if(bizagi.loader.registerMobileWebpart){bizagi.loader.registerMobileWebpart(["newcase","activity","activityFeed","caseProperties","caseTemplates","caseTemplatesOptions","dashBoard","discussionCase","files","filterBar","homePortal","loadForm","menu","menuHome","overviewPlan","render","renderTemplates","searchesList","shortCut","sortBar","stakeHolder","startForm","stuff","summaryCase","syncErrors","taskFeed"])};bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.newcase",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.isMobileDevice=bizagi.util.isMobileDevice(),a.online=a.dataService.online,a.enableOfflineForm=bizagi.util.hasOfflineFormsEnabled(),a.isOfflineFormsV2Supported=a.isMobileDevice&&bizagi.util.isOfflineFormsV2Supported(),bizagi.webpart.subscribe("newcase-refresh",function(e,t){t&&t.refreshCurrentStatus?a.refreshCurrentStatus():a.renderContent({status:"recent"})}),bizagi.webpart.subscribe("createNewCase",function(e,t){return t.notification?t.isBatch?a.createNewCaseNotification(t):a.hasStartForm(t):a.createNewCase(t)}),bizagi.webpart.subscribe("createNewCase-startForm",function(e,t){if(bizagi.util.isNativePluginSupported()&&bizagi.util.isAndroidDevice()){var i={};return i.idProcess=t.idProcess,i.displayName=t.displayName||"",a.createNewCase(i)}})},renderContent:function(e){var t=this;t.online=t.dataService.online,t.currentParams=e;var i=$.Deferred(),a=kendo.template(t.getTemplate("newcase"),{useWithBlock:!1});t.content=a({online:t.online}),$("#content-newCase-drawer",t.canvas).empty(),$("#content-newCase-drawer",t.canvas).html(t.content),$(".km-content:visible").data("kendoMobileScroller")&&$(".km-content:visible").data("kendoMobileScroller").reset();var n=$("#select-process-type",t.canvas).kendoMobileButtonGroup(),r=bizagi.localization.getResource("workportal-widget-newcase-title"),o=e.breadCrumb||[{name:r}];t.changeBreadcrumb(o);var s=e.status||"recent";"recent"===s?n.data("kendoMobileButtonGroup").select(0):n.data("kendoMobileButtonGroup").select(1);var l={status:s,idApp:e.idApp,idCategory:e.idCategory};$(".bz-newcase-list",t.canvas).kendoMobileListView({filterable:!1,template:t.getListTemplate(l),dataBound:function(){$(".bz-newcase-list",t.canvas).on("click","li",function(e){var i=$(this);e.preventDefault(),e.stopPropagation();var a={item:$(".bz-newcase-item",i).data("item")||{},title:$.trim(i.text())},n=t.selectListElement(a,o);n.idProcess?bizagi.util.parseBoolean(bizagi.currentUser.isMultiOrganization)?!0===t.online?t.createOrganizationListByUser(n):$.notifier.add({title:"Error",class_name:"error",text:bizagi.localization.getResource("workportal-offline-error-user-multiorganization","Your user belongs to more than one organization and this device is currently offline. Offline case creation is disabled for users who belong to multiple organizations"),sticky:!0}):t.createNewCase(n):t.renderContent(n)})}});var c={};return bizagi.loading.start(),$.when(t.getData(l)).done(function(e){c=e,$(".bz-newcase-list",t.canvas).data("kendoMobileListView").setDataSource(c),i.resolve()}).fail(function(e){i.resolve()}).always(function(){bizagi.loading.stop()}),$(".bz-grouped-buttons-all, .bz-grouped-buttons-recent",t.canvas).click(function(){$(".km-filter-form",t.canvas).remove(),$(".bz-newcase-list",t.canvas).data("kendoMobileListView").destroy(),$(this).hasClass("bz-grouped-buttons-all")?t.renderContent({status:"all"}):t.renderContent({status:"recent"})}),$(".bz-newcase-search",t.canvas).keyup(function(){c._filter={logic:"or",filters:[{ignoreCase:!0,field:"appName",operator:"contains",value:this.value},{ignoreCase:!0,field:"categoryName",operator:"contains",value:this.value},{ignoreCase:!0,field:"displayName",operator:"contains",value:this.value}]},$(".bz-newcase-list",t.canvas).data("kendoMobileListView").setDataSource(c)}),i.promise()},selectListElement:function(e,t){var i=this;i.online=i.dataService.online;var a=e.item,n={},r=$.trim(a.categoryName||""),o=bizagi.util.parseBoolean(a.isProcess||!0),s=bizagi.util.parseBoolean(a.hasOfflineForm)||!1,l=bizagi.util.parseBoolean(a.forceOffline)&&bizagi.util.isOfflineExecutionSupportedInCurrentEnvironment()||!1,c=bizagi.util.parseBoolean(a.isAdhocProcess)||!1,d=a.appId||null,u=a.idCategory||"",p=a.idWFClass||"",m=a.guidCategory||"";if(d)$(".bz-newcase-list").data("kendoMobileListView").destroy(),$(".km-filter-form").remove(),t.push({name:a.appName||"App",value:d,isApp:!0}),n={status:"all",idApp:d,breadCrumb:t};else if(o){var f=bizagi.util.isEmpty(p)?u:p;f=c?m:f;var g={};g.idProcess=f,g.displayName=e.title,g.isAdhocProcess=c;var b=!i.isOfflineFormsV2Supported&&s&&i.enableOfflineForm,h=i.isOfflineFormsV2Supported&&s&&i.enableOfflineForm&&!i.dataService.online,v=i.isOfflineFormsV2Supported&&l;(b||h||v)&&(g.idOrganization=null,g.isOfflineForm=s,g.process=g.displayName,g.categoryName=r),bizagi.idCategory=f,$("#newCase-drawer").data("kendoMobileDrawer").hide(),n=g}else $(".bz-newcase-list").data("kendoMobileListView").destroy(),$(".km-filter-form").remove(),t.push({name:r,value:u}),n={status:"all",idCategory:u,breadCrumb:t};return n},getData:function(e){var t=this,i=new $.Deferred;if("recent"===e.status){var a={onlyLastProcesses:!0,numberOfProcesses:5};$.when(t.dataService.getRecentProcesses(a)).done(function(e){t.dataSource=new kendo.data.DataSource({transport:{read:function(t){t.success(e.processes)}}}),i.resolve(t.dataSource)}).fail(function(e){var t=bizagi.util.processFailMessage(e);i.reject(t)})}else{var n={};e.idCategory?n={idCategory:e.idCategory}:e.idApp&&(n={idApp:e.idApp}),$.extend(n,{enableOfflineForm:t.enableOfflineForm}),$.when(t.dataService.getCategories(n)).done(function(e){t.dataSource=new kendo.data.DataSource({transport:{read:function(i){var a=t.performCategories(e);i.success(a)}}}),i.resolve(t.dataSource)}).fail(function(e){i.reject($.parseJSON(e.responseText))})}return i.promise()},getListTemplate:function(e){var t=this,i="recent"===e.status?"newCase-categories-recent-process":"newCase-categories-tree";return t.getTemplate(i)},changeBreadcrumb:function(e){var t=this,i=t.getTemplate("newcase-breadcrum"),a=kendo.template(i,{useWithBlock:!1}),n=$(".bz-newcase-title",t.canvas);n.html(a(e)),n.click(function(){t.renderContent(t.clickBreadcrumb(e))})},clickBreadcrumb:function(e){var t={};return e.length>=2?(e.pop(),t={status:"all",breadCrumb:e},e[e.length-1].isApp&&!0===e[e.length-1].isApp?t.idApp=e[e.length-1].value:t.idCategory=e[e.length-1].value):1===e.length&&(t={status:"all"}),t},createNewCase:function(e){var t=this,i=new $.Deferred;if(e.forceOffline&&(e.isOfflineForm=!0),bizagi.loading.start(),e.isOfflineForm){var a={idWfClass:e.idProcess||e.idWFClass,displayName:e.displayName,isOfflineForm:e.isOfflineForm,categoryName:e.categoryName};return t.createCase(a)}return t.dataService.startProcess(e).done(function(a){var n=t.buildCaseParameters(e,a);n.hasStartForm?(n.displayName=e.displayName,t.publish("render-start-form",{params:n})):t.publish("changeCase",n),t.isTabletDevice&&bizagi.webpart.publish("bz-summary-item-clear"),t.publish("bz-update-list-cases",{updateDataList:!0}),i.resolve()}).fail(function(e){var t=$.parseJSON(e.responseText);bizagi.showMessageBox(t.message,"Error"),i.fail()}).always(function(){bizagi.loading.stop()}),i},hasStartForm:function(e){var t=this;return e=e||{},!e.hasStartForm&&e.isShortcut?t.startShortcutProcess(e):t.createNewCaseNotification(e)},startShortcutProcess:function(e){var t=this;t.dataService.actionCreateCase(e).done(function(e){var i=e.caseId;bizagi.loading.stop(),t.dataService.getCaseAssignees({idCase:i}).done(function(e){var a=e.assignees,n=!1;if(void 0!==a&&a.length>0){var r=bizagi.currentUser.idUser;void 0!==a.find(function(e){return e.idUser==r})&&(n=!0)}if(n)t.publish("render-case",{action:"routing",idCase:i});else{var o=bizagi.localization.getResource("workportal-widget-templateengine-action-process-notification");o=o.replace("{0}",i),$.notifier.add({text:o})}})}).fail(function(e){var t=$.parseJSON(e.responseText);bizagi.loading.stop(),bizagi.showMessageBox(t.message,"Error")})},createNewCaseNotification:function(e){var t=this,i=new $.Deferred;return e.hasStartForm?(t.publish("render-start-form",{params:e}),t.publish("bz-update-list-cases",{updateDataList:!0}),bizagi.loading.stop(),i.resolve()):t.dataService.actionCreateCase(e).done(function(a){var n=e.mapping||{},r=e.type||"Process",o={showProcess:!1,isMultiInstance:e.isMultiInstance,notification:!0,hasStartForm:a.hasStartForm,idProcess:a.idProcess,displayName:e.displayName,mapping:n,type:r,idParentCase:e.idParentCase};if($.extend(o,a.caseInfo),e.isBatch){var s=bizagi.localization.getResource("workportal-widget-templateengine-action-process-notification"),l=s.replace("{0}",a.caseNumber),c=printf(bizagi.localization.getResource("workportal-widget-templateengine-message-summary-create-cases-singular"),1);$.notifier.add({title:c,text:l,sticky:!0}),t.publish("bz-update-list-cases",{updateDataList:!0}),bizagi.loading.stop()}else t.dataService.getCaseAssignees({idCase:a.caseId}).done(function(e){var i=e.assignees,n=!1;if(void 0!==i&&i.length>0){var r=bizagi.currentUser.idUser;void 0!==i.find(function(e){return e.idUser==r})&&(n=!0)}if(t.publish("bz-update-list-cases",{updateDataList:!0}),bizagi.loading.stop(),n)t.publish("render-case",{action:"routing",idCase:a.caseId});else{var o=bizagi.localization.getResource("workportal-widget-templateengine-action-process-notification"),s=o.replace("{0}",a.caseNumber),l=printf(bizagi.localization.getResource("workportal-widget-templateengine-message-summary-create-cases-singular"),1);$.notifier.add({title:l,text:s,sticky:!0})}});i.resolve()}).fail(function(e){var t=$.parseJSON(e.responseText);bizagi.loading.stop(),$.notifier.add({title:"Error",class_name:"error",text:t.message,sticky:!0}),i.fail()}),i},createOrganizationListByUser:function(e){var t=this,i=new $.Deferred;return t.isAdjusted=!1,t.dataService.getOrganizationsByUserList().done(function(a){var n=t.getTemplate("newCase-modal-multiorganization"),r=kendo.template(n,{useWithBlock:!1});$(r({list:a.response,idWfClass:e.idProcess,isAdhocProcess:e.isAdhocProcess||!1})).kendoMobileModalView({close:function(){this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),t.configureModalHandlers();var o=$(".bz-wp-modal-organization").data("kendoMobileModalView");$(".bz-wp-modal-organization-footer div.km-rightitem").addClass("inactive"),o.open();var s=function(){var e,i=$(".bz-wp-modal-organization-list",this.element).height();if(0!==i){var a=$(".bz-wp-modal-organization-content",this.element).width(),n=$(".bz-wp-modal-organization-header",this.wrapper).height()+$(".bz-wp-modal-organization-footer",this.wrapper).height(),r=window.innerHeight,o=window.innerWidth;i+n>=r?e=r-20:(e=i+n,"tablet_ios"!==bizagi.util.detectDevice()?e+=t.isAdjusted?90===Math.abs(window.orientation)?8:35:20:e+=90===Math.abs(window.orientation)?20:22);var s=(r-e)/2,l=(o-a)/2;this.wrapper.parent().css("top",s),this.wrapper.parent().css("left",l),this.wrapper.parent().css("height",e),t.isAdjusted=!0}};o.adjustSize=s,o.adjustSize(),window.addEventListener("orientationchange",function(){bizagi.util.isAndroidDevice()?setTimeout(function(){o.adjustSize()},500):o.adjustSize()},!1),i.resolve()}).fail(function(e){if(e.responseText){var t=$.parseJSON(e.responseText);$.notifier.add({title:"Error",class_name:"error",text:t.message,sticky:!0})}else{var a=bizagi.util.processFailMessage(e);bizagi.showMessageBox(a,"Error")}i.fail()}).always(function(){bizagi.loading.stop()}),i},configureModalHandlers:function(){var e=this;$(".bz-wp-modal-organization").delegate(".bz-wp-modal-organization-footer .km-leftitem","click",function(){$(".bz-wp-modal-organization").data("kendoMobileModalView").close()}),$(".bz-wp-modal-organization").delegate(".bz-wp-modal-organization-list > li","click",function(e){var t=$(e.target);$(".bz-wp-modal-organization-list > li").removeClass("bz-wp-modal-organization-list-item-selected"),$(".bz-wp-modal-organization-footer div.km-rightitem").hasClass("inactive")&&($(".bz-wp-modal-organization-footer div.km-rightitem").removeClass("inactive"),$(".bz-wp-modal-organization-footer div.km-rightitem").addClass("active")),t.addClass("bz-wp-modal-organization-list-item-selected")}),$(".bz-wp-modal-organization").delegate(".bz-wp-modal-organization-footer .km-rightitem","click",function(t){if(t.stopPropagation(),!$(".bz-wp-modal-organization-footer div.km-rightitem").hasClass("inactive")){var i=$(this).closest(".bz-wp-modal-organization"),a=(i.data("adhoc"),i.data("workflow")),n=$(".bz-wp-modal-organization-list-item-selected").data("id"),r={};return r.idProcess=a,void 0!=n&&(r.idOrganization=n),e.createNewCase(r)}})},createCase:function(e){var t=this,i=new $.Deferred,a=!e.isOfflineForm||t.dataService.downloadStartFormOnDemand(e.idProcess||e.idWfClass);return $.when(a).then(function(){return t.dataService.createNewCase(e)}).then(function(a){e.isOfflineForm&&(a.offlineType="start"),t.publish("changeCase",a),t.isTabletDevice&&bizagi.webpart.publish("bz-summary-item-clear"),t.publish("bz-update-list-cases",{updateDataList:!0}),i.resolve()}).fail(function(e){var t=$.parseJSON(e.responseText);bizagi.showMessageBox(t.message,"Error"),i.fail()}).always(function(){bizagi.loading.stop()}),i},buildCaseParameters:function(e,t){var i;if(t.oldVersion)i=t,i.hasStartForm=!e.isOfflineForm&&t.hasStartForm||!1,i.displayName=e.displayName;else{var a=e.mapping||{},n=e.type||"Process";i={showProcess:!0,fromNewCase:!0,isMultiInstance:e.isMultiInstance,hasStartForm:!e.isOfflineForm&&t.hasStartForm,idProcess:t.idProcess,displayName:e.displayName,mapping:a,type:n,idParentCase:e.idParentCase},$.extend(i,t.caseInfo)}return i},performCategories:function(e){var t="";if(e.category)try{t=e.category.map(function(e,t){return e.subCategories&&e.subCategories.length>0&&(e.subCategories=[]),e})}catch(e){t="",bizagi.log("Error to map array")}return t},refreshCurrentStatus:function(){this.renderContent(this.currentParams)}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.activity",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.template=kendo.template(a.getTemplate("activity-tmpl"),{useWithBlock:!1})},renderContent:function(){var e=this;return e.dataService.getFavourites().then(function(t){return e.content=e.template(t),e.content})},postRender:function(){this.setEventHandlers()},setEventHandlers:function(){var e=this;$(".wp-myfavorites-all",e.content).bind("click",function(){e.publish("homeportalShow",{what:"myFavorites"})})}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.activityFeed",{PAGE_SIZE:30},{init:function(e,t,i){var a=this;a._super(e,t,i),a.properties={},a.properties.page=1,a.properties.pageSize=a.Class.PAGE_SIZE,a.properties.totalPages=0,a.canvas.bind("view-initialized",function(){a.initializeListView()})},renderContent:function(e){var t=this;return kendo.template(t.getTemplate("main-activityFeed-tmpl"),{useWithBlock:!1})({})},postRender:function(e){},initializeListView:function(){var e=this,t=e.getTemplate("item-activityFeed-tmpl");e.listView=new kendo.mobile.ui.ListView($("#activity-list",e.content),{headerTemplate:'#=(value.split("|"))[1]#',fixedHeaders:!0,template:t,selectable:"single"}),e.getDataSource({page:1,pageSize:e.properties.pageSize}).then(function(t){e.listView.setDataSource(t)})},getDataSource:function(e){return this.dataService.getCurrentActivities(e).then(function(e){return new kendo.data.DataSource({data:e,schema:{data:"elements",total:"totalRecords"},sort:[{field:"endDate",dir:"asc"},{field:"idworkitem",dir:"asc"}],group:{field:"group"}})})}}),bizagi.workportal.webparts.activityFeed.extend("bizagi.workportal.webparts.activityFeed",{},{init:function(e,t,i){this._super(e,t,i),bizagi.webpart.subscribe("homeportalShow-taskFeed",function(e,t){})}}),bizagi.workportal.webparts.rendermanager.extend("bizagi.workportal.webparts.caseProperties",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.caseProperties={}},renderContent:function(e){var t=this,i=$.Deferred(),a=setInterval(function(){bizagi.menuSecurityPromise&&(bizagi.menuSecurityPromise.done(function(){bizagi.menuSecurity.Files||(t.showFilesMenu=!1),bizagi.menuSecurity.Comments||(t.showDiscussionsMenu=!1)}),clearInterval(a))},1e3);return i.resolve(""),i.promise()},postRender:function(e){this.configureHandlers()},configureHandlers:function(){var e=this;e.subscribe("case-properties-init",function(t,i){e.caseProperties=i.params,e.showCasePropertiesOptions=e.caseProperties.allowProperties||!1,e.showFilesMenu=!0,e.showDiscussionsMenu=!0,e.caseProperties.idCase&&$.when(e.getCaseData()).done(function(){bizagi.util.isTabletDevice()&&e.renderCaseSummary();var t=!0,a=void 0!=e.caseProperties.isOfflineForm&&!0===e.caseProperties.isOfflineForm,n=bizagi.util.isConnected();a&&bizagi.util.isTabletDevice()&&(t=!1),a&&!n&&(bizagi.util.isTabletDevice()?t=!1:(e.showDiscussionsMenu=!1,e.showFilesMenu=!1,e.showSummaryFormMenu=!1)),t&&e.configureCaseFolderActionsheet(i.element)})}),bizagi.webpart.subscribe("show-plan-summary",function(t){e.caseProperties.caseDetails&&(e.caseProperties.caseDetails.isActivitySummary=!1,e.renderCaseSummary())}),bizagi.webpart.subscribe("show-case-summary",function(t){e.caseProperties.caseDetails&&(e.caseProperties.caseDetails.isActivitySummary=!0,e.renderCaseSummary())})},renderSummary:function(){this.renderCaseSummary()},configureCaseFolderActionsheet:function(e){var t=this;$(".bz-render-dynamic",e).show().actionSheet({titleLabel:t.getResource("workportal-project-casedashboard-casefolder","case folder"),setDataToShow:function(){return t.getCasePropertiesOptions()},actionClicked:function(e){switch(delete t.caseProperties.data,e.guid){case 0:t.caseProperties.summaryForm=!0,t.publish("render-case",t.caseProperties);break;case 1:t.navigate?t.navigate("#overview-plan"):t.navigator.navigate("#overview-plan"),t.publish("bz-rnd-overviewplan",t.caseProperties);break;case 2:t.caseProperties.summaryForm=!1,t.publish("render-case",t.caseProperties);break;case 3:t.navigate?t.navigate("#discussion-list"):t.navigator.navigate("#discussion-list");var i={globalParent:t.caseProperties.radNumber||t.caseProperties.idCase,dataPlan:{idPlan:t.caseProperties.plan?t.caseProperties.plan.id:null,contextualized:t.caseProperties.plan?t.caseProperties.plan.contextualized:void 0}};t.publish("bz-rnd-discussion",i);break;case 4:t.navigate?t.navigate("#files-list"):t.navigator.navigate("#files-list");var i={globalParent:t.caseProperties.radNumber||t.caseProperties.idCase,dataPlan:{idPlan:t.caseProperties.plan?t.caseProperties.plan.id:null,contextualized:t.caseProperties.plan?t.caseProperties.plan.contextualized:void 0}};t.publish("bz-rnd-files",i);break;case 5:bizagi.webpart.publish("show-case-summary");break;default:t.publish("render-case",t.caseProperties)}},withoutCancel:!0})},getCaseData:function(){var e=this,t=new $.Deferred;return bizagi.loading.start(),bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getCase&&e.caseProperties.isOfflineForm?bizagiapp.getCase(e.caseProperties.idCase,function(i){var a=JSON.parse(i);e.caseProperties.caseDetails=a,bizagi.util.isEmpty(a.idPlan)?(e.showSummaryFormMenu=a.showForm,e.showSummaryPlanMenu=!1,t.resolve()):(e.showSummaryFormMenu=!1,e.showSummaryPlanMenu=!0,e.caseProperties.plan={},e.caseProperties.plan.id=a.idPlan,e.caseProperties.plan.contextualized=a.contextualized,t.resolve()),bizagi.loading.stop()},function(e){bizagi.loading.stop(),t.reject()}):e.dataService.summaryCaseDetails({idCase:e.caseProperties.idCase,eventAsTasks:e.caseProperties.eventAsTasks||!1,onlyUserWorkItems:e.caseProperties.onlyUserWorkItems||!1,idWorkitem:e.caseProperties.idWorkitem,isOfflineForm:e.caseProperties.isOfflineForm||!1,offlineType:e.caseProperties.offlineType}).done(function(i){e.caseProperties.caseDetails=i,bizagi.util.isEmpty(i.idPlan)?(e.showSummaryFormMenu=i.showForm,e.showSummaryPlanMenu=!1,t.resolve()):(e.showSummaryFormMenu=!1,e.showSummaryPlanMenu=!0,e.caseProperties.plan={},e.caseProperties.plan.id=i.idPlan,e.caseProperties.plan.contextualized=i.contextualized,t.resolve())}).fail(function(){t.reject()}).always(function(){bizagi.loading.stop()}),t.promise()},getCasePropertiesOptions:function(){var e=this,t=[],i=$(".bz-form",e.canvas).hasClass("ui-bizagi-summary-form");(void 0===e.showCasePropertiesOptions||e.showCasePropertiesOptions&&!0===e.showCasePropertiesOptions)&&(e.showSummaryPlanMenu&&t.push({guid:1,displayName:e.getResource("workportal-project-casedashboard-view-plan"),icon:"bz-mo-icon bz-inbox"}),e.showDiscussionsMenu&&t.push({guid:3,displayName:e.getResource("workportal-project-casedashboard-discussions"),icon:"bz-mo-icon bz-discussions-case"}),e.showFilesMenu&&t.push({guid:4,displayName:e.getResource("workportal-project-casedashboard-files"),icon:"bz-mo-icon bz-clip"})),e.showSummaryFormMenu&&!i&&t.push({guid:0,displayName:e.getResource("workportal-adhoc-processes-summary-form-button","summary form"),icon:"bz-mo-icon bz-note"}),i&&t.push({guid:2,displayName:e.getResource("workportal-project-casedashboard-activity","Activity"),icon:"bz-mo-icon bz-paper"});var a=e.getSummaryMenu();return a&&t.push(a),t}}),bizagi.workportal.webparts.caseProperties.extend("bizagi.workportal.webparts.caseProperties",{},{init:function(e,t,i){this._super(e,t,i)},postRender:function(e){this._super(e)},renderCaseSummary:function(){var e=this;e.publish("bz-summary-case",e.caseProperties)},getSummaryMenu:function(){return{guid:5,displayName:this.getResource("workportal-taskfeed-summary"),icon:"bz-mo-icon bz-files-document"}},configureHandlers:function(){this._super()}}),bizagi.workportal.webparts.caseProperties.extend("bizagi.workportal.webparts.caseProperties",{},{init:function(e,t,i){this._super(e,t,i)},renderContent:function(e){var t=this;bizagi.util.isNativeHeaderEnabled()||t._super(e)},postRender:function(e){var t=this;bizagi.util.isNativeHeaderEnabled()?t.configureHandlers():t._super(e)},configureHandlers:function(){var e=this;bizagi.util.isNativeHeaderEnabled()?(e.subscribe("case-properties-init",function(t,i){e.caseProperties=i.params,e.showCasePropertiesOptions=e.caseProperties.allowProperties||!1,e.caseProperties&&e.caseProperties.idCase&&$.when(e.getCaseData()).done(function(){bizagi.log("Initialize case folder")})}),e.subscribe("openDiscussion",function(t,i){e.navigate?e.navigate("#discussion-list"):e.navigator.navigate("#discussion-list"),e.publish("bz-rnd-discussion",i)}),e.subscribe("openFiles",function(t,i){e.navigate?e.navigate("#files-list"):e.navigator.navigate("#files-list"),e.publish("bz-rnd-files",i)}),e.subscribe("openSummaryCase",function(t,i){if(bizagi.util.isEmpty(i)||(e.caseProperties.caseDetails=i),e.caseProperties&&e.caseProperties.caseDetails){e.caseProperties.caseDetails.isActivitySummary=!0,e.caseProperties.idWorkitem=e.caseProperties.idWorkitem||"";var a=(e.caseProperties.caseDetails.workItems||[]).find(function(t){return t.idWorkItem.toString()===e.caseProperties.idWorkitem.toString()});e.caseProperties.displayName=a?a.TaskName:e.caseProperties.displayName}else e.caseProperties&&e.caseProperties.caseDetails&&(e.caseProperties.caseDetails.isActivitySummary=null);e.renderCaseSummary()}),e.subscribe("openPlan",function(t,i){bizagi.util.isEmpty(i)||(e.caseProperties.caseDetails=i),e.navigate?e.navigate("#overview-plan"):e.navigator.navigate("#overview-plan"),e.publish("bz-rnd-overviewplan",e.caseProperties)})):e._super()},showPlanSummary:function(){var e=this;e.caseProperties&&e.caseProperties.caseDetails&&(e.caseProperties.caseDetails.isActivitySummary=!1),e.navigate?e.navigate("#summary-case"):e.navigator.navigate("#summary-case"),e.publish("bz-summary-case",e.caseProperties)}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.caseTemplates",{PAGE_SIZE:10},{init:function(e,t,i){var a=this;a._super(e,t,i),a.actionsEvents=new bizagi.actionsEvents(t,"Cases",{homePortalFramework:a.homePortalFramework}),a.caseUsers=new bizagi.caseUsers(t,"Cases",i),a.caseTemplatesGrid=kendo.template(a.getTemplate("case-templates-list"),{useWithBlock:!1}),a.caseTemplatesItem=kendo.template(a.getTemplate("case-templates-item"),{useWithBlock:!1}),a.caseTemplatesActions=kendo.template(a.getTemplate("case-templates-actions"),{useWithBlock:!1}),a.caseTemplatesAssignees=kendo.template(a.getTemplate("case-templates-assignees"),{useWithBlock:!1}),a.caseTemplatesWorkOnIt=kendo.template(a.getTemplate("case-templates-workOnIt"),{useWithBlock:!1}),a.currentPage=1,a.pageSize=a.Class.PAGE_SIZE,a.totalPages=0,a.selectedItems=[],a.entityCollection=[],a.imagesx25={},a.imagesx45={},a.tEnginePromise},renderContent:function(e){return this.caseTemplatesGrid({})},postRender:function(e){var t=this;t.canvas.bind("view-initialized",$.proxy(t.onAfterViewInitialized,t)),t.configureHandler()},configureHandler:function(){var e=this;bizagi.webpart.subscribe("homeportalShow-caseTemplates",function(t,i){var a,n=e.canvas.data("kendoMobileView").contentElement();if(i.onlyFavorites)a={scrollReset:!0,skipAggrupate:!0,taskState:"all",onlyFavorites:!0,myActivities:!0,refresh:i.refresh||!1,idworkflow:void 0!==i?i.idworkflow||null:null,idCase:i.idCase};else switch(a={scrollReset:!0,skipAggrupate:!0,onlyFavorites:!1,refresh:i.refresh||!1,idworkflow:void 0!==i?i.idworkflow||null:null,idCase:i.idCase},i.subcategory){case"ontime":a.taskState="Green";break;case"overdue":a.taskState="Red";break;case"risk":a.taskState="Yellow";break;case"pendings":default:a.taskState="all"}return e.renderTemplatesOptions=a,a.idCase?(a.canvasElement=$('li.wp-case-template-item[data-idcase="'+a.idCase+'"]',n),$(".wp-item-container",a.canvasElement).empty()):($("#tmpl-list",e.content).empty(),e.currentPage=1),a.refresh||bizagi.webpart.publish("display-caseTemplateOptions",a),$.proxy(e.updateCases,e)(a)})},updateCases:function(e){var t,i=this,a={onlyFavorites:e.onlyFavorites,taskState:e.taskState};return e.idCase?(t={idCase:e.idCase||null},$.when(i.getCasesData(t,a)).then(function(a){return i.entityCollection=i.entityCollection.concat(a.entities),i.getCasesTemplates(a,{idCase:t.idCase,canvasElement:e.canvasElement})})):(e.scrollReset&&i.canvas.data("kendoMobileView").scroller.reset(),t={page:i.currentPage,pageSize:i.pageSize},e.idworkflow&&(t.idWorkflow=e.idworkflow),$.when(i.getCasesData(t,a)).then(function(e){if(i.currentPage=e.currentPage,i.totalPages=e.totalPages,i.entityCollection=i.entityCollection.concat(e.entities),e.totalRecords>0)return i.getCasesTemplates(e,{});i.showNoItems(!0)}))},getCasesData:function(e,t){var i=this;return i.showNoItems(!1),i.showLoadMore(!1),t.onlyFavorites?this.dataService.getActivitiesData(e):this.dataService.getPendingsData($.extend(e,{taskState:t.taskState}))},paintHeaderFooterButtons:function(e){var t=this;t.caseUsers.getUsers(e).then(function(i){t.showUsers(e),t.showUsersImagesx25(),t.showUsersImagesx45()}),t.actionsEvents.getEvents(e).done(function(){t.actionsEvents.getActions(e).done(function(){t.showActionsEvents(e)})})},showUsers:function(e){for(var t,i=this,a=-1;t=e[++a];){var n=t.item,r=$(".header-section",n),o=$(".users-section",n).kendoMobileScroller();o=o.data("kendoMobileScroller").scrollElement;var s=i.caseTemplatesAssignees;o.append(s({assignees:t.users})),$("div",$("div.hs-image.createdby",r)).text(t.createdBy.initials).data("user-id",t.createdBy.idUser),void 0===i.imagesx25[t.createdBy.idUser]&&(i.imagesx25[t.createdBy.idUser]={canvas:[]}),i.imagesx25[t.createdBy.idUser].canvas.push($("div.hs-image.createdby",r)),t.assignees.length>0&&t.assignees[0].idUser!==t.createdBy.idUser?($("div",$("div.hs-image.first-asignee",r)).text(t.assignees[0].initials).data("user-id",t.createdBy.idUser),void 0===i.imagesx25[t.assignees[0].idUser]&&(i.imagesx25[t.assignees[0].idUser]={canvas:[]}),i.imagesx25[t.assignees[0].idUser].canvas.push($("div.hs-image.first-asignee",r))):$("div.hs-image.first-asignee",r).hide();for(var l=0;l<t.users.length;l++)void 0===i.imagesx45[t.users[l].idUser]&&(i.imagesx45[t.users[l].idUser]={canvas:[]}),i.imagesx45[t.users[l].idUser].canvas.push($('div.no-picture[data-user-id="'+t.users[l].idUser+'"]',o));if(t.users.length>2){var c=$("div.hs-image.more-asignee",r);c.css("display","inline-block"),$("span",c).text("+"+(t.users.length-2))}i.showWorkOnIt(t)}},showActionsEvents:function(e){for(var t,i=this,a=i.caseTemplatesActions,n=-1;t=e[++n];){var r=$(".actions-section",t.item),o=[];if($.merge(o,t.events),t.actions)for(var s=0,l=t.actions.length;s<l;s++)0!==t.actions[s].multiplicity&&1!==t.actions[s].multiplicity||o.push(t.actions[s]);var c={more:!1,buttons:o};o.length>0&&($(".wp-action-space",r).remove(),o.length>2&&(c.more=!0)),r.prepend(a(c)),i.executeAction(r,o,t)}},showUsersImagesx25:function(){var e=this,t=$.map(e.imagesx25,function(e,t){return t});$.when(e.dataService.getUsersImages({width:25,height:25,square:!0},t)).done(function(t){for(var i=0;i<t.length;i++){var a=t[i];e.imagesx25[a.id].picture=a.picture}jQuery.each(e.imagesx25,function(e,t){var i=t.canvas,a=t.picture;if(void 0!==a)for(var e=0,n=i.length;e<n;e++){var r=$("<img>").attr("src","data:image/png;base64,"+a);i[e].html(r)}})})},showUsersImagesx45:function(){var e=this,t=$.map(e.imagesx45,function(e,t){return t});$.when(e.dataService.getUsersImages({width:45,height:45,square:!0},t)).done(function(t){for(var i=0,a=t.length;i<a;i++){var n=t[i];e.imagesx45[n.id].picture=n.picture}jQuery.each(e.imagesx45,function(e,t){var i=t.canvas,a=t.picture;if(void 0!==a)for(var e=0,n=i.length;e<n;e++){var r=$("<img>").attr("src","data:image/png;base64,"+a);i[e].html(r),i[e].removeClass("no-picture")}})})},markFavorite:function(e,t){var i=this;$(".wp-action-favorite",e).unbind("click").bind("click",function(){var e,a=this,n=$(a).data("id-object");bizagi.util.smartphone.startLoading(i.pane),void 0!==n?(e={idObject:n},$.when(i.dataService.delFavorite(e)).done(function(e){bizagi.util.parseBoolean(e.deleted)&&($(a).removeData("id-object"),$(a).removeAttr("data-id-object"),$(a).addClass("no-mark"))}).always(function(){bizagi.util.smartphone.stopLoading()})):(e={idObject:t,favoriteType:"CASES"},$.when(i.dataService.addFavorite(e)).done(function(e){$(a).data("id-object",e.idFavorites),$(a).removeClass("no-mark")}).always(function(){bizagi.util.smartphone.stopLoading()}))})},getSelectedItems:function(){return this.selectedItems},addSelectedItem:function(e){this.selectedItems.push(e)},deleteSelectedItem:function(e){this.selectedItems.splice(this.selectedItems.indexOf(e),1)},findDataItem:function(e){return this.entityCollection.find(function(t){return t.surrogateKey==e})},handleDataNavigation:function(){var e=this;e.engine.subscribe("onLoadDataNavigation",function(t,i){i.filters=[],e.homePortalFramework._cleanContext(),e.homePortalFramework.addContext(i.data),e.publish("homeportalShow",{what:"stuffTemplates",title:i.data.displayName,params:$.extend(i,{unableBackButton:!1})})})}}),bizagi.workportal.webparts.caseTemplates.extend("bizagi.workportal.webparts.caseTemplates",{},{postRender:function(e){var t=this;t._super(e),t.tEnginePromise=$.when(t.workportalFacade.modules[t.workportalFacade.Class.render_module]).then(function(){var i=e.proxyPrefix||t.dataService.serviceLocator.proxyPrefix,a=new bizagi.render.services.service({proxyPrefix:i}),n=new bizagi.rendering.smartphone.factory(a);return $.when(n.initAsyncStuff()).then(function(){t.engine=new bizagi.templateEngine({renderFactory:n,cache:!0,forcePersonalizedColumns:!0}),t.handleDataNavigation()})})},configureHandler:function(){var e=this;e._super(),$("#tmpl-list",e.content).delegate("div.wp-action-item-check","click",function(t){var i=this.classList.contains("selected"),a=e.findDataItem($(this).data("surrogatekey"));i?($(this).removeClass("selected"),e.deleteSelectedItem(a)):($(this).addClass("selected"),e.addSelectedItem(a)),e.selectedItems.length>0?($(".wp-ly-secondary-header",e.canvas).show(),$(".wp-ly-principal-header",e.canvas).hide()):($(".wp-ly-secondary-header",e.canvas).hide(),$(".wp-ly-principal-header",e.canvas).show())}),$(".bz-case-templates-footer",e.content).unbind().bind("click",function(){e.pane.show(),e.currentPage++,e.updateCases($.extend(e.renderTemplatesOptions,{scrollReset:!1}))}),$("#tmpl-list",e.content).on("click",".header-section .hs-images",function(e){$(e.currentTarget).closest(".wp-case-template-item").addClass("users")}),$("#tmpl-list",e.content).on("click",".header-section .wp-action-item-back",function(e){
$(e.currentTarget).closest(".wp-case-template-item").removeClass("users")})},onAfterViewInitialized:function(e,t){var i=this;$(".bz-header-btn5",t.header).actionSheet({setDataToShow:function(){var e=i.actionsEvents.getCommomActions(i.getSelectedItems());return 0===e.length&&bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-no-actions-found"),"Bizagi",!0,[{label:"Ok",action:"resolve"}]),e},actionClicked:function(e){i.actionsEvents.executeActionMultipleData(e,i.entityCollection[0],i.getSelectedItems())}}),$(".wp-ly-secondary-header .bz-header-back-btn",t.header.context).bind("click",function(e){i.removeShowGrouping()})},showWorkOnIt:function(e){var t=this,i=t.caseTemplatesWorkOnIt,a=bizagi.localization.getResource("workportal-case-dialog-box-workOnIt");$(".actions-section",e.item).append(i({displayName:a,icon:"workonit",type:"WorkOnIt"}))},removeShowGrouping:function(){var e=this;e.selectedItems=[],$("div.wp-action-item-check",e.content).removeClass("selected"),$(".wp-ly-secondary-header",e.canvas).hide(),$(".wp-ly-principal-header",e.canvas).show()},showLoadMore:function(e){var t=this;e?t.currentPage===t.totalPages||0===t.totalPages?$(".bz-case-templates-footer",t.content).hide():$(".bz-case-templates-footer",t.content).show():$(".bz-case-templates-footer",t.content).hide()},showNoItems:function(e){var t=this;e?$(".bz-case-templates-no-content",t.content).show():$(".bz-case-templates-no-content",t.content).hide()},updateCases:function(e){var t=this;bizagi.util.smartphone.startLoading(),t._super(e).then(function(e){bizagi.util.smartphone.stopLoading()})},getCasesTemplates:function(e,t){var i=this,a=$("#tmpl-list",i.content);return $.when(i.tEnginePromise).then(function(){var t=$.map(e.entities,function(e){return $.when(i.engine.render(e)).then(function(t){var n=$(i.caseTemplatesItem({idCase:e.idCase,guidFavorite:e.guidFavorite||null,surrogateKey:e.surrogateKey}));n.find(".wp-item-container").append(t);var r=n.appendTo(a);e.item=r,i.markFavorite(r,e.idCase)})});return $.when.apply($,t).then(function(){i.paintHeaderFooterButtons(e.entities),i.showLoadMore(!0)})})},executeAction:function(e,t,i){var a=this;$(".wp-ct-action-more",e).actionSheet({setDataToShow:function(){return t},actionClicked:function(e){a.actionsEvents.executeActionSingleData(e,i)}}),$(".wp-action",e).unbind("click").bind("click",function(e){var t=bizagi.util.isTabletDevice()?e.target.closest(".wp-case-template-item"):e.target.parentElement.parentElement,n=void 0!==t.dataset.idcase?t.dataset.idcase:t.parentElement.dataset.idcase;a.executeWpAction($(this).data("action"),i),bizagi.util.smartphone.startLoading(),a.dataService.summaryCaseDetails({idCase:n}).done(function(e){e.showForm?$("#overViewMenu").show():$("#overViewMenu").hide()}).always(function(){bizagi.util.smartphone.stopLoading()})})},executeWpAction:function(e,t){this.actionsEvents.executeActionSingleData(e,t)}}),bizagi.workportal.webparts.caseTemplates.extend("bizagi.workportal.webparts.caseTemplates",{},{}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.caseTemplatesOptions",{},{init:function(e,t,i){this._super(e,t,i)},postRender:function(e){var t=this;t.configureHandler(),$(".bz-wp-cto-list",t.content).kendoMobileListView({headerTemplate:bizagi.localization.getResource("workportal-widget-processeslist-title-process"),fixedHeaders:!0,filterable:!1,template:t.itemTemplate,click:function(e){e.item.siblings().removeClass("cto-selected"),e.item.addClass("cto-selected"),t.selectOption(e.dataItem)}}),$(".bz-caseTemplatesOptions-search",t.content).keyup(function(){t.dataSource._filter={logic:"or",filters:[{ignoreCase:!0,field:"name",operator:"contains",value:this.value},{ignoreCase:!0,field:"category",operator:"contains",value:this.value}]},$(".bz-wp-cto-list",t.canvas).data("kendoMobileListView").setDataSource(t.dataSource)})},configureHandler:function(){var e=this;bizagi.webpart.subscribe("display-caseTemplateOptions",function(t,i){e.properties=i,e.displayCaseTemplateOptions(i)})},displayCaseTemplateOptions:function(e){var t=this;$.when(t.getData(e)).done(function(){$(".bz-wp-cto-list",t.content).data("kendoMobileListView").setDataSource(t.dataSource),$(".km-group-container .km-list li:first",t.content).addClass("cto-selected")}).always(function(){bizagi.loading.stop()})},getData:function(e){var t=this;return bizagi.loading.start(),$.when(t.dataService.getAllProcesses(e)).done(function(i){t.dataSource=new kendo.data.DataSource({transport:{read:function(t){var a=0,n=[],r={name:bizagi.localization.getResource("workportal-widget-inbox-all-cases"),path:"",category:"Processes",isFavorite:e.onlyFavorites||!1,guidFavorite:"",idworkflow:"",guidWFClass:"",count:0};if(void 0!==i.workflows){for(var o=0,s=i.workflows.workflow.length;o<s;o++)a+=Number(i.workflows.workflow[o].count),i.workflows.workflow[o].category="Processes";r.count=a,n.push(r),$.merge(n,i.workflows.workflow)}else n.push(r);t.success(n)}},group:{field:"category"}})})},selectOption:function(e){var t=this;t.publish("homeportalShow",{what:"caseTemplates",title:"title",params:$.extend(e,{refresh:!0,onlyFavorites:t.properties.onlyFavorites})})}}),bizagi.workportal.webparts.caseTemplatesOptions.extend("bizagi.workportal.webparts.caseTemplatesOptions",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.itemTemplate=kendo.template(a.getTemplate("case-templates-options-item"),{useWithBlock:!1})},renderContent:function(e){var t=this,i=$.Deferred(),a=t.homePortalFramework.loadComponentTemplate("case-templates-options","caseTemplatesOptions",{});return $(".caseTemplatesOptions-content",t.canvas).html(a),i.resolve(),i.promise()},postRender:function(e){this._super(e)},configureHandler:function(){this._super()}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.dashBoard",{},{init:function(e,t,i){this._super(e,t,i)},renderContent:function(e){return this.homePortalFramework.loadComponentTemplate("dashBoard-tmpl","dashBoard",{useWithBlock:!1})},postRender:function(e){var t=this;return t.homePortalFramework.loadComponents("dashBoard",t.content).done(function(){t.configureHandlers(),t.configureSuscriptions(),$(document).trigger("fetch-offline-processes")})},configureHandlers:function(){var e=this;$(e.content).on("click",".wp-db-item",function(){var t=$(this).data("db-subcategory"),i=$(".wp-db-title",this).text();switch(t){case"favorites":e.publish("homeportalShow",{what:"caseTemplates",title:i,params:{subcategory:t,onlyFavorites:!0},transition:"overlay:right"});break;case"pendings":case"ontime":case"overdue":case"risk":e.publish("homeportalShow",{what:"caseTemplates",title:i,params:{subcategory:t},transition:"overlay:right"});break;case"taskfeed":e.goTaskFeed()}})},goTaskFeed:function(){this.publish("homeportalShow",{what:"taskFeed"})}}),bizagi.workportal.webparts.dashBoard.extend("bizagi.workportal.webparts.dashBoard",{},{init:function(e,t,i){this._super(e,t,i)},goTaskFeed:function(){bizagiapp.showActivityFeed()}}),bizagi.workportal.webparts.dashBoard.extend("bizagi.workportal.webparts.dashBoard",{},{init:function(e,t,i){this._super(e,t,i)},configureSuscriptions:function(){bizagi.util.isOfflineExecutionSupportedInCurrentEnvironment()&&!bizagi.util.isiOSSmartphoneDevice()&&bizagi.webpart.subscribe("homeportalShow-menuHome",function(e,t){$(document).trigger("fetch-offline-processes")})}}),bizagi.workportal.webparts.rendermanager.extend("bizagi.workportal.webparts.discussionCase",{QUALITY_PICTURE:80,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav"],PAGE_SIZE:5},{init:function(e,t,i){var a=this;a._super(e,t,i);var n=a.getTemplate("discussionCase-tmpl-main");a.templateMain=kendo.template(n,{useWithBlock:!1}),bizagi.util.mobility.discussionsViewInit=$.proxy(a.renderViewInit,a),bizagi.util.mobility.commentsViewInit=$.proxy(a.commentsViewInit,a),a.tags=[],a._discussions=[],a._attachmentsToCreate=[],a._attachments=[],a.newDiscussion=!1,a.attchDiscussions={remove:[],addition:[]}},renderContent:function(){return""},commentsViewInit:function(e){var t=this,i=e.view.scroller,a=t.getTemplate("commentsCreation-tmpl"),n=kendo.template(a,{useWithBlock:!1});$(e.view.layout.footer).append(n()),$(".bz-create-attachment",e.view.footer).kendoMobileButton(),$(".bz-create-comment",e.view.footer).kendoMobileButton(),t.configureUploadHandlers(e.view.layout.footer),t.buildUploadResolutionControl(e.view.layout.footer),i.setOptions({pullToRefresh:!0,pull:function(){setTimeout(function(){var e={guid:t._discussionGuid};t.initCommentlist(e),i.pullHandled()},400)}})},renderViewInit:function(e){var t=this;t.discussionsView=e.view,t.content=$(t.templateMain({})),e.view.contentElement().append(t.content),t.configureHandlers(t.content),t.configureDiscussionHeaderHandlers(e.view.layout),t.pane=$("#paneRender").data("kendoMobilePane"),bizagi.util.isNativeHeaderEnabled()||t.configureActionButtons($("#discussion-list",t.canvas))},configureActionButtons:function(e){var t=this;if(bizagi.override.enableFormButtons){var i=[{id:Math.ceil(1e5*Math.random()),action:"add",label:bizagi.localization.getResource("workportal-project-discussion-adddiscussion"),ordinal:1,priority:1,additional:!1}];$(e).formButtons({buttons:i,click:function(){t.openCreateDiscussion()}})}else $(e).mfb({click:function(){t.openCreateDiscussion()}})},initDiscussionList:function(e){var t=this,i=t.getTemplate("discussionCase-tmpl"),a=kendo.template(i,{useWithBlock:!1}),n=t.getCurrentUserInfo(),r=$(".bz-main-list",t.canvas);return t._globalParent=e.globalParent,r.empty(),t.discussionsView.scroller.reset(),e=e||{},t.globalParent=e.globalParent,bizagi.loading.start(),$.when(t.validateNonContextualizedPlan(e)).then(function(e){return t.dataService.getDiscussionCase(e).then(function(e){return e.length?(e.typeResource="discussion",t.organizeListsAndFormat(e).then(function(i){var o=[];$.each(e,function(a,n){t.updateTagsArray(n.tags),n.user?n.user=i.find(function(e){return e.id==n.user}):n.user={id:0,name:"general"},n.attachments&&n.attachments.length>=1&&$.each(n.attachments,function(i,n){if(t.validateFileExtensions(n.name)){var r=$.when(t.dataService.getFilesThumbnail({guids:e[a].attachments[i].guid+"",width:250,height:200,globalParent:t._globalParent})).then(function(e){n.dataAsBase64="data:image/jpg;base64,"+e[n.guid]}).fail(function(e){bizagi.log(e)});o.push(r)}})}),$.when.apply($,o).done(function(){var i=a({discussion:e,currentUser:n});t._discussions=e,$(r).append(i),t.actionListComment()})})):($("#discussion-list",t.canvas).find(".bz-warning").removeClass("hidden"),(new $.Deferred).resolve().promise())})}).fail(function(e){bizagi.showMessageBox(bizagi.localization.getResource("render-document-error-generate"),"Error")}).always(function(){bizagi.loading.stop()})},getCurrentUserInfo:function(){return{name:bizagi.currentUser.userName,id:bizagi.currentUser.idUser,picture:""}},validateNonContextualizedPlan:function(e){var t=this,i=$.Deferred();return void 0===t._contextualizedPlan||t._contextualizedPlan?i.resolve(e):$.when(t.dataService.getFirstParentPlan({idPlan:t._idPlan})).done(function(a){e.globalParent=a&&a.id?a.id:t._idPlan,i.resolve(e)}),i.promise()},openCreateDiscussion:function(e){var t=this,i={},a="";bizagi.loading.start(),void 0!==e?(i=t._discussions.find(function(t){return t.guid==e}),a=bizagi.localization.getResource("workportal-project-discussion-edit")):a=bizagi.localization.getResource("workportal-project-discussion-adddiscussion"),t.pane=t.pane||$("#paneRender").data("kendoMobilePane"),t.pane.navigate("discussion-create");var n=$("#discussion-create").data("kendoMobileView").contentElement(),r=kendo.template(t.getTemplate("discussion-create-tmpl"),{useWithBlock:!1});t.content=r(i),n.empty().append(t.content),$("#discussion-create .bz-render-header .km-view-title span",t.canvas).text(a);var o=$(".bizagi-ui-tags-plugin",n);t.tagsControl=o.uitags(t.workportalFacade,{dataSource:t.tags,value:i.tags||[]}),t.attchDiscussions={addition:i.attachments?i.attachments.slice():[],remove:[]},t.configureUploadHandlers(n),t.buildUploadResolutionControl(n),bizagi.loading.stop()},removeAttachment:function(e){for(var t=this,i=e.data("guid"),a=t.attchDiscussions.addition,n=t.attchDiscussions.remove,r=0,o=a.length;r<o;r++)if(t.getCurrentGuid(a[r])===i){var s=a.splice(r,1),l=t.getCurrentGuid(s[0]);n.push(l),r=o}e.remove()},getCurrentGuid:function(e){var t="";return e&&e.guid&&(t=e.guid),e.params&&e.params.guid&&(t=e.params.guid),t},validateDiscussion:function(e){var t=this,i={};bizagi.loading.start(),t.configureBasicParams(i,e),$.when(t.validateNonContextualizedPlan(i)).done(function(e){t.createOrUpdateDiscussion(i,e)})},configureBasicParams:function(e,t){var i=this,a=$(".bz-form-data").find('[class*="bz-val"]');e.globalParent=i.globalParent,e.guid=t,e.date=(new Date).getTime(),$.each(a,function(t,i){var a=$(i).data("value");e[a]=$(i).val()})},createOrUpdateDiscussion:function(e,t){var i=this;if(e.description&&e.name){var a=i.getDiscussionAttachments(),n=i.tagsControl.getTagsElements();i.updateTagsArray(n),e.user=bizagi.currentUser.idUser;var r={content:{name:t.name,description:t.description,globalParent:t.globalParent,user:e.user,attachments:a.attachments,guid:e.guid||Math.guid(),tags:i.tags,typeResource:"Discussion",general:!1,date:e.date},attachmentsToCreate:a.attachmentsToCreate,attachmentsToDelete:a.attachmentsToDelete};e.guid?i.dataService.editDiscussion(r).done(function(){var e="";i.initDiscussionList({globalParent:i.globalParent}),i.goBack(),bizagi.util.isNativeHeaderEnabled()&&(e="native-header "),$.notifier.add({title:"",text:bizagi.localization.getResource("workportal-project-discussion-edited"),class_name:"success",position:e,sticky:!1})}).fail(function(){i.pane.navigate("discussion-list"),$.notifier.add({title:"Error",text:bizagi.localization.getResource("workportal-project-discussion-error-edition"),class_name:"error",sticky:!1})}).always(function(){bizagi.util.smartphone.stopLoading(),i.attchDiscussions={remove:[],addition:[]}}):i.dataService.createNewDiscussion(r).done(function(){i.initDiscussionList({globalParent:i.globalParent}),i.goBack(),bizagi.loading.stop()}).fail(function(e){bizagi.log(e),bizagi.loading.stop()}).always(function(){bizagi.util.smartphone.stopLoading(),i.attchDiscussions={remove:[],addition:[]}})}else{var o=bizagi.localization.getResource("workportal-widget-admin-dimensions-comfirm-message");bizagi.showMessageBox(o,"Error"),bizagi.util.smartphone.stopLoading()}},getDiscussionAttachments:function(){var e=this,t=[],i=e.attchDiscussions,a=[];i=i||{addition:[],remove:[]};for(var n=0,r=i.addition.length-1;n<=r;n++)t.push({guid:i.addition[n].guid||i.addition[n].params.guid,name:i.addition[n].name||i.addition[n].fileName}),a.push(i.addition[n].guid||i.addition[n].params.guid);return{attachments:t,attachmentsToCreate:a,attachmentsToDelete:i.remove}},updateTagsArray:function(e){var t=this;t.tags=[];for(var i=0,a=e.length;i<a;i++){t.validateTag(e[i]).length>0||""===e[i].tag||t.tags.push(e[i])}},validateTag:function(e){return this.tags.filter(function(t){return t.guid==e.guid})},initCommentlist:function(e){var t=this;bizagi.loading.start(),e=e||{},t._discussionGuid=e.guid,t._commentsCounter=[],t._lastCommentDate=(new Date).getTime(),t.attchDiscussions={remove:[],addition:[]},t._attachmentsToCreate=[],t._attachments=[];var i=t._discussions.find(function(t){return t.guid==e.guid}),a=kendo.template(t.getTemplate("list-comment-tmpl"),{useWithBlock:!1});$("#comment-list",t.canvas).data("kendoMobileView").contentElement().empty().append(a(i)),$("#comment-list .bz-render-header .km-view-title span",t.canvas).text(i.name),t.configureCommentsEvents(),$.when(t.commentList()).always(function(){bizagi.loading.stop()})},commentList:function(){var e=this,t=$("#comment-list .bz-main-list",e.canvas),i=kendo.template(e.getTemplate("commentDiscussion-tmpl"),{useWithBlock:!1}),a=$("#comment-list",e.canvas).find(".bz-more-comments"),n=e.getCurrentUserInfo();return $.when(e.dataService.getCommentCase({idParent:String(e._discussionGuid),count:e.Class.PAGE_SIZE,dateTime:e._lastCommentDate})).then(function(r){if(r.length>=1)return e.organizeListsAndFormat(r).then(function(o){var s=[];$.each(r,function(t,i){i.attachments.length>=1&&$.each(i.attachments,function(i,a){if(e.validateFileExtensions(a.name)){var n=$.when(e.dataService.getFilesThumbnail({guids:r[t].attachments[i].guid+"",width:250,height:200,globalParent:e._globalParent})).then(function(e){a.dataAsBase64="data:image/jpg;base64,"+e[a.guid]}).fail(function(e){bizagi.log(e)});s.push(n)}}),i.user=o.find(function(e){return e.id==i.user}),e._lastCommentDate=i.date,e._commentsCounter++}),$.when.apply($,s).done(function(){var o=i({comments:r,currentUser:n});return $(t).append(o),e.dataService.getCommentsByParent({idParent:String(e._discussionGuid)}).then(function(t){t.count>e._commentsCounter&&a.show()})})}).fail(function(e){bizagi.log(e)});a.hide()}).fail(function(e){bizagi.log(e)})},deleteComment:function(e){var t=this,i=bizagi.localization.getResource("workportal-project-discussion-querydelete");$.when(bizagi.showConfirmationBox(i,"Bizagi","warning")).done(function(){for(var i=$(e.target).closest(".bz-wp-single-comment"),a=i.find(".bz-wp-info-comment-attach"),n=[],r=0,o=a.length;r<o;r++)n.push($(a[r]).data("guid"));var s={content:{guid:i[0].dataset.guid},attachmentsToDelete:n};t.dataService.removeMobileComment(s).done(function(e){if(200===e.status||void 0===e.status)i.remove();else{var a=bizagi.localization.getResource("workportal-project-discussion-errordelete");t.plugins.popupNotification.show(a,"error")}})}).fail(function(){bizagi.log("dont do nothing! :)")})},validateFileExtensions:function(e){return!!/(.jpg|.gif|.png|.bmp|.jpeg)$/i.test(e)},createComment:function(){var e=this,t=new $.Deferred;bizagi.loading.start();var i={content:{guid:Math.guid(),parent:e._discussionGuid,date:(new Date).getTime(),attachments:e._attachments},attachmentsToCreate:e._attachmentsToCreate,attachmentsToDelete:[]},a=$("#comment-list",e.canvas).find('[class*="bz-val"]');return $.each(a,function(e,t){var a=$(t).data("value");i.content[a]=$(t).val()}),i.content.text||0!=e._attachmentsToCreate.length?e.getUserCreation().done(function(n){e._commentsCounter=[],e._lastCommentDate=(new Date).getTime(),$("#comment-list .bz-main-list",e.canvas).empty(),i.content.user=n.idUser,e.dataService.createNewComment({data:i}).done(function(i){$.when(e.commentList()).always(function(){$.each(a,function(e,t){$(t).val("")}),bizagi.loading.stop(),t.resolve("Success")})}).fail(function(e){bizagi.log(e.error),bizagi.loading.stop(),t.reject(e.error)})}):(t.reject("Faltan campos por llenar"),bizagi.loading.stop()),t.promise()},showMoreComments:function(){var e=this;bizagi.loading.start(),$("#comment-list",e.canvas).find(".bz-more-comments").hide(),$.when(e.commentList()).always(function(){bizagi.loading.stop()})},organizeListsAndFormat:function(e){var t=this,i=0,a=[],n=bizagi.util.getFeatureObject("userService.v1.enabled");return e=e||[],$.each(e,function(r,o){1==o.general&&"discussion"==e.typeResource&&(o.name=t.resources.getResource("workportal-project-discussion-generaldiscussion"),i=r),o.user?-1===a.indexOf(o.user)&&a.push(o.user):n||a.push(0);var s=new Date(o.date);o.newDate=bizagi.util.dateFormatter.getRelativeTime(s,"dd/MM/yyyy HH:mm:ss:ff")}),"discussion"==e.typeResource&&(e.splice(0,0,e[i]),i++,e.splice(i,1)),t.dataService.getUsersDiscussion(a.join(","))},getUserCreation:function(){return this.dataService.getCurrentUser()},actionListComment:function(){var e=this,t={};$(".bz-wp-single-discussion",e.canvas).on("click",function(){t.guid=$(this).data("guid"),e.pane.navigate("comment-list"),e.configureDeleteCommentsEvents(),e.initCommentlist(t)}),$(".bz-wp-single-discussion-settings",e.canvas).on("click",function(t){t.stopPropagation();var i=$(this).closest(".bz-wp-single-discussion").data("guid");e.openCreateDiscussion(i)}),$(".bz-wp-discussion-footer li.bz-wp-info-attach",e.canvas).off("click").on("click",function(t){t.stopPropagation(),e.attachGuid=$(this).data("guid");var i=$(this).find("span").text();$.when(e.dataService.getMobileAttachment({idAttachment:e.attachGuid})).then(function(t){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t,i)).fail(function(t){t.responseText&&e.getFormContainer().failHandler(t.responseText)}).always(function(){bizagi.loading.stop()})})})},buildUploadResolutionControl:function(e){var t=this,i=[{guid:1,displayName:bizagi.localization.getResource("workportal-size-small")},{guid:2,displayName:bizagi.localization.getResource("workportal-size-medium")},{guid:3,displayName:bizagi.localization.getResource("workportal-size-large")},{guid:4,displayName:bizagi.localization.getResource("workportal-size-original")}];$(".bz-rn-upload-resolution-container",e).actionSheet({actions:i,actionClicked:function(e){t.handlerResolutionUpload(e.guid)}})},handlerResolutionUpload:function(e){var t=this,i=e||0;if(4===i)t.saveImage(t,t.dataImage);else{var a=bizagi.util.media.getImageResolution(i);bizagi.loading.start(),$.when(bizagi.util.media.transformImageSize(t.dataImage,a)).done(function(e){t.editedImageURL=e.localUrl,t.saveImage(t,t.dataImage)}).fail(function(e){bizagi.showMessageBox("An error has occurred: Code = "+e.code)}).always(function(e){bizagi.loading.stop()})}},configureDeleteCommentsEvents:function(){var e=this;$("#comment-list",e.canvas).off("click",".bz-delete-comment").on("click",".bz-delete-comment",function(t){e.deleteComment(t)})},configureCommentsEvents:function(){var e=this;$(".bz-more-comments",e.canvas).on("click",function(){e.showMoreComments()}),$(".bz-wp-box-discussion",e.canvas).delegate(".bz-wp-info-comment-attach","click",function(t){e.attachGuid=!(!t.currentTarget||!t.currentTarget.attributes[0])&&t.currentTarget.attributes[0].nodeValue;var i=$(this).find("img").data("name");bizagi.util.isCordovaSupported()?$.when(e.dataService.getMobileAttachment({idAttachment:e.attachGuid})).then(function(t){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t,i)).fail(function(t){t.responseText&&e.getFormContainer().failHandler(t.responseText)}).always(function(){bizagi.loading.stop()})}):e.processAttachment(t)})},processAttachment:function(e){var t=this;e.toElement.currentSrc?(t.slideFormParams={preview:bizagi.localization.getResource("workportal-actionsheet-upload-image-preview")},t.slideForm=$($.kendoTmpl(t.getTemplate("discussion-image-view"),t.slideFormParams)),$("#paneRender").append(t.slideForm),t.view=new kendo.mobile.ui.View(t.slideForm,{useNativeScrolling:!0}),t.pane=$("#paneRender").data("kendoMobilePane"),t.pane.navigate(t.view.id),t.scrollContent=$("#render-content",t.view.contentElement()),t.configureViewHandlers(),t.renderEdition(t.attachGuid)):$.when(t.dataService.getMobileAttachment({idAttachment:t.attachGuid})).then(function(e){window.open(e,"_system")})},configureViewHandlers:function(){var e=this;$(".bz-render-back",e.slideForm).bind("click",function(){e.goBack()})},goBack:function(){this.pane.navigate("#:back")},renderEdition:function(e){var t=this;t.imageGuid=e,$.when(t.dataService.getFilesThumbnail({guids:t.imageGuid,width:600,height:800,globalParent:t._globalParent})).then(function(e){var i="data:image/jpg;base64,"+e[t.imageGuid];$(".ui-bizagi-render-preview").remove(),t.inputEdition=kendo.template(t.getTemplate("discussion-image-preview"),{useWithBlock:!1}),$("#render-content",t.view.content).append(t.inputEdition({url:i})),t.kendoViewOptions={zoom:!0},t.renderEditionType="preview",t.titleLable=!0,setTimeout(function(){var e=t.view.element,i=$(".ui-bizagi-render-preview",e).width();e.width()<i&&e.width();$(".ui-bizagi-container-inputs",e).css("padding",0)},200)}).fail(function(e){bizagi.log(e)})},configureHandlers:function(e){var t=this;t.subscribe("bz-rnd-discussion",function(e,i){t._idPlan=i.dataPlan?i.dataPlan.idPlan:void 0,t._contextualizedPlan=i.dataPlan?i.dataPlan.contextualized:void 0,t.initDiscussionList(i).done(function(){i.navigateToDiscussion&&(t.pane.navigate("comment-list"),t.configureDeleteCommentsEvents(),t.initCommentlist({guid:i.guidDiscussion}))})}),$("#discussion-create",t.canvas).on("click",".bz-send-discussion",function(){var e=$(this).data("guid");void 0!==e&&""!==e?t.validateDiscussion(e):t.validateDiscussion(null)})},configureDiscussionHeaderHandlers:function(e){var t=this;$("input.ui-bz-wp-discussions-list-input-search",e.element).keyup(function(){var e=$(this).val();$(".bz-wp-box-discussion li").each(function(){$(this).text().search(new RegExp(e,"i"))<0?$(this).fadeOut():$(this).show()})}),$(".bz-discussion-back",e.element).bind(t.Class.BIZAGI_TAP_EVENT,function(e){e.stopImmediatePropagation(),t.navigator.goHome()}),$(".ui-bz-wp-discussions-list-search-icon",e.element).on("click",function(e){$(this).closest("#discussion-list").find(".ui-bz-wp-discussions-list-search-bar").addClass("active").find("input").trigger("focus")}),$(".ui-bz-wp-discussions-list-cancel-icon",e.element).on("click",function(e){$(this).closest("#discussion-list").find(".ui-bz-wp-discussions-list-search-bar").removeClass("active").find("input").val("").trigger("keyup")})},configureUploadHandlers:function(e){var t=this;if($(".bz-create-comment",e).on("click",function(){t.createComment()}),$(".bizagi-ui-discussion-attachments",e).on("click","li i.right-icon",function(){var e=$(this).closest("li"),i=bizagi.localization.getResource("workportal-project-file-querydelete");$.when(bizagi.showConfirmationBox(i,"Bizagi","warning")).done(function(){t.removeAttachment(e)})}),$(".bizagi-ui-discussion-attachments",e).on("click","li.bz-wp-info-attach span",function(e){var i=$(this.parentNode).data("guid"),a=$(this).text();$.when(t.dataService.getMobileAttachment({idAttachment:i})).then(function(e){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(e,a)).fail(function(e){e.responseText&&t.getFormContainer().failHandler(e.responseText)}).always(function(){bizagi.loading.stop()})})}),bizagi.util.isCordovaSupported()){var i=[{guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")},{guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")}];$(".bz-create-attachment",e).actionSheet({actions:i,actionClicked:function(i){switch(t.newDiscussion=$(".bz-create-attachment",e).closest("#discussion-create").length>0,i.guid){case 1:t.uploadTakePhoto();break;case 2:t.uploadChoosePhoto()}}})}else bizagi.util.media.fileAPISupported()?($(e).off("change").on("change",".bz-rn-upload-files-web",function(){t.newDiscussion=$(this).closest("#discussion-create").length>0,t.saveImage(this)}),$(".bz-create-attachment",e).off("click").click(function(){($(this).closest(".bz-form-data").length>0?$(this).closest(".bz-form-data"):$(this).closest(".km-footer")).find(".bz-rn-upload-files-web").click()})):($(".bz-create-attachment",e).hide(),$(".bizagi-ui-discussion-files-icon",e).hide())},uploadTakePhoto:function(){var e=this;navigator.camera.getPicture(function(t){e.dataImage=t,$.when(bizagi.util.media.getFileDataInfo(e.dataImage)).then(function(i){e.fileProperties=i,e.saveImage(t)})},e.onFail,{quality:e.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0})},uploadChoosePhoto:function(){var e=this;navigator.camera.getPicture(function(t){e.dataImage=t,$.when(bizagi.util.media.getFileDataInfo(e.dataImage)).then(function(t){e.fileProperties=t,$(".bz-rn-upload-resolution-container",e.canvas).click()})},e.onFail,{quality:e.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY})},uploadTakeVideo:function(){var e=this;navigator.device.capture.captureVideo(function(t){e.saveVideo(t)},e.onFail,{limit:e.Class.LIMIT})},uploadRecordAudio:function(){var e=this;navigator.device.capture.captureAudio(function(t){e.saveAudio(t)},e.onFail,{limit:e.Class.LIMIT})},saveImage:function(e){var t=this,i={};if(bizagi.util.isCordovaSupported()){var a,n={guid:Math.guid()},r=t.fileProperties.name;t.editedImageURL?a=t.editedImageURL:t.fileProperties&&(a=t.fileProperties.url),a=bizagi.util.media.getImagePath(a),t.editedImageURL=null,t.fileProperties=null;var o={dataFile:a,data:n};o.options={fileName:r,addUrl:t.dataService.serviceLocator.getUrl("new-comment-attach"),uploadKey:{key:"file[]"}},i={fileName:r,mimeType:"image/jpeg",params:n,dataFile:a},bizagi.loading.start(),$.when(bizagi.util.media.uploadFile(o)).done(function(e){t.onUploadFileCompleted(i,e)}).fail(function(e){var t=JSON.parse(e.responseText);bizagi.showMessageBox(t.message,t.type)}).always(function(){bizagi.loading.stop()})}else if(e&&e.value){i.fileKey="file[]",i.fileName=e.value.substr(e.value.replace(/([\\\/]+)/g,"/").lastIndexOf("/")+1),i.mimeType="image/jpeg",i.params={guid:Math.guid()};var s=new FormData($(e).closest("form")[0]);s.append("guid",i.params.guid),$.ajax({url:t.dataService.serviceLocator.getUrl("new-comment-attach"),data:s,type:"POST",contentType:!1,processData:!1}).done(function(e){t.onUploadFileCompleted(i,e)}).fail(t.onFail).always(function(){bizagi.loading.stop()})}},saveAudio:function(e){var t=this,i=t.properties,a=t.buildAddParams(),n="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),r=new FileUploadOptions,o=new FileTransfer;a.queueID=n,r.fileName=e[0].name,r.params=a,o.upload(e[0].fullPath,i.addUrl,function(e){var i=JSON.parse(decodeURIComponent(e.response));"error"===i.type?bizagi.showMessageBox(i.message,"Error"):t.onUploadFileCompleted(i)},function(e){bizagi.log("An error has occurred: Code = "+e.code)},r)},saveVideo:function(e){var t=this,i=new FileUploadOptions,a=new FileTransfer;i.fileName=e[0].name,i.mimeType="video/quicktime",i.params={guid:Math.guid()},a.upload(e[0].fullPath,t.dataService.serviceLocator.getUrl("new-comment-attach"),function(e){if(e.responseCode>=200&&e.responseCode<=299)try{JSON.parse(decodeURIComponent(e.response));t.onUploadFileCompleted(i,e)}catch(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-general-error-generic"),"Error")}else bizagi.showMessageBox(e.responseCode,"Error")},function(e){bizagi.log("An error has occurred: "+e.code)},i)},onFail:function(e){bizagi.log("Error: "+e.code),bizagi.util.smartphone.stopLoading()},onUploadFileCompleted:function(e,t){var i=this;i._attachments.push({guid:e.params.guid,name:e.fileName}),i._attachmentsToCreate.push(e.params.guid),bizagi.loading.start(),i.newDiscussion?i.onSuccessFile(e,t):$.when(i.createComment()).done(function(e){bizagi.log(e)}).fail(function(e){bizagi.log(e)}).always(function(){i._attachmentsToCreate=[],i._attachments=[],bizagi.loading.stop()})},onSuccessFile:function(e,t){var i=this,a=[e];$.isEmptyObject(t)?bizagi.log("No subido!"):(Array.prototype.push.apply(i.attchDiscussions.addition,a),a[0]&&a[0].params&&(a[0].params.isNew=i.newDiscussion),i.renderAttachments(a))},renderAttachments:function(e){var t=this,i=$("#discussion-create ul.bizagi-ui-discussion-attachments",t.canvas),a=kendo.template(t.getTemplate("discussion-attachment"),{useWithBlock:!1});bizagi.loading.stop(),i.append(a(e))}}),bizagi.workportal.webparts.discussionCase.extend("bizagi.workportal.webparts.discussionCase",{},{}),bizagi.workportal.webparts.discussionCase.extend("bizagi.workportal.webparts.discussionCase",{},{configureDiscussionHeaderHandlers:function(e){var t=this;bizagi.util.isNativeHeaderEnabled()?(e.header.hide(),t.subscribe("createDiscussion",function(e,i){t.openCreateDiscussion()})):t._super(e)},goBack:function(){bizagi.util.isNativeHeaderEnabled()&&bizagiapp.backToDiscussions()},openCreateDiscussion:function(e){var t=this;t._super(e),bizagi.util.isNativeHeaderEnabled()&&($("#discussion-create .bz-render-header",t.canvas).hide(),void 0!==e&&bizagiapp.openDiscussion(bizagi.localization.getResource("workportal-project-discussion-edit")))},commentsViewInit:function(e){this._super(e),
bizagi.util.isNativeHeaderEnabled()&&e.view.header.hide()},initCommentlist:function(e){var t=this;if(t._super(e),bizagi.util.isNativeHeaderEnabled()){var i=t._discussions.find(function(t){return t.guid==e.guid});bizagiapp.openDiscussion(i.name)}},configureFloatingButton:function(e){var t=this;bizagi.util.isNativeHeaderEnabled()||t._super(e)},renderEdition:function(e){var t=this;t._super(e),bizagi.util.isNativeHeaderEnabled()&&(t.view.header.hide(),bizagiapp.openDiscussionImage())}}),bizagi.workportal.webparts.rendermanager.extend("bizagi.workportal.webparts.files",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav"],PAGE_SIZE:5},{init:function(e,t,i){var a=this;a._super(e,t,i);var n=a.getTemplate("files-tmpl-main");a.mainTemplate=kendo.template(n,{useWithBlock:!1}),bizagi.util.mobility.filesViewInit=$.proxy(a.filesViewInit,a)},filesViewInit:function(e){var t=this,i=e.view.scroller,a=t.getTemplate("file-pull-loader"),n=t.getTemplate("file-refresh-loader");t.content=$(t.mainTemplate({})),e.view.contentElement().append(t.content),t.configureFilesHeaderHandlers(e.view),bizagi.util.isNativeHeaderEnabled()||(bizagi.override.enableFormButtons?t.configureFormButtons($("#files-list",t.canvas)):t.configureFloatingButton($("#files-list",t.canvas))),t.actionFiles(),i.setOptions({pullToRefresh:!0,messages:{pullTemplate:a,refreshTemplate:n,releaseTemplate:a},pull:function(){setTimeout(function(){var e={globalParent:t._globalParent};t.initFilesList(e),i.pullHandled()},400)}}),t.pane=$("#paneRender").data("kendoMobilePane")},configureHandlers:function(e){var t=this;$(".bz-wp-single-files-delete-file",e).on("click",function(e){e.stopPropagation();var i=$(this).closest(".bz-wp-single-files").data("position");t.deleteFile(i)})},configureFloatingButton:function(e){var t=this;if(bizagi.util.isCordovaSupported())if((bizagi.util.getAndroidVersion()>=4.4||bizagi.util.isNativePluginSupported())&&bizagi.override.enableMfb){var i=[{label:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo"),link:1,icon:"mo-icon bz-camera"},{label:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo"),link:2,icon:"mo-icon bz-image"}];$(".ui-bizagi-container-children-form",e).addClass("ui-bizagi-form-no-buttons"),$(".ui-bizagi-button-container",e).hide(),$(e).mfb({restingIcon:"mo-icon bz-plus",activeIcon:"mo-icon bz-cancel",activePrincipalButton:!0,buttons:i,click:function(e,i){switch(i.link){case 1:t.uploadTakePhoto();break;case 2:t.uploadChoosePhoto()}}})}else{var a=[{guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")},{guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")}];$(".ui-bizagi-container-children-form",e).addClass("ui-bizagi-form-no-buttons"),$(".ui-bizagi-button-container",e).hide(),$(e).mfb({restingIcon:"mo-icon bz-plus"}),$(".mfb-component__main-icon--resting",e).off("click").actionSheet({actions:a,actionClicked:function(e){switch(e.guid){case 1:t.uploadTakePhoto();break;case 2:t.uploadChoosePhoto()}}})}else bizagi.util.media.fileAPISupported()&&($(t.container).find(".bz-rn-upload-files-web").change(function(){t.saveImage(this),this.value=""}),$(e).mfb({restingIcon:"mo-icon bz-plus",click:function(){t.pane.container().content.find(".bz-rn-upload-files-web").off("click").click()}}))},deleteFile:function(e){var t=this,i=bizagi.localization.getResource("workportal-project-file-querydelete");$.when(bizagi.showConfirmationBox(i,"","info")).done(function(){t.removeFile(e)})},removeFile:function(e){var t=this,i={content:{guid:t.params.data[e].guid},attachmentsToDelete:[t.params.data[e].attachment.guid],index:e};$.when(t.dataService.deleteFile(i)).done(function(e){var t=JSON.parse(this.data).index;$("li.bz-wp-single-files[data-position="+t+"]").remove()})},postRender:function(){var e=this;bizagi.webpart.subscribe("bz-rnd-files",function(t,i){e._idPlan=void 0,e._contextualizedPlan=void 0,e.initFilesList(i)})},renderContent:function(){return""},configureViewHandlers:function(){var e=this;$(".bz-render-back",e.slideForm).bind("click",function(){e.goBack()}),$(".bz-edit-attachment",e.slideForm).bind("click",function(){e.downloadFile()})},goBack:function(){var e=this;e.pane.replace("#files-list"),e.view.destroy(),e.params&&e._globalParent&&e.view.attachedElement.refreshView&&e.initFilesList({globalParent:e._globalParent})},configureDescriptionHandlers:function(){var e=this;$(".cancel-edit-description",e.slideForm).on("click",function(t){$(".km-box-body.description-file",e.slideForm).unbind(),t.stopImmediatePropagation(),e.configureViewEvents(""),$(".km-box-body.description-file",e.slideForm).attr({placeholder:bizagi.localization.getResource("workportal-actionsheet-upload-description-unavailable")}),e.updateDescription("")}),$(".add-new-description",e.slideForm).bind("click",function(t){var i=$(".km-box-body.description-file",e.slideForm).val();$(".km-box-body.description-file",e.slideForm).unbind(),t.stopImmediatePropagation(),e.configureViewEvents(i),e.updateDescription(i)})},updateDescription:function(e){var t=this;$(".km-box-body.description-file",t.slideForm).val(e);var i=t.params.data[t.view.attachedElement.position],a={content:{guid:i.guid,description:e,attachment:i.attachment,name:i.name,date:i.date,user:i.user.id,globalParent:i.globalParent}};$.when(t.dataService.updateProjectFile(a)).always(function(e){200===e.status||201===e.status||void 0===e.status?t.view.attachedElement.refreshView=!0:bizagi.log("Error en la carga de la información...")})},downloadFile:function(){var e=this;$.when(e.dataService.getMobileAttachment({idAttachment:e.view.attachedElement.guid})).then(function(e){window.open(e,"_system","location=yes")})},deleteDescription:function(){var e=this,t=$(".bz-files-description-box",e.view.content),i=$(".description-file",e.view.content);0!==t.length&&$(".bz-files-description-box",e.view.content).remove(),i.text(bizagi.localization.getResource("workportal-actionsheet-upload-description-unavailable")),e.updateDescription(!0)},uploadTakePhoto:function(){var e=this;navigator.camera.getPicture(function(t){e.saveImage(t)},e.onFail,{quality:e.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0})},uploadChoosePhoto:function(){var e=this;navigator.camera.getPicture(function(t){e.dataImage=t,$.when(bizagi.util.media.getFileDataInfo(e.dataImage)).then(function(t){e.fileProperties=t,e.saveImage(e.dataImage)})},e.onFail,{quality:e.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY})},saveImage:function(e){var t=this,i={};if(bizagi.loading.start(),bizagi.util.isCordovaSupported()){var a={guid:Math.guid()},n=e.substr(e.lastIndexOf("/")+1);t.fileProperties&&t.fileProperties.name&&(n=t.fileProperties.name),e=bizagi.util.media.getImagePath(e);var r={dataFile:e,data:a};r.options={fileName:n,addUrl:t.dataService.serviceLocator.getUrl("new-comment-attach"),uploadKey:{key:"file[]"}},i={fileName:n,mimeType:"image/jpeg",params:a,dataFile:e},t.fileProperties=null,$.when(bizagi.util.media.uploadFile(r)).done(function(e){t.onUploadFileCompleted(i,e)}).fail(function(e){var t=JSON.parse(e.responseText);bizagi.showMessageBox(t.message||t.error_description||"error",t.type)}).always(function(){bizagi.loading.stop()})}else if(e&&e.value){i.fileKey="file[]",i.fileName=e.value.substr(e.value.replace(/([\\\/]+)/g,"/").lastIndexOf("/")+1),i.mimeType="image/jpeg",i.params={guid:Math.guid()};var o=new FormData($(e).closest("form")[0]);o.append("guid",i.params.guid),$.ajax({url:t.dataService.serviceLocator.getUrl("new-comment-attach"),data:o,type:"POST",contentType:!1,processData:!1}).done(function(e){t.onUploadFileCompleted(i,e)}).fail(t.onFail).always(function(){bizagi.loading.stop()})}},onUploadFileCompleted:function(e,t){var i=this;$.when(i.createFile(e)).done(function(e){bizagi.log(e)}).fail(function(e){bizagi.log(e)}).always(function(){bizagi.loading.stop()})},createFile:function(e){var t=this,i=new $.Deferred,a=Math.guid(),n=(new Date).getTime(),r={attachmentsToCreate:[e.params.guid],content:{guid:a,description:"",attachment:{name:e.fileName,guid:e.params.guid},name:e.fileName,date:n,user:bizagi.currentUser.idUser,globalParent:t._globalParent}};return t._filesCounter=0,t._lastFileDate=n,$.when(t.dataService.createProjectFile(r)).done(function(e){200===e.status||201===e.status||void 0===e.status?(bizagi.log("Subida de archivo exitosa"),t.initFilesList({globalParent:t._globalParent}),i.resolve("Success")):i.reject("Error en la carga del archivo...")}).fail(function(){bizagi.log("Error en la subida....")}),i.promise()},initFilesList:function(e){var t=this;e=e||{},t._globalParent=e.globalParent,t._filesCounter=0,t._lastFileDate=(new Date).getTime(),bizagi.loading.start(),t._idPlan||(t._idPlan=e.dataPlan&&e.dataPlan.idPlan?e.dataPlan.idPlan:void 0),t._contextualizedPlan||(t._contextualizedPlan=e.dataPlan&&e.dataPlan.contextualized?e.dataPlan.contextualized:void 0),t.params.data={},$(".bz-main-list",t.canvas).empty(),$.when(t.filesList()).always(function(){t.configureHandlers($("#files-list",t.canvas)),bizagi.loading.stop()})},filesList:function(){var e=this;if(void 0===e._contextualizedPlan||e._contextualizedPlan)return e.getFilesList(void 0);$.when(e.dataService.getFirstParentPlan({idPlan:e._idPlan})).done(function(t){return t&&t.id?e.getFilesList(t.id):e.getFilesList(e._idPlan)})},getFilesList:function(e){var t=this,i=kendo.template(t.getTemplate("files-tmpl"),{useWithBlock:!1}),a=$(".bz-main-list",t.canvas),n=$("#files-list",t.canvas).find(".bz-more-files"),r=t.getCurrentUserInfo(),o=bizagi.util.getFeatureObject("userService.v1.enabled");return $.when(t.dataService.getFilesList({globalParent:String(e||t._globalParent),count:t.Class.PAGE_SIZE,dateTime:t._lastFileDate})).then(function(e){if(e.length)return t.organizeListsAndFormat(e).done(function(s){$.each(e,function(e,i){i.user=s.find(function(e){return e.id==(o?i.guidUser||i.user:i.user)})||[],t._lastFileDate=i.date,t._filesCounter++});var l=i({files:e,currentUser:r});return $(a).append(l),t.actionListFiles(),t.dataService.getFilesCount({globalParent:String(t._globalParent)}).then(function(i){return i.count>t._filesCounter&&n.show(),t.params.data=e,$.Deferred().resolve()})}).fail(function(e){bizagi.log(e)});n.hide()}).fail(function(e){bizagi.log(e)})},getCurrentUserInfo:function(){return{name:bizagi.currentUser.userName,id:bizagi.currentUser.idUser,picture:""}},initPreview:function(e){var t=this;e=e||{};var i=t.params.data[e.position],a=i.attachment.guid,n={guid:a,position:e.position,refreshView:!1};bizagi.loading.start(),i.attachment.isImage?$.when(t.setThumbnail(a)).done(function(e){i.attachment.thumbnail="data:image/png;base64,"+e[a],t.initViewFile(n),t.renderEdition(i),bizagi.loading.stop()}).fail(function(e){bizagi.log(e)}):$.when(t.setAttachment(a)).done(function(e){i.attachment.link=e[a],t.initViewFile(n),t.renderEdition(i),bizagi.loading.stop()}).fail(function(e){bizagi.log(e)})},renderEdition:function(e){var t=this,i=t.getTemplate("file-preview-tmpl");t.inputEdition=kendo.template(i,{useWithBlock:!1}),$("#render-content",t.view.content).append(t.inputEdition(e)),t.configureViewEvents(e.description)},configureViewEvents:function(e){var t=this;$(".cancel-edit-description",t.slideForm).hide(),$(".add-new-description",t.slideForm).hide(),$(".km-box-body.description-file",t.slideForm).val(e),$(".km-box-body.description-file",t.slideForm).on("click",function(){var e=2*this.value.length;this.focus(),this.setSelectionRange(e,e),t.showActions(!0),t.configureDescriptionHandlers()})},showActions:function(e){var t=$(".cancel-edit-description",self.slideForm),i=$(".add-new-description",self.slideForm);e?(t.show(),i.show()):(t.hide(),i.hide())},initViewFile:function(e){var t=this;t.slideFormParams={preview:bizagi.localization.getResource("workportal-actionsheet-upload-file-preview")},t.slideForm=$($.kendoTmpl(t.getTemplate("file-view"),t.slideFormParams)),$("#paneRender").append(t.slideForm),t.view=new kendo.mobile.ui.View(t.slideForm,{useNativeScrolling:!0,destroy:function(e,t){this.element.remove()}}),t.pane.replace(t.view.id),t.view.attachedElement=e,t.scrollContent=$("#render-content",t.view.contentElement()),t.configureViewHandlers()},setThumbnail:function(e){var t=this,i={guids:e,width:320,height:420,globalParent:t._globalParent};return t.dataService.getFilesThumbnail(i)},setAttachment:function(e,t){var i=this,a={idAttachment:e,sessionId:t};return i.dataService.getAttachment(a)},actionListFiles:function(){var e=this,t={};$(".bz-wp-single-files",e.canvas).bind("click",function(){t.position=$(this).data("position"),e.pane.navigate("files-list"),e.initPreview(t)})},organizeListsAndFormat:function(e){var t=this,i=[],a=bizagi.util.getFeatureObject("userService.v1.enabled"),e=e||{};return $.each(e,function(e,n){i.push(a?n.guidUser||n.user:n.user);var r=new Date(n.date);n.newDate=bizagi.util.dateFormatter.getRelativeTime(r,"dd/MM/yyyy HH:mm:ss:ff"),n.attachment.iconSrc=t.getIconExtension(n.attachment)}),t.dataService.getUsersDiscussion(i.join(","))},getIconExtension:function(e){return e=e||{},e.iconExtension=e.name.split(".").pop().toLowerCase(),["jpg","jpeg","png"].indexOf(e.iconExtension)>-1?(e.isImage=!0,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAABHCAYAAABIzmSEAAAD8UlEQVR42u2ah0/TQRTH+TcQFyEoONEYSFwxRo0mkiiOgGwFFBVxSwwaERGIDBmFClK2gmVUNlWBAiJ7CGVDZQkUEPwLnvcOqBqMAVroNbmXfJPer79xn9x77+7e76enx40bN27cuDFmicVN4JdSDs9WWcKcOtA4TEWzAg7eTgJ967BVl5FjFHiLSjQLVVzTDebXRfQBHpGF4JMoWxXNQ60hsnmeBSsCVN6igImpn6siCmODCqe/bf2zQeeBjBwFcNI7DTY5R4PBhXBwfpEDXQNK0Fkg00tCiMmth+B3VbS9wS4SnAiUTgOlfmihbYGkVhVX1urEFCtAYxPTEJT+GUwuCtWLKVaAUIrhCQhMqwRjElNrlxtTLAGhvo1MQohYjZhiDWhekdk1NK3rL3We0iYQulbg20qQNfUv0Kf6XnANyfs9TwVIgHkgA9JZU5dXsPtq3D+1zTWGzk94LsaUV+xHYBbo+MO3S177OQa+ZxdoKcJ44kAciAMxCDQ4OgUV5JyShl6NqbZ9EEaV09oBklS0w17PBNjl/lpjOvc0A1p7v2sH6GVmtWrJcvheilo6dDcZNtpHgrmHCOo7hrQDFJLxhZ7n/jJfdUw5OUNdZmT8B9kCzCw6LoaI+x64ncQWEEJkyNrgWnghnHoihscJpbRzykkdBSpp6FNdi1pvGwFuofnQPTCue0BK0o6Ye9BpMjp5VZ10t2nhEQ818oG/rksoaoJjXqmQ9ukr20Chc21bfwlUkmsNHQT0XtVts0DjJL7iCxtpEsHzdl6JhfTSVhp3TLqctLYHzEjqnXc5XOK7BOdSl8NOJ0mb6TYA/zO7MnueORlBcVkbm0A40SaTTjuQB50l88kdoZSOFMKIyMjsvjoLYeUjhqxyOVg+SqftPeR5cQWN7AFhmi6q7gIR6VyHYozWA/C4MLcONs9Vb6xIfGFMoYuWN/fDibl9kAlxQ6bmIRyFTJkctpIdJx7Duhqm8XiSAExdZmGOPkhdkCDw5cC+m4kqN2UCCPf64tI22O4WA+tIqsatNMo9rEAVM8e83lD3+9d9yhr76EqBGSBMzVvIyGCZ6VJQLngKiv7aKp8hMVMrH/zvvbAQsuNyDBtA87IPkEB7/yiNHd9kGX3fc943k7jZoG5NrOhelt7pNMv9+b9iZILGkc6t5XALUdbURwN+ucKMZ3Ejng0gjB/MYOroyP0UMLQXaBcIly3r7SI0+p51/61EaOwa1g4QTqQNnUMgrevRmOQkqfAiCQfiQByIA3EgDsSBOBAHWgCEF+ZUdjCnO9HS5QFhhRMLH6zJ2Clq8UBoNn5ZWvnmdCnCggzW0vknz9y4cePGjdsK2i8pjnlZMxAysQAAAABJRU5ErkJggg=="):["pdf"].indexOf(e.iconExtension)>-1?(e.isImage=!1,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAABBCAYAAACaYlekAAAD5ElEQVR42u2a+U8TURDH/UPEMxpFSTwTz2D8wXjE4weMiEQ5VDTiAfG+E8VEjcSLQ045NICIoojKISAIgiDVogVbsJRSenDIX/D1zRCNRGMolna7vkkm7W433ffJe/N9M7M7bpw0adKkudJyy1vgbs971YK3LSaMGVRs3ltMCIzH+C1xbnW659oTuah83zE2cCeTK+ATGIcVUfcQFVfqFg+88Jjh6L7LDmZBa+jBmIEdji+Do2/QLf6o6vPPWfMRn3N2paJO2wnVgK06mgN/sVJ+fC97Z4AqwKLFsnxW28ZQHHPHc1HlqpjzNFinpRfvW81YfSxnKOYOuCjmlABG52o/GnnmfMTMzY1IQ+2/xpxSwMhLG/RDM+eKmFMSGHmFiLFhMdc8yphTGhj5rzG3ZH/m6GLOk2CRN15Cq7fAYHL85s/rvrCQ0HXzItJFDDoZc54E8w1N5sEvP5j9R6ffOUMRvu5kHho+OZFbegKsoqkd03ckOZVb+oWncuKsaDCLbQDNbWY06rpG5F4D5qwrAowCv73LoR4wm+MbCqt1CLtShNDLRWgWkq0KML3Jjt3XijFt+x3eXC9mVqsDTNPWjY2n87EtppDBTqVUqAOM4opmbMq2BHWBWUWMXcquwWQBNnFrPG4+bFCPKj4W4jF3dxomBSWwkKgGzNTTx5k5gVHJoRqwRp2Zczz6v4jY5zBZ+tQBdr9UywNYKhLb+XvSXbYcPS4ep1MrubQvbzTwQIKF9Ou+Wr0bTGuwYPP5AgQIt/d+w+2CBpb+G/n1sIljrwUretMKv52piHs0JPOf2nsQcvkpZoWlILvkAzrEPqfrsOLd5y6eRbO1X/lgNEO0IS/al4E3H418rkso5PUH9VwszhZwQRcLEXCuAGuO5fKs0vWtRpuywayOASzYexd7hRKSYBxJLMfiyEzMDEke9sBjobjmwK0S7tdT5UwFp2LBum39iM2r45tT1jE1OJEHQQ85ouNLeTAl9XpuytDv/ofuier5DtaLUr9phBWAW8F67AOo1hgRk1WDeULaZ4QkYcOpBzgjlJHa1sbu4d0nqpjPplWyUlJpQ30PxcWYvXeQc8GV0fc5yyCJJ6mnthnJ/t9aAvpOOzrMDmWq4pGEMl5yM3Yk8fLyDUvmesyrWwM55Vq+0aYz+aJSfsqFZXqxxvt7HhcyXvP1wZeecCYffvWZOpo51ZqvLNu0BKlapg1XFWAkHNQGKBbKR313Ov4v2m8STIJJMAkmwSSYBJNgEkx9YBHXitGkMyvS/wmMehaLIjMV6aMCy3ih4a6Ru98JdsbpBRZ6Banmg3HsXo6WJk2aNNXYd5EIhV1Uqgx7AAAAAElFTkSuQmCC"):["doc","docx"].indexOf(e.iconExtension)>-1?(e.isImage=!1,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAA/CAYAAABNY/BRAAADy0lEQVR42u2a6U8TQRjG/TfEI+oHFW+jiVfQxBiiicYDYwTFE6+g9SReoKLxiolGQAEBgaoglxyiHMolRbHKUaEcLaW00JZSEP0LHucdpB/UD1uF7WJmkifNTibd/WXmeWfed3fcONFEE+2fWqnWgHxNi+yqaujEiIK8eKfHgsMJGL/9vuxaciwZz8ubRg4opbgBM/bFYe7BRwiNei2Lgm7mchifwPtYHPoYBTWtGFGY9eEZcA18l0VVjZ3u2fFhmrb7ISpHYsl5E2b+oQT4n0vDpB3RmLk/DtlVeoxZmLUX0vkS2379xZCHVP/oIW/DNJns0JscCLiazT20KDQJL2vaMGZhqK+n9yu2cqAo7qGKehPGLAypvr0HgTdyuYd8Q+I995CSYEhavfXvPaQ0GFJL5y8eei/RQ96EobD8ubUbVsfAbzJYnNgQkcHHkYfK6yR4yJswU3c9wDJVCvxOqf+ohUcS3Zvr7AOPUPzRAMXB1LV1s3vGenSOo6AQqa5SHoyjbxC1zRZodGZJogOpYmE81Uq25ASMgBEwXoLRGW1Ie6sbVRmtffLAJL2qG/V6QInWIA9MfVsPEhnQaKqtq1d4RsB4Kjr15rDkSqpMcgWAv9Hr2nbMYtmiVJXVdSgXpojBUGFRqihfkQ2mkGV7pVqjez9o7rDzvpovZtidg+jr/84eqANvPhlhtQ8o2zP+557B72QqMiua+PWtdA3mHUpA8K08NJsc6HV9w6rTTxAQmY1Gg03ZMEejizAhMAo306r59ZbILHfx+wPLTXQMgMpEe+4UwGjpg9nm4ktHqiz2fvlgUksa+MOfiStFl62f14hXhz3lv5TOqksaOczt5xo+Pl/TqswTwHConRIcgx03cnn5hyonIXcLMX1vLJKL6nEqthRzmJEzyoeWIb172XwlS7LeN3fJG83WnH3GZyMiuYIvuQf5Wn6j84llWHchHStPq3k6TGNtzq9oNfdKlp2l0rLChMW/4abfeCkTE4Ki0NDeg23XcnjRbvLOaGy6nAmHa3BsnADoQOjzc41T1KIQrIop5iUj8gvN2PBYqh03sfAtVTSTssLQPuK7P47D3E4fMjr90o0mspnKq25xj1V0ACC1dzlxL+sDLiaVQdti5X1UrY9UVyL8cTmPcsNjq3VmBLFgIVUf9RZ5YWiXp92elpCz/xvvo83Sxq6p79famKnbJVn0PyIFEDACRsAIGAEjYASMgPkPYeidvCf5h5xafjzFMxjK75eqkhUpymIlwVBlZcWJVK98o+mJ6MMgqtmJz4NFE000d/sBkmT1hmD0wlMAAAAASUVORK5CYII="):void(e.isImage=!1)},actionFiles:function(){var e=this;$(".bz-more-files",e.content).bind("click",function(){e.showMoreFiles()})},showMoreFiles:function(){var e=this;bizagi.loading.start(),$("#files-list",e.canvas).find(".bz-more-files").hide(),$.when(e.filesList({globalParent:e._globalParent})).always(function(){bizagi.loading.stop()})},configureFilesHeaderHandlers:function(e){var t=this;$(".bz-files-back",e.layout.element).on(t.Class.BIZAGI_TAP_EVENT,function(e){e.stopImmediatePropagation(),t.navigator.goHome()}),$("input.ui-bz-wp-files-list-input-search",e.layout.element).keyup(function(){var e=$(this).val();$(".bz-wp-box-files li").each(function(){$(this).text().search(new RegExp(e,"i"))<0?$(this).fadeOut():$(this).show()}),""===e?$(this).closest("#files-list").find(".bz-more-files").show():$(this).closest("#files-list").find(".bz-more-files").hide()}),$(".ui-bz-wp-file-list-search-icon",e.layout.element).on("click",function(e){$(this).closest("#files-list").find(".ui-bz-wp-file-list-search-bar").addClass("active").find("input").trigger("focus")}),$(".ui-bz-wp-file-list-cancel-icon",e.layout.element).on("click",function(e){$(this).closest("#files-list").find(".ui-bz-wp-file-list-search-bar").removeClass("active").find("input").val("").trigger("keyup")})},configureFormButtons:function(e){var t=this,i=[];$(".ui-bizagi-container-children-form",e).addClass("ui-bizagi-form-no-buttons"),$(".ui-bizagi-button-container",e).hide(),bizagi.util.isNativePluginSupported()?i=[{id:Math.ceil(1e5*Math.random()),action:"take",label:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo"),ordinal:1,priority:1,additional:!1},{id:Math.ceil(1e5*Math.random()),action:"choose",label:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo"),ordinal:2,priority:2,additional:!1}]:bizagi.util.media.fileAPISupported()&&($(t.container).find(".bz-rn-upload-files-web").change(function(){t.saveImage(this),this.value=""}),i=[{id:Math.ceil(1e5*Math.random()),action:"choose",label:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo"),ordinal:3,priority:1,additional:!1}]),i.length>0&&(bizagi.util.sortJSON(i,"priority","desc"),$(e).formButtons({buttons:i,click:function(e,i){switch(i.ordinal){case 1:t.uploadTakePhoto();break;case 2:t.uploadChoosePhoto();break;default:case 3:t.pane.container().content.find(".bz-rn-upload-files-web").off("click").click()}}}))}}),bizagi.workportal.webparts.files.extend("bizagi.workportal.webparts.files",{},{}),bizagi.workportal.webparts.files.extend("bizagi.workportal.webparts.files",{},{configureFilesHeaderHandlers:function(e){var t=this;bizagi.util.isNativeHeaderEnabled()?(e.header.hide(),t.subscribe("uploadFileToForm",function(e,i){"upload"==i?t.uploadChoosePhoto():"take"==i&&t.uploadTakePhoto()})):t._super(e)},initViewFile:function(e){var t=this;t._super(e),bizagi.util.isNativeHeaderEnabled()&&(t.view.header.hide(),bizagiapp.openFile())},configureFloatingButton:function(e){var t=this;bizagi.util.isNativeHeaderEnabled()||t._super(e)}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.filterBar",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.criteriaSearchApplied=i.filters?bizagi.clone(i.filters):[],a.filtersApplied=[],a.previousCalculatedFilters=[],a.filterControlArray=[]},renderContent:function(){var e=this;return kendo.template(e.getTemplate("wp-filterBar"))({})},configureHandlers:function(){var e=this;e.unsubscribe("setFiltersData.filterBar"),e.subscribe("setFiltersData.filterBar",function(t,i){e.buildFilters(t,i)}),e.unsubscribe("setOrderBy.sortBar"),e.subscribe("setOrderBy.sortBar",function(t,i){e.setOrderBy(t,i)})},getFilters:function(){return this.filtersApplied},setOrderBy:function(e,t){var i=this;i.orderBy=t,i.triggerFilter({calculateFilters:!1})},buildFilter:function(e,t){var i=this;switch(t.type){case"Entity":i.buildFilterMultiple(e,t);break;case"Number":i.buildFilterNumber(e,t);break;case"Money":i.buildFilterMoney(e,t);break;case"Datetime":i.buildFilterDate(e,t);break;case"Boolean":i.buildFilterBoolean(e,t)}},setFilterData:function(e,t){e.widget.setData(t)},buildFilterNumber:function(e,t){var i=this,a=$("#"+t.id,i.content);e=new bizagi.filterNumber({properties:t,numericFormat:i.getResource("numericFormat"),$content:i.$modalViewTemplate,$opener:a,onApply:function(e){i._changeContainerTopMargin(),i.addFilterSelection(e),i.triggerFilter({calculateFilters:!0})},onClear:function(e){i._changeContainerTopMargin(),i.removeFilterApplied(e),i.triggerFilter({calculateFilters:!0})},getResource:function(e){return bizagi.localization.getResource(e)}}),a.click(function(){e.showDialog()}),i.filterControlArray.push({type:t.type,xpath:t.attribute,widget:e})},buildFilterBoolean:function(e,t){var i=this,a=$("#"+t.id,i.content);e=new bizagi.filterBoolean({properties:t,$content:i.$modalViewTemplate,$opener:a,onApply:function(e){i._changeContainerTopMargin(),i.addFilterSelection(e),i.triggerFilter({calculateFilters:!0})},onClear:function(e){i._changeContainerTopMargin(),i.removeFilterApplied(e),i.triggerFilter({calculateFilters:!0})},getResource:function(e){return bizagi.localization.getResource(e)}}),a.click(function(){e.showDialog()}),i.filterControlArray.push({type:t.type,xpath:t.attribute,widget:e})},buildFilterMoney:function(e,t){var i=this,a=$("#"+t.id,i.content);e=new bizagi.filterMoney({properties:t,numericFormat:i.getResource("numericFormat"),$content:i.$modalViewTemplate,$opener:a,onApply:function(e){i._changeContainerTopMargin(),i.addFilterSelection(e),i.triggerFilter({calculateFilters:!0})},onClear:function(e){i._changeContainerTopMargin(),i.removeFilterApplied(e),i.triggerFilter({calculateFilters:!0})},getResource:function(e){return bizagi.localization.getResource(e)}}),a.click(function(){e.showDialog()}),i.filterControlArray.push({type:t.type,xpath:t.attribute,widget:e})},buildFilterDate:function(e,t){var i=this,a=$("#"+t.id,i.content);e=new bizagi.filterDate({properties:t,$opener:a,$content:i.$modalViewTemplate,onApply:function(e){i._changeContainerTopMargin(),i.addFilterSelection(e),i.triggerFilter({calculateFilters:!0})},onClear:function(e){i._changeContainerTopMargin(),i.removeFilterApplied(e),i.triggerFilter({calculateFilters:!0})},getResource:function(e){return i.getResource(e)}}),a.click(function(){e.showDialog()}),i.filterControlArray.push({type:t.type,xpath:t.attribute,widget:e})},buildFilterMultiple:function(e,t){var i=this,a=$("#"+t.id,i.content);e=new bizagi.filterMultiple({properties:t,$content:i.$modalViewTemplate,$opener:a,onApply:function(e){i._changeContainerTopMargin(),i.addFilterSelection(e),i.triggerFilter({calculateFilters:!0})},onClear:function(e){i._changeContainerTopMargin(),i.removeFilterApplied(e),i.triggerFilter({calculateFilters:!0})},getResource:function(e){return bizagi.localization.getResource(e)}}),a.click(function(){e.showDialog()}),i.filterControlArray.push({type:t.type,xpath:t.attribute,widget:e})},addFilterSelection:function(e){for(var t=this,i=0,a=e.length;i<a;i++)t.removeFilterApplied([e[i].properties.xpath]),t.filtersApplied.push(e[i])},removeFilterApplied:function(e){for(var t,i=this,a=-1;t=e[++a];){var n=i.filtersApplied.find(function(e){return e.properties.xpath===t});n&&i.filtersApplied.splice(i.filtersApplied.indexOf(n),1)}},triggerFilter:function(e){for(var t,i=this,a=i.criteriaSearchApplied?bizagi.clone(i.criteriaSearchApplied):[],n=a.length,r=i.filtersApplied.slice(),o=-1;t=r[++o];)i.dataService.defineFilterObject(t,a);var s=a.length-n;i.orderBy&&i.dataService.defineFilterObject(i.orderBy,a);var l={guidSearch:i.params.guidSearch,filters:a,page:1,calculateFilters:e.calculateFilters||!1,filtersAppliedCounter:s,defaultFilterApplied:!1,typeSearch:"filter",pageSize:10,totalRecords:-1};bizagi.webpart.publish("update-Templates",l)}}),bizagi.workportal.webparts.filterBar.extend("bizagi.workportal.webparts.filterBar",{},{postRender:function(){var e=this,t=kendo.template(e.getTemplate("wp-filterModalView"));e.$modalViewTemplate=$(t({})),e.configureHandlers()},buildFilters:function(e,t){var i=this,a=i.getContent(),n=$(".wp-actions-filters",a),r=t.totalRecords>0?t.filters:i.previousCalculatedFilters,o=kendo.template(i.getTemplate("wp-filterItem"));if(t.defaultFilterApplied&&(i.filtersApplied=t.filtersApplied),0===i.filterControlArray.length){for(var s,l=-1;s=r[++l];){s.id="my-search-filter-"+s.attribute.replace(/\./g,"-");var c=$(o(s));"Text"!==s.type&&"Link"!==s.type&&s.data&&(s.data.defaultValues&&s.data.defaultValues.length>0||s.data.min&&s.data.max)&&(n.append(c),i.buildFilter(c,s))}0===n.children().length?$(".wp-actions-filter").hide():$(".wp-actions-filter").show()}else for(var s,l=-1;s=i.filterControlArray[++l];){var d=r.find(function(e){return e.attribute===s.xpath});d&&i.setFilterData(s,d.data)}},_changeContainerTopMargin:function(){var e=this,t=$(".bz-wp-filterBar",e.canvas).height()+80;$(e.container).animate({marginTop:t+"px"},200,"swing")}}),$.Class.extend("bizagi.filterBase",{},{init:function(e){this.options=e},showDialog:function(){var e=this;e.modalView=e.options.$content.clone(),e._render(),e.modalView.kendoMobileModalView({close:function(){this.destroy(),this.element.remove()}}),e.modalView.kendoMobileModalView("open"),e._configureHandlers(),e._setDisplayValue(),e.adjustModalViewHeight()},setData:function(e){var t=this;t.options.properties.data=void 0!==e?e:t.options.properties.data},setDisplayNameToDefault:function(){var e=this,t=e.options.$opener.text().split(":");e.options.$opener.text(t[0])},adjustModalViewHeight:function(){var e=this,t=e.modalView;if(t){var i=t.find("div.km-header").outerHeight(!0),a=0,n=t.find("div.km-scroll-container");n.is(":visible")&&(a+=n.outerHeight(!0)+10);var r=t.find("div.km-footer").outerHeight(!0),o=i+a+r;$(t.parent().parent()).css("max-height",t.css("max-height"));var s=$(document).height();s>o?(t.height(o),t.parent().parent().height(o)):(t.height(s-20),t.parent().parent().height(s-20))}}}),bizagi.filterBase.extend("bizagi.filterNumber",{},{init:function(e){var t=this;t._super(e),t._setReturnObject()},_render:function(){var e=this,t=e.options,i=t.getResource("bz-rp-components-time-from-label")+" ("+e._formatNumber(t.properties.data.min)+"):",a=t.getResource("bz-rp-components-time-to-label")+" ("+e._formatNumber(t.properties.data.max)+"):",n='<input type="number">';$("#ui-bizagi-title",e.modalView).text(t.properties.display),$("#filter-wrapper",e.modalView).empty(),$("#filter-wrapper",e.modalView).append("<li><label>"+i+"</label></li>"),$("#filter-wrapper",e.modalView).append('<li class="ui-bizagi-number-filter-min">'+n+"</li>"),$("#filter-wrapper",e.modalView).append("<li><label>"+a+"</label></li>"),$("#filter-wrapper",e.modalView).append('<li class="ui-bizagi-number-filter-max">'+n+"</li>"),$("#filter-wrapper",e.modalView).append('<li class="ui-bizagi-number-filter-notification" style="display: none;"><span></span></li>'),e._enableNotification(!1)},_setReturnObject:function(){var e=this,t=e.options.properties.attribute;e.returnObject=[{properties:{xpath:t+"@from",type:"number",typeSearch:"range",rangeQuery:"from"}},{properties:{xpath:t+"@to",type:"number",typeSearch:"range",rangeQuery:"to"}}]},_setValue:function(){var e=this,t=$(".ui-bizagi-number-filter-min input",e.modalView).asNumber(),i=$(".ui-bizagi-number-filter-max input",e.modalView).asNumber();e.returnObject[0].value=""===t?i:t,e.returnObject[1].value=""===i?t:i},_configureHandlers:function(){var e=this,t=e.options,i=$(".ui-bizagi-number-filter-min input",e.modalView),a=$(".ui-bizagi-number-filter-max input",e.modalView),n="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 46 || event.charCode == 44";i.attr("onkeypress",n),a.attr("onkeypress",n),i.unbind().keyup(function(){var i=$(".ui-bizagi-number-filter-max input",e.modalView).asNumber(),a=$(this).asNumber(),n=parseFloat(a)<t.properties.data.min,r=parseFloat(i)>t.properties.data.max,o=parseFloat(a)>parseFloat(i);if(o||n||r){var s="Verifique los datos";n?s=t.getResource("workportal-my-search-lower-limit-notification"):r?s=t.getResource("workportal-my-search-upper-limit-notification"):o&&(s=t.getResource("workportal-my-search-max-min-notification")),e._enableNotification(!0,s)}else e._disableNotification()}),a.unbind().keyup(function(){var i=$(this).asNumber(),a=$(".ui-bizagi-number-filter-min input",e.modalView).asNumber(),n=parseFloat(a)<t.properties.data.min,r=parseFloat(i)>t.properties.data.max,o=parseFloat(a)>parseFloat(i);if(o||n||r){var s="Verifique los datos";n?s=t.getResource("workportal-my-search-lower-limit-notification"):r?s=t.getResource("workportal-my-search-upper-limit-notification"):o&&(s=t.getResource("workportal-my-search-max-min-notification")),e._enableNotification(!0,s)}else e._disableNotification()}),e._configureCallbacks()},_configureCallbacks:function(){var e=this,t=e.options;$("#ui-bizagi-cancel-filter",e.modalView).unbind().click(function(){e.modalView.kendoMobileModalView("close")}),$("#ui-bizagi-clear-filters",e.modalView).unbind().click(function(){var i=[e.returnObject[0].properties.xpath,e.returnObject[1].properties.xpath];e.setDisplayNameToDefault(),e._setReturnObject(),t.onClear(i),e.modalView.kendoMobileModalView("close")}),$("#ui-bizagi-apply-filter",e.modalView).unbind().click(function(){e._setValue(),e._addFiltersToDisplayName(),t.onApply(e.returnObject),e.modalView.kendoMobileModalView("close")})},_enableNotification:function(e,t){var i=this;e?($(".ui-bizagi-number-filter-notification span",i.modalView).text(t),$(".ui-bizagi-number-filter-notification",i.modalView).show()):$(".ui-bizagi-number-filter-notification",i.modalView).hide(),$("#ui-bizagi-apply-filter",i.modalView).attr("disabled","disabled"),$("#ui-bizagi-apply-filter",i.modalView).addClass("ui-state-disabled")},_disableNotification:function(){var e=this;$(".ui-bizagi-number-filter-notification",e.modalView).hide(),$("#ui-bizagi-apply-filter",e.modalView).removeAttr("disabled"),$("#ui-bizagi-apply-filter",e.modalView).removeClass("ui-state-disabled")},_addFiltersToDisplayName:function(){var e=this,t=e.options,i=t.$opener.text().split(":")
;t.$opener.text(i[0]+": "+e._formatNumber(e.returnObject[0].value)+" "+t.getResource("bz-rp-components-time-to-label")+" "+e._formatNumber(e.returnObject[1].value))},_setDisplayValue:function(){var e=this;e.returnObject[0].value&&e.returnObject[1].value&&($(".ui-bizagi-number-filter-min input",e.modalView).val(e.returnObject[0].value),$(".ui-bizagi-number-filter-max input",e.modalView).val(e.returnObject[1].value))},_formatNumber:function(e){var t=$('<input type="text">');return t.val(e),t.val()},_getFormatOptions:function(){return formatOptions={symbol:"",roundToDecimalPlace:0,eventOnDecimalsEntered:!0}}}),bizagi.filterBase.extend("bizagi.filterMoney",{},{init:function(e){var t=this;t._super(e),t._setReturnObject()},_render:function(){var e=this,t=e.options,i=t.getResource("bz-rp-components-time-from-label")+" ("+e._formatNumber(t.properties.data.min)+"):",a=t.getResource("bz-rp-components-time-to-label")+" ("+e._formatNumber(t.properties.data.max)+"):",n='<input type="number">';$("#ui-bizagi-title",e.modalView).text(t.properties.display),$("#filter-wrapper",e.modalView).empty(),$("#filter-wrapper",e.modalView).append("<li><label>"+i+"</label></li>"),$("#filter-wrapper",e.modalView).append('<li class="ui-bizagi-money-filter-min">'+n+"</li>"),$("#filter-wrapper",e.modalView).append("<li><label>"+a+"</label></li>"),$("#filter-wrapper",e.modalView).append('<li class="ui-bizagi-money-filter-max">'+n+"</li>"),$("#filter-wrapper",e.modalView).append('<li class="ui-bizagi-money-filter-notification" style="display: none;"><span></span></li>'),e._enableNotification(!1)},_setReturnObject:function(){var e=this,t=e.options.properties.attribute;e.returnObject=[{properties:{xpath:t+"@from",type:"money",typeSearch:"range",rangeQuery:"from"}},{properties:{xpath:t+"@to",type:"money",typeSearch:"range",rangeQuery:"to"}}]},_setValue:function(){var e=this,t=$(".ui-bizagi-money-filter-min input",e.modalView).asNumber(),i=$(".ui-bizagi-money-filter-max input",e.modalView).asNumber();e.returnObject[0].value=""===t?i:t,e.returnObject[1].value=""===i?t:i},_configureHandlers:function(){var e=this,t=e.options,i=$(".ui-bizagi-money-filter-min input",e.modalView),a=$(".ui-bizagi-money-filter-max input",e.modalView);i.attr("onkeypress","return event.charCode >= 48 && event.charCode <= 57"),a.attr("onkeypress","return event.charCode >= 48 && event.charCode <= 57"),i.unbind().keyup(function(){var i=$(".ui-bizagi-money-filter-max input",e.modalView).asNumber(),a=$(this).asNumber(),n=parseInt(a)<t.properties.data.min,r=parseInt(i)>t.properties.data.max,o=parseInt(a)>parseInt(i);if(o||n||r){var s="Verifique los datos";n?s=t.getResource("workportal-my-search-lower-limit-notification"):r?s=t.getResource("workportal-my-search-upper-limit-notification"):o&&(s=t.getResource("workportal-my-search-max-min-notification")),e._enableNotification(!0,s)}else e._disableNotification()}),a.unbind().keyup(function(){var i=$(this).asNumber(),a=$(".ui-bizagi-money-filter-min input",e.modalView).asNumber(),n=parseInt(a)<t.properties.data.min,r=parseInt(i)>t.properties.data.max,o=parseInt(a)>parseInt(i);if(o||n||r){var s="Verifique los datos";n?s=t.getResource("workportal-my-search-lower-limit-notification"):r?s=t.getResource("workportal-my-search-upper-limit-notification"):o&&(s=t.getResource("workportal-my-search-max-min-notification")),e._enableNotification(!0,s)}else e._disableNotification()}),e._configureCallbacks()},_configureCallbacks:function(){var e=this,t=e.options;$("#ui-bizagi-cancel-filter",e.modalView).unbind().click(function(){e.modalView.kendoMobileModalView("close")}),$("#ui-bizagi-clear-filters",e.modalView).unbind().click(function(){var i=[e.returnObject[0].properties.xpath,e.returnObject[1].properties.xpath];e.setDisplayNameToDefault(),e._setReturnObject(),t.onClear(i),e.modalView.kendoMobileModalView("close")}),$("#ui-bizagi-apply-filter",e.modalView).unbind().click(function(){e._setValue(),e._addFiltersToDisplayName(),t.onApply(e.returnObject),e.modalView.kendoMobileModalView("close")})},_enableNotification:function(e,t){var i=this;e?($(".ui-bizagi-money-filter-notification span",i.modalView).text(t),$(".ui-bizagi-money-filter-notification",i.modalView).show()):$(".ui-bizagi-money-filter-notification",i.modalView).hide(),$("#ui-bizagi-apply-filter",i.modalView).attr("disabled","disabled"),$("#ui-bizagi-apply-filter",i.modalView).addClass("ui-state-disabled")},_disableNotification:function(){var e=this;$(".ui-bizagi-money-filter-notification",e.modalView).hide(),$("#ui-bizagi-apply-filter",e.modalView).removeAttr("disabled"),$("#ui-bizagi-apply-filter",e.modalView).removeClass("ui-state-disabled")},_addFiltersToDisplayName:function(){var e=this,t=e.options,i=t.$opener.text().split(":");t.$opener.text(i[0]+": "+e._formatNumber(e.returnObject[0].value)+" "+t.getResource("bz-rp-components-time-to-label")+" "+e._formatNumber(e.returnObject[1].value))},_setDisplayValue:function(){var e=this;e.returnObject[0].value&&e.returnObject[1].value&&($(".ui-bizagi-money-filter-min input",e.modalView).val(e.returnObject[0].value),$(".ui-bizagi-money-filter-max input",e.modalView).val(e.returnObject[1].value))},_formatNumber:function(e){var t=this,i=$('<input type="text">');return i.val(e),i.formatCurrency(t._getFormatOptions()),i.val()},_getFormatOptions:function(){var e=this,t=e.options.numericFormat;return formatOptions={symbol:t.symbol,roundToDecimalPlace:0,eventOnDecimalsEntered:!0}}}),bizagi.filterBase.extend("bizagi.filterDate",{},{init:function(e){var t=this;t._super(e),t._setReturnObject(),t.selectedValues={}},_render:function(){var e=this,t=e.options,i=e._getDateFromInvariant(t.properties.data.min),a=e._getDateFromInvariant(t.properties.data.max),n=t.getResource("bz-rp-components-time-from-label")+" ("+e._formatDate(i,t.getResource("dateFormat"))+"): ",r=t.getResource("bz-rp-components-time-to-label")+" ("+e._formatDate(a,t.getResource("dateFormat"))+"): ",o='<input type="text">';$("#ui-bizagi-title",e.modalView).text(t.properties.display),$("#filter-wrapper",e.modalView).empty(),$("#filter-wrapper",e.modalView).append("<li><label>"+n+"</label></li>"),$("#filter-wrapper",e.modalView).append('<li class="ui-bizagi-date-filter-from">'+o+"</li>"),$("#filter-wrapper",e.modalView).append("<li><label>"+r+"</label></li>"),$("#filter-wrapper",e.modalView).append('<li class="ui-bizagi-date-filter-to">'+o+"</li>"),$("#filter-wrapper",e.modalView).append('<li class="ui-bizagi-date-filter-notification" style="display: none;"><span></span></li>'),e._enableNotification(!1)},_setReturnObject:function(){var e=this,t=e.options.properties.attribute;e.returnObject=[{properties:{xpath:t+"@from",type:"date",typeSearch:"range",rangeQuery:"from"}},{properties:{xpath:t+"@to",type:"date",typeSearch:"range",rangeQuery:"to"}}]},_configureHandlers:function(){var e=this,t=e.options,i=new Date(e._getDateFromInvariant(t.properties.data.min)),a=new Date(e._getDateFromInvariant(t.properties.data.max)),n={defaultValue:i,display:"modal",mode:"mixed",cancelText:t.getResource("workportal-general-button-label-cancel"),setText:t.getResource("workportal-general-select"),dateFormat:t.getResource("dateFormat").toLowerCase(),showOnFocus:"true",min:i,max:a,onShow:function(e,t){$(".km-modalview-root").hide()},onClose:function(e,t){$(".km-modalview-root").show()},onSet:function(t,i){var a=i.getVal();e.selectedValues.fromDate=new Date(a.getFullYear(),a.getMonth(),a.getDate()),e._verifyData()}},r={defaultValue:a,display:"modal",mode:"mixed",cancelText:t.getResource("workportal-general-button-label-cancel"),setText:t.getResource("workportal-general-select"),dateFormat:t.getResource("dateFormat").toLowerCase(),showOnFocus:"true",min:i,max:a,onShow:function(e,t){$(".km-modalview-root").hide()},onClose:function(e,t){$(".km-modalview-root").show()},onSet:function(t,i){var a=i.getVal();e.selectedValues.toDate=new Date(a.getFullYear(),a.getMonth(),a.getDate()),e._verifyData()}};e._getFromControl().mobiscroll().calendar(n),e._getToControl().mobiscroll().calendar(r),e._configureCallbacks()},_configureCallbacks:function(){var e=this,t=e.options;$("#ui-bizagi-cancel-filter",e.modalView).unbind().click(function(){e.modalView.kendoMobileModalView("close")}),$("#ui-bizagi-clear-filters",e.modalView).unbind().click(function(){var i=[e.returnObject[0].properties.xpath,e.returnObject[1].properties.xpath];e.setDisplayNameToDefault(),e._setReturnObject(),t.onClear(i),e.modalView.kendoMobileModalView("close")}),$("#ui-bizagi-apply-filter",e.modalView).unbind().click(function(){e._setValuesOfReturnObject(),e._setDisplayTitle(),t.onApply(e.returnObject),e.modalView.kendoMobileModalView("close")})},_setValuesOfReturnObject:function(){var e=this,t=e._getFromControl().mobiscroll("getDate"),i=e._getToControl().mobiscroll("getDate");e.returnObject[0].value=null!==t?e._formatDate(t,"MM/dd/yyyy"):e._formatDate(i,"MM/dd/yyyy"),e.returnObject[1].value=null!==i?e._formatDate(i,"MM/dd/yyyy"):e._formatDate(t,"MM/dd/yyyy")},_setDisplayTitle:function(){var e=this,t=e.options,i=t.$opener.text().split(":"),a=e._getDateFromInvariant(e.returnObject[0].value),n=e._getDateFromInvariant(e.returnObject[1].value);t.$opener.text(i[0]+": "+e._formatDate(a,t.getResource("dateFormat"))+" "+t.getResource("bz-rp-components-time-to-label")+" "+e._formatDate(n,t.getResource("dateFormat")))},_setDisplayValue:function(){},_enableNotification:function(e,t){var i=this;e?($(".ui-bizagi-date-filter-notification span",i.modalView).text(t),$(".ui-bizagi-date-filter-notification",i.modalView).show()):$(".ui-bizagi-date-filter-notification",i.modalView).hide(),$("#ui-bizagi-apply-filter",i.modalView).attr("disabled","disabled"),$("#ui-bizagi-apply-filter",i.modalView).addClass("ui-state-disabled")},_disableNotification:function(){var e=this;$(".ui-bizagi-date-filter-notification",e.modalView).hide(),$("#ui-bizagi-apply-filter",e.modalView).removeAttr("disabled"),$("#ui-bizagi-apply-filter",e.modalView).removeClass("ui-state-disabled")},_formatDate:function(e,t){return bizagi.util.dateFormatter.formatDate(e,t)},_getFromControl:function(){var e=this;return $(".ui-bizagi-date-filter-from input",e.modalView)},_getToControl:function(){var e=this;return $(".ui-bizagi-date-filter-to input",e.modalView)},_getDateFromInvariant:function(e){return bizagi.util.dateFormatter.getDateFromInvariant(e)},_verifyData:function(){var e=this,t=e.options,i=void 0===e.selectedValues.fromDate,a=void 0===e.selectedValues.toDate,n=e.selectedValues.fromDate<new Date(t.properties.data.min).setHours(0,0,0,0),r=e.selectedValues.toDate>new Date(t.properties.data.max).setHours(0,0,0,0),o=e.selectedValues.fromDate>e.selectedValues.toDate;if(i||a)e._enableNotification(!1);else if(o||n||r){var s="Verifique los datos";n?s=t.getResource("workportal-my-search-lower-limit-notification"):r?s=t.getResource("workportal-my-search-upper-limit-notification"):o&&(s=t.getResource("workportal-my-search-max-min-notification")),e._enableNotification(!0,s)}else e._disableNotification()}}),bizagi.filterBase.extend("bizagi.filterMultiple",{},{init:function(e){var t=this;t._super(e),t._setReturnObject(),t._bindDefaultFilter()},_bindDefaultFilter:function(){for(var e,t=this,i=t.options.properties.data||[],a=": ",n=-1,r=!1;e=i.defaultValues[++n];)e.applied&&(r=!0,t.returnObject.value.push({id:e.id}),a+=e.displayName);if(r){var o=t.options.$opener.text().split(":");t.options.$opener.text(o[0]+a)}},_render:function(){var e,t=this,i=t.options,a=-1,n=i.getResource("render-boolean-yes"),r=i.getResource("render-boolean-no");for($("#ui-bizagi-title",t.modalView).text(i.properties.display),$("#filter-wrapper",t.modalView).empty();e=i.properties.data.defaultValues[++a];)if(""!=e.id&&""!=e.displayName){var o="<li>"+e.displayName;o+='<input data-role="switch" data-off-label="'+r+'" data-on-label="'+n,o+='" data-displayname="'+e.displayName+'" id="'+e.id+'" type="checkbox" >',o+="</li>",e.applied&&$(o).kendoMobileSwitch({checked:!0}),$("#filter-wrapper",t.modalView).append($(o))}t._disableApply()},_setReturnObject:function(){var e=this;e.returnObject={properties:{xpath:e.options.properties.attribute,type:"entity",typeSearch:"exact"},value:[]}},_setValue:function(e,t){var i=this;if(t)i.returnObject.value.push({id:e}),i._enableApply();else{var a=i.returnObject.value.find(function(t){return t.id==e});a&&i.returnObject.value.splice(i.returnObject.value.indexOf(a),1),0==i.returnObject.value.length?i._disableApply():i._enableApply()}},_configureHandlers:function(){var e=this;$("#filter-wrapper input:checkbox",e.modalView).each(function(){$(this).data("kendoMobileSwitch").bind("change",function(t){e._setValue(t.sender.element.attr("id"),t.checked)})}),e._configureCallbacks()},_configureCallbacks:function(){var e=this,t=e.options;$("#ui-bizagi-cancel-filter",e.modalView).unbind().click(function(){e.modalView.kendoMobileModalView("close")}),$("#ui-bizagi-clear-filters",e.modalView).unbind().click(function(){var i=[e.returnObject.properties.xpath];e.setDisplayNameToDefault(),e._setReturnObject(),t.onClear(i),e.modalView.kendoMobileModalView("close")}),$("#ui-bizagi-apply-filter",e.modalView).unbind().click(function(){e._addFiltersToDisplayName(),t.onApply([e.returnObject]),e.modalView.kendoMobileModalView("close")})},_enableApply:function(){var e=this,t=$("#ui-bizagi-apply-filter",e.modalView);t.removeAttr("disabled"),t.removeClass("ui-state-disabled")},_disableApply:function(){var e=this,t=$("#ui-bizagi-apply-filter",e.modalView);t.attr("disabled","disabled"),t.addClass("ui-state-disabled")},_addFiltersToDisplayName:function(){var e=this,t=e.options.$opener.text().split(":"),i=t[0]+": ",a=e.returnObject.value.length;$("#filter-wrapper input:checked",e.modalView).each(function(){a--,i=i+$(this).data("displayname")+(0==a?"":", ")}),e.options.$opener.text(i)},_setDisplayValue:function(){for(var e,t=this,i=-1;e=t.returnObject.value[++i];){$("#filter-wrapper input#"+e.id+":checkbox",t.modalView).data("kendoMobileSwitch").toggle()}}}),bizagi.filterBase.extend("bizagi.filterBoolean",{},{init:function(e){var t=this;t._super(e),t._setReturnObject()},_render:function(){var e,t=this,i=t.options,a=-1;for($("#ui-bizagi-title",t.modalView).text(i.properties.display),$("#filter-wrapper",t.modalView).empty();e=i.properties.data.defaultValues[++a];)""!=e.id&&""!=e.displayName&&$("#filter-wrapper",t.modalView).append($('<li class="filter-item"><input type="radio" name="filterBoolean" id="'+e.id+'" class="k-radio"><label class="k-radio-label" for="'+e.id+'">'+bizagi.util.formatBoolean(e.displayName)+"</label></li>"));void 0!==t.returnObject.value&&t._disableApply()},_setReturnObject:function(){var e=this;e.returnObject={properties:{xpath:e.options.properties.attribute,type:"boolean",typeSearch:"exact"}}},_setValue:function(e){var t=this;t.returnObject.value=e,t._enableApply()},_configureHandlers:function(){var e=this;$("#filter-wrapper input:radio",e.modalView).bind("change",function(t){e._setValue(this.id)}),e._configureCallbacks()},_configureCallbacks:function(){var e=this,t=e.options;$("#ui-bizagi-cancel-filter",e.modalView).unbind().click(function(){e.modalView.kendoMobileModalView("close")}),$("#ui-bizagi-clear-filters",e.modalView).unbind().click(function(){var i=[e.returnObject.properties.xpath];e.setDisplayNameToDefault(),e._setReturnObject(),t.onClear(i),e.modalView.kendoMobileModalView("close")}),$("#ui-bizagi-apply-filter",e.modalView).unbind().click(function(){e._addFiltersToDisplayName(),t.onApply([e.returnObject]),e.modalView.kendoMobileModalView("close")})},_enableApply:function(){var e=this,t=$("#ui-bizagi-apply-filter",e.modalView);t.removeAttr("disabled"),t.removeClass("ui-state-disabled")},_disableApply:function(){var e=this,t=$("#ui-bizagi-apply-filter",e.modalView);t.attr("disabled","disabled"),t.addClass("ui-state-disabled")},_addFiltersToDisplayName:function(){var e=this,t=e.options.$opener,i=bizagi.util.formatBoolean(e.returnObject.value),a=t.text().indexOf(":")>0?t.text().substring(0,t.text().indexOf(":")):t.text();t.text(a+": "+i)},_setDisplayValue:function(){var e=this;if(void 0!==e.returnObject.value){e.returnObject.value,$("#filter-wrapper input:radio",e.modalView).click()}}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.homePortal",{DEVICE_TABLET_IOS:"tablet_ios",DEVICE_TABLET_ANDROID:"tablet_android",TEMPLATE_CONTENT_NAME:"homePortal-tmpl",SMARTINBOX_SHARE:"sharedSmartInbox",LAST_PROCESS_ICON:"#a-last-open-inbox-icon",LAST_PROCESS_NAME:"#a-last-open-inbox-name",DIV_LAST_PROCESS:"#div-last-open-inbox-item",BZ_WP_HOME_PROCESSES_LIST:".bz-wp-home-processes-list-container",ACTIVE_PROCESS_LIST:"#active-process-list",SMARTINBOX_PROCESS_LIST:"#active-smartinbox-list",VIEW_TYPE:"detailView",FILTERS_RESTRICTED_COLUMNS:["currentfullname","currentlocation","currentusername","baworkflowpath"]},{init:function(e,t,i){var a=this;this._super(e,t,i),a.setDefaultData(),a.configureTriggers(),a.leftPanelBehavior()},setDefaultData:function(){var e=this;e.processListEnabled=bizagi.util.validateFeatureSupport("processListEnabled");var t={sort:[{field:"orderValue",dir:"asc"}]};e.activeProcessDataSource=new kendo.data.DataSource(t),e.maxColumnsAllowedOnView=0,e.sortEnabled=bizagi.util.validateFeatureSupport("sortEnabled"),e.sortDataSource=new kendo.data.DataSource,e.sortDirectionAsc="asc",e.sortDirectionDesc="desc",e.filterableColumnsDataSource=[],e.filterDataSource=new kendo.data.DataSource({schema:{model:{id:"id",index:-1}}}),e.possibleOperators=[{id:"is-empty",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-is-empty-label","is empty"),control:"none",requireValue:!1,appliesTo:["boolean","int","bigint","smallint","tinyint","decimal","numeric","money","float","real","varchar","char","text","nchar","nvarchar","ntext","datetime","smalldatetime","entity"]},{id:"is-not-empty",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-is-not-empty-label","is not empty"),control:"none",requireValue:!1,appliesTo:["boolean","int","bigint","smallint","tinyint","decimal","numeric","money","float","real","varchar","char","text","nchar","nvarchar","ntext","datetime","smalldatetime","entity"]},{id:"equals",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-equals-label","equals"),control:"simple",requireValue:!0,appliesTo:["boolean","int","bigint","smallint","tinyint","decimal","numeric","money","float","real","varchar","char","text","nchar","nvarchar","ntext","entity"]},{id:"not-equals",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-not-equals-label","not equals"),control:"simple",requireValue:!0,appliesTo:["boolean","int","bigint","smallint","tinyint","decimal","numeric","money","float","real","varchar","char","text","nchar","nvarchar","ntext","entity"]},{id:"starts-with",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-starts-with-label","starts with"),control:"compound-array",requireValue:!0,appliesTo:["varchar","char","text","nchar","nvarchar","ntext","entity"]},{id:"not-starts-with",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-not-starts-with-label","not starts with"),control:"simple",requireValue:!0,appliesTo:["varchar","char","text","nchar","nvarchar","ntext","entity"]},{id:"ends-with",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-ends-with-label","ends with"),control:"compound-array",requireValue:!0,appliesTo:["varchar","char","text","nchar","nvarchar","ntext","entity"]},{id:"not-ends-with",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-not-ends-with-label","not ends with"),control:"simple",requireValue:!0,appliesTo:["varchar","char","text","nchar","nvarchar","ntext","entity"]},{id:"contains",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-contains-label","contains"),control:"compound-array",requireValue:!0,appliesTo:["varchar","char","text","nchar","nvarchar","ntext","entity"]},{id:"not-contains",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-not-contains-label","not contains"),control:"simple",requireValue:!0,appliesTo:["varchar","char","text","nchar","nvarchar","ntext","entity"]},{id:"greater-than",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-greater-than-label","greater than"),control:"simple",requireValue:!0,appliesTo:["int","bigint","smallint","tinyint","decimal","numeric","money","float","real","datetime"]},{id:"greater-than-or-equals",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-greater-than-or-equals-label","greater than or equals"),control:"simple",requireValue:!0,appliesTo:["int","bigint","smallint","tinyint","decimal","numeric","money","float","real","datetime"]},{id:"less-than",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-less-than-label","less than"),control:"simple",requireValue:!0,appliesTo:["int","bigint","smallint","tinyint","decimal","numeric","money","float","real","datetime"]},{id:"less-than-or-equals",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-less-than-or-equals-label","less than or equals"),control:"simple",requireValue:!0,appliesTo:["int","bigint","smallint","tinyint","decimal","numeric","money","float","real","datetime"]},{id:"on",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-on-label","on"),control:"on-date",requireValue:!0,appliesTo:["datetime"]},{id:"between",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-between-label","between"),control:"compound",requireValue:!0,appliesTo:["datetime","int","smallint","tinyint","decimal","numeric","money","float","real","bigint"]},{id:"in",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-in-label","in"),control:"compound-array",requireValue:!0,appliesTo:["varchar","char","text","nchar","int","bigint","smallint","tinyint","decimal","numeric","money","float","real","entity"]},{id:"not-in",name:bizagi.localization.getResource("workportal-widget-smartinbox-filters-not-in-label","not in"),control:"compound-array",requireValue:!0,appliesTo:["varchar","char","text","nchar","int","bigint","smallint","tinyint","decimal","numeric","money","float","real","entity"]}],e.defaultInboxEnabled=bizagi.util.validateFeatureSupport("defaultInboxEnabled")},renderContent:function(e){var t=this,i=$.Deferred();return bizagi.util.isMobileDevice()?(t.hasOfflineForm=bizagi.util.hasOfflineFormsEnabled(),t.modeInbox=bizagi.util.getLastProcessInboxInputTray()):(BIZAGI_ENABLE_OFFLINE_FORMS=!1,t.hasOfflineForm=BIZAGI_ENABLE_OFFLINE_FORMS),t.isOfflineErrorsViewSupported=bizagi.util.isOfflineErrorsViewSupported(),t.content=t.homePortalFramework.loadComponentTemplate(t.Class.TEMPLATE_CONTENT_NAME,"homePortal",{hasOfflineForm:t.hasOfflineForm,sortEnabled:t.sortEnabled,showSyncErrorsView:t.isOfflineErrorsViewSupported}),t.content=t.adjustTemplateElements(t.content),t.activeProcessesListContainer=$(t.Class.BZ_WP_HOME_PROCESSES_LIST,t.content),i.resolve(t.content),i.promise()},smartInboxShare:function(){self=this;var e=bizagi.util.getQueryString(),t=bizagi.util.getQueryString(document.referrer),i=self.workportalFacade.getTemplate(self.Class.SMARTINBOX_SHARE);(e.widget&&"smartinbox"==e.widget&&e.action&&"create"==e.action||t.widget&&"smartinbox"==t.widget&&t.action&&"create"==t.action)&&$(i).dialog({title:bizagi.localization.getResource("workportal-general-word-error-message"),width:"400px",modal:!0})},adjustTemplateElements:function(e){return e},postRender:function(e){var t=this;return t.homePortalFramework.loadComponents("homePortal",t.content).done(function(){t.processListEnabled&&t.renderProcessList(),t.sortEnabled&&t.renderSortList(),void 0!==bizagi.util.getLastProcessInboxSmartInboxId()&&null!=bizagi.util.getLastProcessInboxSmartInboxId()?t.createFilterDataSource(bizagi.util.getLiveFiltersFromStorage(bizagi.util.getLastProcessInboxSmartInboxId())):t.createFilterDataSource(bizagi.util.getLiveFiltersFromStorage(bizagi.util.getLastProcessInbox().processInfo.idWorkflow)),t.smartInboxShare()})},configureHandlers:function(){},configureTriggers:function(){$(document).off("cleanLastOpenInbox.homePortal"),$(document).on("cleanLastOpenInbox.homePortal",function(){bizagi.util.removeLastProcessInbox()})},setStatusDescription:function(e){var t=this;t.setStatusType("updating-counter"),t.statusDescription.html(e)},retryDownloadCases:function(){$(document).trigger("retry-download-offline-forms")},updateSyncState:function(e){var t=this;if(e=e||{},"download-started"===e.type)t.setStatusType("calculating");else if("up-to-date"===e.type)bizagi.util.storeSyncTimeStamp(new Date),t.setStatusType("up-to-date");else if("update-total-downloads"===e.type)t.formsDownloaded=0,t.formsFailed=0,t.formsTotal=0,e.argument>0&&(t.formsTotal=e.argument,t.setStatusType("downloading"));else if("form-finished"===e.type&&t.formsTotal>0){"success"===e.argument?t.formsDownloaded++:t.formsFailed++;var i=Math.ceil(100*t.formsDownloaded/t.formsTotal);t.setStatusDescription(i+"%")}else"download-finished"===e.type?(bizagi.util.storeSyncTimeStamp(new Date),t.setStatusType("download-successful"),t.formsDownloaded=0,t.formsFailed=0,t.formsTotal=0):"download-error"===e.type&&(t.formsDownloaded=0,t.formsFailed=0,t.formsTotal=0,t.setStatusType("download-error"))},updateSyncErrorsState:function(e){if(e=e||{},void 0!=this.syncErrorsIcon&&this.isOfflineErrorsViewSupported){var t=e.errors>0?"#sync-failed-24x":"#sync-cases";this.syncErrorsIcon.attr("xlink:href",t)}},setOfflineNotificationStatusClass:function(e){var t=this;show=!e,_getClass=function(e){return e?"online":"offline"},t.offlineStatusContainer.removeClass(_getClass(show)).addClass(_getClass(e))},offlineNotificationAnimate:function(e){this.setOfflineNotificationStatusClass(e)},isOnline:function(){return this.dataService.online},setStatusType:function(e){var t=this,i="online"===e;if(_show=!i,t.actionsContainer.hide(),t.offlineNotificationAnimate(i),_show)switch(e){case"offline":t.statusIcon.attr("xlink:href","#icon-offline"),t.statusIcon.css("fill","#9E9E9E"),t.statusTitle.text(t.getResource("workportal-offline-mode","Currently working in offline mode")),t.setOfflineDescriptionUpdater();break;case"calculating":t.statusIcon.attr("xlink:href","#icon-retrieve-offline"),t.statusIcon.css("fill","#9E9E9E"),t.statusTitle.text(t.getResource("wokrportal-offline-retrieving-offline-work-message","Retrieving offline work")),t.setStatusDescription("");break;case"downloading":t.statusIcon.attr("xlink:href","#icon-download"),t.statusIcon.css("fill","#9E9E9E"),t.statusTitle.text(t.getResource("wokrportal-offline-retrieving-offline-work-message","Retrieving offline work")),t.setStatusDescription("0%");break;case"download-successful":t.formsTotal>0&&(t.statusIcon.attr("xlink:href","#icon-check-mark"),t.statusIcon.css("fill","#2D8631"),t.statusTitle.text(t.getResource("workportal-offline-download-success-title","Download successful")),t.setStatusDescription("100%")),setTimeout(function(){t.setStatusType("online")},2e3);break;case"download-error":if(t.statusIcon.attr("xlink:href","#icon-warning"),t.statusIcon.css("fill","#DA3B3B"),t.statusTitle.text(t.getResource("workportal-offline-download-error-title","Download error")),void 0!==t.formsFailed&&t.formsFailed>0){var a=t.getResource("workportal-offline-download-error-count","Forms failed: {0}");t.setStatusDescription(a.replace("{0}",t.formsFailed))}else t.setStatusDescription("");t.actionsContainer.show();break;case"up-to-date":t.statusIcon.attr("xlink:href","#icon-check-mark"),t.statusIcon.css("fill","#2D8631"),t.statusTitle.text(t.getResource("workportal-offline-up-to-date-message","Your offline work is up to date")),t.setStatusDescription("")}},setOfflineDescriptionUpdater:function(){var e=this;if(!e.isOnline()){var t=e.generateSyncTimeHTML();e.setStatusDescription(t),setTimeout(e.setOfflineDescriptionUpdater.bind(e),6e4)}},generateSyncTimeHTML:function(){var e=this;if(bizagi.util.getSyncTimeStamp()){return"<p>"+e.getResource("workportal-offline-synchronized","Synchronized {0}").replace("{0}",bizagi.util.dateFormatter.getRelativeTime(bizagi.util.getSyncTimeStamp()))+"</p>"}return""},changeStatusConnection:function(){var e=this;if(e.dataService.online)e.setStatusType("online"),e.hasOfflineForm||(bizagi.webpart.publish("bz-summary-item-clear"),e.publish("bz-update-list-cases",{updateDataList:!0}));else{e.setStatusType("offline");try{$(e.Class.ACTIVE_PROCESS_LIST,e.content).data("kendoMobileListView").scroller().scrollTo(0,0)}catch(e){}e.hasOfflineForm||(e.hasStakeholders?$("[data-menu-action='taskfeed']",".bz-wp-menu-list").click():(bizagi.webpart.publish("bz-summary-item-clear"),e.publish("bz-update-list-cases",{updateDataList:!0})),setTimeout(function(){bizagi.showMessageBox(e.getResource("workportal-general-error-connection"))},100))}},configureProcessMenuHandler:function(){var e=this,t=$(e.Class.DIV_LAST_PROCESS,e.content);t&&t.on("touchend",function(t){t.preventDefault(),e.getActiveProcessesHandler()}),e.setLastOpenInbox(),e.defaultInboxEnabled&&$.when(e.dataService.getLastProcessInboxWorkflow()).then(function(t){e.setLastOpenInbox(t.processInfoName)}).fail(function(){e.setLastOpenInbox()})},changeVisibility:function(e){var t=this,i=$(t.Class.DIV_LAST_PROCESS,t.content);e?i.show():i.hide()},getActiveProcessesHandler:function(){var e=this,t=$(e.Class.ACTIVE_PROCESS_LIST,e.content);t&&("none"==t.css("display")?(e.toggleLastOpenInboxIcon(!0),e.refreshProcessList()):(e.toggleLastOpenInboxIcon(!1),e.toggleProcessList(!1)))},toggleLastOpenInboxIcon:function(e){var t=this,i=$(t.Class.LAST_PROCESS_ICON,t.content),a=i.find(".km-icon.km-arrow-down.km-notext"),n=i.find(".km-icon.km-arrow-up.km-notext");i&&(!0===e?(i.attr("data-icon","arrow-up"),a.removeClass("km-arrow-down").addClass("km-arrow-up")):(i.attr("data-icon","arrow-down"),n.removeClass("km-arrow-up").addClass("km-arrow-down")))},renderProcessList:function(){var e=this,t=$(e.Class.BZ_WP_HOME_PROCESSES_LIST,e.content),i=$(e.Class.ACTIVE_PROCESS_LIST,e.content);t.kendoMobileScroller(),i.kendoMobileListView({dataSource:e.activeProcessDataSource,template:e.workportalFacade.getTemplate("active-process-list-item"),click:e.onClickProcessList.bind(e)})},onClickProcessList:function(e){var t=this;if(!e.target.data("disabled")){var i=e.target.parent(),a=i.data();bizagi.util.isEmpty(a)||(t.filterableColumnsDataSource=[],bizagi.util.removeLastProcessLiveFilters(),e.preventDefault(),t.cleanSort(),bizagi.util.setLastProcessInbox(a.name,a.idworkflow,a.id),t.setLastOpenInbox(a.name),"processes"==a.type?(t.publish("bz-update-list-cases",{updateDataList:!0,resetScrollAfterLoad:!0,inboxType:"process"}),t.createFilterDataSource(bizagi.util.getLiveFiltersFromStorage(a.idworkflow))):(t.publish("bz-update-list-cases",{updateDataList:!0,resetScrollAfterLoad:!0,smartInboxId:a.id,inboxType:"smartinbox"}),t.createFilterDataSource(bizagi.util.getLiveFiltersFromStorage(a.id))))}},createFilterDataSource:function(e){var t=this;$.each(e,function(e,i){var a=t.getOperatorById(i.selectedOperator.id);void 0!==a&&(i.selectedOperator=a)}),t.filterDataSource=new kendo.data.DataSource({schema:{model:{id:"id",index:-1}}}),t.filterDataSource.data(e)},cleanSort:function(){bizagi.util.removeLastProcessInboxSort()},refreshProcessList:function(){var e=this;$.when(e.dataService.getAllProcesses({taskState:"all",onlyFavorites:!1,inputtray:"inbox",skipAggrupate:!0,mobileDevice:!0}),e.dataService.getAllSmartInbox()).done(function(t,i){e.setCheckedProcessSelected(t.workflows.workflow),e.activeProcessDataSource.data([{isOffline:!e.isOnline(),workflows:t.workflows.workflow,smartInbox:i}]),e.toggleProcessList(!0)})},setCheckedProcessSelected:function(e){if(e){var t=bizagi.util.getLastProcessInboxProcessInfo();e.forEach(function(e){e.idworkflow&&(e.idworkflow==t.idWorkflow?e.isSelected=!0:e.isSelected=!1)})}return e},toggleProcessList:function(e){
var t=this,i=$(t.Class.ACTIVE_PROCESS_LIST,t.content);i&&(e?i.show():i.hide())},setLastOpenInbox:function(e){var t,i=this;if(void 0!=e&&e.length>0)t=e;else{t=bizagi.util.getLastProcessInboxProcessInfo().processInfoName}$(i.Class.LAST_PROCESS_NAME,i.content).html(t),i.toggleLastOpenInboxIcon(!1),i.toggleProcessList(!1)},configureSortMenuHandler:function(){var e=this,t=$(".bz-header-sort-btn",e.content);t&&t.on("touchend",function(t){t.preventDefault(),e.toggleSortMenuHandler()});var i=bizagi.util.getLastProcessInboxSort();e.setSortColumnAndDirection(i,!1)},initSortDataSource:function(){var e=this;return e.dataService.getLastSelectionCustomColumns().then(function(t){var i=e.selectAvailableColumnsFromHeader(t);i=e.addDefaultColumn(i);var a=e.setCheckedColumnHeader(i);e.sortDataSource.data(a)})},initFilterDataSource:function(){var e=this;return e.dataService.getLastSelectionCustomColumns().then(function(t){e.filterableColumnsDataSource=e.selectAvailableColumnsFromHeader(t)})},addDefaultColumn:function(e){return e},toggleSortMenuHandler:function(){var e=this;e.initSortDataSource().then(function(){var t=$(".bz-wp-home-sort-menu-container",e.canvas);console.log("toggleSortMenuHandler : webpart.homeportal.js : touchend"),"none"===t.css("display")?(t.show(),e.changeVisibility(!1),e.toggleProcessList(!1),e.hideOfflineMenu()):e.hideSortMenu()})},hideOfflineMenu:function(){var e=this;if("none"!=$(".bz-wp-home-offline-menu-container",e.canvas).css("display")){var t=$(".bz-header-offline-btn");t&&t.click()}},hideSortMenu:function(){var e=this;$(".bz-wp-home-sort-menu-container",e.canvas).hide(),e.changeVisibility(!0),e.toggleProcessList(!1),e.toggleLastOpenInboxIcon(!1)},renderSortList:function(){var e=this,t=$(".bz-wp-home-sort-menu-container",e.content),i=$("#sort-columns-list",e.content);t.kendoMobileScroller(),i.kendoMobileListView({dataSource:e.sortDataSource,template:e.workportalFacade.getTemplate("active-sort-list-item"),click:function(t){var i={sortFieldName:t.dataItem.fieldName,order:t.dataItem.order};e.setSortColumnAndDirection(i,!0),e.publish("bz-update-list-cases",{updateDataList:!0}),e.hideSortMenu()}})},setCheckedColumnHeader:function(e){if(e){var t=bizagi.util.getLastProcessInboxSort();e.forEach(function(e){e.fieldName&&(e.fieldName===t.sortFieldName?(e.isSelected=!0,e.sortDirection=t.sortDirection):(e.isSelected=!1,e.sortDirection=""))})}return e},setSortColumnAndDirection:function(e,t){var i=this,a=bizagi.util.getLastProcessInboxSort();e?(a.sortDirection=a.sortDirection==i.sortDirectionAsc?i.sortDirectionDesc:i.sortDirectionAsc,a.sortFieldName=e.sortFieldName,t&&e.sortFieldName&&bizagi.util.setLastProcessInboxSort(e.sortFieldName,a.sortDirection,e.order)):bizagi.util.removeLastProcessInboxSort()},selectAvailableColumnsFromHeader:function(e){var t=this,i=0,a=[];bizagi.util.getLastProcessInboxSmartInboxId();for(var n=bizagi.util.getLastProcessInboxProcessInfo(),r=void 0!==n.smartInboxId&&null!==n.smartInboxId,o=0;o<e.length;o++){const s=e[o];if(!(t.Class.FILTERS_RESTRICTED_COLUMNS.indexOf(s.fieldName)>-1)&&(s&&s.fieldName)){var l=!1;if(t.dataService.isInboxSystemHeaderSortable(s,n,t.Class.VIEW_TYPE))l=!0,(s.isSmartInbox||s.isCustomColumn)&&(i+=1);else{if(r&&!s.isSmartInbox)continue;var c=t.dataService.validateCustomColumn(s,t.maxColumnsAllowedOnView,i);l=c.isValid,i=c.selectedColumnsCount}l&&a.push(s)}}return a.sort(function(e,t){return e.displayName<t.displayName?-1:e.displayName>t.displayName?1:0})},leftPanelBehavior:function(){bizagi.webpart.subscribe("bz-left-panel-hide",function(){$("#left-pane").hide()}),bizagi.webpart.subscribe("bz-left-panel-show",function(){$("#left-pane").show()})},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},getOperatorsByDatatype:function(e){var t=this,i=[];if(e){e=e.toLowerCase();var a=$.grep(t.possibleOperators,function(t){return t.appliesTo.indexOf(e)>=0});Array.prototype.push.apply(i,a)}return i},getOperatorById:function(e){var t=this;return void 0!==e?t.possibleOperators.find(function(t){return t.id==e}):void 0},isBooleanDataType:function(e){return"boolean"==(e=e.toLowerCase())},isTextDataType:function(e){var t=["varchar","char","text","nchar","nvarchar","ntext"];return e=e.toLowerCase(),t.indexOf(e)>-1},isIntDataType:function(e){var t=["int","bigint","smallint","tinyint"];return e=e.toLowerCase(),t.indexOf(e)>-1},isRealDataType:function(e){var t=["decimal","numeric","money","float","real"];return e=e.toLowerCase(),t.indexOf(e)>-1},isDateTimeDataType:function(e){var t=["datetime","smalldatetime"];return e=e.toLowerCase(),t.indexOf(e)>-1},isEntityDataType:function(e){return"entity"==(e=e.toLowerCase())},getIconByType:function(e){e=e.toLowerCase();var t=["int","bigint","smallint","tinyint"],i=["decimal","numeric","money","float","real"],a=["datetime","smalldatetime"];return"boolean"==e?"icon-datatype-boolean":a.indexOf(e)>-1?"icon-datatype-datetime":"entity"==e?"icon-datatype-entity":t.indexOf(e)>-1?"icon-datatype-int":i.indexOf(e)>-1?"icon-datatype-real":"icon-datatype-text"}}),bizagi.workportal.webparts.homePortal.extend("bizagi.workportal.webparts.homePortal",{},{init:function(e,t,i){this._super(e,t,i)},postRender:function(e){var t=this;return t.hasStakeholders=bizagi.currentUser.associatedStakeholders&&bizagi.currentUser.associatedStakeholders.length>0,t._super(e).done(function(){t.hasOfflineForm&&t.renderMenuOptions(),t.configureHandlers(),t.updateSyncErrorsState()})},configureHandlers:function(){var e=this,t=e.getContent();e.offlineStatusContainer=$(".bz-wp-status-container",t),e.statusIcon=$("#bz-wp-status-icon-use",e.offlineStatusContainer),e.statusTitle=$("span.bz-wp-status-title",e.offlineStatusContainer),e.statusDescription=$("span.bz-wp-status-description",e.offlineStatusContainer),e.actionsContainer=$(".bz-wp-status-actions",e.offlineStatusContainer),e.dataService.online||e.updateNetworkState(),e.syncErrorsIcon=$("#bz-wp-sync-errors-button-icon",t),$(document).off("online.inbox"),$(document).on("online.inbox",function(){e.dataService.online=!0,e.hasOfflineForm?(e.updateNetworkState(),e.changeTaskFeedState()):e.updateNetworkState()}),$(document).off("offline.inbox"),$(document).on("offline.inbox",function(){e.dataService.online=!1,e.hasOfflineForm?(e.updateNetworkState(),e.changeTaskFeedState()):e.updateNetworkState()}),$("#select-outbox-type").delegate(".bz-header-outbox-new-btn","click",function(){e.inputTrayManager("outbox"),e.publish("bz-update-list-cases",{updateDataList:!0})}),$("#select-outbox-type").delegate(".bz-header-outbox-finished-btn","click",function(){e.inputTrayManager("outbox"),e.publish("bz-update-list-cases",{updateDataList:!0})}),$(document).off("offline.sync"),$(document).on("offline.sync",function(t,i){void 0!==i&&e.updateSyncState(i)}),$(".bz-wp-status-button-dismiss",e.offlineStatusContainer).bind("click",function(){e.setStatusType("online")}),$(".bz-wp-status-button-retry",e.offlineStatusContainer).bind("click",function(){e.retryDownloadCases()}),$(document).off("update-sync-errors-icon"),$(document).on("update-sync-errors-icon",function(t,i){e.updateSyncErrorsState(i)})},renderMenuOptions:function(){var e=this,t=kendo.template(e.getTemplate("menu-offline-tmpl"),{useWithBlock:!1});$(".bz-wp-home-offline-menu-container ul",e.content).remove(),$(".bz-wp-home-offline-menu-container",e.content).append(t({online:e.dataService.online})),e.menuOffline=$(".bz-wp-home-offline-menu-list",e.content).kendoMobileListView({click:function(t){var i=t.item,a=$(i).data("tray");t.preventDefault(),e.inputTrayManager(a),e.publish("bz-update-list-cases",{updateDataList:!0,mode:a}),$("#taskFeed",e.content).find(".bz-header-offline-btn").click()}}),e.inputTrayManager("inbox")},inputTrayManager:function(e){var t=this,i=t.modeInbox,a=bizagi.localization.getResource("workportal-taskfeed-title"),n=!1;switch(e){case"outbox":i="outbox-new",a=bizagi.localization.getResource("workportal-menu-outbox"),n=!0;break;case"drafts":i="drafts",a=bizagi.localization.getResource("workportal-general-word-drafts"),n=!1;break;case"inbox":i="inbox",a=bizagi.localization.getResource("workportal-taskfeed-title"),n=!1}var r=$("#taskFeed",t.content).data("kendoMobileView");if(void 0!==r){$(".km-navbar",r.header).data("kendoMobileNavBar").title(a),r.options.title=r.title=a}var o=$("#select-outbox-type",t.content);if(o)if(n){o.removeClass("otherbox"),o.addClass("outbox");var s=$(".outbox-tab-list",o).kendoMobileButtonGroup(),l=s.data("kendoMobileButtonGroup").current().index();i=0==l?"outbox-new":"outbox-cases"}else o.removeClass("outbox"),o.addClass("otherbox");$(".bz-offline-selected",t.content).removeClass("bz-offline-selected"),t.menuOffline.find("[data-tray="+e+"]").addClass("bz-offline-selected"),bizagi.util.setLastProcessInboxInputTray(i)},updateNetworkState:function(){var e=this;e.publish("menu-refresh"),e.publish("newcase-refresh"),e.changeStatusConnection(),e.homePortalFramework&&"syncErrors"===e.homePortalFramework.destination&&e.publish("bz-network-sync-errors-status")},changeTaskFeedState:function(){var e=this;e.dataService.online||e.homePortalFramework&&"syncErrors"!=e.homePortalFramework.destination&&(e.workportalFacade.hasStakeholders()&&$("[data-menu-action='taskfeed']",".bz-wp-menu-list").click(),e.dataService.showTaskFeed())}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.loadForm",{},{init:function(e,t,i){this._super(e,t,i)},renderContent:function(e){var t=this;return kendo.template(t.getTemplate("main-loadForm-kendo-tmpl"),{useWithBlock:!1})()},postRender:function(e){var t=this;t.canvas.bind("view-initialized",$.proxy(t.onAfterViewInitialized,t))},renderSearchForm:function(e,t){var i=this,a=i.view.contentElement();return i.params=$.extend(i.params,t),a.empty(),$.when(i.workportalFacade.modules[i.workportalFacade.Class.render_module]).then(function(){var e=bizagi.util.isTabletDevice()?bizagi.rendering.tablet.form:bizagi.rendering.smartphone.form,t=e.extend({createRenderElement:function(e){var t=this,i=e.render.properties;i.rangeQuery&&"none"!=i.rangeQuery&&(i.xpath=i.xpath+"@"+i.rangeQuery),t._super(e)}}),n=bizagi.rendering.facade.extend({processForm:function(e,i,a){var n=$.extend(a,{renderFactory:i,dataService:a.dataService||this.dataService,data:e}),r=new t(n);return r.render(),r}}),r=new n({device:i.workportalFacade.device||bizagi.util.detectDevice()}),o={h_action:"QUERYFORM",h_contexttype:"entity",h_idForm:i.params.form,dataType:"text"};return i.dataService.getQueryForm(o).then(function(e){var t=/\"type\"\s*:\s*\"([':.,-\[\]\w\s]*)\"/g,n=/\"includedInResult\"\s*:\s*(true)/g,o=e.replace(t,function(e,t,i,a){return e.replace(t,t.replace(/query/i,"").toLowerCase())});o=o.replace(n,'"includedInResult":false');var s=JSON.parse(o);s.form.buttons=[],s.form.contextType=s.form.contextType||"metadata";var l={canvas:a,navigation:new bizagi.workportal.action.navigation(i),data:s,displayName:e.displayName,originalParams:{}};return r.execute(l).then(function(e){i.form=e,$(".ui-bizagi-button-container :button",i.form.container).remove(),$(".ui-bizagi-button-container",i.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">'+bizagi.localization.getResource("render-form-dialog-box-search")+"</div>").delegate('div[ordinal="0"]',"click",function(){i.performSearch()}),i.form.triggerHandler("ondomincluded")})})})},performSearch:function(){var e=this;if(e.form&&e.form.validateForm()){var t=[],i=[];e.form.collectRenderValues(t);for(name in t)if("function"!=typeof t[name]){var a=e.form.getRender(name);a.value&&e.dataService.defineFilterObject({properties:a.properties,value:a.value},i)}var n={guidSearch:e.params.id,filters:i,page:1,pageSize:10,calculateFilters:!0};e.publish("homeportalShow",{what:"stuffTemplates",title:e.params.displayName,params:n})}}}),bizagi.workportal.webparts.loadForm.extend("bizagi.workportal.webparts.loadForm",{},{postRender:function(e){var t=this;t._super(e),t.configureContentHandlers()},onAfterViewInitialized:function(e,t){var i=this;i.view=t,$(".btn-close",t.header).click(function(){i.homePortalFramework._back()}),$(".btn-actions",t.header).actionSheet({actions:[{guid:"search-from-query-form",displayName:bizagi.localization.getResource("render-form-dialog-box-search")}],actionClicked:function(e){i.performSearch()}})},configureContentHandlers:function(){var e=this;e.subscribe("homeportalShow-loadForm",function(t,i){bizagi.util.smartphone.startLoading(),$.when(e.renderSearchForm(t,i)).always(function(){bizagi.util.smartphone.stopLoading()})})}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.menu",{DEVICE_SMARTPHONE_ANDROID:"smartphone_android",authCurrentUserAdministration:!1,authAnalysisReports:!1,authAdmin:!1,enableLogOut:!bizagi.util.isCordovaSupported(),enableHome:!0,enableTaskfeed:!0,authInbox:!1,enableSettings:!1,enableNativeAppLauncher:bizagi.util.isNativeAppLauncherSupported()&&bizagi.util.isCordovaSupported()},{init:function(e,t,i){this._super(e,t,i)},renderContent:function(e){var t=this,i=new $.Deferred;return $.when(t.getSecurityMenu()).done(function(e){t.security=e,i.resolve("")}),i.promise()},postRender:function(e){var t=this;t.configureMenu(),bizagi.webpart.subscribe("menu-refresh",function(){$(".search-container",t.canvas).remove(),$(".bz-menu.component-menu",t.canvas).remove(),bizagi.menuSecurity&&t.dataService.online&&delete bizagi.menuSecurity,t.configureMenu()})},configureMenu:function(e){var t=this,i=bizagi.detectDevice();t.security.authCurrentUserAdministration=t.Class.authCurrentUserAdministration,t.security.authAnalysisReports=t.Class.authAnalysisReports,t.security.authAdmin=t.Class.authAdmin,t.security.enableLogOut=!bizagi.util.isCordovaSupported()&&t.Class.enableLogOut,t.security.enableHome=t.Class.enableHome,t.security.enableTaskfeed=t.Class.enableTaskfeed,t.security.authInbox=t.Class.authInbox,t.dataService.online?(t.security.authAssociatedStakeholders=bizagi.currentUser.associatedStakeholders&&bizagi.currentUser.associatedStakeholders.length>0,t.security.enableNativeAppLauncher=t.Class.enableNativeAppLauncher):(t.security.authAssociatedStakeholders=!1,t.security.enableNativeAppLauncher=!1);var a=i===t.Class.DEVICE_SMARTPHONE_ANDROID&&bizagi.util.isCordovaSupported();t.security.enableSettings=a||t.Class.enableSettings;var n=kendo.template(t.getTemplate("menu-tmpl"),{useWithBlock:!1});t.contentInternal=n($.extend(t.security,bizagi.currentUser)),$("#content-menu-drawer .km-scroll-container",t.canvas).append(t.contentInternal),$(".component-menu, .menu-items",t.canvas).kendoMobileListView({appendOnRefresh:!1,pullToRefresh:!1}),$(".bz-wp-mu-button-search").hide(),$(".component-menu",t.canvas).delegate(".new-case","click",function(e){e.preventDefault(),bizagi.webpart.publish("homeportalShow",{what:"newCase"})}).delegate(".logout","click",function(e){e.preventDefault(),t.logOutAction()}).delegate(".home","click",function(e){e.preventDefault(),bizagi.webpart.publish("homeportalShow",{what:"menuHome"})}).delegate(".task-feed","click",function(e){e.preventDefault(),bizagi.webpart.publish("homeportalShow",{what:"taskFeed"})}).delegate(".nativeAppsLauncher","click",function(e){e.preventDefault(),t.Class.enableNativeAppLauncher&&bizagi.util.isNativePluginSupported()&&bizagiapp.showNativeAppLauncherActivity()}).delegate(".settings","click",function(e){e.preventDefault(),a&&($("#menu-drawer").data("kendoMobileDrawer").scroller.reset(),bizagi.util.isNativePluginSupported()?bizagiapp.showSettingsActivity():window.Bizagi.showSettingsActivity())})},logOutAction:function(){var e=this,t=new $.Deferred;if(bizagi.webpart.publish("bz-logout"),e.dataService.online)$.when(e.dataService.logoutMobile()).always(function(){e.defaultLogout(),t.resolve()});else{var i=e.resources.getResource("confirmation-savebox-message3");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){e.defaultLogout(!0),t.resolve()})}return t.promise()},defaultLogout:function(e){bizagi.util.isCordovaSupported()?window.location=bizagi.services.ajax.logoutPage:e&&window.location.replace("")},getSecurityMenu:function(){var e=this,t={},i=new $.Deferred;return e.security={},e.jsonSecurityList={},e.security=new bizagi.workportal.command.security(e.dataService),bizagi.menuSecurityPromise=$.when(e.security.getSecurity()).done(function(a){e.convertSecurityData(a),e.jsonSecurityList=a,t.authNewCase=e.security.NewCase||!1,t.authAnalysisReports=e.checkRootCategory(a,"AnalysisReports"),t.authAdmin=e.checkRootCategory(a,"Admin"),t.authCurrentUserAdministration=e.security.CurrentUser,$.each(e.security,function(e,i){t[e]=i}),i.resolve(t)}),i.promise()},convertSecurityData:function(e){var t=this;e=e||{};for(var i in e)"object"==typeof e[i]?t.convertSecurityData(e[i]):void 0!=e[i]&&(t.security[e[i]]=!0)},checkRootCategory:function(e,t){if(void 0!=e.permissions)for(var i=0;i<e.permissions.length;i++)if(void 0!=e.permissions[i][t])return!0;return!1}}),bizagi.workportal.webparts.menu.extend("bizagi.workportal.webparts.menu",{PAGE_SIZE:30,SEARCH_DELAY:700},{postRender:function(e){var t=this;t._super(e);var i=t.getTemplate("item-search-menu-tmpl");t.commandSearch=new bizagi.workportal.command.search(t.dataService);var a=$(".bz-menu-search",t.canvas).kendoMobileListView({dataSource:new kendo.data.DataSource,template:i,selectable:"single",click:function(e){t.renderCase(e)}});t.listViewSearch=a.data("kendoMobileListView"),t.configureHandlers()},search:function(e){var t=this;(e.query!==t.lastProcessedValue||e.force)&&(t.lastProcessedValue=e.query,bizagi.loading.start(),$.when(t.commandSearch.searchList(e)).done(function(e){t.listViewSearch.dataSource.data(e.elements),bizagi.loading.stop()}).fail(function(e){e=e||{},e&&void 0===e.elements&&(e={elements:[],page:1,totalPages:1},e.elements.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")})),t.listViewSearch.dataSource.data(e.elements),bizagi.loading.stop()}))},renderCase:function(e){var t=this,i=t.commandSearch.getCaseData(e);bizagi.util.isEmpty(i)||($(".bz-wp-mu-button-search",t.canvas).click(),t.publish("changeCase",i))},configureHandlers:function(){var e=this,t=$("#menu-drawer",e.canvas),i=t.data("kendoMobileDrawer");$("#content-menu-drawer input.bz-wp-mu-input-search-menu",e.canvas).on("click",function(t){void 0===e.originalWidth&&(e.originalWidth=i.getSize().width),void 0===e.searchWidth&&(e.searchWidth=$("#content-menu-drawer input.bz-wp-mu-input-search-menu",e.canvas).width()),i.element.width(window.innerWidth),i.show(),$("#content-menu-drawer input.bz-wp-mu-input-search-menu",e.canvas).animate({width:"75%"}),$(".bz-menu",e.canvas).fadeOut(void 0,void 0,function(){$(".bz-menu-search",e.canvas).fadeIn(),$(".bz-wp-mu-button-search").show()})}).keyup(function(t){if(13===t.which)return void e.search({query:this.value,force:!0});var i=this;return void setTimeout(function(t){e.search({query:i.value})},e.Class.SEARCH_DELAY)}),$(".bz-wp-mu-button-search",e.canvas).on("click",function(t){e.lastProcessedValue=null,e.listViewSearch.dataSource.data([]),$("#content-menu-drawer input.bz-wp-mu-input-search-menu",e.canvas).val(""),i.element.width(e.originalWidth),i.hide(),setTimeout(function(){$(".bz-menu",e.canvas).show(),$(".bz-menu-search",e.canvas).hide(),$(".bz-wp-mu-button-search").hide(),$("#content-menu-drawer input.bz-wp-mu-input-search-menu",e.canvas).animate({width:e.searchWidth})},500)})}}),$.Class("bizagi.workportal.command.security",{},{init:function(e){var t=this;t.dataService=e,t.rawData={}},getSecurity:function(){var e=this,t=new $.Deferred,i={};return e.jsonSecurityList={},bizagi.menuSecurity&&void 0!==bizagi.menuSecurity.authAnalysisReports?t.resolve(bizagi.menuSecurity):$.when(e.dataService.getMenuAuthorization()).done(function(a){e.rawData=a,bizagi.menuSecurity=e.convertSecurityData(a),e.jsonSecurityList=a,i.authNewCase=bizagi.menuSecurity.NewCase||!1,i.authAnalysisReports=e.checkRootCategory(a,"AnalysisReports")||!1,i.authAdmin=e.checkRootCategory(a,"Admin")||!1,i.authCurrentUserAdministration=bizagi.menuSecurity.CurrentUser||!1,t.resolve($.extend(bizagi.menuSecurity,i))}).fail(function(a){e.rawData={},bizagi.menuSecurity={},e.jsonSecurityList={},i.authNewCase=!1,i.authAnalysisReports=!1,i.authAdmin=!1,i.authCurrentUserAdministration=!1,t.resolve($.extend(bizagi.menuSecurity,i))}),t.promise()},convertSecurityData:function(e){var t={},i=function(e){$.each(e,function(e,a){"object"==typeof a?("number"!=typeof e&&(t[e]=!0),i(a)):t[a]=!0})};return i(e.permissions),t},getRawData:function(){return this.rawData},checkRootCategory:function(e,t){if(void 0!=e.permissions)for(var i=0,a=e.permissions.length;i<a;i++)if(void 0!=e.permissions[i][t])return!0;return!1}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.menuHome",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.homePortalFramework=a.getHomeportalFrameworkIntance()},renderContent:function(e){var t=this,i=$.Deferred();return t.content=t.homePortalFramework.loadComponentTemplate("menuHome-tmpl","menuHome",{}),i.resolve(t.content),i.promise()},postRender:function(e){var t=this;return t.canvas.bind("view-initialized",$.proxy(t.onAfterViewInitialized,t)),t.homePortalFramework.loadComponents("menuHome",t.content).done(function(){t.configureHandlers()})},configureHandlers:function(){}}),bizagi.workportal.webparts.menuHome.extend("bizagi.workportal.webparts.menuHome",{},{init:function(e,t,i){this._super(e,t,i)},onAfterViewInitialized:function(e,t){function i(e){var t="translateX("+(100*e.index*-1).toString()+"%)",i=l.get(0).style;i.webkitTransform=t,i.MozTransform=t,i.msTransform=t,i.OTransform=t,i.transform=t,o=e.index}function a(e){r=n.scrollPosition-e.scrollTop,n.scrollPosition=e.scrollTop;var t=r<=0?"up":"down";t!==n.scrollDirection&&("down"===t?(n.scrollDirection="down",n.view.header.removeClass("scroll-up")):(n.scrollDirection="up",n.view.header.addClass("scroll-up")),s.contentResized())}var n=this;n.view=t,n.configureHeaderViewHandlers(),n.scrollPosition=0,n.scrollDirection="down";var r=0,o=0,s=n.view.scroller,l=n.view.element.find(".bz-menu-carousel"),c=n.view.element.find(".bz-menu-carousel-seat"),d=$("#select-category",n.view.header).kendoMobileButtonGroup({select:function(e){i(e)},index:0}),u=d.data("kendoMobileButtonGroup");n.view.element.find(".km-scroll-wrapper").kendoTouch({enableSwipe:!0,swipe:function(e){if(o<c.length-1&&"left"===e.direction||o>0&&"right"===e.direction){var t="left"===e.direction?o+1:o-1;u.select(t),i({index:t})}}}),s.bind("scroll",a),n.view.element.find(".bz-menu-home-content").data("kendoMobileScroller").disable()},configureHeaderViewHandlers:function(){var e=this;$(".km-leftitem .km-button.btn-menu",e.view.header).bind("click",function(){e.publish("homeportalShow",{what:"menu"})}),$(".km-rightitem",e.view.header).bind("click",function(){e.publish("homeportalShow",{what:"newCase"})})}}),bizagi.workportal.webparts.menuHome.extend("bizagi.workportal.webparts.menuHome",{},{onAfterViewInitialized:function(e,t){var i=this;i._super(e,t),bizagi.override.enableNativeNavigationBar&&bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()&&$(".km-rightitem",i.view.header).css("display","none")},configureHeaderViewHandlers:function(){var e=this;$(".km-leftitem .km-button.btn-menu",e.view.header).bind("click",function(){bizagiapp.showMainMenu()}),$(".km-rightitem",e.view.header).bind("click",function(){bizagiapp.showNewCase()})}}),bizagi.workportal.webparts.rendermanager.extend("bizagi.workportal.webparts.overviewPlan",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.PENDING_PLAN="PENDING_PLAN",a.EXECUTING_PLAN="EXECUTING_PLAN",a.CONTEXT_PLANACTIVITIES="PLANACTIVITIES",a.CONTEXT_PLANOVERVIEW="PLANOVERVIEW",a.CONTEXT_PLANCREATE="PLANCREATE",a.plugins={},a.fromIndexEnabledSortingActivities=0,a.dataService=t,a._statePlan=a.PENDING_PLAN,a.userPictures=[],a.templateMain=kendo.template(a.getTemplate("overviewplan-view"),{useWithBlock:!1}),bizagi.util.mobility.overviewViewInit=$.proxy(a.renderViewInit,a),a.planActivitiesItems=kendo.template(a.getTemplate("overview-plan-activities-item"),{useWithBlock:!1}),a.dataPlan=new bizagi.workportal.webparts.overviewPlan.dataPlan(e,t,i)},renderContent:function(){return""},renderViewInit:function(e){var t=this;t.content=$(t.templateMain({})),e.view.contentElement().append(t.content),t.pane=$("#paneRender").data("kendoMobilePane")},postRender:function(){var e=this;bizagi.webpart.subscribe("bz-rnd-overviewplan",function(t,i){bizagi.loading.start(),e.params=i,$.when(e.dataPlan.getPlanData(e.params)).then(function(t){e.params.plan=t;var i=JSON.parse(bizagi.util.getItemLocalStorage("newChanges"));if(i&&i.hasChanges){var a=e.params.plan.activities.filter(function(e){return e.id===i.idActivity});a[0].items=i.items,a[0].numResolvedItems=i.itemsResolved,a[0].numTotalItems=i.items.length,a[0].progress=i.progress,bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!1}))}e.initOverviewPlan()}).always(function(){})})},onNotifySummaryProgressPlan:function(){var e=this;e._statePlan=e.params.plan.currentState+"_PLAN"},initOverviewPlan:function(){var e=this;e.onNotifySummaryProgressPlan(),$.when(e.overviewPlan()).always(function(){bizagi.loading.stop()}).fail(function(){bizagi.loading.stop()})},overviewPlan:function(){var e=this;$("#overview-plan .render-content",e.canvas).empty();var t=kendo.template(e.getTemplate("overview-plan-tmpl-main"),{useWithBlock:!1}),i=e.enableEventsOnActivitiesByCurrentContext(e.params.showContextByMenuDashboard),a=e.params.plan.activities?e.params.plan.activities.filter(function(e){return e.finishDate}).length:0,n={statePlan:e._statePlan,statePendingPlan:e.PENDING_PLAN,stateExecutingPlan:e.EXECUTING_PLAN,contextPlanActivities:e.CONTEXT_PLANACTIVITIES,plan:e.params.plan,showFormAddActivityByNotFinishedAllActivities:0!==a&&a!==e.params.plan.activities.length},r=t(n);$("#overview-plan .render-content",e.canvas).append(r),e._statePlan!=e.PENDING_PLAN&&e._statePlan!=e.EXECUTING_PLAN||!i||(e.plugins.sortablelist=e.initializeSortableList()),e.plugins.notifier=e.initializeNotifier(),e.renderActivities(),e.configureOverviewHeaderHandlers()},renderActivities:function(e){var t=this,i=$(".project-plan-activity-list",t.content),a=e||t.params.plan.activities,n={statePlan:t._statePlan,statePendingPlan:t.PENDING_PLAN,stateExecutingPlan:t.EXECUTING_PLAN,activities:e||t.params.plan.activities};t._statePlan==t.EXECUTING_PLAN&&a.forEach(function(e){e.startDate?e.classEnabledActionActivities="disabled":e.classEnabledActionActivities=t.params.showContextByMenuDashboard===t.CONTEXT_PLANACTIVITIES?"enabled":"disabled"}),i.append(t.planActivitiesItems(n)),t.loadAndShowImagesUsers(t.params.plan.activities)},loadAndShowImagesUsers:function(e){var t=this,i=$.map(e,function(e){return e.userAssigned}),a=function(e){for(var t={},i=[],a=e.length,n=0,r=0;r<a;r+=1){var o=e[r];1!==t[o]&&(t[o]=1,i[n+=1]=o)}return i}(i.concat(bizagi.currentUser.idUser)).join(",");t.getDataUsers(a).then(function(){t.renderUserProfilesAndImages()})},enableEventsOnActivitiesByCurrentContext:function(e){return e===this.CONTEXT_PLANACTIVITIES},initializeSortableList:function(){var e=this;return $(".project-plan-activity-list",e.content).kendoSortable({hint:function(e){var t=e.clone().width(e.width());return $("<ol class='project-plan-activity-list ui-bizagi-wp-nolist'></ol>").append(t)},change:$.proxy(e.onChangePosition,e),disabled:".disabled",end:function(t){t.newIndex<e.fromIndexEnabledSortingActivities&&t.preventDefault()}}).data("kendoSortable")},initializeNotifier:function(){},configureOverviewHeaderHandlers:function(){var e=this;$("#overview-plan .bz-overview-back",e.canvas).off("click").on("click",function(t){t.stopImmediatePropagation(),e.navigator.goHome()}),$(".project-plan-activity-list li",e.content).off("click").on("click",function(t){e.onClickActivity(t)}),$(".summary-plan-section",e.canvas).off("click").on("click",function(t){e.showSummary()})},onClickActivity:function(e){var t=this,i=$(e.currentTarget),a=i.data("name"),n=i.index();t.pane.navigate("#overview-plan");var r=i.data("id");t.params.showContextByMenuDashboard===t.CONTEXT_PLANACTIVITIES&&(t.params.plan.idActivitySelected=r),i.addClass("selected").siblings().removeClass("selected"),t.initViewActivity({name:a}),t.renderEdition(n)},initViewActivity:function(e){var t=this;t.slideFormParams={preview:bizagi.localization.getResource("workportal-project-casedashboard-activity")},t.slideForm=$($.kendoTmpl(t.getTemplate("activity-view"),t.slideFormParams)),$("#paneRender").append(t.slideForm),t.view=new kendo.mobile.ui.View(t.slideForm,{useNativeScrolling:!0}),t.pane=$("#paneRender").data("kendoMobilePane"),t.pane.navigate(t.view.id),t.view.attachedElement=e,t.scrollContent=$("#render-content",t.view.contentElement()),t.configureViewHandlers()},renderEdition:function(e){var t=this;t.params.plan.contextualizedPLan=void 0===t.params.plan.contextualizedPLan||t.params.plan.contextualizedPLan,t.inputEdition=kendo.template(t.getTemplate("activity-preview-tmpl"),{useWithBlock:!1}),t.params.plan.usersMap={},$.when(t.setDataUsers(t.params.plan)).done(function(i){$("#render-content",t.view.content).html(t.inputEdition({plan:t.params.plan,index:e,users:i.assignees})),t.params.plan.activities[e].progress<=33?$(".percent-complete-activity",t.view.content).css({color:"#F5645A"}):t.params.plan.activities[e].progress<=66?$(".percent-complete-activity",t.view.content).css({color:"rgb(238, 184, 104)"}):$(".percent-complete-activity",t.view.content).css({color:"#37B464"})})},setDataUsers:function(e){var t=this,i=[],a=[],n=e.idUserCreator,r=new $.Deferred;a.push({idUser:n,userType:["owner"]}),e.usersMap["-"+n+"-"]={picture:"",id:n,name:"",userType:["owner"]},i.push(n),$.each(e.activities,function(t,r){var o=r.userAssigned;o===n?-1===$.inArray("Assigned",a[0].userType)&&(a[0].userType.push("Assigned"),e.usersMap["-"+n+"-"].userType.push("Assigned")):(e.usersMap["-"+o+"-"]={picture:"",id:o,name:"",userType:["Assigned"]},0===a.filter(function(e){return e.idUser==o}).length&&(a.push({idUser:o,userType:["Assigned"]}),i.push(o)))});var o,s=[],l={},c={},d={userIds:i.join(),width:50,height:50};return $.when(t.dataService.getUsersData(d)).always(function(e){for(var t=0,n=e.length;t<n;t+=1)c[e[t].id]=e[t].name;$.each(a,function(e,t){$.each(t.userType,function(e,t){o?o.types.indexOf(t)<0&&(o.types+=", "+t):o={types:t}});var i={};l[t.idUser]||(l[t.idUser]=!0,i.idUser=t.idUser,i.name=c[t.idUser],s.push(i)),o=void 0}),r.resolve({assignees:s,cvsUsers:i})}),r.promise()},getDataUsers:function(e){var t=this,i=$.Deferred(),a={userIds:e,width:50,height:50};return t.dataService.getUsersData(a).always(function(e){t.userPictures=function(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var a=i+1;a<t.length;++a)t[i]===t[a]&&t.splice(a-=1,1);return t}(t.userPictures.concat(e)),i.resolve()}),i.promise()},renderUserProfilesAndImages:function(){for(var e=this,t=0,i=e.userPictures.length;t<i;t++)$("div[data-iduser='"+e.userPictures[t].id+"'] > label").html(e.userPictures[t].name),e.userPictures[t].picture&&$("div[data-iduser='"+e.userPictures[t].id+"'] img").attr("src","data:image/png;base64,"+e.userPictures[t].picture)},configureViewHandlers:function(){var e=this;$(".bz-render-back",e.slideForm).bind("click",function(){e.goBack()})},goBack:function(){var e=this;e.pane.navigate("#:back"),e.view.destroy(),e.view.element.remove()}}),bizagi.workportal.webparts.overviewPlan.extend("bizagi.workportal.webparts.overviewPlan",{},{showSummary:function(){this.publish("show-plan-summary")}}),bizagi.workportal.webparts.overviewPlan.extend("bizagi.workportal.webparts.overviewPlan",{},{renderViewInit:function(e){this._super(e),bizagi.util.isNativeHeaderEnabled()&&e.view.header.hide()},onClickActivity:function(e){var t=this;t._super(e),bizagi.util.isNativeHeaderEnabled()&&(t.view.header.hide(),bizagiapp.openPlanActivity())}}),
$.Class.extend("bizagi.workportal.webparts.overviewPlan.dataPlan",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e,a.differenceMillisecondsServer=i.differenceMillisecondsServer,a.tools={arrayUnique:function(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var a=i+1;a<t.length;++a)t[i]===t[a]&&t.splice(a--,1);return t}}},getPlanData:function(e){var t=this,i=new $.Deferred;t.data=e,t.data.caseDetails.plan={};var a={idPlan:t.data.caseDetails.idPlan};return $.when(t.callGetPlan(a)).then(function(e){$.extend(t.data.caseDetails.plan,e,{activities:[],users:[]});var a={idPlan:t.data.caseDetails.idPlan};$.when(t.callGetFirstParent(a)).then(function(e){t.data.caseDetails.plan.firstParent=e;var a={idPlan:t.data.caseDetails.idPlan},n={idPlan:t.data.caseDetails.idPlan},r={idPlan:t.data.caseDetails.idPlan};$.when(t.callGetActivitiesPlan(a),t.callGetWorkitemsPlan(n),t.callGetTransitionsByPlan(r)).then(function(e,a,n){var r=e||[];t.mergePropertiesActivitiesWithWorkitems(r,a),t.data.caseDetails.plan.activities=t.calculateActivityStatus(r),r=t.orderActivitiesByTransitions(r,n),t.data.caseDetails.plan.activities=r,i.resolve(t.data.caseDetails.plan)})}).fail(function(){i.reject()})}).fail(function(){i.reject()}),i.promise()},calculateActivityStatus:function(e){var t,i=this;return i.data.currentState&&i.data.currentState.length>0&&(t=i.data.currentState[0].entryDateWorkItem),$.each(e,function(e,a){if(a.status="nodisplay",a.starDate=t,a.estimatedFinishDate){var n=i.getDateServer(),r=a.estimatedFinishDate-a.startDate,o=a.startDate+.33*r,s=a.startDate+.66*r;a.estimatedFinishDate;n<o?a.status="ontime":o<=n&&n<s?a.status="delayed":s<=n&&(a.status="atrisk")}if(a.items){var l=a.items.filter(function(e){return!0===e.resolved});a.numResolvedItems=l.length,a.numTotalItems=a.items.length,a.numTotalItems>0&&(a.progress=Math.floor(a.numResolvedItems/a.numTotalItems*100))}else a.items=[]}),e},orderActivitiesByTransitions:function(e,t){var i=this,a=[];if(0===t.length)a=e,e.length>1&&e.filter(function(e){e.parallel=!0});else{var n=i.orderTransitionsByFromAndTo(t,e);if(activityGuidsInOrder=n.activitiesInOrder,parallelActivitiesHash=n.parallelActivitiesHash,0===activityGuidsInOrder.length)return e;for(var r=0,o=activityGuidsInOrder.length;r<o;r+=1)a=a.concat(e.filter(function(e){return e.id==activityGuidsInOrder[r]&&parallelActivitiesHash[e.id]&&(e.parallel=!0),e.id==activityGuidsInOrder[r]}))}return a},orderTransitionsByFromAndTo:function(e){function t(n){var r=[],o=[],s=!1;if(n.forEach(function(t){var n=i.getTransitionsByFrom(e,t),l=n.length;l>0&&(s=!0,n.forEach(function(e){r.push(e.idActivityFrom),o.push(e.idActivityTo)}),l>1&&o.forEach(function(e){a[e]=!0}))}),s){var c=i.tools.arrayUnique(r.concat(o));l=i.tools.arrayUnique(l.concat(c)),t(o)}}for(var i=this,a={},n=e.map(function(e){return e.idActivityFrom}),r=e.map(function(e){return e.idActivityTo}),o=[],s=0;s<n.length;s+=1)-1===r.indexOf(n[s])&&(o=i.tools.arrayUnique(o.concat([n[s]])));if(0===o.length&&1===activities.length)return{activitiesInOrder:[activities[0].id],parallelActivitiesHash:[]};o.length>1&&o.forEach(function(e){a[e]=!0});var l=[];return t(o),{activitiesInOrder:l,parallelActivitiesHash:a}},getTransitionsByFrom:function(e,t){return e.filter(function(e){return e.idActivityFrom===t})},callGetItemsByActivity:function(e){var t=this,i=$.Deferred();return t.dataService.getItemsByActivity(e).always(function(e,t,a){200===a.status?i.resolve(e):i.reject()}),i.promise()},callGetWorkitemsPlan:function(e){var t=this,i=$.Deferred();return t.dataService.getWorkitemsPlan(e).always(function(e,t,a){200===a.status?i.resolve(e):i.reject()}),i.promise()},callGetPlan:function(e){var t=this,i=$.Deferred();return t.dataService.getPlan(e).always(function(e){200===e.status||201===e.status||void 0===e.status?i.resolve(e):i.reject()}),i.promise()},callGetActivitiesPlan:function(e){var t=this,i=$.Deferred();return t.dataService.getActivities(e).always(function(e,t,a){200===a.status?i.resolve(e):i.reject()}),i.promise()},callGetTransitionsByPlan:function(e){var t=this,i=$.Deferred();return t.dataService.getTransitionsByPlan(e).always(function(e,t,a){200===a.status?i.resolve(e):i.reject()}),i.promise()},getDateServer:function(){return(new Date).getTime()+this.differenceMillisecondsServer},mergePropertiesActivitiesWithWorkitems:function(e,t){e.forEach(function(e){var i=t.filter(function(t){return t.guidActivity==e.id});i.length>0&&$.extend(e,{startDate:i[0].wiEntryDate||null,finishDate:i[0].wiSolutionDate||null,idWorkItem:i[0].idWorkItem,workItemState:i[0].workItemState,idCase:i[0].idCase,estimatedFinishDate:i[0].wiEstimatedSolutionDate||e.estimatedFinishDate})})},callGetFirstParent:function(e){var t=this,i=$.Deferred();return t.dataService.getFirstParentPlan(e).done(function(e){i.resolve(e)}),i.promise()}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.render",{BIZAGI_WORKPORTAL_ACTION_ROUTING:"rounting"},{init:function(e,t,i){var a=this;a.renderingStarted=new $.Deferred,a.navigation=i.navigation,a._super(e,t,i),a.routing=new bizagi.workportal.action.routing(a),a.async=new bizagi.workportal.widget.async(a),a.navigation={},a.isOfflineFormsV2Supported=bizagi.util.isMobileDevice()&&bizagi.util.isOfflineFormsV2Supported(),this.subscribe("showDialog",function(e,t){a.showDialog(t)}),this.subscribe("executeRoutingAction",function(e,t){a.routing.executeRouting(t)})},renderContent:function(e){var t=this,i=$.Deferred(),a=kendo.template(t.getTemplate("render-tmpl"),{useWithBlock:!1});return t.content=$(a({})),t.canvas.append(t.content),t.navigator=new bizagi.workportal.action.navigator,i.resolve(t.content),i.promise()},getGoToInboxOnExitPreference:function(){return!1},isNextButton:function(e){return-1!==["nextWithoutValidations","next"].indexOf(e)},renderForm:function(e){var t=this,i=t.view,a=i.contentElement(),n={},r=t.getGoToInboxOnExitPreference(),o=r&&t.isNextButton(e.buttonPropertiesAction),s=!o||!e.withOutGlobalForm;if(e.allowProperties=bizagi.util.isVersionSupported()&&!(bizagi.util.isTabletDevice()&&e.isOfflineForm),t.rfParams=e,a.empty(),i&&i.footer&&i.footer.empty(),e.withOutGlobalForm)t.validateSendUser2WorkDone(o,e);else{if(void 0===t.rendering){var l=void 0!==t.dataService.serviceLocator.proxyPrefix?t.dataService.serviceLocator.proxyPrefix:"",c={proxyPrefix:l,device:bizagi.util.detectDevice()};bizagi.util.isMobileDevice()&&(c.database=void 0!==t.dataService.database?t.dataService.database:""),t.rendering=new bizagi.rendering.facade(c),t.rendering.subscribe("renderActionButton",function(e,i){t.publish("renderActionButton",{actions:i.actions})}),this.rendering.subscribe("dataNavigation",function(e,t){bizagi.util.isNativePluginSupported()&&!bizagi.util.isiOSTabletDevice()?bizagiapp.dataNavigation({what:"stuffTemplates",displayName:t.data.displayName,params:t}):bizagi.webpart.publish("homeportalShow",{what:"stuffTemplates",title:t.data.displayName,params:t})})}e.mobileAccess=void 0==e.mobileAccess||e.mobileAccess,n=$.extend({},e,{canvas:a,navigation:t.navigation}),(n.hasWorkItems||n.isEvent)&&e.mobileAccess||delete n.idWorkitem,e.hasGlobalForm||e.summaryForm||e.mobileAccess?$.when(t.rendering.execute(n)).then(function(i){if(0===i.buttons.length&&0===i.children.length)t.validateSendUser2WorkDone(o,e);else if(!e.mobileAccess&&!e.summaryForm){var a=bizagi.localization.getResource("render-without-mobileaccess","Accessing this activity is disabled on this device. You can work on it using your desktop");bizagi.showMessageBox(a)}}).fail(function(e){t.publish("error",e)}).always(function(){bizagi.loading.stop()}):(e.messageForm=bizagi.localization.getResource("render-without-mobileaccess","Accessing this activity is disabled on this device. You can work on it using your desktop"),t.showWorkDoneMessage(e))}if(s){var d=$(".km-navbar",t.view.header).data("kendoMobileNavBar");if($(t.view.header).removeClass("sync-error"),e.syncError&&e.isOfflineErrorMode){$(document).off("edit-offline-case-action"),$(document).on("edit-offline-case-action",function(){t.editSyncButtonHandler().bind(t)}),$(document).off("edit-offline-case-action-whitout-confirmation"),$(document).on("edit-offline-case-action-whitout-confirmation",function(e,i){t.editSyncButtonAction().bind(t)}),$(t.view.header).addClass("sync-error"),$(".sync-error-btn-edit",t.view.header).off("click"),$(".sync-error-btn-edit",t.view.header).on("click",function(){t.editSyncButtonHandler().bind(t)}),$(".sync-error-btn-again",t.view.header).off("click"),$(".sync-error-btn-again",t.view.header).on("click",function(){t.retrySyncButtonHandler()});var u="business"==e.syncError.type?"workportal-offline-business-sync-error":"workportal-offline-technical-sync-error";$(".nav-subtitle",t.view.header).text(bizagi.localization.getResource(u)),t.unsubscribe("retry-sync-single-offline-case"),t.subscribe("retry-sync-single-offline-case",function(){t.retrySyncButtonHandler()})}var p;p=void 0!==e.displayName&&null!==e.displayName?e.displayName:e.radNumber||e.idCase,d.title(p),"#renderSplitView"!==bizagi.kendoMobileApplication.view().id&&bizagi.kendoMobileApplication.navigate("#renderSplitView"),t.initCaseFolder({element:d.element,params:e}),$("#paneRender",t.content).data("kendoMobilePane").navigate("#render","slide:left"),t.view.scroller&&t.view.scroller.reset()}},initCaseFolder:function(e){this.publish("case-properties-init",e)},postRender:function(){var e=this;e.view=new kendo.mobile.ui.View($("#render",e.content),{useNativeScrolling:!0}),e.navigation=new bizagi.workportal.action.navigation(e);e.workportalFacade.executeWebpart({webpart:"startForm",canvas:$("#startForm",e.content)});e.configureHandlers(),e.setButtonsHandler()},validateSendUser2WorkDone:function(e,t){var i=this;e?i.goHomePortal():i.showWorkDoneMessage(t)},showWorkDoneMessage:function(e){var t=this,i=t.view.contentElement(),a=t.getTemplate("info-message-go-to-inbox"),n=e.messageForm||t.resources.getResource("render-without-globalform"),r=!1;if(void 0!==e&&(r=void 0!==e.isOfflineForm&&bizagi.util.parseBoolean(e.isOfflineForm)),r){var o=e.idWorkitem&&!Array.isArray(e.idWorkitem)?"next":null;n=bizagi.util.getMessageFromNetworkState(t.dataService.online,o)}var s=$.kendoTmpls(a,{message:n});i.html(s),$(".ui-bizagi-info-message-button-go-to-inbox",i).click(function(){t.goHomePortal()})},configureHandlers:function(){var e=this,t=e.view.contentElement(),i=$.Deferred();e.subscribe("render-case",function(t,a){return bizagi.loading.start(),$.when(e.workportalFacade.modules[e.workportalFacade.Class.render_module]).then(function(){if(e.navigation.resetParams(),bizagi.util.isEmpty(a.idCase))return console.warn("Se requiere el id del caso 'idCase' para poder renderizar la forma"),null;if(bizagi.util.isEmpty(a.idWorkitem))return e.routing.executeRouting({action:"routing",buttonPropertiesAction:a.buttonPropertiesAction,idCase:a.idCase,hasStartForm:a.hasStartForm||!1}),null;if(a.online=e.dataService.online,e.isOfflineFormsV2Supported&&a.forceOffline&&bizagi.util.isOfflineExecutionSupportedInCurrentEnvironment()&&e.dataService.online){a.isOfflineForm=!0,a.isOpen=!0,a.offlineType="task";var t=a.idCase+"-"+a.idWorkitem;return $.when(e.dataService.database.validateLocalDataForTaskExists(t)).then(function(t){t&&(a.isEdited=!0);var i=$.extend({executeOfflineEntryPipeline:!0},a);return $.when(e.dataService.downloadActivityOnDemand(i))}).then(function(t){return a.alreadyMarkedAsActive=!0,$.when(e.renderForm(a)).then(function(){if(t.hasEntryPipeline&&!1===t.wasPipelineExecuted){var i=bizagi.localization.getResource("workportal-force-offline-pipeline-error-message","This form has not been updated due to an error executing an automatic action while it was opening. You can continue working normally on the latest downloaded version of the form, or try to open it again from the Inbox"),a=[{label:bizagi.localization.getResource("workportal-general-word-continue"),action:"resolve"},{label:bizagi.localization.getResource("workportal-go-to-inbox"),action:"reject"}];setTimeout(function(){$.when(bizagi.showConfirmationBox(i,"Bizagi","",a)).fail(function(){e.goBack()})},100)}})}).fail(function(t){return console.error("FORCE OFFLINE => downloadActivityOnDemandError",t),e.renderForm(a)})}return e.renderForm(a)}).then(function(){i.resolve()}).fail(function(){i.reject()}).always(function(){bizagi.loading.stop()}),i.promise()}),$(".bz-render-back",e.view.header).bind(e.Class.BIZAGI_TAP_EVENT,function(){e.goBack()}),t.bind("routing",function(t,i){var a={idCase:e.rfParams.idCase,fromTask:e.rfParams.fromTask||e.rfParams.idTask,fromWorkItemId:e.rfParams.fromWorkItemId||e.rfParams.idWorkitem,isOfflineForm:e.rfParams.isOfflineForm||!1,formsRenderVersion:e.rfParams.formsRenderVersion};a=$.extend(a,i),e.refreshTemplate(),e.routing.executeRouting(a),e.publish("bz-update-list-cases",{updateDataList:!0})}),t.bind("errorform",function(t){e.publish("error",t)})},goHomePortal:function(){var e=this;bizagi.kendoMobileApplication.navigate("homePortal"),e.publish("bz-update-list-cases",{updateDataList:!0}),e.homePortalFramework&&"syncErrors"===e.homePortalFramework.destination&&e.publish("bz-update-list-sync-errors-cases")},refreshTemplate:function(){var e=this;if(e.homePortalFramework.accumulatedContext.length>0){var t=e.homePortalFramework.accumulatedContext.length-1,i=e.homePortalFramework.accumulatedContext[t],a={data:i,calculateFilters:i.calculateFilters||!1,filters:[],eventType:"DATA-NAVIGATION"};bizagi.webpart.publish("homeportalShow",{what:"stuffTemplates",title:a.data.displayName||"",params:a,preventNavigate:!0})}},goBack:function(){var e=this;$.when(bizagi.util.autoSave()).done(function(){$(document).data("auto-save","")}).always(function(){e.refreshTemplate(),bizagi.kendoMobileApplication.replace("#homePortal","slide:right"),e.homePortalFramework&&"syncErrors"===e.homePortalFramework.destination&&e.publish("bz-update-list-sync-errors-cases"),e.dataService.showTaskFeed(),$(document).trigger("disposeForm"),$(document).off("online.form"),$(document).off("offline.form"),$(document).off("offline-notify-form-sync-event"),$(".sync-error-btn-edit",e.view.header).off("click"),$(".sync-error-btn-again",e.view.header).off("click")})},showDialog:function(e){var t=this,i=new bizagi.workportal.widget.dialog(t);return i.renderDialog(e),i},setButtonsHandler:function(){},editSyncButtonHandler:function(){var e=this,t=bizagi.localization.getResource("workportal-offline-sync-error-edit-case-title"),i=bizagi.localization.getResource("workportal-offline-sync-error-edit-case-explanation");bizagi.util.isMobileDevice()&&bizagi.util.isCordovaSupported()?bizagi.showSimpleConfirmationBox(i,t,[bizagi.localization.getResource("confirmation-savebox-cancel"),t]).then(function(t){2==t&&e.editSyncButtonAction()}):bizagi.showConfirmationBox(i,t,"",[{label:bizagi.localization.getResource("confirmation-savebox-cancel"),action:"reject"},{label:t,action:"resolve"}]).then(e.editSyncButtonAction.bind(e))},editSyncButtonAction:function(){var e=$.extend({},this.rfParams);e.isOfflineErrorMode=!1,e.isOpen=!0,e.isEdited=!0,e.removeSyncErrorOnSubmit=!0,e.showToastOnSuccessSync=!0,this.renderForm(e)},retrySyncButtonHandler:function(){var e=this;if(!e.dataService.online)return void bizagi.util.showMobileToast({type:"error",message:bizagi.localization.getResource("workportal-offline-sync-failed-no-internet")});var t=$.Deferred(),i=$.extend({deferred:t},e.rfParams);bizagi.loading.start(),$(document).trigger("retrySyncCase.offline",i),t.then(function(){bizagi.util.showMobileToast({type:"success",message:bizagi.localization.getResource("workportal-offline-sync-success")}),e.goBack()}).fail(function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){console.error("Parsing error",t)}var i=t._internalSyncError||{};bizagi.util.isEmpty(i)&&(i.type="technical");var a=$.extend({},e.rfParams);a.hasSyncError=!0,a.syncError=t._internalSyncError||t,void 0!=a.syncError&&"business"!=a.syncError.type&&(delete a.syncError.message,bizagi.util.showMobileToast({type:"error",message:bizagi.localization.getResource("workportal-offline-sync-failed")})),e.renderForm(a)}).always(bizagi.loading.stop)}}),bizagi.workportal.webparts.render.extend("bizagi.workportal.webparts.render",{BIZAGI_NATIVE_COMPONENT_HOMEPORTAL:"homeportal",BIZAGI_NATIVE_COMPONENT_RENDER:"render"},{init:function(e,t,i){var a=this;a._super(e,t,i),this.subscribe("updateRenderEndPoints",function(e,t){a.rendering&&a.rendering.dataService&&a.rendering.dataService.serviceLocator&&a.rendering.dataService.serviceLocator.setProxyPrefix(t)}),this.subscribe("updateWorkportalEndPoints",function(e,t){a.workportalFacade&&a.workportalFacade.dataService&&a.workportalFacade.dataService.serviceLocator&&(bizagi.util.featureObjectCache=void 0,a.workportalFacade.dataService.serviceLocator.setProxyPrefix(t))})},goHomePortal:function(){var e=this;bizagi.getNativeComponent()!==e.Class.BIZAGI_NATIVE_COMPONENT_HOMEPORTAL?(bizagi.kendoMobileApplication.navigate("#:back"),bizagiapp.workPortalBack()):bizagi.kendoMobileApplication.navigate("#:back"),e.publish("bz-update-list-cases",{updateDataList:!0})},goBack:function(){var e=this;if(bizagi.getNativeComponent()!==e.Class.BIZAGI_NATIVE_COMPONENT_HOMEPORTAL)bizagi.kendoMobileApplication.navigate("#:back"),bizagiapp.workPortalBack();else{if(e.homePortalFramework.accumulatedContext.length>0){var t=e.homePortalFramework.accumulatedContext.length-1,i=e.homePortalFramework.accumulatedContext[t];e.homePortalFramework.popContext();var a={data:i,calculateFilters:i.calculateFilters||!1,filters:[],eventType:"DATA-NAVIGATION"};bizagi.webpart.publish("homeportalShow",{what:"stuffTemplates",title:a.data.displayName||"",params:a,preventNavigate:!0})}bizagi.kendoMobileApplication.replace("#homePortal"),e.publish("bz-update-list-cases",{updateDataList:!0})}},renderForm:function(e){var t=this;bizagi.util.isiOSDevice()&&bizagi.util.isNativeHeaderEnabled()&&t.routing&&t.routing.params&&e.idCase!=t.routing.params.idCase?bizagiapp.openRenderElement({idCase:e.idCase,idTask:e.idTask,idWorkitem:e.idWorkitem}):t._super(e)},postRender:function(){var e=this;if(e.view=new kendo.mobile.ui.View($("#render",e.content),{useNativeScrolling:!0}),e.navigation=new bizagi.workportal.action.navigation(e),bizagi.util.getNativeComponent()==e.Class.BIZAGI_NATIVE_COMPONENT_RENDER||!bizagi.util.isNativeHeaderEnabled()){e.workportalFacade.executeWebpart({webpart:"startForm",canvas:$("#startForm",e.content)})}e.configureHandlers(),e.setButtonsHandler(),bizagi.util.isNativeHeaderEnabled()&&e.view.header.hide()},showWorkDoneMessage:function(e){this._super(e),bizagi.util.isNativeHeaderEnabled()&&bizagiapp.setFormButtons([],-1,-1,!0)}}),bizagi.workportal.webparts.render.extend("bizagi.workportal.webparts.render",{},{postRender:function(e){var t=this;return $.when(t._super(e)).then(function(){return t.workportalFacade.executeWebpart({webpart:"caseProperties",canvas:$("#paneRender",t.content),navigator:t.navigator}),t.workportalFacade.executeWebpart({webpart:"discussionCase",canvas:$("#paneRender",t.content),navigator:t.navigator}),t.workportalFacade.executeWebpart({webpart:"files",canvas:$("#paneRender",t.content),navigator:t.navigator}),t.workportalFacade.executeWebpart({webpart:"overviewPlan",canvas:$("#paneRender",t.content),navigator:t.navigator})})},setButtonsHandler:function(){}}),bizagi.workportal.webparts.render.extend("bizagi.workportal.webparts.render",{},{setButtonsHandler:function(){bizagi.util.isNativeHeaderEnabled()||this._super()},modalViewDidAppear:function(){bizagi.util.isNativeHeaderEnabled()&&bizagiapp.modalViewDidAppear()},modalViewDidDisappear:function(){bizagi.util.isNativeHeaderEnabled()&&bizagiapp.modalViewDidDisappear()},renderForm:function(e){this._super(e),bizagi.util.isNativeHeaderEnabled()&&e.withOutGlobalForm&&bizagiapp.processDidEnd()}}),$.Class.extend("bizagi.workportal.action.routing",{},{init:function(e){var t=this;t.dataService=e.dataService,t.resources=e.resources,t.getResource=e.getResource,t.controller=e,t.controller.subscribe("changeCase",function(e,i){t.executeRouting(i)})},executeRouting:function(e){var t=this,i=$.Deferred();return bizagi.loading.start(),t.params=e||{},void 0!==e.hasStartForm&&e.hasStartForm?$.when(t.controller.publish("render-case",e)).done(function(){i.resolve()}).fail(function(){i.reject()}).always(function(){bizagi.loading.stop()}):$.when(t.dataService.routing.getRoute(e)).then(function(e){switch(e=e||{},void 0!==t.params.isOfflineForm&&t.params.isOfflineForm?e.moduleParams=$.extend(e.moduleParams,{formsRenderVersion:t.params.formsRenderVersion,isOfflineForm:t.params.isOfflineForm,idCase:t.params.idCase,idWorkitem:t.params.idWorkitem,isEdited:t.params.isEdited,isOpen:t.params.isOpen,offlineType:t.params.offlineType})||{}:e.moduleParams=e.moduleParams||{},""!==e.moduleParams.displayName&&void 0!==e.moduleParams.displayName||!(t.params.workItems&&t.params.workItems.length>0||t.params.displayName)||(e.moduleParams=$.extend(e.moduleParams,{displayName:t.params.displayName||t.params.workItems[0].displayName})),e.module){case bizagi.workportal.webparts.webpart.BIZAGI_WORKPORTAL_WEBPART_RENDER:var i=bizagi.clone(e.moduleParams);return i.buttonPropertiesAction=t.params.buttonPropertiesAction,$.when(t.controller.publish("render-case",i));case bizagi.workportal.webparts.webpart.BIZAGI_WORKPORTAL_WEBPART_ASYNC:return $.when(t.controller.publish("render-async",e.moduleParams));case bizagi.workportal.webparts.webpart.BIZAGI_WORKPORTAL_WEBPART_ROUTING:var a={title:t.getResource("workportal-widget-routing-window-selector"),width:670,height:400,onClose:e.moduleParams.onClose,isSummaryModal:t.params.isSummaryModal};t.controller.publish("showDialog",{widgetName:bizagi.workportal.webparts.webpart.BIZAGI_WORKPORTAL_WEBPART_ROUTING,data:e.moduleParams.data,modalParameters:a,onClose:a.onClose})}}).done(function(){i.resolve()}).fail(function(){i.reject()}).always(function(){bizagi.loading.stop()}),i.promise()}}),$.Class.extend("bizagi.workportal.action.navigator",{},{init:function(){var e=this;e._pivot="_",bizagi.util.mobility.renderSplitViewInit=$.proxy(e.renderSplitViewInit,e)},renderSplitViewInit:function(e){var t=this;t.splitView=e.view,t.pane=$("#paneRender",e.view.element).data("kendoMobilePane")},navigate:function(e,t){var i=this,t=t||{};void 0===i.start_page&&(i.start_page=i.pane.history[i.pane.history.length-1]),t.reset&&(i.reset(),i.start_page=e),i.pane.navigate(e)},goBack:function(){var e=this;e.pane=e.pane?e.pane:$("#paneRender").data("kendoMobilePane"),e.pane.navigate("#:back")},goHome:function(){var e=this;e.reset(),e.pane.navigate(e.start_page)},reset:function(){var e=this;e.pane.history.splice(1,e.pane.history.length-1)}}),bizagi.workportal.action.navigator.extend("bizagi.workportal.action.navigator",{},{init:function(){var e=this;e._super(),bizagi.webpart.subscribe("RenderNavigate",function(t,i){"home"==i?e.goHome():"back"==i?e.goBack():"autosave"==i?(document.activeElement.blur(),$.when(bizagi.util.autoSave()).done(function(){bizagiapp.formAutoSavePerformed()})):$("#paneRender").data("kendoMobilePane").view().destroy()})}}),$.Class.extend("bizagi.workportal.action.navigation",{PRIORITY_UNDEFINED:-1,PRIORITY_PRIMARY:1,PRIORITY_SECONDARY:2,PRIORITY_LIST:["next","save","validate","nextWithoutValidations","createnewcase","search","select","add",""]},{_useFloatingButtons:!1,_useFormButtons:!1,_containers:{},_forms:{},init:function(e){var t=this,i=bizagi.util.isCordovaSupported()&&bizagi.util.isAndroidDevice()&&bizagi.util.getAndroidVersion()<4.4;t.controller=e,t.view=t.controller.view,t.$pane=t.view.wrapper.closest("[data-role='pane']"),t.navBar=$(".km-navbar",t.view.header).data("kendoMobileNavBar"),t.start_page="#render",t._useFloatingButtons=bizagi.override.enableMfb&&!i,t._useFormButtons=bizagi.override.enableFormButtons},resetParams:function(){this.navBar.title(""),$(".bz-render-dynamic",this.navBar.element).hide()},createRenderContainer:function(e){var t=this;e=e||{},e.view=e.view||{},e.view.zoom=!!e.view.zoom,e.view.useNativeScrolling=void 0===e.view.useNativeScrolling||e.view.useNativeScrolling,e.view.useNativeScrolling=!e.view.zoom&&e.view.useNativeScrolling;var i=$.now(),a="render-edition-"+i,n=$.kendoTmpls(t.controller.getTemplate("renderEdition-tmpl"),{viewId:a,title:e.title||"",zoom:e.view.zoom});t.setContainerParams(e),t.$pane.append(n);var r=new kendo.mobile.ui.View(n,{zoom:e.view.zoom,useNative:e.view.useNativeScrolling,useNativeScrolling:e.view.useNativeScrolling});r._destroy=r.destroy,r.destroy=function(){this._destroy();var e,i=t._containers[a];if(i){if(void 0!==i.previousViewId){var n=t.$pane.data("kendoMobilePane"),r=i.animation||"slide";n.replace(i.previousViewId,r+" reverse");var o=i.previousViewId.replace("#","");if(void 0!==t._containers[o]?(t.setContainerParams(t._containers[o].originalParams),t.setNavigationButtons(t._containers[o].form,t._containers[o].id),e=t._containers[o].form):(t.setNavigationButtons(t.form),e=t.form),r)var s=this.element,l=setTimeout(function(){s.remove(),clearTimeout(l)},1e3);else this.element.remove()}var c=e.getParams()||{},d=$.extend([],c.selectedSection);e.setParam("selectedSection",[]),d.forEach(function(t){var i=e.getRenderById(t);void 0!==i&&i.triggerHandler("reopenSection")}),delete t._containers[a]}};var o={id:a,element:r.contentElement(),originalParams:e,destroy:function(){r.destroy()},setNavigationButtons:function(e){t.setNavigationButtons(e,this.id)}};return t._containers[a]=$.extend(o,{view:r}),$(".bz-render-back",r.header).bind("click",function(){var e=jQuery.Event("close",{});o.element.trigger(e),e.isDefaultPrevented()||r.destroy()}),o},setContainerParams:function(e){},navigate:function(e,t){var i=this._containers[e];if(i){var a=this.$pane.data("kendoMobilePane");"#"+e!==a.view().id&&(i.previousViewId=a.view().id,i.animation=t||"slide",a.replace(i.id,i.animation))}},getView:function(e){return this._containers&&this._containers[e]?this._containers[e]:void 0},goToStartPage:function(e){var t=this;t.$pane.data("kendoMobilePane").navigate(t.start_page,"slide:reverse"),t.form&&t.form.failHandler(e),(Object.keys(t._containers)||[]).reverse().forEach(function(e){t.getView(e).destroy(),delete t._containers[e];var i=$("#"+e);i&&i.length&&i.remove()})},setNavigationButtons:function(e,t){var i=this,a={};if(!(e&&e.originalProperties&&e.originalProperties.uniqueId))throw new Error("This method always requires a form as param");if(void 0!==t?i._containers[t].form=e:i.form=e,i.changeButtonVisibilityByContainer(e),e.properties&&e.properties.editable&&!e.properties.displayAsReadOnly&&e.buttons&&e.buttons.length>0){a=e.properties;var n=e.buttons&&e.buttons.length?e.buttons:a.buttons||[],r=void 0!==t?i.getView(t).view:i.view;n.length>0&&i.isFormButtonsEnabled()?i.initFormButton(e,n,r):n.length>0&&i.isFloatingButtonsEnabled()?i.initFloatingButton(e,n):i.initActionSheet(e,n)}},initActionSheet:function(e,t){var i=this;$(".bz-render-dynamic",i.navBar.element).show().actionSheet({setDataToShow:function(){for(var e=[],i=0,a=t.length;i<a;i++)t[i].guid=t[i].ordinal,t[i].displayName=t[i].caption,t[i].visible=!1!==bizagi.util.parseBoolean(t[i].visible),t[i].visible&&e.push(t[i]);return e},actionClicked:function(t){i.processButton(t.guid,e)}})},initFloatingButton:function(e,t){for(var i=this,a=[],n={save:"mo-icon bz-save-thin",add:"mo-icon bz-plus",search:"mo-icon bz-search",select:"mo-icon bz-checked",next:"mo-icon bz-arrow-right-thin",validate:"mo-icon bz-test",createnewcase:"mo-icon bz-save-thin","default-icon":"mo-icon bz-process"},r=0,o=t.length;r<o;r++){var s={};s.id=t[r].id,s.label=t[r].caption,s.link=t[r].ordinal,s.icon=n[t[r].action]?n[t[r].action]:n["default-icon"],s.slideType="",s.visible=!1!==bizagi.util.parseBoolean(t[r].visible),"back"!==t[r].action&&"cancel"!==t[r].action&&s.visible&&a.push(s)}a.length>0&&$(e.container).mfb({restingIcon:a.length>=1?"mo-icon bz-show-actions":"mo-icon "+a[0].icon.replace(/-thin$/,"-bold"),activeIcon:"mo-icon bz-cancel",activePrincipalButton:1,buttons:a,click:function(t,n){setTimeout(function(){n.principal&&1===a.length?i.processButton(a[0].link,e):i.processButton(n.link,e)},400)}})},processButton:function(e,t){if(t.allowOnlineActions()){var i=t.buttons.find(function(t){return t.ordinal===e});i.callback?i.callback():t.processButton(i)}else{var a=bizagi.localization.getResource("workportal-login-network-error","The internet connection appears to be offline. Please verify and try again.");bizagi.showMessageBox(a,"info",!1)}},modalViewDidAppear:function(){},modalViewDidDisappear:function(){},changeButtonVisibilityByContainer:function(e){e&&e.container&&($(".ui-bizagi-container-children-form",e.container).addClass("ui-bizagi-form-no-buttons"),$(".ui-bizagi-button-container, .ui-bizagi-container-button-edit",e.container).hide())},isFloatingButtonsEnabled:function(){return this._useFloatingButtons},isFormButtonsEnabled:function(){return this._useFormButtons},initFormButton:function(e,t,i){var a=this,n=t.filter(function(e){return!["back","cancel"].includes(e.action)&&!1!==bizagi.util.parseBoolean(e.visible)}).map(function(e){return{id:e.id,action:e.action,quickAction:!0===bizagi.util.parseBoolean(e.quickAction),additional:!1,label:e.caption,ordinal:e.ordinal,priority:a.Class.PRIORITY_SECONDARY,visible:!1!==bizagi.util.parseBoolean(e.visible),ranked:!1}}),r=i.footer;n.length>0?r&&r.formButtons({buttons:a.getListWithPriority(n),click:function(t,i){a.processButton(i.ordinal,e)}}):r.has(".bz-form-buttons")&&r&&r.formButtons({})},getListWithPriority:function(e){var t=this,i=bizagi.clone(e),a=0,n=t.findPriorityAction(i,0);if(n!==t.Class.PRIORITY_UNDEFINED&&(i[n].priority=t.Class.PRIORITY_PRIMARY,i[n].ranked=!0,a++),1===i.length)return i;var r=t.findButtonPositionByAction(i,"save");return r!==t.Class.PRIORITY_UNDEFINED&&(i[r].priority=t.Class.PRIORITY_SECONDARY,i[r].ranked=!0,a++),i.forEach(function(e){e.ranked||(e.priority=++a,e.ranked=!0,e.additional=i&&i.length>2)}),bizagi.util.sortJSON(i,"priority","desc"),i},findPriorityAction:function(e,t){var i=this.Class.PRIORITY_LIST,a=e.findIndex(function(e){return e.action===i[t]&&!e.ranked&&!e.quickAction});return a!==this.Class.PRIORITY_UNDEFINED?a:this.findPriorityAction(e,++t)},findButtonPositionByAction:function(e,t){this.Class.PRIORITY_UNDEFINED;return e.findIndex(function(e){return e.action===t&&!e.ranked&&!e.quickAction})}}),bizagi.workportal.action.navigation.extend("bizagi.workportal.action.navigation",{},{setNavigationButtons:function(e,t){var i=this;if(!bizagi.util.isNativeHeaderEnabled()||void 0!==e.properties.editionForm&&1!=e.properties.editionForm)i._super(e);else{if(i.changeButtonVisibilityByContainer(e),!(e&&e.originalProperties&&e.originalProperties.uniqueId))throw new Error("This method always requires a form as param");if(void 0!==t?(e.isMainForm=!1,i._containers[t].form=e):(e.isMainForm=!0,i.form=e),e.properties&&e.properties.editable&&!e.properties.displayAsReadOnly){var a=e.originalProperties?e.originalProperties.uniqueId:null,n=e.isMainForm;if(a){var r=e.params&&e.params.idWorkitem?parseInt(e.params.idWorkitem):-1,o=e&&e.buttons&&e.buttons.length>0;if(bizagi.util.isNativePluginSupported()&&bizagiapp.setFormButtons&&o){for(var s=e.buttons&&e.buttons.length?e.buttons:e.properties.buttons||[],l=[],c=0,d=s.length;c<d;c++){var u=!1!==bizagi.util.parseBoolean(s[c].visible);u&&l.push({guid:s[c].ordinal,displayName:s[c].caption,action:s[c].action,visible:u})}e.callbackButtons=function(t){if(e.allowOnlineActions()){var o=$.parseJSON(t),s=e.buttons.find(function(e){return e.ordinal===o.guid});s.callback?$.when(s.callback()).fail(function(){i.setFormButtons(l,a,r,n,e)}):e.processButton(s).fail(function(t){i.setFormButtons(l,a,r,n,e)})}else{var c=bizagi.localization.getResource("workportal-login-network-error","The internet connection appears to be offline. Please verify and try again.");bizagi.showMessageBox(c,"info",!1)}},bizagiapp.setFormButtons(l,a,r,n,e.callbackButtons.bind(e))}else bizagiapp.setFormButtons([],a,r,n,null)}}else{
var a=e.originalProperties?e.originalProperties.uniqueId:null,r=e.params&&e.params.idWorkitem?parseInt(e.params.idWorkitem):-1,n=e.isMainForm;bizagiapp.setFormButtons([],a,r,n)}}},createRenderContainer:function(e){var t=this._super(e);return bizagi.util.isNativeHeaderEnabled()&&t.view.header.hide(),t},setContainerParams:function(e){this._super(e),bizagi.util.isNativeHeaderEnabled()&&bizagiapp.setRenderEdition({title:e.title})},modalViewDidAppear:function(){bizagi.util.isNativeHeaderEnabled()&&bizagiapp.modalViewDidAppear()},modalViewDidDisappear:function(){bizagi.util.isNativeHeaderEnabled()&&bizagiapp.modalViewDidDisappear()},setFormButtons:function(e,t,i,a,n){var r=n&&n.validationController&&n.validationController.isExpandedNotificationBox&&n.validationController.isExpandedNotificationBox();bizagiapp.setFormButtons(e,t,i,a,n.callbackButtons.bind(n)),r&&bizagiapp.modalViewDidAppear()}}),$.Class.extend("bizagi.workportal.widget.dialog",{},{init:function(e){this.webpart=e},renderDialog:function(e){var t=this,i=new $.Deferred,a=new bizagi.workportal.widget.routing(t.webpart);a.renderContent(e);var n=kendo.template(t.webpart.getTemplate("dialog-tmpl"),{useWithBlock:!1}),r=n({content:a.getContent()});return t.modal=new kendo.mobile.ui.ModalView(r,{close:function(){this.destroy(),this.element.remove(),i.resolve()},modal:!0}),a.configureHandlers(i,t.modal),t.modal.open(),i.promise()}}),$.Class.extend("bizagi.workportal.widget.routing",{},{init:function(e){var t=this;t.webpart=e,t.content=""},renderContent:function(e){var t=this,i=t.webpart.workportalFacade.getTemplate("routing-tmpl"),a=kendo.template(i,{useWithBlock:!1}),n=a(e);return t.setContent(n),t.getContent()},configureHandlers:function(e,t){var i=this,a=t.contentElement();$("tr:nth-child(even)",a).addClass("event"),$("#ui-bizagi-wp-app-routing-activity-wf .bz-wp-routing-action",a).on("click",function(){var a=$(this).closest(".bz-wp-routing-item").data("item"),n={idCase:a.idCase||0,idWorkitem:a.idWorkItem||0,idTask:a.idTask||0,taskName:a.displayName||"",displayName:a.displayName,radNumber:a.radNumber||0,hasWorkItems:!bizagi.util.isEmpty(a.idWorkItem),mobileAccess:!!bizagi.util.isEmpty(a.mobileAccess)||a.mobileAccess,hasGlobalForm:!0===bizagi.util.parseBoolean(a.hasGlobalForm),forceOffline:!0===a.forceOffline};bizagi.util.isEmpty(a.idWfClass)||(n.idWfClass=a.idWfClass),i.showWorkitem(n),t.close(),e.resolve()}),$(".wp-routing-container-footer button",a).one("click",function(){t.close(),$(this).hasClass("summary-modal")||i.goHomeportal(),e.resolve()})},goHomeportal:function(){bizagi.kendoMobileApplication.navigate("homePortal"),self.publish("bz-update-list-cases",{updateDataList:!0})},showWorkitem:function(e){var t=this,i={idCase:e.idCase,idWorkitem:e.idWorkitem,idTask:e.idTask,taskName:e.taskName,displayName:e.displayName,radNumber:e.radNumber,hasWorkItems:e.hasWorkItems,mobileAccess:e.mobileAccess,hasGlobalForm:e.hasGlobalForm,forceOffline:e.forceOffline};bizagi.util.isEmpty(e.idWfClass)||(i.idWfClass=e.idWfClass),this.getOfflineTaskSyncError(i).then(function(e){e&&t.includeSyncErrorIntoRenderCaseparams(i,e)}).always(function(){bizagi.webpart.publish("render-case",i)})},getContent:function(){return this.content},setContent:function(e){this.content=e},getOfflineTaskSyncError:function(e){if(!bizagi.util.isOfflineErrorsViewSupported())return $.Deferred().resolve(void 0).promise();var t=$.Deferred(),i=$.extend({deferred:t},e);return bizagi.webpart.publish("routing-get-offline-task-sync-error",i),t},includeSyncErrorIntoRenderCaseparams:function(e,t){e.hasSyncError=!0,e.syncError=t,e.offlineType="task",e.idEdited=!0,e.isOfflineForm=!0,e.isOfflineErrorMode=!0}}),bizagi.workportal.widget.routing.extend("bizagi.workportal.widget.routing",{},{goHomeportal:function(){bizagiapp.workPortalBack()}}),$.Class.extend("bizagi.workportal.widget.async",{ASYNC_CHECK_TIMER:3e3},{init:function(e){var t=this;t.webpart=e,t.configureHandlers()},configureHandlers:function(){var e=this.webpart,t=this;e.subscribe("render-async",function(i,a){t.executeAsync(a).done(function(){e.publish("changeCase",{action:bizagi.workportal.webparts.webpart.BIZAGI_WORKPORTAL_WEBPART_ROUTING,idCase:a.idCase})})})},executeAsync:function(e){var t=this,i=new $.Deferred,a=kendo.template(t.webpart.getTemplate("async-tmpl"),{useWithBlock:!1}),n=a(e);return t.modal=new kendo.mobile.ui.ModalView(n,{close:function(){this.destroy(),this.element.remove()},modal:!0}),$(".ui-bizagi-async-close",t.modal.element).bind("click",function(){t.modal.close(),bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSDevice()&&bizagi.util.isSmartphoneDevice()&&bizagiapp.workPortalBack()}),t.modal.open(),t.checkAsycnExecutionState(i,e),i.promise()},checkAsycnExecutionState:function(e,t){var i=this.webpart,a=this;$.when(i.dataService.getAsynchExecutionState({idCase:t.idCase})).done(function(i){"Error"==i.state&&void 0!==i.errorMessage&&($("#modalview-async-message",a.modal.element).height(130),$(".ui-bizagi-wp-async-error",a.modal.element).show(),$(".ui-bizagi-wp-waiting-message",a.modal.element).hide(),$(".ui-bizagi-wp-async-error-txt",a.modal.element).html(i.errorMessage||bizagi.localization.getResource("render-async-error"))),"Processing"==i.state?0===i.errorMessage.length&&setTimeout(function(){a.checkAsycnExecutionState(e,t)},bizagi.workportal.widget.async.ASYNC_CHECK_TIMER):"Finished"==i.state&&(a.modal.close(),e.resolve())})}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.renderTemplates",{PAGE_SIZE:10},{init:function(e,t,i){var a=this;a._super(e,t,i),a.actionsEvents=new bizagi.actionsEvents(t,"Entities",{homePortalFramework:a.homePortalFramework}),a.renderTemplatesGrid=kendo.template(a.getTemplate("render-templates-list"),{useWithBlock:!1}),a.renderTemplatesItem=kendo.template(a.getTemplate("render-templates-item"),{useWithBlock:!1}),a.renderTemplatesActions=kendo.template(a.getTemplate("render-templates-actions"),{useWithBlock:!1}),a.currentPage=1,a.totalPages=0,a.selectedItems=[],a.entityCollection=[],a.tEnginePromise,a.updated=!1},renderContent:function(){return this.renderTemplatesGrid({})},postRender:function(){var e=this;e.subscribe("homeportalShow-stuffTemplates",$.proxy(e.onTriggerTemplate,e)),e.subscribe("update-Templates",function(t,i){e.updated&&e.updateData.bind(e)(t,i||{})}),e.canvas.bind("view-initialized",$.proxy(e.onAfterViewInitialized,e)),e.configureHandler()},onTriggerTemplate:function(e,t){var i=this;t.refresh&&t.surrogateKey?i.refreshRegister(e,t):(t.guidSearch||t.data&&!t.data.reference||i.homePortalFramework.navigateFromRender?i.setActionButton(!1,[]):i.getProcessAddAction(t),$.when(i.renderSortBar(t)).done(function(){$.extend(t,{page:1}),i.updateData(e,t)}))},configureHandler:function(){var e=this;bizagi.webpart.subscribe("newData",function(){e.actionsEvents.processAddAction(e.action)})},updateData:function(e,t){var i,a,n=this;n.updated=!0,n.removeGroupingBar();var r=n.canvas.data("kendoMobileView");if(r){var o=n.canvas.data("kendoMobileView").contentElement();if(n._referrer=n.getReferrer(t),n._totalRecords=t.totalRecords,n._filters=t.filters||n._filters,n._guidSearch=t.guidSearch||n._guidSearch,void 0===t.calculateFilters||t.calculateFilters?(i=-1,a=-1,n._page=t.page||n._page):(i=t.pageSize*n._page,a=1),void 0!==t.data){var s=t.data;n._dataNavigation=s||n._dataNavigation,n._reference=s.reference||n._reference,n._surrogateKey=s.surrogateKey||n._surrogateKey,n._referenceType=s.referenceType||n._referenceType,n._xpath=s.xpath||n._xpath,n._guidEntityCurrent=s.guidEntityCurrent||n._guidEntityCurrent,n._guidSearch=s.guidSearch||n._guidSearch}return $("#tmpl-list",o).empty(),r.scroller.reset(),n.showNoItems(!1),$(".bz-render-templates-header",o).text(t.text),$.when(n.tEnginePromise).then(function(){var e={guidSearch:n._guidSearch,data:t.data,reference:n._reference,surrogateKey:n._surrogateKey,referenceType:n._referenceType,page:a>0?a:n._page,pageSize:i>0?i:t.pageSize||n.Class.PAGE_SIZE,filters:n._filters,filtersAppliedCounter:t.filtersAppliedCounter,totalRecords:n._totalRecords,calculateFilters:t.calculateFilters||!1,defaultFilterApplied:void 0===t.defaultFilterApplied||t.defaultFilterApplied,xpath:n._xpath,guidEntityCurrent:n._guidEntityCurrent};return $.when(n.getEntityData(e)).done(function(){n.showGroupingBar()}).fail(function(e){var t=bizagi.localization.getResource("workportal-widget-sortbar-execute-error-message").replace("%s","error");$.notifier.add({title:"Error",text:t,class_name:"error",sticky:!1})})})}},getData:function(e){var t=this,i=e.filters,a=e.filtersAppliedCounter,n=e.calculateFilters;return t.showNoItems(!1),t.showLoadMore(!1),"search"===t._referrer?t.dataService.getSearchData(e).then(function(e){return e.totalRecords>0?t.homePortalFramework.extendCurrentContext({entityGuid:e.rows[0].guidEntity,calculateFilters:n}):t.showNoItems(!0),t.setFiltersData(e.filters,i,a,e.totalRecords,n,null),e}):t.dataService.getCollectionEntityData(e).then(function(r){var o=r.totalRecords;if(o>0&&r.rows.length>0){var s=e.referenceType;t.homePortalFramework.extendCurrentContext({entityGuid:r.rows[0].guidEntity,calculateFilters:n}),"FACT"===s?t.dataService.getFiltersEntityData(e,r).then(function(r){t.processFiltersData(r,i,a,o,n,e.defaultFilterApplied)}).fail(function(){t.hideSortBar()}):t.hideSortBar()}else a>0?t.setFiltersData([],i,a,o,!1,null):(t.hideSortBar(),t.showNoItems(!0));return r})},processFiltersData:function(e,t,i,a,n,r){var o=this;if(r){for(var s,l={properties:{xpath:"",type:"entity",typeSearch:"exact"},value:[]},c=-1,d=0;s=e[++c];){var u=s.data;if("Entity"===s.type)for(var p,m=-1;p=u.defaultValues[++m];)p.applied&&(l.properties.xpath=s.attribute,l.value.push({id:p.id}),d++)}d>0&&t.push(l),i=void 0!==i?i+d:d,o.setFiltersData(e,t,i,a,n,r)}else o.setFiltersData(e,[],i,a,n,null)},setFiltersData:function(e,t,i,a,n,r){var o=this,s={filters:e||[],filtersApplied:t||[],filtersAppliedCounter:i||0,totalRecords:a||0,calculateFilters:n||!1};r&&(s.defaultFilterApplied=r),o.content.trigger("setFiltersData",s)},getEntityData:function(e){var t=this;return $.when(t.getData(e)).then(function(e){return t.currentPage=e.currentPage,t.totalPages=e.totalPages,t.entityCollection=t.entityCollection.concat(e.entities),t.getEntityTemplates(e)})},getProcessAddAction:function(e){var t=this,i=e.data||{};i.reference&&"ENTITY"!==i.referenceType?t.dataService.getProcessAddAction({reference:i.reference,surrogateKey:i.surrogateKey}).done(function(e){t.setActionButton(e)}):t.setActionButton({})},setActionButton:function(){},refreshEntityData:function(e,t){var i=this,a={operator:"",filters:[{key:"id",value:e}]};return $.when(i.getData({page:i._page,filters:a})).done(function(e){var a=$.map(e.entities,function(e){return $.when(i.engine.render(e)).done(function(a){var n=i.renderTemplatesItem({tmpl:a.get(0).outerHTML,surrogateKey:e.surrogateKey});if(t.length>0)$(n).insertAfter(t);else{var r=$("#tmpl-list",i.content);$(n).prependTo(r)}i.paintHeaderFooterButtons(e)})});return $.when.apply($,a)})},paintHeaderFooterButtons:function(e){var t=this;t.actionsEvents.getEvents(e).done(function(){t.actionsEvents.getActions(e).done(function(){for(var i,a=-1;i=e[++a];)t.paintButtons(i,i.actions,i.events),t.entityCollection.find(function(e){e.surrogateKey===i.surrogateKey&&(e.entityActions=i.actions)})})})},getSelectedItems:function(){return this.selectedItems},addSelectedItem:function(e){this.selectedItems.push(e)},deleteSelectedItem:function(e){this.selectedItems.splice(this.selectedItems.indexOf(e),1)},findDataItem:function(e){return this.entityCollection.find(function(t){return t.surrogateKey==e})},handleDataNavigation:function(){var e=this;e.engine.subscribe("onLoadDataNavigation",function(t,i){i.filters=[],i.calculateFilters=i.calculateFilters||!0,e.homePortalFramework.extendCurrentContext({surrogateKeyToMapping:i.data.surrogateKey}),e.homePortalFramework.addContext(i.data),e.publish("homeportalShow",{what:"stuffTemplates",title:i.data.displayName,params:i,preventNavigate:!1})})}}),bizagi.workportal.webparts.renderTemplates.extend("bizagi.workportal.webparts.renderTemplates",{MAX_BUTTONS:2},{postRender:function(e){var t=this;t._super(e),t.tEnginePromise=$.when(t.workportalFacade.modules[t.workportalFacade.Class.render_module]).then(function(){var i=e.proxyPrefix||t.dataService.serviceLocator.proxyPrefix,a=new bizagi.render.services.service({proxyPrefix:i}),n=new bizagi.rendering.smartphone.factory(a);return $.when(n.initAsyncStuff()).then(function(){t.engine=new bizagi.templateEngine({renderFactory:n,cache:!0,forcePersonalizedColumns:!1}),t.handleDataNavigation()})})},configureHandler:function(){var e=this;e._super(),$(".bz-render-templates-footer",e.content).unbind().bind("click",function(){e.getEntityData({calculateFilters:!1,data:e._dataNavigation,filters:e._filters,guidSearch:e._guidSearch,page:++e._page,pageSize:e.Class.PAGE_SIZE,reference:e._reference,referenceType:e._referenceType,surrogateKey:e._surrogateKey,xpath:e._xpath,guidEntityCurrent:e._guidEntityCurrent})}),$("#tmpl-list",e.content).on("click","div.wp-action-item-check",function(){var t=this.classList.contains("selected"),i=e.findDataItem($(this).data("surrogatekey"));t?($(this).removeClass("selected"),e.deleteSelectedItem(i)):($(this).addClass("selected"),e.addSelectedItem(i)),e.selectedItems.length>0?($(".wp-ly-secondary-header",e.canvas).show(),$(".wp-ly-principal-header",e.canvas).hide()):($(".wp-ly-secondary-header",e.canvas).hide(),$(".wp-ly-principal-header",e.canvas).show())})},onAfterViewInitialized:function(e,t){var i=this;i.data=t,$(".bz-header-btn5",t.header).actionSheet({setDataToShow:function(){var e=i.actionsEvents.getCommomActions(i.getSelectedItems());if(0===e.length){var t=bizagi.localization.getResource("workportal-widget-no-actions-found");bizagi.showConfirmationBox(t,"Bizagi",!0,[{label:"Ok",action:"resolve"}])}return e},actionClicked:function(e){i.actionsEvents.executeActionMultipleData(e,i.entityCollection[0],i.getSelectedItems())}}),$(".wp-ly-secondary-header .bz-header-back-btn",t.header.context).bind("click",function(){i.removeGroupingBar()})},updateData:function(e,t){return bizagi.loading.start(),$.when(this._super(e,t)).always(function(){bizagi.loading.stop()})},setActionButton:function(e){var t=this;e&&"object"==typeof e&&Object.getOwnPropertyNames(e).length>0?(t.action=e,$(".bz-wp-render-new-data",t.canvas).show()):$(".bz-wp-render-new-data",t.canvas).hide()},renderSortBar:function(e){var t=this;if(void 0!=t.data)return $(".bz-wp-sortbar-container",t.data.scroller.fixedContainer).remove(),$(t.content).css({"margin-top":"60px"}),t.workportalFacade.executeWebpart({webpart:"sortBar",canvas:t.data.scroller.fixedContainer,container:t.content,filters:e.filters})},hideSortBar:function(){var e=this,t=$(".bz-wp-sortbar-container",e.data.scroller.fixedContainer);t&&t.remove(),$(e.content).css({"margin-top":"10px"})},showLoadMore:function(e){var t=this;e?t.currentPage===t.totalPages||0===t.totalPages?$(".bz-render-templates-footer",t.content).hide():$(".bz-render-templates-footer",t.content).show():$(".bz-render-templates-footer",t.content).hide()},showNoItems:function(e){var t=this;e?$(".bz-render-templates-no-content",t.content).show():$(".bz-render-templates-no-content",t.content).hide()},showGroupingBar:function(){var e=this,t=$("#tmpl-list",e.content);e.homePortalFramework.navigateFromRender?$(".wp-action-item-check",t).hide():$(".wp-action-item-check",t).show()},removeGroupingBar:function(){var e=this;e.selectedItems=[],$("div.wp-action-item-check",e.content).removeClass("selected"),$(".wp-ly-secondary-header",e.canvas).hide(),$(".wp-ly-principal-header",e.canvas).show()},refreshRegister:function(e,t){var i=this;if("search"==i._referrer)i.updateData(e,$.extend(t,{calculateFilters:!1}));else{var a=i.canvas.data("kendoMobileView").contentElement(),n=$("li.wp-tender-template-item[data-surrogateKey='"+t.surrogateKey+"']",a);t.insertAfterElement=n.prev(),n.remove(),i.refreshEntityData(t.surrogateKey,t.insertAfterElement)}},getEntityTemplates:function(e){var t=this,i=$("#tmpl-list",t.content),a="ENTITY"===t._referenceType?"Content":"List",n=[],r=$.map(e.entities,function(r){return n.push({surrogateKey:r.surrogateKey,entityId:r.guid}),t.engine.render($.extend(r,{isDefaultTemplate:null===r.guidTemplate,templateType:a,columnsXPaths:t._matchHeaderWithColumns(e)})).then(function(e){var a=$(t.renderTemplatesItem({surrogateKey:r.surrogateKey}));a.find("#wp-item-container").append(e),r.item=a.appendTo(i)})});return $.when.apply($,r).then(function(){t.dataService.getIdCasesOfProcessEntities(n).then(function(t){for(var i,a=-1;i=t[++a];){var n=i.caseId;if(void 0!==n&&n>0){var r=e.entities.find(function(e){return e.surrogateKey===i.surrogateKey});void 0!==r&&$.extend(r,{idCase:n})}}}).always(function(){t.homePortalFramework.navigateFromRender||t.paintHeaderFooterButtons(e.entities),t.showLoadMore(!0)})})},getReferrer:function(e){var t=this;return void 0!==e.guidSearch?"search":void 0!==e.data?"searches"===e.data.entityType?"search":"dataNavigation":void 0!==t._referrer?t._referrer:"dataNavigation"},paintButtons:function(e,t,i){var a,n=this,r=n.renderTemplatesActions,o=$("li.wp-tender-template-item[data-surrogatekey='"+e.surrogateKey+"']",n.content),s=$(".actions-section",o),l=[],c=-1;for(t=t||[],i=i||[],-1!==e.surrogateKey&&0!==t.length||$(".wp-action-item-check",o).hide();a=t[++c];)0!==a.multiplicity&&1!==a.multiplicity||l.push(a);for(var d,u=-1;d=i[++u];)l.push(d);var p={more:!1,buttons:l};void 0!==e.idCase&&e.idCase>0&&(p.isProcessEntity=!0,p.caseAction={idCase:e.idCase,type:"WorkOnIt"}),p.buttons.length>n.Class.MAX_BUTTONS&&(p.more=!0),s.html(r(p)),n.configureActionHandlers(s,p.buttons,e)},configureActionHandlers:function(e,t,i){var a=this;$(".wp-action-more",e).actionSheet({setDataToShow:function(){return t},actionClicked:function(e){a.removeGroupingBar(),a.actionsEvents.executeActionSingleData(e,i)}}),$(e).on("click",".wp-action",function(){a.removeGroupingBar(),a.actionsEvents.executeActionSingleData($(this).data("action"),i)})},_matchHeaderWithColumns:function(e){var t=function(e,t){return console.error("_matchHeaderWithColumns: property "+e+" does not exist"),t},i=bizagi.util.tryCatch(function(){return e.cells[0].columns},t.bind(null,"data.cells[0].columns",[])),a=bizagi.util.tryCatch(function(){return e.cells[0].headerMapper},t.bind(null,"data.cells[0].headerMapper",i));return i.reduce(function(e,t,i){return e[t]=void 0==a?t:a[i],e},{})}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.searchesList",{},{init:function(e,t,i){var a=this;i.authorizationRole="Search",a._super(e,t,i)},renderContent:function(e){var t=this;return kendo.template(t.getTemplate("main-searchesList-kendo-tmpl"),{useWithBlock:!1})()}}),bizagi.workportal.webparts.searchesList.extend("bizagi.workportal.webparts.searchesList",{},{postRender:function(e){var t=this;return bizagi.loading.startInnerLoader("#"+e.webpart),$(t.content).find(".bz-wp-searches-list").kendoMobileListView({filterable:!1,template:t.getTemplate("searches-item-tmpl"),click:function(e){t.homePortalFramework._cleanContext(),t.homePortalFramework.addContext({entityGuid:e.dataItem.entity,surrogateKey:[],entityType:"searches",guidSearch:e.dataItem.id}),t._showSearchForm(e)}}),$.when(t.dataService.getSearchLists()).then(function(e){$(t.content).find(".bz-wp-searches-list").data("kendoMobileListView").setDataSource(e)}).always(function(t){bizagi.loading.stopInnerLoader("#"+e.webpart)})},_showSearchForm:function(e){this.publish("homeportalShow",{what:"loadForm",params:e.dataItem,transition:"fade:up"})}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.shortCut",{},{init:function(e,t,i){this._super(e,t,i)},renderContent:function(){var e=this,t=$.Deferred(),i=e.homePortalFramework.loadComponentTemplate("shortCut-tmpl","shortCut",{});return t.resolve(i),t.promise()},postRender:function(e){var t=this;return t.homePortalFramework.loadComponents("shortCut",t.content).done(function(){t.list=$('<ul class="bz-wp-shortCut-list"></ul>'),t.list.kendoMobileListView({filterable:!1,template:t.getTemplate("shortCut-tmpl-item"),click:bizagi.util.debounce(function(e){t._executeShortcut(e)},500),headerTemplate:"<h2>${value}</h2>"}),t.content.prepend(t.list)}),bizagi.loading.startInnerLoader("#"+e.webpart),t.dataService.getShortCuts({icon:!0}).then(function(e){return t.processShortcuts(e)}).then(function(i){if(i.length>0){var a=kendo.data.DataSource.create({data:i,group:"classification.displayName"});t.list.data("kendoMobileListView").setDataSource(a),$(".km-content:visible").data("kendoMobileScroller")&&$(".km-content:visible").data("kendoMobileScroller").reset(),t.configureHandler(),bizagi.loading.stopInnerLoader("#"+e.webpart)}else bizagi.loading.stopInnerLoader("#"+e.webpart)}).fail(function(e){return e})},configureHandler:function(){},processShortcuts:function(e){for(var t,i=-1;t=e[++i];)t.icon=t.icon?t.icon:null,t.image=t.image?t.image:null;return e},_executeShortcut:function(e){var t=this,i=e.dataItem;return $.when(t.dataService.validateHasStartForm({processId:i.idProcess})).done(function(e){return $.when(bizagi.webpart.publish("createNewCase",{showConfirmation:i.showConfirmation,notification:!0,type:"Process",isMultiInstance:!1,title:i.displayName,isShortcut:!0,guidProcess:i.idProcess,hasStartForm:e.startForm,parentCaseId:0}))}).fail(function(e){t._showErrorMessage(i.displayName,e)}).always(function(){bizagi.util.smartphone.stopLoading()})},_showErrorMessage:function(e,t){var i=bizagi.localization.getResource("workportal-widget-sortbar-execute-error-message").replace("%s",e);$.notifier.add({title:"Error",text:i,class_name:"error",sticky:!0})}}),bizagi.workportal.webparts.shortCut.extend("bizagi.workportal.webparts.shortCut",{},{init:function(e,t,i){this._super(e,t,i)}}),bizagi.workportal.webparts.shortCut.extend("bizagi.workportal.webparts.shortCut",{},{init:function(e,t,i){this._super(e,t,i)},_executeShortcut:function(e){var t=this,i=e.dataItem;return $.when(t._super(e)).done(function(e){var t={showConfirmation:i.showConfirmation,notification:!0,type:"Process",isMultiInstance:!1,title:i.displayName,displayName:i.displayName,isShortcut:!0,guidProcess:i.idProcess,hasStartForm:e.startForm,parentCaseId:0};bizagiapp.newCase(t)})}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.sortBar",{},{init:function(e,t,i){this._super(e,t,i)},renderContent:function(e){var t=this;return kendo.template(t.getTemplate("wp-sortBar"))({})}}),bizagi.workportal.webparts.sortBar.extend("bizagi.workportal.webparts.sortBar",{},{postRender:function(e){var t=this;return t.configureHandlers(),t.sortSelection={},t.workportalFacade.executeWebpart({webpart:"filterBar",canvas:$(".bz-wp-filterbar-container",t.content),container:t.container,filters:e.filters}).then(function(e){t.filterBar=e})},configureHandlers:function(){var e=this;e.unsubscribe("setFiltersData.sortBar"),e.subscribe("setFiltersData.sortBar",function(t,i){if(e.filtersAppliedCounter=i.filtersAppliedCounter||0,e.filters=i.calculateFilters?i.filters:e.filters,i.calculateFilters){if(0==$(".bz-wp-sortBar",e.content).children().length){var a=kendo.template(e.getTemplate("wp-sortBar-RigthMenu"));$(".bz-wp-sortBar",e.content).empty().append(a({})),$(".bz-wp-sortBar",e.content).show(),e.configureAfterPaintHandlers()}for(var n,r=-1,o=0,s=0;n=e.filters[++r];)"Text"!=n.type&&"Link"!==n.type&&n.data&&(n.data.defaultValues&&n.data.defaultValues.length>0||n.data.min&&n.data.max)&&o++,""!==n.display&&s++;i.totalRecords>0?(o>0?e.showFilterButton():e.hideFilterButton(),s>0?e.showSortButtons():e.hideSortButtons()):0===e.filtersAppliedCounter&&(e.hideFilterButton(),e.hideSortButtons())}e.updateCounter(e.filtersAppliedCounter)})},showFilterButton:function(){var e=this,t=$(".wp-actions-filter",e.getContent());t.show(),e.filtersAppliedCounter>0?(t.addClass("full"),$(".wp-webp-icon",t).addClass("bz-filter-full")):$(".wp-webp-icon",t).removeClass("bz-filter-full").addClass("bz-filter-empty"),$(".bz-wp-filterbar-container",e.content).is(":visible")&&(t.removeClass("full").addClass("active"),$(".wp-webp-icon",t).removeClass("bz-filter-full").addClass("bz-filter-empty"))},hideFilterButton:function(){var e=this;$(".wp-actions-filter",e.getContent()).hide()},showSortButtons:function(){var e=this;$(".wp-actions-sort",e.getContent()).show(),$(".wp-actions-sort-az",e.getContent()).show()},hideSortButtons:function(){var e=this;$(".wp-actions-sort",e.getContent()).hide(),$(".wp-actions-sort-az",e.getContent()).hide()},configureAfterPaintHandlers:function(){var e=this;$(".wp-actions-filter",e.content).unbind().bind("click",function(){if($(".bz-wp-filterbar-container",e.content).is(":visible"))e.filterBar&&(e.filterBar.getFilters().length>0||e.filtersAppliedCounter>0)?($(".wp-actions-filter",e.content).addClass("full"),$(".wp-actions-filter .wp-webp-icon",e.content).removeClass("bz-filter-empty").addClass("bz-filter-full")):($(".wp-actions-filter",e.content).removeClass("full"),$(".wp-actions-filter .wp-webp-icon",e.content).removeClass("bz-filter-full").addClass("bz-filter-empty")),$(".wp-actions-filter",e.content).removeClass("active"),$(".bz-wp-filterbar-container",e.content).slideUp(200,"swing",function(){$(e.container).animate({marginTop:"60px"},200,"swing")});else{var t=$(".bz-wp-filterbar-container",e.content).height()+60;$(".wp-actions-filter",e.content).addClass("active"),$(".wp-actions-filter .wp-webp-icon",e.content).removeClass("bz-filter-full").addClass("bz-filter-empty"),$(".bz-wp-filterbar-container",e.content).slideDown(200,"swing",function(){$(e.container).animate({marginTop:t+"px"},200,"swing")})}}),$(".wp-actions-sort-az",e.content).unbind().bind("click",function(){if(e.sortSelection.attribute){$(".wp-webp-icon",this).hasClass("bz-unordered")&&$(".wp-webp-icon",this).removeClass("bz-unordered"),"asc"==e._sortType?(e._sortType="desc",$(this).removeClass("asc").addClass("desc"),$(".wp-webp-icon",this).removeClass("bz-ordered-up").addClass("bz-ordered-down")):(e._sortType="asc",$(this).removeClass("desc").addClass("asc"),$(".wp-webp-icon",this).removeClass("bz-ordered-down").addClass("bz-ordered-up"));var t={properties:{xpath:e.sortSelection.attribute,orderType:e._sortType,typeSearch:"none"}};e.publish("setOrderBy",t)}}),$(".wp-actions-sort",e.content).unbind().bind("click",function(){e.buildSortModalView(),e.adjustModalViewHeigth()})},updateCounter:function(e){var t=this,i=t.getContent(),a=$(".wp-webp-filter-counter",i);e>0?(a.html(e),a.show()):a.hide()},buildSortModalView:function(){var e=this,t=kendo.template(e.getTemplate("wp-sortbarModalView"));e.$modalViewTemplate=$(t({filters:e.filters})),e.$modalViewTemplate.kendoMobileModalView({close:function(){this.destroy(),this.element.remove()}}),$(".ui-bizagi-sort-item",e.$modalViewTemplate).unbind().click(function(){var t=$(this).data("index"),i=e.filters[t];if(e.sortSelection!=i){e.sortSelection=i,e._sortType="asc",$(".wp-actions-sort label",e.content).text(e.sortSelection.display),$(".wp-actions-sort-az",e.content).removeClass("desc").addClass("asc"),$(".wp-actions-sort-az .wp-webp-icon",e.content).hasClass("bz-unordered")&&$(".wp-actions-sort-az .wp-webp-icon",e.content).removeClass("bz-unordered"),$(".wp-actions-sort-az .wp-webp-icon",e.content).removeClass("bz-ordered-down").addClass("bz-ordered-up");var a={properties:{xpath:i.attribute,orderType:e._sortType,typeSearch:"none"}};e.publish("setOrderBy",a)}e.$modalViewTemplate.kendoMobileModalView("close")}),$("#ui-bizagi-cancel-sortbar",e.$modalViewTemplate).unbind().click(function(){e.$modalViewTemplate.kendoMobileModalView("close")}),e.$modalViewTemplate.kendoMobileModalView("open")},adjustModalViewHeigth:function(){var e=this,t=e.$modalViewTemplate;if(t){var i=t.find("div.km-header").outerHeight(!0),a=0;$.each(t.find("div.km-scroll-container > *"),function(e,t){var i=$(t);i.is(":visible")&&(a+=i.outerHeight(!0))});var n=t.find("div.km-footer").outerHeight(!0),r=i+a+n;$(t.parent().parent()).css("max-height",t.css("max-height")),$(document).height()>r&&(t.height(r),t.parent().parent().height(r))}}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.stakeHolder",{},{init:function(e,t,i){this._super(e,t,i)},renderContent:function(e){var t=this,i=$.Deferred();return t.content=t.homePortalFramework.loadComponentTemplate("stakeHolder-tmpl","stakeHolder",bizagi.currentUser),i.resolve(""),i.promise()},postRender:function(e){var t=this;t.canvas.bind("view-initialized",$.proxy(t.onAfterViewInitialized,t))},configureHandler:function(){var e=this;$(".wp-sh-container",e.content).bind("click",function(){e.publish("homeportalShow",{what:"dashBoard"})})},onAfterViewInitialized:function(e,t){var i=bizagi.currentUser;t.header.find(".bz-wp-title").html(i.userFullName);for(var a,n=[],r=-1;a=i.associatedStakeholders[++r];)n.push(a.displayName);if(t.header.find(".bz-wp-subtitle").html(n.join(",")),i.userPicture){t.header.find(".btn-menu").removeClass("bz-login-user").removeClass("bz-mo-icon").html('<img class="wp-sh-image" src="data:image/png;base64,'+i.userPicture+'">')}}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.startForm",{},{_useFloatingButtons:!1,init:function(e,t,i){var a=this;a._super(e,t,i),a.navigation={},a._useFloatingButtons=bizagi.override.enableMfb&&!(bizagi.util.isAndroidDevice()&&bizagi.util.isCordovaSupported()&&bizagi.util.getAndroidVersion()<4.4)},initNavigation:function(){var e=this;return e.navigation=new bizagi.workportal.action.navigation(e),e.navigation},renderContent:function(){var e=this,t=$.Deferred();return e.content=e.homePortalFramework.loadComponentTemplate("startForm-tmpl","startForm",{useWithBlock:!1}),t.resolve(e.content),t.promise()},renderForm:function(e){var t=this;t.content.empty(),void 0===t.view&&(t.view=new kendo.mobile.ui.View(t.canvas,{useNativeScrolling:!0}),t.initNavigation());var i=e.displayName||e.title||"";if($(".km-navbar",t.view.header).data("kendoMobileNavBar").title(i),t.original_params=e,t._type=e.type,t._navigateProcess=void 0!==e.showProcess&&e.showProcess,t._origin=e.origin,"Process"===e.type){if(t._renderParams={h_action:e.hasStartForm?"LOADSTARTFORM":"LOADFORM"},void 0!==e.idParentCase&&(t._renderParams.h_idParentCase=e.idParentCase),void 0!==e.guidProcess?(t._renderParams.h_guidprocess=e.guidProcess,void 0===e.mapping&&e.isShortcut&&(t._renderParams.h_mappingstakeholders=!0)):t._renderParams.h_idProcess=e.idProcess,e.mapping)for(var a=0;a<e.mapping.length;a++){var n=e.mapping[a];n.surrogateKey&&(t._renderParams[n.xpath]=JSON.stringify(n.surrogateKey))}}else"Form"===e.type&&(t._renderParams={h_action:"LOADENTITYFORM",h_contexttype:"entity",h_guidEntity:e.entityGuid,h_guidForm:e.formGuid,h_showDisabled:!1,h_readonlyform:e.readonlyform},null!==e.entitySurrogateKey&&(t._renderParams.h_surrogateKey=e.entitySurrogateKey),void 0!==e.mapping&&null!==e.mapping&&(t._renderParams.h_mapping=JSON.stringify(e.mapping)));if(void 0===t.rendering){var r=e.proxyPrefix||t.dataService.serviceLocator.proxyPrefix;bizagi.rendering.facade.extend("bizagi.rendering.startFormFacade",{},{process:function(e){return this._super(e).then(function(i){return t._form=i,t._changeButtons(e.origin),i})}}),t.rendering=new bizagi.rendering.startFormFacade({proxyPrefix:r,device:bizagi.util.detectDevice()})}return bizagi.util.setContext({idCase:e.idCase||null,displayName:e.displayName||e.taskName,caseNumber:e.caseNumber||null}),"#renderSplitView"!==bizagi.kendoMobileApplication.view().id&&bizagi.kendoMobileApplication.navigate("#renderSplitView"),$("#paneRender").data("kendoMobilePane").navigate("#startForm","slide:right"),$.when(t.dataService.getForm(t._renderParams)).then(function(i){return i.form.properties.editionForm=!0,t.rendering.execute({data:i,navigation:t.navigation,originalParams:e,postRenderEdit:t.postRenderEdit.bind(t),getTemplate:t.getTemplate,canvas:t.content,pane:$("#right-pane").data("kendoMobilePane"),type:""})}).done(function(e){
t.view.scroller.reset()})},postRender:function(){this.configureHandlers()},postRenderEdit:function(){},configureHandlers:function(){var e=this;$(".bz-render-back",e.canvas).bind(e.Class.BIZAGI_TAP_EVENT,function(){e._back()}),e.subscribe("render-start-form",function(t,i){return e.startRendering(i.params)}),e.subscribe("homeportalShow-startForm",function(t,i){return e.startRendering(i)}),e.content.bind("routing",function(t,i){if(i.notification){var a=printf(bizagi.localization.getResource("workportal-widget-templateengine-message-summary-create-cases-singular"),1),n=bizagi.localization.getResource("workportal-widget-templateengine-action-process-notification"),r=n.replace("{0}",i.caseNumber);$.notifier.add({title:e.original_params.displayName||"",text:a+"<br>"+r}),e._back()}else if(void 0!==i.idCase){var o={action:"routing",idCase:i.idCase};bizagi.loading.start(),e.dataService.getCaseAssignees(i).then(function(t){var a=t.assignees;if(e._navigateProcess=!1,void 0!==a&&a.length>0){var n=bizagi.currentUser.idUser;void 0!==a.find(function(e){return e.idUser==n})&&(e._navigateProcess=!0)}if(e.publish("bz-update-list-cases",{updateDataList:!0}),e._navigateProcess||e.original_params.fromNewCase)e.openRenderCase(o);else{var r=printf(bizagi.localization.getResource("workportal-widget-templateengine-message-summary-create-cases-singular"),1),s=bizagi.localization.getResource("workportal-widget-templateengine-action-process-notification"),l=s.replace("{0}",i.caseNumber),c=e.original_params.displayName||"",d=r+"<br><span class='message_id_case'>"+l+"</span>";if(e._refreshTemplate(),bizagi.util.isNativeHeaderEnabled())bizagiapp.notifyAction(c,d,!0);else{var u=$.notifier.add({title:c,text:d,sticky:!0});$("#notifier-item-"+u+" .message_id_case").bind("click",function(t){e.openRenderCase(o),$.notifier.remove(u)})}}}).always(function(){bizagi.loading.stop()})}})},startRendering:function(e){var t=this,i=$.Deferred();return bizagi.loading.start(),$.when(t.workportalFacade.modules[t.workportalFacade.Class.render_module]).then(function(){return t.renderForm(e)}).done(function(){i.resolve()}).fail(function(){i.reject()}).always(function(){bizagi.loading.stop()}),i.promise()},openRenderCase:function(e){var t=this;bizagi.loading.start(),$.when(t.publish("render-case",e)).done(function(){bizagi.loading.stop()})},_changeButtons:function(){var e=this,t=e._form,i=t.processButton;t&&(t.processButton=function(a){var n=$.Deferred();return"cancel"===a.action?(t.endLoading(),e._back(),n.resolve()):(bizagi.loading.start(),void 0!==e._renderParams.h_surrogateKey&&(t.properties.surrogateKey=e._renderParams.h_surrogateKey),t.properties.contextType=e._renderParams.h_contexttype,t.validateForm()?$.when(i.apply(t,arguments)).then(function(){void 0===e._renderParams.h_surrogateKey&&void 0===e._renderParams.h_mapping||e._refreshTemplate(),n.resolve()}).always(function(){bizagi.loading.stop()}).fail(function(){n.reject()}):(bizagi.loading.stop(),n.reject())),n.promise()},"Form"===e._type&&t.bind("refresh",function(){bizagi.loading.stop()}))},_refreshTemplate:function(){var e=this;if(void 0!==e._origin){var t=e.homePortalFramework.accumulatedContext,i={data:t[t.length-1],filters:[],eventType:"DATA-NAVIGATION",calculateFilters:!0};e._back(),e.publish("homeportalShow",{what:e._origin,title:void 0!==i.data?i.data.displayName:"",params:i,preventNavigate:!0})}else e._back()},_back:function(){bizagi.util.autoSave().then(function(){bizagi.kendoMobileApplication.navigate("homePortal","slide:right")})}}),bizagi.workportal.webparts.startForm.extend("bizagi.workportal.webparts.startForm",{},{openRenderCase:function(e){bizagi.util.isNativeHeaderEnabled()&&bizagi.util.isAndroidDevice()&&this._super(e),bizagiapp.openRenderElement({idCase:e.idCase})},initNavigation:function(){var e=this;e._super(),bizagi.util.isNativeHeaderEnabled()&&e.view.header.hide()},_back:function(){bizagi.util.isNativeHeaderEnabled()||this._super(),bizagiapp.showHomePortal()},_refreshTemplate:function(){var e=this;if(bizagi.util.isNativeHeaderEnabled())if(void 0!==e._origin){var t=e.original_params.mapping,i={data:t[t.length-1],filters:[],eventType:"DATA-NAVIGATION",calculateFilters:!0};bizagiapp.dataNavigation({what:e._origin,displayName:void 0!==i.data?i.data.displayName:"",params:i,preventNavigate:!0})}else e._back();else e._super()}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.stuff",{},{init:function(e,t,i){this._super(e,t,i)},postRender:function(){this.configureHandler()},configureHandler:function(){},stuffSelected:function(e){var t=this;t.homePortalFramework._cleanContext(),t.homePortalFramework.addContext(e.data),t.publish("homeportalShow",{what:"stuffTemplates",title:e.data.displayName,params:e,transition:"overlay:left"})},processMyStuff:function(e){return $.map(e,function(e){e.icon=e.icon?e.icon:null,e.image=e.image?e.image:null}),e}}),bizagi.workportal.webparts.stuff.extend("bizagi.workportal.webparts.stuff",{},{init:function(e,t,i){this._super(e,t,i)},renderContent:function(){var e=this,t=$.Deferred(),i=e.homePortalFramework.loadComponentTemplate("stuff-tmpl","stuff");return $(e.canvas).html(i),e.content=$(".bz-wp-stuff-list",e.canvas),e.content.kendoMobileListView({filterable:!1,template:e.getTemplate("stuff-item-tmpl"),click:function(t){var i=t.dataItem,a={action:i.action||null,calculateFilters:!0,data:{displayName:i.displayName,guidEntityCurrent:i.entityId,reference:i.reference,referenceType:i.referenceType,surrogateKey:i.surrogateKey,xpath:i.xpath},filters:[]};e.stuffSelected(a)}}),t.resolve(e.content),t.promise()},postRender:function(){var e=this;return e._super(),e.dataService.getMyStuff({icon:!0}).then(function(t){return e.processMyStuff(t)}).done(function(t){e.content.data("kendoMobileListView").setDataSource(t),e.configureHandler(),$(".km-content:visible").data("kendoMobileScroller")&&$(".km-content:visible").data("kendoMobileScroller").reset()})},configureHandler:function(){this._super()}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.summaryCase",{COMMENT_SIZE:5,ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,SEARCH_MIN_LENGTH:3,SEARCH_DELAY:700},{init:function(e,t,i){var a=this;a._super(e,t,i),a.initializeTemplates(),a.caseSummary=new bizagi.workportal.webparts.summaryCase.caseSummary(e,t,i),a.activitySummary=new bizagi.workportal.webparts.summaryCase.activitySummary(e,t,i),a.parentSummary=new bizagi.workportal.webparts.summaryCase.parentSummary(e,t,i),a.eventsSummary=new bizagi.workportal.webparts.summaryCase.eventsSummary(e,t,i),a.subprocessSummary=new bizagi.workportal.webparts.summaryCase.subprocessSummary(e,t,i),a.assigneesSummary=new bizagi.workportal.webparts.summaryCase.assigneesSummary(e,t,i),a.actionSummary=new bizagi.workportal.webparts.summaryCase.actionsSummary(e,t,i),a.activityPlanStateSummary=new bizagi.workportal.webparts.summaryActivityPlan.stateActivity(e,t,i),a.activityPlanProgressSummary=new bizagi.workportal.webparts.summaryActivityPlan.progressActivity(e,t,i),a.activityPlanParentSummary=new bizagi.workportal.webparts.summaryActivityPlan.parentActivity(e,t,i),a.activityPlanAssigneesSummary=new bizagi.workportal.webparts.summaryActivityPlan.assigneesActivity(e,t,i),a.planProgressSummary=new bizagi.workportal.webparts.summaryPlan.progressPlan(e,t,i),a.planTimeSummary=new bizagi.workportal.webparts.summaryPlan.timePlan(e,t,i),a.CLOSED_PLAN="CLOSED",a.dataPlan=new bizagi.workportal.webparts.summaryActivityPlan.dataPlan(e,t,i),a.templateMain=kendo.template(a.getTemplate("summary-view"),{useWithBlock:!1})},initializeTemplates:function(){var e=this,t={useWithBlock:!1};e.summaryCaseTemplateBasic=kendo.template(e.getTemplate("summary-case-basic"),t),e.summaryCaseTemplate=kendo.template(e.getTemplate("summary-case-main"),t),e.summaryCaseTemplateCaseState=kendo.template(e.getTemplate("summary-case-state"),t),e.summaryCaseTemplateAction=kendo.template(e.getTemplate("summary-case-actions"),t),e.summaryCaseTemplateActivities=kendo.template(e.getTemplate("summary-case-activities"),t),e.summaryCaseTemplateParent=kendo.template(e.getTemplate("summary-case-parent"),t),e.summaryCaseTemplateEvents=kendo.template(e.getTemplate("summary-case-events"),t),e.summaryCaseTemplateSubprocess=kendo.template(e.getTemplate("summary-case-subprocess"),t),e.summaryCaseTemplateAssigness=kendo.template(e.getTemplate("summary-case-assignees"),t),e.summaryCaseTemplateActivityPlanState=kendo.template(e.getTemplate("summary-plan-state-activity"),t),e.summaryCaseTemplateActivityPlanProgress=kendo.template(e.getTemplate("summary-plan-progress-activity"),t),e.summaryCaseTemplateActivityPlanParent=kendo.template(e.getTemplate("summary-plan-parent-activity"),t),e.summaryPlanTemplatePlanState=kendo.template(e.getTemplate("project-plan-state"),t),e.summaryPlanTemplatePlanProgress=kendo.template(e.getTemplate("project-plan-progress"),t),e.summaryPlanTemplatePlanTime=kendo.template(e.getTemplate("project-plan-time"),t),e.summaryPlanTemplatePlanParent=kendo.template(e.getTemplate("project-plan-parent"),t)},postRender:function(e){this.configureHandlers()},configureHandlers:function(){var e=this;bizagi.webpart.subscribe("bz-summary-case",function(t,i){return e.renderSummary(i)}),bizagi.webpart.subscribe("onLoadDataItemsFromFormActivityPlan",function(t,i){var a=e.calculateActivityProgressColorBar(i.activityWork);i.dataActivityProgress={progress:{canEdit:0===i.items.length,progress:i.activityWork},valuePercentBarComplete:i.activityWork,colorBar:a},e.updateActivityProgress(i)})},release:function(e){var t=this,i=new $.Deferred,a=[{label:t.getResource("workportal-widget-dialog-box-release-ok"),action:"resolve"},{label:t.getResource("workportal-widget-dialog-box-release-cancel")}];return $.when(bizagi.showConfirmationBox(t.getResource("workportal-widget-dialog-box-release"),t.getResource("render-actions-release"),"",a)).done(function(){bizagi.loading.start(),$.when(t.dataService.releaseActivity({idCase:e.idCase,idWorkItem:e.idWorkitem})).done(function(a){switch(a&&a.status?a.status:"Error"){case"Success":bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()?bizagiapp.showHomePortal():bizagi.kendoMobileApplication.navigate("homePortal");break;case"ConfigurationError":bizagi.showMessageBox(t.getResource("workportal-widget-dialog-box-release-configuration-error-message").replace("{0}",e.idWorkitem),t.getResource("workportal-widget-dialog-box-release-error"),"error",!1);break;case"Error":default:bizagi.showMessageBox(t.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",e.idWorkitem),t.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}bizagi.loading.stop(),i.resolve()}).fail(function(){var a=t.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",e.idWorkitem);bizagi.showMessageBox(a,t.getResource("workportal-widget-dialog-box-release-error"),"error",!1),bizagi.loading.stop(),i.reject()})}),i.promise()},renderBasicSummaryCase:function(e){var t=this,i=$(bizagi.util.trim(t.summaryCaseTemplateBasic(e)));t.data.isOfflineForm||e.countEvents>0&&$.when(t.loadCaseEvents()).done(function(e){$("#summaryCaseBasic .summary-basic-events",t.content).append(e)}).fail(function(){t.hideSummaryElement("#summaryCaseBasic .summary-basic-events")}),$(".widget-right-sidebar",t.content).css("display","none"),$("#summaryCaseBasic",t.content).append(i)},renderSummaryCase:function(){var e=this,t="";e.data=e.data||{},e.data.caseDetails.plan?(e.data.caseDetails.isActivitySummary?e.showActivityPlanSummary():e.showPlanSummary(),$.when(e.activityPlanAssigneesSummary.getActivityAssignees(e.data)).done(function(i){e.assignees=i.assignees,t=$(bizagi.util.trim(e.summaryCaseTemplateAssigness(e.assignees))),e.showSummaryElement("#assigneesContent",t),e.callGetDataUsers(i.cvsUsers).then(function(){e.renderUserProfilesAndImages()})}).fail(function(){e.hideSummaryElement("#assigneesContent")}),e.hideSummaryElement("#eventsContent"),e.hideSummaryElement("#subProcessContent")):e.showCaseSummary()},showActivityPlanSummary:function(){var e=this,t="";$.when(e.activityPlanStateSummary.getActivityPlanStateData(e.data)).done(function(t){e.data.dataActivityPlanState=t,e.updateActivityState(e.data)}).fail(function(){e.hideSummaryElement("#caseStateContent")}),$.when(e.activityPlanProgressSummary.getActivityProgress(e.data)).done(function(t){e.data.dataActivityProgress=t,e.updateActivityProgress(e.data)}).fail(function(){e.hideSummaryElement("#activityStateContent")}),$.when(e.activityPlanParentSummary.getActivityParent(e.data)).done(function(i){e.data.dataActivityParent=i,t=$(bizagi.util.trim(e.summaryCaseTemplateActivityPlanParent(e.data))),e.showSummaryElement("#parentProcessContent",t)}).fail(function(){e.hideSummaryElement("#parentProcessContent")}),$.when(e.actionSummary.getActionsData(e.data)).done(function(i){t=$(bizagi.util.trim(e.summaryCaseTemplateAction(i))),e.configureEditAcitivyHandler(t),e.showSummaryElement("#actionsContent",t)}).fail(function(){e.hideSummaryElement("#actionsContent")}),e.hideSummaryElement("#planProgressContent"),e.hideSummaryElement("#planTimeContent"),e.hideSummaryElement("#planParentContent"),e.hideSummaryElement("#planStateContent")},showPlanSummary:function(){var e=this,t="";e.showPlanState(),$.when(e.planProgressSummary.getPlanProgressData(e.data)).done(function(i){e.data.dataPlanProgress=i,t=$(bizagi.util.trim(e.summaryPlanTemplatePlanProgress(e.data))),e.showSummaryElement("#planProgressContent",t)}).fail(function(){e.hideSummaryElement("#planProgressContent")}),$.when(e.planTimeSummary.getPlanTimeData(e.data)).done(function(i){"thereArentDueDate"===i?e.hideSummaryElement("#planTimeContent"):(e.data.dataPlanTime=i,t=$(bizagi.util.trim(e.summaryPlanTemplatePlanTime(e.data))),e.showSummaryElement("#planTimeContent",t))}).fail(function(){e.hideSummaryElement("#planTimeContent")}),e.getPlanParentData(e.data).done(function(i){i?(e.data.dataPlanParent=i,t=$(bizagi.util.trim(e.summaryPlanTemplatePlanParent(e.data))),e.showSummaryElement("#planParentContent",t)):e.hideSummaryElement("#planParentContent")}).fail(function(){e.hideSummaryElement("#planParentContent")}),e.hideSummaryElement("#caseStateContent"),e.hideSummaryElement("#activityStateContent"),e.hideSummaryElement("#parentProcessContent"),e.hideSummaryElement("#actionsContent")},showCaseSummary:function(){var e=this,t="";e.hideSummaryElement("#actionsContent"),e.hideSummaryElement("#planParentContent"),e.hideSummaryElement("#planStateContent"),e.hideSummaryElement("#planTimeContent"),e.hideSummaryElement("#planProgressContent"),$.when(e.caseSummary.getCaseData(e.data)).done(function(i){e.data.dataCaseState=i,t=$(bizagi.util.trim(e.summaryCaseTemplateCaseState(e.data))),e.setActivitiesHandler(t),e.showSummaryElement("#caseStateContent",t)}).fail(function(){e.hideSummaryElement("#caseStateContent")}),!0!==e.data.isEvent&&$.when(e.activitySummary.getActivitiesData(e.data)).then(function(i){e.data.dataActivityState=i,t=$(bizagi.util.trim(e.summaryCaseTemplateActivities(e.data))),e.showSummaryElement("#activityStateContent",t)}).fail(function(){e.hideSummaryElement("#activityStateContent")}),$.when(e.parentSummary.getParentData(e.data)).done(function(i){t=$(bizagi.util.trim(e.summaryCaseTemplateParent(e.data))),e.showSummaryElement("#parentProcessContent",t)}).fail(function(){e.hideSummaryElement("#parentProcessContent")}),$.when(e.loadCaseEvents()).done(function(t){e.showSummaryElement("#eventsContent",t)}).fail(function(){e.hideSummaryElement("#eventsContent")}),$.when(e.subprocessSummary.getSubprocessData(e.data)).done(function(i){e.data.dataSubProcess=i,t=$(bizagi.util.trim(e.summaryCaseTemplateSubprocess(e.data))),e.showSummaryElement("#subProcessContent",t)}).fail(function(){e.hideSummaryElement("#subProcessContent")}),$.when(e.assigneesSummary.getAssigneesData(e.data)).done(function(i){e.assignees=e.data.caseDetails.assigneesUsers,t=$(bizagi.util.trim(e.summaryCaseTemplateAssigness(e.assignees))),e.showSummaryElement("#assigneesContent",t),e.callGetDataUsers(i).then(function(){e.renderUserProfilesAndImages()})}).fail(function(){e.hideSummaryElement("#assigneesContent")})},loadCaseEvents:function(){var e=this,t=new $.Deferred,i="";return bizagi.loading.start(),$.when(e.eventsSummary.getEventsData(e.data)).done(function(a){e.data.dataEvents=a,i=$(bizagi.util.trim(e.summaryCaseTemplateEvents(e.data))),t.resolve(i)}).fail(function(){t.reject()}).always(function(){bizagi.loading.stop()}),t.promise()},hideSummaryElement:function(e){var t=this;$(e,t.content).hide()},showSummaryElement:function(e,t){var i=this;$(e,i.content).empty(),t.length>0?$(e,i.content).append(t):i.hideSummaryElement(e)},configureSummaryHeaderHandlers:function(e){var t=this;$(".bz-summary-back",e.element).bind("click",function(e){e.stopImmediatePropagation(),t.pane.navigate("#:back")})},updateActivityState:function(e){var t=this,i=$(bizagi.util.trim(t.summaryCaseTemplateActivityPlanState(e)));t.updateProgressActivityState(i),t.showSummaryElement("#caseStateContent",i)},updateActivityProgress:function(e){var t=this,i=$(bizagi.util.trim(t.summaryCaseTemplateActivityPlanProgress(e)));t.updateProgressUI(e.dataActivityProgress.valuePercentBarComplete,i),t.configureActivityProgressHandlers(i),t.showSummaryElement("#activityStateContent",i)},configureActivityProgressHandlers:function(e){var t=this;$(".edit-activity-progress",e).bind("click",function(e){var i=t.getTemplate("progress-bar-kendo-tmpl"),a=kendo.template(i,{useWithBlock:!1});t.modalView=$(a({})),t.modalView.kendoMobileModalView({close:function(e){this.destroy(),this.element.remove()}}),t.configureModalViewHandlers(),t.modalView.kendoMobileModalView("open")})},configureModalViewHandlers:function(){var e=this;$("#modalview-filter","body").delegate(".ui-bizagi-cancel-new-progress","click",function(e){$("#modalview-filter","body").data("kendoMobileModalView").close()}),$("#modalview-filter","body").delegate(".ui-bizagi-apply-new-progress","click",function(t){var i=parseInt($(".ui-bizagi-wp-project-plan-manual-progress-activity-wrapper .output-input-manual-progress").text().slice(0,-1));$.when(e.activityPlanProgressSummary.onSubmitFormChangeProgress(t,e.data,i)).done(function(t){var a=e.calculateActivityProgressColorBar(i);t.dataActivityProgress={progress:{canEdit:0===t.items.length,progress:i},valuePercentBarComplete:i,colorBar:a},e.updateActivityProgress(t),bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!0,idActivity:t.id,itemsResolved:0,items:t.items,progress:i})),$("#modalview-filter","body").data("kendoMobileModalView").close()})}),$(".manual-progress-input-range","body").bind("change",function(e){$(".ui-bizagi-wp-project-plan-manual-progress-activity-wrapper .output-input-manual-progress").text(this.value+"%")});var t=$("#activityStateContent .days","body")[0].textContent;$(".ui-bizagi-wp-project-plan-manual-progress-activity-wrapper .output-input-manual-progress").text(t+"%"),$("input.manual-progress-input-range","body").attr({value:t})},calculateActivityProgressColorBar:function(e){return e<=33?"Red":e<=66?"Yellow":"Green"},setActivitiesHandler:function(e){var t=this;$(".bz-wp-summary-release",e).bind("click",function(e){var i={};t.data&&t.data.idCase?i.idCase=t.data.idCase:t.data.caseDetails&&t.data.caseDetails.idCase&&(i.idCase=t.data.caseDetails.idCase),t.data&&t.data.idWorkitem?i.idWorkitem=t.data.idWorkitem:t.data.caseDetails&&t.data.caseDetails.idWorkitem&&(i.idWorkitem=t.data.caseDetails.idWorkitem),t.release(i)}),$(".case-summary-favorite",e).bind("click",function(e){t.onClickFavorite(e)})},onClickFavorite:function(e){e.preventDefault();var t=this,i=t.data||t.data.params,a={};$(e.target).hasClass("bz-favorites")?(a={idObject:i.caseDetails.idCase,favoriteType:"CASES"},$.when(t.dataService.addFavorite(a)).done(function(i){t.data.caseDetails.guidFavorite=i.idFavorites,$(e.target).removeClass("bz-favorites"),$(e.target).addClass("bz-favorites-full")})):(a={idObject:i.caseDetails.guidFavorite,favoriteType:"CASES"},$.when(t.dataService.delFavorite(a)).done(function(){$(e.target).removeClass("bz-favorites-full"),$(e.target).addClass("bz-favorites")}))},getPlanParentData:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getPlanParent({idPlan:e.plan.id})).done(function(t){if(e.plan.parent=t,e.plan.parent){var a={idParent:e.plan.parent.radNumber,nameParent:e.plan.parent.displayName,idCase:e.plan.parent.idCase,idWorkflow:e.plan.parent.idWorkflow,idWorkItem:e.plan.parent.idWorkItem,idTask:e.plan.parent.idTask};i.resolve(a)}else i.resolve(void 0)}).fail(function(e){i.reject()}),i.promise()},showPlanState:function(e){var t=this;t.data.dataShowPlanState=!0;var i=$(bizagi.util.trim(t.summaryPlanTemplatePlanState(t.data)));t.showSummaryElement("#planStateContent",i)},configureEditAcitivyHandler:function(e){var t=this;$(".edit-activity-button",e).bind("click",function(e){$(".project-popupform-edit-activity-wrapper",t.canvas).length,t.showEditActivityForm(e),t.hideSummaryDrawer()})},showEditActivityForm:function(e){var t=this;t.initViewFile(),t.renderEdition()},initViewFile:function(){var e=this;if(e.params={title:bizagi.localization.getResource("workportal-project-plan-title-activity-properties")},e.editionView)$("#render-content",e.editionView.content).empty();else{var t=$($.kendoTmpl(e.getTemplate("edit-activity-view"),e.params));$("#paneRender").append(t),e.editionView=new kendo.mobile.ui.View(t,{useNativeScrolling:!0})}e.pane=e.pane||$("#paneRender").data("kendoMobilePane"),e.view&&e.view.element.hide("slide",{direction:"left"},300),e.editionView.element.hide(0).show("slide",{direction:"right"},300,function(){$(this).css("display","block"),e.pane.navigate(e.editionView.id),e.configureEditViewHandlers()})},renderEdition:function(){var e=this;e.inputEdition=kendo.template(e.getTemplate("edit-activity-preview-tmpl"),{useWithBlock:!1});var t=e.data.caseDetails.currentState[0].idActivity,i=e.data.caseDetails.plan.activities.filter(function(e){return e.id===t})[0],a={finishDate:i.estimatedFinishDate||null,duration:i.duration||null},n=e.inputEdition(a);$("#render-content",e.editionView.content).append(n),e.configureView(e.editionView.content,a),e.configureEditFormHandlers()},configureView:function(e,t){var i=this;t.duration?($(".edit-activity-clear-button.clear-end-date",e).hide(),$(".edit-activity-clear-button.clear-duration",e).show(),$("input.bz-rn-text-edit-activity.bz-rn-finish-date",e).prop("disabled",!0),$("input.bz-rn-text-edit-activity.bz-rn-numeric",e).prop("disabled",!1),$("input.bz-rn-text-edit-activity.bz-rn-numeric",e).val(t.duration)):t.finishDate?($(".edit-activity-clear-button.clear-duration",e).hide(),$(".edit-activity-clear-button.clear-end-date",e).show(),$("input.bz-rn-text-edit-activity.bz-rn-finish-date",e).prop("disabled",!1),$("input.bz-rn-text-edit-activity.bz-rn-numeric",e).prop("disabled",!0),i.setDisplayValue(new Date(t.finishDate),e),i.configureMobiscrollPlugin(e,t)):($(".edit-activity-clear-button.clear-duration",e).hide(),$(".edit-activity-clear-button.clear-end-date",e).hide(),$("input.bz-rn-text-edit-activity.bz-rn-finish-date",e).prop("disabled",!1),$("input.bz-rn-text-edit-activity.bz-rn-numeric",e).prop("disabled",!1),$("input.bz-rn-text-edit-activity.bz-rn-numeric",e).val(""),$("input.bz-rn-text-edit-activity.bz-rn-finish-date",e).val(""),i.configureMobiscrollPlugin(e,t))},configureMobiscrollPlugin:function(e,t){var i=this,a=t.finishDate?new Date(t.finishDate):new Date;$("input.bz-rn-text-edit-activity.bz-rn-finish-date",e).mobiscroll().calendar({mode:"mixed",display:"bottom",controls:["calendar"],defaultValue:a,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||"en",dateFormat:"MM-dd-yyyy",buttons:["set",{text:bizagi.localization.getResource("render-plugin-search-users-clear-button-name"),handler:function(e,t){i.onChangeHandler(!0),t.hide()}},"cancel"],onSet:function(e,t){i.date=e.valueText,i.onChangeHandler(!1)}})},onChangeHandler:function(e){var t=this;if(e){$("input.bz-rn-text-edit-activity.bz-rn-finish-date",t.editionView.content).val("");var i={finishDate:null,duration:null};t.configureView(t.editionView.content,i)}else{var a=t.date.split("-");$("input.bz-rn-text-edit-activity.bz-rn-finish-date",t.editionView.content).val(a[1]+"/"+a[0]+"/"+a[2])}},configureEditFormHandlers:function(){var e=this;$("#activity-form-assignee",e.editionView.content).bind("click",function(t){e.initAutoCompletePlugin(t)}),$(".ui-bizagi-wp-project-popupform-action-update",e.editionView.content).bind("click",function(t){var i=$("input.bz-rn-text-edit-activity.bz-rn-numeric",e.editionView.content).val(),a=$("input.bz-rn-text-edit-activity.bz-rn-finish-date",e.editionView.content).val();""===i&&""===a||e.updateActivityPlan(i,e.date,t)}),$(".edit-activity-clear-button.clear-end-date",e.editionView.content).bind("click",function(t){e.configureView(e.editionView.content,{duration:void 0,finishDate:void 0})}),$("input.bz-rn-text-edit-activity.bz-rn-finish-date",e.editionView.content).change(function(){var t=$(this).val();""!==t?e.configureView(e.editionView.content,{duration:void 0,finishDate:t}):e.configureView(e.editionView.content,{duration:void 0,finishDate:void 0})}),$(".edit-activity-clear-button.clear-duration",e.editionView.content).bind("click",function(t){e.configureView(e.editionView.content,{duration:void 0,finishDate:void 0})}),$("input.bz-rn-text-edit-activity.bz-rn-numeric",e.editionView.content).keyup(function(){var t=$(this).val();""!==t?e.configureView(e.editionView.content,{duration:t,finishDate:void 0}):e.configureView(e.editionView.content,{duration:void 0,finishDate:void 0})})},setDisplayValue:function(e,t){var i=this,a=i.properties||{};a.dateFormat="dd/MMMM/yyyy";var n=bizagi.util.dateFormatter.formatDate(e,a.dateFormat);$("input.bz-rn-text-edit-activity.bz-rn-finish-date",t).prop("min",n),$("input.bz-rn-text-edit-activity.bz-rn-finish-date",t).val(n)},initAutoCompletePlugin:function(){return this.onSelectAssignee()},onSelectAssignee:function(e){this.formEditActivity.assignee.element.data("id",1)},updateActivityPlan:function(e,t,i){var a=this,n=a.data.caseDetails.currentState[0].idActivity,r=a.data.caseDetails.plan.activities.filter(function(e){return e.id===n})[0],o=bizagi.currentUser.idUser,s=t?new Date(t):void 0,l={progress:r.progress,id:r.id,startDate:r.startDate,duration:e?parseInt(e):void 0,userAssigned:o,allowEdition:r.allowEdition,description:r.description,name:r.name,idPlan:r.idPlan,estimatedFinishDate:s?s.getTime():void 0,finishDate:r.finishDate},c={items:r.items,activity:l};$.when(a.callUpdateActivity(c)).done(function(){r=$.extend(r,l),$.when(a.dataPlan.getPlanData(a.data)).then(function(e){a.data.caseDetails.plan=e,$.when(a.activityPlanStateSummary.getActivityPlanStateData(a.data)).done(function(e){a.data.dataActivityPlanState=e,a.updateActivityState(a.data),a.goBack(),a.posNavigate()})})})},callUpdateActivity:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.editActivityPlan(e)).done(function(){i.resolve()}).always(function(e,t,i){i.status}),i.promise()},configureEditViewHandlers:function(){var e=this;$(".bz-render-back",e.editionView.element).off(e.Class.BIZAGI_TAP_EVENT).on(e.Class.BIZAGI_TAP_EVENT,function(){e.goBack(),e.posNavigate()})},posNavigate:function(){var e=this;e.editionView.element.show(0).hide("slide",{direction:"right"},300),e.view&&e.view.element.hide(0).show("slide",{direction:"left"},300,function(){$(this).css("display","block")})},goBack:function(){this.pane.navigate("#:back")},routingExecute:function(e){var t=this,i=new $.Deferred;if(e){var a=e.data("case")||t.params.idCase,n=e.data("workitem")||"",r=e.data("task")||"",o=e.data("displayname")||t.params.displayName,s=bizagi.util.parseBoolean(e.data("eventastasks"));t.hideSummaryDrawer(),setTimeout(function(){t.publish("changeCase",{idCase:a,idWorkitem:n,idTask:r,displayName:o,isSummaryModal:!0,isEvent:s}),i.resolve(!0)},500)}else i.resolve(!1);return i.promise()},callGetDataUsers:function(e){var t=this,i=$.Deferred(),a={userIds:e,width:50,height:50};return t.dataService.getUsersData(a).always(function(e){for(var a=t.assignees,n=0,r=a.length;n<r;n++)for(var o=0,s=e.length;o<s;o++)a[n].idUser==e[o].id&&(a[n].picture=e[o].picture?"data:image/png;base64,"+e[o].picture:void 0);i.resolve()}),i.promise()},renderUserProfilesAndImages:function(){for(var e=this,t=e.assignees,i=0,a=t.length;i<a;i++)t[i].picture&&$("li[data-iduser='"+t[i].idUser+"'] img",e.content).attr("src",t[i].picture)},updateProgressUI:function(e,t){$(".remaining-days .days",t).text(e);$(".remaining-days .time-remaining",t);$(".remaining-days .bar-completed",t).css("width",e.toString()+"%")},updateProgressActivityState:function(e){var t=this;$(".remaining-days .time-remaining",e).css("padding-left","1px"),$(".remaining-days .bar-completed",e).css("width",t.data.dataActivityPlanState.percentBar+"%")},callUpdatePlan:function(e){var t=this;return $.when(t.dataService.updatePlan(e)).done(function(){$.extend(t.params.plan,e)})}}),bizagi.workportal.webparts.summaryCase.extend("bizagi.workportal.webparts.summaryCase",{COMMENT_SIZE:5},{}),bizagi.workportal.webparts.summaryCase.extend("bizagi.workportal.webparts.summaryCase",{},{init:function(e,t,i){this._super(e,t,i)},hideSummaryDrawer:function(){},renderSummary:function(e){var t=this,i=new $.Deferred;t.params=e||{},t.cache={};var a=e.isOfflineForm||!bizagi.util.isVersionSupported(),n=void 0!==t.params.caseDetails.estimatedSolutionDate?t.params.caseDetails.estimatedSolutionDate:t.params.caseDetails.solutionDate;if(a&&(n=n||t.params.caseDetails.creationDate),e.isOfflineForm){var r=t.params.caseDetails.radNumber;t.params.caseDetails.caseNumber=r||t.params.idCase,void 0===t.params.caseDetails.params&&(t.params.caseDetails.params={displayName:e.displayName})}t.data=t.params;var o=t.summaryCaseTemplate(t.data);if(t.createSummaryView(o),a){var s=new Date(t.data.caseDetails.creationDate),l=t.getResource("dateFormat")+" "+t.getResource("timeFormat"),c=bizagi.util.dateFormatter.formatDate(s,l),d=$.extend({},t.data.caseDetails);d.creationDate=c,$("#summary-case").addClass("basic-summary"),t.renderBasicSummaryCase(d)}else $("#summaryCaseBasic",t.content).hide(),bizagi.util.isEmpty(t.data.caseDetails.idPlan)?(t.renderSummaryCase(),i.resolve()):$.when(t.dataPlan.getPlanData(t.data)).then(function(e){t.data.caseDetails.plan=e,t.renderSummaryCase()}).always(function(){i.resolve()});return t.data.currentState&&t.data.currentState.length>0&&void 0!==t.data.currentState[0].allowReleaseActivity&&t.data.currentState[0].allowReleaseActivity&&$(".bz-wp-summary-release",t.content).bind("click",function(){t.release(e)}),i.promise()},createSummaryView:function(e){var t=this;if(t.params={title:t.getResource("workportal-taskfeed-summary")},t.view)$("#render-content",t.view.content).empty();else{var i=$($.kendoTmpl(t.getTemplate("summary-view"),t.params));$("#paneRender").append(i),t.view=new kendo.mobile.ui.View(i,{useNativeScrolling:!0})}t.pane=t.pane||$("#paneRender").data("kendoMobilePane"),t.view.element.hide(0).show("slide",{direction:"right"},300,function(){$(this).css("display","block"),t.pane.navigate(t.view.id),t.configureViewHandlers()}),$("#render-content",t.view.content).append(e)},configureViewHandlers:function(){var e=this;$(".bz-render-back",e.view.element).off(e.Class.BIZAGI_TAP_EVENT).on(e.Class.BIZAGI_TAP_EVENT,function(){e.goBack(),e.view.element.show(0).hide("slide",{direction:"right"},300)}),e.view.element.off("click").on("click",".summaryLink",function(t){t.preventDefault(),e.routingExecute($(this)),e.cache={}})}}),bizagi.workportal.webparts.summaryCase.extend("bizagi.workportal.webparts.summaryCase",{},{createSummaryView:function(e){var t=this;t._super(e),bizagi.util.isNativeHeaderEnabled()&&t.view.header.hide()},initViewFile:function(){var e=this;e._super(),bizagi.util.isNativeHeaderEnabled()&&(e.editionView.header.hide(),bizagiapp.openActivityFormEdition())},goBack:function(){
bizagi.util.isNativeHeaderEnabled()&&bizagi.util.isAndroidDevice()?bizagiapp.backToSummaryCase():this._super()},routingExecute:function(e){var t=this;if(bizagi.util.isNativeHeaderEnabled()&&null!=e&&bizagi.util.isAndroidDevice()){var i=e.data("case")||t.params.idCase,a=e.data("workitem")||"",n=e.data("displayname")||t.params.displayName,r=e.data("radnumber")||t.params.radNumber;bizagiapp.updateCaseDetails({idCase:i,radNumber:r,idWorkItem:a,displayName:n})}return t._super(e)}}),function(e){e.fn.bztabs=function(t){function i(){t.tabNumber<l?(e(".bz-wp-tabs-arrow-container",r).first().addClass("show-pluss"),c.addClass("show-pluss"),m.trigger("click",{origin:"popUp"})):(e(".bz-wp-tabs-arrow-container",r).first().removeClass("show-pluss"),c.removeClass("show-pluss"),c.find("> .bz-wp-tabs-ui:last").addClass("bz-wp-no-border"))}function a(e){var t=c.find(".bz-wp-tabs-ui"),i=!0;t.each(function(t,a){e!==a.getAttribute("data-reference-tab")&&i?(c.remove("[data-reference-tab='"+e+"']"),c.append(a)):i=!1})}function n(t,i){if(i=i||{},i.origin=i.origin||"header",t.stopPropagation(),t.preventDefault(),!e(this).hasClass("tabSelected")||"popUp"===i.origin){var n=t.currentTarget.getAttribute("data-reference-tab"),l=e(n,r);m=e(t.currentTarget),r.find(">div.childrenActive").removeClass("childrenActive"),l.addClass("childrenActive"),c.find(">div.tabSelected").removeClass("tabSelected").css("width",u+"%"),"block"===s.css("display")&&s.toggle(),i.origin&&"popUp"===i.origin&&(m=e("[data-reference-tab='"+n+"']",c),a(n)),m.addClass("tabSelected").css("width",f+"%"),o(t,i)}}var r=e(this);t=t||{},t.activeTab=t.activeTab||0,t.tabNumber=t.tabNumber||1;var o=t.activate&&"function"==typeof t.activate?t.activate:function(){},s=(t.beforeActivate&&"function"==typeof t.beforeActivate&&t.beforeActivate,r.find(">div.bz-bizagi-container-tap-popup").hide()),l=s.children().length,c=e("<div class='bz-header_select'></div>"),d=t.tabNumber>l?l:t.tabNumber,u=Math.floor(100/Number(d));s.children().each(function(e,t){c.append("<div class='bz-wp-tabs-ui bz-wp-tabs-item' data-index='"+e+"' data-reference-tab='"+t.getAttribute("data-reference-tab")+"'><span>"+t.textContent+"</span></div>")}),c.find("> .bz-wp-tabs-ui").css("width",u+"%"),c.append("<div class='bz-wp-tabs-arrow-container'><div class='bz-cm-icon bz-mo-icon bz-plus'></div></div>"),r.prepend(c);var p=r.find("> .bz-bizagi-container-tap-popup > .bz-container-items-tabs").eq(t.activeTab);e(e(p).data("reference-tab"),r).addClass("childrenActive"),p.addClass("tabSelected");var m=e(".bz-wp-tabs-ui:nth-child("+(t.activeTab+1)+")",c).addClass("tabSelected"),f=u+(100-u*d);m.css("width",f+"%"),void 0!==t.domIncluded?e.when(t.domIncluded).done(function(){i()}):i(),r.find(".bz-wp-tabs-arrow-container").first().bind("click",function(t){var i=c.innerWidth()-29,a=0;e(".bz-container-items-tabs",s).removeClass("show"),c.find(".bz-wp-tabs-ui").each(function(t,n){(a+=e(":first-child",n).outerWidth())>i&&s.children().each(function(t,i){if(i.textContent===n.textContent)return e(i).addClass("show"),e(".cell.bz-container-items-tabs").css("border-bottom",""),void e(".cell.bz-container-items-tabs.show").last().css("border-bottom","none")})}),t.stopPropagation(),t.preventDefault(),s.toggle()}),e(">div.cell",s).bind("click",function(e){n(e,{origin:"popUp"})}),e(".bz-wp-tabs-ui",c).bind("click",n),c.bind("resizeHeader",function(){i()})}}(jQuery),$.Class.extend("bizagi.workportal.webparts.summaryCase.activitySummary",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e,a.datePickerRegional=bizagi.localization.getResource("datePickerRegional")},getActivitiesData:function(e){var t=new $.Deferred,i=this,a=e;i.data=e,i.params=a;var n={},r=a.caseDetails.currentState.filter(function(e){return e.idWorkItem==i.params.idWorkitem})[0];if(r){n.activityName=r.state,n.activityIsEvent=bizagi.util.parseBoolean(r.isEvent);var o=bizagi.util.dateFormatter.getDateFromFormat(r.entryDateWorkItem,"MM/dd/yyyy H:mm");o.getTime&&(n.initDateFormat=i.getFormattedDate(o));var s=new Date,l=bizagi.util.dateFormatter.getDateFromFormat(r.estimatedSolutionDate,"MM/dd/yyyy H:mm");n.estimatedSolutionDateFormat="",o.getTime&&l.getTime&&r?$.when(i.calculateDataForActivityState(r,n,o,s,l)).done(function(){t.resolve(n)}):t.resolve(n)}else t.resolve("No WorkItems");return t.promise()},calculateDataForActivityState:function(e,t,i,a,n){var r=new $.Deferred,o=this,s=(new Date(Date.now()-i.getTime()),a.getTime()-n.getTime()),l=i.getTime()-n.getTime(),c={idUser:bizagi.currentUser.idUser,fromDate:i.getTime(),toDate:Date.now()},d=!1,u={idUser:bizagi.currentUser.idUser,fromDate:a.getTime(),toDate:n.getTime()},p={};return s>0?(u.fromDate=n.getTime(),u.toDate=a.getTime(),d=!0):(p.idUser=bizagi.currentUser.idUser,p.fromDate=i.getTime(),p.toDate=n.getTime()),$.when(o.callGetEffectiveDuration(c),o.callGetEffectiveDuration(u),o.callGetEffectiveDuration(p)).done(function(i,a,s){var c=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-6e4*i.minutes),null,!0);if(t.colorState=e.colorState,t.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",c),t.percentCompleteBar=100,0===l)t.showEstimatedSolutionDate=!1;else if(t.showEstimatedSolutionDate=!0,!1===d){var u=o.getPercentBar(s.minutes,a.minutes);t.percentCompleteBar=u.percent}e&&(t.isEvent=bizagi.util.parseBoolean(e.isEvent)),t.estimatedSolutionDateFormat=o.getFormattedDate(n),r.resolve()}),r.promise()},getFormattedDate:function(e){return this.datePickerRegional.monthNames[e.getMonth()]+" "+kendo.toString(e,"dd")},callGetEffectiveDuration:function(e){var t=this,i=$.Deferred();return e.fromDate?$.when(t.dataService.getEffectiveDuration(e)).done(function(e){i.resolve(e)}):i.resolve(null),i.promise()},getPercentBar:function(e,t){var i={};return i.percent=Math.round(100*(1-t/e)),i}}),$.Class.extend("bizagi.workportal.webparts.summaryCase.assigneesSummary",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e},getAssigneesData:function(e){var t=this,i=e,a=new $.Deferred;return t.data=e,t.params=i,$.when(t.getDataUsersAssignedAndOwner(i)).done(function(e){var n=$.map(e,function(e){return e.idUser}),r=n.join(",");t.users=e;var o,s={},l=[];$.each(e,function(e,i){$.each(t.users,function(e,t){t.idUser==i.idUser&&(o?o.types.indexOf(t.typeUser)<0&&(o.types+=", "+t.typeUser):o={types:i.typeUser})}),s[i.idUser]||(s[i.idUser]=!0,i.types=o.types,l.push(i)),o=void 0}),i.caseDetails.assigneesUsers=l,a.resolve(r)}).fail(function(){a.reject()}),a.promise()},getDataUsersAssignedAndOwner:function(e){var t=this,i=$.Deferred();return $.when(t.getDataUsersAssigned(e),t.getDataUserOwner(e)).done(function(e,t){e.splice(0,0,t),i.resolve(e)}),i.promise()},getDataUsersAssigned:function(e){var t=this,i=$.Deferred(),a=[];return e.caseDetails.countAssigness>0?$.when(t.callGetCaseAssignees(e.caseDetails.idCase)).done(function(e){if(e.assignees)for(var t=0;t<e.assignees.length;t++)a.push({idUser:e.assignees[t].idUser||-1,name:e.assignees[t].Name,isEvent:e.assignees[t].isEvent,typeUser:bizagi.localization.getResource("workportal-project-user-assigned"),taskName:e.assignees[t].taskName});i.resolve(a)}):i.resolve(a),i.promise()},getDataUserOwner:function(e){var t=$.Deferred();return t.resolve({idUser:e.caseDetails.createdBy.userId||-1,name:e.caseDetails.createdBy.Name,typeUser:bizagi.localization.getResource("workportal-project-user-owner")}),t.promise()},callGetCaseAssignees:function(e){var t=this,i=$.Deferred();return $.when(t.dataService.getCaseAssignees({idCase:e})).done(function(e){i.resolve(e)}),i.promise()}}),$.Class.extend("bizagi.workportal.webparts.summaryCase.caseSummary",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e,a.datePickerRegional=bizagi.localization.getResource("datePickerRegional")},getCaseData:function(e){var t=this,i=new $.Deferred;t.data=e;var a=e,n={};n.isFavoriteCase="off",n.currentState=e.caseDetails.currentState,JSON.parse(a.caseDetails.isFavorite)?n.isFavoriteCase="bz-favorites-full":n.isFavoriteCase="bz-favorites";var r=bizagi.util.dateFormatter.getDateFromFormat(a.caseDetails.creationDate,"MM/dd/yyyy H:mm");n.creationDateFormat=t.getFormattedDate(r);var o=bizagi.util.dateFormatter.getDateFromFormat(a.caseDetails.solutionDate,"MM/dd/yyyy H:mm");n.solutionDateFormat=t.getFormattedDate(o);var s=new Date,l=!(!t.data||!t.data.caseDetails)&&t.data.caseDetails.isOpen;return $.when(t.calculateDataForCaseState(n,r,s,o,l)).done(function(a){if(bizagi.util.isCaseSummaryTaskOptionsSupported()&&void 0!=e.idWorkitem&&e.idWorkitem>0)return $.when(t.callGetSummaryCaseTaskOptions(e)).done(function(e){a.allowReleaseEnabled=e.allowRelease||!1}).always(function(){i.resolve(a)});i.resolve(a)}).fail(function(e){i.reject(e)}),i.promise()},getFormattedDate:function(e){return this.datePickerRegional.monthNames[e.getMonth()]+" "+kendo.toString(e,"dd")},calculateDataForCaseState:function(e,t,i,a,n){var r=this,o=new $.Deferred,s=e;n=bizagi.util.parseBoolean(n)||!1;var l={};return l.idUser=bizagi.currentUser.idUser,n?(l.fromDate=t.getTime(),l.toDate=i.getTime()):(l.fromDate=a.getTime(),l.toDate=i.getTime()),$.when(r.callGetEffectiveDuration(l)).done(function(e){var t=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-6e4*e.minutes),null,!1);if(n?(s.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",t),s.colorStateCase="Opened"):(s.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",t),s.colorStateCase="Closed"),s.percentCompleteBar=100,s.isOpen=n,s.allowReleaseEnabled=!1,s.currentState&&s.currentState.length>0){var i=r.data?s.currentState.find(function(e){return e.idWorkItem==r.data.idWorkitem}):s.currentState[0];s.allowReleaseEnabled=i&&void 0!==i.allowReleaseActivity&&i.allowReleaseActivity}o.resolve(s)}).fail(function(e){o.reject(e)}),o.promise()},callGetEffectiveDuration:function(e){var t=this,i=$.Deferred();return e.fromDate?$.when(t.dataService.getEffectiveDuration(e)).done(function(e){i.resolve(e)}):i.resolve(null),i.promise()},callGetSummaryCaseTaskOptions:function(e){var t=this,i=$.Deferred();return $.when(t.dataService.getSummaryCaseTaskOptions(e)).then(function(e){i.resolve(e)}).fail(function(e){i.reject(e)}),i.promise()}}),$.Class.extend("bizagi.workportal.webparts.summaryCase.eventsSummary",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e},getEventsData:function(e){var t=this,i=e,a=$.Deferred();return t.data=e,t.params=i,$.when(t.dataService.summaryCaseEvents({idCase:e.idCase})).done(function(e){a.resolve(e)}).fail(function(){a.reject()}),a.promise()}}),$.Class.extend("bizagi.workportal.webparts.summaryCase.parentSummary",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e},getParentData:function(e){var t=this,i=e,a=new $.Deferred;t.data=e,t.params=i;var n={};return n.showParentProcess=i.idParentCase>=1,n.parentProcess={displayName:i.parentDisplayName,idCase:i.idParentCase},$.when(t.dataService.getWorkitems({idCase:t.params.idCase})).done(function(e){i.dataParentProcess=n,i.dataParentProcess.WorkItem=e.workItems[0],a.resolve(e)}),a.promise()}}),$.Class.extend("bizagi.workportal.webparts.summaryCase.subprocessSummary",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e},getSubprocessData:function(e){var t=this,i=e,a=$.Deferred();return t.data=e,t.params=i,$.when(t.dataService.summarySubProcess({idCase:e.idCase})).done(function(e){a.resolve(e)}).fail(function(){a.reject()}),a.promise()}}),$.Class.extend("bizagi.workportal.webparts.summaryCase.actionsSummary",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e},getActionsData:function(e){var t=this,i=new $.Deferred;t.data=e;var a=t.data.caseDetails.plan.activities.filter(function(e){return e.id==t.data.caseDetails.currentState[0].idActivity})[0];return i.resolve(a),i.resolve()}}),$.Class.extend("bizagi.workportal.webparts.summaryActivityPlan.stateActivity",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e,a.EXECUTING_ACTIVITY="EXECUTING",a.FINISHED_ACTIVITY="FINISHED",a.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),a.dataPlan=new bizagi.workportal.webparts.summaryActivityPlan.dataPlan(e,t,i)},getActivityPlanStateData:function(e){var t=this,i=new $.Deferred;t.data=e;var a=t.data.caseDetails.plan.activities.filter(function(e){return e.idWorkItem==t.data.idWorkitem})[0];if(a.startDate){t.getStateActivity(a);var n={time:{fromDate:t.getFormattedDate(new Date(t.getFirstDate(a)))}},r=t.getDataByScenarios(a);$.when(r.unitTime).done(function(e){r=$.extend(r,{unitTime:e});var a=t.updateDataWidget($.extend(n.time,r));i.resolve(a)})}return i.promise()},updateDataWidget:function(e){var t=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-60*e.unitTime.minutes*1e3),null,!1),i=bizagi.localization.getResource("workportal-project-activity-state-"+e.keywordResource);return e.messageTime=i.replace("%s",t),e},getStateActivity:function(e){var t=this;return e.finishDate?(e.currentState=t.FINISHED_ACTIVITY,t.FINISHED_ACTIVITY):(e.currentState=t.EXECUTING_ACTIVITY,t.EXECUTING_ACTIVITY)},getFirstDate:function(e){var t=this;return e.currentState===t.EXECUTING_ACTIVITY?e.startDate:e.finishDate},getDataByScenarios:function(e){var t=this,i={colorBar:null,percentBar:100,keywordResource:null,unitTime:null},a={};switch(e.currentState){case t.EXECUTING_ACTIVITY:i.keywordResource="opened",i.colorBar=t.getColorByCreatedAndEstimatedDate(e),a={idUser:bizagi.currentUser.idUser,fromDate:e.startDate,toDate:Date.now()},i.unitTime=t.callGetEffectiveDuration(a);break;case t.FINISHED_ACTIVITY:i.colorBar="Gray",i.keywordResource="closed",a={idUser:bizagi.currentUser.idUser,fromDate:e.finishDate,toDate:Date.now()},i.unitTime=t.callGetEffectiveDuration(a)}return i},getColorBar:function(e){return this.getDataByScenarios(e).colorBar},getPercentBar:function(e){return this.getDataByScenarios(e).percentBar},getKeywordResourceDescriptionBar:function(e){return this.getDataByScenarios(e).keywordResource},getUnitTime:function(e){return this.getDataByScenarios(e).unitTime},getColorByCreatedAndEstimatedDate:function(e){var t="Red";if(e.estimatedFinishDate&&Date.now()<e.estimatedFinishDate){t=(new Date).getUTCDate()===new Date(e.estimatedFinishDate).getUTCDate()?"Yellow":"Green"}return t},getFormattedDate:function(e){return this.datePickerRegional.monthNames[e.getMonth()]+" "+bizagi.util.dateFormatter.formatDate(e,"dd hh:ss tt",bizagi.localization.getResource("datePickerRegional"))},callGetEffectiveDuration:function(e){var t=this,i=$.Deferred();return $.when(t.dataService.getEffectiveDuration(e)).done(function(e){i.resolve(e)}),i.promise()}}),$.Class.extend("bizagi.workportal.webparts.summaryActivityPlan.dataPlan",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e,a.differenceMillisecondsServer=i.differenceMillisecondsServer,a.tools={arrayUnique:function(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var a=i+1;a<t.length;++a)t[i]===t[a]&&t.splice(a--,1);return t}}},getPlanData:function(e){var t=this,i=new $.Deferred;t.data=e,t.data.caseDetails.plan={};var a={idPlan:t.data.caseDetails.idPlan};return $.when(t.callGetPlan(a)).then(function(e){$.extend(t.data.caseDetails.plan,e,{activities:[],users:[]});var a={idPlan:t.data.caseDetails.idPlan};$.when(t.callGetFirstParent(a)).then(function(e){t.data.caseDetails.plan.firstParent=e;var a={idPlan:t.data.caseDetails.idPlan},n={idPlan:t.data.caseDetails.idPlan},r={idPlan:t.data.caseDetails.idPlan};$.when(t.callGetActivitiesPlan(a),t.callGetWorkitemsPlan(n),t.callGetTransitionsByPlan(r)).then(function(e,a,n){var r=e||[];t.mergePropertiesActivitiesWithWorkitems(r,a),t.data.caseDetails.plan.activities=t.calculateActivityStatus(r),r=t.orderActivitiesByTransitions(r,n),t.data.caseDetails.plan.activities=r,i.resolve(t.data.caseDetails.plan)})}).fail(function(){i.reject()})}).fail(function(){i.reject()}),i.promise()},calculateActivityStatus:function(e){var t,i=this;return i.data.currentState&&i.data.currentState.length>0&&(t=i.data.currentState[0].entryDateWorkItem),$.each(e,function(e,a){if(a.status="nodisplay",a.starDate=t,a.estimatedFinishDate){var n=i.getDateServer(),r=a.estimatedFinishDate-a.startDate,o=a.startDate+.33*r,s=a.startDate+.66*r;a.estimatedFinishDate;n<o?a.status="ontime":o<=n&&n<s?a.status="delayed":s<=n&&(a.status="atrisk")}if(a.items){var l=a.items.filter(function(e){return!0===e.resolved});a.numResolvedItems=l.length,a.numTotalItems=a.items.length,a.numTotalItems>0&&(a.progress=Math.floor(a.numResolvedItems/a.numTotalItems*100))}else a.items=[]}),e},orderActivitiesByTransitions:function(e,t){var i=this,a=[];if(0===t.length)a=e,e.length>1&&e.filter(function(e){e.parallel=!0});else{var n=i.orderTransitionsByFromAndTo(t,e);if(activityGuidsInOrder=n.activitiesInOrder,parallelActivitiesHash=n.parallelActivitiesHash,0===activityGuidsInOrder.length)return e;for(var r=0,o=activityGuidsInOrder.length;r<o;r+=1)a=a.concat(e.filter(function(e){return e.id==activityGuidsInOrder[r]&&parallelActivitiesHash[e.id]&&(e.parallel=!0),e.id==activityGuidsInOrder[r]}))}return a},orderTransitionsByFromAndTo:function(e){function t(n){var r=[],o=[],s=!1;if(n.forEach(function(t){var n=i.getTransitionsByFrom(e,t),l=n.length;l>0&&(s=!0,n.forEach(function(e){r.push(e.idActivityFrom),o.push(e.idActivityTo)}),l>1&&o.forEach(function(e){a[e]=!0}))}),s){var c=i.tools.arrayUnique(r.concat(o));l=i.tools.arrayUnique(l.concat(c)),t(o)}}for(var i=this,a={},n=e.map(function(e){return e.idActivityFrom}),r=e.map(function(e){return e.idActivityTo}),o=[],s=0;s<n.length;s+=1)-1===r.indexOf(n[s])&&(o=i.tools.arrayUnique(o.concat([n[s]])));if(0===o.length&&1===activities.length)return{activitiesInOrder:[activities[0].id],parallelActivitiesHash:[]};o.length>1&&o.forEach(function(e){a[e]=!0});var l=[];return t(o),{activitiesInOrder:l,parallelActivitiesHash:a}},getTransitionsByFrom:function(e,t){return e.filter(function(e){return e.idActivityFrom===t})},callGetItemsByActivity:function(e){var t=this,i=$.Deferred();return t.dataService.getItemsByActivity(e).always(function(e,t,a){200===a.status?i.resolve(e):i.reject()}),i.promise()},callGetWorkitemsPlan:function(e){var t=this,i=$.Deferred();return t.dataService.getWorkitemsPlan(e).always(function(e,t,a){200===a.status?i.resolve(e):i.reject()}),i.promise()},callGetPlan:function(e){var t=this,i=$.Deferred();return t.dataService.getPlan(e).always(function(e){200===e.status||201===e.status||void 0===e.status?i.resolve(e):i.reject()}),i.promise()},callGetActivitiesPlan:function(e){var t=this,i=$.Deferred();return t.dataService.getActivities(e).always(function(e,t,a){200===a.status?i.resolve(e):i.reject()}),i.promise()},callGetTransitionsByPlan:function(e){var t=this,i=$.Deferred();return t.dataService.getTransitionsByPlan(e).always(function(e,t,a){200===a.status?i.resolve(e):i.reject()}),i.promise()},getDateServer:function(){return(new Date).getTime()+this.differenceMillisecondsServer},mergePropertiesActivitiesWithWorkitems:function(e,t){e.forEach(function(e){var i=t.filter(function(t){return t.guidActivity==e.id});i.length>0&&$.extend(e,{startDate:i[0].wiEntryDate||null,finishDate:i[0].wiSolutionDate||null,idWorkItem:i[0].idWorkItem,workItemState:i[0].workItemState,idCase:i[0].idCase,estimatedFinishDate:i[0].wiEstimatedSolutionDate||e.estimatedFinishDate})})},callGetFirstParent:function(e){var t=this,i=$.Deferred();return t.dataService.getFirstParentPlan(e).done(function(e){i.resolve(e)}),i.promise()}}),$.Class.extend("bizagi.workportal.webparts.summaryActivityPlan.progressActivity",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e,a.plugins={},a.dataPlan=new bizagi.workportal.webparts.summaryActivityPlan.dataPlan(e,t,i)},getActivityProgress:function(e){var t=this,i=new $.Deferred;t.data=e;var a=t.data.caseDetails.plan.activities.filter(function(e){return e.idWorkItem==t.data.idWorkitem})[0],n={};return n.valuePercentBarComplete=0,n.progress={progress:a.progress,canEdit:0===a.items.length},n.progress.progress&&(n.valuePercentBarComplete=n.progress.progress),n.progress.progress<=33?n.colorBar="Red":n.progress.progress<=66?n.colorBar="Yellow":n.colorBar="Green",i.resolve(n),i.promise()},resizeSliderProgressActivity:function(){var e=this;e.formEditProgress.sliderProgress.wrapper.css("width","399px"),e.formEditProgress.sliderProgress.resize()},onSubmitFormChangeProgress:function(e,t,i){e.preventDefault();var a=this,n=$.Deferred();a.data=t;var r=a.data.caseDetails.plan.activities.filter(function(e){return e.id==a.data.caseDetails.currentState[0].idActivity})[0],t=$.extend(r,{progress:i});return a.responseOnSubmitFormChangeProgress=t,$.when(a.callEditActivity(t)).then(function(){n.resolve(a.responseOnSubmitFormChangeProgress)}),n.promise()},callEditActivity:function(e){var t=this,i=$.Deferred();return t.dataService.editActivityPlan(e).always(function(e,t,a){200===a.status?i.resolve(e):i.reject()}),i.promise()},clean:function(){var e=this;e.plugins&&e.cleanWidgets(e.plugins.popupEditProgress),e.formEditProgress&&(e.cleanWidgets(e.formEditProgress.sliderProgress),e.cleanWidgets(e.formEditProgress.numericTextBoxPlugin))},cleanWidgets:function(e){e&&kendo.destroy(e)}}),$.Class.extend("bizagi.workportal.webparts.summaryActivityPlan.parentActivity",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e,a.dataPlan=new bizagi.workportal.webparts.summaryActivityPlan.dataPlan(e,t,i)},getActivityParent:function(e){var t=this,i=new $.Deferred;return t.data=e,$.when(t.dataService.getPlanParent({idPlan:t.data.caseDetails.plan.id})).done(function(e){var t={};t.parent={idParent:e.radNumber,nameParent:e.displayName,idCase:e.idCase,idWorkflow:e.idWorkflow,idWorkItem:e.idWorkItem,idTask:e.idTask},i.resolve(t)}).fail(function(e){i.reject()}),i.promise()}}),$.Class.extend("bizagi.workportal.webparts.summaryActivityPlan.assigneesActivity",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e,a.usersMap={},a.dataPlan=new bizagi.workportal.webparts.summaryActivityPlan.dataPlan(e,t,i)},getActivityAssignees:function(e){var t=this,i=[],a=[],n=new $.Deferred;t.data=e;var r=t.data.caseDetails.plan.idUserCreator;a.push({idUser:r,userType:["owner"]}),t.usersMap["-"+r+"-"]={picture:"",id:r,name:"",userType:["owner"]},i.push(r),$.each(t.data.caseDetails.plan.activities,function(e,n){var o=n.userAssigned;o===r?-1===$.inArray("Assigned",a[0].userType)&&(a[0].userType.push("Assigned"),t.usersMap["-"+r+"-"].userType.push("Assigned")):(t.usersMap["-"+o+"-"]={picture:"",id:o,name:"",userType:["Assigned"]},0===a.filter(function(e){return e.idUser==o}).length&&(a.push({idUser:o,userType:["Assigned"]}),i.push(o)))});var o,s=[],l={},c={},e={userIds:i.join(),width:50,height:50};return $.when(t.dataService.getUsersData(e)).always(function(e){for(var t=0,r=e.length;t<r;t+=1)c[e[t].id]=e[t].name;$.each(a,function(e,t){$.each(t.userType,function(e,t){o?o.types.indexOf(t)<0&&(o.types+=", "+t):o={types:t}}),l[t.idUser]||(l[t.idUser]=!0,t.types=o.types,t.name=c[t.idUser],s.push(t)),o=void 0}),n.resolve({assignees:s,cvsUsers:i.join()})}),n.promise()}}),$.Class.extend("bizagi.workportal.webparts.summaryPlan.progressPlan",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e},getPlanProgressData:function(e){var t=this,i=new $.Deferred;t.data=e;var a=t.calculateProgress(),n={};return n.progress=a,n.progress<33?n.colorBar="Red":n.progress<66?n.colorBar="Yellow":n.colorBar="Green",i.resolve(n),i.promise()},calculateProgress:function(){var e=this,t=0,i=e.data.caseDetails.plan.activities.length,a=0;return 0!==i&&(e.data.caseDetails.plan.activities.forEach(function(e){e.finishDate&&t++}),a=Math.round(t/i*100)),a}}),$.Class.extend("bizagi.workportal.webparts.summaryPlan.timePlan",{},{init:function(e,t,i){var a=this;a.canvas=i.canvas,a.dataService=t,a.workportalFacade=e,a.PENDING_PLAN="PENDING",a.EXECUTING_PLAN="EXECUTING",a.CLOSED_PLAN="CLOSED",a.datePickerRegional=bizagi.localization.getResource("datePickerRegional")},getPlanTimeData:function(e){var t=this,i=new $.Deferred;t.data=e;var a;return t.data.caseDetails.plan.dueDate?t.data.caseDetails.plan.currentState===t.PENDING_PLAN||t.data.plan.currentState===t.EXECUTING_PLAN?$.when(t.updateWidget(t.data)).done(function(e){i.resolve(e)}):(a="ok1",i.resolve(a)):(a="thereArentDueDate",i.resolve(a)),i.promise()},updateWidget:function(e){var t=this;t.data=e;var i=new $.Deferred;return t.data.caseDetails.plan.currentState===t.CLOSED_PLAN?i.resolve(t.getClosedDatePlan(t.data.caseDetails.plan)):($.when(t.getIntervalOnMinutes(t.data.caseDetails.plan)).done(function(e){var a=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-60*e*1e3),null,!0),n=a.replace(/\d/g,""),r=t.getKeywordDifferenceDates(t.data.caseDetails.plan),o=bizagi.localization.getResource("workportal-project-plan-state-"+r);o=o.replace("%s",n);var s=a.replace(/\D/g,""),l=t.getSecondDate(t.data.caseDetails.plan),c=t.getWidthBar(t.data.caseDetails.plan),d=t.getColorBarByPercent(c),u={fromDate:t.getFormattedDate(new Date(t.getFirstDate(t.data.caseDetails.plan))),toDate:l?t.getFormattedDate(new Date(l)):null,valueOfTimeCalculated:s,messageDescripionDifference:o,percentBar:c,colorBar:d};return i.resolve(u)}),i.promise())},getFirstDate:function(e){var t=this;switch(e.currentState){case t.PENDING_PLAN:return e.dueDate?e.dueDate:e.creationDate;case t.EXECUTING_PLAN:case t.CLOSED_PLAN:return e.startDate}},getSecondDate:function(e){var t=this;switch(e.currentState){case t.PENDING_PLAN:return null;case t.EXECUTING_PLAN:return e.dueDate;case t.CLOSED_PLAN:return e.closedDate}},getLastActivity:function(e){return JSON.parse(JSON.stringify(e)).sort(function(e,t){return e.finishDate<t.finishDate?1:-1})[0]},getClosedDatePlan:function(e){var t=this;return e.closedDate=t.getLastActivity(e.activities).finishDate,e.closedDate},getDifferenceBetweenDates:function(e,t){var i=this,a=$.Deferred(),n={idUser:bizagi.currentUser.idUser,fromDate:e,toDate:t};return $.when(i.callGetEffectiveDuration(n)).done(function(e){a.resolve(e.minutes)}),a.promise()},getIntervalOnMinutes:function(e){var t=this,i=$.Deferred();switch(e.currentState){case t.PENDING_PLAN:e.dueDate>Date.now()?$.when(t.getDifferenceBetweenDates(Date.now(),e.dueDate)).done(function(e){i.resolve(e)}):$.when(t.getDifferenceBetweenDates(e.dueDate,Date.now())).done(function(e){i.resolve(e)});break;case t.EXECUTING_PLAN:e.dueDate?e.dueDate>Date.now()?$.when(t.getDifferenceBetweenDates(Date.now(),e.dueDate)).done(function(e){i.resolve(e)}):$.when(t.getDifferenceBetweenDates(e.dueDate,Date.now())).done(function(e){i.resolve(e)}):$.when(t.getDifferenceBetweenDates(e.startDate,Date.now())).done(function(e){i.resolve(e)});break;case t.CLOSED_PLAN:$.when(t.getDifferenceBetweenDates(e.startDate,e.closedDate)).done(function(e){i.resolve(e)})}return i.promise()},getKeywordDifferenceDates:function(e){var t=this;switch(e.currentState){case t.PENDING_PLAN:return e.dueDate>Date.now()?"remaining":"exceeded";case t.EXECUTING_PLAN:return e.dueDate?e.dueDate>Date.now()?"remaining":"exceeded":"opened";case t.CLOSED_PLAN:return"executed"}},getRelativeTime:function(e){return bizagi.util.dateFormatter.getRelativeTime(e,null,!1)},getWidthBar:function(e){var t=this;switch(e.currentState){case t.PENDING_PLAN:if(e.dueDate){if(e.dueDate<Date.now())return 100;var i=e.dueDate-e.creationDate,a=Date.now()-e.creationDate;return Math.ceil(100*a/i)}return 100;case t.EXECUTING_PLAN:if(e.dueDate){if(e.dueDate>Date.now()){var n=e.dueDate-e.startDate,r=Date.now()-e.startDate;return Math.ceil(100*r/n)}return 100}return 100;case t.CLOSED_PLAN:if(e.closedDate>Date.now()){var o=e.closedDate-e.startDate,r=Date.now()-e.startDate;return Math.ceil(100*r/o)}return 100}},getColorBarByPercent:function(e){return e<33?"Red":e<66?"Yellow":"Green"},callGetEffectiveDuration:function(e){var t=this,i=$.Deferred();return $.when(t.dataService.getEffectiveDuration(e)).done(function(e){i.resolve(e)}),i.promise()},getFormattedDate:function(e){return this.datePickerRegional.monthNames[e.getMonth()]+" "+bizagi.util.dateFormatter.formatDate(e,"dd hh:ss tt",bizagi.localization.getResource("datePickerRegional"))}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.syncErrors",{TEMPLATE_HEADER:"main-syncErrors-kendo-tmpl",TEMPLATE_OFFLINE_CONTENT:"#bz-syncErrors-offline-notification-container",TEMPLATE_NAVBAR_HEADER:".bz-div-syncErrors-navbar-header",SYNC_ERROR_RETRY_BUTTON:".bz-syncError-item-retry",SYNC_DESCRIPTION_OFFLINE_MESSAGE:".bz-wp-status-description",SYNC_HEADER_HOMEPORTAL_DESCRIPTION_OFFLINE_MESSAGE:"span.bz-wp-status-description",ACTIONS:{LONGCLICK:"longClick"},DESIGN:{HEADER_HEIGHT:"bz-div-syncErrors-navbar-header-height"},ITEM_ELEMENTS:{RETRY:"retryButton",CARD:"card"}},{init:function(e,t,i){var a=this;a._super(e,t,i),a.initSyncErrors=!0,a.properties={},a.properties.data=[],a.properties.scrollOffset=0,a.subscribe("bz-update-list-sync-errors-cases",function(e,t){a.view&&a.updateDataList(),a.changeNetworkStatus(a.dataService.online)}),bizagi.webpart.subscribe("homeportalShow-syncErrors",function(e,t){a.updateDataList(),a.configureHandlers(),a.changeNetworkStatus(a.dataService.online)}),a.canvas.unbind("view-initialized"),a.canvas.bind("view-initialized",function(e,t){a.view=t,a.initSyncErrorsKendoView(),a.initSyncErrros||(a.updateDataList(),a.configureHandlers())}),a.subscribe("bz-network-sync-errors-status",function(){a.changeNetworkStatus(a.dataService.online)})},renderContent:function(){var e=kendo.template(this.getTemplate(this.Class.TEMPLATE_HEADER),{useWithBlock:!1});return this.content=e({}),this.content},postRender:function(){this.dataSource=new kendo.data.DataSource({})},loadDataList:function(){var e=this,t=new $.Deferred;return bizagi.loading.start(),e.dataService.getSyncErrorsList().then(function(i){i.forEach(function(t){t.isOnline=e.dataService.online});var a={transport:{read:function(e){e.success(i)}},sort:[{field:"synctimestamp",dir:"desc"}]};e.dataSourceNew=new kendo.data.DataSource(a),t.resolve(e.dataSourceNew),e.changeListState(i.length)}).fail(function(e){bizagi.logError(e.responseText),t.reject("")}).always(function(){bizagi.loading.stop()}),t.promise()},updateDataList:function(){var e=this;$.when(e.loadDataList()).then(function(t){var i=t,a=$("#items-content-syncError",e.content).data("kendoMobileListView");i&&void 0!==a&&a.setDataSource(i),e.options&&e.options.resetScrollAfterLoad&&$("#items-content-syncError",e.content).data("kendoMobileListView").scroller().scrollTo(0,0)}).fail(function(e){bizagi.loading.stop(),bizagi.logError(e.responseText)}).always(function(){bizagi.loading.stop()})},configureHandlers:function(){},clickOnSyncErrorItem:function(e){var t=this;switch(t.whichItemElement(e)){case t.Class.ITEM_ELEMENTS.RETRY:t.onClickOnRetry(e);break;case t.Class.ITEM_ELEMENTS.CARD:default:t.onClickOnCard(e)}},whichItemElement:function(e){var t=this,i=t.Class.ITEM_ELEMENTS.CARD;return t.validateSelector(e,t.Class.SELECTOR_ITEM_ELEMENTS.RETRY)&&(i=t.Class.ITEM_ELEMENTS.RETRY),i},validateSelector:function(e,t){var i=$(e.target);return i.hasClass(t)||1===i.closest(t).length},onClickOnRetry:function(e){var t=this;if(t.dataService.online&&e&&e.dataItem){var i=t.resolveRetryCaseParameters(e.dataItem);bizagi.loading.start(),t.dataService.syncSingleOfflineCase(i).then(function(){bizagi.util.showMobileToast({type:"success",message:bizagi.localization.getResource("workportal-offline-sync-success")})}).fail(function(e){bizagi.util.showMobileToast({type:"error",message:bizagi.localization.getResource("workportal-offline-sync-failed")})}).always(function(){setTimeout(function(){t.updateDataList(),bizagi.loading.stop()},100)})
}},resolveRetryCaseParameters:function(e){return{offlineType:e.offlinetype,idCase:e.idcase,idWorkitem:e.idworkitem,isSingleSync:!0,isRetry:!0}},onClickOnCard:function(e){var t=this;e.preventDefault(),t.setCurrentScrollerOfset(),void 0!==e.dataItem&&($(".bz-wp-item-maindata-container",e.item).data(t.Class.ACTIONS.LONGCLICK)||t.openOnClickCard(e))},setCurrentScrollerOfset:function(){this.properties.scrollOffset=$("#items-content-syncError",this.content).data("kendoMobileListView").scroller().scrollTop,this.properties.scrollOffset=this.properties.scrollOffset<0?-1:this.properties.scrollOffset},openOnClickCard:function(e){this.changeCase(e.dataItem)},changeCase:function(e){bizagi.webpart.publish("changeCase",{idCase:e.idcase,idWorkitem:e.idworkitem,displayName:"start"==e.offlinetype?e.process:e.activity,radNumber:e.radnumber,isOfflineForm:!0,formsRenderVersion:2,isEdited:!0,syncError:e.syncerror,hasSyncError:!0,offlineType:e.offlinetype})},initSyncErrorsKendoView:function(){var e=this;if(e.initSyncErrors&&void 0!==$(e.canvas).data("kendoMobileView")){e.initSyncErrors=!1;var t=e.getTemplate("item-syncErrors-kendo-tmpl"),i=e.getTemplate("pull-loader"),a=e.getTemplate("refresh-loader");$("#items-content-syncError",e.content).kendoMobileListView({dataSource:e.dataSource,template:t,selectable:"single",pullToRefresh:!0,messages:{pullTemplate:i,refreshTemplate:a,releaseTemplate:a},pullParameters:function(){return e.updateDataList()},click:e.clickOnSyncErrorItem.bind(e),dataBound:function(){}}),e.configureHandlers()}},changeNetworkStatus:function(e){var t=this;e?$(t.Class.TEMPLATE_OFFLINE_CONTENT).hide():$(t.Class.TEMPLATE_OFFLINE_CONTENT).show(),setTimeout(function(){t.toggleBehaviorEnabled(e)},250),t.updateDataList()},changeListState:function(e){var t=this;$(t.content).prop("class",e<1?"empty":"")},toggleBehaviorEnabled:function(e){var t=this;e?$(t.Class.TEMPLATE_NAVBAR_HEADER).removeClass(t.Class.DESIGN.HEADER_HEIGHT):($(t.Class.TEMPLATE_NAVBAR_HEADER).addClass(t.Class.DESIGN.HEADER_HEIGHT),$(t.Class.SYNC_DESCRIPTION_OFFLINE_MESSAGE).html($(t.Class.SYNC_HEADER_HOMEPORTAL_DESCRIPTION_OFFLINE_MESSAGE).html()))}}),bizagi.workportal.webparts.syncErrors.extend("bizagi.workportal.webparts.syncErrors",{SELECTOR_ITEM_ELEMENTS:{RETRY:".bz-syncError-item-retry"}},{init:function(e,t,i){this._super(e,t,i)},renderContent:function(e){return this._super(e)},postRender:function(e){var t=this;t._super(e),t.dataSource=new kendo.data.DataSource({group:{field:"group"}})},configureHandlers:function(){this._super()}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.taskFeed",{PAGE_SIZE:10,PAGINATOR_MAX_SIZE:40,NUMBER_OF_FIELDS:-1,BUTTON_OFFLINE_DROPDOWN:".bz-header-offline-btn",TEMPLATE_HEADER:"main-taskFeed-kendo-tmpl",INPUT_TRY_MODE:{DRAFTS:"drafts"},ME_DESTINATION:"dashBoard"},{init:function(e,t,i){var a=this;a._super(e,t,i),a.initTaskfeed=!0,a.properties={},a.properties.page=1,a.properties.pageSize=a.Class.PAGE_SIZE,a.properties.totalPages=0,a.properties.elementPages=a.Class.PAGE_SIZE,a.properties.numberOfFields=a.Class.NUMBER_OF_FIELDS,a.properties.idWfClass=-1,a.properties.data=[],a.properties.scrollOffset=0,a.properties.smartInboxId,a.properties.smartInboxFilter=[],a.routingCalled=!0,a.cacheFavorites={},a.isPaginatorActive=!1,a.isTabletDevice=bizagi.util.isTabletDevice(),a.enableOfflineForm=bizagi.util.hasOfflineFormsEnabled(),a.online=a.dataService.online,a.activitySearch=new bizagi.workportal.activity.search(a.workportalFacade,a.dataService,a),a.subscribe("bz-update-list-cases",function(e,t){t=t||{},a.online=a.dataService.online,a.routingCalled=!0,a.options&&t.page&&t.page>0&&(a.options.page=t.page,a.properties.page=t.page),a.options&&t.resetScrollAfterLoad&&(a.options.resetScrollAfterLoad=t.resetScrollAfterLoad),a.homePortalFramework&&"syncErrors"===a.homePortalFramework.destination&&(t.updateDataList=!1),void 0===t.inboxType&&void 0!==a.properties.inboxType&&(t.inboxType=a.properties.inboxType,t.smartInboxId=t.smartInboxId||a.properties.smartInboxId),t.updateDataList&&a.view&&(void 0!==t.smartInboxId?($("#items-content-taskFeed",a.content).data("kendoMobileListView").scroller().scrollTo(0,0),a.properties.smartInboxId=t.smartInboxId,a.properties.inboxType="smartinbox",a.updateDataList()):void 0===t.mode?($("#items-content-taskFeed",a.content).data("kendoMobileListView").scroller().scrollTo(0,0),a.properties.smartInboxId=void 0,a.properties.inboxType="process",a.updateDataList()):"inbox"==t.mode?a.totalPages&&a.totalPages>4?($("#items-content-taskFeed",a.content).data("kendoMobileListView").scroller().scrollTo(0,0),a.updateDataList()):($("#items-content-taskFeed",a.content).data("kendoMobileListView").scroller().reset(),a.navigateToPage(a.properties.page,a.Class.PAGE_SIZE,!0,null)):($("#items-content-taskFeed",a.content).data("kendoMobileListView").scroller().reset(),a.navigateToPage(1,a.properties.page*a.Class.PAGE_SIZE,!0,null)))}),a.canvas.unbind().bind("view-initialized",function(e,t){a.view=t;var i=a.getTitleTaskFeed();bizagi.util.setKendoViewTitle(t,i),a.initTaskFeedKendoView(),a.initTaskfeed||a.updateDataList(),$(t.content).mfb({click:function(){a.workportalFacade.homePortalFramework.showDrawer("newCase")}})}),a.subscribe("taskfeed-favorites-update",function(e,t){t=t||{},a.setFavorite(t)})},getTitleTaskFeed:function(){var e=this,t=bizagi.util.getLastProcessInboxInputTray(),i=t||"inbox",a=bizagi.localization.getResource("workportal-taskfeed-title");switch(i){case"outbox":case"outbox-new":case"outbox-finished":a=bizagi.localization.getResource("workportal-menu-outbox");break;case e.Class.INPUT_TRY_MODE.DRAFTS:a=bizagi.localization.getResource("workportal-general-word-drafts");break;case"inbox":a=bizagi.localization.getResource("workportal-taskfeed-title")}return a},renderContent:function(){var e=this,t=$.Deferred(),i=kendo.template(e.getTemplate(e.Class.TEMPLATE_HEADER),{useWithBlock:!1});return e.content=i({}),t.resolve(e.content),t.promise()},postRender:function(){this.dataSource=new kendo.data.DataSource({group:{field:"group"}})},setViewStyles:function(){$("#items-content-taskFeed").removeClass("grid-view")},onClickOnCard:function(e){var t=this;e.preventDefault(),t.setCurrentScrollerOfset(),void 0!==e.dataItem&&($(".bz-wp-item-maindata-container",e.item).data("longClick")||(t.isTabletDevice?t.openOnClickCard(e):$(e.target).closest(".bz-wp-item-delete").length?t.deleteDraft(e.dataItem):t.openOnClickCard(e)))},openOnClickCard:function(e){this.changeCase(e.dataItem)},initTaskFeedKendoView:function(){var e=this;if(e.initTaskfeed&&void 0!==$(e.canvas).data("kendoMobileView")){e.initTaskfeed=!1;var t=e.viewType&&"cardView"==e.viewType?e.getTemplate("item-taskFeed-card-kendo-tmpl"):e.getTemplate("item-taskFeed-kendo-tmpl"),i=e.getTemplate("pull-loader"),a=e.getTemplate("refresh-loader");e.isFirstElement=!0,e.setViewStyles(),$("#items-content-taskFeed",e.content).kendoMobileListView({dataSource:e.dataSource,headerTemplate:"#=(value.split('|'))[1]#",fixedHeaders:!0,template:t,selectable:"single",pullToRefresh:!0,messages:{pullTemplate:i,refreshTemplate:a,releaseTemplate:a},pullParameters:function(){if(bizagi.util.isSmartphoneDevice()||e.taskFeedSearch&&"on"!==e.taskFeedSearch.getSearchMode())return e.updateDataListByPullRefresh(e.options)},click:e.clickOnTaskFeedItem.bind(e),dataBound:function(){$(".km-list li",this.element).each(function(){var e=this;$(".bz-wp-item-container",e).data("has-error")&&bizagi.util.isOfflineErrorsViewSupported()&&$(e).addClass("sync-error")}),$(".km-list li:first-child",this.element).each(function(){var t=this;e.firstChild=t;var i=$(e.firstChild).data("status");if($(t).addClass(i).attr("data-status",i),e.isTabletDevice&&$("#items-content-taskFeed").data("kendoMobileListView")&&$("#items-content-taskFeed").data("kendoMobileListView").dataSource){var a={};a.dataItem=$("#items-content-taskFeed").data("kendoMobileListView").dataSource.data()[0],a.dataItem&&e.isFirstElement&&(e.isFirstElement=!1,a.item=$(e.firstChild),e.selectFirstElement())}}),e.isTabletDevice?$(".km-list .bz-wp-item-maindata-container",this.element).longTouchs({}).on("longTouch",function(t){var i=$(t.target).closest("li"),a=i.data("uid"),n=this.dataSource.getByUid(a);e.changeCase(n)}.bind(this)):$(".km-list .bz-wp-item-maindata-container",this.element).longTouchs({}).on("longTouch",function(t){var i=$(t.target).closest("li"),a=i.data("uid"),n=this.dataSource.getByUid(a);void 0!==n&&e.showSummary({dataItem:n,item:i})}.bind(this))}}),e.configureHandlers()}},clickOnTaskFeedItem:function(e){this.onClickOnCard(e)},changeCase:function(e){var t=e.radNumber;void 0==t&&e[6]&&e[6][0]&&e[6][0][1]&&(t="DateTime"!==e[6][0][2]?e[6][0][1]:null),bizagi.webpart.publish("changeCase",{idCase:e[0],idWorkitem:e[1],idTask:e[2],displayName:e[5],radNumber:t,isOfflineForm:e[7]&&!0===e[7]||!1,formsRenderVersion:e[7]&&!0===e[7]?2:0,isEdited:e.isEdited,isOpen:"failed"!==e.syncStatus&&e[8],offlineType:e.offlineType,isEvent:!!e.isEvent&&e.isEvent})},deleteDraft:function(e){var t=this,i=bizagi.localization.getResource("workportal-widget-inbox-delete-case-title");$.when(bizagi.showConfirmationBox(i,"Bizagi","warning")).done(function(){$.when(t.dataService.deleteCase({idCase:e[0]})).done(function(){t.publish("bz-update-list-cases",{updateDataList:!0}),bizagi.webpart.publish("bz-summary-item-clear")}).fail(function(e){bizagi.log(e)})})},setPageParamsOnPullRefresh:function(e,t){var i=this,a=t?i.Class.PAGE_SIZE:e.page*e.pageSize;return t&&i.pageProperties(1),$.extend(e,{page:1,pageSize:a})},pageProperties:function(e){var t=this;return void 0!==e&&(t.properties.page=e),t.properties.page},updateDataListByPullRefresh:function(e){var t=this,i=new $.Deferred,a=t.setPageParamsOnPullRefresh(e,t.isPaginatorActive);t.isPaginatorActive||t.setCurrentScrollerOfset(),a.inputtray=bizagi.util.inputTray(t.online),a.enableOfflineForm=t.enableOfflineForm||!1,a.includeSyncErrors=bizagi.util.isOfflineErrorsViewSupported();var n=t.getActivitiesServiceByView(t.dataService);return $.when(n.call(t.dataService,bizagi.clone(a))).done(function(e){t.viewType&&"cardView"==t.viewType&&(e=t.dataService.adapterDataOfActivitiesToTemplate(t.dataService.adapterServerResponseTemplateBindingObject(e))),t.online?(t.totalPages=e.totalPages,$(".bz-wp-taskfeed-paginator-pages span").html(t.getResource("render-grid-page")+" "+e.page+" "+t.getResource("render-grid-conector")+" "+e.totalPages),t.shouldShowPagination(e)):$(".bz-wp-taskfeed-paginator-container").css("display","none"),i.resolve(e),e.elements&&0===e.elements.length?t.setNoPendingCases():t.setHasPendingCasesStyles(),t.cacheFavorites={},t.selectFirstElement()}).fail(function(e){bizagi.debug(e.responseText),0===$("#items-content-taskFeed li",t.content).length?t.setNoPendingCases():t.setHasPendingCasesStyles(),$("#items-content-taskFeed",t.content).data("kendoMobileListView").scroller().scrollTo(0,-t.properties.scrollOffset),i.reject("")}),bizagi.util.isOfflineErrorsViewSupported()&&t.dataService.updateSyncErrorsStatus(),i.promise()},loadDataList:function(e){var t=this,i=new $.Deferred;e=e||{},t.options=t.options||{},t.options.numberOfFields=t.properties.numberOfFields,t.options.page=e.page||t.properties.page,t.options.idWfClass=t.properties.idWfClass;var a=bizagi.util.getLastProcessInboxProcessInfo(),n=a.idWorkflow,r=null;t.options.idWfClass=r=n?parseInt(n):t.options.idWfClass,t.options.enableOfflineForm=t.enableOfflineForm||!1,t.isPaginatorActive?t.options.pageSize=t.Class.PAGE_SIZE:t.options.pageSize=e.pageSize||t.properties.pageSize,t.options.inputtray=bizagi.util.inputTray(t.online),"inbox"!==t.options.inputtray&&(t.isPaginatorActive=!1),t.options.includeSyncErrors=bizagi.util.isOfflineErrorsViewSupported(),e.inboxType=e.inboxType||t.properties.inboxType,"smartinbox"==e.inboxType?(bizagi.util.isEmpty(e.smartInboxId)&&!bizagi.util.isEmpty(t.options.smartInboxId)&&(e.smartInboxId=t.options.smartInboxId),e.smartInboxId?t.options.smartInboxId=r=e.smartInboxId:t.options.smartInboxId=void 0):t.options.smartInboxId=void 0,bizagi.loading.start(),t.options.sortData=bizagi.util.getLastProcessInboxSort(),t.dataService.online&&(t.options.liveFilterData=t.prepareLiveFilterData(r));var o=t.getActivitiesServiceByView(t.dataService),s=bizagi.clone(t.options);return $.when(o.call(t.dataService,s)).then(function(a){if(bizagi.util.isEmpty(t.options.smartInboxId)||t.dataService.markSmartInboxAsAvailableOffline(t.options.smartInboxId),t.viewType&&"cardView"==t.viewType&&(a=t.dataService.adapterDataOfActivitiesToTemplate(t.dataService.adapterServerResponseTemplateBindingObject(a))),t.online&&t.isPaginatorActive&&(a.elements.length<=0||t.totalPages<e.pageSize/t.Class.PAGE_SIZE))return t.properties.scrollOffset=0,void t.navigateToPage(1,t.Class.PAGE_SIZE,!0,null);if(t.activeAdvanceSearch(a.advanceSearch),e.pageSize&&e.pageSize>t.Class.PAGE_SIZE&&(t.properties.page=e.pageSize/t.Class.PAGE_SIZE),(!t.isTabletDevice||t.isTabletDevice&&t.online)&&(t.totalPages=a.totalPages,$(".bz-wp-taskfeed-paginator-pages span").html(t.getResource("render-grid-page")+" "+a.page+" "+t.getResource("render-grid-conector")+" "+a.totalPages),t.isPaginatorActive&&a.elements.length*a.totalPages>t.Class.PAGINATOR_MAX_SIZE&&(t.options.pageSize=10)),t.shouldShowPagination(a),e.more){var n=t.prepareData(a,t.options.idWfClass,t.options.smartInboxId);t.dataSourceNew.pushCreate(n),$("div.bz-wp-item-new",t.content).each(function(){$(this).parent().addClass("bz-wp-item-new")}),i.resolve()}else{var r={transport:{read:function(e){bizagi.util.isSmartphoneDevice()||t.taskFeedSearch&&"on"!==t.taskFeedSearch.getSearchMode()?$.when(e.data).then(function(i){var n=i.elements?i:a,r=t.prepareData(n,t.options.idWfClass,t.options.smartInboxId);e.success(r),$("div.bz-wp-item-new",t.content).each(function(){$(this).parent().addClass("bz-wp-item-new")})}).fail(function(){e.success([]),bizagi.showMessageBox(t.getResource("workportal-general-error-connection")),bizagi.webpart.publish("bz-summary-item-clear")}):e.success([])}}};t.options.sortData&&t.options.sortData.sortFieldName||(r.sort=[{field:"endDate",dir:"asc"},{field:"idworkitem",dir:"asc"}],r.group={field:"group"}),t.dataSourceNew=new kendo.data.DataSource(r),i.resolve(t.dataSourceNew)}0===$("#items-content-taskFeed li",t.content).length?t.setNoPendingCases():t.setHasPendingCasesStyles()}).fail(function(e){bizagi.logError(e.responseText),t.configureLoadMore(!1),0===$("#items-content-taskFeed li",t.content).length?t.setNoPendingCases():t.setHasPendingCasesStyles(),i.reject("")}).always(function(){bizagi.loading.stop()}),i.promise()},prepareLiveFilterData:function(e){var t=[];return bizagi.util.getLiveFiltersFromStorage(e)&&$.each(bizagi.util.getLiveFiltersFromStorage(e),function(e,i){var a={};a.column=i.selectedColumn.fieldFilterName,a.operator=i.selectedOperator.id,a.type=i.selectedColumn.fieldFilterDataType,"between"==a.operator?"datetime"==a.type.toLowerCase()?(a.from=i.value.From.value,a.to=i.value.To.value):(a.from=i.value.From,a.to=i.value.To):"equals"==a.operator||"not-equals"==a.operator||"not-starts-with"==a.operator||"not-ends-with"==a.operator||"not-contains"==a.operator||"greater-than"==a.operator||"greater-than-or-equals"==a.operator||"less-than"==a.operator||"less-than-or-equals"==a.operator||"on"==a.operator?"datetime"==a.type.toLowerCase()&&"on"!=a.operator?a.value=i.value.value:a.value=i.value:"in"==a.operator||"not-in"==a.operator?(a.value=[],"entity"==a.type.toLowerCase()?$.each(i.value,function(e,t){a.value.push({id:t.guid,displayName:t.tag})}):"IdTask"==a.column||"Activity"==a.column?$.each(i.value,function(e,t){a.value.push({id:t.guid,displayName:t.tag,internalId:t.internalId,processName:t.processName})}):$.each(i.value,function(e,t){a.value.push(t.tag)})):"starts-with"!=a.operator&&"ends-with"!=a.operator&&"contains"!=a.operator||(a.value=[],$.each(i.value,function(e,t){a.value.push(t.tag)})),t.push(a)}),t},prepareData:function(e,t,i){return e.elements},getActivitiesServiceByView:function(e){return e.getCasesListBeta},updateDataList:function(){var e=this;if(e.routingCalled){var t;t=e.isPaginatorActive?{page:e.options?e.options.page:e.properties.page,pageSize:e.options?e.options.pageSize:e.properties.pageSize}:{page:1,pageSize:e.options?e.options.page*e.options.pageSize:e.properties.page*e.properties.pageSize},e.properties.smartInboxId&&(t.smartInboxId=e.properties.smartInboxId),t.inboxType=e.properties.inboxType||"process",bizagi.loading.start(),$.when(e.loadDataList(t)).done(function(t){var i=t,a=$("#items-content-taskFeed",e.content).data("kendoMobileListView");i&&void 0!==a&&a.setDataSource(i),$("div.bz-wp-item-new",e.content).each(function(){$(this).parent().addClass("bz-wp-item-new")}),e.selectFirstElement(),e.options&&e.options.resetScrollAfterLoad&&$("#items-content-taskFeed",e.content).data("kendoMobileListView").scroller().scrollTo(0,0)}).fail(function(e){bizagi.logError(e.responseText)}).always(function(){bizagi.loading.stop()}),e.routingCalled=!1}bizagi.util.isOfflineErrorsViewSupported()&&e.dataService.updateSyncErrorsStatus()},selectFirstElement:function(){var e=this;if($("#items-content-taskFeed li",e.content).length>0&&e.isTabletDevice&&$("#items-content-taskFeed").data("kendoMobileListView")&&$("#items-content-taskFeed").data("kendoMobileListView").dataSource&&e.homePortalFramework.destination!=e.Class.ME_DESTINATION){var t={},i=$("#items-content-taskFeed").data("kendoMobileListView").dataSource.view();i&&i[0]&&(i[0].items?t.dataItem=i[0].items[0]:t.dataItem=i[0]),t.dataItem&&(t.item=$(e.firstChild),e.showSummary(t))}},setNoPendingCases:function(){var e=this,t=e.getResource("workportal-taskfeed-process-no-cases","You have no pending cases"),i=$("<li>",{class:"bz-wp-taskfeed-no-records"}).append(t);$("#items-content-taskFeed",e.content).html(i),$(".bz-wp-group-container",e.content).addClass("bz-wp-taskfeed-no-records-container"),bizagi.webpart.publish("bz-summary-item-clear")},setHasPendingCasesStyles:function(){var e=this;$(".bz-wp-group-container",e.content).removeClass("bz-wp-taskfeed-no-records-container")},configureLoadMore:function(e){var t=$("#loadMoreTaskFeed",self.content);e?t.show():t.hide()},pagesShowPagination:function(e,t){var i=this;return e>4||t>i.Class.PAGINATOR_MAX_SIZE},shouldShowPagination:function(e){var t=this,i=!(e.page>=e.totalPages);t.configureLoadMore(i),t.online&&(!t.isTabletDevice||t.isTabletDevice&&"inbox"===t.options.inputtray)&&t.pagesShowPagination(e.totalPages,e.elements.length)?($(".bz-wp-taskfeed-paginator-container",t.content).css("display","block"),$(".bz-wp-taskfeed-paginator-container",t.content).data("paginator",!0),t.configureLoadMore(!1),t.isPaginatorActive=!0,t.options.pageSize>t.Class.PAGE_SIZE&&$("#items-content-taskFeed",t.content).data("kendoMobileListView").dataSource.data().splice(10,10)):!t.isTabletDevice||t.online&&"inbox"===t.options.inputtray?($(".bz-wp-taskfeed-paginator-container",t.content).css("display","none"),$(".bz-wp-taskfeed-paginator-container",t.content).data("paginator",!1),$("#items-content-taskFeed",t.content).data("kendoMobileListView").scroller().scrollTo(0,-t.properties.scrollOffset),t.isPaginatorActive=!1):($(".bz-wp-taskfeed-paginator-container",t.content).css("display","none"),$(".bz-wp-taskfeed-paginator-container",t.content).data("paginator",!1),t.isPaginatorActive=!1)},configureHandlers:function(){var e=this;$("#taskfeedPaginatorFirst",e.content).on("click",function(t,i){e.isFirstElement=!0,e.navigateToPage(1,null,!0,i)}),$("#taskfeedPaginatorBack",e.content).on("click",function(t,i){e.totalPages&&e.properties.page>1&&(e.isFirstElement=!0,e.navigateToPage(e.properties.page-1,null,!0,i))}),$("#taskfeedPaginatorNext",e.content).on("click",function(t,i){e.totalPages&&e.totalPages>e.properties.page&&(e.isFirstElement=!0,e.navigateToPage(e.properties.page+1,null,!0,i))}),$("#taskfeedPaginatorLast",e.content).on("click",function(t,i){e.totalPages&&(e.isFirstElement=!0,e.navigateToPage(e.totalPages,null,!0,i))}),$("#loadMoreTaskFeed",e.content).on("click",function(t,i){e.setCurrentScrollerOfset(),e.navigateToPage(e.properties.page+1,null,!1,i)})},navigateToPage:function(e,t,i,a){var n=this,r={more:!0};n.properties.page=e||n.properties.page,i&&$("#items-content-taskFeed",n.content).data("kendoMobileListView").dataSource.data([]),t&&(r.pageSize=t),bizagi.loading.start(),$.when(n.loadDataList(r)).done(function(e){a&&a()}).always(function(){bizagi.loading.stop()})},setCurrentScrollerOfset:function(){this.properties.scrollOffset=$("#items-content-taskFeed",this.content).data("kendoMobileListView").scroller().scrollTop,this.properties.scrollOffset=this.properties.scrollOffset<0?-1:this.properties.scrollOffset},showSummary:function(e){},setFavorite:function(e){var t,i,a=this,n=$(e.context),r=e.idCase,o=n.attr("data-id-object"),s=$("#items-content-taskFeed",a.content).data("kendoMobileListView");a.selectedItem&&(t=a.selectedItem.dataItem,i=a.selectedItem.item),bizagi.util.isEmpty(o)?$.when(a.dataService.addFavorite({idObject:r,favoriteType:"CASES"})).done(function(e){n=a.changeFavoriteIcon("active",n),void 0!==t&&void 0!==i&&(t=a.changeFavoriteValues(t,!0,e.idFavorites),s.setDataItem(i,t),a.selectedItem.dataItem=t,a.selectedItem.item=$("li [data-uid="+t.uid+"]",s.element)),n.attr("data-id-object",e.idFavorites),a.cacheFavorites[r]={add:!0,idFavorites:e.idFavorites}}):$.when(a.dataService.delFavorite({idObject:o,favoriteType:"CASES"})).done(function(e){bizagi.util.parseBoolean(e.deleted)&&(n=a.changeFavoriteIcon("inactive",n),void 0!==t&&void 0!==i&&(t=a.changeFavoriteValues(t,!1,""),s.setDataItem(i,t),a.selectedItem.dataItem=t,a.selectedItem.item=$("li [data-uid="+t.uid+"]",s.element)),n.attr("data-id-object",""),a.cacheFavorites[r]={add:!1,idFavorites:""})})},changeFavoriteIcon:function(e,t){return"active"==e?t.removeClass("bz-star").addClass("bz-star-full"):t.removeClass("bz-star-full").addClass("bz-star"),t},changeFavoriteValues:function(e,t,i){return e[9]=t,e[8]=i,e},toggleOfflineMenuIcon:function(e){var t=this,i=t.getContainerHeader(),a=i.find(t.Class.BUTTON_OFFLINE_DROPDOWN),n=i.find(".km-icon.km-arrow-right.km-notext"),r=i.find(".km-icon.km-arrow-left.km-notext");a&&n&&r&&(!0===e?(a.attr("data-icon","arrow-left"),n.removeClass("km-arrow-right").addClass("km-arrow-left")):(a.attr("data-icon","arrow-right"),r.removeClass("km-arrow-left").addClass("km-arrow-right")))},configureOfflineMenuHandler:function(){var e=this;if(bizagi.util.hasOfflineFormsEnabled()){var t=$(e.Class.BUTTON_OFFLINE_DROPDOWN),i=$(".bz-header-menu-title");t&&t.on("click",e.menuOfflineToggleHandler.bind(e)),i&&i.on("click",e.menuOfflineToggleHandler.bind(e))}},menuOfflineToggleHandler:function(){var e=this,t=$(".bz-wp-home-offline-menu-container",e.canvas);"none"===t.css("display")?(e.toggleOfflineMenuIcon(!0),e.hideSortList(),e.hideProcessList(),t.fadeIn()):(e.toggleOfflineMenuIcon(!1),t.fadeOut())},hideSortList:function(){var e=this;if("none"!=$(".bz-wp-home-sort-menu-container",e.canvas).css("display")){var t=$(".bz-header-sort-btn");t&&t.click()}},hideProcessList:function(){var e=this;if("none"!=$("#active-process-list",e.canvas).css("display")){var t=$("#div-last-open-inbox-item");t&&t.click()}}}),$.Class.extend("bizagi.workportal.activity.search",{SEARCH_PAGE_SIZE:40,SEARCH_PAGE_FIRST:1,SEARCH_PROCESS_SIZE:2,DELAY_FOCUS_INPUT:850,PROCESS_CONTEXT_ENABLED:!1},{init:function(e,t,i){var a=this;a.workportalFacade=e,a.dataService=t,a.controller=i,a.activeAdvancedSearch=bizagi.util.validateFeatureSupport("advancedSearch"),a.activeTaskColorState=bizagi.util.validateFeatureSupport("taskColorState")},render:function(){var e=this;$.when(e.renderContent()).then(function(){e.postRender()})},renderContent:function(){},postRender:function(){},getFiltersApplied:function(){var e=this,t=[];if(void 0!==e.filters.radNumber&&""!==e.filters.radNumber&&t.push({field:"radNumber",value:e.filters.radNumber}),void 0!==e.filters.favorites&&e.filters.favorites&&t.push({field:"isFavorite",value:e.filters.favorites}),void 0!==e.filters.idwfclass&&t.push({field:"idwfclass",value:e.filters.idwfclass}),void 0!==e.filters.state){var i=new Date;switch(e.filters.state){case"upcoming":if(e.activeTaskColorState)t.push({field:"taskStateColor",value:"green"});else{var a=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1,0,0,0,0);t.push({field:"expirationDateMin",value:a.toISOStringHM()})}break;case"ontime":if(e.activeTaskColorState)t.push({field:"taskStateColor",value:"yellow"});else{var n=new Date(i.setSeconds(i.getSeconds()+1));t.push({field:"expirationDateMin",value:n.toISOStringHM()});var r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59,59,0);t.push({field:"expirationDateMax",value:r.toISOStringHM()})}break;case"overdue":default:e.activeTaskColorState?t.push({field:"taskStateColor",value:"red"}):t.push({field:"expirationDateMax",value:i.toISOStringHM()})}}else void 0!==e.filters.custom&&(t.push({field:"expirationDateMin",value:e.filters.custom.startDate.toISOStringHM()}),t.push({field:"expirationDateMax",value:e.filters.custom.endDate.toISOStringHM()}));return t},configureFiltersHandler:function(){var e=this,t=e.modalView.element.find(".ui-bz-wp-activity-search-header input");t.focus(function(){var i=e.$activityList.data("kendoMobileListView");i?i.scroller().one("scroll",function(){t.blur()}):e.modalView.close()}),e.modalView.element.on("click",".km-content",function(){$(this).hasClass("solid-background")||e.modalView.close()}),e.modalView.element.find(".ui-bz-wp-activity-search-filters .ui-bz-wp-as-favorites").bind("click",function(){e.filters.favorites=void 0===e.filters.favorites||!e.filters.favorites,e.filters.favorites?$(this).addClass("active"):$(this).removeClass("active"),e.resetProcessesFilter(),e.applyFilters()}),e.modalView.element.find(".ui-bz-wp-activity-search-filters .date-filter.status").bind("click",function(){var t=$(this).data("state");e.modalView.element.find(".ui-bz-wp-activity-search-filters .date-filter").removeClass("active"),void 0!==e.filters.state&&e.filters.state===t?(e.filters.state=void 0,$(this).removeClass("active")):(e.filters.state=t,e.filters.custom=void 0,$(this).addClass("active")),e.resetProcessesFilter(),e.applyFilters()});e.modalView.element.find(".ui-bz-wp-activity-search-filters .ui-bz-wp-as-calendar").mobiscroll().calendar({lang:bizagi.util.languages[BIZAGI_LANGUAGE]||"en",display:"bottom",outerMonthChange:!1,endYear:(new Date).getFullYear()+10,controls:["calendar","time"],buttons:["cancel",{text:e.controller.getResource("render-plugin-search-users-clear-button-name"),handler:function(t,i){e.filters.custom=void 0,e.modalView.element.find(".ui-bz-wp-activity-search-filters .ui-bz-wp-as-calendar").removeClass("active"),e.applyFilters(),i.cancel()}},"set"],onBeforeShow:function(t,i){var a=void 0!==e.filters.custom?e.filters.custom.startDate:new Date;i.rCurrent="start",i.rStartDate=a,i.setVal(i.rStartDate),i.rToDate=void 0!==e.filters.custom?e.filters.custom.endDate:new Date(i.rStartDate.getTime()+86403600),i.setRange=function(e){var t=this;"start"===t.rCurrent?(t.rStartDate=e.date,t.rStartDate>t.rToDate&&(t.rToDate=new Date(t.rStartDate.getTime()+86403600),$(".mbsc-range-btn-v-end",t.headerTemp).text(bizagi.util.dateFormatter.formatDate(t.rToDate,"dd/MM/yyyy hh:mm tt"))),$(".mbsc-range-btn-v-start",t.headerTemp).text(bizagi.util.dateFormatter.formatDate(t.rStartDate,"dd/MM/yyyy hh:mm tt"))):(t.rToDate=e.date,t.rToDate<t.rStartDate&&(t.rStartDate=new Date(t.rToDate.getTime()-86403600),$(".mbsc-range-btn-v-start",t.headerTemp).text(bizagi.util.dateFormatter.formatDate(t.rStartDate,"dd/MM/yyyy hh:mm tt"))),$(".mbsc-range-btn-v-end",t.headerTemp).text(bizagi.util.dateFormatter.formatDate(t.rToDate,"dd/MM/yyyy hh:mm tt")));var i=new Date(t.rStartDate.getFullYear(),t.rStartDate.getMonth(),t.rStartDate.getDate(),0,0,0,0),a=new Date(t.rToDate.getFullYear(),t.rToDate.getMonth(),t.rToDate.getDate(),0,0,0,0),n=$(".mbsc-cal-day[data-full]",t._markup);n.removeClass("selected_in_range"),n.each(function(e,t){var n=$(t).data("full").split("-"),r=new Date(n[0],n[1],n[2],0,0,0,0);i<=r&&r<=a&&$(t).addClass("selected_in_range")}),t.isValidRange=t.rStartDate<=t.rToDate}},onChange:function(e,t){t.setRange({date:t.selectedTime})},onDayChange:function(e,t){t.setRange({date:e.date})},onValueTap:function(e,t){t.setRange({date:"start"==t.rCurrent?t.rStartDate:t.rToDate})},onTabChange:function(e,t){t.setRange({date:"start"==t.rCurrent?t.rStartDate:t.rToDate})},onMonthLoaded:function(e,t){t.setRange({date:"start"==t.rCurrent?t.rStartDate:t.rToDate})},onMarkupReady:function(e,t){t.headerTemp=$.kendoTmpls('<div class="mbsc-range-btn-t" role="radiogroup">   <div class="mbsc-range-btn-c mbsc-range-btn-start mbsc-range-btn-sel" aria-checked="true" data-range="start">       <div role="radio" class="mbsc-fr-btn-e mbsc-fr-btn-nhl mbsc-range-btn">          #: data.startText #<div class="mbsc-range-btn-v mbsc-range-btn-v-start">#: data.rStartDate #</div>       </div>   </div>   <div class="mbsc-range-btn-c mbsc-range-btn-end" data-range="end">       <div role="radio" class="mbsc-fr-btn-e mbsc-fr-btn-nhl mbsc-range-btn">           #: data.toText#<div class="mbsc-range-btn-v mbsc-range-btn-v-end">#: data.rToDate #</div>       </div>   </div></div>',{startText:t.settings.fromText,toText:t.settings.toText,rStartDate:bizagi.util.dateFormatter.formatDate(t.rStartDate,"dd/MM/yyyy hh:mm tt"),rToDate:bizagi.util.dateFormatter.formatDate(t.rToDate,"dd/MM/yyyy hh:mm tt")}),$(".mbsc-range-btn-c",t.headerTemp).bind("click",function(){$(".mbsc-range-btn-c",t.headerTemp).removeClass("mbsc-range-btn-sel"),$(this).addClass("mbsc-range-btn-sel");var e="start"==$(this).data("range")?t.rStartDate:t.rToDate;t.rCurrent=$(this).data("range"),t.navigate(e),t.setVal(e,!0),t.setRange({date:e})}),$(".mbsc-cal-tabs",e.target).before(t.headerTemp),t.setRange({date:t.rStartDate})},onSet:function(t,i){if(i.isValidRange)e.modalView.element.find(".ui-bz-wp-activity-search-filters .date-filter").removeClass("active"),$(this).addClass("active"),e.filters.state=void 0,e.filters.custom={},e.filters.custom.startDate=i.rStartDate,e.filters.custom.endDate=new Date(i.rToDate.getFullYear(),i.rToDate.getMonth(),i.rToDate.getDate(),i.rToDate.getHours(),i.rToDate.getMinutes(),59,0),e.resetProcessesFilter(),e.applyFilters();else{var a=e.controller.getResource("workportal-widget-templateengine-action-rule-error"),n=e.controller.getResource("workportal-widget-comments-filter");$.notifier.add({title:n,text:printf(a,n),class_name:"error"})}},onSetDate:function(e,t){t.selectedTime=e.date}});var i=bizagi.util.debounce(function(){var t=this.value;e._search_value=t,e.filters.radNumber=t,e.filters.radNumber||e.resetProcessesFilter(),e.applyFilters()},250);t.bind("keyup",i),setTimeout(function(){t.focus()},e.Class.DELAY_FOCUS_INPUT)},setContentBackgroundColor:function(e){var t=this;"white"===e?(t.modalView.header.find(".activity-empty-list").hide(),t.modalView.content.addClass("solid-background")):(t.modalView.header.find(".activity-empty-list").show(),t.modalView.content.removeClass("solid-background"))},applyFilters:function(){var e=this,t=e.getFiltersApplied();t&&t.length>0?e.activityDataSource.filter(t):(e.activityDataSource.data([]),e.processDataSource.data([]),e.modalView.header.find(".activity-empty-list").hide(),e.modalView.content.removeClass("solid-background")),e.modalView.scroller.reset()},resetProcessesFilter:function(){var e=this;void 0!==e.filters.idwfclass&&e._process_filter&&!e._context_process&&(e.filters.idwfclass=void 0,e._process_filter=!1)},openCase:function(e){var t=this;void 0!==e&&t.controller.publish("changeCase",{idCase:e.idcase,idWorkitem:e.idworkitem,idTask:e.taskid,displayName:e.currenttask,radNumber:e.radnumber,isEvent:e.isevent||e.isEvent||!1})},setLastProcessInboxFilter:function(){var e=this,t=bizagi.util.getLastProcessInboxProcessInfo(),i=t.idWorkflow;-1!=i&&(e._process_filter=!0,e._context_process=!0,e.filters.idwfclass=i,e.processDataSource.data([{processname:t.processInfoName,idwfclass:i,
active:"active"}]))}}),bizagi.workportal.webparts.taskFeed.extend("bizagi.workportal.webparts.taskFeed",{},{init:function(e,t,i){var a=this;a._super(e,t,i),bizagi.webpart.subscribe("homeportalShow-taskFeed",function(e,t){a.initTaskFeedKendoView(),a.updateDataList()})},renderContent:function(e){return this._super(e)},postRender:function(e){var t=this;t._super(e),t.configureOfflineMenuHandler()},configureHandlers:function(){var e=this;e.getContent().find(".km-rightitem").click(function(){bizagi.webpart.publish("bz-new-case")}),e._super()},activeAdvanceSearch:function(e){var t=this;void 0!==t.view&&(e?(t.view.header.find(".km-rightitem .bz-search-icon").show(),t.view.header.find(".km-rightitem .bz-search-icon").unbind().click(function(){t.activitySearch.render()})):t.view.header.find(".km-rightitem .bz-search-icon").hide())},configureModalViewHandlers:function(){var e=this;$(".km-modalview-root").off("click").click(function(e){e.target===e.currentTarget&&$("#modalview-summary").data("kendoMobileModalView").close()}),$("#modalview-summary").delegate(".bz-wp-modal-newcase-footer .km-rightitem","click",function(t){var i=$("#WorkOnItModalView").data("item");e.changeCase(i)}),$("#modalview-summary").delegate(".bz-favorite-case","click",function(t){var i=this,a=$(".bz-wp-modal-content",$(i).parents("#modalview-summary")).data("case");e.setFavorite({context:i,idCase:a})})},showSummary:function(e){var t=this,i=e.dataItem,a=e.dataItem[0];t.selectedItem={item:e.item,dataItem:e.dataItem};var n={mobileDevice:!0,idWorkflow:e.dataItem.idwfclass||""};bizagi.util.isNumeric(a)?n.idCase=a:n.radNumber=a,bizagi.loading.start(),$.when(t.dataService.getCasesByWorkflow(n)).done(function(e){for(var a,n=-1;a=e.rows[++n];)if(a.id===i[0]){i[6]=[],a.radnumber&&a.casenumberdisplayname&&i[6].push([a.casenumberdisplayname,a.radnumber]);for(var r,o=-1;r=a.fields[++o];){var s;if("object"==typeof r.Value){for(var l,c=-1;l=r.Value[++c];)if(""!==l){s=[r.DisplayName,l,r.DataType],i[6].push(s);break}}else s=[r.DisplayName,r.Value,r.DataType],i[6].push(s)}break}var d=t.getTemplate("summary-taskFeed-kendo-tmpl"),u=kendo.template(d,{useWithBlock:!1,useNativeScrolling:!0});$(u(i)).kendoMobileModalView({close:function(e){this.destroy(),this.close(),this.element.remove()}}),t.configureModalViewHandlers(),$("#WorkOnItModalView").data("item",i);var p=t.cacheFavorites[i[0]]?t.cacheFavorites[i[0]].idFavorites:i[8];$(".bz-favorite-case","#modalview-summary").attr("data-id-object",p);var m=$("#modalview-summary").data("kendoMobileModalView");m.open(),m.adjustSize=function(){var e=$(".bz-wp-modal-content",this.element).height(),t=0,i=window.innerHeight,a=$(".km-header",this.wrapper).height()+$(".km-footer",this.wrapper).height();t=e+a>=i?i-20:e+a+10;var n=(i-t)/2;this.wrapper.parent().css("top",n),this.wrapper.parent().css("height",t)},m.adjustSize(),window.addEventListener("orientationchange",function(){setTimeout(function(){m.adjustSize()},250)},!1)}).fail(function(e){bizagi.log(e.responseText)}).always(function(){bizagi.loading.stop()})},getContainerHeader:function(){return $("#taskFeed")}}),bizagi.workportal.activity.search.extend("bizagi.workportal.activity.search",{},{renderContent:function(){var e=this;e.filters={},e._process_filter=!1;var t=$.kendoTmpls(e.workportalFacade.getTemplate("activity-search-view"),{showFilters:e.activeAdvancedSearch});e.modalView=new kendo.mobile.ui.ModalView(t,{close:function(e,t){this.destroy(e,t),this.element.remove()}}),e.activityDataSource=new kendo.data.DataSource({transport:{read:{url:e.activeAdvancedSearch?e.dataService.serviceLocator.getUrl("case-handler-getActivityList"):e.dataService.serviceLocator.getUrl("process-handler-getCustomizedColumnsDataInfo")},parameterMap:function(t){bizagi.loading.startInnerLoader(e.modalView.content);var i={page:t.page||e.Class.SEARCH_PAGE_START,pageSize:t.pageSize||e.Class.SEARCH_PAGE_SIZE};if(t.filter)for(var a,n=-1;a=t.filter.filters[++n];)i[a.field]=a.value;return i}},schema:{parse:function(t){var i=e.dataService.processActivitiesResponse(t,e._search_value,e._process_filter);return e.processDataSource.data(i.processes.length>e.Class.SEARCH_PROCESS_SIZE?i.processes.slice(0,e.Class.SEARCH_PROCESS_SIZE):i.processes),e.setContentBackgroundColor(i.elements.length>0?"white":"transparent"),bizagi.loading.stopInnerLoader(e.modalView.content),i},data:"elements",total:"totalRecords"},serverFiltering:!0,serverPaging:!0,page:e.Class.SEARCH_PAGE_START,pageSize:e.Class.SEARCH_PAGE_SIZE});var i=e.workportalFacade.getTemplate("pull-loader"),a=e.workportalFacade.getTemplate("refresh-loader");e.$activityList=e.modalView.element.find("#activity-list").kendoMobileListView({autoBind:!1,loadMore:!0,messages:{loadMoreText:e.controller.getResource("workportal-widget-inbox-load-more"),pullTemplate:i,refreshTemplate:a,releaseTemplate:a},dataSource:e.activityDataSource,template:e.workportalFacade.getTemplate("activity-search-activity-item"),click:function(t){e.openCase(t.dataItem)}}),e.processDataSource=new kendo.data.DataSource,e.modalView.element.find("#process-list").kendoMobileListView({dataSource:e.processDataSource,template:e.workportalFacade.getTemplate("activity-search-process-item"),click:function(t){($(t.target).hasClass("bz-cancel")||void 0===e.filters.idwfclass)&&(void 0!==e.filters.idwfclass&&e.filters.idwfclass===t.dataItem.idwfclass?(e.filters.idwfclass=void 0,e._process_filter=!1):(e._process_filter=!0,e.filters.idwfclass=t.dataItem.idwfclass),e.applyFilters())}})},postRender:function(){var e=this;e.modalView.open(),e.modalView.element.find(".ui-bz-wp-activity-search-header .bz-cancel").bind("click",function(){e.modalView.close()}),e.configureFiltersHandler()}});
//# sourceMappingURL=webpart.smartphoneandroidnative.production.js.map