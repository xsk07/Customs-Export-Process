function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.rendering.element.original=$.extend(!0,{},bizagi.rendering.element.prototype),$.extend(bizagi.rendering.element.prototype,{isContainedInNestedForm:function(){return!!this.parent&&("nestedForm"===this.parent.properties.type||("collectionnavigator"===this.parent.properties.type||this.parent.isContainedInNestedForm()))},isContainedInCollectionNavigator:function(){return this.getFormContainer().properties.isNavigationForm||!1},isContainedInGrid:function(){return null!=this.column},isReadOnlyForm:function(){return!!((this.getFormContainer()||{}).properties||{}).isReadOnly},findElement:function(e){return e&&this.properties.guid===e?this:null},selectElement:function(){},unselectElement:function(){}}),bizagi.rendering.tablet.container.original=$.extend(!0,{},bizagi.rendering.tablet.container.prototype),$.extend(bizagi.rendering.tablet.container.prototype,{postRenderContainer:function(e){var t=this;return bizagi.rendering.tablet.container.original.postRenderContainer.apply(this,arguments),t.isReadOnlyForm()?e:"template"==t.getFormType()?("template"==t.properties.type&&e.click((function(e){t.onClickCanvas(e)})),e):(e.hasClass("ui-sortable")&&e.sortable("destroy"),e.addClass("ui-bizagi-itemfordrag"),t.addDraggableClassToContainer(),t.isContainerSortable()&&(e.data({guid:t.properties.guid,display:t.properties.displayName,type:t.properties.type}),bizagi.form.modeler.params.reviewMode||setTimeout((function(){t.configureSortablePlugin(e)}),100)),t.isClickEventAllowed()&&(void 0!==t.properties.type&&"searchForm"!==t.properties.type&&"form"!==t.properties.type&&"queryForm"!==t.properties.type?(e.mousedown((function(e){t.onMouseDown(e)})),e.click((function(e){t.onClick(e)}))):e.click((function(e){t.onClickCanvas(e)}))),t.properties.messageValidation&&t.showValidationMessage(t.properties.messageValidation),e)},selectElementByGuid:function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t],r=this.findElement(n);r&&r.selectElement({IsOnClickEvent:!1})}},findElement:function(e){if(!e)return null;if(this.properties.guid===e)return this;for(var t=0;t<this.children.length;t++){var i=this.children[t].findElement(e);if(i)return i}return null},disableSortablePlugin:function(){this.container&&this.container.hasClass("ui-sortable")&&this.container.data()["ui-sortable"]&&this.container.sortable("destroy");for(var e=0,t=this.children.length;e<t;e+=1)this.children[e].container&&this.children[e].disableSortablePlugin()},selectElement:function(e){var t=this.container;t.addClass("ui-bizagi-container-selected");var i=t.offset();$.extend(i,{width:t.outerWidth(),height:t.outerHeight()}),this.triggerGlobalHandler("selectelement",$.extend(e,{position:i,guid:this.properties.guid,element:t,type:this.properties.type}))},unselectElement:function(e){this.container.removeClass("ui-bizagi-container-selected"),e&&$.extend(e,{guid:this.properties.guid}),this.triggerGlobalHandler("unselectelement",e)},configureSortablePlugin:function(e){var t=this,i=t.triggerGlobalHandler("getMainPanel",{}),n='form-modeler[id="'+t.triggerGlobalHandler("getViewID")+'"]';e.addClass("ui-bizagi-container-connectedSortable"),e.bind("sortstart",(function(e,i){t.onSortStart(i)})),e.bind("sortstop",(function(e,i){t.onSortFinish(i)})),e.bind("sort",(function(e){t.onScrollingForm(i,e)})),e.bind("sortactivate",(function(e,i){t.currentDragSource=t.getDragSource(i.item)}));e.sortable({items:"> .ui-bizagi-draggable-item",revert:!1,connectWith:n+" .ui-bizagi-container-connectedSortable:not(.ui-sortable-helper)",distance:10,cursorAt:{top:0,left:0},placeholder:"ui-bizagi-placeholder",delay:10,cancel:"layout"===t.getMode()?".bz-form-item, .ui-bizagi-input-editable":".ui-bizagi-input-editable, .ui-bizagi-grid-cell",containment:i,helper:function(e,i){var n=t.sortableHelper(i),r=$(this);return setTimeout((function(){r.sortable("refreshPositions")}),10),n},start:function(){i&&i.addClass("ui-start-drag")},stop:function(){i&&i.removeClass("ui-start-drag")},beforeStop:function(){window.x3=$("#mtool-container-helper")}}).disableSelection(),t.loadHelperTemplate()},setConnectWith:function(e,t){var i;void 0!==e&&(i=(i=".ui-bizagi-container-connectedSortable")+"[id!= "+t+"]",e.container&&e.container.hasClass("ui-sortable")&&e.container.data()["ui-sortable"]&&e.container.sortable("option","connectWith",i),this.setConnectWith(e.parent,t))},addDraggableClassToContainer:function(){if(this.isContainerDraggable()){if(this.container.addClass("ui-bizagi-draggable-item"),this.container.addClass("ui-dashed-layout"),"horizontal"===this.properties.type){var e=$("> .bz-layout-col",this.container);$.each(e,(function(){var e=$(this);0===e.children().length&&e.append('<div class="children"></div>')}))}this.container.hasClass("ui-dashed-layout")&&(this.container.data("display","Layout"),this.container.data("type","layout")),$("> .ui-bizagi-container-panel",this.container).mouseenter((function(){$(this).addClass("ui-col-hover")})).mouseleave((function(){$(this).removeClass("ui-col-hover")}))}},isContainerDraggable:function(){if(this.isContainedInNestedForm()||this.isContainedInCollectionNavigator())return!1;var e=this.properties.type||"form";return e=this.normalizeType(e),["group","section","nestedForm","tab","horizontal","contentPanel","collectionnavigator"].includes(e)},isContainerSortable:function(){if(this.isContainedInNestedForm()||this.isContainedInCollectionNavigator())return!1;var e=this.properties.type||"form";return e=this.normalizeType(e),["form","group","panel","tabItem","queryForm","searchForm","contentPanel","offlineForm","adhocForm"].includes(e)},isElementSortAllowed:function(e){return"layout"!==this.getMode()||!e.hasClass("bz-form-item")},isClickEventAllowed:function(){var e=this.getMode();if(this.isContainedInNestedForm()||this.isContainedInCollectionNavigator())return!1;var t=this.properties.type||"form";if(t=this.normalizeType(t),"design"==e){if("panel"==t)return!1}else if("layout"===e&&["form","group","section","panel","tab","tabItem","contentPanel"].includes(t))return!1;return!0},sortableHelper:function(e){if(!this.helperTemplate)return null;e.addClass("ui-dragging");var t=e.data(),i=t.type?t.type.toLowerCase():"render",n=t.guid,r=t.display,a=this.triggerGlobalHandler("getControlIcon",{type:i,id:n}),o=this.triggerGlobalHandler("getMainContainer",{});r&&""!==r||(r=i);var l=$.tmpl(this.helperTemplate,{id:i,caption:r,icon:a}),s=$(".wrapper-main-scroll",o),d=l.appendTo(s).css({zIndex:900}),c=parseFloat($("label",d).width())+parseFloat($(".biz-ico",d).eq(0).width())+40+"px";return d.css("width",c),d},loadHelperTemplate:function(){var e=this;return $.when(bizagi.templateService.getTemplate(bizagi.getTemplate("bizagi.editor.component.renderingview").concat("#bizagi-render-drag-helper"))).pipe((function(t){return e.helperTemplate=t,e.helperTemplate}))},getDragSource:function(e){var t={container:!1,toolbar:!1,xpathNavigator:!1,layout:!1,data:null};return $(e).hasClass("ui-bizagi-render")||$(e).hasClass("ui-bizagi-container")?(t.container=!0,t.data={guid:$(e).parents(".ui-bizagi-container").first().data("guid")}):$(e).hasClass("mtool-item")?(t.toolbar=!0,t.data=$(e).data("render")):$(e).hasClass("bizagi_editor_xpathnavigator_data")?(t.xpathNavigator=!0,t.data=$(e).data()):$(e).hasClass("bz-fm-layout-navigator-item")&&(t.layout=!0,t.data=$(e).data("id")),t},changeVisibility:function(e){var t=this.properties;t.visible=bizagi.util.parseBoolean(e),t.visible?$(this.container).removeClass("ui-state-disabled"):$(this.container).addClass("ui-state-disabled")},hasChildren:function(){return this.children.length>0},onScrollingForm:function(e,t){},onSortStart:function(e){var t=$(e.item).parent().children(".ui-bizagi-itemfordrag").index(e.item);e.item.data("start-position",t);var i=$(e.item).parents(".bz-container").first().data("guid")||this.triggerGlobalHandler("getparentid",{guid:$(e.item).data("guid")});e.item.data("sourceContainer",i),t>=0&&this.triggerGlobalHandler("sortstart")},onSortFinish:function(e){if(null==bizagi.sortContainerTimeout){bizagi.sortContainerTimeout=setTimeout((function(){bizagi.sortContainerTimeout=null}),100);var t=$(e.item).parent().children(".ui-bizagi-itemfordrag").not(".ui-sortable-placeholder").index(e.item),i=$(e.item).parents(".bz-container").first().data("guid")||this.triggerGlobalHandler("getparentid",{guid:$(e.item).data("guid")}),n=e.item.data("start-position"),r=e.item.data("sourceContainer");return 0==this.isElementSortAllowed($(e.item))?(this.container.sortable("cancel"),!1):(t>=0&&this.triggerGlobalHandler("sortfinish",{source:this.currentDragSource,initialPosition:n,finalPosition:t,sourceContainer:r,targetContainer:i}),!0)}},onClickCanvas:function(e){e.stopImmediatePropagation(),$(".bz-form-item").removeClass("ui-state-active"),$(".ui-bizagi-grid-cell").removeClass("ui-state-active"),$(".bz-container").removeClass("ui-bizagi-container-selected"),$(".bz-button--container").removeClass("bz-state-active"),this.unselectElement(),0!=e.button&&1!=e.button||this.triggerGlobalHandler("selectcontainerform",{})},onClick:function(e){var t=this.container;e.stopImmediatePropagation(),this.triggerGlobalHandler("checkCtrlKey",{})?t.hasClass("ui-bizagi-container-selected")?this.unselectElement({ctrlIsPressed:!0}):this.selectElement({IsOnClickEvent:!0,ctrlIsPressed:!0}):0!=e.button&&1!=e.button||($(".bz-form-item").removeClass("ui-state-active"),$(".bz-container").not(t).removeClass("ui-bizagi-container-selected"),$(".bz-button--container").removeClass("bz-state-active"),t.hasClass("ui-bizagi-container-selected")?this.unselectElement():this.selectElement({IsOnClickEvent:!0}))},onMouseDown:function(e){if(0==e.button||1==e.button)this.setConnectWith(this.parent,this.container.data("guid"));else if(2==e.button)return this.triggerGlobalHandler("elementrightclick",{guid:this.properties.guid,position:{x:e.clientX,y:e.clientY}}),e.preventDefault(),e.stopPropagation(),!1},normalizeType:function(e){return e.replace(/smartphone/,"").replace(/tablet/,"").replace(/offline/,"")},showValidationMessage:function(e){var t=e.split("</br>")[0];t&&this.setValidationMessage(t)},getContainerMessage:function(){return this.containerMessage||(this.containerMessage=$(".bz-container-message__text",this.container.next("[data-parent="+this.properties.uniqueId+"]"))),this.containerMessage},setValidationMessage:function(e){if(void 0!==this.container){var t=this.getContainerMessage();e&&e.length>0?(e=e.replace(/<\w+>([^<]*)<\/\w+>/g,"$1"),t.attr("data-error",e),t.text(e),this.container.addClass("bz-container--error")):(t.text(""),this.container.removeClass("bz-container--error"))}}}),bizagi.rendering.tablet.form.original=$.extend(!0,{},bizagi.rendering.tablet.form.prototype),$.extend(bizagi.rendering.tablet.form.prototype,{postRenderContainer:function(e){var t=this,i=e;0===t.children.length?i.attr("drophere",bizagi.localization.getResource("formmodeler-component-editor-layout-drophere-containers")):i.removeAttr("drophere"),bizagi.rendering.tablet.form.original.postRenderContainer.apply(this,arguments);var n=void 0!==_typeof(t.params.allowButtons)&&t.params.allowButtons;if(n||$(".ui-bizagi-button-container",e).remove(),t.properties.messageValidation&&t.properties.messageValidation.length>0){var r=t.createMessageValidationElement(t.properties.messageValidation);e.prepend(r)}return e},createMessageValidationElement:function(e){var t=this,i=bizagi.localization.getResource("formmodeler-validations-form"),n=$('<div class="ui-message-validation"/>');return $("<span>"+i+'<i class="biz-ico bz-studio bz-warning-red_16x16_standard" title="'+e+'"></i></span>').appendTo(n),$(n,"div").click((function(){t.triggerGlobalHandler("showPropertiesForm")})),n},onScrollingForm:function(e,t){var i=e[0],n=i.getBoundingClientRect(),r=n.top,a=n.bottom;function o(){return Math.abs(t.clientY-r)<=20}(o()||Math.abs(a-t.clientY)<=30)&&setTimeout((function(){var t=o()?-1:1,n=e.scrollTop();if(!(1===t&&n>i.scrollHeight-i.offsetHeight)){var r=n+40*t;e.scrollTop(r)}}),100)}}),bizagi.rendering.tablet.render.original=$.extend(!0,{},bizagi.rendering.tablet.render.prototype),$.extend(bizagi.rendering.tablet.render.prototype,{postRenderElement:function(e){var t=this;t.properties;if(bizagi.rendering.tablet.render.original.postRenderElement.apply(this,arguments),t.isReadOnlyForm())return e;if(e.attr("guid",t.properties.guid),"template"==t.getFormType())return t.configureLayoutElement(e);if(!t.isContainedInNestedForm()&&!t.isContainedInCollectionNavigator()){t.setMouseDownEvent(e),t.isContainedInGrid()||(e.addClass("ui-bizagi-draggable-item"),e.addClass("ui-bizagi-itemfordrag"));var i=$(".ui-bizagi-render-search",e);if(i.length>0&&i.parent().addClass("ui-bizagi-display-as-search"),t.isClickEventAllowed()){var n,r=t.properties.type||"";r=r.replace("tablet",""),n="design"==t.getMode()&&"grid"==r?t.getLabelGrid():t.getLabel(),e.click((function(i){t.onRenderClick(i,e)})),bizagi.form.modeler.params.reviewMode||n&&n.dblclick((function(){t.onLabelDoubleClick(n)}))}}return t.properties.messageValidation&&(t.column&&(t.parent.properties.messageValidation+=t.properties.displayName+" - "+t.properties.messageValidation),t.showValidationMessage(t.properties.messageValidation)),e.data({guid:t.properties.guid,display:t.properties.displayName,type:t.properties.type}),t.resetStyle(e)},configureLayoutElement:function(e){var t=this;return t.configureDroppablePlugin(e),t.configureDraggablePlugin(e),e.click((function(i){t.onRenderClick(i,e)})),e.dblclick((function(){t.onLabelDoubleClick(e)})),e.find(".biz-template-editor-render-hide-control").click((function(i){t.onRemoveElement(i,e)})),t.setDeleteLayoutItem(e),e},setDeleteLayoutItem:function(e){var t=this,i=(t.properties.type,$("<span class='biz-icon biz-tmpl-delete pull-right bz-studio bz-delete_16x16_standard'></span>")),n=$("<span class='biz-icon biz-tmpl-delete pull-right bz-studio bz-undo_16x16_black'></span>"),r=e.closest("[id]");setTimeout((function(){if(0==r.length&&t.triggerGlobalHandler("isDeleteOptionAllowed",{guid:t.properties.guid}))e.addClass("hover-applied"),e.hover((function(){$(this).append(n)}),(function(){$(this).find("span.biz-tmpl-delete").detach()})),n.click((function(){t.triggerGlobalHandler("restoreItem",{guid:t.properties.guid})}));else{if(null==r.attr("id"))return;if(r.hasClass("hover-applied"))return;r.addClass("hover-applied"),r.hover((function(){$(this).append(i)}),(function(){$(this).find("span.biz-tmpl-delete").detach()})),function(e){i.click((function(){t.triggerGlobalHandler("deleteRepeaterItem",{guid:e.attr("id")})}))}(r)}}),10)},configureDraggablePlugin:function(e){e.draggable({helper:"clone",zIndex:9999,opacity:.75,cursorAt:{left:5},containment:"document",cancel:".biz-template-editor-render-placeholder",start:function(e,t){$(t.helper).data("isLayoutElement",!0)}})},configureDroppablePlugin:function(e){var t=this;e.droppable({hoverClass:"ui-state-highlight",tolerance:"pointer",activeClass:"ui-editor-highlight",greedy:!0,drop:function(e,t){$(this).addClass("ui-state-highlight")},activate:function(){t.getFormContainer().container.find("[noShow='true']").show()},deactivate:function(){t.getFormContainer().container.find("[noShow='true']").hide()}}),e.on("drop",(function(e,i){t.onDrop(i)}))},getLabelGrid:function(){return $(".bz-mobile-grid__header-title",this.element)},resetStyle:function(e){var t=e,i=t.css("color"),n=t.css("background-color");return"black"==i&&t.css("color",""),"white"==n&&t.css("background-color",""),t},selectElement:function(e){var t,i=this.properties;if(this.element){this.element.addClass("ui-state-active");var n=this.element.offset();$.extend(n,{width:this.element.outerWidth(),height:this.element.outerHeight()}),t=$.extend(e,{position:n,guid:this.properties.guid,element:this.element,type:this.properties.type,isInternal:i.isInternal}),this.triggerGlobalHandler("selectelement",t)}},unselectElement:function(e){this.element.removeClass("ui-state-active"),e&&$.extend(e,{guid:this.properties.guid}),this.triggerGlobalHandler("unselectelement",e)},isClickEventAllowed:function(){return"design"===this.getMode()&&!this.column&&!this.isColumn},setMouseDownEvent:function(e){var t=this;t.isClickEventAllowed()&&e.bind("mousedown.contextmenu",(function(e){return 2!=e.button||(t.triggerGlobalHandler("elementrightclick",{guid:t.properties.guid,position:{x:e.clientX,y:e.clientY}}),e.preventDefault(),e.stopPropagation(),!1)}))},changeVisibility:function(e){var t=this.properties;1==bizagi.util.parseBoolean(e)?$(this.element).removeClass("ui-state-disabled"):$(this.element).addClass("ui-state-disabled"),t.visible=e},showValidationMessage:function(e){var t=e.split("</br>")[0];t&&this.setValidationMessage(t)},onRenderClick:function(e,t){e.stopPropagation(),e.preventDefault(),this.triggerGlobalHandler("checkCtrlKey",{})?t&&t.hasClass("ui-state-active")?this.unselectElement({ctrlIsPressed:!0}):($(document.activeElement).is("input")&&$(document.activeElement).closest(".bizagi_editor_component_properties").length>0&&($(document.activeElement).trigger("blur"),$(".bizagi_editor_component_properties").hide()),this.selectElement({IsOnClickEvent:!0,ctrlIsPressed:!0})):(0!=e.button&&1!=e.button||($(".bz-form-item").not(t).removeClass("ui-state-active"),$(".ui-bizagi-grid-cell").not(t).removeClass("ui-state-active"),$(".ui-bizagi-button").not(t).removeClass("bz-state-active"),$(".bz-container").removeClass("ui-bizagi-container-selected"),$(".ui-bizagi-render-layout").not(t).removeClass("ui-state-active"),$(".bz-button--container").not(t).removeClass("bz-state-active")),t&&t.hasClass("ui-state-active")?this.unselectElement():($(document.activeElement).is("input")&&$(document.activeElement).closest(".bizagi_editor_component_properties").length>0&&($(document.activeElement).trigger("blur"),$(".bizagi_editor_component_properties").hide()),this.selectElement({IsOnClickEvent:!0})))},onLabelDoubleClick:function(e){var t=this;if(t.triggerGlobalHandler("canChangeLabel",{guid:t.properties.guid})){t.triggerGlobalHandler("startlabeledition");var i=new bizagi.editor.component.editableLabel.presenter({label:e,value:t.properties.displayName});i.subscribe("change",(function(e,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})})),i.subscribe("finish",(function(){t.triggerGlobalHandler("finishlabeledition")})),i.render()}},onRemoveElement:function(e,t){this.triggerGlobalHandler("hideElement",{guid:this.properties.guid})},showElementLabelEditor:function(){this.element.find(".ui-bizagi-container-input-editable > input.ui-bizagi-input-editable").length>0||$("label",this.element).trigger("dblclick")},onDrop:function(e){var t=$(e.draggable),i=$(e.helper),n=t.data(),r=i.data(),a=bizagi.editor.utilities.buildComplexXpath(n.xpath,n.contextScope,n.isScopeAttribute,n.guidRelatedEntity);this.triggerGlobalHandler("dropfinish",{guid:this.properties.guid,property:"xpath",value:a,renderType:n.nodeSubtype,sourceGuid:!(!r||!r.isLayoutElement)&&i.attr("guid")})}}),bizagi.rendering.tablet.group.original=$.extend(!0,{},bizagi.rendering.tablet.group.prototype),$.extend(bizagi.rendering.tablet.group.prototype,{postRenderContainer:function(e){var t=this;if(bizagi.rendering.tablet.group.original.postRenderContainer.apply(this,arguments),!t.hasChildren()&&!t.isContainedInNestedForm()&&!t.isContainedInCollectionNavigator()){var i=$(".bz-collapsible__content",e);i.append('<div class="children"></div>')}if(!t.isReadOnlyForm()){var n=e.find(".bz-collapsible__header");t.isInNestedform()||n.dblclick((function(){t.triggerGlobalHandler("startlabeledition");var e=new bizagi.editor.component.editableLabel.presenter({label:n,value:t.properties.displayName});e.subscribe("change",(function(e,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})})),e.subscribe("finish",(function(){t.triggerGlobalHandler("finishlabeledition")})),e.render()}));var r=t.properties.guid;setTimeout((function(){var e=t.triggerGlobalHandler("getLastInsertedElement");r==e&&(t.showElementLabelEditor(),t.triggerGlobalHandler("setLastInsertedElement",null))}),0)}},disableSortablePlugin:function(){var e=this.container.find("> .bz-collapsible__content");e&&e.hasClass("ui-sortable")&&e.data()["ui-sortable"]&&e.sortable("destroy");for(var t=0,i=this.children.length;t<i;t+=1)this.children[t].container&&this.children[t].disableSortablePlugin()},configureSortablePlugin:function(e){return e=e.find("> .bz-collapsible__content"),bizagi.rendering.tablet.group.original.configureSortablePlugin.apply(this,arguments)},isInNestedform:function(){var e=this.parent,t=this.properties,i=!1;do{if("nestedForm"===t.type||"collectionnavigator"===t.type){i=!0;break}t=e.properties,e=e.parent}while(void 0!==e);return i},showElementLabelEditor:function(){this.container.find(".bz-collapsible__header").trigger("dblclick")}}),bizagi.rendering.tablet.section.original=$.extend(!0,{},bizagi.rendering.tablet.section.prototype),$.extend(bizagi.rendering.tablet.section.prototype,{postRenderContainer:function(e){var t=this;if(bizagi.rendering.tablet.section.original.postRenderContainer.apply(this,arguments),!t.isReadOnlyForm()){var i=e.find(".bz-section__header > span");t.parent&&t.parent.properties&&t.parent.properties.type&&"group"===bizagi.util.normalizeType(t.parent.properties.type)&&$(".bz-collapsible__content",t.parent.container).css({overflow:"initial"}),t.isInNestedform()||(i.dblclick((function(){t.triggerGlobalHandler("startlabeledition");var e=new bizagi.editor.component.editableLabel.presenter({label:i,value:t.properties.displayName});e.subscribe("change",(function(e,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})})),e.subscribe("finish",(function(){t.triggerGlobalHandler("finishlabeledition")})),e.render()})),e.droppable({accept:".ui-bizagi-draggable-item",hoverClass:"ui-bizagi-section-drop-hover",tolerance:"pointer",drop:function(e,i){t.dropRender(e,i)},activate:function(e,i){t.currentDragSource=t.getDragSource(i.draggable)}}));var n=t.properties.guid;setTimeout((function(){var e=t.triggerGlobalHandler("getLastInsertedElement");n==e&&(t.showElementLabelEditor(),t.triggerGlobalHandler("setLastInsertedElement",null))}),0)}},isInNestedform:function(){var e=this.parent,t=this.properties,i=!1;do{if("nestedForm"===t.type||"collectionnavigator"===t.type){i=!0;break}t=e.properties,e=e.parent}while(void 0!==e);return i},showElementLabelEditor:function(){this.container.find(".bz-section__header > span").trigger("dblclick")},dropRender:function(e,t){if("mouseup"===e.originalEvent.type){var i=this.children.length,n=this.properties.guid,r=t.draggable?t.draggable.data("start-position"):null,a=t.draggable?t.draggable.data("sourceContainer"):null,o=this.currentDragSource;if(bizagi.editor.utilities.isObject(o)){if(null!=bizagi.sortContainerTimeout)return;bizagi.sortContainerTimeout=setTimeout((function(){bizagi.sortContainerTimeout=null}),100),this.triggerGlobalHandler("sortfinish",{source:o,initialPosition:r,finalPosition:i,sourceContainer:a,targetContainer:n})}}}}),bizagi.rendering.tablet.contentPanel.original=$.extend(!0,{},bizagi.rendering.tablet.contentPanel.prototype),$.extend(bizagi.rendering.tablet.contentPanel.prototype,{postRenderContainer:function(e){var t=this;bizagi.rendering.tablet.contentPanel.original.postRenderContainer.apply(this,arguments),t.hasChildren()||t.isContainedInNestedForm()||t.isContainedInCollectionNavigator()||e.find(".panel__content").append('<div class="children"></div>'),e.addClass("ui-bizagi-container-contentpanel-formmodeler");var i=e.find(".ui-bizagi-container-contentpanel-header");i.dblclick((function(){i.hide(),t.triggerGlobalHandler("startlabeledition");var e=new bizagi.editor.component.editableLabel.presenter({label:i,value:t.properties.displayName});e.subscribe("change",(function(e,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})})),e.subscribe("finish",(function(){t.triggerGlobalHandler("finishlabeledition")})),$.when(e.render()).done((function(){0==t.getElement().find(".ui-bizagi-container-input-editable").length?setTimeout((function(){i.hide(),t.adjustEditLabel()}),100):t.adjustEditLabel()}))}))},disableSortablePlugin:function(){var e=this.container.find(".ui-bizagi-container-contentpanel-wrapper");e&&e.hasClass("ui-sortable")&&e.data()["ui-sortable"]&&e.sortable("destroy");for(var t=0,i=this.children.length;t<i;t++)this.children[t].container&&this.children[t].disableSortablePlugin()},configureSortablePlugin:function(e){return e=e.find("> .panel__content"),bizagi.rendering.tablet.contentPanel.original.configureSortablePlugin.apply(this,arguments)},adjustEditLabel:function(){this.getElement().find(".ui-bizagi-container-input-editable").css({width:"95%","background-color":"orange",top:"-18px","border-radius":"10px"}),this.getElement().find(".ui-bizagi-container-input-editable input").css({"margin-left":"5px",width:"90%"}),this.getElement().find(".ui-bizagi-render-confirmation").css({right:"10px",top:"5px"})},showElementLabelEditor:function(){this.container.find(".ui-bizagi-container-input-editable > input.ui-bizagi-input-editable").length>0||this.container.find("span:first").trigger("dblclick")}}),bizagi.rendering.tablet.tab.original=$.extend(!0,{},bizagi.rendering.tablet.tab.prototype),$.extend(bizagi.rendering.tablet.tab.prototype,{postRenderContainer:function(e){var t=this,i=t.properties;if(bizagi.rendering.tablet.tab.original.postRenderContainer.apply(this,arguments),!t.isReadOnlyForm()){var n=$('<div class="bz-tab--add"><svg class="ico_16x16"><use xlink:href="#icon-plus"></use></svg></div>'),r=$('<div style="display: none;"><svg class="ico_16x16 offset__left-indicator"><use xlink:href="#icon-arrow-left"></svg></div>'),a=$('<div style="display: none;"><svg class="ico_16x16 offset__right-indicator"><use xlink:href="#icon-arrow-rigth"></svg></div>'),o=$(".bz-tabs",e).first();if(o.wrap('<div class="bz__tabs--container"></div>').before(r).after(n).after(a).on("updatePositions",(function(e,i){setTimeout((function(){var i=$(e.currentTarget);t.updatePositions(r,a),t.updateErrorPositions(i)}),100)})),r.click((function(e){e.stopPropagation();var i=$(".bz-tabs",t.container);i.scrollLeft(i.scrollLeft()-15),t.updatePositions(r,a)})),a.click((function(e){e.stopPropagation();var i=$(".bz-tabs",t.container);i.scrollLeft(i.scrollLeft()+15),t.updatePositions(r,a)})),!t.isContainedInNestedForm()&&!t.isContainedInCollectionNavigator()){n.click((function(e){return e.stopImmediatePropagation(),t.triggerGlobalHandler("addtab",{guid:i.guid}),!1})),$.each(t.children,(function(t,i){var n=$("li[data-reference= #ui-bizagi-tab-"+i.properties.guid+"]",e);i.setTabHeader(n)}));var l=$(".bz-tabs",e).first();l.sortable({items:"li[data-reference]",revert:!0,distance:10,axis:"x",cursorAt:{top:0,left:0},placeholder:"bz-tab-placeholder",delay:150,start:function(e,i){t.sortStart(e,i)},tolerance:"pointer",stop:function(e,i){t.sortFinish(e,i)}})}e.data({guid:t.properties.guid,display:t.properties.displayName,type:t.properties.type}),e.on("tabsload",(function(e,i){t.triggerGlobalHandler("controlRefreshCanvas",{})})).on("tabsactivate",(function(e,i){t.triggerGlobalHandler("controlRefreshCanvas",{})})),setTimeout((function(){t.updatePositions(r,a),t.removeSortableClass();var e=t.getActiveTab();t.children[e].addSortableClass()}),100);var s=(t.children||[]).find((function(e){if(e.properties&&e.properties.messageValidation)return e}));s&&s.properties&&s.properties.messageValidation&&t.showValidationMessage(s.properties.messageValidation)}},removeSortableClass:function(){(this.children||[]).forEach((function(e){e.removeSortableClass()}))},updatePositions:function(e,t){var i=$(".bz-tabs",this.container).get(0);e.css({display:"none"}),t.css({display:"none"}),i.scrollLeft>0&&e.css({display:"flex"}),i.scrollWidth>i.clientWidth+i.scrollLeft+30&&t.css({display:"flex"})},sortStart:function(e,t){var i=$(t.item).parent().children("li[data-reference]").not(".bz-tab-placeholder").index(t.item);return t.item.data("start-position",i),this.initialPosition=i,!0},sortFinish:function(e,t){var i=$(t.item).parent().children("li[data-reference]").not(".bz-tab-placeholder").index(t.item);return this.triggerGlobalHandler("sortfinish",{source:{},initialPosition:t.item.data("start-position")||this.initialPosition,finalPosition:i,sourceContainer:this.properties.guid,targetContainer:this.properties.guid}),!0},updateErrorPositions:function(e){var t=e.find("li.active");$(".bz-indicator-bar",e).removeClass("bz-indicator-bar--error"),t&&t.hasClass("bz-tab--error")&&$(".bz-indicator-bar",e).addClass("bz-indicator-bar--error")}}),bizagi.rendering.tablet.tabItem.original=$.extend(!0,{},bizagi.rendering.tablet.tabItem.prototype),$.extend(bizagi.rendering.tablet.tabItem.prototype,{postRenderContainer:function(e){var t=this;bizagi.rendering.tablet.tabItem.original.postRenderContainer.apply(this,arguments),t.hasChildren()||e.append('<div class="children"></div>'),e.addClass("bz-tab-item")},setTabHeader:function(e){var t=this,i=t.properties;t.isContainedInNestedForm()||t.isContainedInCollectionNavigator()||($(".tab--delete",e).click((function(){return t.triggerGlobalHandler("deletetab",{guid:i.guid}),!1})),e.dblclick((function(){t.isEditableLabelActive()||t.editDisplayName(e)})).click((function(e){t.isEditableLabelActive()||t.triggerGlobalHandler("showProperties",{guid:t.properties.guid,redraw:!0})})).mousedown((function(e){2===e.button&&(e.stopImmediatePropagation(),t.isEditableLabelActive()||t.triggerGlobalHandler("elementrightclick",{guid:t.properties.guid,position:{x:e.clientX,y:e.clientY}}))})))},activate:function(){var e=this;bizagi.rendering.tablet.tabItem.original.activate.apply(this,arguments),e.parent.removeSortableClass(),e.addSortableClass(),e.triggerGlobalHandler("activatetab",{guid:e.properties.guid})},removeSortableClass:function(){this.container.removeClass("ui-bizagi-container-connectedSortable")},addSortableClass:function(){this.container.addClass("ui-bizagi-container-connectedSortable")},editDisplayName:function(e){var t=this,i=$("a",e);t.triggerGlobalHandler("startlabeledition");var n=t.editableLabelPresenter=new bizagi.editor.component.editableLabel.presenter({label:i,value:t.properties.displayName});n.subscribe("change",(function(e,i){t.triggerGlobalHandler("changelabel",{guid:t.properties.guid,value:i.value})})),n.subscribe("finish",(function(){t.triggerGlobalHandler("finishlabeledition")})),n.subscribe("keyup",(function(t,i){e.find(".ui-bizagi-container-input-editable").width(bizagi.measureString(i.value)+100)})),n.render()},isEditableLabelActive:function(){return!(!this.editableLabelPresenter||!this.editableLabelPresenter.editableLabel)},dropRender:function(e,t){if("mouseup"===e.originalEvent.type){var i=this.children.length,n=this.properties.guid,r=t.draggable?t.draggable.data("start-position"):null,a=t.draggable?t.draggable.data("sourceContainer"):null,o=this.currentDragSource;if(bizagi.editor.utilities.isObject(o)){if(null!=bizagi.sortContainerTimeout)return;bizagi.sortContainerTimeout=setTimeout((function(){bizagi.sortContainerTimeout=null}),100),this.triggerGlobalHandler("sortfinish",{source:o,initialPosition:r,finalPosition:i,sourceContainer:a,targetContainer:n})}}},showValidationMessage:function(e){}}),bizagi.rendering.tablet.search.original=$.extend(!0,{},bizagi.rendering.tablet.search.prototype),$.extend(bizagi.rendering.tablet.search.prototype,{postRender:function(){var e=this;bizagi.rendering.tablet.search.original.postRender.apply(this,arguments),e.isReadOnlyForm()||e.advancedSearch&&!e.isContainedInNestedForm()&&e.advancedSearch.click((function(t){t.stopPropagation(),e.triggerGlobalHandler("showsearchform",{guid:e.properties.guid})}))}}),bizagi.rendering.tablet.image.original=$.extend(!0,{},bizagi.rendering.tablet.image.prototype),$.extend(bizagi.rendering.tablet.image.prototype,{postRender:function(){var e=this,t=e.getControl(),i=e.properties.width,n=e.parent.properties.type;bizagi.rendering.tablet.image.original.postRender.apply(this,arguments),setTimeout((function(){if(-1===i){var r=$(".resizable_img",t),a=t.width(),o=t.height(),l=0,s=0;if("grid"==n)l=$(".resizable_img",t).closest("td").height();else if(e.parent.properties.id==e.getFormContainer().properties.id)l=50;else{var d=e.parent.getChildreCount(),c=e.parent.getChildrenSumHeight("image");l=(l=$(".resizable_img",t).closest(".ui-bizagi-container").height()-17)<50?50:l,s=e.parent.countByRenderTypeWithParams("image",-1),d>1&&(l-=c)}r.width(a),s>1?null!=l&&l>0?$(".resizable_img",e.parent.container).height(l/s+"px"):$(".resizable_img",t).height(o+"px"):null!=l&&l>0?r.height(l+"px"):r.height(o+"px")}e.triggerGlobalHandler("controlRefreshCanvas")}),160)},changeImageSize:function(e,t){var i=this.getControl();this.executeTriggerHandler(i,e,t,"string")},executeTriggerHandler:function(e,t,i,n){var r="",a="";"string"==n?(r=t.slice(0,-2),a=i.slice(0,-2)):(r=t,a=i),this.triggerGlobalHandler("resizeImage",{guid:this.properties.guid,properties:[{property:"thumbnail.width",value:r},{property:"thumbnail.height",value:a}]})}}),bizagi.rendering.tablet.grid.original=$.extend(!0,{},bizagi.rendering.tablet.grid.prototype),$.extend(bizagi.rendering.tablet.grid.prototype,{postRender:function(){bizagi.rendering.tablet.grid.original.postRender.apply(this,arguments);var e=this.getControl();$("th.bz-hidden, td.bz-hidden",e).each((function(e,t){$(t).addClass("ui-state-disabled")}))}}),bizagi.rendering.tablet.collectionnavigator.original=$.extend(!0,{},bizagi.rendering.tablet.collectionnavigator.prototype),$.extend(bizagi.rendering.tablet.collectionnavigator.prototype,{postRender:function(){var e=this;bizagi.rendering.tablet.collectionnavigator.original.postRender.apply(this,arguments),$.when(e.isRendered()).done((function(){var t=e.properties,i=e.getControl().find(".bz-collectionnavigator-navigationform");t.navigationform&&setTimeout((function(){e.triggerGlobalHandler("refreshControl",{guid:t.guid,canvas:i})}),0)}))}}),bizagi.rendering.tablet.nestedForm.original=$.extend(!0,{},bizagi.rendering.tablet.nestedForm.prototype),$.extend(bizagi.rendering.tablet.nestedForm.prototype,{configureDesignView:function(){var e=this,t=e.properties,i=e.container;i.removeClass("ui-bizagi-container-panel"),i.addClass("ui-bizagi-container-nestedform"),setTimeout((function(){var n=$("<span class= 'ui-bizagi-container-nestedform-title'>Nested Form: "+t.formDisplayName+"</span>");e.triggerGlobalHandler("isOfflineForm")?n=$("<span class= 'ui-bizagi-container-nestedform-title'>Nested <b>Offline</b> Form: "+t.formDisplayName+"</span>"):e.triggerGlobalHandler("hasOfflineForm")&&(n=$("<span class= 'ui-bizagi-container-nestedform-title'>Nested <b>Online</b> Form: "+t.formDisplayName+"</span>")),i.prepend(n)}),100)}}),bizagi.rendering.tablet.date.original=$.extend(!0,{},bizagi.rendering.tablet.date.prototype),$.extend(bizagi.rendering.tablet.date.prototype,{setDisplayValue:function(e){var t=this;bizagi.rendering.tablet.date.original.setDisplayValue.apply(this,arguments);var i=t.properties,n=t.getDateControl().parent(),r=$(".ui-bizagi-render-date, .bz-input-icon__input",n);if(i.valueFormat.color&&i.valueFormat.color.length>0){var a="bz-"+i.valueFormat.color.replace("#","")+"-placeholder",o="."+a+"::-webkit-input-placeholder{color:"+i.valueFormat.color+"}";bizagi.util.loadStyle(o,a),r.addClass(a)}i.valueFormat.strikethru&&i.valueFormat.underline?r.addClass("biz-modify-placeholder-through-underline"):(r.removeClass("biz-modify-placeholder-through-underline"),i.valueFormat.strikethru?r.addClass("biz-modify-placeholder-through"):r.removeClass("biz-modify-placeholder-through"),i.valueFormat.underline?r.addClass("biz-modify-placeholder-underline"):r.removeClass("biz-modify-placeholder-underline"))}}),bizagi.rendering.tablet.basicUserField.extend("bizagi.rendering.tablet.designUserField",{},{getEditableControl:function(){var e=this.getControl(),t='<div class="bz-input-icon bz-widget--fake"><input class="bz-input-icon__input bz-space--inline-s" placeholder="'+(this.properties.control+" Custom control")+'"/><svg class="bz-icn bz-space--inline-s" width="32px" height="32px"><use xlink:href="#gear" /></svg></div>';e.addClass("bz-widget__control--fake"),this.input=$(t).appendTo(e)},collectData:function(e){},getDisplayValue:function(){return"Userfield in design mode: "+this.properties.control},getReadonlyControl:function(){var e=this.getControl(),t='<div class="bz-input-icon bz-widget--fake"><input class="bz-input-icon__input bz-space--inline-s" placeholder="'+(this.properties.control+" Custom control")+'/><svg class="bz-icn bz-space--inline-s" width="32px" height="32px"><use xlink:href="#gear" /></svg></div>';return e.addClass("bz-widget__control--fake"),$(t).appendTo(e)}});
//# sourceMappingURL=../../../../Maps/tablet_ios/formmodeller.tablet.production.js.map
