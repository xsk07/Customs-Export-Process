function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}$.Class.extend("bizagi.rendering.tablet.slide.view",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideFormDeferred=new $.Deferred,this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},buttons:[],processFormButtons:function(e){var t=this;e.buttons=[$.extend(e.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){if(e&&e.validateForm()){var i={};e.collectRenderValues(i),t.slideFormParams.allowGetOriginalFormValues&&(i.formValues=e.children),i.idPageCache=e.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(i)).done((function(a){a&&!0!==a&&"success"!==a.type?"validationMessages"===a.type?e.addValidationMessage(a.messages):"error"===a.type&&e.addErrorMessage(a.message):(t.goBack(),t.slideFormDeferred.resolve(i))})).fail((function(a){var r=a.responseText?a.responseText:"string"==typeof a?a:a.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=a);e.validateForm(),e.clearValidationMessages(),e.addValidationMessage(r),t.goBack(),t.slideFormDeferred.resolve(i)})):(t.goBack(),t.slideFormDeferred.reject())}}}),$.extend(e.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){t.goBack(),t.slideFormDeferred.reject()}})],t.slideFormParams.showSaveButton||e.buttons.shift()},render:function(e){return this.renderSlideForm(e),this.slideFormDeferred.promise()},renderSlideForm:function(e){var t=this,i=new $.Deferred;return bizagi.loading.start(),$.when(t.dataService.getFormData(e)).then((function(i){e.recordXPath&&(i.form.properties.recordXpath=e.recordXPath),t.slideFormParams.showSaveButton&&!1!==e.editable||(i.form.properties.editable=!1),void 0!==i.form.properties&&(i.form.properties.orientation=t.slideFormParams.orientation||"ltr");var a=t.renderFactory.getContainer({type:"form",data:i.form,navigation:t.slideFormParams.navigation,view_container:t.container});return a.params=$.extend({},a.params,e.formParams),t.processFormButtons(a),t.form=a,a.render()})).done((function(i){t.container.element.html(i),e.isRefresh||t.slideFormParams.navigation.navigate(t.container.id),$(".ui-bizagi-button-container .action-button",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append(t.buttonContainer),t.form.triggerHandler("ondomincluded"),t.form.bind("refresh",(function(e,i){i.formParams=i.params||t.form.params,t.render(i)}))})).fail((function(e){var i=t.renderFactory.getCommonTemplate("form-error"),a=e.message||"Error";$.fasttmpl(i,{message:a}).appendTo(t.container.element),t.slideFormParams.navigation.navigate(t.container.id)})).always((function(){bizagi.loading.stop()})),i.promise()},goBack:function(){this.container.destroy()},_renderButtons:function(e){var t=$("<div class='bz-slide-button-container'></div>");$.each(e.buttons,(function(e,i){$("<div class='action-button'>"+i.caption+"</div>").click(i.callback).appendTo(t)})),this.buttonContainer=t}}),$.Class.extend("bizagi.rendering.tablet.slide.form",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideContainer&&this.slideContainer.destroy&&this.slideContainer.destroy(),this.slideContainer=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title}),this.configureViewHandlers()},goBack:function(){this.slideContainer.destroy()},configureViewHandlers:function(){},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getFormData(e)).then((function(a){!1===e.editable&&(a.form.properties.editable=!1);var r=bizagi.rendering.tablet.form.extend({submitForm:function(){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done((function(a){null===a||!0===a||"success"===a.type?(i.resolve(),t.goBack()):"validationMessages"===a.type?(t.form.addValidationMessage(a.messages),$.each(e,(function(e,i){var a=t.form.getRenders(e);$.each(a,(function(e,t){t.updateOriginalValue()}))}))):"error"===a.type&&t.form.addErrorMessage(a.message)})):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:a.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form||(t.form=new r(n)),t.form.render()})).done((function(i){t.slideContainer.element.html(i),t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">Save</div>').delegate('div[ordinal="0"]',"click",(function(){t.form.submitForm()})),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="1" id="formButton1" class="action-button ui-bizagi-form-button">'+bizagi.localization.getResource("render-form-dialog-box-cancel")+"</div>").delegate('div[ordinal="1"]',"click",(function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()})),t.form.triggerHandler("ondomincluded"),t.form.bind("refresh",(function(){t.renderSlideForm(e)}))})).fail((function(e,i,a){var r=t.renderFactory.getCommonTemplate("form-error"),n=a.message||"Error";$.fasttmpl(r,{message:n}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)})),i.promise()}}),$.Class.extend("bizagi.rendering.tablet.slide.grid",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormDeferred=new $.Deferred,this.slideFormParams=i||{},this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},render:function(e){return this.renderSlideForm(this.slideForm,e),this.slideFormDeferred.resolve(),this.slideFormDeferred.promise()},renderSlideForm:function(e,t){var i=this,a=i.transformData(t);i.form=i.renderFactory.getContainer({type:"form",data:a.form,navigation:i.slideFormParams.navigation,view_container:i.container}),i.form.buttons=[$.extend(i.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){i.goBack();var e={};i.form.collectRenderValues(e),i.slideFormDeferred.resolve(e)}}),$.extend(i.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){i.goBack(),i.slideFormDeferred.reject()}})],i.slideFormParams.allowEdition||i.form.buttons.shift(),$.when(i.form.render()).done((function(e){i.container.element.html(e),i.slideFormParams.navigation.navigate(i.container.id),i.container.setNavigationButtons(i.form),$(".ui-bizagi-button-container .action-button",i.form.container).remove(),$(".ui-bizagi-button-container",i.form.container).append(i.buttonContainer),i.form.triggerHandler("ondomincluded")}))},transformData:function(e){var t=this,i=e.row,a=e.columns,r=e.xpathContext.length>0?e.xpathContext+"."+e.xpath+"["+e.row[0]+"]":e.xpath+"[id="+e.row[0]+"]",n={type:"form",form:{elements:[],pageCacheId:e.pageCacheId,sessionId:e.sessionId,properties:{xpathContext:r},actions:t.transformActions(e.xpath,e.actions),validations:t.transformValidations(e.xpath,e.validations)}};return $.each(i,(function(e,i){if(e>0){var r={render:{properties:$.extend({},a[e-1].properties)}};if(r.render.properties.type=t.mapRenderType(r.render.properties.type),r.render.properties.displayType="both",0==t.slideFormParams.allowEdition&&(r.render.properties.editable=!1),r.render.properties.value=t.mapValue(r.render.properties.type,i),r.render.properties.recalculate&&(r.render.properties.data=null),void 0!==r.render.properties.columnVisible&&(r.render.properties.visible=r.render.properties.columnVisible),"upload"==r.render.properties.type&&(r.render.properties.isColumn=!0),"search"==r.render.properties.type){var o=r.render.properties.value;o.length>0&&(o=[].concat(o[0]),r.render.properties.value={id:o[0],label:o[1],additionallabel:o[2]||void 0})}n.form.elements.push(r)}})),n},mapRenderType:function(e){return"FormLink"===(e=e.replaceAll("tablet","").replaceAll("column",""))?"formLink":e=e.toLowerCase()},mapValue:function(e,t){return["combo","radio","list"].includes(e)?t&&t.length>0?[{id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!==t})):t[0][1]}]:null:t},transformActions:function(e,t){var i=this,a=[];return bizagi.util.isEmpty(t)?a:($.each(t,(function(t,r){for(var n=!1,o=0;o<r.dependencies.length;o++)-1!=r.dependencies[o].indexOf(e)&&(n=!0);if(n){for(var l=JSON.parse(JSON.encode(r)),s=0;s<l.dependencies.length;s++)l.dependencies[s]=l.dependencies[s].replaceAll(e+"[].","");i.transformConditions(e,l.conditions),i.transformCommands(e,l.commands),i.transformCommands(e,l.elseCommands),a.push(l)}})),a)},transformValidations:function(e,t){var i=this,a=[];return bizagi.util.isEmpty(t)?a:($.each(t,(function(t,r){var n=JSON.parse(JSON.encode(r));i.transformConditions(e,n.conditions),a.push(n)})),a)},transformConditions:function(e,t){if(t.expressions)for(var i in t.expressions)this.transformConditions(e,t.expressions[i]);else t.simple?this.transformConditions(e,t.simple):t.complex?this.transformConditions(e,t.complex):t.xpath?(t.xpath=t.xpath.replaceAll(e+"[].",""),"xpath"===t.argumentType&&(t.argument=t.argument.replaceAll(e+"[].",""))):t&&t.renderId&&(t.renderId=t.renderId.replaceAll(e+"[].",""))},transformCommands:function(e,t){var i=null;if(null!=t&&0!==t.length){for(var a=0;a<t.length;a++)"refresh"===t[a].command?i=a:(t[a].xpath&&(t[a].xpath=t[a].xpath.replaceAll(e+"[].","")),"xpath"===t[a].argumentType&&(t[a].argument=t[a].argument.replaceAll(e+"[].","")),!t[a].xpath&&t[a].renderId&&(t[a].renderId=t[a].renderId.replaceAll(e+"[].","")));null!=i&&t.splice(a,1)}},goBack:function(){this.container.destroy()}}),$.Class.extend("bizagi.rendering.tablet.slide.adhocForm",{},{init:function(e,t){this.renderFactory=e,this.slideFormDeferred=new $.Deferred,this.slideFormParams=t||{},this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},render:function(e){return this.renderSlideForm(e),this.slideFormDeferred.promise()},renderSlideForm:function(e){var t=this,i=t.transformData(e);t.form=t.renderFactory.getContainer({type:"form",data:i.form,navigation:this.slideFormParams.navigation,view_container:t.container}),t.form.buttons=[$.extend(t.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){if(t.form.validateForm()){t.goBack();var e={};t.form.collectRenderValues(e),t.slideFormDeferred.resolve(e)}}}),$.extend(t.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){t.goBack(),t.slideFormDeferred.reject()}})],t.slideFormParams.allowEdition||t.form.buttons.shift(),$.when(t.form.render()).done((function(a){"mock_id"==e.row[0]&&$.each(i.elementsWithDefaultValue,(function(e,i){var a=t.form.getRender(i.xpath+"."+i.id);a||(a=t.form.getRender(i.xpath));var r=bizagi.util.isArray(i.defaultValue)?i.defaultValue[0]:i.defaultValue;a.setDisplayValue(r)})),t.container.element.html(a),t.slideFormParams.navigation.navigate(t.container.id),$(".ui-bizagi-button-container .action-button",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append(t.buttonContainer),t.form.triggerHandler("ondomincluded")}))},transformData:function(e){var t=this,i=e.row,a=e.columns,r=!1,n=e.xpathContext.length>0?e.xpathContext+"."+e.xpath+"["+e.row[0]+"]":e.xpath+"[id="+e.row[0]+"]",o={type:"form",form:{elements:[],pageCacheId:e.pageCacheId,sessionId:e.sessionId,properties:{xpathContext:n},actions:t.transformActions(e.xpath,e.actions),validations:t.transformValidations(e.xpath,e.validations)},elementsWithDefaultValue:[]};return"mock_id"===i[0]&&(r=!0),$.each(i,(function(e,i){if(e>0){var n=a[e-1].properties,l={render:{properties:$.extend({},n)}};if(l.render.properties.type=t.mapRenderType(l.render.properties.type),l.render.properties.defaultvalue=void 0!==l.render.properties.defaultvalue?l.render.properties.defaultvalue:l.render.properties.defaultValue,l.render.properties.displayType="both",0==t.slideFormParams.allowEdition&&(l.render.properties.editable=!1),l.render.properties.value=t.mapValue(l.render.properties.type,i),l.render.properties.recalculate&&(l.render.properties.data=null),void 0!==l.render.properties.defaultvalue&&(void 0!==l.render.properties.value&&null!=l.render.properties.value||o.elementsWithDefaultValue.push({id:l.render.properties.id,xpath:l.render.properties.xpath,defaultValue:l.render.properties.defaultvalue})),void 0!==l.render.properties.columnVisible&&(l.render.properties.visible=l.render.properties.columnVisible),"readonly"===l.render.properties.type&&(l.render.properties.type="text",l.render.properties.editable=!1),"upload"===l.render.properties.type&&(l.render.properties.isColumn=!0),"search"===l.render.properties.type){var s=l.render.properties.value;null==s?l.render.properties.value={}:s.length>0&&(s=[].concat(s[0]),l.render.properties.value={id:s[0],label:s[1],additionallabel:s[2]||void 0})}var d=["document","formLink","upload","uploadecm","image","search"].includes(l.render.properties.type),c=!!l.render.properties.isExclusive&&"boolean"===l.render.properties.type;c||r&&d?l.render.properties.editable=!1:c&&(l.render.properties.value=s,l.render.properties.editable=!1),o.form.elements.push(l)}})),o},mapRenderType:function(e){return"FormLink"===(e=e.replaceAll("tablet","").replaceAll("column",""))?"formLink":e=e.toLowerCase()},mapValue:function(e,t){return["combo","radio","list"].includes(e)?t&&t.length>0?[{id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!==t})):t[0][1]}]:null:t},transformActions:function(e,t){var i=this,a=[];return bizagi.util.isEmpty(t)?a:($.each(t,(function(t,r){for(var n=!1,o=0;o<r.dependencies.length;o++)-1!=r.dependencies[o].indexOf(e)&&(n=!0);if(n){for(var l=JSON.parse(JSON.encode(r)),s=0;s<l.dependencies.length;s++)l.dependencies[s]=l.dependencies[s].replaceAll(e+"[].","");i.transformConditions(e,l.conditions),l.commands=i.transformCommands(e,l.commands),l.elseCommands=i.transformCommands(e,l.elseCommands),a.push(l)}})),a)},transformValidations:function(e,t){var i=this,a=[];return bizagi.util.isEmpty(t)?a:($.each(t,(function(t,r){var n=JSON.parse(JSON.encode(r));i.transformConditions(e,n.conditions),a.push(n)})),a)},transformConditions:function(e,t){if(t.expressions)for(var i in t.expressions)this.transformConditions(e,t.expressions[i]);else t.simple?this.transformConditions(e,t.simple):t.complex?this.transformConditions(e,t.complex):t.xpath?(t.xpath=t.xpath.replaceAll(e+"[].",""),"xpath"===t.argumentType&&(t.argument=t.argument.replaceAll(e+"[].",""))):t&&t.renderId&&(t.renderId=t.renderId.replaceAll(e+"[].",""))},transformCommands:function(e,t){if(null!=t)return t.reduce((function(t,i){return["refresh","submit-data","execute-rule","execute-interface","execute-sap","execute-connector","execute-excel-bot","execute-pipeline"].includes(i.command)||(i.xpath&&(i.xpath=i.xpath.replaceAll(e+"[].","")),"xpath"===i.argumentType&&(i.argument=i.argument.replaceAll(e+"[].","")),!i.xpath&&i.renderId&&(i.renderId=i.renderId.replaceAll(e+"[].","")),t.push(i)),t}),[])},goBack:function(){this.container.destroy()}}),$.Class.extend("bizagi.rendering.tablet.slide.searchForm",{},{init:function(e,t,i,a,r){this.dataService=e,this.renderFactory=t,this.searchForms=i,this.searchParams=a,this.searchFormParams=r,this.searchFormDeferred=new $.Deferred,this.container=this.searchFormParams.navigation.createRenderContainer({title:this.searchFormParams.title})},render:function(e){return this.properties=e,this.renderSearchForm(e),this.searchFormDeferred.promise()},renderSearchForm:function(e){var t=this;bizagi.loading.start(),$.when(t.getSearchContainerData(e)).then((function(e){e.form.properties&&(e.form.properties.orientation=t.searchParams.orientation||"ltr");var i=t.renderFactory.getContainer({type:"form",data:e.form,navigation:t.searchFormParams.navigation,view_container:t.container});return i.buttons=t.getSearchButtons(),t.form=i,(Object.keys(i.children)||[]).map((function(e){i.children[e].params=$.extend({},i.children[e].params,t.searchFormParams)})),i.render()})).done((function(e){var i=t.form.firstChild();t.container.element.html(e),t.searchFormParams.navigation.navigate(t.container.id),t.form.triggerHandler("ondomincluded"),t.currentSearchForm=i,t.currentSearchForm.triggerHandler("ondomincluded"),t.currentSearchForm.bind("instancerefresh",(function(){t.searchResultContainer.show()})),t.form.bind("refresh",(function(e,i){return i.scrollTop=t.form.container.parent().scrollTop(),i=$.extend({focus:focus,selectedTabs:t.form.getSelectedTabs(),isRefresh:!0,contextType:t.properties.contextType||"",navigation:t.searchFormParams.navigation,view_container:t.container},i),t.renderSearchForm(i)})),t.currentSearchForm.bind("instanceSelected",(function(e,i){t.goBack(),t.searchFormDeferred.resolve({id:i.id,label:""})})),t.containerSearchCriteria=t.currentSearchForm.container.find(".bz-container__search-criteria"),t.searchResultContainer=$(".bz-container__search-results",e),t.searchResultContainer.hide()})).fail((function(e){if(t.hasSessionFormException(e))t.goToStartPage(e);else{var i=t.renderFactory.getCommonTemplate("form-error"),a=e&&e.message?e.message:e;$($.fasttmpl(i,{message:a})).appendTo(t.container.element),t.searchFormParams.navigation.navigate(t.container.id)}})).always((function(){bizagi.loading.stop()}))},renderAddForm:function(e){var t=this;e=e||{};var i=t.properties;void 0===t.addContainer&&(t.addContainer=t.searchFormParams.navigation.createRenderContainer({title:bizagi.localization.getResource("render-dialog-entity")}),t.addContainer.element.bind("close",(function(){delete t.addContainer})));var a=e.isRefresh||!1,r={idPageCache:e.idPageCache,guidEntity:i.entity,contextType:"entity"};a?(r.isRefresh=!0,r.idStartScope=e.idStartScope):(r.idRender=i.idRender,r.requestedForm="addForm"),bizagi.loading.start(),$.when(t.dataService.getFormData(r)).then((function(i){!1===e.editable&&(i.form.properties.editable=!1),i.form.properties&&(i.form.properties.orientation=t.searchParams.orientation||"ltr"),i.form.contextType="entity";var r=t.renderFactory.getContainer($.extend({},t.addFormParams,{type:"form",data:i.form,focus:e.focus||!1,selectedTabs:e.selectedTabs,isRefresh:a,requestedForm:e.requestedForm,navigation:t.searchFormParams.navigation,view_container:t.addContainer}));return r.buttons=t.getAddFormButtons(r),$.extend(r,{processButtons:function(){$.each(r.buttons,(function(e,i){switch(i.ordinal){case 1:$(r.getButtons()[e]).click((function(){t.addContainer.destroy(),delete t.addContainer})),r.getButtons()[e].innerHTML=bizagi.localization.getResource("render-form-dialog-box-close"),r.buttons[e].caption=bizagi.localization.getResource("render-form-dialog-box-close"),r.buttons[e].action="back";break;default:$(r.getButtons()[e]).click((function(){t.saveDataAddForm(r),t.addContainer.destroy(),delete t.addContainer}))}}))}}),(Object.keys(r.children)||[]).map((function(e){r.children[e].params=$.extend({},r.children[e].params,t.addFormParams)})),$.when(r.render()).done((function(e){t.currentAddForm=r.firstChild(),t.addContainer.element.html(e),a||t.searchFormParams.navigation.navigate(t.addContainer.id,"overlay:up"),t.addContainer.setNavigationButtons(r),r.triggerHandler("ondomincluded"),t.handleSearchFormZindex("show"),r.bind("refresh",(function(e,i){return i.scrollTop=t.form.container.parent().scrollTop(),i=$.extend({focus:focus,selectedTabs:t.form.getSelectedTabs(),isRefresh:!0,contextType:t.properties.contextType||"",navigation:t.searchFormParams.navigation,view_container:t.addContainer},i),t.renderAddForm(i)}))}))})).fail((function(e){var i=bizagi.util.getErrorFormatted(e);t.hasSessionFormException(i)?t.goToStartPage(i):(t.addContainer.destroy(),delete t.addContainer)})).always((function(){bizagi.loading.stop()}))},saveDataAddForm:function(e){var t=this,i=$.Deferred();if(e.validateForm()){var a={};$.forceCollectData=!0,e.collectRenderValues(a),a.idPageCache=e.idPageCache;var r={action:"SAVE",data:a,idPageCache:a.idPageCache,guidEntity:e.properties.entity,contexttype:"entity"},n={};e.collectRenderValuesForSubmit(n),$.forceCollectData=!1,bizagi.util.isMapEmpty(n)?(bizagi.showMessageBox(bizagi.localization.getResource("render-search-advanced-no-filters")),i.reject()):(bizagi.loading.start(),$.when(t.dataService.submitData(r)).done((function(a){function r(e){var i=t.currentSearchForm.getRender(e);return"object"===_typeof(i)&&null!==i?{found:!0,obj:i}:{found:!1,obj:{}}}if(a&&"validationMessages"===a.type)e.addValidationMessage(a.messages),i.reject();else{for(var o in n){var l=r(o);l.found&&(l.obj.setValue(n[o]),t.setDisplayValueToControl(l.obj,e,o,n))}i.resolve()}})).fail((function(a){var r=bizagi.util.getErrorFormatted(a);if(t.hasSessionFormException(r))t.goToStartPage(r);else{var n=r.message||bizagi.localization.getResource("workportal-general-error");e.addValidationMessage(n)}i.reject()})).always((function(){bizagi.loading.stop()})))}else i.reject();return i.promise()},setDisplayValueToControl:function(e,t,i,a){"searchSuggest"===e.properties.type?e.setDisplayValue(t.getRender(i).getDisplayValue()):e.setDisplayValue(a[i])},getSearchButtons:function(){var e=this,t=[{ordinal:1,action:"search",caption:bizagi.localization.getResource("render-form-dialog-box-search"),callback:function(){e.currentSearchForm.performSearch(e.searchParams)}},{ordinal:2,action:"cancel",caption:"cancel",callback:function(){e.goBack()}}];return e.searchFormParams.allowNew&&t.push({ordinal:3,action:"add",caption:bizagi.localization.getResource("render-form-dialog-box-add"),callback:function(){var t={idCase:e.searchFormParams.idCase,idRender:e.properties.idRender,displayName:e.properties.displayName,idPageCache:e.properties.idPageCache};e.renderAddForm(t)}}),t},getSearchContainerData:function(e){var t=this,i=new $.Deferred,a={form:{properties:{},elements:[]}},r=a.form,n=t.searchForms[0];if(t.searchForms.length>1){var o={properties:{type:"tab"},elements:[]},l=[];$.each(t.searchForms,(function(e,i){var a=i.default||!1,s={properties:{id:e,type:"tabItem",displayName:i.caption},elements:[]};a?(o.elements.push({container:s}),r=s,n=t.searchForms[0]):l.push({container:s})})),$.each(l,(function(e,t){o.elements.push(t)})),a.form.elements.push({container:o})}return bizagi.loading.start(),$.when(t.getSearchFormData(e,n)).done((function(e){r.elements.push(e),r.properties.id=Math.guid(),i.resolve(a)})).fail((function(e){var t=bizagi.util.getErrorFormatted(e);i.reject(t)})).always((function(){bizagi.loading.stop()})),i.promise()},getSearchFormData:function(e,t){return this.dataService.getSearchFormData($.extend(e,{idSearchForm:t.id,url:t.url})).pipe((function(t){return t.form.properties.idRender=e.idRender,t}))},goBack:function(){this.handleSearchFormZindex("hide"),this.container.destroy()},handleSearchFormZindex:function(e){var t=$.grep($(".km-modalview-root"),(function(e){return"block"===$(e).css("display")}));if(t.length>0){var i="show"===e?0:10001;$(t).css("z-index",i)}},hasSessionFormException:function(e){return void 0!==e&&"AUTH_ERROR"===e.code},goToStartPage:function(e){this.searchFormParams.navigation&&this.searchFormParams.navigation.goToStartPage(e)},getAddFormButtons:function(e){var t=this;return[$.extend(e.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""},{callback:function(){t.saveDataAddForm(e).done((function(){t.addContainer.destroy(),delete t.addContainer,setTimeout((function(){t.currentSearchForm.performSearch(t.searchParams)}),350)}))}}),$.extend(e.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:""},{callback:function(){t.addContainer.destroy(),delete t.addContainer}})]}}),$.Class.extend("bizagi.rendering.tablet.slide.upload",{},{init:function(e,t,i){var a=this;this.dataService=e,this.renderFactory=t,this.slideFormDeferred=new $.Deferred,this.slideFormParams=i||{},a.slideContainer=a.slideFormParams.navigation.createRenderContainer({title:a.slideFormParams.title}),a.processButtons().done((function(e){a.slideFormDeferred.resolve(e)})).fail((function(){a.slideFormDeferred.reject()}))},processButtons:function(){var e=this,t=new $.Deferred,i={buttons:[]},a=function(){e.goBack(),t.reject()};return i.buttons.push({text:bizagi.localization.getResource("workportal-case-dialog-box-close"),caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!1,refresh:!1,ordinal:0,action:"back",save:!0,style:"",callback:a,click:a}),this.slideFormParams=$.extend(i,this.slideFormParams),e._renderButtons(this.slideFormParams),t.promise()},render:function(e){return this.renderUploadFile(this.slideForm,e),this.slideFormDeferred.promise()},renderUploadFile:function(e,t){var i=this.renderFactory.getCommonTemplate("uploadSlide"),a=$.fasttmpl(i,{url:t.url});this.slideContainer.element.html(a),this.slideFormParams.navigation.navigate(this.slideContainer.id);var r=$.extend({originalProperties:{uniqueId:101,id:101}},this.slideFormParams);r.container=this.slideContainer.element,this.slideFormParams.navigation.setNavigationButtons(r),a.find(".ui-slide-upload-link").click((function(){$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-tablet-slide-upload-confirmation"))).done((function(){window.location.href=t.url}))}))},goBack:function(){this.slideContainer.destroy()},_renderButtons:function(e){var t=$('<div class="bz-slide-button-container"></div>');$.each(e.buttons,(function(e,i){$('<div class="action-button">'+i.text+"</div>").click(i.click).appendTo(t)})),this.buttonContainer=t}}),$.Class.extend("bizagi.rendering.tablet.startForm",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideContainer=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title}),this.configureViewHandlers()},configureViewHandlers:function(){},goBack:function(){this.slideContainer.destroy()},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getStartForm(e)).then((function(a){!1===e.editable&&(a.form.properties.editable=!1);var r=bizagi.rendering.tablet.form.extend({submitForm:function(){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done((function(a){null==a||1==a||"success"==a.type?(i.resolve(),t.goBack()):"validationMessages"==a.type?(t.form.addValidationMessage(a.messages),$.each(e,(function(e,i){var a=t.form.getRenders(e);$.each(a,(function(e,t){t.updateOriginalValue()}))}))):"error"==a.type&&t.form.addErrorMessage(a.message)})):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:a.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form=new r(n),t.form.bind("refresh",(function(i,a){a=$.extend({selectedTabs:t.form.getSelectedTabs(),isRefresh:!0},e,a,{idStartScope:t.form.properties.idStartScope}),t.renderSlideForm(a)})),t.form.buttons=[$.extend(t.form.buttons[0]||{},{caption:t.slideFormParams.saveButtonLabel,actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""})],t.form.render()})).done((function(i){t.slideContainer.element.html(i),e.isRefresh||t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">'+(t.slideFormParams.saveButtonLabel?t.slideFormParams.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"))+"</div>").delegate('div[ordinal="0"]',"click",(function(){t.form.submitForm()})),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="1" id="formButton1" class="action-button ui-bizagi-form-button">'+bizagi.localization.getResource("render-form-dialog-box-cancel")+"</div>").delegate('div[ordinal="1"]',"click",(function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()})),t.form.triggerHandler("ondomincluded")})).fail((function(e,i,a){var r=t.renderFactory.getCommonTemplate("form-error"),n=a.message||"Error";$.fasttmpl(r,{message:n}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)})),i.promise()}}),$.Class.extend("bizagi.rendering.tablet.slide.ecm",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideFormDeferred=new $.Deferred,this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},render:function(e){return this.renderSlideForm(e),this.slideFormDeferred.promise()},renderSlideForm:function(e){var t=this,i=t.getMetadataForm(e);t.form=t.renderFactory.getContainer({type:"form",data:i.form,navigation:t.slideFormParams.navigation,view_container:t.container}),$.when(t.form.render()).done((function(i){t.container.element.html(i),t.slideFormParams.navigation.navigate(t.container.id),t.processButtons(t.form,e),t.container.setNavigationButtons(t.form),t.form.triggerHandler("ondomincluded")})).always((function(){t.slideFormDeferred.resolve()}))},processButtons:function(e,t){var i=this;e.buttons=[{ordinal:0,action:"save",caption:bizagi.localization.getResource("render-form-dialog-box-save"),callback:i.onSaveDataMetadataForm.bind(i,t.fileData)},{ordinal:1,action:"back",caption:bizagi.localization.getResource("render-form-dialog-box-close"),callback:function(){i.slideFormParams.onCancel({}),i.goBack()}}],i.slideFormParams.editable||e.buttons.shift()},getMetadataForm:function(e){var t=this,i={type:"form",form:{elements:[],pageCacheId:e.pageCacheId,sessionId:e.sessionId,properties:{id:101,xpathContext:e.xpathContext,editable:t.slideFormParams.editable,orientation:t.slideFormParams.orientation||"ltr"}}};return $.each(e.metadata,(function(e,a){var r=t.getRenderType(a.metadataType),n=Object.assign({id:e+1,xpath:a.metadataId,displayName:a.description,required:!0===bizagi.util.parseBoolean(a.required),editable:!1===bizagi.util.parseBoolean(a.readOnly),value:a.value},r);i.form.elements.push({render:{properties:n}})})),i},getRenderType:function(e){switch(e.toUpperCase()){case"INTEGER":return{type:"number",dataType:2,allowDecimals:!1,thousands:!1};case"DECIMAL":return{type:"number",dataType:10,allowDecimals:!0,thousands:!0};case"DATETIME":return{type:"date",dataType:12};case"BOOL":return{type:"boolean",dataType:5};case"STRING":default:return{type:"text",dataType:15,maxLength:50,autoExtend:!1}}},onSaveDataMetadataForm:function(e){var t=this,i=$.Deferred();if(t.form.validateForm()){var a={};if(t.form.collectRenderValuesForSubmit(a),$.forceCollectData=!1,bizagi.util.isMapEmpty(a))t.slideFormParams.onSave({update:!1}),i.resolve({update:!1}),t.goBack();else{var r=Object.keys(a).map((function(e,t){return{idMetadata:e,value:a[e]}})),n={idFileUpload:e.idFileUpload,fileName:e.fileName,idPageCache:e.idPageCache,xpathContext:e.xpathContext,xPath:e.xpath,idAttrib:e.idAttrib};n.metaValues=JSON.encode({metadataValues:r}),bizagi.loading.start(),$.when(t.dataService.updateECMMetadata(n)).done((function(a){a&&a.idFileUpload&&(t.slideFormParams.onSave({update:!0,idFileUpload:a.idFileUpload,fileName:e.fileName}),i.resolve({update:!0})),t.goBack()})).fail((function(e){t.form.addValidationMessage(e.message),i.reject()})).always((function(){bizagi.loading.stop()}))}}i.promise()},goBack:function(){this.container.destroy()}}),bizagi.rendering.container.extend("bizagi.rendering.tablet.container",{},{startLoading:function(){},endLoading:function(){}}),bizagi.rendering.render.extend("bizagi.rendering.tablet.render",bizagi.rendering.render.base.prototype),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.render",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer();this.formParams=t.getParams()},getLabel:function(){return this.label||(this.label=$(".bz-form-label label",this.element||this.observableElement)),this.label},getFormattingLabel:function(){return this.getLabel()},getControl:function(){return this.control&&0!==this.control.length||(this.control=$(".bz-control",this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},getControlFiller:function(){return this.controlFiller||(this.controlFiller=$(".bz-form-item__control",this.element||this.observableElement)),this.controlFiller},getContainerMessage:function(){return this.containerMessage||(this.containerMessage=$(".bz-form-message__text",this.element||this.observableElement)),this.containerMessage},getColumnContainerMessage:function(){return this.containerMessage||(this.containerMessage=$(".bz-form-cell-message__text",this.element||this.observableElement)),this.containerMessage},startLoading:function(){},endLoading:function(){},getDisplayOptionClass:function(e){return"normal"===e||"both"===e?"bz-form-item--display-normal":"vertical"===e?"bz-form-item--display-vertical":"reversed"===e?"bz-form-item--display-reversed":"label"===e?"bz-form-item--display-label":"value"===e?"bz-form-item--display-value":void 0},changeDisplayOption:function(e){},getAlignClass:function(e){return e},changeLabelAlign:function(e){},changeValueAlign:function(e){},customizeRenderWidth:function(){var e=this.getLabel(),t=this.properties,i=this.getControlFiller(),a=t.labelWidth?"0"!=t.labelWidth?t.labelWidth:"50%":null,r=t.valueWidth?"0"!=t.valueWidth?t.valueWidth:"50%":null;a&&!r?r=100-(a=bizagi.util.percent2Number(a)):!a&&r?a=100-(r=bizagi.util.percent2Number(r)):(a=bizagi.util.percent2Number(a))+(r=bizagi.util.percent2Number(r))!=100&&(r=100-a),e.width(a+"%"),i.width(r-.01+"%")},setValidationMessage:function(e){this._super(e);var t=bizagi.util.normalizeType(this.properties.type),i="grid"===t||"groupedgrid"===t,a=this.grid&&this.column&&/column/.test(t)?this.getColumnContainerMessage():this.getContainerMessage();e&&e.length>0?(e=e.replace(/<\w+>([^<]*)<\/\w+>/g,"$1"),a.attr("data-error",e),a.text(e),this.element&&(i?this.element.addClass("bz-form-item-grid--error"):this.element.addClass("bz-form-item--error"))):(a.text(""),this.element&&(i?this.element.removeClass("bz-form-item-grid--error"):this.element.removeClass("bz-form-item--error")))},setDisplayValue:function(e){var t=this.getControl();if(this.setValue(e,!1),!this.properties.editable&&"check"!==this.properties.display){var i=this.getDisplayValue(e);"string"!=typeof i&&"number"!=typeof i||$(t).html("<label class='bz-form-label'>"+i+"</label>")}},getElementsToStylize:function(e){return $(".bz-input, .bz-input-icon__input",e)},getFormParams:function(){return this.formParams||{}},changeRequired:function(e){this.properties.required=e,bizagi.util.parseBoolean(e)&&this.properties.editable?this.element.addClass("bz-form-item--required"):this.element.removeClass("bz-form-item--required"),this.triggerRenderValidate()},changeRequiredLabel:function(e){},clearDisplayValue:function(){var e=this.getControl().find("input").filter((function(e,t){return"file"!==t.type&&"radio"!==t.type&&"checkbox"!==t.type}));e.length>0?e.val(this.getValue()):this.setDisplayValue("")}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.form",bizagi.rendering.form.prototype),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.form",{},{init:function(e){var t=this;if(e=e||{},t.warnings={},t.errors={},e.syncError){e.data.properties.editable=!0!==e.isOfflineErrorMode;var i="business"==e.syncError.type?e.syncError.message:void 0;if(!bizagi.util.isEmpty(i))try{(i=$.makeArray(i)).forEach((function(e){t.errors[e]=e}))}catch(e){console.error("syncErrorMessage could not be parsed as array",i),t.errors[i]=i}delete e.syncError}t.isOfflineErrorMode=!0===e.isOfflineErrorMode,t.showToastOnSuccessSync=!0===e.showToastOnSuccessSync,t.removeSyncErrorOnSubmit=!0===e.removeSyncErrorOnSubmit,this._super(e)},configureHandlers:function(){var e=this,t=e.container;e.configureComplexGateway(),e.processButtons(t),e.bind("ondomincluded",(function(){var t=e.getValidationsContainer();e.validationController=new bizagi.command.controllers.validation(e,e.validations,t),e.actionController=new bizagi.command.controllers.action(e,e.actions),e.readyDeferred.resolve()})),e.bind("modalViewDidAppear",(function(){e.params.navigation.modalViewDidAppear()})),e.bind("closeModalValidationMessage",(function(){e.validationController&&e.validationController.clearValidationMessages()})),e.bind("modalViewDidDisappear",(function(){e.params.navigation.modalViewDidDisappear()})),e.configureNetworkHandlers()},postRenderContainer:function(e){var t=this;t.properties;t._super(e);var i=t.getButtons();if(bizagi.util.isiOSTabletDevice()&&$(".km-native-scroller").css("-webkit-overflow-scrolling","inherit"),!bizagi.util.isObjectEmpty(t.warnings)){var a=$('<ul class="ui-bizagi-form-warnings"></ul>');for(var r in t.warnings)a.append($("<li>"+r+"</li>"));$("<button>X</button>").appendTo(a),a.prependTo(t.container),a.click((function(){a.detach()}))}if(!bizagi.util.isEmpty(t.errors))for(var n in t.errors)setTimeout((function(){t.addValidationMessage(n)}),1);(i?i.length:0)&&($(document).data("auto-save","auto-save"),$(document).unbind("save-form").bind("save-form",(function(e,i){t.allowOnlineActions()?t.autoSaveEvents(i):i.resolve()})),$(window).unbind("beforeunload").bind("beforeunload",(function(e){var i={};if(t.collectRenderValues(i),!$.isEmptyObject(i)&&$(document).data("auto-save"))return bizagi.localization.getResource("confirmation-savebox-message2")}))),bizagi.util.isiOSTabletDevice()&&setTimeout((function(){$(".km-native-scroller").css("-webkit-overflow-scrolling","touch")}),1e3);var o=this.getParams()||{},l=$.extend([],o.selectedSection);this.setParam("selectedSection",[]),l.length>0&&l.forEach((function(e){var i=t.getRenderById(e);void 0!==i&&i.expand()}))},autoSaveEvents:function(e,t){var i=this,a={};if(i.isOfflineErrorMode)e.resolve();else if(i.collectRenderValues(a),$.isEmptyObject(a))e.resolve();else{var r="startform"===i.properties.formtype,n=r?bizagi.localization.getResource("confirmation-savebox-message4"):bizagi.localization.getResource("confirmation-savebox-message1"),o=r?bizagi.showConfirmationBox(n,"Bizagi","warning",[{label:bizagi.localization.getResource("confirmation-box-ok"),action:"resolve"},{label:bizagi.localization.getResource("confirmation-box-cancel"),action:"reject"}]):bizagi.showSaveBox(n,"Bizagi","warning");$.when(o).done((function(){r?e.resolve():(bizagi.loading.start(),$.when(i.saveForm()).always((function(){if(i.params.isOfflineForm&&"task"===i.params.offlineType&&i.online){var t=new $.Deferred,a=$.extend({deferred:t},i.params);$(document).trigger("tryPushCase.offline",a),$.when(t).then((function(){e.resolve()})).fail((function(){console.log("Auto-Save Sync Error",arguments),e.resolve()})).always((function(){bizagi.loading.stop()}))}else bizagi.loading.stop(),e.resolve()})))})).fail((function(){r?e.reject():e.resolve()}))}},internalSubmitForm:function(e){var t=this,i=[],a=$.Deferred(),r=null,n=null,o=null,l=null,s=null,d={};if((e.submitData||e.executeRule||e.createnewcase)&&(d=t.collectRenderValuesForSubmit()),$.when(t.startLoading()).done((function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")})),e.executeRule&&((r=t.dataService.submitData({action:"SUBMITDATA",data:d,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0})).tag="submitData",l=t.prepareCheckpointAction(e.id),d={},(n=t.dataService.executeButton({idRender:e.id,xpathContext:t.properties.xpathContext||"",idPageCache:t.properties.idPageCache,prepare:!0})).tag="executeRule",s=t.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase||e.nextWithoutValidations){if(t.transitions){var c=[];if($.each(this.activeTransitions,(function(e,t){t&&c.push(e)})),0==bizagi.util.countProps(c))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),t.endLoading(),a.reject(),a.promise()}(o=t.dataService.submitData({action:e.action,forcePlanCompletion:e.forcePlanCompletion,data:d,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0,transitions:c||"",contexttype:t.properties.contextType,surrogatekey:t.properties.surrogateKey})).tag="performAction"}n&&(i.push(r),l&&i.push(l),i.push(n),s&&i.push(s)),o&&i.push(o),bizagi.chrono.initAndStart("submitForm-ajax");var p=new $.Deferred;return d&&d.deferreds?$.when.apply($,d.deferreds).done((function(e){p.resolve(e),delete d.deferreds})).fail((function(){p.reject(),console.log("Error: It was not possible resolve async actions on form ")})):p.resolve(),$.when(p).done((function(){bizagi.util.tablet.startLoading(),$.when(t.dataService.multiaction().execute({actions:i})).done((function(i){var r;if(bizagi.chrono.stop("submitForm-ajax"),$.each(i,(function(e,i){"validationMessages"==i.result.type&&(t.addValidationMessage(i.result.messages),r=!0),"alertMessages"==i.result.type&&(bizagi.showMessageBox(i.result.messages.join(","),bizagi.localization.getResource("workportal-general-word-information","Information")),r=!0)})),r)e.executeRule&&t.sendRollbackAction(e.id);else{if(!t.postProcessButton(i,e))return;e.refresh&&t.refreshForm(),e.routing&&t.triggerHandler("routing",{idCase:t.params.idCase,buttonPropertiesAction:e.action}),e.createnewcase&&i.length>0&&t.triggerHandler("routing",{idCase:i[0].result.IdCase,caseNumber:i[0].result.CaseNumber})}delete t.nonSupportedMethods,a.resolve()})).fail((function(i,r,n){e.executeRule&&t.sendRollbackAction(e.id),n&&n.error&&("WaitForCompletionPlanException"===n.error.errorType||"InvalidPlanStateException"===n.error.errorType||"CustomMessageException"===n.error.errorType)?(t.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(n.error.message),null,!1)).then((function(){return $.when(t.internalSubmitForm($.extend({},e,{forcePlanCompletion:!0})))})).done((function(){a.resolve()})).fail((function(){a.reject()}))):(t.failHandler({error:void 0===n?bizagi.localization.getResource("workportal-general-error"):n}),a.reject(n))})).always((function(){bizagi.util.tablet.stopLoading()}))})).always((function(){bizagi.util.tablet.stopLoading()})),a.promise()},prepareCheckpointAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},prepareCommitAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},getPane:function(){return this.pane},getButtons:function(){return this.getParams()&&(handler=this.getParams().getButtons)&&handler(this),$(".ui-bizagi-button-container :button",this.container)},processButtons:function(){var e=this.getParams();e&&e.processButtons&&(0,e.processButtons)(this);var t=this.properties,i=this.getButtons();t.buttons=this.buttons||i,this.saveButton=null,this.nextButton=null;for(var a=0,r=t.buttons.length;a<r;a++)"save"==t.buttons[a].action?this.saveButton=t.buttons[a]:"next"==t.buttons[a].action&&(this.nextButton=t.buttons[a]);var n=this.getNavigation();if(void 0!==n){var o=this.getViewContainer();void 0!==o?o.setNavigationButtons(this):n.setNavigationButtons(this)}this._super()},refreshForm:function(e,t){var i,a=this,r=a.properties,n=a.getParams(),o=$.Deferred();return e=e||a.getFocus(),t=0!=t||t,e&&!e.id&&(e={id:e}),i={idCase:a.params.idCase||"",idWorkitem:a.params.idWorkitem||"",idTask:a.params.idTask||"",focus:e,selectedTabs:a.getSelectedTabs(),selectedSection:a.getSelectedSection(),xpathContext:r.xpathContext,idPageCache:r.idPageCache,isRefresh:!0,action:a.getEndPointAction(),idStartScope:a.properties.idStartScope||"",navigation:n.navigation,view_container:n.view_container},a.isOfflineRefreshWithEdition&&(i.isEdited=!0,a.isOfflineRefreshWithEdition=!1),(n.postRenderEdit||n.processButtons)&&(i.isOfflineForm=a.params.isOfflineForm||!1,i.formsRenderVersion=a.params.formsRenderVersion||0,i.postRenderEdit=n.postRenderEdit,i.processButtons=n.processButtons,i.originalParams=n.originalParams||{},i.getButtons=n.getButtons),$(".km-native-scroller").css("-webkit-overflow-scrolling","inherit"),t&&a.startLoading(),$.when(a.triggerHandler("refresh",i)).done((function(){setTimeout((function(){$(".km-native-scroller").css("-webkit-overflow-scrolling","touch")}),1e3),o.resolve()})).fail((function(){o.reject()})).always((function(){t&&a.endLoading()})),o.promise()},checkWidgetsData:function(){var e=null;if(bizagi.workportal.tablet.popup&&bizagi.workportal.tablet.popup.instance&&bizagi.workportal.tablet.popup.instance.getResponseValues){if(null===(e=bizagi.workportal.tablet.popup.instance.getResponseValues(bizagi.workportal.tablet.popup.instance.getResponseValuesParams)))return bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-complexgateway-path"),bizagi.localization.getResource("workportal-widget-complexgateway-error")),-1;bizagi.workportal.tablet.popup.instance.dontClose=!1,bizagi.workportal.tablet.popup.instance.close()}return e},repaintComplexGateway:function(){var e=this;void 0!==e.focus&&void 0!==e.focus.idCaseObject&&void 0!==e.focus.idCaseObject.isComplex&&e.dataService.getWorkitems({idCase:e.focus.idCaseObject.idCase}).done((function(t){if(1==t.workItems.length&&"ComplexGateway"==t.workItems[0].taskType){var i=t.workItems[0].transitions;e.currentPopup="complexgateway",$(document).triggerHandler("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_COMPLEXGATEWAY,options:{transitions:i,sourceElement:".ui-bizagi-form",insertAfter:".ui-bizagi-form .ui-bizagi-button-container",height:"auto",offset:"8 0",activeScroll:!1,dontClose:!0,closed:function(){e.currentPopup=null}}})}}))},addWarning:function(e){this.warnings[e]=e},addError:function(e){this.errors[e]=e},processButton:function(e){var t=$.Deferred();return!bizagi.util.isObjectEmpty(this.errors)&&(t.resolve(),bizagi.util.parseBoolean(e.routing))?t.promise():this._super(e)},getNavigation:function(){return this.getFormContainer().getParams().navigation},getViewContainer:function(){return this.getFormContainer().getParams().view_container},isFloatingButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFloatingButtonsEnabled()},isFormButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFormButtonsEnabled()},startLoading:function(){bizagi.loading.start()},endLoading:function(){bizagi.loading.stop()},dispose:function(e){void 0!==e&&void 0!==e.isRefresh&&0!=e.isRefresh||this._super()},failHandler:function(e){this._super(e);var t={};try{t=JSON.parse(e)||{}}catch(i){t=e.length&&e.length>1?e[0]:e}finally{t.error&&(t=t.error),t.error&&(t=t.error),void 0!==t.code&&"AUTH_ERROR"===t.code&&this.refreshAfterSessionIdle()}},refreshAfterSessionIdle:function(){$.notifier.add({title:bizagi.localization.getResource("workportal-sessiontimeout-expired-title","Your session has expired"),text:bizagi.localization.getResource("render-idle-expired-error","Idle timer expired. For safety reasons this view will be refreshed automatically in 5 seconds. Note that any unsaved data is lost.").replace("%s","5"),sticky:!1,overlay:!0,time:5e3,after_close:this.routingToProcess.bind(this)})},routingToProcess:function(){var e=this.params||{},t=this.getFormContainer();if(t&&t.isStartForm()){var i=e&&e.originalParams||{};i&&i.idProcess&&bizagi.webpart.publish("render-start-form",{params:{showProcess:!0,hasStartForm:!0,fromNewCase:!0,idProcess:i.idProcess,displayName:i.displayName||"",mapping:{},type:"Process"}})}else this.triggerHandler("routing",{idCase:e.idCase,idWorkitem:e.idWorkitem})},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("form"),i=$.fasttmpl(t,{buttons:this.buttons,transitions:this.transitions,uniqueId:e.uniqueId,helptext:e.helpText,mode:this.getMode(),queryForm:"queryForm"==this.getFormType(),summaryForm:this.params.summaryForm||!1,globalForm:this.properties.displayAsReadOnly||!1,idCase:"",displayName:this.params.displayName||"",processPath:e.processPath,breadCrumb:e.breadCrumb,orientation:e.orientation});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},triggerGlobalHandler:function(e,t){return this.parent?this.parent.triggerGlobalHandler(e,t):this.observableElement&&this.observableElement.trigger(e,t),this._super(e,t)},configureComplexGateway:function(){var e,t=this,i=t.container;i.length>1?$(i.children()).each((function(){$(this).hasClass(".bz-complex-gateway")&&(e=this)})):e=$(".bz-complex-gateway",i),t.activeTransitions={},$(".bz-checkbox__input",e).on("click",(function(){var e=$(this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),t.activeTransitions[i]=e.is(":checked")||!1}))},getValidationsContainer:function(e){var t=this.getNavigation();if(void 0!==t){var i=this.getViewContainer(),a=void 0!==i?i.view:t.view;if(a&&a.footer)return a.footer}return this._super(this,e)}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.panel",bizagi.rendering.panel.prototype),bizagi.rendering.tablet.panel.extend("bizagi.rendering.tablet.panel",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.contentPanel",bizagi.rendering.contentPanel.prototype),bizagi.rendering.tablet.contentPanel.extend("bizagi.rendering.tablet.contentPanel",{},{}),bizagi.rendering.tablet.panel.extend("bizagi.rendering.tablet.nestedForm",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.tab",bizagi.rendering.tab.prototype),bizagi.rendering.tablet.tab.extend("bizagi.rendering.tablet.tab",{},{postRenderContainer:function(e){var t=this;this._super(e),e.material_bizagi_tabs({direction:this.properties.orientation,active_index_tab:this.activeTab}).on("updateActive",(function(e,i){e.stopPropagation(),t.setActiveTab(i.index)})),$("> .bz-tabs > .bz-tab",e).rippleEffect()}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.tabItem",bizagi.rendering.tabItem.prototype),bizagi.rendering.tablet.tabItem.extend("bizagi.rendering.tablet.tabItem",{},{setAsActiveContainer:function(e){var t=this;$.when(t.ready()).done((function(){var e=$("[data-reference='#ui-bizagi-tab-"+t.properties.id+"']",t.parent.tabs);e.css("display",""),e.click()}))},focus:function(){this.activate(),this.setAsActiveContainer(),this._super()},changeVisibility:function(e){var t=this;t.properties.visible=bizagi.util.parseBoolean(e),$.when(t.ready()).done((function(){var e=$("[data-reference='#ui-bizagi-tab-"+t.properties.id+"']",t.parent.tabs),i=t.parent.container.material_bizagi_tabs("getActiveTab");t.properties.visible?(e.css("display",""),t.properties.counter===i.index?(t.container.css("display",""),t.setAsActiveContainer()):t.container.css("display","none")):(t.container.css("display","none"),e.css("display","none"),i=t.parent.container.material_bizagi_tabs("getActiveTab"),t.properties.counter===i.index?t.parent.container.material_bizagi_tabs("moveToNextTab"):t.parent.container.material_bizagi_tabs("refreshPositions"))}))},afterToRefresh:function(){var e=this;e._super(),$.when(e.ready()).done((function(){e.parent.container.material_bizagi_tabs("refreshTab",e.properties.id)}))}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.horizontal",bizagi.rendering.horizontal.prototype),bizagi.rendering.tablet.horizontal.extend("bizagi.rendering.tablet.horizontal",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.layout",bizagi.rendering.layout.prototype),bizagi.rendering.tablet.layout.extend("bizagi.rendering.tablet.layout",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.accordion",bizagi.rendering.accordion.prototype),bizagi.rendering.tablet.accordion.extend("bizagi.rendering.tablet.accordion",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.accordionItem",bizagi.rendering.accordionItem.prototype),bizagi.rendering.tablet.accordionItem.extend("bizagi.rendering.tablet.accordionItem",{},{setAsActiveContainer:function(e){},focus:function(){this.setAsActiveContainer(),this._super()}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.group",bizagi.rendering.group.prototype),bizagi.rendering.tablet.group.extend("bizagi.rendering.tablet.group",{},{configureHandlers:function(){var e=this;$(">h5.bz-collapsible__header",e.container).bind("click",(function(){$(e.container).toggleClass("bz-collapsible--collapsed")}))},postRenderContainer:function(e){this._super(e),this.properties.collapse&&this.collapse()},isOpen:function(){return!this.container.hasClass("bz-collapsible--collapsed")},focus:function(){this.expand(),this._super()},expand:function(){this.isOpen()||$(">h5.bz-collapsible__header",this.container).trigger("click")},collapse:function(){this.isOpen()&&$(">h5.bz-collapsible__header",this.container).trigger("click")},toogleContainer:function(e){e?this.expand():this.collapse()}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.section",bizagi.rendering.section.prototype),bizagi.rendering.tablet.section.extend("bizagi.rendering.tablet.section",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("section"),i=$.fasttmpl(t,{expandedClassIcon:this.expandedIcon,displayName:e.displayName,editable:e.editable,orientation:e.orientation,uniqueId:e.uniqueId,isDesign:"execution"!==this.getMode(),messageValidation:e.messageValidation,guid:e.guid,displayAs:e.displayAs});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},configureHandlers:function(){var e=this,t=e.getSectionOrientationRTL(e)?"rtl":"ltr";$(e.container).attr("dir",t),e.bind("reopenSection",(function(){e.expand()})),$(">div.bz-section__content",e.container).mobileModal({displayName:e.properties.displayName,displayNameParent:e.getParentDisplayName(),anchor:$(">div.bz-section__header",e.container),dir:t,appendTo:e.container,onBeforeShow:function(t){e.addToHistoryNavigation(),setTimeout((function(){var t=e.getSectionParent(e.parent);$("header[data-role=header]").css({display:"none"}),$("div[data-role=footer] .bz-form-buttons").css({display:"none"}),e.isFirstLevel(!0)||$($("div[data-role=header]",t.container)[0]).css({display:"none"})}),250)},onShow:function(e){},onClose:function(t){t&&t.close(),e.removeFromHistoryNavigation();var i=e.getSectionParent(e.parent);e.isFirstLevel()?($("header[data-role=header]").css({display:"block"}),$("div[data-role=footer] .bz-form-buttons").css({display:"flex"})):$($("div[data-role=header]",i.container)[0]).css({display:"flex"})}})},isFirstLevel:function(e){var t=(this.getFormContainer().getParams()||{}).selectedSection;return void 0===t||(e?t.length<=1:0===t.length)},addToHistoryNavigation:function(){var e=this.getFormContainer(),t=e.getParams()||{};void 0===t.selectedSection&&(e.setParam("selectedSection",[]),t=e.getParams()),t.selectedSection.push(this.properties.id)},removeFromHistoryNavigation:function(){var e=this.getFormContainer().getParams()||{};void 0!==e.selectedSection&&e.selectedSection.pop()},isOpen:function(){return!this.container.hasClass("bz-section--collapsed")},focus:function(){this.expand(),this._super()},expand:function(){$(">div.bz-section__header",this.container).trigger("click")},collapse:function(){this.isOpen()&&$(">div.bz-section__header",this.container).trigger("click")},toogleContainer:function(e){e?this.expand():this.collapse()}}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.searchForm",bizagi.rendering.searchForm.prototype),bizagi.rendering.tablet.searchForm.extend("bizagi.rendering.tablet.searchForm",{},{renderResult:function(){var e=this,t=e.properties,i={};i.properties={displayName:e.getResource("render-search-advanced-results-label"),type:"grid",xpath:"searchForm"+t.id,id:t.id,skipInitialLoad:!0,rowsPerPage:10,visible:!1,sortBy:t.sortBy,sortOrder:t.sortOrder,overrideGetRemoteData:function(t){return e.getRemoteData(t)}},i.elements=[];var a=t.columns;$.each(a,(function(t){var r={render:{}};r.render.properties={displayName:a[t].caption,xpath:a[t].xpath,editable:!1},$.extend(r.render.properties,e.parseAdditionalProperties(a[t].dataType)),0==a[t].dataType&&(r.render.properties.columnVisible=!1),7!=a[t].dataType&&8!=a[t].dataType||(r.render.properties.allowDecimals=a[t].allowDecimals),10!=a[t].dataType&&11!=a[t].dataType||(r.render.properties.allowDecimals=!0),12==a[t].dataType&&(r.render.properties.showTime=a[t].showTime),i.elements.push(r)}));var r=e.renderFactory.getRender({type:"grid",data:i,parent:e,mode:e.getMode()});return r.properties.inlineAdd=!1,r.properties.allowDelete=!1,r.properties.allowAdd=!1,r.properties.allowEdit=!1,e.resultsGrid=r,r.render()},postRenderContainer:function(e){var t=this,i=e.find(".bz-container__search-criteria"),a=e.find(".bz-container__search-results"),r=i.children(),n=t.getMode();t.container=e,$.each(r,(function(e,i){i=$(i);var a=Number(i.data("unique-id"));if(a){var r=t.childrenHash[a];if(r){var n=r.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&r.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&r.postRenderContainer(i)}}}));var o=$(a.children()[0]);t.resultsGrid.postRenderElement(o),"execution"===n&&t.configureHandlers(),"design"===n&&t.configureDesignView(),"layout"===n&&(t.configureDesignView(),t.configureLayoutView())},configureHandlers:function(){var e=this;e.criteriaContainer=$(".bz-container__search-criteria",e.container),e.resultsContainer=$(".bz-container__search-results",e.container),e.resultsGrid.bind("rowSelected",(function(t,i){e.properties.searchParams.hasOwnProperty("multiSelect")?e.trigger("multiSelect",i):e.trigger("instanceSelected",i)}))},refreshResults:function(){this.trigger("instancerefresh"),this.resultsGrid.refresh()},onSearchFinished:function(){this.properties.deviceMaxRecordsExceeded||(this.resultsGrid.changeVisibility(!0),this.properties&&(0==this.properties.records?$(".bz-container__search-results label",this.container).hide():$(".bz-container__search-results label",this.container).show()))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.text",bizagi.rendering.text.prototype),bizagi.rendering.tablet.text.extend("bizagi.rendering.tablet.text",{},{postRender:function(){this._super(),this.properties.maxLength>0&&this.input.attr("maxlength",this.properties.maxLength)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("text-readOnly"),t=this.getValue();null!=t&&(t=bizagi.util.sanitizeHTML(t));var i={value:t||"",editable:this.properties.editable};return $.fasttmpl(e,i)},setDisplayValue:function(e){e=this.validateValue(e,this.properties.maxLength),this.setValue(e,!1),this.properties.editable?this.input.val(e):$(".bz-text-readonly",this.getControl()).html(bizagi.util.sanitizeHTML(e))},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur((function(){var t=$(this);e.retypeDouble(t)}))},retypeDouble:function(e){var t=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===t)return;t!==e.data("oldValue")?(this.setValue(""),this.setValidationMessage(this.getResource("render-text-retype-error")),e.val(""),setTimeout((function(){e.focus()}),100)):e.data("newValue",t),e.data("oldValue",""),e.data("ui-tooltip")&&e.tooltip("destroy")}else{if(""===t||t===e.attr("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".bz-text-readonly",e)},createTooltip:function(e,t,i){this._super(e,t,i),$("body").bind("touchmove",(function(t){$("body").unbind("touchmove"),e.data("ui-tooltip")&&e.tooltip("destroy")}))},setValidationMessage:function(e){this._super(e),this.cloneRender&&this.cloneRender.setValidationMessage(e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.readonly",bizagi.rendering.readonly.prototype),bizagi.rendering.tablet.readonly.extend("bizagi.rendering.tablet.readonly",{},{}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.extendedText",bizagi.rendering.extendedText.prototype),bizagi.rendering.tablet.extendedText.extend("bizagi.rendering.tablet.extendedText",{minLines:2,maxLines:8,maxCharactersToShow:200},{postRender:function(){this._super(),this.textarea=this.getControl().find("textarea"),this.textarea&&this.textarea.css({resize:"vertical"})},initializeData:function(e){this._super(e);var t=this.properties.maxLines;this.properties.maxLines=t>this.Class.maxLines?this.Class.maxLines:t<this.Class.minLines?this.Class.minLines:t,this.isOfflineForm=bizagi.util.isOfflineForm({context:this})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("extendedText-readOnly"),t=this.getValue();t=null!=t?bizagi.util.sanitizeHTML(t):"";var i=this.Class.maxCharactersToShow,a=t.substr(0,i),r=t.substr(i-1,t.length-i),n={value:t,startString:a,endString:r};return $.fasttmpl(e,n)},setDisplayValue:function(e){if(e=bizagi.util.isEmpty(e)||"string"==typeof e?e:e.toString(),e=this.validateValue("string"==typeof e?e:"",this.properties.maxLength),this.setValue(e,!1),this.properties.editable)this.textarea.val(e);else{var t=bizagi.util.encodeHtmlText(this.getDisplayValue());$(".bz-textarea-readonly",this.getControl()).html(t)}},configureHandlers:function(){var e=this;e._super(),e.properties.maxLength>0&&(e.textarea.attr("maxlength",e.properties.maxLength),e.actualMaxLength=e.properties.maxLength),$(e.textarea).bind("focus keyup paste",(function(t){8!==t.which&&46!==t.which||e.textarea.prop("rows")>e.properties.maxLines&&e.textarea.prop("rows",e.properties.maxLines);e.updateTextareaSize(this)})),$(e.textarea).bind("blur",(function(t){e.textarea.prop("rows",e.properties.maxLines)}))},configureHandlersReadOnly:function(){var e=this,t=this.getControl();$(".bz-textarea-readonly",t).on("click",".bz-read-more",(function(t){return $(t.delegateTarget).hasClass("bz-textarea-readonly--active")?($(t.delegateTarget).removeClass("bz-textarea-readonly--active"),$(this).html(e.getResource("workportal-project-discussion-comment-viewmore"))):($(t.delegateTarget).addClass("bz-textarea-readonly--active"),$(this).html(e.getResource("workportal-project-discussion-comment-viewless"))),!1}))},updateTextareaSize:function(e){if(this.properties.autoExtend){var t=$(e).prop("rows");e.scrollHeight>e.offsetHeight&&t>=this.Class.minLines&&t<this.Class.maxLines&&($(e).prop("rows",t+1),this.updateTextareaSize(e))}},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input, textarea",t);i&&0!==i.length&&i.blur((function(){var t=$(this),i=e.previousValue,a=e.value;null!=i&&a!=i&&null!=$(this).data("newValue")&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)}))},retypeDouble:function(e){var t=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===t)return;t!==e.data("oldValue")?(this.setValue(""),this.setValidationMessage(this.getResource("render-text-retype-error")),e.val(""),setTimeout((function(){e.focus()}),100)):e.data("newValue",t),e.data("oldValue",""),e.data("ui-tooltip")&&e.tooltip("destroy")}else{if(""===t||t===e.attr("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},getElementsToStylize:function(e){return this.properties.editable?$("textarea",e):$(".bz-textarea-readonly",e)},createTooltip:function(e,t,i){this._super(e,t,i),$("body").bind("touchmove",(function(t){$("body").unbind("touchmove"),e.data("ui-tooltip")&&e.tooltip("destroy")}))},setValidationMessage:function(e){this._super(e),this.cloneRender&&this.cloneRender.setValidationMessage(e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.label",bizagi.rendering.label.prototype),bizagi.rendering.tablet.label.extend("bizagi.rendering.tablet.label",{},{renderReadOnly:function(){return this.setValue(this.properties.displayName),this._super()},setDisplayValue:function(e){}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.number",bizagi.rendering.number.prototype),bizagi.rendering.tablet.number.extend("bizagi.rendering.tablet.number",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{value:this.getDisplayValue(),editable:this.properties.editable,type:"text",isDesign:"execution"!==this.getMode()})},setDisplayValue:function(e){this.setValue(e,!1),null!=e&&(this.properties.editable?(this.numericInput.val(bizagi.util.numberToFixedString(e)),this.value=this.properties.value=e,this.executeFormatCurrencyPlugin()):$(".bz-input",this.getControl()).val(bizagi.util.numberToFixedString(e)).formatCurrency({symbol:this.properties.symbol,positiveFormat:this.properties.positiveFormat,negativeFormat:this.properties.negativeFormat,decimalSymbol:this.properties.decimalSymbol,digitGroupSymbol:this.properties.digitGroupSymbol,groupDigits:this.properties.groupDigits,roundToDecimalPlace:this.properties.numDecimals,colorize:this.properties.colorize}))},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur((function(){var t=$(this),i=e.previousValue,a=e.value;"grid"===e.parent.properties.type?(null!=i&&a!==i&&void 0!==$(this).data("newValue")&&t.val()!==$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)):e.retypeDouble(t)}))},retypeDouble:function(e){var t=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility")&&null==$(this).data("newValue"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===t)return;t!==e.data("oldValue")?(this.setValue(""),this.createTooltip(e,"",this.getResource("render-text-retype-error"))):(e.data("newValue",t),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""===t||t===e.attr("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},getElementsToStylize:function(e){return $("input",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.money",bizagi.rendering.number.prototype),bizagi.rendering.tablet.money.extend("bizagi.rendering.tablet.money",bizagi.rendering.money.prototype),bizagi.rendering.tablet.money.extend("bizagi.rendering.tablet.money",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{value:this.getDisplayValue(),editable:this.properties.editable,type:"text",isDesign:"execution"!==this.getMode()})},setDisplayValue:function(e){this.setValue(e,!1),null!=e&&(this.properties.editable?(this.numericInput.val(bizagi.util.numberToFixedString(e)),this.value=this.properties.value=e,this.executeFormatCurrencyPlugin()):$(".bz-input",this.getControl()).val(bizagi.util.numberToFixedString(e)).formatCurrency({symbol:this.properties.symbol,positiveFormat:this.properties.positiveFormat,negativeFormat:this.properties.negativeFormat,decimalSymbol:this.properties.decimalSymbol,digitGroupSymbol:this.properties.digitGroupSymbol,groupDigits:this.properties.groupDigits,roundToDecimalPlace:this.properties.numDecimals,colorize:this.properties.colorize}))},getElementsToStylize:function(e){return $("input",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.numberScientificNotation",bizagi.rendering.numberScientificNotation.prototype),bizagi.rendering.tablet.numberScientificNotation.extend("bizagi.rendering.tablet.numberScientificNotation",{},{postRender:function(){var e=this.getControl();this.inputDisplay=$("input",e).first(),this.numericInput=this.input=$("input",e).last(),this.numericInput.numericSN(this.properties.decimalSymbol),this.attachFormatSientificNotation()},setDisplayValue:function(e){var t=this.properties,i=(e=bizagi.util.scientificNotationFormat(e,t.decimalSymbol,38),bizagi.util.scientificNotationFormat(e,t.decimalSymbol,20));this._super(i),null!=e&&t.editable&&(this.numericInput.val(e),this.inputDisplay.val(i))},attachFormatSientificNotation:function(){var e=this;e.inputDisplay.focus((function(){$(this).val(e.getDisplayValue())})),e.inputDisplay.blur((function(){var t=e.getFormContainer();if(void 0===t.validationController){var i=t.getValidationsContainer();t.validationController=new bizagi.command.controllers.validation(t,e.validations,i)}var a=bizagi.util.scientificNotationFormat(e.inputDisplay.val(),e.properties.decimalSymbol,38),r=bizagi.util.scientificNotationFormat(e.inputDisplay.val(),e.properties.decimalSymbol,20);e.numericInput.val(a),e.inputDisplay.val(r),e.setValue(a)}))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.date",bizagi.rendering.date.prototype),bizagi.rendering.tablet.date.extend("bizagi.rendering.tablet.date",{MAX_YEARS_DISPLAY:100},{initializeData:function(e){this._super(e)},renderReadOnly:function(){var e=this.properties,t=e.dateFormat,i=bizagi.util.dateFormatter,a=t.substring(0,-1!=t.search("h|H")?t.search("h|H")-1:t.length),r=i.formatDate(i.getDateFromFormat(this.getValue(),a,this.i18n),e.fullFormat),n={value:"execution"!==this.getMode()?e.fullFormat:r,editable:e.editable},o=this.renderFactory.getTemplate("readonly");return $.fasttmpl(o,n)},postRenderReadOnly:function(){this.input=$("input",this.getDateControl())},configureHandlers:function(){var e=this,t=e.getControl(),i=$(".bz-input-icon",t);e.configureMobiscollCalendar(),e.calendarInstance=i.mobiscroll("getInst"),i.on("focus",(function(t){t.preventDefault(),t.stopPropagation(),bizagi.util.isCordovaSupported()&&bizagi.util.isAndroidDevice()&&(cordova.plugins.Keyboard.disableScroll(!0),cordova.plugins.Keyboard.close()),e.calendarInstance.show()})),i.attr("keyboard","disable")},configureMobiscollCalendar:function(){var e=this,t=e.properties,i=t.showTime?["calendar","time"]:["calendar"],a=e.getControl(),r=$(".bz-input-icon",a),n=e.getOrientation();r.mobiscroll().calendar({mode:"mixed",touchUi:!0,display:"bottom",controls:i,min:e.getNormalizeDate(new Date(t.minValue)),max:e.getNormalizeDate(new Date(t.maxValue)),defaultValue:e.getDisplayValue(),timeFormat:t.timePickerFormat?e.getTimeFormat(t.timePickerFormat):"",dateFormat:t.datePickerFormat,dateWheels:"dd/MM/yyyy",select:"single",selectType:"Day",rtl:n&&"rtl"===n,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||bizagi.localization.language||"en",buttons:e.properties.showTime?[{text:e.getResource("render-timeentry-now"),handler:function(){e.setValueFromCalendarButtons(new Date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))}},{text:e.getResource("render-plugin-search-users-select-link"),handler:"set"},{text:e.getResource("render-plugin-search-users-clear-button-name"),handler:function(e,t){t.clear()}}]:[{text:e.getResource("render-timeentry-now"),handler:function(){e.setValueFromCalendarButtons(new Date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))}},{text:e.getResource("render-plugin-search-users-clear-button-name"),handler:function(e,t){t.clear()}}],onSet:function(){e.onChangeHandler()},onDayChange:function(t){e.setValueFromCalendarButtons(t.date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.properties.showTime||e.getCalendarInstance().hide()}))},onClear:function(){e.setValueFromCalendarButtons(null,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))},onBeforeShow:function(i,a){e.triggerGlobalHandler("modalViewDidAppear",{}),a.option({max:bizagi.util.dateFormatter.getDateFromInvariant(t.maxValue,t.showTime),min:bizagi.util.dateFormatter.getDateFromInvariant(t.minValue,t.showTime)}),bizagi.util.isiOSDevice()&&$(".ui-bizagi-notifications-container").css("display","none")},onClose:function(t,i){e.triggerGlobalHandler("modalViewDidDisappear",{}),$(".mbsc-fr-scroll").css("overflow-y","auto")},onShow:function(e,t){$(".mbsc-fr-scroll").css("overflow-y","hidden")}})},getDateControl:function(){return $(".bz-input-icon",this.getControl())},onChangeHandler:function(e){var t=this.properties,i=this.getNormalizeDate(this.getCalendarInstance().getVal()),a="",r=bizagi.util.dateFormatter;if(i&&0!=i){var n=this.value;1==e?(i=this.getNormalizeDate(new Date),a=r.formatDate(i,"MM/dd/yyyy HH:mm:ss"),this.value=a):this.value=r.formatInvariant(i,t.showTime),(e||i)&&(this.value=n,a=r.formatDate(i,"MM/dd/yyyy HH:mm:ss"),this.setValue(a),this.setDisplayValue(a))}},getFullFormatedDate:function(e,t){var i="";i=e.length>0?e:void 0!==e?bizagi.util.dateFormatter.formatISO(e,!1):bizagi.util.dateFormatter.formatISO(new Date,!1),i+=t;var a=bizagi.util.dateFormatter.getDateFromFormat(i,"yyyy-MM-dd H:m");return bizagi.util.dateFormatter.formatDate(0!==a?a:e,"yyyy-MM-dd H:mm:ss")},preprocessDateValue:function(e){return bizagi.util.dateFormatter.formatDate(e,this.properties.fullFormat)},isValid:function(e){var t=this.properties,i=!0,a=this.getValue();return a&&bizagi.util.parseBoolean(t.editable)&&0!=(a=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromInvariant(a)))&&(t.minValue&&"string"==typeof t.minValue&&(i=!this.checkMinAndMaxValue(a,!0,t,e)&&i),t.maxValue&&"string"==typeof t.maxValue&&(i=!this.checkMinAndMaxValue(a,!1,t,e)&&i)),bizagi.util.parseBoolean(t.editable)&&t.required&&!this.hasValue()&&this.showMandatoryMessage(t,e),i&&this.setValidationMessage(""),i},checkMinAndMaxValue:function(e,t,i,a){var r=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromInvariant(t?i.minValue:i.maxValue));if(0==r){var n="";-1==i.timeFormat.indexOf(":ss")&&(n=t?i.minValue+":00":i.maxValue+":00"),r=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromFormat(n,i.fullFormat+":ss"))}if(t&&e.getTime()<r.getTime()||!t&&e.getTime()>r.getTime()){var o=bizagi.util.dateFormatter.formatDate(r,i.fullFormat),l="";return l=t?this.getResource("render-date-minimum-validation").replaceAll("#label#",i.displayName).replaceAll("#minValue#",o):this.getResource("render-date-maximum-validation").replaceAll("#label#",i.displayName).replaceAll("#maxValue#",o),a.push({xpath:i.xpath,message:l}),!0}return!1},showMandatoryMessage:function(e,t){var i=this.getResource("render-required-text").replaceAll("#label#",e.displayName);return t.push({xpath:e.xpath,message:i}),!1},setHour:function(e){return e.replace(/\s(\d:)/," 0$1")},clearDisplayValue:function(){this.date=void 0,this.time=void 0,this.timeS=void 0,this.setValue(""),this.setDisplayValue("")},isValidMinMaxValue:function(){var e=!0,t=this.getValue();return t&&0!==(t=bizagi.util.dateFormatter.getDateFromInvariant(t))&&(this.properties.minValue&&"string"==typeof this.properties.minValue&&(e=this.validateMinAndMaxValue(t,!0)),this.properties.maxValue&&"string"==typeof this.properties.maxValue&&(e=this.validateMinAndMaxValue(t,!1))),e},validateMinAndMaxValue:function(e,t){var i=t?this.properties.minValue:this.properties.maxValue,a=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromInvariant(i));return!(t&&e.getTime()<a.getTime()||!t&&e.getTime()>a.getTime())},getElementsToStylize:function(e){return $("input, .bz-input--readonly",e)},getCalendarInstance:function(){return this.calendarInstance||(this.calendarInstance=$(this.getDateControl()).mobiscroll("getInst"))},setDisplayValue:function(e){if("execution"===this.getMode()){var t=this.properties,i=this.getControl(),a=$(".bz-input-icon__input, .bz-input--readonly",i),r=bizagi.util.dateFormatter;bizagi.util.isNumeric(e)&&0!==e&&(e=r.formatInvariant(new Date(e),t.showTime)),e&&(e="string"==typeof e?this.getNormalizeDate(r.getDateFromInvariant(e,t.showTime)):this.getNormalizeDate(e));var n=this.getCalendarInstance();t.editable&&n.setVal&&n.setVal(e),this.setValue(r.formatInvariant(e,!0)),t.displayValue=r.formatDate(e,t.fullFormat,this.i18n),"string"!=typeof t.displayValue&&"number"!=typeof t.displayValue||(a.prop("value",t.displayValue),a.prop("title",t.displayValue)),t.editable||a.html(t.displayValue)}},setValueFromCalendarButtons:function(e,t){this._super(e),"function"==typeof t&&t(e),this.onChangeHandler()}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.yesno",bizagi.rendering.yesno.prototype),bizagi.rendering.tablet.yesno.extend("bizagi.rendering.tablet.yesno",{},{postRender:function(){var e=this.getControl();this.radio=e.find("input[type=radio]"),!this.properties.editable||null!=this.value&&void 0!==this.value||null==this.properties.value||(this.value=this.properties.value)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.radio=e.find("input"),this._super()},setDisplayValue:function(e){var t=this.getControl(),i=bizagi.util.parseBoolean(e);this.setValue(i,!1),this.properties.editable?i?(t.find("input[value=true]").prop("checked",!0),t.find("input[value=false]").prop("checked",!1)):(t.find("input[value=false]").prop("checked",!0),t.find("input[value=true]").prop("checked",!1)):this.radio.val(this.getDisplayValue())},configureHandlers:function(){var e=this;e.radio.change((function(){var t=$(this).prop("value");e.value!==t&&e.setValue(t)}))},getElementsToStylize:function(e){return $("label.bz-radio__label",e)},cleanData:function(){this.setValue(null,!1),this.clearDisplayValue()},clearDisplayValue:function(){this.properties.editable?this.radio.prop("checked",!1):this.radio.val(this.getDisplayValue())}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.check",bizagi.rendering.check.prototype),bizagi.rendering.tablet.check.extend("bizagi.rendering.tablet.check",{},{postRender:function(){var e=this.getControl();this.check=e.find("input"),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.check=e.find("input"),this._super()},setDisplayValue:function(e){var t=bizagi.util.parseBoolean(e);this.setValue(t,!1),this.properties.editable?t?this.check.attr("checked","checked"):this.check.removeAttr("checked"):this.check.val(this.getDisplayValue())},configureHandlers:function(){var e=this;this.check.on("click",(function(t){var i=$(this).is(":checked");e.setValue(i,!0)}))},cleanData:function(){this.setDisplayValue(!1),this.setValue(!1,!1)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.combo",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.combo.extend("bizagi.rendering.tablet.combo",{renderControl:function(){var e=this.renderFactory.getTemplate("combo");return $.fasttmpl(e,{editable:this.properties.editable,value:this.getDisplayValue()})},getDisplayValue:function(){var e="",t=this.getValue();return this.combo&&this.combo.length>0&&(t=this.getSelectedValue()),t&&(e=this.formatItem(t.value)),e},postRender:function(){var e=this.getControl();this._super(),this.combo=e.find("input"),this.itemSelected=void 0},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.combo=e.find("input")},configureHandlers:function(){var e=this,t=e.getControl();"execution"===e.getMode()&&$(".bz-form-combo",t).bind("click",(function(){$(this).mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{hideSearch:!1===e.properties.enableTyping}),displayName:e.properties.displayName||"",orientation:e.properties.orientation||"",contentTemplate:"",style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},open:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){var i={};if(e.isDependant&&e.properties&&/cascadingcombo/i.test(e.properties.type)&&e.getParentCombo){var a=e.getParentCombo().getValue();a&&a.id&&(i[e.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=a.id)}$.when(e.renderCombo(i)).done((function(i){$(".bz-modal-view__content",t.content).html(i),e.configureModalViewHandlers(t)}))}})}))},processComboData:function(e){var t=this;e.forEach((function(e){t.validateValue(e)}))},setDisplayValue:function(e){var t="";if(e=this.mapValue(e),(e=this.preprocessValue(e))&&"object"===_typeof(e)&&void 0!==e.label){if(bizagi.util.isEmpty(e.label)){var i=this.findDataValueById(e.id);t=i?i.value:""}else t=e.label;$.isArray(t)&&(t=t.join(" - ")),e={id:e.id,value:t}}if(this.properties.editable)this.combo.val(this.formatItem(e.value));else{var a=this.getControl();$(".bz-input",a).html(this.formatItem(e.value))}this.selectedValue=e,this.setValue(e)},configureModalViewHandlers:function(e){var t=this;if($(".bz-list__item",e.content).on("click",(function(){var i={id:$(this).data("value"),value:$(this).text()};""==i.id&&(i.value=""),t.itemSelected=!0,t.setDisplayValue(i),t.trigger("select",[i,!1]),e.close()})),$("[data-action=close]",e.header).bind("click",(function(){e.close()})),this.properties.enableTyping){var i=$(".bz-list li",e.content),a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);a.bind("click",(function(){r.val("").trigger("change")})),r.on("change keyup",(function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)})).on("focus",(function(){e.header.addClass("bz-modal-view__header--active")})).on("blur",(function(){e.header.removeClass("bz-modal-view__header--active")}))}},cleanData:function(){var e={id:"",value:""};this.value=this.properties.value=this.selectedValue=e;var t=this.getControl();$("input",t).val(this.formatItem(e.value))},filterList:function(e,t){t.filter((function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()})).show()},renderComboTemplate:function(e){var t=this.renderFactory.getTemplate("combo-list"),i=this.getValue();return i=null!=i?i:{id:"",value:""},$.fasttmpl(t,{items:e,selectedId:i.id,hasItems:e.length>0},{validateItem:this.validateValue})},getSelectedValue:function(){return this.selectedValue}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.collectionnavigator",bizagi.rendering.collectionnavigator.prototype),bizagi.rendering.tablet.collectionnavigator.extend("bizagi.rendering.tablet.collectionnavigator",{},{postRender:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")},postRenderReadOnly:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.upload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.upload.prototype),bizagi.rendering.tablet.upload.extend("bizagi.rendering.tablet.upload",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{isNative:!1,isOfflineForm:!1,initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported()},renderControl:function(){var e=this.renderFactory.getTemplate("upload");return this.renderItem(e,{})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("upload-readonly"),t={noFiles:0===this.filesCount};return this.renderItem(e,t)},renderItem:function(e,t){for(var i="",a=$.fasttmpl(e,t),r=0;r<this.filesCount;r++){var n={id:this.files[r][0],fileName:this.files[r][1]};i+=this.renderUploadItem(n)}return a=this.replaceFilesHtml(a,i)},postRender:function(){var e=this.getControl();this.$contentFile=$(".bz-file-upload__container",e),this.$inputFile=$(".bz-file-upload__input",e),this.$nativeFile=$(".bz-file-upload__native",e)},configureHandlers:function(){this.checkFileExtensions(),this.attachEvents()},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-readonly-lists",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()}))}))},attachEvents:function(){var e=this,t=e.getControl(),i=0;if(this.$contentFile.off("click").on("click",(function(t){!e.isNative||i>0?e.chooseFile():bizagi.showMessageBox(bizagi.localization.getResource("render-upload-error-files-extension-supported-app","You can only add images or videos."),"Userfield error")})),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()}))})),$("ul.bz-files",t).on("click",".bz-file .bz-icn",(function(){var t=$(this).parent(".bz-file"),i=t.data();e.removeFile(t,i.id)})),e.isNative){var a=e.getUploadChoices();i=a.length,this.$nativeFile.off("click").actionSheet({actions:a,actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-file-upload__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.handlerResolutionUpload(t.guid)).always((function(){bizagi.loading.stop()}))},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})}else this.$inputFile.off("change").on("change",(function(){e.addFile(),this.value=""})),this.$inputFile.off("click").on("click",(function(e){e.stopPropagation()}))},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture((function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then((function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i)){bizagi.util.getAndroidVersion();if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then((function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.handlerResolutionUpload(e)}));$(".bz-file-upload__resolution",t.getControl()).click()}}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,correctOrientation:!0});break;case 1:navigator.camera.getPicture((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then((function(i){return t.fileProperties=i,t.saveImage(e)}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;case 3:navigator.device.capture.captureVideo((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).then((function(){return t.saveVideo(e)})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{limit:t.Class.LIMIT})}},handlerResolutionUpload:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.saveImage(t.dataImage);var a=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,a)).then((function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.saveImage(t.dataImage)}))},saveImage:function(e){var t="";this.editedImageURL?t=this.editedImageURL:this.fileProperties&&(t=this.fileProperties.url);var i={dataFile:bizagi.util.media.getImagePath(t),fileName:this.fileProperties.name,mimeType:"image/jpeg"};return this.editedImageURL=null,this.fileProperties=null,this.uploadFile(i)},saveVideo:function(e){var t={dataFile:e[0].fullPath,fileName:e[0].name,mimeType:"video/quicktime"};return this.uploadFile(t)},uploadFile:function(e){var t=this,i={},a=t.buildAddParams();return a.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),i.data=a,i.options=new FileUploadOptions,i.options.fileKey="file",i.options.fileName=e.fileName,i.options.uploadKey={key:a.h_xpath},i.options.addUrl=t.properties.addUrl,i.dataFile=e.dataFile,e.mimeType&&(i.options.mimeType=e.mimeType),$.when(bizagi.util.media.uploadFile(i)).then((function(e){var i=JSON.parse(decodeURIComponent(e.response));"error"===i.type?bizagi.showMessageBox(i.message,i.errorType):t.onUploadFileCompleted(i)})).fail((function(e){t.executeFormFailHandler(e)}))},onFail:function(e){var t=bizagi.util.processFailMessage(e);if(bizagi.loading.stop(),t&&"string"==typeof t&&-1!==t.indexOf("No Activity found to handle Intent")){var i=bizagi.util.isValidResource("render-upload-error-media-app")?bizagi.localization.getResource("render-upload-error-media-app"):"Your device does not have an app to execute this action.";bizagi.showMessageBox(i)}},onUploadFileCompleted:function(e){var t=$(".bz-files",this.getControl());if(e.id&&e.fileName){var i=this.renderUploadItem(e);t.append(i),this.filesCount=this.filesCount+1;var a=this.files.slice();a.push([e.id,e.fileName]),this.setValue(a,!0),this.checkMaxFiles(),this.editedImageURL=null}else bizagi.showMessageBox(e.message,"Error")},checkMaxFiles:function(){this.isMaxFilesReached()?$(this.$contentFile).addClass("bz-file-upload__container--hidden"):$(this.$contentFile).removeClass("bz-file-upload__container--hidden")},isMaxFilesReached:function(){var e=this.properties.maxfiles,t=this.properties.value?this.properties.value.length:0;return 0!==e&&this.filesCount>=e&&t>=e},checkFileExtensions:function(){var e=this.properties.validExtensions||"";if(this.validOptions={video:!1,image:!1,file:!1},void 0===(e=e.replace(/\s+/g,"").toLowerCase())||""===e)this.validOptions={video:!0,image:!0,file:!0};else if(1===(e=e.split(";")).length&&-1!==e[0].indexOf("*.*"))this.validOptions.video=!0,this.validOptions.image=!0;else for(var t=0,i=e.length;t<i;t++)e[t]=e[t].replace("*.",""),this.Class.EXTENSIONSFILE.toString().indexOf(e[t])>=0?this.validOptions.file=!0:this.Class.EXTENSIONSIMG.toString().indexOf(e[t])>=0?this.validOptions.image=!0:this.Class.EXTENSIONSVIDEO.toString().indexOf(e[t])>=0&&(this.validOptions.video=!0);this.validOptions.file||this.validOptions.image||this.validOptions.video||$(this.$contentFile).addClass("bz-file-upload__container--hidden"),!this.isMaxFilesReached()&&(this.isNative||bizagi.util.media.fileAPISupported()&&!this.isOfflineForm)||$(this.$contentFile).addClass("bz-file-upload__container--hidden")},buildAddFileParams:function(e){var t=this.Class.BA_CONTEXT_PARAMETER_PREFIX,i=new FormData,a=this.getFormContainer();i.append(t+"xpath",this.getUploadXpath()),i.append(t+"idRender",this.properties.id),i.append(t+"xpathContext",this.properties.xpathContext),i.append(t+this.Class.BA_PAGE_CACHE,this.properties.idPageCache),i.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",a.properties.sessionId),i.append(this.properties.xpath,e),this.properties.contexttype&&i.append(t+"contexttype",this.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?i.append(BIZAGI_SESSION_NAME,a.properties.sessionId):i.append("JSESSIONID",a.properties.sessionId)}catch(e){i.append("JSESSIONID",a.properties.sessionId)}return i},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},cleanData:function(){return this.clearDisplayValue()},clearDisplayValue:function(){var e=this,t=$(".bz-files",e.getControl()),i=[];return $(".bz-file",t).each((function(t,a){var r=(a=$(a)).data();i.push($.when(e.removeFile(a,r.id)))})),$.when.apply($,i).then((function(){return e.getValue()}))},getUploadChoices:function(){var e=[];return this.validOptions.image&&(e.push({guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}),e.push({guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")})),this.validOptions.video&&e.push({guid:3,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-video")}),[].concat(e)},executeFormFailHandler:function(e){var t="";t=e&&e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error"),this.getFormContainer().failHandler(t)},chooseFile:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&!this.isOfflineForm&&this.$inputFile.click()},addFile:function(){var e=this,t=this.$inputFile[0].files[0],i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSFILE,e.Class.EXTENSIONSVIDEO);t.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.processUploadFile(t)).then((function(t){e.onUploadFileCompleted(JSON.parse(decodeURIComponent(t)))})).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()})):bizagi.loading.stop()},removeFile:function(e,t){var i=this;return $.when(i.deleteUploadItem(e,t)).done((function(){e.hide(),e.remove(),i.setValue(i.files,!1),i.checkMaxFiles(),i.triggerRenderChange()}))},getTemplateItemName:function(){return"upload-item"},getElementsToStylize:function(e){return $(".bz-input-icon__input",e)}}),bizagi.rendering.tablet.upload.extend("bizagi.rendering.tablet.upload.offline",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{initializeData:function(e){this._super(e);var t=Number(this.properties.maxSize)||1048576,i="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=t<i?t:i,this.updateFilesCount(),this.updateOriginalValue()},updateOriginalValue:function(){this.properties.originalValue=bizagi.clone(this.properties.value)},renderItem:function(e,t){for(var i="",a=$.fasttmpl(e,t),r=0;r<this.files.length;r++){var n=this.files[r];if(n.status&&"deleted"!==n.status&&"new-deleted"!==n.status)i+=this.renderUploadItem(n,r)}return a=this.replaceFilesHtml(a,i)},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-files",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file");e.openOfflineFile(t)}))},attachEvents:function(){var e=this,t=e.getControl();this.$contentFile.off("click").on("click",(function(t){e.isNative?e.$nativeFile.click():e.$inputFile.click(),e.$inputFile.off("change").on("change",(function(){e.handlerWebUploadFile()}))})),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file");e.openOfflineFile(t)})),$("ul.bz-files",t).on("click",".bz-file .bz-icn",(function(){var t=$(this).parent(".bz-file");e.removeOfflineFile(t)})),e.isNative&&e.attachNativeEvents()},attachNativeEvents:function(){var e=this;this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})}})},handlerWebUploadFile:function(){var e,t,i=this,a=i.$inputFile[0].files[0],r=bizagi.util.randomNumber();if(i.$inputFile[0].value="",bizagi.util.media.checkMaxSizeFile(a,i.properties))return i.dataService.getFileService().resolveBlobFromPath(a).then((function(a){return bizagi.loading.start(),t=a.type,e=a.name,i.saveOfflineFile(a,r,t)})).then((function(){i.onUploadOfflineFileCompleted(e,t,r)})).always((function(){bizagi.loading.stop()}))},handlerUploadFile:function(e){switch(e||0){case 2:this.choosePhoto();break;case 1:this.takePhoto();break;default:console.log("The option is not supported!")}},choosePhoto:function(){var e=this;navigator.camera.getPicture((function(t){e.dataImage=t;var i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(t,e.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(e.dataImage)).then((function(t){if(e.fileProperties=t,bizagi.util.media.checkFileTypes(t,e.properties,i))return e.saveImage(e.dataImage)}))})).always((function(){bizagi.loading.stop()}))}),e.onFail.bind(e),{quality:e.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,correctOrientation:!0})},takePhoto:function(){var e=this;navigator.camera.getPicture((function(t){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(t,e.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(t)).then((function(i){return e.fileProperties=i,e.saveImage(t)}))})).always((function(){bizagi.loading.stop()}))}),e.onFail.bind(e),{quality:e.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960})},addInteractions:function(){var e=this,t=e.getControl();$("ul.bz-files",t).on("click",".bz-file .bz-file__delete",(function(){var t=$(this).parent(".bz-file");e.removeOfflineFile(t)}))},collectData:function(e){bizagi.util.identicalObjects(this.properties.originalValue,this.files)||(e[this.properties.xpath]=this.files)},saveImage:function(e){var t=this;bizagi.loading.start();var i,a=bizagi.util.randomNumber(),r=t.fileProperties.name;$.when(t.dataService.getFileService().resolveBlobFromPath(e,r)).always((function(){bizagi.loading.stop()})).then((function(e){return i=e.type,r=e.name,t.saveOfflineFile(e,a,i)})).then((function(e){t.onUploadOfflineFileCompleted(r,i,a)})),t.$inputFile[0].value=""},checkFileExtensions:function(){var e=this.properties.validExtensions||"";if(this.validOptions={video:!1,image:!1,file:!1},void 0===(e=e.replace(/\s+/g,"").toLowerCase())||""===e)this.validOptions.image=!0;else if(1===(e=e.split(";")).length&&-1!==e[0].indexOf("*.*"))this.validOptions.image=!0;else for(var t=0,i=e.length;t<i;t++)e[t]=e[t].replace("*.",""),this.Class.EXTENSIONSIMG.toString().indexOf(e[t])>=0&&(this.validOptions.image=!0);this.validOptions.image||$(this.$contentFile).addClass("bz-file-upload__container--hidden"),!this.isMaxFilesReached()&&bizagi.util.media.fileAPISupported()||$(this.$contentFile).addClass("bz-file-upload__container--hidden")},onUploadOfflineFileCompleted:function(e,t,i){var a=$(".bz-files",this.getControl()),r={id:i,fileName:e,mimeType:t,status:"new"},n=this.renderUploadItem(r,this.files.length);a.append(n),this.filesCount=this.filesCount+1;var o=this.files.slice();o.push(r),this.setValue(o,!1),this.checkMaxFiles(),this.triggerRenderChange()},renderUploadItem:function(e,t){var i=this.getTemplateItemName(),a=this.renderFactory.getTemplate(i);return $.fasttmpl(a,{url:"javascript:void(0);",id:e.id,allowDelete:this.properties.allowDelete||!1,filename:e.fileName,index:t})},canBeSent:function(){return!0},failReadFile:function(e){try{bizagi.log("Error code: "+e.target.error.code)}catch(e){}},onFail:function(e){this._super(e)},removeOfflineFile:function(e){var t=e.data().index,i=this.files[t];i&&("new"!==i.status?i.status="deleted":i.status="new-deleted",e.hide(),e.remove(),this.setValue(this.files,!1),this.checkMaxFiles(),this.triggerRenderChange())},updateFilesCount:function(){for(var e=this.properties.value||[],t=0;t<e.length;t++){var i=e[t].status;i&&i.includes("deleted")&&(this.filesCount=this.filesCount-1)}},setValue:function(e,t){this._super(e,t),this.updateFilesCount(),0===this.filesCount&&(this.properties.method="delete")},isMaxFilesReached:function(){var e=this.properties.maxfiles;return 0!==e&&this.filesCount>=e},openOfflineFile:function(e){var t=e.data(),i=t.index,a="number"==typeof i?this.properties.value[i]:null;if(a){var r=this.getFormParams(),n={idCase:r.idCase,idWorkitem:r.idWorkitem,id:(this.properties.xpathContext?this.properties.xpathContext+".":"")+this.properties.xpath+"."+a.id,offlineType:r.offlineType};bizagi.loading.start(),$.when(this.dataService.getOfflineFile(n,"blob",a.mimeType)).then((function(e){if(null!=e){var i=t.title,a=i||"downloaded.jpg";bizagi.util.isAndroidDevice()?bizagi.util.media.handleBinaryFile(e,i,a):bizagi.util.media.handleBinaryFile(e,i)}})).fail((function(e){console.log("Error opening offline file",e)})).always((function(){bizagi.loading.stop()}))}},saveOfflineFile:function(e,t,i){var a=this.getFormParams(),r={idCase:a.idCase,idWorkitem:a.idWorkitem,id:(this.properties.xpathContext?this.properties.xpathContext+".":"")+this.properties.xpath+"."+t,operationType:"edition",offlineType:a.offlineType};return this.dataService.saveOfflineFile(r,e,i)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.grid",bizagi.rendering.grid.prototype),bizagi.rendering.tablet.grid.extend("bizagi.rendering.tablet.grid",{GRID_PAGE_SIZE:10},{MIN_SUPPORTED_WIDTHS:{LIST:[{minimum:28,appliesTo:["label","readonly","checkboxBoolean"]},{minimum:42,appliesTo:["text","formlink","money","number","button","link"]},{minimum:66,appliesTo:["boolean","radio"]},{minimum:74,appliesTo:["combo","date","list","search","suggest","userfield","image","upload","uploadecm","document"]},{minimum:132,appliesTo:["horizontalRadio"]}],get:function(e){var t=this.LIST.find((function(t,i){return t.appliesTo.includes(e)}));return t&&t.minimum||42}},init:function(e){e.data.properties.singleInstance=!1,this._super(e),this.cellMetadata={},this.isOfflineForm=bizagi.util.isOfflineForm({context:this});var t=this.properties,i=this.getFormContainer();this.properties.helpText&&null!=this.properties.helpText&&""!=this.properties.helpText?t.displayType="value":t.displayType="vertical",t.labelAlign="left",(t.groupBy||t.groupSummary)&&i.addWarning(this.getResource("render-tablet-warning-grid"))},initializeData:function(e){e.properties.singleInstance=!1,this._super(e),this.pendingActions=[]},initAddAndDeleteProperties:function(e,t,i,a){return"groupedgrid"==this.properties.type&&(i=null!=bizagi.util.parseBoolean(i)&&bizagi.util.parseBoolean(i)),this._super(e,t,i,a)},updateAffectedCellManually:function(){},getRowIndexByKey:function(){},postRender:function(){var e=this,t=e.properties,i=e.getControl();for(var a in e.initialLoadDone=!1,e._super(),e.grid=$(">div",i),e.getLabel().hide(),e.applyGridPlugin(),t.data&&(""===t.data||0===t.data.rows.length&&t.data.page>1?e.fetchData(void 0,e.sortBy,e.sortType):(e.updateData(t.data),$.when(e.ready()).done((function(){e.triggerRenderChange({changed:!1})})))),e.initialLoadDone=!0,e.pendingActions)e.pendingActions.hasOwnProperty(a)&&e.pendingActions[a].method.apply(e,e.pendingActions[a].arguments)},applyGridPlugin:function(){var e=this,t=e.properties,i=e.getMode(),a=e.grid,r=e.buildColumnModel(),n=(r||[]).filter((function(e){return e.summarizeBy}));a.bizagi_grid_tablet({columns:r,subType:t.subType||a,title:t.displayName,isOfflineForm:e.isOfflineForm||!1,mode:i,isSortable:t.isSortable,sortBy:t.sortBy||"",template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),buttons:e.renderFactory.getTemplate("bizagi.grid.buttons"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),totalizer:e.renderFactory.getTemplate("bizagi.grid.totalizer")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&null!=t.data||"adhocGrid"===t.subType&&t.allowEdit,details:t.allowDetail,remove:t.allowDelete,inlineAdd:!1,allowMore:t.allowMore,enableXlsExport:!1,enablePdfExport:!1,hasTotalizer:n&&n.length>0&&t.data.rows.length>0},pageRequested:function(t){if(e.isExecutionMode()){var i=e.changes&&Object.keys(e.changes).length>=1||e.exclusiveChanges&&Object.keys(e.exclusiveChanges).length>=1;!e.isSummaryOrGlobalForm()&&i?$.when(e.getFormContainer().saveForm()).done((function(){e.fetchData(t.page,t.sortBy,t.sortType)})):e.fetchData(t.page,t.sortBy,t.sortType)}},sortRequested:function(t){e.isExecutionMode()&&e.fetchData(t.page,t.sortBy,t.sortType)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){e.isExecutionMode()&&e.triggerHandler("rowSelected",{id:t.key,data:t})},addRow:function(t){e.isExecutionMode()&&("adhocGrid"===e.properties.subType||e.properties.inlineAdd?e.addVirtualRow():e.addRow())},editRow:function(t){e.isExecutionMode()&&("adhocGrid"===e.properties.subType?e.editVirtualRow(t.key):e.editRow(t.key))},deleteRow:function(t){e.isExecutionMode()&&e.deleteRow(t.key)},moreRows:function(t){e.isExecutionMode()&&e.moreRows(t)},showFormDetails:function(t){e.showDetailForm(t.key)},showMore:function(t){e.isExecutionMode()&&e.showMore(t.key)},totalData:function(t){e.isExecutionMode()&&e.onTotalData()}})},postRenderReadOnly:function(){this.postRender()},buildColumnModel:function(){var e=this.columns,t=[];return t.push({name:"id",index:0,label:"id",hidden:!0,align:"center",required:!1,key:!0}),$.each(e,(function(e,i){i.columnIndex=e+1;var a=bizagi.util.normalizeType(i.properties.type),r=bizagi.util.isEmpty(i.properties.displayName)?" ":i.properties.displayName,n={name:i.properties.xpath,index:e+1,label:r,required:i.properties.required||!1,key:!1,hidden:!i.properties.visible||/columnHidden/i.test(a)||0==i.properties.columnVisible,summarizeBy:i.properties.totalize&&i.properties.totalize.operation?i.properties.totalize.operation:void 0,bizAgiProperties:i.properties};t.push(n)})),t},refresh:function(){this.fetchData()},dataReady:function(){return null!=this.dataReadyDeferred?this.dataReadyDeferred.promise():null},loadChanges:function(e){for(var t=0;t<e.length;t++){var i=this.changes[e[t][0]];if(this.exclusiveChanges&&(i=$.extend(i||{},this.getExclusiveChangeByRow(e[t][0]))),void 0!==i)for(var a in i)if(i.hasOwnProperty(a)){var r=this.getColumn(a);e[t][r.columnIndex]=this.mapChangeValue(r.properties.type,i[a],r.comboData)}}},mapChangeValue:function(e,t,i){i=i||[];var a=t;if(null!=t&&(/columnCombo/i.test(e)||/columnRadio/i.test(e))&&!bizagi.util.isArray(t)){var r=i.find((function(e){return e.id==t}));r&&(a=[[r.id,r.value]])}return a},updateData:function(e){var t=this.grid,i=this.columns;e&&(this.properties.data=e,this.setCellOverrides(e,i),this.triggerGridPluginHandler("setData",e),this.applyColumnsWidth(t,i))},fetchData:function(e,t,i){var a=this,r=a.properties;a.dataReadyDeferred=new $.Deferred,e=e||r.page||1,t=t||r.sortBy||"",i=i||r.sortOrder||"asc",r.page=e,r.sortBy=t,r.sortType=i,r.sort=t+" "+i,a.startLoading(),$.when(a.getRemoteData()).then((function(e){e&&(e.deviceMaxRecordsExceeded?bizagi.showMessageBox(bizagi.localization.getResource("render-search-maximum-records-allowed")):(a.isRTL()&&(e.rows=a.changeOrderData(e.rows)),a.loadChanges(e.rows),a.updateData(e),a.triggerRenderChange({changed:!1}),a.dataReadyDeferred.resolve()))})).always((function(){a.endLoading()}))},collectData:function(e){var t=this.grid;if(this.grid&&(this.properties.inlineAdd||this.properties.inlineEdit)){var i=t.bizagi_grid_tablet.hasOwnProperty("getNewRowKeys")?t.bizagi_grid_tablet("getNewRowKeys"):[];if(i.length>0&&!this.properties.alreadySaved&&this.isValid()){var a=this.saveInlineAddedRows(i,!0);e.deferreds=e.deferreds||[],e.deferreds.push(a)}for(var r=0;r<i.length;r++)this.changes[i[r]]&&delete this.changes[i[r]]}this._super(e)},drawCell:function(e,t,i,a){if(e.key)return i;var r=e.index-1,n=this.getCellOverride(t,r),o=this.columns[r];this.newRecords=this.newRecords||{},this.cellMetadata[t]||(this.cellMetadata[t]={}),this.cellMetadata[t][r]||(this.cellMetadata[t][r]={});var l=this.cellMetadata[t][r].properties||o.properties;l.editable=bizagi.util.parseBoolean(l.editable)||!1;var s=void 0===l.visible||l.visible,d=void 0===l.editable||l.editable;s=n.visible,d=!!l.editable&&n.editable,a&&(d=!0),o.properties.displayType="value",o.setSurrogateKey(t),"summary"===t&&(d=!1),o.properties.labelAlign="default",o.properties.columntitlealign&&(o.properties.labelAlign=o.properties.columntitlealign),o.properties.valueAlign="default",o.properties.columnAlign&&(o.properties.valueAlign=o.properties.columnAlign);var c="";return c=d?this.drawEditableCell(o,l,t,i,a):this.drawReadonlyCell(o,l,t,i),s?c:""},onCellReady:function(e,t,i,a){var r=e.index-1,n=this.getCellOverride(t,r),o=this.columns[r],l=this.cellMetadata[t][r].properties||o.properties,s=void 0===l.visible||l.visible,d=void 0===l.editable||l.editable;s=n.visible,d=!!l.editable&&n.editable;var c=l.columnwidth||"auto",p=bizagi.util.getColumnType(l.type),u="radio"===p&&l.horizontal&&d,g="boolean"===p&&"check"===l.display;if(this.applyElementWidth(i[0],c,p,u,g,!1),d=!!a,s)if(d){var h=o.properties.editable;if(o.properties.editable=d,o.properties.submitOnChange){var m=o.getDecorated(t);m&&(m.properties.submitOnChangexpathContext=this.properties.xpath+"[]")}o.postRender(t,i),o.properties.editable=h}else o.postRenderReadOnly(t,i)},addRow:function(){var e=this,t=e.properties,i=e.getFormContainer(),a=e.getFormParams();e.startLoading(),$.when(e.submitAddRequest()).done((function(r){var n=new bizagi.rendering.tablet.slide.view(e.dataService,e.renderFactory,{title:e.properties.displayName||"",container:i.container,formParams:a,navigation:a.navigation,showSaveButton:!0,onSave:function(t){return e.addExclusiveChange(r,t),e.submitSaveRequest(r,t)}});e.endLoading();var o=t.xpath+"[id="+r+"]";n.render({idRender:t.id,recordXPath:o,xpathContext:t.xpathContext,idPageCache:t.idPageCache,requestedForm:"addForm",url:t.addPage,formParams:a,navigation:a.navigation}).done((function(){t.submitOnChange?e.submitOnChange():e.fetchData()})).fail((function(){e.submitRollbackRequest()})).always((function(){e.endLoading()}))})).fail((function(t){e.executeFailHandlerOnForm(t)})).always((function(){e.endLoading()}))},addVirtualRow:function(){var e=this,t=e.properties,i=e.getFormContainer(),a=e.getFormParams(),r=["mock_id"];e.columns.forEach((function(){r.push(null)})),new bizagi.rendering.tablet.slide.adhocForm(e.renderFactory,{title:e.properties.displayName||"",allowEdition:!0,navigation:a.navigation,container:e.getFormContainer().container}).render({row:r,columns:e.columns,pageCacheId:t.idPageCache,xpath:t.xpath,xpathContext:t.xpathContext,sessionId:i.properties.sessionId,actions:i.actions,validations:i.validations}).done((function(i){$.when(e.saveAddedRow(i)).done((function(){t.submitOnChange?e.submitOnChange():e.fetchData()}))}))},saveAddedRow:function(e){var t=this.properties;return this.dataService.multiaction().addGridRecordData({url:t.addUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,contexttype:t.contexttype,idPageCache:t.idPageCache,submitData:e})},editRow:function(e){if(0!=e){var t=this,i=t.properties;if(1!=i.inlineEdit||0!=i.allowEdit)if(t.cleanActionChanges&&void 0!==t.cleanActionChanges[e]){t.changes=t.cleanActionChanges;var a=$.extend(t.changes[e],{});a.idPageCache=i.idPageCache,$(".ui-tooltip").remove(),$.when(t.submitSaveRequest(e,a)).done((function(){t.startLoading(),i.submitOnChange?t.submitForGridChange().always((function(){t.endLoading(),t.executeSubmitEditRequest(e,(function(i){t.addExclusiveChange(e,i)}))})):(t.endLoading(),t.fetchData())}))}else t.executeSubmitEditRequest(e,(function(i){t.addExclusiveChange(e,i)}));else t.editInline(e)}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},editVirtualRow:function(e){for(var t=this,i=t.properties.data,a=t.properties,r=t.getFormContainer(),n=t.getFormParams(),o=[],l=0,s=i.rows.length;l<s;l++)if(i.rows[l][0]==e){o=i.rows[l];break}new bizagi.rendering.tablet.slide.adhocForm(t.renderFactory,{title:t.properties.displayName||"",allowEdition:!0,navigation:n.navigation,container:t.getFormContainer().container}).render({row:o,columns:t.columns,pageCacheId:a.idPageCache,xpath:a.xpath,xpathContext:a.xpathContext,sessionId:r.properties.sessionId,actions:r.actions}).done((function(i){for(xpath in i)t.collectGridChange({id:e,xpath:xpath,value:i[xpath],trigger:!1});var r={};t.collectData(r),t.dataService.submitData({action:"SUBMITONCHANGE",data:r,idRender:a.id,xpath:a.xpath,xpathContext:a.xpathContext,idPageCache:a.idPageCache}).done((function(){t.fetchData()}))}))},executeSubmitEditRequest:function(e,t){var i=this,a=i.properties,r=i.getFormContainer(),n=i.getFormParams(),o=new bizagi.rendering.tablet.slide.view(i.dataService,i.renderFactory,{title:i.properties.displayName||"",container:r.container,formParams:n,navigation:n.navigation,showSaveButton:!0,onSave:function(a){return t&&t(a),i.submitSaveRequest(e,a)}});i.startLoading(),$.when(i.submitEditRequest(e)).done((function(){var t=a.xpath+"[id="+e+"]";o.render({idRender:a.id,recordXPath:t,xpathContext:a.xpathContext,idPageCache:a.idPageCache,requestedForm:"editForm",url:a.editPage,formParams:n,navigation:n.navigation}).done((function(){a.submitOnChange?i.submitOnChange():i.fetchData()})).fail((function(){i.startLoading(),$.when(i.submitRollbackRequest()).always((function(){i.endLoading()}))}))})).always((function(){i.endLoading()}))},showDetailForm:function(e){var t=this.properties,i=this.getFormContainer(),a=this.getFormParams(),r=new bizagi.rendering.tablet.slide.view(this.dataService,this.renderFactory,{title:this.properties.displayName||"",container:i.container,formParams:a,navigation:a.navigation,showSaveButton:!1}),n=t.xpath+"[id="+e+"]";r.render({idRender:t.id,recordXPath:n,xpathContext:t.xpathContext,idPageCache:t.idPageCache,requestedForm:"detailForm",url:t.editPage,formParams:a,editable:!1,navigation:a.navigation})},deleteRow:function(e){if(0!==e){var t=this;bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){$.when(t.submitDeleteRequest(e)).done((function(i){t.refreshAfterDeleteRows(),"success"===i.type&&t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e})})).fail((function(e){t.executeFailHandlerOnForm(e)}))}))}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},refreshAfterDeleteRows:function(e){var t=this.triggerGridPluginHandler("getCurrentPage");if(e=e||1,t>1){var i=bizagi.clone(this.properties.data||{}),a=i.records>0?i.records-e:0,r=Math.ceil(a/this.properties.rowsPerPage);r<t&&(t=r)}return this.fetchData(t)},moreRows:function(e){var t=this,i=t.properties;void 0===i.originalrowsPerPage&&(i.originalrowsPerPage=i.rowsPerPage),i.rowsPerPage+=i.originalrowsPerPage;var a={};t.collectData(a),t.startLoading(),$.isEmptyObject(a)?t.moreRowsCommon(e):t.dataService.submitData({action:"SUBMITONCHANGE",data:a,idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,idPageCache:i.idPageCache}).done((function(){t.endLoading(),t.moreRowsCommon(e)}))},moreRowsCommon:function(e){var t=this,i=t.properties;t.fetchData(e.page,e.sortBy,e.sortType),$.when(t.dataReadyDeferred).done((function(){0!=i.records&&i.records+1<=i.rowsPerPage&&$(".ui-bizagi-grid-dynamic-pager",t.getControl()).hide()}))},showMore:function(e){for(var t=this,i=t.properties.data,a=t.properties,r=t.getFormContainer(),n=t.getFormParams(),o=[],l=0,s=i.rows.length;l<s;l++)if(i.rows[l][0]==e){o=i.rows[l];break}var d=new bizagi.rendering.tablet.slide.grid(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:r.container,allowEdition:!1,formParams:n,navigation:n.navigation});t.startLoading(),d.render({row:o,columns:t.columns,pageCacheId:a.idPageCache,xpath:a.xpath,xpathContext:a.xpathContext,sessionId:r.properties.sessionId,actions:r.actions,formParams:n,navigation:n.navigation}).done((function(){t.endLoading()}))},editInline:function(e){for(var t=this,i=t.properties.data,a=t.properties,r=t.getFormContainer(),n=t.getFormParams(),o=[],l=0,s=i.rows.length;l<s;l++)if(i.rows[l][0]==e){o=i.rows[l];break}var d=new bizagi.rendering.tablet.slide.grid(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:r.container,formParams:n,navigation:n.navigation,allowEdition:!0});$.when(d.render({row:o,columns:t.columns,pageCacheId:a.idPageCache,xpath:a.xpath,xpathContext:a.xpathContext,sessionId:r.properties.sessionId,actions:r.actions,validations:r.validations,formParams:n,navigation:n.navigation})).done((function(i){for(xpath in i)t.collectGridChange({id:e,xpath:xpath,value:i[xpath],trigger:!1});var r={};t.collectData(r),t.dataService.submitData({action:"SUBMITONCHANGE",data:r,idRender:a.id,xpath:a.xpath,xpathContext:a.xpathContext,idPageCache:a.idPageCache}).done((function(){t.fetchData()}))}))},changeCellBackgroundColor:function(e,t,i){var a=this;if(a.initialLoadDone){var r=a.getControlCell(e,t);r&&r.changeBackgroundColor(i,!1)}else a.pendingActions&&a.pendingActions.push({method:a.changeCellBackgroundColor,arguments:arguments})},changeCellColor:function(e,t,i){var a=this;if(a.initialLoadDone){var r=a.getControlCell(e,t);r&&r.changeColor(i,!1)}else a.pendingActions&&a.pendingActions.push({method:a.changeCellColor,arguments:arguments})},changeCellVisibility:function(e,t,i){var a=this;if(a.initialLoadDone){var r=(a.columns||[]).findIndex((function(e){return a.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0,n=a.grid.bizagi_grid_tablet("getCell",e,t,r);n&&(1==i?(n.css("visibility","visible"),n.css("display",""),a.element&&a.element.show()):n.css("visibility","hidden")),a.cellOverrides[e]=a.cellOverrides[e]||{},a.getCellOverride(e,r).visible=i}else a.pendingActions&&a.pendingActions.push({method:a.changeCellVisibility,arguments:arguments})},changeCellValue:function(e,t,i){var a=this;if(a.initialLoadDone){var r=a.getControlCell(e,t);if(r){r.setDisplayValue(i);var n=r.column||{},o=n.properties&&n.properties.type;if(n){var l=a.getCellValueFormatted(n,n.getValue(e));r.setDisplayValue(i),r.triggerHandler("renderchange",{render:a,changed:!0}),a.collectGridChange({id:e,xpath:n.properties.xpath,value:l,compositeValue:n.getCompositeValue(e),columnIndex:r.columnIndex,trigger:!1,dataType:o})}}}else a.pendingActions&&a.pendingActions.push({method:a.setDisplayValue,arguments:arguments})},changeCellRequired:function(e,t,i){var a=this;if(a.initialLoadDone){var r=a.getControlCell(e,t);if(r){r.changeCellRequired(i);var n=(a.columns||[]).findIndex((function(e){return a.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0;a.cellOverrides[e]=a.cellOverrides[e]||{},a.getCellOverride(e,n).required=i}}else a.pendingActions&&a.pendingActions.push({method:a.changeCellRequired,arguments:arguments})},changeCellEditability:function(e,t,i){var a=this;if(a.initialLoadDone){var r=a.getControlCell(e,t);if(r){r.changeEditabilityCellControl(i,e,t);var n=a.getIndexForCurrentCell(t);a.cellOverrides[e]=a.cellOverrides[e]||{},a.getCellOverride(e,n).editable=i}}else a.pendingActions&&a.pendingActions.push({method:a.changeCellEditability,arguments:arguments})},setError:function(e,t){var i=this;if(i.initialLoadDone)for(var a=0;a<i.columns.length;a++){var r=i.getCellOverride(e,a).visible,n=i.columns[a].properties;if(i.isCurrentGridCell(n.xpath,n.id,t)&&r){var o=i.grid.bizagi_grid_tablet("getCell",e,t,a);o.parent().addClass("ui-bizagi-render-grid-cell-error");break}}else i.pendingActions&&i.pendingActions.push({method:i.setError,arguments:arguments})},ready:function(){var e=this._super(),t=this.inlineAddDeferred?this.inlineAddDeferred.promise():null;return $.when(e,t)},applyColumnsWidth:function(e,t){var i=this;e[0].querySelectorAll("th:not(.bz-hidden)").forEach((function(e,a){var r=e.querySelector(".bz-tablet-grid__label"),n=r?Number(r.dataset.columnIndex)-1:a,o=t[n]&&t[n].properties?t[n].properties:{},l=o.columnwidth,s=void 0===o.editable||o.editable,d=bizagi.util.getColumnType(o.type),c="radio"===d&&o.horizontal&&s,p="boolean"===d&&"check"===o.display;i.applyElementWidth(e,l,d,c,p,!0)}))},applyElementWidth:function(e,t,i,a,r,n){a?i="horizontalRadio":r&&(i="checkboxBoolean");var o=this.MIN_SUPPORTED_WIDTHS.get(i);t&&"auto"!==t&&(/px$/i.test(t)&&(t=Math.max(parseInt(t),o)+"px"),e.style.width=t,e.style.minWidth=t,n||(e.style.maxWidth=t))},startLoading:function(e){bizagi.loading.start(),this._super(e)},endLoading:function(){bizagi.loading.stop(),this._super()},cleanCellData:function(e,t){var i=this;if(i.initialLoadDone){var a=i.getControlCell(e,t);if(a)return $.when(a.cleanData()).then((function(a){a=a||[["",""]];for(var r=(i.columns||[]).findIndex((function(e){return i.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0,n=i.properties.data.rows,o=0,l=n.length;o<l;o++)if(Number(e)===n[o][0]){n[o][r+1]=a;break}i.cellOverrides[e]=i.cellOverrides[e]||{},i.getCellOverride(e,r).value=null,i.cleanActionChanges||(i.cleanActionChanges={}),i.cleanActionChanges[e]||(i.cleanActionChanges[e]={}),i.cleanActionChanges[e][t]=""}))}else i.pendingActions.push({method:i.cleanData,arguments:""})},onTotalData:function(e){var t,i=this,a=(i.properties.data||{}).rows,r=[],n=i.buildColumnModel();bizagi.util.tablet.startLoading(),n.forEach((function(e,n){if(e.bizAgiProperties){var o=e.bizAgiProperties.totalize.operation;switch(o){case"sum":t=a.sum((function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)}),n);break;case"count":t=a.count((function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return bizagi.util.isArray(i)?bizagi.util.isArray(i)&&i.length>0?i:void 0:i}),e,n);break;case"max":t=a.max((function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)}),n);break;case"min":t=a.min((function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)}),n);break;case"avg":t=(t=a.avg((function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)}),n)).toFixed(2)}o&&(t=i.formatTotalizedResult(o,e.bizAgiProperties.type,t),r.push({label:e.label,total:t}))}})),i.showTotals(r),bizagi.loading.stop()},formatTotalizedResult:function(e,t,i){switch(e){case"sum":case"avg":case"min":case"max":if(/columnMoney/i.test(t)||/money/i.test(t))return bizagi.util.formatMonetaryCell(i)}return i||0},showTotals:function(e){var t=$.fasttmpl(this.renderFactory.getTemplate("bizagi.grid.totalizer"),{items:e});this.grid.mobileView({displayName:bizagi.localization.getResource("render-grid-totalizer"),orientation:this.properties.orientation,style:"width: 80%; height: 70%",transition:"fade:in",cssClass:"bz-modal-view--totalizer",showBorder:!0,contentTemplate:t})},changeBackgroundColor:function(e){var t=this.getControl();return t&&$(".bz-tablet-grid",t).css("background-color","none"!==e?e:""),this},getCellValueFormatted:function(e,t){var i=e.properties.type,a=t;if(/columnDate/i.test(i)){var r=e.data.properties;if(bizagi.util.isEmpty(a))""===t&&(a="");else{var n=bizagi.util.dateFormatter.getDateFromInvariant(a,r.showTime);void 0!==n&&0!==n&&(r.showTime||n.setHours(0,0,0,0),a=bizagi.util.dateFormatter.formatInvariant(n,!0))}}return a},onCellChange:function(e,t,i,a){var r=bizagi.util.normalizeType(e.properties.type);if(!new RegExp(["columnImage","columnUpload"].join("|"),"i").test(r))try{var n=e.getValue(i),o=e.getCompositeValue(i);if(/columnDate/i.test(r))if(bizagi.util.isEmpty(n))""===n&&(n="");else{var l=bizagi.util.dateFormatter.getDateFromInvariant(n,!0);l.setMilliseconds(0),n=bizagi.util.dateFormatter.formatInvariant(l,!0)}!(/columnBoolean/i.test(r)&&e.properties.isExclusive)&&this.properties.allowEdit&&this.collectGridChange($.extend(a,{id:i,xpath:e.properties.xpath||e.properties.id,value:n,compositeValue:o,columnIndex:e.columnIndex,trigger:!0,dataType:r})),this.triggerGridPluginHandler("changeCellValue",i,e.columnIndex,n)}catch(t){console.warn("onCellChange error: ",t,e)}},drawEditableCell:function(e,t,i,a,r){var n=this,o=new $.Deferred,l=e.properties.editable;return e.properties.editable=!0,e.overrideProperties({required:t.required}),$.when(e.render(i,a)).done((function(t){(n.columns||[]).forEach((function(e,t){var a=!0;n.cellOverrides[i]=n.cellOverrides[i]||{},void 0!==n.getCellOverride(i,t).visible&&(a=n.getCellOverride(i,t).visible),n.getCellOverride(i,t).visible=a})),e.getDecorated(i).unbind("renderchange.draweditable").bind("renderchange.draweditable",(function(a,r){n.onCellChange(e,t,i,r)})),o.resolve(t)})),e.properties.editable=l,o.promise()},drawReadonlyCell:function(e,t,i,a){var r=this,n=new $.Deferred;return $.when(e.renderReadOnly(i,a)).done((function(e){(r.columns||[]).forEach((function(e,t){var a=!0;r.cellOverrides[i]=r.cellOverrides[i]||{},void 0!==r.getCellOverride(i,t).visible&&(a=r.getCellOverride(i,t).visible),r.getCellOverride(i,t).visible=a})),n.resolve(e)})),n.promise()},triggerGridPluginHandler:function(){try{var e=Array.prototype.slice.call(arguments,0);return this.grid.bizagi_grid_tablet.apply(this.grid,e)}catch(e){console.warn("triggerGridPluginHandler error: ",e)}},addExclusiveChange:function(e,t){if(this.properties.hasExclusiveCheck)for(var i in t){var a=this.columns.find((function(e){return e.properties.xpath==i})),r=t[i];a&&a.properties.isExclusive&&r&&(this.exclusiveChanges[i]={xpath:i,simpleXpath:i,value:r,key:e})}},changeCellMaxValue:function(e,t,i){var a=this;if(a.initialLoadDone){var r=a.getControlCell(e,t);r&&r.changeMaxValue(i)}else a.pendingActions.push({method:a.changeMaxValue,arguments:arguments})},changeCellMinValue:function(e,t,i){var a=this;if(a.initialLoadDone){var r=a.getControlCell(e,t);r&&r.changeMinValue(i)}else a.pendingActions.push({method:a.changeMinValue,arguments:arguments})},executeFailHandlerOnForm:function(e){var t=e&&e.responseText?e.responseText:bizagi.util.getErrorFormatted(e);(void 0===t||t&&!t.message)&&(message=Object.assign({},"object"===_typeof(t)?t:{},{message:bizagi.localization.getResource("workportal-general-error")})),this.getFormContainer().failHandler(t)}}),bizagi.rendering.tablet.grid.extend("bizagi.rendering.tablet.grid.offline",{},{init:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;i.data.originalRows=bizagi.clone(i.data.rows),i.isTaskForm=t.properties.isTaskForm,this.newRecords={},!0===i.editable&&(this["new-records"]=i["new-records"]?i["new-records"]:{},this["deleted-records"]=i["deleted-records"]?i["deleted-records"]:{}),this.editedImages=i["edited-images"]?i["edited-images"]:{},this.offlineFiles=i["offline-files"]?i["offline-files"]:{},i.displayType="vertical",i.labelAlign="left",(i.groupBy||i.groupSummary)&&t.addWarning(this.getResource("render-tablet-warning-grid")),this.pendingActions=[]},initProperties:function(){this._super(),this.properties.rowsPerPage=1e3},updateOriginalValue:function(){var e=this.properties;this.changes=[],e.data.originalRows=bizagi.clone(e.data.rows),e["new-records"]=void 0,e["edited-images"]=e["offline-files"]=e["deleted-records"]={}},postRender:function(){var e=this,t=e.properties,i=e.getControl();if(e.initialLoadDone=!1,e.grid=$(">div",i),e.getLabel().hide(),e.applyGridPlugin(),t.data&&(e.updateData(t.data),$.when(e.ready()).done((function(){e.triggerRenderChange({changed:!1})}))),e.initialLoadDone=!0,e.pendingActions&&e.pendingActions.length>0)for(var a in e.pendingActions)e.pendingActions[a].method.apply(e,e.pendingActions[a].arguments)},postRenderReadOnly:function(){this.postRender()},applyGridPlugin:function(){var e=this,t=e.properties,i=e.grid,a=e.getMode(),r=e.buildColumnModel();i.bizagi_grid_tablet({columns:r,title:t.displayName,isOfflineForm:this.isOfflineForm||!1,mode:e.getMode(),template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),buttons:e.renderFactory.getTemplate("bizagi.grid.offline.buttons"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.offline.row.buttons"),specialCell:e.renderFactory.getTemplate("bizagi.grid.offline.cell.special")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&null!=t.data,remove:t.allowDelete,details:!1,inlineAdd:!!t.editable||t.inlineAdd,allowMore:!1,enableXlsExport:!1,enablePdfExport:!1,hasTotalizer:!1},isValid:function(){return e.isValidGrid()},pageRequested:function(t){"execution"===a&&e.fetchData(t.page,t.sortBy,t.sortType)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){"execution"===a&&e.triggerHandler("rowSelected",{id:t.key,data:t})},addRow:function(t){"execution"===a&&e.addRow()},editRow:function(t){"execution"===a&&e.editRow(t.key)},deleteRow:function(t){"execution"===a&&e.deleteRow(t.key)},saveAddedRows:function(t){e.saveInlineAddedRows(t.keys)},beforeInlineAdd:function(){e.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(t){e.inlineAddDeferred&&e.inlineAddDeferred.resolve(),t&&t.businessKey&&e.triggerRenderChange({key:t.businessKey})},cancelEdition:function(t){e.removeNewRecords(t)},removeNewRecords:function(t){e.removeNewRecords(t)}})},fetchData:function(e,t,i){var a=this;a.dataReadyDeferred=new $.Deferred,a.startLoading(),$.when(a.getRemoteData()).then((function(e){e&&(a.updateData(e),a.triggerRenderChange({changed:!1}),a.dataReadyDeferred.resolve())})).always((function(){a.endLoading()}))},processChanges:function(){var e=[];this.properties.data;for(var t in this.changes){var i=[];for(var a in this.changes[t])if(this.canColumnBeSent(t,a)){var r=this.getColumn(a).columnIndex-1,n=this.changes[t][a];"string"==typeof n&&null!==n.match(/\n/gm)&&(n=n.replaceAll("\n","\\n")),i[r]=n}for(var o=0;o<this.columns.length;o++)i[o]=null!=i[o]?i[o]:null;this.newRecords[t]&&(i.unshift(parseInt(t+"")),i.creationTimestamp=this.newRecords[t].creationTimestamp,e[e.length]=i)}return e=(e=e.sort((function(e,t){return e.creationTimestamp-t.creationTimestamp}))).map((function(e){return e.creationTimestamp&&delete e.creationTimestamp,e}))},collectOfflineTaskData:function(e){var t=this.properties,i=this.properties.data,a={},r=this.editedImages,n=this.offlineFiles;for(var o in this.changes){var l=[],s={},d={},c={};for(var p in this.changes[o])if(this.canColumnBeSent(o,p)){var u=this.getColumn(p).columnIndex-1;"string"==typeof(m=this.changes[o][p])&&null!==m.match(/\n/gm)&&(m=m.replaceAll("\n","\\n")),l[u]=m;var g=t.xpath+this.buildCellXpathFilter(o)+"."+p,h=this.changes[o][p],m=h&&h.value?h.value:h;r[o]&&r[o][p]?(delete r[o][p].isChanged,d[p]=r[o][p]):n[o]&&n[o][p]?c[p]=n[o][p]:(e[g]=m,s[g]=m)}if(this.newRecords[o]){var b=$.extend({},this.changes[o]),f={url:t.addUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,contexttype:t.contexttype,idPageCache:t.idPageCache,submitData:b,prepare:!0,idRow:parseInt(o+""),creationTimestamp:this.newRecords[o].creationTimestamp};for(change in a[o]=f,s)delete e[change];for(image in d)delete b[image],r[o][image].isNew=!0;for(file in c)delete b[file],n[o][file].isNew=!0;Object.keys(d).length>0&&(r[o].isNew=!0),Object.keys(c).length>0&&(n[o].isNew=!0);var v={};v.idRow=parseInt(o+""),v.isNew=!0,v.changes=this.changes[o],f.images=d,f.files=c,l.push(v)}}this.saveInlineAddedRows(),(JSON.stringify(i.rows)!==JSON.stringify(i.originalRows)||null!=t["new-records"]&&a!=t["new-records"])&&(e[t.xpath]=e[t.xpath]?e[t.xpath]:{},void 0!==i.rows&&(e[t.xpath].rows=this.processOldRows(i.rows)),this["deleted-records"]&&Object.keys(this["deleted-records"]).length>0&&(e[t.xpath]["deleted-records"]=this["deleted-records"]),a&&Object.keys(a).length>0&&(e[t.xpath]["new-records"]=a),r&&Object.keys(r).length>0&&(e[t.xpath]["edited-images"]=r),n&&Object.keys(n).length>0&&(e[t.xpath]["offline-files"]=n))},collectOfflineStartData:function(e){var t=[],i=this.properties,a=this.properties.data;if(this.isValid([]))for(var r in this.changes){var n=[];for(var o in this.changes[r])if(this.canColumnBeSent(r,o)){var l=this.getColumn(o).columnIndex-1,s=this.changes[r][o];"string"==typeof s&&null!==s.match(/\n/gm)&&(s=s.replaceAll("\n","\\n")),n[l]={value:s,xpath:o,DataType:this.getColumn(o).properties.dataType}}if(void 0!==this.properties.data.rows&&this.properties.data.rows.length>0)for(var d=[],c=0;c<a.rows.length;c++)if(a.rows[c][0]==r){d=a.rows[c],a.rows.splice(c,1),c--,d=this.processRow(d),n=$.extend(!0,d,n);break}t[t.length]=n}(JSON.stringify(a.rows)!==JSON.stringify(a.originalRows)||t.length>0)&&(void 0!==a.rows&&t.length>0?e[i.xpath].rows=$.merge($.merge([],this.processOldRows(a.rows)),t):void 0!==a.rows&&a.rows.length>0?e[i.xpath].rows=this.processOldRows(a.rows):e[i.xpath].rows=t)},collectData:function(e){this.collectOfflineTaskData(e)},processOldRows:function(e){for(var t=[],i=e,a=0,r=i.length;a<r;a++){var n=i[a];t[a]=$.grep(n,(function(e,t){return t>0}));var o={};o.idRow=parseInt(n[0]+""),o.isNew=!!this.newRecords[n[0]],o.changes=this.changes[n[0]]?this.changes[n[0]]:{},t[a].push(o)}return t},processRow:function(e){return $.grep(e,(function(e,t){return t>0}))},drawCell:function(e,t,i,a){if(e.key)return i;"object"!==_typeof(i)||null===i||a||(i=i.hasOwnProperty("value")?i.value:i);var r=e.index-1,n=this.columns[r],o=this.getCellOverride(t,e.index-1);this.newRecords=this.newRecords||{},this.cellMetadata[t]||(this.cellMetadata[t]={}),this.cellMetadata[t][r]||(this.cellMetadata[t][r]={});var l=this.cellMetadata[t][r].properties||n.properties,s=void 0===l.visible||l.visible,d=void 0===l.editable||l.editable;if(s=o.visible,d=!!l.editable&&o.editable,a&&(d=!0),"summary"===t&&(d=!1),"columnUpload"===n.properties.type&&(this.offlineFiles[t]&&this.offlineFiles[t][n.properties.xpath]?i=this.offlineFiles[t][n.properties.xpath].value:i&&Array.isArray(i)&&i.length>0&&(i=this.dataService.database.convertUploadOnlineValueInOfflineValue(i))),n.properties.displayType="value",n.setValue(t,i),n.setSurrogateKey(t),n.properties.data=n.properties.data||[],"columnSearch"===n.properties.type&&null!=i)for(var c=0,p=n.properties.data.length;c<p;c++)n.properties.data[c].id==i&&(i={id:n.properties.data[c].id,label:n.properties.data[c].value});if(("columnCombo"===n.properties.type||"columnList"===n.properties.type)&&null!=i)for(c=0,p=n.properties.data.length;c<p;c++)n.properties.data[c].id==i&&(i=[[n.properties.data[c].id,n.properties.data[c].value]]);return"columnText"===n.properties.type&&bizagi.util.isEmpty(i)&&null!=i&&(i=""),"columnImage"===n.properties.type&&this.editedImages[t]&&this.editedImages[t][n.properties.xpath]&&(n.getDecorated(t).properties.isChanged=this.editedImages[t][n.properties.xpath].isChanged),"columnUpload"===n.properties.type&&(n.getDecorated(t).properties.xpathContext=this.properties.xpath+this.buildCellXpathFilter(t)),s?d?this.drawEditableCell(n,l,t,i,a):this.drawReadonlyCell(n,l,t,i):""},drawEditableCell:function(e,t,i,a,r){var n=this,o=new $.Deferred,l=e.properties.editable;return e.properties.editable=!0,e.overrideProperties({required:t.required}),$.when(e.render(i,a)).done((function(t){r&&!n.newRecords[i]&&(n.newRecords[i]={creationTimestamp:Date.now()},n.changes[i]={});for(var a=0;a<n.columns.length;a++)n.cellOverrides[i]=n.cellOverrides[i]||{},n.getCellOverride(i,a).visible=null==n.getCellOverride(i,a).visible||n.getCellOverride(i,a).visible;e.getDecorated(i).bind("renderchange",(function(a){n.onCellChange(e,t,i)})),o.resolve(t)})),e.properties.editable=l,o.promise()},drawReadonlyCell:function(e,t,i,a){var r="";if("summary"===i){var n=e.properties.textFormat;e.properties.totalize&&(e.properties.textFormat=e.properties.totalize.format),r=e.renderSummary(i,a),e.properties.textFormat=n}else r=e.renderReadOnly(i,a);return r},onCellChange:function(e,t,i){var a=e.getValue(i),r=e.getCompositeValue(i);if("columnDate"===e.properties.type&&1==e.data.properties.showTime)if(bizagi.util.isEmpty(a))""===a&&(a="");else{var n=bizagi.util.dateFormatter.getDateFromInvariant(a,!0);a=bizagi.util.dateFormatter.formatInvariant(n,!0)}else if("columnDate"===e.properties.type){if(bizagi.util.isEmpty(a))""===a&&(a="");else(n=bizagi.util.dateFormatter.getDateFromInvariant(a,!1)).setHours(0,0,0,0),a=bizagi.util.dateFormatter.formatInvariant(n,!0)}if("columnImage"===e.properties.type){var o=this.properties.xpath+this.buildCellXpathFilter(i)+"."+e.properties.xpath;this.editedImages=this.editedImages||{},this.editedImages[i]=this.editedImages[i]||{},this.editedImages[i][e.properties.xpath]={id:i,columnXpath:e.properties.xpath,renderId:e.properties.id,gridXpath:this.properties.xpath,fullXpath:o,value:a,offlineId:e.getDecorated(i).buildOfflineImageId(),name:this.dataService.fileService.getOfflineImageName(a),isChanged:!0}}if("columnUpload"===e.properties.type){o=this.properties.xpath+this.buildCellXpathFilter(i)+"."+e.properties.xpath;this.offlineFiles[i]=this.offlineFiles[i]||{},this.offlineFiles[i][e.properties.xpath]={id:i,columnXpath:e.properties.xpath,renderId:e.properties.id,gridXpath:this.properties.xpath,fullXpath:o,value:a}}if(this.properties.allowEdit||this.grid.bizagi_grid_tablet("isNewRecord",i)){var l=!this.grid.bizagi_grid_tablet("isNewRecord",i);this.collectGridChange({id:i,xpath:e.properties.xpath,value:a,compositeValue:r,columnIndex:e.columnIndex,trigger:l,dataType:e.properties&&e.properties.type})}this.grid.bizagi_grid_tablet("changeCellValue",i,e.columnIndex,a),e.properties.totalize&&e.properties.totalize.operation&&this.grid.bizagi_grid_tablet("refreshSummary",e.columnIndex)},collectGridChange:function(e){var t=(e=e||{}).id,i=e.xpath,a=e.value,r=void 0===e.trigger||e.trigger;this.changes[t]=this.changes[t]||{},this.changes[t][i]=a,r&&this.triggerRenderChange({key:t,column:i})},onCellReady:function(e,t,i,a){a=!0,bizagi.rendering.tablet.grid.prototype.onCellReady.apply(this,arguments)},addRow:function(){bizagi.showMessageBox(bizagi.localization.getResource("render-tablet-error-userfield"),bizagi.localization.getResource("render-tablet-error-userfield"))},editRow:function(e){},deleteRow:function(e){var t=this;e&&0!=e?bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){t.saveInlineAddedRows(),$.when(t.submitDeleteRequest(e)).done((function(){t.fetchData(),t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e})}))})):bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},editInline:function(e){},saveInlineAddedRows:function(e,t){this.updateRowsFromChanges(),this.updateNewRowsAsSaved()},updateNewRowsAsSaved:function(){var e=this;bizagi.util.isEmpty(e.newRecords)||(e.triggerGridPluginHandler("hideHeaderButtons"),Object.keys(e.newRecords||[]).forEach((function(t){e.setRowAsSaved(t)})))},updateRowsFromChanges:function(){var e=this.processChanges();bizagi.util.isEmpty(e)||(this.properties.data.rows=this.mergeArray(this.properties.data.rows,e))},mergeArray:function(e,t){var i=this,a=bizagi.clone(e);return t.forEach((function(e){var t=e[0],r=i.getRowByKey(a,t);bizagi.util.isEmpty(r)?a.push(e):r=i.mergeRow(r,e)})),a},getRowByKey:function(e,t){var i=e.filter((function(e){return e[0]==t}));return 0==i.length?null:i[0]},mergeRow:function(e,t){return t.forEach((function(t,i){null!=t&&null!=t&&(e[i]=t)})),e},removeNewRecords:function(e){var t=this;e&&e.keys&&$.each(e.keys,(function(e,i){t.newRecords[i]&&(delete t.newRecords[i],delete t.changes[i],delete t.offlineFiles[i])}))},getRemoteData:function(e){var t=this.properties;if(e=e||{},t.overrideGetRemoteData){var i=t.overrideGetRemoteData(e);return null!=i?i.promise():null}var a=new $.Deferred,r=t.data;return t.page=r.page,t.records=r.records,t.totalPages=r.totalPages,this.isRTL()&&(r.rows=this.changeOrderData(r.rows)),a.resolve(r),a.promise()},submitDeleteRequest:function(e){for(var t=this.properties,i=this.properties.data,a=0,r=i.rows.length;a<r;a++)if(i.rows[a][0]==e){i.rows[a],i.rows.splice(a,1),a--,i.records--,!0;var n=t.xpath+this.buildCellXpathFilter(e),o={url:t.deleteUrl,idRender:t.id,xpath:n,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType,prepare:!0};this["deleted-records"][e]=o,delete this.newRecords[e],delete this.editedImages[e],delete this.offlineFiles[e],delete this.changes[e];break}return i.rows},isValidGrid:function(){var e=[],t=this.getFormContainer();if(void 0!==t.validationController&&t.validationController.clearValidationMessages(),this.isValid(e),e.length>0){if(void 0!==t.validationController)for(var i=0;i<e.length;i++)t.validationController.showValidationMessage(e[i].message,e[i].xpath);return!1}return!0},getIndexes:function(){var e=this.mergeArray(this.properties.data.rows,this.getDataNewRows());return $.map(e,(function(e,t){return e[0]}))}}),bizagi.rendering.tablet.grid.extend("bizagi.rendering.tablet.grid.grouped",{},{postRender:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")},postRenderReadOnly:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.search",bizagi.rendering.search.prototype),bizagi.rendering.tablet.search.extend("bizagi.rendering.tablet.search",{ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,CLEAR_SEARCH_ID:-3,NO_RESULTS_SEARCH_ID:-4,DEFAULT_SEARCH_ID:"",SEARCH_MIN_LENGTH:3,SEARCH_DELAY:250,SEARCH_MAX_RECORDS:50},{initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.properties.submitOnChange=!this.isOfflineForm&&this.properties.submitOnChange,this.deferredReference=null},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly"),t=this.getDisplayValue(),i=t.label||t.value;return void 0!==i?"object"==_typeof(i)&&(i=i.join(" - ")):i="","string"==typeof i&&(t.additionallabel&&(i+=" - "+t.additionallabel),i=bizagi.util.sanitizeHTML(i)),$.fasttmpl(e,{value:i,editable:this.properties.editable})},postRender:function(){this.searchInput=$(".bz-input-icon",this.getControl())},postRenderReadOnly:function(){this.searchInput=$(".bz-input-icon",this.getControl())},configureHandlers:function(){var e=this,t=e.getControl();$(".bz-input-icon",t).on("click",(function(){!e.properties.advancedSearch||e.isOfflineForm?e._simplySearchView():e._advanceSearchView()})),$(".bz-icn--clear",t).bind("click",(function(i){$(".bz-input-icon",t).addClass("bz-input-icon--empty"),e.cleanData(),e.readyActionExecution().done((function(){e.properties.submitOnChange&&e.submitData()})),i.stopPropagation()}))},configureModalViewHandlers:function(e){var t=this;t.modalViewList=$(".bz-list",e.content);var i=bizagi.util.debounce((function(e){t.autoCompleteSearchResults($.trim(e))}),t.Class.SEARCH_DELAY);$("[data-action=close]",e.header).bind("click",(function(){e.close()}));var a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);a.bind("click",(function(){r.val("").trigger("clean")})),$(".bz-list",e.content).on("click","li",(function(){var i=$.data(this).item;!i||i&&i.id==t.Class.NO_RESULTS_SEARCH_ID||(t.selectItem(i),e.close())})),r.bind("clean keyup",(function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),i(this.value)})).on("focus",(function(){e.header.addClass("bz-modal-view__header--active")})).on("blur",(function(){e.header.removeClass("bz-modal-view__header--active")}))},_advanceSearchView:function(){var e=this,t=e.properties,i=$.extend({},e.getParams(),{container:e.getFormContainer().container,title:t.displayName||"",allowNew:t.allowNew});new bizagi.rendering.tablet.slide.searchForm(e.dataService,e.renderFactory,t.searchForms,{allowFullSearch:t.allowFullSearch,maxRecords:t.maxRecords,idRender:t.id,navigation:e.getParams().navigation,idPageCache:t.idPageCache,orientation:t.orientation||"ltr",editable:t.editable},i).render({idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:t.idPageCache}).done((function(t){e.setValue(t),e.readyActionExecution().done((function(){var t=e.getFormContainer();e.properties.submitOnChange||$.when(t.submitData()).done((function(){e.refreshControl()}))}))}))},_simplySearchView:function(){var e=this,t=e.getContentTemplate();e.searchInput.mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),orientation:e.properties.orientation||"",contentTemplate:t,style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.configureModalViewHandlers(t)}})},autoCompleteSearchResults:function(e){var t=this;$.when(t.processRequest({term:e})).done((function(e){t.modalViewList.find("li").remove();for(var i=0,a=e.length;i<a;i++){t.renderSearchItem(e[i]).appendTo(t.modalViewList)}}))},renderSearchItem:function(e){var t=this.renderFactory.getTemplate("search.item"),i=$.tmpl(t,{id:e.id,label:e.label,value:e.value});return i.data("item",e),i},processRequest:function(e){var t=this,i=t.properties,a=new $.Deferred,r=[];if(t.properties.allowSuggest&&e.term.length>=t.properties.searchLength){i.term=e.term;var n=t.isOfflineForm?t.getOfflineData():t.getData();t.deferredReference&&"function"==typeof t.deferredReference.reject&&"resolved"!==t.deferredReference.state()&&t.deferredReference.reject({hideStatus:!0}),t.deferredReference=n.done((function(n){n&&n.length>0?((n=n.slice(0,i.maxRecords)).length>t.Class.SEARCH_MAX_RECORDS?(n=n.slice(0,t.Class.SEARCH_MAX_RECORDS),r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-search-maximum-records-allowed"),value:""})):n=n.slice(0,i.maxRecords),r.push({id:t.Class.DEFAULT_SEARCH_ID,label:t.getResource("render-combo-empty-value"),value:""}),$.each(n,(function(t,a){if(0===i.maxRecords||t<i.maxRecords){var n=bizagi.util.performTermMatches(a.value,e.term);r.push({id:a.id,label:n,value:a.value})}}))):r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-grid-no-records"),value:""}),a.resolve(r)})).fail((function(){a.reject()}))}else a.resolve(r);return a.promise()},setDisplayValue:function(e){var t="";if(null!=(e=this.mapValue(e))&&void 0!==e.id){t=e.additionallabel&&e.label?e.label+" - "+e.additionallabel:e.label?e.label:"";var i=this.searchInput.find("input");i.val(t),i.attr("id",e.id),""!==e.id&&this.properties.allowClear&&$(".bz-input-icon",this.getControl()).removeClass("bz-input-icon--empty"),this.properties.editable&&this.setValue(e,!0)}},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.properties.submitOnChange&&null!=e[this.properties.xpath].id&&this.submitOnChange(e,!0)},cleanData:function(){var e={id:"",value:""};bizagi.util.isEmpty(this.value)&&(e={}),this.setValue(e),this.setDisplayValue(e)},getContentTemplate:function(){var e=this.renderFactory.getTemplate("search.items"),t=$.fasttmpl(e,{});return $.trim(t)},selectItem:function(e){var t=this.hasValue(),i=Array.isArray(e.value)?e.value.join(" - "):e.value;this.setDisplayValue({id:e.id,label:i}),this.properties.allowClear&&(e.id===this.Class.DEFAULT_SEARCH_ID?(this.searchInput.find(".bz-search__clear").addClass("bz-search--hidden"),this.searchInput.find(".bz-search__icon").removeClass("bz-search--hidden")):t||e.id===this.Class.DEFAULT_SEARCH_ID||(this.searchInput.find(".bz-search__clear").removeClass("bz-search--hidden"),this.searchInput.find(".bz-search__icon").addClass("bz-search--hidden")))},getOfflineData:function(){var e=this.properties.data||[],t=(this.properties.term||"").toLowerCase();return $.when(t.startsWith("%%")?e:e.filter((function(e){var i=e&&e.value?e.value:"";return"object"===_typeof(i)&&(i=i.toString()),i.toLowerCase().indexOf(t)>-1})))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.letter",bizagi.rendering.letter.prototype),bizagi.rendering.tablet.label.extend("bizagi.rendering.tablet.letter",{},{}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.button",bizagi.rendering.button.prototype),bizagi.rendering.tablet.button.extend("bizagi.rendering.tablet.button",{},{isOfflineForm:!1,initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this})},configureHandlers:function(){var e=this;$(":button",e.getControl()).on("click",(function(){e.processButton()}))},executeButton:function(){return!this.isOfflineForm&&this._super()},processButton:function(){var e=this;e.properties.editable&&(e.properties.needsUserConfirmation?$.when(bizagi.showConfirmationBox(e.properties.userConfirmationMessage,"Bizagi","warning")).done((function(){e.properties.preventDefault||e.runButtonAction(),e.triggerRenderChange({pressed:!0})})):(e.properties.preventDefault||e.runButtonAction(),e.triggerRenderChange({pressed:!0})))},getElementsToStylize:function(e){return $("button",e)},changeFontBold:function(e,t){return bizagi.util.parseBoolean(t)&&e.css("font-weight","bold"),this}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.fileprint",bizagi.rendering.fileprint.prototype),bizagi.rendering.tablet.fileprint.extend("bizagi.rendering.tablet.fileprint",{},{postRender:function(){this.getControl().parent().hide()}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.link",bizagi.rendering.link.prototype),bizagi.rendering.tablet.link.extend("bizagi.rendering.tablet.link",{},{postRender:function(){var e=this.getControl();this.link=e.find(".bz-link"),this._super(),this.preventDefaultForAnchorTag()},postRenderReadOnly:function(){var e=this.getControl();this.link=e.find(".bz-link"),this._super()},setDisplayValue:function(e){this.setValue(e,!1),this.isValidValue()&&(e=getFullyDecodedURI($.trim(e)),this.link.attr("href",e))},configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},attachEvents:function(){var e=this;e.isValidValue()?e.link.on("click",(function(t){t.preventDefault(),t.stopPropagation();var i=encodeURI(this.getAttribute("href"));e.linkSolver(i,e.properties.linktarget)})):e.link&&e.link.addClass("bz-link--disabled")},isValidValue:function(){return this.hasValue()&&null!==$.trim(this.getValue()||"").toLowerCase().match(/^(http|https):\/\//)||!1},linkSolver:function(e,t){"newwindow"===t||bizagi.util.isCordovaSupported()?window.open(e,"_system","location=yes"):window.open(e,"_system")},processLayout:function(e){e?void 0!==this.properties.textFormat.background&&this._super(e,{background:this.properties.textFormat.background}):this._super(e,this.properties.textFormat)},getElementsToStylize:function(e){return $(".bz-link",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.formLink",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},bizagi.rendering.formLink.prototype),bizagi.rendering.tablet.formLink.extend("bizagi.rendering.tablet.formLink",{},{configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},openLink:function(){var e=this;$.when(e.submitEditRequest()).done((function(){bizagi.loading.start(),$.when(e.paintFormLink()).done((function(){bizagi.loading.stop()})).fail((function(){bizagi.loading.start(),e.rollbackForm()})).always((function(){bizagi.loading.stop()}))})).always((function(){bizagi.loading.stop()}))},openLinkRule:function(e){var t=this,i=new $.Deferred;return bizagi.loading.start(),t.getPropertyValue(e,{}).done((function(a){if(void 0!==(a=a||{}).messages&&null!==a.messages){var r=a.messages[0];t.getFormContainer().validationController.showErrorMessage(r),i.reject()}else"entryrule"===e&&t.openLink();i.resolve()})).fail((function(){i.reject()})).always((function(){bizagi.loading.stop()})),i.promise()},paintFormLink:function(){var e=this,t=e.properties,i=e.getFormContainer(),a=e.getFormParams(),r=$.Deferred();return new bizagi.rendering.tablet.slide.view(e.dataService,e.renderFactory,{title:e.properties.displayName||"",container:i.container,navigation:e.getParams().navigation,showSaveButton:t.editable,orientation:t.orientation||"ltr",onSave:function(t){return e.actionSave(t).then((function(t){return e.submitForm(t).done((function(){r.resolve(t)})).fail((function(){r.reject()}))})).fail((function(e){r.reject(e)}))},goBack:function(){e.rollbackForm()}}).render({idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,recordXPath:e.getFormLinkXpath(),requestedForm:"linkform",editable:t.editable,formParams:a,url:t.editPage}).fail((function(){r.reject()})),r.promise()},getPropertyValue:function(e,t){var i=this,a=i.properties,r=new $.Deferred;return i.dataService.multiaction().getPropertyData({url:a.dataUrl,xpath:a.xpath,idRender:a.id,xpathContext:a.xpathContext,idPageCache:a.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done((function(e){"error"===e.type?(i.getFormContainer().validationController.showErrorMessage(e.message),r.reject(e)):r.resolve(e)})).fail((function(e,t,a){i.getFormContainer().validationController.showErrorMessage(e.message),r.reject(e,t,a)})),r.promise()},actionSave:function(e){var t=this,i=$.Deferred();return $.when(t.submitSaveRequest(e)).done((function(e){try{"validationMessages"===e.type?t.form.addValidationMessage(e.messages):"error"===e.type&&i.reject(e),i.resolve(e)}catch(e){i.reject({noAction:!0})}})).fail((function(e){i.reject(e)})),i.promise()},submitSaveRequest:function(e){var t=this.properties;if(!1===t.editable&&!t.value)return null;var i=this.getFormLinkXpath(),a=i;return void 0!==t.xpathContext&&""!==t.xpathContext&&(a=i?t.xpathContext+"."+i:t.xpathContext),this.dataService.saveLinkForm({url:t.saveUrl,idRender:t.id,xpathContext:a,submitData:e})},submitForm:function(e){var t=this,i=$.Deferred(),a=!0;return e&&"validationMessages"===e.type&&(a=!1),t.properties.hasexitrule?t.closeExitRule().done((function(){a&&t.submitCommitRequest().done((function(){t.properties.hasentryrule?t.submitCommitRequest().done((function(){$.when(t.submitOnChange()).done((function(){i.resolve(e)}))})):$.when(t.submitOnChange()).done((function(){i.resolve(e)}))}))})).fail((function(){i.reject()})):a&&a&&t.submitCommitRequest().done((function(){t.properties.hasentryrule?t.submitCommitRequest().done((function(){$.when(t.submitOnChange()).done((function(){i.resolve(e)}))})):$.when(t.submitOnChange()).done((function(){i.resolve(e)}))})).fail((function(){i.reject()})),i.promise()},closeExitRule:function(){var e=this.properties,t=new $.Deferred;return e.hasexitrule&&$.when(this.openLinkRule("exitrule")).done((function(e){t.resolve(e)})).fail((function(){t.reject()})),t.promise()},rollbackForm:function(){var e=this,t=e.form||e.getFormContainer();$.when(e.submitRollbackRequest({idPageCache:t.idPageCache})).done((function(){e.properties.hasentryrule&&e.submitRollbackRequest({idPageCache:t.idPageCache})}))},getFormLinkXpathContext:function(){var e=this.properties.xpathContext,t=this.getXpathContext();return t&&e?0===e.indexOf(t)?e:t+"."+e:e},attachEvents:function(){var e=this,t=e.getControl();$("[data-action=open]",t).on("click",(function(){if(e.properties.hasentryrule){var t=e.getFormContainer();$.when(t.saveForm()).done((function(){e.submitCheckpointRequest().done((function(){return e.openLinkRule("entryrule")}))}))}else e.openLink()}))},processLayout:function(e){e?void 0!==this.properties.textFormat.background&&this._super(e,{background:this.properties.textFormat.background}):this._super(e,this.properties.textFormat)},getElementsToStylize:function(e){return $(".bz-link",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.hidden",bizagi.rendering.hidden.prototype),bizagi.rendering.tablet.hidden.extend("bizagi.rendering.tablet.hidden",{},{}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.radio",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.radio.extend("bizagi.rendering.tablet.radio",bizagi.rendering.radio.prototype),bizagi.rendering.tablet.radio.extend("bizagi.rendering.tablet.radio",{},{postRender:function(){var e=this.getControl();this.radio=e.find("input[type=radio]"),!this.properties.editable||null!=this.value&&void 0!==this.value||null==this.properties.value||(this.value=this.properties.value)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.radio=e.find("input")},setDisplayValue:function(e){var t=this.getControl();(e=this.mapValue(e),this.setValue(e,!1),void 0!==e&&null!=e.id&&""!==e.id)&&(this.properties.editable?t.find('input[type="radio"][value="'+e.id+'"]').prop("checked","checked"):(this.radio.val(this.getDisplayValue()),this.radio.attr("id",e.id)))},configureHandlers:function(){var e=this;this.radio.change((function(){var t=$(this),i={id:t.prop("value"),value:$.trim(t.siblings("label").text())};e.setValue(i)}))},getElementsToStylize:function(e){return $("label.bz-radio__label, .bz-input.bz-input--readonly",e)},cleanData:function(){this.setValue({id:"",label:""},!1),this.clearDisplayValue()},clearDisplayValue:function(){this.properties.editable?this.radio.prop("checked",!1):this.radio.val(this.getDisplayValue())},getSelectedValue:function(){return this.selectedValue}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.cascadingCombo",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.cascadingCombo.extend("bizagi.rendering.tablet.cascadingCombo",bizagi.rendering.cascadingCombo.prototype),bizagi.rendering.tablet.cascadingCombo.extend("bizagi.rendering.tablet.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{renderControl:function(){var e=this.getMode();return this.parentCombo=this.getParentCombo(),null!=this.parentCombo&&/cascadingcombo/i.test(this.parentCombo.properties.type)&&(this.isDependant=!0),this.initializingCascadingCombo=!0,"execution"!=e&&(this.initializingCascadingCombo=!1),bizagi.rendering.tablet.combo.prototype.renderControl.apply(this,arguments)},postRender:function(){bizagi.rendering.tablet.combo.prototype.postRender.apply(this,arguments)},configureHandlers:function(){this._super(),bizagi.rendering.tablet.combo.prototype.configureHandlers.apply(this,arguments)},cleanData:function(){bizagi.rendering.tablet.combo.prototype.cleanData.apply(this,arguments)},refresh:function(e,t){var i=this;$.when(i.isRendered()).done((function(){var e=i.getControl(),a=i.getMode();e.empty(),$.when(i.renderControl()).then((function(r){e.html(r),i.postRender(),"execution"==a&&i.configureHandlers(),t?i.setDisplayValue(i.getValue()):i.setDisplayValue({id:"",value:""}),i.deferredVisible&&i.deferredVisible.resolve(),i.trigger("select",[i.getValue(),t])}))}))},setDisplayValue:function(e){bizagi.rendering.tablet.combo.prototype.setDisplayValue.apply(this,arguments)},processComboData:function(){bizagi.rendering.tablet.combo.prototype.processComboData.apply(this,arguments)},validateValue:function(){return bizagi.rendering.tablet.combo.prototype.validateValue.apply(this,arguments)},renderComboTemplate:function(){return bizagi.rendering.tablet.combo.prototype.renderComboTemplate.apply(this,arguments)},configureModalViewHandlers:function(){bizagi.rendering.tablet.combo.prototype.configureModalViewHandlers.apply(this,arguments)},configureCombo:function(){bizagi.rendering.tablet.combo.prototype.configureCombo.apply(this,arguments)},changeCombo:function(e,t){bizagi.rendering.tablet.combo.prototype.changeCombo.apply(this,arguments)},getSelectedValue:function(){return bizagi.rendering.tablet.combo.prototype.getSelectedValue.call(this,arguments)},getTemplateName:function(){return"combo"},filterList:function(e,t){return bizagi.rendering.tablet.combo.prototype.filterList.call(this,e,t)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.list",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.list.extend("bizagi.rendering.tablet.list",bizagi.rendering.list.prototype),bizagi.rendering.tablet.list.extend("bizagi.rendering.tablet.list",{},{renderControl:function(){var e=this.renderFactory.getTemplate("list");return $.fasttmpl(e,{editable:this.properties.editable,value:this.getDisplayValue()})},postRenderReadOnly:function(){},configureHandlers:function(){var e=this,t=e.getControl();"execution"===e.getMode()&&$(".bz-form-list",t).bind("click",(function(){$(this).mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),displayName:e.properties.displayName||"",orientation:e.properties.orientation||"",contentTemplate:"",style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},open:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){$.when(e.renderCombo({})).done((function(i){$(".bz-modal-view__content",t.content).html(i),e.configureModalViewHandlers(t)}))}})}))},processComboData:function(e){var t=this;e.forEach((function(e){t.validateValue(e)}))},setDisplayValue:function(e){var t,i=this.getControl();if((e=this.mapValue(e))&&"object"===_typeof(e)&&void 0!==e.label){if(""===e.label||bizagi.util.isNumeric(e.label)){var a=this.findDataValueById(e.value);t=a?a.value:""}else t=e.label;$.isArray(t)&&(t=t.join(" - ")),e={id:e.id,value:t}}$("input",i).val(this.formatItem(e.value)),this.selectedValue=e,this.setValue(e)},configureModalViewHandlers:function(e){var t=this;$(".bz-list__item",e.content).on("click",(function(){var i={id:$(this).data("value"),value:$(this).text()};""==i.id&&(i.value=""),t.setDisplayValue(i),t.trigger("select",[i,!1]),e.close()}));var i=$(".bz-list li",e.content),a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);$("[data-action=close]",e.header).bind("click",(function(){e.close()})),a.bind("click",(function(){r.val("").trigger("change")})),r.bind("change keyup",(function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)})).focus()},filterList:function(e,t){t.filter((function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()})).show()},renderComboTemplate:function(e){var t=this.renderFactory.getTemplate("list-items"),i=this.getValue();return i=null!=i?i:{id:"",value:""},$.fasttmpl(t,{items:e,selectedId:i.id,hasItems:e.length>0},{validateItem:this.validateValue})},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".readonly-control",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.multiSelect",bizagi.rendering.multiSelect.prototype),bizagi.rendering.tablet.multiSelect.extend("bizagi.rendering.tablet.multiSelect",{MORE_OPTION_WIDTH:40,SEARCH_MIN_LENGTH:1},{initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("searchList.readonly"),t=this.getDataValue()||[];return $.fasttmpl(e,{items:t,editable:this.properties.editable||!0},{formatItem:this.formatItem})},postRender:function(){var e=this;this.isExecutionMode()&&this.getData().done((function(t){e.properties.data=t})),this._super()},configureHandlers:function(){var e=this,t=e.getControl();$("[data-action=modal]",t).bind("click",(function(){e.openModalView()}))},setDisplayValue:function(e){var t=this;if(this._super(e),void 0!==e){var i=(t.getDataValue()||[]).map((function(e){return t.formatItem(e.value)})).join(", ");$(".bz-input-icon__input",this.getControl()).html(i)}},openModalView:function(){var e=this;e.getData().done((function(t){var i=e.renderFactory.getTemplate("multiselect-list"),a=e.getDataValue()||[],r={values:t,isChecked:function(t){return e.isChecked(a,t)}},n=$.fasttmpl(i,r,{formatItem:e.formatItem}),o=e.renderFactory.getTemplate("modal-footer-done"),l=$.fasttmpl(o,{});e.getControl().mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{hideSearch:!1===e.properties.enableTyping}),orientation:e.properties.orientation||"",contentTemplate:n,footerTemplate:l,style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.configureModalViewHandlers(t)}})}))},configureModalViewHandlers:function(e){var t=this,i=$(".bz-checkbox-list li",e.content),a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);this.properties.enableTyping&&(r.on("change keyup",(function(){""===this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)})).on("focus",(function(){e.header.addClass("bz-modal-view__header--active")})).on("blur",(function(){e.header.removeClass("bz-modal-view__header--active")})),a.on("click",(function(){r.val("").trigger("change")}))),$("[data-action=close]",e.header).on("click",(function(){e.close()})),$(e.footer).on("click","[data-action=save]",(function(){var a=[];$.each.call(this,i,function(e,t){var i=t.querySelector("input");if(i.checked){var r=i.getAttribute("data-id"),n=this.findItemById(r).value;a.push({id:r,value:n})}}.bind(t)),t.setDisplayValue(a),e.close()}))},getData:function(){var e=this;return this.isOfflineForm?this.getOfflineData():$.when(this._super()).fail((function(t){var i=bizagi.util.getErrorFormatted(t),a=void 0===i?{message:bizagi.localization.getResource("workportal-general-error")}:i;e.getFormContainer().failHandler(a)}))},getOfflineData:function(){var e=this.properties.data||[];return $.when(this.normalizeData(e))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.handSignature",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.handSignature.prototype),bizagi.rendering.tablet.handSignature.extend("bizagi.rendering.tablet.handSignature",{},{isNative:!1,isOfflineForm:!1,initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported()},configureHandlers:function(){var e=this,t=$(".bz-actions",this.getControl()),i=e.getSignatureContainer(),a=bizagi.util.debounce2((function(t){if(r){var i=Array.prototype.slice.call(t||[]),a=(i&&i[0]||[]).dataImage||"";e.saveDeferred=$.when(e.saveSignature(a))}}),e.isOfflineForm?0:e.DELAY_TO_SAVE),r=!1;i.bind("change",(function(){if(r=!0,$(this).BzjSignature("isModified")){e.saveTimestamp=(new Date).getTime();var t=$(".bz-signature__container-canvas",this)[0].toDataURL("image/png");a.fire({dataImage:t}),e.setData(t.replace(/^data:image\/(png|jpg|jpeg);base64,/,"")),e.properties.url=t,e.setState(e.STATE_TYPE.done)}})),t.on("click","[data-action='clear']",(function(){r=!0,a.cancel(),e.onSignatureClear(i)})),t.on("click","[data-action='edit']",(function(){e.onSignatureEdit(i),r=!1})),t.on("click","[data-action='save']",(function(){if(!r)return e.setState(e.STATE_TYPE.edit),void i.BzjSignature("disable");e.onSignatureSave(i,a),r=!1}))},onSignatureClear:function(e){var t,i=this;return e.BzjSignature("reset"),i.hasValue()&&(bizagi.loading.start(),i.setData(i.EMPTY_VALUE),i.properties.url=i.EMPTY_VALUE,t=i.deleteSignature(),$.when(t).then((function(e){i.setData(e),i.properties.url=e})).fail((function(e){i.executeFormFailHandler(e)})).always((function(){bizagi.loading.stop()}))),$.when(t)},onSignatureEdit:function(e){this.setState(this.STATE_TYPE.draw),e.BzjSignature("enable")},onSignatureSave:function(e,t){var i=this;if(e.BzjSignature("disable"),e&&e.BzjSignature("isModified")){var a=$(".bz-signature__container-canvas",e)[0];bizagi.loading.start(),t.cancel(),i.saveSignature(a.toDataURL("image/png")).always((function(){i.setState(i.STATE_TYPE.edit),bizagi.loading.stop()}))}else i.setState(i.STATE_TYPE.edit)},renderSignature:function(){var e=this.getSignatureContainer();e.empty(),e.BzjSignature({sizeRatio:3,cssclass:"bz-signature__container-canvas",color:"#000"}),e.BzjSignature("disable"),this.pluginInitialized&&this.properties.url?this.setSignature(e):this.renderSignatureValue(e);var t=$(".bz-signature__container-canvas",e),i=Math.round(t.width()/3);t.attr("height",i).css("height",i),t.css("width","100%"),this.pluginInitialized=!0},renderSignatureValue:function(e){var t=this;bizagi.util.sleepUntil((function(){return!t.dataService.getFileService().isLoading(t)})).then((function(){return t.buildItemUrl()})).then((function(i){if(!t.isDisposed()){i===t.BASE_IMAGE+t.EMPTY_IMAGE&&(i="");var a=""!==i?i:"";t.properties.url=a,bizagi.util.isEmpty(a)?t.setData(t.EMPTY_VALUE):e.BzjSignature("setData",a)}}))},postSignature:function(e){var t=e.replace(/^data:image\/(png|jpg|jpeg);base64,/,"");return this.isOfflineForm?this.postSignatureOffline(t):this.postSignatureOnline(t)},postSignatureOffline:function(e){var t=this;return t.saveImageOffline(e).then((function(){return t.properties.isChanged=!0,e}))},deleteSignature:function(){var e=this;return e.isOfflineForm?e.saveImageOffline(e.EMPTY_IMAGE).then((function(){return e.properties.isChanged=!0,e.EMPTY_VALUE})):this.deleteImage().then((function(){return e.EMPTY_VALUE}))},buildItemUrl:function(e){return this.isOfflineForm?this.buildItemUrlOffline(e):this._super(e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.association",bizagi.rendering.association.prototype),bizagi.rendering.tablet.association.extend("bizagi.rendering.tablet.association",{},{renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done((function(a){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(a)||!1;var r=e.getColumnData(),n=$.fasttmpl(t,$.extend(e.properties,{columnData:r}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(n)})),i.promise()},getColumnData:function(){var e=this,t=e.properties,i=[];e.data=t;var a=t.flipped?t.rightData:t.leftData;return $.each(a,(function(t,a){i.push({id:a.id,value:a.value,association:e.getRightAssociation(a.id)})})),i},postRender:function(){var e="execution"===this.getMode(),t=this.getControl();this.association=$(".bz-association",t),e&&this.addEventControl(),this.showDefaultGroupList()},showDefaultGroupList:function(){var e=this.getControl(),t=$(".bz-association-group",e);t.length>0&&($("[data-action='collapse']",t[0]).toggleClass("bz-icn--expanded"),$(".bz-association-group__list",t[0]).slideDown(300,(function(){$(this).toggleClass("bz-association-group__list--hidden")})))},addEventControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=e.getControl();e.association.on("change","input:checkbox",(function(){var t=$(this),i=t.data("parent-id"),a=t.data("id");t.prop("checked")?e.addElement(i,a):e.removeElement(i,a)})),e.association.find("[data-action='flip']").click((function(){$(i).empty(),e.properties.flipped=!e.properties.flipped,e.properties.flipstate=e.properties.flipped,e.dataService.getFlipAssociation(e.properties);var a=e.getColumnData();$($.fasttmpl(t,$.extend(e.properties,{columnData:a}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation})).appendTo(i),e.postRender()})),e.association.on("click","[data-action='collapse']",(function(){var t=$(this),i=t.parents(".bz-association-group").find(".bz-association-group__list");e.closeAccordionSection(),i.hasClass("bz-association-group__list--hidden")&&(t.toggleClass("bz-icn--expanded"),i.slideDown(300,(function(){$(this).toggleClass("bz-association-group__list--hidden")})))}))},closeAccordionSection:function(e){var t=this.getControl();$("[data-action='collapse']",t).removeClass("bz-icn--expanded"),$(".bz-association-group__list",t).slideUp(300,(function(){$(this).addClass("bz-association-group__list--hidden")}))},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.postRender()},setDisplayValue:function(e){this.setValue(e,!1)},getLabel:function(){if(!this.label){var e=$("> .bz-form-label",this.element||this.observableElement);return e.length>0&&(this.label=e),e}return this.label}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.ecm.prototype),bizagi.rendering.tablet.ecm.extend("bizagi.rendering.tablet.ecm",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"],ERROR_ECM_NO_AVAILABLE:3,ACTION_DETAILS:"details",ACTION_EDIT:"edit"},{isNative:!1,initializeData:function(e){this._super(e),this.isNative=bizagi.util.isCordovaSupported(),this.fileData=[]},renderControl:function(){var e=this.renderFactory.getTemplate("ecm");return this.files=this.properties.value||[],this.filesCount=this.files.length,this.renderItem(e,{})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("ecm-readonly"),t={noFiles:0===this.filesCount};return this.renderItem(e,t)},renderItem:function(e,t){for(var i="",a=$.fasttmpl(e,t),r=0;r<this.filesCount;r++){i+=this.renderUploadItem(this.files[r])}return a=this.replaceFilesHtml(a,i)},renderUploadItem:function(e){var t=this.renderFactory.getTemplate("ecm-item"),i=this.getFormContainer(),a={id:this.properties.id,idFileUpload:e[0],fileName:e[1],editable:this.properties.editable,xPath:this.properties.xpath,xpathContext:this.getXpathContext()||i.properties.xpathContext||"",idPageCache:this.properties.idPageCache,idAttrib:this.properties.idAttrib,sessionId:i.properties.sessionId},r=$.extend({},a);return a.url=this.buildItemUrl(r),e.getFileProperties=$.when(this.renderFileLayout(a)),$.fasttmpl(t,a)},renderFileLayout:function(e){var t=this,i=t.getFormContainer(),a=new $.Deferred,r=$.extend({},e);return $.when(t.dataService.metadataECMMultiaction().getECMMetadata(e),t.dataService.metadataECMMultiaction().getFileProperties(r)).done((function(n,o){Array.isArray(o)&&(o=o[0]),Array.isArray(n)&&(n=n[0]),o.idAttrib=t.properties.idAttrib,o.showMetadata=t.properties.showMetadata,o.xpathContext=t.getXpathContext()||i.properties.xpathContext||"",o.xpath=t.properties.xpath,o.fileName=e.fileName,o.idPageCache=t.properties.idPageCache,o.fileData=r;var l=$.extend({},o,n);a.resolve(l)})),a.promise()},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},postRender:function(){var e=this.getControl();this.$contentFile=$(".bz-file-upload__container",e),this.$inputFile=$(".bz-file-upload__input",e),this.$nativeFile=$(".bz-file-upload__native",e)},configureHandlers:function(){this.checkFileExtensions(),this.attachEvents()},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-readonly-lists",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()}))}))},saveImage:function(){var e="";this.editedImageURL?e=this.editedImageURL:this.fileProperties&&(e=this.fileProperties.url);var t={dataFile:bizagi.util.media.getImagePath(e),fileName:this.fileProperties.name,mimeType:"image/jpeg"};return this.editedImageURL=null,this.fileProperties=null,this.uploadFile(t)},saveVideo:function(e){var t={dataFile:e[0].fullPath,fileName:e[0].name,mimeType:"video/quicktime"};return this.uploadFile(t)},uploadFile:function(e){var t=this,i={},a=t.buildAddParams();return a.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),a.xPath=a.xPath,a.Filename=e.fileName,i.data=a,i.options=new FileUploadOptions,i.options.fileKey="file",i.options.fileName=e.fileName,i.options.uploadKey={key:"Filedata"},i.options.addUrl=t.properties.addUrl,i.dataFile=e.dataFile,e.mimeType&&(i.options.mimeType=e.mimeType),$.when(bizagi.util.media.uploadFile(i)).then((function(e){t.onUploadFileCompleted(JSON.parse(decodeURIComponent(e.response)))})).fail((function(e){t.executeFormFailHandler(e)}))},attachEvents:function(){var e=this,t=e.getControl();$.each(e.files,(function(t,i){e.attackMenuEvents(i)})),this.$contentFile.off("click").on("click",(function(t){e.chooseFile()})),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()}))})),e.isNative?(this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-file-upload__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.handlerResolutionUpload(t.guid)).always((function(){bizagi.loading.stop()}))},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})):(this.$inputFile.off("change").on("change",(function(){e.addFile(),this.value=""})),this.$inputFile.off("click").on("click",(function(e){e.stopPropagation()})))},addMenuEvents:function(e,t){var i=this,a=e.find(".bz-file-menu"),r=[];t.showMetadata&&r.push({name:i.getResource("render-collection-navigator-details-form"),fn:function(){i.processActionByType(i.Class.ACTION_DETAILS,t,e)}}),t.showMetadata&&t.allowUpdateMetadata&&r.push({name:i.getResource("render-collection-navigator-edit-form"),fn:function(){i.processActionByType(i.Class.ACTION_EDIT,t,e)}}),t.allowCheckOut&&r.push({name:i.getResource("render-ecm-bt-lock"),fn:function(){i.lockECMFile(e,t)}}),t.allowCancelCheckOut&&r.push({name:i.getResource("render-ecm-bt-unlock"),fn:function(){i.unlockECMFile(e,t)}}),t.allowDelete&&r.push({name:i.getResource("render-ecm-bt-delete"),fn:function(){i.deleteECMFile(e,t.idFileUpload)}}),a.overflowMenu({items:r})},deleteECMFile:function(e,t){var i=this;bizagi.showConfirmationBox(this.getResource("render-ecm-confirm-message")).done((function(){$.when(i.deleteUploadItem(e,t)).done((function(){e.hide(),e.remove(),i.setValue(i.files,!1),i.checkMaxFiles(),i.triggerRenderChange()}))}))},checkMaxFiles:function(){this.isMaxFilesReached()?$(this.$contentFile).addClass("bz-file-upload__container--hidden"):$(this.$contentFile).removeClass("bz-file-upload__container--hidden")},isMaxFilesReached:function(){var e=this.properties.maxfiles,t=this.properties.value?this.properties.value.length:0;return 0!==e&&this.filesCount>=e&&t>=e},executeFormFailHandler:function(e){var t="";t=e&&e.code===this.Class.ERROR_ECM_NO_AVAILABLE?this.getResource("render-ecm-service-not-available"):e&&e.responseText?e.responseText:this.getResource("render-ecm-service-general-error"),this.getFormContainer().failHandler(t)},lockECMFile:function(e,t){var i=this;$.when(i.lockUploadItem(t.idFileUpload)).done((function(a){var r=[a.idFileUpload,t.fileName],n=i.renderUploadItem(r);e.replaceWith(n),i.attackMenuEvents(r)}))},unlockECMFile:function(e,t){var i=this;$.when(i.unlockUploadItem(t.idFileUpload)).done((function(a){var r=[a.idFileUpload,t.fileName],n=i.renderUploadItem(r);e.replaceWith(n),i.attackMenuEvents(r)}))},chooseFile:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&this.$inputFile.click()},checkFileExtensions:function(){var e=this.properties.validExtensions||"";if(this.validOptions={video:!1,image:!1,file:!1},void 0===(e=e.replace(/\s+/g,"").toLowerCase())||""===e)this.validOptions={video:!0,image:!0,file:!0};else if(1===(e=e.split(";")).length&&-1!==e[0].indexOf("*.*"))this.validOptions.video=!0,this.validOptions.image=!0;else for(var t=0,i=e.length;t<i;t++)e[t]=e[t].replace("*.",""),this.Class.EXTENSIONSFILE.toString().indexOf(e[t])>=0?this.validOptions.file=!0:this.Class.EXTENSIONSIMG.toString().indexOf(e[t])>=0?this.validOptions.image=!0:this.Class.EXTENSIONSVIDEO.toString().indexOf(e[t])>=0&&(this.validOptions.video=!0);this.validOptions.file||this.validOptions.image||this.validOptions.video||$(this.$contentFile).addClass("bz-file-upload__container--hidden"),(this.isMaxFilesReached()||!this.isNative&&!bizagi.util.media.fileAPISupported())&&$(this.$contentFile).addClass("bz-file-upload__container--hidden")},getUploadChoices:function(){var e=[];return this.validOptions.image&&(e.push({guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}),e.push({guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")})),this.validOptions.video&&e.push({guid:3,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-video")}),[].concat(e)},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture((function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then((function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i)){if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then((function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.handlerResolutionUpload(e)}));$(".bz-file-upload__resolution",t.getControl()).click()}}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY});break;case 1:navigator.camera.getPicture((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then((function(i){return t.fileProperties=i,t.saveImage(e)}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;case 3:navigator.device.capture.captureVideo((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).then((function(){return t.saveVideo(e)})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{limit:t.Class.LIMIT})}},onFail:function(e){var t=bizagi.util.processFailMessage(e);if(bizagi.loading.stop(),t&&"string"==typeof t&&-1!==t.indexOf("No Activity found to handle Intent")){var i=bizagi.util.isValidResource("render-upload-error-media-app")?bizagi.localization.getResource("render-upload-error-media-app"):"Your device does not have an app to execute this action.";self.performValidationMessage(i)}},performValidationMessage:function(e){var t=bizagi.util.processFailMessage(e);bizagi.showMessageBox(t)},handlerResolutionUpload:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.saveImage(t.dataImage);var a=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,a)).then((function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.saveImage(t.dataImage)}))},addFile:function(){var e=this,t=this.$inputFile[0].files[0],i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSFILE,e.Class.EXTENSIONSVIDEO);t.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.processUploadFile(t)).done((function(t){bizagi.util.isFailResponse(t)?e.performValidationMessage(t):e.onUploadFileCompleted(JSON.parse(decodeURIComponent(t)))})).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()})):bizagi.loading.stop()},buildAddFileParams:function(e){var t=this.Class.BA_CONTEXT_PARAMETER_PREFIX,i=new FormData,a=this.getFormContainer(),r=this.buildAddParams();Object.keys(r).map((function(e){i.append(e,r[e])})),i.append("Filedata",e),i.append("Filename",e.name.substr(e.name.replace(/([\\\/]+)/g,"/").lastIndexOf("/")+1)),i.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",a.properties.sessionId),this.properties.contexttype&&i.append(t+"contexttype",this.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?i.append(BIZAGI_SESSION_NAME,a.properties.sessionId):i.append("JSESSIONID",a.properties.sessionId)}catch(e){i.append("JSESSIONID",a.properties.sessionId)}return i},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},onUploadFileCompleted:function(e){var t=$(".bz-files",this.getControl());if(e.idFileUpload&&e.fileName){var i=[e.idFileUpload,e.fileName],a=this.renderUploadItem(i);t.append(a);var r=this.files.slice();r.push(i),this.setValue(r,!0),this.checkMaxFiles(),this.attackMenuEvents(i),this.editedImageURL=null}else this.performValidationMessage(e.message)},attackMenuEvents:function(e){var t=this,i=t.getControl();e&&e.getFileProperties&&$.when(e.getFileProperties).done((function(e){var a=$("."+t.properties.id+"-"+e.idFileUpload,i);t.fileData[e.idFileUpload]=e.metadata||[],t.addMenuEvents(a,e)}))},processActionByType:function(e,t,i){var a=this,r=a.properties,n=a.getFormContainer();bizagi.loading.start(),new bizagi.rendering.tablet.slide.ecm(a.dataService,a.renderFactory,{title:a.properties.displayName||"",container:n.container,navigation:a.getParams().navigation,editable:r.editable&&e!==a.Class.ACTION_DETAILS,orientation:r.orientation||"ltr",onSave:function(e){if(e.update){var t=[e.idFileUpload,e.fileName],r=a.renderUploadItem(t);i.replaceWith(r),a.attackMenuEvents(t)}},onCancel:function(){}}).render({metadata:t.metadata,fileData:t}).always((function(){bizagi.loading.stop()}))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.searchList",bizagi.rendering.searchList.prototype),bizagi.rendering.tablet.searchList.extend("bizagi.rendering.tablet.searchList",{SEARCH_MIN_LENGTH:2,SEARCH_MAX_RECORDS:50,SEARCH_DELAY:250,SEARCH_ELEMENTS:{}},{renderControl:function(){var e=this,t=e.properties,i=e.renderFactory.getTemplate("searchList");return $.fasttmpl(i,{id:t.id,value:t.value.map((function(t){return e.formatItem(t.value)})).join(", ")})},postRender:function(){this.searchListInput=$(".bz-search-list__input",this.getControl())},postRenderReadOnly:function(){this.searchListInput=$(".bz-search-list__input",this.getControl())},renderReadOnly:function(){var e=this.renderFactory.getTemplate("searchList.readonly");return $.fasttmpl(e,{items:this.properties.value||{},editable:this.properties.editable||!0},{formatItem:this.formatItem})},configureHandlers:function(){var e=this;e.searchListInput.on("click",(function(t){($(t.target).parent()||{}).hasClass("bz-pill")||e._searchListViewModal()}))},_searchListViewModal:function(){var e=this,t=e.getHeaderTemplate(),i=e.getContentTemplate(),a=e.getFooterTemplate();e.searchListInput.mobileView({customHeader:t,orientation:e.properties.orientation||"",cssClassHeader:"bz-modal-view__header-multiple",contentTemplate:i,footerTemplate:a,style:"width: 80%; height: 70%",close:function(){$(window).unbind("resize"),e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.adjustResize(),e.configureModalViewHandlers(t)}})},setDisplayValue:function(e){var t=this,i="string"==typeof e?JSON.parse(e).value:e.value;t.setValue(i),void 0!==e&&t.properties.editable&&t.searchListInput.html(i.map((function(e){return t.formatItem(e.value)})).join(", "))},deleteItem:function(e){var t=e.parent("div");this.removeElement({id:t.data("id")}),t.remove()},selectItem:function(e){var t=this.getTagTemplate(e,this.properties.editable);this.modalViewTagList.append(t)},configureModalViewHandlers:function(e){var t=this,i=e.footer,a=e.header,r={};if(t.hasValue()){var n=t.getListItems();$.each(n,(function(e,t){r[t.id]=t}))}t.modalViewList=$(".bz-list",e.content),t.modalViewTagList=$(".bz-search-pill__results",a);var o=$(".bz-modal-view__clear",a),l=$(".bz-modal-view__search",a),s=bizagi.util.debounce((function(){""===this.value?o.removeClass("bz-modal-view__clear--visible"):o.addClass("bz-modal-view__clear--visible"),t.autoCompleteSearchResults($.trim(this.value))}),this.Class.SEARCH_DELAY);l.on("change keyup",s).on("focus",(function(){$(".bz-search__header",e.header).addClass("bz-search__header--active")})).on("blur",(function(){$(".bz-search__header",e.header).removeClass("bz-search__header--active")})),o.bind("click",(function(){l.val("").trigger("change")})),$("[data-action=close]",e.header).bind("click",(function(){e.close()})),t.modalViewList.on("click","li",(function(){var e=$.data(this).item;!e||e&&r[e.id]||(r[e.id]=e,$(i).find(".bz-btn").removeClass("bz-btn--secundary"),$(i).find(".bz-btn").addClass("bz-btn--primary"),1===(Object.keys(r)||[]).length&&$(a).find(".bz-search-pill__selected ").removeClass("bz-search-pill__selected--hidden"),t.selectItem(e))})),t.modalViewTagList.on("click",".bz-pill > .bz-btn-icn",(function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parent("div");$(i).find(".bz-btn").removeClass("bz-btn--secundary"),$(i).find(".bz-btn").addClass("bz-btn--primary"),delete r[t.data("id")],t.remove(),0===(Object.keys(r)||[]).length&&$(a).find(".bz-search-pill__selected ").addClass("bz-search-pill__selected--hidden")})),$(i).delegate("[data-action=save]","click",(function(i){var a=[];$.each(r,(function(e,t){a.push(t)})),t.setDisplayValue({value:a}),e.close()}))},autoCompleteSearchResults:function(e){var t=this;$.when(t.processRequest({term:e})).done((function(e){t.modalViewList.find("li").remove();for(var i=0,a=e.length;i<a;i++){t.renderSearchItem(e[i]).appendTo(t.modalViewList)}}))},renderSearchItem:function(e){var t=this.renderFactory.getTemplate("searchList.item"),i=$.tmpl(t,{id:e.id,label:e.label,value:this.formatItem(e.value)});return i.data("item",e),i},processRequest:function(e){var t=this,i=t.properties,a=new $.Deferred,r=[];return e.term.length>=this.Class.SEARCH_MIN_LENGTH?(i.term=e.term,t.deferredReference&&"function"==typeof t.deferredReference.reject&&"resolved"!==t.deferredReference.state()&&t.deferredReference.reject({hideStatus:!0}),t.deferredReference=t.getData().done((function(n){n&&n.length>0?((n=n.slice(0,i.maxRecords)).length>t.Class.SEARCH_MAX_RECORDS?(n=n.slice(0,t.Class.SEARCH_MAX_RECORDS),r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-search-maximum-records-allowed"),value:""})):n=n.slice(0,i.maxRecords),$.each(n,(function(t,a){if(0===i.maxRecords||t<i.maxRecords){var n=bizagi.util.performTermMatches(a.value,e.term);r.push({id:a.id,label:n,value:a.value})}}))):r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-grid-no-records"),value:""}),a.resolve(r)})).fail((function(){a.reject()}))):a.resolve(r),a.promise()},getContentTemplate:function(){var e=this.getValue(),t="string"==typeof e?JSON.parse(e).value:e.value,i=this.renderFactory.getTemplate("searchList.items"),a=$.fasttmpl(i,{items:t||{},editable:this.properties.editable||!0},{formatItem:this.formatItem});return $.trim(a)},getFooterTemplate:function(){var e=this.renderFactory.getTemplate("searchList.actions"),t=$.fasttmpl(e,{items:this.properties.value||{},editable:this.properties.editable||!0});return $.trim(t)},getTagTemplate:function(e,t){var i=this.renderFactory.getTemplate("searchList.tag"),a=$.fasttmpl(i,{id:e.id,label:e.label,value:this.formatItem(e.value),editable:t});return $.trim(a)},adjustResize:function(){var e=window.innerHeight;$(window).off("resize").on("resize",bizagi.util.debounce((function(){$(this).height()<e?$(".bz-mobile-view__footer_content").addClass("bz-hidden"):$(".bz-mobile-view__footer_content").removeClass("bz-hidden")}),this.Class.SEARCH_DELAY))},getHeaderTemplate:function(){var e=this.getValue(),t="string"==typeof e?JSON.parse(e).value:e.value,i=this.renderFactory.getTemplate("searchList-modal-header"),a=$.fasttmpl(i,{items:t||{},editable:this.properties.editable||!0,emptyItems:0===(t||[]).length},{formatItem:this.formatItem});return $.trim(a)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.userfieldWrapper",bizagi.rendering.userfieldWrapper.prototype),bizagi.rendering.tablet.userfieldWrapper.extend("bizagi.rendering.tablet.userfieldWrapper",{},{getUserfieldControl:function getUserfieldControl(){var self=this,sControl=self.userfieldName,mode=self.getMode(),exists=eval("typeof bizagi.rendering.tablet."+sControl+" !== 'undefined'"),def=new $.Deferred;return exists?$.when(self.parent.ready()).done((function(){def.resolve(self.createUserfieldInstance(sControl))})):"execution"!=mode?setTimeout((function(){$.when(self.triggerGlobalHandler("loadUserField",{userfield:self.userfieldGuid,device:"Tablet"})).pipe((function(e){e&&def.resolve(self.createUserfieldInstance(sControl))}))}),10):$.when(self.dataService.getUserfieldDefinition({userfield:self.userfieldGuid,device:"tablet"})).pipe((function(e){self.loadUserfield(e),def.resolve(self.createUserfieldInstance(sControl))})),def.promise()},createUserfieldInstance:function createUserfieldInstance(sControl){var self=this,control;try{var dynamicFunction="var baDynamicFn = function(renderParams){ \r\n";dynamicFunction+="return new bizagi.rendering.tablet."+sControl+"(renderParams);\r\n",dynamicFunction+="}\r\n",dynamicFunction+="baDynamicFn",dynamicFunction=eval(dynamicFunction),control=dynamicFunction(self.initialParams)}catch(e){control=self.getUserFieldInstance(self.initialParams)}return control.properties.isUserField=!0,self.userfieldInstance=control,self.replicateUserfieldMethods(control),self.userfieldInstance.bind("renderchange",(function(){self.triggerHandler("renderchange",arguments)})),control},loadUserfield:function loadUserfield(data){var self=this,styleContent="";self.properties.styleGuid=self.properties.styleGuid||Math.guid();try{try{data=eval(data)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}$.each(data,(function(e,t){if("js"===t.type)try{t.content=t.content.replace(/bizagi\.rendering\.[^\s]+\.extend(\s|\n|\s)*\((\s|\n|\s)*\"bizagi\.rendering\.[^\s]+\"/gim,(function(e){return e.replace(/bizagi.rendering/gi,"bizagi.rendering.tablet")})),window.eval(t.content)}catch(e){bizagi.log("Could not parse result userfield3 "+self.userfieldName,e.message)}"css"===t.type&&(styleContent+=t.content)})),""!==$.trim(styleContent)&&bizagi.util.loadStyle(styleContent,self.properties.styleGuid);var control=eval("bizagi.rendering."+self.userfieldName)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}},getUserFieldInstance:function(e){return"execution"===this.getMode()?new bizagi.rendering.tablet.defaultUserField(e):new bizagi.rendering.tablet.designUserField(e)},startUserfieldLoading:function(){this.element.addClass("bz-form-userfield__loader")},endUserfieldLoading:function(){this.element.removeClass("bz-form-userfield__loader")}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.basicUserField",bizagi.rendering.userfieldDefinition.prototype),bizagi.rendering.tablet.basicUserField.extend("bizagi.rendering.tablet.basicUserField",bizagi.rendering.basicUserField.prototype),bizagi.rendering.tablet.basicUserField.extend("bizagi.rendering.tablet.basicUserField",{},{init:function(e){(this._super(e),this.isSupported())||this.getFormContainer().addError(this.getResource("render-tablet-error-userfield"))},getEditableControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getEditableControl.apply(this,arguments)},getReadonlyControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getReadonlyControl.apply(this,arguments)},isSupported:function(){return!0}}),bizagi.rendering.tablet.basicUserField.extend("bizagi.rendering.tablet.defaultUserField",{},{getEditableControl:function(){var e=this.getControl(),t=this.properties.control.replace(/column/g,"");return this.input=$("<label>Userfield: "+t+" not found</label>").appendTo(e),this.input.addClass("ui-bizagi-render-userfield-notSupported"),this.input},getReadonlyControl:function(){return this.getEditableControl()},collectData:function(e){}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.image.prototype),bizagi.rendering.tablet.image.extend("bizagi.rendering.tablet.image",{QUALITY_PICTURE:80,EXTENSIONSIMG:["jpeg","jpg","png"]},{$inputFile:null,isNative:!1,isOfflineForm:!1,initializeData:function(e){if(this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported(),this.isOfflineForm){var t=Number(this.properties.maxSize)||1048576,i="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=t<i?t:i}},renderControl:function(){var e=this.renderFactory.getTemplate("image");return $.fasttmpl(e,{url:""})},getElementsToStylize:function(e){return $({})},renderReadOnly:function(){var e=this,t=this.renderFactory.getTemplate("image-readonly");return e.buildItemUrl().then((function(i){var a=i||"";if(!e.isDisposed())return e.properties.url=a,$.fasttmpl(t,{url:e.properties.url})}))},postRender:function(){var e=this.getControl();this.$inputFile=$(".bz-image__input",e),this.$nativeFile=$(".bz-image__native",e),this.isDesignMode()||this.showAsyncImage()},configureHandlers:function(){var e=this;this.getControl().on("click","[data-action=upload]",(function(t){e.choosePhoto()})),this.isNative?e.configureNativeHandlers():e.configureHybridHandlers()},configureNativeHandlers:function(){var e=this,t=this.getControl();this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){switch(t.guid){case 1:e.imageAdd();break;case 2:e.imageAdd(!0)}},appear:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-image__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),e.resolutionButtonHandler(t.guid).always((function(){bizagi.loading.stop()}))},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})},configureHybridHandlers:function(){var e=this;this.$inputFile.off("change").on("change",(function(){e.imageAdd(),this.value=""})),this.$inputFile.off("click").on("click",(function(e){e.stopPropagation()}))},configureHandlersReadOnly:function(){var e=this;this.getControl().off("click").on("click",".bz-image",(function(){e.imagePreview()}))},imageAdd:function(e){this.isNative?this.imageAddNative(e):this.imageAddHybrid()},imageAddHybrid:function(){var e=this.Class.EXTENSIONSIMG,t=this.$inputFile[0].files[0];t.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,this.properties)&&bizagi.util.media.checkFileTypes(t,this.properties,e)?this.performUploadFile(t).always((function(){bizagi.loading.stop()})):bizagi.loading.stop()},imageAddNative:function(e){var t=this,i={quality:t.Class.QUALITY_PICTURE,targetWidth:1280,targetHeight:960,correctOrientation:!0};if(!e){var a=t.getControl()[0].getBoundingClientRect();i={quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,popoverOptions:new CameraPopoverOptions(a.left,a.top-20,200,100,4),destinationType:navigator.camera.DestinationType.FILE_URI,correctOrientation:!0}}navigator.camera.getPicture((function(e){return t.imageAddNativeFromCamera(e)}),(function(){bizagi.loading.stop()}),i)},imageAddNativeFromCamera:function(e){var t=this;bizagi.loading.start(),bizagi.util.media.checkMaxSize(e,t.properties).then((function(){return bizagi.util.media.getFileDataInfo(e)})).then((function(i){if(bizagi.util.media.checkFileTypes(i,t.properties,t.Class.EXTENSIONSIMG)){t.dataImage=e,t.fileProperties=i;var a=bizagi.util.getAndroidVersion();if(a&&a<=4.2||t.isOfflineForm)t.performUploadFile(t.dataImage).always((function(){bizagi.loading.stop()}));else{if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then((function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.resolutionButtonHandler(e)}));$(".bz-image__resolution",t.getControl()).click()}}})).always((function(){bizagi.loading.stop()}))},imageDelete:function(){var e=this;return bizagi.loading.start(),e.dataService.deleteImage({url:e.properties.deleteUrl,idRender:e.properties.id,xpath:e.properties.xpath,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,contexttype:e.properties.contexttype}).then((function(){e.properties.value=[],e.uploadFileCompleted()})).fail((function(t){var i,a=t.responseText;try{i=(i=JSON.parse(a)).message||a}catch(e){i=a}e.setValidationMessage(i)})).always((function(){bizagi.loading.stop()}))},uploadFile:function(e){if(this.properties.isChanged=!0,!this.isOfflineForm)return this.isNative?this.uploadFileNativeOnline(e):this.uploadFileHybridOnline(e);bizagi.util.isEmpty(this.properties.value)&&(this.properties.value=[[null,null]]);var t=null!=this.fileProperties?this.fileProperties.name:e.name;return this.dataService.fileService.changeOfflineImageName(this.properties.value,t),this.saveImageOffline(e)},uploadFileNativeOnline:function(){var e={},t=this.buildAddParams(),i=this.fileProperties.name;return this.editedImageURL?e.dataFile=this.editedImageURL:this.fileProperties&&(e.dataFile=this.fileProperties.url),t.queueID="q_"+bizagi.util.encodeXpath(this.getUploadXpath()),e.data=t,e.options=new FileUploadOptions,e.options.fileKey="file",e.options.fileName=i,e.options.mimeType="image/jpeg",e.options.uploadKey={key:t.h_xpath},e.options.addUrl=this.properties.addUrl,this.editedImageURL=null,this.fileProperties=null,e.dataFile=bizagi.util.media.getImagePath(e.dataFile),$.when(bizagi.util.media.uploadFile(e)).then((function(e){var t=JSON.parse(decodeURIComponent(e.response));return"error"===t.type?$.Deferred().reject(t).promise():t}))},uploadFileHybridOnline:function(e){return bizagi.util.media.checkMaxSizeFile(e,this.properties)&&bizagi.util.media.checkFileTypes(e,this.properties,this.Class.EXTENSIONSIMG)?this.dataService.processUploadFile({url:this.properties.addUrl,formData:this.buildAddFileParams(e)}):$.Deferred().reject().promise()},uploadFileCompleted:function(){try{this.showAsyncImage(),this.editedImageURL=null}catch(e){this.getFormContainer().refreshForm()}},showAsyncImage:function(){var e=this,t=e.getControl(),i=$(".bz-input-icon",t);e.renderUploadItem().then((function(t){if(!e.isDisposed()){i.empty(),i.append(t);var a=e.hasValue()?"update":"upload";i.attr("data-action",a),e.hasValue()&&e.configureMenu()}}))},resolutionButtonHandler:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.performUploadFile(t.dataImage);var a=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,a)).then((function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.performUploadFile(t.dataImage)}))},imagePreview:function(){var e=this,t=e.getParams(),i=t.navigation.createRenderContainer({title:e.properties.displayName,view:{zoom:!0,useNativeScrolling:!1}}),a=e.renderFactory.getTemplate("image-preview"),r={url:e.properties.url&&""!==e.properties.url?e.properties.url:""},n=$.fasttmpl(a,r);i.element.css("display","none"),e.inputEdition=i.element.html(n),t.navigation.navigate(i.id),bizagi.loading.start();var o=this.formCompatibilityVersion>=2?function(){return r.url}:e.buildFullItemUrl.bind(e);$.when(o()).then((function(t){if(i.element.css("display","block"),t.indexOf("error")<0){var a=$(".bz-image__preview-item:first",i.element).attr("src",t),r=a.css("width");r=Number(r.substring(0,r.length-2)),-1!==e.properties.width&&e.properties.width<r&&a.css("width","100%")}})).always((function(){bizagi.loading.stop()}))},buildAddFileParams:function(e){var t=this.properties,i=this.Class.BA_CONTEXT_PARAMETER_PREFIX,a=new FormData,r=this.getFormContainer();a.append(i+"xpath",t.xpath),a.append(i+"idRender",t.id),a.append(i+"xpathContext",t.xpathContext),a.append(i+this.Class.BA_PAGE_CACHE,t.idPageCache),a.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId),a.append(i+"action","savefile"),a.append(this.properties.xpath,e),t.contexttype&&a.append(i+"contexttype",t.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?a.append(BIZAGI_SESSION_NAME,r.properties.sessionId):a.append("JSESSIONID",r.properties.sessionId)}catch(e){a.append("JSESSIONID",r.properties.sessionId)}return a},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},performUploadFile:function(e){var t=this;return $.when(t.uploadFile(e)).then((function(){bizagi.util.isEmpty(t.properties.value)&&(t.properties.value=[[0,"uploaded"]]),t.uploadFileCompleted()})).fail((function(e){t.executeFormFailHandler(e)}))},choosePhoto:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&this.$inputFile.click()},configureMenu:function(){var e=this,t=[],i=this.getControl(),a=$(".bz-input-icon__input + .bz-icn",i),r=!e.isOfflineForm&&(e.properties.allowDelete&&e.properties.editable);t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-image-preview"),fn:function(){e.imagePreview()}}),t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo"),fn:function(){e.choosePhoto()}}),r&&t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-remove-photo"),fn:function(){bizagi.showConfirmationBox(e.getResource("render-grid-delete-confirmation")).then((function(){e.imageDelete()}))}}),a.overflowMenu({items:t})},getUploadChoices:function(){return[{guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")},{guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}]},buildItemUrl:function(e){return this.isOfflineForm?this.buildItemUrlOffline():this.buildItemUrlOnline(e)},buildItemUrlOffline:function(){var e=this;return bizagi.util.sleepUntil((function(){return!e.dataService.getFileService().isLoading(e)})).then((function(){return bizagi.rendering.image.prototype.buildItemUrlOffline.apply(e,arguments)}))},buildItemUrlOnline:function(){var e=this;return bizagi.rendering.image.prototype.buildItemUrl.apply(this,arguments).then((function(t){return e.formCompatibilityVersion<2&&(t.length>0?e.properties.value=[[0,"uploaded"]]:e.properties.value=[]),t}))},collectData:function(e){if(this.isOfflineForm&&bizagi.util.isOfflineFormsV2Supported()){if(!this.properties.isChanged)return;var t=this.properties.xpath;bizagi.util.isEmpty(t)||(e[t]={offlineId:this.buildOfflineImageId(),name:this.dataService.fileService.getOfflineImageName(this.getValue())})}},cleanData:function(){if(this.hasValue())return $.when(this.imageDelete())},hasValue:function(){var e=!1;return(this.properties.value||[]).length>0&&(e=!0),e}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.document",bizagi.rendering.document.prototype),bizagi.rendering.tablet.document.extend("bizagi.rendering.tablet.document",{ACTION_SHOW:"show",ACTION_DOWNLOAD:"download",ACTION_DELETE:"delete"},{renderControl:function(){var e=this.renderFactory.getTemplate(this.getTemplate()),t=this.properties.value||[],i={downloadalldocuments:this.properties.downloadalldocuments,allowgenerate:this.properties.allowGenerate,noFiles:!t||0===t.length,append:this.properties.append,caption:this.properties.caption},a=$.fasttmpl(e,i),r=this.renderDocumentsHtml(t);a=this.replaceFilesHtml(a,r);var n=this.renderActionsHtml(t,i.noFiles,i.downloadalldocuments);return a=this.replaceActionsHtml(a,n)},postRender:function(){var e=this.getControl();this.$inputDocument=$(".bz-document-template__container",e),this.$listDocuments=$("[data-component=files]",e),this.$listActions=$("[data-component=actions]",e),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate(this.getTemplateReadonly()),t=this.properties.value||[],i=!t||0===t.length,a=$.fasttmpl(e,{noFiles:i}),r=this.renderDocumentsHtml(t);return a=this.replaceFilesHtml(a,r)},postRenderReadOnly:function(){var e=this.getControl();this.$listDocuments=$("[data-component=files]",e)},configureHandlers:function(){var e=this;this.$inputDocument.on("click",(function(t){e.properties.buttonExecuted=!0,e.properties.validate?e.validateContainer()&&e.documentTemplateGenerate():e.documentTemplateGenerate(),e.properties.buttonExecuted=!1})),this.$listDocuments.on("click","[data-action]",(function(t){var i=$(this),a=i.parent(".bz-document").data(),r=i.data("action");e.processAction(r,a)})),e.$listActions.on("click","[data-action]",(function(t){var i=$(this),a=i.parent(".bz-document__download").data(),r=i.data("action");e.processAction(r,a)}))},configureHandlersReadOnly:function(){var e=this;this.$listDocuments.on("click","[data-action]",(function(t){var i=$(this),a=i.parent(".bz-document").data(),r=i.data("action");e.processAction(r,a)}))},renderAllDocumentDownload:function(e){var t=this.renderFactory.getTemplate(this.getTemplateDownload()),i=this.buildAllDocumentsUrl();return this.isExecutionMode()||(i="javascript:void(0);"),$.fasttmpl(t,{url:i,filename:e.fileName,joined:!0})},redrawDocuments:function(e,t,i){var a=this.getControl(),r=$("[data-component='files']",a),n=$("[data-component='actions']",a);r.empty(),n.empty();var o=this.renderDocumentsHtml(e);r.append(o);var l=this.renderActionsHtml(e,t,i);n.append(l),this.setValue(e)},showDocumentPreview:function(e,t){var i=this;bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(e,t)).fail((function(e){e.responseText&&i.getFormContainer().failHandler(e.responseText)})).always((function(){bizagi.loading.stop()}))},resolveDocumentTemplateGenerate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e},resolveDeleteDocumentTemplate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e},processAction:function(e,t){e===this.Class.ACTION_DELETE?this.deleteDocumentTemplate(t.filename):e===this.Class.ACTION_SHOW?this.showDocumentPreview(t.url,t.filename):e===this.Class.ACTION_DOWNLOAD&&this.showDocumentPreview(t.url,t.filename)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.geolocation",bizagi.rendering.geolocation.prototype),bizagi.rendering.tablet.geolocation.extend("bizagi.rendering.tablet.geolocation",{ALLOW_UPDATE:"update"},{postRender:function(){var e=this.getControl();this.coordinate=e.find("input"),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.coordinate=e.find("input"),this._super()},configureHandlers:function(){var e=this.getControl();null==this.value&&this.updateDisplayValue(),e.on("click","[data-action="+this.Class.ALLOW_UPDATE+"]",this.processAction.bind(this))},setDisplayValue:function(e){var t=this,i=new $.Deferred;if(null!=e&&""!==e)t.coordinate&&t.coordinate.val(t.performPrecision(e)),t.setValue(e,!1),i.resolve();else{var a=function(e){var a=e.coords.latitude+" "+e.coords.longitude;t.coordinate.val(t.performPrecision(a)),t.setValue(a,!1),i.resolve()},r=function(e){i.reject(e)};bizagi.util.isCordovaSupported()&&bizagi.util.isiOSDevice()?navigator.geolocation.getCurrentPosition(a,r):t.getCurrentPosition(a,r)}return i.promise()},updateDisplayValue:function(){var e=this;e.setDisplayValue().then((function(){e.setValidationMessage("")})).fail((function(t){e.coordinate.val(""),e.setValidationMessage(t)}))},processAction:function(){this.coordinate.empty(),this.updateDisplayValue()},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".readonly-control",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.actionLauncher",bizagi.rendering.actionLauncher.prototype),bizagi.rendering.tablet.actionLauncher.extend("bizagi.rendering.tablet.actionLauncher",{},{postRender:function(){if("design"!=this.getMode()){var e=this,t=e.properties,i=e.getControl();e.actions=[],e.startLoading(),$.when(e.dataService.multiaction().getActions(e.processPropertyValueArgs)).then((function(a){return a=e.getPropertiesActionLaucher(a),e.actions=a,e.deferredActions.resolve(a),e.actions.length>0?$("[data-element='actions-add-btn']",i).show():$("[data-element='actions-add-btn']",i).hide(),t.isHorizontal?"none"!=t.templatetype?e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs).then((function(i){return e.engine.render($.extend(i,{isDefaultTemplate:"default"===t.templatetype,sessionId:e.properties.sessionId}),e.processPropertyValueDataTmplArgs)})).then((function(t){template=e.renderFactory.getTemplate("render-actionLauncher-horizontal");var i=$($.fasttmpl(template,{template:!0}));return $(".bz-template",i.wrap("<div>").parent()).append(t),i})):void 0:(template=e.renderFactory.getTemplate("render-actionLauncher-horizontal"),$.fasttmpl(template,{template:!1}))})).done((function(t){$("[data-element='template-container']",i).append(t),e.configureActionsHandlers(),e.configureTemplateHandlers()})).always((function(){e.endLoading()}))}},hasValue:function(){var e=this.getValue();return null!=e&&e.length>0},configureActionsHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",(function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],readOnlyForm:t[6]||!1,guidEntity:e.properties.guidEntity,xpathActions:e.properties.xpathActions||""};e.processAction(i)}));for(var i=[],a=0,r=e.actions.length;a<r;a++)i.push({guid:e.actions[a][0],displayName:e.actions[a][1]});$("[data-element='actions-add-btn']",t).actionSheet({actions:i,actionClicked:function(t){var i=e.actions.find((function(e){return e[0]==t.guid}));e.processAction({guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5],readOnlyForm:i[6]||!1,xpathActions:e.properties.xpathActions||""})}}),$.expr[":"].FilterAction=function(e,t,i){var a=i[3];return!!a&&new RegExp(a,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup((function(){var e=$(this).val();$(".action-launcher-control",t).show(),e&&$(".action-launcher-control",t).not(":FilterAction("+e+")").hide()}))},configureTemplateHandlers:function(){var e=this,t=e.getControl();e.engine.subscribe("onLoadDataNavigation",(function(t,i){i.filters=[],e.triggerGlobalHandler("dataNavigation",i)})),$(".bz-template-more-or-less",t).bind("click",(function(){$(".bz-template",t).toggleClass("bz-template--collapsed")}))},processAction:function(e){var t=this,i=t.getControl(),a=t.properties;void 0===a.multipleSelection||a.multipleSelection?"Form"==e.actionType&&t.countSameActions(e)>=1&&!e.xpathContext?$(".action-to-execute-control[data-guidaction='"+e.guidAction+"'] label",i).click():$.when(t.actionManager(e)).done((function(e){t.executeAction(e)})):t.getValue().length>0?t.showConfirmationDialog(e):$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))},notifyExecution:function(e,t){"success"==e.response?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,a=t.getParams(),r=t.properties.additionalXpath.join(","),n=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,o=new $.Deferred,l=new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:a.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){return t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:l.form.properties.xpathContext,idPageCache:i.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(i){e.editMode||0!==t.countSameActions(e)||(e.idStartScope=i.IdScope),o.resolve(i.IdScope)}))},onCancel:function(e){}}),s={idForm:e.guidProcess,contextType:"start",idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?a.idWorkitem:void 0,additionalXpaths:r,xpathContext:n,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath};return"Form"===e.actionType&&(s.contextType="entitytemplate",s.xpathContext=void 0,s.guidEntity=e.guidEntity,s.rewriteContextType=!0),l.render(s),o.promise()},processActionFormCollection:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=t.properties.additionalXpath.join(","),n=new $.Deferred,o=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,l=""!==o?printf("%s[id=%s]",o,e.idEntity):o,s=""!==o?printf("%s[]",o):o,d=a.getParams();return new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:d.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(a){return e.editMode?t.dataService.multiaction().submitData({action:"SAVE",data:a,xpathContext:l,idPageCache:a.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(e){n.resolve(e.IdScope)})):t.dataService.addGridRecordData({idRender:i.id,xpathContext:o,contexttype:"start",idPageCache:a.idPageCache,submitData:a}).done((function(i){e.idStartScope=i.IdScope,e.idEntity=i.IdEntity,t.addActionToQueue(e),n.resolve(i.IdScope)}))},onCancel:function(e){}}).render({idForm:e.guidProcess,contextType:"start",idCase:d.idCase,additionalXpaths:r,xpathContext:e.editMode?l:s,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath}),n.promise()},processStartForm:function(e){var t=this,i=new $.Deferred;e=e||{};var a=t.getFormContainer().getParams();return new bizagi.rendering.tablet.startForm(t.dataService,t.renderFactory,{title:e.title||"",navigation:a.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(e){i.resolve(e.IdScope)}))}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?a.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),i.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.executeActionImmediately(e)}))}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.setValue([]),$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))}))},setDisplayValue:function(e){var t=this,i=t.getControl(),a=$("[data-element='actions-container']",i),r=t.renderFactory.getTemplate("render-actionLauncher-actions-to-execute");t.configureQueueVisibility(),$.when(t.deferredActions).done((function(i){$.each(e,(function(t,a){var r=function(e){var t=[];return $.each(i,(function(i,a){a[4]==e&&(t=a)})),t}(a.guidAction);e[t].displayName=r[1],e[t].guidProcess=r[0],e[t].actionType=r[3],e[t].xpathContext=r[5],e[t].readOnlyForm=r[6],e[t].params&&e[t].params.idStartScope&&(e[t].idStartScope=e[t].params.idStartScope),e[t].params&&e[t].params.idPageCache&&(e[t].idPageCache=e[t].params.idPageCache),e[t].params&&e[t].params.idEntity&&(e[t].idEntity=e[t].params.idEntity)})),e.length>0?$.when($.fasttmpl(r,{actions:e})).done((function(e){a.empty(),a.append(e);var i=$(".bz-actions-to-execute .bz-btn-icn",a),r=$("label",a);i.on("click",(function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)})),r.on("click",(function(){var e=$(this).parent(),i=e.data("actiontype"),a=e.data("guidprocess"),r=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),l=e.data("readonlyform")||!1,s=e.data("identity")||"",d=e.data("guidaction"),c=o||t.properties.xpathContext;switch(i){case"Process":r&&t.processStartForm({guidprocess:a,idStartScope:r,title:n,xpathContext:o,recordXpath:c});break;case"Form":var p={guidProcess:a,idStartScope:r,editMode:!0,xpathContext:o,readOnlyForm:l,idEntity:s,recordXpath:c};if(p.xpathContext)t.processActionFormCollection(p);else{p.xpathContext=void 0;var u={},g=t.value.filter((function(e){return e.guidAction==d}));g.length>0&&(u={actionType:"Form",contextType:"entitytemplate",guidEntity:t.properties.guidEntity||g[0].guidEntity}),t.processActionForm($.extend(p,u))}}}))})):a.empty()}))},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-action-launcher-actions-to-execute-container",e),i=$(".action-to-execute-label",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.tablet.actionLauncher.extend("bizagi.rendering.tablet.entityTemplate",{},{postRender:function(){if("design"!=this.getMode()){var e=this,t=e.properties,i=e.getControl();e.actions=[],e.configureQueueVisibility(),e.startLoading(),e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs).then((function(a){return e.engine.render(a,$.extend(e.processPropertyValueDataTmplArgs,{formParams:e.getFormParams()})).then((function(a){var r=e.renderFactory.getTemplate("render-actionLauncher-horizontal"),n=$($.fasttmpl(r,{template:!0}));return $(".bz-template",n.wrap("<div>").parent()).append(a),t.allowactions?e.dataService.multiaction().getActions(e.processPropertyValueArgs).then((function(t){return e.deferredActions.resolve(t),e.actions=t,e.actions.length>0?$("[data-element='actions-add-btn']",i).show():$("[data-element='actions-add-btn']",i).hide(),n})):n}))})).done((function(t){$("[data-element='template-container']",i).append(t),e.configureActionsHandlers(),e.configureTemplateHandlers()})).always((function(){e.endLoading()}))}},configureActionsHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",(function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],xpathActions:e.properties.xpathActions||""};"Form"===i.actionType&&(i.xpathContext=void 0,i.contextType="entitytemplate",i.guidEntity=e.properties.guidEntity),e.processAction(i)}));for(var i=[],a=0,r=e.actions.length;a<r;a++)i.push({guid:e.actions[a][0],displayName:e.actions[a][1]});$("[data-element='actions-add-btn']",t).actionSheet({actions:i,actionClicked:function(t){var i=e.actions.find((function(e){return e[0]==t.guid}));e.processAction({guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5]})}})},configureTemplateHandlers:function(){var e=this,t=e.getControl();e.engine.subscribe("onLoadDataNavigation",(function(t,i){i.filters=[],i.calculateFilters=i.calculateFilters||!0,e.triggerGlobalHandler("dataNavigation",i)})),$(".bz-template-more-or-less",t).bind("click",(function(){$(".bz-template",t).toggleClass("bz-template--collapsed")}))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.polymorphicLauncher",bizagi.rendering.polymorphicLauncher.prototype),bizagi.rendering.tablet.polymorphicLauncher.extend("bizagi.rendering.tablet.polymorphicLauncher",{},{postRender:function(){var e,t=this,i=t.properties;return"design"!=t.getMode()&&t.properties.surrogatedKey?(t.configureQueueVisibility(),$.when(t.dataService.multiaction().getPolymorphicActions(t.processPropertyValueArgs)).done((function(a){a=t.dataService.serializePolymorphicActions(a),t.totalActions=bizagi.clone(a);var r=bizagi.clone(a);t.lessActions=bizagi.clone(r);var n={actions:r,allowSearch:i.allowSearch,treeActionsList:t.getTreeItems(r)};e=t.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree");var o=t.getControl();$(".bz-polymorphic-launcher__constructors",o).append($.fasttmpl(e,n)),t.bindHandlers()}))):""},getTreeItems:function(e,t){var i=this,a="<ul>",r=i.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree-item");return e=e||{},t=t||1,$.each(e,(function(e,n){a+=$.fasttmpl(r,n),n.children&&(a+=i.getTreeItems(n.children,t+1))})),a+="</ul>"},bindHandlers:function(){var e=this,t=e.getControl();$(".bz-polymorphic-launcher__constructors li span",t).on("click",(function(){var t=$(this).parent(),i={guidEntity:t.data("guidentity"),guidObject:t.data("guidobject"),guidConstructor:t.data("guidconstructor"),displayName:t.data("display-name"),actionType:t.data("action-type"),xpathContext:t.data("xpathcontext")};e.onActionClicked(i)})),$.expr[":"].FilterAction=function(e,t,i){var a=i[3];return!!a&&new RegExp(a,"i").test($(e).text())},$("input[data-action=search]",t).keyup((function(){var e=$(this).val();$(".bz-polymorphic-launcher__constructors li",t).show(),e&&$(".bz-polymorphic-launcher__constructors li",t).not(":FilterAction("+e+")").hide()}))},onActionClicked:function(e){var t=this;$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))},notifyExecution:function(e,t){"success"==e?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=t.properties.additionalXpath.join(","),n=new $.Deferred,o=(e.xpathContext,a.getParams()),l=t.properties.recordXpath,s=new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:o.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){var a=i.idPageCache;return i.idPageCache=null,t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:s.form.properties.xpathContext,idPageCache:a,isOfflineForm:!1,isActionStartForm:!0}).done((function(i){e.editMode||0!=t.countSameActions(e)||(e.idStartScope=i.IdScope),n.resolve(i.IdScope)}))},onCancel:function(e){}});return s.render({idForm:e.guidObject,contextType:"entity",guidEntity:e.guidEntity,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?o.idWorkitem:void 0,additionalXpaths:r,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,recordXpath:l}),n.promise()},processStartForm:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=new $.Deferred,n=a.getParams();return e=e||{},new bizagi.rendering.tablet.startForm(t.dataService,t.renderFactory,{maximized:i.maximized,title:e.title||"",navigation:n.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==this.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return a.startLoading(),t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(e){a.endLoading(),r.resolve(e.IdScope)}))}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?n.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),r.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.executeActionImmediately(e)}))}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.setValue([]),$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))}))},setDisplayValue:function(e){var t=this,i=t.getControl(),a=$(".bz-polymorphic-launcher-constructors-to-execute-container",i),r=t.renderFactory.getTemplate("render-polymorphicLauncher-actions-to-execute");t.configureQueueVisibility(),$.when($.fasttmpl(r,{actions:e})).done((function(e){a.empty(),a.append(e);var i=$(".bz-pill .bz-btn-icn",a),r=$(".bz-pill__label",a);i.on("click",(function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)})),r.bind("click",(function(){var e=$(this).parent(),i=e.data("actiontype"),a=e.data("guidprocess"),r=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),l=e.data("identity")||"",s=e.data("guidentity"),d=o||t.properties.xpathContext;switch(i){case"Process":r&&t.processStartForm({guidprocess:a,idStartScope:r,title:n,xpathContext:o,recordXpath:d});break;case"Form":var c={guidProcess:a,idStartScope:r,editMode:!0,xpathContext:o,idEntity:l,guidEntity:s,guidObject:a};t.processActionForm(c)}}))}))},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-polymorphic-launcher-constructors-to-execute-container",e),i=$(".bz-polymorphic-launcher__title",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.checkList",bizagi.rendering.checkList.prototype),bizagi.rendering.tablet.checkList.extend("bizagi.rendering.tablet.checkList",{},{postRender:function(){this._super(),this.properties.unique=Math.ceil(1e3*Math.random()),this.properties.required=!0},configureHandlers:function(){var e=this;e._super(),$("input[type=checkbox]",e.getControl()).bind("change",(function(){var t=$(this).data("item-guid");e.onCheckListGroupChange(t,this.checked)}))},onCheckListGroupChange:function(e,t){var i,a=$.grep(this.properties.items,(function(t,i){return t.guid===e}));a&&a.length>0&&(i=a[0]),i.checked=t},clearDisplayValue:function(){$("input[type=checkbox]",this.getControl()).removeAttr("checked")},setDisplayValue:function(e){}}),bizagi.rendering.tablet.checkList.extend("bizagi.rendering.tablet.activityCheckList",{},{initializeData:function(e){this._super(e);var t=this.properties.activityDescription&&""!==this.properties.activityDescription?bizagi.localization.getResource("workportal-project-plan-activity-goal")+": "+this.properties.activityDescription:"";this.properties.displayName=""!==t?t:bizagi.localization.getResource("workportal-project-plan-activity-work-title"),this.properties.displayType="vertical"},postRender:function(){var e=this.getControl();this._super(),this.newItemName=$(".bz-checkList__input",e),this.addEditButton=$(".add-edit-item-button-checklist",e),this.cancelEditButton=$(".cancel-edit-item-button-checklist",e),this.additionalElements(),this.notifyLoadItems()},notifyLoadItems:function(){var e=this;setTimeout((function(){var t=e.properties.items.filter((function(e){return e.resolved})).length;bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!0,idActivity:e.properties.idActivity,itemsResolved:t,items:e.properties.items,progress:e.properties.activityWork})),bizagi.webpart.publish("onLoadDataItemsFromFormActivityPlan",{items:e.properties.items,activityWork:e.properties.activityWork})}),100)},additionalElements:function(){this.addEditButton&&this.addEditButton.length>0&&this.addEditButton.hide(),this.cancelEditButton&&this.cancelEditButton.length>0&&this.cancelEditButton.hide()},configureHandlers:function(){var e=this,t=e.getControl();this._super(),$("[data-action=add]",t).unbind("click").click((function(){var t=$(".bz-checkList__item.bz-checkList__item--selected",e.control);t.length<=0?e.prepareNewItem():$(".bz-checkList__input",t).focus()})),$("[data-action=delete]",e.control).bind("click",(function(){var t=this,i=bizagi.localization.getResource("workportal-widget-reports-confirm"),a=$(this).closest(".bz-checkList__item");a.addClass("ui-bizagi-to-remove"),$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){var i=$(t).closest(".bz-checkList__item").data("item-guid");e.deleteItem(i)})).fail((function(){a.removeClass("ui-bizagi-to-remove")}))})),$("label[data-action=edit-item]",e.control).bind("click",(function(){var t=$(this).closest(".bz-checkList__item"),i=t.data("item-guid"),a=t.data("item-position");e.selectItem(i,a)}))},selectItem:function(e){for(var t=0,i=this.properties.items.length;t<i;t++)this.properties.items[t].guid===e?this.properties.items[t].selected=!0:this.properties.items[t].selected=!1;this.repaintControl();var a=$(".bz-checkList__item.bz-checkList__item--selected",this.getControl()),r=$(".bz-checkList__input",a),n=r.val();r.focus(),r[0].setSelectionRange(n.length,n.length),this.addSelectedHandlers()},deleteItem:function(e){for(var t=0,i=this.properties.items.length;t<i;t++)if(this.properties.items[t].guid===e){this.properties.items.splice(t,1);break}this.setValue(this.properties.items),this.repaintControl(),this.addSelectedHandlers()},prepareNewItem:function(){var e=this,t={guid:Math.guid(),resolved:!1,name:"",selected:!0};e.properties.items.push(t),e.repaintControl(),e.newItemName.focus(),e.newItemName.blur((function(){var t=$(".bz-checkList__item.bz-checkList__item--selected",e.control);""===$(".bz-checkList__input",t).val()&&e.properties.items&&e.properties.items.length>=1&&""===e.properties.items.slice(-1)[0].name&&e.properties.items.pop()})),e.addSelectedHandlers(),e.newItemName.keypress((function(t){13==t.which&&(t.preventDefault(),e.addItem(),e.prepareNewItem())}))},addSelectedHandlers:function(){var e=this,t=$(".bz-checkList__item.bz-checkList__item--selected",e.control),i=$(".bz-checkList__input",t);i.focus(),$("[data-action=accept-edit]",t).bind("click",(function(){var t=i.val();t&&""!==t&&e.addItem()})),$("[data-action=cancel-edit]",t).bind("click",(function(t){var a=i.val(),r=$(this).closest(".bz-checkList__item"),n=r.data("item-position"),o=r.data("item-guid");a&&""!==a&&""!==e.properties.items[n].name&&(e.properties.items[n].selected=!1),""!==a&&""!==e.properties.items[n].name||e.deleteItem(o),e.repaintControl()}))},addItem:function(){var e=this.getControl(),t=$(".bz-checkList__item.bz-checkList__item--selected",e),i=$(".bz-checkList__input",t).val();$.each(this.properties.items,(function(e,t){t.selected&&(t.name=i,t.selected=!1)})),this.updateOriginalValue(),this.setValue(this.properties.items),this.repaintControl()},repaintControl:function(){var e=this.renderControl();$("[data-component=checkList]",this.control).replaceWith(e),this.postRender(),this.configureHandlers()},onCheckListGroupChange:function(e,t){var i,a=$.grep(this.properties.items,(function(t,i){return t.guid===e}));a&&a.length>0&&(i=a[0]),i.resolved=t,this.setValue(this.properties.items),this.refreshValue(this.properties.items)},refreshValue:function(e){for(var t=e.length,i=0,a=0;a<t;a++)e[a].resolved&&(i+=1);this.properties.activityWork=t>0?Math.floor(100*i/t):100,this.notifyLoadItems()},getValue:function(){return this.value||[]},controlValueIsChanged:function(){return JSON.stringify(this.properties.originalValue)!==JSON.stringify(this.value)},updateOriginalValue:function(){this.properties.originalValue=bizagi.clone(this.value)},collectData:function(e){var t=this.properties,i=t.xpath,a=this.getValue(),r=this.properties.idActivity;this.controlValueIsChanged()?bizagi.util.isEmpty(i)||bizagi.util.isEmpty(r)||(Array.isArray(a)?e[t.xpath]={idActivity:r,items:a}:""===a&&(e[t.xpath]="")):bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!1}))},isValid:function(e){var t,i=this.properties,a=this.getValue();t=this.getResource("render-activity-check-list-validation");for(var r=0;r<a.length;r+=1){if(!a[r].resolved){e.push({xpath:i.xpath,message:t});break}}}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.range",bizagi.rendering.range.prototype),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.range",{},{postRender:function(){this.properties},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.rangeDate",bizagi.rendering.rangeDate.prototype),bizagi.rendering.tablet.rangeDate.extend("bizagi.rendering.tablet.rangeDate",{},{setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.rangeMoney",bizagi.rendering.rangeMoney.prototype),bizagi.rendering.tablet.rangeMoney.extend("bizagi.rendering.tablet.rangeMoney",{},{postRender:function(){var e=new bizagi.rendering.money(this.getRenderProperties("min")),t=new bizagi.rendering.money(this.getRenderProperties("max"));this.setRanageControls(e,t)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,a={data:{properties:{id:i.id,xpath:i.xpath}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return a.data.properties.displayName="min"===e?"From":"To",a},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.rangeNumber",bizagi.rendering.rangeNumber.prototype),bizagi.rendering.tablet.rangeNumber.extend("bizagi.rendering.tablet.rangeNumber",{},{postRender:function(){var e=new bizagi.rendering.number(this.getRenderProperties("min")),t=new bizagi.rendering.number(this.getRenderProperties("max"));this.setRanageControls(e,t)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,a={data:{properties:{id:i.id,xpath:i.xpath}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return a.data.properties.displayName="min"===e?"From":"To",a},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.columns.column.extend("bizagi.rendering.tablet.columns.column",{},{applyOverrides:function(e){e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl)},getControl:function(){var e=this._super();return e&&0!=e.length||(e=$(this.element||this.observableElement)),e},render:function(e,t,i){var a=this._super(e,t,i),r=this.getDecorated(e);return r.element&&r.element.removeClass("ui-bizagi-render-display-normal ui-bizagi-render-display-vertical ui-bizagi-render-display-reversed").removeClass("ui-bizagi-render-display-vertical-reversed ui-bizagi-render-display-label ui-bizagi-render-display-value"),a},postRenderReadOnly:function(e,t){var i=this.getDecorated(e),a=this.properties.editable;i.properties.editable=!1,null==i.grid&&(i.grid=this.grid),this.properties.singleInstance&&(i.element=t),i.postRenderElement(t),i.properties.editable=a},applyColumnStyles:function(e){var t=this.properties;(e=$(e)).css("-webkit-box-pack",t.align),t.textFormat.background&&(e.css("background-color",t.textFormat.background),e.css("background-image","none"))},isValueValid:function(e,t,i,a){var r=this._super(e,t,i,a),n=this.getDecorated(e);return n&&n.element&&(r?n.element.removeClass("bz-form-item--error"):n.element.addClass("bz-form-item--error")),r}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.combo",{},bizagi.rendering.columns.combo.prototype),bizagi.rendering.tablet.columns.combo.extend("bizagi.rendering.tablet.columns.combo",{},{setValue:function(e,t){var i=this.getDecorated(e),a=bizagi.util.isOfflineForm({context:this});if(null!==i){if("summary"==e)return this._super(e,t);if(!a||"number"!=typeof t&&"string"!=typeof t)if("columnRadio"==this.properties.type)this._super(e,t),i.selectedValue=t;else if(t&&t.length>0){r={id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!=t})):t[0][1]};this._super(e,r),i.selectedValue=r.value}else t&&t.id&&t.value?(this._super(e,t),i.selectedValue=t.value):t&&"number"==typeof t?this._super(e,t):a&&null!==t&&"object"===_typeof(t)&&t.value?(this._super(e,t.value),i.selectedValue=t.value):(this._super(e,null),i.selectedValue="");else{var r="object"==_typeof(this.properties.data)?this.properties.data.find((function(e){return e.id==t})):t;this._super(e,r),i.selectedValue=t}}}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.document",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),"design"!==t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.getDocumentXpath=this.getDocumentXpath,e.getContextXpath=this.getContextXpath,e.documentTemplateGenerate=this.documentTemplateGenerate,e.preRenderControl=this.preRenderControl,e.deleteDocumentTemplate=this.deleteDocumentTemplate,e.properties.xpathContext=this.getContextXpath())},renderControl:function(){return this.preRenderControl(),this._super()},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath);var i=e.parent,a=e.getFormContainer();$.when(a.submitData()).done((function(){$.when(e.dataService.generateDocumentTemplate(t)).done((function(t){$.when(i.refresh()).done((function(){e.autoOpenDocuments()})),e.endLoading()})).fail((function(){e.showErrorMessage(),e.endLoading()}))})).fail((function(t){e.getFormContainer().addErrorMessage(t),e.endLoading()}))},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getDocumentXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),t},postRenderReadOnly:function(e,t,i){this._super(e,t,i)},getContextXpath:function(){var e=this.getFormContainer();return(e.properties.xpathContext?e.properties.xpathContext+".":"")+this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},preRenderControl:function(){null!=this.value&&null!=this.properties.value&&(this.properties.value=this.value)},deleteDocumentTemplate:function(e){var t=this.parent,i={};i.xpath=this.properties.xpath+"[fileName='"+e+"']",i.idRender=this.properties.id,i.xpathContext=this.getContextXpath(),i.idPageCache=this.properties.idPageCache,$.when(this.dataService.deleteUploadFile(i)).done((function(){t.refresh()}))}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.date",{},{applyOverrides:function(e){this._super(e)}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.text",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.number",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.numberScientificNotation",{},{postRender:function(e,t){this._super(e,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(e,t){return this.renderReadOnly(e,t)},postRenderSummary:function(e,t){return this.postRenderReadOnly(e,t),!0}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.image",{},{applyOverrides:function(e){var t=this.properties;this._super(e),e.properties.xpathContext=t.xpathContext.length>0?t.xpathContext+"."+this.grid.properties.xpath+"[id="+e.surrogateKey+"]":this.grid.properties.xpath+"[id="+e.surrogateKey+"]"}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.upload",{},{applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath;e.applyUploadPlugin;e.getXpathContext=function(){this.surrogateKey;var e=this.properties;return e.xpathContext.length>0?e.xpathContext+"."+this.grid.properties.xpath+"[id="+this.surrogateKey+"]":this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),a=this.getXpathContext();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:t.xpath,xpathContext:a,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})}},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.link",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),"design"!==t&&"layout"!==t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.properties.xpathContext=this.grid.properties.xpath+"[id="+this.surrogateKey+"]",this.grid.properties.xpathContext&&-1===e.properties.xpathContext.indexOf(this.grid.properties.xpathContext)&&(e.properties.xpathContext=this.grid.properties.xpathContext+"."+e.properties.xpathContext)),"columnFormLink"===e.properties.type&&(e.getFormLinkXpath=this.getFormLinkXpath)},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getContextXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},getFormLinkXpath:function(){if(this.properties.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties(),this.properties.xpath)return this.properties.xpath}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.uploadecm",{},{applyOverrides:function(e){this._super(e),e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl),e.getUploadXpath=this.getUploadXpath,e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),a=this.getUploadXpath(this.surrogateKey),r=(a=a.split("."))[a.length-1],n=this.getXpathContext(this.surrogateKey);return this.dataService.getUploadFileUrl({idRender:t.id,xpath:r,xpathContext:n,idPageCache:t.idPageCache,fileId:e.idFileUpload,sessionId:i.properties.sessionId,contexttype:t.contexttype})},e.buildAddParams=function(){var e=this.properties,t=this.getFormContainer(),i=this.getUploadXpath(this.surrogateKey),a=((i=i.split("."))[i.length-1],this.getXpathContext(this.surrogateKey)),r={url:e.addUrl,xpath:e.xpath,idAttrib:e.idAttrib,xpathContext:a,metaValues:[],idSession:t.properties.sessionId,contexttype:"entity",validExtensions:e.validExtensions,maxSize:e.maxSize};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r},e.getXpathContext=function(){var e=this.properties;return e.xpathContext.length>0?e.xpathContext+"."+this.grid.properties.xpath+"[id="+this.surrogateKey+"]":this.grid.properties.xpath+"[id="+this.surrogateKey+"]"}},renderReadOnly:function(e,t){var i="<div></div>",a=this.getDecorated(e);if(a.setValue(t),this.setValue(e,t),this.setSurrogateKey(e),this.applyOverrides(a),a.grid=this.grid,a.column=this,a.surrogateKey=e,this.readyDeferred=new $.Deferred,a.files.length>0){this.properties.editable;a.properties.editable=!1,i=a.render("cell.upload")}return i},getUploadXpath:function(e){return e=this.surrogateKey||e||"",this.grid.properties.xpath+"[id="+e+"]."+this.properties.xpath},getControl:function(){var e=this._super();return e&&0!=e.length?$(".bz-form-item",this.element||this.observableElement):$(".ui-bizagi-cell-readonly",this.element||this.observableElement)}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.button",{},{}),bizagi.rendering.tablet.columns.combo.extend("bizagi.rendering.tablet.columns.radio",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.readonly",bizagi.rendering.columns.readonly.prototype),bizagi.rendering.tablet.columns.readonly.extend("bizagi.rendering.tablet.columns.readonly",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.search",{},bizagi.rendering.columns.search.prototype),bizagi.rendering.tablet.columns.search.extend("bizagi.rendering.tablet.columns.search",{},{renderReadOnly:function(e,t){return t&&t.length>0?(t=[].concat(t[0]),this._super(e,{id:t[0],label:t[1],additionallabel:t[2]||void 0})):this._super(e,t)},render:function(e,t){return t&&t.length>0?(t=[].concat(t[0]),this._super(e,{id:t[0],label:t[1],additionallabel:t[2]||void 0})):this._super(e,t)},postRender:function(e,t){this._super(e,t),this.getDecorated(e).refreshControl=this.refreshControl},refreshControl:function(){this.grid.refreshCell({key:this.surrogateKey,column:this.properties.xpath,xpathContext:this.getFormContainer().properties.xpathContext})}}),bizagi.rendering.tablet.columns.combo.extend("bizagi.rendering.tablet.columns.list",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.exclusiveCheck",{},{render:function(e,t){var i=this;i.changed=!1;var a=i.properties,r=i.getFormContainer(),n=i.grid.changes,o=i.getDecorated(e);if(o.grid=i.grid,o.column=this,o.surrogateKey=e,"execution"==i.getMode()){i.setValue(e,t||!1);var l=i.grid.enabledChecks[i.properties.xpath].find((function(t){return t.id==e}));void 0===l&&i.grid.enabledChecks[i.properties.xpath].push({id:e,value:t||!1,originalValue:t||!1,changed:!1})}if(null==t){i.changed=!0;var s={};s[i.properties.xpath]=i.getValue(e),bizagi.util.isEmpty(n[e])&&(n[e]={}),n[e]=$.extend({},n[e],s)}if(i.overrideDecoratedRenderProperties(e),!a.editable)return i.renderReadOnly.apply(i,arguments);i.readyDeferred=new $.Deferred;var d=o.render("cell");return o.bind("renderchange",(function(){i.changed=!0,i.grid.enabledChecks[i.properties.xpath].forEach((function(t){if(t.id==e)t.value=o.value,t.changed=!0;else if(o.value&&t.value){var a=i.getDecorated(t.id);a.setDisplayValue(!1),i.setValue(t.id,!1),t.value=!1,t.changed=!0,r.isOfflineForm&&i.handleOfflineChange(a,t)}}));var t=i.properties.xpath.split(".");i.grid.exclusiveChanges[i.properties.xpath]={xpath:i.properties.xpath,simpleXpath:t[t.length-1],value:i.getValue(e),key:e}})),i.bind("rendered",(function(){i.readyDeferred.resolve()})),d},postRender:function(e,t){this._super(e,t);var i=this.getMode();(this.setSurrogateKey(e),"execution"==i)&&(this.getDecorated(e).getControl().parents("tr").data("new-row")?this.isNewRow=!0:this.isNewRow=!1)},isValueValid:function(e,t,i,a){if(this.grid.enabledChecks=this.grid.enabledChecks||{},(this.grid.enabledChecks[this.properties.xpath]||[]).filter((function(e){return e.value})).length>1){var r=this.getResource("render-exclusive-column-check-error").replaceAll("#label#",this.properties.displayName);return i.push(r),!1}return!0},handleOfflineChange:function(e,t){var i=this.grid.changes,a={};a[e.properties.xpath]=t.value,bizagi.util.isEmpty(i[t.id])&&(i[t.id]={}),i[t.id]=$.extend({},i[t.id],a),this.grid.onCellChange(this,null,t.id)}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.hidden",bizagi.rendering.columns.hidden.prototype),bizagi.rendering.tablet.columns.hidden.extend("bizagi.rendering.tablet.columns.hidden",{},{}),bizagi.rendering.base.factory.extend("bizagi.rendering.tablet.factory",{},{loadTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("icons",e.getFileTemplate("common.bizagi.rendering.icons")),e.loadTemplate("form-error",e.getFileTemplate("bizagi.rendering.tablet.form-error")),e.loadTemplate("form-waiting",e.getFileTemplate("bizagi.rendering.tablet.form-waiting")),e.loadTemplate("form",e.getFileTemplate("bizagi.rendering.tablet.form")+"#bz-form-container"),e.loadTemplate("complexgateway",e.getFileTemplate("bizagi.rendering.tablet.form")+"#bz-form-complex-gateway"),e.loadTemplate("panel",e.getFileTemplate("bizagi.rendering.tablet.panel")),e.loadTemplate("tab",e.getFileTemplate("bizagi.rendering.tablet.tab")),e.loadTemplate("tabItem",e.getFileTemplate("bizagi.rendering.tablet.tabItem")),e.loadTemplate("horizontal",e.getFileTemplate("bizagi.rendering.tablet.horizontal")),e.loadTemplate("accordion",e.getFileTemplate("bizagi.rendering.tablet.accordion")),e.loadTemplate("accordionItem",e.getFileTemplate("bizagi.rendering.tablet.accordionItem")),e.loadTemplate("group",e.getFileTemplate("bizagi.rendering.tablet.group")),e.loadTemplate("section",e.getFileTemplate("bizagi.rendering.tablet.section")),e.loadTemplate("searchForm",e.getFileTemplate("bizagi.rendering.tablet.searchForm")),e.loadTemplate("contentPanel",e.getFileTemplate("bizagi.rendering.tablet.contentPanel")),e.loadTemplate("render",e.getFileTemplate("bizagi.rendering.tablet.render")),e.loadTemplate("readonly",e.getFileTemplate("bizagi.rendering.tablet.readonly")),e.loadTemplate("readonly-value",e.getFileTemplate("bizagi.rendering.tablet.readonly")),e.loadTemplate("text",e.getFileTemplate("bizagi.rendering.tablet.text")+"#bz-render-text"),e.loadTemplate("text-readOnly",e.getFileTemplate("bizagi.rendering.tablet.text")+"#bz-render-text-readonly"),e.loadTemplate("extendedText",e.getFileTemplate("bizagi.rendering.tablet.extendedText")+"#bz-render-extended-text"),e.loadTemplate("extendedText-readOnly",e.getFileTemplate("bizagi.rendering.tablet.extendedText")+"#bz-render-extended-text-readonly"),e.loadTemplate("number",e.getFileTemplate("bizagi.rendering.tablet.number")),e.loadTemplate("numberScientificNotation",e.getFileTemplate("bizagi.rendering.tablet.numberScientificNotation")),e.loadTemplate("date",e.getFileTemplate("bizagi.rendering.tablet.date")),e.loadTemplate("yesno",e.getFileTemplate("bizagi.rendering.tablet.yesno")),e.loadTemplate("check",e.getFileTemplate("bizagi.rendering.tablet.check")),e.loadTemplate("checkList",e.getFileTemplate("bizagi.rendering.tablet.checkList")),e.loadTemplate("combo",e.getFileTemplate("bizagi.rendering.tablet.combo")+"#bz-combo-control"),e.loadTemplate("combo-readonly",e.getFileTemplate("bizagi.rendering.tablet.combo")+"#bz-combo-control-readonly"),e.loadTemplate("combo-list",e.getFileTemplate("bizagi.rendering.tablet.combo")+"#bz-combo-control-list"),e.loadTemplate("modal-header-search",e.getFileTemplate("bizagi.rendering.tablet.modal")+"#bz-modal-view-header-search"),e.loadTemplate("modal-footer-done",e.getFileTemplate("bizagi.rendering.tablet.modal")+"#bz-modal-view-footer-done"),e.loadTemplate("list",e.getFileTemplate("bizagi.rendering.tablet.list")+"#bz-render-list"),e.loadTemplate("list-items",e.getFileTemplate("bizagi.rendering.tablet.list")+"#bz-render-list-items"),e.loadTemplate("radio",e.getFileTemplate("bizagi.rendering.tablet.radio")),e.loadTemplate("image",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image"),e.loadTemplate("image-item",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image-item"),e.loadTemplate("image-preview",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image-preview"),e.loadTemplate("image-readonly",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image-readonly"),e.loadTemplate("uploadSlide",e.getFileTemplate("bizagi.rendering.tablet.slide.upload")),e.loadTemplate("upload",e.getFileTemplate("bizagi.rendering.tablet.upload")+"#bz-render-upload"),e.loadTemplate("upload-item",e.getFileTemplate("bizagi.rendering.tablet.upload")+"#bz-render-upload-item"),e.loadTemplate("upload-readonly",e.getFileTemplate("bizagi.rendering.tablet.upload")+"#bz-render-upload-readonly"),e.loadTemplate("grid",e.getFileTemplate("bizagi.rendering.tablet.grid")),e.loadTemplate("cell",e.getFileTemplate("bizagi.rendering.tablet.cell")),e.loadTemplate("cell.readonly",e.getFileTemplate("bizagi.rendering.tablet.cell.readonly")),e.loadTemplate("cell.upload",e.getFileTemplate("bizagi.rendering.tablet.cell.upload")),e.loadTemplate("search",e.getFileTemplate("bizagi.rendering.tablet.search")+"#bz-render-search"),e.loadTemplate("search.item",e.getFileTemplate("bizagi.rendering.tablet.search")+"#bz-render-search-item"),e.loadTemplate("search.items",e.getFileTemplate("bizagi.rendering.tablet.search")+"#bz-render-search-items"),e.loadTemplate("searchItem",e.getFileTemplate("bizagi.rendering.tablet.searchItem")),e.loadTemplate("searchList",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list"),e.loadTemplate("searchList.item",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-item"),e.loadTemplate("searchList.items",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-items"),e.loadTemplate("searchList.actions",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-actions"),e.loadTemplate("searchList.tag",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-tag"),e.loadTemplate("searchList.readonly",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-readonly"),e.loadTemplate("searchList-modal-header",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-modal-header"),e.loadTemplate("letter",e.getFileTemplate("bizagi.rendering.tablet.letter")),e.loadTemplate("letter.readonly",e.getFileTemplate("bizagi.rendering.tablet.letter.readonly")),e.loadTemplate("letter.dialog",e.getFileTemplate("bizagi.rendering.tablet.dialog-letter")),e.loadTemplate("button",e.getFileTemplate("bizagi.rendering.tablet.button")),e.loadTemplate("link",e.getFileTemplate("bizagi.rendering.tablet.link")),e.loadTemplate("formLink",e.getFileTemplate("bizagi.rendering.tablet.formLink")),e.loadTemplate("geolocation",e.getFileTemplate("bizagi.rendering.tablet.geolocation")),e.loadTemplate("association",e.getFileTemplate("bizagi.rendering.tablet.association")),e.loadTemplate("ecm",e.getFileTemplate("bizagi.rendering.tablet.ecm")+"#bz-render-ecm"),e.loadTemplate("ecm-item",e.getFileTemplate("bizagi.rendering.tablet.ecm")+"#bz-render-ecm-item"),e.loadTemplate("ecm-readonly",e.getFileTemplate("bizagi.rendering.tablet.ecm")+"#bz-render-ecm-readonly"),e.loadTemplate("list-multiselect",e.getFileTemplate("bizagi.rendering.tablet.multiSelect")+"#bz-multiselect"),e.loadTemplate("multiselect-list",e.getFileTemplate("bizagi.rendering.tablet.multiSelect")+"#bz-multiselect-list"),e.loadTemplate("document",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator"),e.loadTemplate("document-item",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator-item"),e.loadTemplate("document-readonly",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator-readonly"),e.loadTemplate("document-download",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator-download"),e.loadTemplate("hand-signature",e.getFileTemplate("bizagi.rendering.tablet.handSignature")+"#bz-signature"),e.loadTemplate("hand-signature-readonly",e.getFileTemplate("bizagi.rendering.tablet.handSignature")+"#bz-signature-readonly"),e.loadTemplate("render-actionLauncher",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher"),e.loadTemplate("render-actionLauncher-horizontal",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-horizontal"),e.loadTemplate("render-actionLauncher-vertical",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-vertical"),e.loadTemplate("render-actionLauncher-actions-to-execute",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-actions-to-execute"),e.loadTemplate("render-actionLauncher-design",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-design"),e.loadTemplate("render-polymorphicLauncher",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher"),e.loadTemplate("render-polymorphicLauncher-vertical-tree",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree"),e.loadTemplate("render-polymorphicLauncher-vertical-tree-item",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree-item"),e.loadTemplate("render-polymorphicLauncher-actions-to-execute",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-actions-to-execute"),e.loadTemplate("render-polymorphicLauncher-confirm",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-confirm"),e.loadTemplate("render-polymorphicLauncher-design",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-design"),e.loadTemplate("render-layout",e.getFileTemplate("bizagi.rendering.tablet.layout.render")),e.loadTemplate("layout-image",e.getFileTemplate("bizagi.rendering.tablet.layout.image")+"#ui-bizagi-render-layout-image"),e.loadTemplate("layout-image64",e.getFileTemplate("bizagi.rendering.tablet.layout.image")+"#ui-bizagi-render-layout-image64"),e.loadTemplate("layout-label",e.getFileTemplate("bizagi.rendering.tablet.layout.label")),e.loadTemplate("layout-link",e.getFileTemplate("bizagi.rendering.tablet.layout.link")),e.loadTemplate("layout-text",e.getFileTemplate("bizagi.rendering.tablet.layout.text")),e.loadTemplate("layout-date-time",e.getFileTemplate("bizagi.rendering.tablet.layout.dateTime")),e.loadTemplate("layout-money",e.getFileTemplate("bizagi.rendering.tablet.layout.money")),e.loadTemplate("layout-number",e.getFileTemplate("bizagi.rendering.tablet.layout.number")),e.loadTemplate("layout-upload",e.getFileTemplate("bizagi.rendering.tablet.layout.upload")),e.loadTemplate("bizagi.grid.grid",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid"),e.loadTemplate("bizagi.grid.waiting",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-waiting"),e.loadTemplate("bizagi.grid.table",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-table"),e.loadTemplate("bizagi.grid.table.empty",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-table-empty"),e.loadTemplate("bizagi.grid.column",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-column"),e.loadTemplate("bizagi.grid.column.special",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-column-special"),e.loadTemplate("bizagi.grid.row",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-row"),e.loadTemplate("bizagi.grid.row.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-row-buttons"),e.loadTemplate("bizagi.grid.cell",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-cell"),e.loadTemplate("bizagi.grid.cell.special",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-cell-special"),e.loadTemplate("bizagi.grid.pager",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-pager"),e.loadTemplate("bizagi.grid.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-buttons"),e.loadTemplate("bizagi.grid.dynamicpager",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-dynamic-pager"),e.loadTemplate("bizagi.grid.totalizer",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-totalizer"),e.loadTemplate("bizagi.grid.offline.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#bz-grid-offline-buttons"),e.loadTemplate("bizagi.grid.offline.row.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#bz-grid-offline-row-buttons"),e.loadTemplate("bizagi.grid.offline.cell.special",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#bz-grid-offline-cell-special")).done((function(){var i=$.fasttmpl(e.getTemplate("icons"));0===$("head").find("#genome-forms-icons").length&&$("head").append(i),t.resolve()})),t.promise()},getFileTemplate:function(e,t){var i=bizagi.detectDevice();return bizagi.getTemplate(e,t,"desktop"==i?"tablet_ios":i)},getContainer:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==(t=t.replace(/tablet/,""))?new bizagi.rendering.tablet.form(i):"template"==t?new bizagi.rendering.tablet.formTemplate(i):"queryForm"==t?new bizagi.rendering.tablet.queryForm(i):"layout"==t?new bizagi.rendering.tablet.layout(i):"usersForm"==t?new bizagi.rendering.tablet.usersForm(i):"panel"==t?new bizagi.rendering.tablet.panel(i):/^contentpanel$/i.test(t)?new bizagi.rendering.tablet.contentPanel(i):/^nestedform$/i.test(t)?new bizagi.rendering.tablet.nestedForm(i):"tab"==t?new bizagi.rendering.tablet.tab(i):/^tabitem$/i.test(t)?new bizagi.rendering.tablet.tabItem(i):"horizontal"==t?new bizagi.rendering.tablet.horizontal(i):"accordion"==t?new bizagi.rendering.tablet.accordion(i):"accordionItem"==t?new bizagi.rendering.tablet.accordionItem(i):"group"==t?new bizagi.rendering.tablet.group(i):"section"==t?new bizagi.rendering.tablet.section(i):"searchForm"==t?(i.context="search",i.contexttype="metadata",new bizagi.rendering.tablet.searchForm(i)):"mobileform"==t?new bizagi.rendering.mobileform(i):"mobilegroup"==t?new bizagi.rendering.mobilegroup(i):(bizagi.log(t+" not supported in render factory",e.data,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,a=i.properties,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance}),n=bizagi.util.isOfflineForm({container:e.parent});if("columnText"==(t=t.replace(/tablet/,""))){var o=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return r.decorated=o?bizagi.rendering.tablet.extendedText:bizagi.rendering.tablet.text,new bizagi.rendering.tablet.columns.text(r)}if("columnSearchList"==t)return r.decorated=bizagi.rendering.tablet.searchList,new bizagi.rendering.tablet.columns.searchList(r);if("columnNumber"==t)return r.decorated=bizagi.rendering.tablet.number,new bizagi.rendering.tablet.columns.number(r);if("columnMoney"==t)return r.decorated=bizagi.rendering.tablet.money,new bizagi.rendering.tablet.columns.number(r);if("columnDate"==t)return r.decorated=bizagi.rendering.tablet.date,new bizagi.rendering.tablet.columns.date(r);if("columnBoolean"==t){if("check"==(i.properties.display||"option")){if(r.decorated=bizagi.rendering.tablet.check,e.data.properties.isExclusive)return new bizagi.rendering.tablet.columns.exclusiveCheck(r)}else r.decorated=bizagi.rendering.tablet.yesno;return new bizagi.rendering.tablet.columns.column(r)}return"columnCombo"==t?(r.decorated=bizagi.rendering.tablet.combo,new bizagi.rendering.tablet.columns.combo(r)):"columnRadio"==t?(r.decorated=bizagi.rendering.tablet.radio,new bizagi.rendering.tablet.columns.radio(r)):"columnList"==t?(r.decorated=bizagi.rendering.tablet.list,new bizagi.rendering.tablet.columns.list(r)):"columnHidden"==t?(bizagi.override.hiddenControlsWithDataType||delete a.dataType,r.decorated=bizagi.rendering.tablet.hidden,new bizagi.rendering.tablet.columns.hidden(r)):"columnUpload"==t?(n&&bizagi.util.isOfflineFormsV2Supported()?r.decorated=bizagi.rendering.tablet.upload.offline:r.decorated=bizagi.rendering.tablet.upload,new bizagi.rendering.tablet.columns.upload(r)):"columnImage"==t?(r.decorated=bizagi.rendering.tablet.image,new bizagi.rendering.tablet.columns.image(r)):"columnUploadEcm"==t?(r.decorated=bizagi.rendering.tablet.ecm,new bizagi.rendering.tablet.columns.uploadecm(r)):"columnLink"==t?(r.decorated=bizagi.rendering.tablet.link,new bizagi.rendering.tablet.columns.link(r)):"columnFormLink"==t?(r.decorated=bizagi.rendering.tablet.formLink,new bizagi.rendering.tablet.columns.link(r)):"columnUserfield"==t?(r.decorated=bizagi.rendering.tablet.userfieldWrapper,new bizagi.rendering.tablet.columns.column(r)):"columnSearch"==t?(r.decorated=bizagi.rendering.tablet.search,new bizagi.rendering.tablet.columns.search(r)):"columnLabel"==t?(bizagi.override.hiddenControlsWithDataType||delete a.dataType,r.decorated=bizagi.rendering.tablet.label,new bizagi.rendering.tablet.columns.column(r)):"columnReadonly"==t?(r.decorated=bizagi.rendering.tablet.readonly,new bizagi.rendering.tablet.columns.readonly(r)):"columnDocument"==t?(r.decorated=bizagi.rendering.tablet.document,new bizagi.rendering.tablet.columns.document(r)):"columnButton"==t?(r.decorated=bizagi.rendering.tablet.button,new bizagi.rendering.tablet.columns.button(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,a=i.properties,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService}),n=bizagi.util.isOfflineForm({container:e.parent});return t||(t="label"),"text"==(t=t.replace(/tablet/,""))?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.tablet.extendedText(r):new bizagi.rendering.tablet.text(r):"association"==t?new bizagi.rendering.tablet.association(r):"label"==t?(bizagi.override.hiddenControlsWithDataType||delete a.dataType,new bizagi.rendering.tablet.label(r)):"hidden"==t?(bizagi.override.hiddenControlsWithDataType||delete a.dataType,new bizagi.rendering.tablet.hidden(r)):"number"==t?a&&29===a.dataType?new bizagi.rendering.tablet.numberScientificNotation(r):new bizagi.rendering.tablet.number(r):"money"==t?new bizagi.rendering.tablet.money(r):"date"==t?new bizagi.rendering.tablet.date(r):"boolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.tablet.check(r):new bizagi.rendering.tablet.yesno(r):"combo"==t?new bizagi.rendering.tablet.combo(r):/^cascadingcombo$/i.test(t)?new bizagi.rendering.tablet.cascadingCombo(r):"list"==t?new bizagi.rendering.tablet.list(r):"radio"==t?new bizagi.rendering.tablet.radio(r):"image"==t?n&&!bizagi.util.isOfflineFormsV2Supported()?new bizagi.rendering.tablet.image.old(r):new bizagi.rendering.tablet.image(r):"uploadecm"==t?new bizagi.rendering.tablet.ecm(r):"upload"==t?n?bizagi.util.isOfflineFormsV2Supported()?new bizagi.rendering.tablet.upload.offline(r):new bizagi.rendering.tablet.upload.offline.old(r):new bizagi.rendering.tablet.upload(r):"grid"==t?n?bizagi.util.isOfflineFormsV2Supported()?new bizagi.rendering.tablet.grid.offline(r):new bizagi.rendering.tablet.grid.offline.old(r):new bizagi.rendering.tablet.grid(r):"groupedgrid"==t?new bizagi.rendering.tablet.grid(r):"search"==t?new bizagi.rendering.tablet.search(r):"suggest"==t?(r.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.tablet.search(r)):"searchList"==t?new bizagi.rendering.tablet.searchList(r):"multiSelect"==t?new bizagi.rendering.tablet.multiSelect(r):"button"==t?new bizagi.rendering.tablet.button(r):"formLink"==t?new bizagi.rendering.tablet.formLink(r):"link"==t?new bizagi.rendering.tablet.link(r):"actionLauncher"==t?new bizagi.rendering.tablet.actionLauncher(r):"entityTemplate"==t?new bizagi.rendering.tablet.entityTemplate(r):"polymorphicLauncher"==t?new bizagi.rendering.tablet.polymorphicLauncher(r):"userfield"==t?new bizagi.rendering.tablet.userfieldWrapper(r):0==t.indexOf("search")?this.getSearchRender(e):"document"==t?new bizagi.rendering.tablet.document(r):"image"==t?new bizagi.rendering.tablet.image(r):"fileprint"==t?new bizagi.rendering.tablet.fileprint(r):"geolocation"==t?new bizagi.rendering.tablet.geolocation(r):"collectionnavigator"==t?new bizagi.rendering.tablet.collectionnavigator(r):0===t.indexOf("layout")?this.getLayoutRender(e):0===t.indexOf("range")?this.getRangeRender(e):"activityCheckList"==t?new bizagi.rendering.tablet.activityCheckList(r):"mobiletext"==t?new bizagi.rendering.mobiletext(r):"letter"==t?new bizagi.rendering.tablet.letter(r):/^signature$/i.test(t)?new bizagi.rendering.tablet.handSignature(r):/^readonly$/i.test(t)?new bizagi.rendering.tablet.readonly(r):this._super(e)},getLayoutRender:function(e){var t=e.type,i=e.data.properties,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"layoutImage"==t?new bizagi.rendering.tablet.layoutImage(a):"layoutLink"==t?new bizagi.rendering.tablet.layoutLink(a):"layoutLabel"==t?(bizagi.override.hiddenControlsWithDataType||delete i.dataType,new bizagi.rendering.tablet.layoutLabel(a)):"layoutText"==t?new bizagi.rendering.tablet.layoutText(a):"layoutDateTime"==t?new bizagi.rendering.tablet.layoutDateTime(a):"layoutNumber"==t?new bizagi.rendering.tablet.layoutNumber(a):"layoutMoney"==t?new bizagi.rendering.tablet.layoutMoney(a):"layoutPlaceholder"==t?new bizagi.rendering.tablet.layoutPlaceholder(a):"layoutBoolean"==t?new bizagi.rendering.tablet.layoutBoolean(a):"layoutUpload"==t?new bizagi.rendering.tablet.layoutUpload(a):this._super(e)},getRangeRender:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"rangeDate"===t?new bizagi.rendering.tablet.rangeDate(i):"rangeMoney"===t?new bizagi.rendering.tablet.rangeMoney(i):"rangeNumber"===t?new bizagi.rendering.tablet.rangeNumber(i):(bizagi.log(t+" not supported in render factory",e.data,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,a=i.properties,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==(t=t.replace(/tablet/,""))?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.tablet.extendedText(r):new bizagi.rendering.tablet.text(r):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.tablet.check(r):new bizagi.rendering.tablet.yesno(r):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.tablet.numberScientificNotation(r):new bizagi.rendering.tablet.number(r):"searchMoney"==t?new bizagi.rendering.tablet.money(r):"searchDate"==t?new bizagi.rendering.tablet.date(r):"searchCombo"==t?new bizagi.rendering.tablet.combo(r):"searchSuggest"==t?new bizagi.rendering.tablet.search(r):"searchLabel"==t?(bizagi.override.hiddenControlsWithDataType||delete a.dataType,new bizagi.rendering.tablet.label(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)}}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.queryForm",{},{}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.formTemplate",bizagi.rendering.formTemplate.prototype),bizagi.rendering.tablet.formTemplate.extend("bizagi.rendering.tablet.formTemplate",{},{}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.usersForm",{},{});
//# sourceMappingURL=../../../../Maps/tablet_android/forms.tablet.production.js.map
