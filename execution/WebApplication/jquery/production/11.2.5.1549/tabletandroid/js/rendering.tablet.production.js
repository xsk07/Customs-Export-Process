function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/*! jQuery UI - v1.10.2 - 2013-03-14
                                                                                                                                                                                                                                                                                                                                                                               * http://jqueryui.com
                                                                                                                                                                                                                                                                                                                                                                               * Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.effect.js, jquery.ui.accordion.js, jquery.ui.autocomplete.js, jquery.ui.button.js, jquery.ui.datepicker.js, jquery.ui.dialog.js, jquery.ui.effect-blind.js, jquery.ui.effect-bounce.js, jquery.ui.effect-clip.js, jquery.ui.effect-drop.js, jquery.ui.effect-explode.js, jquery.ui.effect-fade.js, jquery.ui.effect-fold.js, jquery.ui.effect-highlight.js, jquery.ui.effect-pulsate.js, jquery.ui.effect-scale.js, jquery.ui.effect-shake.js, jquery.ui.effect-slide.js, jquery.ui.effect-transfer.js, jquery.ui.menu.js, jquery.ui.position.js, jquery.ui.progressbar.js, jquery.ui.slider.js, jquery.ui.spinner.js, jquery.ui.tabs.js, jquery.ui.tooltip.js
                                                                                                                                                                                                                                                                                                                                                                               * Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){var t;if(void 0===t){var i=e('<div style="background:none;display:none;"/>').appendTo("body");t=i.css("backgroundColor"),i.remove()}e.fn.rippleEffect=function(i){var r=e.extend({},e.fn.rippleEffect.defaults,i);return this.each((function(){e(this).on("click",(function(i){var a,n,o,s,l,d,c,u,p=e(this),h=i.type;function g(){return""!=r.inkColor?r.inkColor:function(i,r){var a,n,o,s;a=function(e,i){return function e(r){return r.css("backgroundColor")==t?r.is("body")?i||t:e(r.parent()):r.css("backgroundColor")}(e)}(i,r),n=e.fn.rippleEffect.colorToHex(a),s=(o=e.fn.rippleEffect.getLuminationValue(n))<=239?o<=70?e.fn.rippleEffect.getColorLuminance(n,.8):e.fn.rippleEffect.getColorLuminance(n,.2):e.fn.rippleEffect.getColorLuminance(n,-.15);return s}(u,r.inkDefaultColor)}if(u=p,""!=r.appendInkTo&&(u=p.closest(r.appendInkTo)),0==u.find("."+r.inkClass).length&&u.append('<span class="'+r.inkContainerClass+'"><span class="'+r.inkClass+'"></span></span>'),(c=u.find("."+r.inkContainerClass+" >  ."+r.inkClass)).removeClass("animate"),!c.height()&&!c.width()){if(l=Math.max(u.outerWidth(),u.outerHeight()),void 0!==p.data("ripple")&&""!=p.data("ripple"))d=p.data("ripple");else if(void 0!==p.data("ripple-getcolorfromid")&&""!=p.data("ripple-getcolorfromid")){var f=p.data("ripple-getcolorfromid");d=e(f).length>0?e(f).css("background-color"):g()}else d=g();c.css({height:l,width:l,"background-color":d})}if("click"===h)a=i.pageX,n=i.pageY;else if("touchstart"===h){var m=i.originalEvent.touches[0]||i.originalEvent.changedTouches[0];a=m.pageX,n=m.pageY}o=a-u.offset().left-c.width()/2,s=n-u.offset().top-c.height()/2,c.css({top:s+"px",left:o+"px"}).addClass("animate"),setTimeout((function(){c.removeClass("animate")}),400)}))}))},e.fn.rippleEffect.defaults={inkContainerClass:"ripple",inkClass:"ink",inkDefaultColor:"#F0F0F0",inkColor:"",appendInkTo:""},e.fn.rippleEffect.getLuminationValue=function(e){e=e.substring(1);var t=parseInt(e,16);return.2126*(t>>16&255)+.7152*(t>>8&255)+.0722*(t>>0&255)},e.fn.rippleEffect.getColorLuminance=function(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var i,r,a="#";for(r=0;r<3;r++)i=parseInt(e.substr(2*r,2),16),a+=("00"+(i=Math.round(Math.min(Math.max(0,i+i*t),255)).toString(16))).substr(i.length);return a},e.fn.rippleEffect.colorToHex=function(e){return"#"===e.substr(0,1)?color:(e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""}}(jQuery),function(e){e.widget("ui.bizagi_notifications",{options:{containerAdditionalClass:"",headerAdditionalClass:"",contentAdditionalClass:"",itemAdditionalClass:"",itemIcon:"ui-icon-alert",title:"Notifications",minimized:!0,clearEnabled:!0,location:"bottom",device:bizagi.detectDevice()||"desktop"},_init:function(){var t=this,i=t.options,r=t.element;t.counter=0,r&&r.parent()&&e(r.parent()).children(".bz-form-notification").remove(),r.addClass(i.containerAdditionalClass).addClass("ui-bizagi-notifications-container").addClass("bz-form-notification"),"rtl"===i.orientation&&r.addClass("bz-form-notification--reverse"),r.addClass(i.minimized?"bz-form-notification--collapsed":"bz-form-notification--expanded");var a=e("<div class='bz-form-notification__content "+i.contentAdditionalClass+"'></div>"),n=e("<div class='bz-form-notification__header "+i.headerAdditionalClass+"'></div>");n.data("expanded",!i.minimized).html("<label>"+i.title+"</label>"),n.mouseenter((function(){r.addClass("bz-form-notification--hover")})),n.mouseleave((function(){r.removeClass("bz-form-notification--hover")})),n.click((function(){t.hide()})),t.headerButton=e("<button class='bz-btn-icn bz-btn-icn--24'>    <svg class='bz-icn' width='16px' height='16px'>        <use xlink:href='#icon-cancel'></use>    </svg></button>").appendTo(n),r.append(n).append(a),i.minimized&&a.hide(),t.content=a,t.header=n},addNotification:function(t,i,r,a,n,o,s){if(t&&t.replace){var l=this.options,d=this.element,c=this.batchMode?this.batchContent:this.content;r=r||l.itemIcon,a=a||l.itemAdditionalClass,"string"!=typeof t&&(t=t.toString()),t=(t=(t=bizagi.util.encodeHtml(t.replace(/<(\/?(?:STRONG|FONT))>/gi,"#$1!#"))).replace(/#(\/?(?:STRONG|FONT))!#/gi,"<$1>")).replace(/\n|\r/g,"<br/>");var u=e("<div class='bz-form-notification__item "+a+"'><label>"+t+"</label></div>").appendTo(c);!this.batchMode&&this._hasScrollBar()&&u[0].scrollIntoView(),u.bind("click",(function(){var e={focus:i||null,id:s||null};d.triggerHandler("itemClick",{data:e}),n&&n({data:i})})),this.batchMode||this.show(),this.counter++}},clearAll:function(e){e=void 0===e||e,bizagi.util.removeItemLocalStorage("bizagi.mobility.trace"),this.content.empty(),this.counter=0,e?this.hide():this.show()},show:function(){this.element.css("z-index",e.getMaxZindex()+1),this.isContentVisible()||this.element.fadeIn()},hide:function(){this.isContentVisible()&&this.element.hide()},count:function(){return this.content.children().size()},_hasScrollBar:function(){return!!this.isContentVisible()&&bizagi.util.hasScroll(this.content,"vertical")},onHeaderClick:function(){this.isExpanded()?this.collapse():this.expand()},isExpanded:function(){return 1==this.header.data("expanded")},collapse:function(){var e=this.element;this.header.data("expanded",!1),e.removeClass("bz-form-notification--expanded"),e.addClass("bz-form-notification--collapsed"),this.content.hide()},expand:function(){var e=this.element;this.header.data("expanded",!0),e.removeClass("bz-form-notification--collapsed"),e.addClass("bz-form-notification--expanded"),this.content.show()},autoFocusFirstError:function(){},initBatch:function(){this.batchMode=!0,this.batchContent=e("<div></div>")},endBatch:function(){this.batchMode=!1,this.batchContent.children().appendTo(this.content),this.batchContent.detach(),this.batchContent=null,this.content.children().length>0&&this.show()},isContentVisible:function(){var e=this.content,t=this.element;return t.length>0&&"none"!==t.css("display")&&e.length>0&&"none"!==e.css("display")}})}(jQuery),function(e){e.widget("ui.bizagi_grid",{options:{id:"no-id",columns:[],sortBy:"",sortType:"asc",showSummary:!1,collapse:!1,collapseState:!1,data:{},indexedData:{},maxColumns:0,buttonsPst:!1,title:"",tableCssClass:"",headerStyles:"",floatingHeader:!1,hasExclusiveCheck:!1,template:{grid:"",waiting:"",table:"",emptyTable:"",column:"",specialColumn:"",row:"",rowButtons:"",cell:"",specialCell:"",pager:"",buttons:"",dynamicPager:"",summary:"",summaryCell:""},actions:{add:!0,edit:!0,remove:!0,details:!0,allowMore:!1,enableXlsExport:!1,enablePdfExport:!1},mode:"execution"},_init:function(){var t=this,i=t.options,r=t.element;t.page=1,t.changes={},t.totalRows=0,t.totalPages=0,t.data=i.data,t.selectedRow=0,t.components={},t.buttons={},t.asyncCells={},t.scrollableArea=i.scrollableArea||t,t.columnByIndex={},t.columnByName={},t.columnKeyIndex=0,e.each(i.columns,(function(e,i){i.key=void 0!==i.key&&i.key,i.label=void 0!==i.label?i.label:i.name,i.sortType="asc",i.tooltip=void 0!==i.tooltip?i.tooltip:"",t.columnByIndex[i.index]=i,t.columnByName[i.name]=i,i.key&&(t.columnKeyIndex=i.index)})),i.sortBy=i.sortBy||t.columnByIndex[0].name,t.columnByName[i.sortBy]?t.columnByName[i.sortBy].sortType=i.sortType:t.columnByName[i.sortBy.split(".")[0]]&&(t.columnByName[i.sortBy.split(".")[0]].sortType=i.sortType),r.addClass("ui-bizagi-grid-wrapper"),r.attr("data-bizagi-id",i.id),t.calculateKeyIndex(),t.collapseState=i.collapseState,t.startLoading(!1)},startLoading:function(t){var i=this;if(t=void 0===t||t,"execution"===i.options.mode&&void 0!==i.options.sortBy){var r=function(){var t=i.element,r=i.options;i.waitingTimeout=null,t.append(e.fasttmpl(r.template.waiting))};t?i.waitingTimeout=setTimeout(r,250):r()}},endLoading:function(){var e=this.element;this.waitingTimeout&&(clearTimeout(this.waitingTimeout),this.waitingTimeout=null),e.empty()},setData:function(e){this.data=e,this.calculateKeyIndex(),this.refresh()},getData:function(){return this.data},calculateKeyIndex:function(){var t=this.options.columns,i=this.data;indexedData={},i.rows&&e.each(i.rows,(function(i,r){var a;e.each(t,(function(e,t){t.key&&(a=r[e])})),indexedData[a]=r})),this.indexedData=indexedData},getChanges:function(){},refresh:function(){this._cleanComponents(),this._cleanButtons(),this.components={},this.draw()},refreshSummary:function(e){var t=this.options,i=this._getComponent("summary");this.drawing||i&&t.showSummary&&(e?this.refreshSummaryCell(e):(i.empty(),i.append(this.drawSummary()),this.postRenderSummary(i)))},refreshSummaryCell:function(t){this.options;var i=this._getComponent("summary"),r=function(t,i){var r=t.is("[data-bizagi-component=summary-cells]")?t.children():t.find("[data-bizagi-component=summary-cells]").children();return e(r[i])},a=r(i,t),n=this.columnByIndex[t];if(!n.key){var o=this.drawSummaryCell(n);a.replaceWith(o),a=r(i,t),this.onCellReady(n,"summary",a,!1)}},changeCellValue:function(e,t,i){this.indexedData[e]&&(this.indexedData[e][t]=i)},deleteCellExclusiveValues:function(t){var i=this;i.indexedData&&e.each(i.indexedData,(function(e){i.indexedData[e][t]=!1}))},draw:function(){var t=this.options,i=this.element;if(this.drawing=!0,this.endLoading(),"rtl"===t.orientation)var r=e.fasttmpl(t.template.gridRtl,{label:t.title,buttonsPst:t.buttonsPst,collapse:t.collapse,collapseState:this.collapseState,isDesign:"design"===t.mode});else r=e.fasttmpl(t.template.grid,{label:t.title,buttonsPst:t.buttonsPst,collapse:t.collapse,collapseState:this.collapseState,isDesign:"design"===t.mode});if(r=this.drawTable(r),this.grid=e(r).appendTo(i),this.postRender(this.grid),"design"!==t.mode&&(this.attachPaginator(),this.attachHandlers()),"execution"===t.mode&&t.floatingHeader){var a=this._getComponent("table"),n=e("table",a),o=parseInt(e(this.scrollableArea).css("padding-top").replace(/[^\d.]/g,""))||0;n.stickyTableHeaders({fixedOffset:o>0?o-1:o,scrollableArea:this.scrollableArea,zIndex:1e3,cacheHeaderHeight:!0}),a.bind("scroll",(function(){n.trigger("resize.stickyTableHeaders")}))}0===this.data.rows.length?(this._getComponent("table").hide(),this._getComponent("pager").hide(),this._getButton("remove").hide(),this._getButton("edit").hide(),this._getComponent("dynamicPager").hide(),this._getComponent("emptyTable").show()):(this._getComponent("table").show(),this._getButton("remove").show(),this._getButton("edit").show(),this._getComponent("emptyTable").hide(),t.actions.allowMore?(this._getComponent("dynamicPager").show(),this._getComponent("pager").hide()):(this._getComponent("pager").show(),this._getComponent("dynamicPager").hide()),t.actions.edit&&this._getButton("edit").show(),t.actions.enableXlsExport||t.actions.enablePdfExport?this._getButton("show-grid-export-options").show():this._getButton("show-grid-export-options").css("display","none")),this.drawing=!1},attachPaginator:function(){},drawTable:function(t){var i=this.options,r=e.fasttmpl(i.template.table,{showSummary:i.showSummary,tableCssClass:i.tableCssClass,orientation:i.orientation}),a=e.fasttmpl(i.template.emptyTable);return r=this._replaceElement(r,"columns",this.drawHeader()),r=this._replaceElement(r,"rows",this.drawBody()),i.showSummary&&(r=this._replaceElement(r,"summary",this.drawSummary())),t=this._replaceElement(t,"pager",this.drawPager()),t=this._replaceElement(t,"buttons",this.drawButtons()),t=this._replaceElement(t,"gridExportOptions",this.drawGridExportOptions()),t=this._replaceElement(t,"rowButtons",this.drawRowButtons()),t=this._replaceElement(t,"dynamicPager",this.drawDynamicPager()),t=this._replaceElement(t,"table",r),t=this._replaceElement(t,"emptyTable",a)},isExactMatch:function(){for(var e=this.options.columns,t=this.options.sortBy,i=0,r=e.length;i<r;)if(t==e[i++].name)return!0;return!1},drawHeader:function(){var t=this,i=t.options,r="";return t.exactMatch=t.isExactMatch(),e.each(i.columns,(function(e,i){t.options.maxColumns>0?e<=t.options.maxColumns&&(r+=t.drawColumn(i)):r+=t.drawColumn(i)})),t.options.maxColumns>0&&t._canShowButtons()&&(r+=t.drawSpecialColumn()),r},drawColumn:function(t){var i=this.options,r=t.bizAgiProperties||{},a=r.cssclass?r.cssclass:"",n=i.headerStyles?i.headerStyles.header:"";n+=(""!==n?"; text-align:":"text-align:")+(r.columntitlealign?r.columntitlealign:"center");var o=r.columntitlealign?r.columntitlealign:"center",s=i.isSortable&&r.isSortable&&void 0!==r.xpath,l=i.sortBy.split(".")[0],d=!1;s&&(t.name===i.sortBy||t.name===l&&!this.exactMatch)&&(d=!0);var c=bizagi.util.getColumnType(r.type),u="radio"===c&&r.horizontal;return e.fasttmpl(i.template.column,e.extend({},t,{isKey:t.key,sortActive:d,sortType:i.sortOrder,isSortable:s,tooltip:t.tooltip||"",columnCssClass:a,headerLabelStyles:i.headerStyles?i.headerStyles.label:"",headerStyles:n,controlType:c,isHorizontalRadio:u,columnAlign:o,flexAlign:bizagi.util.mapAlignClassName(o)}))},drawSpecialColumn:function(){var t=this.options;return e.fasttmpl(t.template.specialColumn)},drawDynamicPager:function(){var t=this.options;return e.fasttmpl(t.template.dynamicPager)},drawBody:function(){var t=this,i="";return e.each(t.data.rows,(function(e,r){i+=t.drawRow(r)})),i},drawRow:function(t,i){var r=this,a=r.options,n=t[r.columnKeyIndex],o=i||!1,s=Math.floor(1e4*Math.random()),l=e.fasttmpl(a.template.row,{key:s,isNewRow:i,businessKey:n}),d="";return e.each(t,(function(e,t){r.options.maxColumns>0?e<r.options.maxColumns+1&&(d+=r.drawCell(e,n,t,o)):d+=r.drawCell(e,n,t,o)})),r.options.maxColumns>0&&r._canShowRowButtons()&&(d+=r.drawSpecialCell(r.options.maxColumns+1)),l=r._replaceElement(l,"cells",d)},drawSummary:function(){var t=this,i=t.options,r=e.fasttmpl(i.template.summary),a="";return e.each(i.columns,(function(e,i){t.options.maxColumns>0?e<=t.options.maxColumns&&(a+=t.drawSummaryCell(i)):a+=t.drawSummaryCell(i)})),r=t._replaceElement(r,"summary-cells",a)},drawSummaryCell:function(t){var i=this.options,r=t.bizAgiProperties||{},a=r.columnAlign?r.columnAlign:"center",n=e.fasttmpl(i.template.summaryCell,{hidden:t.hidden||!1,summarizeBy:t.summarizeBy,cellAlign:a}),o=this.onDrawCell(t,"summary",this.calculateSummary(t),!1);return(o=null!=o&&"number"!=typeof o?o.replace("summaryValue",this.calculateSummary(t)):o)||(o=""),"object"===_typeof(o)&&o.done?"resolved"===o.state()?n=this._replaceElement(n,"cellContent",this.resolveResult(o)):(n=this._replaceElement(n,"cellContent",""),this.asyncCells[key+"-"+columnIndex]=o):n=this._replaceElement(n,"cellContent",o),n},drawCell:function(t,i,r,a){var n=this.options;a=a||!1;var o="";if(!this.columnByIndex[t])return"";t>0&&(o=this.columnByIndex[t].bizAgiProperties&&this.columnByIndex[t].bizAgiProperties.messageValidation);var s=this.columnByIndex[t].bizAgiProperties||{},l=s.cssclass?s.cssclass:"",d=s.columnAlign?s.columnAlign:"center",c=bizagi.util.getColumnType(s.type),u="radio"===c&&s.horizontal,p=e.fasttmpl(n.template.cell,{isKey:this.columnByIndex[t].key,hidden:n.columns[t].hidden||!1,isDesign:"design"===n.mode,messageValidation:o,columnCssClass:l,id:n.columns[t].bizAgiProperties?n.columns[t].bizAgiProperties.id:void 0,cellAlign:d,flexAlign:bizagi.util.mapAlignClassName(d),controlType:c,isHorizontalRadio:u}),h=this.onDrawCell(this.columnByIndex[t],i,r,a);return h||(h=""),"object"===_typeof(h)&&h.done?"resolved"===h.state()?p=this._replaceElement(p,"cellContent",this.resolveResult(h)):(p=this._replaceElement(p,"cellContent",""),this.asyncCells[i+"-"+t]=h):p=this._replaceElement(p,"cellContent",h),this.columnByIndex[t].cell=e(p),p},resolveResult:function(e){var t;return e.done((function(e){t=e})),t},drawSpecialCell:function(t){var i=this.options;return e.fasttmpl(i.template.specialCell)},drawGroupHeader:function(){},drawFooter:function(){},drawPager:function(){for(var t=this.options,i=[],r=1;r<=this.data.total;r++)i.push({number:r,active:r==this.data.page});return e.fasttmpl(t.template.pager,{page:this.data.page,pages:i,records:this.data.records})},drawButtons:function(){var t=this.options,i=t.tooltips||{},r=e.extend(t.actions,i);return this._canShowButtons()?"rtl"===t.orientation?e.fasttmpl(t.template.buttonsRtl,r):e.fasttmpl(t.template.buttons,r):""},drawGridExportOptions:function(){var t=this.options,i=t.actions,r=t.tooltips||{},a=e.extend({orientation:t.orientation,enableXlsExport:i.enableXlsExport,enablePdfExport:i.enablePdfExport},r);return e.fasttmpl(t.template.exportOptions,a)},drawRowButtons:function(){var t=this.options;return this._canShowRowButtons()?"rtl"===t.orientation?e.fasttmpl(t.template.rowButtons.rtl,t.actions):e.fasttmpl(t.template.rowButtons,t.actions):""},postRender:function(){var t=this,i=t.options,r=t._getComponent("cells");if(r&&e.each(r,(function(i,r){r=e(r),t.postRenderRow(r)})),i.showSummary){var a=t._getComponent("summary");t.postRenderSummary(a)}t._triggerHandler("gridControlReady")},postRenderRow:function(t){var i=this,r=t.attr("data-business-key"),a=t.attr("data-new-row"),n=t.is("[data-bizagi-component=cells]")?t.children():t.find("[data-bizagi-component=cells]").children();e.each(n,(function(t,n){var o=i.columnByIndex[t];if(void 0!==o&&!o.key){var s=i.asyncCells[r+"-"+o.index];s?e.when(s).done((function(t){(n=e(n)).append(t),i.onCellReady(o,r,n,a)})):i.onCellReady(o,r,e(n),a)}}))},postRenderSummary:function(t){var i=this,r=t.is("[data-bizagi-component=summary-cells]")?t.children():t.find("[data-bizagi-component=summary-cells]").children();e.each(r,(function(t,r){var a=i.columnByIndex[t];if(!a.key){var n=i.asyncCells[key+"-"+a.index];n?e.when(n).done((function(t){(r=e(r)).append(t),i.onCellReady(a,"summary",r,!1)})):i.onCellReady(a,"summary",e(r),!1)}}))},attachHandlers:function(){},selectDynamicPager:function(){this.onDynamicPager()},changePage:function(e){var t=Number(this.data.page),i=this.data.total,r=e;if("previous"===e){if(!(t>1))return;r=t-1}if("next"===e){if(!(t<i))return;r=t+1}this._cleanComponents(),this.page=Number(r),this.onPageRequested()},getCurrentPage:function(){return(this.data||{}).page||1},isValid:function(){return this._triggerHandler("isValid")},sortBy:function(e,t){var i=this.options,r=this.columnByIndex[e];if(void 0===i.sortBy)return!0;void 0===r.name&&(r.name=r.label),t=r.name==i.sortBy?t||("asc"==i.sortOrder?"desc":"asc"):r.name==i.sortBy.split(".")[0]?t||("asc"==i.sortType?"desc":"asc"):t||i.sortType,i.sortBy.split(".").length>1?(i.sortBy.split(".")[0],r.name,i.sortBy=r.name):i.sortBy=r.name,void 0!==r.bizAgiProperties.sortAttribute&&-1!==r.bizAgiProperties.type.indexOf("column")&&(i.sortBy=r.name+"."+r.bizAgiProperties.sortAttribute),i.sortColumn=r,i.sortType=t,i.sortOrder=t,this._cleanComponents(),this.onSortRequested()},selectRow:function(e,t){this.selectedRow==e?(this.onRowUnselected(),this.selectedRow=0,this.selectedBusinessKey=0):(0!=this.selectedRow&&this.onRowUnselected(),this.selectedRow=e,this.selectedBusinessKey=t,this.onRowSelected())},unselectRow:function(){0!=this.selectedRow&&(this.onRowUnselected(),this.selectedRow=0,this.selectedBusinessKey=0)},calculateSummary:function(t){var r=this,a=t.summarizeBy;e.each(r.data.rows,(function(e,i){void 0!==r.data.rows[e][t.index]&&null==r.data.rows[e][t.index]&&null!=t.bizAgiProperties.defaultvalue&&(r.data.rows[e][t.index]=t.bizAgiProperties.defaultvalue)}));var n,o=e.map(r.data.rows,(function(e,i){return e[t.index]}));if(0==o.length)return 0;if("sum"===a)n=0,e.each(o,(function(e,t){null!=t&&(n+=Number(t))}));else if("min"===a)n=o[0]||0,e.each(o,(function(e,t){"number"==typeof t&&null!=t&&t<n&&(n=Number(t))})),n===Math.max()&&(n=null);else if("max"===a)n=o[0]||0,e.each(o,(function(e,t){"number"==typeof t&&null!=t&&t>n&&(n=Number(t))})),n===Math.min()&&(n=null);else if("avg"===a)n=0,e.each(o,(function(e,t){null!=t&&(n+=Number(t))})),n/=o.length;else if("count"===a)for(n=0,o=r.data.rows,i=0;i<o.length;i++){var s=o[i][t.index];s instanceof Array&&s.length>0?n+=1:s instanceof Array||null===s||""===s||(n+=1)}return n},processAction:function(e,t){var i=t&&t.key?t.key:this.selectedBusinessKey;"edit"===e&&this.onEditRow(i),"remove"===e&&this.onDeleteRow(i),"more"===e&&this.onShowMore(i),"details"===e&&this.onShowDetails(i),"add"===e&&this.onAddRow(),"show-grid-export-options"===e&&this.onShowExportGridOptions()},onPageRequested:function(){return this.startLoading(),this._triggerHandler("pageRequested",this._buildRefreshParameters())},onSortRequested:function(){return this.startLoading(),this._triggerHandler("sortRequested",this._buildRefreshParameters())},onRowSelected:function(){return this._triggerHandler("rowSelected",{key:this.selectedBusinessKey})},onRowUnselected:function(){return this._triggerHandler("rowUnselected",{key:this.selectedBusinessKey})},onCollapseGrid:function(){return this._triggerHandler("performCollapseGrid")},onDynamicPager:function(){return this._triggerHandler("moreRows",{key:this.selectedBusinessKey})},onDrawCell:function(e,t,i,r){return this._triggerHandler("drawCell",{column:e,key:t,value:i,isNewRow:r})},onCellReady:function(e,t,i,r){return this._triggerHandler("cellReady",{column:e,key:t,cell:i,isNewRow:r})},onDrawControl:function(){},onDrawGroupHeader:function(){},onAddRow:function(){return this._triggerHandler("addRow")},onEditRow:function(e){return this._triggerHandler("editRow",{key:e})},onDeleteRow:function(e){return this._triggerHandler("deleteRow",{key:e})},onShowMore:function(e){return this._triggerHandler("showMore",{key:e})},onShowDetails:function(e){return this._triggerHandler("showFormDetails",{key:e})},onShowExportGridOptions:function(){return this._triggerHandler("showGridExportOptions")},_replaceElement:function(e,t,i){return e.replaceFirstWithoutPatterns("{{element "+t+"}}",i)},_buildRefreshParameters:function(){var e=this.options,t=null!=e.sortColumn?e.sortColumn.index:1;return{page:this.page,sortBy:e.sortBy,sortType:e.sortOrder,sortColumnIndex:t}},_triggerHandler:function(e,t){var i=this.options[e];return i?i.call(this.element[0],t):null},_getComponent:function(t){var i=this.element;if(!this.components[t]){var r=e("[data-bizagi-component="+t+"]",i);null!=r&&r.length>0&&(this.components[t]=r)}return this.components[t]},_getButton:function(t){var i=this.element;return this.buttons[t]||(this.buttons[t]=e("[data-action="+t+"]",i)),this.buttons[t]},_cleanComponents:function(){this.components={}},_cleanButtons:function(){this.buttons={}},_canShowButtons:function(){return!0},_canShowRowButtons:function(){return!0}})}(jQuery),function(t){function i(e,t,i){var a=r(e,t,i),n=a.tabsMetaInfo,o=a.tabMetaInfo,s=0;if(n&&o){var l="rtl"===i?n.scrollLeftNormalized+n.clientWidth-n.scrollWidth:n.scrollLeft;s=o.left-n.left+l}return{left:s,width:o?o.width:0}}function r(e,t,i){var r=void 0;if(e){var n=e.getBoundingClientRect();r={clientWidth:e?e.clientWidth:0,scrollLeft:e?e.scrollLeft:0,scrollLeftNormalized:e?a(e,i):0,scrollWidth:e?e.scrollWidth:0,left:n.left,right:n.right}}var o=void 0;return e&&!1!==t&&(o=t.getBoundingClientRect()),{tabsMetaInfo:r,tabMetaInfo:o}}function a(t,i){var r=t.scrollLeft;if("rtl"!==i)return r;var a=function(e){if(!e||!window.document.body)return"indeterminate";var t=window.document.createElement("div");t.appendChild(document.createTextNode("ABCD")),t.dir="rtl",t.style.fontSize="14px",t.style.width="4px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.overflow="scroll",document.body.appendChild(t),type="reverse",t.scrollLeft>0?type="default":(t.scrollLeft=1,0===t.scrollLeft&&(type="negative"));return document.body.removeChild(t),type}(t);if("indeterminate"===a)return Number.NaN;switch(a){case"negative":return e.scrollWidth-e.clientWidth+r;case"reverse":return e.scrollWidth-e.clientWidth-r}return r}t.fn.material_bizagi_tabs=function(e,a){var n=t.extend({},t.fn.material_bizagi_tabs.defaults,e),o={index:0,tabs:[],$el:void 0,$active:void 0,$active_content:void 0,init:function(e,a){var o,s=this,l=t(">ul.bz-tabs",e),d=s.$el=t(e);function c(e,t){if(void 0!==t){var a=i(l.get(0),e.get(0),n.direction);t.css("left",a.left).css("width",a.width)}var o=scrollSelectedIntoView(l.get(0),e.get(0),n.direction);l.scrollLeft(o),l.trigger("updatePositions",r(l.get(0),e.get(0),n.direction))}s.index=n.active_index_tab,t(">li.bz-tab",l).each((function(e,i){e===n.active_index_tab?(s.$active=t(this),s.$active.addClass("active")):t(t(i).data("reference"),d).hide(),s.tabs.push({index:e,element:i})})),s.$active_content=t(s.$active.data("reference"),d),c(s.$active),l.on("click","> li.bz-tab",(function(e){if(e.stopPropagation(),void 0===o){o=t("<li class='bz-indicator-bar'></li>");var r=i(l.get(0),s.$active.get(0),n.direction);o.css("left",r.left).css("width",r.width),o=l.prepend(o).find(".bz-indicator-bar")}s.$active.removeClass("active"),s.$active_content.hide(),s.$active=t(this);var a=s.$active.data("reference");s.index=s.$active.data("index"),s.$active_content=t(a,d),s.$active.addClass("active"),c(s.$active,o),l.trigger("updateActive",{index:s.index}),s.$active_content.show(),e.preventDefault()}))},getActiveTab:function(){return{index:this.index,tab:this.$active,contantTab:this.$active_content}},moveToNextTab:function(){var e=this.index+1<this.tabs.length?this.index+1:0;this.tabs[e].element.click()},refreshPositions:function(){this.tabs[this.index].element.click()},refreshTab:function(e){var i=this.tabs.find((function(i){var r=t(i.element).data("reference");return r&&-1!==r.indexOf(e)}));if(i)if(i.index===this.index){this.$active=t(i.element),this.$active.addClass("active");var r=this.$el,a=this.$active.data("reference");this.index=this.$active.data("index"),this.$active_content=t(a,r)}else t(t(i.element).data("reference"),this.$el).hide()}};return"string"==typeof e&&e?(void 0===(o=t(this).data("base"))&&console.error("this plugin is has not been initialized!!"),o[e](a)):this.each((function(){o.init(this,a),t(this).data("base",o)}))},t.fn.material_bizagi_tabs.defaults={direction:"ltr",active_index_tab:0},scrollSelectedIntoView=function(e,t,i){var a=r(e,t,i),n=a.tabsMetaInfo,o=a.tabMetaInfo;if(o&&n){var s=void 0;return o.left<n.left?s=n.scrollLeft+(o.left-n.left):o.right>n.right&&(s=n.scrollLeft+(o.right-n.right)),s}}}($),function(e){e.widget("ui.bizagi_grid_tablet",e.ui.bizagi_grid,{_init:function(){this._super(),this.isOfflineForm=void 0!==this.options.isOfflineForm&&bizagi.util.parseBoolean(this.options.isOfflineForm)},attachHandlers:function(){var t=this;t._getComponent("pager").find("ul li button").bind("click",(function(){var i=parseInt(e(this).attr("data-page-number"));i&&t.changePage(i)})),t._getComponent("dynamicPager").find("input").bind("click",(function(){t.selectDynamicPager()})),t._getComponent("columns").find(".bz-tablet-grid__label.bz-table__column-sort").bind("click",(function(){if(!t.isOfflineForm){var i=e(this).attr("data-column-index");t.sortBy(i)}})),t._getComponent("buttons").find("[data-action]").bind("click",(function(){"totalizer"===e(this).attr("data-action")?t.totalizer():(t.processAction(e(this).attr("data-action")),t.unselectRow())})),t._getComponent("rowButtons").find("[data-action]").bind("click",(function(){t.processAction(e(this).attr("data-action")),t.unselectRow()})),bizagi.util.isiOSDevice()&&t._resizeListener(),this.isOfflineForm?t._getComponent("rows").on("click",".bz-tablet-grid__cell-actions [data-action=more]",(function(i){var r=e(i.target).parents("[data-bizagi-component=cells]");if(r&&r.hasClass("bz-tablet-grid__row")){var a=r.attr("data-business-key");bizagi.util.parseBoolean(r.attr("data-new-row"))||!1?t.onRemoveNewRow(a):t.processAction("remove",{key:a})}})):(t._getComponent("rows").find("tr").bind("click",(function(i){var r=e(i.target).closest(".bz-tablet-grid__cell");if(i.stopPropagation(),r&&r.hasClass("bz-tablet-grid__cell")){var a=e(this).attr("data-key"),n=e(this).attr("data-business-key");t.selectRow(a,n)}})),t._addColumnActions())},totalizer:function(){this.options.totalData()},onRowSelected:function(){e.ui.bizagi_grid.prototype.onRowSelected.apply(this,arguments),this._showRowButtons()},onRowUnselected:function(){e.ui.bizagi_grid.prototype.onRowUnselected.apply(this,arguments),this._hideRowButtons()},getCell:function(t,i,r){var a,n=this._getComponent("rows").find("[data-business-key="+t+"]");return a=e("td",e(n))[r+1],e(a)},_canShowButtons:function(){var e=this.options.actions;return this.isOfflineForm?e.add||e.remove||e.edit||e.inlineAdd:e.add||e.hasTotalizer},drawRow:function(t,i){var r=this,a=r.options,n=t[r.columnKeyIndex],o=i||!1,s=Math.floor(1e4*Math.random()),l=e.fasttmpl(a.template.row,{key:s,isNewRow:i,businessKey:n}),d="";return e.each(t,(function(e,t){d+=r.drawCell(e,n,t,o)})),r._canShowRowButtons()&&(d+=r.drawSpecialCell(r.options.columns.length+1)),l=r._replaceElement(l,"cells",d)},drawPager:function(){for(var t=this.options,i=[],r=1;r<=this.data.total;r++)i.push({number:r,active:r==this.data.page});var a={renderPages:this.data.page<3||this.data.page>this.data.total-2?[]:[this.data.page-1,this.data.page,this.data.page+1],pages:i,pagination:{totalPages:this.data.total,currentPage:this.data.page}};return e.fasttmpl(t.template.pager,a)},_canShowRowButtons:function(){var e=this.options.actions;return this.isOfflineForm?e.remove:e.edit||e.details||e.remove||"adhocGrid"==this.options.subType},_showRowButtons:function(){window.document;this.element.find("[data-bizagi-component=rows] tr[data-key="+this.selectedRow+"]").addClass("ui-bizagi-state-selected")},_hideRowButtons:function(){var t=this;e.ui.bizagi_grid.prototype.onRowUnselected.apply(t,arguments);var i=t._getComponent("rows").find("tr[data-key="+t.selectedRow+"]");if(i.removeClass("ui-bizagi-state-selected"),!t.isOfflineForm){var r=t._getComponent("rowButtons");r.hide()}},getNewRowKeys:function(t){return t=t||this._getComponent("rows").find("[data-new-row=true]"),e.map(t,(function(t,i){return e(t).data("business-key")}))},processAction:function(t){var i=this;e.ui.bizagi_grid.prototype.processAction.apply(i,arguments),"save"===t&&i.onSaveAddedRows(),"cancel"===t&&i.onCancelEdition()},isNewRecord:function(t){var i=this._getComponent("rows");return!(!i||(t=i.find("[data-business-key='"+t+"']"),!e(t).data("new-row")))},addInlineRow:function(){this._triggerHandler("beforeInlineAdd");var t=this.drawRow(this.createAddRowData(),!0),i=e(t);this.postRenderRow(i),this._getComponent("rows").append(i);var r=this._getComponent("buttons");this.isOfflineForm?(r.find("[data-action=save]").removeClass("bz-tablet-grid__buttons--hidden"),r.find("[data-action=cancel]").removeClass("bz-tablet-grid__buttons--hidden")):(r.find("[data-action=save]").css("display","inline-block"),r.find("[data-action=cancel]").css("display","inline-block")),0===this.data.rows.length&&(this._getComponent("table").show(),this._getComponent("emptyTable").hide()),this._triggerHandler("afterInlineAdd",i.data())},createAddRowData:function(){var t=this,i=t.options,r=[];return e.each(i.columns,(function(e){if(e===t.columnKeyIndex){var i=Math.ceil(1e5*Math.random());r.push(i)}else r.push(null)})),r},onAddRow:function(){if(this.options.actions.add)return this.options.actions.inlineAdd?this.addInlineRow():this._triggerHandler("addRow")},onCancelEdition:function(){var e=this._getComponent("rows").find("[data-new-row=true]"),t=this._getComponent("rows").find("[data-new-row=false]");e.detach();var i=this._getComponent("buttons");return this.isOfflineForm?(i.find("[data-action=save]").addClass("bz-tablet-grid__buttons--hidden"),i.find("[data-action=cancel]").addClass("bz-tablet-grid__buttons--hidden")):(i.find("[data-action=save]").hide(),i.find("[data-action=cancel]").hide()),0===t.length&&(this._getComponent("table").hide(),this._getComponent("emptyTable").show()),this._triggerHandler("cancelEdition",{keys:this.getNewRowKeys(e)})},onSaveAddedRows:function(){var t=this.getNewRowKeys(),i=this._getComponent("buttons");if(t.length>=1&&this.isValid()){var r=this._getComponent("rows");return this.isOfflineForm?(e.each(t,(function(t,i){var a=r.find("[data-business-key='"+i+"']");e(a).attr("data-new-row","false")})),i.find("[data-action=save]").addClass("bz-tablet-grid__buttons--hidden"),i.find("[data-action=cancel]").addClass("bz-tablet-grid__buttons--hidden"),this._triggerHandler("saveAddedRows",{keys:t}),!0):(i.find("[data-action=save]").hide(),i.find("[data-action=cancel]").hide(),this._triggerHandler("saveAddedRows",{keys:t}),this._triggerHandler("removeNewRecords",{keys:t}))}return!0},hideHeaderButtons:function(){var e=this._getComponent("buttons");e&&e.length&&(e.find("[data-action=save]").addClass("bz-tablet-grid__buttons--hidden"),e.find("[data-action=cancel]").addClass("bz-tablet-grid__buttons--hidden"))},_addColumnActions:function(){var t=this,i=[];t.options.actions.details&&i.push({name:bizagi.localization.getResource("render-collection-navigator-details-form"),fn:function(i){var r=e(i).parents("[data-bizagi-component=cells]").attr("data-business-key");t.options.actions.details?t.processAction("details",{key:r}):t.processAction("more",{key:r})}}),t.options.actions.edit&&i.push({name:bizagi.localization.getResource("render-grid-edit-label"),fn:function(i){var r=e(i).parents("[data-bizagi-component=cells]").attr("data-business-key");t.processAction("edit",{key:r})}}),t.options.actions.remove&&i.push({name:bizagi.localization.getResource("render-ecm-confirm-bt-delete"),fn:function(i){var r=e(i).parents("[data-bizagi-component=cells]").attr("data-business-key");t.processAction("remove",{key:r})}}),t._getComponent("rows").find("[data-action=more]").overflowMenu({items:i})},onRemoveNewRow:function(e){var t=this._getComponent("buttons"),i=this._getComponent("rows").find("tr[data-business-key="+e+"]"),r=this._getComponent("rows").find("[data-new-row=false]"),a=this._getComponent("rows").find("[data-new-row=true]");return i.detach(),1===a.length&&(t.find("[data-action=save]").addClass("bz-tablet-grid__buttons--hidden"),t.find("[data-action=cancel]").addClass("bz-tablet-grid__buttons--hidden")),0===r.length&&1===a.length&&(this._getComponent("table").hide(),this._getComponent("emptyTable").show()),this._triggerHandler("cancelEdition",{keys:this.getNewRowKeys(i)})},_replaceElement:function(e,t,i){return e.replace(new RegExp("{{element "+t+"}}","g"),i)},_resizeListener:function(){var t=Math.ceil(1e5*Math.random()),i=0,r=this,a=r._getComponent("table"),n=new IntersectionObserver((function(n){n.forEach((function(i){i.isIntersecting?e(window).on("resize."+t,r._fixHorizontalScroll.bind(r)):e(window).off("resize."+t)})),i!=a.width()&&(i=a.width(),r._fixHorizontalScroll())}));n.POLL_INTERVAL=100,n.observe(r._getComponent("table").get(0))},_fixHorizontalScroll:function(){var e=this._getComponent("table");e.css({webkitOverflowScrolling:"auto","overflow-x":"hidden"}),setTimeout((function(){e.css({webkitOverflowScrolling:"touch","overflow-x":"auto"})}),10)}})}(jQuery),function(e){var t=0,i=[];e.fn.overflowMenu=function(n){return this.each((function(){var o=this;o.id=t++;var s=(n=n||{}).items||[],l=null;function d(t,i){var r=t.getAttribute("data-overflowmenuitem");s[r]&&s[r].fn(l),e(o.menu).remove(),i.preventDefault(),i.stopPropagation()}o.menu=document.createElement("ul"),o.menu.setAttribute("style","position: fixed;"),o.menu.className="bz-overflow-menu",o.menu.setAttribute("data-overflowmenu",o.id),s.forEach((function(e,t){var i=document.createElement("li");"name"in e?(i.className="bz-overflow-menu__item bz-overflow-menu__item--comfortable",i.textContent=e.name,i.setAttribute("data-overflowmenuitem",t),i.setAttribute("tabindex",0),i.addEventListener("touchend",d.bind(this,i))):i.className="bz-overflow-menu__divider",o.menu.appendChild(i)})),e(o).bind("click",(function(t){var n=a(e(t.currentTarget));e(o.menu).css("z-index",n),function(t){l=t.delegateTarget;var a=t.originalEvent.clientX,n=t.originalEvent.clientY,s=e(t.delegateTarget).closest(".bz-section__content");0==s.length&&(s=e("body")),setTimeout((function(){if(s.append(o.menu),r.W()-a<o.menu.offsetWidth)var t=a-o.menu.offsetWidth;else t=a;if(r.H()-n<o.menu.offsetHeight)var l=n-o.menu.offsetHeight;else l=n;o.menu.style.left=t+"px",o.menu.style.top=l+"px",e(o.menu).focus(),i.push(o.menu)}),100)}(t)}))}))};var r={W:function(){return document.documentElement.clientWidth},H:function(){return document.documentElement.clientHeight}},a=function t(i){if(i.get(0)===e("body").get(0))return 2;var r=e(i).parent(),a=parseFloat(r.css("z-index"),-1);return a>-1?a:t(r)};document.addEventListener("touchstart",(function(t){t.target&&!/bz-overflow-menu__item/i.test(t.target.className)&&(i&&i.length>0&&i.forEach((function(t){e(t).remove()})),i=[])}))}(jQuery),function(e,t){var i,r,a=0,n=/^ui-id-\d+$/;function o(t,i){var r,a,n,o=t.nodeName.toLowerCase();return"area"===o?(a=(r=t.parentNode).name,!(!t.href||!a||"map"!==r.nodeName.toLowerCase())&&(!!(n=e("img[usemap=#"+a+"]")[0])&&s(n))):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o&&t.href||i)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter((function(){return"hidden"===e.css(this,"visibility")})).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:(i=e.fn.focus,function(t,r){return"number"==typeof t?this.each((function(){var i=this;setTimeout((function(){e(i).focus(),r&&r.call(i)}),t)})):i.apply(this,arguments)}),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter((function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))})).eq(0):this.parents().filter((function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))})).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,r,a=e(this[0]);a.length&&a[0]!==document;){if(("absolute"===(i=a.css("position"))||"relative"===i||"fixed"===i)&&(r=parseInt(a.css("zIndex"),10),!isNaN(r)&&0!==r))return r;a=a.parent()}return 0},uniqueId:function(){return this.each((function(){this.id||(this.id="ui-id-"+ ++a)}))},removeUniqueId:function(){return this.each((function(){n.test(this.id)&&e(this).removeAttr("id")}))}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo((function(t){return function(i){return!!e.data(i,t)}})):function(t,i,r){return!!e.data(t,r[3])},focusable:function(t){return o(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),r=isNaN(i);return(r||i>=0)&&o(t,!r)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],(function(t,i){var r="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),n={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};function o(t,i,a,n){return e.each(r,(function(){i-=parseFloat(e.css(t,"padding"+this))||0,a&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),n&&(i-=parseFloat(e.css(t,"margin"+this))||0)})),i}e.fn["inner"+i]=function(t){return void 0===t?n["inner"+i].call(this):this.each((function(){e(this).css(a,o(this,t)+"px")}))},e.fn["outer"+i]=function(t,r){return"number"!=typeof t?n["outer"+i].call(this,t):this.each((function(){e(this).css(a,o(this,t,!0,r)+"px")}))}})),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=(r=e.fn.removeData,function(t){return arguments.length?r.call(this,e.camelCase(t)):r.call(this)})),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",(function(e){e.preventDefault()}))},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,r){var a,n=e.ui[t].prototype;for(a in r)n.plugins[a]=n.plugins[a]||[],n.plugins[a].push([i,r[a]])},call:function(e,t,i){var r,a=e.plugins[t];if(a&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;r<a.length;r++)e.options[a[r][0]]&&a[r][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var r,a=i&&"left"===i?"scrollLeft":"scrollTop";return t[a]>0||(t[a]=1,r=t[a]>0,t[a]=0,r)}})}(jQuery),function(e,t){var i=0,r=Array.prototype.slice,a=e.cleanData;e.cleanData=function(t){for(var i,r=0;null!=(i=t[r]);r++)try{e(i).triggerHandler("remove")}catch(e){}a(t)},e.widget=function(t,i,r){var a,n,o,s,l={},d=t.split(".")[0];t=t.split(".")[1],a=d+"-"+t,r||(r=i,i=e.Widget),e.expr[":"][a.toLowerCase()]=function(t){return!!e.data(t,a)},e[d]=e[d]||{},n=e[d][t],o=e[d][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,n,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),(s=new i).options=e.widget.extend({},s.options),e.each(r,(function(t,r){var a,n;e.isFunction(r)?l[t]=(a=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)},function(){var e,t=this._super,i=this._superApply;return this._super=a,this._superApply=n,e=r.apply(this,arguments),this._super=t,this._superApply=i,e}):l[t]=r})),o.prototype=e.widget.extend(s,{widgetEventPrefix:n?s.widgetEventPrefix:t},l,{constructor:o,namespace:d,widgetName:t,widgetFullName:a}),n?(e.each(n._childConstructors,(function(t,i){var r=i.prototype;e.widget(r.namespace+"."+r.widgetName,o,i._proto)})),delete n._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(t){for(var i,a,n=r.call(arguments,1),o=0,s=n.length;o<s;o++)for(i in n[o])a=n[o][i],n[o].hasOwnProperty(i)&&void 0!==a&&(e.isPlainObject(a)?t[i]=e.isPlainObject(t[i])?e.widget.extend({},t[i],a):e.widget.extend({},a):t[i]=a);return t},e.widget.bridge=function(t,i){var a=i.prototype.widgetFullName||t;e.fn[t]=function(n){var o="string"==typeof n,s=r.call(arguments,1),l=this;return n=!o&&s.length?e.widget.extend.apply(null,[n].concat(s)):n,o?this.each((function(){var i,r=e.data(this,a);return r?e.isFunction(r[n])&&"_"!==n.charAt(0)?(i=r[n].apply(r,s))!==r&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0:e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+n+"'")})):this.each((function(){var t=e.data(this,a);t?t.option(n||{})._init():e.data(this,a,new i(n,this))})),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var r,a,n,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},r=t.split("."),t=r.shift(),r.length){for(a=o[t]=e.widget.extend({},this.options[t]),n=0;n<r.length-1;n++)a[r[n]]=a[r[n]]||{},a=a[r[n]];if(t=r.pop(),void 0===i)return void 0===a[t]?null:a[t];a[t]=i}else{if(void 0===i)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,r){var a,n=this;"boolean"!=typeof t&&(r=i,i=t,t=!1),r?(i=a=e(i),this.bindings=this.bindings.add(i)):(r=i,i=this.element,a=this.widget()),e.each(r,(function(r,o){function s(){if(t||!0!==n.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof o?n[o]:o).apply(n,arguments)}"string"!=typeof o&&(s.guid=o.guid=o.guid||s.guid||e.guid++);var l=r.match(/^(\w+)\s*(.*)$/),d=l[1]+n.eventNamespace,c=l[2];c?a.delegate(c,d,s):i.bind(d,s)}))},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){var i=this;return setTimeout((function(){return("string"==typeof e?i[e]:e).apply(i,arguments)}),t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,r){var a,n,o=this.options[t];if(r=r||{},(i=e.Event(i)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(a in n)a in i||(i[a]=n[a]);return this.element.trigger(i,r),!(e.isFunction(o)&&!1===o.apply(this.element[0],[i].concat(r))||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},(function(t,i){e.Widget.prototype["_"+t]=function(r,a,n){"string"==typeof a&&(a={effect:a});var o,s=a?!0===a||"number"==typeof a?i:a.effect||i:t;"number"==typeof(a=a||{})&&(a={duration:a}),o=!e.isEmptyObject(a),a.complete=n,a.delay&&r.delay(a.delay),o&&e.effects&&e.effects.effect[s]?r[t](a):s!==t&&r[s]?r[s](a.duration,a.easing,n):r.queue((function(i){e(this)[t](),n&&n.call(r[0]),i()}))}}))}(jQuery),function(e,t){var i=!1;e(document).mouseup((function(){i=!1})),e.widget("ui.mouse",{version:"1.10.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,(function(e){return t._mouseDown(e)})).bind("click."+this.widgetName,(function(i){if(!0===e.data(i.target,t.widgetName+".preventClickEvent"))return e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1})),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!i){this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,a=1===t.which,n=!("string"!=typeof this.options.cancel||!t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(a&&!n&&this._mouseCapture(t))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout((function(){r.mouseDelayMet=!0}),this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(t),!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),i=!0,!0))}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return!(this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(t),!!this.handle&&(e(!0===i.iframeFix?"iframe":i.iframeFix).each((function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")})),!0))},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var r=this._uiHash();if(!1===this._trigger("drag",t,r))return this._mouseUp({}),!1;this.position=r.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i,r=this,a=!1,n=!1;for(e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1),i=this.element[0];i&&(i=i.parentNode);)i===document&&(a=!0);return!(!a&&"original"===this.options.helper)&&("invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),(function(){!1!==r._trigger("stop",t)&&r._clear()})):!1!==this._trigger("stop",t)&&this._clear(),!1)},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each((function(){this.parentNode.removeChild(this)})),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_createHelper:function(t){var i=this.options,r=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),r[0]===this.element[0]||/(fixed|absolute)/.test(r.css("position"))||r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,r,a=this.options;if("parent"===a.containment&&(a.containment=this.helper[0].parentNode),"document"!==a.containment&&"window"!==a.containment||(this.containment=["document"===a.containment?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"===a.containment?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"===a.containment?0:e(window).scrollLeft())+e("document"===a.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"===a.containment?0:e(window).scrollTop())+(e("document"===a.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(a.containment)||a.containment.constructor===Array)a.containment.constructor===Array&&(this.containment=a.containment);else{if(!(r=(i=e(a.containment))[0]))return;t="hidden"!==e(r).css("overflow"),this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderRightWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderBottomWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(t,i){i||(i=this.position);var r="absolute"===t?1:-1,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:a.scrollTop())*r,left:i.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:a.scrollLeft())*r}},_generatePosition:function(t){var i,r,a,n,o=this.options,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(s[0].tagName),d=t.pageX,c=t.pageY;return this.originalPosition&&(this.containment&&(this.relative_container?(r=this.relative_container.offset(),i=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(d=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(c=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(d=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(c=i[3]+this.offset.click.top)),o.grid&&(a=o.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,c=i?a-this.offset.click.top>=i[1]||a-this.offset.click.top>i[3]?a:a-this.offset.click.top>=i[1]?a-o.grid[1]:a+o.grid[1]:a,n=o.grid[0]?this.originalPageX+Math.round((d-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,d=i?n-this.offset.click.left>=i[0]||n-this.offset.click.left>i[2]?n:n-this.offset.click.left>=i[0]?n-o.grid[0]:n+o.grid[0]:n)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:s.scrollTop()),left:d-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:s.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[i,r]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var r=e(this).data("ui-draggable"),a=r.options,n=e.extend({},i,{item:r.element});r.sortables=[],e(a.connectToSortable).each((function(){var i=e.data(this,"ui-sortable");i&&!i.options.disabled&&(r.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,n))}))},stop:function(t,i){var r=e(this).data("ui-draggable"),a=e.extend({},i,{item:r.element});e.each(r.sortables,(function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===r.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,a))}))},drag:function(t,i){var r=e(this).data("ui-draggable"),a=this;e.each(r.sortables,(function(){var n=!1,o=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(n=!0,e.each(r.sortables,(function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(o.instance.element[0],this.instance.element[0])&&(n=!1),n}))),n?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(a).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)}))}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("ui-draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var r=e(i.helper),a=e(this).data("ui-draggable").options;r.css("opacity")&&(a._opacity=r.css("opacity")),r.css("opacity",a.opacity)},stop:function(t,i){var r=e(this).data("ui-draggable").options;r._opacity&&e(i.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("ui-draggable"),r=i.options,a=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(r.axis&&"x"===r.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?i.scrollParent[0].scrollTop=a=i.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-i.overflowOffset.top<r.scrollSensitivity&&(i.scrollParent[0].scrollTop=a=i.scrollParent[0].scrollTop-r.scrollSpeed)),r.axis&&"y"===r.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?i.scrollParent[0].scrollLeft=a=i.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-i.overflowOffset.left<r.scrollSensitivity&&(i.scrollParent[0].scrollLeft=a=i.scrollParent[0].scrollLeft-r.scrollSpeed))):(r.axis&&"x"===r.axis||(t.pageY-e(document).scrollTop()<r.scrollSensitivity?a=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity&&(a=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed))),r.axis&&"y"===r.axis||(t.pageX-e(document).scrollLeft()<r.scrollSensitivity?a=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity&&(a=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed)))),!1!==a&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each((function(){var i=e(this),r=i.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:r.top,left:r.left})}))},drag:function(t,i){var r,a,n,o,s,l,d,c,u,p,h=e(this).data("ui-draggable"),g=h.options,f=g.snapTolerance,m=i.offset.left,b=m+h.helperProportions.width,v=i.offset.top,y=v+h.helperProportions.height;for(u=h.snapElements.length-1;u>=0;u--)l=(s=h.snapElements[u].left)+h.snapElements[u].width,c=(d=h.snapElements[u].top)+h.snapElements[u].height,s-f<m&&m<l+f&&d-f<v&&v<c+f||s-f<m&&m<l+f&&d-f<y&&y<c+f||s-f<b&&b<l+f&&d-f<v&&v<c+f||s-f<b&&b<l+f&&d-f<y&&y<c+f?("inner"!==g.snapMode&&(r=Math.abs(d-y)<=f,a=Math.abs(c-v)<=f,n=Math.abs(s-b)<=f,o=Math.abs(l-m)<=f,r&&(i.position.top=h._convertPositionTo("relative",{top:d-h.helperProportions.height,left:0}).top-h.margins.top),a&&(i.position.top=h._convertPositionTo("relative",{top:c,left:0}).top-h.margins.top),n&&(i.position.left=h._convertPositionTo("relative",{top:0,left:s-h.helperProportions.width}).left-h.margins.left),o&&(i.position.left=h._convertPositionTo("relative",{top:0,left:l}).left-h.margins.left)),p=r||a||n||o,"outer"!==g.snapMode&&(r=Math.abs(d-v)<=f,a=Math.abs(c-y)<=f,n=Math.abs(s-m)<=f,o=Math.abs(l-b)<=f,r&&(i.position.top=h._convertPositionTo("relative",{top:d,left:0}).top-h.margins.top),a&&(i.position.top=h._convertPositionTo("relative",{top:c-h.helperProportions.height,left:0}).top-h.margins.top),n&&(i.position.left=h._convertPositionTo("relative",{top:0,left:s}).left-h.margins.left),o&&(i.position.left=h._convertPositionTo("relative",{top:0,left:l-h.helperProportions.width}).left-h.margins.left)),!h.snapElements[u].snapping&&(r||a||n||o||p)&&h.options.snap.snap&&h.options.snap.snap.call(h.element,t,e.extend(h._uiHash(),{snapItem:h.snapElements[u].item})),h.snapElements[u].snapping=r||a||n||o||p):(h.snapElements[u].snapping&&h.options.snap.release&&h.options.snap.release.call(h.element,t,e.extend(h._uiHash(),{snapItem:h.snapElements[u].item})),h.snapElements[u].snapping=!1)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,i=this.data("ui-draggable").options,r=e.makeArray(e(i.stack)).sort((function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)}));r.length&&(t=parseInt(e(r[0]).css("zIndex"),10)||0,e(r).each((function(i){e(this).css("zIndex",t+i)})),this.css("zIndex",t+r.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var r=e(i.helper),a=e(this).data("ui-draggable").options;r.css("zIndex")&&(a._zIndex=r.css("zIndex")),r.css("zIndex",a.zIndex)},stop:function(t,i){var r=e(this).data("ui-draggable").options;r._zIndex&&e(i.helper).css("zIndex",r._zIndex)}})}(jQuery),function(e,t){function i(e,t,i){return e>t&&e<t+i}e.widget("ui.droppable",{version:"1.10.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t=this.options,i=t.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=0,i=e.ui.ddmanager.droppables[this.options.scope];t<i.length;t++)i[t]===this&&i.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){"accept"===t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var r=i||e.ui.ddmanager.current,a=!1;return!(!r||(r.currentItem||r.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each((function(){var t=e.data(this,"ui-droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope===r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance))return a=!0,!1})),!a&&(!!this.accept.call(this.element[0],r.currentItem||r.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element)))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,t,r){if(!t.offset)return!1;var a,n=(e.positionAbs||e.position.absolute).left,o=n+e.helperProportions.width,s=(e.positionAbs||e.position.absolute).top,l=s+e.helperProportions.height,d=t.offset.left,c=d+t.proportions.width,u=t.offset.top,p=u+t.proportions.height;switch(r){case"fit":return d<=n&&o<=c&&u<=s&&l<=p;case"intersect":return d<n+e.helperProportions.width/2&&o-e.helperProportions.width/2<c&&u<s+e.helperProportions.height/2&&l-e.helperProportions.height/2<p;case"pointer":return a=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,i((e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,u,t.proportions.height)&&i(a,d,t.proportions.width);case"touch":return(s>=u&&s<=p||l>=u&&l<=p||s<u&&l>p)&&(n>=d&&n<=c||o>=d&&o<=c||n<d&&o>c);default:return!1}},e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,i){var r,a,n=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,s=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(r=0;r<n.length;r++)if(!(n[r].options.disabled||t&&!n[r].accept.call(n[r].element[0],t.currentItem||t.element))){for(a=0;a<s.length;a++)if(s[a]===n[r].element[0]){n[r].proportions.height=0;continue e}n[r].visible="none"!==n[r].element.css("display"),n[r].visible&&("mousedown"===o&&n[r]._activate.call(n[r],i),n[r].offset=n[r].element.offset(),n[r].proportions={width:n[r].element[0].offsetWidth,height:n[r].element[0].offsetHeight})}},drop:function(t,i){var r=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),(function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,i)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))})),r},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",(function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}))},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],(function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var r,a,n,o=e.ui.intersect(t,this,this.options.tolerance),s=!o&&this.isover?"isout":o&&!this.isover?"isover":null;s&&(this.options.greedy&&(a=this.options.scope,(n=this.element.parents(":data(ui-droppable)").filter((function(){return e.data(this,"ui-droppable").options.scope===a}))).length&&((r=e.data(n[0],"ui-droppable")).greedyChild="isover"===s)),r&&"isover"===s&&(r.isover=!1,r.isout=!0,r._out.call(r,i)),this[s]=!0,this["isout"===s?"isover":"isout"]=!1,this["isover"===s?"_over":"_out"].call(this,i),r&&"isout"===s&&(r.isout=!1,r.isover=!0,r._over.call(r,i)))}}))},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(jQuery),function(e,t){function i(e){return parseInt(e,10)||0}function r(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.2",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,i,r,a,n=this,o=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!o.aspectRatio,aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=o.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;i<t.length;i++)r=e.trim(t[i]),(a=e("<div class='ui-resizable-handle "+("ui-resizable-"+r)+"'></div>")).css({zIndex:o.zIndex}),"se"===r&&a.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(a);this._renderAxis=function(t){var i,r,a,n;for(i in t=t||this.element,this.handles)this.handles[i].constructor===String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=e(this.handles[i],this.element),n=/sw|ne|nw|se|n|s/.test(i)?r.outerHeight():r.outerWidth(),a=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(a,n),this._proportionallyResize()),e(this.handles[i]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover((function(){n.resizing||(this.className&&(a=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),n.axis=a&&a[1]?a[1]:"se")})),o.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter((function(){o.disabled||(e(this).removeClass("ui-resizable-autohide"),n._handles.show())})).mouseleave((function(){o.disabled||n.resizing||(e(this).addClass("ui-resizable-autohide"),n._handles.hide())}))),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,r,a=!1;for(i in this.handles)((r=e(this.handles[i])[0])===t.target||e.contains(r,t.target))&&(a=!0);return!this.options.disabled&&a},_mouseStart:function(t){var r,a,n,o=this.options,s=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:s.top,left:s.left}),this._renderProxy(),r=i(this.helper.css("left")),a=i(this.helper.css("top")),o.containment&&(r+=e(o.containment).scrollLeft()||0,a+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:a},this.size=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:r,top:a},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),l.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,r=this.helper,a={},n=this.originalMousePosition,o=this.axis,s=this.position.top,l=this.position.left,d=this.size.width,c=this.size.height,u=t.pageX-n.left||0,p=t.pageY-n.top||0,h=this._change[o];return!!h&&(i=h.apply(this,[t,u,p]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),this.position.top!==s&&(a.top=this.position.top+"px"),this.position.left!==l&&(a.left=this.position.left+"px"),this.size.width!==d&&(a.width=this.size.width+"px"),this.size.height!==c&&(a.height=this.size.height+"px"),r.css(a),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(a)||this._trigger("resize",t,this.ui()),!1)},_mouseStop:function(t){this.resizing=!1;var i,r,a,n,o,s,l,d=this.options;return this._helper&&(a=(r=(i=this._proportionallyResizeElements).length&&/textarea/i.test(i[0].nodeName))&&e.ui.hasScroll(i[0],"left")?0:this.sizeDiff.height,n=r?0:this.sizeDiff.width,o={width:this.helper.width()-n,height:this.helper.height()-a},s=parseInt(this.element.css("left"),10)+(this.position.left-this.originalPosition.left)||null,l=parseInt(this.element.css("top"),10)+(this.position.top-this.originalPosition.top)||null,d.animate||this.element.css(e.extend(o,{top:l,left:s})),this.helper.height(this.size.height),this.helper.width(this.size.width),this._helper&&!d.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,i,a,n,o,s=this.options;o={minWidth:r(s.minWidth)?s.minWidth:0,maxWidth:r(s.maxWidth)?s.maxWidth:1/0,minHeight:r(s.minHeight)?s.minHeight:0,maxHeight:r(s.maxHeight)?s.maxHeight:1/0},(this._aspectRatio||e)&&(t=o.minHeight*this.aspectRatio,a=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,t>o.minWidth&&(o.minWidth=t),a>o.minHeight&&(o.minHeight=a),i<o.maxWidth&&(o.maxWidth=i),n<o.maxHeight&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(e){this.offset=this.helper.offset(),r(e.left)&&(this.position.left=e.left),r(e.top)&&(this.position.top=e.top),r(e.height)&&(this.size.height=e.height),r(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,a=this.axis;return r(e.height)?e.width=e.height*this.aspectRatio:r(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===a&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===a&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,a=r(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=r(e.height)&&t.maxHeight&&t.maxHeight<e.height,o=r(e.width)&&t.minWidth&&t.minWidth>e.width,s=r(e.height)&&t.minHeight&&t.minHeight>e.height,l=this.originalPosition.left+this.originalSize.width,d=this.position.top+this.size.height,c=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return o&&(e.width=t.minWidth),s&&(e.height=t.minHeight),a&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),o&&c&&(e.left=l-t.minWidth),a&&c&&(e.left=l-t.maxWidth),s&&u&&(e.top=d-t.minHeight),n&&u&&(e.top=d-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,i,r,a,n=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){if(a=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],i=[a.css("borderTopWidth"),a.css("borderRightWidth"),a.css("borderBottomWidth"),a.css("borderLeftWidth")],r=[a.css("paddingTop"),a.css("paddingRight"),a.css("paddingBottom"),a.css("paddingLeft")],t=0;t<i.length;t++)this.borderDif[t]=(parseInt(i[t],10)||0)+(parseInt(r[t],10)||0);a.css({height:n.height()-this.borderDif[0]-this.borderDif[2]||0,width:n.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize;return{left:this.originalPosition.left+t,width:i.width-t}},n:function(e,t,i){var r=this.originalSize;return{top:this.originalPosition.top+i,height:r.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,r]))},sw:function(t,i,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,r]))},ne:function(t,i,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,r]))},nw:function(t,i,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,r]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("ui-resizable"),r=i.options,a=i._proportionallyResizeElements,n=a.length&&/textarea/i.test(a[0].nodeName),o=n&&e.ui.hasScroll(a[0],"left")?0:i.sizeDiff.height,s=n?0:i.sizeDiff.width,l={width:i.size.width-s,height:i.size.height-o},d=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,c&&d?{top:c,left:d}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};a&&a.length&&e(a[0]).css({width:r.width,height:r.height}),i._updateCache(r),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,r,a,n,o,s,l,d=e(this).data("ui-resizable"),c=d.options,u=d.element,p=c.containment,h=p instanceof e?p.get(0):/parent/.test(p)?u.parent().get(0):p;h&&(d.containerElement=e(h),/document/.test(p)||p===document?(d.containerOffset={left:0,top:0},d.containerPosition={left:0,top:0},d.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(h),r=[],e(["Top","Right","Left","Bottom"]).each((function(e,a){r[e]=i(t.css("padding"+a))})),d.containerOffset=t.offset(),d.containerPosition=t.position(),d.containerSize={height:t.innerHeight()-r[3],width:t.innerWidth()-r[1]},a=d.containerOffset,n=d.containerSize.height,o=d.containerSize.width,s=e.ui.hasScroll(h,"left")?h.scrollWidth:o,l=e.ui.hasScroll(h)?h.scrollHeight:n,d.parentData={element:h,left:a.left,top:a.top,width:s,height:l}))},resize:function(t){var i,r,a,n,o=e(this).data("ui-resizable"),s=o.options,l=o.containerOffset,d=o.position,c=o._aspectRatio||t.shiftKey,u={top:0,left:0},p=o.containerElement;p[0]!==document&&/static/.test(p.css("position"))&&(u=l),d.left<(o._helper?l.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-l.left:o.position.left-u.left),c&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=s.helper?l.left:0),d.top<(o._helper?l.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-l.top:o.position.top),c&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?l.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,i=Math.abs((o._helper,o.offset.left-u.left+o.sizeDiff.width)),r=Math.abs((o._helper?o.offset.top-u.top:o.offset.top-l.top)+o.sizeDiff.height),a=o.containerElement.get(0)===o.element.parent().get(0),n=/relative|absolute/.test(o.containerElement.css("position")),a&&n&&(i-=o.parentData.left),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,c&&(o.size.height=o.size.width/o.aspectRatio)),r+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-r,c&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),i=t.options,r=t.containerOffset,a=t.containerPosition,n=t.containerElement,o=e(t.helper),s=o.offset(),l=o.outerWidth()-t.sizeDiff.width,d=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(n.css("position"))&&e(this).css({left:s.left-a.left-r.left,width:l,height:d}),t._helper&&!i.animate&&/static/.test(n.css("position"))&&e(this).css({left:s.left-a.left-r.left,width:l,height:d})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable").options,i=function(t){e(t).each((function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})}))};"object"!==_typeof(t.alsoResize)||t.alsoResize.parentNode?i(t.alsoResize):t.alsoResize.length?(t.alsoResize=t.alsoResize[0],i(t.alsoResize)):e.each(t.alsoResize,(function(e){i(e)}))},resize:function(t,i){var r=e(this).data("ui-resizable"),a=r.options,n=r.originalSize,o=r.originalPosition,s={height:r.size.height-n.height||0,width:r.size.width-n.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},l=function(t,r){e(t).each((function(){var t=e(this),a=e(this).data("ui-resizable-alsoresize"),n={},o=r&&r.length?r:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,(function(e,t){var i=(a[t]||0)+(s[t]||0);i&&i>=0&&(n[t]=i||null)})),t.css(n)}))};"object"!==_typeof(a.alsoResize)||a.alsoResize.nodeType?l(a.alsoResize):e.each(a.alsoResize,(function(e,t){l(e,t)}))},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),i=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),i=t.options,r=t.size,a=t.originalSize,n=t.originalPosition,o=t.axis,s="number"==typeof i.grid?[i.grid,i.grid]:i.grid,l=s[0]||1,d=s[1]||1,c=Math.round((r.width-a.width)/l)*l,u=Math.round((r.height-a.height)/d)*d,p=a.width+c,h=a.height+u,g=i.maxWidth&&i.maxWidth<p,f=i.maxHeight&&i.maxHeight<h,m=i.minWidth&&i.minWidth>p,b=i.minHeight&&i.minHeight>h;i.grid=s,m&&(p+=l),b&&(h+=d),g&&(p-=l),f&&(h-=d),/^(se|s|e)$/.test(o)?(t.size.width=p,t.size.height=h):/^(ne)$/.test(o)?(t.size.width=p,t.size.height=h,t.position.top=n.top-u):/^(sw)$/.test(o)?(t.size.width=p,t.size.height=h,t.position.left=n.left-c):(t.size.width=p,t.size.height=h,t.position.top=n.top-u,t.position.left=n.left-c)}})}(jQuery),function(e,t){e.widget("ui.selectable",e.ui.mouse,{version:"1.10.2",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){(t=e(i.options.filter,i.element[0])).addClass("ui-selectee"),t.each((function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})}))},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,r=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each((function(){var r=e.data(this,"selectable-item");r.startselected=!0,t.metaKey||t.ctrlKey||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,i._trigger("unselecting",t,{unselecting:r.element}))})),e(t.target).parents().addBack().each((function(){var r,a=e.data(this,"selectable-item");if(a)return r=!t.metaKey&&!t.ctrlKey||!a.$element.hasClass("ui-selected"),a.$element.removeClass(r?"ui-unselecting":"ui-selected").addClass(r?"ui-selecting":"ui-unselecting"),a.unselecting=!r,a.selecting=r,a.selected=r,r?i._trigger("selecting",t,{selecting:a.element}):i._trigger("unselecting",t,{unselecting:a.element}),!1})))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,r=this,a=this.options,n=this.opos[0],o=this.opos[1],s=t.pageX,l=t.pageY;return n>s&&(i=s,s=n,n=i),o>l&&(i=l,l=o,o=i),this.helper.css({left:n,top:o,width:s-n,height:l-o}),this.selectees.each((function(){var i=e.data(this,"selectable-item"),d=!1;i&&i.element!==r.element[0]&&("touch"===a.tolerance?d=!(i.left>s||i.right<n||i.top>l||i.bottom<o):"fit"===a.tolerance&&(d=i.left>n&&i.right<s&&i.top>o&&i.bottom<l),d?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,r._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),r._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,r._trigger("unselecting",t,{unselecting:i.element})))))})),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each((function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,i._trigger("unselected",t,{unselected:r.element})})),e(".ui-selecting",this.element[0]).each((function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,i._trigger("selected",t,{selected:r.element})})),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e,t){function i(e,t,i){return e>t&&e<t+i}function r(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===e.axis||r(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var r=null,a=!1,n=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(t),e(t.target).parents().each((function(){if(e.data(this,n.widgetName+"-item")===n)return r=e(this),!1})),e.data(t.target,n.widgetName+"-item")===n&&(r=e(t.target)),!!r&&(!(this.options.handle&&!i&&(e(this.options.handle,r).find("*").addBack().each((function(){this===t.target&&(a=!0)})),!a))&&(this.currentItem=r,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(t,i,r){var a,n,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(n)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(a=this.containers.length-1;a>=0;a--)this.containers[a]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,r,a,n,o=this.options,s=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),!1!==s&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(a=(r=this.items[i]).item[0],(n=this._intersectsWithPointer(r))&&r.instance===this.currentContainer&&!(a===this.currentItem[0]||this.placeholder[1===n?"next":"prev"]()[0]===a||e.contains(this.placeholder[0],a)||"semi-dynamic"===this.options.type&&e.contains(this.element[0],a))){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var r=this,a=this.placeholder.offset(),n=this.options.axis,o={};n&&"x"!==n||(o.left=a.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(o.top=a.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,(function(){r._clear(t)}))}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(i).each((function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&r.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))})),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},i.each((function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")})),r},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,r=this.positionAbs.top,a=r+this.helperProportions.height,n=e.left,o=n+e.width,s=e.top,l=s+e.height,d=this.offset.click.top,c=this.offset.click.left,u=r+d>s&&r+d<l&&t+c>n&&t+c<o;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?u:n<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<o&&s<r+this.helperProportions.height/2&&a-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||i(this.positionAbs.top+this.offset.click.top,e.top,e.height),r="y"===this.options.axis||i(this.positionAbs.left+this.offset.click.left,e.left,e.width),a=t&&r,n=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return!!a&&(this.floating?o&&"right"===o||"down"===n?2:1:n&&("down"===n?2:1))},_intersectsWithSides:function(e){var t=i(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),r=i(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),a=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&r||"left"===n&&!r:a&&("down"===a&&t||"up"===a&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i,r,a,n,o=[],s=[],l=this._connectWith();if(l&&t)for(i=l.length-1;i>=0;i--)for(r=(a=e(l[i])).length-1;r>=0;r--)(n=e.data(a[r],this.widgetFullName))&&n!==this&&!n.options.disabled&&s.push([e.isFunction(n.options.items)?n.options.items.call(n.element):e(n.options.items,n.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),n]);for(s.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=s.length-1;i>=0;i--)s[i][0].each((function(){o.push(this)}));return e(o)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,(function(e){for(var i=0;i<t.length;i++)if(t[i]===e.item[0])return!1;return!0}))},_refreshItems:function(t){this.items=[],this.containers=[this];var i,r,a,n,o,s,l,d,c=this.items,u=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],p=this._connectWith();if(p&&this.ready)for(i=p.length-1;i>=0;i--)for(r=(a=e(p[i])).length-1;r>=0;r--)(n=e.data(a[r],this.widgetFullName))&&n!==this&&!n.options.disabled&&(u.push([e.isFunction(n.options.items)?n.options.items.call(n.element[0],t,{item:this.currentItem}):e(n.options.items,n.element),n]),this.containers.push(n));for(i=u.length-1;i>=0;i--)for(o=u[i][1],r=0,d=(s=u[i][0]).length;r<d;r++)(l=e(s[r])).data(this.widgetName+"-item",o),c.push({item:l,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var i,r,a,n;for(this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(r=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(a=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=a.outerWidth(),r.height=a.outerHeight()),n=a.offset(),r.left=n.left,r.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)n=this.containers[i].element.offset(),this.containers[i].containerCache.left=n.left,this.containers[i].containerCache.top=n.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){var i,r=(t=t||this).options;r.placeholder&&r.placeholder.constructor!==String||(i=r.placeholder,r.placeholder={element:function(){var r=t.currentItem[0].nodeName.toLowerCase(),a=e(t.document[0].createElement(r)).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===r?a.append("<td colspan='99'>&#160;</td>"):"img"===r&&a.attr("src",t.currentItem.attr("src")),i||a.css("visibility","hidden"),a},update:function(e,a){i&&!r.forcePlaceholderSize||(a.height()||a.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),a.width()||a.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var a,n,o,s,l,d,c,u,p,h,g=null,f=null;for(a=this.containers.length-1;a>=0;a--)if(!e.contains(this.currentItem[0],this.containers[a].element[0]))if(this._intersectsWith(this.containers[a].containerCache)){if(g&&e.contains(this.containers[a].element[0],g.element[0]))continue;g=this.containers[a],f=a}else this.containers[a].containerCache.over&&(this.containers[a]._trigger("out",t,this._uiHash(this)),this.containers[a].containerCache.over=0);if(g)if(1===this.containers.length)this.containers[f].containerCache.over||(this.containers[f]._trigger("over",t,this._uiHash(this)),this.containers[f].containerCache.over=1);else{for(o=1e4,s=null,l=(h=g.floating||r(this.currentItem))?"left":"top",d=h?"width":"height",c=this.positionAbs[l]+this.offset.click[l],n=this.items.length-1;n>=0;n--)e.contains(this.containers[f].element[0],this.items[n].item[0])&&this.items[n].item[0]!==this.currentItem[0]&&(h&&!i(this.positionAbs.top+this.offset.click.top,this.items[n].top,this.items[n].height)||(u=this.items[n].item.offset()[l],p=!1,Math.abs(u-c)>Math.abs(u+this.items[n][d]-c)&&(p=!0,u+=this.items[n][d]),Math.abs(u-c)<o&&(o=Math.abs(u-c),s=this.items[n],this.direction=p?"up":"down")));if(!s&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[f])return;s?this._rearrange(t,s,null,!0):this._rearrange(t,null,this.containers[f].element,!0),this._trigger("change",t,this._uiHash()),this.containers[f]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[f],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[f]._trigger("over",t,this._uiHash(this)),this.containers[f].containerCache.over=1}},_createHelper:function(t){var i=this.options,r=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),r[0].style.width&&!i.forceHelperSize||r.width(this.currentItem.width()),r[0].style.height&&!i.forceHelperSize||r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,r,a=this.options;"parent"===a.containment&&(a.containment=this.helper[0].parentNode),"document"!==a.containment&&"window"!==a.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===a.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===a.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(a.containment)||(t=e(a.containment)[0],i=e(a.containment).offset(),r="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var r="absolute"===t?1:-1,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:a.scrollTop())*r,left:i.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:a.scrollLeft())*r}},_generatePosition:function(t){var i,r,a=this.options,n=t.pageX,o=t.pageY,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(s[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),a.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/a.grid[1])*a.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-a.grid[1]:i+a.grid[1]:i,r=this.originalPageX+Math.round((n-this.originalPageX)/a.grid[0])*a.grid[0],n=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-a.grid[0]:r+a.grid[0]:r)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:s.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:s.scrollLeft())}},_rearrange:function(e,t,i,r){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var a=this.counter;this._delay((function(){a===this.counter&&this.refreshPositions(!r)}))},_clear:function(e,t){this.reverting=!1;var i,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&r.push((function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))})),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||r.push((function(e){this._trigger("update",e,this._uiHash())})),this!==this.currentContainer&&(t||(r.push((function(e){this._trigger("remove",e,this._uiHash())})),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),i=0;i<r.length;i++)r[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(i=0;i<r.length;i++)r[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(jQuery),function(e,t){var i;e.effects={effect:{}},
/*!
                   * jQuery Color Animations v2.1.2
                   * https://github.com/jquery/jquery-color
                   *
                   * Copyright 2013 jQuery Foundation and other contributors
                   * Released under the MIT license.
                   * http://jquery.org/license
                   *
                   * Date: Wed Jan 16 08:47:09 2013 -0600
                   */
function(e,t){var i,r=/^([\-+])=\s*(\d+\.?\d*)/,a=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],n=e.Color=function(t,i,r,a){return new e.Color.fn.parse(t,i,r,a)},o={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},s={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},l=n.support={},d=e("<p>")[0],c=e.each;function u(e,t,i){var r=s[t.type]||{};return null==e?i||!t.def?null:t.def:(e=r.floor?~~e:parseFloat(e),isNaN(e)?t.def:r.mod?(e+r.mod)%r.mod:0>e?0:r.max<e?r.max:e)}function p(t){var r=n(),s=r._rgba=[];return t=t.toLowerCase(),c(a,(function(e,i){var a,n=i.re.exec(t),l=n&&i.parse(n),d=i.space||"rgba";if(l)return a=r[d](l),r[o[d].cache]=a[o[d].cache],s=r._rgba=a._rgba,!1})),s.length?("0,0,0,0"===s.join()&&e.extend(s,i.transparent),r):i[t]}function h(e,t,i){return 6*(i=(i+1)%1)<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}d.style.cssText="background-color:rgba(1,1,1,.5)",l.rgba=d.style.backgroundColor.indexOf("rgba")>-1,c(o,(function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}})),n.fn=e.extend(n.prototype,{parse:function(t,r,a,s){if(void 0===t)return this._rgba=[null,null,null,null],this;(t.jquery||t.nodeType)&&(t=e(t).css(r),r=void 0);var l=this,d=e.type(t),h=this._rgba=[];return void 0!==r&&(t=[t,r,a,s],d="array"),"string"===d?this.parse(p(t)||i._default):"array"===d?(c(o.rgba.props,(function(e,i){h[i.idx]=u(t[i.idx],i)})),this):"object"===d?(c(o,t instanceof n?function(e,i){t[i.cache]&&(l[i.cache]=t[i.cache].slice())}:function(i,r){var a=r.cache;c(r.props,(function(e,i){if(!l[a]&&r.to){if("alpha"===e||null==t[e])return;l[a]=r.to(l._rgba)}l[a][i.idx]=u(t[e],i,!0)})),l[a]&&e.inArray(null,l[a].slice(0,3))<0&&(l[a][3]=1,r.from&&(l._rgba=r.from(l[a])))}),this):void 0},is:function(e){var t=n(e),i=!0,r=this;return c(o,(function(e,a){var n,o=t[a.cache];return o&&(n=r[a.cache]||a.to&&a.to(r._rgba)||[],c(a.props,(function(e,t){if(null!=o[t.idx])return i=o[t.idx]===n[t.idx]}))),i})),i},_space:function(){var e=[],t=this;return c(o,(function(i,r){t[r.cache]&&e.push(i)})),e.pop()},transition:function(e,t){var i=n(e),r=i._space(),a=o[r],l=0===this.alpha()?n("transparent"):this,d=l[a.cache]||a.to(l._rgba),p=d.slice();return i=i[a.cache],c(a.props,(function(e,r){var a=r.idx,n=d[a],o=i[a],l=s[r.type]||{};null!==o&&(null===n?p[a]=o:(l.mod&&(o-n>l.mod/2?n+=l.mod:n-o>l.mod/2&&(n-=l.mod)),p[a]=u((o-n)*t+n,r)))})),this[r](p)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),r=i.pop(),a=n(t)._rgba;return n(e.map(i,(function(e,t){return(1-r)*a[t]+r*e})))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,(function(e,t){return null==e?t>2?1:0:e}));return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),(function(e,t){return null==e&&(e=t>2?1:0),t&&t<3&&(e=Math.round(100*e)+"%"),e}));return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),r=i.pop();return t&&i.push(~~(255*r)),"#"+e.map(i,(function(e){return 1===(e=(e||0).toString(16)).length?"0"+e:e})).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),n.fn.parse.prototype=n.fn,o.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,r=e[0]/255,a=e[1]/255,n=e[2]/255,o=e[3],s=Math.max(r,a,n),l=Math.min(r,a,n),d=s-l,c=s+l,u=.5*c;return t=l===s?0:r===s?60*(a-n)/d+360:a===s?60*(n-r)/d+120:60*(r-a)/d+240,i=0===d?0:u<=.5?d/c:d/(2-c),[Math.round(t)%360,i,u,null==o?1:o]},o.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],r=e[2],a=e[3],n=r<=.5?r*(1+i):r+i-r*i,o=2*r-n;return[Math.round(255*h(o,n,t+1/3)),Math.round(255*h(o,n,t)),Math.round(255*h(o,n,t-1/3)),a]},c(o,(function(t,i){var a=i.props,o=i.cache,s=i.to,l=i.from;n.fn[t]=function(t){if(s&&!this[o]&&(this[o]=s(this._rgba)),void 0===t)return this[o].slice();var i,r=e.type(t),d="array"===r||"object"===r?t:arguments,p=this[o].slice();return c(a,(function(e,t){var i=d["object"===r?e:t.idx];null==i&&(i=p[t.idx]),p[t.idx]=u(i,t)})),l?((i=n(l(p)))[o]=p,i):n(p)},c(a,(function(i,a){n.fn[i]||(n.fn[i]=function(n){var o,s=e.type(n),l="alpha"===i?this._hsla?"hsla":"rgba":t,d=this[l](),c=d[a.idx];return"undefined"===s?c:("function"===s&&(n=n.call(this,c),s=e.type(n)),null==n&&a.empty?this:("string"===s&&(o=r.exec(n))&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1)),d[a.idx]=n,this[l](d)))})}))})),n.hook=function(t){var i=t.split(" ");c(i,(function(t,i){e.cssHooks[i]={set:function(t,r){var a,o,s="";if("transparent"!==r&&("string"!==e.type(r)||(a=p(r)))){if(r=n(a||r),!l.rgba&&1!==r._rgba[3]){for(o="backgroundColor"===i?t.parentNode:t;(""===s||"transparent"===s)&&o&&o.style;)try{s=e.css(o,"backgroundColor"),o=o.parentNode}catch(e){}r=r.blend(s&&"transparent"!==s?s:"_default")}r=r.toRgbaString()}try{t.style[i]=r}catch(e){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=n(t.elem,i),t.end=n(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}}))},n.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),e.cssHooks.borderColor={expand:function(e){var t={};return c(["Top","Right","Bottom","Left"],(function(i,r){t["border"+r+"Color"]=e})),t}},i=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){var t,i=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function a(t){var i,r,a=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,n={};if(a&&a.length&&a[0]&&a[a[0]])for(r=a.length;r--;)"string"==typeof a[i=a[r]]&&(n[e.camelCase(i)]=a[i]);else for(i in a)"string"==typeof a[i]&&(n[i]=a[i]);return n}e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],(function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,i,e.end),e.setAttr=!0)}})),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,n,o,s){var l=e.speed(n,o,s);return this.queue((function(){var n,o=e(this),s=o.attr("class")||"",d=l.children?o.find("*").addBack():o;d=d.map((function(){return{el:e(this),start:a(this)}})),(n=function(){e.each(i,(function(e,i){t[i]&&o[i+"Class"](t[i])}))})(),d=d.map((function(){return this.end=a(this.el[0]),this.diff=function(t,i){var a,n,o={};for(a in i)n=i[a],t[a]!==n&&(r[a]||!e.fx.step[a]&&isNaN(parseFloat(n))||(o[a]=n));return o}(this.start,this.end),this})),o.attr("class",s),d=d.map((function(){var t=this,i=e.Deferred(),r=e.extend({},l,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,r),i.promise()})),e.when.apply(e,d.get()).done((function(){n(),e.each(arguments,(function(){var t=this.el;e.each(this.diff,(function(e){t.css(e,"")}))})),l.complete.call(o[0])}))}))},e.fn.extend({addClass:(t=e.fn.addClass,function(i,r,a,n){return r?e.effects.animateClass.call(this,{add:i},r,a,n):t.apply(this,arguments)}),removeClass:function(t){return function(i,r,a,n){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},r,a,n):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,r,a,n,o){return"boolean"==typeof r||void 0===r?a?e.effects.animateClass.call(this,r?{add:i}:{remove:i},a,n,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},r,a,n)}}(e.fn.toggleClass),switchClass:function(t,i,r,a,n){return e.effects.animateClass.call(this,{add:i,remove:t},r,a,n)}})}(),function(){function t(t,i,r,a){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(a=i,r=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(a=r,r=i,i={}),e.isFunction(r)&&(a=r,r=null),i&&e.extend(t,i),r=r||i.duration,t.duration=e.fx.off?0:"number"==typeof r?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default,t.complete=a||i.complete,t}function i(t){return!(t&&"number"!=typeof t&&!e.fx.speeds[t])||("string"==typeof t&&!e.effects.effect[t]||(!!e.isFunction(t)||"object"===_typeof(t)&&!t.effect))}var r;e.extend(e.effects,{version:"1.10.2",save:function(e,t){for(var i=0;i<t.length;i++)null!==t[i]&&e.data("ui-effects-"+t[i],e[0].style[t[i]])},restore:function(e,t){var i,r;for(r=0;r<t.length;r++)null!==t[r]&&(void 0===(i=e.data("ui-effects-"+t[r]))&&(i=""),e.css(t[r],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,r;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),float:t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),a={width:t.width(),height:t.height()},n=document.activeElement;try{n.id}catch(e){n=document.body}return t.wrap(r),(t[0]===n||e.contains(t[0],n))&&e(n).focus(),r=t.parent(),"static"===t.css("position")?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],(function(e,r){i[r]=t.css(r),isNaN(parseInt(i[r],10))&&(i[r]="auto")})),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(a),r.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,r,a){return a=a||{},e.each(i,(function(e,i){var n=t.cssUnit(i);n[0]>0&&(a[i]=n[0]*r+n[1])})),a}}),e.fn.extend({effect:function(){var i=t.apply(this,arguments),r=i.mode,a=i.queue,n=e.effects.effect[i.effect];if(e.fx.off||!n)return r?this[r](i.duration,i.complete):this.each((function(){i.complete&&i.complete.call(this)}));function o(t){var r=e(this),a=i.complete,o=i.mode;function s(){e.isFunction(a)&&a.call(r[0]),e.isFunction(t)&&t()}(r.is(":hidden")?"hide"===o:"show"===o)?(r[o](),s()):n.call(r[0],i,s)}return!1===a?this.each(o):this.queue(a||"fx",o)},show:(r=e.fn.show,function(e){if(i(e))return r.apply(this,arguments);var a=t.apply(this,arguments);return a.mode="show",this.effect.call(this,a)}),hide:function(e){return function(r){if(i(r))return e.apply(this,arguments);var a=t.apply(this,arguments);return a.mode="hide",this.effect.call(this,a)}}(e.fn.hide),toggle:function(e){return function(r){if(i(r)||"boolean"==typeof r)return e.apply(this,arguments);var a=t.apply(this,arguments);return a.mode="toggle",this.effect.call(this,a)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),r=[];return e.each(["em","px","%","pt"],(function(e,t){i.indexOf(t)>0&&(r=[parseFloat(i),t])})),r}})}(),i={},e.each(["Quad","Cubic","Quart","Quint","Expo"],(function(e,t){i[t]=function(t){return Math.pow(t,e+2)}})),e.extend(i,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(i,(function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return e<.5?i(2*e)/2:1-i(-2*e+2)/2}}))}(jQuery),function(e,t){var i=0,r={},a={};r.height=r.paddingTop=r.paddingBottom=r.borderTopWidth=r.borderBottomWidth="hide",a.height=a.paddingTop=a.paddingBottom=a.borderTopWidth=a.borderBottomWidth="show",e.widget("ui.accordion",{version:"1.10.2",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||!1!==t.active&&null!=t.active||(t.active=0),this._processPanels(),t.active<0&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e(),content:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each((function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")})),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each((function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")})),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){"active"!==e?("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||!1!==this.options.active||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)):this._activate(t)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,r=this.headers.length,a=this.headers.index(t.target),n=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:n=this.headers[(a+1)%r];break;case i.LEFT:case i.UP:n=this.headers[(a-1+r)%r];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:n=this.headers[0];break;case i.END:n=this.headers[r-1]}n&&(e(t.target).attr("tabIndex",-1),e(n).attr("tabIndex",0),n.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),(!1===t.active&&!0===t.collapsible||!this.headers.length)&&(t.active=!1,this.active=e()),!1===t.active?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var t,r=this.options,a=r.heightStyle,n=this.element.parent(),o=this.accordionId="ui-accordion-"+(this.element.attr("id")||++i);this.active=this._findActive(r.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each((function(t){var i=e(this),r=i.attr("id"),a=i.next(),n=a.attr("id");r||(r=o+"-header-"+t,i.attr("id",r)),n||(n=o+"-panel-"+t,a.attr("id",n)),i.attr("aria-controls",n),a.attr("aria-labelledby",r)})).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(r.event),"fill"===a?(t=n.height(),this.element.siblings(":visible").each((function(){var i=e(this),r=i.css("position");"absolute"!==r&&"fixed"!==r&&(t-=i.outerHeight(!0))})),this.headers.each((function(){t-=e(this).outerHeight(!0)})),this.headers.next().each((function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))})).css("overflow","auto")):"auto"===a&&(t=0,this.headers.next().each((function(){t=Math.max(t,e(this).css("height","").height())})).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),(function(e,t){i[t]="_eventHandler"})),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,r=this.active,a=e(t.currentTarget),n=a[0]===r[0],o=n&&i.collapsible,s=o?e():a.next(),l=r.next(),d={oldHeader:r,oldPanel:l,newHeader:o?e():a,newPanel:s};t.preventDefault(),n&&!i.collapsible||!1===this._trigger("beforeActivate",t,d)||(i.active=!o&&this.headers.index(a),this.active=n?e():a,this._toggle(d),r.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&r.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),n||(a.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&a.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),a.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,r=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=r,this.options.animate?this._animate(i,r,t):(r.hide(),i.show(),this._toggleComplete(t)),r.attr({"aria-expanded":"false","aria-hidden":"true"}),r.prev().attr("aria-selected","false"),i.length&&r.length?r.prev().attr("tabIndex",-1):i.length&&this.headers.filter((function(){return 0===e(this).attr("tabIndex")})).attr("tabIndex",-1),i.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0})},_animate:function(e,t,i){var n,o,s,l=this,d=0,c=e.length&&(!t.length||e.index()<t.index()),u=this.options.animate||{},p=c&&u.down||u,h=function(){l._toggleComplete(i)};return"number"==typeof p&&(s=p),"string"==typeof p&&(o=p),o=o||p.easing||u.easing,s=s||p.duration||u.duration,t.length?e.length?(n=e.show().outerHeight(),t.animate(r,{duration:s,easing:o,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(a,{duration:s,easing:o,complete:h,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?d+=i.now:"content"!==l.options.heightStyle&&(i.now=Math.round(n-t.outerHeight()-d),d=0)}})):t.animate(r,s,o,h):e.animate(a,s,o,h)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}})}(jQuery),function(e,t){var i=0;e.widget("ui.autocomplete",{version:"1.10.2",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t,i,r,a=this.element[0].nodeName.toLowerCase(),n="textarea"===a,o="input"===a;this.isMultiLine=!!n||!o&&this.element.prop("isContentEditable"),this.valueMethod=this.element[n||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(a){if(this.element.prop("readOnly"))return t=!0,r=!0,void(i=!0);t=!1,r=!1,i=!1;var n=e.ui.keyCode;switch(a.keyCode){case n.PAGE_UP:t=!0,this._move("previousPage",a);break;case n.PAGE_DOWN:t=!0,this._move("nextPage",a);break;case n.UP:t=!0,this._keyEvent("previous",a);break;case n.DOWN:t=!0,this._keyEvent("next",a);break;case n.ENTER:case n.NUMPAD_ENTER:this.menu.active&&(t=!0,a.preventDefault(),this.menu.select(a));break;case n.TAB:this.menu.active&&this.menu.select(a);break;case n.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(a),a.preventDefault());break;default:i=!0,this._searchTimeout(a)}},keypress:function(r){if(t)return t=!1,void r.preventDefault();if(!i){var a=e.ui.keyCode;switch(r.keyCode){case a.PAGE_UP:this._move("previousPage",r);break;case a.PAGE_DOWN:this._move("nextPage",r);break;case a.UP:this._keyEvent("previous",r);break;case a.DOWN:this._keyEvent("next",r)}}},input:function(e){if(r)return r=!1,void e.preventDefault();this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),this._change(e))}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({input:e(),role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay((function(){delete this.cancelBlur}));var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay((function(){var t=this;this.document.one("mousedown",(function(r){r.target===t.element[0]||r.target===i||e.contains(i,r.target)||t.close()}))}))},menufocus:function(t,i){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",(function(){e(t.target).trigger(t.originalEvent)}));var r=i.item.data("ui-autocomplete-item");!1!==this._trigger("focus",t,{item:r})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(r.value):this.liveRegion.text(r.value)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),r=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=r,this._delay((function(){this.previous=r,this.selectedItem=i}))),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,r=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,r){r(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,a){r.xhr&&r.xhr.abort(),r.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){a(e)},error:function(){a([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay((function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))}),this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var e=this,t=++i;return function(r){t===i&&e.__response(r),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,(function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)}))},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var r=this;e.each(i,(function(e,i){r._renderItemData(t,i)}))},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").append(e("<a>").text(i.label)).appendTo(t)},_move:function(e,t){if(this.menu.element.is(":visible"))return this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),void this.menu.blur()):void this.menu[e](t);this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var r=new RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,(function(e){return r.test(e.label||e.value||e)}))}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(jQuery),function(e,t){var i,r,a,n,o="ui-button ui-widget ui-state-default ui-corner-all",s="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",l=function(){var t=e(this).find(":ui-button");setTimeout((function(){t.button("refresh")}),1)},d=function(t){var i=t.name,r=t.form,a=e([]);return i&&(i=i.replace(/'/g,"\\'"),a=r?e(r).find("[name='"+i+"']"):e("[name='"+i+"']",t.ownerDocument).filter((function(){return!this.form}))),a};e.widget("ui.button",{version:"1.10.2",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,l),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,s=this.options,c="checkbox"===this.type||"radio"===this.type,u=c?"":"ui-state-active";null===s.label&&(s.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(o).attr("role","button").bind("mouseenter"+this.eventNamespace,(function(){s.disabled||this===i&&e(this).addClass("ui-state-active")})).bind("mouseleave"+this.eventNamespace,(function(){s.disabled||e(this).removeClass(u)})).bind("click"+this.eventNamespace,(function(e){s.disabled&&(e.preventDefault(),e.stopImmediatePropagation())})),this.element.bind("focus"+this.eventNamespace,(function(){t.buttonElement.addClass("ui-state-focus")})).bind("blur"+this.eventNamespace,(function(){t.buttonElement.removeClass("ui-state-focus")})),c&&(this.element.bind("change"+this.eventNamespace,(function(){n||t.refresh()})),this.buttonElement.bind("mousedown"+this.eventNamespace,(function(e){s.disabled||(n=!1,r=e.pageX,a=e.pageY)})).bind("mouseup"+this.eventNamespace,(function(e){s.disabled||r===e.pageX&&a===e.pageY||(n=!0)}))),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,(function(){if(s.disabled||n)return!1})):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,(function(){if(s.disabled||n)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var i=t.element[0];d(i).not(i).map((function(){return e(this).button("widget")[0]})).removeClass("ui-state-active").attr("aria-pressed","false")})):(this.buttonElement.bind("mousedown"+this.eventNamespace,(function(){if(s.disabled)return!1;e(this).addClass("ui-state-active"),i=this,t.document.one("mouseup",(function(){i=null}))})).bind("mouseup"+this.eventNamespace,(function(){if(s.disabled)return!1;e(this).removeClass("ui-state-active")})).bind("keydown"+this.eventNamespace,(function(t){if(s.disabled)return!1;t.keyCode!==e.ui.keyCode.SPACE&&t.keyCode!==e.ui.keyCode.ENTER||e(this).addClass("ui-state-active")})).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,(function(){e(this).removeClass("ui-state-active")})),this.buttonElement.is("a")&&this.buttonElement.keyup((function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()}))),this._setOption("disabled",s.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),(i=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(o+" ui-state-hover ui-state-active  "+s).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){this._super(e,t),"disabled"!==e?this._resetButton():t?this.element.prop("disabled",!0):this.element.prop("disabled",!1)},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?d(this.element[0]).each((function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")})):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"!==this.type){var t=this.buttonElement.removeClass(s),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),r=this.options.icons,a=r.primary&&r.secondary,n=[];r.primary||r.secondary?(this.options.text&&n.push("ui-button-text-icon"+(a?"s":r.primary?"-primary":"-secondary")),r.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>"),r.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>"),this.options.text||(n.push(a?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):n.push("ui-button-text-only"),t.addClass(n.join(" "))}else this.options.label&&this.element.val(this.options.label)}}),e.widget("ui.buttonset",{version:"1.10.2",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map((function(){return e(this).button("widget")[0]})).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map((function(){return e(this).button("widget")[0]})).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(e,t){e.extend(e.ui,{datepicker:{version:"1.10.2"}});var i,r="datepicker",a=(new Date).getTime();function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.dpDiv=o(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function o(t){var r="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(r,"mouseout",(function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")})).delegate(r,"mouseover",(function(){e.datepicker._isDisabledDatepicker(i.inline?t.parent()[0]:i.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}))}function s(t,i){for(var r in e.extend(t,i),i)null==i[r]&&(t[r]=i[r]);return t}e.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return s(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var r,a,n;a="div"===(r=t.nodeName.toLowerCase())||"span"===r,t.id||(this.uuid+=1,t.id="dp"+this.uuid),(n=this._newInst(e(t),a)).settings=e.extend({},i||{}),"input"===r?this._connectDatepicker(t,n):a&&this._inlineDatepicker(t,n)},_newInst:function(t,i){return{id:t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?o(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var a=e(t);i.append=e([]),i.trigger=e([]),a.hasClass(this.markerClassName)||(this._attachments(a,i),a.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,r,i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var r,a,n,o=this._get(i,"appendText"),s=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[s?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),"focus"!==(r=this._get(i,"showOn"))&&"both"!==r||t.focus(this._showDatepicker),"button"!==r&&"both"!==r||(a=this._get(i,"buttonText"),n=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:n,alt:a,title:a}):e("<button type='button'></button>").addClass(this._triggerClass).html(n?e("<img/>").attr({src:n,alt:a,title:a}):a)),t[s?"before":"after"](i.trigger),i.trigger.click((function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1})))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,r,a,n=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){for(i=0,r=0,a=0;a<e.length;a++)e[a].length>i&&(i=e[a].length,r=a);return r},n.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),n.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-n.getDay())),e.input.attr("size",this._formatDate(e,n).length)}},_inlineDatepicker:function(t,i){var a=e(t);a.hasClass(this.markerClassName)||(a.addClass(this.markerClassName).append(i.dpDiv),e.data(t,r,i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,a,n,o){var l,d,c,u,p,h=this._dialogInst;return h||(this.uuid+=1,l="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+l+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),(h=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},e.data(this._dialogInput[0],r,h)),s(h.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(h,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(d=document.documentElement.clientWidth,c=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,p=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[d/2-100+u,c/2-150+p]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),h.settings.onSelect=a,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],r,h),this},_destroyDatepicker:function(t){var i,a=e(t),n=e.data(t,r);a.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,r),"input"===i?(n.append.remove(),n.trigger.remove(),a.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):"div"!==i&&"span"!==i||a.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var i,a,n=e(t),o=e.data(t,r);n.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!1,o.trigger.filter("button").each((function(){this.disabled=!1})).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==i&&"span"!==i||((a=n.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),a.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,(function(e){return e===t?null:e})))},_disableDatepicker:function(t){var i,a,n=e(t),o=e.data(t,r);n.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!0,o.trigger.filter("button").each((function(){this.disabled=!0})).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==i&&"span"!==i||((a=n.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),a.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,(function(e){return e===t?null:e})),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,r)}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,r){var a,n,o,l,d=this._getInst(t);if(2===arguments.length&&"string"==typeof i)return"defaults"===i?e.extend({},e.datepicker._defaults):d?"all"===i?e.extend({},d.settings):this._get(d,i):null;a=i||{},"string"==typeof i&&((a={})[i]=r),d&&(this._curInst===d&&this._hideDatepicker(),n=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(d,"min"),l=this._getMinMaxDate(d,"max"),s(d.settings,a),null!==o&&void 0!==a.dateFormat&&void 0===a.minDate&&(d.settings.minDate=this._formatDate(d,o)),null!==l&&void 0!==a.dateFormat&&void 0===a.maxDate&&(d.settings.maxDate=this._formatDate(d,l)),"disabled"in a&&(a.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),d),this._autoSize(d),this._setDate(d,n),this._updateAlternate(d),this._updateDatepicker(d))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,r,a,n=e.datepicker._getInst(t.target),o=!0,s=n.dpDiv.is(".ui-datepicker-rtl");if(n._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return(a=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",n.dpDiv))[0]&&e.datepicker._selectDay(t.target,n.selectedMonth,n.selectedYear,a[0]),(i=e.datepicker._get(n,"onSelect"))?(r=e.datepicker._formatDate(n),i.apply(n.input?n.input[0]:null,[r,n])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(n,"stepBigMonths"):-e.datepicker._get(n,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(n,"stepBigMonths"):+e.datepicker._get(n,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,s?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(n,"stepBigMonths"):-e.datepicker._get(n,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,s?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(n,"stepBigMonths"):+e.datepicker._get(n,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,r,a=e.datepicker._getInst(t.target);if(e.datepicker._get(a,"constrainInput"))return i=e.datepicker._possibleChars(e.datepicker._get(a,"dateFormat")),r=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||r<" "||!i||i.indexOf(r)>-1},_doKeyUp:function(t){var i=e.datepicker._getInst(t.target);if(i.input.val()!==i.lastVal)try{e.datepicker.parseDate(e.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,e.datepicker._getFormatConfig(i))&&(e.datepicker._setDateFromField(i),e.datepicker._updateAlternate(i),e.datepicker._updateDatepicker(i))}catch(e){}return!0},_showDatepicker:function(t){var i,r,a,n,o,l,d;("input"!==(t=t.target||t).nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t)||(i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),!1!==(a=(r=e.datepicker._get(i,"beforeShow"))?r.apply(t,[t,i]):{})&&(s(i.settings,a),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),n=!1,e(t).parents().each((function(){return!(n|="fixed"===e(this).css("position"))})),o={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),o=e.datepicker._checkOffset(i,o,n),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":n?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),d=e.datepicker._get(i,"duration"),i.dpDiv.zIndex(e(t).zIndex()+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),d):i.dpDiv[l||"show"](l?d:null),i.input.is(":visible")&&!i.input.is(":disabled")&&i.input.focus(),e.datepicker._curInst=i)))},_updateDatepicker:function(t){this.maxRows=4,i=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var r,a=this._getNumberOfMonths(t),n=a[1];t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",17*n+"em"),t.dpDiv[(1!==a[0]||1!==a[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&t.input[0]!==document.activeElement&&t.input.focus(),t.yearshtml&&(r=t.yearshtml,setTimeout((function(){r===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),r=t.yearshtml=null}),0))},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(t,i,r){var a=t.dpDiv.outerWidth(),n=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,s=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(r?0:e(document).scrollLeft()),d=document.documentElement.clientHeight+(r?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?a-o:0,i.left-=r&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=r&&i.top===t.input.offset().top+s?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+a>l&&l>a?Math.abs(i.left+a-l):0),i.top-=Math.min(i.top,i.top+n>d&&d>n?Math.abs(n+s):0),i},_findPos:function(t){for(var i,r=this._getInst(t),a=this._get(r,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[a?"previousSibling":"nextSibling"];return[(i=e(t).offset()).left,i.top]},_hideDatepicker:function(t){var i,a,n,o,s=this._curInst;!s||t&&s!==e.data(t,r)||this._datepickerShowing&&(i=this._get(s,"showAnim"),a=this._get(s,"duration"),n=function(){e.datepicker._tidyDialog(s)},e.effects&&(e.effects.effect[i]||e.effects[i])?s.dpDiv.hide(i,e.datepicker._get(s,"showOptions"),a,n):s.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?a:null,n),i||n(),this._datepickerShowing=!1,(o=this._get(s,"onClose"))&&o.apply(s.input?s.input[0]:null,[s.input?s.input.val():"",s]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),r=e.datepicker._getInst(i[0]);(i[0].id===e.datepicker._mainDivId||0!==i.parents("#"+e.datepicker._mainDivId).length||i.hasClass(e.datepicker.markerClassName)||i.closest("."+e.datepicker._triggerClass).length||!e.datepicker._datepickerShowing||e.datepicker._inDialog&&e.blockUI)&&(!i.hasClass(e.datepicker.markerClassName)||e.datepicker._curInst===r)||e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,r){var a=e(t),n=this._getInst(a[0]);this._isDisabledDatepicker(a[0])||(this._adjustInstDate(n,i+("M"===r?this._get(n,"showCurrentAtPos"):0),r),this._updateDatepicker(n))},_gotoToday:function(t){var i,r=e(t),a=this._getInst(r[0]);this._get(a,"gotoCurrent")&&a.currentDay?(a.selectedDay=a.currentDay,a.drawMonth=a.selectedMonth=a.currentMonth,a.drawYear=a.selectedYear=a.currentYear):(i=new Date,a.selectedDay=i.getDate(),a.drawMonth=a.selectedMonth=i.getMonth(),a.drawYear=a.selectedYear=i.getFullYear()),this._notifyChange(a),this._adjustDate(r)},_selectMonthYear:function(t,i,r){var a=e(t),n=this._getInst(a[0]);n["selected"+("M"===r?"Month":"Year")]=n["draw"+("M"===r?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(n),this._adjustDate(a)},_selectDay:function(t,i,r,a){var n,o=e(t);e(a).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||((n=this._getInst(o[0])).selectedDay=n.currentDay=e("a",a).html(),n.selectedMonth=n.currentMonth=i,n.selectedYear=n.currentYear=r,this._selectDate(t,this._formatDate(n,n.currentDay,n.currentMonth,n.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var r,a=e(t),n=this._getInst(a[0]);i=null!=i?i:this._formatDate(n),n.input&&n.input.val(i),this._updateAlternate(n),(r=this._get(n,"onSelect"))?r.apply(n.input?n.input[0]:null,[i,n]):n.input&&n.input.trigger("change"),n.inline?this._updateDatepicker(n):(this._hideDatepicker(),this._lastInput=n.input[0],"object"!==_typeof(n.input[0])&&n.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,r,a,n=this._get(t,"altField");n&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),r=this._getDate(t),a=this.formatDate(i,r,this._getFormatConfig(t)),e(n).each((function(){e(this).val(a)})))},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,r){if(null==t||null==i)throw"Invalid arguments";if(""===(i="object"===_typeof(i)?i.toString():i+""))return null;var a,n,o,s,l=0,d=(r?r.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof d?d:(new Date).getFullYear()%100+parseInt(d,10),u=(r?r.dayNamesShort:null)||this._defaults.dayNamesShort,p=(r?r.dayNames:null)||this._defaults.dayNames,h=(r?r.monthNamesShort:null)||this._defaults.monthNamesShort,g=(r?r.monthNames:null)||this._defaults.monthNames,f=-1,m=-1,b=-1,v=-1,y=!1,C=function(e){var i=a+1<t.length&&t.charAt(a+1)===e;return i&&a++,i},x=function(e){var t=C(e),r=new RegExp("^\\d{1,"+("@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2)+"}"),a=i.substring(l).match(r);if(!a)throw"Missing number at position "+l;return l+=a[0].length,parseInt(a[0],10)},_=function(t,r,a){var n=-1,o=e.map(C(t)?a:r,(function(e,t){return[[t,e]]})).sort((function(e,t){return-(e[1].length-t[1].length)}));if(e.each(o,(function(e,t){var r=t[1];if(i.substr(l,r.length).toLowerCase()===r.toLowerCase())return n=t[0],l+=r.length,!1})),-1!==n)return n+1;throw"Unknown name at position "+l},z=function(){if(i.charAt(l)!==t.charAt(a))throw"Unexpected literal at position "+l;l++};for(a=0;a<t.length;a++)if(y)"'"!==t.charAt(a)||C("'")?z():y=!1;else switch(t.charAt(a)){case"d":b=x("d");break;case"D":_("D",u,p);break;case"o":v=x("o");break;case"m":m=x("m");break;case"M":m=_("M",h,g);break;case"y":f=x("y");break;case"@":f=(s=new Date(x("@"))).getFullYear(),m=s.getMonth()+1,b=s.getDate();break;case"!":f=(s=new Date((x("!")-this._ticksTo1970)/1e4)).getFullYear(),m=s.getMonth()+1,b=s.getDate();break;case"'":C("'")?z():y=!0;break;default:z()}if(l<i.length&&(o=i.substr(l),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===f?f=(new Date).getFullYear():f<100&&(f+=(new Date).getFullYear()-(new Date).getFullYear()%100+(f<=c?0:-100)),v>-1)for(m=1,b=v;;){if(b<=(n=this._getDaysInMonth(f,m-1)))break;m++,b-=n}if((s=this._daylightSavingAdjust(new Date(f,m-1,b))).getFullYear()!==f||s.getMonth()+1!==m||s.getDate()!==b)throw"Invalid date";return s},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,i){if(!t)return"";var r,a=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,n=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,s=(i?i.monthNames:null)||this._defaults.monthNames,l=function(t){var i=r+1<e.length&&e.charAt(r+1)===t;return i&&r++,i},d=function(e,t,i){var r=""+t;if(l(e))for(;r.length<i;)r="0"+r;return r},c=function(e,t,i,r){return l(e)?r[t]:i[t]},u="",p=!1;if(t)for(r=0;r<e.length;r++)if(p)"'"!==e.charAt(r)||l("'")?u+=e.charAt(r):p=!1;else switch(e.charAt(r)){case"d":u+=d("d",t.getDate(),2);break;case"D":u+=c("D",t.getDay(),a,n);break;case"o":u+=d("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=d("m",t.getMonth()+1,2);break;case"M":u+=c("M",t.getMonth(),o,s);break;case"y":u+=l("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":u+=t.getTime();break;case"!":u+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?u+="'":p=!0;break;default:u+=e.charAt(r)}return u},_possibleChars:function(e){var t,i="",r=!1,a=function(i){var r=t+1<e.length&&e.charAt(t+1)===i;return r&&t++,r};for(t=0;t<e.length;t++)if(r)"'"!==e.charAt(t)||a("'")?i+=e.charAt(t):r=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":a("'")?i+="'":r=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,a=this._getDefaultDate(e),n=a,o=this._getFormatConfig(e);try{n=this.parseDate(i,r,o)||a}catch(e){r=t?"":r}e.selectedDay=n.getDate(),e.drawMonth=e.selectedMonth=n.getMonth(),e.drawYear=e.selectedYear=n.getFullYear(),e.currentDay=r?n.getDate():0,e.currentMonth=r?n.getMonth():0,e.currentYear=r?n.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,r){var a=null==i||""===i?r:"string"==typeof i?function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(e){}for(var r=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,a=r.getFullYear(),n=r.getMonth(),o=r.getDate(),s=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=s.exec(i);l;){switch(l[2]||"d"){case"d":case"D":o+=parseInt(l[1],10);break;case"w":case"W":o+=7*parseInt(l[1],10);break;case"m":case"M":n+=parseInt(l[1],10),o=Math.min(o,e.datepicker._getDaysInMonth(a,n));break;case"y":case"Y":a+=parseInt(l[1],10),o=Math.min(o,e.datepicker._getDaysInMonth(a,n))}l=s.exec(i)}return new Date(a,n,o)}(i):"number"==typeof i?isNaN(i)?r:function(e){var t=new Date;return t.setDate(t.getDate()+e),t}(i):new Date(i.getTime());return(a=a&&"Invalid Date"===a.toString()?r:a)&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var r=!t,a=e.selectedMonth,n=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),a===e.selectedMonth&&n===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(r?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),r="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map((function(){var t={prev:function(){window["DP_jQuery_"+a].datepicker._adjustDate(r,-i,"M")},next:function(){window["DP_jQuery_"+a].datepicker._adjustDate(r,+i,"M")},hide:function(){window["DP_jQuery_"+a].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+a].datepicker._gotoToday(r)},selectDay:function(){return window["DP_jQuery_"+a].datepicker._selectDay(r,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return window["DP_jQuery_"+a].datepicker._selectMonthYear(r,this,"M"),!1},selectYear:function(){return window["DP_jQuery_"+a].datepicker._selectMonthYear(r,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])}))},_generateHTML:function(e){var t,i,r,a,n,o,s,l,d,c,u,p,h,g,f,m,b,v,y,C,x,_,z,T,E,w,R,A,F,P,S,D,I,k,O,M,N,$,B,V=new Date,L=this._daylightSavingAdjust(new Date(V.getFullYear(),V.getMonth(),V.getDate())),X=this._get(e,"isRTL"),H=this._get(e,"showButtonPanel"),U=this._get(e,"hideIfNoPrevNext"),G=this._get(e,"navigationAsDateFormat"),j=this._getNumberOfMonths(e),W=this._get(e,"showCurrentAtPos"),q=this._get(e,"stepMonths"),Y=1!==j[0]||1!==j[1],K=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),J=this._getMinMaxDate(e,"min"),Q=this._getMinMaxDate(e,"max"),Z=e.drawMonth-W,ee=e.drawYear;if(Z<0&&(Z+=12,ee--),Q)for(t=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-j[0]*j[1]+1,Q.getDate())),t=J&&t<J?J:t;this._daylightSavingAdjust(new Date(ee,Z,1))>t;)--Z<0&&(Z=11,ee--);for(e.drawMonth=Z,e.drawYear=ee,i=this._get(e,"prevText"),i=G?this.formatDate(i,this._daylightSavingAdjust(new Date(ee,Z-q,1)),this._getFormatConfig(e)):i,r=this._canAdjustMonth(e,-1,ee,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(X?"e":"w")+"'>"+i+"</span></a>":U?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(X?"e":"w")+"'>"+i+"</span></a>",a=this._get(e,"nextText"),a=G?this.formatDate(a,this._daylightSavingAdjust(new Date(ee,Z+q,1)),this._getFormatConfig(e)):a,n=this._canAdjustMonth(e,1,ee,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+a+"'><span class='ui-icon ui-icon-circle-triangle-"+(X?"w":"e")+"'>"+a+"</span></a>":U?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+a+"'><span class='ui-icon ui-icon-circle-triangle-"+(X?"w":"e")+"'>"+a+"</span></a>",o=this._get(e,"currentText"),s=this._get(e,"gotoCurrent")&&e.currentDay?K:L,o=G?this.formatDate(o,s,this._getFormatConfig(e)):o,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",d=H?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(X?l:"")+(this._isInRange(e,s)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(X?"":l)+"</div>":"",c=parseInt(this._get(e,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(e,"showWeek"),p=this._get(e,"dayNames"),h=this._get(e,"dayNamesMin"),g=this._get(e,"monthNames"),f=this._get(e,"monthNamesShort"),m=this._get(e,"beforeShowDay"),b=this._get(e,"showOtherMonths"),v=this._get(e,"selectOtherMonths"),y=this._getDefaultDate(e),C="",_=0;_<j[0];_++){for(z="",this.maxRows=4,T=0;T<j[1];T++){if(E=this._daylightSavingAdjust(new Date(ee,Z,e.selectedDay)),w=" ui-corner-all",R="",Y){if(R+="<div class='ui-datepicker-group",j[1]>1)switch(T){case 0:R+=" ui-datepicker-group-first",w=" ui-corner-"+(X?"right":"left");break;case j[1]-1:R+=" ui-datepicker-group-last",w=" ui-corner-"+(X?"left":"right");break;default:R+=" ui-datepicker-group-middle",w=""}R+="'>"}for(R+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+w+"'>"+(/all|left/.test(w)&&0===_?X?n:r:"")+(/all|right/.test(w)&&0===_?X?r:n:"")+this._generateMonthYearHeader(e,Z,ee,J,Q,_>0||T>0,g,f)+"</div><table class='ui-datepicker-calendar'><thead><tr>",A=u?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",x=0;x<7;x++)A+="<th"+((x+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+p[F=(x+c)%7]+"'>"+h[F]+"</span></th>";for(R+=A+"</tr></thead><tbody>",P=this._getDaysInMonth(ee,Z),ee===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,P)),S=(this._getFirstDayOfMonth(ee,Z)-c+7)%7,D=Math.ceil((S+P)/7),I=Y&&this.maxRows>D?this.maxRows:D,this.maxRows=I,k=this._daylightSavingAdjust(new Date(ee,Z,1-S)),O=0;O<I;O++){for(R+="<tr>",M=u?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(k)+"</td>":"",x=0;x<7;x++)N=m?m.apply(e.input?e.input[0]:null,[k]):[!0,""],B=($=k.getMonth()!==Z)&&!v||!N[0]||J&&k<J||Q&&k>Q,M+="<td class='"+((x+c+6)%7>=5?" ui-datepicker-week-end":"")+($?" ui-datepicker-other-month":"")+(k.getTime()===E.getTime()&&Z===e.selectedMonth&&e._keyEvent||y.getTime()===k.getTime()&&y.getTime()===E.getTime()?" "+this._dayOverClass:"")+(B?" "+this._unselectableClass+" ui-state-disabled":"")+($&&!b?"":" "+N[1]+(k.getTime()===K.getTime()?" "+this._currentClass:"")+(k.getTime()===L.getTime()?" ui-datepicker-today":""))+"'"+($&&!b||!N[2]?"":" title='"+N[2].replace(/'/g,"&#39;")+"'")+(B?"":" data-handler='selectDay' data-event='click' data-month='"+k.getMonth()+"' data-year='"+k.getFullYear()+"'")+">"+($&&!b?"&#xa0;":B?"<span class='ui-state-default'>"+k.getDate()+"</span>":"<a class='ui-state-default"+(k.getTime()===L.getTime()?" ui-state-highlight":"")+(k.getTime()===K.getTime()?" ui-state-active":"")+($?" ui-priority-secondary":"")+"' href='#'>"+k.getDate()+"</a>")+"</td>",k.setDate(k.getDate()+1),k=this._daylightSavingAdjust(k);R+=M+"</tr>"}++Z>11&&(Z=0,ee++),z+=R+="</tbody></table>"+(Y?"</div>"+(j[0]>0&&T===j[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}C+=z}return C+=d,e._keyEvent=!1,C},_generateMonthYearHeader:function(e,t,i,r,a,n,o,s){var l,d,c,u,p,h,g,f,m=this._get(e,"changeMonth"),b=this._get(e,"changeYear"),v=this._get(e,"showMonthAfterYear"),y="<div class='ui-datepicker-title'>",C="";if(n||!m)C+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(l=r&&r.getFullYear()===i,d=a&&a.getFullYear()===i,C+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;c<12;c++)(!l||c>=r.getMonth())&&(!d||c<=a.getMonth())&&(C+="<option value='"+c+"'"+(c===t?" selected='selected'":"")+">"+s[c]+"</option>");C+="</select>"}if(v||(y+=C+(!n&&m&&b?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",n||!b)y+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(e,"yearRange").split(":"),p=(new Date).getFullYear(),g=(h=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?p+parseInt(e,10):parseInt(e,10);return isNaN(t)?p:t})(u[0]),f=Math.max(g,h(u[1]||"")),g=r?Math.max(g,r.getFullYear()):g,f=a?Math.min(f,a.getFullYear()):f,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g<=f;g++)e.yearshtml+="<option value='"+g+"'"+(g===i?" selected='selected'":"")+">"+g+"</option>";e.yearshtml+="</select>",y+=e.yearshtml,e.yearshtml=null}return y+=this._get(e,"yearSuffix"),v&&(y+=(!n&&m&&b?"":"&#xa0;")+C),y+="</div>"},_adjustInstDate:function(e,t,i){var r=e.drawYear+("Y"===i?t:0),a=e.drawMonth+("M"===i?t:0),n=Math.min(e.selectedDay,this._getDaysInMonth(r,a))+("D"===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,a,n)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),"M"!==i&&"Y"!==i||this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),a=i&&t<i?i:t;return r&&a>r?r:a},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,r){var a=this._getNumberOfMonths(e),n=this._daylightSavingAdjust(new Date(i,r+(t<0?t:a[0]*a[1]),1));return t<0&&n.setDate(this._getDaysInMonth(n.getFullYear(),n.getMonth())),this._isInRange(e,n)},_isInRange:function(e,t){var i,r,a=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),o=null,s=null,l=this._get(e,"yearRange");return l&&(i=l.split(":"),r=(new Date).getFullYear(),o=parseInt(i[0],10),s=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=r),i[1].match(/[+\-].*/)&&(s+=r)),(!a||t.getTime()>=a.getTime())&&(!n||t.getTime()<=n.getTime())&&(!o||t.getFullYear()>=o)&&(!s||t.getFullYear()<=s)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,r){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var a=t?"object"===_typeof(t)?t:this._daylightSavingAdjust(new Date(r,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),a,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each((function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)})):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new n,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.10.2",window["DP_jQuery_"+a]=e}(jQuery),function(e,t){var i={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},r={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{version:"1.10.2",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;i<0&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i=this;this._isOpen&&!1!==this._trigger("beforeClose",t)&&(this._isOpen=!1,this._destroyOverlay(),this.opener.filter(":focusable").focus().length||e(this.document[0].activeElement).blur(),this._hide(this.uiDialog,this.options.hide,(function(){i._trigger("close",t)})))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,t){var i=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return i&&!t&&this._trigger("focus",e),i},open:function(){var t=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,(function(){t._focusTabbable(),t._trigger("focus")})),this._trigger("open"))},_focusTabbable:function(){var e=this.element.find("[autofocus]");e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement;this.uiDialog[0]===t||e.contains(this.uiDialog[0],t)||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB){var i=this.uiDialog.find(":tabbable"),r=i.filter(":first"),a=i.filter(":last");t.target!==a[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==r[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(a.focus(1),t.preventDefault()):(r.focus(1),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?this.uiDialog.removeClass("ui-dialog-buttons"):(e.each(i,(function(i,r){var a,n;r=e.isFunction(r)?{click:r,text:i}:r,r=e.extend({type:"button"},r),a=r.click,r.click=function(){a.apply(t.element[0],arguments)},n={icons:r.icons,text:r.showText},delete r.icons,delete r.showText,e("<button></button>",r).button(n).appendTo(t.uiButtonSet)})),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){var t=this,i=this.options;function r(e){return{position:e.position,offset:e.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,a){e(this).addClass("ui-dialog-dragging"),t._blockFrames(),t._trigger("dragStart",i,r(a))},drag:function(e,i){t._trigger("drag",e,r(i))},stop:function(a,n){i.position=[n.position.left-t.document.scrollLeft(),n.position.top-t.document.scrollTop()],e(this).removeClass("ui-dialog-dragging"),t._unblockFrames(),t._trigger("dragStop",a,r(n))}})},_makeResizable:function(){var t=this,i=this.options,r=i.resizable,a=this.uiDialog.css("position"),n="string"==typeof r?r:"n,e,s,w,se,sw,ne,nw";function o(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:n,start:function(i,r){e(this).addClass("ui-dialog-resizing"),t._blockFrames(),t._trigger("resizeStart",i,o(r))},resize:function(e,i){t._trigger("resize",e,o(i))},stop:function(r,a){i.height=e(this).height(),i.width=e(this).width(),e(this).removeClass("ui-dialog-resizing"),t._unblockFrames(),t._trigger("resizeStop",r,o(a))}}).css("position",a)},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var a=this,n=!1,o={};e.each(t,(function(e,t){a._setOption(e,t),e in i&&(n=!0),e in r&&(o[e]=t)})),n&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",o)},_setOption:function(e,t){var i,r,a=this.uiDialog;"dialogClass"===e&&a.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&((i=a.is(":data(ui-draggable)"))&&!t&&a.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((r=a.is(":data(ui-resizable)"))&&!t&&a.resizable("destroy"),r&&"string"==typeof t&&a.resizable("option","handles",t),r||!1===t||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,r=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),r.minWidth>r.width&&(r.width=r.minWidth),e=this.uiDialog.css({height:"auto",width:r.width}).outerHeight(),t=Math.max(0,r.minHeight-e),i="number"==typeof r.maxHeight?Math.max(0,r.maxHeight-e):"none","auto"===r.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,r.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map((function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]}))},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return!!e(t.target).closest(".ui-dialog").length||!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=this,i=this.widgetFullName;e.ui.dialog.overlayInstances||this._delay((function(){e.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",(function(r){t._allowInteraction(r)||(r.preventDefault(),e(".ui-dialog:visible:last .ui-dialog-content").data(i)._focusTabbable())}))})),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),e.ui.dialog.overlayInstances++}},_getMaxZindex:function(){var t=e("*"),i=1;return e.each(t,(function(t,r){var a=parseInt(e(r).css("z-index"));a>i&&(i=a+1)})),i},_destroyOverlay:function(){this.options.modal&&this.overlay&&(e.ui.dialog.overlayInstances--,e.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),e.ui.dialog.overlayInstances=0,!1!==e.uiBackCompat&&e.widget("ui.dialog",e.ui.dialog,{_position:function(){var t,i=this.options.position,r=[],a=[0,0];i?(("string"==typeof i||"object"===_typeof(i)&&"0"in i)&&(1===(r=i.split?i.split(" "):[i[0],i[1]]).length&&(r[1]=r[0]),e.each(["left","top"],(function(e,t){+r[e]===r[e]&&(a[e]=r[e],r[e]=t)})),i={my:r[0]+(a[0]<0?a[0]:"+"+a[0])+" "+r[1]+(a[1]<0?a[1]:"+"+a[1]),at:r.join(" ")}),i=e.extend({},e.ui.dialog.prototype.options.position,i)):i=e.ui.dialog.prototype.options.position,(t=this.uiDialog.is(":visible"))||this.uiDialog.show(),this.uiDialog.position(i),t||this.uiDialog.hide()}})}(jQuery),function(e,t){var i=/up|down|vertical/,r=/up|left|vertical|horizontal/;e.effects.effect.blind=function(t,a){var n,o,s,l=e(this),d=["position","top","bottom","left","right","height","width"],c=e.effects.setMode(l,t.mode||"hide"),u=t.direction||"up",p=i.test(u),h=p?"height":"width",g=p?"top":"left",f=r.test(u),m={},b="show"===c;l.parent().is(".ui-effects-wrapper")?e.effects.save(l.parent(),d):e.effects.save(l,d),l.show(),o=(n=e.effects.createWrapper(l).css({overflow:"hidden"}))[h](),s=parseFloat(n.css(g))||0,m[h]=b?o:0,f||(l.css(p?"bottom":"right",0).css(p?"top":"left","auto").css({position:"absolute"}),m[g]=b?s:o+s),b&&(n.css(h,0),f||n.css(g,s+o)),n.animate(m,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===c&&l.hide(),e.effects.restore(l,d),e.effects.removeWrapper(l),a()}})}}(jQuery),function(e,t){e.effects.effect.bounce=function(t,i){var r,a,n,o=e(this),s=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(o,t.mode||"effect"),d="hide"===l,c="show"===l,u=t.direction||"up",p=t.distance,h=t.times||5,g=2*h+(c||d?1:0),f=t.duration/g,m=t.easing,b="up"===u||"down"===u?"top":"left",v="up"===u||"left"===u,y=o.queue(),C=y.length;for((c||d)&&s.push("opacity"),e.effects.save(o,s),o.show(),e.effects.createWrapper(o),p||(p=o["top"===b?"outerHeight":"outerWidth"]()/3),c&&((n={opacity:1})[b]=0,o.css("opacity",0).css(b,v?2*-p:2*p).animate(n,f,m)),d&&(p/=Math.pow(2,h-1)),(n={})[b]=0,r=0;r<h;r++)(a={})[b]=(v?"-=":"+=")+p,o.animate(a,f,m).animate(n,f,m),p=d?2*p:p/2;d&&((a={opacity:0})[b]=(v?"-=":"+=")+p,o.animate(a,f,m)),o.queue((function(){d&&o.hide(),e.effects.restore(o,s),e.effects.removeWrapper(o),i()})),C>1&&y.splice.apply(y,[1,0].concat(y.splice(C,g+1))),o.dequeue()}}(jQuery),function(e,t){e.effects.effect.clip=function(t,i){var r,a,n,o=e(this),s=["position","top","bottom","left","right","height","width"],l="show"===e.effects.setMode(o,t.mode||"hide"),d="vertical"===(t.direction||"vertical"),c=d?"height":"width",u=d?"top":"left",p={};e.effects.save(o,s),o.show(),r=e.effects.createWrapper(o).css({overflow:"hidden"}),n=(a="IMG"===o[0].tagName?r:o)[c](),l&&(a.css(c,0),a.css(u,n/2)),p[c]=l?n:0,p[u]=l?0:n/2,a.animate(p,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||o.hide(),e.effects.restore(o,s),e.effects.removeWrapper(o),i()}})}}(jQuery),function(e,t){e.effects.effect.drop=function(t,i){var r,a=e(this),n=["position","top","bottom","left","right","opacity","height","width"],o=e.effects.setMode(a,t.mode||"hide"),s="show"===o,l=t.direction||"left",d="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l?"pos":"neg",u={opacity:s?1:0};e.effects.save(a,n),a.show(),e.effects.createWrapper(a),r=t.distance||a["top"===d?"outerHeight":"outerWidth"](!0)/2,s&&a.css("opacity",0).css(d,"pos"===c?-r:r),u[d]=(s?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+r,a.animate(u,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&a.hide(),e.effects.restore(a,n),e.effects.removeWrapper(a),i()}})}}(jQuery),function(e,t){e.effects.effect.explode=function(t,i){var r,a,n,o,s,l,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=d,u=e(this),p="show"===e.effects.setMode(u,t.mode||"hide"),h=u.show().css("visibility","hidden").offset(),g=Math.ceil(u.outerWidth()/c),f=Math.ceil(u.outerHeight()/d),m=[];function b(){m.push(this),m.length===d*c&&function(){u.css({visibility:"visible"}),e(m).remove(),p||u.hide();i()}()}for(r=0;r<d;r++)for(o=h.top+r*f,l=r-(d-1)/2,a=0;a<c;a++)n=h.left+a*g,s=a-(c-1)/2,u.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*g,top:-r*f}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:g,height:f,left:n+(p?s*g:0),top:o+(p?l*f:0),opacity:p?0:1}).animate({left:n+(p?0:s*g),top:o+(p?0:l*f),opacity:p?1:0},t.duration||500,t.easing,b)}}(jQuery),function(e,t){e.effects.effect.fade=function(t,i){var r=e(this),a=e.effects.setMode(r,t.mode||"toggle");r.animate({opacity:a},{queue:!1,duration:t.duration,easing:t.easing,complete:i})}}(jQuery),function(e,t){e.effects.effect.fold=function(t,i){var r,a,n=e(this),o=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(n,t.mode||"hide"),l="show"===s,d="hide"===s,c=t.size||15,u=/([0-9]+)%/.exec(c),p=!!t.horizFirst,h=l!==p,g=h?["width","height"]:["height","width"],f=t.duration/2,m={},b={};e.effects.save(n,o),n.show(),r=e.effects.createWrapper(n).css({overflow:"hidden"}),a=h?[r.width(),r.height()]:[r.height(),r.width()],u&&(c=parseInt(u[1],10)/100*a[d?0:1]),l&&r.css(p?{height:0,width:c}:{height:c,width:0}),m[g[0]]=l?a[0]:c,b[g[1]]=l?a[1]:0,r.animate(m,f,t.easing).animate(b,f,t.easing,(function(){d&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()}))}}(jQuery),function(e,t){e.effects.effect.highlight=function(t,i){var r=e(this),a=["backgroundImage","backgroundColor","opacity"],n=e.effects.setMode(r,t.mode||"show"),o={backgroundColor:r.css("backgroundColor")};"hide"===n&&(o.opacity=0),e.effects.save(r,a),r.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===n&&r.hide(),e.effects.restore(r,a),i()}})}}(jQuery),function(e,t){e.effects.effect.pulsate=function(t,i){var r,a=e(this),n=e.effects.setMode(a,t.mode||"show"),o="show"===n,s="hide"===n,l=o||"hide"===n,d=2*(t.times||5)+(l?1:0),c=t.duration/d,u=0,p=a.queue(),h=p.length;for(!o&&a.is(":visible")||(a.css("opacity",0).show(),u=1),r=1;r<d;r++)a.animate({opacity:u},c,t.easing),u=1-u;a.animate({opacity:u},c,t.easing),a.queue((function(){s&&a.hide(),i()})),h>1&&p.splice.apply(p,[1,0].concat(p.splice(h,d+1))),a.dequeue()}}(jQuery),function(e,t){e.effects.effect.puff=function(t,i){var r=e(this),a=e.effects.setMode(r,t.mode||"hide"),n="hide"===a,o=parseInt(t.percent,10)||150,s=o/100,l={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:a,complete:i,percent:n?o:100,from:n?l:{height:l.height*s,width:l.width*s,outerHeight:l.outerHeight*s,outerWidth:l.outerWidth*s}}),r.effect(t)},e.effects.effect.scale=function(t,i){var r=e(this),a=e.extend(!0,{},t),n=e.effects.setMode(r,t.mode||"effect"),o=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===n?0:100),s=t.direction||"both",l=t.origin,d={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()},c="horizontal"!==s?o/100:1,u="vertical"!==s?o/100:1;a.effect="size",a.queue=!1,a.complete=i,"effect"!==n&&(a.origin=l||["middle","center"],a.restore=!0),a.from=t.from||("show"===n?{height:0,width:0,outerHeight:0,outerWidth:0}:d),a.to={height:d.height*c,width:d.width*u,outerHeight:d.outerHeight*c,outerWidth:d.outerWidth*u},a.fade&&("show"===n&&(a.from.opacity=0,a.to.opacity=1),"hide"===n&&(a.from.opacity=1,a.to.opacity=0)),r.effect(a)},e.effects.effect.size=function(t,i){var r,a,n,o=e(this),s=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["width","height","overflow"],d=["fontSize"],c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],u=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(o,t.mode||"effect"),h=t.restore||"effect"!==p,g=t.scale||"both",f=t.origin||["middle","center"],m=o.css("position"),b=h?s:["position","top","bottom","left","right","overflow","opacity"],v={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&o.show(),r={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},"toggle"===t.mode&&"show"===p?(o.from=t.to||v,o.to=t.from||r):(o.from=t.from||("show"===p?v:r),o.to=t.to||("hide"===p?v:r)),n={from:{y:o.from.height/r.height,x:o.from.width/r.width},to:{y:o.to.height/r.height,x:o.to.width/r.width}},"box"!==g&&"both"!==g||(n.from.y!==n.to.y&&(b=b.concat(c),o.from=e.effects.setTransition(o,c,n.from.y,o.from),o.to=e.effects.setTransition(o,c,n.to.y,o.to)),n.from.x!==n.to.x&&(b=b.concat(u),o.from=e.effects.setTransition(o,u,n.from.x,o.from),o.to=e.effects.setTransition(o,u,n.to.x,o.to))),"content"!==g&&"both"!==g||n.from.y!==n.to.y&&(b=b.concat(d).concat(l),o.from=e.effects.setTransition(o,d,n.from.y,o.from),o.to=e.effects.setTransition(o,d,n.to.y,o.to)),e.effects.save(o,b),o.show(),e.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),f&&(a=e.effects.getBaseline(f,r),o.from.top=(r.outerHeight-o.outerHeight())*a.y,o.from.left=(r.outerWidth-o.outerWidth())*a.x,o.to.top=(r.outerHeight-o.to.outerHeight)*a.y,o.to.left=(r.outerWidth-o.to.outerWidth)*a.x),o.css(o.from),"content"!==g&&"both"!==g||(c=c.concat(["marginTop","marginBottom"]).concat(d),u=u.concat(["marginLeft","marginRight"]),l=s.concat(c).concat(u),o.find("*[width]").each((function(){var i=e(this),r=i.height(),a=i.width(),o=i.outerHeight(),s=i.outerWidth();h&&e.effects.save(i,l),i.from={height:r*n.from.y,width:a*n.from.x,outerHeight:o*n.from.y,outerWidth:s*n.from.x},i.to={height:r*n.to.y,width:a*n.to.x,outerHeight:r*n.to.y,outerWidth:a*n.to.x},n.from.y!==n.to.y&&(i.from=e.effects.setTransition(i,c,n.from.y,i.from),i.to=e.effects.setTransition(i,c,n.to.y,i.to)),n.from.x!==n.to.x&&(i.from=e.effects.setTransition(i,u,n.from.x,i.from),i.to=e.effects.setTransition(i,u,n.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,(function(){h&&e.effects.restore(i,l)}))}))),o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===o.to.opacity&&o.css("opacity",o.from.opacity),"hide"===p&&o.hide(),e.effects.restore(o,b),h||("static"===m?o.css({position:"relative",top:o.to.top,left:o.to.left}):e.each(["top","left"],(function(e,t){o.css(t,(function(t,i){var r=parseInt(i,10),a=e?o.to.left:o.to.top;return"auto"===i?a+"px":r+a+"px"}))}))),e.effects.removeWrapper(o),i()}})}}(jQuery),function(e,t){e.effects.effect.shake=function(t,i){var r,a=e(this),n=["position","top","bottom","left","right","height","width"],o=e.effects.setMode(a,t.mode||"effect"),s=t.direction||"left",l=t.distance||20,d=t.times||3,c=2*d+1,u=Math.round(t.duration/c),p="up"===s||"down"===s?"top":"left",h="up"===s||"left"===s,g={},f={},m={},b=a.queue(),v=b.length;for(e.effects.save(a,n),a.show(),e.effects.createWrapper(a),g[p]=(h?"-=":"+=")+l,f[p]=(h?"+=":"-=")+2*l,m[p]=(h?"-=":"+=")+2*l,a.animate(g,u,t.easing),r=1;r<d;r++)a.animate(f,u,t.easing).animate(m,u,t.easing);a.animate(f,u,t.easing).animate(g,u/2,t.easing).queue((function(){"hide"===o&&a.hide(),e.effects.restore(a,n),e.effects.removeWrapper(a),i()})),v>1&&b.splice.apply(b,[1,0].concat(b.splice(v,c+1))),a.dequeue()}}(jQuery),function(e,t){e.effects.effect.slide=function(t,i){var r,a=e(this),n=["position","top","bottom","left","right","width","height"],o=e.effects.setMode(a,t.mode||"show"),s="show"===o,l=t.direction||"left",d="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l,u={};e.effects.save(a,n),a.show(),r=t.distance||a["top"===d?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(a).css({overflow:"hidden"}),s&&a.css(d,c?isNaN(r)?"-"+r:-r:r),u[d]=(s?c?"+=":"-=":c?"-=":"+=")+r,a.animate(u,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&a.hide(),e.effects.restore(a,n),e.effects.removeWrapper(a),i()}})}}(jQuery),function(e,t){e.effects.effect.transfer=function(t,i){var r=e(this),a=e(t.to),n="fixed"===a.css("position"),o=e("body"),s=n?o.scrollTop():0,l=n?o.scrollLeft():0,d=a.offset(),c={top:d.top-s,left:d.left-l,height:a.innerHeight(),width:a.innerWidth()},u=r.offset(),p=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:u.top-s,left:u.left-l,height:r.innerHeight(),width:r.innerWidth(),position:n?"fixed":"absolute"}).animate(c,t.duration,t.easing,(function(){p.remove(),i()}))}}(jQuery),function(e,t){e.widget("ui.menu",{version:"1.10.2",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy((function(e){this.options.disabled&&e.preventDefault()}),this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){var i=e(t.target).closest(".ui-menu-item");!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.mouseHandled=!0,this.select(t),i.has(".ui-menu").length?this.expand(t):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var i=e(t.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,i)},blur:function(t){this._delay((function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)}))},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each((function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()})),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){var i,r,a,n,o,s=!0;function l(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:s=!1,r=this.previousFilter||"",a=String.fromCharCode(t.keyCode),n=!1,clearTimeout(this.filterTimer),a===r?n=!0:a=r+a,o=new RegExp("^"+l(a),"i"),i=this.activeMenu.children(".ui-menu-item").filter((function(){return o.test(e(this).children("a").text())})),(i=n&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i).length||(a=String.fromCharCode(t.keyCode),o=new RegExp("^"+l(a),"i"),i=this.activeMenu.children(".ui-menu-item").filter((function(){return o.test(e(this).children("a").text())}))),i.length?(this.focus(t,i),i.length>1?(this.previousFilter=a,this.filterTimer=this._delay((function(){delete this.previousFilter}),1e3)):delete this.previousFilter):delete this.previousFilter}s&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,i=this.options.icons.submenu,r=this.element.find(this.options.menus);r.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each((function(){var t=e(this),r=t.prev("a"),a=e("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);r.attr("aria-haspopup","true").prepend(a),t.attr("aria-labelledby",r.attr("id"))})),(t=r.add(this.element)).children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each((function(){var t=e(this);/[^\-\u2014\u2013\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")})),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),this._super(e,t)},focus:function(e,t){var i,r;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),r=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay((function(){this._close()}),this.delay),(i=t.children(".ui-menu")).length&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,r,a,n,o,s;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,r=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,a=t.offset().top-this.activeMenu.offset().top-i-r,n=this.activeMenu.scrollTop(),o=this.activeMenu.height(),s=t.height(),a<0?this.activeMenu.scrollTop(n+a):a+s>o&&this.activeMenu.scrollTop(n+a-o+s))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay((function(){this._close(),this._open(e)}),this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay((function(){var r=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element),this._close(r),this.blur(t),this.activeMenu=r}),this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay((function(){this.focus(e,t)})))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var r;this.active&&(r="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),r&&r.length&&this.active||(r=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(i,r)},nextPage:function(t){var i,r,a;this.active?this.isLastItem()||(this._hasScroll()?(r=this.active.offset().top,a=this.element.height(),this.active.nextAll(".ui-menu-item").each((function(){return(i=e(this)).offset().top-r-a<0})),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())):this.next(t)},previousPage:function(t){var i,r,a;this.active?this.isFirstItem()||(this._hasScroll()?(r=this.active.offset().top,a=this.element.height(),this.active.prevAll(".ui-menu-item").each((function(){return(i=e(this)).offset().top-r+a>0})),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item").first())):this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)}})}(jQuery),function(e,t){e.ui=e.ui||{};var i,r=Math.max,a=Math.abs,n=Math.round,o=/left|center|right/,s=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,c=/%$/,u=e.fn.position;function p(e,t,i){return[parseFloat(e[0])*(c.test(e[0])?t/100:1),parseFloat(e[1])*(c.test(e[1])?i/100:1)]}function h(t,i){return parseInt(e.css(t,i),10)||0}function g(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.position={scrollbarWidth:function(){if(void 0!==i)return i;var t,r,a=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),n=a.children()[0];return e("body").append(a),t=n.offsetWidth,a.css("overflow","scroll"),t===(r=n.offsetWidth)&&(r=a[0].clientWidth),a.remove(),i=t-r},getScrollInfo:function(t){var i=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),a="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth;return{width:"scroll"===r||"auto"===r&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:a?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),r=e.isWindow(i[0]);return{element:i,isWindow:r,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:r?i.width():i.outerWidth(),height:r?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return u.apply(this,arguments);t=e.extend({},t);var i,c,f,m,b,v,y=e(t.of),C=e.position.getWithinInfo(t.within),x=e.position.getScrollInfo(C),_=(t.collision||"flip").split(" "),z={};return v=g(y),y[0].preventDefault&&(t.at="left top"),c=v.width,f=v.height,m=v.offset,b=e.extend({},m),e.each(["my","at"],(function(){var e,i,r=(t[this]||"").split(" ");1===r.length&&(r=o.test(r[0])?r.concat(["center"]):s.test(r[0])?["center"].concat(r):["center","center"]),r[0]=o.test(r[0])?r[0]:"center",r[1]=s.test(r[1])?r[1]:"center",e=l.exec(r[0]),i=l.exec(r[1]),z[this]=[e?e[0]:0,i?i[0]:0],t[this]=[d.exec(r[0])[0],d.exec(r[1])[0]]})),1===_.length&&(_[1]=_[0]),"right"===t.at[0]?b.left+=c:"center"===t.at[0]&&(b.left+=c/2),"bottom"===t.at[1]?b.top+=f:"center"===t.at[1]&&(b.top+=f/2),i=p(z.at,c,f),b.left+=i[0],b.top+=i[1],this.each((function(){var o,s,l=e(this),d=l.outerWidth(),u=l.outerHeight(),g=h(this,"marginLeft"),v=h(this,"marginTop"),T=d+g+h(this,"marginRight")+x.width,E=u+v+h(this,"marginBottom")+x.height,w=e.extend({},b),R=p(z.my,l.outerWidth(),l.outerHeight());"right"===t.my[0]?w.left-=d:"center"===t.my[0]&&(w.left-=d/2),"bottom"===t.my[1]?w.top-=u:"center"===t.my[1]&&(w.top-=u/2),w.left+=R[0],w.top+=R[1],e.support.offsetFractions||(w.left=n(w.left),w.top=n(w.top)),o={marginLeft:g,marginTop:v},e.each(["left","top"],(function(r,a){e.ui.position[_[r]]&&e.ui.position[_[r]][a](w,{targetWidth:c,targetHeight:f,elemWidth:d,elemHeight:u,collisionPosition:o,collisionWidth:T,collisionHeight:E,offset:[i[0]+R[0],i[1]+R[1]],my:t.my,at:t.at,within:C,elem:l})})),t.using&&(s=function(e){var i=m.left-w.left,n=i+c-d,o=m.top-w.top,s=o+f-u,p={target:{element:y,left:m.left,top:m.top,width:c,height:f},element:{element:l,left:w.left,top:w.top,width:d,height:u},horizontal:n<0?"left":i>0?"right":"center",vertical:s<0?"top":o>0?"bottom":"middle"};c<d&&a(i+n)<c&&(p.horizontal="center"),f<u&&a(o+s)<f&&(p.vertical="middle"),r(a(i),a(n))>r(a(o),a(s))?p.important="horizontal":p.important="vertical",t.using.call(this,e,p)}),l.offset(e.extend(w,{using:s}))}))},e.ui.position={fit:{left:function(e,t){var i,a=t.within,n=a.isWindow?a.scrollLeft:a.offset.left,o=a.width,s=e.left-t.collisionPosition.marginLeft,l=n-s,d=s+t.collisionWidth-o-n;t.collisionWidth>o?l>0&&d<=0?(i=e.left+l+t.collisionWidth-o-n,e.left+=l-i):e.left=d>0&&l<=0?n:l>d?n+o-t.collisionWidth:n:l>0?e.left+=l:d>0?e.left-=d:e.left=r(e.left-s,e.left)},top:function(e,t){var i,a=t.within,n=a.isWindow?a.scrollTop:a.offset.top,o=t.within.height,s=e.top-t.collisionPosition.marginTop,l=n-s,d=s+t.collisionHeight-o-n;t.collisionHeight>o?l>0&&d<=0?(i=e.top+l+t.collisionHeight-o-n,e.top+=l-i):e.top=d>0&&l<=0?n:l>d?n+o-t.collisionHeight:n:l>0?e.top+=l:d>0?e.top-=d:e.top=r(e.top-s,e.top)}},flip:{left:function(e,t){var i,r,n=t.within,o=n.offset.left+n.scrollLeft,s=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,d=e.left-t.collisionPosition.marginLeft,c=d-l,u=d+t.collisionWidth-s-l,p="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,h="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,g=-2*t.offset[0];c<0?((i=e.left+p+h+g+t.collisionWidth-s-o)<0||i<a(c))&&(e.left+=p+h+g):u>0&&((r=e.left-t.collisionPosition.marginLeft+p+h+g-l)>0||a(r)<u)&&(e.left+=p+h+g)},top:function(e,t){var i,r,n=t.within,o=n.offset.top+n.scrollTop,s=n.height,l=n.isWindow?n.scrollTop:n.offset.top,d=e.top-t.collisionPosition.marginTop,c=d-l,u=d+t.collisionHeight-s-l,p="top"===t.my[1],h=p?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,g="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,f=-2*t.offset[1];c<0?(r=e.top+h+g+f+t.collisionHeight-s-o,e.top+h+g+f>c&&(r<0||r<a(c))&&(e.top+=h+g+f)):u>0&&(i=e.top-t.collisionPosition.marginTop+h+g+f-l,e.top+h+g+f>u&&(i>0||a(i)<u)&&(e.top+=h+g+f))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,r,a,n,o=document.getElementsByTagName("body")[0],s=document.createElement("div");for(n in t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"}),r)t.style[n]=r[n];t.appendChild(s),(i=o||document.documentElement).insertBefore(t,i.firstChild),s.style.cssText="position: absolute; left: 10.7432222px;",a=e(s).offset().left,e.support.offsetFractions=a>10&&a<11,t.innerHTML="",i.removeChild(t)}()}(jQuery),function(e,t){e.widget("ui.progressbar",{version:"1.10.2",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){if(void 0===e)return this.options.value;this.options.value=this._constrainedValue(e),this._refreshValue()},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=!1===e,"number"!=typeof e&&(e=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}})}(jQuery),function(e,t){e.widget("ui.slider",e.ui.mouse,{version:"1.10.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,r=this.options,a=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),n=[];for(i=r.values&&r.values.length||1,a.length>i&&(a.slice(i).remove(),a=a.slice(0,i)),t=a.length;t<i;t++)n.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");this.handles=a.add(e(n.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each((function(t){e(this).data("ui-slider-handle-index",t)}))},_createRange:function(){var t=this.options,i="";t.range?(!0===t.range&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):this.range=e([])},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,r,a,n,o,s,l,d=this,c=this.options;return!c.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(i),a=this._valueMax()-this._valueMin()+1,this.handles.each((function(t){var i=Math.abs(r-d.values(t));(a>i||a===i&&(t===d._lastChangedValue||d.values(t)===c.min))&&(a=i,n=e(this),o=t)})),!1!==this._start(t,o)&&(this._mouseSliding=!0,this._handleIndex=o,n.addClass("ui-state-active").focus(),s=n.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-s.left-n.width()/2,top:t.pageY-s.top-n.height()/2-(parseInt(n.css("borderTopWidth"),10)||0)-(parseInt(n.css("borderBottomWidth"),10)||0)+(parseInt(n.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,r,a,n;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),(r=i/t)>1&&(r=1),r<0&&(r=0),"vertical"===this.orientation&&(r=1-r),a=this._valueMax()-this._valueMin(),n=this._valueMin()+r*a,this._trimAlignValue(n)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var r,a,n;this.options.values&&this.options.values.length?(r=this.values(t?0:1),2===this.options.values.length&&!0===this.options.range&&(0===t&&i>r||1===t&&i<r)&&(i=r),i!==this.values(t)&&((a=this.values())[t]=i,n=this._trigger("slide",e,{handle:this.handles[t],value:i,values:a}),r=this.values(t?0:1),!1!==n&&this.values(t,i,!0))):i!==this.value()&&!1!==(n=this._trigger("slide",e,{handle:this.handles[t],value:i}))&&this.value(i)},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var r,a,n;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(r=this.options.values,a=arguments[0],n=0;n<r.length;n+=1)r[n]=this._trimAlignValue(a[n]),this._change(null,n);this._refreshValue()},_setOption:function(t,i){var r,a=0;switch("range"===t&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(a=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=0;r<a;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),r=0;r<i.length;r+=1)i[r]=this._trimAlignValue(i[r]);return i}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,r=e-i;return 2*Math.abs(i)>=t&&(r+=i>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,r,a,n,o=this.options.range,s=this.options,l=this,d=!this._animateOff&&s.animate,c={};this.options.values&&this.options.values.length?this.handles.each((function(r){i=(l.values(r)-l._valueMin())/(l._valueMax()-l._valueMin())*100,c["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[d?"animate":"css"](c,s.animate),!0===l.options.range&&("horizontal"===l.orientation?(0===r&&l.range.stop(1,1)[d?"animate":"css"]({left:i+"%"},s.animate),1===r&&l.range[d?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:s.animate})):(0===r&&l.range.stop(1,1)[d?"animate":"css"]({bottom:i+"%"},s.animate),1===r&&l.range[d?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:s.animate}))),t=i})):(r=this.value(),a=this._valueMin(),n=this._valueMax(),i=n!==a?(r-a)/(n-a)*100:0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[d?"animate":"css"](c,s.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[d?"animate":"css"]({width:i+"%"},s.animate),"max"===o&&"horizontal"===this.orientation&&this.range[d?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:s.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[d?"animate":"css"]({height:i+"%"},s.animate),"max"===o&&"vertical"===this.orientation&&this.range[d?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:s.animate}))},_handleEvents:{keydown:function(t){var i,r,a,n=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),!1===this._start(t,n)))return}switch(a=this.options.step,i=r=this.options.values&&this.options.values.length?this.values(n):this.value(),t.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/5);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/5);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;r=this._trimAlignValue(i+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;r=this._trimAlignValue(i-a)}this._slide(t,n,r)},click:function(e){e.preventDefault()},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),function(e){function t(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.widget("ui.spinner",{version:"1.10.2",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],(function(e,r){var a=i.attr(r);void 0!==a&&a.length&&(t[r]=a)})),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay((function(){this.spinning&&this._stop(e)}),100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){var i;function r(){this.element[0]===this.document[0].activeElement||(this.element.focus(),this.previous=i,this._delay((function(){this.previous=i})))}i=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),r.call(this),this.cancelBlur=!0,this._delay((function(){delete this.cancelBlur,r.call(this)})),!1!==this._start(t)&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(e(t.currentTarget).hasClass("ui-state-active"))return!1!==this._start(t)&&void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var i=this.options,r=e.ui.keyCode;switch(t.keyCode){case r.UP:return this._repeat(null,1,t),!0;case r.DOWN:return this._repeat(null,-1,t),!0;case r.PAGE_UP:return this._repeat(null,i.page,t),!0;case r.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e))&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay((function(){this._repeat(40,t,i)}),e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,r=this.options;return i=e-(t=null!==r.min?r.min:0),e=t+(i=Math.round(i/r.step)*r.step),e=parseFloat(e.toFixed(this._precision())),null!==r.max&&e>r.max?r.max:null!==r.min&&e<r.min?r.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,void this.element.val(this._format(i))}"max"!==e&&"min"!==e&&"step"!==e||"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:t((function(e){this._super(e),this._value(this.element.val())})),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(e,t){var i;""!==e&&null!==(i=this._parse(e))&&(t||(i=this._adjustValue(i)),e=this._format(i)),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t((function(e){this._stepUp(e)})),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:t((function(e){this._stepDown(e)})),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:t((function(e){this._stepUp((e||1)*this.options.page)})),pageDown:t((function(e){this._stepDown((e||1)*this.options.page)})),value:function(e){if(!arguments.length)return this._parse(this.element.val());t(this._value).call(this,e)},widget:function(){return this.uiSpinner}})}(jQuery),function(e,t){var i=0,r=/#.*$/;function a(e){return e.hash.length>1&&decodeURIComponent(e.href.replace(r,""))===decodeURIComponent(location.href.replace(r,""))}e.widget("ui.tabs",{version:"1.10.2",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,(function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()})).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,(function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()})),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),(function(e){return t.tabs.index(e)})))).sort()),!1!==this.options.active&&this.anchors.length?this.active=this._findActive(i.active):this.active=e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,r=location.hash.substring(1);return null===t&&(r&&this.tabs.each((function(i,a){if(e(a).attr("aria-controls")===r)return t=i,!1})),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==t&&-1!==t||(t=!!this.tabs.length&&0)),!1!==t&&-1===(t=this.tabs.index(this.tabs.eq(t)))&&(t=!i&&0),!i&&!1===t&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),r=this.tabs.index(i),a=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:r++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:a=!1,r--;break;case e.ui.keyCode.END:r=this.anchors.length-1;break;case e.ui.keyCode.HOME:r=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(r);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(r!==this.options.active&&r);default:return}t.preventDefault(),clearTimeout(this.activating),r=this._focusNextTab(r,a),t.ctrlKey||(i.attr("aria-selected","false"),this.tabs.eq(r).attr("aria-selected","true"),this.activating=this._delay((function(){this.option("active",r)}),this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){var r=this.tabs.length-1;for(;-1!==e.inArray((t>r&&(t=0),t<0&&(t=r),t),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){"active"!==e?"disabled"!==e?(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t)):this._setupDisabled(t):this._activate(t)},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+ ++i},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),(function(e){return i.index(e)})),this._processTabs(),!1!==t.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map((function(){return e("a",this)[0]})).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each((function(i,r){var n,o,s,l=e(r).uniqueId().attr("id"),d=e(r).closest("li"),c=d.attr("aria-controls");a(r)?(n=r.hash,o=t.element.find(t._sanitizeSelector(n))):(n="#"+(s=t._tabId(d)),(o=t.element.find(n)).length||(o=t._createPanel(s)).insertAfter(t.panels[i-1]||t.tablist),o.attr("aria-live","polite")),o.length&&(t.panels=t.panels.add(o)),c&&d.data("ui-tabs-aria-controls",c),d.attr({"aria-controls":n.substring(1),"aria-labelledby":l}),o.attr("aria-labelledby",l)})),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,r=0;i=this.tabs[r];r++)!0===t||-1!==e.inArray(r,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),(function(e,t){i[t]="_eventHandler"})),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,r=this.element.parent();"fill"===t?(i=r.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each((function(){var t=e(this),r=t.css("position");"absolute"!==r&&"fixed"!==r&&(i-=t.outerHeight(!0))})),this.element.children().not(this.panels).each((function(){i-=e(this).outerHeight(!0)})),this.panels.each((function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))})).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each((function(){i=Math.max(i,e(this).height("").height())})).height(i))},_eventHandler:function(t){var i=this.options,r=this.active,a=e(t.currentTarget).closest("li"),n=a[0]===r[0],o=n&&i.collapsible,s=o?e():this._getPanelForTab(a),l=r.length?this._getPanelForTab(r):e(),d={oldTab:r,oldPanel:l,newTab:o?e():a,newPanel:s};t.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||n&&!i.collapsible||!1===this._trigger("beforeActivate",t,d)||(i.active=!o&&this.tabs.index(a),this.active=n?e():a,this.xhr&&this.xhr.abort(),l.length||s.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),s.length&&this.load(this.tabs.index(a),t),this._toggle(t,d))},_toggle:function(t,i){var r=this,a=i.newPanel,n=i.oldPanel;function o(){r.running=!1,r._trigger("activate",t,i)}function s(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),a.length&&r.options.show?r._show(a,r.options.show,o):(a.show(),o())}this.running=!0,n.length&&this.options.hide?this._hide(n,this.options.hide,(function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),s()})):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n.hide(),s()),n.attr({"aria-expanded":"false","aria-hidden":"true"}),i.oldTab.attr("aria-selected","false"),a.length&&n.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter((function(){return 0===e(this).attr("tabIndex")})).attr("tabIndex",-1),a.attr({"aria-expanded":"true","aria-hidden":"false"}),i.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var i,r=this._findActive(t);r[0]!==this.active[0]&&(r.length||(r=this.active),i=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return!1===t?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each((function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")})),this.tabs.each((function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")})),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var i=this.options.disabled;!1!==i&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,(function(e){return e!==t?e:null})):e.map(this.tabs,(function(e,i){return i!==t?i:null}))),this._setupDisabled(i))},disable:function(t){var i=this.options.disabled;if(!0!==i){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setupDisabled(i)}},load:function(t,i){t=this._getIndex(t);var r=this,n=this.tabs.eq(t),o=n.find(".ui-tabs-anchor"),s=this._getPanelForTab(n),l={tab:n,panel:s};a(o[0])||(this.xhr=e.ajax(this._ajaxSettings(o,i,l)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),s.attr("aria-busy","true"),this.xhr.success((function(e){setTimeout((function(){s.html(e),r._trigger("load",i,l)}),1)})).complete((function(e,t){setTimeout((function(){"abort"===t&&r.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),s.removeAttr("aria-busy"),e===r.xhr&&delete r.xhr}),1)}))))},_ajaxSettings:function(t,i,r){var a=this;return{url:t.attr("href"),beforeSend:function(t,n){return a._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:n},r))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}})}(jQuery),function(e){var t=0;e.widget("ui.tooltip",{version:"1.10.2",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,i){var r=this;if("disabled"===t)return this[i?"_disable":"_enable"](),void(this.options[t]=i);this._super(t,i),"content"===t&&e.each(this.tooltips,(function(e,t){r._updateContent(t)}))},_disable:function(){var t=this;e.each(this.tooltips,(function(i,r){var a=e.Event("blur");a.target=a.currentTarget=r[0],t.close(a,!0)})),this.element.find(this.options.items).addBack().each((function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")}))},_enable:function(){this.element.find(this.options.items).addBack().each((function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))}))},open:function(t){var i=this,r=e(t?t.target:this.element).closest(this.options.items);r.length&&!r.data("ui-tooltip-id")&&(r.attr("title")&&r.data("ui-tooltip-title",r.attr("title")),r.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&r.parents().each((function(){var t,r=e(this);r.data("ui-tooltip-open")&&((t=e.Event("blur")).target=t.currentTarget=this,i.close(t,!0)),r.attr("title")&&(r.uniqueId(),i.parents[this.id]={element:this,title:r.attr("title")},r.attr("title",""))})),this._updateContent(r,t))},_updateContent:function(e,t){var i,r=this.options.content,a=this,n=t?t.type:null;if("string"==typeof r)return this._open(t,e,r);(i=r.call(e[0],(function(i){e.data("ui-tooltip-open")&&a._delay((function(){t&&(t.type=n),this._open(t,e,i)}))})))&&this._open(t,e,i)},_open:function(t,i,r){var a,n,o,s,l,d,c=e.extend({},this.options.position);r&&((a=this._find(i)).length?a.find(".ui-tooltip-content").html(r):(i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),a=this._tooltip(i),s=i,l=a.attr("id"),(d=(s.attr("aria-describedby")||"").split(/\s+/)).push(l),s.data("ui-tooltip-id",l).attr("aria-describedby",e.trim(d.join(" "))),a.find(".ui-tooltip-content").html(r),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:u}),u(t)):a.position(e.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.show&&this.options.show.delay&&(o=this.delayedShow=setInterval((function(){a.is(":visible")&&(u(c.of),clearInterval(o))}),e.fx.interval)),this._trigger("open",t,{tooltip:a}),n={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var r=e.Event(t);r.currentTarget=i[0],this.close(r,!0)}},remove:function(){this._removeTooltip(a)}},t&&"mouseover"!==t.type||(n.mouseleave="close"),t&&"focusin"!==t.type||(n.focusout="close"),this._on(!0,i,n)));function u(e){c.of=e,a.is(":hidden")||a.position(c)}},close:function(t){var i,r,a,n,o=this,s=e(t?t.currentTarget:this.element),l=this._find(s);this.closing||(clearInterval(this.delayedShow),s.data("ui-tooltip-title")&&s.attr("title",s.data("ui-tooltip-title")),r=(i=s).data("ui-tooltip-id"),a=(i.attr("aria-describedby")||"").split(/\s+/),-1!==(n=e.inArray(r,a))&&a.splice(n,1),i.removeData("ui-tooltip-id"),(a=e.trim(a.join(" ")))?i.attr("aria-describedby",a):i.removeAttr("aria-describedby"),l.stop(!0),this._hide(l,this.options.hide,(function(){o._removeTooltip(e(this))})),s.removeData("ui-tooltip-open"),this._off(s,"mouseleave focusout keyup"),s[0]!==this.element[0]&&this._off(s,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,(function(t,i){e(i.element).attr("title",i.title),delete o.parents[t]})),this.closing=!0,this._trigger("close",t,{tooltip:l}),this.closing=!1)},_tooltip:function(i){var r="ui-tooltip-"+t++,a=e("<div>").attr({id:r,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(a),a.appendTo(this.document[0].body),this.tooltips[r]=i,a},_find:function(t){var i=t.data("ui-tooltip-id");return i?e("#"+i):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,(function(i,r){var a=e.Event("blur");a.target=a.currentTarget=r[0],t.close(a,!0),e("#"+i).remove(),r.data("ui-tooltip-title")&&(r.attr("title",r.data("ui-tooltip-title")),r.removeData("ui-tooltip-title"))}))}})}(jQuery),function(e){function t(t){var i=e.formatCurrency.regions[t];if(i)return i;if(/(\w+)-(\w+)/g.test(t)){var r=t.replace(/(\w+)-(\w+)/g,"$1");return e.formatCurrency.regions[r]}return null}function i(e){if(""===e.symbol)return new RegExp("[^\\d"+e.decimalSymbol+"-]","g");var t=e.symbol.replace("$","\\$").replace(".","\\.");return new RegExp(t+"|[^\\d"+e.decimalSymbol+"-]","g")}e.formatCurrency={},e.formatCurrency.regions=[],e.formatCurrency.regions[""]={symbol:"$",positiveFormat:"%s%n",negativeFormat:"(%s%n)",decimalSymbol:".",digitGroupSymbol:",",groupDigits:!0},e.fn.formatCurrency=function(r,a){1==arguments.length&&"string"!=typeof r&&(a=r,r=!1);var n={name:"formatCurrency",colorize:!1,region:"",global:!0,roundToDecimalPlace:2,eventOnDecimalsEntered:!1};return n=e.extend(n,e.formatCurrency.regions[""]),(a=e.extend(n,a)).region.length>0&&(a=e.extend(a,t(a.region))),a.regex=i(a),this.each((function(){var t=e(this),i="0",n=new RegExp("^(0+|-0+)","g");if((i=t[t.is("input, select, textarea")?"val":"html"]()).search("\\(")>=0&&(i="-"+i),i.match(/[1-9]/g)||(i=i.replace(n,0)),""!==i&&("-"!==i||-1!==a.roundToDecimalPlace)){if(isNaN(i)){if(""===(i=i.replace(a.regex,""))||"-"===i&&-1===a.roundToDecimalPlace)return;"."!=a.decimalSymbol&&(i=i.replace(a.decimalSymbol,".")),isNaN(i)&&(i="0")}var o=String(i).split("."),s=i==Math.abs(i),l=o.length>1,d=l?o[1].toString():"0",c=d;if(i=Math.abs(o[0]),i=isNaN(i)?0:i,a.roundToDecimalPlace>=0&&("2"==(d=(d=parseFloat("1."+d)).toFixed(a.roundToDecimalPlace)).substring(0,1)&&(i=Number(i)+1),d=d.substring(2)),i=String(i),a.groupDigits)for(var u=0;u<Math.floor((i.length-(1+u))/3);u++)i=i.substring(0,i.length-(4*u+3))+a.digitGroupSymbol+i.substring(i.length-(4*u+3));(l&&-1==a.roundToDecimalPlace||a.roundToDecimalPlace>0)&&(i+=a.decimalSymbol+d);var p=(s?a.positiveFormat:a.negativeFormat).replace(/%s/g,a.symbol);p=p.replace(/%n/g,i);var h=e([]);(h=r?e(r):t)[h.is("input, select, textarea")?"val":"html"](p),l&&a.eventOnDecimalsEntered&&c.length>a.roundToDecimalPlace&&h.trigger("decimalsEntered",c),a.colorize&&h.css("color",s?"black":"red")}}))},e.fn.toNumber=function(r){var a=e.extend({name:"toNumber",region:"",global:!0},e.formatCurrency.regions[""]);return(r=jQuery.extend(a,r)).region.length>0&&(r=e.extend(r,t(r.region))),r.regex=i(r),this.each((function(){var t=e(this).is("input, select, textarea")?"val":"html";e(this)[t](e(this)[t]().replace("(","(-").replace(r.regex,""))}))},e.fn.asNumber=function(r){var a=e.extend({name:"asNumber",region:"",parse:!0,parseType:"Float",global:!0},e.formatCurrency.regions[""]);(r=jQuery.extend(a,r)).region.length>0&&(r=e.extend(r,t(r.region))),r.regex=i(r),r.parseType=function(e){switch(e.toLowerCase()){case"int":return"Int";case"float":return"Float";default:throw"invalid parseType"}}(r.parseType);var n=e(this).is("input, select, textarea")?"val":"html",o=e(this)[n]();return o=(o=(o=o||"").replace("(","(-")).replace(r.regex,""),r.parse?(0==o.length&&(o="0"),"."!=r.decimalSymbol&&(o=o.replace(r.decimalSymbol,".")),window["parse"+r.parseType](o)):o}}(jQuery),function(e){var t=(bizagi.util.isEventSupported("paste")?"paste":"input")+".mask";e.widget("ui.mask",{_init:function(){var t=this.options,i=this;e.extend(this,{caret:function(t,r){return e.ui.mask.caret(i.element,t,r)}}),t.mask&&t.mask.length&&(t.placeholder&&t.placeholder.length||(t.placeholder="_"),this._prepareBuffer(),this._bindEvents(),this._checkVal(this.element.val().length&&t.allowPartials))},destroy:function(){this.element.unbind(".mask").removeData("mask")},value:function(){this.element;var t=this,i=e.map(t.buffer,(function(e,i){return t.tests[i]?e:null})).join(""),r=new RegExp("\\"+this.options.placeholder,"gi");return i.replace(r,"")},formatted:function(){var e=new RegExp("\\"+this.options.placeholder,"gi");return this.element.val().replace(e,"")},apply:function(){this.element.trigger("apply.mask")},_setData:function(t,i){e.widget.prototype._setData.apply(this,arguments);var r=this.options;switch(t){case"mask":if(!r.mask||!r.mask.length){this.element.unbind(".mask");break}case"placeholder":r.placeholder&&r.placeholder.length||(r.placeholder="_"),this.element.val(""),this._prepareBuffer(),!this.eventsBound&&this._bindEvents()}},_prepareBuffer:function(){this._escapeMask();var t=this,i=this.element,r=this.options,a=r.mask,n=e.ui.mask.definitions,o=[],s=a.length,l=null;a.length;i.is(":input")||(i.val=i.html),e.each(a.split(""),(function(e,t){"?"==t?(s=e):n[t]?(o.push(new RegExp(n[t])),null==l&&(l=o.length-1)):o.push(null)})),e.extend(this,{buffer:e.map(a.split(""),(function(e,t){if("?"!=e)return n[e]?r.placeholder:e})),tests:o,firstNonMaskPos:l,partialPosition:s}),this.buffer=e.map(this.buffer,(function(e,i){return"\t"==e?t.maskEscaped[i]:e})),this.options.mask=a=this.maskEscaped},_bindEvents:function(){var i=this,r=this.element,a=!1,n=r.val();r.attr("readonly")||(r.bind("focus.mask",(function(){n=r.val();var e=i._checkVal();i._writeBuffer(),setTimeout((function(){e==i.options.mask.length?i.caret(0,e):i.caret(e)}),0)})).bind("blur.mask",(function(){i._checkVal(),r.val()!=n&&r.change()})).bind("apply.mask",(function(){n=r.val();i._checkVal();i._writeBuffer()})).bind("keydown.mask",(function(t){t=t||window.event;var o=i.caret(),s=t.keyCode,l=e.ui.keyCode;return a=s<l.SHIFT||s>l.SHIFT&&s<l.SPACE||s>l.SPACE&&s<41,o.begin-o.end==0||a&&s!=l.BACKSPACE&&s!=l.DELETE||i._clearBuffer(o.begin,o.end),s==l.BACKSPACE||s==l.DELETE?(i._shiftL(o.begin+(s==l.DELETE||s==l.BACKSPACE&&o.begin!=o.end?0:-1),Math.abs(o.begin-o.end)),!1):s==l.ESCAPE?(r.val(n),i.caret(0,i._checkVal()),!1):void 0})).bind("keypress.mask",(function(t){var n=(t=t||window.event).charCode||t.keyCode||t.which,o=e.ui.keyCode,s=i.options.mask.length;if(a)return a=!1,t.keyCode!=o.BACKSPACE&&null;var l=i.caret();if(t.ctrlKey||t.altKey||t.metaKey)return!0;if(n>=o.SPACE&&n<=125||n>186){var d=i._seekNext(l.begin-1);if(d<s){var c=String.fromCharCode(n);if(i.tests[d]&&i.tests[d].test(c)){i._shiftR(d),i.buffer[d]=c,i._writeBuffer();var u=i._seekNext(d);i.caret(u),i.options.completed&&u==s&&i.options.completed.call(r)}}}return!1})).bind(t,(function(){setTimeout((function(){i.caret(i._checkVal(!0))}),0)})),this.eventsBound=!0)},_writeBuffer:function(){return this.element.val(this.buffer.join("")).val()},_clearBuffer:function(e,t){for(var i=this.options.mask.length,r=e;r<t&&r<i;r++)this.tests[r]&&(this.buffer[r]=this.options.placeholder)},_seekNext:function(e){for(var t=this.options.mask.length;++e<=t&&!this.tests[e];);return e},_shiftR:function(e){for(var t=this.options.mask.length,i=e,r=this.options.placeholder;i<t;i++)if(this.tests[i]){var a=this._seekNext(i),n=this.buffer[i];if(this.buffer[i]=r,!(a<t&&this.tests[a].test(n)))break;r=n}},_shiftL:function(e,t){for(;!this.tests[e]&&--e>=0;);for(var i=e,r=this.options.mask.length,a=this.options.placeholder,n=e;n<r&&(n>=0||t>1);n++)if(this.tests[n]){this.buffer[n]=a;var o=this._seekNext(n);if(o<r&&this.tests[n].test(this.buffer[o]))for(this.buffer[e]=this.buffer[o],this.buffer[o]=a,e++;!this.tests[e];)e++}this._writeBuffer(),this.caret(Math.max(this.firstNonMaskPos,i))},_checkVal:function(e){for(var t=this.element,i=t.val(),r=this.options.mask.length,a=-1,n=0,o=0;n<r;n++)if(this.tests[n]){for(this.buffer[n]=this.options.placeholder;o++<i.length;){var s=i.charAt(o-1);if(this.tests[n].test(s)){this.buffer[n]=s,a=n;break}}if(o>i.length)break}else this.buffer[n]==i[o]&&n!=this.partialPosition&&(o++,a=n);return!e&&a+1<this.partialPosition?this.options.allowPartials&&this.value().length?t.is(":input")||this._writeBuffer():(t.val(""),this._clearBuffer(0,r)):(e||a+1>=this.partialPosition)&&(this._writeBuffer(),e||t.val(t.val().substring(0,a+1))),this.partialPosition?n:this.firstNonMaskPos},_escapeMask:function(){for(var e=this.options.mask,t=[],i=[],r=0;r<e.length;r++){var a,n=e[r]||e.charAt(r);"\\"==n&&"\\"!=e[r-1]||("\\"==e[r-1]?(a="\t",i[t.length]=n):a=n,t[t.length]=a)}this.options.mask=t.join("");for(r=0;r<t.length;r++)void 0!==i[r]&&(t[r]=i[r]);this.maskEscaped=t.join("")}}),e.extend(e.ui.mask,{version:"@VERSION",getter:"value formatted",defaults:{mask:"",placeholder:"_",completed:null,allowPartials:!1},definitions:{"#":"[\\d]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},caret:function(e,t,i){var r=e[0];if("number"==typeof t){if(i="number"==typeof i?i:t,r.setSelectionRange)r.focus(),r.setSelectionRange(t,i);else if(r.createTextRange){(a=r.createTextRange()).collapse(!0),a.moveEnd("character",i),a.moveStart("character",t),a.select()}return e}if(r.setSelectionRange)t=r.selectionStart,i=r.selectionEnd;else if(document.selection&&document.selection.createRange){var a;i=(t=0-(a=document.selection.createRange()).duplicate().moveStart("character",-1e5))+a.text.length}return{begin:t,end:i}}})}(jQuery),jQuery.fn.numeric=function(e,t){return e=e||".",t="function"==typeof t?t:function(){},this.keypress((function(t){var i=t.charCode?t.charCode:t.keyCode?t.keyCode:0;if(13==i&&"input"==this.nodeName.toLowerCase())return!0;if(13==i)return!1;var r=!1;if(t.ctrlKey&&97==i||t.ctrlKey&&65==i)return!0;if(t.ctrlKey&&120==i||t.ctrlKey&&88==i)return!0;if(t.ctrlKey&&99==i||t.ctrlKey&&67==i)return!0;if(t.ctrlKey&&122==i||t.ctrlKey&&90==i)return!0;if(t.ctrlKey&&118==i||t.ctrlKey&&86==i||t.shiftKey&&45==i)return!0;if(i<48||i>57){if(45==i&&0==this.value.length)return!0;i==e.charCodeAt(0)&&-1!=this.value.indexOf(e)&&(r=!1),8!=i&&9!=i&&13!=i&&35!=i&&36!=i&&37!=i&&39!=i&&46!=i?r=!1:void 0!==t.charCode&&(t.keyCode==t.which&&0!=t.which?r=!0:0!=t.keyCode&&0==t.charCode&&0==t.which&&(r=!0)),i==e.charCodeAt(0)&&-1==this.value.indexOf(e)&&(r=!0)}else r=!0;return r})).blur((function(){var i=jQuery(this).val();""!=i&&(new RegExp("^\\d+$|\\d*"+e+"\\d+").exec(i)||t.apply(this))})),this},jQuery.fn.numericSN=function(e,t){e=e||".",t=t||"e";return callback="function"==typeof callback?callback:function(){},this.keypress((function(i){var r=i.charCode?i.charCode:i.keyCode?i.keyCode:0;if(13==r&&"input"==this.nodeName.toLowerCase())return!0;if(13==r)return!1;var a=!1;return!!(i.ctrlKey&&97==r||i.ctrlKey&&65==r)||(!!(i.ctrlKey&&120==r||i.ctrlKey&&88==r)||(!!(i.ctrlKey&&99==r||i.ctrlKey&&67==r)||(!!(i.ctrlKey&&122==r||i.ctrlKey&&90==r)||(!!(i.ctrlKey&&118==r||i.ctrlKey&&86==r||i.shiftKey&&45==r)||(r<48||r>57?(r==e.charCodeAt(0)&&-1!=this.value.indexOf(e)&&(a=!1),r==t.charCodeAt(0)&&-1!=this.value.indexOf(t)&&(a=!1),8!=r&&9!=r&&13!=r&&35!=r&&36!=r&&37!=r&&39!=r?a=!1:void 0!==i.charCode&&(i.keyCode==i.which&&0!=i.which?a=!0:0!=i.keyCode&&0==i.charCode&&0==i.which&&(a=!0)),r==t.charCodeAt(0)&&-1==this.value.indexOf(t)&&(a=!0),r==e.charCodeAt(0)&&-1==this.value.indexOf(e)&&(a=!0),r!="-".charCodeAt(0)&&r!="+".charCodeAt(0)||(a=!0)):a=!0,a)))))})).blur((function(){var t=jQuery(this).val();""!=t&&(new RegExp("^\\d+$|\\d*"+e+"\\d+").exec(t)||callback.apply(this))})),this},function(e){e.widget("ui.slideContent",{options:{container:"<div/>",content:"",buttons:[],zIndex:1,autoOpen:!0,cssWrapContainer:"slide-container",cssButtonsContainer:"ui-slide-button-container"},_create:function(){this._layout=e("<div class='"+this.options.cssWrapContainer+"'></div>").append(this.element),this.element.addClass("slide-container-applied"),this.options.buttons.length>=1&&this._layout.append(this._createButtons()),this._layout.hide()},_init:function(){return this.options.autoOpen&&(this._isOpen=!1,this.open()),this},_createButtons:function(){var t=e("<div class="+this.options.cssButtonsContainer+"></div>");return e.each(this.options.buttons,(function(i,r){e("<input type='button' value='"+r.text+"' >").click(r.click).appendTo(t)})),this.buttonContainer=t,t},destroy:function(){e.Widget.prototype.destroy.apply(this),this.element.removeClass("slide-container-applied")},setContent:function(e){this.options.content=e},open:function(){this._isOpen||(this.parentCurrentScroll=this.options.container.parent().scrollTop(),this.options.container.hide(),this.options.container.after(this._layout),this.element.parents(".slide-container-applied").length>0&&e(this.element.parents(".slide-container-applied")[0]).slideContent("hideButtons"),this._layout.show(),this._isOpen=!0,this._trigger("open"))},isOpen:function(){return this._isOpen},close:function(){!1!==this._trigger("beforeclose")&&(this.isOpen()&&(this.options.container.show(),this.options.container.parent().scrollTop(this.parentCurrentScroll),this.element.parents(".slide-container-applied").length>0&&e(this.element.parents(".slide-container-applied")[0]).slideContent("showButtons"),this._layout.hide(),this._isOpen=!1),this._trigger("close"))},showButtons:function(){this.buttonContainer.show()},hideButtons:function(){this.buttonContainer.hide()}})}(jQuery),function(e){function t(t,i){function f(t){l=e("li.dw-v",t).eq(0).index(),d=e("li.dw-v",t).eq(-1).index(),s=k.height,c=D}function b(){D.temp=N&&null!==D.val&&D.val!=t.val()||null===D.values?k.parseValue(t.val()?t.val():"",D):D.values.slice(0),D.setValue(!0)}function C(t,i,r,a,n){k.validate.call(I,S,r),e(".dww ul",S).each((function(a){var o=e(this),s=(o=(l=e('li[data-val="'+D.temp[a]+'"]',o)).index(),l),l=o;if(!s.hasClass("dw-v")){for(var d=s,c=0,u=0;d.prev().length&&!d.hasClass("dw-v");)d=d.prev(),c++;for(;s.next().length&&!s.hasClass("dw-v");)s=s.next(),u++;u<c&&u&&1==!n||!c||!d.hasClass("dw-v")||1==n?l+=u:(s=d,l-=c),D.temp[a]=s.data("val")}o==l&&a!=r&&void 0!==r||D.scroll(e(this),l,a==r?t:0,i,a)})),D.change(a)}function z(){var t,i,r=0,a=0,n=e(window).width(),o=e(window).height(),s=e(window).scrollTop(),l=e(".dwo",S),d=e(".dw",S);e(".dwc",S).each((function(){t=e(this).outerWidth(!0),r+=t,a=t>a?t:a})),t=r>n?a:r,d.width(t),t=d.outerWidth(),i=d.outerHeight(),d.css({left:(n-t)/2,top:s+(o-i)/2}),l.height(0).height(function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}())}function E(e){var t=+e.data("pos")+1;n(e,t>d?l:t,1)}function A(e){var t=+e.data("pos")-1;n(e,t<l?d:t,2)}var F,P,S,D=this,I=t,k=(t=e(I),e.extend({},w)),O={},M={},N=t.is("input"),$=!1;D.enable=function(){k.disabled=!1,N&&t.prop("disabled",!1)},D.disable=function(){k.disabled=!0,N&&t.prop("disabled",!0)},D.scroll=function(e,t,i,r,a){var n=(P-t)*k.height;if(e.attr("style",(i?_+"-transition:all "+i.toFixed(1)+"s ease-out;":"")+(x?_+"-transform:translate3d(0,"+n+"px,0);":"top:"+n+"px;")),i){var o=0;clearInterval(O[a]),O[a]=setInterval((function(){o+=.1,e.data("pos",Math.round((t-r)*Math.sin(o/i*(Math.PI/2))+r)),o>=i&&(clearInterval(O[a]),e.data("pos",t))}),100),clearTimeout(M[a]),M[a]=setTimeout((function(){"mixed"==k.mode&&!e.hasClass("dwa")&&e.closest(".dwwl").find(".dwwb").fadeIn("fast")}),1e3*i)}else e.data("pos",t)},D.setValue=function(e,i,r){var a=k.formatResult(D.temp);D.val=a,D.values=D.temp.slice(0),$&&e&&C(r),i&&N&&t.val(a).trigger("change")},D.validate=function(e,t,i,r){C(e,t,i,!0,r)},D.change=function(t){var i=k.formatResult(D.temp);"inline"==k.display?D.setValue(!1,t):e(".dwv",S).html(function(e){var t=k.headerText;return t?"function"==typeof t?t.call(I,e):t.replace(/{value}/i,e):""}(i)),t&&k.onChange.call(I,i,D)},D.hide=function(){if(!1===k.onClose.call(I,D.val,D))return!1;e(".dwtd").prop("disabled",!1).removeClass("dwtd"),t.blur(),S&&S.remove(),$=!1,e(window).unbind(".dw")},D.show=function(){if(k.disabled||$)return!1;var i=k.height,a=k.rows*i;b();for(var s='<div class="'+k.theme+'">'+("inline"==k.display?'<div class="dw dwbg dwi"><div class="dwwr">':'<div class="dwo"></div><div class="dw dwbg"><div class="dwwr">'+(k.headerText?'<div class="dwv"></div>':"")),l=0;l<k.wheels.length;l++){var d;s=s+'<div class="dwc'+("scroller"!=k.mode?" dwpm":" dwsc")+(k.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>';for(d in k.wheels[l]){var c;s=s+'<td><div class="dwwl dwrc">'+("scroller"!=k.mode?'<div class="dwwb dwwbp" style="height:'+i+"px;line-height:"+i+'px;"><span>+</span></div><div class="dwwb dwwbm" style="height:'+i+"px;line-height:"+i+'px;"><span>&ndash;</span></div>':"")+'<div class="dwl">'+d+'</div><div class="dww dwrc" style="height:'+a+"px;min-width:"+k.width+'px;"><ul>';for(c in k.wheels[l][d])s+='<li class="dw-v" data-val="'+c+'" style="height:'+i+"px;line-height:"+i+'px;">'+k.wheels[l][d][c]+"</li>";s+='</ul><div class="dwwo"></div></div><div class="dwwol"></div></div></td>'}s+="</tr></table></div></div>"}s+=("inline"!=k.display?'<div class="dwbc"><span class="dwbw dwb-s"><a href="#" class="dwb">'+k.setText+'</a></span><span class="dwbw dwb-c"><a href="#" class="dwb">'+k.cancelText+"</a></span></div>":'<div class="dwcc"></div>')+"</div></div></div>",S=e(s),C(),"inline"!=k.display?S.appendTo("body"):t.is("div")?t.html(S):S.insertAfter(t),$=!0,F.init(S,D),"inline"!=k.display&&(e(".dwb-s a",S).click((function(){return D.setValue(!1,!0),D.hide(),k.onSelect.call(I,D.val,D),!1})),e(".dwb-c a",S).click((function(){return D.hide(),k.onCancel.call(I,D.val,D),!1})),e("input,select").each((function(){e(this).prop("disabled")||e(this).addClass("dwtd")})),e("input,select").prop("disabled",!0),z(),e(window).bind("resize.dw",z)),S.delegate(".dwwl","DOMMouseScroll mousewheel",(function(t){if(!k.readonly){t.preventDefault();t=(t=t.originalEvent).wheelDelta?t.wheelDelta/120:t.detail?-t.detail/3:0;var i=e("ul",this),r=+i.data("pos");r=Math.round(r-t);f(i),n(i,r,t<0?1:2)}})).delegate(".dwb, .dwwb",T,(function(){e(this).addClass("dwb-a")})).delegate(".dwwb",T,(function(t){if(!k.readonly){t.preventDefault(),t.stopPropagation();var i=e(this).closest(".dwwl").find("ul");func=e(this).hasClass("dwwbp")?E:A,f(i),clearInterval(o),o=setInterval((function(){func(i)}),k.delay),func(i)}})).delegate(".dwwl",T,(function(t){v||"clickpick"==k.mode||k.readonly||(t.preventDefault(),v=!0,y=e("ul",this).addClass("dwa"),"mixed"==k.mode&&e(".dwwb",this).fadeOut("fast"),g=+y.data("pos"),f(y),u=r(t),h=new Date,p=u,D.scroll(y,g))})),k.onShow.call(I,S,D)},D.init=function(i){F=e.extend({defaults:{},init:m},e.scroller.themes[i.theme?i.theme:k.theme]),e.extend(k,F.defaults,i),D.settings=k,P=Math.floor(k.rows/2);var r=e.scroller.presets[k.preset];t.unbind(".dw"),r&&(r=r.call(I,D),e.extend(k,r,i),e.extend(R,r.methods)),void 0!==t.data("dwro")&&(I.readOnly=a(t.data("dwro"))),$&&D.hide(),"inline"==k.display?D.show():(b(),N&&k.showOnFocus&&(t.data("dwro",I.readOnly),I.readOnly=!0,t.bind("focus.dw",D.show)))},D.values=null,D.val=null,D.temp=null,D.init(i)}function i(e){for(var t in e)if(void 0!==C[e[t]])return!0;return!1}function r(e){return z?e.originalEvent?e.originalEvent.changedTouches[0].pageY:e.changedTouches[0].pageY:e.pageY}function a(e){return!0===e||"true"==e}function n(t,i,r,a,n){var o=t.closest(".dwwr").find("ul").index(t);i=(i=i>d?d:i)<l?l:i,t=e("li",t).eq(i);c.temp[o]=t.data("val"),c.validate(a?i==n?.1:Math.abs(.1*(i-n)):0,n,o,r)}var o,s,l,d,c,u,p,h,g,f={},m=function(){},b=(new Date).getTime(),v=!1,y=null,C=document.createElement(C).style,x=i(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"])&&"webkitPerspective"in document.documentElement.style,_=function(){var e,t=["Webkit","Moz","O","ms"];for(e in t)if(i([t[e]+"Transform"]))return"-"+t[e].toLowerCase();return""}(),z="ontouchstart"in window,T=z?"touchstart":"mousedown",E=z?"touchend":"mouseup",w={width:70,height:40,rows:3,delay:300,disabled:!1,readonly:!1,showOnFocus:!0,showLabel:!0,wheels:[],theme:"",headerText:"{value}",display:"modal",mode:"scroller",preset:"",setText:"Set",cancelText:"Cancel",onShow:m,onClose:m,onSelect:m,onCancel:m,onChange:m,formatResult:function(e){for(var t="",i=0;i<e.length;i++)t+=(0<i?" ":"")+e[i];return t},parseValue:function(e,t){for(var i=t.settings.wheels,r=(e=e.split(" "),[]),a=0,n=0;n<i.length;n++)for(var o in i[n]){if(void 0!==i[n][o][e[a]])r.push(e[a]);else for(var s in i[n][o]){r.push(s);break}a++}return r},validate:m},R={init:function(e){return void 0===e&&(e={}),this.each((function(){this.id||(b+=1,this.id="scoller"+b),f[this.id]=new t(this,e)}))},enable:function(){return this.each((function(){var e=f[this.id];e&&e.enable()}))},disable:function(){return this.each((function(){var e=f[this.id];e&&e.disable()}))},isDisabled:function(){var e=f[this[0].id];if(e)return e.settings.disabled},option:function(e,t){return this.each((function(){var i=f[this.id];if(i){var r={};"object"===_typeof(e)?r=e:r[e]=t,i.init(r)}}))},setValue:function(e,t,i){return this.each((function(){var r=f[this.id];r&&(r.temp=e,r.setValue(!0,t,i))}))},getInst:function(){return f[this[0].id]},getValue:function(){var e=f[this[0].id];if(e)return e.values},show:function(){var e=f[this[0].id];if(e)return e.show()},hide:function(){return this.each((function(){var e=f[this.id];e&&e.hide()}))},destroy:function(){return this.each((function(){var t=f[this.id];t&&(t.hide(),e(this).unbind(".dw"),delete f[this.id],e(this).is("input")&&(this.readOnly=a(e(this).data("dwro"))))}))}};e(document).bind(z?"touchmove":"mousemove",(function(e){v&&(e.preventDefault(),p=r(e),e=(e=(e=g+(u-p)/s)>d+1?d+1:e)<l-1?l-1:e,c.scroll(y,e))})),e(document).bind(E,(function(t){if(v){t.preventDefault(),y.removeClass("dwa");var i=new Date-h;t=(t=(t=g+(u-p)/s)>d+1?d+1:t)<l-1?l-1:t;300>i?(i=(i=(p-u)/i)*i/.0012,0>p-u&&(i=-i)):i=p-u,n(y,Math.round(g-i/s),0,!0,Math.round(t)),v=!1,y=null}clearInterval(o),e(".dwb-a").removeClass("dwb-a")})),e.fn.scroller=function(t){return R[t]?R[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==_typeof(t)&&t?void e.error("Unknown method"):R.init.apply(this,arguments)},e.scroller={setDefaults:function(t){e.extend(w,t)},presets:{},themes:{}}}(jQuery),function(e){var t={dateFormat:"mm/dd/yy",dateOrder:"mmddy",timeWheels:"hhiiA",timeFormat:"hh:ii A",startYear:(i=new Date).getFullYear()-100,endYear:i.getFullYear()+1,monthNames:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),monthNamesShort:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),dayNames:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),dayNamesShort:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",stepHour:1,stepMinute:1,stepSecond:1,separator:" "},i=function(i){function r(e,t,i){return void 0!==p[t]?+e[p[t]]:void 0!==i?i:x[h[t]]?x[h[t]]():h[t](x)}function a(e,t){return Math.floor(e/t)*t}function n(e){var t=r(e,"h",0);return new Date(r(e,"y"),r(e,"m"),r(e,"d"),r(e,"ap")?t+12:t,r(e,"i",0),r(e,"s",0))}var o;if((l=e(this)).is("input")){switch(l.attr("type")){case"date":o="yy-mm-dd";break;case"datetime":o="yy-mm-ddTHH:ii:ssZ";break;case"datetime-local":o="yy-mm-ddTHH:ii:ss";break;case"month":o="yy-mm",t.dateOrder="mmyy";break;case"time":o="HH:ii:ss"}var s=l.attr("min"),l=l.attr("max");s&&(t.minDate=e.scroller.parseDate(o,s)),l&&(t.maxDate=e.scroller.parseDate(o,l))}var d=e.extend({},t,i.settings),c=0,u=(s=[],[]),p={},h={y:"getFullYear",m:"getMonth",d:"getDate",h:function(e){return e=e.getHours(),a(e=y&&12<=e?e-12:e,_)},i:function(e){return a(e.getMinutes(),z)},s:function(e){return a(e.getSeconds(),T)},ap:function(e){return v&&11<e.getHours()?1:0}},g=d.preset,f=d.dateOrder,m=d.timeWheels,b=f.match(/D/),v=m.match(/a/i),y=m.match(/h/),C="datetime"==g?d.dateFormat+d.separator+d.timeFormat:"time"==g?d.timeFormat:d.dateFormat,x=new Date,_=d.stepHour,z=d.stepMinute,T=d.stepSecond,E=d.minDate,w=d.maxDate;if(o=o||C,g.match(/date/i)){e.each(["y","m","d"],(function(e,t){-1<(e=f.search(RegExp(t,"i")))&&u.push({o:e,v:t})})),u.sort((function(e,t){return e.o>t.o?1:-1})),e.each(u,(function(e,t){p[t.v]=e}));l={};for(var R=0;3>R;R++)if(R==p.y){c++,l[d.yearText]={};for(var A=E?E.getFullYear():d.startYear,F=w?w.getFullYear():d.endYear;A<=F;A++)l[d.yearText][A]=f.match(/yy/i)?A:(A+"").substr(2,2)}else if(R==p.m)for(c++,l[d.monthText]={},A=0;12>A;A++)l[d.monthText][A]=f.match(/MM/)?d.monthNames[A]:f.match(/M/)?d.monthNamesShort[A]:f.match(/mm/)&&9>A?"0"+(A+1):A+1;else if(R==p.d)for(c++,l[d.dayText]={},A=1;32>A;A++)l[d.dayText][A]=f.match(/dd/i)&&10>A?"0"+A:A;s.push(l)}if(g.match(/time/i)){if(l={},m.match(/h/i))for(p.h=c++,l[d.hourText]={},A=0;A<(y?12:24);A+=_)l[d.hourText][A]=y&&0==A?12:m.match(/hh/i)&&10>A?"0"+A:A;if(m.match(/i/))for(p.i=c++,l[d.minuteText]={},A=0;60>A;A+=z)l[d.minuteText][A]=m.match(/ii/)&&10>A?"0"+A:A;if(m.match(/s/))for(p.s=c++,l[d.secText]={},A=0;60>A;A+=T)l[d.secText][A]=m.match(/ss/)&&10>A?"0"+A:A;v&&(p.ap=c++,c=m.match(/A/),l[d.ampmText]={0:c?"AM":"am",1:c?"PM":"pm"}),s.push(l)}return{wheels:s,headerText:function(){return e.scroller.formatDate(C,n(i.temp),d)},formatResult:function(t){return e.scroller.formatDate(o,n(t),d)},parseValue:function(t){var i=new Date,r=[];try{i=e.scroller.parseDate(o,t,d)}catch(e){}for(var a in p)r[p[a]]=i[h[a]]?i[h[a]]():h[a](i);return r},validate:function(t,n){var o=i.temp,s={m:0,d:1,h:0,i:0,s:0,ap:0},l={m:11,d:31,h:a(y?11:23,_),i:a(59,z),s:a(59,T),ap:1},c=!0,u=!0;e.each(E||w?"y,m,d,ap,h,i,s".split(","):n==p.y||n==p.m||void 0===n?["d"]:[],(function(i,a){if(void 0!==p[a]){var n,g,m=s[a],v=l[a],y=31,C=r(o,a),x=e("ul",t).eq(p[a]);if("d"==a&&(n=r(o,"y"),g=r(o,"m"),v=y=32-new Date(n,g,32).getDate(),b&&e("li",x).each((function(){var t=e(this),i=t.data("val"),r=new Date(n,g,i).getDay();t.html(f.replace(/[my]/gi,"").replace(/dd/,10>i?"0"+i:i).replace(/d/,i).replace(/DD/,d.dayNames[r]).replace(/D/,d.dayNamesShort[r]))}))),c&&E&&(m=E[h[a]]?E[h[a]]():h[a](E)),u&&w&&(v=w[h[a]]?w[h[a]]():h[a](w)),"y"!=a){var _=e('li[data-val="'+m+'"]',x).index(),z=e('li[data-val="'+v+'"]',x).index();e("li",x).removeClass("dw-v").slice(_,z+1).addClass("dw-v"),"d"==a&&e("li",x).removeClass("dw-h").slice(y).addClass("dw-h"),C<m&&(C=m),C>v&&(C=v)}if(c&&(c=C==m),u&&(u=C==v),d.invalid&&"d"==a){var T=[];if(d.invalid.dates&&e.each(d.invalid.dates,(function(e,t){t.getFullYear()==n&&t.getMonth()==g&&T.push(t.getDate()-1)})),d.invalid.daysOfWeek){var R=new Date(n,g,1).getDay();e.each(d.invalid.daysOfWeek,(function(e,t){for(var i=t-R;i<y;i+=7)i>=0&&T.push(i)}))}d.invalid.daysOfMonth&&e.each(d.invalid.daysOfMonth,(function(e,t){(t=(t+"").split("/"))[1]?t[0]-1==g&&T.push(t[1]-1):T.push(t[0]-1)})),e.each(T,(function(t,i){e("li",x).eq(i).removeClass("dw-v")}))}}}))},methods:{getDate:function(t){var i=e(this).scroller("getInst");if(i)return n(t?i.temp:i.values)},setDate:function(t,i,r){return null==i&&(i=!1),this.each((function(){var a=e(this).scroller("getInst");if(a){for(var n in p)a.temp[p[n]]=t[h[n]]?t[h[n]]():h[n](t);a.setValue(!0,i,r)}}))}}}};e.scroller.presets.date=i,e.scroller.presets.datetime=i,e.scroller.presets.time=i,e.scroller.formatDate=function(i,r,a){if(!r)return null;a=e.extend({},t,a);for(var n=function(e){for(var t=0;c+1<i.length&&i.charAt(c+1)==e;)t++,c++;return t},o=function(e,t,i){if(t=""+t,n(e))for(;t.length<i;)t="0"+t;return t},s=function(e,t,i,r){return n(e)?r[t]:i[t]},l="",d=!1,c=0;c<i.length;c++)if(d)"'"!=i.charAt(c)||n("'")?l+=i.charAt(c):d=!1;else switch(i.charAt(c)){case"d":l+=o("d",r.getDate(),2);break;case"D":l+=s("D",r.getDay(),a.dayNamesShort,a.dayNames);break;case"o":l+=o("o",(r.getTime()-new Date(r.getFullYear(),0,0).getTime())/864e5,3);break;case"m":l+=o("m",r.getMonth()+1,2);break;case"M":l+=s("M",r.getMonth(),a.monthNamesShort,a.monthNames);break;case"y":l+=n("y")?r.getFullYear():(10>r.getYear()%100?"0":"")+r.getYear()%100;break;case"h":var u=r.getHours();l=l+o("h",12<u?u-12:0==u?12:u,2);break;case"H":l+=o("H",r.getHours(),2);break;case"i":l+=o("i",r.getMinutes(),2);break;case"s":l+=o("s",r.getSeconds(),2);break;case"a":l+=11<r.getHours()?"pm":"am";break;case"A":l+=11<r.getHours()?"PM":"AM";break;case"'":n("'")?l+="'":d=!0;break;default:l+=i.charAt(c)}return l},e.scroller.parseDate=function(i,r,a){var n=new Date;if(!i||!r)return n;r="object"==_typeof(r)?r.toString():r+"";for(var o=e.extend({},t,a),s=(a=n.getFullYear(),n.getMonth()+1),l=n.getDate(),d=-1,c=n.getHours(),u=(n=n.getMinutes(),0),p=-1,h=!1,g=function(e){return(e=v+1<i.length&&i.charAt(v+1)==e)&&v++,e},f=function(e){return g(e),(e=r.substr(b).match(RegExp("^\\d{1,"+("@"==e?14:"!"==e?20:"y"==e?4:"o"==e?3:2)+"}")))?(b+=e[0].length,parseInt(e[0],10)):0},m=function(e,t,i){for(e=g(e)?i:t,t=0;t<e.length;t++)if(r.substr(b,e[t].length).toLowerCase()==e[t].toLowerCase())return b+=e[t].length,t+1;return 0},b=0,v=0;v<i.length;v++)if(h)"'"!=i.charAt(v)||g("'")?b++:h=!1;else switch(i.charAt(v)){case"d":l=f("d");break;case"D":m("D",o.dayNamesShort,o.dayNames);break;case"o":d=f("o");break;case"m":s=f("m");break;case"M":s=m("M",o.monthNamesShort,o.monthNames);break;case"y":a=f("y");break;case"H":c=f("H");break;case"h":c=f("h");break;case"i":n=f("i");break;case"s":u=f("s");break;case"a":p=m("a",["am","pm"],["am","pm"])-1;break;case"A":p=m("A",["am","pm"],["am","pm"])-1;break;case"'":g("'")?b++:h=!0;break;default:b++}if(100>a&&(a+=(new Date).getFullYear()-(new Date).getFullYear()%100+(a<=o.shortYearCutoff?0:-100)),-1<d)for(s=1,l=d;;){if(l<=(o=32-new Date(a,s-1,32).getDate()))break;s++,l-=o}if((c=new Date(a,s-1,l,-1==p?c:p&&12>c?c+12:p||12!=c?c:0,n,u)).getFullYear()!=a||c.getMonth()+1!=s||c.getDate()!=l)throw"Invalid date";return c}}(jQuery),function(e){var t={inputClass:""};e.scroller.presets.select=function(i){var r=e.extend({},t,i.settings),a=e(this),n=this.id+"_dummy";e('label[for="'+this.id+'"]').attr("for",n);var o=(o=e('label[for="'+n+'"]')).length?o.text():a.attr("name"),s=[],l=[{}];l[0][o]={};var d=l[0][o];e("option",a).each((function(){var t=e(this).attr("value");d[t]=e(this).text(),e(this).prop("disabled")&&s.push(t)})),e("#"+n).remove();var c=e('<input type="text" id="'+n+'" value="'+d[a.val()]+'" class="'+r.inputClass+'" readonly />').insertBefore(a);return r.showOnFocus&&c.focus((function(){i.show()})),a.hide().closest(".ui-field-contain").trigger("create"),{width:200,wheels:l,headerText:!1,formatResult:function(e){return d[e[0]]},parseValue:function(){return[a.val()]},validate:function(t){e.each(s,(function(i,r){e('li[data-val="'+r+'"]',t).removeClass("dw-v")}))},onSelect:function(e,t){c.val(e),a.val(t.values[0]).trigger("change")},onChange:function(e,t){"inline"==r.display&&(c.val(e),a.val(t.temp[0]).trigger("change"))},onClose:function(){c.blur()}}}}(jQuery),jQuery.scroller.themes.android={defaults:{dateOrder:"Mddyy",mode:"clickpick",height:50}},function(e){var t={defaults:{dateOrder:"Mddyy",mode:"mixed",rows:5,width:70,showLabel:!1}};e.scroller.themes["android-ics"]=t,e.scroller.themes["android-ics light"]=t}(jQuery),jQuery.scroller.themes.ios={defaults:{dateOrder:"MMdyy",rows:5,height:30,width:55,headerText:!1,showLabel:!1}},function(e){e.scroller.themes.jqm={defaults:{jqmBody:"c",jqmHeader:"b",jqmWheel:"d",jqmClickPick:"c",jqmSet:"b",jqmCancel:"c"},init:function(t,i){var r=i.settings;e(".dw",t).removeClass("dwbg").addClass("ui-overlay-shadow ui-corner-all ui-body-a"),e(".dwb-s a",t).attr("data-role","button").attr("data-theme",r.jqmSet),e(".dwb-c a",t).attr("data-role","button").attr("data-theme",r.jqmCancel),e(".dwwb",t).attr("data-role","button").attr("data-theme",r.jqmClickPick),e(".dwv",t).addClass("ui-header ui-bar-"+r.jqmHeader),e(".dwwr",t).addClass("ui-body-"+r.jqmBody),e(".dwpm .dww",t).addClass("ui-body-"+r.jqmWheel),"inline"!=r.display&&e(".dw",t).addClass("pop in"),t.trigger("create"),e(".dwo",t).click((function(){i.hide()}))}}}(jQuery),function(e){e.fn.bztabs=function(t){var i=e(this);(t=t||{}).activeTab=t.activeTab||0,t.tabNumber=t.tabNumber||1;var r=t.activate&&"function"==typeof t.activate?t.activate:function(){},a=(t.beforeActivate&&"function"==typeof t.beforeActivate&&t.beforeActivate,i.find(">div.bz-bizagi-container-tap-popup").hide()),n=a.children().length,o=e("<div class='bz-header_select'></div>"),s=t.tabNumber>n?n:t.tabNumber,l=Math.floor(100/Number(s));a.children().each((function(e,t){o.append("<div class='bz-wp-tabs-ui bz-wp-tabs-item' data-index='"+e+"' data-reference-tab='"+t.getAttribute("data-reference-tab")+"'><span>"+t.textContent+"</span></div>")})),o.find("> .bz-wp-tabs-ui").css("width",l+"%"),o.append("<div class='bz-wp-tabs-arrow-container'><div class='bz-cm-icon bz-mo-icon bz-plus'></div></div>"),i.prepend(o);var d=i.find("> .bz-bizagi-container-tap-popup > .bz-container-items-tabs").eq(t.activeTab);e(e(d).data("reference-tab"),i).addClass("childrenActive"),d.addClass("tabSelected");var c=e(".bz-wp-tabs-ui:nth-child("+(t.activeTab+1)+")",o).addClass("tabSelected"),u=l+(100-l*s);function p(){t.tabNumber<n?(e(".bz-wp-tabs-arrow-container",i).first().addClass("show-pluss"),o.addClass("show-pluss"),c.trigger("click",{origin:"popUp"})):(e(".bz-wp-tabs-arrow-container",i).removeClass("show-pluss"),o.removeClass("show-pluss"),o.find("> .bz-wp-tabs-ui:last").addClass("bz-wp-no-border"))}function h(t,n){if((n=n||{}).origin=n.origin||"header",t.stopPropagation(),t.preventDefault(),!e(this).hasClass("tabSelected")||"popUp"===n.origin){var s=t.currentTarget.getAttribute("data-reference-tab"),d=e(s,i);c=e(t.currentTarget),i.find(">div.childrenActive").removeClass("childrenActive"),d.addClass("childrenActive"),o.find(">div.tabSelected").removeClass("tabSelected").css("width",l+"%"),"block"===a.css("display")&&a.toggle(),n.origin&&"popUp"===n.origin&&(c=e("[data-reference-tab='"+s+"']",o),function(e){var t=o.find(".bz-wp-tabs-ui"),i=!0;t.each((function(t,r){e!==r.getAttribute("data-reference-tab")&&i?(o.remove("[data-reference-tab='"+e+"']"),o.append(r)):i=!1}))}(s)),c.addClass("tabSelected").css("width",u+"%"),r(t,n)}}c.css("width",u+"%"),void 0!==t.domIncluded?e.when(t.domIncluded).done((function(){p()})):p(),i.find(".bz-wp-tabs-arrow-container").first().bind("click",(function(t){var i=o.innerWidth()-29,r=0;e(".bz-container-items-tabs",a).removeClass("show"),o.find(".bz-wp-tabs-ui").each((function(t,n){(r+=e(":first-child",n).outerWidth())>i&&a.children().each((function(t,i){if(i.textContent===n.textContent)return e(i).addClass("show"),e(".cell.bz-container-items-tabs").css("border-bottom",""),void e(".cell.bz-container-items-tabs.show").last().css("border-bottom","none")}))})),t.stopPropagation(),t.preventDefault(),a.toggle()})),e(">div.cell",a).bind("click",(function(e){h(e,{origin:"popUp"})})),e(".bz-wp-tabs-ui",o).bind("click",h),o.bind("resizeHeader",(function(){p()}))}}(jQuery),bizagi.render=void 0!==bizagi.render?bizagi.render:{},bizagi.render.services=void 0!==bizagi.render.services?bizagi.render.services:{},bizagi.render.services.endPoints=[],bizagi.render.services.getEndPoints=function(e){var t="Rest/Handlers/Render";return"workflow"==e.context?{"form-get-data":e.proxyPrefix+t,"form-submit-data":e.proxyPrefix+t,"form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload","render-property-refresh":e.proxyPrefix+t,"render-multiaction":e.proxyPrefix+"Rest/Handlers/MultiAction","render-upload-cancel-image":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload","render-upload-delete-url":e.proxyPrefix+t,"render-ecm-upload-url":e.proxyPrefix+"Rest/Handlers/Metadata","render-multiaction-metadata":e.proxyPrefix+"Rest/Handlers/MetadataMultiAction","render-grid-edit-url":e.proxyPrefix+t,"render-grid-save-url":e.proxyPrefix+t,"render-grid-add-url":e.proxyPrefix+t,"render-grid-rollback-url":e.proxyPrefix+t,"render-grid-commit-url":e.proxyPrefix+t,"render-grid-checkpoint-url":e.proxyPrefix+t,"render-save-entity":e.proxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":e.proxyPrefix+"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter","render-letter-save-url":e.proxyPrefix+t,"render-letter-content-icons":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.proxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.proxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.proxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}","render-entity-layout-upload-files":e.proxyPrefix+"Api/Entities/{entity}/Files/{surrogateKey}/Array?xpath={xpath}","render-query-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsersForQueryFormsById/{queryFormId}/","case-handler-getCaseSummary":e.proxyPrefix+"Rest/Cases/{idCase}/SummaryGuid","case-handler-getCaseSummaryByGuid":e.proxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/AssigneesGuid","case-handler-getWorkItems":e.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid","admin-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsers","admin-getUsersList-FromPreferences":e.proxyPrefix+"Rest/Users/SearchUsersFromPreferences","admin-getUsersList-ForStakeholders":e.proxyPrefix+"Rest/Users/SearchUsersForStakeholders","admin-getUsersList-ForXpathIdBossUser":e.proxyPrefix+"Rest/Users/SearchUsersForBosses","admin-getUsersList-ForXpathIdDelegate":e.proxyPrefix+"Rest/Users/SearchUsersForDelegates","admin-getUsersForAssignation":e.proxyPrefix+"Rest/Users/UsersForAssignation","admin-users-config":e.proxyPrefix+"Api/Authentication/BizagiConfig","admin-usersform":e.proxyPrefix+"Rest/Handlers/Render","admin-GenerateDataToSendByEmail":e.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendUserEmail":e.proxyPrefix+"Rest/Users/SendUserEmail"}:"sharepoint"==e.context||"portal"==e.context?(void 0===e.sharepointProxyPrefix&&alert("sharepointProxyPrefix param is requiered to build endpoints when context is 'sharepoint'"),{"form-get-data":e.sharepointProxyPrefix+t,"form-submit-data":e.sharepointProxyPrefix+t,"form-submit-data-upload":e.sharepointProxyPrefix+"Rest/Handlers/Render/Upload","render-property-refresh":e.sharepointProxyPrefix+t,"render-multiaction":e.sharepointProxyPrefix+"Rest/Handlers/MultiAction","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.sharepointProxyPrefix+"Rest/Handlers/RenderFile","render-upload-add-url":e.sharepointProxyPrefix+"Rest/Handlers/Render/Upload","render-upload-delete-url":e.sharepointProxyPrefix+t,"render-ecm-upload-url":e.sharepointProxyPrefix+"Rest/Handlers/Metadata","render-grid-edit-url":e.sharepointProxyPrefix+t,"render-grid-save-url":e.sharepointProxyPrefix+t,"render-grid-add-url":e.sharepointProxyPrefix+t,"render-grid-rollback-url":e.sharepointProxyPrefix+t,"render-grid-commit-url":e.sharepointProxyPrefix+t,"render-grid-checkpoint-url":e.sharepointProxyPrefix+t,"render-save-entity":e.sharepointProxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":"jquery/css/bizagi/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.sharepointProxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.sharepointProxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.sharepointProxyPrefix+"Rest/Handlers/Letter","render-letter-content-url":e.sharepointProxyPrefix+"Rest/Handlers/Letter","render-letter-save-url":e.sharepointProxyPrefix+t,"render-letter-content-icons":"jquery/css/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.sharepointProxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.sharepointProxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.sharepointProxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}","case-handler-getCaseSummary":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-getCaseSummaryByGuid":e.sharepointProxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getWorkItems":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid"}):"entitymanagement"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=entity","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=entity","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile?h_contexttype=entity","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=entity","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=entity","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=entity","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=entity","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=entity","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:"search"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=metadata","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=metadata","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile?h_contexttype=metadata","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=metadata","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=metadata","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=metadata","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=metadata","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:{}},$.Class.extend("bizagi.render.services.context",{},{init:function(e){this.context=e.context,this.endPoints=bizagi.render.services.getEndPoints(e),this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix},getUrl:function(e){return null==this.endPoints[e]&&alert("No endpoint defined for: "+e),this.endPoints[e]},setProxyPrefix:function(e){this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.endPoints=bizagi.render.services.getEndPoints(e)}}),$.Class.extend("bizagi.render.services.service",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId",BA_MULTIACTION_WITH_LIMIT_NUMBER:5,BA_MULTIACTION_WITH_LIMIT_QUEUE:"multiaction"},{init:function(e){(e=e||{}).context=e.context||"workflow",e.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.serviceLocator=new bizagi.render.services.context(e),this.multiactionService=new bizagi.render.services.multiactionservice(this),this.multiactionServiceWithLimit=new bizagi.render.services.multiactionservice(this,this.Class.BA_MULTIACTION_WITH_LIMIT_NUMBER,this.Class.BA_MULTIACTION_WITH_LIMIT_QUEUE),this.guid=Math.guid(),bizagi.override.enableECMMetadataMultiaction&&(this.multiactionMetadataService=new bizagi.render.services.metadatamultiactionservice(this)),this.userfieldRequests={},this.deviceType=e.deviceType||(bizagi.util.isSmartphoneDevice()?bizagi.deviceEnum.smartphone:bizagi.util.isTabletDevice()?bizagi.deviceEnum.tablet:bizagi.deviceEnum.desktop),this.deviceCode=bizagi.util.getDeviceCode()},multiaction:function(){return this.multiactionService},multiactionWithLimit:function(){return this.multiactionServiceWithLimit},metadataECMMultiaction:function(){return bizagi.override.enableECMMetadataMultiaction?this.multiactionMetadataService:this},getFormData:function(e){if(e&&e.data)return e.data;e=e||{};var t={};if(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action||"LOADFORM",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,e.idProcess&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idProcess"]=e.idProcess),e.idOrganization&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idOrganization"]=e.idOrganization),e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.idEntity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEntity"]=e.idEntity),e.surrogateKey&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey),e.idRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.requestedForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"requestedForm"]=e.requestedForm),e.recordXPath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordXPath"]=e.recordXPath),e.summaryForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"summaryForm"]=e.summaryForm),e.idCase&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idWorkitem&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.idTask&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idTask"]=e.idTask),e.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.contextType&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contextType),e.guidEntity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),bizagi.util.isEmpty(e.isRefresh)||(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isRefresh"]=e.isRefresh),e.isActionStartForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=e.isActionStartForm),e.additionalXpaths&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),void 0!==e.readOnlyForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"readonlyform"]=e.readOnlyForm),void 0!==e.printversion&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"printForm"]=e.printversion),void 0!==e.recordXpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.guid&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guid"]=e.guid),e.downloadOfflineForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"downloadofflineform"]=1),!1===e.editable&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"DisplayFormAsReadOnly"]=!0),e.printversion){e[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"]&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"]=e[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"])}if(e.prepare)return t;bizagi.chrono.initAndStart("data");var i={url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:e.action||"LOAD"};return e.downloadOfflineForm&&(i.avoidLoader=!0),$.ajax(i).pipe((function(i){if(bizagi.chrono.stopAndLog("data"),e.printversion)try{i.form.properties.editable="False";i=function e(i){return null==i?i:(i.hasOwnProperty("type")&&"grid"==i.type?(i.id=t.id+"-print",i.allowAdd="False",i.allowDelete="False",i.allowEdit="False",i.allowGrouping="False",i.allowMore="False",i.allowSearch="False"):$.each(t,(function(t,r){"object"==_typeof(r)&&(i[t]=e(i[t]))})),i)}(i)}catch(e){}return i}))},getSearchFormData:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHFORM",e.xpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idSearchForm&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm),e.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-search-form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"SEARCHFORM"})},processDataValues:function(e){var t;for(t in e=$.extend(!0,{},e))e.hasOwnProperty(t)&&"object"==$.type(e[t])&&e[t].hasOwnProperty("id")&&(e[t]=e[t].id);return e},submitData:function(e){data=this.resolveData(e.data||{},e.xpathContext),data=this.processDataValues(data),data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action,(e=e||{}).xpath&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idPageCache&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.guidEntity&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),e.contexttype&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.transitions&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"transitions"]=e.transitions),e.surrogatekey&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.forcePlanCompletion&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"forcePlanCompletion"]=e.forcePlanCompletion);var t=e.action.toString().toUpperCase();return bizagi.debug("Data sent",data),e.prepare?data:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:data,type:"POST",dataType:"json",serviceType:t,beforeSend:function(e,t){e.renderingService=!0}})},resolveData:function(e,t){var i,r,a;if(!$.isEmptyObject(e)&&t&&-1!==t.search(/\[id=\d+\]/))for(i in e)-1!==i.search(/\[id=\d+\]/)&&t==i.substr(0,i.search(/\]/)+1)&&(r=i.substr(i.search(/\]/)+2),a=e[i],e[r]=a,delete e[i]);return e},getPropertyData:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,e.sessionId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.guidentity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.surrogatekey&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.pxpath&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpath"]=e.pxpath),e.prows&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.prows),e.ppage&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.ppage),null!=e.pfilter&&null!=e.pfilter&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"filter"]=e.pfilter),null!=e.psort&&null!=e.psort&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.psort),e.porder&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.porder),e.pcaseId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"caseId"]=e.pcaseId),e.pguidEntity&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidEntity"]=e.pguidEntity),e.psurrogatedKey&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.psurrogatedKey),e.pactionXpath&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"actionXpath"]=e.pactionXpath),e.ptemplateGuid&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"templateGuid"]=e.ptemplateGuid),e.pparameters&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"parameters"]=e.pparameters),bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},getData:function(e){return this.getPropertyData($.extend(e,{property:"data"}))},getSearchData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"term"]=e.term,this.getPropertyData($.extend(e,{property:"data"}))},getCollapseData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"collapseState"]=e.collapseState,this.getPropertyData($.extend(e,{property:"collapseState"}))},getGridData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.order,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,this.getPropertyData($.extend(e,{property:"data"}))},getGridDataExclusivesSelected:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathfilter"]=e.xpathfilter,this.getPropertyData($.extend(e,{property:"exclusivesSelected"}))},getUploadCancelImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-upload-cancel-image")},getUploadFileUrl:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)+"&xsrf="+bizagi.getXSRFToken()},downloadFile:function(e){var t=this,i=t.getUploadFileUrl(e);return $.ajax({url:i,type:"GET",queue:e.queue,dataType:"binary",processData:!1}).then((function(e){if("application/json"==e.type)return t.readFileAsJSON(e);if("string"==typeof e){var i=arguments[2],r=i.getResponseHeader("Content-type");e=bizagi.util.media.byteArrayToBlob(t.stringToByteArray(e),r)}return e}))},readFileAsJSON:function(e){var t=new $.Deferred,i=new FileReader;return i.onloadend=function(){t.reject({responseText:i.result})},i.readAsText(e),t.promise()},stringToByteArray:function(e){return bizagi.util.stringToByteArray(e)},getUploadFileEntityUrl:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)},getUploadAddUrl:function(){var e=this.serviceLocator.getUrl("render-upload-add-url"),t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDFILE",this.verifyPathToBase(bizagi.services.ajax.pathToBase,e)+"?"+jQuery.param(t)},getUploadAddFileUrl:function(e){var t=this.serviceLocator.getUrl("form-submit-data-upload"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=!0===e?"SAVEUSERIMAGE":"savefile",this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)},deleteImage:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="DELETEUSERIMAGE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing image '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},deleteUploadFile:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing file in upload '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},getECMMetadata:function(e){var t=e.extra||{};return t.action="getECMMetadata",t.idFileUpload=e.idFileUpload,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,t.xPath=e.xPath,t.idAttrib=e.idAttrib,e.sessionId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),bizagi.debug("Get file metadata '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},checkOutFile:function(e){var t=e.extra||{};return t.action="checkOutFile",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},cancelCheckOut:function(e){var t=e.extra||{};return t.action="cancelCheckOut",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},deleteECMFile:function(e){var t=e.extra||{};return t.action="delete",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("delete file'"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMFileContent:function(e){var t=e.extra||{};return t.action="updateECMFileContent",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file content '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMMetadata:function(e){var t=e.extra||{};return t.action="updateECMMetadata",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file meta data '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getFileProperties:function(e){var t=e.extra||{};return t.action="getFileProperties",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Get file properties '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},getFile:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},getAllDocuments:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),i={};return i.contextXpath=e.xpathContext,i.xpathAttribute=e.xpath,i.idCase=e.idCase,i.idWorkItem=e.idWorkItem,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},getUploadFileEntity:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},uploadECMFile:function(e){var t=e.extra||{};return t.action="uploadECMFile",t.fileUpload=e.fileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.fileName=e.fileName,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Upload ECM file '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getECMFileUrl:function(e){var t=e.url||this.serviceLocator.getUrl("render-ecm-upload-url")+"File",i=e.extra||{};return i.action="viewECMFile",i.idFileUpload=e.idFileUpload,i.xPath=e.xPath,i.idAttrib=e.idAttrib,i.fileName=e.fileName,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i.xpathContext=e.xpathContext,e.sessionId&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.p_sessionId&&(i.p_sessionId=e.p_sessionId),bizagi.debug("View uploaded file '"+e.xPath+"'",i),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)+"&xsrf="+bizagi.getXSRFToken()},isFileOnECM:function(e){var t={action:"isFileOnECM"};return t.idUpload=e.idUpload,$.read(this.serviceLocator.getUrl("render-ecm-upload-url"),t)},editGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EDITRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending edit request for relation '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-edit-url"),data:t,type:"POST",dataType:"json",serviceType:"EDITRELATION"})},addGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Sending add request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATION"})},addGridRecordData:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATIONWITHDATA",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype);var i=this.processDataValues(e.submitData||{});for(key in i)t[key]=i[key];return bizagi.debug("Sending add request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATIONWITHDATA"})},saveGridRecord:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disableServerGridValidations"]=e.disableServerGridValidations||!1,e.submitData.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var i=e.submitData||{};for(key in i=this.processDataValues(i))t[key]=i[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVERELATION"})},deleteGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending delete request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"REMOVERELATION"})},getFlipAssociation:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.id,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="flipped",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"flipstate"]=e.flipstate,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending request for flip association control '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:"text"}).pipe((function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}}))},rollbackGridAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ROLLBACK",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-rollback-url"),data:t,type:"POST",dataType:"json",serviceType:"ROLLBACK"})},getSearchDefaultImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-search-default-image")},processDataCriteria:function(e){var t;for(t in e=$.extend(!0,[],e))e.hasOwnProperty(t)&&e[t].hasOwnProperty("value")&&"object"==$.type(e[t].value)&&e[t].value.hasOwnProperty("id")&&e[t].value.hasOwnProperty("label")&&(e[t].value=e[t].value.id);return e},submitSearch:function(e){var t,i=e.extra||{},r=e.sort&&""!==e.sort?e.sort:"";return e.order&&""!==e.order&&""!==r&&(r+=" "+e.order),i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHENTITYFORRENDER",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=r,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"pageSize"]=e.rows,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,t=this.processDataCriteria(e.criteria),i[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchCriteria"]=JSON.encode(t),e.allowFullSearch&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"allowFullSearch"]=e.allowFullSearch),e.maxRecords&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxRowsAllowed"]=e.maxRecords),bizagi.debug("Performing advanced search",i),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-search-advanced-url"),data:i,type:"POST",dataType:"json",serviceType:"SEARCHENTITYFORRENDER"})},associateStakeholder:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey,t.associatedUser=e.associatedUser,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity,bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:e.dataType||"json"})},refreshAssociateStakeholder:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getLetterNotEditableUrl:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache;var i=e.url||this.serviceLocator.getUrl("render-letter-notEditable-url");return this.verifyPathToBase(bizagi.services.ajax.pathToBase,i)+"?"+jQuery.param(t)},getLetterContent:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-letter-content-url"),data:t,type:"POST",dataType:"html"}).pipe((function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}}))},getCanGenerateLetter:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CANGENERATELETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:this.serviceLocator.getUrl("render-letter-content-url"),data:t,type:"POST",dataType:"json"})},saveLetterContent:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="UPDATELETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache;var i=e.content||"",r=(e.url||this.serviceLocator.getUrl("render-letter-save-url"))+"?"+jQuery.param(t);return bizagi.debug("Save request for letter sent to: "+r,i),e.prepare?t:$.ajax({url:r,data:i,type:"POST",dataType:"html"})},getLetterEditorIconsPath:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-letter-content-icons")},executeButton:function(e){return this.getPropertyData($.extend(e,{property:"buttonRule"}))},getFilePrint:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="data",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},editLinkForm:function(e){return this.editGridRecord(e)},saveLinkForm:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVEFORMLINKRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.submitData.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var i=e.submitData||{};for(key in i=this.processDataValues(i))t[key]=i[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVEFORMLINKRELATION"})},rollbackLinkForm:function(e){return this.rollbackGridAction(e)},commitLinkForm:function(e){return this.commitGridAction(e)},sendCheckpoint:function(e){return this.sendCheckpointAction(e)},getUserfieldDefinition:function(e){return e=e||{},this.userfieldRequests[e.userfield]?this.userfieldRequests[e.userfield]:(this.userfieldRequests[e.userfield]=$.read(this.serviceLocator.getUrl("render-userfield-definition"),{guidUserfield:e.userfield,device:e.device||"desktop"}),this.userfieldRequests[e.userfield])},refreshControl:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESH",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"PARTIALREFRESH"})},refreshGridCell:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESHGRIDCELL",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidcolumn"]=e.column,e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.typeRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"typeRender"]=e.typeRender),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json"})},executeRule:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTERULE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidrule"]=e.rule||"",e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeInterface:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEINTERFACE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidinterface"]=e.interface||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeSAPConnector:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTESAP",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidsap"]=e.guidsap||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeConnector:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTECONNECTOR",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidConnector"]=e.guidConnector||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executePipeline:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEPIPELINE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidpipeline"]=e.pipeline||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},generateDocumentTemplate:function(e){return(e=e||{}).append=!!e.append&&e.append,$.create(this.serviceLocator.getUrl("render-document-generate"),{h_pageCacheId:e.idPageCache,contextXpath:e.xpathcontext,groupMappingId:e.groupMapping,xpathAttribute:e.xpath,append:e.append,controlId:e.id})},getAllDocumentsDownloadUrl:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),i={};return i.h_pageCacheId=e.idPageCache,i.contextXpath=e.xpathContext,i.xpathAttribute=e.xpath,i.idCase=e.idCase,i.idWorkItem=e.idWorkItem,i.p_sessionId=e.sessionId,this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)+"&xsrf="+bizagi.getXSRFToken()},getCaseNumber:function(e){return $.ajax({url:this.serviceLocator.getUrl("case-handler-getCaseSummary").replace("{idCase}",e.idCase)+"?eventAsTasks=false&onlyUserWorkItems=true&mobileDevice="+bizagi.isMobile(),type:"GET",dataType:"json"})},getCaseAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:e.idCase}).pipe((function(e){return e}))},getWorkitems:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getWorkItems"),{idCase:e.idCase,onlyUserWorkItems:e.onlyUserWorkItems||""})},getGridExportFile:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.exportType,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"idForm"]=e.idForm,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},sendEmail:function(e){e=e||{};var t={};if(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"sendEmail",e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_ACTION_PARAMETER_PREFIX+"to"]=e.to,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"subject"]=e.subject,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"message"]=e.message,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"selected"]=JSON.encode(e.selected),e.prepare)return t;var i=e.url||this.serviceLocator.getUrl("form-get-data");return $.create(i,t)},invalidatePageCache:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="INVALIDATEPAGECACHE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:t,type:"POST",dataType:"json",serviceType:"INVALIDATEPAGECACHE"})},getUsersList:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList"),e)},getUsersListFromQueryForm:function(e){return $.read(this.serviceLocator.getUrl("render-query-getUsersList"),e)},getUsersListFromPreferences:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-FromPreferences"),e)},getUsersListForXpathIdBossUser:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForXpathIdBossUser"),e)},getUsersListForXpathIdDelegate:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForXpathIdDelegate"),e)},getUsersListForStakeholders:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForStakeholders"),e)},getUsersForAssignation:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersForAssignation"),e)},getUsersForm:function(e){return $.create(this.serviceLocator.getUrl("admin-usersform"),e)},generateDataToSendByEmail:function(e){return e=e||{},$.ajax({url:this.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:e,type:"POST",dataType:"json"})},sendUserEmail:function(e){(e=e||{}).eMailTo,e.subject,e.body;return $.ajax({url:this.serviceLocator.getUrl("admin-sendUserEmail"),data:e,type:"POST",dataType:"json"})},getConfiguration:function(){var e=this.serviceLocator.getUrl("admin-users-config");return $.read(e)},verifyPathToBase:function(e,t){return-1!=t.indexOf("http")&&""!=e?t:e+t},getTemplate:function(e){var t={};e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADTEMPLATE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]="entity",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guid,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isProcessData"]=e.forcePersonalizedColumns,e.templateType&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"templatetype"]=e.templateType),e.templateGuid&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"templateguid"]=e.templateGuid),null!=e.isDefaultTemplate&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isDefaultTemplate"]=e.isDefaultTemplate);var i=bizagi.util.detectDevice();return bizagi.util.isTabletDevice()?i="tablet":bizagi.util.isSmartphoneDevice()&&(i="mobile"),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=i,e.prepare?t:$.create(this.serviceLocator.getUrl("form-get-data"),t)},hasStartForm:function(e){var t={};return e.guidWFClass&&(t.guidWFClass=e.guidWFClass),$.read(this.serviceLocator.getUrl("render-processes-startform"),t)},getStartForm:function(e){var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADSTARTFORM",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidprocess"]=e.guidprocess,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=!0,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idCase&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idWorkitem&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.additionalXpaths&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.surrogatedKey&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.surrogatedKey),e.recordXpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.mappingstakeholders&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"mappingstakeholders"]=e.mappingstakeholders),$.ajax({url:this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",cache:!0})},editActionForm:function(e){return this.editGridRecord(e)},getActions:function(e){var t=$.extend(e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.ptags&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.pmaxitems&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxitems"]=e.pmaxitems),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},executeActions:function(e){var t=$.extend({},e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.pguidConstructor&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidConstructor"]=e.pguidConstructor),e.pguidAction&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidAction"]=e.pguidAction),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getPolymorphicActions:function(e){var t=$.extend(e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.ptags&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.additionalXpaths&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},serializePolymorphicActions:function(e){var t=[],i=function t(i){i=i||{};var r="";return $.each(e,(function(e,a){a[0]==i[6]&&(r+=t(a)+a[1]+" > ")})),r};return function t(r,a){var n,o=function(t){var i=[];return t=t||"",$.each(e,(function(e,r){r[6]==t&&i.push(r)})),i}(a);return $.each(o,(function(e,a){var o=t([],a[0]);(""!==(n={guidEntity:a[0],displayName:a[1],hasConstructor:!!a[5],type:a[3],guidObject:a[4],guidConstructor:a[5],xpathContext:a[2],children:o,parents:i(a)}).guidConstructor||n.children.length>0)&&r.push(n)})),r}(t,""),t},getEntityImage64:function(e){var t={width:e.data,height:e.height,xpath:e.xpath},i=this.serviceLocator.getUrl("render-entity-layout-image64").replace("{entity}",e.entity).replace("{surrogateKey}",e.surrogateKey);return $.ajax({url:i,data:t})},getFilesDataForLayoutUploadControl:function(e){return $.read(this.serviceLocator.getUrl("render-entity-layout-upload-files"),e)},processUploadFile:function(e){return $.ajax({url:this.verifyMobilePathToBase(bizagi.services.ajax.pathToBase||"",e.url),data:e.formData,type:"POST",contentType:!1,processData:!1})},commitGridAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="COMMIT",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-commit-url"),data:t,type:"POST",dataType:"json",serviceType:"COMMIT"})},sendCheckpointAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CHECKPOINT",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending checkpoint request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-checkpoint-url"),data:t,type:"POST",dataType:"json",serviceType:"CHECKPOINT"})},verifyMobilePathToBase:function(e,t){return bizagi.util.isMashupContext()?(t||"").replaceAll(e,""):t}}),bizagi.render.services.service.extend("bizagi.render.services.service",{},{init:function(e){this._super(e),this.database=e.database,this.gridService=new bizagi.grid.services.service({renderDataService:this,database:e.database}),this.fileService=new bizagi.file.services.service({renderDataService:this,database:e.database}),this.syncService=new bizagi.sync.services.service({renderDataService:this,database:e.database}),this.formService=new bizagi.form.services.service({renderDataService:this,database:e.database})},getFileService:function(){return this.fileService},getSyncService:function(){return this.syncService},getGridService:function(){return this.gridService},getFormService:function(){return this.formService},getFormData:function(e){var t=this;if((e=e||{}).isOfflineForm){if("inactive"==e.workitemstate&&e.online&&!0!==e.alreadyMarkedAsActive&&t._super(e),bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData)return t.getFormDataFromNative(e).then((function(i){return t.database.mergeForm(i[1],i[0].data,{online:e.online})}));if("task"===e.offlineType){if(e.isEdited||!e.isOpen){var i=new $.Deferred;return $.when(t.database.getTaskData(e)).then((function(r){var a=e.syncError||r.syncStatus,n=e.hasSyncError||!bizagi.util.isEmpty(a),o=t.database.getTaskForm(e);$.when(t.database.mergeDataDocument(r.data,o)).done((function(r){var a={data:r,isOpen:e.isOpen};t.database.mergeForm(a,o,{online:e.online,hasSyncError:n}).then((function(e){i.resolve(e)}))}))})),i.promise()}return t.database.getTaskForm(e)}return $.when(t.database.getCase(e.idCase)).then((function(i){var r=$.trim(i.idWfClass.toString());return t.database.mergeForm(i,t.database.getFormData(r),{online:e.online})}))}return t._super(e)},getOfflineImage:function(e,t){return"task"===e.offlineType?this.database.getActivityImage(e,t):this.database.getStartDataImage(e,t)},getOfflineActivityDataImage:function(e,t){return this.database.getActivityDataImage(e,t)},saveOfflineImage:function(e,t){return"synchronization"===e.operationType?this.database.saveActivityFormImage(e,t):"edition"===e.operationType?"task"===e.offlineType?this.database.saveActivityDataImage(e,t):this.database.saveStartDataImage(e,t):null},saveOfflineFile:function(e,t,i){return"synchronization"===e.operationType?this.database.saveActivityFormFile(e,t,i):"edition"===e.operationType?"task"===e.offlineType?this.database.saveActivityDataFile(e,t,i):this.database.saveStartDataFile(e,t,i):null},getOfflineFile:function(e,t,i){return"task"===e.offlineType?this.database.getActivityFile(e,t,i):this.database.getStartDataFile(e,t,i)},getOfflineActivityDataFile:function(e,t,i){return this.database.getActivityDataFile(e,t,i)},getFormDataFromNative:function(e){var t=new $.Deferred;return bizagiapp.getNativeFormData(e,(function(i){bizagiapp.getCase(e.idCase,(function(e){var r=[JSON.parse(i),JSON.parse(e)];t.resolve(r)}),(function(e){t.reject(e)}))}),(function(e){t.reject(e)})),t.promise()},submitData:function(e){if((e=e||{}).isOfflineForm){var t=this.resolveData(e.data||{},e.xpathContext),i=(e.action||"").toLowerCase();return""==i||"save"!=i&&"next"!=i&&"nextwithoutvalidations"!=i&&"submitdata"!=i||(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=i),bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData?this.saveNativeFormInfo(e,t):"task"===e.offlineType?(this.sanityDataForSaveInDB(t),this.database.saveTaskData(e,t)):this.database.saveStartData(e,t)}return this._super(e)},sanityDataForSaveInDB:function(e){delete e.deferreds},saveNativeFormInfo:function(e,t){var i=this,r=new $.Deferred;return i.getFormDataFromNative(e).then((function(a){return i.database.nativesaveStartData(t,a[1],a[0].data).done((function(t){bizagiapp.saveFormData(e,t),r.resolve(t)}))})),r.promise()},removeStartCaseSyncError:function(e){var t,i=this;return i.database.getCase(e.idCase).then((function(r){return r.isOpen=!0,delete r.syncDetails,delete r.syncStatus,t=r,i.database.saveStartCase(e.idCase,r)})).then((function(){return t}))},removeTaskCaseSyncError:function(e){var t,i=this,r=e.idCase+"-"+e.idWorkitem;return i.database.getTask(r).then((function(e){return e.isOpen=!0,e.isEdited=!0,delete e.syncDetails,delete e.syncStatus,t=e,i.database.saveTask(r,e)})).then((function(){return i.database.getTaskData(e)})).then((function(t){return t&&null!=t.data&&(t.data.h_action="",delete t.data.retry_h_actions,delete t.data.actions),i.database.saveTaskData(e,t.data)})).then((function(){return t}))},parseServiceError:function(e){var t,i={};if(null!=e){if(e.responseText)t=e.responseText;else if(1!=e.length||e[0].responseText)if(e.length>0&&e[0]&&e[0].responseText)t=e[0].responseText;else if(3==e.length){for(var r=e[2];null!=r&&r.error;)r=r.error;r.errorType?i=r:(i.type="error",i.errorType=e[1],i.message=e[2])}else try{t=JSON.stringify(e)}catch(e){}else i=e[0];if(null!=t)try{i=JSON.parse(t)}catch(e){i.type="error",i.errorType="parsingError",i.message="Error parsing the server response: "+t}return i}}}),bizagi.file=bizagi.file||{},bizagi.file.services=bizagi.file.services||{},bizagi.file.services.service||$.Class.extend("bizagi.file.services.service",{loaders:{},isLoading:function(e){return this.loaders[e]||!1},setLoading:function(e,t,i,r){var a=this.internalBuildOfflineFileLoadingKey(e,t,i,r);this.loaders[a]=!0},clearLoading:function(e,t,i,r){var a=this.internalBuildOfflineFileLoadingKey(e,t,i,r);this.loaders[a]=!1},internalBuildOfflineFileLoadingKey:function(e,t,i,r){var a="case:"+e;return bizagi.util.isEmpty(t)||(a+="-"+t),a+="::",a+="xpath:",bizagi.util.isEmpty(i)||(a+=i+"."),a+=r}},{EMPTY_IMAGE:"R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",init:function(e){this.renderDataService=e.renderDataService,this.database=e.database},isLoading:function(e){return this.Class.isLoading(this.buildOfflineFileLoadingKey(e))},buildOfflineFileLoadingKey:function(e){var t=e.getFormContainer(),i=t.getParams().idCase,r=t.getParams().idWorkitem;return this.Class.internalBuildOfflineFileLoadingKey(i,r,e.properties.xpathContext,e.properties.xpath)},downloadFormImages:function(e,t){var i=this,r=i.database.filterXpathsByTypeMap(e,{image:!0,columnImage:!0,signature:!0}),a=[];return r.forEach((function(r){var n=i.buildOfflineImageId(r.value,r.xpathContext,r.xpath);t.localFiles[n]||a.push(i.downloadImage(t,e.form,r))})),a},downloadImage:function(e,t,i){var r=t.properties.compatibilityVersion>=2;if(r&&bizagi.util.isEmpty(i.value))return $.Deferred().resolve(null).promise();var a={xpath:i.xpath,idRender:i.renderId,xpathContext:i.xpathContext||"",idPageCache:t.pageCacheId,sessionId:t.sessionId,property:r?"fileBinaryContent":"fileFullContent"};return r?this.downloadImageVersion2(e,a,t,i):this.downloadImageVersion1(e,a,t,i)},downloadImageVersion2:function(e,t,i,r){var a=this;return a.Class.setLoading(e.idCase,e.idWorkitem,r.xpathContext,r.xpath),t.queue=e.bulkDownload?"offlineimages":void 0,a.renderDataService.downloadFile(t).then((function(t){return t.name=r.xpath,e.operationType="synchronization",e.id=a.buildOfflineImageId(r.value,r.xpathContext,r.xpath),a.database.saveActivityFormImage(e,t,t.type)})).then((function(){if(!e.bulkDownload)return a.ensureImageIsPersistedLocally(e)})).always((function(){a.Class.clearLoading(e.idCase,e.idWorkitem,r.xpathContext,r.xpath)}))},ensureImageIsPersistedLocally:function(e,t){var i=this;if(0==(t=t||3))return console.log("downloadImageVersion2::image not found after 3 retries '"+e.id+"'",e),$.Deferred().resolve().promise();var r={idCase:e.idCase,idWorkitem:e.idWorkitem,id:e.id,offlineType:"task",loadImageFromForm:!1},a=!1;return i.renderDataService.getOfflineImage(r,bizagi.util.db.AttachmentType.Blob).then((function(e){if(null==e)return a=!0,bizagi.util.sleepFor(200)})).then((function(){if(a)return i.ensureImageIsPersistedLocally(e,t-1)}))},downloadImageVersion1:function(e,t,i,r){var a=this;return a.Class.setLoading(e.idCase,e.idWorkitem,r.xpathContext,r.xpath),a.renderDataService.multiaction().getPropertyData(t).then((function(t){if(null!=t){var i={id:r.xpathContext?r.xpathContext+"."+r.xpath:r.xpath,idCase:e.idCase,idWorkitem:e.idWorkitem,operationType:"synchronization"};return a.database.saveActivityFormImage(i,t)}})).always((function(){a.Class.clearLoading(e.idCase,e.idWorkitem,r.xpathContext,r.xpath)}))},downloadFormFiles:function(e,t){var i=this,r={},a=[];return i.database.filterXpathsByTypeMap(e,{upload:!0,columnUpload:!0}).forEach((function(n){var o=i.downloadFilesInUploadControl(t,e,n);Array.prototype.push.apply(a,o),"columnUpload"!==n.type&&(r[n.xpath]=i.database.convertUploadOnlineValueInOfflineValue(n.value))})),{data:r,promises:a}},downloadFilesInUploadControl:function(e,t,i){var r=this,a=[];return i.value&&Array.isArray(i.value)&&i.value.forEach((function(n){var o=n[0],s=n[1],l=(i.xpathContext?i.xpathContext+".":"")+i.xpath+"."+o;e.localFiles[l]||a.push(r.downloadSingleFile(e,t,i,o,s,l))})),a},downloadSingleFile:function(e,t,i,r,a,n){var o=this;return o.downloadBinaryFile(e,t,i,r,a).then((function(t){t&&(e.operationType="synchronization",e.id=n,o.renderDataService.saveOfflineFile(e,t,t.type))}))},downloadBinaryFile:function(e,t,i,r,a){var n={xpath:i.xpath,idRender:i.renderId,xpathContext:i.xpathContext||"",idPageCache:t.form.pageCacheId,fileId:r,sessionId:t.form.sessionId,queue:e.bulkDownload?"offlinefiles":void 0};return this.renderDataService.downloadFile(n).then((function(e){return e.name=a,e}))},uploadFormImages:function(e,t){var i=this,r=[];return t.forEach((function(t){var a=t.value;a&&($.extend(e,t),r.push(i.uploadImage(e,a)))})),r},uploadFormGridImages:function(e,t,i){for(var r=Object.keys(t),a=[],n=0;n<r.length;n++)for(var o=t[r[n]],s=Object.keys(o),l=0;l<s.length;l++)if("isNew"!=s[l]){var d=o[s[l]];if(o.isNew){var c=i[r[n]];if(void 0===c)continue;d.xpathContext=d.gridXpath+this.database.buildCellXpathFilter(c)}else d.xpathContext=d.gridXpath+this.database.buildCellXpathFilter(r[n]);if(!d)continue;d.columnXpath&&(e.xpath=d.columnXpath),uploadParams=$.extend({},e,d),a.push(this.uploadImage(uploadParams,d))}return a},uploadImage:function(e,t){var i=this,r=i.buildAddParamsForUpload(e,"savefile"),a=bizagi.util.isEmpty(t.name)?"offlineImage_"+bizagi.util.randomNumber()+".png":t.name,n=e.xpath,o=i.renderDataService.getUploadAddFileUrl(!1),s=new FormData;return $.each(r,(function(e,t){s.append(e,t)})),i.renderDataService.getOfflineImage({idCase:e.idCase,idWorkitem:e.idWorkitem,id:t.offlineId,offlineType:e.offlineType,loadImageFromForm:!1},bizagi.util.db.AttachmentType.Blob).then((function(r){return t.isSignature&&null==r&&(r=bizagi.util.b64toBlob(i.EMPTY_IMAGE,"image/png")),r?(s.append(n,r,a),$.ajax({url:o,type:"POST",contentType:!1,processData:!1,data:s})):(bizagi.util.console.error("UploadImage:: Missing local file",e,t.offlineId),$.Deferred().reject({type:"error",errorType:"offlineUploadFileError",message:"Missing local file "+t.offlineId}).promise())})).then((function(t){return t.type&&"error"===t.type?(bizagi.util.console.error("UploadImage:: Server returned error",e,t),$.Deferred().reject(t).promise()):(bizagi.util.console.log("Image uploaded",t,n,a),t)})).fail((function(e){bizagi.util.console.error("UploadImage:: fail",e)}))},uploadAndDeleteFormFiles:function(e,t,i){var r=this,a=[];return t.forEach((function(t){Array.prototype.push.apply(a,r.uploadAndDeleteFiles(e,t,i))})),a},uploadFormGridFiles:function(e,t,i,r){for(var a=[],n=Object.keys(t),o=0;o<n.length;o++)for(var s=t[n[o]],l=Object.keys(s),d=0;d<l.length;d++)if("isNew"!=l[d]){var c=s[l[d]];if(s.isNew){var u=i[n[o]];if(void 0===u)continue;c.xpathContext=c.gridXpath+this.database.buildCellXpathFilter(u)}else c.xpathContext=c.gridXpath+this.database.buildCellXpathFilter(n[o]);Array.prototype.push.apply(a,this.uploadAndDeleteFiles(e,c,r))}return a},uploadAndDeleteFiles:function(e,t,i){var r=[],a=this,n=t.value;if(n&&0!=n.length)return n.forEach((function(n){var o=n.status;if("new"===o){var s={fileId:n.id,fileName:n.fileName,fileMimeType:n.mimeType};$.extend(s,e),r.push(a.uploadFile(s,t))}else if("deleted"===o){var l={renderId:t.renderId,xpath:t.xpath,fileId:n.id,idPageCache:e.pageCacheId};t.columnXpath&&(l.xpath=t.columnXpath,l.xpathContext=t.xpathContext);var d=a.deleteFile(l);i.push(d)}})),r},uploadFile:function(e,t){var i=this,r=t.xpath;if(t.columnXpath){r=t.columnXpath;var a=(t.xpathContext?t.xpathContext+".":"")+r+"."+e.fileId;t.isNew&&t.fullXpath&&(a=t.fullXpath+"."+e.fileId)}else a=r+"."+e.fileId;return i.getOfflineFile(e,a).then((function(n){if(n){var o={xpath:r,renderId:t.renderId,pageCacheId:e.pageCacheId,sessionId:e.sessionId,fileName:e.fileName,xpathContext:t.xpathContext};return i.uploadBinaryFile(o,n)}return bizagi.util.console.error("UploadFile:: Missing local file",e,a),$.Deferred().reject({type:"error",errorType:"offlineUploadFileError",message:"Missing local file "+a}).promise()}))},uploadBinaryFile:function(e,t){var i=this.buildAddParamsForUpload(e,"addfile"),r=new FormData;return $.each(i,(function(e,t){r.append(e,t)})),r.append(e.xpath,t,e.fileName),this.renderDataService.processUploadFile({url:this.renderDataService.getUploadAddUrl(),formData:r}).then((function(t){return t.type&&"error"===t.type?(bizagi.util.console.error("UploadBinaryFile:: Server returned error",e,t),$.Deferred().reject(t).promise()):(bizagi.util.console.log("File uploaded",t,e.xpath,e.fileName),t)}))},getOfflineFile:function(e,t){var i=e.offlineType,r={id:t,idCase:e.idCase};return i&&"start"===i?(r.offlineType=e.offlineType,this.renderDataService.getOfflineFile(r,bizagi.util.db.AttachmentType.Blob,e.fileMimeType)):(r.idWorkitem=e.idWorkitem,this.renderDataService.getOfflineActivityDataFile(r,bizagi.util.db.AttachmentType.Blob,e.fileMimeType))},deleteFile:function(e){var t=e.fileId,i={xpath:e.xpath+(bizagi.util.isNumeric(t)?"[id="+t+"]":"[id='"+t+"']"),idRender:e.renderId,xpathContext:e.xpathContext||"",idPageCache:e.idPageCache,prepare:!0};return this.renderDataService.deleteUploadFile(i)},buildOfflineImageId:function(e,t,i,r,a){r=r||void 0===r,bizagi.util.isEmptyValue(e)&&(e=null),e=bizagi.util.isArray(e)&&bizagi.util.isArray(e[0])?e[0][1]:e;var n=(t?t+".":"")+i;return!r||bizagi.util.isEmpty(e)||a||(n+="."+e),n},getOfflineImageName:function(e,t){bizagi.util.isEmptyValue(e)&&(e=null);var i=bizagi.util.isArray(e)&&bizagi.util.isArray(e[0])?e[0][1]:null;return t&&(i="offlineImage_"+bizagi.util.randomNumber()+".png"),i},changeOfflineImageName:function(e,t){bizagi.util.isEmptyValue(e)||bizagi.util.isArray(e)&&bizagi.util.isArray(e[0])&&(e[0][1]=t)},resolveBlobFromPath:function(e,t){var i=new $.Deferred;if(bizagi.util.isCordovaSupported()){e=bizagi.util.isAndroidDevice()?bizagi.util.media.getImagePath(e):bizagi.util.media.normalizeIOSFilePath(e);var r=function(e){bizagi.util.console.error("Error converting path to blob",e),i.reject(e)};window.resolveLocalFileSystemURL(e,(function(e){e.file((function(e){var r=new FileReader;r.onloadend=function(){var r=new Blob([this.result],{type:e.type});r.name=t,i.resolve(r)},r.readAsArrayBuffer(e)}),r)}),r)}else i.resolve(e);return i},buildAddParamsForUpload:function(e,t){var i={};i.h_xpath=e.xpath,i.h_idRender=e.renderId,i.h_xpathContext=e.xpathContext||"",i.h_pageCacheId=e.pageCacheId,i.p_sessionId=e.sessionId,i.h_action=t;try{null!=BIZAGI_SESSION_NAME?i[BIZAGI_SESSION_NAME]=e.sessionId:i.JSESSIONID=e.sessionId}catch(t){i.JSESSIONID=e.sessionId}return i.queueID="q_"+bizagi.util.encodeXpath(e.xpath),i}}),bizagi.sync=bizagi.sync||{},bizagi.sync.services=bizagi.sync.services||{},bizagi.sync.services.service=bizagi.sync.services.service||{},$.Class.extend("bizagi.sync.services.service",{logKey:"OFFLINE SYNC TRACES::",syncTraces:{},getCurrentSyncStep:function(e){return this.syncTraces[e]?this.syncTraces[e].currentStep:null},setCurrentSyncStep:function(e,t,i){var r=this.syncTraces[e]||{},a=!bizagi.util.isEmpty(r);r.currentStep=t,r.steps=r.steps||[],r.steps.push({step:t,stepParameters:i}),a||(this.syncTraces[e]=r)},addSyncStepResponse:function(e,t,i){var r=this.syncTraces[e];if(bizagi.util.isEmpty(r))console.error("OFFLINE SYNC TRACES::addCurrentSyncStepResponse:: Sync trace does not exist",e);else{null==r.steps&&(r.steps=[]);var a=r.steps.find((function(e){return e.step==t}));bizagi.util.isEmpty(a)&&(console.warn("OFFLINE SYNC TRACES::addCurrentSyncStepResponse:: step "+t+" does not exist",t),a={step:"not-found-"+bizagi.util.randomNumber()+"-"+t},r.steps.push(a)),a.stepResponse=i}},addCurrentSyncStepResponse:function(e,t){var i=this.syncTraces[e];bizagi.util.isEmpty(i)?console.error("OFFLINE SYNC TRACES::addCurrentSyncStepResponse:: Sync trace does not exist",e):this.addSyncStepResponse(e,i.currentStep,t)},clearTrace:function(e){this.syncTraces[e]&&delete this.syncTraces[e].steps},printTrace:function(e){var t=this.syncTraces[e],i=this.logKey+"TRACE::"+e+"::";bizagi.util.isEmpty(t)||(bizagi.util.console.log(i+" ** TRACE START **",""),bizagi.util.console.log(i+"LAST STEP:: "+t.currentStep,""),(t.steps||[]).forEach((function(e,t){bizagi.util.console.log(i+(t+1)+"::"+e.step+":: params",e.stepParameters),bizagi.util.console.log(i+(t+1)+"::"+e.step+":: response",e.stepResponse)})),bizagi.util.console.log(i+" ** TRACE END **",""))},printAndClearTrace:function(e){var t=this;setTimeout((function(){t.printTrace(e),t.clearTrace(e)}),1e3)}},{init:function(e){this.renderDataService=e.renderDataService,this.database=e.database,this.fileService=this.renderDataService.getFileService(),this.gridService=this.renderDataService.getGridService()},syncOfflineStartCase:function(e){var t,i=this,r=e.id||e.idCase,a={action:"LOADSTARTFORM",idProcess:e.idProcess,downloadOfflineForm:!0};return bizagi.util.console.log("SYNCHRONIZING Start Case",e),i.Class.setCurrentSyncStep(r,"getFormData",e),i.renderDataService.getFormData(a).then((function(a){return t=a,i.Class.addCurrentSyncStepResponse(r,a),a.errorType?$.Deferred().reject(a).promise():a.form?(i.Class.setCurrentSyncStep(r,"separateComplexControls",{data:e.data}),i.database.separateComplexControls({offlineType:"start"},e.data)):$.Deferred().reject("Form not found in server response").promise()})).then((function(a){return i.Class.addCurrentSyncStepResponse(r,a),e.pageCacheId=t.form.pageCacheId,e.sessionId=t.form.sessionId,e.formId=t.form.properties.id,e.offlineType="start",i.performSyncOfflineCase(e,a)})).then((function(e){return i.Class.clearTrace(r),e})).fail((function(e){return i.Class.addCurrentSyncStepResponse(r,e),i.Class.printAndClearTrace(r),bizagi.util.console.error("START case sync failed",e),i.updateSyncStatusError(e,"start",r)}))},syncOfflineTaskCase:function(e){var t,i=this,r=e.data;delete e.data;var a=e.idCase+"-"+e.idWorkitem;return e.downloadOfflineForm=!0,bizagi.util.console.log("SYNCHRONIZING Task Case",e),i.Class.setCurrentSyncStep(a,"getFormData",e),i.renderDataService.getFormData(e).then((function(n){return t=n,i.Class.addCurrentSyncStepResponse(a,n),n.errorType?$.Deferred().reject(n).promise():n.form?(i.Class.setCurrentSyncStep(a,"separateComplexControls",{params:e,data:r}),i.database.separateComplexControls(e,r)):$.Deferred().reject("Form not found in server response").promise()})).then((function(r){return i.Class.addCurrentSyncStepResponse(a,r),e.pageCacheId=t.form.pageCacheId,e.sessionId=t.form.sessionId,e.offlineType="task",e.formId=t.form.properties.id,e.id=a,i.performSyncOfflineCase(e,r)})).then((function(e){return i.Class.clearTrace(a),e})).fail((function(e){return i.Class.addCurrentSyncStepResponse(a,e),i.Class.printAndClearTrace(a),i.updateSyncStatusError(e,"task",a)}))},performSyncOfflineCase:function(e,t){var i,r=this,a=[],n=[];return e.gridPromises=null,r.Class.setCurrentSyncStep(e.id,"checkpoint",e),r.createCheckpoint(e).then((function(i){return r.Class.addCurrentSyncStepResponse(e.id,i),r.processGridRecords(e,t,a,n)})).then((function(o){return i=r.parseGridAdditionsResponse(a,o),r.Class.addCurrentSyncStepResponse(e.id,{gridActionsResponse:o,entityMap:i}),r.processUploads(e,t,i,n)})).then((function(a){return r.Class.addSyncStepResponse(e.id,"uploadPromises",a),r.processMultiAction(e,t.data,i,n)})).then((function(t){return r.Class.addSyncStepResponse(e.id,"multiaction",t),t})).fail((function(t){r.Class.addCurrentSyncStepResponse(e.id,t);var i=r.Class.getCurrentSyncStep(e.id);return r.manageError(e,t,i,arguments)}))},processGridRecords:function(e,t,i,r){var a=t.grids;return a&&(e.gridPromises=gridPromises=this.gridService.uploadGridData(a,e.pageCacheId),gridPromises.bizAdditions&&gridPromises.bizAdditions.length>0&&Array.prototype.push.apply(i,gridPromises.bizAdditions),gridPromises.bizDeletions&&gridPromises.bizDeletions.length>0&&Array.prototype.push.apply(r,gridPromises.bizDeletions)),this.Class.setCurrentSyncStep(e.id,"multiaction grid",{gridVallues:a,gridActions:i}),this.renderDataService.multiaction().execute({actions:i})},parseGridAdditionsResponse:function(e,t){var i={};if(void 0!==e&&e.length>0)for(var r=0;r<e.length;r++)t[r]&&"success"===t[r].result.type&&(i[e[r]["offline-entityId"]]=t[r].result.IdEntity);return i},processUploads:function(e,t,i,r){var a=[],n=t.images,o=t.uploads;this.Class.setCurrentSyncStep(e.id,"uploadPromises",{imageValues:n,uploadValues:o});try{o&&o.length>0&&Array.prototype.push.apply(a,this.fileService.uploadAndDeleteFormFiles(e,o,r)),n&&n.length>0&&Array.prototype.push.apply(a,this.fileService.uploadFormImages(e,n));var s=e.gridPromises;s&&(Object.keys(s.bizImages).length>0&&Array.prototype.push.apply(a,this.fileService.uploadFormGridImages(e,s.bizImages,i,r)),Object.keys(s.bizFiles).length>0&&Array.prototype.push.apply(a,this.fileService.uploadFormGridFiles(e,s.bizFiles,i,r)))}catch(e){return $.Deferred().reject(e).promise()}return $.when.apply($,a)},processMultiAction:function(e,t,i,r){var a,n,o,s,l=this,d=e.offlineType,c=l.getSyncAction(d,t),u=null!=c&&c.length>0&&c.toLowerCase().includes("next"),p=(r=l.prepareMultiActionData(e,t,i,c,r),"multiaction");return l.Class.setCurrentSyncStep(e.id,p,r),l.renderDataService.multiaction().execute({actions:r}).then((function(t){return l.Class.addSyncStepResponse(e.id,"multiaction",t),n=t,s=l.wasMultiActionPerformed(t),a=t[t.length-1].result,s?(p="commit-multiaction",l.Class.setCurrentSyncStep(e.id,"commit-multiaction"),l.performCommit(e,u)):$.Deferred().reject(t).promise()})).then((function(t){return o=t,l.Class.addSyncStepResponse(e.id,"commit-multiaction",t),l.deleteOfflineCase(e,s,u)})).then((function(){return s?(null!=o&&null!=o.DataChangesetVersion&&(a.DataChangesetVersion=o.DataChangesetVersion),a.containsNext=$.grep(r,(function(e){return e.h_action.toLowerCase().includes("next")})).length>0,a):$.Deferred().reject(n).promise()})).fail((function(t){l.Class.addCurrentSyncStepResponse(e.id,t);var i="multiaction"==p&&!e.isRetry;return l.performRollback(e,t,i)}))},prepareMultiActionData:function(e,t,i,r,a){var n=this.convertStartFormDataToStandardFormat(t),o=!1;this.replaceGridChangesWithAddedRows(n,i);var s=this.addButtonActions(e,n);null!==s&&s.length>0&&(Array.prototype.push.apply(a,s),o=!0);var l=this.addTrySaveOrTryNextAction(e,r,n,o);return bizagi.util.isEmpty(l)||a.push(l),a},replaceGridChangesWithAddedRows:function(e,t){bizagi.util.isEmpty(e)||Object.keys(e).forEach((function(i){var r=i.match(/\[id=(\d+)\]/);if(r){var a=r[1],n=t[a];if(void 0!==t[a]){var o=i,s=i.replace(a,n);e[s]=e[o],delete e[o]}}}))},addButtonActions:function(e,t){var i=[];if(bizagi.util.isEmpty(t))return[];var r=e.isRetry&&t.retry_h_actions?t.retry_h_actions:t.h_actions;if(delete t.h_actions,delete t.retry_h_actions,!Array.isArray(r)||r.length<1)return[];var a=this.renderDataService.submitData({action:"SUBMITDATA",data:t,idPageCache:e.pageCacheId,prepare:!0});return a.tag="submitData",i.push(a),r.forEach((function(t){t&&(t.h_pageCacheId=e.pageCacheId,i.push(t))})),i},addTrySaveOrTryNextAction:function(e,t,i,r){if(!bizagi.util.isEmpty(t)){actionParams={action:t,idPageCache:e.pageCacheId,prepare:!0,transitions:""},r||(actionParams.data=i);var a=this.renderDataService.submitData(actionParams);return a.tag="performAction",a}return null},deleteOfflineCase:function(e,t,i){var r=this,a=e.offlineType;return"start"===a?(r.Class.setCurrentSyncStep(e.id,"deleteStartCase",{params:e}),r.database.deleteCase(e).then((function(t){return r.Class.addSyncStepResponse(e.id,"deleteStartCase",t),t}))):(r.Class.setCurrentSyncStep(e.id,"removeSyncStatus",{params:!1}),r.database.updateCaseSyncStatus({type:a,id:e.id,syncStatus:void 0,syncDetails:void 0}).then((function(t){return r.Class.addSyncStepResponse(e.id,"removeSyncStatus",t),r.Class.setCurrentSyncStep(e.id,"updateTaskIsEdited",{params:!1}),r.database.updateTaskIsEdited(e.id,!1)})).then((function(t){r.Class.addSyncStepResponse(e.id,"updateTaskIsEdited",t);var a=i?$.extend({deleteAttachments:!0},e):e;return r.Class.setCurrentSyncStep(e.id,"deleteTaskData",{deleteTaskDataParams:a}),r.database.deleteTaskData(a)})).then((function(n){if(r.Class.addSyncStepResponse(e.id,"deleteTaskData",n),"task"===a&&t&&i)return r.Class.setCurrentSyncStep(e.id,"deleteTaskForm",{params:e}),r.database.deleteTaskForm(e);r.Class.setCurrentSyncStep(e.id,"deleteTaskForm","--skipped--")})).then((function(n){return r.Class.addSyncStepResponse(e.id,"deleteTaskForm",n),"task"===a&&t&&i?(r.Class.setCurrentSyncStep(e.id,"deleteTaskIfNext",{params:e}),r.database.deleteTask(e)):(r.Class.setCurrentSyncStep(e.id,"deleteTaskIfNext","--skipped--"),n)})).then((function(t){return r.Class.addSyncStepResponse(e.id,"deleteTaskIfNext",t),t})).fail((function(t){var i={type:"error",errorType:"offlineSyncError",message:"Local case could not be deleted",details:t};return r.Class.addCurrentSyncStepResponse(e.id,i),$.Deferred().reject(i).promise()})))},convertStartFormDataToStandardFormat:function(e){var t={};return Object.keys(e).forEach((function(i){t[i]=e[i],void 0!==e[i].value&&(t[i]=e[i].value)})),t},getSyncAction:function(e,t){return"start"===e?"createnewcase":"save"===t.h_action?"trysave":"next"===t.h_action?"trynext":t.h_action},wasMultiActionPerformed:function(e){return e.length>0&&e[e.length-1].result&&"success"===e[e.length-1].result.type},createCheckpoint:function(e){return this.renderDataService.sendCheckpoint({idRender:e.formId,xpath:"",xpathContext:"",idPageCache:e.pageCacheId})},performCommit:function(e,t){return t?$.Deferred().resolve(null).promise():this.renderDataService.commitGridAction({idRender:e.formId,xpath:"",xpathContext:"",idPageCache:e.pageCacheId})},manageError:function(e,t,i,r){var a=this;return"checkpoint"!=i?(t=Array.isArray(t)?t.map((function(e){return a.renderDataService.parseServiceError(e)})):a.renderDataService.parseServiceError(r),a.performRollback(e,t)):a.updateSyncStatusError(r,e.offlineType,e.id)},performRollback:function(e,t,i){var r=this;return r.Class.setCurrentSyncStep(e.id,"rollback",{params:e,error:t,cleanTaskDataActions:i}),r.renderDataService.rollbackGridAction({idRender:e.formId,xpath:"",xpathContext:"",idPageCache:e.pageCacheId}).always((function(t){if(r.Class.addCurrentSyncStepResponse(e.id,t),i)return r.Class.setCurrentSyncStep(e.id,"cleanTaskDataActions",{id:e.id}),r.database.cleanTaskDataActions(e.id);r.Class.setCurrentSyncStep(e.id,"cleanTaskDataActions","--skipped--")})).then((function(t){if(r.Class.addSyncStepResponse(e.id,"cleanTaskDataActions",t),"start"!=e.offlineType)return r.Class.setCurrentSyncStep(e.id,"openOfflineTask",{id:e.id}),r.database.openOfflineTask(e.id);r.Class.setCurrentSyncStep(e.id,"openOfflineTask","--skipped--")})).then((function(i){return r.Class.addSyncStepResponse(e.id,"openOfflineTask",i),$.Deferred().reject(t).promise()}))},updateSyncStatusError:function(e,t,i){var r=this.renderDataService.parseServiceError(e)||{},a=this.buildSyncErrorObject(r);return this.database.updateCaseSyncStatus({type:t,id:i,syncStatus:"failed",syncDetails:a}).then((function(){return $.Deferred().reject(r).promise()}))},buildSyncErrorObject:function(e){var t="technical",i=[],r=e;if(Array.isArray(e))e.forEach((function(e){null!=e.result&&((e.result.type||"").toLowerCase().includes("message")&&(t="business",e.result.message&&i.push(e.result.message),Array.isArray(e.result.messages)&&(i=i.concat(e.result.messages))))}));else if(null!=e&&null!=e.result){(e.result.type||"").toLowerCase().includes("message")&&(t="business",e.result.message&&i.push(e.result.message),Array.isArray(e.result.messages)&&(i=i.concat(e.result.messages)))}else e.message&&i.push(e.message);return{type:t,message:1==i.length?i[0]:i,actionResponse:r,timestamp:Date.now()}}}),bizagi.grid=bizagi.grid||{},bizagi.grid.services=bizagi.grid.services||{},bizagi.grid.services.service=bizagi.grid.services.service||{},$.Class.extend("bizagi.grid.services.service",{},{init:function(e){this.renderDataService=e.renderDataService,this.database=e.database},uploadGridData:function(e,t){var i=this,r={bizAdditions:[],bizDeletions:[],bizImages:{},bizFiles:{}};return e.forEach((function(e){Array.prototype.push.apply(r.bizAdditions,i.processNewRecords(e,t)),Array.prototype.push.apply(r.bizDeletions,i.processDeletedRecords(e,t)),$.extend(r.bizImages,i.processImages(e)),$.extend(r.bizFiles,i.processFiles(e))})),r},processNewRecords:function(e,t){var i=[],r=e.value["new-records"];if(r)for(var a=Object.keys(r),n=0;n<a.length;n++){var o=r[a[n]];o.idPageCache=t;var s=this.renderDataService.addGridRecordData(o);s["offline-entityId"]=a[n],i.push({actionParams:s,creationTimestamp:o.creationTimestamp})}return i.sort((function(e,t){return e.creationTimestamp-t.creationTimestamp})).map((function(e){return e.actionParams}))},processImages:function(e){var t={};if(e.value["edited-images"])for(var i=Object.keys(e.value["edited-images"]),r=0;r<i.length;r++){var a=e.value["edited-images"][i[r]];t[i[r]]=a}return t},processFiles:function(e){var t={},i=e.value["offline-files"];if(i)for(var r=Object.keys(i),a=0;a<r.length;a++){var n=i[r[a]];t[r[a]]=n}return t},processDeletedRecords:function(e,t){var i=[],r=e.value["deleted-records"];if(r)for(var a=Object.keys(r),n=0;n<a.length;n++){var o=r[a[n]];o.idPageCache=t,i.push(this.renderDataService.deleteGridRecord(o))}return i}}),bizagi.form=bizagi.form||{},bizagi.form.services=bizagi.form.services||{},bizagi.form.services.service=bizagi.form.services.service||{},$.Class.extend("bizagi.form.services.service",{},{init:function(e){this.renderDataService=e.renderDataService,this.database=e.database,this.fileService=this.renderDataService.getFileService()},getServerTaskForm:function(e){var t,i,r,a=this;return e.downloadOfflineForm=!0,(e.bulkDownload?a.renderDataService.multiactionWithLimit():a.renderDataService).getFormData(e).then((function(t){return a.executeOfflineEntryPipelineAndReloadForm(t,e)})).then((function(n){return t=n.form,i=!0===n.hasEntryPipeline,r=!0===n.wasPipelineExecuted,a.getFileAttachmentsFromLocalTaskForm(e)})).then((function(i){if(t.errorType)return $.Deferred().reject(t).promise();e.deleteNextButton&&(t=a.database.deleteNextButton(t)),t.dataChangeset=e.dataChangeset,e.localFiles=i;var r=a.fileService.downloadFormFiles(t,e),n=r.promises,o=a.fileService.downloadFormImages(t,e),s=Array.prototype.push.apply(n,o);return e.bulkDownload&&s.length>0?$.when.apply($,s).then((function(){return a.mergeForm(t,r.data)})):a.mergeForm(t,r.data)})).then((function(e){return{form:e,hasEntryPipeline:i,wasPipelineExecuted:r}})).fail((function(){bizagi.util.console.error("Error downloading task form",e)}))},executeOfflineEntryPipeline:function(e){var t=e.form?e.form.properties:{};return this.hasFormEntryPipeline(e)?$.when(this.renderDataService.executePipeline({pipeline:t.loadExecution,idPageCache:e.form.pageCacheId})).then((function(){return{hasEntryPipeline:!0,wasPipelineExecuted:!0}}),(function(){return $.Deferred().resolve({hasEntryPipeline:!0,wasPipelineExecuted:!1}).promise()})):$.Deferred().resolve({hasEntryPipeline:!1,wasPipelineExecuted:!1}).promise()},executeOfflineEntryPipelineAndReloadForm:function(e,t){var i=this;return t.executeOfflineEntryPipeline?i.executeOfflineEntryPipeline(e).then((function(r){return hasEntryPipeline=r.hasEntryPipeline,wasPipelineExecuted=r.wasPipelineExecuted,hasEntryPipeline&&wasPipelineExecuted?i.renderDataService.getFormData(t).then((function(e){return{form:e,hasEntryPipeline:hasEntryPipeline,wasPipelineExecuted:wasPipelineExecuted}})):{form:e,hasEntryPipeline:hasEntryPipeline,wasPipelineExecuted:wasPipelineExecuted}})):{form:e,wasPipelineExecuted:!1}},getFileAttachmentsFromLocalTaskForm:function(e){return this.database.getFileAttachmentsFromLocalTaskForm(e).then((function(e){return e}),(function(){return{}}))},mergeForm:function(e,t){var i=this;return i.database.mergeDataDocument(t,e).then((function(r){var a={data:t};return a.data=r,a.isOpen=!0,i.database.mergeForm(a,e,{online:!0})}))},downloadOfflineStartForm:function(e){var t=this;return e.action="LOADSTARTFORM",e.downloadOfflineForm=!0,t.renderDataService.multiactionWithLimit().getFormData(e).then((function(i){return i.errorType?$.Deferred().reject(i).promise():i.form?(i.form.properties.isTaskForm=!1,(void 0===i.form.buttons||Array.isArray(i.form.buttons)&&i.form.buttons.length<2)&&(i.form.buttons=t.addFormDefaultButtons()),i.lastSynchronization=Date.now(),t.database.saveStartForm(e,i)):$.Deferred().reject(i).promise()}))},downloadOfflineTaskForm:function(e){var t,i,r=this;return e.deleteNextButton=!1,r.getServerTaskForm({idCase:e.idCase,idWorkitem:e.idWorkitem,executeOfflineEntryPipeline:!0===e.executeOfflineEntryPipeline,bulkDownload:e.bulkDownload}).then((function(a){var n=a.form;return t=a.hasEntryPipeline,i=a.wasPipelineExecuted,n.form.properties.isTaskForm=!0,(void 0===n.form.buttons||Array.isArray(n.form.buttons)&&0==n.form.buttons.length)&&(n.form.buttons=r.addFormDefaultButtons()),r.database.saveTaskForm(e,n)})).then((function(){if(!e.isSingleSync){var r=$.extend({},e);r.type="download-form-success",$(document).trigger("offline-notify-form-sync-event",r)}return{wasFormDownloaded:!0,hasEntryPipeline:t,wasPipelineExecuted:i}}))},addFormDefaultButtons:function(){return[{button:{properties:{actions:["submitData","refresh"],caption:"render-form-button-save",id:"ec0a5a02-0f81-44a7-8d64-ac090a01d61b"}}},{button:{properties:{actions:["validate","submitData","next","routing"],caption:"render-form-button-next",id:"ba81c7af-0d83-4139-879d-b040f0f81bd7"}}}]},verifyFormEntryPipeline:function(e){var t=this;return t.renderDataService.getFormData(e).then((function(e){return t.hasFormEntryPipeline(e)})).fail((function(e){return bizagi.util.console.error("verifyFormEntryPipeline => getFormData error",e),!1}))},hasFormEntryPipeline:function(e){var t=e.form?e.form.properties:{};return!0===bizagi.util.parseBoolean(t.hasEntryPipeline)&&!bizagi.util.isEmpty(t.loadExecution)}}),bizagi.render.services.service.extend("bizagi.render.services.service",{},{init:function(e){this._super(e),this.database=e.database},getFormData:function(e){var t=this;return!(e=e||{}).isOfflineForm||bizagi.util.isOfflineFormsV2Supported()?t._super(e):bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData?t.getFormDataFromNative(e).then((function(i){return t.database.mergeForm(i[1],i[0].data,{online:e.online})})):$.when(t.database.getCase(e.idCase)).then((function(i){var r=$.trim(i.idWfClass.toString());return t.database.mergeForm(i,t.database.getFormData(r),{online:e.online})}))},getFormDataFromNative:function(e){var t=new $.Deferred;return bizagiapp.getNativeFormData(e,(function(i){bizagiapp.getCase(e.idCase,(function(e){var r=[JSON.parse(i),JSON.parse(e)];t.resolve(r)}),(function(e){t.reject(e)}))}),(function(e){t.reject(e)})),t.promise()},submitData:function(e){if(!(e=e||{}).isOfflineForm||bizagi.util.isOfflineFormsV2Supported())return this._super(e);var t=this.resolveData(e.data||{},e.xpathContext);return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action,bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData?this.saveNativeFormInfo(e,t):this.database.saveFormInfo(e,t)},saveNativeFormInfo:function(e,t){var i=this,r=new $.Deferred;return i.getFormDataFromNative(e).then((function(a){return i.database.nativeSaveFormInfo(t,a[1],a[0].data).done((function(t){bizagiapp.saveFormData(e,t),r.resolve(t)}))})),r.promise()}}),$.Class.extend("bizagi.render.services.multiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(e,t,i){this.service=e,this.serviceLocator=e.serviceLocator,this.batch={},this.batchTimer=50,this.maxNumberOfActions=t||0,this.queue=i||null,this.deferredBatchExecuting=$.Deferred(),this.deferredBatchExecuting.resolve(),this.disabledRequests=!1,this.circularDependencies=new bizagi.circularDependencies,this.replicateServiceMethods()},getService:function(){return this.service},replicateServiceMethods:function replicateServiceMethods(){var self=this;for(var key in this.service.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"multiaction"!=key&&(self[key]=eval("var tmp = function(){ return this.proxyMethod(this.getService()."+key+", arguments);};tmp"))},proxyMethod:function(e,t){var i=this.service;if(!t||1!=t.length)return e.apply(i,t);if("object"!=_typeof(t[0]))return e.apply(i,t);var r=t[0];if(1==r.prepare)return e.apply(i,t);var a=r.prepare;r.prepare=!0;var n=e.apply(i,t);return void 0===a||null==a?delete r.prepare:r.prepare=a,this.add(n)},makeCircularDependenciesError:function(e){var t=bizagi.localization.getResource("render-actions-loop-validation");return printf(t,e.dependencyFrom,e.dependencyTo)},add:function(e){var t=this,i=new $.Deferred,r=e.h_action||"unnamed";["PROCESSPROPERTYVALUE","LOADTEMPLATE","ADDRELATIONWITHDATA","GETFILE"].indexOf(r)<0&&bizagi.override.detectCircularDependencies&&t.circularDependencies.addNode(r,e),clearTimeout(t.batchTimeout);var a=e.tag=Math.guid(),n={action:e,deferred:i};t.batch[a]=n;var o=function(){var e=t.circularDependencies.resolve();if(e.error){for(var i in t.batch){var r=e.error.multiactionError;t.batch[i].deferred.reject(r)}t.batch={}}else t.disabledRequests||(t.deferredBatchExecuting=t.fire())};return t.batchTimeout=setTimeout(o,t.batchTimer),0!=t.maxNumberOfActions&&Object.keys(t.batch).length>=t.maxNumberOfActions&&(clearTimeout(t.batchTimeout),o()),i.promise()},fire:function(){var e={},t=[];return $.each(this.batch,(function(i,r){t.push(r.action),e[i]=r})),this.batch={},$.when(this.execute({actions:t,rejectDeferreds:!1})).done((function(t){$.each(t,(function(t,i){var r=i.tag;i.error?e[r].deferred.reject(i.error,i,i.error.message):e[r].deferred.resolve(i.result),delete e[r]})),$.each(e,(function(e,t){t.deferred.reject({type:"not-processed",message:"Operation didn't executed"},"","Operation didn't executed")}))})).fail((function(t,i,r){var a=void 0!==r?r.message:r||"Operation didn't executed";$.each(e,(function(e,t){t.deferred.reject({type:"not-processed",message:a},"","Operation didn't executed")}))}))},execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,(function(e,i){i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=i.tag||e,delete i.tag})),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action",r);var n=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction"),data:r,queue:this.queue,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){e.renderingService=!0,bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done((function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void n.reject(t.error,"servererror",t)}n.resolve(e)})).fail((function(e){var t=e.responseText||e,i={};try{i=JSON.parse(t)}catch(e){}n.reject(e,"servererror",i)})),n.promise()},disableRequests:function(){this.disabledRequests=!0},validateIfBatchIsExecuting:function(){return this.deferredBatchExecuting}}),bizagi.render.services.multiactionservice.extend("bizagi.render.services.metadatamultiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"h_pageCacheId"},{execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,(function(e,i){i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=i.tag||e,i[t.Class.BA_PAGE_CACHE]&&(r[t.Class.BA_PAGE_CACHE]=i[t.Class.BA_PAGE_CACHE]),delete i[t.Class.BA_PAGE_CACHE],delete i.tag})),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action metadata",r);var n=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction-metadata"),data:r,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done((function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void n.reject(this,"servererror",t)}n.resolve(e)})).fail((function(e){var t,i=e.responseText||e;try{t=JSON.parse(i)}catch(e){}n.reject(e,"servererror",t)})),n.promise()}}),$.Class.extend("bizagi.command.controllers.controller",{THROW_ERROR:!0},{init:function(e){this.form=e,this.dateFormat=e.getResource("dateFormat")},buildConditions:function(e,t,i,r){var a=e.expressions&&e.expressions.length>1?this.buildConditionOperator(e.operator):e.operator;if(r=r||[],t=t||!1,i=i||!1,"true"==a)return"true";if("false"==a)return"false";for(var n="",o=0;o<e.expressions.length;o++){var s=e.expressions[o];if(s.simple){var l=this.searchGridReferenceInCondition(s.simple);n+=this.buildSimpleCondition(s.simple,l,i,r)}else s.complex&&(n+="("+this.buildConditions(s.complex,t,i,r)+") ");n+=o<e.expressions.length-1?a:""}return n},buildConditionOperator:function(e){return"and"==e?" && ":"or"==e?" || ":e},buildSimpleCondition:function(e,t,i,r){var a,n,o="",s=e.operator,l="",d="";t=t||!1,i=i||!1;var c=e.xpath&&e.renderId?e.xpath+"."+e.renderId:e.xpath||e.renderId||e.containerId;if(t&&e.containerId){var u=this.processGridXpath(e.xpath);c=u.gridXpath+"."+e.containerId+"[]."+u.remainingXpath+"."+e.renderId}r.includes(c)||r.push(c);var p=this.detectConditionArgumentType(c,e.argumentType);if(a=this.buildXpath(c,p,t),"boolean"!=p&&(l+="!bizagi.util.isEmpty("+a+") && "),i&&c&&c.length>0&&!{boolean:""}.hasOwnProperty(p)&&(d="self.isVisible('"+c+"') && self.isEditable('"+c+"') && "),bizagi.util.isEmpty(e.argument)?""===e.argument&&(o='""'):(o=this.buildArgument(e.argument,p,t),"xpath"==p&&(l+="!bizagi.util.isEmpty("+o+") && ")),"includes"==s)return d+l+"self.includes("+a+","+o+") ";if("changes"==s)return bizagi.override&&!bizagi.override.enableActionIsChangedSupport?"self.isChanged("+a+", params.changed)":t?"self.isGridColumnChanged("+a+", params,'"+c+"')":"self.isControlChanged("+a+", params,'"+c+"')";if("equals"==s)return d+l+a+" == "+o;if("not-equals"==s)return d+a+" != "+o;if("less-than"==s)return d+l+a+" < "+o;if("less-equals-than"==s)return d+l+a+" <= "+o;if("greater-than"==s)return d+l+a+" > "+o;if("greater-equals-than"==s)return d+l+a+" >= "+o;if("like"==s)return d+l+a+".toString().indexOf("+o+") >= 0 ";if("is-empty"==s)return"entity"!=p?d+"bizagi.util.isEmpty("+a+")":d+"("+a+" == 0 || bizagi.util.isEmpty("+a+"))";if("is-not-empty"==s)return"entity"!=p?d+"!bizagi.util.isEmpty("+a+")":d+"("+a+" != 0 && !bizagi.util.isEmpty("+a+"))";if("is-true"==s)return d+"( "+a+" == true || "+a+" == 'true' )";if("is-false"==s)return d+"( "+a+" == false || "+a+" == 'false' || "+a+" == 'False' )";if("does-not-contain"==s)return d+"(bizagi.util.isEmpty("+a+") || "+a+".toString().indexOf("+o+") < 0 )";if("contains"==s)return d+l+a+".toString().indexOf("+o+") >= 0 ";if("begins-with"==s)return d+l+a+".toString().startsWith("+o+") == true ";if("does-not-begins-with"==s)return d+l+a+".toString().startsWith("+o+") == false ";if("file-uploaded"==s)return n=c,t&&n&&(n=n.replaceAll("[]","[' + i + ']")),d+"self.isFileUploaded('"+n+"') ";if("file-not-uploaded"==s)return n=c,t&&n&&(n=n.replaceAll("[]","[' + i + ']")),d+"!self.isFileUploaded('"+n+"') ";if("is-invalid-email"==s)return d+"!self.isValidEmail("+a+") ";if("letter-edited"==s)return"false";if("letter-not-edited"==s)return"false";if("cell-change"==s)return"column == "+o;if("on-press"==s)return t?"self.isGridButtonPressed("+this.buildXpath(c,"id",t)+", params.pressed)":"self.isButtonPressed('"+c+"', params.pressed)";if("on-load"==s)return"true";if("on-deleted-row"==s)return"self.onDeletedGridRow('"+(n=c||"")+"', params.rowDeleted)";throw new"There is no implementation for operator code "+s},detectConditionArgumentType:function(e,t){if(void 0===t||"const"==t){var i=this.form,r=i.getRender(e)||i.getRenderById(e);if(null==r){if(bizagi.override&&bizagi.override.breakActionWithUnavailableRenders)throw new Error("RenderNotFoundException in method detectConditionArgumentType of bizagi.command.controllers.controller");return"text"}if("grid"==r.properties.type){var a=this.processGridXpath(e);if(""===a.remainingXpath)return"xpath";if(null==(r=r.getColumn(a.remainingXpath)))throw new Error("RenderNotFoundException in method detectConditionArgumentType of bizagi.command.controllers.controller")}var n=r.properties.dataType,o=bizagi.util.normalizeType(r.properties.type);return this.isRelatedEntityRender(o)?"entity":1==n||2==n||3==n||4==n||6==n||7==n||10==n||11==n?"number":8==n?"money":12==n||13==n?1==r.properties.showTime?"datetime":"date":5==n?"boolean":"button"==o?"button":"form"===o||/queryForm/i.test(o)?"form":"text"}return"xpath"==t||"function"==t||"entity"==t?t:"text"},isRelatedEntityRender:function(e){return["combo","list","radio","search","searchCombo","columnCombo","columnSearch","queryMultiSelect"].includes(e)||/^cascadingcombo$/i.test(e)},buildXpath:function(e,t,i){return(i=i||!1)&&(e=e.replaceAll("[]","[' + i + ']")),"xpath"!=t||i?"id"==t?"'"+e+"'":"function"==t?"self.evalXpath('"+e+"', '"+this.detectConditionArgumentType(e,"const")+"')":i?"self.evalGridXpath(params, '"+e+"', '"+t+"')":"self.evalXpath('"+e+"', '"+t+"')":"self.evalXpath('"+e+"', '"+this.detectConditionArgumentType(e,"const")+"')"},buildArgument:function buildArgument(argument,argumentType,bGridDetected,xpathContext){var self=this,number;if(bGridDetected=bGridDetected||!1,"text"==argumentType)return argument=null==argument?"":argument,argument="string"!=typeof argument?argument.toString():argument,-1!=argument.indexOf("'")&&(argument=argument.replaceAll("'","\\'")),-1!=argument.indexOf("\n")&&(argument=argument.replaceAll("\n","")),"'"+argument.toString()+"'";if("boolean"==argumentType)return"string"==typeof argument?"Default"==argument?argument:1==eval(argument.toLowerCase())?"true":"false":1==eval(argument)?"true":"false";if("number"==argumentType)return number=new Number(argument),NaN==number?"-99999999":number.toString();if("money"==argumentType)return number=new Number(argument),NaN==number?"-99999999":number.toString();if("date"==argumentType){var date=bizagi.util.dateFormatter.getDateFromInvariant(argument);return date&&0!=date||(date=new Date(0)),date.setHours(0,0,0,0),"bizagi.util.dateFormatter.getDateFromInvariant('"+bizagi.util.dateFormatter.formatInvariant(date)+"').setHours(0,0,0,0)"}if("datetime"==argumentType){var date=bizagi.util.dateFormatter.getDateFromInvariant(argument,!0);return date&&0!=date||(date=new Date(0)),date.setMilliseconds(0),"bizagi.util.dateFormatter.getDateFromInvariant('"+bizagi.util.dateFormatter.formatInvariant(date,!0)+"', true).getTime()"}if("color"==argumentType)return"'"+argument.toString()+"'";if("entity"==argumentType){if(bizagi.util.isEmpty(argument))return null;try{argument="object"!=_typeof(argument)?JSON.parse(argument):argument}catch(e){argument=argument||{}}if(argument&&argument.id)result=argument.id;else if(argument&&Array.isArray(argument.value))var result=argument.value.map((function(e){return e.id}));else result=argument.id||argument;return JSON.stringify(result)}if("xpath"==argumentType){var xpath=argument.toString();return bGridDetected=self.searchGridReferenceInXpath(xpath),bGridDetected&&(xpath=xpath.replaceAll("[]","[' + i + ']")),xpathContext&&(xpath=xpathContext+"."+xpath),self.buildXpath(xpath,argumentType,bGridDetected)}if("json"==argumentType)return JSON.encode(argument);if("function"==argumentType){if("BAToday"==argument)return"self.getCurrentDate()";if("BANow"==argument)return"self.getCurrentDate(true)";throw"There is no implementation for function "+argument}if(null==argumentType)return null;throw"There is no implementation for argument type "+argumentType},isEditable:function(e){var t=this.getRender(e);if(null!=t)return t.properties.editable;this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},isVisible:function(e){var t=this.getRender(e);if(null!=t){if(t.properties.visible)return this.isParentVisible(t.parent);var i=bizagi.util.normalizeType(t.properties.type);return!!/^hidden$/i.test(i)}this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},isParentVisible:function(e){return e.parent?!!e.properties.visible&&this.isParentVisible(e.parent):e.properties.visible},evalGridXpath:function evalGridXpath(params,xpath,argumentType){var self=this;if(void 0===params)return this.evalXpath(xpath,argumentType);var grid=params.grid;if(null==grid)return self.Class.THROW_ERROR&&self.showRenderNotFoundError(xpath),null;var gridXpath=self.processGridXpath(xpath),gridColumn=grid.getColumn(gridXpath.remainingXpath);if(!gridColumn)return!1;var cellValue=grid.getCellCurrentValue(gridXpath.index,gridXpath.remainingXpath);return"columnRadio"==gridColumn.properties.type&&(cellValue&&!bizagi.util.isString(cellValue)?cellValue=cellValue.length>0&&cellValue[0].length>0?cellValue[0][0]:cellValue.id:bizagi.util.isString(cellValue)||(cellValue=0)),"columnCombo"==gridColumn.properties.type&&(cellValue=cellValue&&cellValue.id?cellValue.id:0),"columnSearch"==gridColumn.properties.type&&(cellValue=cellValue&&cellValue.id?cellValue.id:0),"columnDate"==gridColumn.properties.type&&cellValue&&(cellValue=gridColumn.properties.showTime?bizagi.util.dateFormatter.getDateFromInvariant(cellValue):bizagi.util.dateFormatter.getDateFromInvariant(cellValue).setHours(0,0,0,0)),bizagi.util.isEmpty(cellValue)&&"boolean"==argumentType?"check"!=gridColumn.properties.display&&null:"boolean"==argumentType?eval(self.buildArgument(cellValue,argumentType)):cellValue},evalXpath:function evalXpath(xpath,argumentType){var self=this,i,renderToEval,renders=self.getRenders(xpath);if(null==renders)return self.Class.THROW_ERROR&&self.showRenderNotFoundError(xpath),null;var rendersToEval=[];for($.each(renders,(function(e,t){t.properties.editable&&rendersToEval.push(t)})),0===rendersToEval.length&&$.each(renders,(function(e,t){rendersToEval.push(t)})),i=0;i<rendersToEval.length;){renderToEval=rendersToEval[i++];var bIsGrid="grid"==renderToEval.properties.type;if(bIsGrid){var gridXpath=self.processGridXpath(xpath),gridColumn=renderToEval.getColumn(gridXpath.remainingXpath);if(!gridColumn)continue;var cellValue=renderToEval.getCellCurrentValue(gridXpath.index,gridXpath.remainingXpath);return"columnRadio"==gridColumn.properties.type&&(cellValue&&!bizagi.util.isString(cellValue)?cellValue=cellValue.length>0&&cellValue[0].length>0?cellValue[0][0]:cellValue.id:bizagi.util.isString(cellValue)||(cellValue=0)),"columnCombo"!=gridColumn.properties.type&&"columnSearch"!=gridColumn.properties.type&&"columnList"!=gridColumn.properties.type||(cellValue&&cellValue.id?cellValue=cellValue.id:"number"!=typeof cellValue&&"string"!=typeof cellValue&&(cellValue=0)),bizagi.util.isEmpty(cellValue)&&"boolean"==argumentType?"check"!=gridColumn.properties.display&&null:"boolean"==argumentType||"date"==argumentType&&!bizagi.util.isEmpty(cellValue)?eval(self.buildArgument(cellValue,argumentType)):(void 0!==gridColumn&&void 0!==gridColumn.properties&&void 0!==gridColumn.properties.type&&"columnDate"==gridColumn.properties.type&&(cellValue=self.getColumnDateCorrectFunction(cellValue,gridColumn.properties.showTime)(cellValue)),cellValue)}var value=renderToEval.getValue(),renderType=bizagi.util.normalizeType(renderToEval.properties.type||"");return void 0===argumentType||"undefined"===argumentType?value:((["combo","list","search","radio"].includes(renderType)||/^cascadingcombo$/i.test(renderType))&&(bizagi.util.isEmpty(value)||""==value.id)&&(value=0),/^queryMultiSelect$/i.test(renderType)?renderToEval&&renderToEval.mapValue(value):"comboSelected"===renderType?"string"==typeof value?JSON.parse(value).value:value:bizagi.util.isEmpty(value)?("boolean"!==renderType||"check"!==renderToEval.properties.display)&&value:"xpath"===argumentType?eval(self.buildArgument(xpath,argumentType)):eval(self.buildArgument(value,argumentType)))}},isFileUploaded:function(e){var t=this.evalXpath(e);return!!(t&&t.length&&t.length>0)},isValidEmail:function(e){return!(!e||!e.match(new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/gi)))},isButtonPressed:function(e,t){var i=this.getRenderById(e);return!(null==i||!/^button$/i.test(bizagi.util.normalizeType(i.properties.type)))&&t},isGridButtonPressed:function(e,t){var i=this.processGridXpath(e),r=i.gridXpath,a=this.getRender(r),n=i.remainingXpath||"";return t&&a&&a.columns&&$.each(a.columns,(function(e,i){i.properties.xpath!==n&&i.properties.id!==n||"columnButton"!==i.properties.type||(t=!0)})),t},isChanged:function(e,t){return null!=e&&t},isControlChanged:function(e,t,i){if(null==e)return!1;if(t.changed){var r=this.getRender(i),a=t.render;return null!=r&&null!=a&&(a.properties.id===r.properties.id&&a.properties.xpath===r.properties.xpath)}return!1},isGridColumnChanged:function(e,t,i){if(null==e)return!1;if(t.changed){var r=this.processGridXpath(i),a=r.gridXpath,n=this.getRender(a);if(null==n)return!1;var o=r.remainingXpath||"",s=t.id?t.render.getColumnById(t.id):t.render.getColumn(t.column),l=n.getColumn(o);return!(!l||!s)&&(l.properties.xpath===s.properties.xpath&&l.properties.id===s.properties.id)}},includes:function(e,t){return null!=e&&(null!=t&&$.grep(e,(function(e){return e.id==t})).length>0)},onDeletedGridRow:function(e,t){return!(!(this.getRender(e)||{})||!t)},getRenders:function(e){var t=this.form,i=null,r=/id=([\w-]+)/gi.exec(e);if(r&&r.length>1){var a=this.getRenderById(r[1]);return a?0==a.length?null:((i=[]).push(a),i):null}return 0==(i=t.getRenders(e)).length?null:i},getRender:function(e){return this.form.getRender(e)},getRenderById:function(e){return this.form.getRenderById(e)},showRenderNotFoundError:function(e){bizagi.debug("Cannot find render in DOM: "+e)},showContainerNotFoundError:function(e){bizagi.debug("Cannot find container in DOM: "+e)},getCurrentDate:function(e){var t=new Date,i=bizagi.util.dateFormatter.getDateFromInvariant(bizagi.util.dateFormatter.formatInvariant(t));return e||!i||isNaN(Date.parse(i))||$.isNumeric(i)||i.setHours(0,0,0,0),i.getTime()},processGridXpath:function(e){var t,i,r,a=new RegExp(/([\w\.-]*)\[(\d*)\]\.([\w\.|\w-\.]*)/g).exec(e);return a?(r=a[1],t=a[2],i=a[3]):(t="",i=""),{xpath:e,index:t,remainingXpath:i,gridXpath:r}},searchForGridReference:function(e,t){var i;if(e)return this.searchGridReferenceInCondition(e);if(t)for(i in t){var r=t[i];return this.searchForGridReferenceInCommand(r)}return null},searchForGridReferenceInCommand:function(e){return e.xpath&&e.xpath.indexOf("[]")>0?e.xpath.substring(0,e.xpath.indexOf("[]")):e.renderId&&e.renderId.indexOf("[]")>0?e.renderId.substring(0,e.renderId.indexOf("[]")):"xpath"==e.argumentType&&e.argument.indexOf("[]")>0?e.argument.substring(0,e.argument.indexOf("[]")):void 0},searchGridReferenceInCondition:function(e){var t;if("string"==typeof e||"boolean"==typeof e)return null;if(e.expressions){for(i in e.expressions)if(e.expressions.hasOwnProperty(i)&&(t=this.searchGridReferenceInCondition(e.expressions[i])))return t}else{if(e.simple)return this.searchGridReferenceInCondition(e.simple);if(e.complex)return this.searchGridReferenceInCondition(e.complex);if(e.xpath||e.renderId){if(t=this.searchGridReferenceInXpath(e.xpath)||this.searchGridReferenceInXpath(e.renderId))return t;if("xpath"==e.argumentType&&(t=this.searchGridReferenceInXpath(e.argument)))return t}}return null},searchGridReferenceInXpath:function(e){return e&&e.indexOf("[]")>0?e.substring(0,e.indexOf("[]")):null},getGridControl:function(e,t){var i=this.processGridXpath(e).remainingXpath;return this.getRender(e).getControlCell(t,i)},getColumnDateCorrectFunction:function(e,t){return e?e&&t?this.getColumnDateValueDateAndTime:e&&!t?this.getColumnDateValueOnlyDate:e:this.getColumnDateValueForNoValue},getColumnDateValueForNoValue:function(e){return bizagi.util.dateFormatter.getDateFromInvariant(e)},getColumnDateValueOnlyDate:function(e){return bizagi.util.dateFormatter.getDateFromInvariant(e).setHours(0,0,0,0)},getColumnDateValueDateAndTime:function(e){return bizagi.util.dateFormatter.getDateFromInvariant(e,!0).getTime()}}),bizagi.command.controllers.controller.extend("bizagi.command.controllers.validation",{},{init:function(e,t,i){this.enableDebug=!1,this._super(e),this.initializeValidations(i,t)},initializeValidations:function(e,t){var i=this,r=$("<div />").appendTo(e);$.widget("ui.bizagi_notifications",$.ui.bizagi_notifications,{expand:function(){this._super(),i.form.triggerGlobalHandler("modalViewDidAppear",{})},collapse:function(){this._super(),i.form.triggerGlobalHandler("modalViewDidDisappear",{})},hide:function(){this._super(),i.form.triggerGlobalHandler("modalViewDidDisappear",{})}}),r.bizagi_notifications({itemIcon:"ui-icon-circle-close",minimized:!1,clearEnabled:!1,title:bizagi.localization.getResource("render-form-validations-header-text"),device:bizagi.util.detectDevice(),orientation:i.form.properties.orientation}),r.bind("itemClick",(function(e,t){i.onNotificationClick(t.data)})),t&&i.buildValidations(t),i.validationBox=r,i.validations=t||[]},buildValidations:function(e){var t=this,i=t.buildAllValidations(e);t.form.bind("rendervalidate",(function(){return i(t)}))},showErrorMessage:function(e){bizagi.showErrorAlertDialog=!1,this.showValidationMessage(e,null,"ui-icon-circle-close","ui-state-error")},showAlertMessage:function(e){this.showValidationMessage(e,null,"ui-icon-alert","ui-state-highlight")},showInfoMessage:function(e){this.showValidationMessage(e,null,"ui-icon-info","ui-state-highlight")},showValidationMessage:function(e,t,i,r,a,n){var o=this,s=o.form,l=null;l=n?s.getRenderById(n)||null:t?s.getRender(t):null,bizagi.showErrorAlertDialog=!1;var d=function(){o.clearValidationMessages();var e=s?s.getLastActionButton():{};e&&"nextWithoutValidations"===e.action||(o.validating=!0,o.performValidations(),o.validating=!1),0==o.countValidationMessages()?(o.hideValidationMessages(),o.form.triggerGlobalHandler("modalViewDidDisappear",{})):o.form.triggerGlobalHandler("modalViewDidAppear",{})};o.form.triggerGlobalHandler("modalViewDidAppear",{}),o.validationBox.bizagi_notifications("addNotification",e,t,i,r,d,a,n),l&&(l.setValidationMessage(e),bizagi.util.isIE8()||o.validating||l.bind("rendervalidate",(function(){d(),"double"!=l.properties.retype&&l.unbind("rendervalidate")})))},countValidationMessages:function(){return this.validationBox.bizagi_notifications("count")},clearValidationMessages:function(e){return $(".ui-bizagi-notifications-container","body").not(".ui-bizagi-log-container").bizagi_notifications("clearAll",void 0,e)},hideValidationMessages:function(){return this.validationBox.bizagi_notifications("hide")},showValidationMessages:function(){return this.validationBox.bizagi_notifications("show")},expandNotificationBox:function(e){return!1!==e&&this.validationBox.bizagi_notifications("autoFocusFirstError"),this.validationBox.bizagi_notifications("expand")},isExpandedNotificationBox:function(){return this.validationBox.bizagi_notifications("isExpanded")&&this.validationBox.bizagi_notifications("isContentVisible")},performValidations:function(e){this.clearValidationMessages(),this.validationBox.bizagi_notifications("initBatch");var t=this.validateRenders(e),i=!(this.validations.length>0)||this.form.triggerHandler("rendervalidate");return this.validationBox.bizagi_notifications("endBatch"),!(!i||!t)||(this.validationBox.bizagi_notifications("show"),!1)},buildAllValidations:function(e){for(var t="",i=0;i<e.length;i++){if(null==e[i].enabled||e[i].enabled)try{t+=this.buildValidation(e[i].conditions,e[i].validationCommand)}catch(t){"RenderNotFoundException"!=t.message&&bizagi.logError("Validation cannot be parsed: "+t.message,e[i])}}var r="var baTmpFn = function(self, params){\r\n var bValid = true;\r\n "+t+"\r\n return bValid;}; baTmpFn";return this.evalValidation(r)},buildValidation:function(e,t){var i="",r="",a=this.searchForGridReference(e),n=null!=a,o=void 0===bizagi.override.validateEditabilityOnValidations||bizagi.override.validateEditabilityOnValidations;i+="( "+this.buildConditions(e,n,o)+" )",t.message=t.message.replace(/'/g,"\\'"),t.message=t.message.replace(/\n/g," ");var s=t.focus||"";if(n&&(s=a),t.tokens?r+="self.showValidationMessage(' "+t.message+"', '"+s+"', JSON.parse('"+JSON.encode(t.tokens)+"')); bValid = false;\r\n":r+="self.showValidationMessage(' "+t.message+"', '"+s+"'); bValid = false;\r\n",n){var l="var grid = self.form.getRender('"+a+"');\r\n";return l+="if(grid === null) return true;\r\n",l+="var data = grid.getIndexes();\r\n",l+="var bGridValid = true;\r\n",l+="$.each(data, function(_, i) {\r\n",l+="if ("+i+"){\r\n bGridValid = false; \r\n}",l+="});\r\n",l+="if (bGridValid == false){\r\n "+r+"\r\n}"}return"if ("+i+"){\r\n "+r+" \r\n}"},onNotificationClick:function(e){var t=this.form,i=e.focus,r=e.id;if(i){var a=r?t.getRenderById(r):t.getRender(i);a&&a.focus()}},validateRenders:function(e){var t=this;e=e||[];var i=t.form.isValid(e);return i||e.forEach((function(e){e.id?t.showValidationMessageById(e.message,e.xpath,e.id):(e.message||e.xpath)&&t.showValidationMessage(e.message,e.xpath)})),i},evalValidation:function evalValidation(command){var self=this;return self.enableDebug&&null!=console&&console.log(command),eval(command)},showValidationMessageById:function(e,t,i){this.showValidationMessage(e,t,void 0,!1,void 0,i)}}),bizagi.command.controllers.controller.extend("bizagi.command.controllers.action",{overridesInitiated:!1},{init:function(e,t){this.configureOverrides(),this._super(e),this.globalDependencies={},this.initialCallFunctions={},this.funtionsToExecuteARefreshCommand=[],this.initialCallFunctionsDeferred=new $.Deferred,t&&this.buildActions(t),this.actions=t,this.internalSubmitActions={},this.initialCallTimeout=25,this.initialCallIncrements=25,this.actionsHistory={},this.period=50},processInternalSubmitAction:function(e,t){this.internalSubmitActions[e]||(this.internalSubmitActions[e]=t,this.buildAction(t,!0))},isSummaryOrGlobalForm:function(){var e=!1;return"SummaryForm"!==this.form.properties.typeForm&&"GlobalForm"!==this.form.properties.typeForm||(e=!0),e},evalClientAction:function(e){for(var t,i=0,r=!1,a=[].concat(e.commands,e.elseCommands),n=a.length;i<n;i++)if(t=a[i],!this.isClientAction(t)){r=!0;break}r&&(e.enabled=!1)},buildActions:function(e,t){var i,r,a={};this.funtionsToExecuteARefreshCommand=[];var n=this.isSummaryOrGlobalForm();for(i=0,r=e.length;i<r;i++)try{var o=e[i],s=bizagi.util.md5(JSON.stringify(o.conditions)),l=bizagi.util.md5(JSON.stringify(o.commands));a[s]?-1===a[s].indexOf(l)&&(n&&this.evalClientAction(o),this.buildAction(o,t),a[s].push(l)):(n&&this.evalClientAction(o),this.buildAction(o,t),a[s]=[l])}catch(t){"RenderNotFoundException"!==t.message&&bizagi.logError("Action cannot be parsed: "+t.message,e[i])}},unbindActions:function(){$.each(this.globalDependencies,(function(e,t){t.unbind("renderchange.action")})),this.globalDependencies={},$.each(this.initialCallFunctions,(function(e,t){clearTimeout(t)})),this.initialCallFunctions={}},refreshActions:function(e){var t=this;t.initialCallTimeout=25,t.initialCallFunctions={},e=e||[],t.actions=t.actions.concat(e),t.buildActions(t.actions,!0),$.each(t.internalSubmitActions,(function(e,i){try{t.buildAction(i,!1)}catch(e){"RenderNotFoundException"!==e.message&&bizagi.logError("Action cannot be parsed: "+e.message,i)}}))},buildAction:function(e,t){var i=this,r=i.form,a=[],n=[],o=[];if(e.commands=e.commands||[],e.elseCommands=e.elseCommands||[],null==e.enabled||e.enabled){e.conditions&&"true"==e.conditions.operator&&$.each(e.commands,(function(e,t){var r=i.searchGridReferenceInXpath(t.xpath);r&&(o.includes(r)||o.push(r))}));var s=i.buildFunction(e.conditions,e.commands,e.elseCommands,o);if(o)for(var l=0;l<o.length;l++)if(void 0!==o[l]){var d=r.getRenders(o[l]);if(0===d.length){var c=r.getRenderById(o[l]);d=c?[c]:null}d&&($.each(d,(function(e,t){$.inArray(t.properties.id,n)<0&&t.properties.editable&&h(t)})),0===a.length&&h(d[0]))}var u=function(t){this.commandDependencies=e.commands.concat(e.elseCommands).map((function(e){return e.xpath||e.container||e.renderId})),this.commandNames=e.commands.concat(e.elseCommands).map((function(e){return e.command})),this.fn=t};u.prototype={hasDependency:function(e){return null!=e&&this.commandDependencies.indexOf(e)>=0},hasRefreshCommand:function(){return this.commandNames.indexOf("refresh")>=0},execute:function(e){return s(i,e)}},i.funtionsToExecuteARefreshCommand=i.funtionsToExecuteARefreshCommand||[];var p=new u(s);if(p.hasRefreshCommand()||i.funtionsToExecuteARefreshCommand.push(p),$.each(a,(function(r,a){a.bind("renderchange.action",(function(t,r){if((r=r||{}).changed=void 0===r.changed||r.changed,r.column){for(var a=0;a<e.gridColumns.length;a++)if(r.column==e.gridColumns[a])return void s(i,r)}else s(i,r)})),i.globalDependencies[a.properties.id]=a,"grid"===a.properties.type&&(t=!0,e.gridColumns=[],i.searchGridColumns(e.conditions,e.gridColumns))})),!t){!function(e){var t=Math.guid(),i=setTimeout((function(){try{s(e),delete e.initialCallFunctions[t]}catch(e){}finally{clearTimeout(i)}}),e.initialCallTimeout);e.initialCallFunctions[t]=i,e.initialCallTimeout+=e.initialCallIncrements}(i)}}function h(e){(function(e){return-1===["groupedgrid","collectionnavigator"].indexOf(e)})(e.properties.type)&&(n.push(e.properties.id),a.push(e))}},tryToExecuteFunction:function(e){if(bizagi.override&&!0===bizagi.override.enableExecuteRefreshAction)for(var t=0;t<this.funtionsToExecuteARefreshCommand.length;t++){var i=this.funtionsToExecuteARefreshCommand[t];i.hasDependency(e)&&i.execute()}},buildFunction:function buildFunction(conditions,commands,elseCommands,innerDependencies){var self=this,gridReference=self.searchForGridReference(conditions,commands),bGridDetected=null!=gridReference&&gridReference,sJsCondition="",sJsAction="",sStatement,sJsElseAction="",bAutomaticRestore=!elseCommands,bCondition=!!conditions,i;for(bCondition&&(sJsCondition+=self.buildConditions(conditions,bGridDetected,!1,innerDependencies)),i=0;i<commands.length;i++){var queueAction=self.isServerCommand(commands[i])?"addParallel":"add",command=self.buildCommand(commands[i],bGridDetected);command=command.indexOf(";")>=1?command.replace(";",""):command,sJsAction+="actionQueue."+queueAction+"(function(){return "+command+" ;}); \r\n",bAutomaticRestore&&(sJsElseAction+=self.buildRestoreCommand(commands[i],bGridDetected))}if(!bAutomaticRestore){for(sJsElseAction+="var actionQueue = new bizagiQueue(); \r\n",sJsElseAction+="if (params.render){params.render.startActionExecution();} \r\n",i=0;i<elseCommands.length;i++){var queueAction=self.isServerCommand(elseCommands[i])?"addParallel":"add",elseCommand=self.buildCommand(elseCommands[i],bGridDetected);elseCommand=elseCommand.indexOf(";")>=1?elseCommand.replace(";",""):elseCommand,sJsElseAction+="actionQueue."+queueAction+"(function(){return "+elseCommand+" ;}); \r\n"}sJsElseAction+="var execute = actionQueue.execute().always(function(){ \r\n",sJsElseAction+="if (params.render){ params.render.endActionExecution();} \r\n });\r\n",sJsElseAction+="self.form.appendWaitForLoader({ promise: execute, create: true });\r\n"}if(sStatement="var baTmpFn = function(self, params){ \r\n",sStatement+="params = params || {};\r\n",bGridDetected&&(sStatement+="var i = params.key;\r\n",sStatement+="var column = params.column;\r\n"),bCondition&&(sStatement+="if ("+sJsCondition+"){ \r\n"),sStatement+="var actionQueue = new bizagiQueue(); \r\n",sStatement+="if (params.render){params.render.startActionExecution();} \r\n",sStatement+=sJsAction,sStatement+="var execute = actionQueue.execute().always(function(){ \r\n",sStatement+="if (params.render){ params.render.endActionExecution();} \r\n });\r\n",sStatement+="self.form.appendWaitForLoader({ promise: execute, create: true });\r\n",bCondition&&(sStatement+="\r\n } ",sJsElseAction.length>0&&(sStatement+="else { \r\n"+sJsElseAction+" }\r\n")),sStatement+="};\r\n",bGridDetected){var sGridStatement="var baGridTmpFn = function(self, args){ \r\n";sGridStatement+="args = args || {};\r\n",sGridStatement+="\t var grid = args.render || self.form.getRender('"+gridReference+"') || []; \r\n",sGridStatement+="\t grid = grid.grid ? grid : (self.form.getRender('"+gridReference+"') || []); \r\n",sGridStatement+="\t args.grid = grid; \r\n",sGridStatement+="if(args.surrogateKey === undefined){\r\n",sGridStatement+="\t var data = grid.getIndexes();\r\n",sGridStatement+="\t $.each(data, function(i, index) {\r\n",sGridStatement+="\t\t args.key = index; \r\n",sGridStatement+="\t\t baTmpFn(self, args);\r\n",sGridStatement+="\t });\r\n",sGridStatement+="} else {\r\n",sGridStatement+="\t args.key = args.surrogateKey; \r\n",sGridStatement+="\t\t baTmpFn(self, args ); \r\n",sGridStatement+="}\r\n",sGridStatement+="};\r\n",sStatement+=sGridStatement,sStatement+="baGridTmpFn"}else sStatement+="baTmpFn";return eval(sStatement)},isServerCommand:function(e){var t=e.command;return["refresh","submit-data","execute-rule","execute-interface","execute-sap","execute-connector","execute-excel-bot","execute-pipeline"].includes(t)},isClientAction:function(e){var t=e.command;return["background-color","forecolor","visible","required","collapse","set-active"].includes(t)},isRecentAction:function(e,t){var i=this,r=e+"@"+t;return null!=i.actionsHistory[r]||($.when(i.runAction(e,t)).done((function(){delete i.actionsHistory[r],bizagi.log("resolve "+r)})),!1)},runAction:function(e,t){var i=e+"@"+t;this.actionsHistory[i]=new $.Deferred;var r=setTimeout(this.actionsHistory[i].resolve,this.period);return this.actionsHistory[i].done(clearTimeout.bind(null,r)),this.actionsHistory[i].promise()},buildCommand:function(e,t){var i=t=t||!1,r=e.command,a=this.detectCommandArgumentType(e.argumentType,r),n=this.buildArgument(e.argument,a,t,e.xpathContext),o=e.xpath,s=this.searchForGridReferenceInCommand(e);if(s&&e.containerId){var l=this.processGridXpath(o);o=l.gridXpath+"."+e.containerId+"[]."+l.remainingXpath+"."+e.renderId}else o&&e.renderId?o=o+"."+e.renderId:t&&e.renderId?o=e.renderId:e.renderId&&(o="id="+e.renderId);if(t&&o&&(o=o.replaceAll("[]","[' + i + ']")),e.xpath&&e.xpath.length>0||e.renderId&&e.renderId.length>0)switch(r){case"background-color":return"activityFlowButton"===e.controlType?"self.changeButtonBackground('"+o+"', "+n+");":"self.changeRenderBackground('"+o+"', "+n+");";case"forecolor":return"activityFlowButton"===e.controlType?"self.changeButtonForeground('"+o+"', "+n+");":"self.changeRenderForeground('"+o+"', "+n+");";case"visible":return"activityFlowButton"===e.controlType?"self.changeButtonVisibility('"+o+"', "+n+");":"self.changeRenderVisibility('"+o+"', "+n+");";case"readonly":return"activityFlowButton"===e.controlType?"self.changeButtonEditability('"+o+"', "+n+");":"self.changeRenderEditability('"+o+"', '"+n+"');";case"required":return"self.changeRenderRequired('"+o+"', "+n+");";case"set-value":return t&&"xpath"===e.argumentType&&e.xpathContext&&(void 0!==e.xpathContext&&(e.argument=e.xpathContext+"."+e.argument),n=this.buildArgument(e.argument,a,t)),"self.changeRenderValue('"+o+"', "+n+");";case"set-min":return"self.changeRenderMinValue('"+o+"', "+n+");";case"set-max":return"self.changeRenderMaxValue('"+o+"', "+n+");";case"calculate":return"self.executeCalculatedField('"+o+"');";case"submit-value":return"self.submitRender('"+o+"', '"+n+"');";case"clean-data":return"self.cleanRenderData('"+o+"');";case"refresh":return(s=this.searchForGridReferenceInCommand(e))?"self.refreshGridCell('"+o+"', '"+(e.xpathContext||"")+"');":"self.refreshControl('"+o+"', '"+(e.xpathContext||"")+"','"+r+"');";case"trigger-click":return"self.triggerClick('"+o+"');"}else switch(r){case"background-color":return"self.changeContainerBackground('"+e.container+"', "+n+");";case"visible":return"self.changeContainerVisibility('"+e.container+"', "+n+");";case"collapse":return"self.toogleContainer('"+e.container+"', "+!bizagi.util.parseBoolean(n)+");";case"set-active":return"self.changeActiveItem('"+e.container+"');";case"readonly":return"self.changeContainerEditability('"+e.container+"', '"+n+"');";case"refresh":return"self.refreshContainer('"+e.container+"', '"+(e.xpathContext||"")+"');"}if("submit-data"===r)return"self.submitFormData();";if("execute-rule"===r){var d=e.argument||{},c="";try{c=JSON.parse(d).guid}catch(e){}var u=e.xpathContext||"";if(t){var p=i+"[id=%s]";return"self.executeRule('"+c+"', printf('"+p+"',i) ,'"+r+"');"}return"self.executeRule('"+c+"','"+u+"','"+r+"');"}if("execute-interface"===r){var h=e.argument||{},g="";try{g=JSON.parse(h).guid}catch(e){}return u=e.xpathContext||"",t?"self.executeInterface('"+g+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executeInterface('"+g+"','"+u+"');"}if("execute-sap"===r){var f=e.argument||{},m="";try{m=JSON.parse(f).guid}catch(e){}return u=e.xpathContext||"",t?"self.executeSAPConnector('"+m+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executeSAPConnector('"+m+"','"+u+"');"}if("execute-connector"===r||"execute-excel-bot"===r){f=e.argument||{};var b="";try{b=JSON.parse(f).guid}catch(e){}return u=e.xpathContext||"",t?"self.executeConnector('"+b+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executeConnector('"+b+"','"+u+"');"}if("execute-pipeline"===r){var v=e.argument||{},y="";try{y=JSON.parse(v).guid}catch(e){}return u=e.xpathContext||"",t?"self.executePipeline('"+y+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executePipeline('"+y+"','"+u+"');"}return bizagi.log("There is no definition for commandType: "+r),""},buildRestoreCommand:function(e,t){var i=e.xpath,r=e.command;return t=t||!1,e.renderId&&(i="id="+e.renderId),t&&(i=i.replaceAll("[]","[' + i + ']")),i&&i.length>0?"self.restoreRender('"+i+"', '"+r+"');":"self.restoreContainer('"+e.container+"', '"+r+"');"},detectCommandArgumentType:function(e,t){if(void 0===e)return e;if("const"==e){if("background-color"==t)return"color";if("forecolor"==t)return"color";if("visible"==t)return"boolean";if("readonly"==t)return"boolean";if("required"==t)return"boolean";if("set-value"==t)return"text";if("collapse"==t)return"boolean";if("set-active"==t)return"number";if("set-min"==t)return"text";if("set-max"==t)return"text";if("calculate"==t)return;if("refresh"==t)return;if("submit-value"==t)return"json"}else if("xpath"===e||"entity"===e||"function"===e)return e;return bizagi.log("There is no definition for commandType: "+t),null},restoreRender:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){var n=a.originalProperties,o=n.textFormat||{};"background-color"==t&&i.changeRenderBackground(e,o.background||""),"forecolor"==t&&i.changeRenderForeground(e,o.color||"none"),"visible"==t&&i.changeRenderVisibility(e,null==n.visible||n.visible),"readonly"==t&&i.changeRenderEditability(e,null==n.editable||n.editable),"required"==t&&i.changeRenderRequired(e,null!=n.required&&n.required)})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},restoreContainer:function(e,t){var i=this.form.getContainer(e);if(null!=i){var r=i.originalProperties;"background-color"==t&&this.changeContainerBackground(e,r.backgroundColor||"none"),"visible"==t&&this.changeContainerVisibility(e,null==r.visible||r.visible),"collapse"==t&&this.toogleContainer(e,!0),"readonly"==t&&this.changeContainerEditability(e,null==r.editable||r.editable)}else this.Class.THROW_ERROR&&this.showContainerNotFoundError(xpath)},changeRenderBackground:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"backgroundColor",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellBackgroundColor(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellBackgroundColor(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){a.changeBackgroundColor(t),i.logVisualChange(n)}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonBackground:function(e,t){var i=e.substring(3),r=this.form.getButton(i);r.css("background-image","none"),r.addClass("ui-fast-transition"),void 0!==r[0]&&r[0].style.setProperty("background-color",t,"important")},changeRenderForeground:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"color",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellColor(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellColor(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){a.changeColor(t),i.logVisualChange(n)}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonForeground:function(e,t){var i=e.substring(3);this.form.getButton(i).css("color",t,"!important")},changeRenderVisibility:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"visibility",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){a.changeColumnVisibility(o.remainingXpath,t);var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellVisibility(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellVisibility(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){$.when(a.renderingDeferred).done((function(){a.changeVisibility(t),i.logVisualChange(n)}))}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonVisibility:function(e,t){var i=e.substring(3),r=1==bizagi.util.parseBoolean(t);if(bizagi.util.isMobileDevice())this.changeFormButtonVisibility(i,r);else{var a=this.form.getButton(i);r?(a.show(),a.css("display","")):a.hide()}},changeRenderEditability:function(e,t){var i=this;if(bizagi.override.changeEditabilityOnReadOnlyForms||!i.form.properties.displayAsReadOnly){var r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"editability",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){a.changeColumnEditability(o.remainingXpath,t);var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellEditability(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellEditability(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){$.when(a.renderingDeferred).done((function(){a.changeEditability(t),i.logVisualChange(n)}))}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)}},changeButtonEditability:function(e,t){var i=e.substring(3),r=this.form.getButton(i);1==bizagi.util.parseBoolean(t)?r.removeAttr("disabled"):r.attr("disabled","disabled")},triggerClick:function(e){var t=e.substring(3),i=this.form.buttons.find((function(e){return e.id==t}));i?this.form.buttonExecutionHandler(i):console.warn("Button properties were not found")},changeRenderRequired:function(e,t){var i=this,r=i.getRenders(e),a=[];null!=r?($.each(r,(function(e,t){bizagi.util.parseBoolean(t.properties.editable)&&a.push(t)})),0===a.length&&(a=r),$.each(a,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"required",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){a.changeColumnRequired(o.remainingXpath,t);var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellRequired(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellRequired(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){$.when(a.renderingDeferred).done((function(){a.changeRequired(t),i.logVisualChange(n)}))}))}}))):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderValue:function(e,t){var i=this;null!=t&&"object"===_typeof(t)&&(t=$.extend(t,{fromAction:!0}));var r=i.getRenders(e);if(null!=r){var a=[];$.each(r,(function(e,t){t.properties.editable&&a.push(t)})),0==a.length&&$.each(r,(function(e,t){a.push(t)})),$.each(a,(function(r,a){if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellValue(r[e],n.remainingXpath,t)}else a.changeCellValue(n.index,n.remainingXpath,t)}))}else $.when(a.ready()).done((function(){a.asyncRenderDeferred?$.when(a.asyncRenderDeferred).done((function(){a.setDisplayValue(t)})):a.setDisplayValue(t)}))}))}else i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderMinValue:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){var n=i.getVisualChange(a,"minValue",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellMinValue(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellMinValue(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){var e=bizagi.util.normalizeQueryType(a.properties.type);["number","date","money"].includes(e)&&(a.changeMinValue(t),i.logVisualChange(n))}))})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderMaxValue:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){var n=i.getVisualChange(a,"maxValue",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellMaxValue(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellMaxValue(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){a.changeMaxValue(t),i.logVisualChange(n)}))})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},executeCalculatedField:function(e){var t=this.getRenders(e);null!=t?$.each(t,(function(e,t){$.when(t.ready()).done((function(){t.runFormula()}))})):this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshControl:function(e,t,i){var r=this.getRenders(e)||this.form.getContainer(e),a=new bizagiQueue;if(null!=r)return $.each(r,(function(i,r){a.add(r.ready().pipe((function(){return r.refreshControl({xpath:e,xpathContext:t})})))})),a.execute();this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshContainer:function(e,t){var i=this.form.getContainer(e);if(null!=i)return $.when(i.ready()).pipe((function(){return i.refreshContainer({xpathContext:t})}));this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshGridCell:function(e,t){var i=this,r=new bizagiQueue,a=new $.Deferred,n=i.getRenders(e)||i.form.getContainer(e);if(null==n)return i.Class.THROW_ERROR&&i.showRenderNotFoundError(e),null;var o=[];return $.each(n,(function(e,t){if(t.properties.editable)return o.push(t),!1})),0==o.length&&$.each(n,(function(e,t){return o.push(t),!1})),0!==o.length?(i.form&&""!==i.form.properties.xpathContext&&(t=""!==t?i.form.properties.xpathContext+"."+t:i.form.properties.xpathContext),r.add(a.promise()),$.when.apply($,$.map(o,(function(e){e.ready()}))).done((function(){for(var r=o.length,n=new bizagiQueue,s=0;s<r;s++){var l=o[s],d=i.processGridXpath(e);if(bizagi.util.isEmpty(d.index))for(var c=l.getIndexes(),u=c.length,p=0;p<u;p++)n.addParallel(l.refreshCell({key:c[p],column:d.remainingXpath,xpathContext:t}));else n.add(l.refreshCell({key:d.index,column:d.remainingXpath,xpathContext:t}))}$.when(n.execute()).done((function(){a.resolve()}))})),r.execute()):void 0},submitFormData:function(e){var t=this.form;return $.when(t.ready()).pipe((function(){return t.submitData(e)}))},executeRule:function(e,t,i){var r=this.form,a=e+"."+t;return this.isRecentAction(a,i)?void 0:$.when(r.ready()).pipe((function(){return r.executeRule({rule:e,xpathContext:t})}))},executeInterface:function(e,t){var i=this.form;return $.when(i.ready()).pipe((function(){return i.executeInterface({interface:e,xpathContext:t})}))},executeSAPConnector:function(e,t){var i=this.form;return $.when(i.ready).pipe((function(){return i.executeSAPConnector({guidsap:e,xpathContext:t})}))},executeConnector:function(e,t){var i=this.form;return $.when(i.ready).pipe((function(){return i.executeConnector({guidConnector:e,xpathContext:t})}))},executePipeline:function(e,t){var i=this.form;return $.when(i.ready()).pipe((function(){return i.executePipeline({pipeline:e,xpathContext:t})}))},submitRender:function(e,t){var i=this.getRender(e);if(null!=i)return $.when(i.ready()).pipe((function(){return i.submitOnChange()}));this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},cleanRenderData:function(e){var t=this,i=t.getRenders(e),r=[];if(null!=i)return $.each(i,(function(i,a){if(t.isGridComponent(a,e)){var n=t.processGridXpath(e);r.push($.when(a.ready()).then((function(){var e=[];if(bizagi.util.isEmpty(n.index)){var t,i,r=a.getIndexes();for(t=0,i=r.length;t<i;t++)e.push($.when(a.cleanCellData(r[t],n.remainingXpath)))}else e.push($.when(a.cleanCellData(n.index,n.remainingXpath)));return $.when.apply($,e)})))}else r.push($.when(a.ready()).then((function(){return $.when(a.renderingDeferred).then((function(){return $.when(a.cleanData()).then((function(){return t.changeRenderRequired(e,null!=a.properties.required&&a.properties.required)}))}))})))})),$.when.apply($,r);t.Class.THROW_ERROR&&t.showRenderNotFoundError(e)},changeContainerBackground:function(e,t){var i=this.form.getContainer(e);null!=i?$.when(i.ready()).done((function(){i.changeBackgroundColor(t),i.visualChanges.backgroundColor=t})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeContainerVisibility:function(e,t){var i=this.form.getContainer(e);null!=i?$.when(i.ready(!0)).done((function(){$.when(i.renderingDeferred).done((function(){i.changeVisibility(t),i.visualChanges.visibility=t}))})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},toogleContainer:function(e,t){var i=this.form.getContainer(e);null!=i?/group/i.test(i.properties.type)&&$.when(i.ready()).done((function(){i.toogleContainer(t)})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeActiveItem:function(e){var t=this.form.getContainer(e);null!=t?("tabItem"===t.properties.type&&t.loadingDeferred&&t.loadingDeferred.resolve(),$.when(t.ready()).done((function(){t.setAsActiveContainer()}))):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeContainerEditability:function(e,t){if(bizagi.override.changeEditabilityOnReadOnlyForms||!this.form.properties.displayAsReadOnly){var i=this.form.getContainer(e);null!=i?$.when(i.ready()).done((function(){i.changeEditability(t),i.visualChanges.editability=t})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)}},searchGridColumns:function(e,t){var i;if("string"==typeof e||"boolean"==typeof e)return null;if(e.expressions){var r,a;for(r=0,a=e.expressions.length;r<a;r++)this.searchGridColumns(e.expressions[r],t)}else{if(e.simple)return this.searchGridColumns(e.simple,t);if(e.complex)return this.searchGridColumns(e.complex,t);var n=e.xpath||e.renderId;n&&(n&&n.indexOf("[]")>0&&(i=n.substring(n.indexOf("[]")+3),t.push(i)),"xpath"===e.argumentType&&e.argument.indexOf("[]")>0&&(i=e.argument.substring(e.argument.indexOf("[]")+3),t.push(i)))}return null},isGridComponent:function(e,t){var i=bizagi.util.normalizeType(e.properties.type);return/grid$/i.test(i)&&t.indexOf("[")>=0},isValidRender:function(e){return-1===["collectionnavigator"].indexOf(e.properties.type)},changeFormButtonVisibility:function(e,t){var i=this.form,r=i.buttons&&i.buttons.length?i.buttons:i.properties.buttons||[],a=r.findIndex((function(t){return t.id===e})),n=i.getNavigation();-1!==a&&(r[a].visible=t),i.buttons=r||[],n.setNavigationButtons(i)},getVisualChange:function(e,t,i){return new Object({element:e,command:t,argument:i,indexes:[],xpath:""})},logVisualChange:function(e){if(e.indexes.length>0)for(var t=0;t<e.indexes.length;t++){var i=e.element.getControlCell(e.indexes[t],e.xpath);i&&(i.visualChanges[e.command]=e.argument)}else e.element.visualChanges[e.command]=e.argument},configureOverrides:function(){if(!this.Class.overridesInitiated){switch(bizagi.override.enableExecuteRefreshAction||void 0!==bizagi.override.refreshActionBehavior||(bizagi.override.refreshActionBehavior="DEPRECATED-11.2.3"),bizagi.override.refreshActionBehavior=bizagi.override.refreshActionBehavior||"11.2.5"){case"DEPRECATED-11.2.3":bizagi.override.enableExecuteRefreshAction=!1,bizagi.override.restoreAppearanceAfterRefresh=!1;break;case"DEPRECATED-11.2.4":bizagi.override.enableExecuteRefreshAction=!0,bizagi.override.restoreAppearanceAfterRefresh=!1;break;case"11.2.5":default:bizagi.override.enableExecuteRefreshAction=!1,bizagi.override.restoreAppearanceAfterRefresh=!0}this.Class.overridesInitiated=!0}}}),$.Class.extend("bizagi.rendering.element",{ELEMENT_TYPE_CONTAINER:1,ELEMENT_TYPE_RENDER:2,ELEMENT_TYPE_COLUMN:3},{init:function(e){this.renderFactory=e.renderFactory,this.dataService=e.dataService,this.parent=e.parent,this.resources=bizagi.localization,this.observableElement=$("<div />"),this.disposed=!1,this.initializeData(e.data),this.subscribers=[]},initializeData:function(e){this.properties={},e&&e.properties&&(this.properties=e.properties),this.properties.xpathContext=this.getXpathContext(),this.properties.idPageCache=this.getPageCache(),this.visualChanges=this.visualChanges||{}},getXpathContext:function(){return null!=this.parent&&"function"==typeof this.parent.getXpathContext?this.parent.getXpathContext():""},getXpath:function(){return this.properties.xpath},getPageCache:function(){return null!=this.parent&&"function"==typeof this.parent.getPageCache?this.parent.getPageCache():""},getFormContainer:function(){if(void 0!==this.parent)return this.parent.getFormContainer()},getResource:function(e){return this.resources.getResource(e)},getElementType:function(){},resize:function(e){},focus:function(){if(this.properties.required){var e=$("#ui-bizagi-wp-app-render-form-content");bizagi.util.isScrolledIntoView(this.element,e)||$(this.element).attr("tabindex",-1).focus(),this.element&&this.element.effect("highlight",2e3)}this.parent&&"function"==typeof this.parent.focus&&this.parent.focus()},triggerGlobalHandler:function(e,t){return this.disposed?null:this.parent?this.parent.triggerGlobalHandler(e,t):null},trigger:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.trigger(e,t):null},triggerHandler:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.triggerHandler(e,t):null},bind:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.bind(e,t):(this.subscribers.push({event:e}),null)},unbind:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.unbind(e,t):null},one:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.one(e,t):(this.subscribers.push({event:e}),null)},getRenderedElement:function(){},getMode:function(){if(this.parent)return this.parent.getMode()},getParams:function(){if(this.parent)return this.parent.getParams()},getFormType:function(){return this.getFormContainer().properties.type||"form"},ready:function(){},isReadyToSave:function(){},getCustomHandlers:function(){return null},dispose:function(){var e=this;e.disposed=!0;var t=setTimeout((function(){null!=e.subscribers&&$.each(e.subscribers,(function(t,i){e.unbind(i.event)})),delete e.subscribers,e.observableElement&&e.observableElement.off(),bizagi.util.dispose(e),clearTimeout(t)}),bizagi.override.disposeTime||50)},isDisposed:function(){return this.disposed},processFailMessage:function(e){var t=this.getFormContainer(),i=bizagi.util.isOfflineForm({context:this});if("CustomMessageException"===e.errorType){t.validationController.clearValidationMessages();var r=bizagi.localization.getResource(e.message);t.validationController.showErrorMessage(r)}else if("InvalidCaseStateException"===e.errorType){var a=t.getParams();t.validationController.clearValidationMessages(),t.container.trigger("routing",{idCase:a.idCase||bizagi.context.idCase})}else{var n=(e="string"==typeof(e=e||{})?JSON.parse(e):e).type||"error",o=e.code||"code";if(e=e.responseText||e.message||e,"not-processed"===n)return;if("not-shown"===n)return;if(i&&"AUTH_ERROR"===o)return;t.validationController.clearValidationMessages(),"alert"==n?t.validationController.showAlertMessage(e):t.validationController.showErrorMessage(e)}return e},startLoading:function(){},endLoading:function(){},beforeToRefresh:function(){},afterToRefresh:function(){bizagi.override&&!0===bizagi.override.enableExecuteRefreshAction&&this.getFormContainer().tryToExecuteFunction(this.properties.xpath||this.properties.id)},getResourceByKey:function(e,t){return t=t||e,bizagi.localization.getResource(e,t)},restoreAppearance:function(){for(var e in this.visualChanges)switch(e){case"color":this.changeColor(this.visualChanges[e]);break;case"backgroundColor":this.changeBackgroundColor(this.visualChanges[e]);break;case"required":this.changeRequired(this.visualChanges[e]);break;case"editability":this.changeEditability(this.visualChanges[e]);break;case"visibility":this.changeVisibility(this.visualChanges[e]);break;case"minValue":this.changeMinValue(this.visualChanges[e]);break;case"maxValue":this.changeMaxValue(this.visualChanges[e])}},getOrientation:function(){for(var e=this;e;){if(properties=e.properties||{},"auto"!==properties.orientation)return properties.orientation;e=e.parent}return"auto"}}),bizagi.rendering.element.extend("bizagi.rendering.container",{TYPE_QUERY_FORM:"queryForm"},{initializeData:function(e){var t=this;t._super(e);var i=t.properties;i.uniqueId=Math.ceil(1e6*Math.random()),i.editable=void 0===i.editable||bizagi.util.parseBoolean(i.editable),i.visible=void 0===i.visible||bizagi.util.parseBoolean(i.visible),i.orientation=i.orientation||"auto",this.originalProperties=JSON.parse(JSON.encode(i)),this.children=[],this.childrenHash={},e.elements&&$.each(e.elements,(function(e,i){i.render?t.createRenderElement(i):i.container?t.createContainerElement(i):i.form&&t.createFormElement(i)}))},createRenderElement:function(e){var t,i=this.properties;0==i.editable&&(e.render.properties.editable=i.editable),!1===i.required&&(e.render.properties.required=i.required),"duplicate"==e.render.properties.retype&&(t=bizagi.clone(e));var r=this.renderFactory.getRender({type:e.render.properties.type,data:e.render,dataService:this.dataService,parent:this,mode:this.getMode()});this.children.push(r),"duplicate"==e.render.properties.retype&&this.processDuplicateRender(r,t),this.getFormContainer().registerRender(r)},createContainerElement:function(e){var t=this.properties;0==t.editable&&(e.container.properties.editable=t.editable),!1===t.required&&(e.container.properties.required=t.required);var i=this.renderFactory.getContainer({type:e.container.properties.type,data:e.container,parent:this,dataService:this.dataService,mode:this.getMode(),isDesign:"design"===this.getMode()});this.children.push(i),this.getFormContainer().registerRender(i)},createFormElement:function(e){var t=this.properties;0==t.editable&&(e.container.properties.editable=t.editable);var i=this.renderFactory.getContainer({type:e.form.properties.type||"form",data:e.form,parent:this,dataService:this.dataService,mode:this.getMode()});this.children.push(i)},getElement:function(){return this.container},getElementsByType:function(e,t){t=t||[];return $.each(this.children,(function(i,r){r.properties.type==e&&t.push(r),r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&r.getElementsByType(e,t)})),t},processDuplicateRender:function(e,t){var i=JSON.parse(JSON.encode(t.render));i.properties.displayName=i.properties.displayName+" "+this.getResource("render-text-duplicate-label-sufix"),i.properties.xpath=i.properties.xpath+".clone",i.properties.isClone=!0;var r=this.renderFactory.getRender({type:i.properties.type,data:i,parent:this,mode:this.getMode()});e.cloneRender=r,this.children.push(r)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_CONTAINER},render:function(){var e;this.getMode();return e=this.internalRender(),this.applyContainerDefaults(),e.attr("data-container-id",this.properties.id),this.properties.tag&&e.attr("data-tag",this.properties.tag),this.params&&this.params.requestedForm&&e.addClass(this.params.requestedForm),e},internalRender:function(){var e=this.renderContainerHtml(),t=this.container=$(e);return this.postRenderContainer(t),this.container},renderContainerHtml:function(){return this.renderingDeferred=this.renderingDeferred||new $.Deferred,this.renderContainer()},isRendered:function(){return!!this.renderingDeferred&&this.renderingDeferred.promise()},getRenderedElement:function(){return bizagi.util.isEmpty(this.container)&&alert("container hasn't been rendered!"),this.container},applyContainerDefaults:function(){var e=this.properties;e.backgroundColor&&this.changeBackgroundColor(e.backgroundColor),e.visible||this.changeVisibility(e.visible)},changeBackgroundColor:function(e){this.properties.backgroundColor=e,$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.changeBackgroundColor(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeBackgroundColor(e)}))},changeVisibility:function(e){var t=this.properties;t.visible=bizagi.util.parseBoolean(e),t.visible?this.container.show():this.container.hide()},changeEditability:function(e){this.properties.editable="Default"==e?this.originalProperties.editable:bizagi.util.parseBoolean(e),$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?$.when(i.ready()).done((function(){i.changeEditability(e)})):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeEditability(e)}))},replaceTag:function(e,t,i){bizagi.util.replaceSelector(e,t,i)},replaceChildrenTag:function(e,t){this.replaceTag(e,".children",t)},replaceChildrenHtml:function(e,t){return e.replaceFirstWithoutPatterns("{{children}}",t)},renderContainer:function(){},postRenderContainer:function(e){var t=this.getMode();this.renderingDeferred&&this.renderingDeferred.resolve(),this.container=e,this.executeChildrenPostRender(e),"execution"==t&&(this.configureHandlers(),this.applyPlaceHolderPolyfill()),"design"==t&&this.configureDesignView(),"layout"==t&&(this.configureDesignView(),this.configureLayoutView())},applyPlaceHolderPolyfill:function(){var e=window.placeHolderConfig||{};("placeholder"in $("<input>")[0]||"placeHolder"in $("<input>")[0])&&!e.forceApply||Placeholders.enable()},executeChildrenPostRender:function(e){var t=this,i=e.children();$.each(i,(function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var a=t.childrenHash[r];if(a){var n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&a.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&a.postRenderContainer(i)}}else t.executeChildrenPostRender(i)}))},configureHandlers:function(){},configureDesignView:function(){},configureLayoutView:function(){},renderChildrenHtml:function(){var e=this,t="";return $.each(e.children,(function(i,r){var a=r.getElementType();a==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(t+=r.renderElement()),a==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(t+=r.renderContainerHtml()),e.childrenHash[r.properties.uniqueId]=r})),t},collectRenderValues:function(e){this.children&&$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValues(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSent()&&i.collectData(e)}))},hasChanged:function(e){if((e=e||[]).length)return e;this.children&&$.each(this.children,(function(t,i){if(e.length||i.hasChanged(e))return!1}))},collectRenderValuesQueryForm:function(e){$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValuesQueryForm(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSentQueryForm()&&i.collectDataQueryForm(e)}))},firstChild:function(){return this.children[0]},getRenders:function(e,t){return t=t||[],e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),$.each(this.children,(function(i,r){r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.getRenders(e,t):r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&e==r.properties.xpath&&t.push(r)})),t},getRender:function(e){var t=this.getRenders(e),i=null;return $.each(t,(function(e,t){t.properties.editable&&null==i&&(i=t)})),null==i&&$.each(t,(function(e,t){i=t})),i},getRendersByXpath:function(e){return this.getRenders(e)},getContainer:function(e){var t;return this.properties.id==e?this:($.each(this.children,(function(i,r){if(r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var a=r.getContainer(e);if(null!=a)return t=a,!1}})),t)},isValid:function(e){return this.children&&$.each(this.children,(function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.isValid(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.isValid(e))})),0==e.length},hasValidGrids:function(e){return $.each(this.children,(function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.hasValidGrids(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&void 0!==i.grid&&i.isValid(e))})),0==e.length},ready:function(){return $.when(this.parent.ready(),this.isRendered())},isReadyToSave:function(){var e=$.map(this.children,(function(e){return e.isReadyToSave()}));return $.when.apply($,e)},getFocus:function(){var e;return $.each(this.children,(function(t,i){if(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var r=i.getFocus();bizagi.util.isEmpty(r)||(e=r)}})),e},getCustomHandlers:function(){var e=this.getFormContainer();if(e)return e.getCustomHandlers()},getCustomHandler:function(e){var t=this.getCustomHandlers();if(t)return t[e]},dispose:function(){var e=this,t=setTimeout((function(){e.children&&$.each(e.children,(function(e,t){t.dispose()})),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()},refreshContainer:function(e){var t=this,i=t.properties,r=t.getFormContainer();return t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||e.xpathContext,contexttype:t.properties.contexttype||"",idForm:r&&r.properties&&r.properties.id?r.properties.id:""})).done((function(e){if(!t.isDisposed()){bizagi.override.restoreAppearanceAfterRefresh&&t.saveChildrenVisualChanges(t),t.unregisterChildren(),delete t.children,delete t.childrenHash,t.getFormContainer().removeActions(),!1===t.properties.editable&&e.container&&e.container.properties&&(e.container.properties.editable=!1),t.initializeData(e.container);var i=t.container,r=t.render();"tabItem"==t.properties.type&&$(r).addClass("childrenActive"),i.replaceWith(r);var a=e.container&&e.container.actions?e.container.actions:[];t.getFormContainer().refreshActions(a),t.triggerChildrenActions(),bizagi.override.restoreAppearanceAfterRefresh&&(t.restoreChildrenVisualChanges(t),delete t.childrenVisualChanges,t.restoreAppearance(e.container)),t.afterToRefresh()}})).fail((function(e){e=t.processFailMessage(e)})).always((function(){t.endLoading()}))},refreshDesignContainer:function(e){var t=this.properties;if(this.beforeToRefresh(e),$.extend(e.properties,{editable:t.editable,contexttype:t.contexttype||"",idPageCache:t.idPageCache,idRender:t.id,messageValidation:t.messageValidation,uniqueId:t.uniqueId,visible:t.visible,xpath:t.xpath,mode:"design",xpathContext:t.xpathContext||""}),!this.isDisposed()){this.unregisterChildren(),delete this.children,delete this.childrenHash,!1===this.properties.editable&&e.container&&e.container.properties&&(e.container.properties.editable=!1),this.initializeData(e.container);var i=this.container,r=this.render();"tabItem"==this.properties.type&&$(r).addClass("childrenActive"),i&&i.replaceWith(r),this.afterToRefresh()}},beforeToRefresh:function(){for(var e=0;e<this.children.length;e++)this.children[e].beforeToRefresh()},afterToRefresh:function(){bizagi.override&&!0===bizagi.override.enableExecuteRefreshAction&&this.getFormContainer().tryToExecuteFunction(this.properties.id);for(var e=0;e<this.children.length;e++)this.children[e].afterToRefresh()},triggerChildrenActions:function(){for(var e=this.children,t=0,i=e.length;t<i;t++){var r=e[t],a=r.getElementType();a===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.triggerChildrenActions():a===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&r.triggerRenderChange({changed:!1})}},registerActions:function(e){var t=this.getFormContainer();e&&t.actionController.buildActions(e)},unregisterChildren:function(){for(var e=this.getFormContainer(),t=this.children,i=0,r=t.length;i<r;i++){var a=t[i],n=a.getElementType();n===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?a.unregisterChildren():n===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&e.unregisterRender(a)}},replaceChild:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){if(t[i].properties.uniqueId==e.properties.uniqueId){t.splice(i,1),t.splice(i,0,e);break}}},getChildById:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){var a=t[i];if(a.properties.id==e)return a}return null},restoreAppearance:function(e){var t=this;t._super(),(e.elements||[]).forEach((function(e){t.restoreElementAppearance(e.container||e.render)}))},restoreElementAppearance:function(e){var t=this.getChildById(e.properties.id);t&&t.restoreAppearance(e)},saveChildrenVisualChanges:function(e){var t=this;t.childrenVisualChanges=t.childrenVisualChanges||{},(e.children||[]).forEach((function(e){var i=e.getElementType();i===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?(t.childrenVisualChanges[e.properties.id]=e.visualChanges,t.saveChildrenVisualChanges(e)):i===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(t.childrenVisualChanges[e.properties.id]=e.visualChanges)}))},restoreChildrenVisualChanges:function(e){var t=this;(e.children||[]).forEach((function(e){var i=e.getElementType(),r=t.childrenVisualChanges&&t.childrenVisualChanges[e.properties.id]||{};i===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?(e.visualChanges=r,t.restoreChildrenVisualChanges(e)):i===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(e.visualChanges=r)}))}}),bizagi.rendering.container.extend("bizagi.rendering.tablet.container",{},{startLoading:function(){},endLoading:function(){}}),bizagi.rendering.element.extend("bizagi.rendering.render",{postRenderTimeout:0,maxRendersPerScreen:50,rendersExecuted:0,renderOptimization:!1,TYPE_QUERY_FORM:"queryForm",startOptimization:function(){bizagi.rendering.render.postRenderTimeout=500,bizagi.rendering.render.rendersExecuted=0,bizagi.rendering.render.renderOptimization=!1},stopOptimization:function(){bizagi.rendering.render.postRenderTimeout=0,bizagi.rendering.render.rendersExecuted=0,bizagi.rendering.render.renderOptimization=!1}},{initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;i.included=void 0!==i.included&&bizagi.util.parseBoolean(i.included),i.uniqueId=Math.ceil(1e6*Math.random()),i.displayName=i.displayName||"",i.editable=void 0===i.editable||bizagi.util.parseBoolean(i.editable),i.visible=void 0===i.visible||bizagi.util.parseBoolean(i.visible),i.includedInResult=void 0!==i.includedInResult&&bizagi.util.parseBoolean(i.includedInResult);var r=bizagi.util.normalizeType(i.type);(/^hidden$/i.test(r)||/^queryHidden$/i.test(r))&&(i.visible=!1),i.required=void 0!==i.required&&bizagi.util.parseBoolean(i.required),i.submitOnChange=void 0!==i.submitOnChange&&bizagi.util.parseBoolean(i.submitOnChange),i.maxLength=i.maxLength||0,i.helpText=bizagi.util.trim(i.helpText)||"",i.textFormat=i.textFormat||{},i.valueFormat=i.valueFormat||{},i.isHidden=void 0!==i.isHidden&&bizagi.util.parseBoolean(i.isHidden),i.visible=!i.isHidden&&i.visible,i.editabilityEnabled=!1,i.color&&(i.textFormat.color=i.color),i.backgroundColor&&(i.textFormat.backgroundColor=i.backgroundColor),i.required=!!i.editable&&i.required,i.orientation=i.orientation||"auto",i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",this.originalProperties={textFormat:{color:i.textFormat.color,backgroundColor:i.textFormat.backgroundColor},valueFormat:{color:i.textFormat.color,backgroundColor:i.textFormat.backgroundColor},visible:i.visible,editable:i.editable,required:i.required,labelAlign:i.labelAlign,valueAlign:i.valueAlign},this.value=void 0!==i.value?i.value:null,this.properties.originalValue=this.value,this.properties.previousValue=this.value,this.calculateInitialLayoutProperties()},calculateInitialLayoutProperties:function(){var e=this.properties;e.displayType=e.displayType||"normal",e.labelAlign=e.labelAlign||this.getDefaultLabelAlign(e.displayType),e.valueAlign=e.valueAlign||this.getDefaultValueAlign(e.displayType),"rtl"===e.orientation&&(e.labelAlign=this.getRTLAlign(e.labelAlign),e.valueAlign=this.getRTLAlign(e.valueAlign));var t=this.calculateRenderWidth(e.labelWidth,e.valueWidth,e.displayType);e.labelWidth=t.label,e.valueWidth=t.control,"percentage"===e.layoutType&&(e.valueWidth=t.control),0==e.labelWidth&&(e.displayType="value",e.valueWidth=t.control),0==e.valueWidth&&(e.displayType="label"),"userfield"===e.type&&(["both","normal","reversed"].includes(e.displayType)?(e.valueWidth=e.valueWidth||50,e.labelWidth=e.labelWidth||50):"vertical"===e.displayType?(e.valueWidth=100,e.labelWidth=100):"label"===e.displayType?(e.valueWidth=0,e.labelWidth=100):(e.valueWidth=100,e.labelWidth=0))},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_RENDER},render:function(e){return this.renderElement(e)},renderElement:function(e){var t=this.properties,i=this.getFormContainer();this.renderingDeferred=new $.Deferred,e=e||"render";var r=this.renderFactory.getTemplate(e),a=t.displayName;"string"==typeof a&&(a=bizagi.util.encodeString(a));var n="desktop"!==bizagi.util.detectDevice()&&("association"===t.type||"uploadecm"===t.type||("actionLauncher"===t.type||"polymorphicLauncher"===t.type)&&bizagi.util.isTabletDevice()||"grid"===t.type&&!bizagi.util.isTabletDevice()),o=parseFloat(t.labelWidth),s=$.fasttmpl(r,{label:a,helpText:t.helpText,editable:t.editable,isExtendedText:"text"==t.type&&t.isExtended,orientation:t.orientation,uniqueId:t.uniqueId,id:t.id,xpath:t.xpath,tag:t.tag,displayType:t.displayType,displayOptionClass:this.getDisplayOptionClass(t.displayType),labelAlignClass:this.getAlignClass(t.labelAlign),valueAlignClass:this.getAlignClass(t.valueAlign),flexAlignClass:bizagi.util.mapAlignClassName(t.columnAlign),labelWidth:o,stringLabelWidth:o+("pixels"==t.layoutType?"px":"%"),valueWidth:parseFloat(t.valueWidth),stringValueWidth:parseFloat(t.valueWidth)+("pixels"==t.layoutType?"px":"%"),layoutType:t.layoutType,isDesign:"design"===this.getMode(),messageValidation:t.messageValidation,printVersion:i.params.printversion,cssClass:t.cssclass||"",includedInResult:t.includedInResult,included:t.included,type:t.type,showFullRender:n,required:t.required}),l=this.internalRenderControl();return l||(l=""),"object"===_typeof(l)&&l.done?"resolved"===l.state()?(s=this.replaceControlHtml(s,this.resolveResult(l)),this.asyncRenderDeferred=null):(this.asyncRenderDeferred=l,s=this.replaceControlHtml(s,"")):s=this.replaceControlHtml(s,l),s},resolveResult:function(e){return bizagi.resolveResult(e)},isRendered:function(){return!!this.renderingDeferred&&this.renderingDeferred.promise()},internalRenderControl:function(){var e=this.properties;return this.control=null,this.renderFactory.printVersion?(e.editable=!1,this.renderControl()):e.editable?this.renderControl():this.renderReadOnly()},postRenderElement:function(e){var t=this,i=t.properties;t.element=e,i.submitOnChange&&t.configureSubmitOnChange(),isLabelFormat=!0;var r=function(e){if(bizagi.rendering.render.renderOptimization&&bizagi.rendering.render.rendersExecuted>bizagi.rendering.render.maxRendersPerScreen)var i=setTimeout((function(){t.internalPostRender(e),bizagi.rendering.render.postRenderTimeout+=50,clearTimeout(i)}),bizagi.rendering.render.postRenderTimeout);else t.internalPostRender(e);bizagi.rendering.render.rendersExecuted++};t.asyncRenderDeferred?$.when(t.asyncRenderDeferred).done((function(i){var a=t.getControl();"function"==typeof t.emptyControlByAsyncRenderDeferred&&t.emptyControlByAsyncRenderDeferred(),a.append(i),r(e),t.processLayout(!isLabelFormat,t.properties.valueFormat||{})})):r(e)},internalPostRender:function(e){var t=this.properties,i=this.getMode();this.control=this.getControl(),this.renderingDeferred&&this.renderingDeferred.resolve(),t.editable?this.renderFactory.printVersion&&this.postRenderPrintVersion?this.postRenderPrintVersion():this.postRender():this.postRenderReadOnly(e),"execution"==i?this.performExecutionModeMethods():this.performDesignModeMethods(),this.processLayout(isLabelFormat,this.properties.textFormat||{}),this.processLayout(!isLabelFormat,this.properties.valueFormat||{})},performExecutionModeMethods:function(){var e=this.properties;this.getFormType()==this.Class.TYPE_QUERY_FORM&&this.configureHandlersQueryForm(),e.editable?this.configureHandlers():this.configureHandlersReadOnly(),this.internalSetInitialValue()},performDesignModeMethods:function(){this.configureDesignView(),this.internalSetInitialValue()},replaceControlHtml:function(e,t){return t=t||"",(e=e||"").replaceFirstWithoutPatterns("{{control}}",t)},getRenderedElement:function(){return bizagi.util.isEmpty(this.element)&&bizagi.log(" render hasn't been rendered!",this,"error"),this.element},internalSetInitialValue:function(){var e=this.properties;this.internalSetInitialValueFlag=!0,e.editable,bizagi.util.isEmpty(this.value)||this.setDisplayValue(this.value),this.internalSetInitialValueFlag=!1},isValid:function(e){var t,i=this.properties,r=this.grid&&this.grid.properties&&this.grid.properties.inlineAdd;if(!1===bizagi.util.parseBoolean(i.visible))return!0;if(!1===bizagi.util.parseBoolean(i.editable)&&!r)return!0;if(this.setValidationMessage(""),bizagi.util.parseBoolean(i.required)){var a=this.getFormContainer(),n=!1,o=this.grid?[this]:a.getRenders(i.xpath),s=/^query/i.test(i.type);if(o.filter((function(e){return e.properties.id==i.id})).forEach((function(e){if(e.hasValue()&&(e.properties.editable||r))return n=!0,!1})),!n&&!this.properties.isClone){t=this.getResource("render-required-text").replaceAll("#label#",i.displayName);var l={xpath:i.xpath,message:t,id:i.id};return s&&(l=$.extend({},l,{id:i.id,isQuery:s})),e.push(l),!1}}if("duplicate"==i.retype){if(this.cloneRender&&this.cloneRender.getValue()!=this.getValue())return t=this.getResource("render-text-retype-error"),e.push({xpath:i.xpath,message:t}),!1}else if("double"==i.retype){var d=$("input",this.element);if(d&&d.data("oldValue")){if(""===d.val())return t=this.getResource("render-text-retype-error"),e.push({xpath:i.xpath,message:t}),!1;if(d.val()!=d.data("oldValue"))return t=this.getResource("render-text-retype-error"),e.push({xpath:i.xpath,message:t}),!1}}var c=!this.grid||!this.grid.getColumn||this.grid.getColumn(this.properties.xpath).properties.editable;if("userPassword"!==i.type&&void 0!==i.maxLength&&i.maxLength>0&&bizagi.util.isNumeric(i.maxLength)&&(c||!c&&this.controlValueIsChanged())){var u=new Number(i.maxLength),p=this.getValue();if(p&&p.toString().length>u)return t=this.getResource("render-text-maxLength-error").replaceAll("#maxLength#",u),e.push({xpath:i.xpath,message:t}),!1}return!0},hasValue:function(){var e=this.getValue();return e&&"text"===this.properties.type&&(e="string"==typeof e?e.trim():e),!bizagi.util.isEmpty(e)},postRender:function(){},postRenderReadOnly:function(){},configureHandlers:function(){},configureHandlersReadOnly:function(){},configureDesignView:function(){},processLayout:function(e,t){var i=this.properties;if(null!=this.getControl()){(t=t||{}).color&&this.changeColor(t.color,e),t.background&&this.changeBackgroundColor(t.background),!t.bold&&t.bold&&e||this.changeFontBold(t.bold,e),t.italic&&this.changeFontItalic(t.italic,e),t.underline&&this.changeFontUnderline(t.underline,e),t.strikethru&&this.changeFontStrikethru(t.strikethru,e),t.size&&this.changeFontSize(t.size,e),i.required=null!=i.required&&bizagi.util.parseBoolean(i.required);var r=null==i.visible||bizagi.util.parseBoolean(i.visible);i.required&&this.changeRequired(i.required),r||(this.grid?this.changeCellVisibility(r):this.changeVisibility(r))}},setValue:function(e,t){t=void 0===t||t,bizagi.util.identicalObjects(e,this.value)||(this.properties.previousValue=this.properties.originalValue=this.value,this.value=this.properties.value=e,this.properties.required&&"execution"==this.getMode()&&(this.checkRequired([])?this.changeRequiredLabel(!1):this.changeRequiredLabel(!0)),t&&!this.internalSetInitialValueFlag&&(this.triggerRenderChange(),this.triggerRenderValidate()))},checkRequired:function(e){var t=this.properties;return!(bizagi.util.parseBoolean(t.required)&&!this.hasValue())||(message=this.getResource("render-required-text").replaceAll("#label#",t.displayName),e.push({xpath:t.xpath,message:message}),!1)},validateInputRetype:function(){return!this.properties.retype||!this.cloneRender||this.getValue()==this.cloneRender.getValue()},triggerRenderChange:function(e){(e=e||{}).changed=void 0===e.changed||e.changed,this.triggerHandler("renderchange",{render:this,changed:e.changed})},triggerRenderValidate:function(){this.triggerHandler("rendervalidate",{render:this})},setDisplayValue:function(e){var t=this.getControl();if(this.setValue(e,!1),!this.properties.editable&&("check"!==this.properties.display||"check"===this.properties.display&&!0===bizagi.override.enableCheck)){var i=this.getDisplayValue(e);"string"!=typeof i&&"number"!=typeof i||(i=bizagi.util.sanitizeHTML(i),$(t).html("<label class='readonly-control'>"+i+"</label>"))}},getValue:function(){return this.value},getDisplayValue:function(){return this.getValue()},getLabel:function(){bizagi.util.mustImplement("getLabel")},getControl:function(){bizagi.util.mustImplement("getControl")},getControlFiller:function(){bizagi.util.mustImplement("getControlFiller")},renderControl:function(){},setValidationMessage:function(e){this.validationMessage=e},renderReadOnly:function(){var e=this.getValue(),t="";return bizagi.util.isObject(e)&&void 0!==e.value?t=bizagi.util.sanitizeHTML(e.value):bizagi.util.isEmpty(e)||(t=bizagi.util.isString(e)?bizagi.util.encodeHtmlText(e):e),t},postRenderPrintVersion:function(){},changeDisplayOption:function(e){this.properties.displayType=e},getDisplayOptionClass:function(e){return""},changeLabelAlign:function(e){this.properties.labelAlign=e},changeValueAlign:function(e){this.properties.valueAlign=e},getAlignClass:function(e){return""},customizeRenderWidth:function(){},changeColor:function(e,t){var i=this,r=i.getControl(),a=i.getLabel();t=void 0===t&&null==t||t;r&&a&&("none"!=e?"value"!==i.properties.displayType&&t?(i.element.each((function(){this.style.setProperty("color",e,"important")})),"grid"==i.properties.type&&i.getControl().find(".bz-mobile-grid__header-title").each((function(){this.style.setProperty("color",e,"important")})),i.getLabel().find("label").css("color",e,"!important"),!1===i.properties.editable&&(i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getElementsToStylize($("label",i.getControl()).css("color",e,"!important")))):(i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getControl().find("*").each((function(t,r){i.getElementsToStylize(r).css("color",e,"!important")}))):(i.element.css("color",""),i.getLabel().find("label").css("color",""),i.getControl().css("color",""),i.getControl().find("input, textarea").each((function(e,t){var r=$(t).data("originalColor")||"";i.getElementsToStylize(t).css("color",r)}))))},changeBackgroundColor:function(e){var t=this.getControl(),i=this.getLabel();if(t&&i)if("none"!=e){this.element.each((function(){this.style.setProperty("background-color",e,"important")})),void 0!==i.find("label").style?this.getLabel().find("label").style("background-color",e,"important"):this.getLabel().find("label").css("background-color",e,"!important");var r=this.getLabel().attr("style");r+="; background-color:"+e+"!important",this.getLabel().attr("style",r)}else this.element.css("background-color",""),this.getLabel().find("label").css("background-color",""),this.getControl().css("background-color",""),this.getControl().find("input, textarea").each((function(e,t){var i=$(t).data("originalColor")||"";$(t).css("background-color",i)}))},getFormattingLabel:function(){return this.getLabel().find("label")},changeFontBold:function(e,t){t=void 0===t&&null==t||t;0!=bizagi.util.parseBoolean(e)&&t?(this.getFormattingLabel().css("font-weight","bold","!important"),this.getControl().find("*").each((function(e,t){$(t).css("font-weight","bold","!important")}))):t&&this.getFormattingLabel().css("font-weight","normal","!important"),t||(1==bizagi.util.parseBoolean(e)?this.getControl().find("*").each((function(e,t){$(t).css("font-weight","bold","!important")})):this.surrogateKey&&"summary"==this.surrogateKey||(this.getControl().find("*").each((function(e,t){$(t).css("font-weight","normal","!important")})),this.getControl().css("font-weight","normal","!important")))},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue,a=!0,n=bizagi.util.normalizeType(e.type),o=this.getFormContainer();if("duplicate"===e.retype&&this.cloneRender&&o.isStartForm())return!0;if($.forceCollectData)return!0;if("grid"===n&&"pending"===this.ready().state())return!1;if(["combo","queryCombo","list","queryList","radio","queryRadio"].includes(n)||/^cascadingcombo$/i.test(n))t&&void 0!==t.length&&(t=t[0]),i&&void 0!==i.length&&(i=i[0]),r&&void 0!==r.length&&(r=r[0]),t=t&&t.id?t.id:t,i=i&&i.id?i.id:i,a=void 0!==(r=r&&r.id?r.id:r)&&null!=r?i!=t||i==r:i!=t;else if("boolean"===n||"queryBoolean"===n||"queryCheck"===n)a=bizagi.util.parseBoolean(i)!=bizagi.util.parseBoolean(t);else if("searchNumber"===n)a=!!t;else if("number"===n)a=(null!==t&&""!==t||null!==i&&""!==i)&&i!==t;else if("text"===n)a=(null!==t&&""!==t||null!==i&&""!==i)&&i!==t;else if("date"===n)i||t?(e.showTime||(t=bizagi.util.getNormalizedDate(t,e.fullFormat),i=bizagi.util.getNormalizedDate(i,e.fullFormat)),a=i!=t):a=!1;else if("actionLauncher"===n){a=!1;var s=[];try{s="string"==typeof i?JSON.parse(i):i}catch(e){}var l=function(e,t){e=e||"";for(var i=!1,r=0,a=(t=t||[]).length;r<a;r++)if(t[r].guidAction==e){i=!0;break}return i};if(s.length==t.length)for(var d=0,c=s.length;d<c;d++)l(s[d].guidAction,t)||(a=!0);else a=!0}else if("polymorphicLauncher"===n||"entityTemplate"===n)a=i.length!=t.length||JSON.encode(t)!=JSON.encode(i);else if("searchList"===n){var u={};try{u=JSON.parse(t)}catch(e){console.log("Error when detect change value on searchList control")}a=JSON.encode(i)!=JSON.encode(u.value)}else a=!["signature","image"].includes(n)&&i!==t;return a},changeFontItalic:function(e,t){var i=this;t=void 0===t&&null==t||t;"value"!=i.properties.displayType&&t?1==bizagi.util.parseBoolean(e)?i.getFormattingLabel().css("font-style","italic","!important"):i.getFormattingLabel().css("font-style","normal","!important"):1==bizagi.util.parseBoolean(e)?(t&&i.getFormattingLabel().css("font-style","italic","!important"),i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("font-style","italic","!important")})):i.getElementsToStylize(i.getControl()).css("font-style","italic","!important")):(t&&i.getFormattingLabel().css("font-style","normal","!important"),i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("font-style","normal","!important")})):i.getElementsToStylize(i.getControl()).css("font-style","normal","!important"))},changeFontUnderline:function(e,t){var i=this,r=i.properties.textFormat||{},a=i.properties.valueFormat||{},n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(a.strikethru)?"line-through ":"";t=void 0===t&&null==t||t;1==bizagi.util.parseBoolean(e)&&t?(i.getFormattingLabel().css("text-decoration",n+"underline","!important"),i.getControl().each((function(e,t){i.getElementsToStylize(t).css("text-decoration",n+"underline")}))):t&&i.getFormattingLabel().css("text-decoration",n,"!important"),"value"!=i.properties.displayType&&t||(1==bizagi.util.parseBoolean(e)?i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o+"underline","!important")})):i.getElementsToStylize(i.getControl()).css("text-decoration",o+"underline","!important"):i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o,"!important")})))},changeFontStrikethru:function(e,t){var i=this,r=i.properties.textFormat||{},a=i.properties.valueFormat||{},n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(a.underline)?"underline ":"";t=void 0===t&&null==t||t;1==bizagi.util.parseBoolean(e)&&t?i.getFormattingLabel().css("text-decoration",n+"line-through","!important"):t&&i.getFormattingLabel().css("text-decoration",n,"!important"),"value"!=i.properties.displayType&&t||(1==bizagi.util.parseBoolean(e)?i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o+"line-through","!important")})):i.getElementsToStylize(i.getControl()).css("text-decoration",o+"line-through","!important"):i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o,"!important")})):i.getElementsToStylize(i.getControl()).css("text-decoration",o,"!important"))},changeFontSize:function(e,t){t=void 0===t&&null==t||t;if("0"!=e){var i=this.getFormattingLabel(),r=100+10*Number(e)+"%";if(t&&i.css("font-size",r,"!important"),"value"==this.properties.displayType||!t){var a=this.getControl();"object"==_typeof(a.children())&&a.children().length>0?this.getElementsToStylize(a.children()).css("font-size",r,"!important"):(this.getElementsToStylize(a).css("font-size",r,"!important"),-1!=this.properties.type.indexOf("ombo")&&e>4&&a.children(0).height(2*e+20)),this.getElementsToStylize(a.find(".ui-bizagi-render-date")).css("line-height","normal")}}},getElementsToStylize:function(e){return $(e)},changeVisibility:function(e){var t=this.properties;1==bizagi.util.parseBoolean(e)?"hidden"!==t.type&&(this.element.show(),this.element.css("display",""),t.required&&(this.hasValue()||this.changeRequiredLabel(!0))):this.element&&this.element.hide(),t.visible=e},changeEditability:function(e){var t=this,i=t.properties,r=t.getControl();i.editable="Default"==e?t.originalProperties.editable:bizagi.util.parseBoolean(e),i.editabilityEnabled=i.editabilityEnabled||i.editable,r.empty(),"function"==typeof t.internalRenderControl&&$.when(t.internalRenderControl()).done((function(e){"function"==typeof t.emptyControlByChangeEditability&&t.emptyControlByChangeEditability(),t.asyncRenderDeferred||r.append(e),t.postRenderElement(t.element)}))},changeEditabilityCellControl:function(e,t,i){var r=this.properties,a=this.grid.getColumn(i),n=a.getDecorated(t);r.editable="Default"===e?this.originalProperties.editable:bizagi.util.parseBoolean(e),r.editabilityEnabled=r.editabilityEnabled||r.editable,this.internalRenderCellControl(r.editable,t,a,n)},internalRenderCellControl:function(e,t,i,r){var a=this,n=a.getControl();n.empty(),"function"==typeof a.internalRenderControl&&$.when(a.internalRenderControl()).done((function(o){a.asyncRenderDeferred||n.append(o),a.postRenderElement(a.element),e&&(i.bind("rendered",(function(){i.readyDeferred.resolve()})),r.unbind("renderchange"),r.bind("renderchange",(function(e,r){i.changed=!0,a.grid.onCellChange(i,null,t,r)})))}))},changeRequired:function(e){var t=this.properties,i=t.displayName||"",r=$("label",this.getLabel()),a=this.getControl();t.required=e,"execution"==this.getMode()&&this.checkRequired([])?this.changeRequiredLabel(!1):1==bizagi.util.parseBoolean(e)&&t.editable?"rtl"==this.properties.orientation?a.prepend('<div class="ui-bizagi-render-control-required-rtl"></div>'):(a.addClass("control-required"),a.prepend('<div class="ui-bizagi-render-control-required"></div>')):"rtl"==this.properties.orientation?$(".ui-bizagi-render-control-required-rtl",a).remove():(a.removeClass("control-required"),$(".ui-bizagi-render-control-required",a).remove()),r.html(i),this.triggerRenderValidate()},changeRequiredLabel:function(e){var t=this.properties,i=t.displayName||"",r=$("label",this.getLabel()),a=this.getControl();1==bizagi.util.parseBoolean(e)&&t.editable?"rtl"==this.properties.orientation?a.prepend('<div class="ui-bizagi-render-control-required-rtl"></div>'):(a.addClass("control-required"),a.append('<div class="ui-bizagi-render-control-required"></div>')):"rtl"==this.properties.orientation?$(".ui-bizagi-render-control-required-rtl",a).remove():(a.removeClass("control-required"),$(".ui-bizagi-render-control-required",a).remove()),r.html(i),this.triggerRenderValidate()},refreshControl:function(e){var t=this,i=t.properties,r=(t.value,t.getFormContainer().properties.id||"");return e=e||{},t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||e.xpathContext,idForm:r})).pipe((function(e){t.grid&&bizagi.override.restoreAppearanceAfterRefresh&&t.saveGridChildrenVisualChanges(),t.control=t.controlFiller=t.label=null;var i=t.element;return t.initializeData(e.render),$.when(t.render()).pipe((function(e){var i=$(e);t.postRenderElement(i);return t.properties.originalValue=t.value,i})).pipe((function(e){i.replaceWith(e),t.grid||t.triggerRenderChange({changed:!1}),bizagi.override.restoreAppearanceAfterRefresh&&(t.grid?(t.restoreGridChildrenVisualChanges(),t.restoreGridAppearance()):t.restoreAppearance()),t.afterToRefresh()}))})).fail((function(e){e=t.processFailMessage(e)})).always((function(){t.endLoading()}))},refreshDesignControl:function(e){var t=this,i=t.properties;t.beforeToRefresh(),t.control=t.controlFiller=t.label=null,$.extend(e.render.properties,{xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext||"form",idPageCache:i.idPageCache});var r=t.element;return t.initializeData(e.render),$.when(t.render()).pipe((function(e){var i=$(e);t.postRenderElement(i);return t.properties.originalValue=t.value,i})).pipe((function(e){r.replaceWith(e),t.triggerRenderChange(),t.beforeToRefresh()}))},cleanData:function(){this.setValue(""),this.clearDisplayValue()},clearDisplayValue:function(){var e=this.getControl(),t=e.find("input");t.length>0?t.val(this.getValue()):!1===this.properties.editable&&$(e).html("<label class='readonly-control'></label>")},updateOriginalValue:function(){this.properties.originalValue=this.value},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();this.controlValueIsChanged()&&(bizagi.util.isEmpty(i)||(bizagi.util.isEmpty(r)?""!==r&&null!==r||(e[t.xpath]=""):e[t.xpath]=r)),this.validateInputRetype()||(e[t.xpath]="")},hasChanged:function(e){return!!this.controlValueIsChanged()&&(e.push(!0),!0)},configureHandlersQueryForm:function(){var e=this;e.element.find(".ui-bizagi-render-control-included").change((function(){e.properties.included=$(this).is(":checked")}))},getRenderId:function(){var e=this;return bizagi.util.tryCatch((function(){return e.properties.id}),null)},collectDataQueryForm:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=null;if(!bizagi.util.isEmpty(i)){if(null!=r)a=void 0!==r.id?bizagi.util.isEmpty(r.id)?null:[r]:""!==r?r:null;if(null!==a||t.included){var n=(this.properties.typeSearch||this.properties.rangeQuery||"NONE").toUpperCase(),o={value:a,included:this.properties.included,xpath:t.xpath,searchType:n,orderType:"NONE",renderId:this.getRenderId()};void 0!==t.displayXpath&&""!==t.displayXpath&&(o.displayXpath=t.displayXpath),e.push(o)}}},canBeSent:function(){var e,t=this.properties,i=bizagi.util.parseBoolean(t.displayOnly)||!1,r=bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editabilityEnabled);if(t.isClone)return!1;if(!i&&r)return!0;if(t.xpath&&1==this.getFormContainer().getRenders(t.xpath).length){if(e=!!$.forceCollectData&&$.forceCollectData.toString(),$.forceCollectData=e?void 0:$.forceCollectData,this.controlValueIsChanged())return $.forceCollectData=e?bizagi.util.parseBoolean(e):$.forceCollectData,!0;$.forceCollectData=e?bizagi.util.parseBoolean(e):$.forceCollectData}return!1},canBeSentQueryForm:function(){return!this.properties.isClone},focus:function(e){var t=this;if(t.properties.visible){this._super();var i=$("#ui-bizagi-wp-app-render-form-content"),r=function(){var e=t.getControl(),r="grid"!=t.properties.type?$("input, select, option, textarea",e):$("input, select, option, textarea",e).first();r.length>0&&$.each(r,(function(e){var t=r[e];if("hidden"!=$(t).attr("type")&&"none"!=$(t).css("display")&&"hidden"!=$(t).css("visibility"))try{bizagi.util.isIE()||bizagi.util.autoScrollBottom(i),t.focus()}catch(e){}}))};$.when(t.ready()).done((function(){if(e>0)var t=setTimeout((function(){r(),clearTimeout(t)}),e);else r()}))}},getDefaultLabelAlign:function(e){return"default"},getDefaultValueAlign:function(e){return"default"},getRTLAlign:function(e){return e},configureSubmitOnChange:function(){var e=this,t=e.properties,i="",r=t.id;if(t.editable){t.dependencies=t.dependencies||"all";var a={conditions:{expressions:[{simple:{xpath:i=t.xpath?t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.xpath:t.xpath:t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.id:t.id,renderId:t.id,operator:"changes",argumentType:"const"}}]},commands:[{xpath:i,command:"submit-value",argument:t.dependencies}],dependencies:[i],elseCommands:[]};t.submitOnChangexpathContext&&e.grid&&(a.conditions.expressions[0].simple.containerId=e.grid.properties.id),$.when(e.ready()).done((function(){e.getFormContainer().addSubmitAction(i+"."+r,a)}))}},submitOnChange:function(e,t,i){var r=this,a=$.Deferred();return""!=r.properties.contexttype&&e&&(e[r.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=r.properties.contexttype),$.when(r.isReadyToSave()).done((function(){r.internalSubmitOnChange(e,t,i).done((function(){a.resolve()})).fail((function(){a.reject()}))})),a.promise()},getCacheIdCase:function(){var e=this.getParams().idCase;return void 0===bizagi.cache?(bizagi.cache={},bizagi.cache.idCaseObject={idCase:void 0!==e?e:void 0!==bizagi.cache.idCase?bizagi.cache.idCase:void 0}):void 0!==e&&void 0!==bizagi.cache.idCaseObject?bizagi.cache.idCaseObject.idCase=e:void 0!==e&&void 0===bizagi.cache.idCaseObject&&(bizagi.cache.idCaseObject={},bizagi.cache.idCaseObject.idCase=e),e=void 0===e?void 0===bizagi.cache.idCaseObject?void 0:bizagi.cache.idCaseObject.idCase:e},internalSubmitOnChange:function(e,t,i){var r=this.getFormContainer(),a=this.properties,n={data:e,bRefreshForm:t,notCollect:i,properties:{idCase:this.getCacheIdCase(),id:a.id,xpath:a.xpath,idPageCache:a.idPageCache,contexttype:a.contexttype}};return r.internalSubmitOnChange(n)},ready:function(){return $.when(this.parent.ready(),this.isRendered())},getCustomHandlers:function(){var e=this.getFormContainer();return e?e.getCustomHandlers():null},getCustomHandler:function(e){var t=this.getCustomHandlers();return t?t[e]:null},calculateRenderWidth:function(e,t,i){if(e="100"==t&&void 0===e?"0":e?"0"!=e?e:"50":"50%",t=t?"0"!=t?t:"50":"50%","normal"==i||"both"==i||"reversed"==i){if(e&&bizagi.util.percent2Number(e)<5&&t&&bizagi.util.percent2Number(t)<5)return{label:0,control:100};e&&!t?t=100-(e=bizagi.util.percent2Number(e)):!e&&t?e=100-(t=bizagi.util.percent2Number(t)):(e=bizagi.util.percent2Number(e))+(t=bizagi.util.percent2Number(t))!=100&&void 0!==this.properties&&"pixels"!=this.properties.layoutType&&(t=100-e)}else e=100,t=100;return{label:e,control:t}},getIdCase:function(){return this.getFormContainer().params.idCase||bizagi.context.idCase},getIdWorkitem:function(){return this.getFormContainer().params.idWorkitem||bizagi.context.idWorkitem},getidTask:function(){return this.getFormContainer().params.idTask||bizagi.context.idTask},getSessionId:function(){return this.getFormContainer().properties.sessionId},changeCellColor:function(e){var t=this.getControl();t&&("none"!=e?(t.css("color",e),t.find("input, textarea, label").each((function(t,i){$(i).css("color",e)}))):(t.css("color",""),t.find("input, textarea, label").each((function(e,t){$(t).css("color","")}))))},changeCellBackgroundColor:function(e){var t=this.getControl(),i="",r="";if(t)if("none"!=e&&(i=e,r="none"),this.properties.editable){var a=!1;t.find("input, textarea, .ui-selectmenu").each((function(e,t){"text"!=t.type&&"textarea"!=t.type||$(t).hasClass("ui-select-data")||(a=!0),$(t).css({"background-color":i,"background-image":r})})),a||t.closest("td").each((function(e,t){$(t).css({"background-color":i,"background-image":r})}))}else t.each((function(e,a){($(a).hasClass("ui-bizagi-cell-readonly")?t.closest("td"):$(a)).css({"background-color":i,"background-image":r})}))},changeCellVisibility:function(e){var t=this.properties,i=this.getControl();i&&(1==bizagi.util.parseBoolean(e)?(i.css("visibility","visible"),i.css("display",""),this.element&&this.element.show()):i.css("visibility","hidden")),t.visible=e},changeCellRequired:function(e){var t=this.properties,i=this.getControl();i&&(1==bizagi.util.parseBoolean(e)&&bizagi.util.isEmpty(this.value)?(i.addClass("control-required"),i.append('<div class="ui-bizagi-render-control-required"></div>')):(i.removeClass("control-required"),$(".ui-bizagi-render-control-required",i).remove()),t.required=e)},startActionExecution:function(){this.startLoading(),this.actionExecutionDeferred=new $.Deferred},endActionExecution:function(){this.endLoading(),this.actionExecutionDeferred&&this.actionExecutionDeferred.resolve(),delete this.actionExecutionDeferred},readyActionExecution:function(){return this.actionExecutionDeferred?this.actionExecutionDeferred.promise():$.when(!0)},isFromCreatedRow:function(){if(this.grid)for(var e=this.grid.columns.length;e-- >0;)if(this.grid.columns[e].properties.xpath==this.properties.xpath&&1==this.grid.columns[e].isNewRow)return!0;return!1},submitInvalidatePageCacheRequest:function(e){var t=this.properties,i=e?e.idPageCache:t.idPageCache;this.dataService.invalidatePageCache({idPageCache:i})},isDesignMode:function(){return"design"===this.getMode()},isExecutionMode:function(){return"execution"===this.getMode()},preventDefaultForAnchorTag:function(){(bizagi.util.isSharepointContext()||bizagi.util.isWebpartContext())&&$("a[href='#']",this.getControl()).click((function(e){e.preventDefault()}))},getMainForm:function(e){var t=e.params.fromRender;if(void 0===t)return e;this.getMainForm(t.getFormContainer())},setInterceptionObserver:function(e,t){var i=this,r=new IntersectionObserver((function(){i.pluginInitialized||0===e.width()||("function"==typeof t&&t(),r.disconnect())}));r.POLL_INTERVAL=100,r.observe(e.get(0))},setResizeObserver:function(e,t){var i=this,r=new ResizeObserver((function(){i.pluginInitialized||0===e.width()||("function"==typeof t&&t(),r.disconnect())}));r.observe(e.get(0))},restoreGridAppearance:function(){var e=this.getIndexes();this.restoreAppearance(),this.columns.length>0&&$.each(this.columns,(function(t,i){for(var r=0;r<e.length;r++)i.decorateRenders[e[r]].restoreCellAppearance()}))},saveGridChildrenVisualChanges:function(){var e=this,t=e.getIndexes();e.gridChildrenVisualChanges=[],e.columns.length>0&&$.each(e.columns,(function(i,r){if(r.properties.xpath)for(var a=0;a<t.length;a++){var n=r.decorateRenders[t[a]];n&&n.properties&&(e.gridChildrenVisualChanges[n.properties.id+t[a]]=n.visualChanges)}}))},restoreGridChildrenVisualChanges:function(){var e=this,t=e.getIndexes();e.columns.length>0&&$.each(e.columns,(function(i,r){if(r.properties.xpath)for(var a=0;a<t.length;a++){var n=r.decorateRenders[t[a]];n&&n.properties&&(n.visualChanges=e.gridChildrenVisualChanges[n.properties.id+t[a]]||{})}})),delete e.gridChildrenVisualChanges},restoreCellAppearance:function(){for(var e in this.visualChanges)switch(e){case"color":this.changeCellColor(this.visualChanges[e]);break;case"backgroundColor":this.changeCellBackgroundColor(this.visualChanges[e]);break;case"required":this.changeCellRequired(this.visualChanges[e]);break;case"editability":this.changeEditabilityCellControl(this.visualChanges[e],this.surrogateKey,this.properties.xpath);break;case"visibility":this.changeCellVisibility(this.visualChanges[e]);break;case"minValue":this.changeMinValue(this.visualChanges[e]);break;case"maxValue":this.changeMaxValue(this.visualChanges[e])}},formatValue:function(e){return e}}),$.Class.extend("bizagi.rendering.render.base",{},{processLayout:function(e,t){var i=this.properties;if("boolean"==typeof e)if(e)this.processLabelLayout(t);else{this.processControlLayout(t),i.required=void 0!==i.required&&bizagi.util.parseBoolean(i.required);var r=void 0===i.visible||bizagi.util.parseBoolean(i.visible);i.required&&this.changeRequired(i.required),r||this.changeVisibility(r)}else console.warm("error calling processLayout, 'isLabelFormat' is not boolean")},processLabelLayout:function(e){var t=this.getLabel();null!=t&&(void 0===(e=e||{}).bold&&(e.bold=!0),this.changeBackgroundColor(e.background).changeFontColor(t,e.color).changeFontBold(t,e.bold).changeFontSize(t,e.size).changeFontItalic(t,e.italic).changeTextDecoration(t,(e.underline?"underline":"")+(e.strikethru?" line-through":"")))},processControlLayout:function(e){var t=this.getControl(),i=this.getElementsToStylize(t);e=e||{},this.changeFontColor(i,e.color).changeFontBold(i,e.bold).changeFontItalic(i,e.italic).changeFontSize(i,e.size).changeTextDecoration(i,(e.underline?"underline":"")+(e.strikethru?" line-through":""))},changeColor:function(e){var t=this.getLabel(),i=this.getControl(),r=this.getElementsToStylize(i);return this.changeFontColor(t,e).changeFontColor(r,e)},changeFontColor:function(e,t){if(void 0===e)return this;if(void 0===t)return this;var i="none"!==t?t:"";return e.css("color",i),this},changeFontSize:function(e,t){if(void 0===t)return this;if(void 0===e)return this;if("0"!==t){var i=100+10*Number(t)+"%";e.css("font-size",i)}return this},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)},changeFontItalic:function(e,t){var i=bizagi.util.parseBoolean(t)?"italic":"normal";return e.css("font-style",i),this},changeFontBold:function(e,t){var i=bizagi.util.parseBoolean(t)?"bold":"normal";return e.css("font-weight",i),this},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.element.css("background-color",e):this.element.css("background-color",""),this)},changeCellBackgroundColor:function(e){return this.getCellBackgroundFunction(this.properties.editable.toString(),this.properties.type)(e)},getCellBackgroundFunction:function(e,t){var i={true:{columnDate:this.changeInputBackgroundColor.bind(this)},false:{default:this.changeBackgroundColor.bind(this)},default:this.changeBackgroundColor.bind(this)};return i[e][t]||i.default},changeInputBackgroundColor:function(e){return void 0===e?this:("none"!==e?$(".bz-input-icon",this.element).css("background-color",e):$(".bz-input-icon",this.element).css("background-color",""),this)},changeRequiredLabel:function(){},changeCellRequired:function(e){this.changeRequired(e)},getRTLAlign:function(e){return void 0===e||""==e?"default":e},getDefaultLabelAlign:function(){return"default"},getDefaultValueAlign:function(){return"default"}}),bizagi.rendering.render.extend("bizagi.rendering.tablet.render",bizagi.rendering.render.base.prototype),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.render",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer();this.formParams=t.getParams()},getLabel:function(){return this.label||(this.label=$(".bz-form-label label",this.element||this.observableElement)),this.label},getFormattingLabel:function(){return this.getLabel()},getControl:function(){return this.control&&0!==this.control.length||(this.control=$(".bz-control",this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},getControlFiller:function(){return this.controlFiller||(this.controlFiller=$(".bz-form-item__control",this.element||this.observableElement)),this.controlFiller},getContainerMessage:function(){return this.containerMessage||(this.containerMessage=$(".bz-form-message__text",this.element||this.observableElement)),this.containerMessage},getColumnContainerMessage:function(){return this.containerMessage||(this.containerMessage=$(".bz-form-cell-message__text",this.element||this.observableElement)),this.containerMessage},startLoading:function(){},endLoading:function(){},getDisplayOptionClass:function(e){return"normal"===e||"both"===e?"bz-form-item--display-normal":"vertical"===e?"bz-form-item--display-vertical":"reversed"===e?"bz-form-item--display-reversed":"label"===e?"bz-form-item--display-label":"value"===e?"bz-form-item--display-value":void 0},changeDisplayOption:function(e){},getAlignClass:function(e){return e},changeLabelAlign:function(e){},changeValueAlign:function(e){},customizeRenderWidth:function(){var e=this.getLabel(),t=this.properties,i=this.getControlFiller(),r=t.labelWidth?"0"!=t.labelWidth?t.labelWidth:"50%":null,a=t.valueWidth?"0"!=t.valueWidth?t.valueWidth:"50%":null;r&&!a?a=100-(r=bizagi.util.percent2Number(r)):!r&&a?r=100-(a=bizagi.util.percent2Number(a)):(r=bizagi.util.percent2Number(r))+(a=bizagi.util.percent2Number(a))!=100&&(a=100-r),e.width(r+"%"),i.width(a-.01+"%")},setValidationMessage:function(e){this._super(e);var t=bizagi.util.normalizeType(this.properties.type),i="grid"===t||"groupedgrid"===t,r=this.grid&&this.column&&/column/.test(t)?this.getColumnContainerMessage():this.getContainerMessage();e&&e.length>0?(e=e.replace(/<\w+>([^<]*)<\/\w+>/g,"$1"),r.attr("data-error",e),r.text(e),this.element&&(i?this.element.addClass("bz-form-item-grid--error"):this.element.addClass("bz-form-item--error"))):(r.text(""),this.element&&(i?this.element.removeClass("bz-form-item-grid--error"):this.element.removeClass("bz-form-item--error")))},setDisplayValue:function(e){var t=this.getControl();if(this.setValue(e,!1),!this.properties.editable&&"check"!==this.properties.display){var i=this.getDisplayValue(e);"string"!=typeof i&&"number"!=typeof i||$(t).html("<label class='bz-form-label'>"+i+"</label>")}},getElementsToStylize:function(e){return $(".bz-input, .bz-input-icon__input",e)},getFormParams:function(){return this.formParams||{}},changeRequired:function(e){this.properties.required=e,bizagi.util.parseBoolean(e)&&this.properties.editable?this.element.addClass("bz-form-item--required"):this.element.removeClass("bz-form-item--required"),this.triggerRenderValidate()},changeRequiredLabel:function(e){},clearDisplayValue:function(){var e=this.getControl().find("input").filter((function(e,t){return"file"!==t.type&&"radio"!==t.type&&"checkbox"!==t.type}));e.length>0?e.val(this.getValue()):this.setDisplayValue("")}}),$.Class.extend("bizagi.rendering.form",{},{init:function(e){var t=e.data,i=bizagi.util.detectDevice();this.rendersById={},this.rendersByXpath={},this.rendersByXpathId={},this.rendersByType={},this.idPageCache=t.pageCacheId,this.compatibilityVersion=t.properties.compatibilityVersion||0,this.mode=e.mode||"execution",this.focus=e.focus,this.params=e,this._super(e);var r="";r="desktop"!==i?this.getResource("render-form-user-confirmation-message").replace(/<br(\/| \/)>/g,"\n"):this.getResource("render-form-user-confirmation-message");var a=this.properties;a.sessionId=t.sessionId,a.displayAsReadOnly=bizagi.util.parseBoolean(t.displayAsReadOnly)||!1,a.userConfirmationMessage=a.userConfirmationMessage||r,a.orientation=a.orientation||"ltr",a.hasRule=bizagi.util.parseBoolean(a.hasRule)||!1,a.contexttype=e.contexttype||"",a.paramsRender=e.paramsRender||{},a.processPath=e.data.processPath?e.data.processPath.replaceAll("|/|","  &rsaquo;  "):"",a.breadCrumb=e.data.processPath?e.data.processPath.split("|/|"):[],a.type=a.type||"form",this.validations=t.validations,this.actions=t.actions,this.allowValidateAndSaveAction=bizagi.override&&!0===bizagi.override.enableActionValidateAndSave;var n=bizagi.util.isFeatureEnabled("enableExecuteQuickActions"),o=null===n||n;if(this.useQuickActions=o&&this.hasQuickActions(t,o),this.initializeButtons(t),t.transitions&&(this.transitions=t.transitions),this.originalProcessButton=this.processButton,this.isRoutingDisabled=!1,e.applicationParent)switch(e.applicationParent){case"NEWWORKPORTAL":this.isRoutingDisabled=!0}this.isOfflineFormsV2Supported=bizagi.util.isMobileDevice()&&bizagi.util.isOfflineFormsV2Supported(),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.rendersById[a.id]=this},initializeButtons:function(e){var t=this;t.buttons=[],e.buttons&&$.each(e.buttons,(function(e,i){var r=i.button.properties;r.caption=bizagi.util.isEmpty(r.caption)||t.getResource(r.caption)===r.caption?r.caption:t.getResource(r.caption),r.actions&&$.each(r.actions,(function(e,t){r[t]=!0})),r.ordinal=e,r.action=r.next?"next":r.nextWithoutValidations?"nextWithoutValidations":r.submitData?"save":r.cancel?"cancel":r.back?"back":r.createnewcase?"createnewcase":r.validate?"validate":"",r.save="save"===r.action,r.quickAction="quickactions"===r.type,(r.next||r.back||r.nextWithoutValidations)&&(r.routing=!0),r.hasRule&&(r.executeRule=!0),t.allowValidateAndSaveAction&&r.validate&&(r.submitData=!0,r.refresh=!0,r.save=!0,"next"!==r.action&&"createnewcase"!==r.action||(r.refresh=!1)),r.style=t.buildButtonStyle(r),t.buttons.push(r)}))},getParams:function(){return this.params},setParam:function(e,t){this.params&&(this.params[e]=t)},getMode:function(){return this.mode},getCustomHandlers:function(){if(this.params)return this.params.customHandlers},registerRender:function(e){var t=e.properties.xpath,i=e.properties.id,r=e.properties.type,a=t?t+"."+i:void 0;this.rendersById[i]=e,t&&(this.rendersByXpath[t]||(this.rendersByXpath[t]=[]),this.rendersByXpath[t].push(e)),a&&(this.rendersByXpathId[a]||(this.rendersByXpathId[a]=[]),this.rendersByXpathId[a].push(e)),this.rendersByType[r]||(this.rendersByType[r]=[]),this.rendersByType[r].push(e)},unregisterRender:function(e){if(this.rendersById[e.properties.id]&&delete this.rendersById[e.properties.id],e.properties.xpath){var t;if($.isArray(this.rendersByXpath[e.properties.xpath])&&this.rendersByXpath[e.properties.xpath].length>1)-1!==(t=this.rendersByXpath[e.properties.xpath].findIndex((function(t){return bizagi.util.md5(JSON.stringify(t.properties))===bizagi.util.md5(JSON.stringify(e.properties))})))&&this.rendersByXpath[e.properties.xpath].splice(t,1);else delete this.rendersByXpath[e.properties.xpath];if(e.properties.id)if($.isArray(this.rendersByXpathId[e.properties.xpath+"."+e.properties.id])&&this.rendersByXpathId[e.properties.xpath+"."+e.properties.id].length>1)-1!==(t=this.rendersByXpathId[e.properties.xpath+"."+e.properties.id].findIndex((function(t){return bizagi.util.md5(JSON.stringify(t.properties))===bizagi.util.md5(JSON.stringify(e.properties))})))&&this.rendersByXpathId[e.properties.xpath+"."+e.properties.id].splice(t,1);else delete this.rendersByXpathId[e.properties.xpath+"."+e.properties.id]}if(e.properties.type)for(var i=this.getRenderByType(e.properties.type),r=i.length,a=e.properties.id||e.properties.xpath,n=0;n<r;n++){var o=i[n];if(void 0!==o.properties.id&&o.properties.id==a||void 0!==o.properties.xpath&&o.properties.xpath==a){this.rendersByType[e.properties.type].splice(n,1);break}}},getRenderById:function(e){return this.rendersById[e]},getGridByColumn:function(e){for(var t=this.getRenderByType("grid"),i=0;i<t.length;i++)if(-1!=t[i].columnsIds.indexOf(e))return t[i];return null},getRenders:function(e){return e&&e.indexOf&&e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),this.rendersByXpathId[e]?this.rendersByXpathId[e]:this.rendersByXpath[e]?this.rendersByXpath[e]:[]},getRenderByType:function(e){return"string"==typeof e&&e.length>0&&this.rendersByType[e]?this.rendersByType[e]:[]},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("form"),i=$.fasttmpl(t,{buttons:this.buttons,transitions:this.transitions,uniqueId:e.uniqueId,helptext:e.helpText,mode:this.getMode(),queryForm:"queryForm"===this.getFormType(),summaryForm:this.params.summaryForm||!1,globalForm:this.properties.displayAsReadOnly||!1,idCase:"",displayName:this.params.displayName||"",processPath:e.processPath,breadCrumb:e.breadCrumb,orientation:e.orientation,isEmpty:bizagi.util.isEmpty(this.children)&&bizagi.util.isEmpty(this.transitions),allowQuickActions:this.useQuickActions});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){var t=this.getMode();e.addClass("ui-bizagi-rendering-mode-"+t),this._super(e)},configureHandlers:function(){var e,t=this,i=t.container;i.length>1?$(i).each((function(){$(this).hasClass("ui-bizagi-container-complexgateway")&&(e=this)})):e=$(".ui-bizagi-container-complexgateway",i),t.activeTransitions={},t.processButtons(i),t.bind("ondomincluded",(function(e,i){var r=t.getValidationsContainer(i);t.validationController=new bizagi.command.controllers.validation(t,t.validations,r),t.actionController=new bizagi.command.controllers.action(t,t.actions),t.readyDeferred.resolve()})),$(e).find(".ui-checkbox").bind("click",(function(){var e=$("label",this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),bizagi.util.parseBoolean(e.data("checked"))?(e.removeClass("ui-checkbox-state-checked"),e.removeClass("bz-check").addClass("bz-full-ball"),e.data("checked",!1),t.activeTransitions[i]=!1):(e.addClass("ui-checkbox-state-checked"),e.addClass("bz-mo-icon").addClass("bz-check").removeClass("bz-full-ball"),e.data("checked",!0),t.activeTransitions[i]=!0)}))},configureDesignView:function(){var e=this;e.bind("ondomincluded",(function(){e.readyDeferred.resolve()}))},buildButtonStyle:function(e){var t={};if(e.format){if(e.format.size&&"0"!=e.format.size){var i=100+10*Number(e.format.size)+"%";t["font-size"]=i+" !important"}if(e.format.bold&&(t["font-weight"]="bold !important",bizagi.util.isIE()&&(t["font-family"]="'Open Sans', 'Helvetica Neue', Arial, Helvetica, sans-serif !important")),e.format.italic&&(t["font-style"]="italic !important"),e.format.underline||e.format.strikethru){var r=bizagi.util.parseBoolean(e.format.strikethru)?"line-through ":"",a=bizagi.util.parseBoolean(e.format.underline)?"underline ":"";t["text-decoration"]=r+a+" !important"}e.format.background&&(t["background-color"]=e.format.background+" !important",t["background-image"]="none !important"),e.format.color&&(t.color=e.format.color+" !important")}var n="";for(key in t)n+=key+":"+t[key]+";";return n},render:function(){return this.readyDeferred||(this.readyDeferred=new $.Deferred),this._super()},ready:function(){return this.readyDeferred.promise()},getXpathContext:function(){return this.properties.xpathContext||""},getContextType:function(){return this.properties.contexttype||""},getEndPointAction:function(){if("startform"==this.properties.formtype)return"LOADSTARTFORM"},getPageCache:function(){return this.idPageCache},getFormContainer:function(){return this},processButtons:function(){var e=this,t=e.getButtons();t&&0!==t.length&&t.on("click",(function(t){t.preventDefault(),t.stopImmediatePropagation();var i=$(this),r=i.attr("ordinal"),a=e.buttons.find((function(e){return e.ordinal==r}));i.prop("disabled",!0),i.hasOwnProperty("disabled")&&i.button("disable"),e.propagateExternalEvents(t);var n=setTimeout((function(){$.when(e.buttonExecutionHandler(a)).always((function(){$.contains(document.documentElement,i.get(0))&&(i.prop("disabled",!1),i.hasOwnProperty("enable")&&i.button("enable"))})),clearTimeout(n)}),100)}))},buttonExecutionHandler:function(e){var t=this;return t.startLoading(),t.lastActionButton=e,"next"===e.action&&(e.routingDisabled=t.isRoutingDisabled),$.when(t.processButton(e)).always((function(){t.processDefer=void 0,t.endLoading()}))},preProcessButton:function(e){return!0},postProcessButton:function(e,t){return!0},setLoaderDeferred:function(){this.loaderDeferred=$.Deferred().resolve()},deleteLoaderDeferred:function(){var e=this;e.isLoaderDeferredSet()&&$.when(e.loaderDeferred.promise()).done((function(){delete e.loaderDeferred})).fail((function(){delete e.loaderDeferred}))},useOrSetLoaderDeferred:function(){this.isLoaderDeferredSet()||this.setLoaderDeferred()},getLoaderPromise:function(){return this.isLoaderDeferredSet()?this.loaderDeferred.promise():void 0},isLoaderDeferredSet:function(){return!!this.loaderDeferred},appendWaitForLoader:function(e){var t=e.promise,i=e.create||!1;if(!this.isLoaderDeferredSet()){if(!i)return;this.setLoaderDeferred()}this.loaderDeferred=this.loaderDeferred.then((function(){return t}))},getResolveOrReject:function(){var e=$.Deferred();return this.isLoaderDeferredSet()?$.when(this.loaderDeferred.promise()).done((function(){e.resolve()})).fail((function(){e.resolve()})):e.resolve(),e.promise()},processButton:function(e){var t=this,i=$.Deferred(),r=t.properties;e.routing||bizagi.chrono.initAndStart("submitForm"),bizagi.chrono.init("waiting"),t.validationController.clearValidationMessages();var a=t.getFormContainer(),n=a.getRenderByType("tabItem"),o=n.length;a.innerTabsLoading=!0,t.useOrSetLoaderDeferred();for(var s=0;s<o;s++){var l=n[s];l.loadingDeferred&&l.parent.container&&l.loadingDeferred.resolve()}return delete a.innerTabsLoading,$.when(t.ready(),t.getResolveOrReject()).done((function(){if(t.deleteLoaderDeferred(),!bizagi.util.parseBoolean(e.validate)||t.validationController.performValidations()){["save","next","back","createnewcase","nextWithoutValidations"].includes(e.action)&&!t.isOfflineForm&&$(document).data("auto-save","");var a=t.getConfirmationStatus(r,e);a.hasConfirmation?(t.endLoading(),$.when(bizagi.showConfirmationBox(a.message,null,!1)).done((function(){t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done((function(){i.resolve()})).fail((function(){i.reject(arguments)})))})).fail((function(){i.reject()}))):t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done((function(){$(document).trigger("FORMACTION",e),i.resolve()})).fail((function(){i.reject(arguments)})))}else t.endLoading(),e.submitData?$.when(t.submitData()).done((function(){i.reject()})):i.reject(),t.validationController.expandNotificationBox();var n=t.getCustomHandler("afterFormButtonClick");n&&n(e)})),i.promise()},validateForm:function(){return this.validationController.clearValidationMessages(),this.validationController.performValidations()},saveForm:function(){var e=this;if(bizagi.util.isNativeMobileDevice()&&!this.allowOnlineActions())return $.when((function(){return null}));var t=e.collectRenderValuesForSubmit(),i=null;return t.deferreds&&(i=$.when.apply($,t.deferreds),delete t.deferreds),$.when(i).pipe((function(){e.startLoading();var i={action:"SAVE",data:t,idCase:e.params.idCase,idWorkitem:e.params.idWorkitem,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,isOfflineForm:e.isOfflineForm||!1};return e.isOfflineForm&&(i.offlineType=e.params.offlineType),$.when(e.dataService.submitData(i)).always((function(){e.endLoading()}))}))},removeCaseSyncError:function(){if(this.removeSyncErrorOnSubmit)return this.removeSyncErrorOnSubmit=!1,"start"==("task"==this.params.offlineType?"task":"start")?this.dataService.removeStartCaseSyncError(this.params):this.dataService.removeTaskCaseSyncError(this.params)},submitForm:function(e){var t=this,i=$.Deferred();return $.when(t.isReadyToSave()).then((function(){t.isOfflineForm?$.when(t.removeCaseSyncError()).then((function(){return t.internalSubmitFormOffline(e)}),(function(){return t.internalSubmitFormOffline(e)})).then((function(){i.resolve()})).fail((function(){i.reject(arguments)})):$.when(t.internalSubmitForm(e)).done((function(){i.resolve()})).fail((function(){i.reject(arguments)}))})).fail((function(){t.endLoading(),bizagi.log("The form is not saved, no changes were found"),i.reject()})),i.promise()},checkWidgetsData:function(){},isComplexGatewayPainted:function(){return!1},getLastActionButton:function(){return this.lastActionButton},internalSubmitFormOffline:function(e){var t,i=this,r=$.Deferred();if(i.isOfflineForm&&i.properties&&!i.properties.idPageCache&&(i.properties.idPageCache=""),e.submitData||e.executeRule||e.save){t=i.collectRenderValuesForSubmit();var a=null;if(bizagi.loading.start(),e.executeRule&&(null==t&&(t={}),(a=i.dataService.executeButton({idRender:e.id,xpathContext:i.properties.xpathContext||"",idPageCache:i.properties.idPageCache,prepare:!0})).tag="executeRule_"+e.id),i.transitions){var n=[];if($.each(this.activeTransitions,(function(e,t){t&&n.push(e)})),0==bizagi.util.countProps(n))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),""}var o=[],s=null;t&&t.deferreds&&(s=$.when.apply($,t.deferreds),o.push(s),delete t.deferreds);var l=[];a&&l.push(a),$.when.apply($,o).done((function(){$.when(i.dataService.submitData({action:e.action,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,idForm:i.properties.id,prepare:!0,transitions:n||"",idCase:i.params.idCase,idWorkitem:i.params.idWorkitem,isOfflineForm:i.isOfflineForm||!1,offlineType:i.params.offlineType||"",actions:l})).then((function(t){if(i.postProcessButton(t,e)){var a="task"!==i.params.offlineType&&"save"===e.action;if(i.online&&i.isOfflineFormsV2Supported&&!a){var n=new $.Deferred,o=$.extend({deferred:n},i.params);$(document).trigger("tryPushCase.offline",o)}i.isOfflineFormsV2Supported||$(document).trigger("tryPushData.offline"),$.when(n).then((function(t){if(bizagi.loading.stop(),e.routing)!i.online&&i.isOfflineFormsV2Supported?i.triggerHandler("routing",{offlineAction:e.action,idCase:i.params.idCase,idWorkitem:i.params.idWorkitem,buttonPropertiesAction:e.action,radNumber:i.params.radNumber}):(i.showToastOnSuccessSync&&(i.showToastOnSuccessSync=!1,bizagi.util.showMobileToast({type:"success",message:bizagi.localization.getResource("workportal-offline-sync-success")})),i.triggerHandler("routing",{idCase:t.IdCase,caseNumber:t.CaseNumber,buttonPropertiesAction:e.action}));else if(i.online||null!=t||(i.isOfflineRefreshWithEdition=!0),(e.refresh||t&&t.shouldRefresh)&&i.refreshForm(),i.showToastOnSuccessSync&&i.online)i.showToastOnSuccessSync=!1,bizagi.util.showMobileToast({type:"success",message:bizagi.localization.getResource("workportal-offline-save-and-sync-success")});else{var a=bizagi.localization.getResource("workportal-mobile-offline-form-successful","Saved");bizagi.util.showNotification({text:a,stop:!1,type:"success"})}r.resolve()})).fail((function(e){bizagi.loading.stop(),bizagi.util.recreateNativeButtons(i);var t=bizagi.localization.getResource("workportal-mobile-offline-sync-fail","Synchronization failed");if(bizagi.util.showNotification({text:t,stop:!1,type:"error"}),$.isArray(e)){var a,n=e,o="";$.each(n,(function(e,t){var r=i.validationToDisplayMessages(a,t.result.type,t.result.messages,o);a=r.bHasValidations,o=r.alertMessage})),a&&""!==o&&bizagi.modalError.show(o,"workportal-general-word-information",!1)}i.failHandler(e),r.reject(e)}))}})).fail((function(e){var t=bizagi.localization.getResource("workportal-mobile-offline-sync-fail","Synchronization failed");bizagi.util.showNotification({text:t,stop:!1,type:"error"}),r.reject(e)}))}))}},partialSubmitFormOffline:function(e){var t=$.Deferred();return $.when(this.dataService.submitData({action:"save",data:e,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,idForm:this.properties.id,prepare:!0,transitions:"",idCase:this.params.idCase,idWorkitem:this.params.idWorkitem,isOfflineForm:this.isOfflineForm||!1,offlineType:this.params.offlineType||"",actions:[]})).fail((function(e){var i=bizagi.localization.getResource("workportal-mobile-offline-form-fail","Not saved");bizagi.util.showNotification({text:i,stop:!1,type:"error"}),t.reject(e)})),t.promise()},internalSubmitForm:function(e){var t=this,i=$.Deferred(),r={};(e.submitData||e.executeRule||e.createnewcase||e.back)&&(r=t.collectRenderValuesForSubmit()),$.when(t.startLoading()).done((function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")}));var a=null,n=null,o=null,s=null,l=null,d=[],c=null;if(e.executeRule&&(r.deferreds&&(c=$.when.apply($,r.deferreds),d.push(c),delete r.deferreds),(a=t.dataService.submitData({action:"SUBMITDATA",data:r,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0})).tag="submitData",s=t.prepareCheckpointAction(e.id),r={},(n=t.dataService.executeButton({idRender:e.id,xpathContext:t.properties.xpathContext||"",idPageCache:t.properties.idPageCache,prepare:!0})).tag="executeRule",l=t.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase||e.nextWithoutValidations){if(t.transitions){var u=[];if($.each(this.activeTransitions,(function(e,t){t&&u.push(e)})),0==bizagi.util.countProps(u))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),t.endLoading(),i.reject(),i.promise()}r&&r.deferreds&&(c=$.when.apply($,r.deferreds),d.push(c),delete r.deferreds),(o=t.dataService.submitData({action:t.getButtonAction(e.action),forcePlanCompletion:e.forcePlanCompletion,data:r,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0,transitions:u||"",contexttype:t.properties.contextType,surrogatekey:t.properties.surrogateKey})).tag="performAction"}var p=[];n&&(p.push(a),p.push(s),p.push(n),p.push(l)),o&&p.push(o),bizagi.chrono.initAndStart("submitForm-ajax");var h=new $.Deferred;return r&&r.deferreds?$.when.apply(this,r.deferreds).done((function(e){h.resolve(e)})).fail((function(){h.reject(),console.log("Error: It was not possible resolve async actions on form ")})):h.resolve(),d.push(h),$.when.apply($,d).done((function(){$.when(t.dataService.multiaction().execute({actions:p})).done((function(r){var a;bizagi.chrono.stop("submitForm-ajax"),t.endLoading();var n="";if($.each(r,(function(e,i){var r=t.validationToDisplayMessages(a,i.result.type,i.result.messages,n);a=r.bHasValidations,n=r.alertMessage})),a)""!==n&&bizagi.modalError.show(n,"workportal-general-word-information",!1),e.executeRule&&t.sendRollbackAction(e.id);else{if(!t.postProcessButton(r,e))return;e.refresh&&t.refreshForm(),e.routing&&(bizagi.jqxhrList.abortAll("rendering_"+t.dataService.guid),t.triggerHandler("routing",{idCase:t.params.idCase,routingDisabled:e.routingDisabled})),e.createnewcase&&r.length>0&&(bizagi.jqxhrList.abortAll("rendering_"+t.dataService.guid),t.triggerHandler("routing",{idCase:r[0].result.IdCase,caseNumber:r[0].result.CaseNumber}))}i.resolve()})).fail((function(r,a,n){e.executeRule&&t.sendRollbackAction(e.id),n&&n.error&&("WaitForCompletionPlanException"===n.error.errorType||"InvalidPlanStateException"===n.error.errorType||"CustomMessageException"===n.error.errorType)?(t.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(n.error.message),null,!1)).then((function(){return $.when(t.internalSubmitForm($.extend({},e,{forcePlanCompletion:!0})))})).done((function(){i.resolve()})).fail((function(){i.reject()}))):(t.failHandler(n),i.reject(n))}))})),i.promise()},validationToDisplayMessages:function(e,t,i,r){return"validationMessages"==t&&(this.addValidationMessage(i),e=!0),"alertMessages"==t&&(r=""===r?i:r+"\n\n"+i,e=!0),{bHasValidations:e,alertMessage:r}},addValidationMessage:function(e,t,i,r,a,n){var o=this;if(bizagi.util.isNativeMobileDevice()&&!this.allowOnlineActions()&&this.clearValidationMessages(),!o.validationController){var s=o.getValidationsContainer();o.validationController=new bizagi.command.controllers.validation(o,void 0,s)}"string"==typeof e?o.validationController.showValidationMessage(e,t,i,r,n):$.each(e,(function(e,a){o.validationController.showValidationMessage(a,t,i,r,n)})),o.validationController.expandNotificationBox(a)},clearValidationMessages:function(e){this.validationController&&this.validationController.clearValidationMessages(e)},addErrorMessage:function(e){bizagi.util.isNativeMobileDevice()&&!this.allowOnlineActions()&&this.clearValidationMessages(),this.validationController&&(this.validationController.showErrorMessage(e),this.validationController.expandNotificationBox())},refreshForm:function(e){var t=this,i=t.properties,r=$.Deferred();(e=e||t.getFocus())&&!e.id&&(e={id:e});var a={idCase:t.params.idCase||"",idWorkitem:t.params.idWorkitem||"",idTask:t.params.idTask||"",focus:e,selectedTabs:t.getSelectedTabs(),selectedSection:t.getSelectedSection(),xpathContext:i.xpathContext,idPageCache:i.idPageCache,isRefresh:!0,contextType:t.getContextType()||"",action:t.getEndPointAction(),idStartScope:t.properties.idStartScope||""};return t.isOfflineRefreshWithEdition&&(a.isEdited=!0,t.isOfflineRefreshWithEdition=!1),t.startLoading(),$.when(t.triggerHandler("refresh",a)).done((function(){r.resolve()})).fail((function(){r.reject()})).always((function(){t.endLoading()})),r.promise()},getSelectedTabs:function(){for(var e=this.getElementsByType("tab"),t=$.map(e,(function(e){return{tab:e.properties.id,selected:e.activeTab}})),i={},r=0,a=t.length;r<a;r++)i[t[r].tab]=t[r].selected;return i},getSelectedSection:function(){return(this.getParams()||{}).selectedSection},getButtons:function(){},addSubmitAction:function(e,t){this.actionController.processInternalSubmitAction(e,t)},startLoading:function(){var e=this.renderFactory.getTemplate("form-waiting");if(!this.waitingOverlay||!this.waitingMessage)if(bizagi.util.isTabletDevice())this.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo("body",$(document)),this.waitingMessage=$.tmpl(e).appendTo("body",$(document));else{var t="sharepoint"===this.params.context,i=this.params.canvas;t&&(i=bizagi.util.scrollTop(i)).context||(i=$("body",$(document)));var r=this.getSize(),a=this.getOffset();r.height==$(window).height()&&(a.top=0),this.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo(i),this.waitingMessage=$.tmpl(e).appendTo(i),this.waitingOverlay.css({height:"100%",width:"100%","min-height":r.height,"min-width":r.width}),this.waitingMessage.css({top:a.top+Math.ceil((r.height-this.waitingMessage.outerHeight())/2)+"px",left:Math.ceil((r.width-this.waitingMessage.outerWidth())/2)+"px"}),i.css("position","relative")}},endLoading:function(){if(this.waitingOverlay&&this.waitingMessage){this.waitingOverlay.remove(),this.waitingMessage.remove(),this.waitingOverlay=null,this.waitingMessage=null;var e=this.params.canvas;null!=e&&e.css("position","")}},getFocusedElement:function(){return this.focus},setFocusedElement:function(e){this.focus=e},triggerGlobalHandler:function(e,t){return this.triggerHandler("globalHandler",{eventType:e,data:t})},failHandler:function(e){try{e=JSON.parse(e)}catch(e){}if(e&&e.length&&e.length>1&&(e=e[0]),e.error&&(e=e.error),e.error&&(e=e.error),"object"==_typeof(e)&&e.message)e="WaitForCompletionPlanException"===e.errorType||"InvalidPlanStateException"===e.errorType||"CustomMessageException"===e.errorType?bizagi.localization.getResource(e.message):e.message;else if("string"==typeof e)try{var t=JSON.parse(e);"WaitForCompletionPlanException"!==t.errorType&&"InvalidPlanStateException"!==t.errorType&&"CustomMessageException"!==e.errorType||(t.message=bizagi.localization.getResource(t.message)),e=t.message}catch(e){}this.addErrorMessage(e),this.endLoading()},resize:function(e){this.setSize(e)},setSize:function(e){this.size=e},getSize:function(){if(this.size)return this.size;var e=this.params.canvas?this.params.canvas:this.getFormContainer().container;return{width:e.width(),height:e.height()}},getOffset:function(){return this.getFormContainer().container.offset()},submitData:function(e){var t=this;if(!bizagi.util.isNativeMobileDevice()||this.allowOnlineActions()){var i=t.collectRenderValuesForSubmit(),r=bizagi.util.isOfflineForm({context:t});if(r&&t.properties&&!t.properties.idPageCache&&(t.properties.idPageCache=""),$.each(i,(function(e,i){var r=t.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))})),!$.isEmptyObject(i)){var a=[],n=null,o=null;return i&&i.deferreds&&(n=$.when.apply($,i.deferreds),a.push(n),delete i.deferreds),o=r?t.dataService.submitData({action:t.isRefreshingAfterSync?"submitdata":"save",data:i,xpathContext:t.properties.xpathContext,contexttype:t.properties.contexttype||"",isOfflineForm:r,offlineType:t.params.offlineType,idCase:t.params.idCase,idWorkitem:t.params.idWorkitem}):t.dataService.multiaction().submitData({action:"SUBMITDATA",data:i,idPageCache:t.properties.idPageCache,xpathContext:t.properties.xpathContext,contexttype:t.properties.contexttype||""}),$.when.apply($,a).then((function(){return $.when(o).fail((function(e){e=t.processFailMessage(e)}))}))}t.isOfflineRefreshWithEdition=!1}},executeRule:function(e){var t=this,i=t.properties,r=e.xpathContext,a=$.Deferred();return""!==i.xpathContext&&(r=""!==r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeRule({idPageCache:i.idPageCache,rule:e.rule,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){var i=e&&e.type?e.type:"",r=t.getFormContainer();t.getFormContainer().clearValidationMessages({clearOnlyServer:!0}),["validationMessages","alertMessages"].includes(i)?("alertMessages"===i?bizagi.modalError&&bizagi.modalError.show(e.messages.join("\n\n"),"workportal-general-word-information",!1):r.addValidationMessage.apply(t,[e.messages,void 0,void 0,void 0,!1,"serverMessage"]),a.reject(e)):a.resolve(e)})).fail((function(e){e=t.processFailMessage(e),a.reject(e)})),a.promise()},executeInterface:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeInterface({idPageCache:i.idPageCache,interface:e.interface,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executeSAPConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeSAPConnector({idPageCache:i.idPageCache,guidsap:e.guidsap,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executeConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeConnector({idPageCache:i.idPageCache,guidConnector:e.guidConnector,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executePipeline:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executePipeline({idPageCache:i.idPageCache,pipeline:e.pipeline,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},refreshActions:function(e){this.actionController.refreshActions(e)},tryToExecuteFunction:function(e){"execution"==this.getMode()&&this.actionController&&this.actionController.tryToExecuteFunction(e)},removeActions:function(){this.actionController.unbindActions()},collectRenderValuesForSubmit:function(e){var t=this;return e=e||{},t.collectRenderValues(e),$.each(e,(function(e,i){var r=t.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))})),e},internalSubmitOnChange:function(e){var t=this,i=(e=e||{}).properties,r=new $.Deferred,a=e.data||{},n=void 0===e.bRefreshForm||e.bRefreshForm;(e.notCollect?e.notCollect:void 0)&&!$.isEmptyObject(a)||t.collectRenderValuesForSubmit(a),t.startLoading();var o=null;return a.deferreds&&(o=$.when.apply($,a.deferreds),delete a.deferreds),$.when(o).then((function(){t.dataService.multiaction().submitData({action:"SUBMITONCHANGE",data:a,idRender:i.id,xpath:i.xpath,xpathContext:t.properties.xpathContext,idPageCache:i.idPageCache,contexttype:i.contexttype}).done((function(e){if(t.cancelPreviousRequest(),t.endLoading(),e&&"validationMessages"==e.type)"function"==typeof t.clearValidationMessages&&t.clearValidationMessages(),t.addValidationMessage(e.messages),r.resolve();else if(n){var a={id:i.id,xpath:i.xpath};void 0!==i.idCase&&$.extend(a,{idCaseObject:bizagi.cache.idCaseObject}),e.IdScope&&(t.properties.idStartScope=e.IdScope),$.when(t.refreshForm(a)).done((function(){r.resolve()})).fail((function(){r.resolve()}))}else r.resolve()})).fail((function(e){t.endLoading();var i="object"==_typeof(e)?e.responseText?JSON.parse(e.responseText):e:{},a=i.message||e,n=i.type||"error";["not-processed","not-shown"].includes(n)||(t.validationController.clearValidationMessages(),"alert"===i.type?t.validationController.showAlertMessage(a):t.validationController.showErrorMessage(a)),r.resolve()}))})),r.promise()},cancelPreviousRequest:function(){if(bizagi.multiactionConnection&&bizagi.multiactionConnection.length)for(var e,t=bizagi.multiactionConnection.length,i=0;i<t;i++)(e=bizagi.multiactionConnection.pop())&&e.abort&&(bizagi.showErrorAlertDialog=!1,e.abort())},prepareCheckpointAction:function(e){var t=this.dataService.sendCheckpoint({url:this.properties.checkpointUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0});return t.tag="checkpoint",t},prepareCommitAction:function(e){var t=this.dataService.commitLinkForm({url:this.properties.commitUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0});return t.tag="commit",t},sendRollbackAction:function(e){this.dataService.rollbackLinkForm({url:this.properties.rollbackUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache})},dispose:function(){var e=this;e.endLoading();var t=setTimeout((function(){e.params&&delete e.params.canvas,delete e.params,delete e.control,e.validationController&&(e.unbind("rendervalidate"),delete e.validationController),e.actionController&&(e.actionController.unbindActions(),delete e.actionController),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()},getButton:function(e){return $(".ui-bizagi-button[data-id='"+e+"']",this.container)},getFloatingButton:function(e){return $("li[data-id='"+e+"']",this.container)},propagateExternalEvents:function(e){$(".bz-overflow-menu")&&$(document).trigger("click.overflow"),$(".jquery-image-zoom")&&"block"==$(".jquery-image-zoom").css("display")&&$("div.jquery-image-zoom a").click()},getButtonAction:function(e){return this.allowValidateAndSaveAction&&"validate"===e?"save":e},isConnected:function(){return!0},configureNetworkHandlers:function(){this.online=bizagi.util.isConnected(),this.isOfflineForm&&bizagi.util.isMobileDevice()&&"debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase()&&(this.online=this.getParams().online,console.log("CONNECTED: ",this.online)),(bizagi.util.isNativeMobileDevice()||bizagi.util.isMobileDevice()&&"debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase())&&($(document).off("online.form"),$(document).on("online.form",this.handleConnectionChange.bind(this)),$(document).off("offline.form"),$(document).on("offline.form",this.handleConnectionChange.bind(this)),$(document).off("offline-notify-form-sync-event"),$(document).on("offline-notify-form-sync-event",this.handleOfflineSyncEvent.bind(this)))},handleConnectionChange:function(e){var t=this.getFormContainer();bizagi.util.isMobileDevice()&&"debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase()?this.online="online"===e.type:this.online=bizagi.util.isConnected(),"offline"===e.type&&t.triggerHandler("offlineForm"),"online"===e.type&&t.triggerHandler("onlineForm")},handleOfflineSyncEvent:function(e,t){var i=this,r=i.params||{};if(!r.hasSyncError){var a=r.idCase+"-"+r.idWorkitem;switch(t.type){case"download-form-success":var n=t.idCase+"-"+t.idWorkitem;a===n&&(console.log("Form downloaded successfully. It will be refreshed",t),$.when(i.dataService.database.validateLocalDataForTaskExists(n).then((function(e){!0===e&&(i.isOfflineRefreshWithEdition=!0),$.when(i.refreshForm(null,!1)).then((function(){o(!1)}))}))));break;case"push-tasks-started":null!=t.tasks&&t.tasks[a]&&o(!0);break;case"push-tasks-error":o(!1),null!=i.validationController&&(i.validationController.clearValidationMessages(),i.validationController.showErrorMessage(t.message));break;case"fetch-tasks-started":null!=t.tasks&&t.tasks[a]&&o(!0);break;case"download-finished":case"download-error":o(!1);break;default:console.warn("Event hast not implementation in bizagi.rendering.form - handleOfflineSyncEvent",t.type,t)}}function o(e){if(e?!(!0===i.isSyncLoaderRunning):!0===i.isSyncLoaderRunning){i.isSyncLoaderRunning=e;for(var t=0;t<3;t++)e?bizagi.loading.start():bizagi.loading.stop()}}},allowOnlineActions:function(){return void 0===this.online||(this.online||!this.online&&this.isOfflineForm)},processQuickButton:function(e){var t=this,i=t.buttons.find((function(t){return t.ordinal==e}));i&&(t.startLoading(),t.lastActionButton=i,"next"===i.action&&(i.routingDisabled=t.isRoutingDisabled),setTimeout((function(){$.when(t.processButton(i)).always((function(){t.processDefer=void 0,t.endLoading()}))}),100))},hasQuickActions:function(e,t){return!!t&&(e.buttons||[]).some((function(e){var t=e.button.properties;return t&&"quickactions"===t.type}))},getValidationsContainer:function(e){return(void 0!==e?e:this).container},getConfirmationStatus:function(e,t){var i=bizagi.util.parseBoolean(t.needsUserConfirmation)||!1,r=t.userConfirmationMessage||"",a=bizagi.util.parseBoolean(e.needsUserConfirmation)&&bizagi.util.parseBoolean(t.routing),n=e.userConfirmationMessage||"";return{hasConfirmation:i||a,message:i?r:n}},saveWorkInProgress:function(){var e=this.collectRenderValuesForSubmit();return bizagi.util.isEmpty(e)?$.Deferred().resolve(void 0).promise():this.dataService.submitData({action:"submitdata",data:e,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,idForm:this.properties.id,prepare:!0,idCase:this.params.idCase,idWorkitem:this.params.idWorkitem,isOfflineForm:this.isOfflineForm||!1,offlineType:this.params.offlineType||"",actions:[]})},isStartForm:function(){var e=this.getFormContainer(),t=e&&e.properties&&e.properties.formtype||"";return/startform/i.test(t)}}),$.Class.extend("bizagi.rendering.formTemplate",{init:function(e){this._super(e),e.paramsRender&&e.paramsRender.contextEvent&&(self.contextEvent=e.paramsRender.contextEvent)},processTemplate:function(e,t){var i=e.replace(/\{\{(((repeater)\s*(\{["':,-\[\]\w\s]*\}))|([\/repeater]+:item)|(\/repeater)|(repeater)|(separator))\}\}/g,"");return i=(i=i.replace(/\{\{([\w:]*)\s*(\{["':,-\[\]\w\s]*\})\}\}/g,(function(e,i,r,a,n){var o=JSON.parse(r);return t[o.id]||""}))).replace(/{{([\w:]*)\s*}}/g,(function(){return""}))},renderContainer:function(){var e=this,t=e.getRenderByType("layout"),i=t.length>0?t[0]:{},r="function"==typeof i.getTemplate?i.getTemplate():"",a="function"==typeof i.getCss?i.getCss():"",n=e.getMode(),o=e.properties.layoutguid||Math.guid(),s={};return i.children&&$.each(i.children,(function(t,i){if("execution"!=n||"layoutPlaceholder"!=i.properties.type){var r=i.getElementType();r==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(s[i.properties.id]=i.renderElement()),r==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(s[i.properties.id]=i.renderContainerHtml()),e.childrenHash[i.properties.uniqueId]=i}})),bizagi.util.loadStyle(a,o),e.processTemplate(r,s)},getContextEvent:function(){return self.contextEvent}}),$.Class.extend("bizagi.rendering.layout",{},{getTemplate:function(){var e=this.getMode(),t=this.properties.html||"";return"design"==e&&t&&(t="<div class='bz-design-template'>"+t+"</div>"),bizagi.util.stripslashes(t)},getCss:function(){var e=this.properties.css||"";return"design"==this.getMode()&&(e=e&&e.desktop),bizagi.util.stripslashes(e)},postRenderContainer:function(e){var t=this.getMode();this.renderingDeferred&&this.renderingDeferred.resolve(),this.container=e,this.executeChildrenPostRender(e),"execution"==t&&this.configureHandlers(),"design"==t&&this.configureDesignView(),"layout"==t&&(this.configureDesignView(),this.configureLayoutView())}}),$.Class.extend("bizagi.rendering.mobileform",{},{init:function(e){var t=e.data,i=bizagi.util.detectDevice();this.rendersById={},this.rendersByXpath={},this.rendersByType={},this.idPageCache=t.pageCacheId,this.mode=e.mode||"execution",this.focus=e.focus,this.params=e,this._super(e);var r="";r="desktop"!==i?this.getResource("render-form-user-confirmation-message").replace(/<br(\/| \/)>/g,"\n"):this.getResource("render-form-user-confirmation-message");var a=this.properties;a.sessionId=t.sessionId,a.displayAsReadOnly=bizagi.util.parseBoolean(t.displayAsReadOnly)||!1,a.userConfirmationMessage=a.userConfirmationMessage||r,a.orientation=a.orientation||"ltr",a.hasRule=bizagi.util.parseBoolean(a.hasRule)||!1,a.contexttype=e.contexttype||"",a.paramsRender=e.paramsRender||{},a.processPath=e.data.processPath?e.data.processPath.replaceAll("/","  &rsaquo;  "):"",a.breadCrumb=e.data.processPath?e.data.processPath.split("/"):[],this.validations=t.validations,this.actions=t.actions,this.initializeButtons(t),t.transitions&&(this.transitions=t.transitions),this.originalProcessButton=this.processButton},initializeButtons:function(e){var t=this;t.buttons=[],e.buttons&&$.each(e.buttons,(function(e,i){var r=i.button.properties;r.caption=bizagi.util.isEmpty(r.caption)||t.getResource(r.caption)==r.caption?r.caption:t.getResource(r.caption),r.actions&&$.each(r.actions,(function(e,t){r[t]=!0})),r.ordinal=e,r.action=r.next?"next":r.submitData?"save":r.cancel?"cancel":r.back?"back":r.createnewcase?"createnewcase":r.validate?"validate":"",r.save="save"==r.action,(r.next||r.back)&&(r.routing=!0),r.hasRule&&(r.executeRule=!0),r.style=t.buildButtonStyle(r),"rtl"!==t.properties.orientation||t.properties.useCustomButtons?t.buttons.push(r):t.buttons.unshift(r)}))},getParams:function(){return this.params},setParam:function(e,t){this.params&&(this.params[e]=t)},getMode:function(){return this.mode},getCustomHandlers:function(){if(this.params)return this.params.customHandlers},registerRender:function(e){this.rendersById[e.properties.id]=e,e.properties.xpath&&(this.rendersByXpath[e.properties.xpath]||(this.rendersByXpath[e.properties.xpath]=[]),this.rendersByXpath[e.properties.xpath].push(e)),this.rendersByType[e.properties.type]||(this.rendersByType[e.properties.type]=[]),this.rendersByType[e.properties.type].push(e)},unregisterRender:function(e){if(this.rendersById[e.properties.id]&&delete this.rendersById[e.properties.id],e.properties.xpath)if($.isArray(this.rendersByXpath[e.properties.xpath])&&this.rendersByXpath[e.properties.xpath].length>1)for(var t=0,i=this.rendersByXpath[e.properties.xpath].length;t<i;t++){if(this.rendersByXpath[e.properties.xpath][t].properties.id===e.properties.id){this.rendersByXpath[e.properties.xpath].splice(t,1);break}}else delete this.rendersByXpath[e.properties.xpath];if(e.properties.type){var r=this.getRenderByType(e.properties.type),a=r.length,n=e.properties.id||e.properties.xpath;for(t=0;t<a;t++){var o=r[t];if(void 0!==o.properties.id&&o.properties.id==n||void 0!==o.properties.xpath&&o.properties.xpath==n){this.rendersByType[e.properties.type].splice(t,1);break}}}},getRenderById:function(e){return this.rendersById[e]},getRenders:function(e){return e&&e.indexOf&&e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),this.rendersByXpath[e]?this.rendersByXpath[e]:[]},getRenderByType:function(e){return"string"==typeof e&&e.length>0&&this.rendersByType[e]?this.rendersByType[e]:[]},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("form"),i=$.fasttmpl(t,{buttons:this.buttons,transitions:this.transitions,uniqueId:e.uniqueId,helptext:e.helpText,mode:this.getMode(),queryForm:"queryForm"==this.getFormType(),summaryForm:this.params.summaryForm||!1,globalForm:this.properties.displayAsReadOnly||!1,idCase:"",displayName:this.params.displayName||"",processPath:e.processPath,breadCrumb:e.breadCrumb,orientation:e.orientation});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){var t=this.getMode();e.addClass("ui-bizagi-rendering-mode-"+t),this._super(e)},configureHandlers:function(){var e,t=this,i=t.container;i.length>1?$(i).each((function(){$(this).hasClass("ui-bizagi-container-complexgateway")&&(e=this)})):e=$(".ui-bizagi-container-complexgateway",i),t.activeTransitions={},t.processButtons(i),t.bind("ondomincluded",(function(e,i){t.validationController=new bizagi.command.controllers.validation(t,t.validations,i),t.actionController=new bizagi.command.controllers.action(t,t.actions),t.readyDeferred.resolve()})),$(e).find(".ui-checkbox").bind("click",(function(){var e=$("label",this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),bizagi.util.parseBoolean(e.data("checked"))?(e.removeClass("ui-checkbox-state-checked"),e.removeClass("bz-check").addClass("bz-full-ball"),e.data("checked",!1),t.activeTransitions[i]=!1):(e.addClass("ui-checkbox-state-checked"),e.addClass("bz-mo-icon").addClass("bz-check").removeClass("bz-full-ball"),e.data("checked",!0),t.activeTransitions[i]=!0)}))},configureDesignView:function(){var e=this;e.container;e.bind("ondomincluded",(function(){e.readyDeferred.resolve()}))},buildButtonStyle:function(e){var t={};if(e.format){if(e.format.size&&"0"!=e.format.size){var i=100+10*Number(e.format.size)+"%";t["font-size"]=i+" !important"}if(e.format.bold&&(t["font-weight"]="bold !important",bizagi.util.isIE()&&(t["font-family"]="'Open Sans', 'Helvetica Neue', Arial, Helvetica, sans-serif !important")),e.format.italic&&(t["font-style"]="italic !important"),e.format.underline||e.format.strikethru){var r=bizagi.util.parseBoolean(e.format.strikethru)?"line-through ":"",a=bizagi.util.parseBoolean(e.format.underline)?"underline ":"";t["text-decoration"]=r+a+" !important"}e.format.background&&(t["background-color"]=e.format.background+" !important",t["background-image"]="none !important"),e.format.color&&(t.color=e.format.color+" !important")}var n="";for(key in t)n+=key+":"+t[key]+";";return n},render:function(){return this.readyDeferred||(this.readyDeferred=new $.Deferred),this._super()},ready:function(){return this.readyDeferred.promise()},getXpathContext:function(){return this.properties.xpathContext||""},getContextType:function(){return this.properties.contexttype||""},getEndPointAction:function(){if("startform"==this.properties.formtype)return"LOADSTARTFORM"},getPageCache:function(){return this.idPageCache},getFormContainer:function(){return this},processButtons:function(){var e=this,t=e.getButtons();t&&0!=t.length&&t.on("click",(function(t){t.preventDefault(),t.stopImmediatePropagation(),e.startLoading();var i=$(this).attr("ordinal"),r=e.buttons[i];e.lastActionButton=r,setTimeout((function(){$.when(e.processButton(r)).always((function(){e.processDefer=void 0,e.endLoading()}))}),100)}))},preProcessButton:function(e){return!0},postProcessButton:function(e,t){return!0},processButton:function(e){var t=this,i=$.Deferred(),r=t.properties;e.routing||bizagi.chrono.initAndStart("submitForm"),bizagi.chrono.init("waiting"),t.validationController.clearValidationMessages();var a=t.getFormContainer(),n=$.Deferred(),o=a.getRenderByType("tabItem"),s=o.length;a.innerTabsLoading=!0;for(var l=0;l<s;l++){var d=o[l];d.loadingDeferred&&d.parent.container&&d.loadingDeferred.resolve()}return delete a.innerTabsLoading,n.resolve(),$.when(t.ready(),n.promise()).done((function(){!bizagi.util.parseBoolean(e.validate)||t.validationController.performValidations()?("save"!==e.action&&"next"!=e.action&&"back"!=e.action&&"createnewcase"!=e.action||t.isOfflineForm||$(document).data("auto-save",""),bizagi.util.parseBoolean(t.properties.needsUserConfirmation)&&bizagi.util.parseBoolean(e.routing)?(t.endLoading(),$.when(bizagi.showConfirmationBox(r.userConfirmationMessage,null,!1)).done((function(){t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done((function(){i.resolve()})))})).fail((function(){i.reject()}))):t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done((function(){$(document).trigger("FORMACTION",e),i.resolve()})).fail((function(){i.reject(arguments)})))):(t.endLoading(),e.submitData&&$.when(t.submitData()).done((function(){i.reject()})),t.validationController.expandNotificationBox());var a=t.getCustomHandler("afterFormButtonClick");a&&a(e)})),i.promise()},validateForm:function(){return this.validationController.clearValidationMessages(),this.validationController.performValidations()},saveForm:function(){var e=this,t=bizagi.util.isOfflineForm({context:e}),i=e.collectRenderValuesForSubmit(),r=null;return i.deferreds&&(r=$.when.apply($,i.deferreds),delete i.deferreds),$.when(r).pipe((function(){return e.startLoading(),$.when(e.dataService.submitData({action:"SAVE",data:i,idCase:e.params.idCase,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,isOfflineForm:t||!1})).always((function(){e.endLoading()}))}))},submitForm:function(e){var t=this,i=$.Deferred(),r=bizagi.util.isOfflineForm({context:t});return $.when(t.isReadyToSave()).done((function(){r?t.internalSubmitFormOffline(e):$.when(t.internalSubmitForm(e)).done((function(){i.resolve()})).fail((function(){i.reject(arguments)}))})).fail((function(){t.endLoading(),bizagi.log("The form is not saved, no changes were found"),i.reject()})),i.promise()},checkWidgetsData:function(){},isComplexGatewayPainted:function(){return!1},getLastActionButton:function(){return this.lastActionButton},internalSubmitFormOffline:function(e){var t,i=this,r="",a=bizagi.util.isOfflineForm({context:i});if(a&&i.properties&&!i.properties.idPageCache&&(i.properties.idPageCache=""),(e.submitData||e.executeRule)&&(t=i.collectRenderValuesForSubmit()),i.transitions){var n=[];if($.each(this.activeTransitions,(function(e,t){t&&n.push(e)})),0==bizagi.util.countProps(n))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),""}$.when(i.dataService.submitData({action:e.action,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0,transitions:n||"",idCase:i.params.idCase,idWorkitem:i.params.idWorkitem,isOfflineForm:a||!1})).done((function(t){i.postProcessButton(t,e)&&(e.routing?(i.triggerHandler("routing",{offlineAction:e.action,idCase:i.params.idCase,idWorkitem:i.params.idWorkitem}),$(document).trigger("tryPushData.offline")):(r=bizagi.util.isValidResource("workportal-mobile-offline-form-successful")?bizagi.localization.getResource("workportal-mobile-offline-form-successful"):"Saved",bizagi.util.showNotification({text:r,type:"success"})))})).fail((function(e){r=bizagi.util.isValidResource("workportal-mobile-offline-successful-fail")?bizagi.localization.getResource("workportal-mobile-offline-successful-fail"):"Not saved",bizagi.util.showNotification({text:r,type:"error"})}))},internalSubmitForm:function(e){var t,i=this,r=$.Deferred();(e.submitData||e.executeRule||e.createnewcase)&&(t=i.collectRenderValuesForSubmit()),$.when(i.startLoading()).done((function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")}));var a=null,n=null,o=null,s=null,l=null;if(e.executeRule&&((a=i.dataService.submitData({action:"SUBMITDATA",data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0})).tag="submitData",s=i.prepareCheckpointAction(e.id),t={},(n=i.dataService.executeButton({idRender:e.id,xpathContext:i.properties.xpathContext||"",idPageCache:i.properties.idPageCache,prepare:!0})).tag="executeRule",l=i.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase){if(i.transitions){var d=[];if($.each(this.activeTransitions,(function(e,t){t&&d.push(e)})),0==bizagi.util.countProps(d))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),r.reject(),r.promise()}(o=i.dataService.submitData({action:e.action,forcePlanCompletion:e.forcePlanCompletion,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0,transitions:d||"",contexttype:i.properties.contextType,surrogatekey:i.properties.surrogateKey})).tag="performAction"}var c=[];n&&(c.push(a),c.push(s),c.push(n),c.push(l)),o&&c.push(o),bizagi.chrono.initAndStart("submitForm-ajax");var u=new $.Deferred;return t&&t.deferreds?$.when.apply(this,t.deferreds).done((function(e){u.resolve(e)})).fail((function(){u.reject(),console.log("Error: It was not possible resolve async actions on form ")})):u.resolve(),$.when(u).done((function(){$.when(i.dataService.multiaction().execute({actions:c})).done((function(t){var a;if(bizagi.chrono.stop("submitForm-ajax"),i.endLoading(),$.each(t,(function(e,t){"validationMessages"==t.result.type&&(i.addValidationMessage(t.result.messages),a=!0)})),a)e.executeRule&&i.sendRollbackAction(e.id);else{if(!i.postProcessButton(t,e))return;e.refresh&&i.refreshForm(),e.routing&&i.triggerHandler("routing",{idCase:i.params.idCase}),e.createnewcase&&t.length>0&&i.triggerHandler("routing",{idCase:t[0].result.IdCase,caseNumber:t[0].result.CaseNumber})}r.resolve()})).fail((function(t,a,n){e.executeRule&&i.sendRollbackAction(e.id),n&&n.error&&("WaitForCompletionPlanException"===n.error.errorType||"InvalidPlanStateException"===n.error.errorType||"CustomMessageException"===n.error.errorType)?(i.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(n.error.message),null,!1)).then((function(){return $.when(i.internalSubmitForm($.extend({},e,{forcePlanCompletion:!0})))})).done((function(){r.resolve()})).fail((function(){r.reject()}))):(i.failHandler(n),r.reject(n))}))})),r.promise()},addValidationMessage:function(e,t,i,r,a,n){var o=this;o.validationController||(o.validationController=new bizagi.command.controllers.validation(o)),"string"==typeof e?o.validationController.showValidationMessage(e,t,i,r,n):$.each(e,(function(e,a){o.validationController.showValidationMessage(a,t,i,r,n)})),o.validationController.expandNotificationBox(a)},clearValidationMessages:function(e){this.validationController&&this.validationController.clearValidationMessages(e)},addErrorMessage:function(e){this.validationController.showErrorMessage(e),this.validationController.expandNotificationBox()},refreshForm:function(e){var t=this,i=t.properties,r=$.Deferred();(e=e||t.getFocus())&&!e.id&&(e={id:e});var a={idCase:t.params.idCase||"",idWorkitem:t.params.idWorkitem||"",idTask:t.params.idTask||"",focus:e,selectedTabs:t.getSelectedTabs(),xpathContext:i.xpathContext,idPageCache:i.idPageCache,isRefresh:!0,contextType:t.getContextType()||"",action:t.getEndPointAction(),idStartScope:t.properties.idStartScope||""};return t.startLoading(),$.when(t.triggerHandler("refresh",a)).done((function(){t.endLoading(),r.resolve()})).fail((function(){t.endLoading(),r.reject()})),r.promise()},getSelectedTabs:function(){for(var e=this.getElementsByType("tab"),t=$.map(e,(function(e){return{tab:e.properties.id,selected:e.activeTab}})),i={},r=0,a=t.length;r<a;r++)i[t[r].tab]=t[r].selected;return i},getButtons:function(){},addSubmitAction:function(e,t){this.actionController.processInternalSubmitAction(e,t)},startLoading:function(){var e=this.renderFactory.getTemplate("form-waiting");if(!this.waitingOverlay||!this.waitingMessage)if(bizagi.util.isTabletDevice())this.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo("body",$(document)),this.waitingMessage=$.tmpl(e).appendTo("body",$(document));else{var t="sharepoint"===this.params.context,i=this.params.canvas;t&&(i=bizagi.util.scrollTop(i)).context||(i=$("body",$(document)));var r=this.getSize(),a=this.getOffset();r.height==$(window).height()&&(a.top=0),this.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo(i),this.waitingMessage=$.tmpl(e).appendTo(i),this.waitingOverlay.css({height:"100%",width:"100%","min-height":r.height,"min-width":r.width}),this.waitingMessage.css({top:a.top+Math.ceil((r.height-this.waitingMessage.outerHeight())/2)+"px",left:Math.ceil((r.width-this.waitingMessage.outerWidth())/2)+"px"}),i.css("position","relative")}},endLoading:function(){if(this.waitingOverlay&&this.waitingMessage){this.waitingOverlay.remove(),this.waitingMessage.remove(),this.waitingOverlay=null,this.waitingMessage=null;var e=this.params.canvas;null!=e&&e.css("position","")}},getFocusedElement:function(){return this.focus},setFocusedElement:function(e){this.focus=e},triggerGlobalHandler:function(e,t){return this.triggerHandler("globalHandler",{eventType:e,data:t})},failHandler:function(e){try{e=JSON.parse(e)}catch(e){}if(e.length&&e.length>1&&(e=e[0]),e.error&&(e=e.error),"object"==_typeof(e)&&e.message)e="WaitForCompletionPlanException"===e.errorType||"InvalidPlanStateException"===e.errorType||"CustomMessageException"===e.errorType?bizagi.localization.getResource(e.message):e.message;else if("string"==typeof e)try{var t=JSON.parse(e);"WaitForCompletionPlanException"!==t.errorType&&"InvalidPlanStateException"!==t.errorType&&"CustomMessageException"!==e.errorType||(t.message=bizagi.localization.getResource(t.message)),e=t.message}catch(e){}this.addErrorMessage(e),this.endLoading()},resize:function(e){this.setSize(e)},setSize:function(e){this.size=e},getSize:function(){if(this.size)return this.size;var e=this.params.canvas?this.params.canvas:this.getFormContainer().container;return{width:e.width(),height:e.height()}},getOffset:function(){return this.getFormContainer().container.offset()},submitData:function(e){var t=this,i=t.collectRenderValuesForSubmit();if(bizagi.util.isOfflineForm({context:t})&&t.properties&&!t.properties.idPageCache&&(t.properties.idPageCache=""),$.each(i,(function(e,i){var r=t.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))})),!$.isEmptyObject(i))return $.when(t.dataService.multiaction().submitData({action:"SUBMITDATA",data:i,idPageCache:t.properties.idPageCache,xpathContext:t.properties.xpathContext,contexttype:t.properties.contexttype||""})).fail((function(e){e=t.processFailMessage(e)}))},executeRule:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeRule({idPageCache:i.idPageCache,rule:e.rule,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages({clearOnlyServer:!0}),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage.apply(t,[e.messages,void 0,void 0,void 0,!1,"serverMessage"])})).fail((function(e){e=t.processFailMessage(e)}))},executeInterface:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeInterface({idPageCache:i.idPageCache,interface:e.interface,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executeSAPConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeSAPConnector({idPageCache:i.idPageCache,guidsap:e.guidsap,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executeConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeConnector({idPageCache:i.idPageCache,guidConnector:e.guidConnector,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},refreshActions:function(e){this.actionController.refreshActions(e)},removeActions:function(){this.actionController.unbindActions()},collectRenderValuesForSubmit:function(e){var t=this;return e=e||{},t.collectRenderValues(e),$.each(e,(function(e,i){var r=t.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))})),e},internalSubmitOnChange:function(e){var t=this,i=(e=e||{}).properties,r=new $.Deferred,a=e.data||{},n=void 0===e.bRefreshForm||e.bRefreshForm;(e.notCollect?e.notCollect:void 0)&&!$.isEmptyObject(a)||t.collectRenderValuesForSubmit(a),t.startLoading();var o=null;return a.deferreds&&(o=$.when.apply($,a.deferreds),delete a.deferreds),$.when(o).then((function(){t.dataService.submitData({action:"SUBMITONCHANGE",data:a,idRender:i.id,xpath:i.xpath,xpathContext:t.properties.xpathContext,idPageCache:i.idPageCache,contexttype:i.contexttype}).done((function(e){if(t.cancelPreviousRequest(),t.endLoading(),e&&"validationMessages"==e.type)"function"==typeof t.clearValidationMessages&&t.clearValidationMessages(),t.addValidationMessage(e.messages),r.resolve();else if(n){var a={id:i.id,xpath:i.xpath};void 0!==i.idCase&&$.extend(a,{idCaseObject:bizagi.cache.idCaseObject}),e.IdScope&&(t.properties.idStartScope=e.IdScope),$.when(t.refreshForm(a)).done((function(){r.resolve()})).fail((function(){r.resolve()}))}else r.resolve()})).fail((function(e){t.endLoading();var i=JSON.parse("object"==_typeof(e)&&e.responseText?e.responseText:{})||{},a=i.message||e;t.validationController.clearValidationMessages(),"alert"==i.type?t.validationController.showAlertMessage(a):t.validationController.showErrorMessage(a),r.resolve()}))})),r.promise()},cancelPreviousRequest:function(){if(bizagi.multiactionConnection&&bizagi.multiactionConnection.length)for(var e,t=bizagi.multiactionConnection.length,i=0;i<t;i++)(e=bizagi.multiactionConnection.pop())&&e.abort&&(bizagi.showErrorAlertDialog=!1,e.abort())},prepareCheckpointAction:function(e){return checkpointAction=this.dataService.sendCheckpoint({url:this.properties.checkpointUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0}),checkpointAction.tag="checkpoint",checkpointAction},prepareCommitAction:function(e){var t=this.dataService.commitLinkForm({url:this.properties.commitUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0});return t.tag="commit",t},sendRollbackAction:function(e){this.dataService.rollbackLinkForm({url:this.properties.rollbackUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache})},dispose:function(){var e=this;e.endLoading(),setTimeout((function(){e.params&&delete e.params.canvas,delete e.params,delete e.control,e.validationController&&(e.unbind("rendervalidate"),delete e.validationController),e.actionController&&(e.actionController.unbindActions(),delete e.actionController)}),bizagi.override.disposeTime||50),e._super()},getButton:function(e){return $(".ui-bizagi-button[data-id='"+e+"']",this.container)}}),$.Class.extend("bizagi.rendering.accordion",{},{initializeData:function(e){this._super(e),$.each(this.children,(function(e,t){t.properties.ordinal=e}))},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("accordion"),i=$.fasttmpl(t,{uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),$.Class.extend("bizagi.rendering.accordionItem",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("accordionItem"),i=$.fasttmpl(t,{id:e.id,ordinal:e.ordinal,displayName:e.displayName,orientation:e.orientation,uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},activate:function(){this.active=!0},getFocus:function(){var e=this._super();return bizagi.util.isEmpty(e)&&this.active&&(e=this.properties.id),e}}),$.Class.extend("bizagi.rendering.collectionnavigator",{},{initializeData:function(e){this._super(e);var t=this.properties;t.allowAdd=void 0===t.allowAdd||bizagi.util.parseBoolean(t.allowAdd),t.withAddForm=t.withAddForm&&t.allowAdd,t.allowEdit=void 0===t.allowEdit||bizagi.util.parseBoolean(t.allowEdit),t.withEditForm=t.withEditForm&&t.allowEdit,t.allowDetail=void 0!==t.allowDetail&&bizagi.util.parseBoolean(t.allowDetail),t.inlineAdd=void 0===t.inlineAdd||bizagi.util.parseBoolean(t.inlineAdd),t.inlineAdd=t.inlineAdd&&t.allowAdd,t.inlineEdit=void 0===t.inlineEdit||bizagi.util.parseBoolean(t.inlineEdit),t.inlineEdit=t.inlineEdit&&t.allowEdit,t.allowDelete=void 0===t.allowDelete||bizagi.util.parseBoolean(t.allowDelete),this.orientation=this.properties.orientation||"ltr",this.data=this.properties.data,this.keys=this.data?this.getKeys(this.data.rows):[],this.pointer=0,this.totalRows=0,this.inlineAddRecords=[],this.data&&(this.totalRows=this.data.rows.length)},getKeys:function(e){for(var t=[],i=0,r=(e=e||[]).length;i<r;i++){var a=e[i];t.push(a[0])}return t},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("collectionnavigator"),i=this.getMode(),r=$.fasttmpl(t,{uniqueId:e.uniqueId,displayName:e.displayName?e.displayName:"",id:e.id,guid:e.guid,showPreview:this.showPreview(),mode:i,orientation:this.getFormContainer().properties.orientation});return r=this.drawControls(r)},renderReadOnly:function(){return this.renderControl()},drawControls:function(e){},drawActions:function(e){},drawControl:function(e){},drawForms:function(e){},drawPreview:function(){var e="execution"===this.getMode()?"collectionnavigator-execution":"collectionnavigator-preview",t=this.renderFactory.getTemplate(e),i=$.tmpl(t);this.canvas.append(i)},hasData:function(){return this.getTotalRows()>0},getRow:function(){return this.keys[this.pointer]},getNextRow:function(){return this.getTotalRows()>this.pointer+1&&(this.pointer+=1),this.getRow()},getPreviousRow:function(){return this.pointer>0&&(this.pointer-=1),this.getRow()},getFirstRow:function(){return this.pointer=0,this.getRow()},getLastRow:function(){return this.pointer=this.keys.length-1,this.getRow()},getTotalRows:function(){return this.keys.length},getIndexes:function(){return this.properties.data.rows},setPointer:function(e){this.pointer=e-1},isTherePendingInlineRow:function(){return this.inlineAddRecords.length>0},addKey:function(e){this.keys.push(e)},removeKey:function(){var e=this.pointer;if(e>=0){this.keys.splice(e,1);var t=this.getTotalRows();t>0&&e>=t&&this.setPointer(t)}},showPreview:function(){var e=this.getMode(),t=this.properties;return"execution"==e?!this.hasData():!bizagi.util.parseBoolean(t.navigationform)},getParameters:function(e){var t={},i=this.properties,r=i.xpath+"[id="+e.id+"]";return t.idRender=i.id,t.recordXPath=r,t.xpathContext=i.xpathContext,t.idPageCache=i.idPageCache,t.requestedForm=e.requestedForm,t.contextType=i.contextType||i.contexttype,t.url=e.url,t.editable=e.editable,i.orientation,t},submitAddRequest:function(){var e=this,t=e.properties;return e.dataService.addGridRecord({url:t.addUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,contexttype:t.contextType||t.contexttype,idPageCache:t.idPageCache,orientation:t.orientation||"ltr"}).pipe((function(t){return e.properties.temporalRecord=!0,t.idEntity})).promise()},submitEditRequest:function(e){var t=this.properties,i=t.xpath+"[id="+e+"]";return this.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType||t.contexttype||"",orientation:t.orientation||"ltr"})},submitDeleteRequest:function(e){var t=this,i=t.properties,r=i.xpath+"[id="+e+"]";return t.dataService.deleteGridRecord({url:i.deleteUrl,idRender:i.id,xpath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType||i.contexttype}).pipe((function(e){if("validationMessages"==e.type){var i=t.getFormContainer(),r=e.messages.join(" ");i.failHandler({message:r})}return e}))},submitSaveRequest:function(e,t){var i=this,r=i.properties,a=$.Deferred(),n=r.xpathContext.length>0?r.xpathContext+"."+r.xpath+"[id="+e+"]":r.xpath+"[id="+e+"]",o=null;return t.deferreds&&(o=$.when.apply($,t.deferreds),delete t.deferreds),$.when(o).then((function(){!bizagi.util.isEmpty(t)||i.properties.temporalRecord?(t.idPageCache=t.idPageCache||i.form.getPageCache(),i.dataService.saveGridRecord({url:r.saveUrl,idRender:r.id,xpath:r.xpath,xpathContext:n,contexttype:r.contextType||r.contexttype||"",submitData:t}).done((function(e){delete i.properties.temporalRecord,a.resolve(e)})).fail((function(e){var t=i.getFormContainer(),r=e.responseText?e.responseText:"string"==typeof e?e:e.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=e);t.validateForm(),t.clearValidationMessages(),t.addValidationMessage(r)}))):a.resolve()})),a.promise()},submitRollbackRequest:function(e){var t=this.properties;return this.dataService.rollbackGridAction({url:t.rollbackUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:e.idPageCache,contexttype:this.properties.contexttype||""})},getRemoteData:function(e){var t=this.properties;return e=e||{},$.extend(e,{url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,contexttype:t.contextType||t.contexttype,idPageCache:t.idPageCache}),this.dataService.getData(e)},isValid:function(e){var t=this.form;return void 0!==t&&this.totalRows>0&&(t.children||[]).forEach((function(t){if(t.properties.visible)if(t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER)t.isValid(e);else if(t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&!t.isValid(e)){var i=e[e.length-1];e[e.length-1]=$.extend(i,{id:t.properties.id})}})),0===e.length},validateControls:function(e){return!!this.form&&this.form.validationController.performValidations(e)}}),$.Class.extend("bizagi.rendering.group",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||"cssClassContainer",t.collapse=!(void 0===t.collapse||!bizagi.util.parseBoolean(t.collapse))},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("group");this.expandedIcon=this.getExpandedIcon(),this.collapsedIcon=this.getCollapsedIcon();var i=$.fasttmpl(t,{expandedClassIcon:this.expandedIcon,displayName:e.displayName,editable:e.editable,orientation:e.orientation,uniqueId:e.uniqueId,collapse:e.collapse,isDesign:"execution"!==this.getMode(),messageValidation:e.messageValidation,cssclass:e.cssclass,guid:e.guid});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},getExpandedIcon:function(){},getCollapsedIcon:function(){},toogleContainer:function(e,t){}}),$.Class.extend("bizagi.rendering.section",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.displayAs=t.displayAs||"section"},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("section-header"),i=$.fasttmpl(t,{displayName:e.displayName,editable:e.editable,orientation:e.orientation,uniqueId:e.uniqueId,isDesign:"execution"!==this.getMode(),messageValidation:e.messageValidation,guid:e.guid});return this.sectionContent=$(this.renderSectionContent())[0],i},renderSectionContent:function(){},getBreadcrumb:function(){for(var e=this,t=[];e;){var i=e.properties||{},r=e.params||{};if("section"===i.type){var a=i.displayName?i.displayName:"";t.unshift(a)}else"form"===r.type&&t.unshift(this.getResourceByKey("render-section-breadcrumb-main-form","Main form"));e=e.parent}return t},getParentDisplayName:function(){var e=this.getSectionParent(this.parent);return"form"==e.properties.type?e.properties.formtype&&"startform"==e.properties.formtype?e.params&&e.params.originalParams&&e.params.originalParams.displayName?e.params.originalParams.displayName:"":e.properties.displayName||e.params.displayName||e.params.radNumber||e.params.idCase:e.properties.displayName||""},getSectionParent:function(e){return"section"!==e.properties.type&&e.parent?this.getSectionParent(e.parent):e},getSectionOrientationRTL:function(e){return!(e&&e.properties&&e.properties.orientation&&"ltr"===e.properties.orientation)&&(!!(e&&e.properties&&e.properties.orientation&&"rtl"===e.properties.orientation)||!!e.parent&&this.getSectionOrientationRTL(e.parent))}}),$.Class.extend("bizagi.rendering.mobilegroup",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||"cssClassContainer",t.collapse=!(void 0===t.collapse||!bizagi.util.parseBoolean(t.collapse))},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("group");this.expandedIcon=this.getExpandedIcon(),this.collapsedIcon=this.getCollapsedIcon();var i=$.fasttmpl(t,{expandedClassIcon:this.expandedIcon,displayName:e.displayName,editable:e.editable,orientation:e.orientation,uniqueId:e.uniqueId,collapse:e.collapse,isDesign:"design"===this.getMode(),messageValidation:e.messageValidation,cssclass:e.cssclass,guid:e.guid});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},getExpandedIcon:function(){},getCollapsedIcon:function(){},toogleContainer:function(e,t){}}),$.Class.extend("bizagi.rendering.horizontal",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("horizontal"),i=$.fasttmpl(t,{uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),$.Class.extend("bizagi.rendering.panel",{},{initializeData:function(e){this._super(e);var t=this.properties;(t.displayName=t.displayName||"","nestedForm"==t.type)&&(this.getFormContainer().rendersById[t.idForm]=this)},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("panel"),i=$.fasttmpl(t,{displayName:e.displayName,loading:e.loading,message:e.message,orientation:e.orientation,uniqueId:e.uniqueId,cssClass:e.cssclass});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){var t=this.properties;t.height&&e.height(t.height),this._super(e)}}),$.Class.extend("bizagi.rendering.contentPanel",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayName=t.displayName||""},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("contentPanel"),i=$.fasttmpl(t,{displayName:e.displayName,mode:this.getMode(),uniqueId:e.uniqueId,isDesign:"design"===this.getMode(),messageValidation:e.messageValidation,cssClass:e.cssclass,guid:e.guid});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){this._super(e)}}),$.Class.extend("bizagi.rendering.searchForm",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("searchForm");"entity"!==e.contexttype&&this.parent&&(e.contexttype="function"==typeof this.parent.getContextType?this.parent.getContextType():"");var i=$.fasttmpl(t,{displayName:e.displayName,uniqueId:e.uniqueId});return i=(i=this.replaceChildrenHtml(i,this.renderChildrenHtml())).replaceFirstWithoutPatterns("{{result}}",this.renderResult())},performSearch:function(e){this.properties.searchParams=e,this.submitSearch()},submitSearch:function(){this.refreshResults()},ready:function(){return this.parent.ready()},getRemoteData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.collectSearchValues();return bizagi.util.isMapEmpty(a)?(bizagi.showMessageBox(this.getResource("render-search-advanced-no-filters"),this.getResource("render-form-dialog-box-search"),"error"),null):(e.rows=i.searchParams&&i.searchParams.maxRecords&&i.searchParams.maxRecords>0?i.searchParams.maxRecords:e.rows,i.searchParams&&void 0!==i.searchParams.maxRows&&(e.rows=i.searchParams.maxRows||e.rows),t.dataService.submitSearch($.extend(e,{url:i.dataUrl,idRender:i.idRender,idPageCache:i.idPageCache,idSearchForm:i.id,allowFullSearch:i.searchParams.allowFullSearch?i.searchParams.allowFullSearch:null,maxRecords:i.searchParams.maxRecords>0?i.searchParams.maxRecords:null,criteria:a})).done((function(e){i.page=e.page,i.records=e.records,i.totalPages=e.totalPages||0,e.records>1e4?(i.deviceMaxRecordsExceeded=!0,e.deviceMaxRecordsExceeded=!0):delete i.deviceMaxRecordsExceeded,r.resolve(e),t.onSearchFinished()})).fail((function(e){if(bizagi.showErrorAlertDialog=!1,e.responseText)try{var t=JSON.parse(e.responseText).message;bizagi.showMessageBox(t,"","error")}catch(e){}r.reject()})),r.promise())},collectSearchValues:function(){var e={};this.collectRenderValues(e);var t=[];for(key in e){var i=key,r=e[key],a=this.getCriteriaOperation(this.getRender(i)),n={};bizagi.util.isEmpty(r)||(n.xpath=i,n.value=r,n.operation=a,t.push(n))}return t},getCriteriaOperation:function(e){var t=this.properties,i="EQUALS";return"15"==e.properties.dataType&&(void 0!==e.properties.typeSearch&&"approx"!==e.properties.typeSearch||(i=t.allowFullSearch?"FULLLIKE":"LIKE")),i},renderResult:function(){},refreshResults:function(){},parseAdditionalProperties:function(e){return 1==e||2==e||3==e||4==e||6==e||7==e||10==e||11==e?{type:"columnNumber"}:29==e?{type:"columnNumberScientificNotation"}:8==e?{type:"columnMoney"}:12==e||13==e?{type:"columnDate"}:5==e?{type:"columnBoolean"}:{type:"columnText"}},onSearchFinished:function(){}}),$.Class.extend("bizagi.rendering.tab",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||""},renderContainer:function(){for(var e=this.properties,t=$.map(this.children,(function(e,t){return e.properties.counter=t,e.properties.tooltip=e.properties.tooltip||e.properties.displayName||"",e.properties})),i=this.renderFactory.getTemplate("tab"),r=this.getMode(),a=$.fasttmpl(i,{id:e.id,tabs:t,mode:r,isDesign:"execution"!==this.getMode(),editable:e.editable,tabOrientation:e.orientation,uniqueId:e.uniqueId,cssclass:e.cssclass}),n=this.activeTab=this.getActiveTab(),o=0,s=this.children.length;o<s;o++)this.children[o].properties.loadOnDemand=o!=n;return a=this.replaceChildrenHtml(a,this.renderChildrenHtml())},getActiveTab:function(){var e=this.properties,t=this.getFormContainer().getParams();"execution"===this.getMode()&&!t.isRefresh&&e.activeTab&&this.getFormContainer().setFocusedElement(e.activeTab);var i=t&&t.selectedTabs?t.selectedTabs:{};if(i[this.properties.id]>=0)return i[this.properties.id];for(var r=0,a=this.children.length;r<a;r++)if(this.children[r].containsFocusedElement())return r;return 0},setActiveTab:function(e){if(this.triggerHandler("selected",{index:e,tab:this.children[e]}),this.children[e]){var t=this.getFormContainer();this.children[e].activate(),this.activeTab=e;var i={};i[this.children[e].parent.properties.id]=e,t.setParam("selectedTabs",i)}}}),$.Class.extend("bizagi.rendering.tabItem",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("tabItem"),i=$.fasttmpl(t,{id:e.id,uniqueId:e.uniqueId,counter:e.counter,tabOrientation:e.orientation,isDesign:"execution"!==this.getMode()});return i=this.renderTabContent(i)},renderTabContent:function(e){return this.replaceChildrenHtml(e,this.renderChildrenHtml())},activate:function(){this.active=!0},getFocus:function(){var e=this._super();return bizagi.util.isEmpty(e)&&this.active&&(e=this.properties.id),e},containsFocusedElement:function(){var e=this.getFormContainer().getFocusedElement();if(e){if(e.xpath){var t=this.getFormContainer().getRenders(e.xpath);$.each(t,(function(t,r){r.properties.id==e.id&&r.properties.editable&&(i=r)}))}else var i=this.getFormContainer().getContainer(e)||this.getFormContainer().getRenderById(e);if(i)for(;i.parent;){if(i.properties.id==this.properties.id||i.parent.properties.id==this.properties.id)return!0;i=i.parent}}return!1}}),$.Class.extend("bizagi.rendering.nestedForm",{},{}),$.Class.extend("bizagi.rendering.layoutRender",{},{renderElement:function(e){var t=this.properties,i=this.getFormContainer();this.renderingDeferred=new $.Deferred,e=e||"render-layout";var r=this.renderFactory.getTemplate(e),a=t.displayName;"string"==typeof a&&(a=bizagi.util.encodeString(a));var n=$.fasttmpl(r,{label:a,isExtendedText:"text"==t.type&&t.isExtended,orientation:t.orientation,uniqueId:t.uniqueId,id:t.id,isDesign:"design"===this.getMode(),messageValidation:t.messageValidation,printVersion:i.params.printversion,cssClass:t.cssclass||"",hide:t.hide}),o=this.internalRenderControl();return o||(o=""),"object"===_typeof(o)&&o.done?"resolved"===o.state()?(n=this.replaceControlHtml(n,this.resolveResult(o)),this.asyncRenderDeferred=null):(this.asyncRenderDeferred=o,n=this.replaceControlHtml(n,"")):n=this.replaceControlHtml(n,o),n},getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=this.element),this.control&&0!=this.control.length?this.control:null},changeFontItalic:function(e){return bizagi.util.parseBoolean(e)?this.getControl().css("font-style","italic","!important"):this.getControl().css("font-style","normal","!important"),this},changeFontUnderline:function(e){var t=this.properties.valueFormat||{},i=bizagi.util.parseBoolean(t.strikethru)?"line-through ":"";return bizagi.util.parseBoolean(e)?this.getControl().css("text-decoration",i+"underline","!important"):this.getControl().find("*").each((function(e,t){$(t).css("text-decoration",i,"!important")})),this}}),$.Class.extend("bizagi.rendering.layoutImage",{},{init:function(e){this._super(e)},renderControl:function(){this.getMode(),this.properties.value;var e=this.renderFactory.getTemplate("layout-image");return $.fasttmpl(e,{useDefaultImage:!0})},getImage64:function(){var e={xpath:this.properties.xpath,entity:this.value.guid,surrogateKey:this.value.surrogateKey,width:96,height:96};return this.dataService.getEntityImage64(e)},getImageUri:function(){var e={entity:this.value.guid,surrogateKey:this.value.surrogateKey,xpath:this.properties.xpath,width:96,height:96,hash:this.value.value};return this.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(e)}}),$.Class.extend("bizagi.rendering.layoutLink",{},{init:function(e){this._super(e)},renderControl:function(){var e=this.renderFactory.getTemplate("layout-link");return $.fasttmpl(e,{displayName:this.properties.displayName})}}),$.Class.extend("bizagi.rendering.layoutLabel",{},{init:function(e){this._super(e),this.properties.required=!1,this.properties.displayType="label",this.properties.labelAlign=this.originalProperties.labelAlign||"left",this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.renderFactory.getTemplate("layout-label"),t=this.properties.displayName||this.properties.value||"";return $.fasttmpl(e,{value:t})}}),$.Class.extend("bizagi.rendering.layoutText",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);this.properties},renderControl:function(){var e=this.renderFactory.getTemplate("layout-text");return $.fasttmpl(e,{value:this.properties.value,editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()}}),$.Class.extend("bizagi.rendering.layoutUpload",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;i.editable=!0,i.allowDelete=!0,i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",i.allowSendInMail=i.allowSendInMail||!1},getValueFilesByData:function(e){var t,i,r=$.Deferred();t=e.value.value?e.value.value:e.value;try{this.isContextContainerWidgetRender()?(i=JSON.parse('{ "files": '+t+"}"),r.resolve(e,i)):$.when(this.getDataFilesWithoutScope()).done((function(t){i=JSON.parse('{ "files": '+t+"}"),r.resolve(e,i)}))}catch(t){i=JSON.parse('{ "files": []}'),r.resolve(e,i),console.warn("Exception converting data files. Error: ",t)}return r.promise()},isContextContainerWidgetRender:function(){var e=this.getFormContainer();return e.params.paramsRender&&e.params.paramsRender.idRender},getDataFilesWithoutScope:function(){var e={xpath:this.properties.xpath,entity:this.value.guid,surrogateKey:this.value.surrogateKey};return this.dataService.getFilesDataForLayoutUploadControl(e)},getValue:function(){return this.files},getUploadXpath:function(){return this.properties.xpath}}),$.Class.extend("bizagi.rendering.layoutBoolean",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e),this.properties.editable=!1},renderControl:function(){var e=this.renderFactory.getTemplate("layout-boolean");return $.fasttmpl(e,{value:this.properties.value})},renderReadOnly:function(){return this.renderControl()},setValue:function(e,t){null===e||""===e?this.properties.value="":"true"!==e.toString().toLowerCase()&&"false"!==e.toString().toLowerCase()||(this.properties.value=bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):this.getResource("render-boolean-no")),this._super(this.properties.value,t)}}),$.Class.extend("bizagi.rendering.layoutDateTime",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("dateFormat"),r=this.getResource("timeFormat");if(t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||i,t.timeFormat=t.timeFormat||r,t.fullFormat=t.dateFormat,t.showTime)-1===t.fullFormat.search(/[h|H]+/gi)&&(t.fullFormat=t.fullFormat+" "+t.timeFormat);else{var a=t.fullFormat.search(/[h|H]+/gi);-1!==a&&(t.fullFormat=t.fullFormat.substring(0,a-1))}if(t.value){var n=bizagi.util.dateFormatter.getDateFromInvariant(t.value,t.showTime);if(0!=n){var o=bizagi.localization.getResource("datePickerRegional");this.value=t.value,t.displayValue=bizagi.util.dateFormatter.formatDate(n,t.fullFormat,o)}else this.value=null}else this.value=null,t.value="",t.displayValue=""},renderControl:function(){var e=this.renderFactory.getTemplate("layout-date-time"),t=null===this.properties.value||""===this.properties.value?"":this.properties.value;return $.fasttmpl(e,{value:t})},setDisplayValue:function(e){var t,i=this.properties,r=this.getDateControl();if(this.i18n=bizagi.localization.getResource("datePickerRegional"),e.length=="MM/dd/yyyy H:mm:ss".length||e.length=="MM/dd/yyyy H:mm:ss".length+1?t=bizagi.util.dateFormatter.getDateFromInvariant(e,!0):!(t=bizagi.util.dateFormatter.getDateFromInvariant(e))||isNaN(Date.parse(t))||$.isNumeric(t)||t.setHours(0,0,0,0),e&&!isNaN(Date.parse(e))){var a=bizagi.util.dateFormatter.formatDate(t,i.fullFormat,this.i18n);r.text(a)}},getDateControl:function(){return this.dateControl=$(".ui-bizagi-render-date-time",this.getControl()),this.dateControl}}),$.Class.extend("bizagi.rendering.layoutNumber",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.getDefaultGroupDigits(t.dataType),t.colorize=t.colorizeOnNegative||!1},renderControl:function(){var e=this.renderFactory.getTemplate("layout-number");return $.fasttmpl(e,{value:this.properties.value})},renderReadOnly:function(){return this.renderControl()},getDisplayValue:function(e){var t=this.properties,i=(this.getControl(),$("<label/>").html(e));return e.toString().match(/[\u20AC \u0024\u00A3]/)||i.formatCurrency({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize}),i.text()},getDefaultAllowDecimals:function(e){if(e){if(1==e||2==e||3==e||4==e||7==e)return!1;if(6==e||8==e||10==e||11==e)return!0}return!1},getDefaultGroupDigits:function(e){if(e){if(1==e||2==e||3==e||4==e||7==e)return!1;if(6==e||8==e||10==e||11==e)return!0}return!1}}),$.Class.extend("bizagi.rendering.layoutMoney",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol?t.symbol=t.currencySymbol?t.currencySymbol:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol:t.symbol="",t.groupDigits=!0}}),$.Class.extend("bizagi.rendering.layoutPlaceholder",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);this.properties},renderControl:function(){var e=this.renderFactory.getTemplate("layout-placeholder"),t=this.properties.value||this.properties.displayName||"";return $.fasttmpl(e,{value:t})}}),$.Class.extend("bizagi.rendering.combo",{},{initializeData:function(e){this._super(e);var t=this.properties;t.hasLocalData=t.data||!1,t.value=t.value&&t.value.length>0?t.value[0]:t.defaultValue&&t.defaultValue.length>0?t.defaultValue[0]:null,void 0===t.enableTyping&&(t.enableTyping=!0),t.value&&void 0===t.value.id&&(t.value=null),this.value=t.value,t.hasLocalData&&(t.data=this.complementData(t.data)),t.loadOnDemand=!1},renderControl:function(){var e={},t=bizagi.util.normalizeType(this.properties.type);if(this.isDependant&&this.properties&&/^cascadingcombo$/i.test(t)&&this.getParentCombo){var i=this.getParentCombo().getValue();i&&i.id&&(e[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=i.id)}return this.renderCombo(e)},renderCombo:function(e){var t=this;if(t.properties.loadOnDemand)return t.renderComboTemplate();var i=new $.Deferred,r=t.getData(e);return $.when(r).done((function(e){var r=t.renderComboTemplate(e);t.properties.data=e,i.resolve(r)})).fail((function(e){var r=t.renderComboTemplate({});i.resolve(r)})),i.promise()},renderComboTemplate:function(e){var t=this.properties,i=this.renderFactory.getTemplate(this.getTemplateName()),r=bizagi.override.emptyLabelForCombo||this.getResource("render-combo-empty-selection"),a=t.value?"":r;return e=e||this.properties.data||{},"columnCombo"!==this.properties.type||""!==a||"object"!==_typeof(t.value)||""!==t.value.id||""!==t.value.value&&t.value.value!==this.getResource("render-combo-empty-value")||(a=this.getResource("render-combo-empty-selection")),$.fasttmpl(i,$.extend(this.getTemplateParams(),{id:t.id,xpath:t.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:t.idPageCache,items:e,align:t.valueAlign,value:a,editable:t.editable}))},postRenderReadOnly:function(){this._super();var e=this.getValue(),t=this.getControl();this.control&&this.control.parent()&&this.control.parent().addClass("ui-bizagi-noneditable-"+this.properties.displayType),e?(null!=e.value&&"boolean"==typeof e.value&&(!0===bizagi.util.parseBoolean(e.value)?e.value=this.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(e.value)&&(e.value=this.getResource("render-boolean-no"))),this.getResource("render-combo-empty-value")===e.value||this.getResource("render-combo-empty-selection")===e.value?t.text(""):t.html("<label class='readonly-control'>"+this.formatItem(e.value)+"</label>")):t.text("")},getTemplateName:function(){return"combo"},showEmpty:function(){return!0},showCurrentData:function(){return!0},getData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.getMode(),n=bizagi.util.isOfflineForm({context:t});if("execution"!==a)return t.getDummyData();if(i.hasLocalData||n)r.resolve(i.data);else{var o=bizagi.util.normalizeType(i.type);i.remoteDataLoaded&&!/^cascadingcombo$/i.test(o)?r.resolve(i.data):t.dataService.multiaction().getData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,extra:e,contexttype:t.properties.contexttype||null}).done((function(e){i.recalculate||(i.remoteDataLoaded=!0),i.data=t.complementData(e),r.resolve(i.data)})).fail((function(e){var i=!0,a=t.getFormContainer();if(bizagi.util.isNativeMobileDevice()&&void 0!==a&&(i=a.allowOnlineActions()),"not-processed"!==e.type||!i){var n=t.properties.displayName+": ";if("string"==typeof e)var o=JSON&&JSON.parse(e)||$.parseJSON(e);else o=e;n+=o.message,a.addValidationMessage(n),r.reject(e)}}))}return r.promise()},getDummyData:function(){var e=this.properties;return e.data?e.data:(e.data=[],e.data=this.complementData(e.data),e.data.push({id:"",value:"Item 1"}),e.data.push({id:"",value:"Item 2"}),e.data)},resetData:function(){var e=this.properties;e.hasLocalData=!1,e.data=null,e.remoteDataLoaded=!1},getDisplayValue:function(){if(this.combo&&this.combo.length>0)return this.getSelectedValue();var e="",t=this.getValue();return t&&(e=this.formatItem(t.value)),e},getSelectedValue:function(){},getTemplateParams:function(){return{}},formatItem:function(e){if(null!=e){if($.isArray(e)){for(var t=0,i=e.length;t<i;t++)null!=e[t]&&"boolean"==typeof e[t]&&(!0===bizagi.util.parseBoolean(e[t])?e[t]=this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e[t])&&(e[t]=this.getResource("render-boolean-no")));return e.join(" - ")}return e}return""},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();this.controlValueIsChanged()&&(bizagi.util.isEmpty(i)||null==r||("object"!==_typeof(r)||void 0!==r.id&&""!==r.id?e[t.xpath]=void 0!==r.id?r.id:"":e[t.xpath]=""))},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue,a=!0;return $.forceCollectData?a:(t=t&&void 0!==t.length?t[0]:t,i=i&&void 0!==i.length?i[0]:i,r=r&&void 0!==r.length?r[0]:r,t=t&&void 0!==t.id?t.id:t,i=i&&void 0!==i.id?i.id:i,a=void 0!==(r=r&&void 0!==r.id?r.id:r)?r!=i||r!=t:t!=i)},parseAdditionalValues:function(e){var t=this;return $.map(e,(function(e){var i=e.value?t.formatItem(e.value):e,r={id:e.id,value:i};return e.hidden&&(r.hidden=!0),e}))},complementData:function(e){var t=this,i=t.properties,r=!1;if($.each(e,(function(e,a){void 0!==a.value&&null!==a.value?(a.value=t.formatItem(a.value),i.value&&a.id==i.value.id&&(r=!0)):a.value=""})),t.showEmpty()){for(var a=!1,n=0,o=e.length;n<o;n++)if(""===e[n].id){a=!0;break}if(!a){var s=bizagi.override.emptyLabelForCombo||bizagi.localization.getResource("render-combo-empty-value");e.unshift({id:"",value:s})}}return i.value&&!r&&t.showCurrentData()&&e.unshift({id:i.value.id,value:i.value.value,hidden:!0}),t.parseAdditionalValues(e)},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmpty(e)&&("[object Object]"!==Object.prototype.toString.apply(e)||!bizagi.util.isEmpty(e.id)&&0!=e.id)},cleanData:function(){var e={id:"",label:""};this.setDisplayValue(e),this.setValue(e,!1)},beforeToRefresh:function(){this.column&&!this.column.comboData&&this.getData()},isExtraItem:function(){var e=(this.value||{}).value||"";return""===e||e===this.getResource("render-combo-empty-selection")||e===this.getResource("render-combo-empty-value")},escapeValue:function(e){return bizagi.util.isString(e)?e.replaceAll("<","&lt;").replaceAll(">","&gt;"):e},mapValue:function(e){return e&&e.fromAction?{id:e.value,value:e.label,label:e.label}:e},preprocessValue:function(e){var t=this;if(null==e)return e;var i={id:"",value:void 0};if(e.fromAction&&(e={id:e.value,value:e.label}),"number"==typeof e||"string"==typeof e){i.id="string"==typeof e?Number(e):e;var r=t.findDataValueById(i.id);i.value=r?r.value:""}else if("object"===_typeof(e)){if(void 0!==e.id&&null!==e.id&&("string"==typeof e.id&&""!==e.id?(i.id=Number(e.id),isNaN(i.id)&&(i.id=e.id)):i.id=e.id,""!==i.id&&(void 0===e.value||null===e.value||""===e.value))){r=t.findDataValueById(i.id);i.value=r?r.value:e.value}void 0!==e.value&&null!==e.value&&""!==e.value&&("boolean"==typeof e.value?i.value=e.value?t.getResource("render-boolean-yes"):t.getResource("render-boolean-no"):Array.isArray(e.value)?i.value=e.value.map((function(e){return"boolean"==typeof e?e?t.getResource("render-boolean-yes"):t.getResource("render-boolean-no"):e})).join(" - "):i.value=e.value)}return i},validateValue:function(e){if(null!=e.id&&("number"==typeof e.id&&null!==e.id||"string"==typeof e.id&&e.id.length>0))if(null!==e.value&&"boolean"==typeof e.value)translated=!0,!0===bizagi.util.parseBoolean(e.value)?e.value=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value)&&(e.value=bizagi.localization.getResource("render-boolean-no"));else if(null!=e.value&&"object"===_typeof(e.value))for(var t=0,i=e.value.length;t<i;t++)null!=e.value[t]&&"boolean"==typeof e.value[t]&&(!0===bizagi.util.parseBoolean(e.value[t])?e.value[t]=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value[t])&&(e.value[t]=bizagi.localization.getResource("render-boolean-no")));return e},findDataValueById:function(e){return(this.properties.data||[]).find((function(t){return t.id==e}))}}),$.Class.extend("bizagi.rendering.check",{},{initializeData:function(e){this._super(e);var t=this.properties;t.value=void 0!==t.value?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var e=this.renderFactory.getTemplate("check"),t=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(e,{id:t,editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()},postRender:function(){this._super()},getDisplayValue:function(){var e=this.getValue();return!0===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-no"):""},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmpty(e)&&!(!1===bizagi.util.parseBoolean(e)&&this.properties.required)}}),$.Class.extend("bizagi.rendering.number",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.setGroupDigits(),t.colorize=t.colorizeOnNegative||!1,t.dataTypeMinValue=this.calculateMinValue(t.dataType),t.dataTypeMaxValue=this.calculateMaxValue(t.dataType)},renderControl:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{id:this.properties.id,editable:this.properties.editable,value:bizagi.isMobile()?this.getDisplayValue():"",type:bizagi.util.isAndroidDevice()?"tel":"text",isDesign:"execution"!==this.getMode()})},postRender:function(){this._super();var e=this.getControl(),t=this.properties;this.numericInput=e.find("input"),this.numericInput.numeric(this.properties.decimalSymbol),"double"===t.retype&&this.attachRetypeDouble()},configureHandlers:function(){this.attachFormatCurrency()},removeValidations:function(){(this.getFormContainer().parent||this.getFormContainer()).clearValidationMessages()},attachRetypeDouble:function(){},formatNumericInput:function(e){var t=this.properties,i=bizagi.localization.getResource("render-number-retype-fail"),r=this.getFormContainer();if(void 0===r.validationController){var a=r.getValidationsContainer();r.validationController=new bizagi.command.controllers.validation(r,this.validations,a)}var n=r.validationController||r.parent.validationController,o=".",s=",";"undefined"==typeof BIZAGI_DEFAULT_CURRENCY_INFO?(o=this.getResource("numericFormat").decimalSymbol||".",s=this.getResource("numericFormat").digitGroupSymbol||","):(o=BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,s=BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator);var l=this.getMinValue(),d=this.getMaxValue();t.percentage&&this.numericInput.val(this.numericInput.val().replace("%",""));var c=this.numericInput.val();c=(c=","==o?c.replace(/\,0+$/,""):c.replace(/\.0+$/,"")).replace(t.symbol,""),-1!=(c=bizagi.util.replaceAll(c,s,"")).toString().indexOf(o)&&(","==o&&(c=c.replace(/([0-9]+(\,[0-9]+[1-9])?)(\,?0+$)/,"$1")),"."==o&&(c=c.replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1"))),null!=c&&c.length>0&&this.numericInput.val(c),/(.+)-$/.test(c)&&(c=c.replace(/(.+)-$/,"-$1"),this.numericInput.val(c));var u=c.replace(/[^0-9]+/g,"").length,p=this.properties.xpath,h=this.numericInput.val();if(null!=this.isInvalidFormat&&1==this.isInvalidFormat||""!=c&&-1!=["$","","","",t.symbol].indexOf(c))return this.setValue(""),this.getControl().find("input").val(""),void this.numericInput.val("");if(""!=bizagi.util.trim(c)){var g=parseFloat(c.replace(",","."));if(isNaN(g)&&(g=this.numericInput.asNumber()),i=void 0!==l&&null!=l&&g<l?bizagi.localization.getResource("render-numeric-minimum-validation").replaceAll("#label#",t.displayName+" ("+h+")").replaceAll("#minValue#",l.toString()):null!=d&&g>d?bizagi.localization.getResource("render-numeric-maximum-validation").replaceAll("#label#",t.displayName+" ("+h+")").replaceAll("#maxValue#",d.toString()):i+" "+h,null!=l&&g<l||null!=d&&g>d||10==this.properties.dataType&&u>15||1==this.properties.dataType&&u>19||11==this.properties.dataType&&u>7||11==this.properties.dataType&&u>7||h.match(/[^$,-.()\d]/)){if(void 0!==n&&null!=n){this.removeValidations();var f=i;-1===f.indexOf(h)&&(f=i+" "+h),n.showValidationMessage(f,p),this.isValidRender=!1,this.isValidRenderMessage=f}i=i.replace(h,"")}else this.isValidRender=!0,this.isValidRenderMessage="",e.value.toString().length>0&&!t.allowDecimals&&!t.groupDigits?(e.value=e.value.toString().replace(/^0+/,""),t.symbol.length>0&&(e.value=e.value.toString().replace(t.symbol+"0",t.symbol)),e.value=e.value.toString().replace(/^0+/,""),0==e.value.replaceAll("0","").length?e.value=t.symbol+"0":e.value.toString()==parseInt(e.value)&&(e.value=t.symbol+e.value)):"money"!==this.properties.type&&"number"!==this.properties.type&&"columnMoney"!==this.properties.type&&"columnNumber"!==this.properties.type||(e.value=e.value.toString().replace(/^0+/,""),""===e.value&&(e.value=0)),this.executeFormatCurrencyPlugin(),this.setValue(this.numericInput.asNumber({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits})),t.percentage&&this.numericInput&&-1==this.numericInput.val().indexOf("%")&&this.numericInput.val(this.numericInput.val()+"%"),i=i.replace(h,"")}else this.setValue("")},attachFormatCurrency:function attachFormatCurrency(){var self=this,properties=self.properties;self.isValidRender=self.isValidRender||!0,null==$.formatCurrency.regions[bizagi.language]&&($.formatCurrency.regions[bizagi.language]=this.getResource("numericFormat")),self.numericInput.blur((function(){self.formatNumericInput(this)})).bind("paste",(function(e){try{var tmpData=bizagi.util.isIE()||bizagi.util.isIE11()?window.clipboardData.getData("text"):e.originalEvent.clipboardData.getData("Text"),totalVal="/[^0-9";properties.decimalSymbol.length>0&&(totalVal+=properties.decimalSymbol),8==properties.dataType&&(properties.symbol.length>0&&(totalVal+=properties.symbol),properties.digitGroupSymbol.length>0&&(totalVal+=properties.digitGroupSymbol)),totalVal+="\\-\\s]/gi";try{tmpData.replace(eval(totalVal),"").length!=tmpData.length&&e.preventDefault()}catch(e){}}catch(e){bizagi.log("Error to pasting content"),self.isInvalidFormat=!0}})).keydown((function(e){self.previousValue=this.value;var t=(e=window.event&&window.event.preventDefault?window.event:e).charCode||e.keyCode;if("undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO&&0==BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits&&(properties.allowDecimals=!1),(properties.dataType<5||8==properties.dataType&&0==properties.allowDecimals)&&(188!=t&&190!=t&&110!=t||e.preventDefault()),this.value&&void 0!==e&&this.value.length>0&&(8==properties.dataType||10==properties.dataType))if(t>47&&t<58){self.formatTimeout&&clearTimeout(self.formatTimeout);var i=this.value+"";properties.digitGroupSymbol&&properties.digitGroupSymbol.length>0&&(i=i.replaceAll(properties.digitGroupSymbol,"")),properties.symbol.length>0&&(i=i.replaceAll(properties.symbol,"")),i=$.trim(i),properties.decimalSymbol&&properties.decimalSymbol.length>0&&(i=i.replaceAll(properties.decimalSymbol,".")),10*i>properties.dataTypeMaxValue&&e.preventDefault()}else if(109==t||189==t)if(0!=this.selectionStart||this.selectionEnd!=this.value.length){var r=this.selectionEnd;this.value=properties.symbol+"-"+this.value.replace(properties.symbol,""),this.selectionStart=this.selectionEnd=r+1}else 0==this.selectionStart&&this.selectionEnd==this.value.length&&(this.value="-",this.selectionStart=this.selectionEnd=this.value.length)})).keyup((function(e){var t=(e=window.event||e).charCode||e.keyCode;if(void 0!==e)switch(t){case 16:case 17:case 13:case 18:break;case 27:this.value=""}})).keypress((function(e){var t=(e=window.event&&window.event.preventDefault?window.event:e).charCode||e.keyCode;if(void 0!==e){35==t||37==t||39==t?e.preventDefault():8!=properties.dataType&&36==t&&e.preventDefault();var i=String.fromCharCode(t);!1===properties.allowDecimals&&0===properties.numDecimals&&i===properties.decimalSymbol&&e.preventDefault()}}))},executeFormatCurrencyPlugin:function(){var e=this.properties;if(this.numericInput&&this.numericInput.formatCurrency({symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,roundToDecimalPlace:e.numDecimals,colorize:e.colorize}),8!==e.dataType&&!0===bizagi.override.removeTrailingZeros){var t=this.numericInput.val(),i=!0;-1!==t.indexOf(")")&&(i=!1,t=t.replace("(","").replace(")",""));var r=new RegExp("("+e.decimalSymbol+"\\d*?[1-9])0+$","g");t=t.replace(r,"$1"),r=new RegExp("\\"+e.decimalSymbol+"0+$","g"),t=t.replace(r,""),this.numericInput.val(t),i||this.numericInput.val("("+t+")")}e.percentage&&this.numericInput.val(this.numericInput.val()+"%")},getDisplayValue:function(){var e=this.properties,t=this.getControl(),i=void 0!==this.getValue()&&null!==this.getValue()?this.getValue():e.defaultValue||e.defaultvalue||$("input",t).val()||"",r=$("<label/>").html(bizagi.util.numberToFixedString(i));if(r.formatCurrency({symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,roundToDecimalPlace:e.numDecimals,colorize:e.colorize}),e.percentage&&(r=$("<label/>").html(r.text()+"%")),!e.editable&&8!==e.dataType&&!0===bizagi.override.removeTrailingZeros){var a=!0;-1!==(i=r.text()).toString().indexOf(")")&&(a=!1,i=i.replace("(","").replace(")",""));var n=new RegExp("("+e.decimalSymbol+"\\d*?[1-9])0+$","g");return i=i.replace(n,"$1"),n=new RegExp("\\"+e.decimalSymbol+"0+$","g"),i=i.replace(n,""),a||(i="("+i+")"),i}return r.text()},isValid:function(e){var t,i=this.properties,r=this._super(e),a=this.getValue(),n=this.getMinValue(),o=this.getMaxValue();if("string"==typeof a&&""!=a&&(a=Number(a)),this.hasValue()&&(bizagi.util.isEmpty(n)||a<n&&(t=this.getResource("render-numeric-minimum-validation").replaceAll("#label#",i.displayName.toString()+" ("+a+")").replaceAll("#minValue#",n.toString()),e.push({xpath:i.xpath,message:t}),r=!1),bizagi.util.isEmpty(o)||a>o&&(t=this.getResource("render-numeric-maximum-validation").replaceAll("#label#",i.displayName.toString()+" ("+a+")").replaceAll("#maxValue#",o.toString()),e.push({xpath:i.xpath,message:t}),r=!1)),!(!1!==this.isValidRender||r&&bizagi.util.isMobileDevice())){r=!1;var s=this.isValidRenderMessage?this.isValidRenderMessage:"error";e.push({xpath:i.xpath,message:s})}return r},getMinValue:function(){var e=this.properties.minValue;return null!=e?e:this.properties.dataTypeMinValue},getMaxValue:function(){var e=this.properties.maxValue;return null!=e?e:this.properties.dataTypeMaxValue},getDefaultAllowDecimals:function(e){if(e){if(1===e||2===e||3===e||4===e||7===e)return!1;if(6===e||8===e||10===e||11===e)return!0}return!1},getDefaultGroupDigits:function(e){if(e){if(1===e||2===e||3===e||4===e||7===e)return!1;if(6===e||8===e||10===e||11===e)return!0}return!1},setGroupDigits:function(){return void 0!==this.properties.thousands?!!this.properties.digitGroupSymbol&&bizagi.util.parseBoolean(this.properties.thousands):!!this.properties.digitGroupSymbol&&this.getDefaultGroupDigits(this.properties.dataType)},calculateMinValue:function(e){return 8===e||10===e?-922337203685477:4===e?0:3===e?-32768:2===e?-2147483648:1===e?-999999999999999:null},calculateMaxValue:function(e){return 8===e||10===e?922337203685477:4===e?255:3===e?32767:2===e?2147483647:1===e?999999999999999:null},performMinValue:function(e){var t=Number(e);return isNaN(t)&&(t=this.calculateMinValue(this.properties.dataType)),t},performMaxValue:function(e){var t=Number(e);return isNaN(t)&&(t=this.calculateMaxValue(this.properties.dataType)),t},changeMinValue:function(e){var t=this.performMinValue(e);this.properties.minValue=this.properties.dataTypeMinValue=t},changeMaxValue:function(e){var t=this.performMaxValue(e);this.properties.maxValue=this.properties.dataTypeMaxValue=t},createTooltip:function(e,t,i){e.data("oldValue",t),e.val("");try{e.tooltip("destroy")}catch(e){}e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",(function(e,t){t.tooltip.zIndex(r)})),e.tooltip("open");var a=setTimeout((function(){e.focus(),clearTimeout(a)}),100)}}),$.Class.extend("bizagi.rendering.numberScientificNotation",{initializeData:function(e){this._super(e),this.properties.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:format.decimalSymbol},renderControl:function(){var e=this.renderFactory.getTemplate("numberScientificNotation");return $.fasttmpl(e,{})},postRender:function(){var e=this.getControl();this.numericInput=e.find("input"),this.numericInput.numericSN(this.properties.decimalSymbol)},getDisplayValue:function(){return this.getValue().replace(".",this.properties.decimalSymbol)},setValue:function(e){e=(e||"").toString().replace(this.properties.decimalSymbol,"."),this._super(e)},controlValueIsChanged:function(){var e=this.properties,t=this.getValue()||"",i=e.originalValue||"";return!!$.forceCollectData||i.toLowerCase()!=t.toLowerCase()}}),$.Class.extend("bizagi.rendering.date",{},{initializeData:function(e){var t=bizagi.util.dateFormatter;this._super(e);var i=this.properties,r=this.getResource("dateFormat"),a=this.getResource("timeFormat");if(i.displayValue="",i.showTime=void 0!==i.showTime&&bizagi.util.parseBoolean(i.showTime),i.dateFormat=i.dateFormat||r,i.timeFormat=i.timeFormat||a,i.fullFormat=i.dateFormat,i.showTime&&-1===i.fullFormat.search(/[h|H]+/gi)&&(i.fullFormat=i.fullFormat+" "+i.timeFormat),i.value){var n=t.getDateFromInvariant(i.value,i.showTime);if(0!=n){this.value=i.value;var o=bizagi.localization.getResource("datePickerRegional");i.displayValue=bizagi.util.dateFormatter.formatDate(n,i.fullFormat,o)}else this.value=null}r=this.getDateFormat(i.fullFormat);var s=i.fullFormat.substring(0,i.fullFormat.indexOf(":")).lastIndexOf(" ");i.showTime||(i.fullFormat=s>0?i.fullFormat.substring(0,s):i.fullFormat),i.datePickerFormat=r.datePickerFormat,i.timePickerFormat=r.timePickerFormat,this.i18n=bizagi.localization.getResource("datePickerRegional")},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("date"),i=e.fullFormat;return $.fasttmpl(t,{id:e.id,showTime:e.showTime,value:e.value,editable:e.editable,dateFormat:bizagi.override&&!0===bizagi.override.uppercaseDatePlaceholder?i.toUpperCase():i,rtl:"rtl"==e.orientation})},configureHandlers:function(e,t){var i=this,r=i.properties,a=i.getDateControl(),n=i.getTimeControl();a.bind("change",(function(){i.onChangeHandler()})),r.showTime&&n.bind("change",(function(e,t){i.updatingTime?delete i.updatingTime:i.onChangeHandler(t)}))},onChangeHandler:function(){},getDisplayValue:function(e){var t,i=this.properties;if(!i.displayValue&&e){var r=bizagi.util.dateFormatter.getDateFromInvariant(e,i.showTime),a=bizagi.localization.getResource("datePickerRegional");t=bizagi.util.dateFormatter.formatDate(r,i.fullFormat,a)}else t="";return i.displayValue||t||""},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();if(this.controlValueIsChanged()&&!bizagi.util.isEmpty(i))if(bizagi.util.isEmpty(r))""===r&&(e[t.xpath]="");else{var a=bizagi.util.dateFormatter.getDateFromInvariant(r,t.showTime);void 0!==a&&0!==a&&(t.showTime||a.setHours(0,0,0,0),e[t.xpath]=bizagi.util.dateFormatter.formatInvariant(a,!0))}},getDateControl:function(){},getTimeControl:function(){},isValid:function(e){var t,i=this.properties,r=this._super(e),a=this.getValue();if(a&&(!0===bizagi.util.parseBoolean(i.editable)&&0!=(a=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromInvariant(a,i.showTime))))){if(i.minValue&&("string"==typeof i.minValue||"number"==typeof i.minValue)){var n=this.getNormalizeDate("string"==typeof i.minValue?bizagi.util.dateFormatter.getDateFromInvariant(i.minValue,i.showTime):new Date(i.minValue));a<n&&(t=this.getResource("render-date-minimum-validation").replaceAll("#label#",i.displayName).replaceAll("#minValue#",bizagi.util.dateFormatter.formatDate(n,i.fullFormat)),e.push({xpath:i.xpath,message:t}),r=!1)}if(i.maxValue&&("string"==typeof i.maxValue||"number"==typeof i.maxValue)){var o=this.getNormalizeDate("string"==typeof i.maxValue?bizagi.util.dateFormatter.getDateFromInvariant(i.maxValue,i.showTime):new Date(i.maxValue));a>o&&(t=this.getResource("render-date-maximum-validation").replaceAll("#label#",i.displayName).replaceAll("#maxValue#",bizagi.util.dateFormatter.formatDate(o,i.fullFormat)),e.push({xpath:i.xpath,message:t}),r=!1)}}return r},getDateFormat:function(e){var t,i=e,r=void 0;return-1==e.search("h")&&-1==e.search("H")||(t=-1!=e.search("h")?e.search("h"):e.search("H"),i=e.substring(0,t-1),r=e.substr(t)),i.indexOf("MMMM")>=0?i=i.replaceAll("MMMM","MM"):i.indexOf("MMM")>=0?i=i.replaceAll("MMM","M"):i.indexOf("MM")>=0?i=i.replaceAll("MM","mm"):i.indexOf("M")>=0&&(i=i.replaceAll("M","m")),-1!=i.search("yyyy")?i=i.replaceAll("yyyy","yy"):-1!=i.search("yy")&&(i=i.replaceAll("yy","y")),{datePickerFormat:i=i.replaceAll("dddd","DD"),timePickerFormat:r}},postRender:function(){var e=this.properties;this._super(),void 0===e.maxValue&&(e.maxValue="12/31/"+parseInt((new Date).getFullYear()+200).toString()+" 00:00:00"),void 0===e.minValue&&(e.minValue="01/01/"+parseInt((new Date).getFullYear()-200).toString()+" 00:00:00")},getNormalizeDate:function(e){return 0!=e&&null!=e&&(this.properties.showTime?e.setMilliseconds(0):e.setHours(0,0,0,0)),e},getTimeFormat:function(e){return e.replaceAll("m","i").replaceAll("tt","A")},setValueFromCalendarButtons:function(e){e?e=this.getNormalizeDate(e):(value=null,this.setValue(""),this.setDisplayValue(""))},changeMinValue:function(e){var t=this.properties,i=bizagi.util.dateFormatter;e&&t.editable&&("number"==typeof e?e=i.formatInvariant(this.getNormalizeDate(new Date(e)),t.showTime):(e=this.getNormalizeDate("object"===_typeof(e)?e:i.getDateFromInvariant(e,t.showTime)),e=i.formatInvariant(e)),t.minValue=e)},changeMaxValue:function(e){var t=this.properties,i=bizagi.util.dateFormatter;e&&t.editable&&("number"==typeof e?e=i.formatInvariant(this.getNormalizeDate(new Date(e)),t.showTime):(e=this.getNormalizeDate("object"===_typeof(e)?e:i.getDateFromInvariant(e,t.showTime)),e=i.formatInvariant(e)),t.maxValue=e)}}),$.Class.extend("bizagi.rendering.extendedText",{},{initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.hasMaxLines=!!this.properties.maxLines;var t=this.properties;if(t.maxLines=this.properties.maxLines||6,t.regularExpressionExpression){var i=t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message");t.regularExpression={expression:t.regularExpressionExpression,message:i}}},renderControl:function(){var e=this.renderFactory.getTemplate("extendedText");return $.fasttmpl(e,{id:this.properties.id,isEmptyField:void 0===this.properties.value,editable:this.properties.editable})},postRender:function(){this._super();var e=this.getControl();this.textarea=e.find("textarea"),this.textarea?this.textarea.css({resize:"both"}):this.textarea.css({resize:"none"}),"double"===this.properties.retype&&this.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var e=this,t=e.properties;t.maxLength&&e.textarea.prop("maxlength",t.maxLength),t.maxLines?e.textarea.prop("rows",t.maxLines):e.textarea.prop("rows",6),e.textarea.bind("change",(function(){e.setValue(e.textarea.val());var i=[];if("duplicate"!==t.retype)if(e.isValid(i)||void 0===t.regularExpression)e.setValue(e.textarea.val(),!0);else{var r=i[0].message;bizagi.showMessageBox(r,"Bizagi","error")}})),e.textarea.bind("blur",(function(){e.setValue(e.textarea.val())}))},isValid:function(e){var t,i=this.properties,r=this._super(e),a=this.getValue(),n=new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g");return this.isOfflineForm&&bizagi.util.isMobileDevice()&&(a=a&&"object"===_typeof(a)&&a.value?a.value:a),i.regularExpression?i.editable&&(a&&(a.match(n)||!a.match(new RegExp(i.regularExpression.expression))&&this.properties&&"userName"===this.properties.xpath)?(t=i.regularExpression.message,e.push({xpath:i.xpath,message:t}),r=!1):!a||!a.match(n)&&a.match(new RegExp(i.regularExpression.expression))||(t=i.regularExpression.message,e.push({xpath:i.xpath,message:t}),r=!1)):a&&a.match(new RegExp(".*?eval\\(","g"))&&a.match(new RegExp(".*?eval\\u0028","g"))&&i.editable&&(t=this.getResource("render-text-regular-expression-default-message"),e.push({xpath:i.xpath,message:t}),r=!1),r},setDisplayValue:function(e){var t=this.getControl();if(0==this.properties.editable&&"string"==typeof e){var i=bizagi.util.encodeHtmlText(this.getDisplayValue());t.html(i)}this.setValue(e,!1)},collectData:function(e){this._super(e)},createTooltip:function(e,t,i){e.data("oldValue",t),e.val(""),e.data("ui-tooltip")&&e.tooltip("destroy"),e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",(function(e,t){t.tooltip.zIndex(r)})),e.tooltip("open");var a=setTimeout((function(){e.focus(),clearTimeout(a)}),100)},validateValue:function(e,t){return t<1||e.length<=t?e:e.substr(0,t)}}),$.Class.extend("bizagi.rendering.grid",{},{initializeData:function(e){var t=this;this._super(e),t.originalProperties=bizagi.clone(e.properties);var i,r,a=this.properties;t.initProperties(),t.columns=[],t.columnsIds=[],t.enabledChecks={},t.exclusiveChanges={},t.originalEnabledChecks=[],$.each(e.elements,(function(e,n){var o=n.render.properties;o.groupBy&&(a.groupBy=o.xpath||"",a.allowGrouping=!bizagi.util.isEmpty(a.groupBy)),/columnBoolean/i.test(o.type)&&o.isExclusive&&(a.hasExclusiveCheck=!0,n.render.properties.required=!1,t.enabledChecks[o.xpath]=[]),t.properties.inlineEdit||(n.render.properties.editable=!1);var s=t.renderFactory.getColumn({type:o.type,data:n.render,parent:t,singleInstance:a.singleInstance});t.columns.push(s),t.columnsIds.push(n.render.properties.id),o.editable&&(i=!0),o.totalize&&o.totalize.operation&&(r=!0,o.totalize.format=o.totalize.format||{},o.totalize.format.bold=void 0===o.totalize.format.bold||o.totalize.format.bold)})),"rtl"===a.orientation&&(t.columns=t.columns.reverse()),a.inlineEdit&&!i&&(a.inlineEdit=!1,a.allowEdit=!1),r&&(a.showSummary=!0,a.rowsPerPage=0)},initProperties:function(){var e=this.getFormContainer(),t=this.properties;$.extend(t,this.initEditabilityProperties(t.editable,t.allowEdit,t.inlineEdit,t.withEditForm),this.initAddAndDeleteProperties(t.editable,t.allowAdd,t.inlineAdd,t.allowDelete)),t.allowDetail=null!=bizagi.util.parseBoolean(t.allowDetail)&&bizagi.util.parseBoolean(t.allowDetail),t.isSortable=null==bizagi.util.parseBoolean(t.isSortable)||bizagi.util.parseBoolean(t.isSortable),t.keyColumn="",t.data=t.data||null,t.displayType="value",t.skipInitialLoad=t.skipInitialLoad||!1,t.allowMore=bizagi.util.parseBoolean(t.allowMore)||!1,t.allowFilter=bizagi.util.parseBoolean(t.allowFilter)||!1,t.allowGrouping=!1,t.groupBy="",t.groupSummary=t.groupSummary||null,t.groupText=this.getResource("render-grid-group-text"),t.groupCollapsed=bizagi.util.parseBoolean(t.groupCollapsed)||!1,t.groupOrder=t.groupOrder||"asc",t.formShowMode=bizagi.util.parseBoolean(t.formShowMode)||"popup",t.floatingHeader=bizagi.util.parseBoolean(t.floatingHeader)||!1,t.sortBy=t.sortBy?t.sortBy:t.data&&t.data.sort?t.data.sort:t.keyColumn,t.sortOrder=void 0!==t.sortOrder&&null!==t.sortOrder?"True"===t.sortOrder?"asc":"desc":t.data&&t.data.order?t.data.order:"asc",t.sort=t.sortBy+" "+t.sortOrder,t.rowsPerPage=t.allowGrouping?1e3:t.rowsPerPage||20,t.page=1,t.records=0,t.totalPages=0,t.addLabel=t.addLabel||$.trim(this.getResource("render-grid-add-label"))+" "+t.displayName,t.editLabel=t.editLabel||$.trim(this.getResource("render-grid-edit-label"))+" "+t.displayName,t.deleteLabel=t.deleteLabel||this.getResource("render-ecm-confirm-bt-delete")+" "+t.displayName,t.exportOptionsLabel=t.exportOptionsLabel||this.getResource("render-grid-export-options-label")+t.displayName,t.detailLabel=t.detailLabel||this.getResource("render-collection-navigator-details-form"),t.tableCssClass=t.cssClass||"",t.alreadySaved=!1,"entity"!=t.contexttype&&(t.contexttype="function"==typeof this.parent.getContextType?this.parent.getContextType():"");try{(this.parent&&"boolean"==typeof this.parent.properties.editable&&!this.parent.properties.editable||!t.editable)&&(t.editable=!1,t.allowEdit=!1,t.inlineEdit=!1,t.allowAdd=!1,t.inlineAdd=!1,t.allowDelete=!1)}catch(e){}t.allowEdit&&(t.inlineEdit||t.withEditForm)||(t.editable=!1),t.labelWidth=0,t.valueWidth="100%",t.overrideGetRemoteData=t.overrideGetRemoteData||void 0,t.singleInstance=!!bizagi.util.isEmpty(t.singleInstance)||t.singleInstance,t.contextType=e.params&&e.params.data&&e.params.data.contextType?e.params.data.contextType:null,this.changes={},this.cellOverrides={},this.isRTL()&&null!=t.data&&(t.data.rows=this.changeOrderData(t.data.rows))},initEditabilityProperties:function(e,t,i,r){return e=null===bizagi.util.parseBoolean(e)||bizagi.util.parseBoolean(e),t=null===bizagi.util.parseBoolean(t)||bizagi.util.parseBoolean(t),i=null===bizagi.util.parseBoolean(i)||bizagi.util.parseBoolean(i),r=null!==bizagi.util.parseBoolean(r)&&bizagi.util.parseBoolean(r),e||(t=i=r=!1),{editable:e,allowEdit:t,inlineEdit:i,withEditForm:r}},initAddAndDeleteProperties:function(e,t,i,r){return e=null===bizagi.util.parseBoolean(e)||bizagi.util.parseBoolean(e),t=null==bizagi.util.parseBoolean(t)||bizagi.util.parseBoolean(t),i=null==bizagi.util.parseBoolean(i)||bizagi.util.parseBoolean(i),r=null==bizagi.util.parseBoolean(r)||bizagi.util.parseBoolean(r),t||(i=!1),e||(t=i=r=!1),{allowAdd:t,inlineAdd:i,allowDelete:r}},hasValue:function(){return this.properties.data&&this.properties.data.rows.length>0},isRTL:function(){var e=this.properties;return!e||"string"==typeof e.orientation&&"RTL"==e.orientation.toUpperCase()},changeOrderData:function(e){var t,i=[],r=e||[];return $.each(r,(function(e,a){t=a.shift(),(i=a.reverse()).unshift(t),r[e]=i})),r},removeRemainingColumns:function(e,t){var i=e||[],r=0;return i.length>0&&(r=i[0].length-t-1),r>0&&$.each(i,(function(e,t){for(var i=0;i<r;i++)t.pop()})),i},getColumn:function(e){var t=null;return $.each(this.columns,(function(i,r){r.properties.xpath!=e&&r.properties.id!=e&&r.properties.xpath+"."+r.properties.id!=e||(t=r)})),t},getColumnType:function(e){var t=this.columnsIds.indexOf(e);return-1!=t?this.columns[t].properties.type:null},getColumnById:function(e){var t=this.columnsIds.indexOf(e);return-1!==t?this.columns[t]:null},renderControl:function(){var e=this.properties,t=new $.Deferred;"execution"!==this.getMode()&&(e.data=this.getDummyData());var i=this.getGridTemplate(),r=this.applyTemplate(i),a=[];return $.each(this.columns,(function(e,t){var i=t.initialize();i&&a.push(i)})),$.when.apply($,a).done((function(){t.resolve(r)})),t.promise()},postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-grid-container").addClass("ui-bizagi-render-display-block")},getGridTemplate:function(){return this.renderFactory.getTemplate("grid")},applyTemplate:function(e){var t=this.properties;return orientation=this.properties.orientation,$.fasttmpl(e,{id:bizagi.util.encodeXpath(t.xpath),displayName:bizagi.util.encodeXpath(t.displayName),allowAdd:t.allowAdd,addLabel:t.addLabel})},renderReadOnly:function(){return this.renderControl()},getRemoteData:function(e){var t=this,i=t.properties;return e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,sort:i.sortBy,order:i.sortType,page:i.page,rows:i.rowsPerPage,searchFilter:i.searchFilter,orientation:i.orientation||"ltr"}),i.overrideGetRemoteData?i.overrideGetRemoteData(e):t.dataService.multiaction().getGridData(e).then((function(e){return t.originalProperties=t.originalProperties||{},t.originalProperties.data=bizagi.clone(e),i.page=e.page,i.records=e.records,i.totalPages=e.totalPages,e})).fail((function(e){console.error(e.message||"Error")}))},spliceRowData:function(e,t){"execution"===this.getMode()&&e&&e.rows&&$.each(e.rows,(function(i,r){var a=t||e.rows[i].length;e.rows[i].splice(a,0,"")}))},spliceRowDataVisible:function(e,t){"execution"===this.getMode()&&e&&e.visible&&$.each(e.visible,(function(i,r){var a=t||e.visible[i].length;e.visible[i].splice(a,0,!0)}))},spliceRowDataEditable:function(e,t){"execution"===this.getMode()&&e&&e.editable&&$.each(e.editable,(function(i,r){var a=t||e.editable[i].length;e.editable[i].splice(a,0,!0)}))},getDummyData:function(){var e=this.properties;if(e.data)return e.data;for(var t=["1"],i=0;i<this.columns.length;i++)t.push("");return{page:1,total:1,records:1,rows:[t]}},submitEditRequest:function(e){var t=this.properties,i=t.xpath+this.buildCellXpathFilter(e);return this.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType})},submitSaveRequest:function(e,t){var i=this,r=i.properties,a=null;t.deferreds&&(a=$.when.apply($,t.deferreds),delete t.deferreds);var n=r.xpathContext.length>0?r.xpathContext+"."+r.xpath+i.buildCellXpathFilter(e):r.xpath+i.buildCellXpathFilter(e);return $.when(a).pipe((function(){return i.startLoading(),i.dataService.saveGridRecord({url:r.saveUrl,idRender:r.id,xpath:r.xpath,xpathContext:n,submitData:t,contexttype:r.contextType,disableServerGridValidations:t.disableServerGridValidations||!1}).pipe((function(e){return i.endLoading(),e})).fail((function(e){var t=i.getFormContainer(),r=e.responseText?e.responseText:"string"==typeof e?e:e.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=e);t.validateForm(),t.clearValidationMessages(),t.addValidationMessage(r)}))}))},submitDeleteRequest:function(e){var t=this,i=t.properties,r=i.xpath+t.buildCellXpathFilter(e);return t.dataService.deleteGridRecord({url:i.deleteUrl,idRender:i.id,xpath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType}).pipe((function(e){if("validationMessages"==e.type){var i=t.getFormContainer(),r=e.messages.join(" ");i.failHandler({message:r})}return e}))},submitAddRequest:function(){var e=this.properties;return this.dataService.addGridRecord({url:e.addUrl,idRender:e.id,xpath:e.xpath,xpathContext:e.xpathContext,contexttype:e.contextType,idPageCache:e.idPageCache}).pipe((function(e){return e.idEntity})).promise()},submitRollbackRequest:function(e){var t=this.properties;return this.dataService.rollbackGridAction({url:t.rollbackUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:e?e.idPageCache:t.idPageCache,contexttype:this.properties.contexttype||""})},collectGridChange:function(e){var t=(e=e||{}).id,i=e.dataType,r=e.xpath,a=e.value,n=void 0===e.trigger||e.trigger,o=e.pressed||!1,s=i&&bizagi.util.normalizeType(i),l=e.renderId||"";this.changes[t]=this.changes[t]||{},/^columnsearch$/i.test(s)&&a&&void 0!==a.id?this.changes[t][r]=a.id:this.changes[t][r]=a,n&&this.triggerRenderChange({key:t,column:r,pressed:o,id:l})},configureColumnSubmitOnChange:function(e){var t=this,i=t.properties,r=i.id,a={commands:[{xpath:i.xpath,command:"submit-value",argument:"all"}],conditions:{operator:"and",expressions:[{simple:{operator:"cell-change",xpath:i.xpath+"[]."+e,argumentType:"text",argument:e}}]},dependencies:[i.xpath]};$.when(t.ready()).done((function(){t.getFormContainer().addSubmitAction(e+"."+r,a)}))},collectData:function(e){var t=this,i=t.properties,r=[];if(t.exclusiveChanges)for(var a in t.exclusiveChanges){var n=t.exclusiveChanges[a],o=t.enabledChecks[a];if(n&&o)e[i.xpath+"["+a+"=true]."+a]=!1}for(var s in t.changes){if("summary"!=s)for(var l in t.changes[s])if(t.canColumnBeSent(s,l)){a=i.xpath+t.buildCellXpathFilter(s)+"."+l;var d=t.changes[s][l];e[a]=d}r.push(s)}if(t.exclusiveChanges)for(var a in t.exclusiveChanges){n=t.exclusiveChanges[a],o=t.enabledChecks[a];if(n&&o){var c=t.exclusiveChanges[a];if(c&&c.value)e[i.xpath+t.buildCellXpathFilter(c.key)+"."+a]=c.value}}$.each(r,(function(e,i){delete t.changes[i]}))},hasChanged:function(e){return $.isEmptyObject(this.changes)?!$.isEmptyObject(this.exclusiveChanges)&&(e.push(!0),!0):(e.push(!0),!0)},canColumnBeSent:function(e,t){var i,r;for(i in this.columns)if(this.columns.hasOwnProperty(i)){var a=this.columns[i];if("columnUserfield"!==a.properties.type){if(a.properties.xpath==t){var n=this.getCellOverride(e,a.columnIndex-1);return a.canBeSent(e,n)}}else for(r in a.properties)if(a.properties.hasOwnProperty(r)&&"[object String]"===Object.prototype.toString.apply(a.properties[r])&&a.properties[r].substr(a.properties[r].lastIndexOf(".")+1)===t)return!0}return!1},canBeSent:function(){var e=this.properties;return!(bizagi.util.parseBoolean(e.displayOnly)||!1||!e.inlineEdit&&!e.inlineAdd&&$.isEmptyObject(this.changes))},getCellValue:function(e,t){for(var i=this.properties.data.rows,r=0;r<i.length;r++)if(i[r][0]==e)for(var a=0;a<this.columns.length;a++){if(this.columns[a].properties.xpath==t)return i[r][a+1]}return null},getCellCurrentValue:function(e,t){var i=this.getControlCell(e,t);return i&&"function"==typeof i.getValue?i.getValue():null},getControlCell:function(e,t){var i=null;if(void 0!==this.columns)for(var r=0;r<this.columns.length;r++)if(this.columns[r].properties.xpath==t||this.columns[r].properties.id==t||this.columns[r].properties.xpath+"."+this.columns[r].properties.id==t){i=this.columns[r].getDecorated(e);break}return i},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("grid-control-required"):t.removeClass("grid-control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("grid-control-required"):t.removeClass("grid-control-required")),this.triggerRenderValidate()},refresh:function(){},setError:function(e,t){},changeCellBackgroundColor:function(e,t,i){},changeCellColor:function(e,t,i){},changeCellVisibility:function(e,t,i){},changeCellRequired:function(e,t,i){},changeCellEditability:function(e,t,i){},changeCellProperties:function(e,t,i){},changeCellMaxValue:function(e,t,i){},changeCellMinValue:function(e,t,i){},changeColumnEditability:function(e,t){},changeColumnVisibility:function(e,t){},changeColumnRequired:function(e,t){},cleanCellData:function(e,t){},changeEditability:function(e){var t=this,i=t.getControl();t.saveGrid().done((function(){var r="Default"==e?t.originalProperties.editable:bizagi.util.parseBoolean(e);i.empty();var a=t.originalProperties;$.extend(t.properties,t.initEditabilityProperties(r,a.allowEdit,a.inlineEdit,a.withEditForm),t.initAddAndDeleteProperties(r,a.allowAdd,a.inlineAdd,a.allowDelete)),t.properties.editabilityEnabled=t.properties.editabilityEnabled||t.properties.editable,r?t.properties.allowEdit&&t.properties.inlineEdit&&t.changeColumnsEditability(e):t.changeColumnsEditability(!1),"function"==typeof t.internalRenderControl&&$.when(t.internalRenderControl()).done((function(e){i.append(e),t.postRenderElement(t.element)}))}))},saveGrid:function(){var e=this,t=$.Deferred(),i=$("[data-bizagi-component=rows]",e.element).find("[data-new-row=true]");if(i.length>0){var r=$.map(i,(function(e,t){return $(e).data("business-key")}));e.saveInlineAddedRows(r).done((function(){$.when(e.saveRows()).done((function(){e.refresh(),t.resolve()}))}))}else t.resolve();return t.promise()},changeColumnsEditability:function(e){var t=this.columns||[];$.each(t,(function(t,i){i.properties.editable="Default"==e?i.originalProperties.editable:bizagi.util.parseBoolean(e)}))},refreshCell:function(e){var t=this,i=t.properties,r=e.key,a=e.column,n=""!==e.xpathContext?e.xpathContext+"."+t.properties.xpath+t.buildCellXpathFilter(r):t.properties.xpath+t.buildCellXpathFilter(r),o=t.getControlCell(r,e.column),s=t.getFormContainer().properties.id;if(o)return o.beforeToRefresh(),$.when(t.dataService.multiaction().refreshGridCell({idRender:i.id,column:o.properties.id,idPageCache:i.idPageCache,xpathContext:n,idForm:s,typeRender:bizagi.util.normalizeType(o.properties.type)})).done((function(e){var i=function(e){return e&&"object"==_typeof(e)&&e.length>=1?e[0].length>=1?e[0][0]:e[0]:""},n=i(e.rows),s=i(e.editable);bizagi.util.isBoolean(s)||(s=s||!0);var l=i(e.visible);bizagi.util.isBoolean(l)||(l=l||!0),t.changeCellVisibility(r,a,l),t.changeCellEditability(r,a,s);var d=o.formatValue(n);o.setValue(d),o.setDisplayValue(d),t.triggerRenderChange({key:r,column:a,changed:!1}),bizagi.override.restoreAppearanceAfterRefresh&&o.restoreCellAppearance(),null!=o.column&&"desktop"==bizagi.util.detectDevice()&&t.updateAffectedCellManually(r,d,o.column.columnIndex),t.afterToRefresh({action:"refreshCell"})}))},triggerRenderChange:function(e){e=e||{},bizagi.util.isEmpty(e)||0==e.changed||(this.properties.canBeExported=!1),this.triggerHandler("renderchange",{render:this,surrogateKey:e.key,column:e.column,changed:e.changed,rowDeleted:e.rowDeleted,pressed:e.pressed,id:e.id||""})},validate:function(){this.isValid([])},isValid:function(e){var t=!0;if(this.hasErrors=!1,this.setValidationMessage(""),this.properties.data&&this.properties.data.rows){var i=this.getDataNewRows();0==i.length&&bizagi.util.parseBoolean(this.properties.required)&&(this.hasValue()||(message=this.getResource("render-required-text").replaceAll("#label#",this.properties.displayName),e.push({xpath:this.properties.xpath,message:message}),t=!1));for(var r=$.merge($.merge([],this.properties.data.rows),i),a=0;a<this.columns.length;a++){for(var n=[],o={},s=0;s<r.length;s++){var l=r[s][a+1],d=r[s][0];this.columns[a].properties.xpath;void 0!==this.changes[d]&&void 0!==this.changes[d][this.columns[a].properties.xpath]&&(l=this.changes[d][this.columns[a].properties.xpath]),this.columns[a].isValueValid(d,l,n,this.getCellOverride(d,a))||(t=!1,this.hasErrors=!0,this.setError(d,this.columns[a].properties.xpath))}for(var c=0,u=n.length;c<u;c++)null==o[n[c]]&&(o[n[c]]=n[c]);if(n.length>0){var p=this.getResource("render-grid-validation").replaceAll("#grid#",this.properties.displayName);for(d in o)e.push({xpath:this.properties.xpath,message:p+" "+d})}}}return t},configureSubmitOnChange:function(){},getCellOverride:function(e,t){t=Number(t);var i=this.columns[t].properties;return this.cellOverrides[e]||(this.cellOverrides[e]={}),this.cellOverrides[e][t]||(this.cellOverrides[e][t]={visible:i.columnVisible&&i.visible,editable:i.editable,required:i.required}),this.cellOverrides[e][t]},setCellOverrides:function(e,t){var i;if(e.visible)for(var r=0,a=e.visible.length;r<a;r++){i=e.visible[r][0];for(var n=0,o=e.visible[r].length;n<o;n++)if(n>0){var s=this.getCellOverride(i,n-1).visible;this.cellOverrides[i][n-1].visible=!!s&&bizagi.util.parseBoolean(e.visible[r][n])}}if(e.editable)for(r=0,a=e.editable.length;r<a;r++){i=e.editable[r][0];for(n=0,o=e.editable[r].length;n<o;n++)if(n>0){var l=!t||bizagi.util.parseBoolean(t[n-1].properties.editable);this.getCellOverride(i,n-1).editable=!!l&&bizagi.util.parseBoolean(e.editable[r][n])}}if(e.required)for(r=0,a=e.required.length;r<a;r++){i=e.required[r][0];for(n=0,o=e.required[r].length;n<o;n++)n>0&&(this.getCellOverride(i,n-1).required=bizagi.util.parseBoolean(e.required[r][n]))}},getIndexes:function(){var e=$.merge(this.properties.data.rows,this.getDataNewRows());return $.map(e,(function(e,t){return e[0]}))},getDataNewRows:function(){var e=this,t=[];return"object"!=_typeof(e.newRecords)||$.isEmptyObject(e.newRecords)||$.each(e.newRecords,(function(i){var r=[];r.push(i);for(var a=0,n=e.columns.length;a<n;a++)r.push(e.getCellCurrentValue(i,e.columns[a].properties.xpath));t.push(r)})),t},getGridExportFile:function(e){var t=this.properties;return this.dataService.getGridExportFile({idRender:t.id,xpathContext:t.xpathContext||"",idPageCache:t.idPageCache,disposition:e.disposition,exportType:e.exportType,sort:t.sort,idForm:this.getFormContainer().properties.id}).then((function(e){return bizagi.util.handleJSONResponse(e)}))},submitForGridChange:function(){return this.submitOnChange(null,!1)},dispose:function(){var e=this,t=setTimeout((function(){e.columns&&$.each(e.columns,(function(e,t){t.dispose()})),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()},getEnabledChecks:function(e){var t=this,i=t.properties;e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,rows:i.rowsPerPage,xpathfilter:e.xpath});var r=new $.Deferred;return t.dataService.multiaction().getGridDataExclusivesSelected(e).done((function(e){i.page=e.page,i.records=e.records,i.totalPages=e.totalPages,t.isRTL()&&(e.rows=t.changeOrderData(e.rows)),r.resolve(e)})),r.promise()},buildCellXpathFilter:function(e){return bizagi.util.isNumeric(e)?"[id="+e+"]":"[id='"+e+"']"},cleanNewRecords:function(){this.newRecords={}},setRowAsSaved:function(e){var t=this.getControl();$("[data-bizagi-component=rows]",t).find("tr[data-business-key="+e+"]").attr("data-new-row","false")},changeBackgroundColor:function(e){this._super(e);var t=this.getControl();return t.find(".bz-rn-grid-header-title, .bz-rn-grid-header-title-rtl").css("background-color",e,"!important"),t.find(".bz-rn-grid-container-foother, .bz-rn-grid-container-foother-rtl").css("background-color",e,"!important"),this},hasColorHeader:function(){var e=this.properties.headerFormat||{};return!!e&&!bizagi.util.isEmpty(e.color)},isRTLOrientation:function(e,t){return t&&"auto"!==t||!e?/^rtl$/i.test(t):this.isRTLOrientation(e.parent,e.properties.orientation)},canBeExport:function(){for(var e in this.changes)if("summary"!==e)for(var t in this.changes[e])if(this.canColumnBeSent(e,t))return!1;if(this.exclusiveChanges)for(var i in this.exclusiveChanges)if(this.exclusiveChanges[i]&&this.enabledChecks[i])return!1;return!0},getExclusiveChangeByRow:function(e){var t={};for(var i in this.enabledChecks)if(this.enabledChecks.hasOwnProperty(i)){var r=(this.enabledChecks[i]||[]).find((function(t){return t.id==e&&t.changed}));r&&(t[i]=r.value)}return t},isCurrentGridCell:function(e,t,i){return e===i||t===i||e+"."+t===i},getIndexForCurrentCell:function(e){var t=this;return(t.columns||[]).findIndex((function(i){return t.isCurrentGridCell(i.properties.xpath,i.properties.id,e)}))||0},isSummaryOrGlobalForm:function(){var e=this.getFormContainer(),t=e&&e.properties||{};return e&&["SummaryForm","GlobalForm"].includes(t.typeForm)}}),$.Class.extend("bizagi.rendering.hidden",{},{renderControl:function(){return"design"===this.getMode()?"<div>"+bizagi.localization.getResource("render-hidden-displayName")+"</div>":"<div />"},postRender:function(){var e=this.properties;this._super(),void 0!==e.value&&this.setDisplayValue(e.value)}}),$.Class.extend("bizagi.rendering.label",{},{initializeData:function(e){this._super(e),this.properties.required=!1,this.properties.displayType="label",this.properties.displayName=e.properties.displayName||"",bizagi.util.parseBoolean(this.properties.allowDinamiclabel)&&(this.properties.displayName=e.properties.displayName||bizagi.localization.getResource("render-label-default-display-name")),this.bindingValue(),this.calculateInitialLayoutProperties()},postRender:function(){this._super(),this.changeDisplayOption("label"),"function"==typeof this.configureHelpText&&this.configureHelpText()},postRenderReadOnly:function(){this._super(),this.changeDisplayOption("label"),this.changeLabelAlign(this.properties.labelAlign||"left")},isValid:function(e){},canBeSent:function(){return!1},bindingValue:function(){this.properties.allowDinamiclabel&&this.properties.value&&("object"===_typeof(this.properties.value)&&this.properties.value[0]?this.properties.displayName=this.properties.value[0].value:"string"==typeof this.properties.value&&""!==this.properties.value&&(this.properties.displayName=this.performLabelLineBreak(this.properties.value)))},controlValueIsChanged:function(){return!1},performLabelLineBreak:function(e){return(e||"").replace(/\\n/gm,"\n")}}),$.Class.extend("bizagi.rendering.search",{},{initializeData:function(e){var t=e.properties.submitOnChange;"execution"===this.getMode()&&e.properties.advancedSearch&&(t=void 0!==t?t:!((e.properties.submitVersion||1)>1)),this._super(e);var i=this.properties;i.submitOnChange=bizagi.util.parseBoolean(t)||!1,i.searchForms=i.searchForms||[],i.maxRecords=Number(i.maxRecords)||20,i.advancedSearch=null!==bizagi.util.parseBoolean(i.advancedSearch)&&bizagi.util.parseBoolean(i.advancedSearch),i.allowSuggest=null!==bizagi.util.parseBoolean(i.allowSuggest)&&bizagi.util.parseBoolean(i.allowSuggest),i.allowFullSearch=i.allowFullSearch||!1,i.allowAdd=bizagi.util.parseBoolean(i.allowAdd)||!1,i.allowTyping=null!==bizagi.util.parseBoolean(i.allowTyping)&&bizagi.util.parseBoolean(i.allowTyping),i.allowTyping=!!bizagi.util.parseBoolean(i.allowSuggest)||i.allowTyping,i.allowClear=null!==bizagi.util.parseBoolean(i.allowClear)&&bizagi.util.parseBoolean(i.allowClear),i.editable=null===bizagi.util.parseBoolean(i.editable)||bizagi.util.parseBoolean(i.editable),i.searchLength=i.searchLength||2,i.enableLocalStorage=!1,i.expireCache=9e5},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("search");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,allowTyping:e.allowTyping,advancedSearch:e.advancedSearch,allowSuggest:e.allowSuggest,editable:e.editable,allowClear:e.allowClear,hasValue:this.hasValue()})},getData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.getFormContainer(),n=a.getContextType()||a.params.contexttype||!1;if(e=e||{},t.properties.contexttype?e.h_contexttype=t.properties.contexttype:n&&(e.h_contexttype=n),e.h_contexttype=t.properties.enableQuerySuggestBehavior?"metadata":e.h_contexttype,e&&e.h_contexttype&&"metadata"===e.h_contexttype&&(i.xpathContext=""),i.term.indexOf("'")>-1){var o=new RegExp("'","g");i.term=i.term.replace(o,"\\'\\'")}if(i.term.indexOf('"')>-1){o=new RegExp('"',"g");i.term=i.term.replace(o,'"')}return t.dataService.multiaction().getSearchData({url:i.dataUrl,contexttype:e.h_contexttype,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.allowFullSearch?"%"+i.term:i.term,extra:e}).done((function(e){i.data=e,r.resolve(i.data)})).fail((function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)})),r.promise(r)},setValue:function(e,t){t=void 0===t||t,this._super(e,t),null!=e?(this.value=e,this.selectedValue=e.label):(this.value=null,this.selectedValue=null)},mapValue:function(e){return e&&e.fromAction?{id:e.value,value:e.label,label:e.label}:e},collectData:function(e){var t=this.properties.xpath,i=this.getValue();if(this.controlValueIsChanged()&&!bizagi.util.isEmpty(t)&&null!=i){if("object"==_typeof(i)&&void 0===i.id)return;e[t]=i}},submitData:function(){var e={};this.grid||(e[this.properties.xpath]=this.getValue()),this.submitOnChange(e,void 0,!1)},isValid:function(e){return this._super(e)},hasValue:function(){var e=this.getValue();return void 0!==e&&null!=e&&("object"===_typeof(e)&&""!==e.id&&void 0!==e.id||!bizagi.util.isEmpty(e))},formatItem:function(e){return bizagi.util.formatItem(e)}}),$.Class.extend("bizagi.rendering.text",{},{initializeData:function(e){this._super(e);var t=this.properties;if(t.regularExpressionExpression){var i=t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message");t.regularExpression={expression:t.regularExpressionExpression,message:i}}},renderControl:function(){var e=this.renderFactory.getTemplate("text");return $.fasttmpl(e,{id:this.properties.id,value:this.properties.value,isEmptyField:void 0===this.properties.value,helpText:this.properties.helpText,editable:this.properties.editable})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("text-read-only"),t=this.getValue();return bizagi.util.isString(t)&&(t=t.replaceAll("`","&#96;")),$.fasttmpl(e,{value:t,editable:this.properties.editable})},postRender:function(){this._super(),this.input=this.getControl().find("input"),"double"===this.properties.retype&&this.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var e=this,t=e.properties;t.mask&&e.input.mask({mask:t.mask}),e.input.bind("change",(function(){e.setValue(e.input.val(),!1);"duplicate"!==t.retype&&(e.isValid([])||void 0===t.regularExpression)&&e.setValue(e.input.val(),!0)})).keypress((function(e){var t=(e=window.event||e).charCode||e.keyCode;void 0!==e&&13==t&&$(this).trigger("change")})),bizagi.util.isAndroidDevice()&&t.maxLength>0&&e.input.bind("keyup",(function(e){($(this).val()&&$(this).val().length)>=t.maxLength&&(e.preventDefault(),e.target.value=e.target.value.substring(0,t.maxLength))}))},isValid:function(e){var t=this.properties,i=this._super(e),r=this.getValue();if("string"==typeof r)if(t.regularExpression){if(t.editable){var a=new RegExp("");try{a=new RegExp(t.regularExpression.expression)}catch(r){bizagi.override.showDesignValidations&&(bizagi.log(r),e.push({xpath:t.xpath,message:r.message}),i=!1)}if(r&&(r.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!r.match(a)&&this.properties&&"userName"===this.properties.xpath)){var n=t.regularExpression.message;e.push({xpath:t.xpath,message:n}),i=!1}else if(r&&(r.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!r.match(a))){n=t.regularExpression.message;e.push({xpath:t.xpath,message:n}),i=!1}}}else if(r&&r.match(new RegExp(".*?eval\\(","g"))&&r.match(new RegExp(".*?eval\\u0028","g"))&&t.editable){n=this.getResource("render-text-regular-expression-default-message");e.push({xpath:t.xpath,message:n}),i=!1}return i},setDisplayValue:function(e){var t=this.getControl(),i=bizagi.util.decodeURI(e);if(!bizagi.util.parseBoolean(this.properties.editable))if("string"==typeof e){var r=bizagi.util.encodeHtmlText(this.getDisplayValue());t.html("<label class='readonly-control'>"+r+"</label>")}else bizagi.util.isNull(e)&&t.html("");this.setValue(i,!1)},setValue:function(e){this._super(e)},createTooltip:function(e,t,i){e.data("oldValue",t),e.val(""),e.data("ui-tooltip")&&e.tooltip("destroy"),e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",(function(e,t){t.tooltip.zIndex(r)})),e.tooltip("open");var a=setTimeout((function(){e.focus(),clearTimeout(a)}),100)},validateValue:function(e,t){return"string"!=typeof e||t<1||e.length<=t?e:e.substr(0,t)}}),$.Class.extend("bizagi.rendering.readonly",{},{initializeData:function(e){this._super(e)},renderControl:function(){var e=this.renderFactory.getTemplate("readonly-value"),t="execution"==this.getMode()?this.getFormattedValue(this.properties.value,this.properties.dataType):this.getDesignModeValue(this.properties.renderType);return $.fasttmpl(e,{id:this.properties.id,value:t})},renderReadOnly:function(){return this.renderControl()},setDisplayValue:function(e){},setValue:function(e,t){},getFormattedValue:function(e,t){return bizagi.util.isEmpty(e)?"":[1,2,3,4,7].includes(t)?e:[5,17].includes(t)?bizagi.util.formatBoolean(e):[8].includes(t)?bizagi.util.formatMonetaryValue(e):[6,10,11].includes(t)?bizagi.util.formatDecimalValue(e):[12,13].includes(t)?bizagi.util.formatDateValue(e):bizagi.util.sanitizeHTML(e)||""},getDesignModeValue:function(e){return"number"==e?"123":"string"==e?"abc":"date"==e?"1/1/1900":"boolean"==e?"false":"currency"==e?"$123":""},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.element.style("background",e,"important"):this.element.css("background",""),this)},getElementsToStylize:function(e){return $(".bz-input--readonly",e)}}),$.Class.extend("bizagi.rendering.checkList",{},{initializeData:function(e){this._super(e);var t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1,this.setValue(t.items),this.updateOriginalValue()},postRender:function(){var e=this.getControl();this._super(),this.checkListGroup=$(".ui-bizagi-render-checkList .ui-bizagi-render-checkList-item",e)},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate(this.getTemplateName()),i=this.properties.items||[];return $.fasttmpl(t,$.extend(this.getTemplateParams(),{id:e.id,xpath:e.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:e.idPageCache,items:i}))},getTemplateName:function(){return"checkList"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){return{vertical:!this.properties.horizontal}},cleanData:function(){},setValue:function(e){this.value=bizagi.clone(e)},getValue:function(e){return this.value||[]}}),$.Class.extend("bizagi.rendering.range",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e)},renderControl:function(){var e;this.properties;return e=this.renderFactory.getTemplate("render-range"),$.fasttmpl(e,{})},setRanageControls:function(e,t){this.minControl=e||null,this.maxControl=t||null;var i=this.getControl(),r=$(".bz-range-maximum",i),a=$(".bz-range-minimum",i);this.renderRangeControl(a,e),this.renderRangeControl(r,t)},getValue:function(){return{min:this.minControl.getValue(),max:this.maxControl.getValue()}},renderRangeControl:function(e,t){$.when(t.render("render")).done((function(i){e.empty().append(i),t.postRenderElement(e)}))}}),$.Class.extend("bizagi.rendering.rangeDate",{},{defineRangeControl:function(e){var t=bizagi.rendering.date.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=bizagi.rendering.date.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),r=new t(this.getRenderProperties("min")),a=new i(this.getRenderProperties("max"));r.suscribe(a),a.suscribe(r),this.setRanageControls(r,a)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,r={data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return r.data.properties.displayName="min"===e?"From":"To",r}}),$.Class.extend("bizagi.rendering.rangeMoney",{},{defineRangeControl:function(){var e=bizagi.rendering.money.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),t=bizagi.rendering.money.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=new e(this.getRenderProperties("min")),r=new t(this.getRenderProperties("max"));i.suscribe(r),r.suscribe(i),this.setRanageControls(i,r)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService}}}),$.Class.extend("bizagi.rendering.rangeNumber",{},{defineRangeControl:function(){var e=bizagi.rendering.number.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),t=bizagi.rendering.number.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=new e(this.getRenderProperties("min")),r=new t(this.getRenderProperties("max"));i.suscribe(r),r.suscribe(i),this.setRanageControls(i,r)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService}}}),$.Class.extend("bizagi.rendering.actionLauncher",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer();this.typeForm=t.properties.typeForm||"";var i=this.getMode(),r=this.properties;this.deferredActions=new $.Deferred,this.deferredActions.promise(),"execution"==i&&(this.engine=new bizagi.templateEngine({renderFactory:this.renderFactory,cache:!0,autoGenerateData:!1,templateGuid:r.selecttemplate})),this.processPropertyValueArgs={pcaseId:this.getIdCase(),pguidEntity:this.properties.guidEntity,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,property:"data",psurrogatedKey:this.properties.surrogatedKey,ptags:this.properties.tagslist||[],pmaxitems:this.properties.maxItems,pactionXpath:this.properties.xpathActions},this.processPropertyValueDataTmplArgs={pactionXpath:this.properties.xpathActions,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,ptemplateGuid:r.selecttemplate,property:"dataTemplate",xpathActions:this.properties.xpathActions},this.properties.valueWidth=100,this.properties.displayType="value";var a="entityTemplate"!==e.properties.type;this.properties.allowactions=void 0===e.properties.allowactions?a:e.properties.allowactions,this.properties.isHorizontal=void 0===e.properties.isHorizontal||e.properties.isHorizontal,this.properties.allowSearch=void 0!==e.properties.allowSearch&&e.properties.allowSearch,this.properties.selecttemplate=void 0===e.properties.selecttemplate?"":e.properties.selecttemplate,this.properties.templatetype=void 0!==r.templatetype?r.templatetype:"none",this.properties.sessionId=t.params.data.sessionId,this.properties.value?"string"==typeof this.properties.value&&(this.properties.value=this.value=JSON.parse(this.properties.value)):(this.properties.value=this.value=[],this.properties.originalValue=[])},executeActionImmediately:function(e){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeAction",psurrogatedKey:t.properties.surrogatedKey,pguidAction:e.guidAction,pparameters:JSON.encode({idStartScope:e.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:e.idPageCache})};t.dataService.executeActions(r).done((function(i){t.notifyExecution(i,e)})).fail((function(i){t.notifyExecution("Error",e)}))},notifyExecution:function(e,t){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0,this.postRender()},renderControl:function(){var e,t=this.properties,i="";if("design"==this.getMode()){e=this.renderFactory.getTemplate("render-actionLauncher-design");var r={type:t.type,isHorizontal:t.isHorizontal,allowSearch:t.allowSearch,templateDefined:"none"!=t.templatetype,allowactions:t.allowactions};i=$.fasttmpl(e,r)}else t.surrogatedKey&&(e=this.renderFactory.getTemplate("render-actionLauncher"),i=$.fasttmpl(e,{allowactions:this.properties.allowactions}));return i},isValid:function(e){var t=this.properties;this.getValue();return 0==bizagi.util.parseBoolean(t.visible)||(0==bizagi.util.parseBoolean(t.editable)||!(!t.required||!this.value)&&(this.value.length>0||(message=this.getResource("render-required-register-action"),e.push({xpath:t.xpath,message:message}),!1)))},setDisplayValue:function(e){this.getControl();this.setValue(e,!1)},actionManager:function(e){var t=this,i=e.guidProcess||"",r=new $.Deferred;switch(e.recordXpath=t.getFormContainer().properties.recordXpath,e.actionType){case"Process":var a={guidWFClass:i};$.when(t.dataService.hasStartForm(a)).done((function(a){a.hasStartForm?$.when(t.processStartForm({guidprocess:i,title:e.displayName,recordXpath:e.recordXpath})).done((function(t){e.idStartScope=t,r.resolve(e)})):r.resolve(e)}));break;case"Rule":r.resolve(e);break;case"Form":e.xpathContext?$.when(t.processActionFormCollection(e)).done((function(t){e.idStartScope=t,r.resolve(e)})):("Form"===e.actionType&&(e.xpathContext=void 0,e.contextType="entitytemplate",e.guidEntity=e.guidEntity||t.properties.guidEntity),$.when(t.processActionForm(e)).done((function(t){e.idStartScope=t,r.resolve(e)})))}return r.promise()},addActionToQueue:function(e){var t=this.getValue(),i=this.getFormContainer().getParams();e.params=e.params||{};var r=this.properties.xpathContext;switch(e.actionType){case"Process":e.params={idStartScope:e.idStartScope,additionalXpaths:this.properties.additionalXpath.join(","),idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,recordXpath:r};break;case"Form":e.params={idStartScope:e.idStartScope,additionalXpaths:this.properties.additionalXpath.join(","),entityXpath:this.properties.xpathActions,idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,idEntity:e.idEntity};break;case"Rule":e.params={xpathActions:e.xpathActions||"",recordXpath:r}}var a=bizagi.clone(t);a.push(e),this.setValue(a),this.setDisplayValue(a)},removeActionToQueue:function(e){var t=bizagi.clone(this.getValue());t.splice(e,1),this.setValue(t),this.setDisplayValue(t)},collectData:function(e){if(this.controlValueIsChanged()){var t=this.properties.xpath,i=this.getValue(),r=[];$.each(i,(function(e,t){var i={};i.params=t.params||{},i.guidAction=t.guidAction,r.push(i)})),e[t]=0==r.length?"":JSON.encode(r)}},countSameActions:function(e){var t=this.getValue(),i=0;return $.each(t,(function(t,r){r.guidAction==e.guidAction&&i++})),i},getPropertiesActionLaucher:function(e){for(var t=this.getFormContainer(),i=0,r=e.length;i<r;i+=1)6===e[i].length&&(e[i].splice(5,0,""),"Process"==e[i][3]&&t.properties.xpathContext&&(e[i][5]=t.properties.xpathContext));return e}}),$.Class.extend("bizagi.rendering.entityTemplate",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.getFormContainer();this.deferredActions=new $.Deferred,this.deferredActions.promise(),this.processPropertyValueArgs={pcaseId:this.getIdCase(),pguidEntity:this.properties.guidEntity,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,property:"data",psurrogatedKey:this.properties.surrogatedKey},this.properties.valueWidth=100,this.properties.displayType="value",this.properties.allowactions=void 0===e.properties.allowactions||e.properties.allowactions,this.properties.value?"string"==typeof this.properties.value&&(this.properties.value=this.value=JSON.parse(this.properties.value)):this.properties.value=this.value=[]},renderControl:function(){var e,t="";return"design"==this.getMode()?(e=this.renderFactory.getTemplate("render-entityTemplate-design"),t=$.fasttmpl(e,{})):this.properties.surrogatedKey&&(e=this.renderFactory.getTemplate("render-entityTemplate"),t=$.fasttmpl(e,{allowactions:this.properties.allowactions})),t},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t},setDisplayValue:function(e){this.getControl();this.setValue(e,!1)}}),$.Class.extend("bizagi.rendering.polymorphicLauncher",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.getFormContainer();this.typeForm=t.properties.typeForm||"";this.getMode();this.deferredActions=new $.Deferred,this.deferredActions.promise(),this.properties.valueWidth=100,this.properties.displayType="value",this.properties.allowSearch=void 0!==e.properties.allowSearch&&e.properties.allowSearch,this.properties.additionalXpath=this.properties.additionalXpath||[],this.properties.value?"string"==typeof this.properties.value&&(this.properties.value=this.value=JSON.parse(this.properties.value)):(this.properties.value=this.value=[],this.properties.originalValue=[]),this.processPropertyValueArgs={pcaseId:this.getIdCase(),pguidEntity:this.properties.guidEntity,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,property:"data",ptags:this.getTagList(this.properties.tagslist),additionalXpaths:this.properties.additionalXpath}},executeActionImmediately:function(e){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeConstructor",psurrogatedKey:t.properties.surrogatedKey,pguidConstructor:e.guidConstructor,pparameters:JSON.encode({idStartScope:e.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:e.idPageCache})};t.dataService.executeActions(r).done((function(i){t.notifyExecution(i.response,e)})).fail((function(i){t.notifyExecution("Error",e)}))},notifyExecution:function(e,t){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0,this.postRender()},renderControl:function(){var e,t=this.properties,i="";if("design"==this.getMode()){e=this.renderFactory.getTemplate("render-polymorphicLauncher-design");var r={type:t.type,allowSearch:t.allowSearch};i=$.fasttmpl(e,r)}else t.surrogatedKey&&(e=this.renderFactory.getTemplate("render-polymorphicLauncher"),i=$.fasttmpl(e));return i},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t},setDisplayValue:function(e){this.setValue(e,!1)},actionManager:function(e){var t=this,i=e.guidObject||"",r=new $.Deferred;switch(e.recordXpath=t.getFormContainer().properties.recordXpath,e.actionType){case"Process":var a={guidWFClass:i};$.when(t.dataService.hasStartForm(a)).done((function(a){a.hasStartForm?$.when(t.processStartForm({guidprocess:i,title:e.displayNamee,recordXpath:e.recordXpath})).done((function(t){e.idStartScope=t,r.resolve(e)})):r.resolve(e)}));break;case"Rule":r.resolve(e);break;case"Form":$.when(t.processActionForm(e)).done((function(t){e.idStartScope=t,r.resolve(e)}))}return r.promise()},addActionToQueue:function(e){var t=this.getValue(),i=this.getFormContainer().getParams();e.params=e.params||{};var r=this.properties.xpathContext;switch(e.actionType){case"Process":e.params={additionalXpaths:this.properties.additionalXpath.join(","),idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,recordXpath:r},void 0!==e.idStartScope&&(e.params.idStartScope=e.idStartScope);break;case"Form":e.params={idStartScope:e.idStartScope,additionalXpaths:this.properties.additionalXpath.join(","),entityXpath:this.properties.xpathActions,idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,idEntity:e.idEntity,guidEntity:e.guidEntity}}t.push(e),this.setValue(t),this.setDisplayValue(t)},removeActionToQueue:function(e){var t=this.getValue();t.splice(e,1),this.setValue(t),this.setDisplayValue(t)},collectData:function(e){if(this.controlValueIsChanged()){var t=this.properties.xpath,i=this.getValue(),r=[];$.each(i,(function(e,t){var i={};i.params=t.params||{},i.guidAction=t.guidObject||t.guidAction,i.displayName=t.displayName,i.guidConstructor=t.guidConstructor,i.actionType=t.actionType,i.xpathContext=t.xpathContext,i.guidEntity=t.guidEntity,r.push(i)})),e[t]=0==r.length?"":JSON.encode(r)}},countSameActions:function(e){var t=this.getValue(),i=0;return $.each(t,(function(t,r){r.guidAction==e.guidAction&&i++})),i},getTagList:function(e){for(var t=[],i=(e=e||[]).length;i>0;i--)t.push(e[i-1].value);return t.length>0?t:""}}),$.Class.extend("bizagi.rendering.button",{},{initializeData:function(e){this._super(e);var t=this.properties;t.caption=t.caption||"",t.displayType="value",t.required=!1,t.preventDefault=t.preventDefault||!1},renderControl:function(){var e=this.renderFactory.getTemplate("button");return $.fasttmpl(e,{caption:this.properties.caption,cssClass:this.properties.cssclass||"",editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},saveForm:function(){return this.getFormContainer().saveForm()},executeButton:function(){var e=this,t=e.properties,i=t.xpathContext||"";return t.submitOnChangexpathContextRow&&(i=i?i+"."+t.submitOnChangexpathContextRow:t.submitOnChangexpathContextRow),e.getFormContainer().startLoading(),e.dataService.multiaction().executeButton({idRender:t.id,xpath:t.xpath||"",xpathContext:i||"",idPageCache:t.idPageCache}).always((function(){return e.getFormContainer().endLoading(),arguments?arguments[0]:void 0}))},refreshForm:function(){this.getFormContainer().refreshForm(this.properties.id)},processButton:function(){this.properties.editable&&this.runButtonAction()},triggerRenderChange:function(e){var t=(e=e||{}).pressed||!1;this.triggerHandler("renderchange",{render:this,pressed:t})},runButtonAction:function(){var e=this;e.getFormContainer().clearValidationMessages(),e.saveForm().pipe((function(){return e.executeButton()})).done((function(t){var i=t&&t.type?t.type:"";if(null==t||1==t||"success"===t.result||"success"===t.type)return e.refreshForm();if(["validationMessages","alertMessages"].includes(i))try{"alertMessages"===i?bizagi.modalError&&bizagi.modalError.show(t.messages.join("\n\n"),"workportal-general-word-information",!1):e.getFormContainer().addValidationMessage(t.messages)}catch(e){}})).fail((function(t){try{var i=bizagi.util.getErrorFormatted(t),r=void 0===i?{message:bizagi.localization.getResource("workportal-general-error")}:i;e.getFormContainer().failHandler(r)}catch(e){}}))},processLayout:function(e,t){e&&(this.changeBackgroundColor(t.background),this._super(!e,t))},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.getElementsToStylize(this.getControl()).style("background",e,"important"):this.getElementsToStylize(this.getControl()).css("background",""),this)},getElementsToStylize:function(e){return $("input",e)},canBeSent:function(){return!1},configureSubmitOnChange:function(){var e=this,t=e.properties,i="";if(t.editable){t.dependencies=t.dependencies||"all";var r={conditions:{expressions:[{simple:{renderId:i=t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.id:t.id,operator:"changes",argumentType:"const"}}]},commands:[{xpath:i,command:"submit-value",argument:t.dependencies}],dependencies:[i],elseCommands:[]};$.when(e.ready()).done((function(){e.getFormContainer().addSubmitAction(i,r)}))}}}),$.Class.extend("bizagi.rendering.fileprint",{},{initializeData:function(e){this._super(e);var t=this.properties,i=$.trim(t.caption);t.caption=bizagi.util.isEmpty(i)?"render-fileprint-property-caption":i,t.filesCount=t.filesCount?t.filesCount:0,t.displayType="value",this.calculateInitialLayoutProperties(),t.required=!1},renderControl:function(){var e=this.renderFactory.getTemplate("fileprint");return $.fasttmpl(e,{caption:this.properties.caption})},renderReadOnly:function(){return this.renderControl()},downloadFile:function(){return this.dataService.getFilePrint({idRender:this.properties.id,xpathContext:this.properties.xpathContext||"",idPageCache:this.properties.idPageCache,contexttype:this.properties.contexttype,disposition:"download"}).then((function(e){return bizagi.util.handleJSONResponse(e)}))}}),$.Class.extend("bizagi.rendering.link",{},{initializeData:function(e){this._super(e);var t=this.properties;t.required=!1,t.displayType="value",this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.renderFactory.getTemplate("link");return $.fasttmpl(e,{displayName:this.properties.displayName,align:this.properties.valueAlign,editable:this.properties.editable})},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},isValid:function(e){},setDisplayValue:function(e){},canBeSent:function(){return!1}}),$.Class.extend("bizagi.rendering.geolocation",{},{init:function(e){this._super(e),this.geolocation=window.navigator.geolocation;var t=this.properties;t.allowUpdate=!0===bizagi.util.parseBoolean(t.allowUpdate)},renderControl:function(){var e=this.renderFactory.getTemplate("geolocation");return $.fasttmpl(e,this.properties)},isValid:function(e){return this._super(e)},setDisplayValue:function(e){this.setValue(e,!1)},configureHandlers:function(){},getCurrentPosition:function(e,t){var i=this;if(void 0!==i.geolocation){return i.geolocation.getCurrentPosition((function(t){e&&e(t)}),(function(e){var r=i.getErrorMessage(e);t&&t(r)}))}t&&t(bizagi.localization.getResource("render-control-unsuported-by-browser").replace("{0}",i.properties.type))},getErrorMessage:function(e){var t="";switch(e.code){case e.PERMISSION_DENIED:case 1:t=bizagi.localization.getResource("render-geolocation-permission-denied");break;case e.POSITION_UNAVAILABLE:case 2:t=bizagi.localization.getResource("render-geolocation-position-unavailable");break;case e.TIMEOUT:case 3:t=bizagi.localization.getResource("render-geolocation-timeout");break;default:t="WD: "+bizagi.localization.getResource("render-geolocation-permission-denied")}return t},performPrecision:function(e){var t=e.split(" ")||"";if(!t)return e;try{var i=parseFloat(t[0].trim()),r=parseFloat(t[1].trim());return i.toPrecision(10)+" "+r.toPrecision(10)}catch(t){return e}}}),$.Class.extend("bizagi.rendering.association",{},{initializeData:function(e){this._super(e);var t=this.properties;t.property="flipped",t.idRender=this.properties.id,t.allowFlip=void 0===t.allowFlip||bizagi.util.parseBoolean(t.allowFlip),t.flipped=void 0!==t.flipped&&bizagi.util.parseBoolean(t.flipped),t.flipstate=t.flipped,t.leftData=t.leftData||[],t.rightData=t.rightData||[],t.value&&this.processPropertyValue()},renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done((function(r){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(r)||!1;var a=$.fasttmpl(t,e.properties,{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(a)})),i.promise()},getFlipAssociation:function(){return"execution"==this.getMode()&&this.dataService.getFlipAssociation(this.properties)},getDisplayValue:function(){return this.getValue()},getTemplateName:function(){return"association"},getColumnData:function(){var e=this.data,t=[],i=e.flipped?e.rightData:e.leftData;return $.each(i,(function(e,i){t.push({id:i.id,value:i.value})})),t},getRightAssociation:function(e){var t=this.data,i=[],r=function(e,i){var r=!1;return $.each(t.formatJson.value,(function(t,a){!r&&a.id==e&&a.value.indexOf(i)>=0&&(r=!0)})),r};return t.flipped?$.each(t.leftData,(function(t,a){i.push({id:a.id,name:a.value,checked:r(a.id,e)})})):$.each(t.rightData,(function(t,a){i.push({id:a.id,name:a.value,checked:r(e,a.id)})})),i},removeElement:function(e,t){var i=this;$.each(i.properties.formatJson.value,(function(r,a){i.properties.flipped?a.id==t&&$.each(i.properties.formatJson.value[r].value,(function(t,a){e==a&&i.properties.formatJson.value[r].value.splice(t,1)})):a.id==e&&$.each(i.properties.formatJson.value[r].value,(function(e,a){t==a&&i.properties.formatJson.value[r].value.splice(e,1)}))})),i.setValue(JSON.encode(i.properties.formatJson))},addElement:function(e,t){var i=this;$.each(i.properties.formatJson.value,(function(r,a){i.properties.flipped?a.id==t&&i.properties.formatJson.value[r].value.push(e):a.id==e&&i.properties.formatJson.value[r].value.push(t)})),i.setValue(JSON.encode(i.properties.formatJson))},makeJsonBase:function(){this.properties.formatJson=this.properties.formatJson||{leftXpath:this.properties.leftXpath,rightXpath:this.properties.rightXpath,leftFactName:this.properties.leftFactName,rightFactName:this.properties.rightFactName,value:this.properties.value}},hasValue:function(){if(this.properties.formatJson)var e=this.properties.formatJson.value;else e=this.properties.value;for(var t=0,i=e.length;t<i;t++){var r=e[t];if(r&&r.value.length>0)return!0}return!1},processPropertyValue:function(){for(var e=this.properties,t=e.value,i=[],r=0,a=t.length;r<a;r++){var n=t[r];i.push({id:n[0],value:n[1]})}e.value=i}}),$.Class.extend("bizagi.rendering.upload",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties,r=Number(i.maxSize)||0,a="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):4091904;if(i.maxSize=r||a,i.maxfiles=Number(i.maxfiles)||999,i.validExtensions=i.validExtensions||"",i.validExtensions.length>0&&i.validExtensions.indexOf(".")<0){for(var n=i.validExtensions.replace(/\ /gi,"").split(";"),o=[],s=0;s<n.length;s++)if(n[s].length>0)o.push("*."+n[s]);else{n.indexOf(n[s]);n.splice(s,1)}i.validExtensions=o.join(";")}i.addUrl=i.addUrl||this.dataService.getUploadAddUrl(),i.deleteUrl=i.deleteUrl||void 0,i.editable=bizagi.util.parseBoolean(i.editable)||!1,i.allowDelete=!(null===bizagi.util.parseBoolean(i.allowDelete)||!i.editable)&&bizagi.util.parseBoolean(i.allowDelete),i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",i.allowSendInMail=i.allowSendInMail||!1,this.files=i.value||[],this.filesCount=this.files.length},renderControl:function(){for(var e=this.properties,t=this.renderFactory.getTemplate("upload"),i=$.fasttmpl(t,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),editable:e.editable,haveFiles:0!==this.filesCount,noFiles:0===this.filesCount,allowSendInMail:e.allowSendInMail}),r="",a=0;a<this.filesCount;a++){var n={id:this.files[a][0],fileName:this.files[a][1]};r+=this.renderUploadItem(n)}return i=this.replaceFilesHtml(i,r)},renderReadOnly:function(){return this.renderControl()},renderUploadItem:function(e){var t=this.getMode(),i=this.getTemplateItemName(),r=this.renderFactory.getTemplate(i),a=this.getFormContainer(),n=a.params&&a.params.printversion,o=this.isExecutionMode()?this.buildItemUrl(e):"";return $.fasttmpl(r,{id:e.id,mode:t,url:o,allowDelete:this.properties.allowDelete,filename:bizagi.util.decodeURI(e.fileName),editable:this.properties.editable,printVersion:n||!1})},buildItemUrl:function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getUploadXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},deleteUploadItem:function(e,t){var i=this,r=i.properties,a=i.getUploadXpath()+(bizagi.util.isNumeric(t)?"[id="+t+"]":"[id='"+t+"']");return i.dataService.deleteUploadFile({url:r.deleteUrl,idRender:r.id,xpath:a,xpathContext:r.xpathContext,idPageCache:r.idPageCache,contexttype:r.contexttype}).pipe((function(){i.filesCount=i.filesCount-1,i.files=$.grep(i.files,(function(e){return e[0]!=t}))}))},canBeSent:function(){return!1},setValue:function(e,t){this.files=e||[],this.filesCount=this.files.length,this._super(e,t)},getValue:function(){return this.files},isValid:function(e){var t,i=this.properties,r=!0;if(this.setValidationMessage(""),i.required&&i.editable){var a=this.grid&&this.grid.isFromCreatedRow.apply(this);if(this.filesCount<=0&&!a)(!this.grid||this.grid.properties.inlineEdit)&&(t=this.getResource("render-required-upload").replaceAll("#label#",i.displayName),e.push({xpath:i.xpath,message:t}),r=!1)}return r},buildAddParams:function(){var e=this.properties,t=this.getFormContainer(),i={},r=this.Class.BA_CONTEXT_PARAMETER_PREFIX;i[r+"xpath"]=this.getUploadXpath(),i[r+"idRender"]=e.id,i[r+"xpathContext"]=e.xpathContext,i[r+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=t.properties.sessionId,i[r+"contexttype"]=e.contexttype;try{"undefined"!=typeof BIZAGI_SESSION_NAME?i[BIZAGI_SESSION_NAME]=t.properties.sessionId:i.JSESSIONID=t.properties.sessionId}catch(e){i.JSESSIONID=t.properties.sessionId}return i},getUploadXpath:function(){return this.properties.xpath},getUploadXpathContext:function(){return this.getXpathContext()||this.properties.xpathContext},checkRequired:function(e){var t=this.properties;if(bizagi.util.parseBoolean(t.required))if(this.grid&&!0===this.grid.properties.inlineAdd){if(!this.hasValue()&&!this.getControl().parents("tr").data("new-row"))return this.setRenderRequired(e,t),!1}else if(!this.hasValue())return this.setRenderRequired(e,t),!1;return!0},setRenderRequired:function(e,t){var i=this.getResource("render-required-text").replaceAll("#label#",t.displayName);e.push({xpath:t.xpath,message:i})},getTemplateItemName:function(){return"uploadItem"},formatValue:function(e){var t=function(e){return!(!e.uploadId||!e.fileName)},i=function(e){return!(!e[0]||!e[1])};return(e||[]).reduce((function(e,r){var a=!1,n=bizagi.util.bzValidator(r).add(t).validate((function(t){(a=t.errors&&!t.errors.length)&&e.push([r.uploadId,r.fileName])}));return a||n.add(i,"The value is not in a valid format").validate((function(t){t.errors&&t.errors.length>0?console.warn(t.errors):e.push([r])})),e}),[])}}),$.Class.extend("bizagi.rendering.ecm",{},{initializeData:function(e){this._super(e);var t=this.properties;if(t.maxSize=Number(t.maxSize)||("undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):t.maxSize=Number(t.maxSize)||4091904),t.maxFiles=Number(t.maxfiles)||999,t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var i=t.validExtensions.split(";"),r=0;r<i.length;r++)i[r]="*."+i[r];t.validExtensions=i.join(";")}t.addUrl=this.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=uploadECMFile",t.editUrl=this.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=updateECMFileContent",t.deleteUrl=t.deleteUrl||void 0,t.allowDelete=null===bizagi.util.parseBoolean(t.allowDelete)||bizagi.util.parseBoolean(t.allowDelete),t.q_xpath=bizagi.util.encodeXpath(t.xpath),t.showMetadata=void 0===t.showMetadata||null===t.showMetadata||bizagi.util.parseBoolean(t.showMetadata);var a=this.getResource("dateFormat"),n=this.getResource("timeFormat");t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||a,t.timeFormat=t.timeFormat||n,t.fullFormat=t.dateFormat,this.files=t.value||[],this.filesCount=this.files.length,t.xpathContext=this.parent.properties.xpathContext||t.xpathContext||""},renderControl:function(e,t){var i=this,r=i.properties,a=i.renderFactory.getTemplate("ecm"),n=i.getMode(),o=new $.Deferred;r.value=t?[[t.idFileUpload,t.fileName]]:i.value;var s=$.fasttmpl(a,r,{getFileExtension:i.getFileExtension,isImage:i.isImage});if(null!=i.properties.value){var l=i.properties.value.length;0===l&&o.resolve(s),$.each(i.properties.value,(function(e,r){var a={};a.idFileUpload=r[0],a.fileName=r[1],a.idPageCache=i.properties.idPageCache,a.xpathContext=i.getXpathContext(),a.xPath=i.properties.xpath,a.editable=i.properties.editable,a.idAttrib=i.properties.idAttrib;var d=i.getFormContainer();d&&d.properties&&d.properties.sessionId&&(a.sessionId=d.properties.sessionId),"execution"===n&&$.when(i.renderFileLayout(a,t)).done((function(e){l--,bizagi.loader.productBuildToAbout&&0===bizagi.loader.productBuildToAbout.indexOf("10.4")&&(e=e.replaceAll("Handlers/MetadataFile","Handlers/Metadata")),s=i.replaceItemHtml(s,i.properties.id+"-"+a.idFileUpload,e),0===l&&o.resolve(s)}))}))}else o.resolve(s);return o.promise()},replaceItemHtml:function(e,t,i){return e.replace("{{"+t+"}}",i)},renderFileLayout:function(e,t){var i=this,r=i.getFormContainer(),a=i.renderFactory.getTemplate("ecm-metadata"),n=$.Deferred();return $.when(i.dataService.getECMMetadata(e),t?[t]:i.dataService.getFileProperties(e)).done((function(t,o){o[0].data=e,o[0].xpathContext=o[0].xpathContext||r.properties.xpathContext||"",o[0].xpath=i.properties.xpath,t[0].filename=e.fileName,t[0].url=i.buildItemUrl(o[0]),t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].ecm_isVisible=o[0].isVisible,t[0].ecm_allowUpdateMetadata=o[0].allowUpdateMetadata,t[0].ecm_allowDelete=o[0].allowDelete,t[0].ecm_allowUpdateContent=o[0].allowUpdateContent,t[0].ecm_allowView=o[0].allowView,t[0].ecm_allowCheckOut=o[0].allowCheckOut,t[0].ecm_allowCancelCheckOut=o[0].allowCancelCheckOut,t[0].ecm_allowEdit=e.editable&&o[0].allowEdit,t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].idFileUploads=o[0].idFileUpload,t[0].xpath=o[0].xpath,t[0].value=bizagi.util.parseBoolean(o[0].value),t[0].deviceType=bizagi.detectDevice();var s=$.fasttmpl(a,t[0]);n.resolve(s)})),n.promise()},isImage:function(e){var t=this.getFileExtension(e);return["JPG","JPEG","GIF","PNG","BMP"].indexOf(t.toUpperCase())>-1},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},renderReadOnly:function(){return this.renderControl()},canBeSent:function(){return!1},buildItemUrl:function(e){var t=bizagi.cookie("JSESSIONID");return e.data||(e.data={fileName:e.fileName,idAttrib:e.idAttrib}),this.dataService.getECMFileUrl({idFileUpload:e.idFileUpload,xPath:e.xpath||e.xPath,xpathContext:e.xpathContext,idAttrib:e.data.idAttrib,idPageCache:this.properties.idPageCache,fileName:e.data.fileName.replace(/ /g,"_"),p_sessionId:t,sessionId:e.data.sessionId||""})},buildAddParams:function(){var e=this.properties,t={};return t.xPath=e.xpath,t.idAttrib=e.idAttrib,t.xpathContext=e.xpathContext,t.metaValues=[],t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t},getFileExtension:function(e){return(e=e||"").split(".").pop()},setValue:function(e,t){var i=this.properties;this._super(e,t),this.files=i.value||[],this.filesCount=this.files.length?this.files.length:i.value},getXpathContext:function(){return this.properties.xpathContext||""},getUploadXpath:function(){return this.properties.xpath},deleteUploadItem:function(e,t){var i=this,r=i.properties,a={idFileUpload:t,xPath:r.xpath,idAttrib:r.idAttrib,idPageCache:r.idPageCache,xpathContext:i.getXpathContext()};return i.dataService.deleteECMFile(a).pipe((function(){i.filesCount=i.filesCount-1,i.files=$.grep(i.files,(function(e){return e[0]!=t}))}))},lockUploadItem:function(e){var t=this.properties,i={idFileUpload:e,xPath:t.xpath,idAttrib:t.idAttrib,idPageCache:t.idPageCache,xpathContext:this.getXpathContext()};return this.dataService.checkOutFile(i)},unlockUploadItem:function(e){var t=this.properties,i={idFileUpload:e,xPath:t.xpath,idAttrib:t.idAttrib,idPageCache:t.idPageCache,xpathContext:this.getXpathContext()};return this.dataService.cancelCheckOut(i)}}),$.Class.extend("bizagi.rendering.yesno",{},{initializeData:function(e){this._super(e);var t=this.properties;t.value=void 0!==t.value?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var e=this.renderFactory.getTemplate("yesno"),t=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(e,{id:t,editable:this.properties.editable})},getDisplayValue:function(){var e=this.getValue();return!0===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-no"):""},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmptyValue(e)&&null!==bizagi.util.parseBoolean(e)}}),$.Class.extend("bizagi.rendering.letter",{},{initializeData:function(e){this._super(e),this.letterOpened=!1},renderControl:function(){var e=this.renderFactory.getTemplate("letter");return $.fasttmpl(e)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("letter.readonly");return $.fasttmpl(e)},getLetterContent:function(){return this.letterOpened=!0,this.dataService.getLetterContent({url:this.properties.getUrl,idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache})},saveLetterContent:function(e){return this.dataService.saveLetterContent({url:this.properties.saveUrl,idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache,content:e})},getCanGenerateLetter:function(){return this.dataService.getCanGenerateLetter({idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache})},saveForm:function(){return this.getFormContainer().saveForm()},isValid:function(e){var t,i=this.properties;return 0==bizagi.util.parseBoolean(i.visible)||(0==bizagi.util.parseBoolean(i.editable)||(this.setValidationMessage(""),!i.required||0!=this.letterOpened||(t=this.getResource("render-letter-required-text").replaceAll("#label#",i.displayName),e.push({xpath:i.xpath,message:t}),!1)))},getXpath:function(){return this.properties.xpath},getContextXpath:function(){return this.properties.xpathContext}}),$.Class.extend("bizagi.rendering.formLink",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayType="value",t.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("formLink");return $.fasttmpl(t,{id:e.id,align:e.valueAlign,displayName:e.displayName,value:e.value,editable:e.editable,likeButton:bizagi.util.parseBoolean(e.likeButton)||!1})},renderReadOnly:function(){return this.renderControl()},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},submitEditRequest:function(){var e=this.properties;return e.editable||e.value?this.dataService.editLinkForm({url:e.editUrl,idRender:e.id,xpath:this.getFormLinkXpath(),xpathContext:e.xpathContext,idPageCache:e.idPageCache}):null},submitSaveRequest:function(e){var t=this,i=t.properties;if(!i.editable&&!i.value)return null;var r=t.getFormLinkXpath(),a=r;return void 0!==i.xpathContext&&""!==i.xpathContext&&(a=r?i.xpathContext+"."+r:i.xpathContext),t.dataService.saveLinkForm({url:i.saveUrl,idRender:i.id,xpathContext:a,submitData:e}).done((function(e){var i=!0;e&&"validationMessages"===e.type&&(i=!1),i&&t.submitOnChange({})}))},saveFormLinkData:function(e){var t=this.properties,i=this.getFormLinkXpath(),r=i;void 0!==t.xpathContext&&""!==t.xpathContext&&(r=i?t.xpathContext+"."+i:t.xpathContext);var a=$.extend({},e);return delete a.idPageCache,$.when(bizagi.util.isEmpty(a)?void 0:this.dataService.multiaction().submitData({action:"SAVE",data:a,idPageCache:e.idPageCache,xpathContext:r}))},submitRollbackRequest:function(e){var t=this,i=t.properties;return $.when(i.editable||i.value?t.dataService.rollbackLinkForm({url:i.rollbackUrl,idRender:i.id,xpath:t.getFormLinkXpath(),xpathContext:i.xpathContext,idPageCache:e?e.idPageCache:i.idPageCache}):null)},submitCommitRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.commitLinkForm({url:t.commitUrl,idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},submitCheckpointRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.sendCheckpoint({url:t.checkpointUrl,idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},submitDataRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.submitData({url:t.checkpointUrl,action:"SUBMITDATA",idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},isValid:function(e){},getFormLinkXpath:function(){return this.properties.xpath},canBeSent:function(){return!1},setDisplayValue:function(e){},cleanData:function(){}}),$.Class.extend("bizagi.rendering.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{init:function(e){this._super(e),this.dependants=[],this.isDependant=!1},initializeData:function(e){this._super(e);var t=this.properties;t.hasLocalData=!!bizagi.util.isEmpty(t.parentCombo)&&t.hasLocalData,t.value&&void 0===t.value.id&&(t.value=null),this.value=t.value,t.hasLocalData&&(t.data=this.complementData(t.data))},renderControl:function(){var e=this.getMode(),t=this.parentCombo=this.getParentCombo();if(null!=t){var i=bizagi.util.normalizeType(t.properties.type);/^cascadingcombo$/i.test(i)&&(this.isDependant=!0)}this.initializingCascadingCombo=!0;var r=this._super();return"execution"!==e&&(this.initializingCascadingCombo=!1),r},configureHandlers:function(){this.initializingCascadingCombo=!1,this.isDependant&&this.parentCombo.bindDependantCombo(this)},configureHandlersReadOnly:function(){this.initializingCascadingCombo=!1,this.isDependant&&this.parentCombo.bindDependantCombo(this)},refresh:function(e,t){var i=this;$.when(i.isRendered()).done((function(){var r=i.getControl(),a=i.getMode();r.empty(),$.when(i.renderCombo(e)).then((function(e){r.html(e),i.postRender(),"execution"==a&&i.configureHandlers(),void 0!==i.getValue()&&i.setDisplayValue(i.getValue()),i.deferredVisible&&i.deferredVisible.resolve(),i.trigger("select",[i.value,t])}))}))},getData:function(e){if("execution"!=this.getMode())return this.getDummyData();if(this.isDependant){this.parentCombo&&e&&(this.properties.remoteDataLoaded=!1);var t=this.parentCombo.selectedValue?this.parentCombo.selectedValue.id:"";return""!=t?((e=e||{})[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]||(e[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t),this._super(e)):[]}return this._super(e)},bindDependantCombo:function(e){var t=this,i=bizagi.util.normalizeType(e.properties.type);/^cascadingcombo$/i.test(i)&&(t.dependants.push(e),e.onChangeFunction=function(i,r,a){t.refreshDependantCombo(e,r.id,t.focusDependant,a),a||e.cleanInput()},t.isEventBinded("select")||t.bind("select",e.onChangeFunction),bizagi.util.isEmpty(t.getValue())||t.properties.hasLocalData&&t.refreshDependantCombo(e,t.getValue().id))},isEventBinded:function(e){return void 0!==$._data(this.observableElement.get(0),"events")&&void 0!==$._data(this.observableElement.get(0),"events")[e]},unbindDependantCombo:function(e){this.unbind("select",e.onChangeFunction)},refreshDependantCombo:function(e,t,i,r){var a={};a[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t,e.deferredVisible=$.Deferred(),r||e.setValue("",!1),e.refresh(a,r),i&&$.when(e.deferredVisible.promise()).done((function(){e.inputCombo.trigger("click")}))},emptyControlByChangeEditability:function(){this.getControl().empty()},cleanInput:function(){this.triggerHandler("select",{id:0})},getParentCombo:function(){var e=this.properties;if(void 0===e.parentCombo)return null;for(var t=this.getFormContainer(),i=bizagi.util.normalizeType(this.properties.type),r=/^cascadingcombo$/i.test(i)?t.getRenderByType(e.type):[],a=0,n=0,o=[],s=null;a<r.length;a++)e.parentCombo===r[a].properties.id&&o.push({control:r[a],index:a});if(o.length>1){for(var l,d;n<o.length;n++)if(l=(d=o[n].control.properties.xpath.split(".")).length,d.slice(0,l-1).join(".")===e.xpath){s=r[o[n].index];break}}else s=t.getRenderById(e.parentCombo);return s},canBeSent:function(){return this._super()&&bizagi.util.isMapEmpty(this.dependants)},showCurrentData:function(){return"execution"!=this.getMode()},configureSubmitOnChange:function(){this.configured||(this._super(),this.configured=!0)},internalSubmitOnChange:function(e,t){var i=new $.Deferred;return this.isDependant&&this.canBeSent()&&void 0!==this.itemSelected?this._super(e,t):i.resolve()},internalSetInitialValue:function(){this._super(),this.value&&0==this.isDependant&&(this.internalSetInitialValueFlag=!0,this.trigger("select",[this.value,!0])),this.internalSetInitialValueFlag=!1}}),$.Class.extend("bizagi.rendering.list",{},{initializeData:function(e){this._super(e);var t=this.properties;t.listSize=t.listSize||0},getTemplateName:function(){return"list"},showCurrentData:function(){return!1}}),$.Class.extend("bizagi.rendering.multiSelect",{},{initializeData:function(e){this._super(e),Array.isArray(this.value)&&(this.value=this.properties.value=JSON.encode({value:this.value}),this.properties.originalValue=this.properties.previousValue=this.value);var t=this.properties;t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),t.enableTyping=null===bizagi.util.parseBoolean(t.enableTyping)||bizagi.util.parseBoolean(t.enableTyping),t.maxRecords=Number(t.maxRecords)||20},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("list-multiselect");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,align:e.valueAlign},{formatItem:this.formatItem})},renderReadOnly:function(){var e=this.properties,t=this.renderFactory.getTemplate("list-multiselect");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,align:e.valueAlign},{formatItem:this.formatItem})},getData:function(){var e=this,t=new $.Deferred,i=this.properties;return e.dataService.multiaction().getData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contexttype||null,idPageCache:i.idPageCache}).done((function(r){i.data=e.normalizeData(r),t.resolve(i.data)})).fail((function(i){var r=!0,a=e.getFormContainer();bizagi.util.isNativeMobileDevice()&&void 0!==a&&(r=a.allowOnlineActions()),"not-processed"===i.type&&r||t.reject(i)})),t.promise()},setValue:function(e,t){t=void 0===t||t,Array.isArray(e)&&(e=JSON.encode({value:e})),this._super(e,t)},setDisplayValue:function(e){this.setValue(e,!1)},canBeSent:function(){return!0},getValue:function(){return this.value||[]},getDataValue:function(){try{return JSON.parse(this.value).value||[]}catch(e){return[]}},hasValue:function(){var e=this.getDataValue();return e&&e.length>0},getElementsToStylize:function(e){return $(".bz-multiselect .bz-multiselect__tag:not(.bz-multiselect__plus)",e)},addElement:function(e){var t=this.getDataValue();t.push(e),this.setValue(t)},removeElement:function(e){var t=e.id,i=this.getDataValue().filter((function(e){return e.id!==t}));this.setValue(i)},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.submitOnChange(e)},markAsChecked:function(e){var t=this;return t.selected.some((function(i,r){var a=i.id===e;return a&&t.selected.splice(r,1),a}))},isChecked:function(e,t){return e.some((function(e){return e.id==t}))},canAddMoreItems:function(e){var t=this;return parseInt(e.css("width"))>e.children().toArray().reduce((function(e,i){return e+=t.getElementWidth(i)}),0)+t.Class.MORE_OPTION_WIDTH},getElementWidth:function(e){var t=window.getComputedStyle(e);return $(e).outerWidth()+["padding-left","padding-right","margin-left","margin-right"].reduce((function(e,i){return e+=parseInt(t[i])}),0)},filterList:function(e,t){t.filter((function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()})).show()},addSelectedElements:function(){},findItemById:function(e){return(this.properties.data||[]).find((function(t){return t.id==e}))},formatItem:function(e){return bizagi.util.formatItem(e)},normalizeData:function(e){return(e||[]).forEach((function(e){e.value=void 0!==e.value&&null!==e.value?e.value:""})),e}}),$.Class.extend("bizagi.rendering.searchList",{},{initializeData:function(e){this._super(e);var t=this.properties;t.maxRecords=Number(t.maxRecords)||20,t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),this.setValue(t.value)},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("searchList");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,value:e.value,allowTyping:e.allowTyping,items:e.value,hasSearchForm:!!e.searchForms,editable:e.editable},{formatItem:this.formatItem})},renderReadOnly:function(){return this.renderControl()},setValue:function(e){this.value=JSON.encode({value:e}),this.triggerRenderChange()},addElement:function(e){var t=JSON.parse(this.value);t.value.push(e),this.setValue(t.value)},removeElement:function(e){var t=JSON.parse(this.value),i=[];$.each(t.value,(function(t,r){r.id!=e.id&&i.push({id:r.id,value:r.value})})),this.setValue(i)},removeLastElement:function(){var e=JSON.parse(this.value);e.value.length>0&&(e.value.pop(),this.setValue(e.value))},getData:function(e){var t=this,i=t.properties,r=new $.Deferred;return t.dataService.getSearchData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.term,extra:e}).done((function(e){i.data=e,r.resolve(i.data)})).fail((function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)})),r.promise()},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.submitOnChange(e)},canBeSent:function(){return!0},hasValue:function(){return this.getListItems().length>0},getListItems:function(){var e=this.getValue();return("string"==typeof e?JSON.parse(e).value:e.value)||[]},formatItem:function(e){return bizagi.util.formatItem(e)}}),$.Class.extend("bizagi.rendering.handSignature",{},{BASE_IMAGE:"data:image/png;base64,",EMPTY_IMAGE:"R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",EMPTY_VALUE:"",DELAY_TO_SAVE:1e3,RESOURCES_FALLBACK:{DONE_BUTTON:"Done",EDIT_BUTTON:"Edit",CLEAR_BUTTON:"Clear",UPLOAD_SUCCESS:"Your signature have been uploaded successfully",UPLOAD_ERROR:"The signature have not been uploaded. Try again",TITLE_DONE:'Click "Done" to upload the signature',TITLE_DRAW:"Draw here your signature",TITLE_EDIT:'Click "Edit" to start drawing'},STATE_TYPE:{edit:1,draw:2,done:3,success:4,error:5},pluginInitialized:!1,saveDeferred:null,saveTimestamp:0,initializeData:function(e){this._super(e);var t=this.properties;t.editable=!0===bizagi.util.parseBoolean(t.editable),t.addUrl=t.addUrl||this.dataService.serviceLocator.getUrl("form-submit-data-upload"),t.deleteUrl=t.deleteUrl||this.dataService.serviceLocator.getUrl("render-upload-delete-url"),t.isChanged=!1,this.currentState=this.STATE_TYPE.edit},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("hand-signature");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,isDesign:!this.isExecutionMode(),render_signature_action_edit:this.getResourceByKey("render-signature-action-edit",this.RESOURCES_FALLBACK.EDIT_BUTTON),render_signature_action_done:this.getResourceByKey("render-signature-action-done",this.RESOURCES_FALLBACK.DONE_BUTTON),render_signature_action_clear:this.getResourceByKey("render-signature-action-clear",this.RESOURCES_FALLBACK.CLEAR_BUTTON)})},postRender:function(){var e=this;if(this.isExecutionMode()){var t=e.getSignatureContainer();e.setResizeObserver(t,(function(i){e.renderSignature(),e.setState(e.currentState),[e.STATE_TYPE.draw,e.STATE_TYPE.done].includes(e.currentState)&&t.BzjSignature("enable")}))}},postRenderReadOnly:function(){var e=this;if(this.isExecutionMode()){var t=e.getSignatureContainer();e.setResizeObserver(t,(function(){e.renderSignature()}))}},renderReadOnly:function(){var e=this.properties,t=this.renderFactory.getTemplate("hand-signature-readonly");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,isDesign:!this.isExecutionMode()})},setData:function(e){var t=this.getData();if(bizagi.util.isEmpty(e)?this.properties.binaryValue=null:e instanceof Blob?this.properties.binaryValue=e:this.properties.binaryValue=bizagi.util.b64toBlob(e,"image/png"),t!=this.properties.binaryValue){if(this.properties.required&&this.isExecutionMode()){var i=!this.checkRequired([]);this.changeRequiredLabel(i)}this.properties.isChanged&&(this.triggerRenderChange(),this.triggerRenderValidate())}},getData:function(){return this.properties.binaryValue||[]},getBase64:function(){return this.properties.base64||""},getValue:function(){return this.properties.value||[]},hasValue:function(){if(this.pluginInitialized){var e=this.getData();return!bizagi.util.isEmpty(e)}return!bizagi.util.isEmpty(this.properties.value)},isValid:function(e){if(!1===bizagi.util.parseBoolean(this.properties.visible))return!0;if(!1===bizagi.util.parseBoolean(this.properties.editable))return!0;if(this.setValidationMessage(""),this.properties.required&&!this.hasValue()){var t=this.getResource("render-required-text").replaceAll("#label#",this.properties.displayName);return e.push({xpath:this.properties.xpath,message:t}),!1}return!0},canBeSent:function(){return!this.getFormContainer().isOfflineForm||this.properties.isChanged},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},buildAddFileParams:function(e){var t=this.properties,i=this.Class.BA_CONTEXT_PARAMETER_PREFIX,r=new FormData,a=this.getFormContainer();r.append(i+"xpath",t.xpath),r.append(i+"idRender",t.id),r.append(i+"xpathContext",t.xpathContext),r.append(i+this.Class.BA_PAGE_CACHE,t.idPageCache),r.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",a.properties.sessionId),r.append(i+"action","savefile");var n="signature_"+bizagi.util.randomNumber()+".png";r.append(this.properties.xpath,e,n),t.contexttype&&r.append(i+"contexttype",t.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?r.append(BIZAGI_SESSION_NAME,a.properties.sessionId):r.append("JSESSIONID",a.properties.sessionId)}catch(e){r.append("JSESSIONID",a.properties.sessionId)}return r},buildItemUrl:function(){var e=this,t=e.getFormContainer(),i=e.properties,r=t.properties.compatibilityVersion>=2,a="";if(!this.isExecutionMode())return $.Deferred().resolve(a).promise();var n={url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,property:"fileFullContent",queue:"onlineimages",sessionId:t.properties.sessionId,contexttype:i.contexttype||void 0,dataType:"text"};return r?bizagi.util.isEmpty(e.properties.value)&&!e.hasValue()?$.Deferred().resolve("").promise():(n.property="fileBinaryContent",n.sessionId=t.properties.sessionId,e.dataService.downloadFile(n).then((function(t){return e.setData(t),null==t||window.Blob&&t instanceof Blob&&0===t.size?null:bizagi.util.blobTob64(t,!1)})).then((function(e){return bizagi.util.getDataUrl(e,i.url)}))):e.dataService.multiaction().getPropertyData(n,"text").then((function(t){return'"'===t.charAt(0)&&(t=t.slice(1,-1)),""!==t&&(a=e.BASE_IMAGE+t),e.setData(bizagi.util.b64toBlob(t)),a}))},executeFormFailHandler:function(e){var t=bizagi.util.getErrorFormatted(e),i=t;(void 0===t||t&&!t.message)&&(i=Object.assign({},"object"===_typeof(t)?t:{},{message:bizagi.localization.getResource("workportal-general-error")})),this.getFormContainer().failHandler(i)},saveSignature:function(e){var t=this,i=new $.Deferred,r=t.getFormContainer();return r.useOrSetLoaderDeferred(),r.appendWaitForLoader({promise:i.promise()}),$.when(t.postSignature(e)).then((function(e){t.setData(e),t.properties.url=bizagi.util.getDataUrl(e,t.EMPTY_VALUE),t.executePartialSaveForm(),i.resolve()})).fail((function(e){t.executeFormFailHandler(e),i.reject()}))},executePartialSaveForm:function(){var e={},t=this.getFormContainer();t.isOfflineForm&&(this.collectDataToSave(e),t.partialSubmitFormOffline(e).then((function(){})))},deleteImage:function(){return this.dataService.deleteImage({url:this.properties.deleteUrl,idRender:this.properties.id,xpath:this.properties.xpath,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,contexttype:this.properties.contexttype})},postSignature:function(e){var t=e.replace(/^data:image\/(png|jpg|jpeg);base64,/,"");return this.postSignatureOnline(t)},postSignatureOnline:function(e){var t=this,i=t.getDataFileFromSignature(e);return bizagi.util.isEmpty(i)?t.getData():t.processUploadFile(i).then((function(){return t.properties.isChanged=!0,e}))},emptyControlByAsyncRenderDeferred:function(){this.getControl().empty()},saveImageOffline:function(e){var t=this,i=t.buildOfflineImageId();return $.when(e).then((function(e){var r=t.getFormParams(),a={idCase:r.idCase,idWorkitem:r.idWorkitem,id:i,operationType:"edition",offlineType:r.offlineType};return t.dataService.saveOfflineImage(a,e)}))},collectDataToSave:function(e){if(this.isOfflineForm&&bizagi.util.isOfflineFormsV2Supported()){if(!this.properties.isChanged)return;e[this.properties.xpath]={offlineId:this.buildOfflineImageId(),name:this.dataService.fileService.getOfflineImageName(this.getValue()),isSignature:!0}}},collectData:function(e){var t=this;if(0!=t.saveTimestamp){var i=(new Date).getTime()-t.saveTimestamp;if(i<t.DELAY_TO_SAVE){var r=new $.Deferred;setTimeout((function(){$.when(t.saveDeferred).always((function(){r.resolve()}))}),t.DELAY_TO_SAVE+10-i),e.deferreds=e.deferreds||[],e.deferreds.push(r.promise())}else t.saveDeferred&&(e.deferreds=e.deferreds||[],e.deferreds.push(t.saveDeferred.promise()))}},buildItemUrlOffline:function(){var e=this,t=e.properties,i=e.getFormParams(),r=e.buildOfflineImageId(),a=!t.isChanged,n={idCase:i.idCase,idWorkitem:i.idWorkitem,id:r,offlineType:i.offlineType,loadImageFromForm:a};return $.when(e.dataService.getOfflineImage(n,bizagi.util.db.AttachmentType.Blob)).then((function(t){return e.setData(t),null==t||window.Blob&&t instanceof Blob&&0===t.size?null:bizagi.util.blobTob64(t,!1)})).then((function(e){return bizagi.util.getDataUrl(e,t.url)}))},setState:function(e){var t=$(".bz-actions",this.getControl()),i="";switch(this.currentState=e,e){case this.STATE_TYPE.edit:i=this.getResourceByKey("render-signature-title-edit",this.RESOURCES_FALLBACK.TITLE_EDIT);break;case this.STATE_TYPE.draw:i=this.getResourceByKey("render-signature-title-draw",this.RESOURCES_FALLBACK.TITLE_DRAW);break;case this.STATE_TYPE.done:i=this.getResourceByKey("render-signature-title-done",this.RESOURCES_FALLBACK.TITLE_DONE)}$(".bz-actions__status",t).text(i),this.setActions(e)},setActions:function(e){var t=$(".bz-actions",this.getControl());[this.STATE_TYPE.draw].includes(e)?(t.find("[data-action='edit']").addClass("bz-hidden"),t.find("[data-action='clear']").removeClass("bz-hidden"),t.find("[data-action='save']").removeClass("bz-hidden")):[this.STATE_TYPE.edit].includes(e)&&(t.find("[data-action='edit']").removeClass("bz-hidden"),t.find("[data-action='clear']").addClass("bz-hidden"),t.find("[data-action='save']").addClass("bz-hidden"))},buildOfflineImageId:function(){var e=this.getFormContainer(),t=e.properties.compatibilityVersion>=2,i=!e.properties.isTaskForm;return this.dataService.fileService.buildOfflineImageId(this.properties.value,this.properties.xpathContext,this.properties.xpath,t,i)},buildOfflineFileLoadingKey:function(){var e=this.getFormContainer(),t=e.getParams().idCase,i=e.getParams().idWorkitem,r=t;return bizagi.util.isEmpty(i)||(r+="-"+i),r+="-",bizagi.util.isEmpty(this.properties.xpathContext)||(r+="-"+this.properties.xpathContext),r+=this.properties.xpath},getDataFileFromSignature:function(e){try{var t=atob(e),i=bizagi.util.stringToByteArray(t);return new Blob([new Uint8Array(i)],{type:"image/png"})}catch(e){return""}},setSignature:function(e){var t=this.properties&&this.properties.url;try{bizagi.util.isEmpty(t)||(e.BzjSignature("reset"),e.BzjSignature("setData",t))}catch(e){}},setResizeObserver:function(e,t){var i=0;new ResizeObserver((function(e){var r=e[0];r.contentRect&&i!==r.contentRect.width&&0!==r.contentRect.width&&(i=r.contentRect.width,"function"==typeof t&&t())})).observe(e.get(0))},getSignatureContainer:function(e){var t=e||".bz-signature__container";return this.getSignatureContext(t)},getSignatureContext:function(e){var t=this.getControl();return $(e,t)},onSignatureClear:function(){},cleanData:function(){var e=this.getFormContainer(),t=this.onSignatureClear(this.getSignatureContainer());return e.useOrSetLoaderDeferred(),e.appendWaitForLoader({promise:t.promise()}),t}}),$.Class.extend("bizagi.rendering.money",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");if(t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol){var r="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol;t.symbol=t.currencySymbol?t.currencySymbol:r}else t.symbol="";t.groupDigits=!0}}),$.Class.extend("bizagi.rendering.radio",{},{initializeData:function(e){this._super(e);var t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1,t.unique=bizagi.util.randomNumber(1e3,1e6)},getTemplateName:function(){return"radio"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){var e=this.properties;return{vertical:!e.horizontal,horizontal:e.horizontal}},cleanData:function(){var e={id:"",label:""};this.element.find(".ui-radio-state-checked").removeClass("ui-radio-state-checked"),this.setDisplayValue(e),this.setValue(e,!1),this.clearDisplayValue()},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue;return t&&void 0!==t.length&&(t=t[0]),i&&void 0!==i.length&&(i=i[0]),r&&void 0!==r.length&&(r=r[0]),t=t&&void 0!==t.id?t.id:t,i=i&&void 0!==i.id?i.id:i,void 0!==(r=r&&void 0!==r.id?r.id:r)?(r!=t||t!=i)&&((null!==t&&""!==t||null!==i&&""!==i)&&i!=t):(null!==t&&""!==t||null!==i&&""!==i)&&i!=t},emptyControlByAsyncRenderDeferred:function(){this.getControl().empty()}}),$.Class.extend("bizagi.rendering.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{BASE_IMAGE:"data:image/png;base64,",initializeData:function(e){this._super(e);var t=this.properties,i=4091904;if(t.maxSize?i=Number(t.maxSize):"undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize&&(i=Number(BIZAGI_SETTINGS.UploadMaxFileSize)),t.maxSize=i,t.editable=!0===bizagi.util.parseBoolean(t.editable),t.validExtensions=t.validExtensions||"",t.isChanged=!1,t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var r=t.validExtensions.replace(/\ /gi,"").split(";"),a=0;a<r.length;a++)if(0!=r[a].length)r[a]="*."+r[a].replaceAll(" ","");else{r.indexOf(r[a]);r.splice(a,1)}t.validExtensions=r.join(";")}t.addUrl=t.addUrl||this.dataService.getUploadAddFileUrl(t.isUserPreference),t.allowDelete=null!==bizagi.util.parseBoolean(t.allowDelete),this.formCompatibilityVersion=this.getFormContainer().compatibilityVersion,this.initializeWidthAndHeight()},initializeWidthAndHeight:function(){var e=this.properties;e.isAutoWidth=!1,e.isAutoHeight=!1,-1===e.width?(e.width="100%",e.isAutoWidth=!0):e.width=e.width+"px",-1===e.height?(e.height="auto",e.isAutoHeight=!0):e.height=e.height+"px"},setData:function(e){var t=this.getData();if(bizagi.util.isEmpty(e)?this.properties.binaryValue=null:this.properties.binaryValue=e instanceof Blob?e:bizagi.util.b64toBlob(e,"image/png"),t!=this.properties.binaryValue){if(this.properties.required&&this.isExecutionMode()){var i=!this.checkRequired([]);this.changeRequiredLabel(i)}this.properties.isChanged&&(this.triggerRenderChange(),this.triggerRenderValidate())}},getData:function(){return this.properties.binaryValue||[]},renderControl:function(){var e=this,t=e.renderFactory.getTemplate("image");return e.buildItemUrl().then((function(i){if(!e.isDisposed())return e.properties.url=""!==i?i:"",bizagi.util.isEmpty(e.properties.url)?e.properties.value=[]:e.formCompatibilityVersion<2&&(e.properties.value=[[0,"uploaded"]]),e.setValue(e.properties.value),$.fasttmpl(t,{url:e.properties.url})}))},renderReadOnly:function(){var e=this.renderFactory.getTemplate("image-readonly");return $.fasttmpl(e)},getTemplateItem:function(){return this.renderFactory.getTemplate("image-item")},renderUploadItem:function(){var e=this,t=e.getMode(),i=e.getTemplateItem();return e.buildItemUrl().then((function(r){var a=r||"",n=$.fasttmpl(i,{url:a,allowDelete:e.properties.allowDelete,editable:e.properties.editable,mode:t});return e.properties.url=a,n}))},buildItemUrl:function(e){var t=this,i=t.getFormContainer(),r=t.properties,a=i.properties.compatibilityVersion>=2,n="";if(!this.isExecutionMode())return $.Deferred().resolve("").promise();var o={url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,contexttype:r.contexttype,property:e&&e.property?e.property:"fileContent",dataType:"text"};if(r.isUserPreference&&(t.currentUser=bizagi.currentUser.idUser,o.xpathContext="@Context.Users[id == "+t.currentUser+"]",o.contexttype="entity",o.surrogatekey=t.currentUser),a){if(bizagi.util.isEmpty(t.properties.value)&&!t.hasValue())return $.Deferred().resolve("").promise();if(!t.properties.forceBase64)return o.sessionId=i.properties.sessionId,o.property="fileBinaryContent",t.dataService.downloadFile(o).then((function(e){return t.setData(e),null==e||window.Blob&&e instanceof Blob&&0===e.size?null:bizagi.util.blobTob64(e,!1)})).then((function(e){return bizagi.util.getDataUrl(e,r.url)}))}return t.dataService.multiaction().getPropertyData(o,"text").then((function(e){return'"'===e.charAt(0)&&(e=e.slice(1,-1)),""!==e&&(n=t.BASE_IMAGE+e),t.setData(bizagi.util.b64toBlob(e)),n}))},buildItemUrlOffline:function(){var e=this,t=e.properties,i=e.getFormParams(),r=!t.isChanged,a=e.buildOfflineImageId(),n={idCase:i.idCase,idWorkitem:i.idWorkitem,id:a,offlineType:i.offlineType,loadImageFromForm:r};return $.when(e.dataService.getOfflineImage(n,bizagi.util.db.AttachmentType.Blob)).then((function(t){return e.setData(t),null==t||window.Blob&&t instanceof Blob&&0===t.size?null:bizagi.util.blobTob64(t,!1)})).then((function(e){return bizagi.util.getDataUrl(e,t.url)}))},saveImageOffline:function(e){var t=this,i=t.buildOfflineImageId(),r=void 0!==t.fileProperties?t.fileProperties.name:e.name;return t.dataService.getFileService().resolveBlobFromPath(e,r).then((function(e){var r=t.getFormParams(),a={idCase:r.idCase,idWorkitem:r.idWorkitem,id:i,operationType:"edition",offlineType:r.offlineType};return t.dataService.saveOfflineImage(a,e)}))},buildFullItemUrl:function(){return this.buildItemUrl({property:"fileFullContent"})},canBeSent:function(){return this.properties.isChanged},getValue:function(){return this.properties.value||[]},isValid:function(e){if(!1===bizagi.util.parseBoolean(this.properties.visible))return!0;if(!1===bizagi.util.parseBoolean(this.properties.editable))return!0;if((this.setValidationMessage(""),this.properties.required)&&(!(this.grid&&this.grid.isFromCreatedRow.apply(this))&&!this.hasValue())){var t=this.getResource("render-required-text").replaceAll("#label#",this.properties.displayName);return e.push({xpath:this.properties.xpath,message:t}),!1}return!0},buildAddParams:function(){var e=this.properties,t=this.getFormContainer(),i={};i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=this.getUploadXpath(),i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.id,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=t.properties.sessionId,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="savefile",e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?i[BIZAGI_SESSION_NAME]=t.properties.sessionId:i.JSESSIONID=t.properties.sessionId}catch(e){i.JSESSIONID=t.properties.sessionId}return i},getUploadXpath:function(){return this.properties.xpath},emptyControlByAsyncRenderDeferred:function(){this.getControl().empty()},buildOfflineImageId:function(){var e=this.getFormContainer().properties.compatibilityVersion>=2;return this.dataService.fileService.buildOfflineImageId(this.properties.value,this.properties.xpathContext,this.properties.xpath,e)}}),$.Class.extend("bizagi.rendering.userfieldDefinition",{},{getFileDependencies:function(){return null},postRender:function(){var e=this;e._super();var t=$.Deferred(),i=e.getFileDependencies();return i&&i.length>0?bizagi.loader.loadFile(i).then((function(){e.internalRenderControl(),t.resolve()})):$.when(e.renderUserfieldControl()).done((function(){t.resolve()})),t.promise()},renderUserfieldControl:function(){var e=this,t=e.getControl(),i=e.properties,r=new $.Deferred;i.extendedData&&i.extendedData.length>0?e.extendedData=bizagi.services.ajax.parseJSON(i.extendedData):e.extendedData={};var a;return(a=e.getEditableControl())&&(e.input=t.html(a)),e.renderComplex(),r.resolve(),r.promise()},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.properties;i.extendedData&&i.extendedData.length>0?e.extendedData=bizagi.services.ajax.parseJSON(i.extendedData):e.extendedData={};var r=function(){try{var i=e.getReadonlyControl();i&&(e.input=t.html(i)),e.renderComplex()}catch(i){var r=e.properties.displayName||"Widget";t.html("<h6>"+r+"</h6>")}};e.ready?e.ready().done((function(){r()})):r()},getDisplayValue:function(){return this.getReadonlyValue()},setDisplayValue:function(e){this.setValue(e),this.setEditableValue(e)},getValue:function(){return this.getEditableValue()},getPropertyValue:function(e,t){var i=this,r=i.properties,a=new $.Deferred,n=i.getFormContainer();return n.useOrSetLoaderDeferred(),n.appendWaitForLoader({promise:a.promise()}),i.dataService.multiaction().getPropertyData({url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done((function(e){"error"==e.type?(i.getFormContainer().addErrorMessage(e.message),a.reject(e)):a.resolve(e)})).fail((function(e,t,i){a.reject(e,t,i)})),a.promise()},saveForm:function(){return this.getFormContainer().saveForm()},getRenderElements:function(e){var t=$(),i=this.getFormContainer().getRenders(e);return $.each(i,(function(e,i){t=t.add($(i.element))})),t},getServerResourceURL:function(e){var t="Rest/Userfields/{0}/resource/{1}/{2}";t=t.replace("{0}",this.properties.userfieldGuid),e=e.replace("\\","__").replace("/","__");var i=bizagi.util.detectDevice();return t=(t=t.replace("{1}",i)).replace("{2}",e)},getRenderValue:function(e){var t,i=this.getFormContainer().getRenders(e);return $.each(i,(function(e,i){t&&!i.properties.editable||(t=i)})),t?t.getValue():null},refreshForm:function(){var e=this.properties;this.getFormContainer().refreshForm(e.id)},showDialog:function(e,t){bizagi.util.mustImplement("Must implement the showDialog method")},showPopup:function(e,t){bizagi.util.mustImplement("Must implement the showPopup method")},updateOriginalValue:function(){this.properties.originalValue=this.value=this.properties.value}}),$.Class.extend("bizagi.rendering.basicUserField",{},{getEditableControl:function(){},renderComplex:function(){},getEditableValue:function(){return bizagi.rendering.render.prototype.getValue.apply(this,arguments)},setEditableValue:function(e){return bizagi.rendering.render.prototype.setValue.apply(this,arguments)},getReadonlyControl:function(){},getReadonlyValue:function(){return bizagi.rendering.render.prototype.getDisplayValue.apply(this,arguments)},dispose:function(){this._super()}}),$.Class.extend("bizagi.rendering.userfieldWrapper",{},{init:function(e){this._super(e),this.initialParams=e,this.userfieldGuid=this.properties.userfieldGuid,this.userfieldName=this.properties.control},startUserfieldLoading:function(){},endUserfieldLoading:function(){},internalPostRender:function(){var e=this;e.startUserfieldLoading(),$.when(e.getUserfieldControl()).done((function(t){return t.element=e.element,e.column&&(t.isColumn=!0,t.grid=e.grid,t.surrogateKey=e.surrogateKey,t.properties.xpathContext=e.getControlXpathContext(t),t.getControl=e.column.getControl),t.internalPostRender()})).always((function(){e.endUserfieldLoading()}))},getControlXpathContext:function(e){var t=e.properties;return e.isColumn?t.xpathContext.length>0?t.xpathContext+"."+e.grid.properties.xpath+"[id="+e.surrogateKey+"]":e.grid.properties.xpath+"[id="+e.surrogateKey+"]":t.xpathContext},getUserFieldInstance:function(e){console.log("not implemented")},replicateUserfieldMethods:function replicateUserfieldMethods(control){var self=this;for(var key in control.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"subscribe"!=key&&"unsubscribe"!=key&&"publish"!=key&&"render"!=key&&"triggerHandler"!=key&&"dispose"!=key&&(self[key]=eval("var tmp = function(){ if (this.userfieldInstance) return this.userfieldInstance."+key+".apply(this.userfieldInstance, arguments); return null;};tmp"));control.properties=self.properties,control.value=self.value},dispose:function(){var e=this,t=setTimeout((function(){e.userfieldInstance&&(e.userfieldInstance.unbind("renderchange"),e.userfieldInstance.dispose()),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()}}),$.Class.extend("bizagi.rendering.document",{},{initializeData:function(e){this._super(e);var t=this.properties;t.validate=null!=bizagi.util.parseBoolean(t.validate)&&bizagi.util.parseBoolean(t.validate),t.downloadalldocuments=!!t.downloadalldocuments&&t.downloadalldocuments,t.allowGenerate=void 0===t.allowGenerate||t.allowGenerate,t.append=!!t.append&&t.append,t.caption?(t.caption=$.trim(t.caption),0===t.caption.length&&(t.caption=this.getResource("render-documentgenerator-button-label"))):t.caption=this.getResource("render-documentgenerator-button-label")},renderControl:function(){this.preRenderControl();var e=this.properties,t=this.getMode(),i=e.downloadalldocuments,r=e.allowGenerate,a=this.renderFactory.getTemplate(this.getTemplate()),n=e.value||[],o=!n||0===n.length,s=this.getControlHtml(a,t,i,r,e,o),l=this.renderDocumentsHtml(n);return l+=this.renderActionsHtml(n,o,i),s=this.replaceFilesHtml(s,l)},getControlHtml:function(e,t,i,r,a,n){return $.fasttmpl(e,{noActivateButton:!1,editable:"execution"!==t,mode:t,downloadalldocuments:i,required:a.required,allowgenerate:r,xpath:this.getXpath(a.xpath),append:a.append,caption:a.caption,noFiles:n,allowSendInMail:a.allowSendInMail})},getXpath:function(e){return e},preRenderControl:function(){},activateButton:function(){return!0},getDocumentXpath:function(e){return e},getContextXpath:function(){return this.properties.xpathContext},renderDocumentItem:function(e){var t=this.getMode(),i=this.renderFactory.getTemplate(this.getTemplateItem()),r=this.buildItemUrl(e);return"execution"!==t&&(r="javascript:void(0);"),$.fasttmpl(i,{url:r,allowDelete:this.properties.allowDelete,filename:e.fileName,id:e.id,mode:t,editable:this.properties.editable,joined:!1})},buildItemUrl:function(e){var t=this.properties;return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getDocumentXpath(t.xpath),xpathContext:this.getContextXpath(),idPageCache:t.idPageCache,fileId:e.id,sessionId:this.getSessionId()})},buildAllDocumentsUrl:function(){var e=this.properties;return this.dataService.getAllDocumentsDownloadUrl({xpath:this.getDocumentXpath(e.xpath),xpathContext:this.getContextXpath(),idPageCache:e.idPageCache,idCase:e.caseId,idWorkItem:e.workitemId,sessionId:this.getSessionId()})},postRender:function(){return this._super(),"<div></div>"},postRenderReadOnly:function(){if("design"!==this.getMode()){var e=this.getControl(),t=this.renderControl();e.append(t),this.updateControlForPrintMode(e),this.postRender()}},validateContainer:function(){return this.getFormContainer().validateForm()},save:function(){return this.getFormContainer().saveForm()},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},replaceActionsHtml:function(e,t){return e.replace("{{actions}}",t)},canBeSent:function(){return!1},isValid:function(e){var t,i=this.properties;return!1===bizagi.util.parseBoolean(i.visible)||(!1===bizagi.util.parseBoolean(i.editable)||(this.setValidationMessage(""),!(i.required&&!i.buttonExecuted&&this.value)||(this.value.length>0||(t=this.getResource("render-document-required-text"),e.push({xpath:i.xpath,message:t}),!1))))},configureHandlers:function(){var e=this;e._super();var t=$(".ui-bizagi-button-documentgenerator",e.getControl());e.isExecutionMode()&&(t.click((function(t){if(!t.isPropagationStopped()){if(t.stopPropagation(),e.properties.buttonExecuted=!0,e.properties.validate)e.validateContainer()&&e.documentTemplateGenerate();else e.documentTemplateGenerate();e.properties.buttonExecuted=!1}})),e.attachEvents())},configureHandlersReadOnly:function(){this.isExecutionMode()&&this.attachEvents()},attachEvents:function(){var e=this,t=e.getControl();$(".ui-bizagi-document-upload-item a > span",t).click((function(t){if(!t.isPropagationStopped()){t.stopPropagation();var i=$(this).closest(".ui-bizagi-document-upload-item").data();i.joined?e.downloadAllFiles({filename:"TemplatesConcatFilesToPDF.pdf"}):e.downloadFile(i)}})),$(".ui-bizagi-container-documents-item-delete",t).click((function(t){t.isPropagationStopped()||(t.stopPropagation(),e.deleteDocumentTemplate($(this).data("filename")))}))},deleteDocumentTemplate:function(e){var t=this,i={xpath:t.properties.xpath+"[fileName='"+e+"']",idRender:t.properties.id,xpathContext:t.getContextXpath(),idPageCache:t.properties.idPageCache};t.startLoading(),$.when(t.dataService.deleteUploadFile(i)).done((function(){$.when(t.dataService.multiaction().getPropertyData({xpath:t.properties.xpath,idRender:t.properties.id,xpathContext:t.getContextXpath(),idPageCache:t.properties.idPageCache,property:"value"})).done((function(e){t.resolveDeleteDocumentTemplate(e,!1,t.properties.downloadalldocuments),t.endLoading()}))}))},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath),e.save().done((function(){bizagi.showErrorAlertDialog=!1,$.when(e.dataService.generateDocumentTemplate(t)).done((function(){$.when(e.dataService.multiaction().getPropertyData({xpath:t.xpath,idRender:t.id,xpathContext:e.getContextXpath(),idPageCache:t.idPageCache,property:"value"})).done((function(i){e.resolveDocumentTemplateGenerate(i,!1,t.downloadalldocuments),e.endLoading()}))})).fail((function(t){e.endLoading(),e.showErrorMessage(t)}))})).fail((function(t){e.endLoading(),e.showErrorMessage(t)}))},showErrorMessage:function(e){var t=this.getFormContainer(),i=this.resources.getResource("render-upload-alert-maxsize").replace("{0}",BIZAGI_SETTINGS.UploadMaxFileSize);try{i=e&&void 0!==e.responseText?JSON.parse(e.responseText.replace(/(\r\n|\n|\r)/gm,"")).message:e}catch(e){}t.addErrorMessage(i),t.endLoading()},autoOpenDocuments:function(){},showDocumentPreview:function(e,t){},returnCssTypeFile:function(e){if(null==e||0===e.lenght)return"ui-bizagi-document-upload-item-generic-file";switch(e.substr(e.lastIndexOf(".")+1)){case"docx":return"ui-bizagi-document-upload-item-doc";case"pdf":return"ui-bizagi-document-upload-item-pdf";case"xlsx":return"ui-bizagi-document-upload-item-xls";default:return"ui-bizagi-document-upload-item-generic-file"}},redrawDocuments:function(e,t,i){var r=this.getControl(),a="",n=$("[data-component='files']",r);n.empty(),a+=this.renderDocumentsHtml(e),a+=this.renderActionsHtml(e,t,i),n.append(a),this.setValue(e)},renderAllDocumentDownload:function(e){var t=this.properties,i=this.getMode(),r=this.renderFactory.getTemplate(this.getTemplateItem()),a=this.buildAllDocumentsUrl();"execution"!==i&&(a="javascript:void(0);");var n=$.fasttmpl(r,{url:a,allowDelete:t.allowDelete,filename:e.fileName,mode:i,joined:!0});return this.removeDeleteButton(n)},removeDeleteButton:function(e){var t=e.indexOf('<span class="ui-bizagi-container-documents-item-delete');if(t>0){var i=e.substring(t),r=i.indexOf("</span>")+7;return e.substring(0,t)+i.substring(r)}return e},resolveDocumentTemplateGenerate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e,this.autoOpenDocuments(),this.configureHandlers()},resolveDeleteDocumentTemplate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e,this.configureHandlers()},renderDocumentsHtml:function(e){for(var t="",i=0;i<e.length;i++){var r={id:e[i][0],fileName:e[i][1]};t+=this.renderDocumentItem(r)}return t},renderActionsHtml:function(e,t,i){var r="";if(i&&!t&&e.length>0){var a={fileName:this.getResource("render-document-downloadalldocuments")};r+=this.renderAllDocumentDownload(a)}return r},getTemplate:function(){return"document"},getTemplateItem:function(){return"document-item"},getErrorTemplate:function(){return"form-error"},getTemplateDownload:function(){return"document-download"},getTemplateReadonly:function(){return"document-readonly"},getDocumentFile:function(e){var t=this.properties;return this.dataService.getFile({idRender:t.id,xpath:this.getDocumentXpath(t.xpath),xpathContext:this.getContextXpath(),idPageCache:t.idPageCache,fileId:e.id,contexttype:t.contexttype}).then((function(e){return bizagi.util.handleJSONResponse(e)}))},getAllDocumentFiles:function(){return this.dataService.getAllDocuments({xpath:this.getDocumentXpath(this.properties.xpath),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache,idCase:this.properties.caseId,idWorkItem:this.properties.workitemId}).then((function(e){return bizagi.util.handleJSONResponse(e)}))},downloadFile:function(e){var t=this;this.getDocumentFile(e).then((function(t){bizagi.util.downloadBlobFile(t,e.filename)})).fail((function(e){var i=t.getFormContainer();i&&i.failHandler(e)}))},downloadAllFiles:function(e){var t=this;this.getAllDocumentFiles().then((function(t){bizagi.util.downloadBlobFile(t,e.filename)})).fail((function(e){var i=t.getFormContainer();i&&i.failHandler(e)}))}}),bizagi.rendering.element.extend("bizagi.rendering.columns.column",{},{init:function(e){this._super(e),this.originalProperties=JSON.parse(JSON.encode(this.properties)),this.decoratedClass=e.decorated,this.data=e.data,e.singleInstance?(this.decorated=new this.decoratedClass({data:this.data,parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService}),this.decorated.getControl=this.getControl,e.decorated=this.decorated,this.decorated.properties.isColumn=!0):this.decorateRenders=[],this.grid=e.parent;var t=this.properties;t.columnVisible=null==bizagi.util.parseBoolean(t.columnVisible)||bizagi.util.parseBoolean(t.columnVisible),t.align=t.align||"center",t.textFormat=t.textFormat||{},t.submitOnChange=void 0!==t.submitOnChange&&bizagi.util.parseBoolean(t.submitOnChange),t.singleInstance=e.singleInstance,t.editable=void 0===t.editable||bizagi.util.parseBoolean(t.editable),t.visible=void 0===t.visible||bizagi.util.parseBoolean(t.visible),t.required=void 0!==t.required&&bizagi.util.parseBoolean(t.required),t.showColumn=void 0===t.showColumn||bizagi.util.parseBoolean(t.showColumn),t.isSortable=void 0===t.isSortable||bizagi.util.parseBoolean(t.isSortable);try{e.parent&&"boolean"==typeof e.parent.properties.editable&&!e.parent.properties.editable&&(t.editable=!1)}catch(e){}this.readonly=void 0!==t.readonly&&t.readonly,this.readonly&&(t.editable=required=!1)},isReadonly:function(){return!1},getControl:function(){return $(".ui-bizagi-render-control",this.element||this.observableElement)},getDecorated:function(e){if(this.properties.singleInstance)return this.decorated;var t=this.decorateRenders[e];if(null==t){"object"!=_typeof(this.decorateRenders)&&(this.decorateRenders=[]);var i=new this.decoratedClass({data:bizagi.clone(this.data),parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService});t=i,this.decorateRenders[e]=i,t.surrogateKey=e,this.applyOverrides(t);var r=bizagi.util.normalizeType(t.properties.type);"summary"!==e||/columnMoney/i.test(r)||/columnNumber/i.test(r)||(t.setDisplayValue=function(e){this.getControl().html(e)})}return t},ready:function(){return this.readyDeferred.promise()},initialize:function(){},canBeSent:function(e,t){var i=this.getDecorated(e);return t&&(i.properties.visible=t.visible,i.properties.editable=t.editable),i.canBeSent()||!this.properties.editable&&this.hasChanged()||!i.properties.editable&&this.hasChanged()},isValueValid:function(e,t,i,r){var a=this.getDecorated(e),n=[];return r.visible&&(this.setValue(e,t),a.properties=$.extend(a.properties,r),this.grid&&void 0===a.grid&&(a.grid=this.grid),a.isValid(n)),!(n.length>0)||($.each(n,(function(e,t){i.push(t.message)})),!1)},applyOverrides:function(e){},render:function(e,t){try{var i=this,r=i.properties,a=i.getDecorated(e);if(a.grid=i.grid,a.column=this,a.surrogateKey=e,i.setValue(e,t),i.overrideDecoratedRenderProperties(e),i.changed=!1,!r.editable&&"CALLER_RENDER_READ_ONLY_COLUMNSLINK"!==arguments[3])return i.renderReadOnly.apply(i,arguments);i.readyDeferred=new $.Deferred;var n=a.render("cell");return a.bind("renderchange",(function(){i.changed=!0})),i.bind("rendered",(function(){i.readyDeferred.resolve()})),n}catch(e){return console.log(e),""}},postRender:function(e,t){this.getDecorated(e).postRenderElement(t)},renderReadOnly:function(e,t){var i=this,r=i.getDecorated(e);r.grid=i.grid,r.column=this,r.surrogateKey=e,i.setValue(e,t),i.overrideDecoratedRenderProperties(e),r.properties.editable=!1,i.readyDeferred=new $.Deferred;var a=r.render("cell.readonly");return i.bind("rendered",(function(){i.readyDeferred.resolve()})),a},renderSummary:function(e,t){var i=this.renderFactory.getTemplate("cell.summary");return $.tmpl(i).html()},postRenderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties.editable;i.properties.editable=!1,this.properties.singleInstance&&(i.element=t),i.postRenderElement(t),i.properties.editable=r},postRenderSummary:function(){return!1},getCell:function(){return this.decorated.getDisplayValue()},setSurrogateKey:function(e){this.surrogateKey=e},setValue:function(e,t){var i=this.getDecorated(e);"undefined"!=i&&null!=i&&(i.properties.originalValue=t,i.properties.previousValue=t,"summary"==e||null!=t||void 0===this.properties.defaultvalue&&void 0===this.properties.defaultValue||null==i.grid||(t=this.setDefaultValue(e,i)),i.properties.value=t,i.setValue(t,!1))},setDefaultValue:function(e,t){var i=void 0;return null!==this.properties.defaultvalue&&void 0!==this.properties.defaultvalue?i=this.properties.defaultvalue:null!==this.properties.defaultValue&&void 0!==this.properties.defaultValue&&(i=this.properties.defaultValue),t.grid.changes[e]=t.grid.changes[e]||{},t.grid.changes[e][this.properties.xpath]=i,i},getValue:function(e){return this.getDecorated(e).getValue()},getCompositeValue:function(e){return this.getValue(e)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_COLUMN},hasChanged:function(){return this.changed},trigger:function(e,t){this.decorated&&this.decorated.trigger(e,t)},triggerHandler:function(e,t){this.decorated&&this.decorated.triggerHandler(e,t)},bind:function(e,t){this.decorated&&this.decorated.bind(e,t)},unbind:function(e,t){this.decorated&&this.decorated.unbind(e,t)},overrideDecoratedRenderProperties:function(e){var t=this.getDecorated(e);t.properties.editable=this.properties.editable,t.properties.visible=this.properties.visible,t.properties.required=this.properties.required},overrideProperties:function(e){this.properties.editable=e.editable||this.properties.editable,this.properties.visible=e.visible||this.properties.visible,this.properties.required=e.required||this.properties.required},getSortName:function(){var e=this.getAnyDecoratedInstance();return e&&e.getSortColumn?e.getSortColumn():this.properties.xpath},getAnyDecoratedInstance:function(){var e;for(e in this.decorateRenders)break;return e?this.decorateRenders[e]:null},dispose:function(){var e=this,t=setTimeout((function(){e.decorated&&(e.decorated.unbind("renderchange"),e.decorated.dispose()),e.decorateRenders&&bizagi.util.arrayEach(e.decorateRenders,(function(e,t){t&&(t.unbind("renderchange"),t.dispose())})),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()}}),$.Class.extend("bizagi.rendering.columns.readonly",{},{init:function(e){this._super(e),this.properties.editable=required=!1},isReadonly:function(){return!0},isValueValid:function(){return!0}}),$.Class.extend("bizagi.rendering.columns.combo",{},{init:function(e){this._super(e);var t=this.properties;t.recalculate=bizagi.util.parseBoolean(t.recalculate)||!1,bizagi.util.isOfflineForm({context:this})&&(t.recalculate=!1)},applyOverrides:function(e){var t=this.properties;this._super(e),t.recalculate||(e.originalGetData=e.getData,e.getData=this.getDataForAllCells,e.findDataById=this.findDataById)},findDataById:function(e){var t={};return this.column&&this.column.comboData&&$.each(this.column.comboData,(function(i,r){r.id==e&&(t=r)})),t},getDataForAllCells:function(e){var t=this.column;return t.comboData?t.comboData:t.fetchingData?t.dataPromise:(t.fetchingData=!0,t.dataPromise=$.when(this.originalGetData(e)).pipe((function(e){return t.comboData=e,t.fetchingData=!1,e})),t.dataPromise)},setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if("summary"==e)return this._super(e,t);if(t&&bizagi.util.isString(t))this._super(e,t);else if(t&&t.length>0){var r={id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!=t})):t[0][1]};this._super(e,r),i.selectedValue=r.value}else t&&t.id&&t.value?(this._super(e,t),i.selectedValue=t.value):"columnRadio"==this.properties.type?(this._super(e,null),i.selectedValue=t):t&&"number"==typeof t?this._super(e,t):(this._super(e,null),i.selectedValue="")}},setDefaultValue:function(e,t){var i=this.properties.defaultValue[0];return t.grid.changes[e]=t.grid.changes[e]||{},t.grid.changes[e][this.properties.xpath]=i.id,i},getCompositeValue:function(e){var t=this.getDecorated(e),i=t.getValue(),r=t.getSelectedValue(),a=[];return i&&(i.id>0||bizagi.util.isString(i.id))?(a.push([]),a[0].push(i.id),a[0].push(r)):a.push([]),a},getValue:function(e){var t=this.getDecorated(e).getValue();return t?t.id:t},render:function(e,t,i){var r=this.getDecorated(e),a=this.properties;a.recalculate&&r.resetData();var n=a.xpathContext.length>0?a.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return r.properties.xpathContext=n,this._super(e,t,i)},renderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties,a=r.xpathContext.length>0?r.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return i.properties.xpathContext=a,this._super(e,t)}}),$.Class.extend("bizagi.rendering.columns.date",{},{setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if(this._super(e,t),null==t&&void 0!==this.properties.defaultvalue&&(t=this.setDefaultValue(e,i)),"summary"===e)return this._super(e,t);null==t&&(i.setValue(t,!1),i.properties.displayValue="");var r=bizagi.util.dateFormatter.getDateFromInvariant(t,i.properties.showTime);if(0===r&&(r=bizagi.util.dateFormatter.getDateFromInvariant(t,!i.properties.showTime)),0!==r){var a=bizagi.localization.getResource("datePickerRegional"),n=bizagi.util.dateFormatter.formatDate(r,i.properties.fullFormat,a);i.properties.displayValue=n,i.setValue(t,!1)}}},setDefaultValue:function(e,t){var i=this.properties.defaultvalue;return t.grid.changes[e]=t.grid.changes[e]||{},i=bizagi.util.dateFormatter.getDateFromInvariant(i,t.properties.showTime||!1),i=bizagi.util.dateFormatter.formatInvariant(i,!0),t.grid.changes[e][this.properties.xpath]=i,i}}),$.Class.extend("bizagi.rendering.columns.search",{},{init:function(e){this._super(e)},applyOverrides:function(e){var t;this._super(e),t=this.properties.xpathContext.length>0?this.properties.xpathContext+"."+this.grid.properties.xpath+"[id="+e.surrogateKey+"]":this.grid.properties.xpath+"[id="+e.surrogateKey+"]",e.properties.xpathContext=t},render:function(e,t,i){var r=this.getDecorated(e);return this.properties.recalculate&&r.resetData(),this._super(e,t,i)},getValue:function(e){return this.getDecorated(e).getValue()},setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if("summary"==e)return this._super(e,t);var r=this.getCompositeValue(e);if(r&&void 0!==r.id&&r.id==t&&(t=r),t&&t.length>0){var a={id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!=t})):t[0][1]};this._super(e,a),i.selectedValue=a.value}else t&&t.id&&t.value?(this._super(e,t),i.selectedValue=t.value):t&&t.id&&t.label?(this._super(e,t),i.selectedValue=t.label):(this._super(e,t),i.selectedValue="")}}}),$.Class.extend("bizagi.rendering.columns.hidden",{},{canBeSent:function(){return!0}}),$.Class.extend("bizagi.rendering.tablet.slide.view",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideFormDeferred=new $.Deferred,this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},buttons:[],processFormButtons:function(e){var t=this;e.buttons=[$.extend(e.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){if(e&&e.validateForm()){var i={};e.collectRenderValues(i),t.slideFormParams.allowGetOriginalFormValues&&(i.formValues=e.children),i.idPageCache=e.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(i)).done((function(r){r&&!0!==r&&"success"!==r.type?"validationMessages"===r.type?e.addValidationMessage(r.messages):"error"===r.type&&e.addErrorMessage(r.message):(t.goBack(),t.slideFormDeferred.resolve(i))})).fail((function(r){var a=r.responseText?r.responseText:"string"==typeof r?r:r.toString();if("string"==typeof a)try{a=JSON.parse(a).message}catch(e){a=(a=a.match(/"message":(.*)",/)[0]).substr(11,a.length-13)}else a.message||(a=r);e.validateForm(),e.clearValidationMessages(),e.addValidationMessage(a),t.goBack(),t.slideFormDeferred.resolve(i)})):(t.goBack(),t.slideFormDeferred.reject())}}}),$.extend(e.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){t.goBack(),t.slideFormDeferred.reject()}})],t.slideFormParams.showSaveButton||e.buttons.shift()},render:function(e){return this.renderSlideForm(e),this.slideFormDeferred.promise()},renderSlideForm:function(e){var t=this,i=new $.Deferred;return bizagi.loading.start(),$.when(t.dataService.getFormData(e)).then((function(i){e.recordXPath&&(i.form.properties.recordXpath=e.recordXPath),t.slideFormParams.showSaveButton&&!1!==e.editable||(i.form.properties.editable=!1),void 0!==i.form.properties&&(i.form.properties.orientation=t.slideFormParams.orientation||"ltr");var r=t.renderFactory.getContainer({type:"form",data:i.form,navigation:t.slideFormParams.navigation,view_container:t.container});return r.params=$.extend({},r.params,e.formParams),t.processFormButtons(r),t.form=r,r.render()})).done((function(i){t.container.element.html(i),e.isRefresh||t.slideFormParams.navigation.navigate(t.container.id),$(".ui-bizagi-button-container .action-button",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append(t.buttonContainer),t.form.triggerHandler("ondomincluded"),t.form.bind("refresh",(function(e,i){i.formParams=i.params||t.form.params,t.render(i)}))})).fail((function(e){var i=t.renderFactory.getCommonTemplate("form-error"),r=e.message||"Error";$.fasttmpl(i,{message:r}).appendTo(t.container.element),t.slideFormParams.navigation.navigate(t.container.id)})).always((function(){bizagi.loading.stop()})),i.promise()},goBack:function(){this.container.destroy()},_renderButtons:function(e){var t=$("<div class='bz-slide-button-container'></div>");$.each(e.buttons,(function(e,i){$("<div class='action-button'>"+i.caption+"</div>").click(i.callback).appendTo(t)})),this.buttonContainer=t}}),$.Class.extend("bizagi.rendering.tablet.slide.form",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideContainer&&this.slideContainer.destroy&&this.slideContainer.destroy(),this.slideContainer=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title}),this.configureViewHandlers()},goBack:function(){this.slideContainer.destroy()},configureViewHandlers:function(){},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getFormData(e)).then((function(r){!1===e.editable&&(r.form.properties.editable=!1);var a=bizagi.rendering.tablet.form.extend({submitForm:function(){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done((function(r){null===r||!0===r||"success"===r.type?(i.resolve(),t.goBack()):"validationMessages"===r.type?(t.form.addValidationMessage(r.messages),$.each(e,(function(e,i){var r=t.form.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))}))):"error"===r.type&&t.form.addErrorMessage(r.message)})):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:r.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form||(t.form=new a(n)),t.form.render()})).done((function(i){t.slideContainer.element.html(i),t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">Save</div>').delegate('div[ordinal="0"]',"click",(function(){t.form.submitForm()})),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="1" id="formButton1" class="action-button ui-bizagi-form-button">'+bizagi.localization.getResource("render-form-dialog-box-cancel")+"</div>").delegate('div[ordinal="1"]',"click",(function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()})),t.form.triggerHandler("ondomincluded"),t.form.bind("refresh",(function(){t.renderSlideForm(e)}))})).fail((function(e,i,r){var a=t.renderFactory.getCommonTemplate("form-error"),n=r.message||"Error";$.fasttmpl(a,{message:n}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)})),i.promise()}}),$.Class.extend("bizagi.rendering.tablet.slide.grid",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormDeferred=new $.Deferred,this.slideFormParams=i||{},this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},render:function(e){return this.renderSlideForm(this.slideForm,e),this.slideFormDeferred.resolve(),this.slideFormDeferred.promise()},renderSlideForm:function(e,t){var i=this,r=i.transformData(t);i.form=i.renderFactory.getContainer({type:"form",data:r.form,navigation:i.slideFormParams.navigation,view_container:i.container}),i.form.buttons=[$.extend(i.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){i.goBack();var e={};i.form.collectRenderValues(e),i.slideFormDeferred.resolve(e)}}),$.extend(i.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){i.goBack(),i.slideFormDeferred.reject()}})],i.slideFormParams.allowEdition||i.form.buttons.shift(),$.when(i.form.render()).done((function(e){i.container.element.html(e),i.slideFormParams.navigation.navigate(i.container.id),i.container.setNavigationButtons(i.form),$(".ui-bizagi-button-container .action-button",i.form.container).remove(),$(".ui-bizagi-button-container",i.form.container).append(i.buttonContainer),i.form.triggerHandler("ondomincluded")}))},transformData:function(e){var t=this,i=e.row,r=e.columns,a=e.xpathContext.length>0?e.xpathContext+"."+e.xpath+"["+e.row[0]+"]":e.xpath+"[id="+e.row[0]+"]",n={type:"form",form:{elements:[],pageCacheId:e.pageCacheId,sessionId:e.sessionId,properties:{xpathContext:a},actions:t.transformActions(e.xpath,e.actions),validations:t.transformValidations(e.xpath,e.validations)}};return $.each(i,(function(e,i){if(e>0){var a={render:{properties:$.extend({},r[e-1].properties)}};if(a.render.properties.type=t.mapRenderType(a.render.properties.type),a.render.properties.displayType="both",0==t.slideFormParams.allowEdition&&(a.render.properties.editable=!1),a.render.properties.value=t.mapValue(a.render.properties.type,i),a.render.properties.recalculate&&(a.render.properties.data=null),void 0!==a.render.properties.columnVisible&&(a.render.properties.visible=a.render.properties.columnVisible),"upload"==a.render.properties.type&&(a.render.properties.isColumn=!0),"search"==a.render.properties.type){var o=a.render.properties.value;o.length>0&&(o=[].concat(o[0]),a.render.properties.value={id:o[0],label:o[1],additionallabel:o[2]||void 0})}n.form.elements.push(a)}})),n},mapRenderType:function(e){return"FormLink"===(e=e.replaceAll("tablet","").replaceAll("column",""))?"formLink":e=e.toLowerCase()},mapValue:function(e,t){return["combo","radio","list"].includes(e)?t&&t.length>0?[{id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!==t})):t[0][1]}]:null:t},transformActions:function(e,t){var i=this,r=[];return bizagi.util.isEmpty(t)?r:($.each(t,(function(t,a){for(var n=!1,o=0;o<a.dependencies.length;o++)-1!=a.dependencies[o].indexOf(e)&&(n=!0);if(n){for(var s=JSON.parse(JSON.encode(a)),l=0;l<s.dependencies.length;l++)s.dependencies[l]=s.dependencies[l].replaceAll(e+"[].","");i.transformConditions(e,s.conditions),i.transformCommands(e,s.commands),i.transformCommands(e,s.elseCommands),r.push(s)}})),r)},transformValidations:function(e,t){var i=this,r=[];return bizagi.util.isEmpty(t)?r:($.each(t,(function(t,a){var n=JSON.parse(JSON.encode(a));i.transformConditions(e,n.conditions),r.push(n)})),r)},transformConditions:function(e,t){if(t.expressions)for(var i in t.expressions)this.transformConditions(e,t.expressions[i]);else t.simple?this.transformConditions(e,t.simple):t.complex?this.transformConditions(e,t.complex):t.xpath?(t.xpath=t.xpath.replaceAll(e+"[].",""),"xpath"===t.argumentType&&(t.argument=t.argument.replaceAll(e+"[].",""))):t&&t.renderId&&(t.renderId=t.renderId.replaceAll(e+"[].",""))},transformCommands:function(e,t){var i=null;if(null!=t&&0!==t.length){for(var r=0;r<t.length;r++)"refresh"===t[r].command?i=r:(t[r].xpath&&(t[r].xpath=t[r].xpath.replaceAll(e+"[].","")),"xpath"===t[r].argumentType&&(t[r].argument=t[r].argument.replaceAll(e+"[].","")),!t[r].xpath&&t[r].renderId&&(t[r].renderId=t[r].renderId.replaceAll(e+"[].","")));null!=i&&t.splice(r,1)}},goBack:function(){this.container.destroy()}}),$.Class.extend("bizagi.rendering.tablet.slide.adhocForm",{},{init:function(e,t){this.renderFactory=e,this.slideFormDeferred=new $.Deferred,this.slideFormParams=t||{},this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},render:function(e){return this.renderSlideForm(e),this.slideFormDeferred.promise()},renderSlideForm:function(e){var t=this,i=t.transformData(e);t.form=t.renderFactory.getContainer({type:"form",data:i.form,navigation:this.slideFormParams.navigation,view_container:t.container}),t.form.buttons=[$.extend(t.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){if(t.form.validateForm()){t.goBack();var e={};t.form.collectRenderValues(e),t.slideFormDeferred.resolve(e)}}}),$.extend(t.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){t.goBack(),t.slideFormDeferred.reject()}})],t.slideFormParams.allowEdition||t.form.buttons.shift(),$.when(t.form.render()).done((function(r){"mock_id"==e.row[0]&&$.each(i.elementsWithDefaultValue,(function(e,i){var r=t.form.getRender(i.xpath+"."+i.id);r||(r=t.form.getRender(i.xpath));var a=bizagi.util.isArray(i.defaultValue)?i.defaultValue[0]:i.defaultValue;r.setDisplayValue(a)})),t.container.element.html(r),t.slideFormParams.navigation.navigate(t.container.id),$(".ui-bizagi-button-container .action-button",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append(t.buttonContainer),t.form.triggerHandler("ondomincluded")}))},transformData:function(e){var t=this,i=e.row,r=e.columns,a=!1,n=e.xpathContext.length>0?e.xpathContext+"."+e.xpath+"["+e.row[0]+"]":e.xpath+"[id="+e.row[0]+"]",o={type:"form",form:{elements:[],pageCacheId:e.pageCacheId,sessionId:e.sessionId,properties:{xpathContext:n},actions:t.transformActions(e.xpath,e.actions),validations:t.transformValidations(e.xpath,e.validations)},elementsWithDefaultValue:[]};return"mock_id"===i[0]&&(a=!0),$.each(i,(function(e,i){if(e>0){var n=r[e-1].properties,s={render:{properties:$.extend({},n)}};if(s.render.properties.type=t.mapRenderType(s.render.properties.type),s.render.properties.defaultvalue=void 0!==s.render.properties.defaultvalue?s.render.properties.defaultvalue:s.render.properties.defaultValue,s.render.properties.displayType="both",0==t.slideFormParams.allowEdition&&(s.render.properties.editable=!1),s.render.properties.value=t.mapValue(s.render.properties.type,i),s.render.properties.recalculate&&(s.render.properties.data=null),void 0!==s.render.properties.defaultvalue&&(void 0!==s.render.properties.value&&null!=s.render.properties.value||o.elementsWithDefaultValue.push({id:s.render.properties.id,xpath:s.render.properties.xpath,defaultValue:s.render.properties.defaultvalue})),void 0!==s.render.properties.columnVisible&&(s.render.properties.visible=s.render.properties.columnVisible),"readonly"===s.render.properties.type&&(s.render.properties.type="text",s.render.properties.editable=!1),"upload"===s.render.properties.type&&(s.render.properties.isColumn=!0),"search"===s.render.properties.type){var l=s.render.properties.value;null==l?s.render.properties.value={}:l.length>0&&(l=[].concat(l[0]),s.render.properties.value={id:l[0],label:l[1],additionallabel:l[2]||void 0})}var d=["document","formLink","upload","uploadecm","image","search"].includes(s.render.properties.type),c=!!s.render.properties.isExclusive&&"boolean"===s.render.properties.type;c||a&&d?s.render.properties.editable=!1:c&&(s.render.properties.value=l,s.render.properties.editable=!1),o.form.elements.push(s)}})),o},mapRenderType:function(e){return"FormLink"===(e=e.replaceAll("tablet","").replaceAll("column",""))?"formLink":e=e.toLowerCase()},mapValue:function(e,t){return["combo","radio","list"].includes(e)?t&&t.length>0?[{id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!==t})):t[0][1]}]:null:t},transformActions:function(e,t){var i=this,r=[];return bizagi.util.isEmpty(t)?r:($.each(t,(function(t,a){for(var n=!1,o=0;o<a.dependencies.length;o++)-1!=a.dependencies[o].indexOf(e)&&(n=!0);if(n){for(var s=JSON.parse(JSON.encode(a)),l=0;l<s.dependencies.length;l++)s.dependencies[l]=s.dependencies[l].replaceAll(e+"[].","");i.transformConditions(e,s.conditions),s.commands=i.transformCommands(e,s.commands),s.elseCommands=i.transformCommands(e,s.elseCommands),r.push(s)}})),r)},transformValidations:function(e,t){var i=this,r=[];return bizagi.util.isEmpty(t)?r:($.each(t,(function(t,a){var n=JSON.parse(JSON.encode(a));i.transformConditions(e,n.conditions),r.push(n)})),r)},transformConditions:function(e,t){if(t.expressions)for(var i in t.expressions)this.transformConditions(e,t.expressions[i]);else t.simple?this.transformConditions(e,t.simple):t.complex?this.transformConditions(e,t.complex):t.xpath?(t.xpath=t.xpath.replaceAll(e+"[].",""),"xpath"===t.argumentType&&(t.argument=t.argument.replaceAll(e+"[].",""))):t&&t.renderId&&(t.renderId=t.renderId.replaceAll(e+"[].",""))},transformCommands:function(e,t){if(null!=t)return t.reduce((function(t,i){return["refresh","submit-data","execute-rule","execute-interface","execute-sap","execute-connector","execute-excel-bot","execute-pipeline"].includes(i.command)||(i.xpath&&(i.xpath=i.xpath.replaceAll(e+"[].","")),"xpath"===i.argumentType&&(i.argument=i.argument.replaceAll(e+"[].","")),!i.xpath&&i.renderId&&(i.renderId=i.renderId.replaceAll(e+"[].","")),t.push(i)),t}),[])},goBack:function(){this.container.destroy()}}),$.Class.extend("bizagi.rendering.tablet.slide.searchForm",{},{init:function(e,t,i,r,a){this.dataService=e,this.renderFactory=t,this.searchForms=i,this.searchParams=r,this.searchFormParams=a,this.searchFormDeferred=new $.Deferred,this.container=this.searchFormParams.navigation.createRenderContainer({title:this.searchFormParams.title})},render:function(e){return this.properties=e,this.renderSearchForm(e),this.searchFormDeferred.promise()},renderSearchForm:function(e){var t=this;bizagi.loading.start(),$.when(t.getSearchContainerData(e)).then((function(e){e.form.properties&&(e.form.properties.orientation=t.searchParams.orientation||"ltr");var i=t.renderFactory.getContainer({type:"form",data:e.form,navigation:t.searchFormParams.navigation,view_container:t.container});return i.buttons=t.getSearchButtons(),t.form=i,(Object.keys(i.children)||[]).map((function(e){i.children[e].params=$.extend({},i.children[e].params,t.searchFormParams)})),i.render()})).done((function(e){var i=t.form.firstChild();t.container.element.html(e),t.searchFormParams.navigation.navigate(t.container.id),t.form.triggerHandler("ondomincluded"),t.currentSearchForm=i,t.currentSearchForm.triggerHandler("ondomincluded"),t.currentSearchForm.bind("instancerefresh",(function(){t.searchResultContainer.show()})),t.form.bind("refresh",(function(e,i){return i.scrollTop=t.form.container.parent().scrollTop(),i=$.extend({focus:focus,selectedTabs:t.form.getSelectedTabs(),isRefresh:!0,contextType:t.properties.contextType||"",navigation:t.searchFormParams.navigation,view_container:t.container},i),t.renderSearchForm(i)})),t.currentSearchForm.bind("instanceSelected",(function(e,i){t.goBack(),t.searchFormDeferred.resolve({id:i.id,label:""})})),t.containerSearchCriteria=t.currentSearchForm.container.find(".bz-container__search-criteria"),t.searchResultContainer=$(".bz-container__search-results",e),t.searchResultContainer.hide()})).fail((function(e){if(t.hasSessionFormException(e))t.goToStartPage(e);else{var i=t.renderFactory.getCommonTemplate("form-error"),r=e&&e.message?e.message:e;$($.fasttmpl(i,{message:r})).appendTo(t.container.element),t.searchFormParams.navigation.navigate(t.container.id)}})).always((function(){bizagi.loading.stop()}))},renderAddForm:function(e){var t=this;e=e||{};var i=t.properties;void 0===t.addContainer&&(t.addContainer=t.searchFormParams.navigation.createRenderContainer({title:bizagi.localization.getResource("render-dialog-entity")}),t.addContainer.element.bind("close",(function(){delete t.addContainer})));var r=e.isRefresh||!1,a={idPageCache:e.idPageCache,guidEntity:i.entity,contextType:"entity"};r?(a.isRefresh=!0,a.idStartScope=e.idStartScope):(a.idRender=i.idRender,a.requestedForm="addForm"),bizagi.loading.start(),$.when(t.dataService.getFormData(a)).then((function(i){!1===e.editable&&(i.form.properties.editable=!1),i.form.properties&&(i.form.properties.orientation=t.searchParams.orientation||"ltr"),i.form.contextType="entity";var a=t.renderFactory.getContainer($.extend({},t.addFormParams,{type:"form",data:i.form,focus:e.focus||!1,selectedTabs:e.selectedTabs,isRefresh:r,requestedForm:e.requestedForm,navigation:t.searchFormParams.navigation,view_container:t.addContainer}));return a.buttons=t.getAddFormButtons(a),$.extend(a,{processButtons:function(){$.each(a.buttons,(function(e,i){switch(i.ordinal){case 1:$(a.getButtons()[e]).click((function(){t.addContainer.destroy(),delete t.addContainer})),a.getButtons()[e].innerHTML=bizagi.localization.getResource("render-form-dialog-box-close"),a.buttons[e].caption=bizagi.localization.getResource("render-form-dialog-box-close"),a.buttons[e].action="back";break;default:$(a.getButtons()[e]).click((function(){t.saveDataAddForm(a),t.addContainer.destroy(),delete t.addContainer}))}}))}}),(Object.keys(a.children)||[]).map((function(e){a.children[e].params=$.extend({},a.children[e].params,t.addFormParams)})),$.when(a.render()).done((function(e){t.currentAddForm=a.firstChild(),t.addContainer.element.html(e),r||t.searchFormParams.navigation.navigate(t.addContainer.id,"overlay:up"),t.addContainer.setNavigationButtons(a),a.triggerHandler("ondomincluded"),t.handleSearchFormZindex("show"),a.bind("refresh",(function(e,i){return i.scrollTop=t.form.container.parent().scrollTop(),i=$.extend({focus:focus,selectedTabs:t.form.getSelectedTabs(),isRefresh:!0,contextType:t.properties.contextType||"",navigation:t.searchFormParams.navigation,view_container:t.addContainer},i),t.renderAddForm(i)}))}))})).fail((function(e){var i=bizagi.util.getErrorFormatted(e);t.hasSessionFormException(i)?t.goToStartPage(i):(t.addContainer.destroy(),delete t.addContainer)})).always((function(){bizagi.loading.stop()}))},saveDataAddForm:function(e){var t=this,i=$.Deferred();if(e.validateForm()){var r={};$.forceCollectData=!0,e.collectRenderValues(r),r.idPageCache=e.idPageCache;var a={action:"SAVE",data:r,idPageCache:r.idPageCache,guidEntity:e.properties.entity,contexttype:"entity"},n={};e.collectRenderValuesForSubmit(n),$.forceCollectData=!1,bizagi.util.isMapEmpty(n)?(bizagi.showMessageBox(bizagi.localization.getResource("render-search-advanced-no-filters")),i.reject()):(bizagi.loading.start(),$.when(t.dataService.submitData(a)).done((function(r){function a(e){var i=t.currentSearchForm.getRender(e);return"object"===_typeof(i)&&null!==i?{found:!0,obj:i}:{found:!1,obj:{}}}if(r&&"validationMessages"===r.type)e.addValidationMessage(r.messages),i.reject();else{for(var o in n){var s=a(o);s.found&&(s.obj.setValue(n[o]),t.setDisplayValueToControl(s.obj,e,o,n))}i.resolve()}})).fail((function(r){var a=bizagi.util.getErrorFormatted(r);if(t.hasSessionFormException(a))t.goToStartPage(a);else{var n=a.message||bizagi.localization.getResource("workportal-general-error");e.addValidationMessage(n)}i.reject()})).always((function(){bizagi.loading.stop()})))}else i.reject();return i.promise()},setDisplayValueToControl:function(e,t,i,r){"searchSuggest"===e.properties.type?e.setDisplayValue(t.getRender(i).getDisplayValue()):e.setDisplayValue(r[i])},getSearchButtons:function(){var e=this,t=[{ordinal:1,action:"search",caption:bizagi.localization.getResource("render-form-dialog-box-search"),callback:function(){e.currentSearchForm.performSearch(e.searchParams)}},{ordinal:2,action:"cancel",caption:"cancel",callback:function(){e.goBack()}}];return e.searchFormParams.allowNew&&t.push({ordinal:3,action:"add",caption:bizagi.localization.getResource("render-form-dialog-box-add"),callback:function(){var t={idCase:e.searchFormParams.idCase,idRender:e.properties.idRender,displayName:e.properties.displayName,idPageCache:e.properties.idPageCache};e.renderAddForm(t)}}),t},getSearchContainerData:function(e){var t=this,i=new $.Deferred,r={form:{properties:{},elements:[]}},a=r.form,n=t.searchForms[0];if(t.searchForms.length>1){var o={properties:{type:"tab"},elements:[]},s=[];$.each(t.searchForms,(function(e,i){var r=i.default||!1,l={properties:{id:e,type:"tabItem",displayName:i.caption},elements:[]};r?(o.elements.push({container:l}),a=l,n=t.searchForms[0]):s.push({container:l})})),$.each(s,(function(e,t){o.elements.push(t)})),r.form.elements.push({container:o})}return bizagi.loading.start(),$.when(t.getSearchFormData(e,n)).done((function(e){a.elements.push(e),a.properties.id=Math.guid(),i.resolve(r)})).fail((function(e){var t=bizagi.util.getErrorFormatted(e);i.reject(t)})).always((function(){bizagi.loading.stop()})),i.promise()},getSearchFormData:function(e,t){return this.dataService.getSearchFormData($.extend(e,{idSearchForm:t.id,url:t.url})).pipe((function(t){return t.form.properties.idRender=e.idRender,t}))},goBack:function(){this.handleSearchFormZindex("hide"),this.container.destroy()},handleSearchFormZindex:function(e){var t=$.grep($(".km-modalview-root"),(function(e){return"block"===$(e).css("display")}));if(t.length>0){var i="show"===e?0:10001;$(t).css("z-index",i)}},hasSessionFormException:function(e){return void 0!==e&&"AUTH_ERROR"===e.code},goToStartPage:function(e){this.searchFormParams.navigation&&this.searchFormParams.navigation.goToStartPage(e)},getAddFormButtons:function(e){var t=this;return[$.extend(e.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""},{callback:function(){t.saveDataAddForm(e).done((function(){t.addContainer.destroy(),delete t.addContainer,setTimeout((function(){t.currentSearchForm.performSearch(t.searchParams)}),350)}))}}),$.extend(e.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:""},{callback:function(){t.addContainer.destroy(),delete t.addContainer}})]}}),$.Class.extend("bizagi.rendering.tablet.slide.upload",{},{init:function(e,t,i){var r=this;this.dataService=e,this.renderFactory=t,this.slideFormDeferred=new $.Deferred,this.slideFormParams=i||{},r.slideContainer=r.slideFormParams.navigation.createRenderContainer({title:r.slideFormParams.title}),r.processButtons().done((function(e){r.slideFormDeferred.resolve(e)})).fail((function(){r.slideFormDeferred.reject()}))},processButtons:function(){var e=this,t=new $.Deferred,i={buttons:[]},r=function(){e.goBack(),t.reject()};return i.buttons.push({text:bizagi.localization.getResource("workportal-case-dialog-box-close"),caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!1,refresh:!1,ordinal:0,action:"back",save:!0,style:"",callback:r,click:r}),this.slideFormParams=$.extend(i,this.slideFormParams),e._renderButtons(this.slideFormParams),t.promise()},render:function(e){return this.renderUploadFile(this.slideForm,e),this.slideFormDeferred.promise()},renderUploadFile:function(e,t){var i=this.renderFactory.getCommonTemplate("uploadSlide"),r=$.fasttmpl(i,{url:t.url});this.slideContainer.element.html(r),this.slideFormParams.navigation.navigate(this.slideContainer.id);var a=$.extend({originalProperties:{uniqueId:101,id:101}},this.slideFormParams);a.container=this.slideContainer.element,this.slideFormParams.navigation.setNavigationButtons(a),r.find(".ui-slide-upload-link").click((function(){$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-tablet-slide-upload-confirmation"))).done((function(){window.location.href=t.url}))}))},goBack:function(){this.slideContainer.destroy()},_renderButtons:function(e){var t=$('<div class="bz-slide-button-container"></div>');$.each(e.buttons,(function(e,i){$('<div class="action-button">'+i.text+"</div>").click(i.click).appendTo(t)})),this.buttonContainer=t}}),$.Class.extend("bizagi.rendering.tablet.startForm",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideContainer=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title}),this.configureViewHandlers()},configureViewHandlers:function(){},goBack:function(){this.slideContainer.destroy()},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getStartForm(e)).then((function(r){!1===e.editable&&(r.form.properties.editable=!1);var a=bizagi.rendering.tablet.form.extend({submitForm:function(){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done((function(r){null==r||1==r||"success"==r.type?(i.resolve(),t.goBack()):"validationMessages"==r.type?(t.form.addValidationMessage(r.messages),$.each(e,(function(e,i){var r=t.form.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))}))):"error"==r.type&&t.form.addErrorMessage(r.message)})):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:r.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form=new a(n),t.form.bind("refresh",(function(i,r){r=$.extend({selectedTabs:t.form.getSelectedTabs(),isRefresh:!0},e,r,{idStartScope:t.form.properties.idStartScope}),t.renderSlideForm(r)})),t.form.buttons=[$.extend(t.form.buttons[0]||{},{caption:t.slideFormParams.saveButtonLabel,actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""})],t.form.render()})).done((function(i){t.slideContainer.element.html(i),e.isRefresh||t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">'+(t.slideFormParams.saveButtonLabel?t.slideFormParams.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"))+"</div>").delegate('div[ordinal="0"]',"click",(function(){t.form.submitForm()})),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="1" id="formButton1" class="action-button ui-bizagi-form-button">'+bizagi.localization.getResource("render-form-dialog-box-cancel")+"</div>").delegate('div[ordinal="1"]',"click",(function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()})),t.form.triggerHandler("ondomincluded")})).fail((function(e,i,r){var a=t.renderFactory.getCommonTemplate("form-error"),n=r.message||"Error";$.fasttmpl(a,{message:n}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)})),i.promise()}}),$.Class.extend("bizagi.rendering.tablet.slide.ecm",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideFormDeferred=new $.Deferred,this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},render:function(e){return this.renderSlideForm(e),this.slideFormDeferred.promise()},renderSlideForm:function(e){var t=this,i=t.getMetadataForm(e);t.form=t.renderFactory.getContainer({type:"form",data:i.form,navigation:t.slideFormParams.navigation,view_container:t.container}),$.when(t.form.render()).done((function(i){t.container.element.html(i),t.slideFormParams.navigation.navigate(t.container.id),t.processButtons(t.form,e),t.container.setNavigationButtons(t.form),t.form.triggerHandler("ondomincluded")})).always((function(){t.slideFormDeferred.resolve()}))},processButtons:function(e,t){var i=this;e.buttons=[{ordinal:0,action:"save",caption:bizagi.localization.getResource("render-form-dialog-box-save"),callback:i.onSaveDataMetadataForm.bind(i,t.fileData)},{ordinal:1,action:"back",caption:bizagi.localization.getResource("render-form-dialog-box-close"),callback:function(){i.slideFormParams.onCancel({}),i.goBack()}}],i.slideFormParams.editable||e.buttons.shift()},getMetadataForm:function(e){var t=this,i={type:"form",form:{elements:[],pageCacheId:e.pageCacheId,sessionId:e.sessionId,properties:{id:101,xpathContext:e.xpathContext,editable:t.slideFormParams.editable,orientation:t.slideFormParams.orientation||"ltr"}}};return $.each(e.metadata,(function(e,r){var a=t.getRenderType(r.metadataType),n=Object.assign({id:e+1,xpath:r.metadataId,displayName:r.description,required:!0===bizagi.util.parseBoolean(r.required),editable:!1===bizagi.util.parseBoolean(r.readOnly),value:r.value},a);i.form.elements.push({render:{properties:n}})})),i},getRenderType:function(e){switch(e.toUpperCase()){case"INTEGER":return{type:"number",dataType:2,allowDecimals:!1,thousands:!1};case"DECIMAL":return{type:"number",dataType:10,allowDecimals:!0,thousands:!0};case"DATETIME":return{type:"date",dataType:12};case"BOOL":return{type:"boolean",dataType:5};case"STRING":default:return{type:"text",dataType:15,maxLength:50,autoExtend:!1}}},onSaveDataMetadataForm:function(e){var t=this,i=$.Deferred();if(t.form.validateForm()){var r={};if(t.form.collectRenderValuesForSubmit(r),$.forceCollectData=!1,bizagi.util.isMapEmpty(r))t.slideFormParams.onSave({update:!1}),i.resolve({update:!1}),t.goBack();else{var a=Object.keys(r).map((function(e,t){return{idMetadata:e,value:r[e]}})),n={idFileUpload:e.idFileUpload,fileName:e.fileName,idPageCache:e.idPageCache,xpathContext:e.xpathContext,xPath:e.xpath,idAttrib:e.idAttrib};n.metaValues=JSON.encode({metadataValues:a}),bizagi.loading.start(),$.when(t.dataService.updateECMMetadata(n)).done((function(r){r&&r.idFileUpload&&(t.slideFormParams.onSave({update:!0,idFileUpload:r.idFileUpload,fileName:e.fileName}),i.resolve({update:!0})),t.goBack()})).fail((function(e){t.form.addValidationMessage(e.message),i.reject()})).always((function(){bizagi.loading.stop()}))}}i.promise()},goBack:function(){this.container.destroy()}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.form",bizagi.rendering.form.prototype),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.form",{},{init:function(e){var t=this;if(e=e||{},t.warnings={},t.errors={},e.syncError){e.data.properties.editable=!0!==e.isOfflineErrorMode;var i="business"==e.syncError.type?e.syncError.message:void 0;if(!bizagi.util.isEmpty(i))try{(i=$.makeArray(i)).forEach((function(e){t.errors[e]=e}))}catch(e){console.error("syncErrorMessage could not be parsed as array",i),t.errors[i]=i}delete e.syncError}t.isOfflineErrorMode=!0===e.isOfflineErrorMode,t.showToastOnSuccessSync=!0===e.showToastOnSuccessSync,t.removeSyncErrorOnSubmit=!0===e.removeSyncErrorOnSubmit,this._super(e)},configureHandlers:function(){var e=this,t=e.container;e.configureComplexGateway(),e.processButtons(t),e.bind("ondomincluded",(function(){var t=e.getValidationsContainer();e.validationController=new bizagi.command.controllers.validation(e,e.validations,t),e.actionController=new bizagi.command.controllers.action(e,e.actions),e.readyDeferred.resolve()})),e.bind("modalViewDidAppear",(function(){e.params.navigation.modalViewDidAppear()})),e.bind("closeModalValidationMessage",(function(){e.validationController&&e.validationController.clearValidationMessages()})),e.bind("modalViewDidDisappear",(function(){e.params.navigation.modalViewDidDisappear()})),e.configureNetworkHandlers()},postRenderContainer:function(e){var t=this;t.properties;t._super(e);var i=t.getButtons();if(bizagi.util.isiOSTabletDevice()&&$(".km-native-scroller").css("-webkit-overflow-scrolling","inherit"),!bizagi.util.isObjectEmpty(t.warnings)){var r=$('<ul class="ui-bizagi-form-warnings"></ul>');for(var a in t.warnings)r.append($("<li>"+a+"</li>"));$("<button>X</button>").appendTo(r),r.prependTo(t.container),r.click((function(){r.detach()}))}if(!bizagi.util.isEmpty(t.errors))for(var n in t.errors)setTimeout((function(){t.addValidationMessage(n)}),1);(i?i.length:0)&&($(document).data("auto-save","auto-save"),$(document).unbind("save-form").bind("save-form",(function(e,i){t.allowOnlineActions()?t.autoSaveEvents(i):i.resolve()})),$(window).unbind("beforeunload").bind("beforeunload",(function(e){var i={};if(t.collectRenderValues(i),!$.isEmptyObject(i)&&$(document).data("auto-save"))return bizagi.localization.getResource("confirmation-savebox-message2")}))),bizagi.util.isiOSTabletDevice()&&setTimeout((function(){$(".km-native-scroller").css("-webkit-overflow-scrolling","touch")}),1e3);var o=this.getParams()||{},s=$.extend([],o.selectedSection);this.setParam("selectedSection",[]),s.length>0&&s.forEach((function(e){var i=t.getRenderById(e);void 0!==i&&i.expand()}))},autoSaveEvents:function(e,t){var i=this,r={};if(i.isOfflineErrorMode)e.resolve();else if(i.collectRenderValues(r),$.isEmptyObject(r))e.resolve();else{var a="startform"===i.properties.formtype,n=a?bizagi.localization.getResource("confirmation-savebox-message4"):bizagi.localization.getResource("confirmation-savebox-message1"),o=a?bizagi.showConfirmationBox(n,"Bizagi","warning",[{label:bizagi.localization.getResource("confirmation-box-ok"),action:"resolve"},{label:bizagi.localization.getResource("confirmation-box-cancel"),action:"reject"}]):bizagi.showSaveBox(n,"Bizagi","warning");$.when(o).done((function(){a?e.resolve():(bizagi.loading.start(),$.when(i.saveForm()).always((function(){if(i.params.isOfflineForm&&"task"===i.params.offlineType&&i.online){var t=new $.Deferred,r=$.extend({deferred:t},i.params);$(document).trigger("tryPushCase.offline",r),$.when(t).then((function(){e.resolve()})).fail((function(){console.log("Auto-Save Sync Error",arguments),e.resolve()})).always((function(){bizagi.loading.stop()}))}else bizagi.loading.stop(),e.resolve()})))})).fail((function(){a?e.reject():e.resolve()}))}},internalSubmitForm:function(e){var t=this,i=[],r=$.Deferred(),a=null,n=null,o=null,s=null,l=null,d={};if((e.submitData||e.executeRule||e.createnewcase)&&(d=t.collectRenderValuesForSubmit()),$.when(t.startLoading()).done((function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")})),e.executeRule&&((a=t.dataService.submitData({action:"SUBMITDATA",data:d,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0})).tag="submitData",s=t.prepareCheckpointAction(e.id),d={},(n=t.dataService.executeButton({idRender:e.id,xpathContext:t.properties.xpathContext||"",idPageCache:t.properties.idPageCache,prepare:!0})).tag="executeRule",l=t.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase||e.nextWithoutValidations){if(t.transitions){var c=[];if($.each(this.activeTransitions,(function(e,t){t&&c.push(e)})),0==bizagi.util.countProps(c))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),t.endLoading(),r.reject(),r.promise()}(o=t.dataService.submitData({action:e.action,forcePlanCompletion:e.forcePlanCompletion,data:d,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0,transitions:c||"",contexttype:t.properties.contextType,surrogatekey:t.properties.surrogateKey})).tag="performAction"}n&&(i.push(a),s&&i.push(s),i.push(n),l&&i.push(l)),o&&i.push(o),bizagi.chrono.initAndStart("submitForm-ajax");var u=new $.Deferred;return d&&d.deferreds?$.when.apply($,d.deferreds).done((function(e){u.resolve(e),delete d.deferreds})).fail((function(){u.reject(),console.log("Error: It was not possible resolve async actions on form ")})):u.resolve(),$.when(u).done((function(){bizagi.util.tablet.startLoading(),$.when(t.dataService.multiaction().execute({actions:i})).done((function(i){var a;if(bizagi.chrono.stop("submitForm-ajax"),$.each(i,(function(e,i){"validationMessages"==i.result.type&&(t.addValidationMessage(i.result.messages),a=!0),"alertMessages"==i.result.type&&(bizagi.showMessageBox(i.result.messages.join(","),bizagi.localization.getResource("workportal-general-word-information","Information")),a=!0)})),a)e.executeRule&&t.sendRollbackAction(e.id);else{if(!t.postProcessButton(i,e))return;e.refresh&&t.refreshForm(),e.routing&&t.triggerHandler("routing",{idCase:t.params.idCase,buttonPropertiesAction:e.action}),e.createnewcase&&i.length>0&&t.triggerHandler("routing",{idCase:i[0].result.IdCase,caseNumber:i[0].result.CaseNumber})}delete t.nonSupportedMethods,r.resolve()})).fail((function(i,a,n){e.executeRule&&t.sendRollbackAction(e.id),n&&n.error&&("WaitForCompletionPlanException"===n.error.errorType||"InvalidPlanStateException"===n.error.errorType||"CustomMessageException"===n.error.errorType)?(t.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(n.error.message),null,!1)).then((function(){return $.when(t.internalSubmitForm($.extend({},e,{forcePlanCompletion:!0})))})).done((function(){r.resolve()})).fail((function(){r.reject()}))):(t.failHandler({error:void 0===n?bizagi.localization.getResource("workportal-general-error"):n}),r.reject(n))})).always((function(){bizagi.util.tablet.stopLoading()}))})).always((function(){bizagi.util.tablet.stopLoading()})),r.promise()},prepareCheckpointAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},prepareCommitAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},getPane:function(){return this.pane},getButtons:function(){return this.getParams()&&(handler=this.getParams().getButtons)&&handler(this),$(".ui-bizagi-button-container :button",this.container)},processButtons:function(){var e=this.getParams();e&&e.processButtons&&(0,e.processButtons)(this);var t=this.properties,i=this.getButtons();t.buttons=this.buttons||i,this.saveButton=null,this.nextButton=null;for(var r=0,a=t.buttons.length;r<a;r++)"save"==t.buttons[r].action?this.saveButton=t.buttons[r]:"next"==t.buttons[r].action&&(this.nextButton=t.buttons[r]);var n=this.getNavigation();if(void 0!==n){var o=this.getViewContainer();void 0!==o?o.setNavigationButtons(this):n.setNavigationButtons(this)}this._super()},refreshForm:function(e,t){var i,r=this,a=r.properties,n=r.getParams(),o=$.Deferred();return e=e||r.getFocus(),t=0!=t||t,e&&!e.id&&(e={id:e}),i={idCase:r.params.idCase||"",idWorkitem:r.params.idWorkitem||"",idTask:r.params.idTask||"",focus:e,selectedTabs:r.getSelectedTabs(),selectedSection:r.getSelectedSection(),xpathContext:a.xpathContext,idPageCache:a.idPageCache,isRefresh:!0,action:r.getEndPointAction(),idStartScope:r.properties.idStartScope||"",navigation:n.navigation,view_container:n.view_container},r.isOfflineRefreshWithEdition&&(i.isEdited=!0,r.isOfflineRefreshWithEdition=!1),(n.postRenderEdit||n.processButtons)&&(i.isOfflineForm=r.params.isOfflineForm||!1,i.formsRenderVersion=r.params.formsRenderVersion||0,i.postRenderEdit=n.postRenderEdit,i.processButtons=n.processButtons,i.originalParams=n.originalParams||{},i.getButtons=n.getButtons),$(".km-native-scroller").css("-webkit-overflow-scrolling","inherit"),t&&r.startLoading(),$.when(r.triggerHandler("refresh",i)).done((function(){setTimeout((function(){$(".km-native-scroller").css("-webkit-overflow-scrolling","touch")}),1e3),o.resolve()})).fail((function(){o.reject()})).always((function(){t&&r.endLoading()})),o.promise()},checkWidgetsData:function(){var e=null;if(bizagi.workportal.tablet.popup&&bizagi.workportal.tablet.popup.instance&&bizagi.workportal.tablet.popup.instance.getResponseValues){if(null===(e=bizagi.workportal.tablet.popup.instance.getResponseValues(bizagi.workportal.tablet.popup.instance.getResponseValuesParams)))return bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-complexgateway-path"),bizagi.localization.getResource("workportal-widget-complexgateway-error")),-1;bizagi.workportal.tablet.popup.instance.dontClose=!1,bizagi.workportal.tablet.popup.instance.close()}return e},repaintComplexGateway:function(){var e=this;void 0!==e.focus&&void 0!==e.focus.idCaseObject&&void 0!==e.focus.idCaseObject.isComplex&&e.dataService.getWorkitems({idCase:e.focus.idCaseObject.idCase}).done((function(t){if(1==t.workItems.length&&"ComplexGateway"==t.workItems[0].taskType){var i=t.workItems[0].transitions;e.currentPopup="complexgateway",$(document).triggerHandler("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_COMPLEXGATEWAY,options:{transitions:i,sourceElement:".ui-bizagi-form",insertAfter:".ui-bizagi-form .ui-bizagi-button-container",height:"auto",offset:"8 0",activeScroll:!1,dontClose:!0,closed:function(){e.currentPopup=null}}})}}))},addWarning:function(e){this.warnings[e]=e},addError:function(e){this.errors[e]=e},processButton:function(e){var t=$.Deferred();return!bizagi.util.isObjectEmpty(this.errors)&&(t.resolve(),bizagi.util.parseBoolean(e.routing))?t.promise():this._super(e)},getNavigation:function(){return this.getFormContainer().getParams().navigation},getViewContainer:function(){return this.getFormContainer().getParams().view_container},isFloatingButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFloatingButtonsEnabled()},isFormButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFormButtonsEnabled()},startLoading:function(){bizagi.loading.start()},endLoading:function(){bizagi.loading.stop()},dispose:function(e){void 0!==e&&void 0!==e.isRefresh&&0!=e.isRefresh||this._super()},failHandler:function(e){this._super(e);var t={};try{t=JSON.parse(e)||{}}catch(i){t=e.length&&e.length>1?e[0]:e}finally{t.error&&(t=t.error),t.error&&(t=t.error),void 0!==t.code&&"AUTH_ERROR"===t.code&&this.refreshAfterSessionIdle()}},refreshAfterSessionIdle:function(){$.notifier.add({title:bizagi.localization.getResource("workportal-sessiontimeout-expired-title","Your session has expired"),text:bizagi.localization.getResource("render-idle-expired-error","Idle timer expired. For safety reasons this view will be refreshed automatically in 5 seconds. Note that any unsaved data is lost.").replace("%s","5"),sticky:!1,overlay:!0,time:5e3,after_close:this.routingToProcess.bind(this)})},routingToProcess:function(){var e=this.params||{},t=this.getFormContainer();if(t&&t.isStartForm()){var i=e&&e.originalParams||{};i&&i.idProcess&&bizagi.webpart.publish("render-start-form",{params:{showProcess:!0,hasStartForm:!0,fromNewCase:!0,idProcess:i.idProcess,displayName:i.displayName||"",mapping:{},type:"Process"}})}else this.triggerHandler("routing",{idCase:e.idCase,idWorkitem:e.idWorkitem})},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("form"),i=$.fasttmpl(t,{buttons:this.buttons,transitions:this.transitions,uniqueId:e.uniqueId,helptext:e.helpText,mode:this.getMode(),queryForm:"queryForm"==this.getFormType(),summaryForm:this.params.summaryForm||!1,globalForm:this.properties.displayAsReadOnly||!1,idCase:"",displayName:this.params.displayName||"",processPath:e.processPath,breadCrumb:e.breadCrumb,orientation:e.orientation});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},triggerGlobalHandler:function(e,t){return this.parent?this.parent.triggerGlobalHandler(e,t):this.observableElement&&this.observableElement.trigger(e,t),this._super(e,t)},configureComplexGateway:function(){var e,t=this,i=t.container;i.length>1?$(i.children()).each((function(){$(this).hasClass(".bz-complex-gateway")&&(e=this)})):e=$(".bz-complex-gateway",i),t.activeTransitions={},$(".bz-checkbox__input",e).on("click",(function(){var e=$(this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),t.activeTransitions[i]=e.is(":checked")||!1}))},getValidationsContainer:function(e){var t=this.getNavigation();if(void 0!==t){var i=this.getViewContainer(),r=void 0!==i?i.view:t.view;if(r&&r.footer)return r.footer}return this._super(this,e)}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.panel",bizagi.rendering.panel.prototype),bizagi.rendering.tablet.panel.extend("bizagi.rendering.tablet.panel",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.contentPanel",bizagi.rendering.contentPanel.prototype),bizagi.rendering.tablet.contentPanel.extend("bizagi.rendering.tablet.contentPanel",{},{}),bizagi.rendering.tablet.panel.extend("bizagi.rendering.tablet.nestedForm",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.tab",bizagi.rendering.tab.prototype),bizagi.rendering.tablet.tab.extend("bizagi.rendering.tablet.tab",{},{postRenderContainer:function(e){var t=this;this._super(e),e.material_bizagi_tabs({direction:this.properties.orientation,active_index_tab:this.activeTab}).on("updateActive",(function(e,i){e.stopPropagation(),t.setActiveTab(i.index)})),$("> .bz-tabs > .bz-tab",e).rippleEffect()}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.tabItem",bizagi.rendering.tabItem.prototype),bizagi.rendering.tablet.tabItem.extend("bizagi.rendering.tablet.tabItem",{},{setAsActiveContainer:function(e){var t=this;$.when(t.ready()).done((function(){var e=$("[data-reference='#ui-bizagi-tab-"+t.properties.id+"']",t.parent.tabs);e.css("display",""),e.click()}))},focus:function(){this.activate(),this.setAsActiveContainer(),this._super()},changeVisibility:function(e){var t=this;t.properties.visible=bizagi.util.parseBoolean(e),$.when(t.ready()).done((function(){var e=$("[data-reference='#ui-bizagi-tab-"+t.properties.id+"']",t.parent.tabs),i=t.parent.container.material_bizagi_tabs("getActiveTab");t.properties.visible?(e.css("display",""),t.properties.counter===i.index?(t.container.css("display",""),t.setAsActiveContainer()):t.container.css("display","none")):(t.container.css("display","none"),e.css("display","none"),i=t.parent.container.material_bizagi_tabs("getActiveTab"),t.properties.counter===i.index?t.parent.container.material_bizagi_tabs("moveToNextTab"):t.parent.container.material_bizagi_tabs("refreshPositions"))}))},afterToRefresh:function(){var e=this;e._super(),$.when(e.ready()).done((function(){e.parent.container.material_bizagi_tabs("refreshTab",e.properties.id)}))}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.horizontal",bizagi.rendering.horizontal.prototype),bizagi.rendering.tablet.horizontal.extend("bizagi.rendering.tablet.horizontal",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.layout",bizagi.rendering.layout.prototype),bizagi.rendering.tablet.layout.extend("bizagi.rendering.tablet.layout",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.accordion",bizagi.rendering.accordion.prototype),bizagi.rendering.tablet.accordion.extend("bizagi.rendering.tablet.accordion",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.accordionItem",bizagi.rendering.accordionItem.prototype),bizagi.rendering.tablet.accordionItem.extend("bizagi.rendering.tablet.accordionItem",{},{setAsActiveContainer:function(e){},focus:function(){this.setAsActiveContainer(),this._super()}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.group",bizagi.rendering.group.prototype),bizagi.rendering.tablet.group.extend("bizagi.rendering.tablet.group",{},{configureHandlers:function(){var e=this;$(">h5.bz-collapsible__header",e.container).bind("click",(function(){$(e.container).toggleClass("bz-collapsible--collapsed")}))},postRenderContainer:function(e){this._super(e),this.properties.collapse&&this.collapse()},isOpen:function(){return!this.container.hasClass("bz-collapsible--collapsed")},focus:function(){this.expand(),this._super()},expand:function(){this.isOpen()||$(">h5.bz-collapsible__header",this.container).trigger("click")},collapse:function(){this.isOpen()&&$(">h5.bz-collapsible__header",this.container).trigger("click")},toogleContainer:function(e){e?this.expand():this.collapse()}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.section",bizagi.rendering.section.prototype),bizagi.rendering.tablet.section.extend("bizagi.rendering.tablet.section",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("section"),i=$.fasttmpl(t,{expandedClassIcon:this.expandedIcon,displayName:e.displayName,editable:e.editable,orientation:e.orientation,uniqueId:e.uniqueId,isDesign:"execution"!==this.getMode(),messageValidation:e.messageValidation,guid:e.guid,displayAs:e.displayAs});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},configureHandlers:function(){var e=this,t=e.getSectionOrientationRTL(e)?"rtl":"ltr";$(e.container).attr("dir",t),e.bind("reopenSection",(function(){e.expand()})),$(">div.bz-section__content",e.container).mobileModal({displayName:e.properties.displayName,displayNameParent:e.getParentDisplayName(),anchor:$(">div.bz-section__header",e.container),dir:t,appendTo:e.container,onBeforeShow:function(t){e.addToHistoryNavigation(),setTimeout((function(){var t=e.getSectionParent(e.parent);$("header[data-role=header]").css({display:"none"}),$("div[data-role=footer] .bz-form-buttons").css({display:"none"}),e.isFirstLevel(!0)||$($("div[data-role=header]",t.container)[0]).css({display:"none"})}),250)},onShow:function(e){},onClose:function(t){t&&t.close(),e.removeFromHistoryNavigation();var i=e.getSectionParent(e.parent);e.isFirstLevel()?($("header[data-role=header]").css({display:"block"}),$("div[data-role=footer] .bz-form-buttons").css({display:"flex"})):$($("div[data-role=header]",i.container)[0]).css({display:"flex"})}})},isFirstLevel:function(e){var t=(this.getFormContainer().getParams()||{}).selectedSection;return void 0===t||(e?t.length<=1:0===t.length)},addToHistoryNavigation:function(){var e=this.getFormContainer(),t=e.getParams()||{};void 0===t.selectedSection&&(e.setParam("selectedSection",[]),t=e.getParams()),t.selectedSection.push(this.properties.id)},removeFromHistoryNavigation:function(){var e=this.getFormContainer().getParams()||{};void 0!==e.selectedSection&&e.selectedSection.pop()},isOpen:function(){return!this.container.hasClass("bz-section--collapsed")},focus:function(){this.expand(),this._super()},expand:function(){$(">div.bz-section__header",this.container).trigger("click")},collapse:function(){this.isOpen()&&$(">div.bz-section__header",this.container).trigger("click")},toogleContainer:function(e){e?this.expand():this.collapse()}}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.searchForm",bizagi.rendering.searchForm.prototype),bizagi.rendering.tablet.searchForm.extend("bizagi.rendering.tablet.searchForm",{},{renderResult:function(){var e=this,t=e.properties,i={};i.properties={displayName:e.getResource("render-search-advanced-results-label"),type:"grid",xpath:"searchForm"+t.id,id:t.id,skipInitialLoad:!0,rowsPerPage:10,visible:!1,sortBy:t.sortBy,sortOrder:t.sortOrder,overrideGetRemoteData:function(t){return e.getRemoteData(t)}},i.elements=[];var r=t.columns;$.each(r,(function(t){var a={render:{}};a.render.properties={displayName:r[t].caption,xpath:r[t].xpath,editable:!1},$.extend(a.render.properties,e.parseAdditionalProperties(r[t].dataType)),0==r[t].dataType&&(a.render.properties.columnVisible=!1),7!=r[t].dataType&&8!=r[t].dataType||(a.render.properties.allowDecimals=r[t].allowDecimals),10!=r[t].dataType&&11!=r[t].dataType||(a.render.properties.allowDecimals=!0),12==r[t].dataType&&(a.render.properties.showTime=r[t].showTime),i.elements.push(a)}));var a=e.renderFactory.getRender({type:"grid",data:i,parent:e,mode:e.getMode()});return a.properties.inlineAdd=!1,a.properties.allowDelete=!1,a.properties.allowAdd=!1,a.properties.allowEdit=!1,e.resultsGrid=a,a.render()},postRenderContainer:function(e){var t=this,i=e.find(".bz-container__search-criteria"),r=e.find(".bz-container__search-results"),a=i.children(),n=t.getMode();t.container=e,$.each(a,(function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var a=t.childrenHash[r];if(a){var n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&a.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&a.postRenderContainer(i)}}}));var o=$(r.children()[0]);t.resultsGrid.postRenderElement(o),"execution"===n&&t.configureHandlers(),"design"===n&&t.configureDesignView(),"layout"===n&&(t.configureDesignView(),t.configureLayoutView())},configureHandlers:function(){var e=this;e.criteriaContainer=$(".bz-container__search-criteria",e.container),e.resultsContainer=$(".bz-container__search-results",e.container),e.resultsGrid.bind("rowSelected",(function(t,i){e.properties.searchParams.hasOwnProperty("multiSelect")?e.trigger("multiSelect",i):e.trigger("instanceSelected",i)}))},refreshResults:function(){this.trigger("instancerefresh"),this.resultsGrid.refresh()},onSearchFinished:function(){this.properties.deviceMaxRecordsExceeded||(this.resultsGrid.changeVisibility(!0),this.properties&&(0==this.properties.records?$(".bz-container__search-results label",this.container).hide():$(".bz-container__search-results label",this.container).show()))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.text",bizagi.rendering.text.prototype),bizagi.rendering.tablet.text.extend("bizagi.rendering.tablet.text",{},{postRender:function(){this._super(),this.properties.maxLength>0&&this.input.attr("maxlength",this.properties.maxLength)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("text-readOnly"),t=this.getValue();null!=t&&(t=bizagi.util.sanitizeHTML(t));var i={value:t||"",editable:this.properties.editable};return $.fasttmpl(e,i)},setDisplayValue:function(e){e=this.validateValue(e,this.properties.maxLength),this.setValue(e,!1),this.properties.editable?this.input.val(e):$(".bz-text-readonly",this.getControl()).html(bizagi.util.sanitizeHTML(e))},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur((function(){var t=$(this);e.retypeDouble(t)}))},retypeDouble:function(e){var t=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===t)return;t!==e.data("oldValue")?(this.setValue(""),this.setValidationMessage(this.getResource("render-text-retype-error")),e.val(""),setTimeout((function(){e.focus()}),100)):e.data("newValue",t),e.data("oldValue",""),e.data("ui-tooltip")&&e.tooltip("destroy")}else{if(""===t||t===e.attr("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".bz-text-readonly",e)},createTooltip:function(e,t,i){this._super(e,t,i),$("body").bind("touchmove",(function(t){$("body").unbind("touchmove"),e.data("ui-tooltip")&&e.tooltip("destroy")}))},setValidationMessage:function(e){this._super(e),this.cloneRender&&this.cloneRender.setValidationMessage(e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.readonly",bizagi.rendering.readonly.prototype),bizagi.rendering.tablet.readonly.extend("bizagi.rendering.tablet.readonly",{},{}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.extendedText",bizagi.rendering.extendedText.prototype),bizagi.rendering.tablet.extendedText.extend("bizagi.rendering.tablet.extendedText",{minLines:2,maxLines:8,maxCharactersToShow:200},{postRender:function(){this._super(),this.textarea=this.getControl().find("textarea"),this.textarea&&this.textarea.css({resize:"vertical"})},initializeData:function(e){this._super(e);var t=this.properties.maxLines;this.properties.maxLines=t>this.Class.maxLines?this.Class.maxLines:t<this.Class.minLines?this.Class.minLines:t,this.isOfflineForm=bizagi.util.isOfflineForm({context:this})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("extendedText-readOnly"),t=this.getValue();t=null!=t?bizagi.util.sanitizeHTML(t):"";var i=this.Class.maxCharactersToShow,r=t.substr(0,i),a=t.substr(i-1,t.length-i),n={value:t,startString:r,endString:a};return $.fasttmpl(e,n)},setDisplayValue:function(e){if(e=bizagi.util.isEmpty(e)||"string"==typeof e?e:e.toString(),e=this.validateValue("string"==typeof e?e:"",this.properties.maxLength),this.setValue(e,!1),this.properties.editable)this.textarea.val(e);else{var t=bizagi.util.encodeHtmlText(this.getDisplayValue());$(".bz-textarea-readonly",this.getControl()).html(t)}},configureHandlers:function(){var e=this;e._super(),e.properties.maxLength>0&&(e.textarea.attr("maxlength",e.properties.maxLength),e.actualMaxLength=e.properties.maxLength),$(e.textarea).bind("focus keyup paste",(function(t){8!==t.which&&46!==t.which||e.textarea.prop("rows")>e.properties.maxLines&&e.textarea.prop("rows",e.properties.maxLines);e.updateTextareaSize(this)})),$(e.textarea).bind("blur",(function(t){e.textarea.prop("rows",e.properties.maxLines)}))},configureHandlersReadOnly:function(){var e=this,t=this.getControl();$(".bz-textarea-readonly",t).on("click",".bz-read-more",(function(t){return $(t.delegateTarget).hasClass("bz-textarea-readonly--active")?($(t.delegateTarget).removeClass("bz-textarea-readonly--active"),$(this).html(e.getResource("workportal-project-discussion-comment-viewmore"))):($(t.delegateTarget).addClass("bz-textarea-readonly--active"),$(this).html(e.getResource("workportal-project-discussion-comment-viewless"))),!1}))},updateTextareaSize:function(e){if(this.properties.autoExtend){var t=$(e).prop("rows");e.scrollHeight>e.offsetHeight&&t>=this.Class.minLines&&t<this.Class.maxLines&&($(e).prop("rows",t+1),this.updateTextareaSize(e))}},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input, textarea",t);i&&0!==i.length&&i.blur((function(){var t=$(this),i=e.previousValue,r=e.value;null!=i&&r!=i&&null!=$(this).data("newValue")&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)}))},retypeDouble:function(e){var t=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===t)return;t!==e.data("oldValue")?(this.setValue(""),this.setValidationMessage(this.getResource("render-text-retype-error")),e.val(""),setTimeout((function(){e.focus()}),100)):e.data("newValue",t),e.data("oldValue",""),e.data("ui-tooltip")&&e.tooltip("destroy")}else{if(""===t||t===e.attr("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},getElementsToStylize:function(e){return this.properties.editable?$("textarea",e):$(".bz-textarea-readonly",e)},createTooltip:function(e,t,i){this._super(e,t,i),$("body").bind("touchmove",(function(t){$("body").unbind("touchmove"),e.data("ui-tooltip")&&e.tooltip("destroy")}))},setValidationMessage:function(e){this._super(e),this.cloneRender&&this.cloneRender.setValidationMessage(e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.label",bizagi.rendering.label.prototype),bizagi.rendering.tablet.label.extend("bizagi.rendering.tablet.label",{},{renderReadOnly:function(){return this.setValue(this.properties.displayName),this._super()},setDisplayValue:function(e){}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.number",bizagi.rendering.number.prototype),bizagi.rendering.tablet.number.extend("bizagi.rendering.tablet.number",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{value:this.getDisplayValue(),editable:this.properties.editable,type:"text",isDesign:"execution"!==this.getMode()})},setDisplayValue:function(e){this.setValue(e,!1),null!=e&&(this.properties.editable?(this.numericInput.val(bizagi.util.numberToFixedString(e)),this.value=this.properties.value=e,this.executeFormatCurrencyPlugin()):$(".bz-input",this.getControl()).val(bizagi.util.numberToFixedString(e)).formatCurrency({symbol:this.properties.symbol,positiveFormat:this.properties.positiveFormat,negativeFormat:this.properties.negativeFormat,decimalSymbol:this.properties.decimalSymbol,digitGroupSymbol:this.properties.digitGroupSymbol,groupDigits:this.properties.groupDigits,roundToDecimalPlace:this.properties.numDecimals,colorize:this.properties.colorize}))},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur((function(){var t=$(this),i=e.previousValue,r=e.value;"grid"===e.parent.properties.type?(null!=i&&r!==i&&void 0!==$(this).data("newValue")&&t.val()!==$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)):e.retypeDouble(t)}))},retypeDouble:function(e){var t=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility")&&null==$(this).data("newValue"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===t)return;t!==e.data("oldValue")?(this.setValue(""),this.createTooltip(e,"",this.getResource("render-text-retype-error"))):(e.data("newValue",t),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""===t||t===e.attr("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},getElementsToStylize:function(e){return $("input",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.money",bizagi.rendering.number.prototype),bizagi.rendering.tablet.money.extend("bizagi.rendering.tablet.money",bizagi.rendering.money.prototype),bizagi.rendering.tablet.money.extend("bizagi.rendering.tablet.money",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{value:this.getDisplayValue(),editable:this.properties.editable,type:"text",isDesign:"execution"!==this.getMode()})},setDisplayValue:function(e){this.setValue(e,!1),null!=e&&(this.properties.editable?(this.numericInput.val(bizagi.util.numberToFixedString(e)),this.value=this.properties.value=e,this.executeFormatCurrencyPlugin()):$(".bz-input",this.getControl()).val(bizagi.util.numberToFixedString(e)).formatCurrency({symbol:this.properties.symbol,positiveFormat:this.properties.positiveFormat,negativeFormat:this.properties.negativeFormat,decimalSymbol:this.properties.decimalSymbol,digitGroupSymbol:this.properties.digitGroupSymbol,groupDigits:this.properties.groupDigits,roundToDecimalPlace:this.properties.numDecimals,colorize:this.properties.colorize}))},getElementsToStylize:function(e){return $("input",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.numberScientificNotation",bizagi.rendering.numberScientificNotation.prototype),bizagi.rendering.tablet.numberScientificNotation.extend("bizagi.rendering.tablet.numberScientificNotation",{},{postRender:function(){var e=this.getControl();this.inputDisplay=$("input",e).first(),this.numericInput=this.input=$("input",e).last(),this.numericInput.numericSN(this.properties.decimalSymbol),this.attachFormatSientificNotation()},setDisplayValue:function(e){var t=this.properties,i=(e=bizagi.util.scientificNotationFormat(e,t.decimalSymbol,38),bizagi.util.scientificNotationFormat(e,t.decimalSymbol,20));this._super(i),null!=e&&t.editable&&(this.numericInput.val(e),this.inputDisplay.val(i))},attachFormatSientificNotation:function(){var e=this;e.inputDisplay.focus((function(){$(this).val(e.getDisplayValue())})),e.inputDisplay.blur((function(){var t=e.getFormContainer();if(void 0===t.validationController){var i=t.getValidationsContainer();t.validationController=new bizagi.command.controllers.validation(t,e.validations,i)}var r=bizagi.util.scientificNotationFormat(e.inputDisplay.val(),e.properties.decimalSymbol,38),a=bizagi.util.scientificNotationFormat(e.inputDisplay.val(),e.properties.decimalSymbol,20);e.numericInput.val(r),e.inputDisplay.val(a),e.setValue(r)}))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.date",bizagi.rendering.date.prototype),bizagi.rendering.tablet.date.extend("bizagi.rendering.tablet.date",{MAX_YEARS_DISPLAY:100},{initializeData:function(e){this._super(e)},renderReadOnly:function(){var e=this.properties,t=e.dateFormat,i=bizagi.util.dateFormatter,r=t.substring(0,-1!=t.search("h|H")?t.search("h|H")-1:t.length),a=i.formatDate(i.getDateFromFormat(this.getValue(),r,this.i18n),e.fullFormat),n={value:"execution"!==this.getMode()?e.fullFormat:a,editable:e.editable},o=this.renderFactory.getTemplate("readonly");return $.fasttmpl(o,n)},postRenderReadOnly:function(){this.input=$("input",this.getDateControl())},configureHandlers:function(){var e=this,t=e.getControl(),i=$(".bz-input-icon",t);e.configureMobiscollCalendar(),e.calendarInstance=i.mobiscroll("getInst"),i.on("focus",(function(t){t.preventDefault(),t.stopPropagation(),bizagi.util.isCordovaSupported()&&bizagi.util.isAndroidDevice()&&(cordova.plugins.Keyboard.disableScroll(!0),cordova.plugins.Keyboard.close()),e.calendarInstance.show()})),i.attr("keyboard","disable")},configureMobiscollCalendar:function(){var e=this,t=e.properties,i=t.showTime?["calendar","time"]:["calendar"],r=e.getControl(),a=$(".bz-input-icon",r),n=e.getOrientation();a.mobiscroll().calendar({mode:"mixed",touchUi:!0,display:"bottom",controls:i,min:e.getNormalizeDate(new Date(t.minValue)),max:e.getNormalizeDate(new Date(t.maxValue)),defaultValue:e.getDisplayValue(),timeFormat:t.timePickerFormat?e.getTimeFormat(t.timePickerFormat):"",dateFormat:t.datePickerFormat,dateWheels:"dd/MM/yyyy",select:"single",selectType:"Day",rtl:n&&"rtl"===n,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||bizagi.localization.language||"en",buttons:e.properties.showTime?[{text:e.getResource("render-timeentry-now"),handler:function(){e.setValueFromCalendarButtons(new Date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))}},{text:e.getResource("render-plugin-search-users-select-link"),handler:"set"},{text:e.getResource("render-plugin-search-users-clear-button-name"),handler:function(e,t){t.clear()}}]:[{text:e.getResource("render-timeentry-now"),handler:function(){e.setValueFromCalendarButtons(new Date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))}},{text:e.getResource("render-plugin-search-users-clear-button-name"),handler:function(e,t){t.clear()}}],onSet:function(){e.onChangeHandler()},onDayChange:function(t){e.setValueFromCalendarButtons(t.date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.properties.showTime||e.getCalendarInstance().hide()}))},onClear:function(){e.setValueFromCalendarButtons(null,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))},onBeforeShow:function(i,r){e.triggerGlobalHandler("modalViewDidAppear",{}),r.option({max:bizagi.util.dateFormatter.getDateFromInvariant(t.maxValue,t.showTime),min:bizagi.util.dateFormatter.getDateFromInvariant(t.minValue,t.showTime)}),bizagi.util.isiOSDevice()&&$(".ui-bizagi-notifications-container").css("display","none")},onClose:function(t,i){e.triggerGlobalHandler("modalViewDidDisappear",{}),$(".mbsc-fr-scroll").css("overflow-y","auto")},onShow:function(e,t){$(".mbsc-fr-scroll").css("overflow-y","hidden")}})},getDateControl:function(){return $(".bz-input-icon",this.getControl())},onChangeHandler:function(e){var t=this.properties,i=this.getNormalizeDate(this.getCalendarInstance().getVal()),r="",a=bizagi.util.dateFormatter;if(i&&0!=i){var n=this.value;1==e?(i=this.getNormalizeDate(new Date),r=a.formatDate(i,"MM/dd/yyyy HH:mm:ss"),this.value=r):this.value=a.formatInvariant(i,t.showTime),(e||i)&&(this.value=n,r=a.formatDate(i,"MM/dd/yyyy HH:mm:ss"),this.setValue(r),this.setDisplayValue(r))}},getFullFormatedDate:function(e,t){var i="";i=e.length>0?e:void 0!==e?bizagi.util.dateFormatter.formatISO(e,!1):bizagi.util.dateFormatter.formatISO(new Date,!1),i+=t;var r=bizagi.util.dateFormatter.getDateFromFormat(i,"yyyy-MM-dd H:m");return bizagi.util.dateFormatter.formatDate(0!==r?r:e,"yyyy-MM-dd H:mm:ss")},preprocessDateValue:function(e){return bizagi.util.dateFormatter.formatDate(e,this.properties.fullFormat)},isValid:function(e){var t=this.properties,i=!0,r=this.getValue();return r&&bizagi.util.parseBoolean(t.editable)&&0!=(r=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromInvariant(r)))&&(t.minValue&&"string"==typeof t.minValue&&(i=!this.checkMinAndMaxValue(r,!0,t,e)&&i),t.maxValue&&"string"==typeof t.maxValue&&(i=!this.checkMinAndMaxValue(r,!1,t,e)&&i)),bizagi.util.parseBoolean(t.editable)&&t.required&&!this.hasValue()&&this.showMandatoryMessage(t,e),i&&this.setValidationMessage(""),i},checkMinAndMaxValue:function(e,t,i,r){var a=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromInvariant(t?i.minValue:i.maxValue));if(0==a){var n="";-1==i.timeFormat.indexOf(":ss")&&(n=t?i.minValue+":00":i.maxValue+":00"),a=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromFormat(n,i.fullFormat+":ss"))}if(t&&e.getTime()<a.getTime()||!t&&e.getTime()>a.getTime()){var o=bizagi.util.dateFormatter.formatDate(a,i.fullFormat),s="";return s=t?this.getResource("render-date-minimum-validation").replaceAll("#label#",i.displayName).replaceAll("#minValue#",o):this.getResource("render-date-maximum-validation").replaceAll("#label#",i.displayName).replaceAll("#maxValue#",o),r.push({xpath:i.xpath,message:s}),!0}return!1},showMandatoryMessage:function(e,t){var i=this.getResource("render-required-text").replaceAll("#label#",e.displayName);return t.push({xpath:e.xpath,message:i}),!1},setHour:function(e){return e.replace(/\s(\d:)/," 0$1")},clearDisplayValue:function(){this.date=void 0,this.time=void 0,this.timeS=void 0,this.setValue(""),this.setDisplayValue("")},isValidMinMaxValue:function(){var e=!0,t=this.getValue();return t&&0!==(t=bizagi.util.dateFormatter.getDateFromInvariant(t))&&(this.properties.minValue&&"string"==typeof this.properties.minValue&&(e=this.validateMinAndMaxValue(t,!0)),this.properties.maxValue&&"string"==typeof this.properties.maxValue&&(e=this.validateMinAndMaxValue(t,!1))),e},validateMinAndMaxValue:function(e,t){var i=t?this.properties.minValue:this.properties.maxValue,r=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromInvariant(i));return!(t&&e.getTime()<r.getTime()||!t&&e.getTime()>r.getTime())},getElementsToStylize:function(e){return $("input, .bz-input--readonly",e)},getCalendarInstance:function(){return this.calendarInstance||(this.calendarInstance=$(this.getDateControl()).mobiscroll("getInst"))},setDisplayValue:function(e){if("execution"===this.getMode()){var t=this.properties,i=this.getControl(),r=$(".bz-input-icon__input, .bz-input--readonly",i),a=bizagi.util.dateFormatter;bizagi.util.isNumeric(e)&&0!==e&&(e=a.formatInvariant(new Date(e),t.showTime)),e&&(e="string"==typeof e?this.getNormalizeDate(a.getDateFromInvariant(e,t.showTime)):this.getNormalizeDate(e));var n=this.getCalendarInstance();t.editable&&n.setVal&&n.setVal(e),this.setValue(a.formatInvariant(e,!0)),t.displayValue=a.formatDate(e,t.fullFormat,this.i18n),"string"!=typeof t.displayValue&&"number"!=typeof t.displayValue||(r.prop("value",t.displayValue),r.prop("title",t.displayValue)),t.editable||r.html(t.displayValue)}},setValueFromCalendarButtons:function(e,t){this._super(e),"function"==typeof t&&t(e),this.onChangeHandler()}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.yesno",bizagi.rendering.yesno.prototype),bizagi.rendering.tablet.yesno.extend("bizagi.rendering.tablet.yesno",{},{postRender:function(){var e=this.getControl();this.radio=e.find("input[type=radio]"),!this.properties.editable||null!=this.value&&void 0!==this.value||null==this.properties.value||(this.value=this.properties.value)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.radio=e.find("input"),this._super()},setDisplayValue:function(e){var t=this.getControl(),i=bizagi.util.parseBoolean(e);this.setValue(i,!1),this.properties.editable?i?(t.find("input[value=true]").prop("checked",!0),t.find("input[value=false]").prop("checked",!1)):(t.find("input[value=false]").prop("checked",!0),t.find("input[value=true]").prop("checked",!1)):this.radio.val(this.getDisplayValue())},configureHandlers:function(){var e=this;e.radio.change((function(){var t=$(this).prop("value");e.value!==t&&e.setValue(t)}))},getElementsToStylize:function(e){return $("label.bz-radio__label",e)},cleanData:function(){this.setValue(null,!1),this.clearDisplayValue()},clearDisplayValue:function(){this.properties.editable?this.radio.prop("checked",!1):this.radio.val(this.getDisplayValue())}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.check",bizagi.rendering.check.prototype),bizagi.rendering.tablet.check.extend("bizagi.rendering.tablet.check",{},{postRender:function(){var e=this.getControl();this.check=e.find("input"),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.check=e.find("input"),this._super()},setDisplayValue:function(e){var t=bizagi.util.parseBoolean(e);this.setValue(t,!1),this.properties.editable?t?this.check.attr("checked","checked"):this.check.removeAttr("checked"):this.check.val(this.getDisplayValue())},configureHandlers:function(){var e=this;this.check.on("click",(function(t){var i=$(this).is(":checked");e.setValue(i,!0)}))},cleanData:function(){this.setDisplayValue(!1),this.setValue(!1,!1)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.combo",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.combo.extend("bizagi.rendering.tablet.combo",{renderControl:function(){var e=this.renderFactory.getTemplate("combo");return $.fasttmpl(e,{editable:this.properties.editable,value:this.getDisplayValue()})},getDisplayValue:function(){var e="",t=this.getValue();return this.combo&&this.combo.length>0&&(t=this.getSelectedValue()),t&&(e=this.formatItem(t.value)),e},postRender:function(){var e=this.getControl();this._super(),this.combo=e.find("input"),this.itemSelected=void 0},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.combo=e.find("input")},configureHandlers:function(){var e=this,t=e.getControl();"execution"===e.getMode()&&$(".bz-form-combo",t).bind("click",(function(){$(this).mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{hideSearch:!1===e.properties.enableTyping}),displayName:e.properties.displayName||"",orientation:e.properties.orientation||"",contentTemplate:"",style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},open:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){var i={};if(e.isDependant&&e.properties&&/cascadingcombo/i.test(e.properties.type)&&e.getParentCombo){var r=e.getParentCombo().getValue();r&&r.id&&(i[e.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=r.id)}$.when(e.renderCombo(i)).done((function(i){$(".bz-modal-view__content",t.content).html(i),e.configureModalViewHandlers(t)}))}})}))},processComboData:function(e){var t=this;e.forEach((function(e){t.validateValue(e)}))},setDisplayValue:function(e){var t="";if(e=this.mapValue(e),(e=this.preprocessValue(e))&&"object"===_typeof(e)&&void 0!==e.label){if(bizagi.util.isEmpty(e.label)){var i=this.findDataValueById(e.id);t=i?i.value:""}else t=e.label;$.isArray(t)&&(t=t.join(" - ")),e={id:e.id,value:t}}if(this.properties.editable)this.combo.val(this.formatItem(e.value));else{var r=this.getControl();$(".bz-input",r).html(this.formatItem(e.value))}this.selectedValue=e,this.setValue(e)},configureModalViewHandlers:function(e){var t=this;if($(".bz-list__item",e.content).on("click",(function(){var i={id:$(this).data("value"),value:$(this).text()};""==i.id&&(i.value=""),t.itemSelected=!0,t.setDisplayValue(i),t.trigger("select",[i,!1]),e.close()})),$("[data-action=close]",e.header).bind("click",(function(){e.close()})),this.properties.enableTyping){var i=$(".bz-list li",e.content),r=$(".bz-modal-view__clear",e.header),a=$(".bz-modal-view__search",e.header);r.bind("click",(function(){a.val("").trigger("change")})),a.on("change keyup",(function(){""==this.value?r.removeClass("bz-modal-view__clear--visible"):r.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)})).on("focus",(function(){e.header.addClass("bz-modal-view__header--active")})).on("blur",(function(){e.header.removeClass("bz-modal-view__header--active")}))}},cleanData:function(){var e={id:"",value:""};this.value=this.properties.value=this.selectedValue=e;var t=this.getControl();$("input",t).val(this.formatItem(e.value))},filterList:function(e,t){t.filter((function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()})).show()},renderComboTemplate:function(e){var t=this.renderFactory.getTemplate("combo-list"),i=this.getValue();return i=null!=i?i:{id:"",value:""},$.fasttmpl(t,{items:e,selectedId:i.id,hasItems:e.length>0},{validateItem:this.validateValue})},getSelectedValue:function(){return this.selectedValue}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.upload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.upload.prototype),bizagi.rendering.tablet.upload.extend("bizagi.rendering.tablet.upload",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{isNative:!1,isOfflineForm:!1,initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported()},renderControl:function(){var e=this.renderFactory.getTemplate("upload");return this.renderItem(e,{})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("upload-readonly"),t={noFiles:0===this.filesCount};return this.renderItem(e,t)},renderItem:function(e,t){for(var i="",r=$.fasttmpl(e,t),a=0;a<this.filesCount;a++){var n={id:this.files[a][0],fileName:this.files[a][1]};i+=this.renderUploadItem(n)}return r=this.replaceFilesHtml(r,i)},postRender:function(){var e=this.getControl();this.$contentFile=$(".bz-file-upload__container",e),this.$inputFile=$(".bz-file-upload__input",e),this.$nativeFile=$(".bz-file-upload__native",e)},configureHandlers:function(){this.checkFileExtensions(),this.attachEvents()},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-readonly-lists",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()}))}))},attachEvents:function(){var e=this,t=e.getControl(),i=0;if(this.$contentFile.off("click").on("click",(function(t){!e.isNative||i>0?e.chooseFile():bizagi.showMessageBox(bizagi.localization.getResource("render-upload-error-files-extension-supported-app","You can only add images or videos."),"Userfield error")})),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()}))})),$("ul.bz-files",t).on("click",".bz-file .bz-icn",(function(){var t=$(this).parent(".bz-file"),i=t.data();e.removeFile(t,i.id)})),e.isNative){var r=e.getUploadChoices();i=r.length,this.$nativeFile.off("click").actionSheet({actions:r,actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-file-upload__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.handlerResolutionUpload(t.guid)).always((function(){bizagi.loading.stop()}))},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})}else this.$inputFile.off("change").on("change",(function(){e.addFile(),this.value=""})),this.$inputFile.off("click").on("click",(function(e){e.stopPropagation()}))},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture((function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then((function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i)){bizagi.util.getAndroidVersion();if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then((function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.handlerResolutionUpload(e)}));$(".bz-file-upload__resolution",t.getControl()).click()}}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,correctOrientation:!0});break;case 1:navigator.camera.getPicture((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then((function(i){return t.fileProperties=i,t.saveImage(e)}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;case 3:navigator.device.capture.captureVideo((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).then((function(){return t.saveVideo(e)})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{limit:t.Class.LIMIT})}},handlerResolutionUpload:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.saveImage(t.dataImage);var r=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,r)).then((function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.saveImage(t.dataImage)}))},saveImage:function(e){var t="";this.editedImageURL?t=this.editedImageURL:this.fileProperties&&(t=this.fileProperties.url);var i={dataFile:bizagi.util.media.getImagePath(t),fileName:this.fileProperties.name,mimeType:"image/jpeg"};return this.editedImageURL=null,this.fileProperties=null,this.uploadFile(i)},saveVideo:function(e){var t={dataFile:e[0].fullPath,fileName:e[0].name,mimeType:"video/quicktime"};return this.uploadFile(t)},uploadFile:function(e){var t=this,i={},r=t.buildAddParams();return r.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),i.data=r,i.options=new FileUploadOptions,i.options.fileKey="file",i.options.fileName=e.fileName,i.options.uploadKey={key:r.h_xpath},i.options.addUrl=t.properties.addUrl,i.dataFile=e.dataFile,e.mimeType&&(i.options.mimeType=e.mimeType),$.when(bizagi.util.media.uploadFile(i)).then((function(e){var i=JSON.parse(decodeURIComponent(e.response));"error"===i.type?bizagi.showMessageBox(i.message,i.errorType):t.onUploadFileCompleted(i)})).fail((function(e){t.executeFormFailHandler(e)}))},onFail:function(e){var t=bizagi.util.processFailMessage(e);if(bizagi.loading.stop(),t&&"string"==typeof t&&-1!==t.indexOf("No Activity found to handle Intent")){var i=bizagi.util.isValidResource("render-upload-error-media-app")?bizagi.localization.getResource("render-upload-error-media-app"):"Your device does not have an app to execute this action.";bizagi.showMessageBox(i)}},onUploadFileCompleted:function(e){var t=$(".bz-files",this.getControl());if(e.id&&e.fileName){var i=this.renderUploadItem(e);t.append(i),this.filesCount=this.filesCount+1;var r=this.files.slice();r.push([e.id,e.fileName]),this.setValue(r,!0),this.checkMaxFiles(),this.editedImageURL=null}else bizagi.showMessageBox(e.message,"Error")},checkMaxFiles:function(){this.isMaxFilesReached()?$(this.$contentFile).addClass("bz-file-upload__container--hidden"):$(this.$contentFile).removeClass("bz-file-upload__container--hidden")},isMaxFilesReached:function(){var e=this.properties.maxfiles,t=this.properties.value?this.properties.value.length:0;return 0!==e&&this.filesCount>=e&&t>=e},checkFileExtensions:function(){var e=this.properties.validExtensions||"";if(this.validOptions={video:!1,image:!1,file:!1},void 0===(e=e.replace(/\s+/g,"").toLowerCase())||""===e)this.validOptions={video:!0,image:!0,file:!0};else if(1===(e=e.split(";")).length&&-1!==e[0].indexOf("*.*"))this.validOptions.video=!0,this.validOptions.image=!0;else for(var t=0,i=e.length;t<i;t++)e[t]=e[t].replace("*.",""),this.Class.EXTENSIONSFILE.toString().indexOf(e[t])>=0?this.validOptions.file=!0:this.Class.EXTENSIONSIMG.toString().indexOf(e[t])>=0?this.validOptions.image=!0:this.Class.EXTENSIONSVIDEO.toString().indexOf(e[t])>=0&&(this.validOptions.video=!0);this.validOptions.file||this.validOptions.image||this.validOptions.video||$(this.$contentFile).addClass("bz-file-upload__container--hidden"),!this.isMaxFilesReached()&&(this.isNative||bizagi.util.media.fileAPISupported()&&!this.isOfflineForm)||$(this.$contentFile).addClass("bz-file-upload__container--hidden")},buildAddFileParams:function(e){var t=this.Class.BA_CONTEXT_PARAMETER_PREFIX,i=new FormData,r=this.getFormContainer();i.append(t+"xpath",this.getUploadXpath()),i.append(t+"idRender",this.properties.id),i.append(t+"xpathContext",this.properties.xpathContext),i.append(t+this.Class.BA_PAGE_CACHE,this.properties.idPageCache),i.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId),i.append(this.properties.xpath,e),this.properties.contexttype&&i.append(t+"contexttype",this.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?i.append(BIZAGI_SESSION_NAME,r.properties.sessionId):i.append("JSESSIONID",r.properties.sessionId)}catch(e){i.append("JSESSIONID",r.properties.sessionId)}return i},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},cleanData:function(){return this.clearDisplayValue()},clearDisplayValue:function(){var e=this,t=$(".bz-files",e.getControl()),i=[];return $(".bz-file",t).each((function(t,r){var a=(r=$(r)).data();i.push($.when(e.removeFile(r,a.id)))})),$.when.apply($,i).then((function(){return e.getValue()}))},getUploadChoices:function(){var e=[];return this.validOptions.image&&(e.push({guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}),e.push({guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")})),this.validOptions.video&&e.push({guid:3,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-video")}),[].concat(e)},executeFormFailHandler:function(e){var t="";t=e&&e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error"),this.getFormContainer().failHandler(t)},chooseFile:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&!this.isOfflineForm&&this.$inputFile.click()},addFile:function(){var e=this,t=this.$inputFile[0].files[0],i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSFILE,e.Class.EXTENSIONSVIDEO);t.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.processUploadFile(t)).then((function(t){e.onUploadFileCompleted(JSON.parse(decodeURIComponent(t)))})).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()})):bizagi.loading.stop()},removeFile:function(e,t){var i=this;return $.when(i.deleteUploadItem(e,t)).done((function(){e.hide(),e.remove(),i.setValue(i.files,!1),i.checkMaxFiles(),i.triggerRenderChange()}))},getTemplateItemName:function(){return"upload-item"},getElementsToStylize:function(e){return $(".bz-input-icon__input",e)}}),bizagi.rendering.tablet.upload.extend("bizagi.rendering.tablet.upload.offline",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{initializeData:function(e){this._super(e);var t=Number(this.properties.maxSize)||1048576,i="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=t<i?t:i,this.updateFilesCount(),this.updateOriginalValue()},updateOriginalValue:function(){this.properties.originalValue=bizagi.clone(this.properties.value)},renderItem:function(e,t){for(var i="",r=$.fasttmpl(e,t),a=0;a<this.files.length;a++){var n=this.files[a];if(n.status&&"deleted"!==n.status&&"new-deleted"!==n.status)i+=this.renderUploadItem(n,a)}return r=this.replaceFilesHtml(r,i)},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-files",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file");e.openOfflineFile(t)}))},attachEvents:function(){var e=this,t=e.getControl();this.$contentFile.off("click").on("click",(function(t){e.isNative?e.$nativeFile.click():e.$inputFile.click(),e.$inputFile.off("change").on("change",(function(){e.handlerWebUploadFile()}))})),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file");e.openOfflineFile(t)})),$("ul.bz-files",t).on("click",".bz-file .bz-icn",(function(){var t=$(this).parent(".bz-file");e.removeOfflineFile(t)})),e.isNative&&e.attachNativeEvents()},attachNativeEvents:function(){var e=this;this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})}})},handlerWebUploadFile:function(){var e,t,i=this,r=i.$inputFile[0].files[0],a=bizagi.util.randomNumber();if(i.$inputFile[0].value="",bizagi.util.media.checkMaxSizeFile(r,i.properties))return i.dataService.getFileService().resolveBlobFromPath(r).then((function(r){return bizagi.loading.start(),t=r.type,e=r.name,i.saveOfflineFile(r,a,t)})).then((function(){i.onUploadOfflineFileCompleted(e,t,a)})).always((function(){bizagi.loading.stop()}))},handlerUploadFile:function(e){switch(e||0){case 2:this.choosePhoto();break;case 1:this.takePhoto();break;default:console.log("The option is not supported!")}},choosePhoto:function(){var e=this;navigator.camera.getPicture((function(t){e.dataImage=t;var i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(t,e.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(e.dataImage)).then((function(t){if(e.fileProperties=t,bizagi.util.media.checkFileTypes(t,e.properties,i))return e.saveImage(e.dataImage)}))})).always((function(){bizagi.loading.stop()}))}),e.onFail.bind(e),{quality:e.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,correctOrientation:!0})},takePhoto:function(){var e=this;navigator.camera.getPicture((function(t){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(t,e.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(t)).then((function(i){return e.fileProperties=i,e.saveImage(t)}))})).always((function(){bizagi.loading.stop()}))}),e.onFail.bind(e),{quality:e.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960})},addInteractions:function(){var e=this,t=e.getControl();$("ul.bz-files",t).on("click",".bz-file .bz-file__delete",(function(){var t=$(this).parent(".bz-file");e.removeOfflineFile(t)}))},collectData:function(e){bizagi.util.identicalObjects(this.properties.originalValue,this.files)||(e[this.properties.xpath]=this.files)},saveImage:function(e){var t=this;bizagi.loading.start();var i,r=bizagi.util.randomNumber(),a=t.fileProperties.name;$.when(t.dataService.getFileService().resolveBlobFromPath(e,a)).always((function(){bizagi.loading.stop()})).then((function(e){return i=e.type,a=e.name,t.saveOfflineFile(e,r,i)})).then((function(e){t.onUploadOfflineFileCompleted(a,i,r)})),t.$inputFile[0].value=""},checkFileExtensions:function(){var e=this.properties.validExtensions||"";if(this.validOptions={video:!1,image:!1,file:!1},void 0===(e=e.replace(/\s+/g,"").toLowerCase())||""===e)this.validOptions.image=!0;else if(1===(e=e.split(";")).length&&-1!==e[0].indexOf("*.*"))this.validOptions.image=!0;else for(var t=0,i=e.length;t<i;t++)e[t]=e[t].replace("*.",""),this.Class.EXTENSIONSIMG.toString().indexOf(e[t])>=0&&(this.validOptions.image=!0);this.validOptions.image||$(this.$contentFile).addClass("bz-file-upload__container--hidden"),!this.isMaxFilesReached()&&bizagi.util.media.fileAPISupported()||$(this.$contentFile).addClass("bz-file-upload__container--hidden")},onUploadOfflineFileCompleted:function(e,t,i){var r=$(".bz-files",this.getControl()),a={id:i,fileName:e,mimeType:t,status:"new"},n=this.renderUploadItem(a,this.files.length);r.append(n),this.filesCount=this.filesCount+1;var o=this.files.slice();o.push(a),this.setValue(o,!1),this.checkMaxFiles(),this.triggerRenderChange()},renderUploadItem:function(e,t){var i=this.getTemplateItemName(),r=this.renderFactory.getTemplate(i);return $.fasttmpl(r,{url:"javascript:void(0);",id:e.id,allowDelete:this.properties.allowDelete||!1,filename:e.fileName,index:t})},canBeSent:function(){return!0},failReadFile:function(e){try{bizagi.log("Error code: "+e.target.error.code)}catch(e){}},onFail:function(e){this._super(e)},removeOfflineFile:function(e){var t=e.data().index,i=this.files[t];i&&("new"!==i.status?i.status="deleted":i.status="new-deleted",e.hide(),e.remove(),this.setValue(this.files,!1),this.checkMaxFiles(),this.triggerRenderChange())},updateFilesCount:function(){for(var e=this.properties.value||[],t=0;t<e.length;t++){var i=e[t].status;i&&i.includes("deleted")&&(this.filesCount=this.filesCount-1)}},setValue:function(e,t){this._super(e,t),this.updateFilesCount(),0===this.filesCount&&(this.properties.method="delete")},isMaxFilesReached:function(){var e=this.properties.maxfiles;return 0!==e&&this.filesCount>=e},openOfflineFile:function(e){var t=e.data(),i=t.index,r="number"==typeof i?this.properties.value[i]:null;if(r){var a=this.getFormParams(),n={idCase:a.idCase,idWorkitem:a.idWorkitem,id:(this.properties.xpathContext?this.properties.xpathContext+".":"")+this.properties.xpath+"."+r.id,offlineType:a.offlineType};bizagi.loading.start(),$.when(this.dataService.getOfflineFile(n,"blob",r.mimeType)).then((function(e){if(null!=e){var i=t.title,r=i||"downloaded.jpg";bizagi.util.isAndroidDevice()?bizagi.util.media.handleBinaryFile(e,i,r):bizagi.util.media.handleBinaryFile(e,i)}})).fail((function(e){console.log("Error opening offline file",e)})).always((function(){bizagi.loading.stop()}))}},saveOfflineFile:function(e,t,i){var r=this.getFormParams(),a={idCase:r.idCase,idWorkitem:r.idWorkitem,id:(this.properties.xpathContext?this.properties.xpathContext+".":"")+this.properties.xpath+"."+t,operationType:"edition",offlineType:r.offlineType};return this.dataService.saveOfflineFile(a,e,i)}}),bizagi.rendering.tablet.upload.extend("bizagi.rendering.tablet.upload.offline.old",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{initializeData:function(e){this._super(e);var t=Number(this.properties.maxSize)||1048576,i="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=t<i?t:i},renderItem:function(e,t){for(var i="",r=$.fasttmpl(e,t),a=0;a<this.filesCount;a++){i+=this.renderUploadItem(this.files[a],a)}return r=this.replaceFilesHtml(r,i)},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-files",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file");e.openOfflineFile(t)}))},attachEvents:function(){var e=this,t=e.getControl();this.$contentFile.off("click").on("click",(function(t){e.$nativeFile.click()})),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file");e.openOfflineFile(t)})),$("ul.bz-files",t).on("click",".bz-file .bz-icn",(function(){var t=$(this).parent(".bz-file");e.removeOfflineFile(t)})),e.isNative&&this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture((function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then((function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i))return t.saveImage(t.dataImage)}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY});break;case 1:navigator.camera.getPicture((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then((function(i){return t.fileProperties=i,t.saveImage(e)}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;default:bizagi.log("The option is not supported!")}},addInteractions:function(){var e=this,t=e.getControl();$("ul.bz-files",t).on("click",".bz-file .bz-file__delete",(function(){$(this);var t=$(this).parent(".bz-file"),i=t.data(),r=t.index();e.filesCount=e.filesCount-1,0===e.filesCount&&(e.properties.method="delete"),e.files=$.grep(e.files,(function(e,t){return t!==r&&e!==i.name})),t.hide(),t.remove(),e.setValue(e.files,!1),e.checkMaxFiles(),e.triggerRenderChange()}))},collectData:function(e){this.filesCount>0?e[this.properties.xpath]=this.files:"delete"===this.properties.method&&(e[this.properties.xpath]=[],delete this.properties.method)},saveImage:function(e){var t=this;e=bizagi.util.media.getImagePath(e),t.getDataUri(e,(function(e){var i=t.fileProperties?t.fileProperties.extension:"",r=bizagi.util.uniqueID()+i;t.onUploadOfflineFileCompleted(r,e)}))},checkFileExtensions:function(){var e=this.properties.validExtensions||"";if(this.validOptions={video:!1,image:!1,file:!1},void 0===(e=e.replace(/\s+/g,"").toLowerCase())||""===e)this.validOptions.image=!0;else if(1===(e=e.split(";")).length&&-1!==e[0].indexOf("*.*"))this.validOptions.image=!0;else for(var t=0,i=e.length;t<i;t++)e[t]=e[t].replace("*.",""),this.Class.EXTENSIONSIMG.toString().indexOf(e[t])>=0&&(this.validOptions.image=!0);this.validOptions.image||$(this.$contentFile).addClass("bz-file-upload__container--hidden"),!this.isMaxFilesReached()&&(this.isNative||bizagi.util.media.fileAPISupported()&&!this.isOfflineForm)||$(this.$contentFile).addClass("bz-file-upload__container--hidden")},onUploadOfflineFileCompleted:function(e,t){var i=$(".bz-files",this.getControl()),r=t.replace(/^data:.*;base64,/,""),a=t.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/),n=[{xpath:"fileName",DataType:"15",value:e},{xpath:"data",DataType:"19",value:r},{xpath:"mimeType",DataType:"15",value:a=a&&a.length?a[1]:"image/jpeg"}],o=this.renderUploadItem(n,this.filesCount);i.append(o),this.filesCount=this.filesCount+1;var s=this.files.slice();s.push(n),this.setValue(s,!1),this.checkMaxFiles()},renderUploadItem:function(e,t){var i=this.getTemplateItemName(),r=this.renderFactory.getTemplate(i);return $.fasttmpl(r,{url:"javascript:void(0);",id:bizagi.util.randomNumber(),allowDelete:this.properties.allowDelete||!1,filename:e[0].value,index:t})},canBeSent:function(){return!0},failReadFile:function(e){try{bizagi.log("Error code: "+e.target.error.code)}catch(e){}},onFail:function(e){this._super(e)},getDataUri:function(e,t){var i=new XMLHttpRequest;try{i.onload=function(){var e=new FileReader;e.onloadend=function(){var i=e.result;t(i)},e.readAsDataURL(i.response)},i.open("GET",e),i.responseType="blob",i.send()}catch(e){t("")}},removeOfflineFile:function(e){var t=e.data(),i=e.index();this.filesCount=this.filesCount-1,0===this.filesCount&&(this.properties.method="delete"),this.files=$.grep(this.files,(function(e,r){return r!==i&&e!==t.name})),e.hide(),e.remove(),this.setValue(this.files,!1),this.checkMaxFiles(),this.triggerRenderChange()},openOfflineFile:function(e){var t=this,i=e.data(),r=i.index,a="number"==typeof r?t.properties.value[r]:null;if(a){var n=a[1]?a[1].value:"",o=a[2]?a[2].value:"image/jpeg";bizagi.loading.start(),$.when(bizagi.util.media.openOfflineFile(n,o,i.title)).fail((function(e){bizagi.showMessageBox(t.getResource("workportal-widget-admin-language-error"))})).always((function(){bizagi.loading.stop()}))}}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.grid",bizagi.rendering.grid.prototype),bizagi.rendering.tablet.grid.extend("bizagi.rendering.tablet.grid",{GRID_PAGE_SIZE:10},{MIN_SUPPORTED_WIDTHS:{LIST:[{minimum:28,appliesTo:["label","readonly","checkboxBoolean"]},{minimum:42,appliesTo:["text","formlink","money","number","button","link"]},{minimum:66,appliesTo:["boolean","radio"]},{minimum:74,appliesTo:["combo","date","list","search","suggest","userfield","image","upload","uploadecm","document"]},{minimum:132,appliesTo:["horizontalRadio"]}],get:function(e){var t=this.LIST.find((function(t,i){return t.appliesTo.includes(e)}));return t&&t.minimum||42}},init:function(e){e.data.properties.singleInstance=!1,this._super(e),this.cellMetadata={},this.isOfflineForm=bizagi.util.isOfflineForm({context:this});var t=this.properties,i=this.getFormContainer();this.properties.helpText&&null!=this.properties.helpText&&""!=this.properties.helpText?t.displayType="value":t.displayType="vertical",t.labelAlign="left",(t.groupBy||t.groupSummary)&&i.addWarning(this.getResource("render-tablet-warning-grid"))},initializeData:function(e){e.properties.singleInstance=!1,this._super(e),this.pendingActions=[]},initAddAndDeleteProperties:function(e,t,i,r){return"groupedgrid"==this.properties.type&&(i=null!=bizagi.util.parseBoolean(i)&&bizagi.util.parseBoolean(i)),this._super(e,t,i,r)},updateAffectedCellManually:function(){},getRowIndexByKey:function(){},postRender:function(){var e=this,t=e.properties,i=e.getControl();for(var r in e.initialLoadDone=!1,e._super(),e.grid=$(">div",i),e.getLabel().hide(),e.applyGridPlugin(),t.data&&(""===t.data||0===t.data.rows.length&&t.data.page>1?e.fetchData(void 0,e.sortBy,e.sortType):(e.updateData(t.data),$.when(e.ready()).done((function(){e.triggerRenderChange({changed:!1})})))),e.initialLoadDone=!0,e.pendingActions)e.pendingActions.hasOwnProperty(r)&&e.pendingActions[r].method.apply(e,e.pendingActions[r].arguments)},applyGridPlugin:function(){var e=this,t=e.properties,i=e.getMode(),r=e.grid,a=e.buildColumnModel(),n=(a||[]).filter((function(e){return e.summarizeBy}));r.bizagi_grid_tablet({columns:a,subType:t.subType||r,title:t.displayName,isOfflineForm:e.isOfflineForm||!1,mode:i,isSortable:t.isSortable,sortBy:t.sortBy||"",template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),buttons:e.renderFactory.getTemplate("bizagi.grid.buttons"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),totalizer:e.renderFactory.getTemplate("bizagi.grid.totalizer")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&null!=t.data||"adhocGrid"===t.subType&&t.allowEdit,details:t.allowDetail,remove:t.allowDelete,inlineAdd:!1,allowMore:t.allowMore,enableXlsExport:!1,enablePdfExport:!1,hasTotalizer:n&&n.length>0&&t.data.rows.length>0},pageRequested:function(t){if(e.isExecutionMode()){var i=e.changes&&Object.keys(e.changes).length>=1||e.exclusiveChanges&&Object.keys(e.exclusiveChanges).length>=1;!e.isSummaryOrGlobalForm()&&i?$.when(e.getFormContainer().saveForm()).done((function(){e.fetchData(t.page,t.sortBy,t.sortType)})):e.fetchData(t.page,t.sortBy,t.sortType)}},sortRequested:function(t){e.isExecutionMode()&&e.fetchData(t.page,t.sortBy,t.sortType)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){e.isExecutionMode()&&e.triggerHandler("rowSelected",{id:t.key,data:t})},addRow:function(t){e.isExecutionMode()&&("adhocGrid"===e.properties.subType||e.properties.inlineAdd?e.addVirtualRow():e.addRow())},editRow:function(t){e.isExecutionMode()&&("adhocGrid"===e.properties.subType?e.editVirtualRow(t.key):e.editRow(t.key))},deleteRow:function(t){e.isExecutionMode()&&e.deleteRow(t.key)},moreRows:function(t){e.isExecutionMode()&&e.moreRows(t)},showFormDetails:function(t){e.showDetailForm(t.key)},showMore:function(t){e.isExecutionMode()&&e.showMore(t.key)},totalData:function(t){e.isExecutionMode()&&e.onTotalData()}})},postRenderReadOnly:function(){this.postRender()},buildColumnModel:function(){var e=this.columns,t=[];return t.push({name:"id",index:0,label:"id",hidden:!0,align:"center",required:!1,key:!0}),$.each(e,(function(e,i){i.columnIndex=e+1;var r=bizagi.util.normalizeType(i.properties.type),a=bizagi.util.isEmpty(i.properties.displayName)?" ":i.properties.displayName,n={name:i.properties.xpath,index:e+1,label:a,required:i.properties.required||!1,key:!1,hidden:!i.properties.visible||/columnHidden/i.test(r)||0==i.properties.columnVisible,summarizeBy:i.properties.totalize&&i.properties.totalize.operation?i.properties.totalize.operation:void 0,bizAgiProperties:i.properties};t.push(n)})),t},refresh:function(){this.fetchData()},dataReady:function(){return null!=this.dataReadyDeferred?this.dataReadyDeferred.promise():null},loadChanges:function(e){for(var t=0;t<e.length;t++){var i=this.changes[e[t][0]];if(this.exclusiveChanges&&(i=$.extend(i||{},this.getExclusiveChangeByRow(e[t][0]))),void 0!==i)for(var r in i)if(i.hasOwnProperty(r)){var a=this.getColumn(r);e[t][a.columnIndex]=this.mapChangeValue(a.properties.type,i[r],a.comboData)}}},mapChangeValue:function(e,t,i){i=i||[];var r=t;if(null!=t&&(/columnCombo/i.test(e)||/columnRadio/i.test(e))&&!bizagi.util.isArray(t)){var a=i.find((function(e){return e.id==t}));a&&(r=[[a.id,a.value]])}return r},updateData:function(e){var t=this.grid,i=this.columns;e&&(this.properties.data=e,this.setCellOverrides(e,i),this.triggerGridPluginHandler("setData",e),this.applyColumnsWidth(t,i))},fetchData:function(e,t,i){var r=this,a=r.properties;r.dataReadyDeferred=new $.Deferred,e=e||a.page||1,t=t||a.sortBy||"",i=i||a.sortOrder||"asc",a.page=e,a.sortBy=t,a.sortType=i,a.sort=t+" "+i,r.startLoading(),$.when(r.getRemoteData()).then((function(e){e&&(e.deviceMaxRecordsExceeded?bizagi.showMessageBox(bizagi.localization.getResource("render-search-maximum-records-allowed")):(r.isRTL()&&(e.rows=r.changeOrderData(e.rows)),r.loadChanges(e.rows),r.updateData(e),r.triggerRenderChange({changed:!1}),r.dataReadyDeferred.resolve()))})).always((function(){r.endLoading()}))},collectData:function(e){var t=this.grid;if(this.grid&&(this.properties.inlineAdd||this.properties.inlineEdit)){var i=t.bizagi_grid_tablet.hasOwnProperty("getNewRowKeys")?t.bizagi_grid_tablet("getNewRowKeys"):[];if(i.length>0&&!this.properties.alreadySaved&&this.isValid()){var r=this.saveInlineAddedRows(i,!0);e.deferreds=e.deferreds||[],e.deferreds.push(r)}for(var a=0;a<i.length;a++)this.changes[i[a]]&&delete this.changes[i[a]]}this._super(e)},drawCell:function(e,t,i,r){if(e.key)return i;var a=e.index-1,n=this.getCellOverride(t,a),o=this.columns[a];this.newRecords=this.newRecords||{},this.cellMetadata[t]||(this.cellMetadata[t]={}),this.cellMetadata[t][a]||(this.cellMetadata[t][a]={});var s=this.cellMetadata[t][a].properties||o.properties;s.editable=bizagi.util.parseBoolean(s.editable)||!1;var l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;l=n.visible,d=!!s.editable&&n.editable,r&&(d=!0),o.properties.displayType="value",o.setSurrogateKey(t),"summary"===t&&(d=!1),o.properties.labelAlign="default",o.properties.columntitlealign&&(o.properties.labelAlign=o.properties.columntitlealign),o.properties.valueAlign="default",o.properties.columnAlign&&(o.properties.valueAlign=o.properties.columnAlign);var c="";return c=d?this.drawEditableCell(o,s,t,i,r):this.drawReadonlyCell(o,s,t,i),l?c:""},onCellReady:function(e,t,i,r){var a=e.index-1,n=this.getCellOverride(t,a),o=this.columns[a],s=this.cellMetadata[t][a].properties||o.properties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;l=n.visible,d=!!s.editable&&n.editable;var c=s.columnwidth||"auto",u=bizagi.util.getColumnType(s.type),p="radio"===u&&s.horizontal&&d,h="boolean"===u&&"check"===s.display;if(this.applyElementWidth(i[0],c,u,p,h,!1),d=!!r,l)if(d){var g=o.properties.editable;if(o.properties.editable=d,o.properties.submitOnChange){var f=o.getDecorated(t);f&&(f.properties.submitOnChangexpathContext=this.properties.xpath+"[]")}o.postRender(t,i),o.properties.editable=g}else o.postRenderReadOnly(t,i)},addRow:function(){var e=this,t=e.properties,i=e.getFormContainer(),r=e.getFormParams();e.startLoading(),$.when(e.submitAddRequest()).done((function(a){var n=new bizagi.rendering.tablet.slide.view(e.dataService,e.renderFactory,{title:e.properties.displayName||"",container:i.container,formParams:r,navigation:r.navigation,showSaveButton:!0,onSave:function(t){return e.addExclusiveChange(a,t),e.submitSaveRequest(a,t)}});e.endLoading();var o=t.xpath+"[id="+a+"]";n.render({idRender:t.id,recordXPath:o,xpathContext:t.xpathContext,idPageCache:t.idPageCache,requestedForm:"addForm",url:t.addPage,formParams:r,navigation:r.navigation}).done((function(){t.submitOnChange?e.submitOnChange():e.fetchData()})).fail((function(){e.submitRollbackRequest()})).always((function(){e.endLoading()}))})).fail((function(t){e.executeFailHandlerOnForm(t)})).always((function(){e.endLoading()}))},addVirtualRow:function(){var e=this,t=e.properties,i=e.getFormContainer(),r=e.getFormParams(),a=["mock_id"];e.columns.forEach((function(){a.push(null)})),new bizagi.rendering.tablet.slide.adhocForm(e.renderFactory,{title:e.properties.displayName||"",allowEdition:!0,navigation:r.navigation,container:e.getFormContainer().container}).render({row:a,columns:e.columns,pageCacheId:t.idPageCache,xpath:t.xpath,xpathContext:t.xpathContext,sessionId:i.properties.sessionId,actions:i.actions,validations:i.validations}).done((function(i){$.when(e.saveAddedRow(i)).done((function(){t.submitOnChange?e.submitOnChange():e.fetchData()}))}))},saveAddedRow:function(e){var t=this.properties;return this.dataService.multiaction().addGridRecordData({url:t.addUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,contexttype:t.contexttype,idPageCache:t.idPageCache,submitData:e})},editRow:function(e){if(0!=e){var t=this,i=t.properties;if(1!=i.inlineEdit||0!=i.allowEdit)if(t.cleanActionChanges&&void 0!==t.cleanActionChanges[e]){t.changes=t.cleanActionChanges;var r=$.extend(t.changes[e],{});r.idPageCache=i.idPageCache,$(".ui-tooltip").remove(),$.when(t.submitSaveRequest(e,r)).done((function(){t.startLoading(),i.submitOnChange?t.submitForGridChange().always((function(){t.endLoading(),t.executeSubmitEditRequest(e,(function(i){t.addExclusiveChange(e,i)}))})):(t.endLoading(),t.fetchData())}))}else t.executeSubmitEditRequest(e,(function(i){t.addExclusiveChange(e,i)}));else t.editInline(e)}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},editVirtualRow:function(e){for(var t=this,i=t.properties.data,r=t.properties,a=t.getFormContainer(),n=t.getFormParams(),o=[],s=0,l=i.rows.length;s<l;s++)if(i.rows[s][0]==e){o=i.rows[s];break}new bizagi.rendering.tablet.slide.adhocForm(t.renderFactory,{title:t.properties.displayName||"",allowEdition:!0,navigation:n.navigation,container:t.getFormContainer().container}).render({row:o,columns:t.columns,pageCacheId:r.idPageCache,xpath:r.xpath,xpathContext:r.xpathContext,sessionId:a.properties.sessionId,actions:a.actions}).done((function(i){for(xpath in i)t.collectGridChange({id:e,xpath:xpath,value:i[xpath],trigger:!1});var a={};t.collectData(a),t.dataService.submitData({action:"SUBMITONCHANGE",data:a,idRender:r.id,xpath:r.xpath,xpathContext:r.xpathContext,idPageCache:r.idPageCache}).done((function(){t.fetchData()}))}))},executeSubmitEditRequest:function(e,t){var i=this,r=i.properties,a=i.getFormContainer(),n=i.getFormParams(),o=new bizagi.rendering.tablet.slide.view(i.dataService,i.renderFactory,{title:i.properties.displayName||"",container:a.container,formParams:n,navigation:n.navigation,showSaveButton:!0,onSave:function(r){return t&&t(r),i.submitSaveRequest(e,r)}});i.startLoading(),$.when(i.submitEditRequest(e)).done((function(){var t=r.xpath+"[id="+e+"]";o.render({idRender:r.id,recordXPath:t,xpathContext:r.xpathContext,idPageCache:r.idPageCache,requestedForm:"editForm",url:r.editPage,formParams:n,navigation:n.navigation}).done((function(){r.submitOnChange?i.submitOnChange():i.fetchData()})).fail((function(){i.startLoading(),$.when(i.submitRollbackRequest()).always((function(){i.endLoading()}))}))})).always((function(){i.endLoading()}))},showDetailForm:function(e){var t=this.properties,i=this.getFormContainer(),r=this.getFormParams(),a=new bizagi.rendering.tablet.slide.view(this.dataService,this.renderFactory,{title:this.properties.displayName||"",container:i.container,formParams:r,navigation:r.navigation,showSaveButton:!1}),n=t.xpath+"[id="+e+"]";a.render({idRender:t.id,recordXPath:n,xpathContext:t.xpathContext,idPageCache:t.idPageCache,requestedForm:"detailForm",url:t.editPage,formParams:r,editable:!1,navigation:r.navigation})},deleteRow:function(e){if(0!==e){var t=this;bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){$.when(t.submitDeleteRequest(e)).done((function(i){t.refreshAfterDeleteRows(),"success"===i.type&&t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e})})).fail((function(e){t.executeFailHandlerOnForm(e)}))}))}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},refreshAfterDeleteRows:function(e){var t=this.triggerGridPluginHandler("getCurrentPage");if(e=e||1,t>1){var i=bizagi.clone(this.properties.data||{}),r=i.records>0?i.records-e:0,a=Math.ceil(r/this.properties.rowsPerPage);a<t&&(t=a)}return this.fetchData(t)},moreRows:function(e){var t=this,i=t.properties;void 0===i.originalrowsPerPage&&(i.originalrowsPerPage=i.rowsPerPage),i.rowsPerPage+=i.originalrowsPerPage;var r={};t.collectData(r),t.startLoading(),$.isEmptyObject(r)?t.moreRowsCommon(e):t.dataService.submitData({action:"SUBMITONCHANGE",data:r,idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,idPageCache:i.idPageCache}).done((function(){t.endLoading(),t.moreRowsCommon(e)}))},moreRowsCommon:function(e){var t=this,i=t.properties;t.fetchData(e.page,e.sortBy,e.sortType),$.when(t.dataReadyDeferred).done((function(){0!=i.records&&i.records+1<=i.rowsPerPage&&$(".ui-bizagi-grid-dynamic-pager",t.getControl()).hide()}))},showMore:function(e){for(var t=this,i=t.properties.data,r=t.properties,a=t.getFormContainer(),n=t.getFormParams(),o=[],s=0,l=i.rows.length;s<l;s++)if(i.rows[s][0]==e){o=i.rows[s];break}var d=new bizagi.rendering.tablet.slide.grid(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:a.container,allowEdition:!1,formParams:n,navigation:n.navigation});t.startLoading(),d.render({row:o,columns:t.columns,pageCacheId:r.idPageCache,xpath:r.xpath,xpathContext:r.xpathContext,sessionId:a.properties.sessionId,actions:a.actions,formParams:n,navigation:n.navigation}).done((function(){t.endLoading()}))},editInline:function(e){for(var t=this,i=t.properties.data,r=t.properties,a=t.getFormContainer(),n=t.getFormParams(),o=[],s=0,l=i.rows.length;s<l;s++)if(i.rows[s][0]==e){o=i.rows[s];break}var d=new bizagi.rendering.tablet.slide.grid(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:a.container,formParams:n,navigation:n.navigation,allowEdition:!0});$.when(d.render({row:o,columns:t.columns,pageCacheId:r.idPageCache,xpath:r.xpath,xpathContext:r.xpathContext,sessionId:a.properties.sessionId,actions:a.actions,validations:a.validations,formParams:n,navigation:n.navigation})).done((function(i){for(xpath in i)t.collectGridChange({id:e,xpath:xpath,value:i[xpath],trigger:!1});var a={};t.collectData(a),t.dataService.submitData({action:"SUBMITONCHANGE",data:a,idRender:r.id,xpath:r.xpath,xpathContext:r.xpathContext,idPageCache:r.idPageCache}).done((function(){t.fetchData()}))}))},changeCellBackgroundColor:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeBackgroundColor(i,!1)}else r.pendingActions&&r.pendingActions.push({method:r.changeCellBackgroundColor,arguments:arguments})},changeCellColor:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeColor(i,!1)}else r.pendingActions&&r.pendingActions.push({method:r.changeCellColor,arguments:arguments})},changeCellVisibility:function(e,t,i){var r=this;if(r.initialLoadDone){var a=(r.columns||[]).findIndex((function(e){return r.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0,n=r.grid.bizagi_grid_tablet("getCell",e,t,a);n&&(1==i?(n.css("visibility","visible"),n.css("display",""),r.element&&r.element.show()):n.css("visibility","hidden")),r.cellOverrides[e]=r.cellOverrides[e]||{},r.getCellOverride(e,a).visible=i}else r.pendingActions&&r.pendingActions.push({method:r.changeCellVisibility,arguments:arguments})},changeCellValue:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a){a.setDisplayValue(i);var n=a.column||{},o=n.properties&&n.properties.type;if(n){var s=r.getCellValueFormatted(n,n.getValue(e));a.setDisplayValue(i),a.triggerHandler("renderchange",{render:r,changed:!0}),r.collectGridChange({id:e,xpath:n.properties.xpath,value:s,compositeValue:n.getCompositeValue(e),columnIndex:a.columnIndex,trigger:!1,dataType:o})}}}else r.pendingActions&&r.pendingActions.push({method:r.setDisplayValue,arguments:arguments})},changeCellRequired:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a){a.changeCellRequired(i);var n=(r.columns||[]).findIndex((function(e){return r.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0;r.cellOverrides[e]=r.cellOverrides[e]||{},r.getCellOverride(e,n).required=i}}else r.pendingActions&&r.pendingActions.push({method:r.changeCellRequired,arguments:arguments})},changeCellEditability:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a){a.changeEditabilityCellControl(i,e,t);var n=r.getIndexForCurrentCell(t);r.cellOverrides[e]=r.cellOverrides[e]||{},r.getCellOverride(e,n).editable=i}}else r.pendingActions&&r.pendingActions.push({method:r.changeCellEditability,arguments:arguments})},setError:function(e,t){var i=this;if(i.initialLoadDone)for(var r=0;r<i.columns.length;r++){var a=i.getCellOverride(e,r).visible,n=i.columns[r].properties;if(i.isCurrentGridCell(n.xpath,n.id,t)&&a){var o=i.grid.bizagi_grid_tablet("getCell",e,t,r);o.parent().addClass("ui-bizagi-render-grid-cell-error");break}}else i.pendingActions&&i.pendingActions.push({method:i.setError,arguments:arguments})},ready:function(){var e=this._super(),t=this.inlineAddDeferred?this.inlineAddDeferred.promise():null;return $.when(e,t)},applyColumnsWidth:function(e,t){var i=this;e[0].querySelectorAll("th:not(.bz-hidden)").forEach((function(e,r){var a=e.querySelector(".bz-tablet-grid__label"),n=a?Number(a.dataset.columnIndex)-1:r,o=t[n]&&t[n].properties?t[n].properties:{},s=o.columnwidth,l=void 0===o.editable||o.editable,d=bizagi.util.getColumnType(o.type),c="radio"===d&&o.horizontal&&l,u="boolean"===d&&"check"===o.display;i.applyElementWidth(e,s,d,c,u,!0)}))},applyElementWidth:function(e,t,i,r,a,n){r?i="horizontalRadio":a&&(i="checkboxBoolean");var o=this.MIN_SUPPORTED_WIDTHS.get(i);t&&"auto"!==t&&(/px$/i.test(t)&&(t=Math.max(parseInt(t),o)+"px"),e.style.width=t,e.style.minWidth=t,n||(e.style.maxWidth=t))},startLoading:function(e){bizagi.loading.start(),this._super(e)},endLoading:function(){bizagi.loading.stop(),this._super()},cleanCellData:function(e,t){var i=this;if(i.initialLoadDone){var r=i.getControlCell(e,t);if(r)return $.when(r.cleanData()).then((function(r){r=r||[["",""]];for(var a=(i.columns||[]).findIndex((function(e){return i.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0,n=i.properties.data.rows,o=0,s=n.length;o<s;o++)if(Number(e)===n[o][0]){n[o][a+1]=r;break}i.cellOverrides[e]=i.cellOverrides[e]||{},i.getCellOverride(e,a).value=null,i.cleanActionChanges||(i.cleanActionChanges={}),i.cleanActionChanges[e]||(i.cleanActionChanges[e]={}),i.cleanActionChanges[e][t]=""}))}else i.pendingActions.push({method:i.cleanData,arguments:""})},onTotalData:function(e){var t,i=this,r=(i.properties.data||{}).rows,a=[],n=i.buildColumnModel();bizagi.util.tablet.startLoading(),n.forEach((function(e,n){if(e.bizAgiProperties){var o=e.bizAgiProperties.totalize.operation;switch(o){case"sum":t=r.sum((function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)}),n);break;case"count":t=r.count((function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return bizagi.util.isArray(i)?bizagi.util.isArray(i)&&i.length>0?i:void 0:i}),e,n);break;case"max":t=r.max((function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)}),n);break;case"min":t=r.min((function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)}),n);break;case"avg":t=(t=r.avg((function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)}),n)).toFixed(2)}o&&(t=i.formatTotalizedResult(o,e.bizAgiProperties.type,t),a.push({label:e.label,total:t}))}})),i.showTotals(a),bizagi.loading.stop()},formatTotalizedResult:function(e,t,i){switch(e){case"sum":case"avg":case"min":case"max":if(/columnMoney/i.test(t)||/money/i.test(t))return bizagi.util.formatMonetaryCell(i)}return i||0},showTotals:function(e){var t=$.fasttmpl(this.renderFactory.getTemplate("bizagi.grid.totalizer"),{items:e});this.grid.mobileView({displayName:bizagi.localization.getResource("render-grid-totalizer"),orientation:this.properties.orientation,style:"width: 80%; height: 70%",transition:"fade:in",cssClass:"bz-modal-view--totalizer",showBorder:!0,contentTemplate:t})},changeBackgroundColor:function(e){var t=this.getControl();return t&&$(".bz-tablet-grid",t).css("background-color","none"!==e?e:""),this},getCellValueFormatted:function(e,t){var i=e.properties.type,r=t;if(/columnDate/i.test(i)){var a=e.data.properties;if(bizagi.util.isEmpty(r))""===t&&(r="");else{var n=bizagi.util.dateFormatter.getDateFromInvariant(r,a.showTime);void 0!==n&&0!==n&&(a.showTime||n.setHours(0,0,0,0),r=bizagi.util.dateFormatter.formatInvariant(n,!0))}}return r},onCellChange:function(e,t,i,r){var a=bizagi.util.normalizeType(e.properties.type);if(!new RegExp(["columnImage","columnUpload"].join("|"),"i").test(a))try{var n=e.getValue(i),o=e.getCompositeValue(i);if(/columnDate/i.test(a))if(bizagi.util.isEmpty(n))""===n&&(n="");else{var s=bizagi.util.dateFormatter.getDateFromInvariant(n,!0);s.setMilliseconds(0),n=bizagi.util.dateFormatter.formatInvariant(s,!0)}!(/columnBoolean/i.test(a)&&e.properties.isExclusive)&&this.properties.allowEdit&&this.collectGridChange($.extend(r,{id:i,xpath:e.properties.xpath||e.properties.id,value:n,compositeValue:o,columnIndex:e.columnIndex,trigger:!0,dataType:a})),this.triggerGridPluginHandler("changeCellValue",i,e.columnIndex,n)}catch(t){console.warn("onCellChange error: ",t,e)}},drawEditableCell:function(e,t,i,r,a){var n=this,o=new $.Deferred,s=e.properties.editable;return e.properties.editable=!0,e.overrideProperties({required:t.required}),$.when(e.render(i,r)).done((function(t){(n.columns||[]).forEach((function(e,t){var r=!0;n.cellOverrides[i]=n.cellOverrides[i]||{},void 0!==n.getCellOverride(i,t).visible&&(r=n.getCellOverride(i,t).visible),n.getCellOverride(i,t).visible=r})),e.getDecorated(i).unbind("renderchange.draweditable").bind("renderchange.draweditable",(function(r,a){n.onCellChange(e,t,i,a)})),o.resolve(t)})),e.properties.editable=s,o.promise()},drawReadonlyCell:function(e,t,i,r){var a=this,n=new $.Deferred;return $.when(e.renderReadOnly(i,r)).done((function(e){(a.columns||[]).forEach((function(e,t){var r=!0;a.cellOverrides[i]=a.cellOverrides[i]||{},void 0!==a.getCellOverride(i,t).visible&&(r=a.getCellOverride(i,t).visible),a.getCellOverride(i,t).visible=r})),n.resolve(e)})),n.promise()},triggerGridPluginHandler:function(){try{var e=Array.prototype.slice.call(arguments,0);return this.grid.bizagi_grid_tablet.apply(this.grid,e)}catch(e){console.warn("triggerGridPluginHandler error: ",e)}},addExclusiveChange:function(e,t){if(this.properties.hasExclusiveCheck)for(var i in t){var r=this.columns.find((function(e){return e.properties.xpath==i})),a=t[i];r&&r.properties.isExclusive&&a&&(this.exclusiveChanges[i]={xpath:i,simpleXpath:i,value:a,key:e})}},changeCellMaxValue:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeMaxValue(i)}else r.pendingActions.push({method:r.changeMaxValue,arguments:arguments})},changeCellMinValue:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeMinValue(i)}else r.pendingActions.push({method:r.changeMinValue,arguments:arguments})},executeFailHandlerOnForm:function(e){var t=e&&e.responseText?e.responseText:bizagi.util.getErrorFormatted(e);(void 0===t||t&&!t.message)&&(message=Object.assign({},"object"===_typeof(t)?t:{},{message:bizagi.localization.getResource("workportal-general-error")})),this.getFormContainer().failHandler(t)}}),bizagi.rendering.tablet.grid.extend("bizagi.rendering.tablet.grid.offline",{},{init:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;i.data.originalRows=bizagi.clone(i.data.rows),i.isTaskForm=t.properties.isTaskForm,this.newRecords={},!0===i.editable&&(this["new-records"]=i["new-records"]?i["new-records"]:{},this["deleted-records"]=i["deleted-records"]?i["deleted-records"]:{}),this.editedImages=i["edited-images"]?i["edited-images"]:{},this.offlineFiles=i["offline-files"]?i["offline-files"]:{},i.displayType="vertical",i.labelAlign="left",(i.groupBy||i.groupSummary)&&t.addWarning(this.getResource("render-tablet-warning-grid")),this.pendingActions=[]},initProperties:function(){this._super(),this.properties.rowsPerPage=1e3},updateOriginalValue:function(){var e=this.properties;this.changes=[],e.data.originalRows=bizagi.clone(e.data.rows),e["new-records"]=void 0,e["edited-images"]=e["offline-files"]=e["deleted-records"]={}},postRender:function(){var e=this,t=e.properties,i=e.getControl();if(e.initialLoadDone=!1,e.grid=$(">div",i),e.getLabel().hide(),e.applyGridPlugin(),t.data&&(e.updateData(t.data),$.when(e.ready()).done((function(){e.triggerRenderChange({changed:!1})}))),e.initialLoadDone=!0,e.pendingActions&&e.pendingActions.length>0)for(var r in e.pendingActions)e.pendingActions[r].method.apply(e,e.pendingActions[r].arguments)},postRenderReadOnly:function(){this.postRender()},applyGridPlugin:function(){var e=this,t=e.properties,i=e.grid,r=e.getMode(),a=e.buildColumnModel();i.bizagi_grid_tablet({columns:a,title:t.displayName,isOfflineForm:this.isOfflineForm||!1,mode:e.getMode(),template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),buttons:e.renderFactory.getTemplate("bizagi.grid.offline.buttons"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.offline.row.buttons"),specialCell:e.renderFactory.getTemplate("bizagi.grid.offline.cell.special")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&null!=t.data,remove:t.allowDelete,details:!1,inlineAdd:!!t.editable||t.inlineAdd,allowMore:!1,enableXlsExport:!1,enablePdfExport:!1,hasTotalizer:!1},isValid:function(){return e.isValidGrid()},pageRequested:function(t){"execution"===r&&e.fetchData(t.page,t.sortBy,t.sortType)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){"execution"===r&&e.triggerHandler("rowSelected",{id:t.key,data:t})},addRow:function(t){"execution"===r&&e.addRow()},editRow:function(t){"execution"===r&&e.editRow(t.key)},deleteRow:function(t){"execution"===r&&e.deleteRow(t.key)},saveAddedRows:function(t){e.saveInlineAddedRows(t.keys)},beforeInlineAdd:function(){e.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(t){e.inlineAddDeferred&&e.inlineAddDeferred.resolve(),t&&t.businessKey&&e.triggerRenderChange({key:t.businessKey})},cancelEdition:function(t){e.removeNewRecords(t)},removeNewRecords:function(t){e.removeNewRecords(t)}})},fetchData:function(e,t,i){var r=this;r.dataReadyDeferred=new $.Deferred,r.startLoading(),$.when(r.getRemoteData()).then((function(e){e&&(r.updateData(e),r.triggerRenderChange({changed:!1}),r.dataReadyDeferred.resolve())})).always((function(){r.endLoading()}))},processChanges:function(){var e=[];this.properties.data;for(var t in this.changes){var i=[];for(var r in this.changes[t])if(this.canColumnBeSent(t,r)){var a=this.getColumn(r).columnIndex-1,n=this.changes[t][r];"string"==typeof n&&null!==n.match(/\n/gm)&&(n=n.replaceAll("\n","\\n")),i[a]=n}for(var o=0;o<this.columns.length;o++)i[o]=null!=i[o]?i[o]:null;this.newRecords[t]&&(i.unshift(parseInt(t+"")),i.creationTimestamp=this.newRecords[t].creationTimestamp,e[e.length]=i)}return e=(e=e.sort((function(e,t){return e.creationTimestamp-t.creationTimestamp}))).map((function(e){return e.creationTimestamp&&delete e.creationTimestamp,e}))},collectOfflineTaskData:function(e){var t=this.properties,i=this.properties.data,r={},a=this.editedImages,n=this.offlineFiles;for(var o in this.changes){var s=[],l={},d={},c={};for(var u in this.changes[o])if(this.canColumnBeSent(o,u)){var p=this.getColumn(u).columnIndex-1;"string"==typeof(f=this.changes[o][u])&&null!==f.match(/\n/gm)&&(f=f.replaceAll("\n","\\n")),s[p]=f;var h=t.xpath+this.buildCellXpathFilter(o)+"."+u,g=this.changes[o][u],f=g&&g.value?g.value:g;a[o]&&a[o][u]?(delete a[o][u].isChanged,d[u]=a[o][u]):n[o]&&n[o][u]?c[u]=n[o][u]:(e[h]=f,l[h]=f)}if(this.newRecords[o]){var m=$.extend({},this.changes[o]),b={url:t.addUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,contexttype:t.contexttype,idPageCache:t.idPageCache,submitData:m,prepare:!0,idRow:parseInt(o+""),creationTimestamp:this.newRecords[o].creationTimestamp};for(change in r[o]=b,l)delete e[change];for(image in d)delete m[image],a[o][image].isNew=!0;for(file in c)delete m[file],n[o][file].isNew=!0;Object.keys(d).length>0&&(a[o].isNew=!0),Object.keys(c).length>0&&(n[o].isNew=!0);var v={};v.idRow=parseInt(o+""),v.isNew=!0,v.changes=this.changes[o],b.images=d,b.files=c,s.push(v)}}this.saveInlineAddedRows(),(JSON.stringify(i.rows)!==JSON.stringify(i.originalRows)||null!=t["new-records"]&&r!=t["new-records"])&&(e[t.xpath]=e[t.xpath]?e[t.xpath]:{},void 0!==i.rows&&(e[t.xpath].rows=this.processOldRows(i.rows)),this["deleted-records"]&&Object.keys(this["deleted-records"]).length>0&&(e[t.xpath]["deleted-records"]=this["deleted-records"]),r&&Object.keys(r).length>0&&(e[t.xpath]["new-records"]=r),a&&Object.keys(a).length>0&&(e[t.xpath]["edited-images"]=a),n&&Object.keys(n).length>0&&(e[t.xpath]["offline-files"]=n))},collectOfflineStartData:function(e){var t=[],i=this.properties,r=this.properties.data;if(this.isValid([]))for(var a in this.changes){var n=[];for(var o in this.changes[a])if(this.canColumnBeSent(a,o)){var s=this.getColumn(o).columnIndex-1,l=this.changes[a][o];"string"==typeof l&&null!==l.match(/\n/gm)&&(l=l.replaceAll("\n","\\n")),n[s]={value:l,xpath:o,DataType:this.getColumn(o).properties.dataType}}if(void 0!==this.properties.data.rows&&this.properties.data.rows.length>0)for(var d=[],c=0;c<r.rows.length;c++)if(r.rows[c][0]==a){d=r.rows[c],r.rows.splice(c,1),c--,d=this.processRow(d),n=$.extend(!0,d,n);break}t[t.length]=n}(JSON.stringify(r.rows)!==JSON.stringify(r.originalRows)||t.length>0)&&(void 0!==r.rows&&t.length>0?e[i.xpath].rows=$.merge($.merge([],this.processOldRows(r.rows)),t):void 0!==r.rows&&r.rows.length>0?e[i.xpath].rows=this.processOldRows(r.rows):e[i.xpath].rows=t)},collectData:function(e){this.collectOfflineTaskData(e)},processOldRows:function(e){for(var t=[],i=e,r=0,a=i.length;r<a;r++){var n=i[r];t[r]=$.grep(n,(function(e,t){return t>0}));var o={};o.idRow=parseInt(n[0]+""),o.isNew=!!this.newRecords[n[0]],o.changes=this.changes[n[0]]?this.changes[n[0]]:{},t[r].push(o)}return t},processRow:function(e){return $.grep(e,(function(e,t){return t>0}))},drawCell:function(e,t,i,r){if(e.key)return i;"object"!==_typeof(i)||null===i||r||(i=i.hasOwnProperty("value")?i.value:i);var a=e.index-1,n=this.columns[a],o=this.getCellOverride(t,e.index-1);this.newRecords=this.newRecords||{},this.cellMetadata[t]||(this.cellMetadata[t]={}),this.cellMetadata[t][a]||(this.cellMetadata[t][a]={});var s=this.cellMetadata[t][a].properties||n.properties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;if(l=o.visible,d=!!s.editable&&o.editable,r&&(d=!0),"summary"===t&&(d=!1),"columnUpload"===n.properties.type&&(this.offlineFiles[t]&&this.offlineFiles[t][n.properties.xpath]?i=this.offlineFiles[t][n.properties.xpath].value:i&&Array.isArray(i)&&i.length>0&&(i=this.dataService.database.convertUploadOnlineValueInOfflineValue(i))),n.properties.displayType="value",n.setValue(t,i),n.setSurrogateKey(t),n.properties.data=n.properties.data||[],"columnSearch"===n.properties.type&&null!=i)for(var c=0,u=n.properties.data.length;c<u;c++)n.properties.data[c].id==i&&(i={id:n.properties.data[c].id,label:n.properties.data[c].value});if(("columnCombo"===n.properties.type||"columnList"===n.properties.type)&&null!=i)for(c=0,u=n.properties.data.length;c<u;c++)n.properties.data[c].id==i&&(i=[[n.properties.data[c].id,n.properties.data[c].value]]);return"columnText"===n.properties.type&&bizagi.util.isEmpty(i)&&null!=i&&(i=""),"columnImage"===n.properties.type&&this.editedImages[t]&&this.editedImages[t][n.properties.xpath]&&(n.getDecorated(t).properties.isChanged=this.editedImages[t][n.properties.xpath].isChanged),"columnUpload"===n.properties.type&&(n.getDecorated(t).properties.xpathContext=this.properties.xpath+this.buildCellXpathFilter(t)),l?d?this.drawEditableCell(n,s,t,i,r):this.drawReadonlyCell(n,s,t,i):""},drawEditableCell:function(e,t,i,r,a){var n=this,o=new $.Deferred,s=e.properties.editable;return e.properties.editable=!0,e.overrideProperties({required:t.required}),$.when(e.render(i,r)).done((function(t){a&&!n.newRecords[i]&&(n.newRecords[i]={creationTimestamp:Date.now()},n.changes[i]={});for(var r=0;r<n.columns.length;r++)n.cellOverrides[i]=n.cellOverrides[i]||{},n.getCellOverride(i,r).visible=null==n.getCellOverride(i,r).visible||n.getCellOverride(i,r).visible;e.getDecorated(i).bind("renderchange",(function(r){n.onCellChange(e,t,i)})),o.resolve(t)})),e.properties.editable=s,o.promise()},drawReadonlyCell:function(e,t,i,r){var a="";if("summary"===i){var n=e.properties.textFormat;e.properties.totalize&&(e.properties.textFormat=e.properties.totalize.format),a=e.renderSummary(i,r),e.properties.textFormat=n}else a=e.renderReadOnly(i,r);return a},onCellChange:function(e,t,i){var r=e.getValue(i),a=e.getCompositeValue(i);if("columnDate"===e.properties.type&&1==e.data.properties.showTime)if(bizagi.util.isEmpty(r))""===r&&(r="");else{var n=bizagi.util.dateFormatter.getDateFromInvariant(r,!0);r=bizagi.util.dateFormatter.formatInvariant(n,!0)}else if("columnDate"===e.properties.type){if(bizagi.util.isEmpty(r))""===r&&(r="");else(n=bizagi.util.dateFormatter.getDateFromInvariant(r,!1)).setHours(0,0,0,0),r=bizagi.util.dateFormatter.formatInvariant(n,!0)}if("columnImage"===e.properties.type){var o=this.properties.xpath+this.buildCellXpathFilter(i)+"."+e.properties.xpath;this.editedImages=this.editedImages||{},this.editedImages[i]=this.editedImages[i]||{},this.editedImages[i][e.properties.xpath]={id:i,columnXpath:e.properties.xpath,renderId:e.properties.id,gridXpath:this.properties.xpath,fullXpath:o,value:r,offlineId:e.getDecorated(i).buildOfflineImageId(),name:this.dataService.fileService.getOfflineImageName(r),isChanged:!0}}if("columnUpload"===e.properties.type){o=this.properties.xpath+this.buildCellXpathFilter(i)+"."+e.properties.xpath;this.offlineFiles[i]=this.offlineFiles[i]||{},this.offlineFiles[i][e.properties.xpath]={id:i,columnXpath:e.properties.xpath,renderId:e.properties.id,gridXpath:this.properties.xpath,fullXpath:o,value:r}}if(this.properties.allowEdit||this.grid.bizagi_grid_tablet("isNewRecord",i)){var s=!this.grid.bizagi_grid_tablet("isNewRecord",i);this.collectGridChange({id:i,xpath:e.properties.xpath,value:r,compositeValue:a,columnIndex:e.columnIndex,trigger:s,dataType:e.properties&&e.properties.type})}this.grid.bizagi_grid_tablet("changeCellValue",i,e.columnIndex,r),e.properties.totalize&&e.properties.totalize.operation&&this.grid.bizagi_grid_tablet("refreshSummary",e.columnIndex)},collectGridChange:function(e){var t=(e=e||{}).id,i=e.xpath,r=e.value,a=void 0===e.trigger||e.trigger;this.changes[t]=this.changes[t]||{},this.changes[t][i]=r,a&&this.triggerRenderChange({key:t,column:i})},onCellReady:function(e,t,i,r){r=!0,bizagi.rendering.tablet.grid.prototype.onCellReady.apply(this,arguments)},addRow:function(){bizagi.showMessageBox(bizagi.localization.getResource("render-tablet-error-userfield"),bizagi.localization.getResource("render-tablet-error-userfield"))},editRow:function(e){},deleteRow:function(e){var t=this;e&&0!=e?bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){t.saveInlineAddedRows(),$.when(t.submitDeleteRequest(e)).done((function(){t.fetchData(),t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e})}))})):bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},editInline:function(e){},saveInlineAddedRows:function(e,t){this.updateRowsFromChanges(),this.updateNewRowsAsSaved()},updateNewRowsAsSaved:function(){var e=this;bizagi.util.isEmpty(e.newRecords)||(e.triggerGridPluginHandler("hideHeaderButtons"),Object.keys(e.newRecords||[]).forEach((function(t){e.setRowAsSaved(t)})))},updateRowsFromChanges:function(){var e=this.processChanges();bizagi.util.isEmpty(e)||(this.properties.data.rows=this.mergeArray(this.properties.data.rows,e))},mergeArray:function(e,t){var i=this,r=bizagi.clone(e);return t.forEach((function(e){var t=e[0],a=i.getRowByKey(r,t);bizagi.util.isEmpty(a)?r.push(e):a=i.mergeRow(a,e)})),r},getRowByKey:function(e,t){var i=e.filter((function(e){return e[0]==t}));return 0==i.length?null:i[0]},mergeRow:function(e,t){return t.forEach((function(t,i){null!=t&&null!=t&&(e[i]=t)})),e},removeNewRecords:function(e){var t=this;e&&e.keys&&$.each(e.keys,(function(e,i){t.newRecords[i]&&(delete t.newRecords[i],delete t.changes[i],delete t.offlineFiles[i])}))},getRemoteData:function(e){var t=this.properties;if(e=e||{},t.overrideGetRemoteData){var i=t.overrideGetRemoteData(e);return null!=i?i.promise():null}var r=new $.Deferred,a=t.data;return t.page=a.page,t.records=a.records,t.totalPages=a.totalPages,this.isRTL()&&(a.rows=this.changeOrderData(a.rows)),r.resolve(a),r.promise()},submitDeleteRequest:function(e){for(var t=this.properties,i=this.properties.data,r=0,a=i.rows.length;r<a;r++)if(i.rows[r][0]==e){i.rows[r],i.rows.splice(r,1),r--,i.records--,!0;var n=t.xpath+this.buildCellXpathFilter(e),o={url:t.deleteUrl,idRender:t.id,xpath:n,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType,prepare:!0};this["deleted-records"][e]=o,delete this.newRecords[e],delete this.editedImages[e],delete this.offlineFiles[e],delete this.changes[e];break}return i.rows},isValidGrid:function(){var e=[],t=this.getFormContainer();if(void 0!==t.validationController&&t.validationController.clearValidationMessages(),this.isValid(e),e.length>0){if(void 0!==t.validationController)for(var i=0;i<e.length;i++)t.validationController.showValidationMessage(e[i].message,e[i].xpath);return!1}return!0},getIndexes:function(){var e=this.mergeArray(this.properties.data.rows,this.getDataNewRows());return $.map(e,(function(e,t){return e[0]}))}}),bizagi.rendering.tablet.grid.extend("bizagi.rendering.tablet.grid.offline.old",{MAX_ROWS_SUPPORTED:4},{init:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;i.data.originalRows=bizagi.clone(i.data.rows),i.displayType="vertical",i.labelAlign="left",(i.groupBy||i.groupSummary)&&t.addWarning(this.getResource("render-tablet-warning-grid"))},postRender:function(){var e=this,t=e.properties,i=e.getControl();for(var r in e.initialLoadDone=!1,e.grid=$(">div",i),e.getLabel().hide(),e.applyGridPlugin(),t.data&&(e.updateData(t.data),$.when(e.ready()).done((function(){e.triggerRenderChange({changed:!1})}))),e.initialLoadDone=!0,e.pendingActions)e.pendingActions[r].method.apply(e,e.pendingActions[r].arguments)},postRenderReadOnly:function(){this.postRender()},applyGridPlugin:function(){var e=this,t=e.properties,i=e.grid,r=e.getMode(),a=e.buildColumnModel();i.bizagi_grid_tablet({columns:a,maxColumns:e.Class.MAX_ROWS_SUPPORTED,title:t.displayName,isOfflineForm:this.isOfflineForm||!1,mode:e.getMode(),template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),buttons:e.renderFactory.getTemplate("bizagi.grid.offline.buttons"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.offline.row.buttons"),specialCell:e.renderFactory.getTemplate("bizagi.grid.offline.cell.special")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&null!=t.data,remove:t.allowDelete,details:!1,inlineAdd:!!t.editable||t.inlineAdd,allowMore:!1,enableXlsExport:!1,enablePdfExport:!1,hasTotalizer:!1},isValid:function(){return e.isValidGrid()},pageRequested:function(t){"execution"===r&&e.fetchData(t.page,t.sortBy,t.sortType)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){if("execution"===r){e.triggerHandler("rowSelected",{id:t.key,data:t})}},addRow:function(t){"execution"===r&&e.addRow()},editRow:function(t){"execution"===r&&e.editRow(t.key)},deleteRow:function(t){"execution"===r&&e.deleteRow(t.key)},saveAddedRows:function(t){e.saveInlineAddedRows(t.keys)},beforeInlineAdd:function(){e.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(){e.inlineAddDeferred&&e.inlineAddDeferred.resolve()},cancelEdition:function(t){e.removeNewRecords(t)},removeNewRecords:function(t){e.removeNewRecords(t)}})},fetchData:function(e,t,i){var r=this;r.dataReadyDeferred=new $.Deferred,r.startLoading(),$.when(r.getRemoteData()).then((function(e){r.endLoading(),e&&(r.updateData(e),r.triggerRenderChange(),r.dataReadyDeferred.resolve())}))},processChanges:function(){var e=[],t=this.properties.data;for(var i in this.changes){var r=[];for(var a in this.changes[i])if(this.canColumnBeSent(i,a)){var n=this.getColumn(a).columnIndex-1,o=this.changes[i][a].value?this.changes[i][a].value:this.changes[i][a];"string"==typeof o&&null!==o.match(/\n/gm)&&(o=o.replaceAll("\n","\\n")),r[n]={value:o,xpath:a,DataType:this.getColumn(a).properties.dataType}}if(void 0!==this.properties.data.rows&&this.properties.data.rows.length>0)for(var s=[],l=0;l<t.rows.length;l++)if(t.rows[l][0]==i){s=t.rows[l],t.rows.splice(l,1),l--,s=this.processRow(s),r=$.extend(!0,s,r);break}r.unshift(i),e.push(r)}return e},collectData:function(e){var t=[],i=this.properties,r=this.properties.data,a={};if(this.isValid([]))for(var n in this.changes){var o=[];for(var s in this.changes[n])if(this.canColumnBeSent(n,s)){var l=this.getColumn(s).columnIndex-1,d=this.changes[n][s].value?this.changes[n][s].value:this.changes[n][s];"string"==typeof d&&null!==d.match(/\n/gm)&&(d=d.replaceAll("\n","\\n")),o[l]={value:d,xpath:s,DataType:this.getColumn(s).properties.dataType}}if(void 0!==this.properties.data.rows&&this.properties.data.rows.length>0)for(var c=[],u=0;u<r.rows.length;u++)if(r.rows[u][0]==n){c=r.rows[u],r.rows.splice(u,1),u--,c=this.processRow(c),o=$.extend(!0,c,o),a[n]={values:o,idRow:n,position:u};break}t[t.length]=o}if((JSON.stringify(r.rows)!==JSON.stringify(r.originalRows)||t.length>0)&&(void 0!==r.rows&&t.length>0?e[i.xpath]=$.merge($.merge([],this.processOldRows(r.rows)),t):void 0!==r.rows&&r.rows.length>0?e[i.xpath]=this.processOldRows(r.rows):e[i.xpath]=t),t.length>0)for(var p=Object.keys(a),h=0;h<p.length;h++){var g=a[p[h]],f=$.merge([],g.values);f.unshift(g.idRow),r.rows.splice(g.position,0,f)}},processOldRows:function(e){for(var t=[],i=e,r=0,a=i.length;r<a;r++){var n=i[r];t[r]=$.grep(n,(function(e,t){return t>0}))}return t},processRow:function(e){return $.grep(e,(function(e,t){return t>0}))},drawCell:function(e,t,i,r){if(e.key)return i;"object"!==_typeof(i)||r||(i=i.hasOwnProperty("value")?i.value:i);var a=e.index-1,n=this.columns[a],o=this.getCellOverride(t,e.index-1);this.newRecords=this.newRecords||{},this.cellMetadata[t]||(this.cellMetadata[t]={}),this.cellMetadata[t][a]||(this.cellMetadata[t][a]={});var s=this.cellMetadata[t][a].properties||n.originalProperties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;if(l=o.visible,d=!!s.editable&&o.editable,r&&(d=!0),"summary"===t&&(d=!1),n.properties.displayType="value",n.setValue(t,i),n.setSurrogateKey(t),n.properties.data=n.properties.data||[],"columnSearch"===n.properties.type&&null!=i)for(var c=0,u=n.properties.data.length;c<u;c++)n.properties.data[c].id==i&&(i={id:n.properties.data[c].id,label:n.properties.data[c].value});if(("columnCombo"===n.properties.type||"columnList"===n.properties.type)&&null!=i)for(c=0,u=n.properties.data.length;c<u;c++)n.properties.data[c].id==i&&(i=[[n.properties.data[c].id,n.properties.data[c].value]]);return l?d?this.drawEditableCell(n,s,t,i,r):this.drawReadonlyCell(n,s,t,i):""},drawEditableCell:function(e,t,i,r,a){var n=this,o=new $.Deferred,s=e.properties.editable;return e.properties.editable=!0,e.overrideProperties({required:t.required}),$.when(e.render(i,r)).done((function(t){a&&!n.newRecords[i]&&(n.newRecords[i]={});for(var r=0;r<n.columns.length;r++)n.cellOverrides[i]=n.cellOverrides[i]||{},n.getCellOverride(i,r).visible=null==n.getCellOverride(i,r).visible||n.getCellOverride(i,r).visible;e.getDecorated(i).bind("renderchange",(function(r){n.onCellChange(e,t,i)})),o.resolve(t)})),e.properties.editable=s,o.promise()},drawReadonlyCell:function(e,t,i,r){var a="";if("summary"===i){var n=e.properties.textFormat;e.properties.totalize&&(e.properties.textFormat=e.properties.totalize.format),a=e.renderSummary(i,r),e.properties.textFormat=n}else a=e.renderReadOnly(i,r);return a},onCellChange:function(e,t,i){var r=e.getValue(i),a=e.getCompositeValue(i);if("columnDate"===e.properties.type&&1==e.data.properties.showTime)if(bizagi.util.isEmpty(r))""===r&&(r="");else{var n=bizagi.util.dateFormatter.getDateFromInvariant(r,!0);r=bizagi.util.dateFormatter.formatInvariant(n,!0)}else if("columnDate"===e.properties.type){if(bizagi.util.isEmpty(r))""===r&&(r="");else(n=bizagi.util.dateFormatter.getDateFromInvariant(r,!1)).setHours(0,0,0,0),r=bizagi.util.dateFormatter.formatInvariant(n,!0)}if(this.properties.allowEdit||this.grid.bizagi_grid_tablet("isNewRecord",i)){var o=!this.grid.bizagi_grid_tablet("isNewRecord",i);this.collectGridChange({id:i,xpath:e.properties.xpath,value:r,compositeValue:a,columnIndex:e.columnIndex,trigger:o,dataType:e.properties&&e.properties.type})}this.grid.bizagi_grid_tablet("changeCellValue",i,e.columnIndex,r),e.properties.totalize&&e.properties.totalize.operation&&this.grid.bizagi_grid_tablet("refreshSummary",e.columnIndex)},collectGridChange:function(e){var t=(e=e||{}).id,i=e.xpath,r=e.value,a=void 0===e.trigger||e.trigger;this.changes[t]=this.changes[t]||{},this.changes[t][i]=r,a&&this.triggerRenderChange({key:t,column:i})},onCellReady:function(e,t,i,r){r=!0,bizagi.rendering.tablet.grid.prototype.onCellReady.apply(this,arguments)},addRow:function(){bizagi.showMessageBox(bizagi.localization.getResource("render-tablet-error-userfield"),bizagi.localization.getResource("render-tablet-error-userfield"))},editRow:function(e){},deleteRow:function(e){var t=this;e&&0!=e?bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){$.when(t.submitDeleteRequest(e)).done((function(){t.fetchData()}))})):bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},editInline:function(e){},saveInlineAddedRows:function(e,t){var i=this.processChanges();bizagi.util.isEmpty(i)||(this.properties.data.rows=$.merge(this.properties.data.rows,i))},removeNewRecords:function(e){var t=this;e&&e.keys&&$.each(e.keys,(function(e,i){t.newRecords[i]&&(delete t.newRecords[i],delete t.changes[i])}))},getRemoteData:function(e){var t=this.properties;if(e=e||{},t.overrideGetRemoteData){var i=t.overrideGetRemoteData(e);return null!=i?i.promise():null}var r=new $.Deferred,a=t.data;if(t.page=a.page,t.records=a.records,t.totalPages=a.totalPages,!a.columns){a.columns=[];for(var n=0;n<this.columns.length;n++)a.columns.push(this.columns[n].properties.xpath)}for(var o=a.columns.length,s=a.rows.length,l=[],d=0;d<s;d++){var c=a.rows[d][0];a.rows[d].splice(0,1);for(var u=a.rows[d],p=[],h=0;h<o;h++){var g=void 0!==u[h]?a.columns.indexOf(u[h].xpath):-1;-1!=g&&(p[g]=u[h]),p[h]=void 0===p[h]?{}:p[h]}l.push($.merge([c],p))}return a.rows=l,this.isRTL()&&(a.rows=this.changeOrderData(a.rows)),r.resolve(a),r.promise()},submitDeleteRequest:function(e){for(var t=this.properties.data,i=0,r=t.rows.length;i<r;i++)if(t.rows[i][0]==e){t.rows[i],t.rows.splice(i,1),i--,t.records--,!0;break}return delete this.newRecords[e],delete this.changes[e],t.rows},isValidGrid:function(){var e=[],t=this.getFormContainer();if(void 0!==t.validationController&&t.validationController.clearValidationMessages(),this.isValid(e),e.length>0){if(void 0!==t.validationController)for(var i=0;i<e.length;i++)t.validationController.showValidationMessage(e[i].message,e[i].xpath);return!1}return!0}}),bizagi.rendering.tablet.grid.extend("bizagi.rendering.tablet.grid.grouped",{},{postRender:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")},postRenderReadOnly:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.collectionnavigator",bizagi.rendering.collectionnavigator.prototype),bizagi.rendering.tablet.collectionnavigator.extend("bizagi.rendering.tablet.collectionnavigator",{},{postRender:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")},postRenderReadOnly:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.search",bizagi.rendering.search.prototype),bizagi.rendering.tablet.search.extend("bizagi.rendering.tablet.search",{ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,CLEAR_SEARCH_ID:-3,NO_RESULTS_SEARCH_ID:-4,DEFAULT_SEARCH_ID:"",SEARCH_MIN_LENGTH:3,SEARCH_DELAY:250,SEARCH_MAX_RECORDS:50},{initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.properties.submitOnChange=!this.isOfflineForm&&this.properties.submitOnChange,this.deferredReference=null},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly"),t=this.getDisplayValue(),i=t.label||t.value;return void 0!==i?"object"==_typeof(i)&&(i=i.join(" - ")):i="","string"==typeof i&&(t.additionallabel&&(i+=" - "+t.additionallabel),i=bizagi.util.sanitizeHTML(i)),$.fasttmpl(e,{value:i,editable:this.properties.editable})},postRender:function(){this.searchInput=$(".bz-input-icon",this.getControl())},postRenderReadOnly:function(){this.searchInput=$(".bz-input-icon",this.getControl())},configureHandlers:function(){var e=this,t=e.getControl();$(".bz-input-icon",t).on("click",(function(){!e.properties.advancedSearch||e.isOfflineForm?e._simplySearchView():e._advanceSearchView()})),$(".bz-icn--clear",t).bind("click",(function(i){$(".bz-input-icon",t).addClass("bz-input-icon--empty"),e.cleanData(),e.readyActionExecution().done((function(){e.properties.submitOnChange&&e.submitData()})),i.stopPropagation()}))},configureModalViewHandlers:function(e){var t=this;t.modalViewList=$(".bz-list",e.content);var i=bizagi.util.debounce((function(e){t.autoCompleteSearchResults($.trim(e))}),t.Class.SEARCH_DELAY);$("[data-action=close]",e.header).bind("click",(function(){e.close()}));var r=$(".bz-modal-view__clear",e.header),a=$(".bz-modal-view__search",e.header);r.bind("click",(function(){a.val("").trigger("clean")})),$(".bz-list",e.content).on("click","li",(function(){var i=$.data(this).item;!i||i&&i.id==t.Class.NO_RESULTS_SEARCH_ID||(t.selectItem(i),e.close())})),a.bind("clean keyup",(function(){""==this.value?r.removeClass("bz-modal-view__clear--visible"):r.addClass("bz-modal-view__clear--visible"),i(this.value)})).on("focus",(function(){e.header.addClass("bz-modal-view__header--active")})).on("blur",(function(){e.header.removeClass("bz-modal-view__header--active")}))},_advanceSearchView:function(){var e=this,t=e.properties,i=$.extend({},e.getParams(),{container:e.getFormContainer().container,title:t.displayName||"",allowNew:t.allowNew});new bizagi.rendering.tablet.slide.searchForm(e.dataService,e.renderFactory,t.searchForms,{allowFullSearch:t.allowFullSearch,maxRecords:t.maxRecords,idRender:t.id,navigation:e.getParams().navigation,idPageCache:t.idPageCache,orientation:t.orientation||"ltr",editable:t.editable},i).render({idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:t.idPageCache}).done((function(t){e.setValue(t),e.readyActionExecution().done((function(){var t=e.getFormContainer();e.properties.submitOnChange||$.when(t.submitData()).done((function(){e.refreshControl()}))}))}))},_simplySearchView:function(){var e=this,t=e.getContentTemplate();e.searchInput.mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),orientation:e.properties.orientation||"",contentTemplate:t,style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.configureModalViewHandlers(t)}})},autoCompleteSearchResults:function(e){var t=this;$.when(t.processRequest({term:e})).done((function(e){t.modalViewList.find("li").remove();for(var i=0,r=e.length;i<r;i++){t.renderSearchItem(e[i]).appendTo(t.modalViewList)}}))},renderSearchItem:function(e){var t=this.renderFactory.getTemplate("search.item"),i=$.tmpl(t,{id:e.id,label:e.label,value:e.value});return i.data("item",e),i},processRequest:function(e){var t=this,i=t.properties,r=new $.Deferred,a=[];if(t.properties.allowSuggest&&e.term.length>=t.properties.searchLength){i.term=e.term;var n=t.isOfflineForm?t.getOfflineData():t.getData();t.deferredReference&&"function"==typeof t.deferredReference.reject&&"resolved"!==t.deferredReference.state()&&t.deferredReference.reject({hideStatus:!0}),t.deferredReference=n.done((function(n){n&&n.length>0?((n=n.slice(0,i.maxRecords)).length>t.Class.SEARCH_MAX_RECORDS?(n=n.slice(0,t.Class.SEARCH_MAX_RECORDS),a.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-search-maximum-records-allowed"),value:""})):n=n.slice(0,i.maxRecords),a.push({id:t.Class.DEFAULT_SEARCH_ID,label:t.getResource("render-combo-empty-value"),value:""}),$.each(n,(function(t,r){if(0===i.maxRecords||t<i.maxRecords){var n=bizagi.util.performTermMatches(r.value,e.term);a.push({id:r.id,label:n,value:r.value})}}))):a.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-grid-no-records"),value:""}),r.resolve(a)})).fail((function(){r.reject()}))}else r.resolve(a);return r.promise()},setDisplayValue:function(e){var t="";if(null!=(e=this.mapValue(e))&&void 0!==e.id){t=e.additionallabel&&e.label?e.label+" - "+e.additionallabel:e.label?e.label:"";var i=this.searchInput.find("input");i.val(t),i.attr("id",e.id),""!==e.id&&this.properties.allowClear&&$(".bz-input-icon",this.getControl()).removeClass("bz-input-icon--empty"),this.properties.editable&&this.setValue(e,!0)}},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.properties.submitOnChange&&null!=e[this.properties.xpath].id&&this.submitOnChange(e,!0)},cleanData:function(){var e={id:"",value:""};bizagi.util.isEmpty(this.value)&&(e={}),this.setValue(e),this.setDisplayValue(e)},getContentTemplate:function(){var e=this.renderFactory.getTemplate("search.items"),t=$.fasttmpl(e,{});return $.trim(t)},selectItem:function(e){var t=this.hasValue(),i=Array.isArray(e.value)?e.value.join(" - "):e.value;this.setDisplayValue({id:e.id,label:i}),this.properties.allowClear&&(e.id===this.Class.DEFAULT_SEARCH_ID?(this.searchInput.find(".bz-search__clear").addClass("bz-search--hidden"),this.searchInput.find(".bz-search__icon").removeClass("bz-search--hidden")):t||e.id===this.Class.DEFAULT_SEARCH_ID||(this.searchInput.find(".bz-search__clear").removeClass("bz-search--hidden"),this.searchInput.find(".bz-search__icon").addClass("bz-search--hidden")))},getOfflineData:function(){var e=this.properties.data||[],t=(this.properties.term||"").toLowerCase();return $.when(t.startsWith("%%")?e:e.filter((function(e){var i=e&&e.value?e.value:"";return"object"===_typeof(i)&&(i=i.toString()),i.toLowerCase().indexOf(t)>-1})))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.letter",bizagi.rendering.letter.prototype),bizagi.rendering.tablet.label.extend("bizagi.rendering.tablet.letter",{},{}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.button",bizagi.rendering.button.prototype),bizagi.rendering.tablet.button.extend("bizagi.rendering.tablet.button",{},{isOfflineForm:!1,initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this})},configureHandlers:function(){var e=this;$(":button",e.getControl()).on("click",(function(){e.processButton()}))},executeButton:function(){return!this.isOfflineForm&&this._super()},processButton:function(){var e=this;e.properties.editable&&(e.properties.needsUserConfirmation?$.when(bizagi.showConfirmationBox(e.properties.userConfirmationMessage,"Bizagi","warning")).done((function(){e.properties.preventDefault||e.runButtonAction(),e.triggerRenderChange({pressed:!0})})):(e.properties.preventDefault||e.runButtonAction(),e.triggerRenderChange({pressed:!0})))},getElementsToStylize:function(e){return $("button",e)},changeFontBold:function(e,t){return bizagi.util.parseBoolean(t)&&e.css("font-weight","bold"),this}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.fileprint",bizagi.rendering.fileprint.prototype),bizagi.rendering.tablet.fileprint.extend("bizagi.rendering.tablet.fileprint",{},{postRender:function(){this.getControl().parent().hide()}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.link",bizagi.rendering.link.prototype),bizagi.rendering.tablet.link.extend("bizagi.rendering.tablet.link",{},{postRender:function(){var e=this.getControl();this.link=e.find(".bz-link"),this._super(),this.preventDefaultForAnchorTag()},postRenderReadOnly:function(){var e=this.getControl();this.link=e.find(".bz-link"),this._super()},setDisplayValue:function(e){this.setValue(e,!1),this.isValidValue()&&(e=getFullyDecodedURI($.trim(e)),this.link.attr("href",e))},configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},attachEvents:function(){var e=this;e.isValidValue()?e.link.on("click",(function(t){t.preventDefault(),t.stopPropagation();var i=encodeURI(this.getAttribute("href"));e.linkSolver(i,e.properties.linktarget)})):e.link&&e.link.addClass("bz-link--disabled")},isValidValue:function(){return this.hasValue()&&null!==$.trim(this.getValue()||"").toLowerCase().match(/^(http|https):\/\//)||!1},linkSolver:function(e,t){"newwindow"===t||bizagi.util.isCordovaSupported()?window.open(e,"_system","location=yes"):window.open(e,"_system")},processLayout:function(e){e?void 0!==this.properties.textFormat.background&&this._super(e,{background:this.properties.textFormat.background}):this._super(e,this.properties.textFormat)},getElementsToStylize:function(e){return $(".bz-link",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.formLink",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},bizagi.rendering.formLink.prototype),bizagi.rendering.tablet.formLink.extend("bizagi.rendering.tablet.formLink",{},{configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},openLink:function(){var e=this;$.when(e.submitEditRequest()).done((function(){bizagi.loading.start(),$.when(e.paintFormLink()).done((function(){bizagi.loading.stop()})).fail((function(){bizagi.loading.start(),e.rollbackForm()})).always((function(){bizagi.loading.stop()}))})).always((function(){bizagi.loading.stop()}))},openLinkRule:function(e){var t=this,i=new $.Deferred;return bizagi.loading.start(),t.getPropertyValue(e,{}).done((function(r){if(void 0!==(r=r||{}).messages&&null!==r.messages){var a=r.messages[0];t.getFormContainer().validationController.showErrorMessage(a),i.reject()}else"entryrule"===e&&t.openLink();i.resolve()})).fail((function(){i.reject()})).always((function(){bizagi.loading.stop()})),i.promise()},paintFormLink:function(){var e=this,t=e.properties,i=e.getFormContainer(),r=e.getFormParams(),a=$.Deferred();return new bizagi.rendering.tablet.slide.view(e.dataService,e.renderFactory,{title:e.properties.displayName||"",container:i.container,navigation:e.getParams().navigation,showSaveButton:t.editable,orientation:t.orientation||"ltr",onSave:function(t){return e.actionSave(t).then((function(t){return e.submitForm(t).done((function(){a.resolve(t)})).fail((function(){a.reject()}))})).fail((function(e){a.reject(e)}))},goBack:function(){e.rollbackForm()}}).render({idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,recordXPath:e.getFormLinkXpath(),requestedForm:"linkform",editable:t.editable,formParams:r,url:t.editPage}).fail((function(){a.reject()})),a.promise()},getPropertyValue:function(e,t){var i=this,r=i.properties,a=new $.Deferred;return i.dataService.multiaction().getPropertyData({url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done((function(e){"error"===e.type?(i.getFormContainer().validationController.showErrorMessage(e.message),a.reject(e)):a.resolve(e)})).fail((function(e,t,r){i.getFormContainer().validationController.showErrorMessage(e.message),a.reject(e,t,r)})),a.promise()},actionSave:function(e){var t=this,i=$.Deferred();return $.when(t.submitSaveRequest(e)).done((function(e){try{"validationMessages"===e.type?t.form.addValidationMessage(e.messages):"error"===e.type&&i.reject(e),i.resolve(e)}catch(e){i.reject({noAction:!0})}})).fail((function(e){i.reject(e)})),i.promise()},submitSaveRequest:function(e){var t=this.properties;if(!1===t.editable&&!t.value)return null;var i=this.getFormLinkXpath(),r=i;return void 0!==t.xpathContext&&""!==t.xpathContext&&(r=i?t.xpathContext+"."+i:t.xpathContext),this.dataService.saveLinkForm({url:t.saveUrl,idRender:t.id,xpathContext:r,submitData:e})},submitForm:function(e){var t=this,i=$.Deferred(),r=!0;return e&&"validationMessages"===e.type&&(r=!1),t.properties.hasexitrule?t.closeExitRule().done((function(){r&&t.submitCommitRequest().done((function(){t.properties.hasentryrule?t.submitCommitRequest().done((function(){$.when(t.submitOnChange()).done((function(){i.resolve(e)}))})):$.when(t.submitOnChange()).done((function(){i.resolve(e)}))}))})).fail((function(){i.reject()})):r&&r&&t.submitCommitRequest().done((function(){t.properties.hasentryrule?t.submitCommitRequest().done((function(){$.when(t.submitOnChange()).done((function(){i.resolve(e)}))})):$.when(t.submitOnChange()).done((function(){i.resolve(e)}))})).fail((function(){i.reject()})),i.promise()},closeExitRule:function(){var e=this.properties,t=new $.Deferred;return e.hasexitrule&&$.when(this.openLinkRule("exitrule")).done((function(e){t.resolve(e)})).fail((function(){t.reject()})),t.promise()},rollbackForm:function(){var e=this,t=e.form||e.getFormContainer();$.when(e.submitRollbackRequest({idPageCache:t.idPageCache})).done((function(){e.properties.hasentryrule&&e.submitRollbackRequest({idPageCache:t.idPageCache})}))},getFormLinkXpathContext:function(){var e=this.properties.xpathContext,t=this.getXpathContext();return t&&e?0===e.indexOf(t)?e:t+"."+e:e},attachEvents:function(){var e=this,t=e.getControl();$("[data-action=open]",t).on("click",(function(){if(e.properties.hasentryrule){var t=e.getFormContainer();$.when(t.saveForm()).done((function(){e.submitCheckpointRequest().done((function(){return e.openLinkRule("entryrule")}))}))}else e.openLink()}))},processLayout:function(e){e?void 0!==this.properties.textFormat.background&&this._super(e,{background:this.properties.textFormat.background}):this._super(e,this.properties.textFormat)},getElementsToStylize:function(e){return $(".bz-link",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.hidden",bizagi.rendering.hidden.prototype),bizagi.rendering.tablet.hidden.extend("bizagi.rendering.tablet.hidden",{},{}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.radio",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.radio.extend("bizagi.rendering.tablet.radio",bizagi.rendering.radio.prototype),bizagi.rendering.tablet.radio.extend("bizagi.rendering.tablet.radio",{},{postRender:function(){var e=this.getControl();this.radio=e.find("input[type=radio]"),!this.properties.editable||null!=this.value&&void 0!==this.value||null==this.properties.value||(this.value=this.properties.value)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.radio=e.find("input")},setDisplayValue:function(e){var t=this.getControl();(e=this.mapValue(e),this.setValue(e,!1),void 0!==e&&null!=e.id&&""!==e.id)&&(this.properties.editable?t.find('input[type="radio"][value="'+e.id+'"]').prop("checked","checked"):(this.radio.val(this.getDisplayValue()),this.radio.attr("id",e.id)))},configureHandlers:function(){var e=this;this.radio.change((function(){var t=$(this),i={id:t.prop("value"),value:$.trim(t.siblings("label").text())};e.setValue(i)}))},getElementsToStylize:function(e){return $("label.bz-radio__label, .bz-input.bz-input--readonly",e)},cleanData:function(){this.setValue({id:"",label:""},!1),this.clearDisplayValue()},clearDisplayValue:function(){this.properties.editable?this.radio.prop("checked",!1):this.radio.val(this.getDisplayValue())},getSelectedValue:function(){return this.selectedValue}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.cascadingCombo",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.cascadingCombo.extend("bizagi.rendering.tablet.cascadingCombo",bizagi.rendering.cascadingCombo.prototype),bizagi.rendering.tablet.cascadingCombo.extend("bizagi.rendering.tablet.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{renderControl:function(){var e=this.getMode();return this.parentCombo=this.getParentCombo(),null!=this.parentCombo&&/cascadingcombo/i.test(this.parentCombo.properties.type)&&(this.isDependant=!0),this.initializingCascadingCombo=!0,"execution"!=e&&(this.initializingCascadingCombo=!1),bizagi.rendering.tablet.combo.prototype.renderControl.apply(this,arguments)},postRender:function(){bizagi.rendering.tablet.combo.prototype.postRender.apply(this,arguments)},configureHandlers:function(){this._super(),bizagi.rendering.tablet.combo.prototype.configureHandlers.apply(this,arguments)},cleanData:function(){bizagi.rendering.tablet.combo.prototype.cleanData.apply(this,arguments)},refresh:function(e,t){var i=this;$.when(i.isRendered()).done((function(){var e=i.getControl(),r=i.getMode();e.empty(),$.when(i.renderControl()).then((function(a){e.html(a),i.postRender(),"execution"==r&&i.configureHandlers(),t?i.setDisplayValue(i.getValue()):i.setDisplayValue({id:"",value:""}),i.deferredVisible&&i.deferredVisible.resolve(),i.trigger("select",[i.getValue(),t])}))}))},setDisplayValue:function(e){bizagi.rendering.tablet.combo.prototype.setDisplayValue.apply(this,arguments)},processComboData:function(){bizagi.rendering.tablet.combo.prototype.processComboData.apply(this,arguments)},validateValue:function(){return bizagi.rendering.tablet.combo.prototype.validateValue.apply(this,arguments)},renderComboTemplate:function(){return bizagi.rendering.tablet.combo.prototype.renderComboTemplate.apply(this,arguments)},configureModalViewHandlers:function(){bizagi.rendering.tablet.combo.prototype.configureModalViewHandlers.apply(this,arguments)},configureCombo:function(){bizagi.rendering.tablet.combo.prototype.configureCombo.apply(this,arguments)},changeCombo:function(e,t){bizagi.rendering.tablet.combo.prototype.changeCombo.apply(this,arguments)},getSelectedValue:function(){return bizagi.rendering.tablet.combo.prototype.getSelectedValue.call(this,arguments)},getTemplateName:function(){return"combo"},filterList:function(e,t){return bizagi.rendering.tablet.combo.prototype.filterList.call(this,e,t)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.list",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.list.extend("bizagi.rendering.tablet.list",bizagi.rendering.list.prototype),bizagi.rendering.tablet.list.extend("bizagi.rendering.tablet.list",{},{renderControl:function(){var e=this.renderFactory.getTemplate("list");return $.fasttmpl(e,{editable:this.properties.editable,value:this.getDisplayValue()})},postRenderReadOnly:function(){},configureHandlers:function(){var e=this,t=e.getControl();"execution"===e.getMode()&&$(".bz-form-list",t).bind("click",(function(){$(this).mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),displayName:e.properties.displayName||"",orientation:e.properties.orientation||"",contentTemplate:"",style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},open:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){$.when(e.renderCombo({})).done((function(i){$(".bz-modal-view__content",t.content).html(i),e.configureModalViewHandlers(t)}))}})}))},processComboData:function(e){var t=this;e.forEach((function(e){t.validateValue(e)}))},setDisplayValue:function(e){var t,i=this.getControl();if((e=this.mapValue(e))&&"object"===_typeof(e)&&void 0!==e.label){if(""===e.label||bizagi.util.isNumeric(e.label)){var r=this.findDataValueById(e.value);t=r?r.value:""}else t=e.label;$.isArray(t)&&(t=t.join(" - ")),e={id:e.id,value:t}}$("input",i).val(this.formatItem(e.value)),this.selectedValue=e,this.setValue(e)},configureModalViewHandlers:function(e){var t=this;$(".bz-list__item",e.content).on("click",(function(){var i={id:$(this).data("value"),value:$(this).text()};""==i.id&&(i.value=""),t.setDisplayValue(i),t.trigger("select",[i,!1]),e.close()}));var i=$(".bz-list li",e.content),r=$(".bz-modal-view__clear",e.header),a=$(".bz-modal-view__search",e.header);$("[data-action=close]",e.header).bind("click",(function(){e.close()})),r.bind("click",(function(){a.val("").trigger("change")})),a.bind("change keyup",(function(){""==this.value?r.removeClass("bz-modal-view__clear--visible"):r.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)})).focus()},filterList:function(e,t){t.filter((function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()})).show()},renderComboTemplate:function(e){var t=this.renderFactory.getTemplate("list-items"),i=this.getValue();return i=null!=i?i:{id:"",value:""},$.fasttmpl(t,{items:e,selectedId:i.id,hasItems:e.length>0},{validateItem:this.validateValue})},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".readonly-control",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.multiSelect",bizagi.rendering.multiSelect.prototype),bizagi.rendering.tablet.multiSelect.extend("bizagi.rendering.tablet.multiSelect",{MORE_OPTION_WIDTH:40,SEARCH_MIN_LENGTH:1},{initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("searchList.readonly"),t=this.getDataValue()||[];return $.fasttmpl(e,{items:t,editable:this.properties.editable||!0},{formatItem:this.formatItem})},postRender:function(){var e=this;this.isExecutionMode()&&this.getData().done((function(t){e.properties.data=t})),this._super()},configureHandlers:function(){var e=this,t=e.getControl();$("[data-action=modal]",t).bind("click",(function(){e.openModalView()}))},setDisplayValue:function(e){var t=this;if(this._super(e),void 0!==e){var i=(t.getDataValue()||[]).map((function(e){return t.formatItem(e.value)})).join(", ");$(".bz-input-icon__input",this.getControl()).html(i)}},openModalView:function(){var e=this;e.getData().done((function(t){var i=e.renderFactory.getTemplate("multiselect-list"),r=e.getDataValue()||[],a={values:t,isChecked:function(t){return e.isChecked(r,t)}},n=$.fasttmpl(i,a,{formatItem:e.formatItem}),o=e.renderFactory.getTemplate("modal-footer-done"),s=$.fasttmpl(o,{});e.getControl().mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{hideSearch:!1===e.properties.enableTyping}),orientation:e.properties.orientation||"",contentTemplate:n,footerTemplate:s,style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.configureModalViewHandlers(t)}})}))},configureModalViewHandlers:function(e){var t=this,i=$(".bz-checkbox-list li",e.content),r=$(".bz-modal-view__clear",e.header),a=$(".bz-modal-view__search",e.header);this.properties.enableTyping&&(a.on("change keyup",(function(){""===this.value?r.removeClass("bz-modal-view__clear--visible"):r.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)})).on("focus",(function(){e.header.addClass("bz-modal-view__header--active")})).on("blur",(function(){e.header.removeClass("bz-modal-view__header--active")})),r.on("click",(function(){a.val("").trigger("change")}))),$("[data-action=close]",e.header).on("click",(function(){e.close()})),$(e.footer).on("click","[data-action=save]",(function(){var r=[];$.each.call(this,i,function(e,t){var i=t.querySelector("input");if(i.checked){var a=i.getAttribute("data-id"),n=this.findItemById(a).value;r.push({id:a,value:n})}}.bind(t)),t.setDisplayValue(r),e.close()}))},getData:function(){var e=this;return this.isOfflineForm?this.getOfflineData():$.when(this._super()).fail((function(t){var i=bizagi.util.getErrorFormatted(t),r=void 0===i?{message:bizagi.localization.getResource("workportal-general-error")}:i;e.getFormContainer().failHandler(r)}))},getOfflineData:function(){var e=this.properties.data||[];return $.when(this.normalizeData(e))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.handSignature",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.handSignature.prototype),bizagi.rendering.tablet.handSignature.extend("bizagi.rendering.tablet.handSignature",{},{isNative:!1,isOfflineForm:!1,initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported()},configureHandlers:function(){var e=this,t=$(".bz-actions",this.getControl()),i=e.getSignatureContainer(),r=bizagi.util.debounce2((function(t){if(a){var i=Array.prototype.slice.call(t||[]),r=(i&&i[0]||[]).dataImage||"";e.saveDeferred=$.when(e.saveSignature(r))}}),e.isOfflineForm?0:e.DELAY_TO_SAVE),a=!1;i.bind("change",(function(){if(a=!0,$(this).BzjSignature("isModified")){e.saveTimestamp=(new Date).getTime();var t=$(".bz-signature__container-canvas",this)[0].toDataURL("image/png");r.fire({dataImage:t}),e.setData(t.replace(/^data:image\/(png|jpg|jpeg);base64,/,"")),e.properties.url=t,e.setState(e.STATE_TYPE.done)}})),t.on("click","[data-action='clear']",(function(){a=!0,r.cancel(),e.onSignatureClear(i)})),t.on("click","[data-action='edit']",(function(){e.onSignatureEdit(i),a=!1})),t.on("click","[data-action='save']",(function(){if(!a)return e.setState(e.STATE_TYPE.edit),void i.BzjSignature("disable");e.onSignatureSave(i,r),a=!1}))},onSignatureClear:function(e){var t,i=this;return e.BzjSignature("reset"),i.hasValue()&&(bizagi.loading.start(),i.setData(i.EMPTY_VALUE),i.properties.url=i.EMPTY_VALUE,t=i.deleteSignature(),$.when(t).then((function(e){i.setData(e),i.properties.url=e})).fail((function(e){i.executeFormFailHandler(e)})).always((function(){bizagi.loading.stop()}))),$.when(t)},onSignatureEdit:function(e){this.setState(this.STATE_TYPE.draw),e.BzjSignature("enable")},onSignatureSave:function(e,t){var i=this;if(e.BzjSignature("disable"),e&&e.BzjSignature("isModified")){var r=$(".bz-signature__container-canvas",e)[0];bizagi.loading.start(),t.cancel(),i.saveSignature(r.toDataURL("image/png")).always((function(){i.setState(i.STATE_TYPE.edit),bizagi.loading.stop()}))}else i.setState(i.STATE_TYPE.edit)},renderSignature:function(){var e=this.getSignatureContainer();e.empty(),e.BzjSignature({sizeRatio:3,cssclass:"bz-signature__container-canvas",color:"#000"}),e.BzjSignature("disable"),this.pluginInitialized&&this.properties.url?this.setSignature(e):this.renderSignatureValue(e);var t=$(".bz-signature__container-canvas",e),i=Math.round(t.width()/3);t.attr("height",i).css("height",i),t.css("width","100%"),this.pluginInitialized=!0},renderSignatureValue:function(e){var t=this;bizagi.util.sleepUntil((function(){return!t.dataService.getFileService().isLoading(t)})).then((function(){return t.buildItemUrl()})).then((function(i){if(!t.isDisposed()){i===t.BASE_IMAGE+t.EMPTY_IMAGE&&(i="");var r=""!==i?i:"";t.properties.url=r,bizagi.util.isEmpty(r)?t.setData(t.EMPTY_VALUE):e.BzjSignature("setData",r)}}))},postSignature:function(e){var t=e.replace(/^data:image\/(png|jpg|jpeg);base64,/,"");return this.isOfflineForm?this.postSignatureOffline(t):this.postSignatureOnline(t)},postSignatureOffline:function(e){var t=this;return t.saveImageOffline(e).then((function(){return t.properties.isChanged=!0,e}))},deleteSignature:function(){var e=this;return e.isOfflineForm?e.saveImageOffline(e.EMPTY_IMAGE).then((function(){return e.properties.isChanged=!0,e.EMPTY_VALUE})):this.deleteImage().then((function(){return e.EMPTY_VALUE}))},buildItemUrl:function(e){return this.isOfflineForm?this.buildItemUrlOffline(e):this._super(e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.association",bizagi.rendering.association.prototype),bizagi.rendering.tablet.association.extend("bizagi.rendering.tablet.association",{},{renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done((function(r){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(r)||!1;var a=e.getColumnData(),n=$.fasttmpl(t,$.extend(e.properties,{columnData:a}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(n)})),i.promise()},getColumnData:function(){var e=this,t=e.properties,i=[];e.data=t;var r=t.flipped?t.rightData:t.leftData;return $.each(r,(function(t,r){i.push({id:r.id,value:r.value,association:e.getRightAssociation(r.id)})})),i},postRender:function(){var e="execution"===this.getMode(),t=this.getControl();this.association=$(".bz-association",t),e&&this.addEventControl(),this.showDefaultGroupList()},showDefaultGroupList:function(){var e=this.getControl(),t=$(".bz-association-group",e);t.length>0&&($("[data-action='collapse']",t[0]).toggleClass("bz-icn--expanded"),$(".bz-association-group__list",t[0]).slideDown(300,(function(){$(this).toggleClass("bz-association-group__list--hidden")})))},addEventControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=e.getControl();e.association.on("change","input:checkbox",(function(){var t=$(this),i=t.data("parent-id"),r=t.data("id");t.prop("checked")?e.addElement(i,r):e.removeElement(i,r)})),e.association.find("[data-action='flip']").click((function(){$(i).empty(),e.properties.flipped=!e.properties.flipped,e.properties.flipstate=e.properties.flipped,e.dataService.getFlipAssociation(e.properties);var r=e.getColumnData();$($.fasttmpl(t,$.extend(e.properties,{columnData:r}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation})).appendTo(i),e.postRender()})),e.association.on("click","[data-action='collapse']",(function(){var t=$(this),i=t.parents(".bz-association-group").find(".bz-association-group__list");e.closeAccordionSection(),i.hasClass("bz-association-group__list--hidden")&&(t.toggleClass("bz-icn--expanded"),i.slideDown(300,(function(){$(this).toggleClass("bz-association-group__list--hidden")})))}))},closeAccordionSection:function(e){var t=this.getControl();$("[data-action='collapse']",t).removeClass("bz-icn--expanded"),$(".bz-association-group__list",t).slideUp(300,(function(){$(this).addClass("bz-association-group__list--hidden")}))},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.postRender()},setDisplayValue:function(e){this.setValue(e,!1)},getLabel:function(){if(!this.label){var e=$("> .bz-form-label",this.element||this.observableElement);return e.length>0&&(this.label=e),e}return this.label}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.ecm.prototype),bizagi.rendering.tablet.ecm.extend("bizagi.rendering.tablet.ecm",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"],ERROR_ECM_NO_AVAILABLE:3,ACTION_DETAILS:"details",ACTION_EDIT:"edit"},{isNative:!1,initializeData:function(e){this._super(e),this.isNative=bizagi.util.isCordovaSupported(),this.fileData=[]},renderControl:function(){var e=this.renderFactory.getTemplate("ecm");return this.files=this.properties.value||[],this.filesCount=this.files.length,this.renderItem(e,{})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("ecm-readonly"),t={noFiles:0===this.filesCount};return this.renderItem(e,t)},renderItem:function(e,t){for(var i="",r=$.fasttmpl(e,t),a=0;a<this.filesCount;a++){i+=this.renderUploadItem(this.files[a])}return r=this.replaceFilesHtml(r,i)},renderUploadItem:function(e){var t=this.renderFactory.getTemplate("ecm-item"),i=this.getFormContainer(),r={id:this.properties.id,idFileUpload:e[0],fileName:e[1],editable:this.properties.editable,xPath:this.properties.xpath,xpathContext:this.getXpathContext()||i.properties.xpathContext||"",idPageCache:this.properties.idPageCache,idAttrib:this.properties.idAttrib,sessionId:i.properties.sessionId},a=$.extend({},r);return r.url=this.buildItemUrl(a),e.getFileProperties=$.when(this.renderFileLayout(r)),$.fasttmpl(t,r)},renderFileLayout:function(e){var t=this,i=t.getFormContainer(),r=new $.Deferred,a=$.extend({},e);return $.when(t.dataService.metadataECMMultiaction().getECMMetadata(e),t.dataService.metadataECMMultiaction().getFileProperties(a)).done((function(n,o){Array.isArray(o)&&(o=o[0]),Array.isArray(n)&&(n=n[0]),o.idAttrib=t.properties.idAttrib,o.showMetadata=t.properties.showMetadata,o.xpathContext=t.getXpathContext()||i.properties.xpathContext||"",o.xpath=t.properties.xpath,o.fileName=e.fileName,o.idPageCache=t.properties.idPageCache,o.fileData=a;var s=$.extend({},o,n);r.resolve(s)})),r.promise()},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},postRender:function(){var e=this.getControl();this.$contentFile=$(".bz-file-upload__container",e),this.$inputFile=$(".bz-file-upload__input",e),this.$nativeFile=$(".bz-file-upload__native",e)},configureHandlers:function(){this.checkFileExtensions(),this.attachEvents()},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-readonly-lists",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()}))}))},saveImage:function(){var e="";this.editedImageURL?e=this.editedImageURL:this.fileProperties&&(e=this.fileProperties.url);var t={dataFile:bizagi.util.media.getImagePath(e),fileName:this.fileProperties.name,mimeType:"image/jpeg"};return this.editedImageURL=null,this.fileProperties=null,this.uploadFile(t)},saveVideo:function(e){var t={dataFile:e[0].fullPath,fileName:e[0].name,mimeType:"video/quicktime"};return this.uploadFile(t)},uploadFile:function(e){var t=this,i={},r=t.buildAddParams();return r.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),r.xPath=r.xPath,r.Filename=e.fileName,i.data=r,i.options=new FileUploadOptions,i.options.fileKey="file",i.options.fileName=e.fileName,i.options.uploadKey={key:"Filedata"},i.options.addUrl=t.properties.addUrl,i.dataFile=e.dataFile,e.mimeType&&(i.options.mimeType=e.mimeType),$.when(bizagi.util.media.uploadFile(i)).then((function(e){t.onUploadFileCompleted(JSON.parse(decodeURIComponent(e.response)))})).fail((function(e){t.executeFormFailHandler(e)}))},attachEvents:function(){var e=this,t=e.getControl();$.each(e.files,(function(t,i){e.attackMenuEvents(i)})),this.$contentFile.off("click").on("click",(function(t){e.chooseFile()})),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",(function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()}))})),e.isNative?(this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-file-upload__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.handlerResolutionUpload(t.guid)).always((function(){bizagi.loading.stop()}))},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})):(this.$inputFile.off("change").on("change",(function(){e.addFile(),this.value=""})),this.$inputFile.off("click").on("click",(function(e){e.stopPropagation()})))},addMenuEvents:function(e,t){var i=this,r=e.find(".bz-file-menu"),a=[];t.showMetadata&&a.push({name:i.getResource("render-collection-navigator-details-form"),fn:function(){i.processActionByType(i.Class.ACTION_DETAILS,t,e)}}),t.showMetadata&&t.allowUpdateMetadata&&a.push({name:i.getResource("render-collection-navigator-edit-form"),fn:function(){i.processActionByType(i.Class.ACTION_EDIT,t,e)}}),t.allowCheckOut&&a.push({name:i.getResource("render-ecm-bt-lock"),fn:function(){i.lockECMFile(e,t)}}),t.allowCancelCheckOut&&a.push({name:i.getResource("render-ecm-bt-unlock"),fn:function(){i.unlockECMFile(e,t)}}),t.allowDelete&&a.push({name:i.getResource("render-ecm-bt-delete"),fn:function(){i.deleteECMFile(e,t.idFileUpload)}}),r.overflowMenu({items:a})},deleteECMFile:function(e,t){var i=this;bizagi.showConfirmationBox(this.getResource("render-ecm-confirm-message")).done((function(){$.when(i.deleteUploadItem(e,t)).done((function(){e.hide(),e.remove(),i.setValue(i.files,!1),i.checkMaxFiles(),i.triggerRenderChange()}))}))},checkMaxFiles:function(){this.isMaxFilesReached()?$(this.$contentFile).addClass("bz-file-upload__container--hidden"):$(this.$contentFile).removeClass("bz-file-upload__container--hidden")},isMaxFilesReached:function(){var e=this.properties.maxfiles,t=this.properties.value?this.properties.value.length:0;return 0!==e&&this.filesCount>=e&&t>=e},executeFormFailHandler:function(e){var t="";t=e&&e.code===this.Class.ERROR_ECM_NO_AVAILABLE?this.getResource("render-ecm-service-not-available"):e&&e.responseText?e.responseText:this.getResource("render-ecm-service-general-error"),this.getFormContainer().failHandler(t)},lockECMFile:function(e,t){var i=this;$.when(i.lockUploadItem(t.idFileUpload)).done((function(r){var a=[r.idFileUpload,t.fileName],n=i.renderUploadItem(a);e.replaceWith(n),i.attackMenuEvents(a)}))},unlockECMFile:function(e,t){var i=this;$.when(i.unlockUploadItem(t.idFileUpload)).done((function(r){var a=[r.idFileUpload,t.fileName],n=i.renderUploadItem(a);e.replaceWith(n),i.attackMenuEvents(a)}))},chooseFile:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&this.$inputFile.click()},checkFileExtensions:function(){var e=this.properties.validExtensions||"";if(this.validOptions={video:!1,image:!1,file:!1},void 0===(e=e.replace(/\s+/g,"").toLowerCase())||""===e)this.validOptions={video:!0,image:!0,file:!0};else if(1===(e=e.split(";")).length&&-1!==e[0].indexOf("*.*"))this.validOptions.video=!0,this.validOptions.image=!0;else for(var t=0,i=e.length;t<i;t++)e[t]=e[t].replace("*.",""),this.Class.EXTENSIONSFILE.toString().indexOf(e[t])>=0?this.validOptions.file=!0:this.Class.EXTENSIONSIMG.toString().indexOf(e[t])>=0?this.validOptions.image=!0:this.Class.EXTENSIONSVIDEO.toString().indexOf(e[t])>=0&&(this.validOptions.video=!0);this.validOptions.file||this.validOptions.image||this.validOptions.video||$(this.$contentFile).addClass("bz-file-upload__container--hidden"),(this.isMaxFilesReached()||!this.isNative&&!bizagi.util.media.fileAPISupported())&&$(this.$contentFile).addClass("bz-file-upload__container--hidden")},getUploadChoices:function(){var e=[];return this.validOptions.image&&(e.push({guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}),e.push({guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")})),this.validOptions.video&&e.push({guid:3,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-video")}),[].concat(e)},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture((function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then((function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i)){if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then((function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.handlerResolutionUpload(e)}));$(".bz-file-upload__resolution",t.getControl()).click()}}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY});break;case 1:navigator.camera.getPicture((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then((function(i){return t.fileProperties=i,t.saveImage(e)}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;case 3:navigator.device.capture.captureVideo((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).then((function(){return t.saveVideo(e)})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{limit:t.Class.LIMIT})}},onFail:function(e){var t=bizagi.util.processFailMessage(e);if(bizagi.loading.stop(),t&&"string"==typeof t&&-1!==t.indexOf("No Activity found to handle Intent")){var i=bizagi.util.isValidResource("render-upload-error-media-app")?bizagi.localization.getResource("render-upload-error-media-app"):"Your device does not have an app to execute this action.";self.performValidationMessage(i)}},performValidationMessage:function(e){var t=bizagi.util.processFailMessage(e);bizagi.showMessageBox(t)},handlerResolutionUpload:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.saveImage(t.dataImage);var r=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,r)).then((function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.saveImage(t.dataImage)}))},addFile:function(){var e=this,t=this.$inputFile[0].files[0],i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSFILE,e.Class.EXTENSIONSVIDEO);t.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.processUploadFile(t)).done((function(t){bizagi.util.isFailResponse(t)?e.performValidationMessage(t):e.onUploadFileCompleted(JSON.parse(decodeURIComponent(t)))})).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()})):bizagi.loading.stop()},buildAddFileParams:function(e){var t=this.Class.BA_CONTEXT_PARAMETER_PREFIX,i=new FormData,r=this.getFormContainer(),a=this.buildAddParams();Object.keys(a).map((function(e){i.append(e,a[e])})),i.append("Filedata",e),i.append("Filename",e.name.substr(e.name.replace(/([\\\/]+)/g,"/").lastIndexOf("/")+1)),i.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId),this.properties.contexttype&&i.append(t+"contexttype",this.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?i.append(BIZAGI_SESSION_NAME,r.properties.sessionId):i.append("JSESSIONID",r.properties.sessionId)}catch(e){i.append("JSESSIONID",r.properties.sessionId)}return i},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},onUploadFileCompleted:function(e){var t=$(".bz-files",this.getControl());if(e.idFileUpload&&e.fileName){var i=[e.idFileUpload,e.fileName],r=this.renderUploadItem(i);t.append(r);var a=this.files.slice();a.push(i),this.setValue(a,!0),this.checkMaxFiles(),this.attackMenuEvents(i),this.editedImageURL=null}else this.performValidationMessage(e.message)},attackMenuEvents:function(e){var t=this,i=t.getControl();e&&e.getFileProperties&&$.when(e.getFileProperties).done((function(e){var r=$("."+t.properties.id+"-"+e.idFileUpload,i);t.fileData[e.idFileUpload]=e.metadata||[],t.addMenuEvents(r,e)}))},processActionByType:function(e,t,i){var r=this,a=r.properties,n=r.getFormContainer();bizagi.loading.start(),new bizagi.rendering.tablet.slide.ecm(r.dataService,r.renderFactory,{title:r.properties.displayName||"",container:n.container,navigation:r.getParams().navigation,editable:a.editable&&e!==r.Class.ACTION_DETAILS,orientation:a.orientation||"ltr",onSave:function(e){if(e.update){var t=[e.idFileUpload,e.fileName],a=r.renderUploadItem(t);i.replaceWith(a),r.attackMenuEvents(t)}},onCancel:function(){}}).render({metadata:t.metadata,fileData:t}).always((function(){bizagi.loading.stop()}))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.searchList",bizagi.rendering.searchList.prototype),bizagi.rendering.tablet.searchList.extend("bizagi.rendering.tablet.searchList",{SEARCH_MIN_LENGTH:2,SEARCH_MAX_RECORDS:50,SEARCH_DELAY:250,SEARCH_ELEMENTS:{}},{renderControl:function(){var e=this,t=e.properties,i=e.renderFactory.getTemplate("searchList");return $.fasttmpl(i,{id:t.id,value:t.value.map((function(t){return e.formatItem(t.value)})).join(", ")})},postRender:function(){this.searchListInput=$(".bz-search-list__input",this.getControl())},postRenderReadOnly:function(){this.searchListInput=$(".bz-search-list__input",this.getControl())},renderReadOnly:function(){var e=this.renderFactory.getTemplate("searchList.readonly");return $.fasttmpl(e,{items:this.properties.value||{},editable:this.properties.editable||!0},{formatItem:this.formatItem})},configureHandlers:function(){var e=this;e.searchListInput.on("click",(function(t){($(t.target).parent()||{}).hasClass("bz-pill")||e._searchListViewModal()}))},_searchListViewModal:function(){var e=this,t=e.getHeaderTemplate(),i=e.getContentTemplate(),r=e.getFooterTemplate();e.searchListInput.mobileView({customHeader:t,orientation:e.properties.orientation||"",cssClassHeader:"bz-modal-view__header-multiple",contentTemplate:i,footerTemplate:r,style:"width: 80%; height: 70%",close:function(){$(window).unbind("resize"),e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.adjustResize(),e.configureModalViewHandlers(t)}})},setDisplayValue:function(e){var t=this,i="string"==typeof e?JSON.parse(e).value:e.value;t.setValue(i),void 0!==e&&t.properties.editable&&t.searchListInput.html(i.map((function(e){return t.formatItem(e.value)})).join(", "))},deleteItem:function(e){var t=e.parent("div");this.removeElement({id:t.data("id")}),t.remove()},selectItem:function(e){var t=this.getTagTemplate(e,this.properties.editable);this.modalViewTagList.append(t)},configureModalViewHandlers:function(e){var t=this,i=e.footer,r=e.header,a={};if(t.hasValue()){var n=t.getListItems();$.each(n,(function(e,t){a[t.id]=t}))}t.modalViewList=$(".bz-list",e.content),t.modalViewTagList=$(".bz-search-pill__results",r);var o=$(".bz-modal-view__clear",r),s=$(".bz-modal-view__search",r),l=bizagi.util.debounce((function(){""===this.value?o.removeClass("bz-modal-view__clear--visible"):o.addClass("bz-modal-view__clear--visible"),t.autoCompleteSearchResults($.trim(this.value))}),this.Class.SEARCH_DELAY);s.on("change keyup",l).on("focus",(function(){$(".bz-search__header",e.header).addClass("bz-search__header--active")})).on("blur",(function(){$(".bz-search__header",e.header).removeClass("bz-search__header--active")})),o.bind("click",(function(){s.val("").trigger("change")})),$("[data-action=close]",e.header).bind("click",(function(){e.close()})),t.modalViewList.on("click","li",(function(){var e=$.data(this).item;!e||e&&a[e.id]||(a[e.id]=e,$(i).find(".bz-btn").removeClass("bz-btn--secundary"),$(i).find(".bz-btn").addClass("bz-btn--primary"),1===(Object.keys(a)||[]).length&&$(r).find(".bz-search-pill__selected ").removeClass("bz-search-pill__selected--hidden"),t.selectItem(e))})),t.modalViewTagList.on("click",".bz-pill > .bz-btn-icn",(function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parent("div");$(i).find(".bz-btn").removeClass("bz-btn--secundary"),$(i).find(".bz-btn").addClass("bz-btn--primary"),delete a[t.data("id")],t.remove(),0===(Object.keys(a)||[]).length&&$(r).find(".bz-search-pill__selected ").addClass("bz-search-pill__selected--hidden")})),$(i).delegate("[data-action=save]","click",(function(i){var r=[];$.each(a,(function(e,t){r.push(t)})),t.setDisplayValue({value:r}),e.close()}))},autoCompleteSearchResults:function(e){var t=this;$.when(t.processRequest({term:e})).done((function(e){t.modalViewList.find("li").remove();for(var i=0,r=e.length;i<r;i++){t.renderSearchItem(e[i]).appendTo(t.modalViewList)}}))},renderSearchItem:function(e){var t=this.renderFactory.getTemplate("searchList.item"),i=$.tmpl(t,{id:e.id,label:e.label,value:this.formatItem(e.value)});return i.data("item",e),i},processRequest:function(e){var t=this,i=t.properties,r=new $.Deferred,a=[];return e.term.length>=this.Class.SEARCH_MIN_LENGTH?(i.term=e.term,t.deferredReference&&"function"==typeof t.deferredReference.reject&&"resolved"!==t.deferredReference.state()&&t.deferredReference.reject({hideStatus:!0}),t.deferredReference=t.getData().done((function(n){n&&n.length>0?((n=n.slice(0,i.maxRecords)).length>t.Class.SEARCH_MAX_RECORDS?(n=n.slice(0,t.Class.SEARCH_MAX_RECORDS),a.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-search-maximum-records-allowed"),value:""})):n=n.slice(0,i.maxRecords),$.each(n,(function(t,r){if(0===i.maxRecords||t<i.maxRecords){var n=bizagi.util.performTermMatches(r.value,e.term);a.push({id:r.id,label:n,value:r.value})}}))):a.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-grid-no-records"),value:""}),r.resolve(a)})).fail((function(){r.reject()}))):r.resolve(a),r.promise()},getContentTemplate:function(){var e=this.getValue(),t="string"==typeof e?JSON.parse(e).value:e.value,i=this.renderFactory.getTemplate("searchList.items"),r=$.fasttmpl(i,{items:t||{},editable:this.properties.editable||!0},{formatItem:this.formatItem});return $.trim(r)},getFooterTemplate:function(){var e=this.renderFactory.getTemplate("searchList.actions"),t=$.fasttmpl(e,{items:this.properties.value||{},editable:this.properties.editable||!0});return $.trim(t)},getTagTemplate:function(e,t){var i=this.renderFactory.getTemplate("searchList.tag"),r=$.fasttmpl(i,{id:e.id,label:e.label,value:this.formatItem(e.value),editable:t});return $.trim(r)},adjustResize:function(){var e=window.innerHeight;$(window).off("resize").on("resize",bizagi.util.debounce((function(){$(this).height()<e?$(".bz-mobile-view__footer_content").addClass("bz-hidden"):$(".bz-mobile-view__footer_content").removeClass("bz-hidden")}),this.Class.SEARCH_DELAY))},getHeaderTemplate:function(){var e=this.getValue(),t="string"==typeof e?JSON.parse(e).value:e.value,i=this.renderFactory.getTemplate("searchList-modal-header"),r=$.fasttmpl(i,{items:t||{},editable:this.properties.editable||!0,emptyItems:0===(t||[]).length},{formatItem:this.formatItem});return $.trim(r)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.userfieldWrapper",bizagi.rendering.userfieldWrapper.prototype),bizagi.rendering.tablet.userfieldWrapper.extend("bizagi.rendering.tablet.userfieldWrapper",{},{getUserfieldControl:function getUserfieldControl(){var self=this,sControl=self.userfieldName,mode=self.getMode(),exists=eval("typeof bizagi.rendering.tablet."+sControl+" !== 'undefined'"),def=new $.Deferred;return exists?$.when(self.parent.ready()).done((function(){def.resolve(self.createUserfieldInstance(sControl))})):"execution"!=mode?setTimeout((function(){$.when(self.triggerGlobalHandler("loadUserField",{userfield:self.userfieldGuid,device:"Tablet"})).pipe((function(e){e&&def.resolve(self.createUserfieldInstance(sControl))}))}),10):$.when(self.dataService.getUserfieldDefinition({userfield:self.userfieldGuid,device:"tablet"})).pipe((function(e){self.loadUserfield(e),def.resolve(self.createUserfieldInstance(sControl))})),def.promise()},createUserfieldInstance:function createUserfieldInstance(sControl){var self=this,control;try{var dynamicFunction="var baDynamicFn = function(renderParams){ \r\n";dynamicFunction+="return new bizagi.rendering.tablet."+sControl+"(renderParams);\r\n",dynamicFunction+="}\r\n",dynamicFunction+="baDynamicFn",dynamicFunction=eval(dynamicFunction),control=dynamicFunction(self.initialParams)}catch(e){control=self.getUserFieldInstance(self.initialParams)}return control.properties.isUserField=!0,self.userfieldInstance=control,self.replicateUserfieldMethods(control),self.userfieldInstance.bind("renderchange",(function(){self.triggerHandler("renderchange",arguments)})),control},loadUserfield:function loadUserfield(data){var self=this,styleContent="";self.properties.styleGuid=self.properties.styleGuid||Math.guid();try{try{data=eval(data)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}$.each(data,(function(e,t){if("js"===t.type)try{t.content=t.content.replace(/bizagi\.rendering\.[^\s]+\.extend(\s|\n|\s)*\((\s|\n|\s)*\"bizagi\.rendering\.[^\s]+\"/gim,(function(e){return e.replace(/bizagi.rendering/gi,"bizagi.rendering.tablet")})),window.eval(t.content)}catch(e){bizagi.log("Could not parse result userfield3 "+self.userfieldName,e.message)}"css"===t.type&&(styleContent+=t.content)})),""!==$.trim(styleContent)&&bizagi.util.loadStyle(styleContent,self.properties.styleGuid);var control=eval("bizagi.rendering."+self.userfieldName)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}},getUserFieldInstance:function(e){return"execution"===this.getMode()?new bizagi.rendering.tablet.defaultUserField(e):new bizagi.rendering.tablet.designUserField(e)},startUserfieldLoading:function(){this.element.addClass("bz-form-userfield__loader")},endUserfieldLoading:function(){this.element.removeClass("bz-form-userfield__loader")}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.basicUserField",bizagi.rendering.userfieldDefinition.prototype),bizagi.rendering.tablet.basicUserField.extend("bizagi.rendering.tablet.basicUserField",bizagi.rendering.basicUserField.prototype),bizagi.rendering.tablet.basicUserField.extend("bizagi.rendering.tablet.basicUserField",{},{init:function(e){(this._super(e),this.isSupported())||this.getFormContainer().addError(this.getResource("render-tablet-error-userfield"))},getEditableControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getEditableControl.apply(this,arguments)},getReadonlyControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getReadonlyControl.apply(this,arguments)},isSupported:function(){return!0}}),bizagi.rendering.tablet.basicUserField.extend("bizagi.rendering.tablet.defaultUserField",{},{getEditableControl:function(){var e=this.getControl(),t=this.properties.control.replace(/column/g,"");return this.input=$("<label>Userfield: "+t+" not found</label>").appendTo(e),this.input.addClass("ui-bizagi-render-userfield-notSupported"),this.input},getReadonlyControl:function(){return this.getEditableControl()},collectData:function(e){}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.image.prototype),bizagi.rendering.tablet.image.extend("bizagi.rendering.tablet.image",{QUALITY_PICTURE:80,EXTENSIONSIMG:["jpeg","jpg","png"]},{$inputFile:null,isNative:!1,isOfflineForm:!1,initializeData:function(e){if(this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported(),this.isOfflineForm){var t=Number(this.properties.maxSize)||1048576,i="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=t<i?t:i}},renderControl:function(){var e=this.renderFactory.getTemplate("image");return $.fasttmpl(e,{url:""})},getElementsToStylize:function(e){return $({})},renderReadOnly:function(){var e=this,t=this.renderFactory.getTemplate("image-readonly");return e.buildItemUrl().then((function(i){var r=i||"";if(!e.isDisposed())return e.properties.url=r,$.fasttmpl(t,{url:e.properties.url})}))},postRender:function(){var e=this.getControl();this.$inputFile=$(".bz-image__input",e),this.$nativeFile=$(".bz-image__native",e),this.isDesignMode()||this.showAsyncImage()},configureHandlers:function(){var e=this;this.getControl().on("click","[data-action=upload]",(function(t){e.choosePhoto()})),this.isNative?e.configureNativeHandlers():e.configureHybridHandlers()},configureNativeHandlers:function(){var e=this,t=this.getControl();this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){switch(t.guid){case 1:e.imageAdd();break;case 2:e.imageAdd(!0)}},appear:function(){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-image__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),e.resolutionButtonHandler(t.guid).always((function(){bizagi.loading.stop()}))},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})},configureHybridHandlers:function(){var e=this;this.$inputFile.off("change").on("change",(function(){e.imageAdd(),this.value=""})),this.$inputFile.off("click").on("click",(function(e){e.stopPropagation()}))},configureHandlersReadOnly:function(){var e=this;this.getControl().off("click").on("click",".bz-image",(function(){e.imagePreview()}))},imageAdd:function(e){this.isNative?this.imageAddNative(e):this.imageAddHybrid()},imageAddHybrid:function(){var e=this.Class.EXTENSIONSIMG,t=this.$inputFile[0].files[0];t.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,this.properties)&&bizagi.util.media.checkFileTypes(t,this.properties,e)?this.performUploadFile(t).always((function(){bizagi.loading.stop()})):bizagi.loading.stop()},imageAddNative:function(e){var t=this,i={quality:t.Class.QUALITY_PICTURE,targetWidth:1280,targetHeight:960,correctOrientation:!0};if(!e){var r=t.getControl()[0].getBoundingClientRect();i={quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,popoverOptions:new CameraPopoverOptions(r.left,r.top-20,200,100,4),destinationType:navigator.camera.DestinationType.FILE_URI,correctOrientation:!0}}navigator.camera.getPicture((function(e){return t.imageAddNativeFromCamera(e)}),(function(){bizagi.loading.stop()}),i)},imageAddNativeFromCamera:function(e){var t=this;bizagi.loading.start(),bizagi.util.media.checkMaxSize(e,t.properties).then((function(){return bizagi.util.media.getFileDataInfo(e)})).then((function(i){if(bizagi.util.media.checkFileTypes(i,t.properties,t.Class.EXTENSIONSIMG)){t.dataImage=e,t.fileProperties=i;var r=bizagi.util.getAndroidVersion();if(r&&r<=4.2||t.isOfflineForm)t.performUploadFile(t.dataImage).always((function(){bizagi.loading.stop()}));else{if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then((function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.resolutionButtonHandler(e)}));$(".bz-image__resolution",t.getControl()).click()}}})).always((function(){bizagi.loading.stop()}))},imageDelete:function(){var e=this;return bizagi.loading.start(),e.dataService.deleteImage({url:e.properties.deleteUrl,idRender:e.properties.id,xpath:e.properties.xpath,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,contexttype:e.properties.contexttype}).then((function(){e.properties.value=[],e.uploadFileCompleted()})).fail((function(t){var i,r=t.responseText;try{i=(i=JSON.parse(r)).message||r}catch(e){i=r}e.setValidationMessage(i)})).always((function(){bizagi.loading.stop()}))},uploadFile:function(e){if(this.properties.isChanged=!0,!this.isOfflineForm)return this.isNative?this.uploadFileNativeOnline(e):this.uploadFileHybridOnline(e);bizagi.util.isEmpty(this.properties.value)&&(this.properties.value=[[null,null]]);var t=null!=this.fileProperties?this.fileProperties.name:e.name;return this.dataService.fileService.changeOfflineImageName(this.properties.value,t),this.saveImageOffline(e)},uploadFileNativeOnline:function(){var e={},t=this.buildAddParams(),i=this.fileProperties.name;return this.editedImageURL?e.dataFile=this.editedImageURL:this.fileProperties&&(e.dataFile=this.fileProperties.url),t.queueID="q_"+bizagi.util.encodeXpath(this.getUploadXpath()),e.data=t,e.options=new FileUploadOptions,e.options.fileKey="file",e.options.fileName=i,e.options.mimeType="image/jpeg",e.options.uploadKey={key:t.h_xpath},e.options.addUrl=this.properties.addUrl,this.editedImageURL=null,this.fileProperties=null,e.dataFile=bizagi.util.media.getImagePath(e.dataFile),$.when(bizagi.util.media.uploadFile(e)).then((function(e){var t=JSON.parse(decodeURIComponent(e.response));return"error"===t.type?$.Deferred().reject(t).promise():t}))},uploadFileHybridOnline:function(e){return bizagi.util.media.checkMaxSizeFile(e,this.properties)&&bizagi.util.media.checkFileTypes(e,this.properties,this.Class.EXTENSIONSIMG)?this.dataService.processUploadFile({url:this.properties.addUrl,formData:this.buildAddFileParams(e)}):$.Deferred().reject().promise()},uploadFileCompleted:function(){try{this.showAsyncImage(),this.editedImageURL=null}catch(e){this.getFormContainer().refreshForm()}},showAsyncImage:function(){var e=this,t=e.getControl(),i=$(".bz-input-icon",t);e.renderUploadItem().then((function(t){if(!e.isDisposed()){i.empty(),i.append(t);var r=e.hasValue()?"update":"upload";i.attr("data-action",r),e.hasValue()&&e.configureMenu()}}))},resolutionButtonHandler:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.performUploadFile(t.dataImage);var r=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,r)).then((function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.performUploadFile(t.dataImage)}))},imagePreview:function(){var e=this,t=e.getParams(),i=t.navigation.createRenderContainer({title:e.properties.displayName,view:{zoom:!0,useNativeScrolling:!1}}),r=e.renderFactory.getTemplate("image-preview"),a={url:e.properties.url&&""!==e.properties.url?e.properties.url:""},n=$.fasttmpl(r,a);i.element.css("display","none"),e.inputEdition=i.element.html(n),t.navigation.navigate(i.id),bizagi.loading.start();var o=this.formCompatibilityVersion>=2?function(){return a.url}:e.buildFullItemUrl.bind(e);$.when(o()).then((function(t){if(i.element.css("display","block"),t.indexOf("error")<0){var r=$(".bz-image__preview-item:first",i.element).attr("src",t),a=r.css("width");a=Number(a.substring(0,a.length-2)),-1!==e.properties.width&&e.properties.width<a&&r.css("width","100%")}})).always((function(){bizagi.loading.stop()}))},buildAddFileParams:function(e){var t=this.properties,i=this.Class.BA_CONTEXT_PARAMETER_PREFIX,r=new FormData,a=this.getFormContainer();r.append(i+"xpath",t.xpath),r.append(i+"idRender",t.id),r.append(i+"xpathContext",t.xpathContext),r.append(i+this.Class.BA_PAGE_CACHE,t.idPageCache),r.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",a.properties.sessionId),r.append(i+"action","savefile"),r.append(this.properties.xpath,e),t.contexttype&&r.append(i+"contexttype",t.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?r.append(BIZAGI_SESSION_NAME,a.properties.sessionId):r.append("JSESSIONID",a.properties.sessionId)}catch(e){r.append("JSESSIONID",a.properties.sessionId)}return r},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},performUploadFile:function(e){var t=this;return $.when(t.uploadFile(e)).then((function(){bizagi.util.isEmpty(t.properties.value)&&(t.properties.value=[[0,"uploaded"]]),t.uploadFileCompleted()})).fail((function(e){t.executeFormFailHandler(e)}))},choosePhoto:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&this.$inputFile.click()},configureMenu:function(){var e=this,t=[],i=this.getControl(),r=$(".bz-input-icon__input + .bz-icn",i),a=!e.isOfflineForm&&(e.properties.allowDelete&&e.properties.editable);t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-image-preview"),fn:function(){e.imagePreview()}}),t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo"),fn:function(){e.choosePhoto()}}),a&&t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-remove-photo"),fn:function(){bizagi.showConfirmationBox(e.getResource("render-grid-delete-confirmation")).then((function(){e.imageDelete()}))}}),r.overflowMenu({items:t})},getUploadChoices:function(){return[{guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")},{guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}]},buildItemUrl:function(e){return this.isOfflineForm?this.buildItemUrlOffline():this.buildItemUrlOnline(e)},buildItemUrlOffline:function(){var e=this;return bizagi.util.sleepUntil((function(){return!e.dataService.getFileService().isLoading(e)})).then((function(){return bizagi.rendering.image.prototype.buildItemUrlOffline.apply(e,arguments)}))},buildItemUrlOnline:function(){var e=this;return bizagi.rendering.image.prototype.buildItemUrl.apply(this,arguments).then((function(t){return e.formCompatibilityVersion<2&&(t.length>0?e.properties.value=[[0,"uploaded"]]:e.properties.value=[]),t}))},collectData:function(e){if(this.isOfflineForm&&bizagi.util.isOfflineFormsV2Supported()){if(!this.properties.isChanged)return;var t=this.properties.xpath;bizagi.util.isEmpty(t)||(e[t]={offlineId:this.buildOfflineImageId(),name:this.dataService.fileService.getOfflineImageName(this.getValue())})}},cleanData:function(){if(this.hasValue())return $.when(this.imageDelete())},hasValue:function(){var e=!1;return(this.properties.value||[]).length>0&&(e=!0),e}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.image.old",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.image.prototype),bizagi.rendering.tablet.image.extend("bizagi.rendering.tablet.image.old",{QUALITY_PICTURE:80,EXTENSIONSIMG:["jpeg","jpg","png"]},{$inputFile:null,isNative:!1,isOfflineForm:!1,initializeData:function(e){if(this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported(),this.isOfflineForm){var t=Number(this.properties.maxSize)||1048576,i="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=t<i?t:i}},renderControl:function(){var e=this.renderFactory.getTemplate("image");return $.fasttmpl(e,{url:""})},getElementsToStylize:function(e){return $({})},renderReadOnly:function(){var e=this,t=this.renderFactory.getTemplate("image-readonly"),i=new $.Deferred;return $.when(e.buildItemUrl()).done((function(r){var a=r||"";if(!e.isDisposed()){e.properties.url=a,e.properties.value=a.length>0?[a]:null,e.setValue(e.properties.value);var n=$.fasttmpl(t,{url:e.properties.url});i.resolve(n)}})),i.promise()},postRender:function(){var e=this.getControl();this.$inputFile=$(".bz-image__input",e),this.$nativeFile=$(".bz-image__native",e),this.isDesignMode()||this.showAsyncImage()},configureHandlers:function(){var e=this,t=this.getControl();t.on("click","[data-action=upload]",(function(t){e.choosePhoto()})),this.isNative?(this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){switch(t.guid){case 1:e.imageAdd();break;case 2:e.imageAdd(!0)}},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-image__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.resolutionButtonHandler(t.guid)).always((function(){bizagi.loading.stop()}))},appear:function(t){e.triggerGlobalHandler("closeModalValidationMessage",{}),e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})):(this.$inputFile.off("change").on("change",(function(){e.imageAdd(),this.value=""})),this.$inputFile.off("click").on("click",(function(e){e.stopPropagation()})))},configureHandlersReadOnly:function(){var e=this;this.getControl().on("click",".bz-image",(function(){e.imagePreview()}))},imageAdd:function(e){var t=this;if(this.isNative){var i={quality:t.Class.QUALITY_PICTURE,targetWidth:1280,targetHeight:960,correctOrientation:!0};if(!e){var r=t.getControl()[0].getBoundingClientRect();i={quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,popoverOptions:new CameraPopoverOptions(r.left,r.top-20,200,100,4),destinationType:navigator.camera.DestinationType.FILE_URI,correctOrientation:!0}}navigator.camera.getPicture((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then((function(i){if(bizagi.util.media.checkFileTypes(i,t.properties,t.Class.EXTENSIONSIMG)){t.dataImage=e,t.fileProperties=i;var r=bizagi.util.getAndroidVersion();if(r&&r<=4.2||t.isOfflineForm)return $.when(t.performUploadFile(t.dataImage)).always((function(){bizagi.loading.stop()}));if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then((function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.resolutionButtonHandler(e)}));$(".bz-image__resolution",t.getControl()).click()}}))})).always((function(){bizagi.loading.stop()}))}),t.onFail,i)}else{var a=this.Class.EXTENSIONSIMG,n=this.$inputFile[0].files[0];n.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(n,t.properties)&&bizagi.util.media.checkFileTypes(n,t.properties,a)?$.when(t.performUploadFile(n)).always((function(){bizagi.loading.stop()})):bizagi.loading.stop()}},onFail:function(e){bizagi.loading.stop()},imageDelete:function(){var e=this;bizagi.showConfirmationBox(e.getResource("render-grid-delete-confirmation")).done((function(){bizagi.loading.start(),$.when(e.dataService.deleteImage({url:e.properties.deleteUrl,idRender:e.properties.id,xpath:e.properties.xpath,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,contexttype:e.properties.contexttype})).done((function(){e.uploadFileCompleted()})).fail((function(t){var i,r=t.responseText;try{i=(i=JSON.parse(r)).message||r}catch(e){i=r}e.setValidationMessage(i)})).always((function(){bizagi.loading.stop()}))}))},uploadFile:function(e){var t=this,i=new $.Deferred;if(this.isOfflineForm)t.saveImageOffline(e,(function(e){var r=e.replace(/^data:.*;base64,/,"");t.setValue(r),i.resolve()})),t.canBeSent=function(){return $.forceCollectData=!0,!0};else if(this.isNative){var r={},a=t.buildAddParams(),n=t.fileProperties.name;t.editedImageURL?r.dataFile=t.editedImageURL:t.fileProperties&&(r.dataFile=t.fileProperties.url),a.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),r.data=a,r.options=new FileUploadOptions,r.options.fileKey="file",r.options.fileName=n,r.options.mimeType="image/jpeg",r.options.uploadKey={key:a.h_xpath},r.options.addUrl=t.properties.addUrl,t.editedImageURL=null,t.fileProperties=null,r.dataFile=bizagi.util.media.getImagePath(r.dataFile),$.when(bizagi.util.media.uploadFile(r)).done((function(e){"error"===(e=JSON.parse(decodeURIComponent(e.response))).type?i.reject(e):i.resolve(e)})).fail((function(e){i.reject(e)}))}else bizagi.util.media.checkMaxSizeFile(e,t.properties)&&bizagi.util.media.checkFileTypes(e,t.properties,t.Class.EXTENSIONSIMG)?t.dataService.processUploadFile({url:t.properties.addUrl,formData:t.buildAddFileParams(e)}).done((function(e){i.resolve(e)})).fail((function(e){i.reject(e)})):i.reject();return i.promise()},uploadFileCompleted:function(){try{this.showAsyncImage(),this.editedImageURL=null}catch(e){this.getFormContainer().refreshForm()}},showAsyncImage:function(){var e=this,t=e.getControl(),i=$(".bz-input-icon",t);$.when(e.renderUploadItem()).done((function(t){if(!e.isDisposed()){i.empty(),i.append(t);var r=e.hasValue()?"update":"upload";i.attr("data-action",r),e.setValue(e.properties.value),e.hasValue()&&e.configureMenu()}}))},resolutionButtonHandler:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.performUploadFile(t.dataImage);var r=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,r)).then((function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.performUploadFile(t.dataImage)}))},imagePreview:function(){var e=this,t=e.getParams(),i=t.navigation.createRenderContainer({title:e.properties.displayName,view:{zoom:!0,useNativeScrolling:!1}}),r=e.renderFactory.getTemplate("image-preview"),a={url:e.value&&""!==e.value[0]?e.value[0]:""},n=$.fasttmpl(r,a);i.element.css("display","none"),e.inputEdition=i.element.html(n),t.navigation.navigate(i.id),e.isOfflineForm&&i.element.on("close",e.onPreviewActionBack.bind(e)),bizagi.loading.start(),$.when(e.buildFullItemUrl()).done((function(t){if(i.element.css("display","block"),t.indexOf("error")<0){var r=$(".bz-image__preview-item:first",i.element).attr("src",t),a=r.css("width");a=Number(a.substring(0,a.length-2)),-1!==e.properties.width&&e.properties.width<a&&r.css("width","100%")}})).always((function(){bizagi.loading.stop()}))},buildAddFileParams:function(e){var t=this.properties,i=this.Class.BA_CONTEXT_PARAMETER_PREFIX,r=new FormData,a=this.getFormContainer();r.append(i+"xpath",t.xpath),r.append(i+"idRender",t.id),r.append(i+"xpathContext",t.xpathContext),r.append(i+this.Class.BA_PAGE_CACHE,t.idPageCache),r.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",a.properties.sessionId),r.append(i+"action","savefile"),r.append(this.properties.xpath,e),t.contexttype&&r.append(i+"contexttype",t.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?r.append(BIZAGI_SESSION_NAME,a.properties.sessionId):r.append("JSESSIONID",a.properties.sessionId)}catch(e){r.append("JSESSIONID",a.properties.sessionId)}return r},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},performUploadFile:function(e){var t=this;return $.when(t.uploadFile(e)).done((function(e){t.uploadFileCompleted()})).fail((function(e){t.executeFormFailHandler(e)}))},choosePhoto:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&!self.isOfflineForm&&this.$inputFile.click()},configureMenu:function(){var e=this,t=[],i=this.getControl(),r=$(".bz-input-icon__input + .bz-icn",i),a=!e.isOfflineForm&&(e.properties.allowDelete&&e.properties.editable);t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-image-preview"),fn:function(){e.imagePreview()}}),t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo"),fn:function(){e.choosePhoto()}}),a&&t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-remove-photo"),fn:function(){e.imageDelete()}}),r.overflowMenu({items:t})},getUploadChoices:function(){return[{guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")},{guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}]},buildItemUrl:function(e){var t=this.properties,i=new $.Deferred,r="";if(this.isExecutionMode()){var a={url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,property:e&&e.property?e.property:"fileContent",dataType:"text"};t.contexttype&&(a.contexttype=t.contexttype),t.isUserPreference&&(this.currentUser=bizagi.currentUser.idUser,a.xpathContext="@Context.Users[id == "+this.currentUser+"]",a.contexttype="entity",a.surrogatekey=this.currentUser),this.isOfflineForm?i.resolve(bizagi.util.getDataUrl(t)):this.dataService.multiaction().getPropertyData(a,"text").done((function(e){'"'===e.charAt(0)&&(e=e.slice(1,-1)),""!==e&&(r="data:image/png;base64,"+e),i.resolve(r)}))}else r="",i.resolve(r);return i.promise()},saveImageOffline:function(e,t){var i=bizagi.util.media.getImagePath(e),r=new XMLHttpRequest;try{r.onload=function(){var e=new FileReader;e.onloadend=function(){var i=e.result;t(i)},e.readAsDataURL(r.response)},r.open("GET",i),r.responseType="blob",r.send()}catch(e){t("")}},onPreviewActionBack:function(e){var t=$(".bz-image__preview-item",e.target).attr("src")||"",i=t.length>0?[].concat(t):null;this.setValue(i)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.document",bizagi.rendering.document.prototype),bizagi.rendering.tablet.document.extend("bizagi.rendering.tablet.document",{ACTION_SHOW:"show",ACTION_DOWNLOAD:"download",ACTION_DELETE:"delete"},{renderControl:function(){var e=this.renderFactory.getTemplate(this.getTemplate()),t=this.properties.value||[],i={downloadalldocuments:this.properties.downloadalldocuments,allowgenerate:this.properties.allowGenerate,noFiles:!t||0===t.length,append:this.properties.append,caption:this.properties.caption},r=$.fasttmpl(e,i),a=this.renderDocumentsHtml(t);r=this.replaceFilesHtml(r,a);var n=this.renderActionsHtml(t,i.noFiles,i.downloadalldocuments);return r=this.replaceActionsHtml(r,n)},postRender:function(){var e=this.getControl();this.$inputDocument=$(".bz-document-template__container",e),this.$listDocuments=$("[data-component=files]",e),this.$listActions=$("[data-component=actions]",e),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate(this.getTemplateReadonly()),t=this.properties.value||[],i=!t||0===t.length,r=$.fasttmpl(e,{noFiles:i}),a=this.renderDocumentsHtml(t);return r=this.replaceFilesHtml(r,a)},postRenderReadOnly:function(){var e=this.getControl();this.$listDocuments=$("[data-component=files]",e)},configureHandlers:function(){var e=this;this.$inputDocument.on("click",(function(t){e.properties.buttonExecuted=!0,e.properties.validate?e.validateContainer()&&e.documentTemplateGenerate():e.documentTemplateGenerate(),e.properties.buttonExecuted=!1})),this.$listDocuments.on("click","[data-action]",(function(t){var i=$(this),r=i.parent(".bz-document").data(),a=i.data("action");e.processAction(a,r)})),e.$listActions.on("click","[data-action]",(function(t){var i=$(this),r=i.parent(".bz-document__download").data(),a=i.data("action");e.processAction(a,r)}))},configureHandlersReadOnly:function(){var e=this;this.$listDocuments.on("click","[data-action]",(function(t){var i=$(this),r=i.parent(".bz-document").data(),a=i.data("action");e.processAction(a,r)}))},renderAllDocumentDownload:function(e){var t=this.renderFactory.getTemplate(this.getTemplateDownload()),i=this.buildAllDocumentsUrl();return this.isExecutionMode()||(i="javascript:void(0);"),$.fasttmpl(t,{url:i,filename:e.fileName,joined:!0})},redrawDocuments:function(e,t,i){var r=this.getControl(),a=$("[data-component='files']",r),n=$("[data-component='actions']",r);a.empty(),n.empty();var o=this.renderDocumentsHtml(e);a.append(o);var s=this.renderActionsHtml(e,t,i);n.append(s),this.setValue(e)},showDocumentPreview:function(e,t){var i=this;bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(e,t)).fail((function(e){e.responseText&&i.getFormContainer().failHandler(e.responseText)})).always((function(){bizagi.loading.stop()}))},resolveDocumentTemplateGenerate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e},resolveDeleteDocumentTemplate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e},processAction:function(e,t){e===this.Class.ACTION_DELETE?this.deleteDocumentTemplate(t.filename):e===this.Class.ACTION_SHOW?this.showDocumentPreview(t.url,t.filename):e===this.Class.ACTION_DOWNLOAD&&this.showDocumentPreview(t.url,t.filename)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.geolocation",bizagi.rendering.geolocation.prototype),bizagi.rendering.tablet.geolocation.extend("bizagi.rendering.tablet.geolocation",{ALLOW_UPDATE:"update"},{postRender:function(){var e=this.getControl();this.coordinate=e.find("input"),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.coordinate=e.find("input"),this._super()},configureHandlers:function(){var e=this.getControl();null==this.value&&this.updateDisplayValue(),e.on("click","[data-action="+this.Class.ALLOW_UPDATE+"]",this.processAction.bind(this))},setDisplayValue:function(e){var t=this,i=new $.Deferred;if(null!=e&&""!==e)t.coordinate&&t.coordinate.val(t.performPrecision(e)),t.setValue(e,!1),i.resolve();else{var r=function(e){var r=e.coords.latitude+" "+e.coords.longitude;t.coordinate.val(t.performPrecision(r)),t.setValue(r,!1),i.resolve()},a=function(e){i.reject(e)};bizagi.util.isCordovaSupported()&&bizagi.util.isiOSDevice()?navigator.geolocation.getCurrentPosition(r,a):t.getCurrentPosition(r,a)}return i.promise()},updateDisplayValue:function(){var e=this;e.setDisplayValue().then((function(){e.setValidationMessage("")})).fail((function(t){e.coordinate.val(""),e.setValidationMessage(t)}))},processAction:function(){this.coordinate.empty(),this.updateDisplayValue()},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".readonly-control",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.actionLauncher",bizagi.rendering.actionLauncher.prototype),bizagi.rendering.tablet.actionLauncher.extend("bizagi.rendering.tablet.actionLauncher",{},{postRender:function(){if("design"!=this.getMode()){var e=this,t=e.properties,i=e.getControl();e.actions=[],e.startLoading(),$.when(e.dataService.multiaction().getActions(e.processPropertyValueArgs)).then((function(r){return r=e.getPropertiesActionLaucher(r),e.actions=r,e.deferredActions.resolve(r),e.actions.length>0?$("[data-element='actions-add-btn']",i).show():$("[data-element='actions-add-btn']",i).hide(),t.isHorizontal?"none"!=t.templatetype?e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs).then((function(i){return e.engine.render($.extend(i,{isDefaultTemplate:"default"===t.templatetype,sessionId:e.properties.sessionId}),e.processPropertyValueDataTmplArgs)})).then((function(t){template=e.renderFactory.getTemplate("render-actionLauncher-horizontal");var i=$($.fasttmpl(template,{template:!0}));return $(".bz-template",i.wrap("<div>").parent()).append(t),i})):void 0:(template=e.renderFactory.getTemplate("render-actionLauncher-horizontal"),$.fasttmpl(template,{template:!1}))})).done((function(t){$("[data-element='template-container']",i).append(t),e.configureActionsHandlers(),e.configureTemplateHandlers()})).always((function(){e.endLoading()}))}},hasValue:function(){var e=this.getValue();return null!=e&&e.length>0},configureActionsHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",(function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],readOnlyForm:t[6]||!1,guidEntity:e.properties.guidEntity,xpathActions:e.properties.xpathActions||""};e.processAction(i)}));for(var i=[],r=0,a=e.actions.length;r<a;r++)i.push({guid:e.actions[r][0],displayName:e.actions[r][1]});$("[data-element='actions-add-btn']",t).actionSheet({actions:i,actionClicked:function(t){var i=e.actions.find((function(e){return e[0]==t.guid}));e.processAction({guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5],readOnlyForm:i[6]||!1,xpathActions:e.properties.xpathActions||""})}}),$.expr[":"].FilterAction=function(e,t,i){var r=i[3];return!!r&&new RegExp(r,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup((function(){var e=$(this).val();$(".action-launcher-control",t).show(),e&&$(".action-launcher-control",t).not(":FilterAction("+e+")").hide()}))},configureTemplateHandlers:function(){var e=this,t=e.getControl();e.engine.subscribe("onLoadDataNavigation",(function(t,i){i.filters=[],e.triggerGlobalHandler("dataNavigation",i)})),$(".bz-template-more-or-less",t).bind("click",(function(){$(".bz-template",t).toggleClass("bz-template--collapsed")}))},processAction:function(e){var t=this,i=t.getControl(),r=t.properties;void 0===r.multipleSelection||r.multipleSelection?"Form"==e.actionType&&t.countSameActions(e)>=1&&!e.xpathContext?$(".action-to-execute-control[data-guidaction='"+e.guidAction+"'] label",i).click():$.when(t.actionManager(e)).done((function(e){t.executeAction(e)})):t.getValue().length>0?t.showConfirmationDialog(e):$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))},notifyExecution:function(e,t){"success"==e.response?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,r=t.getParams(),a=t.properties.additionalXpath.join(","),n=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,o=new $.Deferred,s=new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:r.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){return t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:s.form.properties.xpathContext,idPageCache:i.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(i){e.editMode||0!==t.countSameActions(e)||(e.idStartScope=i.IdScope),o.resolve(i.IdScope)}))},onCancel:function(e){}}),l={idForm:e.guidProcess,contextType:"start",idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?r.idWorkitem:void 0,additionalXpaths:a,xpathContext:n,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath};return"Form"===e.actionType&&(l.contextType="entitytemplate",l.xpathContext=void 0,l.guidEntity=e.guidEntity,l.rewriteContextType=!0),s.render(l),o.promise()},processActionFormCollection:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=t.properties.additionalXpath.join(","),n=new $.Deferred,o=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,s=""!==o?printf("%s[id=%s]",o,e.idEntity):o,l=""!==o?printf("%s[]",o):o,d=r.getParams();return new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:d.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(r){return e.editMode?t.dataService.multiaction().submitData({action:"SAVE",data:r,xpathContext:s,idPageCache:r.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(e){n.resolve(e.IdScope)})):t.dataService.addGridRecordData({idRender:i.id,xpathContext:o,contexttype:"start",idPageCache:r.idPageCache,submitData:r}).done((function(i){e.idStartScope=i.IdScope,e.idEntity=i.IdEntity,t.addActionToQueue(e),n.resolve(i.IdScope)}))},onCancel:function(e){}}).render({idForm:e.guidProcess,contextType:"start",idCase:d.idCase,additionalXpaths:a,xpathContext:e.editMode?s:l,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath}),n.promise()},processStartForm:function(e){var t=this,i=new $.Deferred;e=e||{};var r=t.getFormContainer().getParams();return new bizagi.rendering.tablet.startForm(t.dataService,t.renderFactory,{title:e.title||"",navigation:r.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(e){i.resolve(e.IdScope)}))}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?r.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),i.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.executeActionImmediately(e)}))}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.setValue([]),$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))}))},setDisplayValue:function(e){var t=this,i=t.getControl(),r=$("[data-element='actions-container']",i),a=t.renderFactory.getTemplate("render-actionLauncher-actions-to-execute");t.configureQueueVisibility(),$.when(t.deferredActions).done((function(i){$.each(e,(function(t,r){var a=function(e){var t=[];return $.each(i,(function(i,r){r[4]==e&&(t=r)})),t}(r.guidAction);e[t].displayName=a[1],e[t].guidProcess=a[0],e[t].actionType=a[3],e[t].xpathContext=a[5],e[t].readOnlyForm=a[6],e[t].params&&e[t].params.idStartScope&&(e[t].idStartScope=e[t].params.idStartScope),e[t].params&&e[t].params.idPageCache&&(e[t].idPageCache=e[t].params.idPageCache),e[t].params&&e[t].params.idEntity&&(e[t].idEntity=e[t].params.idEntity)})),e.length>0?$.when($.fasttmpl(a,{actions:e})).done((function(e){r.empty(),r.append(e);var i=$(".bz-actions-to-execute .bz-btn-icn",r),a=$("label",r);i.on("click",(function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)})),a.on("click",(function(){var e=$(this).parent(),i=e.data("actiontype"),r=e.data("guidprocess"),a=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("readonlyform")||!1,l=e.data("identity")||"",d=e.data("guidaction"),c=o||t.properties.xpathContext;switch(i){case"Process":a&&t.processStartForm({guidprocess:r,idStartScope:a,title:n,xpathContext:o,recordXpath:c});break;case"Form":var u={guidProcess:r,idStartScope:a,editMode:!0,xpathContext:o,readOnlyForm:s,idEntity:l,recordXpath:c};if(u.xpathContext)t.processActionFormCollection(u);else{u.xpathContext=void 0;var p={},h=t.value.filter((function(e){return e.guidAction==d}));h.length>0&&(p={actionType:"Form",contextType:"entitytemplate",guidEntity:t.properties.guidEntity||h[0].guidEntity}),t.processActionForm($.extend(u,p))}}}))})):r.empty()}))},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-action-launcher-actions-to-execute-container",e),i=$(".action-to-execute-label",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.tablet.actionLauncher.extend("bizagi.rendering.tablet.entityTemplate",{},{postRender:function(){if("design"!=this.getMode()){var e=this,t=e.properties,i=e.getControl();e.actions=[],e.configureQueueVisibility(),e.startLoading(),e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs).then((function(r){return e.engine.render(r,$.extend(e.processPropertyValueDataTmplArgs,{formParams:e.getFormParams()})).then((function(r){var a=e.renderFactory.getTemplate("render-actionLauncher-horizontal"),n=$($.fasttmpl(a,{template:!0}));return $(".bz-template",n.wrap("<div>").parent()).append(r),t.allowactions?e.dataService.multiaction().getActions(e.processPropertyValueArgs).then((function(t){return e.deferredActions.resolve(t),e.actions=t,e.actions.length>0?$("[data-element='actions-add-btn']",i).show():$("[data-element='actions-add-btn']",i).hide(),n})):n}))})).done((function(t){$("[data-element='template-container']",i).append(t),e.configureActionsHandlers(),e.configureTemplateHandlers()})).always((function(){e.endLoading()}))}},configureActionsHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",(function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],xpathActions:e.properties.xpathActions||""};"Form"===i.actionType&&(i.xpathContext=void 0,i.contextType="entitytemplate",i.guidEntity=e.properties.guidEntity),e.processAction(i)}));for(var i=[],r=0,a=e.actions.length;r<a;r++)i.push({guid:e.actions[r][0],displayName:e.actions[r][1]});$("[data-element='actions-add-btn']",t).actionSheet({actions:i,actionClicked:function(t){var i=e.actions.find((function(e){return e[0]==t.guid}));e.processAction({guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5]})}})},configureTemplateHandlers:function(){var e=this,t=e.getControl();e.engine.subscribe("onLoadDataNavigation",(function(t,i){i.filters=[],i.calculateFilters=i.calculateFilters||!0,e.triggerGlobalHandler("dataNavigation",i)})),$(".bz-template-more-or-less",t).bind("click",(function(){$(".bz-template",t).toggleClass("bz-template--collapsed")}))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.polymorphicLauncher",bizagi.rendering.polymorphicLauncher.prototype),bizagi.rendering.tablet.polymorphicLauncher.extend("bizagi.rendering.tablet.polymorphicLauncher",{},{postRender:function(){var e,t=this,i=t.properties;return"design"!=t.getMode()&&t.properties.surrogatedKey?(t.configureQueueVisibility(),$.when(t.dataService.multiaction().getPolymorphicActions(t.processPropertyValueArgs)).done((function(r){r=t.dataService.serializePolymorphicActions(r),t.totalActions=bizagi.clone(r);var a=bizagi.clone(r);t.lessActions=bizagi.clone(a);var n={actions:a,allowSearch:i.allowSearch,treeActionsList:t.getTreeItems(a)};e=t.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree");var o=t.getControl();$(".bz-polymorphic-launcher__constructors",o).append($.fasttmpl(e,n)),t.bindHandlers()}))):""},getTreeItems:function(e,t){var i=this,r="<ul>",a=i.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree-item");return e=e||{},t=t||1,$.each(e,(function(e,n){r+=$.fasttmpl(a,n),n.children&&(r+=i.getTreeItems(n.children,t+1))})),r+="</ul>"},bindHandlers:function(){var e=this,t=e.getControl();$(".bz-polymorphic-launcher__constructors li span",t).on("click",(function(){var t=$(this).parent(),i={guidEntity:t.data("guidentity"),guidObject:t.data("guidobject"),guidConstructor:t.data("guidconstructor"),displayName:t.data("display-name"),actionType:t.data("action-type"),xpathContext:t.data("xpathcontext")};e.onActionClicked(i)})),$.expr[":"].FilterAction=function(e,t,i){var r=i[3];return!!r&&new RegExp(r,"i").test($(e).text())},$("input[data-action=search]",t).keyup((function(){var e=$(this).val();$(".bz-polymorphic-launcher__constructors li",t).show(),e&&$(".bz-polymorphic-launcher__constructors li",t).not(":FilterAction("+e+")").hide()}))},onActionClicked:function(e){var t=this;$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))},notifyExecution:function(e,t){"success"==e?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=t.properties.additionalXpath.join(","),n=new $.Deferred,o=(e.xpathContext,r.getParams()),s=t.properties.recordXpath,l=new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:o.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){var r=i.idPageCache;return i.idPageCache=null,t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:l.form.properties.xpathContext,idPageCache:r,isOfflineForm:!1,isActionStartForm:!0}).done((function(i){e.editMode||0!=t.countSameActions(e)||(e.idStartScope=i.IdScope),n.resolve(i.IdScope)}))},onCancel:function(e){}});return l.render({idForm:e.guidObject,contextType:"entity",guidEntity:e.guidEntity,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?o.idWorkitem:void 0,additionalXpaths:a,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,recordXpath:s}),n.promise()},processStartForm:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=new $.Deferred,n=r.getParams();return e=e||{},new bizagi.rendering.tablet.startForm(t.dataService,t.renderFactory,{maximized:i.maximized,title:e.title||"",navigation:n.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==this.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return r.startLoading(),t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(e){r.endLoading(),a.resolve(e.IdScope)}))}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?n.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),a.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.executeActionImmediately(e)}))}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.setValue([]),$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))}))},setDisplayValue:function(e){var t=this,i=t.getControl(),r=$(".bz-polymorphic-launcher-constructors-to-execute-container",i),a=t.renderFactory.getTemplate("render-polymorphicLauncher-actions-to-execute");t.configureQueueVisibility(),$.when($.fasttmpl(a,{actions:e})).done((function(e){r.empty(),r.append(e);var i=$(".bz-pill .bz-btn-icn",r),a=$(".bz-pill__label",r);i.on("click",(function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)})),a.bind("click",(function(){var e=$(this).parent(),i=e.data("actiontype"),r=e.data("guidprocess"),a=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("identity")||"",l=e.data("guidentity"),d=o||t.properties.xpathContext;switch(i){case"Process":a&&t.processStartForm({guidprocess:r,idStartScope:a,title:n,xpathContext:o,recordXpath:d});break;case"Form":var c={guidProcess:r,idStartScope:a,editMode:!0,xpathContext:o,idEntity:s,guidEntity:l,guidObject:r};t.processActionForm(c)}}))}))},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-polymorphic-launcher-constructors-to-execute-container",e),i=$(".bz-polymorphic-launcher__title",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.checkList",bizagi.rendering.checkList.prototype),bizagi.rendering.tablet.checkList.extend("bizagi.rendering.tablet.checkList",{},{postRender:function(){this._super(),this.properties.unique=Math.ceil(1e3*Math.random()),this.properties.required=!0},configureHandlers:function(){var e=this;e._super(),$("input[type=checkbox]",e.getControl()).bind("change",(function(){var t=$(this).data("item-guid");e.onCheckListGroupChange(t,this.checked)}))},onCheckListGroupChange:function(e,t){var i,r=$.grep(this.properties.items,(function(t,i){return t.guid===e}));r&&r.length>0&&(i=r[0]),i.checked=t},clearDisplayValue:function(){$("input[type=checkbox]",this.getControl()).removeAttr("checked")},setDisplayValue:function(e){}}),bizagi.rendering.tablet.checkList.extend("bizagi.rendering.tablet.activityCheckList",{},{initializeData:function(e){this._super(e);var t=this.properties.activityDescription&&""!==this.properties.activityDescription?bizagi.localization.getResource("workportal-project-plan-activity-goal")+": "+this.properties.activityDescription:"";this.properties.displayName=""!==t?t:bizagi.localization.getResource("workportal-project-plan-activity-work-title"),this.properties.displayType="vertical"},postRender:function(){var e=this.getControl();this._super(),this.newItemName=$(".bz-checkList__input",e),this.addEditButton=$(".add-edit-item-button-checklist",e),this.cancelEditButton=$(".cancel-edit-item-button-checklist",e),this.additionalElements(),this.notifyLoadItems()},notifyLoadItems:function(){var e=this;setTimeout((function(){var t=e.properties.items.filter((function(e){return e.resolved})).length;bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!0,idActivity:e.properties.idActivity,itemsResolved:t,items:e.properties.items,progress:e.properties.activityWork})),bizagi.webpart.publish("onLoadDataItemsFromFormActivityPlan",{items:e.properties.items,activityWork:e.properties.activityWork})}),100)},additionalElements:function(){this.addEditButton&&this.addEditButton.length>0&&this.addEditButton.hide(),this.cancelEditButton&&this.cancelEditButton.length>0&&this.cancelEditButton.hide()},configureHandlers:function(){var e=this,t=e.getControl();this._super(),$("[data-action=add]",t).unbind("click").click((function(){var t=$(".bz-checkList__item.bz-checkList__item--selected",e.control);t.length<=0?e.prepareNewItem():$(".bz-checkList__input",t).focus()})),$("[data-action=delete]",e.control).bind("click",(function(){var t=this,i=bizagi.localization.getResource("workportal-widget-reports-confirm"),r=$(this).closest(".bz-checkList__item");r.addClass("ui-bizagi-to-remove"),$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){var i=$(t).closest(".bz-checkList__item").data("item-guid");e.deleteItem(i)})).fail((function(){r.removeClass("ui-bizagi-to-remove")}))})),$("label[data-action=edit-item]",e.control).bind("click",(function(){var t=$(this).closest(".bz-checkList__item"),i=t.data("item-guid"),r=t.data("item-position");e.selectItem(i,r)}))},selectItem:function(e){for(var t=0,i=this.properties.items.length;t<i;t++)this.properties.items[t].guid===e?this.properties.items[t].selected=!0:this.properties.items[t].selected=!1;this.repaintControl();var r=$(".bz-checkList__item.bz-checkList__item--selected",this.getControl()),a=$(".bz-checkList__input",r),n=a.val();a.focus(),a[0].setSelectionRange(n.length,n.length),this.addSelectedHandlers()},deleteItem:function(e){for(var t=0,i=this.properties.items.length;t<i;t++)if(this.properties.items[t].guid===e){this.properties.items.splice(t,1);break}this.setValue(this.properties.items),this.repaintControl(),this.addSelectedHandlers()},prepareNewItem:function(){var e=this,t={guid:Math.guid(),resolved:!1,name:"",selected:!0};e.properties.items.push(t),e.repaintControl(),e.newItemName.focus(),e.newItemName.blur((function(){var t=$(".bz-checkList__item.bz-checkList__item--selected",e.control);""===$(".bz-checkList__input",t).val()&&e.properties.items&&e.properties.items.length>=1&&""===e.properties.items.slice(-1)[0].name&&e.properties.items.pop()})),e.addSelectedHandlers(),e.newItemName.keypress((function(t){13==t.which&&(t.preventDefault(),e.addItem(),e.prepareNewItem())}))},addSelectedHandlers:function(){var e=this,t=$(".bz-checkList__item.bz-checkList__item--selected",e.control),i=$(".bz-checkList__input",t);i.focus(),$("[data-action=accept-edit]",t).bind("click",(function(){var t=i.val();t&&""!==t&&e.addItem()})),$("[data-action=cancel-edit]",t).bind("click",(function(t){var r=i.val(),a=$(this).closest(".bz-checkList__item"),n=a.data("item-position"),o=a.data("item-guid");r&&""!==r&&""!==e.properties.items[n].name&&(e.properties.items[n].selected=!1),""!==r&&""!==e.properties.items[n].name||e.deleteItem(o),e.repaintControl()}))},addItem:function(){var e=this.getControl(),t=$(".bz-checkList__item.bz-checkList__item--selected",e),i=$(".bz-checkList__input",t).val();$.each(this.properties.items,(function(e,t){t.selected&&(t.name=i,t.selected=!1)})),this.updateOriginalValue(),this.setValue(this.properties.items),this.repaintControl()},repaintControl:function(){var e=this.renderControl();$("[data-component=checkList]",this.control).replaceWith(e),this.postRender(),this.configureHandlers()},onCheckListGroupChange:function(e,t){var i,r=$.grep(this.properties.items,(function(t,i){return t.guid===e}));r&&r.length>0&&(i=r[0]),i.resolved=t,this.setValue(this.properties.items),this.refreshValue(this.properties.items)},refreshValue:function(e){for(var t=e.length,i=0,r=0;r<t;r++)e[r].resolved&&(i+=1);this.properties.activityWork=t>0?Math.floor(100*i/t):100,this.notifyLoadItems()},getValue:function(){return this.value||[]},controlValueIsChanged:function(){return JSON.stringify(this.properties.originalValue)!==JSON.stringify(this.value)},updateOriginalValue:function(){this.properties.originalValue=bizagi.clone(this.value)},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=this.properties.idActivity;this.controlValueIsChanged()?bizagi.util.isEmpty(i)||bizagi.util.isEmpty(a)||(Array.isArray(r)?e[t.xpath]={idActivity:a,items:r}:""===r&&(e[t.xpath]="")):bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!1}))},isValid:function(e){var t,i=this.properties,r=this.getValue();t=this.getResource("render-activity-check-list-validation");for(var a=0;a<r.length;a+=1){if(!r[a].resolved){e.push({xpath:i.xpath,message:t});break}}}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.range",bizagi.rendering.range.prototype),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.range",{},{postRender:function(){this.properties},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.rangeDate",bizagi.rendering.rangeDate.prototype),bizagi.rendering.tablet.rangeDate.extend("bizagi.rendering.tablet.rangeDate",{},{setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.rangeMoney",bizagi.rendering.rangeMoney.prototype),bizagi.rendering.tablet.rangeMoney.extend("bizagi.rendering.tablet.rangeMoney",{},{postRender:function(){var e=new bizagi.rendering.money(this.getRenderProperties("min")),t=new bizagi.rendering.money(this.getRenderProperties("max"));this.setRanageControls(e,t)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,r={data:{properties:{id:i.id,xpath:i.xpath}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return r.data.properties.displayName="min"===e?"From":"To",r},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.rangeNumber",bizagi.rendering.rangeNumber.prototype),bizagi.rendering.tablet.rangeNumber.extend("bizagi.rendering.tablet.rangeNumber",{},{postRender:function(){var e=new bizagi.rendering.number(this.getRenderProperties("min")),t=new bizagi.rendering.number(this.getRenderProperties("max"));this.setRanageControls(e,t)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,r={data:{properties:{id:i.id,xpath:i.xpath}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return r.data.properties.displayName="min"===e?"From":"To",r},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.layoutRender",bizagi.rendering.layoutRender.prototype),bizagi.rendering.tablet.layoutRender.extend("bizagi.rendering.tablet.layoutImage",bizagi.rendering.layoutImage.prototype),bizagi.rendering.tablet.layoutImage.extend("bizagi.rendering.tablet.layoutImage",{renderControl:function(){var e=this.renderFactory.getTemplate("layout-image");return this.control=this.getControl(),$.fasttmpl(e,{})},postRender:function(){var e=this.getControl();if(this.value&&void 0!==this.value.value&&""!==this.value.value&&null!==this.value.value){var t=this.getImageUri();$.ajax({url:t,type:"GET",dataType:"binary",processData:!1,success:function(t){if("string"==typeof t){var i=arguments[2],r=i.getResponseHeader("Content-type");t=bizagi.util.media.byteArrayToBlob(bizagi.util.media.stringToByteArray(t),r)}var a=window.URL||window.webkitURL,n=a.createObjectURL(t);$(e).find("img").attr("src",n)}})}},getImageUri:function(){var e=this.parent.parent.properties.paramsRender||{},t={entity:this.value.guid,surrogateKey:this.value.surrogateKey,xpath:this.properties.xpath,width:96,height:96,hash:this.value.value};return e.formParams&&(e.formParams.idCase&&(t.idcase=e.formParams.idCase),e.formParams.idWorkitem&&(t.idworkitem=e.formParams.idWorkitem),e.xpathActions&&(t.contextxpath=e.xpathActions)),this.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(t)},getDisplayValue:function(){return[this.value]}}),bizagi.rendering.tablet.layoutRender.extend("bizagi.rendering.tablet.layoutPlaceholder",bizagi.rendering.layoutPlaceholder.prototype),bizagi.rendering.tablet.layoutRender.extend("bizagi.rendering.tablet.layoutBoolean",bizagi.rendering.layoutBoolean.prototype),bizagi.rendering.tablet.layoutRender.extend("bizagi.rendering.tablet.layoutLink",bizagi.rendering.layoutLink.prototype),bizagi.rendering.tablet.layoutLink.extend("bizagi.rendering.tablet.layoutLink",{render:function(){this.getContainerRender().addClass("bz-command-not-edit")},postRender:function(){var e=this.element;e&&e.on("click",$.proxy(this.onClickElement,this))},onClickElement:function(){var e={displayName:this.properties.displayName,navigateFromRender:!1,reference:this.properties.reference,referenceType:this.properties.referenceType,xpath:this.properties.xpath};bizagi.kendoMobileApplication&&"#renderSplitView"===bizagi.kendoMobileApplication.view().id&&(e.navigateFromRender=!0),this.triggerGlobalHandler("DATA-NAVIGATION",e)}}),bizagi.rendering.tablet.layoutRender.extend("bizagi.rendering.tablet.layoutLabel",bizagi.rendering.layoutLabel.prototype),bizagi.rendering.tablet.layoutLabel.extend("bizagi.rendering.tablet.layoutLabel",{setValue:function(e,t){this.properties.displayName=e,this._super(e,t);var i=this.getControl();i&&$(".ui-bizagi-render-label",i).text(e)}}),bizagi.rendering.tablet.layoutRender.extend("bizagi.rendering.tablet.layoutText",bizagi.rendering.layoutText.prototype),bizagi.rendering.tablet.layoutText.extend("bizagi.rendering.tablet.layoutText",{}),bizagi.rendering.tablet.layoutRender.extend("bizagi.rendering.tablet.layoutDateTime",bizagi.rendering.layoutDateTime.prototype),bizagi.rendering.tablet.layoutDateTime.extend("bizagi.rendering.tablet.layoutDateTime",{}),bizagi.rendering.tablet.layoutRender.extend("bizagi.rendering.tablet.layoutNumber",bizagi.rendering.layoutNumber.prototype),bizagi.rendering.tablet.layoutNumber.extend("bizagi.rendering.tablet.layoutNumber",{setValue:function(e,t){e=e?this.getDisplayValue(e):this.getDisplayValue(0),this.properties.displayName=e,this._super(e,t);var i=this.getControl();i&&$(".ui-bizagi-render-number",i).text(e)}}),bizagi.rendering.tablet.layoutRender.extend("bizagi.rendering.tablet.layoutMoney",bizagi.rendering.layoutNumber.prototype),bizagi.rendering.tablet.layoutMoney.extend("bizagi.rendering.tablet.layoutMoney",bizagi.rendering.layoutMoney.prototype),bizagi.rendering.tablet.layoutMoney.extend("bizagi.rendering.tablet.layoutMoney",{setValue:function(e,t){e=e?this.getDisplayValue(e):this.getDisplayValue(0),this.properties.displayName=e,this._super(e,t);var i=this.getControl();i&&$(".ui-bizagi-render-number",i).text(e)}}),bizagi.rendering.tablet.layoutRender.extend("bizagi.rendering.tablet.layoutUpload",bizagi.rendering.layoutUpload.prototype),bizagi.rendering.tablet.layoutUpload.extend("bizagi.rendering.tablet.layoutUpload",{renderControl:function(){var e=this,t=e.properties,i=$.Deferred();return $.when(e.getValueFilesByData(bizagi.clone(t))).done((function(t,r){e.properties=t,e.files=r.files,i.resolve(e.getHTMLFiles())})),i.promise()},getHTMLFiles:function(){var e=this,t=$.map(e.files,(function(t){var i={id:t[0],filename:t[1]};return i.url=e.buildItemUrl(i),i})),i=e.renderFactory.getTemplate("layout-upload");return $.fasttmpl(i,{files:t})},postRender:function(){var e=this;e.getControl().find(".ui-bizagi-render-upload-item a").on("click",(function(){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile($(this).attr("data-url"),this.title)).fail((function(t){t.responseText&&e.getFormContainer().failHandler(t.responseText)})).always((function(){bizagi.loading.stop()}))}))},buildItemUrl:function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileEntityUrl({isContextContainerWidgetRender:this.isContextContainerWidgetRender(),xpath:this.getUploadXpath(),fileId:e.id,idRender:i.properties.paramsRender.idRender||"undefined",xpathContext:t.xpathContext,idPageCache:i.properties.paramsRender.idPageCache||"undefined",xpathActions:i.properties.paramsRender.xpathActions||"undefined",sessionId:i.properties.sessionId,surrogatekey:this.properties.value.surrogateKey,guidentity:this.properties.value.guid})}}),bizagi.rendering.columns.column.extend("bizagi.rendering.tablet.columns.column",{},{applyOverrides:function(e){e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl)},getControl:function(){var e=this._super();return e&&0!=e.length||(e=$(this.element||this.observableElement)),e},render:function(e,t,i){var r=this._super(e,t,i),a=this.getDecorated(e);return a.element&&a.element.removeClass("ui-bizagi-render-display-normal ui-bizagi-render-display-vertical ui-bizagi-render-display-reversed").removeClass("ui-bizagi-render-display-vertical-reversed ui-bizagi-render-display-label ui-bizagi-render-display-value"),r},postRenderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties.editable;i.properties.editable=!1,null==i.grid&&(i.grid=this.grid),this.properties.singleInstance&&(i.element=t),i.postRenderElement(t),i.properties.editable=r},applyColumnStyles:function(e){var t=this.properties;(e=$(e)).css("-webkit-box-pack",t.align),t.textFormat.background&&(e.css("background-color",t.textFormat.background),e.css("background-image","none"))},isValueValid:function(e,t,i,r){var a=this._super(e,t,i,r),n=this.getDecorated(e);return n&&n.element&&(a?n.element.removeClass("bz-form-item--error"):n.element.addClass("bz-form-item--error")),a}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.combo",{},bizagi.rendering.columns.combo.prototype),bizagi.rendering.tablet.columns.combo.extend("bizagi.rendering.tablet.columns.combo",{},{setValue:function(e,t){var i=this.getDecorated(e),r=bizagi.util.isOfflineForm({context:this});if(null!==i){if("summary"==e)return this._super(e,t);if(!r||"number"!=typeof t&&"string"!=typeof t)if("columnRadio"==this.properties.type)this._super(e,t),i.selectedValue=t;else if(t&&t.length>0){a={id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!=t})):t[0][1]};this._super(e,a),i.selectedValue=a.value}else t&&t.id&&t.value?(this._super(e,t),i.selectedValue=t.value):t&&"number"==typeof t?this._super(e,t):r&&null!==t&&"object"===_typeof(t)&&t.value?(this._super(e,t.value),i.selectedValue=t.value):(this._super(e,null),i.selectedValue="");else{var a="object"==_typeof(this.properties.data)?this.properties.data.find((function(e){return e.id==t})):t;this._super(e,a),i.selectedValue=t}}}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.document",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),"design"!==t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.getDocumentXpath=this.getDocumentXpath,e.getContextXpath=this.getContextXpath,e.documentTemplateGenerate=this.documentTemplateGenerate,e.preRenderControl=this.preRenderControl,e.deleteDocumentTemplate=this.deleteDocumentTemplate,e.properties.xpathContext=this.getContextXpath())},renderControl:function(){return this.preRenderControl(),this._super()},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath);var i=e.parent,r=e.getFormContainer();$.when(r.submitData()).done((function(){$.when(e.dataService.generateDocumentTemplate(t)).done((function(t){$.when(i.refresh()).done((function(){e.autoOpenDocuments()})),e.endLoading()})).fail((function(){e.showErrorMessage(),e.endLoading()}))})).fail((function(t){e.getFormContainer().addErrorMessage(t),e.endLoading()}))},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getDocumentXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),t},postRenderReadOnly:function(e,t,i){this._super(e,t,i)},getContextXpath:function(){var e=this.getFormContainer();return(e.properties.xpathContext?e.properties.xpathContext+".":"")+this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},preRenderControl:function(){null!=this.value&&null!=this.properties.value&&(this.properties.value=this.value)},deleteDocumentTemplate:function(e){var t=this.parent,i={};i.xpath=this.properties.xpath+"[fileName='"+e+"']",i.idRender=this.properties.id,i.xpathContext=this.getContextXpath(),i.idPageCache=this.properties.idPageCache,$.when(this.dataService.deleteUploadFile(i)).done((function(){t.refresh()}))}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.date",{},{applyOverrides:function(e){this._super(e)}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.text",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.number",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.numberScientificNotation",{},{postRender:function(e,t){this._super(e,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(e,t){return this.renderReadOnly(e,t)},postRenderSummary:function(e,t){return this.postRenderReadOnly(e,t),!0}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.image",{},{applyOverrides:function(e){var t=this.properties;this._super(e),e.properties.xpathContext=t.xpathContext.length>0?t.xpathContext+"."+this.grid.properties.xpath+"[id="+e.surrogateKey+"]":this.grid.properties.xpath+"[id="+e.surrogateKey+"]"}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.upload",{},{applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath;e.applyUploadPlugin;e.getXpathContext=function(){this.surrogateKey;var e=this.properties;return e.xpathContext.length>0?e.xpathContext+"."+this.grid.properties.xpath+"[id="+this.surrogateKey+"]":this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),r=this.getXpathContext();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:t.xpath,xpathContext:r,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})}},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.link",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),"design"!==t&&"layout"!==t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.properties.xpathContext=this.grid.properties.xpath+"[id="+this.surrogateKey+"]",this.grid.properties.xpathContext&&-1===e.properties.xpathContext.indexOf(this.grid.properties.xpathContext)&&(e.properties.xpathContext=this.grid.properties.xpathContext+"."+e.properties.xpathContext)),"columnFormLink"===e.properties.type&&(e.getFormLinkXpath=this.getFormLinkXpath)},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getContextXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},getFormLinkXpath:function(){if(this.properties.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties(),this.properties.xpath)return this.properties.xpath}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.uploadecm",{},{applyOverrides:function(e){this._super(e),e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl),e.getUploadXpath=this.getUploadXpath,e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),r=this.getUploadXpath(this.surrogateKey),a=(r=r.split("."))[r.length-1],n=this.getXpathContext(this.surrogateKey);return this.dataService.getUploadFileUrl({idRender:t.id,xpath:a,xpathContext:n,idPageCache:t.idPageCache,fileId:e.idFileUpload,sessionId:i.properties.sessionId,contexttype:t.contexttype})},e.buildAddParams=function(){var e=this.properties,t=this.getFormContainer(),i=this.getUploadXpath(this.surrogateKey),r=((i=i.split("."))[i.length-1],this.getXpathContext(this.surrogateKey)),a={url:e.addUrl,xpath:e.xpath,idAttrib:e.idAttrib,xpathContext:r,metaValues:[],idSession:t.properties.sessionId,contexttype:"entity",validExtensions:e.validExtensions,maxSize:e.maxSize};return a[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,a},e.getXpathContext=function(){var e=this.properties;return e.xpathContext.length>0?e.xpathContext+"."+this.grid.properties.xpath+"[id="+this.surrogateKey+"]":this.grid.properties.xpath+"[id="+this.surrogateKey+"]"}},renderReadOnly:function(e,t){var i="<div></div>",r=this.getDecorated(e);if(r.setValue(t),this.setValue(e,t),this.setSurrogateKey(e),this.applyOverrides(r),r.grid=this.grid,r.column=this,r.surrogateKey=e,this.readyDeferred=new $.Deferred,r.files.length>0){this.properties.editable;r.properties.editable=!1,i=r.render("cell.upload")}return i},getUploadXpath:function(e){return e=this.surrogateKey||e||"",this.grid.properties.xpath+"[id="+e+"]."+this.properties.xpath},getControl:function(){var e=this._super();return e&&0!=e.length?$(".bz-form-item",this.element||this.observableElement):$(".ui-bizagi-cell-readonly",this.element||this.observableElement)}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.button",{},{}),bizagi.rendering.tablet.columns.combo.extend("bizagi.rendering.tablet.columns.radio",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.readonly",bizagi.rendering.columns.readonly.prototype),bizagi.rendering.tablet.columns.readonly.extend("bizagi.rendering.tablet.columns.readonly",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.search",{},bizagi.rendering.columns.search.prototype),bizagi.rendering.tablet.columns.search.extend("bizagi.rendering.tablet.columns.search",{},{renderReadOnly:function(e,t){return t&&t.length>0?(t=[].concat(t[0]),this._super(e,{id:t[0],label:t[1],additionallabel:t[2]||void 0})):this._super(e,t)},render:function(e,t){return t&&t.length>0?(t=[].concat(t[0]),this._super(e,{id:t[0],label:t[1],additionallabel:t[2]||void 0})):this._super(e,t)},postRender:function(e,t){this._super(e,t),this.getDecorated(e).refreshControl=this.refreshControl},refreshControl:function(){this.grid.refreshCell({key:this.surrogateKey,column:this.properties.xpath,xpathContext:this.getFormContainer().properties.xpathContext})}}),bizagi.rendering.tablet.columns.combo.extend("bizagi.rendering.tablet.columns.list",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.exclusiveCheck",{},{render:function(e,t){var i=this;i.changed=!1;var r=i.properties,a=i.getFormContainer(),n=i.grid.changes,o=i.getDecorated(e);if(o.grid=i.grid,o.column=this,o.surrogateKey=e,"execution"==i.getMode()){i.setValue(e,t||!1);var s=i.grid.enabledChecks[i.properties.xpath].find((function(t){return t.id==e}));void 0===s&&i.grid.enabledChecks[i.properties.xpath].push({id:e,value:t||!1,originalValue:t||!1,changed:!1})}if(null==t){i.changed=!0;var l={};l[i.properties.xpath]=i.getValue(e),bizagi.util.isEmpty(n[e])&&(n[e]={}),n[e]=$.extend({},n[e],l)}if(i.overrideDecoratedRenderProperties(e),!r.editable)return i.renderReadOnly.apply(i,arguments);i.readyDeferred=new $.Deferred;var d=o.render("cell");return o.bind("renderchange",(function(){i.changed=!0,i.grid.enabledChecks[i.properties.xpath].forEach((function(t){if(t.id==e)t.value=o.value,t.changed=!0;else if(o.value&&t.value){var r=i.getDecorated(t.id);r.setDisplayValue(!1),i.setValue(t.id,!1),t.value=!1,t.changed=!0,a.isOfflineForm&&i.handleOfflineChange(r,t)}}));var t=i.properties.xpath.split(".");i.grid.exclusiveChanges[i.properties.xpath]={xpath:i.properties.xpath,simpleXpath:t[t.length-1],value:i.getValue(e),key:e}})),i.bind("rendered",(function(){i.readyDeferred.resolve()})),d},postRender:function(e,t){this._super(e,t);var i=this.getMode();(this.setSurrogateKey(e),"execution"==i)&&(this.getDecorated(e).getControl().parents("tr").data("new-row")?this.isNewRow=!0:this.isNewRow=!1)},isValueValid:function(e,t,i,r){if(this.grid.enabledChecks=this.grid.enabledChecks||{},(this.grid.enabledChecks[this.properties.xpath]||[]).filter((function(e){return e.value})).length>1){var a=this.getResource("render-exclusive-column-check-error").replaceAll("#label#",this.properties.displayName);return i.push(a),!1}return!0},handleOfflineChange:function(e,t){var i=this.grid.changes,r={};r[e.properties.xpath]=t.value,bizagi.util.isEmpty(i[t.id])&&(i[t.id]={}),i[t.id]=$.extend({},i[t.id],r),this.grid.onCellChange(this,null,t.id)}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.hidden",bizagi.rendering.columns.hidden.prototype),bizagi.rendering.tablet.columns.hidden.extend("bizagi.rendering.tablet.columns.hidden",{},{}),$.Class.extend("bizagi.rendering.base.factory",{},{init:function(e){this.templates={},this.dataService=e},loadOverrides:function(){},initAsyncStuff:function(){return $.when.apply($,[this.loadOverrides(),this.loadTemplates()])},loadTemplates:function(){},loadTemplate:function(e,t){var i=this;return bizagi.templateService.getTemplate(t,e).done((function(t){i.templates[e]=t}))},getCommonTemplate:function(e){return this.templates[e]},getContainer:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==t?new bizagi.rendering.form(r):"mobileform"==t?new bizagi.rendering.mobileform(r):"template"==t?new bizagi.rendering.formTemplate(r):"queryForm"==t?new bizagi.rendering.queryForm(r):"layout"==t?new bizagi.rendering.layout(r):"usersForm"==t?new bizagi.rendering.usersForm(r):"panel"==t?new bizagi.rendering.panel(r):"section"==t?new bizagi.rendering.section(r):"contentPanel"==t||"contentpanel"==t?new bizagi.rendering.contentPanel(r):"nestedform"==t.toLowerCase()?new bizagi.rendering.nestedForm(r):"tab"==t?new bizagi.rendering.tab(r):"tabItem"==t||"tabitem"==t?new bizagi.rendering.tabItem(r):"horizontal"==t?new bizagi.rendering.horizontal(r):"accordion"==t?new bizagi.rendering.accordion(r):"accordionItem"==t?new bizagi.rendering.accordionItem(r):"group"==t?new bizagi.rendering.group(r):"mobilegroup"==t?new bizagi.rendering.mobilegroup(r):"searchForm"==t?(r.context="search",r.contexttype="metadata",new bizagi.rendering.searchForm(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return t||(t="label"),"text"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.extendedText(r):new bizagi.rendering.text(r):"mobiletext"==t?new bizagi.rendering.mobiletext(r):"association"==t?new bizagi.rendering.association(r):"label"==t?new bizagi.rendering.label(r):"hidden"==t?new bizagi.rendering.hidden(r):"number"==t?new bizagi.rendering.number(r):"money"==t?new bizagi.rendering.money(r):"date"==t?new bizagi.rendering.date(r):"boolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.check(r):new bizagi.rendering.yesno(r):"combo"==t?new bizagi.rendering.combo(r):/^cascadingcombo$/i.test(t)?new bizagi.rendering.cascadingCombo(r):"list"==t?new bizagi.rendering.list(r):"multiSelect"==t?new bizagi.rendering.multiSelect(r):"radio"==t?new bizagi.rendering.radio(r):"image"==t?new bizagi.rendering.image(r):"uploadecm"==t?new bizagi.rendering.ecm(r):"upload"==t?new bizagi.rendering.upload(r):"grid"==t?new bizagi.rendering.grid(r):"groupedgrid"==t?new bizagi.rendering.grid(r):"search"==t?new bizagi.rendering.search(r):"suggest"==t?(r.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.search(r)):"searchList"==t?new bizagi.rendering.searchList(r):"letter"==t?new bizagi.rendering.letter(r):"button"==t?new bizagi.rendering.button(r):"formLink"==t?new bizagi.rendering.formLink(r):"link"==t?new bizagi.rendering.link(r):"layoutImage"==t?new bizagi.rendering.layoutImage(r):"layoutLink"==t?new bizagi.rendering.layoutLink(r):"layoutLabel"==t?new bizagi.rendering.layoutLabel(r):"layoutText"==t?new bizagi.rendering.layoutText(r):"layoutDateTime"==t?new bizagi.rendering.layoutDateTime(r):"layoutNumber"==t?new bizagi.rendering.layoutNumber(r):"layoutMoney"==t?new bizagi.rendering.layoutMoney(r):"layoutPlaceholder"==t?new bizagi.rendering.layoutPlaceholder(r):"actionLauncher"==t?new bizagi.rendering.actionLauncher(r):"layoutBoolean"==t?new bizagi.rendering.layoutBoolean(r):"layoutUpload"==t?new bizagi.rendering.layoutUpload(r):"entityTemplate"==t?new bizagi.rendering.entityTemplate(r):"polymorphicLauncher"==t?new bizagi.rendering.polymorphicLauncher(r):"userfield"==t?new bizagi.rendering.userfieldWrapper(r):0==t.indexOf("search")?this.getSearchRender(e):0==t.indexOf("query")?this.getQueryRender(e):"document"==t?new bizagi.rendering.document(r):"image"==t?new bizagi.rendering.image(r):"fileprint"==t?new bizagi.rendering.fileprint(r):"geolocation"==t?new bizagi.rendering.geolocation(r):"collectionnavigator"==t?new bizagi.rendering.collectionnavigator(r):"getUser"==t?new bizagi.rendering.getUser(r):"rangeDate"==t?new bizagi.rendering.rangeDate(r):"rangeMoney"==t?new bizagi.rendering.rangeMoney(r):"rangeNumber"==t?new bizagi.rendering.rangeNumber(r):"activityCheckList"==t?new bizagi.rendering.activityCheckList(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnText"==t){var a=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return r.decorated=a?bizagi.rendering.extendedText:bizagi.rendering.text,new bizagi.rendering.columns.text(r)}if("columnSearchList"==t)return r.decorated=bizagi.rendering.searchList,new bizagi.rendering.columns.searchList(r);if("columnNumber"==t)return r.decorated=bizagi.rendering.number,new bizagi.rendering.columns.number(r);if("columnMoney"==t)return r.decorated=bizagi.rendering.money,new bizagi.rendering.columns.number(r);if("columnDate"==t)return r.decorated=bizagi.rendering.date,new bizagi.rendering.columns.date(r);if("columnBoolean"==t){if("check"==(i.properties.display||"option")){if(r.decorated=bizagi.rendering.check,e.data.properties.isExclusive)return new bizagi.rendering.columns.exclusiveCheck(r)}else r.decorated=bizagi.rendering.yesno;return new bizagi.rendering.columns.column(r)}return"columnCombo"==t?(r.decorated=bizagi.rendering.combo,new bizagi.rendering.columns.combo(r)):"columnRadio"==t?(r.decorated=bizagi.rendering.radio,new bizagi.rendering.columns.radio(r)):"columnList"==t?(r.decorated=bizagi.rendering.list,new bizagi.rendering.columns.list(r)):"columnHidden"==t?(r.decorated=bizagi.rendering.hidden,new bizagi.rendering.columns.column(r)):"columnUpload"==t?(r.decorated=bizagi.rendering.upload,new bizagi.rendering.columns.upload(r)):"columnImage"==t?(r.decorated=bizagi.rendering.image,new bizagi.rendering.columns.image(r)):"columnUploadEcm"==t?(r.decorated=bizagi.rendering.ecm,new bizagi.rendering.columns.uploadecm(r)):"columnLink"==t?(r.decorated=bizagi.rendering.link,new bizagi.rendering.columns.link(r)):"columnFormLink"==t?(r.decorated=bizagi.rendering.formLink,new bizagi.rendering.columns.link(r)):"columnUserfield"==t?(r.decorated=bizagi.rendering.userfieldWrapper,new bizagi.rendering.columns.column(r)):"columnSearch"==t?(r.decorated=bizagi.rendering.search,new bizagi.rendering.columns.search(r)):"columnLabel"==t?(r.decorated=bizagi.rendering.label,new bizagi.rendering.columns.column(r)):"columnReadonly"==t?(r.decorated=bizagi.rendering.label,new bizagi.rendering.columns.readonly(r)):"columnDocument"==t?(r.decorated=bizagi.rendering.document,new bizagi.rendering.columns.document(r)):"columnLetter"==t?(r.decorated=bizagi.rendering.letter,new bizagi.rendering.columns.letter(r)):"columnButton"==t?(r.decorated=bizagi.rendering.button,new bizagi.rendering.columns.button(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.extendedText(r):new bizagi.rendering.text(r):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.check(r):new bizagi.rendering.yesno(r):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.numberScientificNotation(r):new bizagi.rendering.number(r):"searchMoney"==t?new bizagi.rendering.money(r):"searchDate"==t?new bizagi.rendering.date(r):"searchCombo"==t?new bizagi.rendering.combo(r):"searchSuggest"==t?new bizagi.rendering.search(r):"searchLabel"==t?new bizagi.rendering.label(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getQueryRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"queryText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.queryExtendedText(r):new bizagi.rendering.queryText(r):"queryBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.queryCheck(r):new bizagi.rendering.queryYesNo(r):"queryNumber"==t?new bizagi.rendering.queryNumber(r):"queryMoney"==t?new bizagi.rendering.queryMoney(r):"queryDate"==t?new bizagi.rendering.queryDate(r):"queryCombo"==t?new bizagi.rendering.queryCombo(r):"queryCascadingCombo"==t?new bizagi.rendering.queryCascadingCombo(r):"querySuggest"==t?new bizagi.rendering.querySuggest(r):"queryLabel"==t?new bizagi.rendering.queryLabel(r):"queryList"==t?new bizagi.rendering.queryList(r):"queryMultiSelect"==t?new bizagi.rendering.queryMultiSelect(r):"querySearch"==t?new bizagi.rendering.querySearch(r):"queryRadio"==t?new bizagi.rendering.queryRadio(r):"queryState"==t?new bizagi.rendering.queryState(r):"queryCaseState"==t?new bizagi.rendering.queryCaseState(r):"queryProcess"==t?new bizagi.rendering.queryProcess(r):"querySearchUser"==t?new bizagi.rendering.querySearchUser(r):"queryHidden"==t?new bizagi.rendering.hidden(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getTemplate:function(e){return this.templates[e]}}),bizagi.rendering.base.factory.extend("bizagi.rendering.tablet.factory",{},{loadTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("icons",e.getFileTemplate("common.bizagi.rendering.icons")),e.loadTemplate("form-error",e.getFileTemplate("bizagi.rendering.tablet.form-error")),e.loadTemplate("form-waiting",e.getFileTemplate("bizagi.rendering.tablet.form-waiting")),e.loadTemplate("form",e.getFileTemplate("bizagi.rendering.tablet.form")+"#bz-form-container"),e.loadTemplate("complexgateway",e.getFileTemplate("bizagi.rendering.tablet.form")+"#bz-form-complex-gateway"),e.loadTemplate("panel",e.getFileTemplate("bizagi.rendering.tablet.panel")),e.loadTemplate("tab",e.getFileTemplate("bizagi.rendering.tablet.tab")),e.loadTemplate("tabItem",e.getFileTemplate("bizagi.rendering.tablet.tabItem")),e.loadTemplate("horizontal",e.getFileTemplate("bizagi.rendering.tablet.horizontal")),e.loadTemplate("accordion",e.getFileTemplate("bizagi.rendering.tablet.accordion")),e.loadTemplate("accordionItem",e.getFileTemplate("bizagi.rendering.tablet.accordionItem")),e.loadTemplate("group",e.getFileTemplate("bizagi.rendering.tablet.group")),e.loadTemplate("section",e.getFileTemplate("bizagi.rendering.tablet.section")),e.loadTemplate("searchForm",e.getFileTemplate("bizagi.rendering.tablet.searchForm")),e.loadTemplate("contentPanel",e.getFileTemplate("bizagi.rendering.tablet.contentPanel")),e.loadTemplate("render",e.getFileTemplate("bizagi.rendering.tablet.render")),e.loadTemplate("readonly",e.getFileTemplate("bizagi.rendering.tablet.readonly")),e.loadTemplate("readonly-value",e.getFileTemplate("bizagi.rendering.tablet.readonly")),e.loadTemplate("text",e.getFileTemplate("bizagi.rendering.tablet.text")+"#bz-render-text"),e.loadTemplate("text-readOnly",e.getFileTemplate("bizagi.rendering.tablet.text")+"#bz-render-text-readonly"),e.loadTemplate("extendedText",e.getFileTemplate("bizagi.rendering.tablet.extendedText")+"#bz-render-extended-text"),e.loadTemplate("extendedText-readOnly",e.getFileTemplate("bizagi.rendering.tablet.extendedText")+"#bz-render-extended-text-readonly"),e.loadTemplate("number",e.getFileTemplate("bizagi.rendering.tablet.number")),e.loadTemplate("numberScientificNotation",e.getFileTemplate("bizagi.rendering.tablet.numberScientificNotation")),e.loadTemplate("date",e.getFileTemplate("bizagi.rendering.tablet.date")),e.loadTemplate("yesno",e.getFileTemplate("bizagi.rendering.tablet.yesno")),e.loadTemplate("check",e.getFileTemplate("bizagi.rendering.tablet.check")),e.loadTemplate("checkList",e.getFileTemplate("bizagi.rendering.tablet.checkList")),e.loadTemplate("combo",e.getFileTemplate("bizagi.rendering.tablet.combo")+"#bz-combo-control"),e.loadTemplate("combo-readonly",e.getFileTemplate("bizagi.rendering.tablet.combo")+"#bz-combo-control-readonly"),e.loadTemplate("combo-list",e.getFileTemplate("bizagi.rendering.tablet.combo")+"#bz-combo-control-list"),e.loadTemplate("modal-header-search",e.getFileTemplate("bizagi.rendering.tablet.modal")+"#bz-modal-view-header-search"),e.loadTemplate("modal-footer-done",e.getFileTemplate("bizagi.rendering.tablet.modal")+"#bz-modal-view-footer-done"),e.loadTemplate("list",e.getFileTemplate("bizagi.rendering.tablet.list")+"#bz-render-list"),e.loadTemplate("list-items",e.getFileTemplate("bizagi.rendering.tablet.list")+"#bz-render-list-items"),e.loadTemplate("radio",e.getFileTemplate("bizagi.rendering.tablet.radio")),e.loadTemplate("image",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image"),e.loadTemplate("image-item",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image-item"),e.loadTemplate("image-preview",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image-preview"),e.loadTemplate("image-readonly",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image-readonly"),e.loadTemplate("uploadSlide",e.getFileTemplate("bizagi.rendering.tablet.slide.upload")),e.loadTemplate("upload",e.getFileTemplate("bizagi.rendering.tablet.upload")+"#bz-render-upload"),e.loadTemplate("upload-item",e.getFileTemplate("bizagi.rendering.tablet.upload")+"#bz-render-upload-item"),e.loadTemplate("upload-readonly",e.getFileTemplate("bizagi.rendering.tablet.upload")+"#bz-render-upload-readonly"),e.loadTemplate("grid",e.getFileTemplate("bizagi.rendering.tablet.grid")),e.loadTemplate("cell",e.getFileTemplate("bizagi.rendering.tablet.cell")),e.loadTemplate("cell.readonly",e.getFileTemplate("bizagi.rendering.tablet.cell.readonly")),e.loadTemplate("cell.upload",e.getFileTemplate("bizagi.rendering.tablet.cell.upload")),e.loadTemplate("search",e.getFileTemplate("bizagi.rendering.tablet.search")+"#bz-render-search"),e.loadTemplate("search.item",e.getFileTemplate("bizagi.rendering.tablet.search")+"#bz-render-search-item"),e.loadTemplate("search.items",e.getFileTemplate("bizagi.rendering.tablet.search")+"#bz-render-search-items"),e.loadTemplate("searchItem",e.getFileTemplate("bizagi.rendering.tablet.searchItem")),e.loadTemplate("searchList",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list"),e.loadTemplate("searchList.item",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-item"),e.loadTemplate("searchList.items",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-items"),e.loadTemplate("searchList.actions",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-actions"),e.loadTemplate("searchList.tag",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-tag"),e.loadTemplate("searchList.readonly",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-readonly"),e.loadTemplate("searchList-modal-header",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-modal-header"),e.loadTemplate("letter",e.getFileTemplate("bizagi.rendering.tablet.letter")),e.loadTemplate("letter.readonly",e.getFileTemplate("bizagi.rendering.tablet.letter.readonly")),e.loadTemplate("letter.dialog",e.getFileTemplate("bizagi.rendering.tablet.dialog-letter")),e.loadTemplate("button",e.getFileTemplate("bizagi.rendering.tablet.button")),e.loadTemplate("link",e.getFileTemplate("bizagi.rendering.tablet.link")),e.loadTemplate("formLink",e.getFileTemplate("bizagi.rendering.tablet.formLink")),e.loadTemplate("geolocation",e.getFileTemplate("bizagi.rendering.tablet.geolocation")),e.loadTemplate("association",e.getFileTemplate("bizagi.rendering.tablet.association")),e.loadTemplate("ecm",e.getFileTemplate("bizagi.rendering.tablet.ecm")+"#bz-render-ecm"),e.loadTemplate("ecm-item",e.getFileTemplate("bizagi.rendering.tablet.ecm")+"#bz-render-ecm-item"),e.loadTemplate("ecm-readonly",e.getFileTemplate("bizagi.rendering.tablet.ecm")+"#bz-render-ecm-readonly"),e.loadTemplate("list-multiselect",e.getFileTemplate("bizagi.rendering.tablet.multiSelect")+"#bz-multiselect"),e.loadTemplate("multiselect-list",e.getFileTemplate("bizagi.rendering.tablet.multiSelect")+"#bz-multiselect-list"),e.loadTemplate("document",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator"),e.loadTemplate("document-item",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator-item"),e.loadTemplate("document-readonly",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator-readonly"),e.loadTemplate("document-download",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator-download"),e.loadTemplate("hand-signature",e.getFileTemplate("bizagi.rendering.tablet.handSignature")+"#bz-signature"),e.loadTemplate("hand-signature-readonly",e.getFileTemplate("bizagi.rendering.tablet.handSignature")+"#bz-signature-readonly"),e.loadTemplate("render-actionLauncher",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher"),e.loadTemplate("render-actionLauncher-horizontal",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-horizontal"),e.loadTemplate("render-actionLauncher-vertical",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-vertical"),e.loadTemplate("render-actionLauncher-actions-to-execute",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-actions-to-execute"),e.loadTemplate("render-actionLauncher-design",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-design"),e.loadTemplate("render-polymorphicLauncher",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher"),e.loadTemplate("render-polymorphicLauncher-vertical-tree",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree"),e.loadTemplate("render-polymorphicLauncher-vertical-tree-item",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree-item"),e.loadTemplate("render-polymorphicLauncher-actions-to-execute",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-actions-to-execute"),e.loadTemplate("render-polymorphicLauncher-confirm",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-confirm"),e.loadTemplate("render-polymorphicLauncher-design",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-design"),e.loadTemplate("render-layout",e.getFileTemplate("bizagi.rendering.tablet.layout.render")),e.loadTemplate("layout-image",e.getFileTemplate("bizagi.rendering.tablet.layout.image")+"#ui-bizagi-render-layout-image"),e.loadTemplate("layout-image64",e.getFileTemplate("bizagi.rendering.tablet.layout.image")+"#ui-bizagi-render-layout-image64"),e.loadTemplate("layout-label",e.getFileTemplate("bizagi.rendering.tablet.layout.label")),e.loadTemplate("layout-link",e.getFileTemplate("bizagi.rendering.tablet.layout.link")),e.loadTemplate("layout-text",e.getFileTemplate("bizagi.rendering.tablet.layout.text")),e.loadTemplate("layout-date-time",e.getFileTemplate("bizagi.rendering.tablet.layout.dateTime")),e.loadTemplate("layout-money",e.getFileTemplate("bizagi.rendering.tablet.layout.money")),e.loadTemplate("layout-number",e.getFileTemplate("bizagi.rendering.tablet.layout.number")),e.loadTemplate("layout-upload",e.getFileTemplate("bizagi.rendering.tablet.layout.upload")),e.loadTemplate("bizagi.grid.grid",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid"),e.loadTemplate("bizagi.grid.waiting",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-waiting"),e.loadTemplate("bizagi.grid.table",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-table"),e.loadTemplate("bizagi.grid.table.empty",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-table-empty"),e.loadTemplate("bizagi.grid.column",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-column"),e.loadTemplate("bizagi.grid.column.special",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-column-special"),e.loadTemplate("bizagi.grid.row",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-row"),e.loadTemplate("bizagi.grid.row.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-row-buttons"),e.loadTemplate("bizagi.grid.cell",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-cell"),e.loadTemplate("bizagi.grid.cell.special",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-cell-special"),e.loadTemplate("bizagi.grid.pager",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-pager"),e.loadTemplate("bizagi.grid.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-buttons"),e.loadTemplate("bizagi.grid.dynamicpager",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-dynamic-pager"),e.loadTemplate("bizagi.grid.totalizer",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-totalizer"),e.loadTemplate("bizagi.grid.offline.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#bz-grid-offline-buttons"),e.loadTemplate("bizagi.grid.offline.row.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#bz-grid-offline-row-buttons"),e.loadTemplate("bizagi.grid.offline.cell.special",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#bz-grid-offline-cell-special")).done((function(){var i=$.fasttmpl(e.getTemplate("icons"));0===$("head").find("#genome-forms-icons").length&&$("head").append(i),t.resolve()})),t.promise()},getFileTemplate:function(e,t){var i=bizagi.detectDevice();return bizagi.getTemplate(e,t,"desktop"==i?"tablet_ios":i)},getContainer:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==(t=t.replace(/tablet/,""))?new bizagi.rendering.tablet.form(i):"template"==t?new bizagi.rendering.tablet.formTemplate(i):"queryForm"==t?new bizagi.rendering.tablet.queryForm(i):"layout"==t?new bizagi.rendering.tablet.layout(i):"usersForm"==t?new bizagi.rendering.tablet.usersForm(i):"panel"==t?new bizagi.rendering.tablet.panel(i):/^contentpanel$/i.test(t)?new bizagi.rendering.tablet.contentPanel(i):/^nestedform$/i.test(t)?new bizagi.rendering.tablet.nestedForm(i):"tab"==t?new bizagi.rendering.tablet.tab(i):/^tabitem$/i.test(t)?new bizagi.rendering.tablet.tabItem(i):"horizontal"==t?new bizagi.rendering.tablet.horizontal(i):"accordion"==t?new bizagi.rendering.tablet.accordion(i):"accordionItem"==t?new bizagi.rendering.tablet.accordionItem(i):"group"==t?new bizagi.rendering.tablet.group(i):"section"==t?new bizagi.rendering.tablet.section(i):"searchForm"==t?(i.context="search",i.contexttype="metadata",new bizagi.rendering.tablet.searchForm(i)):"mobileform"==t?new bizagi.rendering.mobileform(i):"mobilegroup"==t?new bizagi.rendering.mobilegroup(i):(bizagi.log(t+" not supported in render factory",e.data,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,r=i.properties,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance}),n=bizagi.util.isOfflineForm({container:e.parent});if("columnText"==(t=t.replace(/tablet/,""))){var o=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return a.decorated=o?bizagi.rendering.tablet.extendedText:bizagi.rendering.tablet.text,new bizagi.rendering.tablet.columns.text(a)}if("columnSearchList"==t)return a.decorated=bizagi.rendering.tablet.searchList,new bizagi.rendering.tablet.columns.searchList(a);if("columnNumber"==t)return a.decorated=bizagi.rendering.tablet.number,new bizagi.rendering.tablet.columns.number(a);if("columnMoney"==t)return a.decorated=bizagi.rendering.tablet.money,new bizagi.rendering.tablet.columns.number(a);if("columnDate"==t)return a.decorated=bizagi.rendering.tablet.date,new bizagi.rendering.tablet.columns.date(a);if("columnBoolean"==t){if("check"==(i.properties.display||"option")){if(a.decorated=bizagi.rendering.tablet.check,e.data.properties.isExclusive)return new bizagi.rendering.tablet.columns.exclusiveCheck(a)}else a.decorated=bizagi.rendering.tablet.yesno;return new bizagi.rendering.tablet.columns.column(a)}return"columnCombo"==t?(a.decorated=bizagi.rendering.tablet.combo,new bizagi.rendering.tablet.columns.combo(a)):"columnRadio"==t?(a.decorated=bizagi.rendering.tablet.radio,new bizagi.rendering.tablet.columns.radio(a)):"columnList"==t?(a.decorated=bizagi.rendering.tablet.list,new bizagi.rendering.tablet.columns.list(a)):"columnHidden"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,a.decorated=bizagi.rendering.tablet.hidden,new bizagi.rendering.tablet.columns.hidden(a)):"columnUpload"==t?(n&&bizagi.util.isOfflineFormsV2Supported()?a.decorated=bizagi.rendering.tablet.upload.offline:a.decorated=bizagi.rendering.tablet.upload,new bizagi.rendering.tablet.columns.upload(a)):"columnImage"==t?(a.decorated=bizagi.rendering.tablet.image,new bizagi.rendering.tablet.columns.image(a)):"columnUploadEcm"==t?(a.decorated=bizagi.rendering.tablet.ecm,new bizagi.rendering.tablet.columns.uploadecm(a)):"columnLink"==t?(a.decorated=bizagi.rendering.tablet.link,new bizagi.rendering.tablet.columns.link(a)):"columnFormLink"==t?(a.decorated=bizagi.rendering.tablet.formLink,new bizagi.rendering.tablet.columns.link(a)):"columnUserfield"==t?(a.decorated=bizagi.rendering.tablet.userfieldWrapper,new bizagi.rendering.tablet.columns.column(a)):"columnSearch"==t?(a.decorated=bizagi.rendering.tablet.search,new bizagi.rendering.tablet.columns.search(a)):"columnLabel"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,a.decorated=bizagi.rendering.tablet.label,new bizagi.rendering.tablet.columns.column(a)):"columnReadonly"==t?(a.decorated=bizagi.rendering.tablet.readonly,new bizagi.rendering.tablet.columns.readonly(a)):"columnDocument"==t?(a.decorated=bizagi.rendering.tablet.document,new bizagi.rendering.tablet.columns.document(a)):"columnButton"==t?(a.decorated=bizagi.rendering.tablet.button,new bizagi.rendering.tablet.columns.button(a)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,r=i.properties,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService}),n=bizagi.util.isOfflineForm({container:e.parent});return t||(t="label"),"text"==(t=t.replace(/tablet/,""))?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.tablet.extendedText(a):new bizagi.rendering.tablet.text(a):"association"==t?new bizagi.rendering.tablet.association(a):"label"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.tablet.label(a)):"hidden"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.tablet.hidden(a)):"number"==t?r&&29===r.dataType?new bizagi.rendering.tablet.numberScientificNotation(a):new bizagi.rendering.tablet.number(a):"money"==t?new bizagi.rendering.tablet.money(a):"date"==t?new bizagi.rendering.tablet.date(a):"boolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.tablet.check(a):new bizagi.rendering.tablet.yesno(a):"combo"==t?new bizagi.rendering.tablet.combo(a):/^cascadingcombo$/i.test(t)?new bizagi.rendering.tablet.cascadingCombo(a):"list"==t?new bizagi.rendering.tablet.list(a):"radio"==t?new bizagi.rendering.tablet.radio(a):"image"==t?n&&!bizagi.util.isOfflineFormsV2Supported()?new bizagi.rendering.tablet.image.old(a):new bizagi.rendering.tablet.image(a):"uploadecm"==t?new bizagi.rendering.tablet.ecm(a):"upload"==t?n?bizagi.util.isOfflineFormsV2Supported()?new bizagi.rendering.tablet.upload.offline(a):new bizagi.rendering.tablet.upload.offline.old(a):new bizagi.rendering.tablet.upload(a):"grid"==t?n?bizagi.util.isOfflineFormsV2Supported()?new bizagi.rendering.tablet.grid.offline(a):new bizagi.rendering.tablet.grid.offline.old(a):new bizagi.rendering.tablet.grid(a):"groupedgrid"==t?new bizagi.rendering.tablet.grid(a):"search"==t?new bizagi.rendering.tablet.search(a):"suggest"==t?(a.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.tablet.search(a)):"searchList"==t?new bizagi.rendering.tablet.searchList(a):"multiSelect"==t?new bizagi.rendering.tablet.multiSelect(a):"button"==t?new bizagi.rendering.tablet.button(a):"formLink"==t?new bizagi.rendering.tablet.formLink(a):"link"==t?new bizagi.rendering.tablet.link(a):"actionLauncher"==t?new bizagi.rendering.tablet.actionLauncher(a):"entityTemplate"==t?new bizagi.rendering.tablet.entityTemplate(a):"polymorphicLauncher"==t?new bizagi.rendering.tablet.polymorphicLauncher(a):"userfield"==t?new bizagi.rendering.tablet.userfieldWrapper(a):0==t.indexOf("search")?this.getSearchRender(e):"document"==t?new bizagi.rendering.tablet.document(a):"image"==t?new bizagi.rendering.tablet.image(a):"fileprint"==t?new bizagi.rendering.tablet.fileprint(a):"geolocation"==t?new bizagi.rendering.tablet.geolocation(a):"collectionnavigator"==t?new bizagi.rendering.tablet.collectionnavigator(a):0===t.indexOf("layout")?this.getLayoutRender(e):0===t.indexOf("range")?this.getRangeRender(e):"activityCheckList"==t?new bizagi.rendering.tablet.activityCheckList(a):"mobiletext"==t?new bizagi.rendering.mobiletext(a):"letter"==t?new bizagi.rendering.tablet.letter(a):/^signature$/i.test(t)?new bizagi.rendering.tablet.handSignature(a):/^readonly$/i.test(t)?new bizagi.rendering.tablet.readonly(a):this._super(e)},getLayoutRender:function(e){var t=e.type,i=e.data.properties,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"layoutImage"==t?new bizagi.rendering.tablet.layoutImage(r):"layoutLink"==t?new bizagi.rendering.tablet.layoutLink(r):"layoutLabel"==t?(bizagi.override.hiddenControlsWithDataType||delete i.dataType,new bizagi.rendering.tablet.layoutLabel(r)):"layoutText"==t?new bizagi.rendering.tablet.layoutText(r):"layoutDateTime"==t?new bizagi.rendering.tablet.layoutDateTime(r):"layoutNumber"==t?new bizagi.rendering.tablet.layoutNumber(r):"layoutMoney"==t?new bizagi.rendering.tablet.layoutMoney(r):"layoutPlaceholder"==t?new bizagi.rendering.tablet.layoutPlaceholder(r):"layoutBoolean"==t?new bizagi.rendering.tablet.layoutBoolean(r):"layoutUpload"==t?new bizagi.rendering.tablet.layoutUpload(r):this._super(e)},getRangeRender:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"rangeDate"===t?new bizagi.rendering.tablet.rangeDate(i):"rangeMoney"===t?new bizagi.rendering.tablet.rangeMoney(i):"rangeNumber"===t?new bizagi.rendering.tablet.rangeNumber(i):(bizagi.log(t+" not supported in render factory",e.data,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,r=i.properties,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==(t=t.replace(/tablet/,""))?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.tablet.extendedText(a):new bizagi.rendering.tablet.text(a):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.tablet.check(a):new bizagi.rendering.tablet.yesno(a):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.tablet.numberScientificNotation(a):new bizagi.rendering.tablet.number(a):"searchMoney"==t?new bizagi.rendering.tablet.money(a):"searchDate"==t?new bizagi.rendering.tablet.date(a):"searchCombo"==t?new bizagi.rendering.tablet.combo(a):"searchSuggest"==t?new bizagi.rendering.tablet.search(a):"searchLabel"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.tablet.label(a)):(bizagi.log(t+" not supported in render factory",i,"error"),null)}}),$.Class.extend("bizagi.rendering.device.factory",{},{init:function(e){this.execution_device=bizagi.util.detectDevice(),this.cachedFactory={}},getRenderFactory:function(e,t){var i=this;t=t||"desktop";var r=new $.Deferred;return void 0!==i.cachedFactory[t]?(i.cachedFactory[t].printVersion=!1,r.resolve(i.cachedFactory[t])):"print"===t?(i.cachedFactory[t]=new bizagi.rendering.print.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):"desktop"===t?(i.cachedFactory[t]=new bizagi.rendering.desktop.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):bizagi.util.isTabletDevice(t)?(i.cachedFactory[t]=new bizagi.rendering.tablet.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):bizagi.util.isSmartphoneDevice(t)?(i.cachedFactory[t]=new bizagi.rendering.smartphone.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):(bizagi.showMessageBox("Not supported device: "+t),r.reject("Not supported device: "+t)),r.promise()},getDataService:function(){return this.dataService}}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.queryForm",{},{}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.formTemplate",bizagi.rendering.formTemplate.prototype),bizagi.rendering.tablet.formTemplate.extend("bizagi.rendering.tablet.formTemplate",{},{}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.usersForm",{},{}),bizagi.rendering=bizagi.rendering||{},$.Class.extend("bizagi.rendering.facade",{form:void 0,executionDeferred:new $.Deferred},{init:function(e){e=e||{},this.observableElement=$({});var t=e.device||"";this.deviceFactory=new bizagi.rendering.device.factory,this.dataService=new bizagi.render.services.service(e),this.renderFactory=this.deviceFactory.getRenderFactory(this.dataService,t)},getFactory:function(){return{deviceFactory:this.deviceFactory,dataService:this.dataService,renderFactory:this.renderFactory}},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){return this.observableElement.triggerHandler.apply(this.observableElement,arguments)},update:function(e){return e.mode&&(this.mode=e.mode),this.execute($.extend({canvas:this.canvas,mode:this.mode},e))},execute:function(e){var t=this,i=this.ownerDocument,r=$("body",i);if(e=e||{},t.executionDeferred&&t.executionDeferred.state?"resolved"==t.executionDeferred.state()&&(t.executionDeferred=$.Deferred()):t.executionDeferred=$.Deferred(),bizagi.chrono.initAndStart("rendering+data",!0),bizagi.rendering.render.startOptimization(),void 0===e.mode&&!bizagi.util.isEmpty(window.location.search)){var a=bizagi.util.getQueryString();e.mode=a.mode}var n=t.canvas=e.canvas=e.canvas||$("<div />").appendTo(r);return t.mode=e.mode,t.sendExecutingPostMessageWebparts(),t.process(e).done((function(i){e.refreshing||n.empty(),n.append(i.container),$(i.pathProcess).insertBefore(i.container),t.form=i,t.form.setSize({width:t.lastWidth,height:t.lastHeight});var r=setTimeout((function(){t.lastWidth=$(window).width(),t.lastHeight=$(window).height(),window.self!==window.top&&t.resizeInPopUpHTML(),clearTimeout(r)}),2e3);i.triggerHandler("ondomincluded"),t.publish("rendering-formRendered",{form:i}),t.configureOpenForm(i),t.configureRefresh(i,n),t.configureRouting(i,n),t.configureRenderError(i,n),t.configureResize(i),t.configureGlobalHandlers(i),e.summaryForm&&i.container.addClass("ui-bizagi-summary-form"),bizagi.chrono.stopAndLog("rendering"),bizagi.chrono.stopAndLog("rendering+data"),bizagi.chrono.stopAndLog("submitForm"),bizagi.chrono.stopAndLog("submitForm-ajax"),bizagi.chrono.stopAndLog("waiting"),bizagi.rendering.render.stopOptimization(),bizagi.override.enableE2EInterface&&(t.Class.form=t.form,t.Class.executionDeferred.resolve(t.form)),t.executionDeferred.resolve(t.form)})).fail((function(e,i){$.when(t.renderFactory).done((function(i){void 0!==e&&""!==e||(e=bizagi.localization.getResource("render-error-unknown"));var r=i.getCommonTemplate("form-error");n.empty(),n.append($.tmpl(r,{message:e})),t.publish("rendering-formRenderedError",e),t.canvas.triggerHandler("errorform",e),bizagi.chrono.stopAndLog("rendering"),bizagi.chrono.stopAndLog("rendering+data"),t.executionDeferred.reject()}))})),t.executionDeferred.promise()},ready:function(){return this.executionDeferred.promise()},process:function(e){var t=this,i=new $.Deferred,r=t.dataService.getFormData(e),a=t.canvas||e.canvas;return bizagi.showErrorAlertDialog=!1,$.when(r,t.renderFactory).done((function(r,n){if(bizagi.showErrorAlertDialog=!0,bizagi.util.isEmpty(r))return t.publish("no-data-found"),void i.fail();if(r&&"reload"==r.type)(l=t.form)&&(l.endLoading(),l.dispose()),a.triggerHandler("routing",r);else if(r&&"suspended"==r.type){var o=n.getTemplate("info-message"),s=bizagi.localization.getResource("render-case-suspended");$.tmpl(o,{message:s}).appendTo(a),i.fail()}else if(r&&"error"!=r.type){e.hasOwnProperty("printversion")&&((r=t.transformGridControl(r)).form.properties.editable="False"),bizagi.chrono.initAndStart("rendering"),e.type=r.form&&r.form.properties.type||e.type;var l=t.processForm(r.form,n,e);i.resolve(l)}else t.getFailDeferred(r,i)})).fail((function(e){t.getFailDeferred(e,i)})),i.promise()},transformGridControl:function(e){var t=this;return null==e?e:(e.hasOwnProperty("type")&&"grid"==e.type?(e.id=e.id+"-print",e.allowAdd="False",e.allowDelete="False",e.allowEdit="False",e.allowGrouping="False",e.allowMore="False",e.allowSearch="False"):$.each(e,(function(i,r){"object"==_typeof(r)&&(e[i]=t.transformGridControl(e[i]))})),e)},getFailDeferred:function(e,t){var i="",r={};try{r=JSON.parse(e.responseText)}catch(t){r={message:e.responseText,errorType:"ERRORUNKNOWN"}}r.message?(i+="<br>Error Type: "+r.errorType,i+="<br>Error Message: "+r.message):"JSharpNotSupportedException"==r.errorType&&(i+="<br>Error Message: "+bizagi.localization.getResource("jsharp-required")),"ERRORUNKNOWN"==r.errorType?t.reject(i,r.errorType):t.reject(i)},processForm:function(e,t,i){var r=t.getContainer($.extend(i,{type:i.type||"form",data:e}));return r.render(),r},resize:function(e){this.form&&this.form.trigger("renderresize",e)},configureRefresh:function(e,t){var i=this;e.bind("refresh",(function(r,a){var n=e.container.parent(),o=(n=bizagi.util.scrollTop(n)).scrollTop();$(i.form).trigger("onRefreshStarted"),e.dispose(a),t.fastEmpty();var s=t.parent();s.find(".ui-bizagi-button-container").length>0&&s.find(".ui-bizagi-button-container").remove(),i.executionDeferred&&i.executionDeferred.state&&"resolved"==i.executionDeferred.state()&&(i.executionDeferred=$.Deferred());var l=i.form.getParams();return bizagi.util.isMobileDevice()&&!0===l.isOfflineForm&&($.extend(a,{isOfflineForm:!0,offlineType:l.offlineType,isOpen:l.isOpen}),a.online="debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase()?e.online:bizagi.util.isConnected()),$.when(i.execute($.extend(a,{canvas:t,refreshing:!0,idCase:l.idCase,displayName:l.displayName}))).done((function(){var e=setTimeout((function(){n.scrollTop(o),$(i.form).trigger("onRefreshFinished"),clearTimeout(e)}),100)})),i.executionDeferred.promise()}))},configureResize:function(e){var t=this;e.bind("renderresize",(function(i,r){if(r=r||{},!t.resizeTimeout){t.resizeTimeout=setTimeout((function(){var i=$(window).width(),a=$(window).height();(r.forceResize||i!=t.lastWidth)&&(bizagi.chrono.initAndStart("resize"),e.resize({width:i,height:a}),t.lastWidth=i,t.lastHeight=a,bizagi.chrono.stopAndLog("resize"),bizagi.chrono.log("resize")),t.resizeTimeout=null,clearTimeout(t.resizeTimeout)}),0)}})),t.resize()},configureRouting:function(e,t){e.bind("routing",(function(i,r){e.dispose(),t.triggerHandler("routing",r)}))},configureGlobalHandlers:function(e){var t=this;e.bind("globalHandler",(function(e,i){return t.publish(i.eventType,i.data)}))},configureOpenForm:function(e){$(document).trigger("openForm",{form:e})},configureRenderError:function(e,t){var i=this;e.bind("formRenderingError",(function(e,r){$.when(i.renderFactory).done((function(e){var a="<br>Error: ";r=r.replace(/(\r\n|\n|\r)/gm,"");var n=JSON.parse(r);n.message&&(a+=n.message,a+="<br>Error Type: "+n.errorType);var o=e.getCommonTemplate("form-error");t.empty(),t.append($.tmpl(o,{message:a})),i.canvas.triggerHandler("errorform","renderItemError"),bizagi.chrono.stopAndLog("rendering+data"),bizagi.chrono.stopAndLog("rendering")}))}))},dispose:function(){this.form&&this.form.dispose(),bizagi.util.dispose(this)},resizeInPopUpHTML:function(){if($(".activitiFormContainer").length>0&&"cases"!=bizagi.util.getQueryString().type){var e=$(".activitiFormContainer").height()||0,t=$(".activitiFormContainer #ui-bizagi-webpart-render-container"),i=$(".ui-bizagi-button-container",".activitiFormContainer"),r=i.outerHeight()||0,a=bizagi.util.getQueryString().renderBehavior||"";if("PopUp"==(a=a.replace("#",""))){if(void 0===self.postMessageSocket){var n=$(".activitiFormContainer").height()-50||396;$("#render-canvas").height(n),$("#render-canvas").css("overflowY","scroll")}else $(".activitiFormContainer").height($(".activitiFormContainer").height()+$(".ui-bizagi-button-container").height()+30);$(".ui-bizagi-button-container").css("position","absolute"),$(".ui-bizagi-button-container").appendTo(".activitiFormContainer"),$(".ui-bizagi-button-container").length>1&&($(".ui-bizagi-button-container:first").hide(),t.css("marginTop","-17px"))}i.length>0&&t.height(e-97-r),0==$(".ui-bizagi-button-container").children().length?$("#render-canvas").height($("#render-canvas").height()+r):(i.width("100%"),i.css("marginLeft",0),i.css("bottom",0))}else"render"==bizagi.util.getQueryString().type&&($("html").css("overflowX","hidden"),$("#render").height()<=window.innerHeight+5?$("html").css("overflowY","hidden"):$("html").css("overflowY","scroll"),$(".ui-widget-overlay").height(650))},sendExecutingPostMessageWebparts:function(){bizagi&&bizagi.iframeCommunicator&&bizagi.iframeCommunicator.trigger("executing-rendering",{})}});
//# sourceMappingURL=../../../../Maps/tablet_android/rendering.tablet.production.js.map
