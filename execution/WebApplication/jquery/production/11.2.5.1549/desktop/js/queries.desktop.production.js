function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.queries",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERIES},renderContent:function(){var e=this.getTemplate("queries"),t=this.content=$.tmpl(e);return this.loadtemplates(),t},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.listCases",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_LISTCASES},setTableHeadFixed:function(e){e.TableElement.floatThead(e.floatOptions),e.groupByCaseNumber&&bizagi.util.isIE()&&e.TableElement.find("tbody > tr.ui-bizagi-wp-app-inbox-grouped-trtag-hide").hide()},_startQuickActions:function(){var e=void 0!==this.quickActionsInstance,t={getContainerSelector:this.getQuickActionContainerSelector.bind(this),checkAllSelector:this.getQuickActionCheckAllContainerSelector(),refreshShowedResults:this.updateResults.bind(this)};e||(this.quickActionsInstance=new bizagi.workportal.widgets.quickActions(this.workportalFacade,this.dataService,t))},updateResults:function(){var e=bizagi.util.tryCatch((function(){return bizagi.referrerParams.changeProcessOptions}),{});this.changeProcess(e)},_QuickActionsRenderIn:function(e,t,r){var i=e.find("#contentQuickActions");this.quickActionsInstance.setDataToExecute(t,r),this.quickActionsInstance.renderIn(i),this.quickActionsInstance.renderCheckboxGroup(e)},_getWorkItemsInfo:function(e,t){for(var r={},i=this._getIndexFromTableColumn(e,"order","T_IDTASK"),a=this._getIndexFromTableColumn(e,"order","T_RADNUMBER"),o=0;o<t.length&&-1!==i;o++)for(var s=t[o].fields,n=s[i].workitems,u=0;u<n.length&&-1!==a;u++){var c=n[u];c.idCase=t[o].id,c.caseNumber=s[a],r[c.idWorkItem]=c}return r},_getIndexFromTableColumn:function(e,t,r){return e.findIndex((function(e){return e[t].toUpperCase()===r}))},getQuickActionCheckAllContainerSelector:function(){return"#ui-quickActions-all-processes"},getQuickActionContainerSelector:function(e){return"#ui-quickActions-checkbox-"+e},showCase:function(e,t){var r=this,a=r.getContent(),o=$("#contentDesc",a),s={},n="";r.idCase=e,o.empty(),0!=r.idCase&&$.when(r.dataService.summaryCaseDetails({idCase:r.idCase})).done((function(u){var c=null,l=!1;u.isAdhocProcess&&void 0!==u.isAdhocProcess||(u.isAdhocProcess=!1),u.isAdhocProcess&&(c=u.idAdhocProcess,l=!0),u.hasComments="true"==u.hasComments;var d=new bizagi.workportal.command.security(r.dataService);u.graphicQuery=d.checkSecurityPerm("GraphicQuery"),u.enableFeatureShowTimelineButton=bizagi.override.enableFeatureShowTimelineButton,u.enableTimelineByProcessType=r.isAvailableTimelineByProcessType(u.isAdhocProcess),u.currentState&&u.currentState.length>0&&u.currentState.forEach((function(e){e.idTask||(e.idTask=0),e.state||(e.state=e.displayName||" ")})),"undefined"!==u.process&&""!==u.process&&void 0!==u.process||(u.process=!1),"undefined"!==u.processPath&&""!==u.processPath&&void 0!==u.processPath||(u.processPath=!1);var m=$.tmpl(r.caseSummaryTemplate,$.extend(u,{security:bizagi.menuSecurity})).appendTo(o);r.callTaskDescription(u,m),bizagi.util.formatInvariantDate(a,r.getResource("dateFormat")+" "+r.getResource("timeFormat")),$("#details",m).delegate(".summaryLink","click",(function(){r.routingExecute($(this)),p.dialog("close")}));var p=m;$("#ui-bizagi-details-tabs",a).tabs({active:-1,create:function(e,t){$(this).tabs("option","active",0)},activate:function(e,t){switch(null==t?"formSummary":t.newPanel.attr("id")){case"comments":null==s.comments&&($.extend(r,{},bizagi.workportal.comments),u.canvas=$("#comments"),u.readOnly=!0,$.when(r.renderComments(u)).done((function(e){s.comments=e}))),bizagi.util.setContext({commentsFocus:!0});break;case"formSummary":if(null==s.formSummary){var a=$("#formSummary",o);a.bind("oldrenderintegration",(function(e){if(!e.isPropagationStopped()){e.stopPropagation();var t=r.getTemplate("inbox-common-case-summary-oldrender"),o={};bizagi.oldrenderevent=!0;var s=window.addEventListener?"addEventListener":"attachEvent";(0,window[s])("attachEvent"==s?"onmessage":"message",(function(e){e.stopPropagation(),r.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.data})}),!1),$.when(r.dataService.getWorkitems({idCase:r.idCase,onlyUserWorkItems:!0,eventAsTasks:!0})).done((function(e){if("object"==_typeof(e.workItems)&&e.workItems.length>=1){var s=e.workItems[0].idWorkItem,n=e.workItems[0].idTask;for(i=0;i<e.workItems.length;i++)if(e.workItems[i].idCase==r.idCase){s=e.workItems[i].idWorkItem,n=e.workItems[i].idTask;break}o.url=r.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+r.idCase+"&idWorkitem="+s+"&idTask="+n+"&isSummary=1"}else o.url=r.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+r.idCase+"&isSummary=1";a.empty(),$.tmpl(t,o).appendTo(a),r.iframeOldRender($("iframe",a))}))}}));var c={idCase:r.idCase};$.when(r.dataService.getCaseFormsRenderVersion(c)).done((function(e){1==e.formsRenderVersion?a.trigger("oldrenderintegration"):$.when(r.renderSummaryForm($("#formSummary",m))).done((function(){n=$("#formSummary",m).html(),s.formSummary=n}))}))}break;case"subprocess":null==s.subprocess&&$.when(r.dataService.summarySubProcess({idCase:r.idCase})).done((function(e){(n=$.tmpl(r.caseSummaryTemplateSubprocess,e)).appendTo($("#subprocess",m)),s.subprocess=n,n.delegate(".summaryLink","click",(function(){r.routingExecute($(this)),p.dialog("close")}))}));break;case"assignees":null==s.assignees&&$.when(r.dataService.summaryAssigness({idCase:r.idCase,preview:!0})).done((function(e){var t=[];$.each(e.events.split(", "),(function(e,r){-1===$.inArray(r,t)&&t.push(r)})),e.events=t.join(", "),(n=$.tmpl(r.caseSummaryTemplateAssigness,e)).appendTo($("#assignees",m)),s.assignees=n}));break;case"events":null==s.events&&$.when(r.dataService.summaryCaseEvents({idCase:r.idCase})).done((function(e){(n=$.tmpl(r.caseSummaryTemplateEvents,e)).appendTo($("#events",m)),s.events=n,n.delegate(".summaryLink","click",(function(){r.routingExecute($(this)),p.dialog("close")}))}))}}}),$(".workonitRow",m).button(),$(".js-show-timeline",m).click((function(t){var i=$.trim($(this).closest("div.ui-bizagi-wp-app-inbox-processes-title").find("span.js-case-number").text());r.showTimeLine({radNumber:i,idCase:e})})),$("#ui-bizagi-wp-app-inbox-description-container .ui-bizagi-wp-app-inbox-cases-ico-view",a).click((function(){l?r.showGraphicQuery({idCase:e,idWorkflow:t,isAdhoc:!0,idProcess:c}):r.showGraphicQuery({idCase:e,idWorkflow:t})})),$(".workonitRow",m).click((function(){p.dialog("close");var e=$(this).parent().find("#idWorkItem").val();r.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:r._getIdCase(u,e),idWorkflow:t,idTask:$(this).parent().find("#idTask").val(),idWorkItem:e})}));var g={};g[bizagi.localization.getResource("workportal-case-dialog-box-close")]=function(){o.empty(),m.remove(),$("#ui-bizagi-wp-app-inbox-description-container").remove()},p.dialog({modal:!0,title:u.process,width:1e3,height:600,draggable:!0,resizable:!0,buttons:g,close:function(){o.empty(),m.remove(),$("#ui-bizagi-wp-app-inbox-description-container").remove()}})}))},_getIdCase:function(e,t){var r=$.grep(e.currentState,(function(e){return e.idWorkItem==t}))[0];return r&&void 0!==r.idCase?r.idCase:e.idCase},callTaskDescription:function(e,t){var r={classNeedsModal:"task_description_needs_modal",width:720};new bizagi.workportal.widgets.task.description(this.workportalFacade,this.dataService,r).renderManyTasksDescription(e.currentState,t)},renderSummaryForm:function(e){var t=this,r=void 0!==t.dataService.serviceLocator.proxyPrefix?t.dataService.serviceLocator.proxyPrefix:"";bizagi.loader.start("rendering").then((function(){var i=new bizagi.rendering.facade({proxyPrefix:r});i.execute({canvas:e,summaryForm:!0,idCase:t.idCase}),t.renderingFacade=i,setTimeout((function(){t.resizeLayout()}),1e3)}))},isAvailableTimelineByProcessType:function(e){return!e||e&&bizagi.util.isEnableFeature("enableTimelineOnLiveProcesses")}}),bizagi.workportal.widgets.listCases.extend("bizagi.workportal.widgets.queryform",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM},renderContent:function(){bizagi.util.parseBoolean(bizagi.override.disableFrankensteinQueryForms)&&!this.params.notMigratedUrl?this.modifiedRender():this.frankensteinRenderContent()},modifiedRender:function(){var e,t=this.getTemplate("queryform-wrapper");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){},frankensteinRenderContent:function(){var e=this.getTemplate("queryform"),t="",r=this.params.idQueryForm||"",i=this.params.idStoredQuery||"",a=this.params.idCube||"";switch(this.params.queryFormAction){case"edit":t=this.dataService.getUrl({endPoint:"query-form-edit"})+"?idStoredQuery="+i+"&idQueryForm="+r;break;case"loadPrevious":t="App/ListaDetalle/listaitems.aspx?"+this.dataService.lastQueryFullKey;break;default:t=this.dataService.getUrl({endPoint:"query-form"})+"?idQueryForm="+r,t=""!=i?t+"&idStoredQuery="+i:t,t=""!=a?t+"&idCube="+a:t}return this.params.notMigratedUrl&&(t="App/"+this.params.notMigratedUrl),this.content=$.tmpl(e,{queryFormURL:t})}}),bizagi.workportal.widgets.queries.extend("bizagi.workportal.widgets.queries",{},{init:function(e,t,r){this._super(e,t,r),this.loadTemplates({queries:bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries"),"queries-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-elements"),"queries-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-empty-elements"),"queries-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-query-tree"),"queries-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-confirm"),useNewEngine:!1})},postRender:function(){this.configureTreeNavigation(),this.configureBackButton(),this.renderQueries(),this.scrollVertical({autohide:!1})},renderQueries:function(e,t){var r,i,a=this,o=a.getContent(),s=a.getTemplate("queries-elements"),n=a.getTemplate("queries-empty-elements"),u=$("#queries",o);$.when(a.dataService.getQueries({idElement:e})).done((function(e){u.empty(),(e=e||{}).length>=1?(i=null!=t?$.merge(t,e):e,r=$.tmpl(s,i,{checkChildNode:a.checkChildNode})):r=$.tmpl(n,i),r.appendTo(u),a.configureNavTree(u)}))},configureNavTree:function(e){var t=this,r=t.getTemplate("queries-query-confirm");$("li","#queries").click((function(){var e=$(this).children("#idCube").val(),r=$(this).children("#queryId").val(),i=$(this).children("#prefix").val(),a=$(this).children("#nodesLength").val(),o=$(this).children("#idStoredQuery").val(),s=$(this).children("#id").val(),n=$(this).children("#queryDisplayName").val(),u=t.getTemplate("queries-query-tree"),c=$("#categoryTree");if("-1"==r)$.tmpl(u,{idParentQuery:s,queryDisplayName:n}).appendTo(c),t.configureTreeNavigation(),t.renderQueries(s);else if(a>0)$.tmpl(u,{idParentQuery:s,queryDisplayName:n}).appendTo(c),t.configureTreeNavigation(),t.renderQueries(s,[{queryDisplayName:n,idStoredQuery:o,id:s,idParent:"",queryId:r,prefix:i,nodes:[],idCube:$(this).data("idcube"),categoryWithLink:"true"}]);else{bizagi.workportal.desktop.popup.closePopupInstance();var l=this.data("queryDisplayName");t.showQueryFormPopup({idQuery:r,idStoredQuery:"-1"==o?"":o,title:l,idCube:e})}})),$(".editButton","#queries").click((function(e){e.stopPropagation();var r=$(this).parent().find("#idStoredQuery").val();t.showQueryFormPopup({queryFormAction:"edit",idQuery:"-1",idStoredQuery:"-1"==r?"":r,title:$("#queryDisplayName",$(this).parent()).val()}),bizagi.workportal.desktop.popup.closePopupInstance()})),$(".deleteButton","#queries").click((function(e){e.stopPropagation();var i,a=$(this).parent().find("#idStoredQuery").val(),o=$(this).parent().find("#prefix").val(),s=$(this).parent().find("#idCube").val(),n=$.tmpl(r);"prefix_MyStoredQuery"==o?i=t.dataService.getUrl({endPoint:"query-form-delete"})+"?idStoredQueryDel="+a+"&idQueryForm=-1":"prefix_Cube"==o&&(i=t.dataService.getUrl({endPoint:"query-form-delete-cube"})),$(n).dialog({resizable:!0,modal:!0,title:t.getResource("workportal-widget-queries-confirm-title"),buttons:[{text:t.getResource("workportal-widget-queries-confirm-delete"),click:function(){"prefix_MyStoredQuery"==o?$.ajax({url:i}):"prefix_Cube"==o&&$.destroy(i,{idCube:s}),$(this).dialog("close"),bizagi.workportal.desktop.popup.closePopupInstance()}},{text:t.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]})}))},configureBackButton:function(){var e=this,t=e.getContent(),r=$("#bt-back",t),i=$("#categoryTree",t);r.click((function(){if($("li",i).length>1){$("li:last-child",i).remove();var t=$("li:last-child").children("#idParent").val();e.renderQueries(t)}}))},configureTreeNavigation:function(){var e=this,t=e.getContent(),r=$("#categoryTree",t);$("li:last-child",r).click((function(){$(this).nextAll().remove();var t=$(this).children("#idParent").val();e.renderQueries(t)}))},scrollVertical:function(){var e=this.getContent();$("#queries",e).bizagiScrollbar({autohide:!1})},showQueryFormPopup:function(e){var t=e.idQuery||"",r=e.idStoredQuery||"",i=e.queryFormAction||"",a=e.title||"",o=e.idCube||"";"queryform"!=this.currentPopup?(this.currentPopup="queryform",this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,idQueryForm:t,idStoredQuery:r,queryFormAction:i,idCube:o,modalParameters:{title:a,id:"Queries"}})):bizagi.workportal.desktop.popup.closePopupInstance()}}),bizagi.workportal.widgets.queries.extend("bizagi.workportal.widgets.queries.definition",{},{init:function(e,t,r){this._super(e,t,r),this.loadTemplates({queries:bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries"),"queries-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-elements"),"queries-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-empty-elements"),"queries-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-query-tree"),"queries-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-confirm"),"queries-definition-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-definition-elements"),"queries-definition-manage-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-definition-manage-menu"),"queries-liveprocesses-query-element":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-definition-liveprocesses-menu"),"queries-flat-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-flat-list"),"queries-query-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-message-error"),useNewEngine:!1})},loadtemplates:function(){this.mainTemplate=this.getTemplate("queries-definition-elements"),this.mainTemplateManage=this.getTemplate("queries-definition-manage-elements"),this.mainTemplateLiveProcessesQuery=this.getTemplate("queries-liveprocesses-query-element"),this.emptyTemplate=this.getTemplate("queries-empty-elements"),this.flatListTemplate=this.getTemplate("queries-flat-list"),this.confirmTemplate=this.getTemplate("queries-query-confirm"),this.messageErrorTemplate=this.getTemplate("queries-query-message-error")},postRender:function(){this.configureTreeNavigation("#queries"),this.renderQueries(),this.scrollVertical({autohide:!1})},showManageQueries:function(){var e,t=this.mainTemplateManage,r=!0===bizagi.menuSecurity.QueriesPermissionManager&&bizagi.util.isEnableFeature("enableTransferQueryOwnership");return r&&(e=$.tmpl(t,{})),{manageContent:e,isManageQueries:r}},getLiveProcessesQuery:function(){return this.hasLiveProcessesQuery()?$.tmpl(this.mainTemplateLiveProcessesQuery,{}):void 0},hasLiveProcessesQuery:function(){return!0===bizagi.menuSecurity.AdhocUserGroupReport},mergeQueryWithLpContent:function(e,t){var r=e;return void 0!==e&&void 0!==t?r=$.merge(e,t):void 0!==t&&(r=t),r},beforeSavedQueriesContent:function(e,t,r){var i,a=this.showManageQueries(),o=a.manageContent;if(e.length>=1){i=void 0!==t?$.merge(t,e):e;var s=$.tmpl(this.mainTemplate,i,{checkChildNode:this.checkChildNode});this.validateMenu(o,r)?o=s:o.append(s)}else a.isManageQueries||this.hasLiveProcessesQuery()||(o=$.tmpl(this.emptyTemplate,i));return o},addEventToMangeQueries:function(e){e.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERIES_MANAGEMENT,data:{},maximize:!0,closeVisible:!1,modalParameters:{title:bizagi.localization.getResource("workportal-widget-queries-management-title"),width:790,height:540,refreshInbox:!1}})},addEventToLPQuery:function(e){$(document).find("iframe").length>0&&-1!==$(document).find("iframe")[0].contentWindow.location.href.indexOf("quickprocess")?(bizagi.util.liveProcessesEvents.routeEvents.route="/reports",document.dispatchEvent(bizagi.util.liveProcessesEvents.routeEvents),bizagi.workportal.desktop.popup.closePopupInstance()):e.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROFLY,data:{route:"reports",params:{module:"none"}}})},validateMenu:function(e,t){return(null==e||void 0!==t)&&"-1"!==t||null==e&&"-1"===t},getQueriesDefinitions:function(e,t){var r,i,a=function(e){var t=new $.Deferred;return t.resolve(e),t.promise()},o=function(e){return e.sort((function(e,t){var r=e.queryDisplayName.toLowerCase(),i=t.queryDisplayName.toLowerCase();return r==i?0:r>i?1:-1}))};return t?(i=this.dataService.getQueriesDefinitions({idNode:e}),(r=i,bizagi.util.tryCatch((function(){return"function"==typeof r.promise}),!1)?r:a(r)).pipe((function(t){return t&&e?o(t):t})),i):a([])},getStoredQueryFormList:function(e){var t=this;return(e?function(){return t.dataService.getStoredQueryFormList()}:function(){var e=new $.Deferred;return e.resolve({storedQueryForms:[]}),e.promise()})()},renderQueries:function(e,t){var r,i=this,a=bizagi.menuSecurity.BizagiQueries,o=i.getContent(),s=$("#queries",o);$.when(i.getQueriesDefinitions(e,a)).done((function(o){s.empty(),r=i.beforeSavedQueriesContent(o||[],t,e),void 0===e||"-1"===e?$.when(i.getStoredQueryFormList(a)).done((function(e){if(e.storedQueryForms.length>0){var t=$.tmpl(i.mainTemplate,{queryType:"-2",queryDisplayName:i.getResource("workportal-widget-queries-stored-query-forms"),nodes:[],guidForm:"stored"});r=$.merge(r,t),i.storedQueryForm=e.storedQueryForms}s.append(i.mergeQueryWithLpContent(r,i.getLiveProcessesQuery())),i.configureNavTree(s)})):r.appendTo(s),i.configureNavTree(s)}))},renderStoredQueries:function(){var e=this.getContent(),t=this.flatListTemplate,r=$("#queries",e);$.tmpl(t,{storedQueryForm:this.storedQueryForm,queryNameFormatter:this.queryNameFormatter}).appendTo(r)},queryNameFormatter:function(e){if(e){var t=bizagi.localization.getResource("workportal-general-word-anonymized");e=e.replace(/UserDeleted_[a-zA-z0-9-]*/gi,t.toLowerCase())}return e},configureNavTree:function(e){var t=this;t.getTemplate("queries-query-confirm");$("li#manageQueries",e).click((function(){t.addEventToMangeQueries(t)})),$("li#manageLiveProcessesQuery",e).click((function(){t.addEventToLPQuery(t)})),$("li:not(#manageQueries,#manageLiveProcessesQuery)",e).click((function(){var e=$(this).children("#idNode").val(),r=($(this).children("#guidQueryForm").val(),$(this).children("#guidForm").val()),i=$(this).children("#guidContext").val(),a=$(this).children("#queryType").val(),o=$(this).children("#nodesLength").val(),s=$(this).children("#queryDisplayName").val(),n=t.getTemplate("queries-query-tree"),u=$("#categoryTree"),c=$(this).children("#notMigratedUrl").val();if("-2"==a)t.renderStoredQueries(),$.tmpl(n,{idParentQuery:"-2",queryDisplayName:s}).appendTo(u),t.configureTreeNavigation("#queries");else if(o>0)$.tmpl(n,{idParentQuery:e,queryDisplayName:s}).appendTo(u),t.configureTreeNavigation("#queries"),t.renderQueries(e);else{bizagi.workportal.desktop.popup.closePopupInstance();var l=$("#queryDisplayName",this).val();t.showQueryFormPopup({guidForm:r,guidEntity:i,title:l,queryFormAction:"renderQueryForm",queryType:a,notMigratedUrl:c})}})),$(".deleteGAButton").click((function(e){e.stopPropagation();var r=$.tmpl(t.confirmTemplate),i={resizable:!0,modal:!0,title:t.getResource("workportal-widget-queries-confirm-title"),buttons:[]},a=$("#notMigratedUrlDelete",$(this).parent()).val();i.buttons=[{text:t.getResource("workportal-widget-queries-confirm-delete"),click:function(){$(this).dialog("close"),a&&$.destroy(a),bizagi.workportal.desktop.popup.closePopupInstance()}},{text:t.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}],$(r).dialog(i)}))},configureTreeNavigation:function(e){var t=this,r=t.getContent(),i=$("#categoryTree",r),a=$(e,r);$("li:last-child",i).click((function(){$(this).nextAll().remove();var e=$(this).children("#idParent").val();"-2"==e?t.renderStoredQueries():t.renderQueries(e)})),$("li.storedQuery",a).click((function(){var e,r=$(this).data("guid"),i=($(this).data("id"),$(this).data("idnode")),a=$.grep(t.storedQueryForm,(function(e){return e.idNode==i}));1==a.length&&(e=a[0],t.showQueryFormPopup({idStoredQuery:r,idQuery:1,title:e.definition.name,paramsStoredQuery:e,queryFormAction:"execute",notMigratedUrl:e.notMigratedUrl?e.notMigratedUrl.execute:""}))})),$(".editButton",e).click((function(e){e.stopPropagation();$(this).parent().data("guid");var r,i=$(this).parent().data("id"),a=$(this).parent().data("idnode"),o=$.grep(t.storedQueryForm,(function(e){return e.idNode==a}));1==o.length&&(r=o[0],t.showQueryFormPopup({queryFormAction:"edit",idStoredQuery:"-1"==i?"":i,paramsStoredQuery:r,title:r.definition.name,notMigratedUrl:r.notMigratedUrl?r.notMigratedUrl.edit:""}),bizagi.workportal.desktop.popup.closePopupInstance())})),$(".deleteButton",e).click((function(e){e.stopPropagation();$(this).parent().data("guid");var r,i,a,o=$(this).parent().data("id"),s=$(this).parent().data("idnode"),n=t.getResource("workportal-widget-admin-entities-message-migrate");n=n.replace("{build}",bizagi.loader.productBuildToAbout);var u=$.grep(t.storedQueryForm,(function(e){return e.idNode==s}));1==u.length&&(i=u[0],a={resizable:!0,modal:!0,title:t.getResource("workportal-widget-queries-confirm-title"),buttons:[]},null!==bizagi.cookie("JSESSIONID")&&i.notMigratedUrl?r=$.tmpl(t.messageErrorTemplate,{messageError:n}):(r=$.tmpl(t.confirmTemplate),a.buttons=[{text:t.getResource("workportal-widget-queries-confirm-delete"),click:function(){$(this).dialog("close"),i.notMigratedUrl&&i.notMigratedUrl.delete?$.get("App/"+i.notMigratedUrl.delete):t.dataService.deleteStoredQueryForm({idStoredQueryForm:o}),bizagi.workportal.desktop.popup.closePopupInstance(),t.publish("refreshQueryFormShortCut")}},{text:t.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]),$(r).dialog(a))}))},scrollVertical:function(){var e=this.getContent();$("#queries",e).bizagiScrollbar({autohide:!1})},showQueryFormPopup:function(e){var t=this,r=e.queryFormAction||"",i=e.title||"",a=e.queryType||"",o=e.guidForm||"",s=e.guidEntity||"",n=e.paramsStoredQuery||{};"queryform"!=t.currentPopup?(t.currentPopup="queryform",t.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,queryFormAction:r,queryType:a,paramsStoredQuery:n,modalParameters:{title:i,id:"Queries"},closeVisible:!1,guidForm:o,guidEntity:s,notMigratedUrl:e.notMigratedUrl||"",maximizeOnly:!0,editQueryForm:function(e){t.currentPopup=void 0,t.showPopUpEditQueryForm(e)},executeQueryForm:function(e){t.currentPopup=void 0,t.showPopUpResultsQueryForm(e)}})):bizagi.workportal.desktop.popup.closePopupInstance()},showPopUpEditQueryForm:function(e){var t=this;t.getContent();$.when(t.dataService.getStoredQueryFormList()).done((function(r){if(t.storedQueryForm=r.storedQueryForms,t.publish("refreshQueryFormShortCut"),e&&e.response){var i=e.response;t.editQueryForm(i)}}))},showPopUpResultsQueryForm:function(e){var t=this;t.getContent();$.when(t.dataService.getStoredQueryFormList()).done((function(r){if(t.storedQueryForm=r.storedQueryForms,t.publish("refreshQueryFormShortCut"),e&&e.response){var i=e.response;t.executeQueryForm(i)}}))},editQueryForm:function(e){var t=this.getParamsStoredQuery(e);1==t.length&&(t=t[0],this.showQueryFormPopup({queryFormAction:"edit",idStoredQuery:"-1"==e?"":e,paramsStoredQuery:t,title:t.definition.name,notMigratedUrl:t.notMigratedUrl?t.notMigratedUrl.edit:""}))},executeQueryForm:function(e){var t=this.getParamsStoredQuery(e);1==t.length&&(t=t[0],this.showQueryFormPopup({idStoredQuery:t.guid,idQuery:1,title:t.definition.name,paramsStoredQuery:t,queryFormAction:"execute",notMigratedUrl:t.notMigratedUrl?t.notMigratedUrl.execute:""}))},getParamsStoredQuery:function(e){return $.grep(this.storedQueryForm,(function(t){return t.id==e}))}}),bizagi.workportal.widgets.queries.definition.extend("bizagi.workportal.widgets.queries.shortcut",{},{init:function(e,t,r){this._super(e,t,r),this.loadTemplates({queries:bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries"),"queries-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-elements"),"queries-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-empty-elements"),"queries-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-query-tree"),"queries-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-confirm"),"queries-definition-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-definition-elements"),"queries-flat-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-flat-list"),"queries-query-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries").concat("#ui-bizagi-workportal-widget-queries-message-error"),"queries-shortcut":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-shortcut"),"queries-shortcut-flat-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-flat-list-shortcut"),"queries-shortcut-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-confirm-shortcut"),"queries-shortcut-query-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queries.shortcut").concat("#ui-bizagi-workportal-widget-queries-message-error-shortcut"),useNewEngine:!1})},loadtemplates:function(){this.flatListTemplate=this.getTemplate("queries-shortcut-flat-list"),this.confirmTemplate=this.getTemplate("queries-shortcut-query-confirm"),this.messageErrorTemplate=this.getTemplate("queries-shortcut-query-message-error")},postRender:function(){var e=this.getTemplate("queries-shortcut");this.content=$.tmpl(e);this.handleEvents(),bizagi.workportal.widgets.queries.shortcut.instance=this},handleEvents:function(){var e=this;$("#queryFormShortcutContainer").show(),$("#queryFormShortcutContainer").click((function(){var t=$("#queryFormShortcut"),r=$(this).find("span");!!t.is(":hidden")?(t.show(),r.removeClass("Right"),r.addClass("Down"),e.renderStoredQueries()):(t.hide(),r.removeClass("Down"),r.addClass("Right"))}))},configureTreeNavigation:function(){var e=this,t=($("#categoryTree",e.content),$("#queries-shortcut",e.content));$("li.storedQuery",t).click((function(){var t,r=$(this).data("guid"),i=($(this).data("id"),$(this).data("idnode")),a=$.grep(e.storedQueryForm,(function(e){return e.idNode==i}));1==a.length&&(t=a[0],e.showQueryFormPopup({idStoredQuery:r,idQuery:1,title:t.definition.name,paramsStoredQuery:t,queryFormAction:"execute",notMigratedUrl:t.notMigratedUrl?t.notMigratedUrl.execute:""})),e.currentPopup=void 0})),$(".bz-icon-pencil-outline","#queries-shortcut").click((function(t){$(this).closest(".storedQuery").data("guid");var r,i=$(this).closest(".storedQuery").data("id"),a=$(this).closest(".storedQuery").data("idnode"),o=$.grep(e.storedQueryForm,(function(e){return e.idNode==a}));1==o.length&&(r=o[0],e.showQueryFormPopup({queryFormAction:"edit",idStoredQuery:"-1"==i?"":i,paramsStoredQuery:r,title:r.definition.name,notMigratedUrl:r.notMigratedUrl?r.notMigratedUrl.edit:""}),bizagi.workportal.desktop.popup.closePopupInstance())})),$(".bz-icon-close","#queries-shortcut .bz-shorcut__icons").click((function(t){t.stopPropagation();$(this).closest(".storedQuery").data("guid");var r,i,a,o=$(this).closest(".storedQuery").data("id"),s=$(this).closest(".storedQuery").data("idnode"),n=e.getResource("workportal-widget-admin-entities-message-migrate");n=n.replace("{build}",bizagi.loader.productBuildToAbout);var u=$.grep(e.storedQueryForm,(function(e){return e.idNode==s}));1==u.length&&(i=u[0],a={resizable:!0,modal:!0,title:e.getResource("workportal-widget-queries-confirm-title"),buttons:[]},null!==bizagi.cookie("JSESSIONID")&&i.notMigratedUrl?r=$.tmpl(e.messageErrorTemplate,{messageError:n}):(r=$.tmpl(e.confirmTemplate),a.buttons=[{text:e.getResource("workportal-widget-queries-confirm-delete"),click:function(){$(this).dialog("close"),i.notMigratedUrl&&i.notMigratedUrl.delete?$.get("App/"+i.notMigratedUrl.delete):$.when(e.dataService.deleteStoredQueryForm({idStoredQueryForm:o})).done((function(){bizagi.workportal.desktop.popup.closePopupInstance(),e.renderStoredQueries()})),e.renderStoredQueries(),bizagi.workportal.desktop.popup.closePopupInstance()}},{text:e.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]),$(r).dialog(a))}))},renderStoredQueries:function(e){var t=this,r=t.flatListTemplate,i=$("#queries-shortcut",t.content);$.when(t.dataService.getStoredQueryFormList()).done((function(e){t.storedQueryForm=e.storedQueryForms,$.tmpl(r,{storedQueryForm:t.storedQueryForm}).appendTo(i),t.configureTreeNavigation(),t.storedQueryForm.length<=0?$("#queryFormShortcutContainer").hide():$("#queryFormShortcutContainer").show()}))}}),bizagi.workportal.widgets.queryform.extend("bizagi.workportal.widgets.queryform",{SELECTORS:{FORM_LOADER:"#query-form-loader",FORM:"#query-form",FORM_BUTTONS:"#query-form-buttons"},QUERY_FORM_ACTIONS:{EDIT:"edit",RENDER_QUERY_FORM:"renderQueryForm",SUBMIT_QUERY_FORM:"submitQueryForm",GRAPHICAL_ANALYSIS:"graphicalAnalysis",EXECUTE:"execute",SAVE_QUERY_FORM:"saveQueryForm"}},{init:function(e,t,r){this._super(e,t,r),this.loadTemplates({queryform:bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-frankenstein-queryform-wrapper"),"queryform-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-wrapper"),"queryform-container":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-container"),"queryform-buttons":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-buttons"),"queryform-graphic-analysis":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-graphic-analysis"),"queryform-result-set":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-result-set"),"queryform-search-result":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-search-result"),"queryform-pagination":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-pagination"),"queryform-admin-result":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-admin-result"),"queryform-share-selection":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-share-selection"),"queryform-select-user":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-select-user"),"queryform-select-group":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-select-group"),"queryform-save-as":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform-save-as"),"queryform-message-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.queryform").concat("#ui-bizagi-workportal-widget-queryform--message-error"),"inbox-common-case-summary":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description"),"inbox-common-case-summary-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-subprocess"),"inbox-common-case-summary-assignees":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-assignees"),"inbox-common-case-summary-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-events"),useNewEngine:!1}),bizagi.referrerParams||(bizagi.referrerParams={}),bizagi.referrerParams.referrer=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,this.lstIdCasesBackup(this.lstIdCases())},postRender:function(){this.caseSummaryTemplate=this.getTemplate("inbox-common-case-summary"),this.caseSummaryTemplateSubprocess=this.getTemplate("inbox-common-case-summary-subprocess"),this.caseSummaryTemplateAssigness=this.getTemplate("inbox-common-case-summary-assignees"),this.caseSummaryTemplateEvents=this.getTemplate("inbox-common-case-summary-events"),"true"==this.params.notMigratedUrl&&(this.params.notMigratedUrl=Boolean(this.params.notMigratedUrl)),""==this.params.notMigratedUrl||1==this.params.notMigratedUrl?this.modifiedPostRender():this.frankensteinPostRender(),this.comboRowsPerPage=new bizagi.workportal.results.per.page,bizagi.referrerParams.referrer=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,this._startQuickActions()},loadResultsOnActionExecute:function(e,t){var r=this,i={h_action:"QUERYFORM",h_contexttype:r.contextType,h_idForm:r.guidForm};r.dataService.getQueryForm(i).done((function(i){r.queryFormElements=i.form.elements,r.initialSearchParams&&(r.initialSearchParams.numberOfRows=r.getItemsPerPage()),r.findResults(r.getContent(),e,r.params.pageToShow,t)}))},storeQueryFormParams:function(e){bizagi.referrerParams=bizagi.referrerParams||{};var t={actionForm:bizagi.clone(this.params.queryFormAction),data:$.extend({},this.params)};bizagi.referrerParams.queryForm=$.extend(t,e)},getItemsPerPage:function(){var e=this.getRowValue();return e||10},updateResults:function(){this.reloadDataResults(!0)},calculateNewPage:function(e,t,r){var i=t*r-t+1,a=Math.ceil(i/e);return a||1},reloadDataResults:function(e){var t=this.Class.QUERY_FORM_ACTIONS,r=Number(this.getItemsPerPage()),i=this.getContent(),a=e&&this.params.queryParams.pageNumber?this.params.queryParams.pageNumber:this.calculateNewPage(r,this.params.queryParams.numberOfRows,this.params.queryParams.pageNumber);this.params.queryFormAction===t.SUBMIT_QUERY_FORM||this.params.queryFormAction===t.RENDER_QUERY_FORM?(this.params.queryParams.numberOfRows=r,this.findResults(i,this.params.queryParams,a,!0)):(this.storeQueryFormParams(),this.searchParamsOnActionExecute.numberOfRows=r,this.loadResultsOnActionExecute(this.params.queryParams,!0))},renderNumberRowsCombo:function(e,t){var r=this;return r.comboRowsPerPage.renderNumberRowsCombo({combo:e,content:t,comboWrapper:$("#select-pagination",t),onChange:function(){r.quickActionsInstance&&r.quickActionsInstance.setPersistCheckboxGroup(!0),r.params.pageToShow="1",r.reloadDataResults(!1)},setRowValue:r.setRowValue,getRowValue:r.getRowValue})},getRowValue:function(){var e=bizagi.services.preferences().getPreferences();return storedValue=e&&e.queriesItemsPerPage?e.queriesItemsPerPage:null,storedValue},setRowValue:function(e){var t=bizagi.services.preferences().getPreferences();t.queriesItemsPerPage=Number(e),bizagi.services.preferences().overridePreferences(t)},loadtemplates:function(){this.container=this.getTemplate("queryform-container"),this.buttons=this.getTemplate("queryform-buttons"),this.graphicalAnalysisContainer=this.getTemplate("queryform-graphic-analysis"),this.resultSet=this.getTemplate("queryform-result-set"),this.searchResult=this.getTemplate("queryform-search-result"),this.paginationTmpl=this.getTemplate("queryform-pagination"),this.adminResult=this.getTemplate("queryform-admin-result"),this.selectUser=this.getTemplate("queryform-select-user"),this.selectGroup=this.getTemplate("queryform-select-group"),this.shareSelection=this.getTemplate("queryform-share-selection"),this.dialogSaveAsTmpl=this.getTemplate("queryform-save-as")},_adjustViewLoader:function(e,t){return SELECTORS=this.Class.SELECTORS,LOADER=$(SELECTORS.FORM_LOADER,e),FORM=$(SELECTORS.FORM,e),BUTTONS=$(SELECTORS.FORM_BUTTONS,e),_start=function(e){e?LOADER.show():LOADER.hide(),e?FORM.hide():FORM.show(),e?BUTTONS.hide():BUTTONS.show()},_noOp=function(){},execute=t?_noOp:_start,{start:execute.bind(null,!0),stop:execute.bind(null,!1)}},modifiedPostRender:function(){var e=this,t=e.Class.QUERY_FORM_ACTIONS,r=e.getContent();if(e.maxElemShow=10,e.maxPageToShow=5,e.atLeastOneChecked=!1,e.selectedItemsToShare={users:[],groups:[]},e.readyToSave=!1,e.includeAllUsers=!1,e.saveAs=!1,e.sortedField={},e.storedQueryFormParameters={},e.dialogSaveAs=$.tmpl(e.dialogSaveAsTmpl),e.orderType={ASC:"ASC",DESC:"DESC",NONE:"NONE"},e.queryFormContextTypes={CASES:"metadata",ENTITY:"entity"},e.queryFormTypes={CASES:"CASES",ENTITY:"ENTITIES"},$("#queries-results-per-page",r).hide(),1==e.params.notMigratedUrl||1==e.params.paramsStoredQuery.notMigratedUrl){var i=e.getResource("workportal-widget-admin-entities-message-migrate");i=i.replace("{build}",bizagi.loader.productBuildToAbout);var a=$.tmpl(e.getTemplate("queryform-message-error"),{messageError:i});return $(r).html(a),!1}switch(e.params.queryFormAction){case t.EDIT:e.params.queryParams&&!e.params.queryParams.ownerQuery?(e.showSaveResultsForm(),$("#tab_share",r).hide(),$("#query-form-buttons",r).hide(),$("#query-form").hide(),$("#queryFormName").prop("disabled",!0),$("#queryFormDescription").prop("disabled",!0),$("#input-name-ui-bizagi-input-required").hide()):(e.guidEntity=e.params.paramsStoredQuery.definition.entityGuid,e.guidForm=e.params.paramsStoredQuery.guid,e.queryFormType=e.params.paramsStoredQuery.definition.type,e.idQueryForm=e.params.paramsStoredQuery.id,e.renderQueryForm(),e.showSaveResultsForm()),e.previousValues(e.params.paramsStoredQuery);break;case t.RENDER_QUERY_FORM:e.guidForm=e.params.guidForm,e.guidEntity=e.params.guidEntity,1==e.params.queryType?e.queryFormType=e.queryFormTypes.CASES:2==e.params.queryType&&(e.queryFormType=e.queryFormTypes.ENTITY),e.renderQueryForm();break;case t.SUBMIT_QUERY_FORM:case t.GRAPHICAL_ANALYSIS:!function(){"string"==typeof e.params.queryParams.parameters&&(e.params.queryParams.parameters=JSON.parse(e.params.queryParams.parameters)),e.initialSearchParams=e.params.queryParams,e.initSortParameters();var t=e.params.pageToShow||1;e.params.queryParams.numberOfRows=e.getItemsPerPage(),e.contextType=e.params.widget.contextType,e.guidForm=e.params.widget.guidForm,e.guidEntity=e.params.widget.guidEntity,e.queryForm=e.params.queryForm,e.includeAllUsers=e.params.widget.includeAllUsers,e.queryFormType=e.params.widget.queryFormType,1==e.params.queryType?e.queryFormType=e.queryFormTypes.CASES:2==e.params.queryType&&(e.queryFormType=e.queryFormTypes.ENTITY),e.handleEvents(),e.findResults(e.getContent(),e.params.queryParams,t),$("#copy-as-new-stored-queryform",r).hide(),$("#update-stored-queryform",r).hide(),$("#edit-stored-queryform",r).hide()}();break;case t.EXECUTE:e.storeQueryFormParams(),e.guidEntity=e.params.paramsStoredQuery.definition.entityGuid,e.guidForm=e.params.paramsStoredQuery.guid,e.queryFormType=e.params.paramsStoredQuery.definition.type,e.includeAllUsers=e.params.paramsStoredQuery.definition.includeAllUsers,e.idQueryForm=e.params.paramsStoredQuery.id,e.searchParamsOnActionExecute={numberOfRows:e.getItemsPerPage(),pageNumber:1,queryFormGuid:e.params.paramsStoredQuery.guid,entityGuid:e.params.paramsStoredQuery.definition.entityGuid,type:e.params.paramsStoredQuery.definition.type,parameters:e.params.paramsStoredQuery.definition.parameters,ownerQuery:e.params.paramsStoredQuery.owner,includeAllUsers:e.params.paramsStoredQuery.definition.includeAllUsers},e.params&&e.params.queryParams&&e.params.queryParams.parameters&&("string"==typeof e.params.queryParams.parameters&&(e.params.queryParams.parameters=JSON.parse(e.params.queryParams.parameters)),e.searchParamsOnActionExecute.parameters=e.params.queryParams.parameters),e.handleEvents(),e.initialSearchParams=JSON.parse(JSON.stringify(e.searchParamsOnActionExecute)),e.initSortParameters(),e.queryFormType==e.queryFormTypes.CASES?e.contextType=e.queryFormContextTypes.CASES:e.queryFormType==e.queryFormTypes.ENTITY&&(e.contextType=e.queryFormContextTypes.ENTITY),$("#query-form-buttons",r).hide(),e.loadResultsOnActionExecute(e.searchParamsOnActionExecute,!1),$("#copy-as-new-stored-queryform",r).hide(),$("#update-stored-queryform",r).hide(),$("#edit-stored-queryform",r).show()}},renderQueryForm:function(e){var t=this,r=t.Class.QUERY_FORM_ACTIONS,i=t.getContent();t.queryFormType==t.queryFormTypes.CASES?t.contextType=t.queryFormContextTypes.CASES:t.queryFormType==t.queryFormTypes.ENTITY&&(t.contextType=t.queryFormContextTypes.ENTITY);var a={h_action:"QUERYFORM",h_contexttype:t.contextType,h_idForm:t.guidForm};t.idQueryForm&&""!==t.idQueryForm&&(a.h_idqueryform=t.idQueryForm);var o=$.tmpl(t.container);t.dataService.getQueryForm(a).done((function(a){var s={canvas:o,data:a,type:"queryForm"};t.queryFormElements=a.form.elements,bizagi.loader.startAndThen("rendering").then((function(){var a=new bizagi.rendering.facade;a.execute(s).done((function(){if(t.queryForm=a.form,t.queryForm.properties&&void 0!==t.queryForm.properties.includeAllUsers&&(t.includeAllUsers=t.queryForm.properties.includeAllUsers),$("#query-form",i).html(o),t.validateRequireField(),$("#queryFormName",i).keyup((function(){t.validateRequireField()})),t.handleEvents(),t._adjustViewLoader(i,!1).stop(),$("#queries-results-per-page",i).hide(),$("#query-form-result",i).hide(),$("#mainButtons",i).css("width","100%"),$("#exportExcel",i).hide(),$("#graphicalAnalysis",i).hide(),$("#back-to-queryform",i).hide(),$("#save-queryform",i).hide(),$("#queryFormName").prop("disabled",!1),$("#queryFormDescription").prop("disabled",!1),e&&(t.setXpathValuesToQueryForm(t.queryForm,e),$("#query-form-admin-result",i).hide(),$("#copy-as-new-stored-queryform",i).hide(),$("#update-stored-queryform",i).hide(),$("#edit-stored-queryform",i).hide()),t.params.queryFormAction===r.RENDER_QUERY_FORM)$("#query-form-admin-result",i).hide(),$("#copy-as-new-stored-queryform",i).hide(),$("#update-stored-queryform",i).hide(),$("#edit-stored-queryform",i).hide();else if(t.params.queryFormAction===r.EDIT){var s=t.params.paramsStoredQuery.definition.parentQueryForm||t.params.paramsStoredQuery.definition.name;$("#queryFormFieldsContainerName span",i).html(s),$("#queryFormFieldsContainer",i).html(o),$("#submit-for-search",i).hide(),$("#clear-queryform",i).hide(),$("#copy-as-new-stored-queryform",i).show(),$("#update-stored-queryform",i).show(),$("#edit-stored-queryform",i).hide()}}))}))}))},_adjustValueOnRestore:function(e,t){return-1!==["queryCombo","querySuggest","queryCascadingCombo","queryState","queryList","queryRadio","queryCaseState","querySearchUser"].indexOf(t.properties.type)&&(e.value=bizagi.util.tryCatch((function(){return e.value[0]}),"")),e},_setValueAndDisplay:function(e,t){var r=function(r){var i=!r;r&&e.setValue(t),e.setDisplayValue(t),i&&e.setValue(t)};switch(e.properties.type){case"queryCascadingCombo":this._onRestore4Cascade(e).done(r.bind(null,!0));break;case"querySearchUser":r(!0),r(!1);break;default:r(!0)}},_onRestore4Cascade:function(e){var t=new $.Deferred;return _parentReady=function(){var t=e.getParentCombo();return bizagi.util.tryCatch((function(){return t.asyncRenderDeferred?t.asyncRenderDeferred:t.wait4MeOnRestore}),(function(){var e=new $.Deferred;return e.resolve(),e}))},e.wait4MeOnRestore=new $.Deferred,e.internalSetInitialValueFlag=!0,_parentReady().done((function(){t.resolve(),e.wait4MeOnRestore.resolve()})),t},setXpathValuesToQueryForm:function(e,t){var r=this;t=t||{};try{var i;i="string"==typeof t.parameters?JSON.parse(t.parameters):t.parameters,$.each(i,(function(t,i){var a=i.renderId?e.getRenderById(i.renderId):e.getRender(i.xpath);$.when(a.ready()).done((function(){(i=r._adjustValueOnRestore(i,a)).advancedQuery?(a.setFilter&&a.setFilter(i.filterType),a.setDisplayValue(i.value)):r._setValueAndDisplay(a,i.value)}))}))}catch(e){console.log("Error:",e)}},_recalculateShowQueryForm:function(){var e=this.Class.QUERY_FORM_ACTIONS;return-1!==[e.SUBMIT_QUERY_FORM,e.RENDER_QUERY_FORM].indexOf(this.params.queryFormAction)&&this.params.widget&&this.params.recalculateQueryForm},handleEvents:function(){var e=this,t=e.Class.QUERY_FORM_ACTIONS,r=e.getContent(),i={I_PROCESSSTATE:"ALL",h_idEnt:10001};i.h_idQueryForm=e.idQueryForm,$("#query-form-buttons",r).html($.tmpl(e.buttons,i)),$("#back-to-queryform",r).click((function(){if(e.params.queryFormAction==t.EXECUTE)e.renderQueryForm();else if($("#iframeGraphicalAnalysis",r).hide(),$("#query-form-admin-result",r).hide(),e.params.queryFormAction==t.SAVE_QUERY_FORM)e.params.queryFormAction=t.RENDER_QUERY_FORM,$("#queries-results-per-page",r).show(),$("#query-form-result",r).show(),$("#back-to-queryform",r).show(),$("#save-queryform",r).show(),$("#exportExcel",r).show(),$("#graphicalAnalysis",r).show();else{e.sortedField={},$("#queries-results-per-page",r).hide(),$("#query-form-result",r).hide(),$("#query-form",r).show(),e.enableButton($("#submit-for-search",e.getContent()));var i=$(this).closest(".ui-dialog"),a=i.length?i.find(".ui-dialog-content"):[];if(i.height()===a.height()&&a.height(440),e.originalHeight&&r.parent().height(e.originalHeight),$("#back-to-queryform",r).hide(),$("#submit-for-search",r).show(),$("#clear-queryform",r).show(),$("#save-queryform",r).hide(),$("#exportExcel",r).hide(),$("#graphicalAnalysis",r).hide(),e._recalculateShowQueryForm())e.params.recalculateQueryForm=!1,e.params.widget.searchParams=e.params.widget.searchParams||{},e.renderQueryForm(e.params.widget.searchParams);else if(e.params.queryFormAction==t.GRAPHICAL_ANALYSIS){e.params.queryFormAction=t.SUBMIT_QUERY_FORM;var o={queryFormGuid:e.guidForm,numberOfRows:e.getItemsPerPage(),pageNumber:e.params.pageToShow?e.params.pageToShow:1,entityGuid:e.guidEntity,type:e.queryFormType,includeAllUsers:e.includeAllUsers,parameters:[]},s=e.queryForm.getSearchParams(o);e.submitQueryForm(s)}}e.readyToSave=!1})),$("#clear-queryform",r).click((function(){e.params.queryFormAction=t.RENDER_QUERY_FORM,e.renderQueryForm()})),$("#submit-for-search",r).click((function(){e.params.queryFormAction=t.SUBMIT_QUERY_FORM;var r=e.getSearchParams();null!==r&&(e.disableButton($(this)),e.submitQueryForm(r))})),$(".ui-bizagi-render-control-included",r).tooltip({content:bizagi.localization.getResource("workportal-widget-query-form-included-tooltip")}),$("#save-queryform",r).click((function(){e.readyToSave?e.createStoredQueryForm():e.showSaveResultsForm(),e.params.queryFormAction=t.SAVE_QUERY_FORM,$("#exportExcel",r).hide(),$("#graphicalAnalysis",r).hide(),$("#mainButtons",r).css("width","100%")})),$("#copy-as-new-stored-queryform",r).click((function(){e.saveAs=!0,$(e.dialogSaveAs).dialog({resizable:!0,modal:!0,title:e.getResource("workportal-widget-query-form-copy-as-new"),buttons:[{text:e.getResource("workportal-general-button-label-ok"),click:function(){var t=this;$.when(e.createStoredQueryForm()).done((function(){$(t).dialog("destroy"),bizagi.workportal.desktop.popup.closePopupInstance()}))}},{text:e.getResource("workportal-widget-queries-confirm-cancel"),click:function(){e.saveAs=!1,$(this).dialog("destroy")}}]})})),$("#update-stored-queryform",r).click((function(){e.updateStoredQueryForm()})),$("#edit-stored-queryform",r).click((function(){e.publish("closeCurrentDialog"),e.params.editQueryForm({response:e.params.paramsStoredQuery.id,fromExec:!0})})),$(".biz-wp-form-queryForm-graphicalAnalysisLink",r).click((function(){var i;e.params.queryFormAction=t.GRAPHICAL_ANALYSIS,"string"==typeof e.searchParams.parameters&&(e.searchParams.parameters=JSON.parse(e.searchParams.parameters)),i=e.params.paramsStoredQuery.definition?JSON.stringify(e.params.paramsStoredQuery.definition):JSON.stringify({name:"name",description:"desc",parameters:e.searchParams.parameters,type:e.queryFormType,entityGuid:e.guidEntity,includeAllUsers:e.includeAllUsers,parentQueryForm:e.queryForm.properties.displayName});var a=e.params.paramsStoredQuery.id?e.params.paramsStoredQuery.guid:e.params.guidForm,o=$.tmpl(e.graphicalAnalysisContainer,{h_guidQueryForm:a,h_idStoredQuery:e.params.paramsStoredQuery.id,h_definition:i});$("#queries-results-per-page",r).hide(),$("#query-form-result",r).html(o),$("#exportExcel",r).hide(),$("#graphicalAnalysis",r).hide(),$("#mainButtons",r).show(),$("#mainButtons",r).css("width","99%"),$("#save-queryform",r).hide(),e.originalHeight=r.parent().height(),r.parent().height("auto"),$("#formGraphicalAnalysis").delay(800).submit();var s=$("#iframeGraphicalAnalysis"),n=s.length?s.closest(".ui-dialog"):[],u=n.length?n.height():0;function c(){var e=$("#iframeGraphicalAnalysis"),t=$(this),r=t.length?t.height():0;r>550?e.height(r-100):(e.height(400),t.find(".ui-dialog-content").height("auto"))}u>550&&s.height(u-100),n.on("dialogmaximize",c),n.on("dialogunmaximize",c)})),$(".biz-wp-form-queryForm-exportExcelLink",r).click((function(){var t={queryFormGuid:e.guidForm,entityGuid:e.guidEntity,type:e.queryFormType,includeAllUsers:e.includeAllUsers,parameters:[]},r=e.sortedField.xpath,i=e.sortedField.orderType,a=!1,o=JSON.parse(JSON.stringify(e.initialSearchParams.parameters));(o="array"===$.type(o)?o:JSON.parse(o)).length>0&&void 0!==r&&$.each(o,(function(e,t){t.xpath==r&&(t.orderType=i,a=!0)})),a||""==r||void 0===r||o.push({value:null,included:!0,xpath:r,searchType:"NONE",orderType:i}),t.parameters=o;var s=e.refactorParameters(t),n=bizagi.cookie("JSESSIONID");null!=n&&(s.p_sessionId=n),e.dataService.getQueryFormExportExcel(s).done((function(){}))}))},disableButton:function(e){var t=this.getContent();$(".ui-bizagi-render-control-included:checked",t).size();(this.queryFormType==this.queryFormTypes.ENTITY&&this.atLeastOneChecked||this.queryFormType==this.queryFormTypes.CASES)&&e.attr("disabled",!0).addClass("ui-button-disabled")},enableButton:function(e){e.removeAttr("disabled").removeClass("ui-button-disabled")},getSearchParams:function(){var e={queryFormGuid:this.guidForm,numberOfRows:this.getItemsPerPage(),pageNumber:1,entityGuid:this.guidEntity,type:this.queryFormType,includeAllUsers:this.includeAllUsers,parameters:[],onlyLocalResults:!0};return this.queryForm.getSearchParams(e)},throwMessageAtLeastOneCheck:function(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-query-form-at-least-one-checked"),"Bizagi","warning"),this.enableButton($("#submit-for-search",e))},validateTypeAndOneCheck:function(e){var t=this.getContent(),r=this.isInShareTab()?".ui-bizagi-render-control-included:checked":".ui-bizagi-render-control-included:checked:visible",i=$(r,t).size();return this.atLeastOneChecked=i>0,(this.queryFormType==this.queryFormTypes.ENTITY&&this.atLeastOneChecked||this.queryFormType==this.queryFormTypes.CASES)&&null!==e},submitQueryForm:function(e){var t=this.getContent();null!==e&&(this.validateTypeAndOneCheck(e)?(this.initialSearchParams=JSON.parse(JSON.stringify(e)),this.findResults(t,e,e.pageNumber)):this.throwMessageAtLeastOneCheck(t))},findResults:function(e,t,r,i){var a=this,o=a.Class.QUERY_FORM_ACTIONS,s=(e=a.getContent(),$(".js-mini-loading",e)),n=$("#save-queryform, #back-to-queryform, #submit-for-search",e);r&&(a.params.pageToShow=r),a.params.queryParams=t,t.pageNumber=r||1,a.storeQueryFormParams({queryParams:t,pageToShow:r,queryForm:a.queryForm}),a.searchParams=JSON.parse(JSON.stringify(t)),t=a.refactorParameters(bizagi.clone(t)),bizagiConfig.groupByCaseNumber&&(t.group="T_RADNUMBER"),s.show(),a.disableButton(n);var u=new bizagi.workportal.command.security(a.dataService),c=a.dataService.getQueryFormResponse(t),l=a._adjustViewLoader(e,i);c.always(a.enableButton.bind(a,n)),l.start(),$.when(c,u.checkSecurityPerm("GraphicQuery"),u.checkSecurityPerm("TimeLine")).done((function(r,i,n){var u=bizagi.util.tryCatch((function(){return r[0].rows.length>0||1===r[0].page}),!0);if(s.hide(),l.stop(),!1===u)return a.findResults(e,t,1),!1;r=r[0];var c=a.validateSecurityOptionIcons(r,i,n);$(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove(),a.totalRecords=r.records,a.totalPages=r.total,r.rows.length>0?a.showSearchResultFrame(e,r,t,c):(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-query-form-no-records-found"),"Bizagi","warning"),a.enableButton($("#submit-for-search",a.getContent())),a.params.queryFormAction===o.EXECUTE&&(a.params.queryFormAction=o.EDIT,a.modifiedPostRender()))})).fail((function(e){l.stop(),s.hide(),bizagi.log(e)}))},validateSecurityOptionIcons:function(e,t,r){var i=bizagi.override.enableFeatureShowTimelineButton&&r,a=-1;return t||i?i&&e.rows.length>0&&(a=e.rows[0].findIndex((function(e){return!(!e||"object"!==_typeof(e)||!e.radNumber)})))>-1&&e.rows.forEach((function(e){null!=e[e.length-1]&&(e[e.length-1].radNumber=e[a].radNumber)})):e.header&&e.header.length&&0===e.header[e.header.length-1].dataType&&(e.header.splice(-1,1),e.rows.forEach((function(e){e.splice(-1,1)}))),{graphicQuery:t,timeline:i}},checkDisplayedNames:function(e){var t=this;return"string"==typeof t.initialSearchParams.parameters&&(t.initialSearchParams.parameters=JSON.parse(t.initialSearchParams.parameters)),"string"==typeof t.searchParams.parameters&&(t.searchParams.parameters=JSON.parse(t.searchParams.parameters)),$.each(e.header,(function(e,r){if(r.xpath){var i=t.getRenderElementDisplayByXpath(r.xpath,t.queryFormElements);if(i){if(t.initialSearchParams&&t.initialSearchParams.parameters)for(e=0;e<t.initialSearchParams.parameters.length;e++){var a=t.initialSearchParams.parameters[e],o=t.searchParams.parameters[e],s=a.xpath+"."+a.displayXpath,n=bizagi.util.tryCatch((function(){return t.params.paramsStoredQuery.definition.parameters[e]}),{});if(a.xpath===r.xpath||s===r.xpath){o.displayHeader=i,a.displayHeader=i,n.displayHeader=i,t.searchParams.parameters[e].displayName=i;break}}r.displayName=i}}})),e},getRenderElementDisplayByXpath:function(e,t){if(t&&t.length>0)for(var r=0,i=t.length;r<i;r++){var a=t[r];if(void 0!==a.render){var o=void 0===a.render.properties.included||a.render.properties.included,s=a.render.properties.xpath,n=a.render.properties.xpath+"."+a.render.properties.displayXpath;if(o&&(s===e||n===e))return a.render.properties.displayName}else if(void 0!==a.container){var u=this.getRenderElementDisplayByXpath(e,a.container.elements);if(null!=u)return u}}},refactorParameters:function(e){var t=[];return"string"==typeof e.parameters&&(e.parameters=JSON.parse(e.parameters)),$.each(e.parameters,(function(e,r){null!=r.value&&"object"==_typeof(r.value)&&r.value[0]&&void 0!==r.value[0].id&&(r.value=r.value[0].id),t.push(r)})),e.parameters=JSON.stringify(t),e},_checkOverrideAboutRemoveSymbol:function(e){return!1===bizagi.override.enableSymbolMoneyColumnQueryResult&&(e=e.replace(BIZAGI_DEFAULT_CURRENCY_INFO.symbol,"")),e},_checkOverridesFormatMoneyColumnQueryResults:function(e,t){return null!==(e=!1===bizagi.override.enableFormatMoneyColumnQueryResult?t:this._checkOverrideAboutRemoveSymbol(e))?e:""},_formatValue:function(e,t){var r=bizagi.util.formatValueByDataType(e,t);return-1!==[8,"Money"].indexOf(t)&&(r=this._checkOverridesFormatMoneyColumnQueryResults(r,e)),r},showSearchResultFrame:function(e,t,r,i){var a=this,o=a.Class.QUERY_FORM_ACTIONS;a.queryFormElements=a.queryFormElements?a.queryFormElements:bizagi.referrerParams.queryForm.queryForm.params.data.elements,bizagi.referrerParams&&bizagi.referrerParams.queryForm&&bizagi.referrerParams.queryForm.queryForm&&bizagi.referrerParams.queryForm.queryForm.params&&bizagi.referrerParams.queryForm.queryForm.params.data&&(bizagi.referrerParams.queryForm.queryForm.params.data.elements=a.queryFormElements),(t=a.checkDisplayedNames(t)).rows=a.cleanEmptyColorState(t.rows);var s=t.quickActions&&t.quickActions.length>0,n=$.tmpl(a.searchResult,{enableQueryDetailView:bizagi.util.isEnableFeature("enableQueryDetailView"),headers:t.header,rows:t.rows,sortedField:a.sortedField.xpath?a.sortedField:null,records:t.records,groupByCaseNumber:bizagiConfig.groupByCaseNumber,securityGraphicQuery:bizagi.menuSecurity.GraphicQuery,resultList:t,enabledIcons:i,haveQuickActions:s},{getRadNumberColumnIndex:function(){for(var e=this.data,t=-1,r=0,i=e.headers.length;r<i;r++)"radnumber"==e.headers[r].fieldName&&(t=r);return t},showColumn:function(e){var t=this.getRadNumberColumnIndex();return this.data.groupByCaseNumber&&t==e?" hidden ":""},createGroupedHeader:function(e){var t=this.data.resultList,r=!1,i=this.getRadNumber(t.rows[e]);this.data.groupByCaseNumber&&(0==e&&""!=i?r=!0:i!=this.getRadNumber(t.rows[e-1])&&""!=i&&(r=!0));return r},getRadNumber:function(e){var t=this.getRadNumberColumnIndex();return t>=0?e[t].radNumber:""},formatValue:$.proxy(a._formatValue,a),isIEAndFirstRowAndGroupCases:function(e){return 0==e&&this.data.groupByCaseNumber&&bizagi.util.isIE()}});if(a.lstIdCases(a.getIdCases(t.rows)),a.renderNumberRowsCombo(a.comboRowsPerPage.initCombo(),n),s){var u=a._getWorkItemsInfo(t.header,t.rows);a._QuickActionsRenderIn(n,u,t.quickActions)}var c,l=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,d=$("#biz-wp-table-pager-wrapper",n),m={};m.pagination=a.totalPages>1,m.page=t.page,m.pages={};for(var p=1;p<=l;p++)m.pages[p]={pageNumber:p};c=$.tmpl(a.paginationTmpl,m).html(),d.append(c),$("#submit-for-search",e).hide(),$("#clear-queryform",e).hide(),$("#save-queryform",e).show(),t.permissions&&t.permissions.canExportData?$("#exportExcel",e).show():$("#exportExcel",e).hide(),$("#mainButtons",e).css("width","100%"),$("#query-form",e).hide(),$("#queries-results-per-page",e).show(),$("#query-form-result",e).show(),$("#query-form-result",e).html(n),$("#back-to-queryform",e).show(),t.permissions&&t.permissions.canAnalizeData?$("#graphicalAnalysis",e).show():$("#graphicalAnalysis",e).remove(),a.params.queryFormAction==o.EXECUTE&&($("#back-to-queryform",e).hide(),$("#save-queryform",e).hide()),0==r.ownerQuery&&$("#edit-stored-queryform",e).hide(),$("ul").bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:t.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(t){var r=$(".sortColumnsDataUpIcon, .sortColumnsDataDownIcon").closest("th").first();if(a.initialSearchParams&&(a.initialSearchParams.numberOfRows=a.getItemsPerPage()),0==r.length)a.findResults(e,a.initialSearchParams,t.page,!0);else{var i=r.data("xpath"),o=null;null!=_typeof(a.sortedField.xpath)&&a.sortedField.xpath==i&&(o=a.sortedField.orderType),null==o||o==a.orderType.DESC?a.findSortedResults(e,i,a.orderType.DESC,t.page):a.findSortedResults(e,i,a.orderType.ASC,t.page)}}}),$(".cases-column-header",e).click((function(t){var i=$(t.currentTarget).data("xpath"),o=null;null!=_typeof(a.sortedField.xpath)&&a.sortedField.xpath==i&&(o=a.sortedField.orderType),null==o||o==a.orderType.DESC?a.findSortedResults(e,i,a.orderType.ASC,r.pageNumber):a.findSortedResults(e,i,a.orderType.DESC,r.pageNumber)})),$(".caseClicked",e).click((function(){a.disposeGoToCase(!0),a.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idcase"),idWorkItem:$(this)[0].getAttribute("data-idworkitem"),idTask:$(this)[0].getAttribute("data-idtask"),idWorkflow:$(this)[0].getAttribute("data-idworkflow")}),a.publish("closeCurrentDialog")})),$(".ui-bizagi-wp-app-inbox-grouped",e).bind("click",(function(){var e=$(this).find("#idCase").val();a.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e}),a.publish("closeCurrentDialog")})),$(".js-show-graphic-query",e).click((function(){var e=$(this).data("idcase"),t=$(this).data("idworkflow");a.showGraphicQuery({idCase:e,idWorkflow:t})})),$(".js-show-timeline",e).click((function(){var e=$(this).data("idcase"),t=$(this).data("radnumber");a.showTimeLine({radNumber:t,idCase:e})})),$("i.bz-icon-search-outline",e).click((function(){var e=$(this).data("idcase"),t=$(this).data("idworkflow");a.showCase(e,t)})),a.setTableHeadFixed({TableElement:$("table",n),groupByCaseNumber:bizagiConfig.groupByCaseNumber,floatOptions:{position:"fixed",scrollContainer:function(){return $("#result-set-queryForm")}}})},applyFomatNumbers:function(e,t,r){var i=$("th[data-type='"+e+"']",t);$.each(i,(function(e,r){var i=r.getAttribute("data-index");$(".biz-wp-table tr",t).find("td:eq("+i+")").find("span").addClass("formatMoney")})),bizagi.util.formatInvariantNumber(t,r)},getIdCases:function(e){var t=Array.isArray(e)?e:[],r=function(e){var t=e.find((function(e){return bizagi.util.tryCatch((function(){return void 0!==e.idCase}),!1)}));return void 0===t?-1:t.idCase};return t.map((function(e){return function(e){return Array.isArray(e)&&e.length>0&&void 0!==r(e)}(e)?r(e):-1})).filter((function(e){return-1!==e}))},lstIdCases:function(e){return void 0!==e&&(bizagi.lstIdCases=e),bizagi.lstIdCases},lstIdCasesBackup:function(e){return void 0!==e&&(this._lstIdCasesBackup=e),this._lstIdCasesBackup},disposeGoToCase:function(e){this._closedByCase=!0===this._closedByCase||e,!1===this._closedByCase&&this.lstIdCases(this.lstIdCasesBackup())},cleanEmptyColorState:function(e){return e.map((function(e){return e.map((function(e){return Array.isArray(e)?e.filter((function(e){return null==e||""!==e.colorState})):e}))}))},findSortedResults:function(e,t,r,i){var a=JSON.parse(JSON.stringify(this.initialSearchParams));a&&(a=this.buildParametersForSorting(a,t,r),this.findResults(e,a,i,!0))},buildParametersForSorting:function(e,t,r){var i=!1,a=e.parameters;return(a="array"===$.type(a)?a:JSON.parse(a)).length>0&&$.each(a,(function(e,a){a.xpath===t?(a.orderType=r,i=!0):a.orderType="NONE"})),i||""==t||void 0===t||a.push({value:null,included:!0,xpath:t,searchType:"NONE",orderType:r,isAddedTableSorting:!0}),this.sortedField={xpath:t,orderType:r},e.parameters=a,e},initSortParameters:function(){for(var e=this.initialSearchParams.parameters||[],t=0;t<e.length;t++){var r=e[t];if("NONE"!==r.orderType){this.sortedField={xpath:r.xpath,orderType:r.orderType};break}}},previousValues:function(e){var t=this.getContent();$("#queryFormName",t).val(e.definition.name),$("#queryFormDescription",t).val(e.definition.description),this.selectedItemsToShare.users=e&&e.users?e.users.map(String):[],this.selectedItemsToShare.groups=e&&e.groups?e.groups:[]},createStoredQueryForm:function(){var e=this,t=e.Class.QUERY_FORM_ACTIONS,r=e.buildStoredQueryFormParams(),i=new $.Deferred;return null!=r?$.when(e.dataService.saveStoredQueryForm(r)).done((function(r){e.publish("closeCurrentDialog"),e.readyToSave=!1,e.params.queryFormAction=t.RENDER_QUERY_FORM,0==$("#queryFormShortcut").has("#modalMenuBtList").length?$.when(e.workportalFacade.getWidget("queriesShortcut",{})).pipe((function(e){return widget=e,widget.render()})).done((function(){try{var t=widget.getContent();$("#queryFormShortcut").html(t),e.params.executeQueryForm(r)}catch(e){}})):e.params.executeQueryForm(r),i.resolve()})).fail((function(e){bizagi.log(e),i.reject()})):i.reject(),i.promise()},closeQueryForm:function(){},updateStoredQueryForm:function(){var e=this,t=e.Class.QUERY_FORM_ACTIONS,r=e.buildStoredQueryFormParams();return null!=r&&(e.validateTypeAndOneCheck(e.getSearchParams())?(r.id=e.idQueryForm,$.when(e.dataService.updateStoredQueryForm(r)).done((function(){e.readyToSave=!1,e.params.queryFormAction=t.RENDER_QUERY_FORM,e.renderQueryForm(),e.publish("refreshQueryFormShortCut")})).fail((function(e){bizagi.log(e)}))):e.throwMessageAtLeastOneCheck(e.getContent()),!0)},buildStoredQueryFormParams:function(){var e=this.Class.QUERY_FORM_ACTIONS,t=this.getContent(),r={};if(r.users=JSON.stringify($.unique(this.selectedItemsToShare.users)),r.groups=JSON.stringify($.unique(this.selectedItemsToShare.groups)),this.params.queryFormAction==e.EDIT){this.searchParams=this.queryForm.getSearchParams({parameters:[]})}r.guid=this.guidForm;var i,a=$("#queryFormNameSaveAs",this.dialogSaveAs).val(),o=$("#queryFormName",t).val().trim();return!this.saveAs||null!=a&&""!=a?this.saveAs||null!=o&&""!=o?this.validationController&&this.queryForm.validateForm()||this.queryForm?("string"==typeof this.searchParams.parameters&&(this.searchParams.parameters=JSON.parse(this.searchParams.parameters)),r.definition=JSON.stringify({name:a||o,description:$("#queryFormDescriptionSaveAs",this.dialogSaveAs).val()?$("#queryFormDescriptionSaveAs",this.dialogSaveAs).val():$("#queryFormDescription",t).val(),parameters:this.searchParams.parameters,type:this.queryFormType,entityGuid:this.guidEntity,includeAllUsers:this.includeAllUsers,parentQueryForm:this.queryForm.properties.displayName}),r):void 0:((i=$("#queryFormName",t).next(".ui-bizagi-input-icon-error")).show(),i.tooltip({content:bizagi.localization.getResource("workportal-general-error-required")}),null):((i=$("#queryFormNameSaveAs").next(".ui-bizagi-input-icon-error")).show(),i.tooltip({content:bizagi.localization.getResource("workportal-general-error-required")}),null)},isInShareTab:function(e){return void 0!==e&&(this._isInShareTab=e),this._isInShareTab},showSaveResultsForm:function(){var e=this,t=e.getContent();e.readyToSave=!0;var r=$.tmpl(e.adminResult,{});$("#tab_share",r).click((function(){e.initShareSelection(),$("#query-form").hide(),e.isInShareTab(!0)})),$("#tab_definition",r).click((function(){e.isInShareTab(!1),e._canGoToForm($("#query-form"),e.params.queryFormAction,e.totalRecords)})),$("input[type=radio][name=shareType]",r).change((function(){"users"==this.value?e.initShareSelection():"groups"==this.value&&$.when(e.searchGroupToShare()).done((function(){$("#userShare",e.shareSlection).hide()}))})),$("#query-form",t).hide(),$("#queries-results-per-page",t).hide(),$("#query-form-result",t).hide(),$("#query-form-admin-result",t).show(),$("#query-form-admin-result",t).html(r),$("#admin-stored-query-form-wrapper",t).tabs(),$("#queryFormName",t).keyup((function(){e.validateRequireField()}))},_canGoToForm:function(e,t,r){t===this.Class.QUERY_FORM_ACTIONS.EDIT&&r>0&&e.show()},validateRequireField:function(){var e=$("#queryFormName").val();/([^\s])/.test(e)?$("#input-name-ui-bizagi-input-required").hide():$("#input-name-ui-bizagi-input-required").show()},initShareSelection:function(){var e=this,t=e.getContent(),r=$.tmpl(e.shareSelection,{}),i=e.selectedItemsToShare.users;$("#shareUsers",t).prop("checked",!0),$("#search_user",r).click((function(){e.searchUserToShare()})),$("#shareSelectionPanel",t).html(r),$("#move_left",t).click((function(){e.removeItem()})),$("#move_right",t).click((function(){e.addItem()})),i.length>0&&e.searchSavedUser()},searchUserToShare:function(){var e=this,t=e.getContent(),r={userName:$("#userName",t).val(),domain:$("#domain",t).val(),fullName:$("#fullName",t).val(),queryFormId:e.guidForm};$.when(e.dataService.searchUsersSharedQuery(r)).done((function(t){var r=[];$.each(t.users,(function(t,i){i&&$.inArray(i.idUser.toString(),e.selectedItemsToShare.users)<0&&r.push(i)})),e.showDataToShare(r,[])})).fail((function(e){bizagi.log(e)}))},searchSavedUser:function(){var e=this,t=e.getContent(),r=$("input[type=radio][name=shareType]:checked",t).val();$.when(e.dataService.searchUsersByID(e.selectedItemsToShare.users)).done((function(i){$("#ListBoxResult",t).empty(),e.addPrevious(i,r)})).fail((function(e){bizagi.log(e)}))},searchGroupToShare:function(){var e=this;return e.dataService.searchProfiles({profileType:11}).pipe((function(t){var r=[],i=[];$.each(t.response,(function(t,a){a&&($.inArray(a.id,e.selectedItemsToShare.groups)<0?r.push(a):i.push(a))})),e.showDataToShare(r,i)}))},showDataToShare:function(e,t){var r,i=this.getContent(),a=$("input[type=radio][name=shareType]:checked",i).val();"users"==a?r=$.tmpl(this.selectUser,{elementList:e}):(r=$.tmpl(this.selectGroup,{elementList:e}),$("#ListBoxResult",i).empty(),t.length>0&&this.addPrevious(t,a)),$("#ListBoxSource",i).replaceWith(r)},addPrevious:function(e,t){var r=this.getContent();"users"==t?$.each(e.users,(function(e,t){$("#ListBoxResult",r).append(new Option(t.userName,t.idUser))})):$.each(e,(function(e,t){$("#ListBoxResult",r).append(new Option(t.displayName,t.id))}))},addItem:function(){var e=this,t=e.getContent(),r=$("input[type=radio][name=shareType]:checked",t).val(),i=$("#ListBoxSource option:selected",t);$.each(i,(function(i,a){-1==$.inArray(a.value,e.selectedItemsToShare)?(e.selectedItemsToShare[r].push(a.value.toString()),$("#ListBoxSource option[value='"+a.value+"']",t).appendTo("#ListBoxResult")):$("#ListBoxSource option[value='"+a.value+"']",t).remove()})),$("#ListBoxResult option:selected").prop("selected",!1)},removeItem:function(){var e=this,t=e.getContent(),r=$("input[type=radio][name=shareType]:checked",t).val(),i=$("#ListBoxResult option:selected",t),a=$("#ListBoxSource option").toArray(),o=[];$.each(a,(function(e,t){o.push(t.value)})),$.each(i,(function(i,a){var s=a.value;-1==$.inArray(s,o)?$("#ListBoxResult option[value='"+s+"']",t).appendTo("#ListBoxSource"):$("#ListBoxResult option[value='"+s+"']",t).remove(),e.selectedItemsToShare[r].splice($.inArray(s,e.selectedItemsToShare[r]),1)})),$("#ListBoxSource option:selected").prop("selected",!1)},HTMLEncodeText:function(e){var t=e;return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace("","&aacute;")).replace("","&eacute;")).replace("","&iacute;")).replace("","&oacute;")).replace("","&uacute;")).replace("","&ntilde;")).replace("","&Aacute;")).replace("","&Eacute;")).replace("","&Iacute;")).replace("","&Oacute;")).replace("","&Uacute;")).replace("","&Ntilde;")},frankensteinPostRender:function(){var e=this,t=e.getContent(),r=$("#queryFormIFrame",t),i="",a="",o=[".ui-bizagi-old-render*","@font-face"];r.attr("frameborder",0),"object"==_typeof(o)?$.each(o,(function(e,t){i+=bizagi.getStyle(t),a+=t.replace(".","")+" "})):(i+=bizagi.getStyle(o),a+=o.replace(".","")),r.load((function(){var t=$(this).contents();t.find('input[name="btnReturn"]').css("display","none"),$("head",t).append("<style type='text/css'>"+i+"body, .ui-bizagi-old-render { overflow-y: visible;};</style>"),$("body",t).addClass(a.replace("*","")),$("body a.WPButton",t).parent().siblings().remove();var o=function(e){this.openBACase=function(t,r){var i=null,a=null;r.indexOf("idWorkitem=")>-1&&(i=(i=r.substring(r.indexOf("idWorkitem=")+11)).substring(0,i.indexOf("&"))),r.indexOf("idWorkflow=")>-1&&(a=r.substring(r.indexOf("idWorkflow=")+11)),e.controller.publish("executeAction",{action:e.routingAction,idCase:t,idWorkItem:i,idWorkflow:a,referrer:"queryform"});var o=document.getElementById("h_lastFullKey"),s=document.getElementById("h_lstCases");try{e.controller.dataService.lastQueryFullKey=o.value,e.bizagireference.referrerParams.referrer="queryform",e.bizagireference.lstIdCases=s.value.split(",")}catch(e){}for(var n=0;n<e.bizagireference.workportal.desktop.dialogStack.length;n++)e.controller.publish("closeCurrentDialog")},this.ShowCaseSumary=function(t){e.$.when(e.controller.dataService.getCaseFormsRenderVersion({idCase:t})).done((function(r){1==r.formsRenderVersion&&e.controller.publish("showDialogWidget",{widgetName:e.bizagireference.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:e.controller.dataService.serviceLocator.getUrl("old-render")+"?idCase="+t+"&isSummary=1",modalParameters:{title:e.controller.resources.getResource("workportal-widget-navigation-summary-case")},afterLoad:e.callBack,afterLoadParams:{routingAction:e.bizagireference.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,genericIframe:e.bizagireference.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,bizagi:e.bizagireference}})}))}};r.callInside(o,{controller:e,routingAction:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,bizagireference:bizagi,callBack:o,$:jQuery})}))},dispose:function(){this.disposeGoToCase(!1),this._super()},_getWorkItemsInfo:function(e,t){for(var r={},i=this._getIndexFromTableColumn(e,"fieldName","CURRENTTASK"),a=this._getIndexFromTableColumn(e,"fieldName","RADNUMBER"),o=0;o<t.length&&-1!==i;o++)for(var s=t[o],n=s[i],u=0;u<n.length&&-1!==a;u++){var c=n[u];c.idCase=s[a].idCase,c.caseNumber=s[a].radNumber,r[c.idWorkItem]=c}return r}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.queries.management",{},{init:function(e,t,r){this.selectedUsers=["",""],this._super(e,t,r),this.loadTemplates({"queries-management":bizagi.getTemplate("bizagi.workportal.desktop.widgets.queries.management").concat("#queries-management"),"queries-management-loader":bizagi.getTemplate("bizagi.workportal.desktop.widgets.queries.management").concat("#ui-bizagi-workportal-widget-queries-management-loader"),"queries-management-table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.queries.management").concat("#ui-bizagi-workportal-widget-queries-management-table")})},renderContent:function(){var e=this.getTemplate("queries-management");return this.content=e.render(),this.content},postRender:function(){this.setupSearchusersButton(),this.loaderTmpl=this.getTemplate("queries-management-loader"),this.loader=this.loaderTmpl.render()},fixedHeadTable:function(){var e=$(".ui-bizagi-wp-queries-management-content-parent-tableHeadFixed > .ui-bizagi-wp-queries-management-content-tableHeadFixed",this.content);e.find("table:first").floatThead({position:"fixed",zIndex:1,scrollContainer:function(){return e}}),this.onResizeModalEvent()},clean:function(){},onResizeModalEvent:function(){var e=this;e.getContent().parents(".ui-dialog").find(".ui-dialog-titlebar-maximize").click((function(){$("body").trigger("resize"),e.onResizeModalEvent()}))},setupUsersSearchForm:function(e,t){var r=this,i=r.getContent(),a=$.Deferred();$(".queries-management-content",i).hide(),r.usersTable=new bizagi.workportal.widgets.userstable(r.workportalFacade,r.dataService,$.extend(r.params,{canvas:$("#dinamicContent",i),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-select-link")],parentDef:a,showBackButton:!0})),r.usersTable.render(),$.when(a).done((function(a,o,s){var n={action:"Applications",userId:a};0==t&&r.dataService.getApplicationCategoriesList(n).done((function(e){e.items.length>0&&(r.allProcess=!0,r.haveProcess=!0,void 0!==s&&r.getQueries(s))})).fail((function(){})),$("#dinamicContent",i).html(""),$(".queries-management-content",i).show(),o&&($(e,i).val(o),r.showHideClearIcon(e,"block")),s&&(r.selectedUsers[t]=s)}))},showNotifier:function(e){window.parent.bizagi.injector.get("notifier").showSucessMessage(e,"")},showLoading:function(){$(".queries-management-container").append(this.loader)},endLoading:function(){$(this.loader).remove()},clearInput:function(e,t){var r="#txtTextUserSource"==e?0:1;this.showHideClearIcon(e,"none"),$(e,t).val(""),this.selectedUsers[r]=""},showHideClearIcon:function(e,t){var r=this.getContent();$(e+" ~ span",r).css("display",t)},getQueries:function(e){var t=this,r={};r.guidUser=e,t.showLoading(),t.dataService.getManagementQueries(r).done((function(e){if(t.queries=e.storedQueryForms,t.endLoading(),t.queries.length>0){var r=$.map(e.storedQueryForms,(function(e){return{name:e.definition.name,description:e.definition.description}}));$(".emptyQueries",t.content).hide(),$(".queries-content",t.content).show(),t.renderTable(r)}else $(".emptyQueriesText").text(bizagi.localization.getResource("workportal-widget-queries-management-list-empty-no-queries"))})).fail((function(e){t.endLoading(),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),bizagi.log(e)}))},renderTable:function(e){var t={data:e},r=this.getTemplate("queries-management-table").render(t);$(".queries-content.ui-bizagi-wp-queries-management-content-tableHeadFixed").html(r),this.fixedHeadTable()},validateUsers:function(){var e=!0;return""==this.selectedUsers[0]||""==this.selectedUsers[1]?(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-fail-you-must-select-both-users-to-continue"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),e=!1):this.selectedUsers[0]==this.selectedUsers[1]?(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-fail-users-must-be-different"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),e=!1):0==this.queries.length&&(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-queries-management-list-empty-no-queries"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),e=!1),e},transferQueries:function(){var e=this;if(e.validateUsers()){var t=[{label:bizagi.localization.getResource("workportal-widget-queries-management-transfer-confirmation-modal-no-button"),action:"reject"},{label:bizagi.localization.getResource("workportal-widget-queries-management-transfer-confirmation-modal-button"),action:"resolve"}];$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-queries-management-transfer-confirmation-modal-description"),bizagi.localization.getResource("workportal-general-word-information"),!1,t,{dialogClass:"widget-queries-management-transfer-confirm",width:400,minWidth:400})).done((function(){e.showLoading();var t={guidUserSource:e.selectedUsers[0],guidUserTarget:e.selectedUsers[1]};e.dataService.transferQueries(t).done((function(){e.endLoading(),$(".emptyQueriesText").text(bizagi.localization.getResource("workportal-widget-queries-management-list-empty-no-queries")),$(".queries-content",e.content).hide(),$(".emptyQueries",e.content).show(),e.queries=[],e.showNotifier(bizagi.localization.getResource("workportal-widget-queries-management-queries-transferred-successfully"))})).fail((function(t){e.endLoading(),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-queries-management-queries-transferred-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),bizagi.log(t)}))}))}},setupSearchusersButton:function(){var e=this,t=e.getContent();$("#btn-searchUserSource",t).click((function(){e.setupUsersSearchForm("#txtTextUserSource",0)})),$("#btn-searchUserTarget",t).click((function(){e.setupUsersSearchForm("#txtTextUserTarget",1)})),$("#btn-clearUserSource",t).click((function(){e.clearInput("#txtTextUserSource",t),$(".emptyQueriesText").text(bizagi.localization.getResource("workportal-widget-queries-management-list-empty-no-selected-user")),$(".queries-content",e.content).hide(),$(".emptyQueries",e.content).show()})),$("#btn-clearUserTarget",t).click((function(){e.clearInput("#txtTextUserTarget",t)})),$("#btn-transferQueries",t).click((function(){e.transferQueries()}))}}),bizagi.injector.register("bizagi.workportal.widgets.queries.management",["workportalFacade","dataService",bizagi.workportal.widgets.queries.management]),$.Class.extend("bizagi.workportal.results.per.page",{},{init:function(e){this.bizagiConfigProperty=e},initCombo:function(){var e={combo:[],id:"numberRows"},t=Array(10,20,30,40,50,100);return this.bizagiConfigProperty&&-1==t.indexOf(this.bizagiConfigProperty)&&(t.push(this.bizagiConfigProperty),t.sort((function(e,t){return e-t}))),t.map((function(t){e.combo.push({id:t,name:t})})),e},_findValue:function(e,t){var r=!1;return e.map((function(e){e.id==t&&(r=e)})),r},initialValueCombo:function(e){var t=e.comboDataSource.combo[0],r=e.getRowValue();if(r||this.bizagiConfigProperty){var i=r&&!1!==this._findValue(e.comboDataSource.combo,r)?r:this.bizagiConfigProperty;i&&(t=this._findValue(e.comboDataSource.combo,i))}return t},renderNumberRowsCombo:function(e){var t=$.Deferred();e.comboWrapper.empty();var r=this.initialValueCombo({comboDataSource:e.combo,getRowValue:e.getRowValue}),i=r.id;return e.comboWrapper.uicombo({isEditable:!1,data:e.combo,itemValue:function(e){return e.id},itemText:function(e){return e.name},onComplete:function(){t.resolve()},onChange:function(t){var r=t.ui.data("value");r!=i&&(i=r,e.setRowValue(r),e.onChange())},initValue:r}),t}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.quickActions",{CLASS_ACTIVE_MORE_BUTTON:"active",SELECTOR_NUMBER_SELECTED:"#ui-bizagi-workportal-widget-quick-actions-details > .quick-actions-details-activities-selected",SELECTOR_BUTTONS_CONTAINER:"#ui-bizagi-workportal-widget-quick-actions-buttons",SELECTOR_BUTTON_LAUNCH:"button.quick-actions-details-button-launch",SELECTOR_SUMMARY_EXECUTED_ACTIONS:".summary-quick-actions-executed",SELECTOR_HIDDEN_BUTTON_LAUNCH:"div.quick-actions-details-button-launch-hidden",SELECTOR_MORE_BUTTON:"button#quick-actions-details-more-button",SELECTOR_HIDDEN_BUTTONS_CONTAINER:"div#quick-actions-details-buttons-hidden-container",SELECTOR_INBOX_GRID_TITLE:"div#contentInboxName",DATA_PROPERTIES:{TOTAL_SELECTED:"TOTAL_SELECTED",SHOW:"SHOW",BUTTONS:"BUTTONS",BUTTONS_TO_SHOW:"BUTTONS_TO_SHOW",BUTTONS_HIDDEN:"BUTTONS_HIDDEN",WIDTH_BUTTONS_CONTAINER:"WIDTH_BUTTONS_CONTAINER",SHOW_MORE_BUTTON:"SHOW_MORE_BUTTON",SHOW_HIDDEN_BUTTONS:"SHOW_HIDDEN_BUTTONS"}},{init:function(e,t,r){var i={callback:this.callbackCheckboxGroup.bind(this),getContainerSelector:r.getContainerSelector,checkAllSelector:r.checkAllSelector};this._super(e,t,r),this.checkboxGroup=new bizagi.workportal.widgets.checkboxGroup(this.workportalFacade,this.dataService,i),this.checkboxGroup.render({}),this.params={refreshShowedResults:r.refreshShowedResults},this.loadTemplates({"quick-actions-container":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActions").concat("#ui-bizagi-workportal-widget-quick-actions"),"quick-actions-button":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActions").concat("#ui-bizagi-workportal-widget-quick-actions-button"),"quick-actions-modal-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActions").concat("#ui-bizagi-workportal-widget-quick-actions-modal-confirm"),"quick-actions-more-button":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActions").concat("#ui-bizagi-workportal-widget-quick-actions-more-button"),"quick-actions-button-hidden":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActions").concat("#ui-bizagi-workportal-widget-quick-actions-button-hidden"),useNewEngine:!1}),this._setInitialData(),this.setPersistCheckboxGroup(!1)},renderContent:function(){var e=this.getTemplate("quick-actions-container");(this.content=$.tmpl(e,{})).appendTo(this.container),this._events()},renderIn:function(e){this.container=e,this.render()},postRender:function(){this._updateView()},setPersistCheckboxGroup:function(e){this.persistCheckboxGroup=e},setDataToExecute:function(e,t){this.itemsInfo=e,this.setAvailableButtons(t)},callbackCheckboxGroup:function(){this.itemsSelected=this.checkboxGroup.getChecked(),this._updateButtonsToShow(),this._setItemsSelected(this.itemsSelected.length)},_updateButtonsToShow:function(){var e=this.getButtonsToShow();this._showCurrentButtons(e)},getButtonsToShow:function(){var e=[];_labels=Object.keys(this.quickActionsPerName);for(var t=0;t<_labels.length;t++){var r=_labels[t],i=this.quickActionsPerName[r];this._shouldShowButton(i)&&e.push(r)}return e},_shouldShowButton:function(e){for(var t=this,r=t.itemsSelected.length>0,i=function(e){var r=t.itemsSelected[a].id,i=t.itemsInfo[r].idTask;return e.idTask===i},a=0;a<t.itemsSelected.length&&r;a++)e.some(i)||(r=!1);return r},_showCurrentButtons:function(e){var t=e.map((function(e){return{id:e,text:e}}));this._addButtons(t)},renderCheckboxGroup:function(e){var t=this._filterItemsToShowCheckbox();this.checkboxGroup.renderCheckboxGroup(e,t,this.persistCheckboxGroup),this.setPersistCheckboxGroup(!1)},_filterItemsToShowCheckbox:function(){var e=[];_workItems=Object.keys(this.itemsInfo);for(var t=0;t<_workItems.length;t++){var r=this.itemsInfo[_workItems[t]];-1!==this.idTasksWithQuickActions.indexOf(r.idTask)&&e.push(r.idWorkItem)}return e},setAvailableButtons:function(e){this.quickActionsPerName={},this.idTasksWithQuickActions=[];for(var t=0;e&&t<e.length;t++){var r=e[t].label;this.quickActionsPerName[r]||(this.quickActionsPerName[r]=[]),this.quickActionsPerName[r].push(e[t]),this.addItemToShowCheckbox(e[t].idTask)}},addItemToShowCheckbox:function(e){-1===this.idTasksWithQuickActions.indexOf(e)&&this.idTasksWithQuickActions.push(e)},_renderButton:function(e,t,r){var i=r?"quick-actions-button-hidden":"quick-actions-button",a=this.getTemplate(i),o={text:t,id:e};return $.tmpl(a,o)},_renderMoreButton:function(){var e=this.getTemplate("quick-actions-more-button");return $.tmpl(e,{})},_events:function(e){!0===e?(this.content.off("click",this.Class.SELECTOR_BUTTON_LAUNCH),this.content.off("click",this.Class.SELECTOR_HIDDEN_BUTTON_LAUNCH),this.content.off("click",this.Class.SELECTOR_MORE_BUTTON),this.unsubscribe("resizeLayout")):(this.content.on("click",this.Class.SELECTOR_BUTTON_LAUNCH,this._clickOnAction.bind(this)),this.content.on("click",this.Class.SELECTOR_HIDDEN_BUTTON_LAUNCH,this._clickOnAction.bind(this)),this.content.on("click",this.Class.SELECTOR_MORE_BUTTON,this._clickOnMore.bind(this)),this.subscribe("resizeLayout",this._adjustButtonsWidth.bind(this)))},_clickOnAction:function(e){var t=this,r=t.Class.DATA_PROPERTIES,i=e.currentTarget.textContent,a=t._getNumberOfSelected();_textToShow=bizagi.localization.getResourceByElementsNumber("workportal-quick-actions-confirm-execute-detail",a).replace("{0}",a),_message=$.tmpl(t.getTemplate("quick-actions-modal-confirm"),{numberActivities:_textToShow}).html(),_modalParams=t._buildParamsForModalConfirm(i,_message),_buttonClicked=e.target.id,t._setProperty(r.SHOW_HIDDEN_BUTTONS,!1),$.when(bizagi.showConfirmationBox.apply(t,_modalParams)).done((function(){var e=t.setInitialDataForModal(_buttonClicked);t.showResultDialog(i,e)}))},setInitialDataForModal:function(e){for(var t={activities:[]},r=this.quickActionsPerName[e],i=0;i<this.itemsSelected.length;i++)for(var a=this.itemsSelected[i].id,o=this.itemsInfo[a],s=0;s<r.length;s++){var n=r[s];if(o.idTask===n.idTask){var u={workItemId:o.idWorkItem,taskId:o.idTask,activityName:o.TaskName,caseNumber:o.caseNumber,caseId:o.idCase,icon:"gray",quickActionGuid:n.guid,ruleGuid:n.guidRule,actions:n.actions};t.activities.push(u)}}return t},itemIsChecked:function(e){return this.itemsSelected.some((function(t){return t.id===e}))},_buildParamsForModalConfirm:function(e,t){return[t,e,!1,[{label:bizagi.localization.getResource("workportal-general-word-no"),action:"reject",class:"biz-wp-btn-secondary-real"},{label:bizagi.localization.getResource("workportal-general-word-yes"),action:"resolve",class:"biz-wp-btn-warning"}],{dialogClass:"ui-quick-action-modal-confirm",width:500}]},_clickOnMore:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.SHOW_HIDDEN_BUTTONS);this._setProperty(e.SHOW_HIDDEN_BUTTONS,!t)},_setProperty:function(e,t,r){var i=void 0!==r&&r,a=this.Class.DATA_PROPERTIES[e],o=this.data[a]!==t,s=!i&&o;if(void 0===a)throw"Property does not exist: "+e;this.data[a]=t,s&&this._updateView()},_getProperty:function(e){var t=this.Class.DATA_PROPERTIES[e],r=this.data[t],i=Array.isArray(r)?[]:{};if(void 0===t)throw"Property does not exist: "+e;return"object"===_typeof(r)&&(r=jQuery.extend(i,r)),r},_setInitialData:function(){var e=this.Class.DATA_PROPERTIES;this.data={},this.data[e.TOTAL_SELECTED]=0,this.data[e.SHOW]=!1,this.data[e.BUTTONS]=[],this.data[e.BUTTONS_TO_SHOW]=[],this.data[e.BUTTONS_HIDDEN]=[],this.data[e.WIDTH_BUTTONS_CONTAINER]=0,this.data[e.SHOW_MORE_BUTTON]=!1,this.data[e.SHOW_HIDDEN_BUTTONS]=!1},_updateViewSelected:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.TOTAL_SELECTED),r=this.content.find(this.Class.SELECTOR_NUMBER_SELECTED);_textToShow=bizagi.localization.getResourceByElementsNumber("workportal-quick-actions-selected-activities",t).replace("{0}",t),r.text(_textToShow)},_adjustButtonsWidth:function(){var e=this,t=e.Class.DATA_PROPERTIES,r=e.content.find(e.Class.SELECTOR_BUTTONS_CONTAINER),i=e.content.find(e.Class.SELECTOR_BUTTON_LAUNCH+":first"),a=e._getProperty(t.BUTTONS),o=e._getProperty(t.BUTTONS_TO_SHOW),s=e._getProperty(t.BUTTONS_HIDDEN),n=e._getProperty(t.WIDTH_BUTTONS_CONTAINER),u=r.outerWidth(),c=n!==u,l=1.5*i.outerHeight()<r.outerHeight(),d=o.length>0,m=o.slice(-1),p=o.slice(0,-1),g=c?[]:m.concat(s);c?(e._setProperty(t.SHOW_MORE_BUTTON,!1,!0),e._setProperty(t.SHOW_HIDDEN_BUTTONS,!1,!0),e._setProperty(t.BUTTONS_HIDDEN,g,!0),e._setProperty(t.WIDTH_BUTTONS_CONTAINER,u,!0),e._setProperty(t.BUTTONS_TO_SHOW,a)):l&&d&&(e._setProperty(t.SHOW_MORE_BUTTON,!0,!0),e._setProperty(t.BUTTONS_HIDDEN,g,!0),e._setProperty(t.BUTTONS_TO_SHOW,p))},_updateViewButtons:function(){var e=this,t=e.Class.DATA_PROPERTIES,r=e._getProperty(t.BUTTONS_TO_SHOW),i=e._getProperty(t.BUTTONS_HIDDEN),a=e._renderMoreButton(),o=e.content.find(e.Class.SELECTOR_BUTTONS_CONTAINER),s=a.find(e.Class.SELECTOR_HIDDEN_BUTTONS_CONTAINER),n=function(t,r,i){e._renderButton(i.id,i.text,t).appendTo(r)};o.empty(),r.map(n.bind(null,!1,o)),a.appendTo(o),i.map(n.bind(null,!0,s)),e._adjustButtonsWidth()},_updateViewMoreButton:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.SHOW_MORE_BUTTON),r=this._getProperty(e.SHOW_HIDDEN_BUTTONS),i=this.content.find(this.Class.SELECTOR_MORE_BUTTON);i.toggleClass(this.Class.CLASS_ACTIVE_MORE_BUTTON,r),t?i.show():i.hide()},_updateViewContainer:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.SHOW),r=this.content,i=$(this.Class.SELECTOR_INBOX_GRID_TITLE);t?r.css("display","grid"):r.css("display","none"),t?i.css("display","none"):i.css("display","inline-block")},_updateViewHiddenButtons:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.SHOW_HIDDEN_BUTTONS),r=this.content.find(this.Class.SELECTOR_HIDDEN_BUTTONS_CONTAINER);t?r.show():r.hide()},_updateView:function(){this._updateViewContainer(),this._updateViewSelected(),this._updateViewButtons(),this._updateViewMoreButton(),this._updateViewHiddenButtons()},_setItemsSelected:function(e){var t=this.Class.DATA_PROPERTIES,r="number"==typeof e?e:0,i=this._getProperty(t.BUTTONS),a=e>0&&i.length>0;this._setProperty(t.SHOW,a,!0),this._setProperty(t.TOTAL_SELECTED,r)},_getNumberOfSelected:function(){var e=this.Class.DATA_PROPERTIES;return this._getProperty(e.TOTAL_SELECTED)},_addButtons:function(e){var t=this.Class.DATA_PROPERTIES;this._setProperty(t.SHOW_MORE_BUTTON,!1,!0),this._setProperty(t.BUTTONS_HIDDEN,[],!0),this._setProperty(t.BUTTONS_TO_SHOW,e,!0),this._setProperty(t.BUTTONS,e,!0)},showResultDialog:function(e,t){var r=this;bizagi.loader.start("entity-engine-view").then((function(){var i,a=$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUICKACTIONS_EXECUTE,data:t,dialogClass:"ui-quick-action-modal-confirm",modalParameters:{title:e,width:"900px"},maximizeOnly:!1,buttons:[{text:bizagi.localization.getResource("workportal-quick-actions-stop-all"),click:function(){i.showStopConfirmModal()},class:"biz-wp-btn-secondary-real btn-stop-all"}],closeOnEscape:!1,closeVisible:!0,onClose:function(){r.params.refreshShowedResults()}});$.when(a.getRenderWidget()).done((function(e){(i=e).registerDialog(a),$(r.Class.SELECTOR_SUMMARY_EXECUTED_ACTIONS).prependTo(".ui-quick-action-modal-confirm .ui-dialog-buttonpane .ui-dialog-buttonset")}))}))},dispose:function(){this._super(),this._events(!0)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.quickActionsExecute",{SELECTOR_BUTTON_STOP_ALL:".ui-dialog.ui-quick-action-modal-confirm button.btn-stop-all",SELECTOR_BUTTON_CLOSE:".ui-dialog.ui-quick-action-modal-confirm button.bz-dialog-btn-close",SELECTOR_SUMMARY_EXECUTED_ACTIONS:".summary-quick-actions-executed",SELECTOR_ONE_RESULT:"div[collapsibleitem][id={0}]",TYPE_ROW_DEFAULT:"TYPE_ROW_DEFAULT",TYPE_ROW_ONLY_DEFAULT_TEXT:"TYPE_ROW_ONLY_DEFAULT_TEXT",TYPE_ROW_ONLY_ERROR_TEXT:"TYPE_ROW_ONLY_ERROR_TEXT",DATA_PROPERTIES:{ACTIVITIES:"ACTIVITIES",END_ALL_REQUESTS:"END_ALL_REQUESTS",STOP_BY_USER:"STOP_BY_USER",NUMBER_EXECUTED_ACTIONS:"NUMBER_EXECUTED_ACTIONS",DIALOG:"DIALOG"},RESULT_SUCCESS:"success",RESULT_EXECUTED:"executed",RESULT_WARNING:"warning",RESULT_ERROR:"error"},{init:function(e,t,r){this._super(e,t,r),this.loadTemplates({"quickActions-execute":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActionsExecute").concat("#ui-bizagi-workportal-widget-quickActions-execute"),"quick-actions-stop-all-modal-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActionsExecute").concat("#ui-bizagi-workportal-widget-quick-actions-stop-all-modal-confirm"),useNewEngine:!1}),this._setInitialData(r.data.activities)},renderContent:function(){var e=this.getTemplate("quickActions-execute");return this.content=$.tmpl(e,{summaryText:this._getSummaryText()}),this.content},postRender:function(){var e=this,t=e.Class.DATA_PROPERTIES;e.requesterService=new bizagi.workportal.services.quickActionsRequester(e.dataService,{callback:function(t){e._processResponseOfExecuteQuickActions(t)}}),e._updateView(),e.requesterService.startAllRequests(e._getProperty(t.ACTIVITIES)),$(window).on("beforeunload",$.proxy(e._showDefaultWarningMessageBrowser,e)),e._configureHandlers()},_setProperty:function(e,t,r){var i=void 0!==r&&r,a=this.Class.DATA_PROPERTIES[e],o=this.data[a]!==t,s=!i&&o;if(void 0===a)throw"Property does not exist: "+e;this.data[a]=t,s&&this._updateView()},_getProperty:function(e){var t=this.Class.DATA_PROPERTIES[e],r=this.data[t],i=Array.isArray(r)?[]:{};if(void 0===t)throw"Property does not exist: "+e;return"object"===_typeof(r)&&(r=bizagi.util.extend(i,r)),r},_setInitialData:function(e){var t=this.Class.DATA_PROPERTIES;this.data={},this.data[t.END_ALL_REQUESTS]=!1,this.data[t.STOP_BY_USER]=!1,this.data[t.ACTIVITIES]=e,this.data[t.NUMBER_EXECUTED_ACTIONS]=0},_updateView:function(){this._updateViewSummaryExecutionActions()},_updateViewSummaryExecutionActions:function(){$(this.Class.SELECTOR_SUMMARY_EXECUTED_ACTIONS+" span").text(this._getSummaryText())},_getSummaryText:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.ACTIVITIES),r=this._getProperty(e.NUMBER_EXECUTED_ACTIONS);return bizagi.localization.getResourceByElementsNumber("workportal-quick-actions-summary-number-actions-executed",t.length).replace("{0}",r).replace("{1}",t.length)},_configureHandlers:function(){$(this.content).find(".filter-button").on("click",$.proxy(this._onClickFilterButton,this))},_onClickFilterButton:function(e){var t=e.target;t.correspondingUseElement&&(t=t.correspondingUseElement);var r=$(t).closest(".filter-button");r.addClass("selected").siblings().removeClass("selected");var i=r.attr("filter-by");this._showFilterResults(i)},_showFilterResults:function(e){var t=bizagi.localization.getResource("workportal-quick-actions-completed-actions"),r=bizagi.localization.getResource("workportal-widget-inboxcommon-no-results-found"),i=$(this.content).find(".filter-row."+e);if("all"===e)$(this.content).find(".filter-row").show(),$(".quickActionsContainer .default-text span").text(t);else{var a=0===i.length?r:t;$(this.content).find(".filter-row").hide(),i.show(),$(".quickActionsContainer .default-text span").text(a)}},_processResponseOfExecuteQuickActions:function(e){var t=this.Class.DATA_PROPERTIES,r=this._getProperty(t.ACTIVITIES);if("all"===e.type){this._setProperty(t.END_ALL_REQUESTS,!0),this._disableBtnStopAll();var i={title:bizagi.localization.getResource("workportal-quick-actions-completed-actions")};this._addRowToResultsWithType(i,this.Class.TYPE_ROW_ONLY_DEFAULT_TEXT)}else if("one-start"===e.type){var a=r.filter((function(t){return t.workItemId===e.response.paramsRequest.workItemId}))[0];i={workItemId:a.workItemId,activityName:a.activityName,caseNumber:a.caseNumber,details:a.details,icon:"gray",status:"inProcess"};this.instance=this._addRowToResultsWithType(i,this.Class.TYPE_ROW_DEFAULT)}else if("one-end"===e.type){this._setProperty(t.NUMBER_EXECUTED_ACTIONS,this._getProperty(t.NUMBER_EXECUTED_ACTIONS)+1);var o=this._getStatusByBackResponse(e.response.backResponse);this._setResultToActionRequest(e.response.paramsRequest.workItemId,o,this.instance)}else if("stop-by-user"===e.type){if(!this._getProperty(t.END_ALL_REQUESTS)){this._setProperty(t.STOP_BY_USER,!0);i={title:bizagi.localization.getResourceByElementsNumber("workportal-quick-actions-confirm-stop-all-message",e.response.numberSkipActions).replace("{0}",e.response.numberSkipActions)};this._addRowToResultsWithType(i,this.Class.TYPE_ROW_ONLY_ERROR_TEXT)}this._disableBtnStopAll()}this._getProperty(t.NUMBER_EXECUTED_ACTIONS)==this._getProperty(t.ACTIVITIES).length&&this._hideBtnStopAllAndShowClose()},_manageExecuteModalCloseButton:function(){var e=this.Class.DATA_PROPERTIES;return!(!this._getProperty(e.END_ALL_REQUESTS)&&!this._getProperty(e.STOP_BY_USER))||(this.showStopConfirmModal(),!1)},_showDefaultWarningMessageBrowser:function(){var e=this.Class.DATA_PROPERTIES;if(!this._getProperty(e.END_ALL_REQUESTS))return""},_buildParamsForModalConfirm:function(e,t,r){return[t,e,!1,[{label:bizagi.localization.getResource("workportal-general-word-no"),action:"reject",class:"biz-wp-btn-secondary-real"},{label:bizagi.localization.getResource("workportal-general-word-yes"),action:"resolve",class:"biz-wp-btn-warning"}],{dialogClass:"ui-quick-action-modal-confirm"}]},_disableBtnStopAll:function(){var e=$(document).find(this.Class.SELECTOR_BUTTON_STOP_ALL);$(e).prop("disabled",!0)},_hideBtnStopAllAndShowClose:function(){$(document).find(this.Class.SELECTOR_BUTTON_STOP_ALL).hide(),$(document).find(this.Class.SELECTOR_BUTTON_CLOSE).show()},showStopConfirmModal:function(){var e=this,t=(e.Class.DATA_PROPERTIES,$.tmpl(e.getTemplate("quick-actions-stop-all-modal-confirm")).html()),r=bizagi.localization.getResource("workportal-general-word-message"),i=e._buildParamsForModalConfirm(r,t);$.when(bizagi.showConfirmationBox.apply(e,i)).done((function(){e.requesterService.stopAllRequests()}))},_addRowToResultsWithType:function(e,t){var r=this,i={item:e,type:t},a=new bizagi.workportal.widgets.collapsible(r.workportalFacade,r.dataService,i);return a.getView().then((function(e){e.prependTo(r.content.find(".quickActionsContainer"))})),a},_changeProperties:function(e,t){e.setStatus(t.status),e.setIcon(t.icon),e.setDescription(t.description)},_getStatusByBackResponse:function(e){for(var t=this.Class.RESULT_SUCCESS,r="",i=0;i<e.length&&t===this.Class.RESULT_SUCCESS;i++)tag=e[i],tag.error?(t=this.Class.RESULT_ERROR,r=tag.error.message):tag.result.type!==this.Class.RESULT_SUCCESS&&(t=this.Class.RESULT_WARNING,r=tag.result.messages[0]);return 0===e.status&&(t=this.Class.RESULT_ERROR,r=e.statusText),this._getFinalDataResponse(t,r)},_getFinalDataResponse:function(e,t){return{status:e=e===this.Class.RESULT_SUCCESS?this.Class.RESULT_EXECUTED:e,icon:this._getIcon(e),description:t}},_getIcon:function(e){var t;switch(e){case"warning":t="yellow";break;case"error":t="red";break;case"executed":t="green";break;default:t="gray"}return t},_setResultToActionRequest:function(e,t,r){var i=t;this._changeProperties(r,i)},registerDialog:function(e){var t=this.Class.DATA_PROPERTIES;this._setProperty(t.DIALOG,e.dialogBox),e.dialogBox.bind("dialogbeforeclose",$.proxy(this._manageExecuteModalCloseButton,this))},dispose:function(){this._super(),$(window).off("beforeunload",$.proxy(this._showDefaultWarningMessageBrowser,this)),$(this.content).find(".filter-button").on("click",$.proxy(this._onClickFilterButton,this))}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.collapsible",{SELECTOR_TITLE:".collapsible-title",SELECTOR_SUBTITLE:".collapsible-subtitle",SELECTOR_STATUS:".collapsible-status",SELECTOR_ICON:"div.collapsible-icon > svg",SELECTOR_DESCRIPTION:".collapsible-description",SELECTOR_ARROW:" div.collapsible-arrow > i",SELECTOR_COLLAPSIBLE_LINK:".collapsible-link",SELECTOR_COLLAPSIBLE_DESCRIPTION:".collapsible-description",SELECTOR_COLLAPSIBLE_ITEM:"div[collapsibleItem]",RESULT_EXECUTED:"executed",RESULT_WARNING:"warning",RESULT_ERROR:"error",RESULT_IN_PROCESS:"inProcess",TYPE_ROW_DEFAULT:"TYPE_ROW_DEFAULT",TYPE_ROW_ONLY_DEFAULT_TEXT:"TYPE_ROW_ONLY_DEFAULT_TEXT",TYPE_ROW_ONLY_ERROR_TEXT:"TYPE_ROW_ONLY_ERROR_TEXT",DATA_PROPERTIES:{TYPE_ROW:"TYPE_ROW",ID:"ID",TITLE:"TITLE",SUBTITLE:"SUBTITLE",STATUS:"STATUS",ICON:"ICON",DESCRIPTION:"DESCRIPTION"}},{init:function(e,t,r){this._super(e,t,r),this.loadTemplates({"quick-actions-items":bizagi.getTemplate("bizagi.workportal.desktop.widget.collapsible").concat("#ui-bizagi-workportal-widget-collapsible"),"quick-actions-item-only-default-text":bizagi.getTemplate("bizagi.workportal.desktop.widget.collapsible").concat("#ui-bizagi-workportal-widget-collapsible-only-default-text"),"quick-actions-item-only-error-text":bizagi.getTemplate("bizagi.workportal.desktop.widget.collapsible").concat("#ui-bizagi-workportal-widget-collapsible-only-error-text"),useNewEngine:!1}),this.rendered=new $.Deferred,this._setInitialData(r.item,r.type),this.render()},renderContent:function(){var e,t=this.Class.DATA_PROPERTIES;switch(this._getProperty(t.TYPE_ROW)){case this.Class.TYPE_ROW_ONLY_DEFAULT_TEXT:e=this.getTemplate("quick-actions-item-only-default-text");break;case this.Class.TYPE_ROW_ONLY_ERROR_TEXT:e=this.getTemplate("quick-actions-item-only-error-text");break;default:e=this.getTemplate("quick-actions-items")}this.content=$.tmpl(e,{}),this.rendered.resolve()},postRender:function(){this._updateView(),this._events()},_events:function(e){var t=this;!0===e?t.content.off("click",t.Class.SELECTOR_COLLAPSIBLE_LINK):t.content.on("click",t.Class.SELECTOR_COLLAPSIBLE_LINK,(function(){$(this).closest(t.Class.SELECTOR_COLLAPSIBLE_ITEM).find(t.Class.SELECTOR_COLLAPSIBLE_DESCRIPTION).slideToggle("slow");var e=$(this).find(t.Class.SELECTOR_ARROW);$(this).find(t.Class.SELECTOR_ARROW).hasClass("down")?(t._changeArrow(e,"up","down"),t._changeArrow(e.parent(),"up","down")):(t._changeArrow(e,"down","up"),t._changeArrow(e.parent(),"down","up"))}))},_changeArrow:function(e,t,r){e.addClass(t),e.removeClass(r)},_setProperty:function(e,t,r){var i=void 0!==r&&r,a=this.Class.DATA_PROPERTIES[e],o=this.data[a]!==t,s=!i&&o;if(void 0===a)throw"Property does not exist: "+e;this.data[a]=t,s&&this._updateView()},_getProperty:function(e){var t=this.Class.DATA_PROPERTIES[e],r=this.data[t],i=Array.isArray(r)?[]:{};if(void 0===t)throw"Property does not exist: "+e;return"object"===_typeof(r)&&(r=jQuery.extend(i,r)),r},_setInitialData:function(e,t){var r=this.Class.DATA_PROPERTIES;this.data={},this.data[r.ID]=e.workItemId,this.data[r.TITLE]=e.activityName||e.title,this.data[r.SUBTITLE]=e.caseNumber,this.data[r.STATUS]=e.status,this.data[r.DESCRIPTION]=e.details,this.data[r.ICON]=e.icon,this.data[r.TYPE_ROW]=t||this.Class.TYPE_ROW_DEFAULT},_setId:function(){var e=this.Class.DATA_PROPERTIES;$(this.content).prop("id",this._getProperty(e.ID))},setStatus:function(e){var t=e,r="",i=this.content.find(this.Class.SELECTOR_STATUS),a=this.content.find(this.Class.SELECTOR_ARROW);switch(i.show(),t){case this.Class.RESULT_IN_PROCESS:r=bizagi.localization.getResource("workportal-general-word-in-process"),i.text(r+"...");break;case this.Class.RESULT_EXECUTED:i.text(""),$(this.content).addClass("filter-row"),$(this.content).addClass(this.Class.RESULT_EXECUTED);break;case this.Class.RESULT_WARNING:r=bizagi.localization.getResource("workportal-general-word-details"),i.text(r),a.addClass("down"),$(this.content).addClass("filter-row"),$(this.content).addClass(this.Class.RESULT_WARNING);break;case this.Class.RESULT_ERROR:r=bizagi.localization.getResource("workportal-general-word-details"),i.text(r),a.addClass("down"),$(this.content).addClass("filter-row"),$(this.content).addClass(this.Class.RESULT_ERROR);break;default:i.hide()}},setIcon:function(e){var t=this.content.find(this.Class.SELECTOR_ICON);t.hide(),this.content.find(t.selector+"."+e).show()},setDescription:function(e){this.content.find(this.Class.SELECTOR_DESCRIPTION).text(e)},_updateViewAll:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.TITLE),r=this._getProperty(e.SUBTITLE),i=this._getProperty(e.DESCRIPTION),a=this._getProperty(e.STATUS),o=this._getProperty(e.ICON),s=this.content.find(this.Class.SELECTOR_TITLE);_selectorSubtitle=this.content.find(this.Class.SELECTOR_SUBTITLE),_selectorDescription=this.content.find(this.Class.SELECTOR_DESCRIPTION),s.text(t),_selectorSubtitle.text(r),_selectorDescription.hide(),this._setId(),this.setStatus(a),this.setIcon(o),this.setDescription(i)},getView:function(){var e=this,t=new $.Deferred;return e.rendered.then((function(){t.resolve(e.getContent())})),t},_updateView:function(){this._updateViewAll()},dispose:function(){this._events(!0),this._super()}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.checkboxGroup",{CHECKBOX_CLASS:".quick-actions-checkbox",CHECKBOX_CHECKED_CLASS:".quick-actions-checkbox-checked",DATA_PROPERTIES:{CHECK_ALL:"CHECK_ALL"}},{init:function(e,t,r){this._super(e,t,r),this.loadTemplates({"quick-actions-checkbox":bizagi.getTemplate("bizagi.workportal.desktop.widget.checkboxGroup").concat("#ui-bizagi-quickActions-checkbox"),useNewEngine:!1}),this._CHECK_ALL_CHECKBOX_CONTAINER=r.checkAllSelector,this._CHECK_ALL_CHECKBOX=r.checkAllSelector+" div",this._getContainerSelector=r.getContainerSelector,this._onItemsCheckedChange=r.callback,this.checkedItems=[],this._setInitialData()},postRender:function(){var e=this.getTemplate("quick-actions-checkbox");this.checkboxContent=$.tmpl(e,{})},getChecked:function(){return this.checkedItems},renderCheckboxGroup:function(e,t,r){this._items=t,this._context=e;for(var i=0;i<this._items.length;i++)this._renderCheckbox(this._items[i]);this._configureCheckAllCheckbox(),this.loadStoredItems(r)},loadStoredItems:function(e){if(this.checkedItems.length>0&&e){for(var t=[],r=0;r<this.checkedItems.length;r++){var i=this.checkedItems[r],a=this._getContainerSelector(i.id)+" div",o=$(a,this._context);0!==o.length&&(o.toggleClass(this.Class.CHECKBOX_CHECKED_CLASS.substr(1),!0),t.push(i))}this.checkedItems=t,this._refreshCheckAllCheckbox(!0),this._onItemsCheckedChange(),this._updateView()}else this.clearCheckedItems()},clearCheckedItems:function(){this.checkedItems=[],this._toggleCheckAllCheckbox(!1)},_renderCheckbox:function(e){var t=this,r=t._getContainerSelector(e),i=r+" div",a=t.checkboxContent.clone();$(r,t._context).append(a),$(i,t._context).on("click",(function(){$(this).toggleClass(t.Class.CHECKBOX_CHECKED_CLASS.substr(1)),t._updateCheckedItems($(this)),t._refreshCheckAllCheckbox(!1),t._onItemsCheckedChange()})),t._addDataToCheckbox(e,i)},_updateCheckedItems:function(e){var t=this._getDataFormCheckbox(e);this._itemWasChecked(t)?this._removeItemChecked(t):this._addItemChecked(t)},_addItemChecked:function(e){this.checkedItems.push(e)},_removeItemChecked:function(e){this.checkedItems=this.checkedItems.filter((function(t){return JSON.stringify(t)!==JSON.stringify(e)}))},_addDataToCheckbox:function(e,t){$(t,this._context).data("id",e)},_getDataFormCheckbox:function(e){return e.data()},_itemWasChecked:function(e){return this.checkedItems.some((function(t){return JSON.stringify(t)===JSON.stringify(e)}))},_configureCheckAllCheckbox:function(){var e=this,t=e.checkboxContent.clone();$(e._CHECK_ALL_CHECKBOX_CONTAINER,e._context).append(t),$(e._CHECK_ALL_CHECKBOX,e._context).attr("title",e.getResource("workportal-widget-query-form-check-all")).on("click",(function(t){(t=t||window.event).stopPropagation(),e._toggleCheckAllCheckbox()}))},_refreshCheckAllCheckbox:function(e){var t=this.Class.DATA_PROPERTIES,r=this._getNumberOfItemsChecked()===this._items.length;this._setProperty(t.CHECK_ALL,r,e)},_getNumberOfItemsChecked:function(){return this.checkedItems.length},_toggleCheckAllCheckbox:function(e){var t=this.Class.DATA_PROPERTIES,r=this._getProperty(t.CHECK_ALL),i=void 0!==e?e:!r;this._refreshAllCheckboxes(i),this._setProperty(t.CHECK_ALL,i),this._onItemsCheckedChange()},_refreshAllCheckboxes:function(e){var t=this,r=$(t.Class.CHECKBOX_CLASS,t._context).not(t._CHECK_ALL_CHECKBOX);r.toggleClass(t.Class.CHECKBOX_CHECKED_CLASS.substr(1),e),t.checkedItems=[],e&&r.each((function(){var e=t._getDataFormCheckbox($(this));t._addItemChecked(e)}))},_setProperty:function(e,t,r){var i=void 0!==r&&r,a=this.Class.DATA_PROPERTIES[e],o=this.data[a]!==t,s=!i&&o;if(void 0===a)throw"Property does not exist: "+e;this.data[a]=t,s&&this._updateView()},_getProperty:function(e){var t=this.Class.DATA_PROPERTIES[e],r=this.data[t],i=Array.isArray(r)?[]:{};if(void 0===t)throw"Property does not exist: "+e;return"object"===_typeof(r)&&(r=jQuery.extend(i,r)),r},_setInitialData:function(){var e=this.Class.DATA_PROPERTIES;this.data={},this.data[e.CHECK_ALL]=!1},_updateView:function(){this._updateViewCheckAll()},_updateViewCheckAll:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.CHECK_ALL);$(this._CHECK_ALL_CHECKBOX,this._context).toggleClass(this.Class.CHECKBOX_CHECKED_CLASS.substr(1),t)}});
//# sourceMappingURL=../../../../Maps/desktop/queries.desktop.production.js.map
