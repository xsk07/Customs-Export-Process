function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu",{},{onDiscussionsMenuStatusChange:function(t,e){this.updateDiscussionsIcons(e.hasDiscussionsOrComment)},updateDiscussionsIcons:function(t){this.sub("UPDATE_DISCUSSIONS_MENU_STATUS",$.proxy(this.onDiscussionsMenuStatusChange,this)),$(".bz-icon-discussion-comment").toggle(t),$(".bz-icon-discussion-no-comment").toggle(!t),this.params.hasDiscussionsOrComment=t},clean:function(){this.unsub("UPDATE_DISCUSSIONS_MENU_STATUS",$.proxy(this.onDiscussionsMenuStatusChange,this))}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu],!0),bizagi.workportal.widgets.project.dashboard.menu.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(t,e,i){this.params=i||{},this._super(t,e,i),this.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t._super(),t.params.contextsLeftSidebarCaseDashboard.forEach((function(e){t.sub(e,$.proxy(t.updateView,t))}))},updateView:function(t,e){this.params=$.extend(this.params,e.args),this.params.plan.idActivitySelected=void 0,this.clean();var i=this.getContent().empty();void 0!==t.type&&(this.params.showContextByMenuDashboard=t.type);var a={showFormOverview:this.params.menuDashboard.showFormOverview,showFormActivity:this.params.menuDashboard.showFormActivity,showCommentsOptionMenu:this.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:this.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:this.params.menuDashboard.showTimeLineOptionMenu&&(!this.params.isAdhocProcess||this.params.isAdhocProcess&&bizagi.util.isEnableFeature("enableTimelineOnLiveProcesses")),showPlanOptionMenu:this.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:this.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:this.params.menuDashboard.contextFormActivityOptionMenu};this.getTemplate("project-dashboard-menu").render(a).appendTo(i),this.params.showContextByMenuDashboard&&$("li[data-context='"+this.params.showContextByMenuDashboard.toUpperCase()+"']",this.content).addClass("active").siblings().removeClass("active"),this.updateDiscussionsIcons(this.params.hasDiscussionsOrComment),this.handlerEvents()},loadContentById:function(t){t.preventDefault();var e=$(t.target).closest("li");if(!e.hasClass("active")){var i=e.data("context");if(i){var a=this.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),o=parseInt(a[0],10),r="",s=o;"PLANACTIVITIES"==i&&(s=o+1,r=bizagi.localization.getResource("workportal-project-casedashboard-plan")),this.params.refreshLastItemBreadcrumb=!1,this.pub("notify",{type:i.toUpperCase(),args:$.extend(this.params,{showContextByMenuDashboard:i,histName:r,level:s})}),$("li[data-context='"+this.params.showContextByMenuDashboard.toUpperCase()+"']",this.content).addClass("active").siblings().removeClass("active")}}},subMenuHandler:function(){var t=this.getContent(),e=$("[data-context='COMMENTS']",t),i=$("[data-context='FILES']",t),a=$("[data-context='TIMELINE']",t);$(".ui-bizagi-wp-project-tab-submenu a",t).on("click",(function(){e.toggle(),i.toggle(),a.toggle()}))},handlerEvents:function(){var t=this,e=t.getContent();t.subMenuHandler(),$(".ui-bizagi-wp-project-tab-links a",e).on("click",$.proxy(t.loadContentById,t)),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",e).on("click",(function(){var e={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.params.idCase,idTask:t.params.idTask,idWorkflow:t.params.idWorkflow,idWorkItem:t.params.idWorkitem,referrer:t.params.referrer||"inboxGrid"};t.publish("executeAction",e)}))},clean:function(){var t=this,e=t.getContent();t._super(),t.params&&t.params.contextsLeftSidebarCaseDashboard&&t.params.contextsLeftSidebarCaseDashboard.forEach((function(e){t.unsub(e,$.proxy(t.updateView,t))})),$(".ui-bizagi-wp-project-tab-links a",e).off(),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",e).off()}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(t,e,i){this._super(t,e,i),this.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var t=this.getTemplate("project-content-dashboard");return this.content=t.render({}),this.content},postRender:function(){setTimeout((function(){$(window).trigger("resize")}),1e3)}}),bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.activity.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ACTIVITY_LOG},renderContent:function(){var t=this.getTemplate("activity.log");return this.idCase=this.params.idCase,this.idWorkflow=this.params.idWorkflow,this.content=$.tmpl(t,{idCase:this.idCase})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.authentication.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_AUTHENTICATION_LOG},renderContent:function(){var t=this.getTemplate("authentication.log");return this.content=$.tmpl(t,{})}}),bizagi.workportal.widgets.activity.log.extend("bizagi.workportal.widgets.activity.log",{ATTR_VALUE_INDEX_COLUMN:{ActivityLog:2,EntityLog:1,UserLog:2},ATTR_VALUE_MAX_LENGTH:89,SELECTORS:{ATTR_VALUE_VIEW_MORE:".activity-log-attribute-value-container > a",DETAIL_WRAPPER:"#activity-log-data-detail-wrapper"}},{init:function(t,e,i){this.totalPages=0,this.maxRows=10,this.maxPages=10,this.currentPage=1,this._super(t,e,i),this.loadTemplates({"activity.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log"),"activity.log.general.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-general-content"),"activity.log.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-header"),"activity.log.detail.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-header"),"activity.log.detail.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-content"),useNewEngine:!1})},postRender:function(){var t=this;t.generalContentTmpl=t.getTemplate("activity.log.general.content"),t.generalHeaderContentTmpl=t.getTemplate("activity.log.header"),t.detailHeaderTmpl=t.getTemplate("activity.log.detail.header"),t.detailContentTmpl=t.getTemplate("activity.log.detail.content"),t.logCategories={ACTIVITIES:{id:"ActivityLog",serviceMethod:"getActivityLog",detailServiceMethod:"getActivityDetailLog",selectedDetailId:0},ENTITIES:{id:"EntityLog",serviceMethod:"getEntityLog",detailServiceMethod:"getEntityDetailLog",selectedDetailId:0},USERS:{id:"UserLog",serviceMethod:"getUserLog",detailServiceMethod:"getUserDetailLog",selectedDetailId:0},ADMINISTRATION:{id:"AdminLog",serviceMethod:"getAdminLog"}},t.containtersID={GENERAL:"general",DETAIL:"detail"};var e=null!=_typeof(t.dataService.serviceLocator.proxyPrefix)?t.dataService.serviceLocator.proxyPrefix:"";new bizagi.render.services.service({proxyPrefix:e}).getCaseNumber({idCase:t.idCase}).done((function(e){var i=e.caseNumber;t.caseNumber=i||t.idCase,t.initWidget()}))},initWidget:function(){this.displayNoResults(!1),this.setupHeader()},setupHeader:function(){var t=this;content=t.getContent();var e=$("#activity-log-data-header-wrapper",content);$.when(t.dataService.supportedLogTypes()).done((function(i){$.tmpl(t.generalHeaderContentTmpl,{supportedLogTypes:i.Supported}).appendTo(e);var a=t.getFirstAvailableLogTypes(i.Supported);t.currentPage=1,t.getActivityLogByCategory(t.logCategories[a]),t.bindHeaderElementInteraction($("#LnkActivities",t.content),t.logCategories.ACTIVITIES),t.bindHeaderElementInteraction($("#LnkEntities",t.content),t.logCategories.ENTITIES),t.bindHeaderElementInteraction($("#LnkUsers",t.content),t.logCategories.USERS),t.bindHeaderElementInteraction($("#LnkAdmin",t.content),t.logCategories.ADMINISTRATION)})).fail((function(t){}))},getFirstAvailableLogTypes:function(t){for(var e in this.logCategories)for(var i in t)if(this.logCategories[e].id==i&&("true"==t[i]||1==t[i]))return e;return""},bindHeaderElementInteraction:function(t,e){var i=this;t.click((function(){$(this).hasClass("active")||($(".active",i.content).removeClass("active"),$(this).addClass("active"),i.currentPage=1,i.getActivityLogByCategory(e))}))},getActivityLogByCategory:function(t){var e,i=this;i.selectedCategoryObj=$.isEmptyObject(t)?i.selectedCategoryObj:$.extend({},t),e={idCase:i.idCase,idActualPage:i.currentPage,pageSize:i.maxRows},$("#activity-log-data-general-wrapper",content).addClass("ui-bizagi-component-loading"),$.when(i.dataService[i.selectedCategoryObj.serviceMethod](e)).done((function(t){i.totalPages=t.total,i.generalActivityDataValidator(t)})).fail((function(t){bizagi.showErrorAlertDialog=!1,bizagi.showMessageBox(JSON.parse(t.responseText).message,"Bizagi","Error")}))},generalActivityDataValidator:function(t){var e=this.getContent();$("#activity-log-data-general-wrapper",e);t.rows?this.currentLogData=[].concat(t.rows):this.currentLogData=[],this.renderContentByCategory()},renderContentByCategory:function(){var t=this,e=t.getContent(),i=$("#activity-log-data-general-wrapper",e);$("#activity-log-data-detail-wrapper",e);i.removeClass("ui-bizagi-component-loading"),i.empty(),t.switchContent(t.containtersID.GENERAL);var a=t.getPaginationData();$.tmpl(t.generalContentTmpl,{logCategory:t.selectedCategoryObj.id,idCase:t.caseNumber,logItems:t.currentLogData,pagData:a,getIcon:t.getIcon}).appendTo(i),t.setUpPagination($("#biz-wp-activitylog-category-pager ul",t.content),"getActivityLogByCategory"),t.currentLogData.length>0?(t.displayNoResults(!1),$(".activity-log-table",i).show()):(t.displayNoResults(!0),$(".activity-log-table",i).hide()),$(".detail-item",i).click((function(e){e.preventDefault(),t.selectedLogItemIndex=$($(e.currentTarget).closest("tr")[0]).index()-1,t.currentPage=1,t.preprocessDetailRender($(this))})),$(".listHeaderLinks",i).click((function(t){t.preventDefault()}))},getPaginationData:function(){for(var t=this.totalPages>1,e={page:this.currentPage,pagesArray:[],pagination:t},i=this.maxPages>this.totalPages?this.totalPages:this.maxPages,a=0;a<i;a++)e.pagesArray.push(a+1);return e},setUpPagination:function(t,e){var i=this;t.bizagiPagination({maxElemShow:i.maxRows,totalPages:i.totalPages,actualPage:i.currentPage,listElement:t,clickCallBack:function(a){i.currentPage=parseInt(a.page),i[e]({},t)}})},preprocessDetailRender:function(t){var e=this,i=(e.getContent(),e.getDetailRenderParams(t));e.selectedCategoryObj.detailServiceMethod&&$.when(e.dataService[e.selectedCategoryObj.detailServiceMethod](i)).done((function(t){e.totalPages=t.total,e.switchContent(e.containtersID.DETAIL),t.rows?e.currentDetailLogData=[].concat(t.rows):e.currentDetailLogData=[],e.renderLogDetail(t)})).fail((function(t){}))},getDetailRenderParams:function(t){var e,i;switch(this.selectedCategoryObj.id){case this.logCategories.ACTIVITIES.id:$.isEmptyObject(t)?i=this.logCategories.ACTIVITIES.selectedDetailId:this.logCategories.ACTIVITIES.selectedDetailId=i=t.attr("data-id"),e={idCase:this.idCase,idWorkItemFrom:i};break;case this.logCategories.ENTITIES.id:$.isEmptyObject(t)?i=this.logCategories.ENTITIES.selectedDetailId:this.logCategories.ENTITIES.selectedDetailId=i=t.attr("data-id"),e={idCase:this.idCase,idEntity:i};break;case this.logCategories.USERS.id:$.isEmptyObject(t)?i=this.logCategories.USERS.selectedDetailId:this.logCategories.USERS.selectedDetailId=i=t.attr("data-id"),e={idCase:this.idCase,idUser:i}}return $.extend(e,{idActualPage:this.currentPage,pageSize:this.maxRows}),e},renderLogDetail:function(t){var e=this,i=e.getContent(),a=$("#activity-log-data-detail-wrapper",i);a.empty(),a.removeClass("ui-bizagi-component-loading"),$.when(e.renderDetailContent()).done((function(){var t=$("#log-filter-wrapper",i);e.showDetailResultMessage(),$("#back-general-content",a).click((function(t){t.preventDefault(),e.displayNoResults(!1),e.switchContent(e.containtersID.GENERAL)})),$("#apply-filter",t).click((function(t){t.preventDefault(),e.currentPage=1,e.applyDetailFilter()})),$("#remove-filter",t).click((function(i){i.preventDefault(),$("input",t).val(""),e.currentPage=1,e.applyDetailFilter()})),$(".listHeaderLinks",a).click((function(t){t.preventDefault()})),e._eventsDeclare()}))},showDetailResultMessage:function(){var t=$("#activity-log-data-detail-wrapper",this.getContent());this.currentDetailLogData.length>0?(this.displayNoResults(!1),$(".activity-log-table",t).show()):(this.displayNoResults(!0),$(".activity-log-table",t).hide())},applyDetailFilter:function(){var t=this,e=t.getFilterParams(),i=t.getContent();t.selectedCategoryObj.detailServiceMethod&&$.when(t.dataService[t.selectedCategoryObj.detailServiceMethod](e)).done((function(e){t.totalPages=e.total,e.rows?t.currentDetailLogData=[].concat(e.rows):t.currentDetailLogData=[];var a=t.getPaginationData(),o=t._renderDetailContentTmpl(a);$("#bz-workportal-activitylog-detailcontent-wrapper",i).remove(),$(o).insertAfter("#activity-log-data-detail-header-wrapper",i),t.showDetailResultMessage(),t.setUpPagination($("#biz-wp-activitylog-detail-pager ul",i),"applyDetailFilter"),t._eventsDeclare()}))},getFilterParams:function(){var t,e,i,a=this.getContent(),o=$("#log-filter-wrapper",a),r=this.getDetailRenderParams();return this.selectedCategoryObj.id==this.logCategories.ENTITIES.id?t=$("#filterUser",o).val().toLowerCase():this.selectedCategoryObj.id==this.logCategories.USERS.id&&(i=$("#filterEntity",o).val().toLowerCase()),e=$("#filterAttribute",o).val().toLowerCase(),$.extend(r,{userFullName:t,attribDisplayName:e,entDisplayName:i}),r},_eventsDeclare:function(){var t=this.Class.SELECTORS,e=this.getContent(),i=$(t.DETAIL_WRAPPER,e);$(t.ATTR_VALUE_VIEW_MORE,i).click(this._showCompleteAttributeValue)},_renderDetailContentTmpl:function(t){var e={logCategory:this.selectedCategoryObj.id,title:this.selectedCategoryObj.title,detailItems:this.currentDetailLogData,pagData:t,isAttrValue:this._isAttrValue.bind(this,this.selectedCategoryObj.id),attrValue2show:this._attrValue2show.bind(this),showMoreButton4AttrValue:this._showMoreButton4AttrValue.bind(this)};return $.tmpl(this.detailContentTmpl,e)},_showCompleteAttributeValue:function(t){var e=$(this).find("span").html();t.preventDefault(),bizagi.showSimpleBox(e,bizagi.localization.getResource("workportal-widget-activity-log-table-details-title-attrvalue"))},_isAttrValue:function(t,e){var i=this.Class.ATTR_VALUE_INDEX_COLUMN[t];return void 0===i&&console.error("_isAttrValue: the selectedCategoryObjId "+t+" does not exist"),e==i},_attrValue2show:function(t){return t.substr(0,this.Class.ATTR_VALUE_MAX_LENGTH)},_showMoreButton4AttrValue:function(t){return t.length>this.Class.ATTR_VALUE_MAX_LENGTH},renderDetailContent:function(){var t=this,e=t.getContent(),i=$.Deferred(),a=$("#activity-log-data-detail-wrapper",e),o=t.getPaginationData(),r=$.tmpl(t.detailHeaderTmpl,{logCategory:t.selectedCategoryObj.id,idCase:t.caseNumber,data:t.currentLogData[t.selectedLogItemIndex]}),s=t._renderDetailContentTmpl(o);return $.when(r,s).done((function(e,o){a.append(e),o.insertAfter("#activity-log-data-detail-header-wrapper",a),t.setUpPagination($("#biz-wp-activitylog-detail-pager ul",t.content),"preprocessDetailRender"),i.resolve()})),i.promise()},switchContent:function(t){var e=this.getContent(),i=$("#activity-log-data-general-wrapper",e),a=$("#activity-log-data-detail-wrapper",e);this.containtersID.DETAIL==t?(i.hide(),a.show()):(i.show(),a.hide())},displayNoResults:function(t){var e=this.getContent();t?$("#activity-log-no-results",e).show():$("#activity-log-no-results",e).hide()},getIcon:function(t){var e="bzg-case-allocation",i="bzg-case-allocation-info",a="bzg-case-canceled",o="";switch(t){case 1:case 6:case 7:case 1002:o=e;break;case 3:case 4:o=i;break;case 1001:o=a}return o}}),bizagi.injector.register("bizagi.workportal.widgets.activity.log",["workportalFacade","dataService",bizagi.workportal.widgets.activity.log],!0),bizagi.workportal.widgets.authentication.log.extend("bizagi.workportal.widgets.authentication.log",{},{init:function(t,e,i){this._super(t,e,i),this.loadTemplates({"authentication.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log"),"authentication.log.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-fields"),"authentication.log.button":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-button"),"authentication.log.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-result"),"authentication.log.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-pagination"),useNewEngine:!1})},postRender:function(){this.maxElemShow=10,this.maxPageToShow=5,this.generalContentTmpl=this.getTemplate("authentication.log"),this.fieldsContentTmpl=this.getTemplate("authentication.log.fields"),this.buttonContentTmpl=this.getTemplate("authentication.log.button"),this.resultContentTmpl=this.getTemplate("authentication.log.result"),this.paginationTmpl=this.getTemplate("authentication.log.pagination"),this.setupInitialData()},setupInitialData:function(){var t=this,e=t.getContent(),i=[{dataType:"domains"},{dataType:"events"},{dataType:"subEvents"}];$.when(t.dataService.getAuthenticationLogData(i[0]),t.dataService.getAuthenticationLogData(i[1]),t.dataService.getAuthenticationLogData(i[2])).done((function(i,a,o){t.eventTypeList=a[0].response,t.subEventTypeList=o[0].response;var r=$.tmpl(t.fieldsContentTmpl,{domainList:i[0],eventTypeList:a[0].response,subEvenTypes:o[0].response});e.append(r),t.setupDatePicker(),t.setupFooterButtons()})).fail((function(t){bizagi.log(t)}))},setupDatePicker:function(){var t=this.getContent(),e=this.getDateFormat(),i=bizagi.localization.getResource("timeFormat");$(".biz-wp-form-datepicker",t).datetimepicker({controlType:"select",dateFormat:e,timeFormat:i,currentText:bizagi.localization.getResource("render-timeentry-now"),closeText:bizagi.localization.getResource("workportal-general-button-label-done"),timeText:bizagi.localization.getResource("workportal-project-plan-time-title"),hourText:bizagi.localization.getResource("reports-general-hour").capitalize(),minuteText:bizagi.localization.getResource("reports-general-minute").capitalize()})},getDateFormat:function(){var t=bizagi.localization.getResource("dateFormat");return t.indexOf("MMMM")>=0?t=t.replaceAll("MMMM","MM"):t.indexOf("MMM")>=0?t=t.replaceAll("MMM","M"):t.indexOf("MM")>=0?t=t.replaceAll("MM","mm"):t.indexOf("M")>=0&&(t=t.replaceAll("M","m")),-1!=t.search("yyyy")?t=t.replaceAll("yyyy","yy"):-1!=t.search("yy")&&(t=t.replaceAll("yy","y")),t=t.replaceAll("dddd","DD")},setupFooterButtons:function(){var t=this,e=t.getContent(),i=$.tmpl(t.buttonContentTmpl,{});e.append(i);var a=$("#authentication-log-data-buttonset",e);$("#btn-authentication-search",a).click((function(i){$(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove();var a=t.validateData(),o=$("#sinceDate",e).val(),r=$("#toDate",e).val();if(""!=o&&(o=bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(o,t.getResource("dateFormat")+" "+t.getResource("timeFormat")),"MM/dd/yyyy H:mm")),""!=r&&(r=bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(r,t.getResource("dateFormat")+" "+t.getResource("timeFormat")),"MM/dd/yyyy H:mm")),a.fieldsAreEmpty||""!=a.errorMessage)bizagi.showMessageBox(a.errorMessage,"Bizagi","warning");else{var s={action:"AuthLog",domain:"none"!=$("#domainList",e).val()?$("#domainList",e).val():"",userName:$("#auth-log-user",e).val(),dtFrom:o,dtTo:r,eventSubType:$("#subEventType",e).val()!=t.subEventTypeList[0].displayName?$("#subEventType",e).val():"",eventType:$("#eventType",e).val()!=t.eventTypeList[0].displayName?$("#eventType",e).val():"",pagSize:t.maxElemShow};t.findResults(e,s)}}))},validateData:function(){var t=this.getContent(),e={fieldsAreEmpty:!1,errorMessage:""},i="",a="",o=$("#sinceDate",t).val(),r=$("#toDate",t).val();return"none"==$("#domainList",t).val()&&""==$("#user",t).val()&&$("#eventType",t).val()==this.eventTypeList[0].id&&$("#subEventType",t).val()==this.subEventTypeList[0].id&&""==$("#sinceDate",t).val()&&""==$("#toDate",t).val()?(e.fieldsAreEmpty=!0,e.errorMessage=bizagi.localization.getResource("workportal-widget-authentication-log-emptyfields-message")):""!=o&&""==bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(o,this.getResource("dateFormat")+" "+this.getResource("timeFormat")),"MM/dd/yyyy H:mm")?(a=bizagi.localization.getResource("workportal-widget-authentication-log-datesince"),i=(i=bizagi.localization.getResource("workportal-general-invalid-date")).replace("{0}",a),e.errorMessage=i):""!=r&&""==bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(r,this.getResource("dateFormat")+" "+this.getResource("timeFormat")),"MM/dd/yyyy H:mm")&&(a=bizagi.localization.getResource("workportal-widget-authentication-log-dateto"),i=(i=bizagi.localization.getResource("workportal-general-invalid-date")).replace("{0}",a),e.errorMessage=i),e},findResults:function(t,e,i){var a=this;e.pag=i||1,$.when(a.dataService.getAuthenticationLogResult(e)).done((function(i){if($(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove(),a.totalRecords=i.records,a.totalPages=i.total,i.rows.length>0){var o=$.tmpl(a.resultContentTmpl,{resultList:i.rows});t.append(o);var r,s=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,n=$("#biz-wp-table-pager-wrapper"),c={};c.pagination=a.totalPages>1,c.page=i.page,c.pages={};for(var l=1;l<=s;l++)c.pages[l]={pageNumber:l};r=$.tmpl(a.paginationTmpl,c).html(),n.append(r),$("ul").bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(i){a.findResults(t,e,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-authentication-log-none"),"Bizagi","warning")})).fail((function(t){bizagi.log(t)}))}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.overview",{},{init:function(t,e,i){this._super(t,e,i),this.loadTemplates({"project-overview":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview"),"project-overview-no-summary-form-found":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview-no-summary-form-found")})},renderContent:function(){var t=this.getTemplate("project-overview");return this.content=t.render({}),this.content},postRender:function(){var t=this,e=t.getContent(),i=$("#ui-bizagi-wp-project-overview-wrapper",e);i.bind("oldrenderintegration",(function(e){if(!e.isPropagationStopped()){e.stopPropagation();var a=t.workportalFacade.getTemplate("inbox-common-case-summary-oldrender"),o={};bizagi.oldrenderevent=!0;var r=window.addEventListener?"addEventListener":"attachEvent";(0,window[r])("attachEvent"==r?"onmessage":"message",(function(e){e.stopPropagation(),t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.data})}),!1),$.when(t.dataService.getWorkitems({idCase:t.params.idCase,onlyUserWorkItems:!0})).done((function(e){if("object"==_typeof(e.workItems)&&e.workItems.length>=1){var r=e.workItems[0].idWorkItem,s=e.workItems[0].idTask;o.url=t.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+t.idCase+"&idWorkitem="+r+"&idTask="+s+"&isSummary=1"}else o.url=t.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+t.idCase+"&isSummary=1";i.empty(),$.tmpl(a,o).appendTo(i),t.iframeOldRender($("iframe",i))}))}}));var a={idCase:t.params.idCase};$.when(t.dataService.getCaseFormsRenderVersion(a)).done((function(a){1==a.formsRenderVersion?i.trigger("oldrenderintegration"):t.renderSummaryForm(t.params.idCase,$("#ui-bizagi-wp-project-overview-wrapper",e))}))},renderSummaryForm:function(t,e){var i=this,a=null!=_typeof(i.dataService.serviceLocator.proxyPrefix)?i.dataService.serviceLocator.proxyPrefix:"",o=new bizagi.rendering.facade({proxyPrefix:a});o.execute({canvas:e,summaryForm:!0,idCase:t}),o.subscribe("no-data-found",(function(){var t=i.getTemplate("project-overview-no-summary-form-found");e.append(t.render())})),i.renderingFacade=o,setTimeout((function(){i.resizeLayout()}),1e3)},iframeOldRender:function(t){this.getContent();var e,i=bizagi.readQueryString();$.each(t,(function(){$(this).is("iframe")&&(e=$(this))})),e.load((function(){var t=$(this).contents(),e=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";e=e.replace("%theme%",i.theme||"bizagiDefault"),$("body",t).append("<link type='text/css' rel='stylesheet' href='"+e+"'>")}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.overview",["workportalFacade","dataService",bizagi.workportal.widgets.project.overview],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining"),"project-cancel-case-button":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-cancel-case-button")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;(t.contextsSidebarActivity||[]).forEach((function(e){t.sub(e,$.proxy(t.updateView,t))}))},updateView:function(t,e){var i=this;$.extend(i.params,e.args);var a=e.args;i.getContent().empty();var o={isFavoriteCase:"off"};if(a.isFavorite&&JSON.parse(a.isFavorite)?o.isFavoriteCase="bz-icon-star":o.isFavoriteCase="bz-icon-star-outline",i.showCaseNumber(a,o),a.creationDate){var r=bizagi.currentUser.timeZoneName,s=a.creationDate,n=i.getDateWithTimezone("MM/DD/yyyy H:mm",r,s);o.creationDateFormat=i.getFormattedDate(n);var c=i.getDateWithTimezone("MM/DD/yyyy H:mm",r,a.solutionDate);o.solutionDateFormat=i.getFormattedDate(c);var l=i.getDateWithTimezone("MM/DD/yyyy H:mm",r);i.calculateDataForTemplate(o,n,l,c,a)}$(i.getContent()).on("click",".show-diagram-case",(function(){!(!i.params.isAdhocProcess||void 0===i.params.isAdhocProcess)?i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkFlow,isAdhoc:!0,idProcess:i.params.idAdhocProcess}):i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkflow})})),$(i.getContent()).on("click",".show-process-help",(function(){i.showHelpUrl(i.params.helpUrl)}))},calculateDataForTemplate:function(t,e,i,a,o){var r=this.getContent(),s=bizagi.currentUser.timeZoneName,n={};n.idUser=bizagi.currentUser.idUser,bizagi.util.parseBoolean(o.isOpen)?(n.fromDate=e.getTime(),n.toDate=i.getTime()):(n.fromDate=a.getTime(),n.toDate=i.getTime());var c=n.toDate-n.fromDate,l=this.getDateWithTimezone("MM/DD/yyyy H:mm",s),p=bizagi.util.dateFormatter.getRelativeTime(new Date(l.getTime()-c),null,!1,s);bizagi.util.parseBoolean(o.isOpen)?(t.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",p),t.colorStateCase="Opened"):(t.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",p),t.colorStateCase="Closed"),t.percentCompleteBar=100,t.isOpen=bizagi.util.parseBoolean(o.isOpen),this.getTemplate("project-caseState-remaining").render($.extend(o,t)).appendTo($("#ui-bizagi-remaining",r))},showCancelCase:function(t,e,i){var a=this,o=a.getContent(),r=a.getTemplate("project-cancel-case-button");e.buttonCancelCase=i,r.render($.extend(t,e)).appendTo($("#ui-bizagi-cancel-case",o)),$("#ui-bizagi-wp-project-activity-cancel-case-button > a",a.content).click((function(){var t={widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_CANCEL_CASE,maximize:!1,dialogClass:"bz-cancel-case-widget",idWorkitem:a.params.idWorkitem,idCase:a.params.idCase,modalParameters:{refreshInbox:!1,title:bizagi.localization.getResource("workportal-widget-cancel-case-title"),width:420,height:400},closeVisible:!1};a.publish("showDialogWidget",t)}))},showCaseNumber:function(t,e){var i=this.getContent(),a=this.getTemplate("project-caseState"),o=!1;o=!(!this.params.isAdhocProcess||void 0===this.params.isAdhocProcess)&&this.params.isAdhocProcess,this.params.helpUrl=bizagi.util.validateUrlWellFormed(this.params.helpUrl),a.render($.extend(t,e,{security:bizagi.menuSecurity,isAdhocProcess:o,urlHelp:!bizagi.util.isEmpty(this.params.helpUrl)})).appendTo(i),this._startShowCancelCase(t,e),$(".case-summary-favorite",i).on("click",$.proxy(this.onClickFavorite,this)),$(".case-summary-back",this.content).on("click",$.proxy(this.goToCase,this,"back")),$(".case-summary-next",this.content).on("click",$.proxy(this.goToCase,this,"next")),this.showBackNextNavigation()},_startShowCancelCase:function(t,e){var i=bizagi.injector.get("bizagi.workportal.widgets.navigator"),a=this.showCancelCase.bind(this,t,e);i.getShowCancelCase().done(a)},getFormattedDate:function(t){var e=this.datePickerRegional.monthNames,i=t.getMonth(),a=BIZAGI_LANGUAGE;return null!=a&&null!=a&&a.length>0&&"fr"==a.substring(0,2)?$.datepicker.formatDate("dd",t)+" "+e[i]:e[i]+" "+$.datepicker.formatDate("dd",t)},onClickFavorite:function(t){t.preventDefault();var e=this,i={};$(t.target).hasClass("bz-icon-star-outline")?(i={idObject:e.params.idCase,favoriteType:"CASES"},$.when(e.dataService.addFavorite(i)).done((function(i){e.params.guidFavorite=i.idFavorites,$(t.target).removeClass("bz-icon-star-outline"),$(t.target).addClass("bz-icon-star")}))):(i={idObject:e.params.guidFavorite,favoriteType:"CASES"},$.when(e.dataService.delFavorite(i)).done((function(){$(t.target).addClass("bz-icon-star-outline"),$(t.target).removeClass("bz-icon-star")})))},showHelpUrl:function(t){window.open(t)},callGetEffectiveDuration:function(t){var e=$.Deferred();return t.fromDate?$.when(this.dataService.getEffectiveDuration(t)).done((function(t){e.resolve(t)})):e.resolve(null),e.promise()},clean:function(){var t=this;$(".show-diagram-case",t.getContent()).off();var e=t.contextsSidebarActivity||[];this.params={},e.forEach((function(e){t.unsub(e,$.proxy(t.updateView,t))}))},goToCase:function(t){var e="back"==t?this.getBackCase():this.getNextCase();e>0&&this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e})},getListKey:function(){if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(var t=0;t<bizagi.lstIdCases.length;t++)if(this.params.idCase==bizagi.lstIdCases[t])return t;return-1},getNextCase:function(){var t=this.getListKey();return bizagi.lstIdCases.length==t+1||1==bizagi.lstIdCases.length?-1:bizagi.lstIdCases[t+1]},getBackCase:function(){var t=this.getListKey();return 0==t?-1:bizagi.lstIdCases[t-1]||-1},showBackNextNavigation:function(){var t=this.getNextCase(),e=this.getBackCase();t<=0?$(".case-summary-next",this.content).hide():$(".case-summary-next",this.content).show(),e<=0?$(".case-summary-back",this.content).hide():$(".case-summary-back",this.content).show(),t<=0&&e<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}}),bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach((function(e){t.sub(e,$.proxy(t.updateView,t))}))},updateView:function(t,e){var i=e.args;this.params=i,this.getContent();var a=bizagi.currentUser.timeZoneName,o={},r=i.currentState||[],s=r.filter((function(t){return t.idWorkItem==i.idWorkitem}))[0];if(s){o.activityName=s.state,o.activityIsEvent=bizagi.util.parseBoolean(s.isEvent);var n=this.getDateWithTimezone("MM/DD/yyyy H:mm",a,s.entryDateWorkItem);n.getTime&&(o.initDateFormat=this.getFormattedDate(n));var c=this.getDateWithTimezone("MM/DD/yyyy H:mm",a),l=this.getDateWithTimezone("MM/DD/yyyy H:mm",a,s.estimatedSolutionDate);o.estimatedSolutionDateFormat="",n.getTime&&l.getTime&&s?this.calculateDataForTemplate(s,o,n,c,l,r):this.updateTemplateWidget(o,r)}},initilizeActionMenu:function(t){var e=this,i=!1;if(t&&t.length>0)for(j=0;j<t.length;++j)t[j]&&e.params&&t[j].idWorkItem==e.params.idWorkitem&&(i=bizagi.util.parseBoolean(t[j].allowsReassign)||!1);var a=$("#bt-case-action-reassing",e.content),o=$("#ui-bizagi-wp-project-activity-button:not(.ui-bizagi-wp-project-activity-shared)",e.content);i&&a.show(),a.on("click",(function(){e.onClickMenuReasign()})),o.on("click",(function(){e.onClickShareActivity()}))},onClickMenuReasign:function(){var t=this,e=t.params.idCase,i=t.params.idWorkitem,a=function(){t.publish("closeCurrentDialog")};bizagi.loader.startAndThen("admin").then((function(){$.when(t.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:e,idWorkItem:i,closeDialogWidget:a},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))}))},onClickShareActivity:function(){var t={idWorkItem:this.params.idWorkitem},e=$("#ui-bizagi-wp-project-activity-button",this.content);e.attr("disabled",!0),$.when(this.dataService.getShareActivity(t)).done((function(t){var i=window.parent.bizagi.injector.get("notifier");!0===t.value?(e.addClass("ui-bizagi-wp-project-activity-shared").unbind("click"),i.showSucessMessage(bizagi.localization.getResource("workportal-project-activity-success-message"),"")):i.showErrorMessage(bizagi.localization.getResource("workportal-project-activity-error-message"),"")})).always((function(){e.attr("disabled",!1)}))},calculateDataForTemplate:function(t,e,i,a,o,r){var s=bizagi.currentUser.timeZoneName,n=a.getTime()-o.getTime(),c=i.getTime()-o.getTime(),l=(bizagi.currentUser.idUser,i.getTime()),p=this.getDateWithTimezone("MM/DD/yyyy H:mm",s).getTime(),d=!1,g={idUser:bizagi.currentUser.idUser,fromDate:a.getTime(),toDate:o.getTime()},u={};n>0?(g.fromDate=o.getTime(),g.toDate=a.getTime(),d=!0):(u.idUser=bizagi.currentUser.idUser,u.fromDate=i.getTime(),u.toDate=o.getTime());var h=p-l,m=g.toDate-g.fromDate,b=n>0?0:u.toDate-u.fromDate,v=this.getDateWithTimezone("MM/DD/yyyy H:mm",s),w=bizagi.util.dateFormatter.getRelativeTime(new Date(v.getTime()-h),null,!1,s);if(e.colorState=t.colorState,e.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",w),e.percentCompleteBar=100,0===c)e.showEstimatedSolutionDate=!1;else if(e.showEstimatedSolutionDate=!0,!1===d){var y=this.getPercentBar(b/1e3/60,m/1e3/60);e.percentCompleteBar=y.percent}t&&(e.isEvent=bizagi.util.parseBoolean(t.isEvent),e.canShareActivity=t.canShareActivity,e.isShared=t.isShared),e.estimatedSolutionDateFormat=this.getFormattedDate(o),this.updateTemplateWidget(e,r)},getPercentBar:function(t,e){var i={};return i.percent=Math.round(100*(1-e/t)),i},updateTemplateWidget:function(t,e){var i=this.getContent().empty();!1===bizagi.override.enableShareActivity&&(t.canShareActivity=!1,t.isShared=!1),this.getTemplate("project-activityState-wrapper").render(t).appendTo(i),e.length>0&&this.initilizeActionMenu(e),this.shareActivityTooltip()},shareActivityTooltip:function(){var t=$("#ui-bizagi-wp-project-activity-button",this.content);t.on("mouseenter",(function(){var e=t.hasClass("ui-bizagi-wp-project-activity-shared")?"workportal-project-activity-shared":"workportal-project-activity-share";t.attr("title",bizagi.localization.getResource(e))})),t.tooltip({tooltipClass:"custom-tooltip-styling-bottom-bar",position:{my:"right top",at:"left top",of:t,collision:"flip"}})},getFormattedDate:function(t){var e=this.datePickerRegional.monthNames,i=t.getMonth(),a=BIZAGI_LANGUAGE;return null!=a&&null!=a&&a.length>0&&"fr"==a.substring(0,2)?$.datepicker.formatDate("dd",t)+" "+e[i]:e[i]+" "+$.datepicker.formatDate("dd",t)},clean:function(){var t=this,e=t.contextsSidebarActivity||[];this.params={},e.forEach((function(e){t.unsub(e,$.proxy(t.updateView,t))}))},callGetEffectiveDuration:function(t){var e=this,i=$.Deferred();return setTimeout((function(){t.fromDate?$.when(e.dataService.getEffectiveDuration(t)).done((function(t){i.resolve(t)})):i.resolve(null)}),200),i.promise()}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var t=this.getTemplate("project-process-state");return this.content=t.render({}),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach((function(e){t.sub(e,$.proxy(t.updateView,t))}))},updateView:function(t,e){var i=e.args,a=this.getContent().empty();this.params=i;var o={};o.showParentProcess=i.idParentCase>=1,o.parentProcess={displayName:i.parentDisplayName,idCase:i.idParentCase,idWorkItem:i.idWorkItem,idTask:"0"==i.idTask?"":i.idTask,idWorkflow:i.idWorkflowParentCase},this.getTemplate("project-process-state").render($.extend(i,o)).appendTo(a),$("#go-to-parent-case",a).on("click",$.proxy(this.onClickGoToParentCase,this))},onClickGoToParentCase:function(t){t.preventDefault();this.routingExecute($(t.target).closest("#go-to-parent-case"))},clean:function(){var t=this;t.params={},t.contextsSidebarActivity.forEach((function(e){t.unsub(e,$.proxy(t.updateView,t))}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(t,e,i,a){this.relatedusers=i,this._super(t,e,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.plugins={},this.users=[],this.loadedUsers=!1,this.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach((function(e){t.sub(e,$.proxy(t.updateView,t))})),t.sub("ON_RENDER_FINISH",$.proxy(t.onRenderFinish,t))},updateView:function(t,e){var i=this;i.params=e,setTimeout((function(){!1===i.loadedUsers&&i.onRenderFinish()}),500)},onRenderFinish:function(){var t=this.params.args,e=this.getContent().empty();this.loadedUsers=!0,this.getTemplate("project-users").render().appendTo(e),this.showCreatorInformation(e);var i=[{id:t.createdBy.userId,typeName:"owner"}];t.idCase>0&&this.relatedusers.render(this.content,".relatedusers-wrapper",t.idCase,i)},showCreatorInformation:function(t){var e=this,i={userIds:e.params.args.createdBy.userId,width:50,height:50};e.dataService.getUsersData(i).done((function(i){var a=usersAdapter.createJsonUserInfo(i[0].id,i[0].name,i[0].username,i[0].picture?"data:image/png;base64,"+i[0].picture:void 0,i[0].email,i[0].name.getInitials(),!1,!0,[],[]);t.find("#ui-bizagi-wp-project-users-wrapper .ui-bizagi-wp-project-users-creator-info").userinformation(e,{user:a})}))},clean:function(){var t=this;t.loadedUsers=!1,t.contextsSidebarActivity.forEach((function(e){t.unsub(e,$.proxy(t.updateView,t))}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses.data",{responseSubprocessState:{},responseSubprocess:function(t){return t&&(responseSubprocessState=t),responseSubprocessState},auxArrayListSubprocessesState:[],auxArrayListSubprocesses:function(t){return t?jQuery.isArray(t)&&0===t.length?void(this.auxArrayListSubprocessesState.length=0):this.auxArrayListSubprocessesState.push(t):this.auxArrayListSubprocessesState}},{init:function(t,e,i){this._super(t,e,i),this.Class.auxArrayListSubprocesses([]),this.loadTemplates({"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.subprocesses.data").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},initializeTooltip:function(t){var e=this,i=e.getContent();$(t,i).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){var t,i,a,o=$(this).closest("li").find("#idCase").val(),r=e.Class.auxArrayListSubprocesses().filter((function(t){return t.idCase==o}));if(r.length>0)return t=r[0].indexSubprocess,i=r[0].idCustData,a=$(this).text(),e.getContentTooltip(t,i,a,e.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(t,e){if(void 0===t.originalEvent)return!1;var i=$(e.tooltip).attr("id");$("div.ui-tooltip").not("#"+i).remove()},close:function(t,e){e.tooltip.hover((function(){$(this).stop(!0).fadeTo(400,1)}),(function(){$(this).fadeOut("400",(function(){$(this).remove()}))}))}})},getContentTooltip:function(t,e,i,a){"-1"==e&&(e="0");var o=function(t,e){return{nameProperty:t,valueProperty:e}},r=[],s="",n=this.getSubprocessData(t,e),c=n.custData,l=n.custDataTypes,p=n.custFields,d=n.displayName;if(r.push(new o(bizagi.localization.getResource("workportal-widget-inboxcommon-subprocess"),d)),c.length)for(var g=0;g<c.length;g+=1)s=c[g],l&&("Money"==l[g]?s=bizagi.util.formatMonetaryCell(s):"Boolean"==l[g]?s=bizagi.util.formatBoolean(s):"Float"==l[g]||"Real"==l[g]?s=bizagi.util.formatDecimalCell(s):"function"==typeof s&&(s="")),r.push(new o(p[g],s));var u={};u.arrayCustomsProperties=r,u.nameSubprocess=i;var h=a,m=$('<div class="bizagi-custom-tooltip-subprocesses"></div>');return h.render(u).appendTo(m),m.html()},getSubprocessData:function(t,e){var i={},a=this.Class.responseSubprocess().subProcesses,o=this.Class.responseSubprocess().subProcPersonalized;if(a&&a.length>0){i.custData=a[t].custData,i.custDataTypes=a[t].custDataTypes;var r=this.Class.responseSubprocess().CustFields[e];i.custFields=r[Object.keys(r)[0]],i.displayName=a[t].displayName}else o&&Object.keys(o).length>0&&(i.custData=o[0].subProcesses[t].custData,i.custDataTypes=o[0].subProcesses[t].custDataTypes,i.custFields=o[0].CustFields[0],i.displayName=o[0].subProcesses[t].displayName);return i},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses.data",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses.data]),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.events",{},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var t=this.getTemplate("project-events");return this.content=t.render({}),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach((function(e){t.sub(e,$.proxy(t.updateView,t))}))},updateView:function(t,e){var i=this,a=e.args,o=i.getContent().empty();i.params=a,$.when(i.getArgsTemplate(a)).done((function(t){i.getTemplate("project-events").render($.extend(a,t)).appendTo(o),$(".list-events li.event a",o).on("click",$.proxy(i.onClickGoEvent,i)),i.initializeTooltip(".list-events li")}))},getArgsTemplate:function(t){var e=$.Deferred(),i={};if(t.countEvents>=1)for(var a=0;a<t.currentState.length;a++)"true"==t.currentState[a].isEvent&&t.currentState[a].idWorkItem==t.idWorkitem&&(t.countEvents=t.countEvents-1);return i.showEvents=t.countEvents>=1,i.showEvents?$.when(this.callSummaryCaseEvents(t.idCase)).done((function(a){t.showEvents=a.events.length>=1,t.showEvents&&(i.events=[],a.events.forEach((function(t){i.events.push($.extend(t[Object.keys(t)[0]],{idWorkFlow:a.idWorkFlow}))}))),e.resolve(i)})):e.resolve(i),e.promise()},onClickGoEvent:function(t){t.preventDefault();var e=this;$.when(bizagi.util.autoSave()).done((function(){e.routingExecute($(t.target).closest("li"))}))},callSummaryCaseEvents:function(t){var e=$.Deferred();return $.when(this.dataService.summaryCaseEvents({idCase:t})).done((function(t){e.resolve(t)})),e.promise()},clean:function(){var t=this;this.params={},t.contextsSidebarActivity.forEach((function(e){t.unsub(e,$.proxy(t.updateView,t))}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.subprocesses",{responseSubprocess:function(t){return this._super(t)},auxArrayListSubprocesses:function(t){return this._super(t)}},{init:function(t,e,i){this._super(t,e,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var t=this;t.contextsSidebarActivity.forEach((function(e){t.sub(e,$.proxy(t.updateView,t))}))},updateView:function(t,e){var i=this,a=e.args;i.getContent().empty();i.params=a,i.params.idCase>0&&$.when(i.dataService.summarySubProcess({idCase:i.params.idCase})).done((function(t){i.Class.responseSubprocess(t),i.organizeDataForSubprocesses(i.params)}))},organizeDataForSubprocesses:function(t){var e=this;if(e.Class.responseSubprocess().showSubProcess){$.each(e.Class.responseSubprocess().subProcesses,(function(t){var i=e.Class.responseSubprocess().subProcesses[t].custData;if(i&&i.length)for(var a=0;a<i.length;a+=1)null===i[a]&&(i[a]="")}));var i=e.Class.responseSubprocess().subProcesses||e.Class.responseSubprocess().subProcPersonalized;e.Class.auxArrayListSubprocesses([]);for(var a=0;a<Object.keys(i).length;a+=1){var o=i[a];e.Class.auxArrayListSubprocesses({isOpen:o.isOpen,radNumber:o.radNumber,displayName:o.displayName,idCase:o.idCase,indexSubprocess:a,idCustData:o.idCustData}),o.subProcesses&&Object.keys(o).forEach((function(t){e.Class.auxArrayListSubprocesses({isOpen:o[t].isOpen,radNumber:o[t].radNumber,displayName:o[t].displayName,idCase:o[t].idCase,indexSubprocess:a,idCustData:o[t].idCustData})}))}e.renderWidget()}},renderWidget:function(){var t=this.getContent();this.getTemplate("project-subprocesses").render({auxArrayListSubprocesses:this.Class.auxArrayListSubprocesses()}).appendTo(t),$(".list-subprocesses a",t).on("click",$.proxy(this.onClickGoSubprocess,this)),this.initializeTooltip(".list-subprocesses li")},onClickGoSubprocess:function(t){t.preventDefault();this.routingExecute($(t.target).closest("li"))},clean:function(){var t=this;t.params={},t.pluginTooltip=null,t.contextsSidebarActivity.forEach((function(e){t.unsub(e,$.proxy(t.updateView,t))}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.description",{},{init:function(t,e,i){this._super(t,e,i),i=i||{},this.loadTemplates({"project-activity-description":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.description").concat("#project-activity-description")})},renderContent:function(){var t=this.getTemplate("project-activity-description");return this.content=t.render(),this.content},postRender:function(){this.description=this.getWorkitemDescription(),this.description?this.callTaskDescription():this.content=$("<div />")},callTaskDescription:function(){var t={container:$("#ui-bizagi-wp-project-activity-task_description_container",this.content),description:this.description,width:310};this.taskDescriptionWidget=new bizagi.workportal.widgets.task.description(this.workportalFacade,this.dataService,t),this.taskDescriptionWidget.render()},getWorkitemDescription:function(){for(var t=this.params||{},e=t.idWorkitem||0,i=t.currentState||[],a="",o=0;o<i.length;o++)if(e==i[o].idWorkItem){a=i[o].tskDescription;break}return a},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity.description",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.description],!0);
//# sourceMappingURL=../../../../Maps/desktop/log.desktop.production.js.map
