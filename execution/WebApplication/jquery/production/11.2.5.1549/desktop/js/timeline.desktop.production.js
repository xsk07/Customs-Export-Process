function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}
/*! */function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}$.bizagi||($.bizagi={processviewer:{}}),$.bizagi.processviewer={configuration:{constants:{ELEMENT_TYPE:{PROCESS:"Process",LANE:"Lane",MILESTONES:"Milestone",TEXTANNOTATION:"TextAnnotation",ASSOCIATION:"Association",SEQUENCEFLOW:"SequenceFlow"},CONDITION_TYPE:{SUBPROCESSEXP:"SubprocessException",CANCELLATION:"Cancellation",NORMAL:"Normal",RELATION:"Relation",COMPENSATION:"Compensation"},PROPERTIES:{WAYPOINTS:"waypoints",BOUNDS:"bounds"},LANESETS:"laneSets",LANES:"lanes",BPMNLABELSTYLES:"bpmnLabelStyles"},validTypeDefinitions:["artifacts","flowElements","laneSets","milestones"]},design:{markers:{normal:{type:"path",properties:{d:"M0.616,9.401  l2.05-4.4l-2.05-4.399l8.8,4.433L0.616,9.401",class:"normal"}},highlighted:{type:"path",properties:{d:"M0.616,9.401  l2.05-4.4l-2.05-4.399l8.8,4.433L0.616,9.401",class:"highlighted"}},selected:{type:"path",properties:{d:"M0.616,9.401  l2.05-4.4l-2.05-4.399l8.8,4.433L0.616,9.401",class:"highlighted"}},association:{type:"path",properties:{d:"M0.595,0.598  l8.8,4.132l-8.8,4.667",class:"association"}}}}},
/*! */
function(t){t.widget("ui.processviewer",{constants:t.bizagi.processviewer.configuration.constants,options:{image:null,zoomRange:50,hotspots:[],dragMessage:"Drag Image (Image Pane)",processMessage:"Process Image....",previewWidth:120,previewHeight:120,hotspotsCSS:"",draggable:!0,controls:!0,zoomImageOptions:!1,moveIncrement:20,isIE8:!1,device:"desktop",minZoom:.5,minZoomIE8:.5,maxZoomIE8:1.5,maxZoom:1.5,template:!1,unavailableImage:"img/unavailable_image.png",tmpl:"bizagi.processviewer.template",hotSpotsSVG:!1,formatStyles:{},milestonesHeight:25,width:"100%",height:150,dimentions:{width:100,height:150},animation:{path:[],interval:0,instance:0,time:200,counter:0},configuration:{localTemplate:"",processviewerStageId:"",processviewerStage:"",$processviewerStage:"",processviewerStageSet:"",processviewerImageStage:"",processviewerHotSpotsContainer:"",processviewerStagePathsSet:"",errorImageCSS:"processviewer-error-image",sliderOptions:{}},getTemplate:function(t){return bizagi.getTemplate(t)}},_create:function(){var e=this;t.support.touch="ontouchend"in document,e._isInWorkportal()?"undefined"!=typeof bizagi&&void 0!==bizagi.util&&(e.options.isIE8=bizagi.util.isIE8(),e.options.device=bizagi.util.detectDevice()):bizagi={workportal:!1},e.$el=t('<div class="wdg-processviewer"></div>'),e.$el.attr("role","widget.bizagi.processviewer"),e.element.append(e.$el),e.options.jsonBizagi?"string"==typeof e.options.jsonBizagi.processDefinition&&"string"==typeof e.options.jsonBizagi.processDefinition?t.when(t.get(e.options.jsonBizagi.processDefinition),t.get(e.options.jsonBizagi.processGraphicsInfo)).done((function(t,i){e._processDataForPlugin({definition:t[0],graphics:i[0]})})).fail((function(t){e.$el.text(t.message)})):e._processDataForPlugin({definition:e.options.jsonBizagi.processDefinition,graphics:e.options.jsonBizagi.processGraphicsInfo}):e._loadTemplate()},_processDataForPlugin:function(e){var i=this;e.definition.status||e.graphics.status?i._triggers.error({message:e.definition.message,json:e}):t.when(t(e).processviewerQueries()).done((function(e){t.extend(i.options,e),i._loadTemplate()}))},_triggerError:function(t){},_loadTemplate:function(){var e=this,i=e.options.template;bizagi.workportal?(e.loader=new bizagi.ui.controls.tmplloader,i?i.indexOf(".html")&&t.when(e.loader.loadTemplates({processviewer:i})).done((function(){e.options.configuration.localTemplate=e.loader.getTemplate("processviewer"),e._buildprocessviewer()})):(i=e.options.getTemplate(e.options.tmpl),t.when(e.loader.loadTemplates({processviewer:i})).done((function(){e.options.configuration.localTemplate=e.loader.getTemplate("processviewer"),e._buildprocessviewer()})))):i?i.indexOf(".html")&&t.when(t.get(e.options.template)).done((function(t){e.options.configuration.localTemplate=t,e._buildprocessviewer()})):(i=e.options.getTemplate(e.options.tmpl),t.when(t.get(i)).done((function(t){e.options.configuration.localTemplate=t,e._buildprocessviewer()})))},_buildprocessviewer:function(){var e,i;this.$el.empty(),e=this.options.configuration.processviewerStageId=this._generateID(),i=t.tmpl(this.options.configuration.localTemplate,{id:e,isIE8:this.options.isIE8}),this.$el.append(i),this._createStage()},resize:function(t,e){e=e||this.options.width,h=t||this.options.height,this.$el.outerWidth(e),this.$el.outerHeight(t)},calculatePosition:function(t,e,i,r){return{top:r/2-(e+45)+"px",left:i/2-(t+67.5)+"px"}},setPosition:function(e,i){var r=document.getElementById(i),n=this._getStageContainer(),s=t("#bz-gq-processviewer-canvas"),o=t(n),a=parseInt(isNaN(e.css("left").replace("px",""))?0:e.css("left").replace("px","")),l=parseInt(isNaN(e.css("top").replace("px",""))?0:e.css("top").replace("px","")),h=this.calculatePosition(a,l,s.width(),s.height());o.animate({left:h.left,top:h.top},1500,(function(){var t=!0,e=0,i=setInterval((function(){t?r.classList.remove("processviewer-shape-selected"):r.classList.add("processviewer-shape-selected"),t=!t,5==e&&clearInterval(i),e++}),400)}))},_createStage:function(){var e,i,r,n,s,o,a=this;e=a.options.width?a.options.width:"100%",i=a.options.height?a.options.height:150,a.$el.outerWidth(e),a.$el.outerHeight(i);var l=100*a.options.dimentions.width/150+a.options.dimentions.width,h=100*a.options.dimentions.height/150+a.options.dimentions.height,c=a._getStageContainer();a._ScrollZoomProcessViewer(c),a._setResetZoom(t("button#resetZoom"),c),a.options.configuration.processviewerStage=s=new Raphael(c,l,h),a.options.configuration.processviewerPathsStageGroup=s.group(),s.canvas.setAttribute("id",a._generateID()),s.canvas.setAttribute("id",a._generateID()),s.canvas.setAttribute("class","processviewer-zvg-container"),s.canvas.setAttribute("class","processviewer-zvg-nested"),a.options.configuration.processviewerStageSet=s.set(),a.options.configuration.processviewerstageHotSpotSet=s.set(),e.indexOf("%")&&(o=!0),o||a.options.dimentions.width<e?t("[data-processviewercontainer]",a.element).width("100%"):t("[data-processviewercontainer]",a.element).width(a.options.dimentions.width),a.options.dimentions.width<e&&t("[data-processviewercontainer]",a.element).width(e),a.options.image?t.when(a._verifyingImage(a.options.image)).done((function(t){r=t.width?t.width:"150",n=t.height?t.height:"150",a.options.configuration.processviewerImageStage=a.options.configuration.processviewerStage.image(t.src,0,0,r,n),a.options.configuration.processviewerStageSet.push(a.options.configuration.processviewerImageStage),a.options.configuration.processviewerRectStage.attr("fill","rgba(255,255,255,0)"),a.options.configuration.processviewerRectStage.attr("stroke","none"),a._createUIControls()})).fail((function(t){a._createUIFailView(t)})):(r=a.element.width()?a.element.width():"150",n=a.element.height()?a.element.height():"150",a.options.configuration.processviewerRectStage=a.options.configuration.processviewerStage.rect(0,0,2*e,2*i),a.options.configuration.processviewerRectStage.attr("fill","rgba(255,255,255,0)"),a.options.configuration.processviewerRectStage.attr("stroke","none"),a.options.configuration.processviewerRectStage[0].setAttribute("id","BaseStage"+a._generateID()),a._createUIControls())},_createUIControls:function(){var e=this;e.options.configuration.processviewerStage,e.options.configuration.processviewerImageStage;e.options.draggable&&e._setDraggable(),t.when(e._createSVGProcessPool(),e._createSVGLanes(),e._createSVGMilestones(),e._createSVGSequenceFlows()).done((function(){e._createStyleFormats(),e.options.isIE8||e._createMarkers(),e._addHandlers(),e._createSlider(),e.options.hotSpotsSVG?e._createSVGHotSpots():t.when(e._createHTMLHotSpots()).done((function(){e._adjustLabelsPosition();var t={type:"pvComplete",message:"processviewer complete",time:new Date,ui:e.$el};e.element.trigger(t)}))}))},_zoomProcessViewer:function(e,i){this._updateOutputSlider(i);var r=t(i).val();this.options.configuration.processviewerPathsStageGroup.scale(r),this.options.configuration.processviewerHotSpotsContainer.css("font-size",r+"em");var n=t(this.options.configuration.processviewerStage.defs);t(this.options.configuration.processviewerStage.canvas).append(n),this._updateHotSpotsScale(r),e.preventDefault(),e.stopPropagation()},calcProcessViewerTo:function(t,e,i,r){var n=t*(e-r),s=t>0?n-i+r:i-r-n;return t>0?(s<0?"":"-")+Math.abs(s):s},_ScrollZoomProcessViewer:function(e){var i=this,r=t(e).closest(".processviewer-wrapper"),n=t("input[type='range']",i.element),s=t(e),o=null;e.addEventListener("wheel",(function(t){null==o&&(o=s.find("[data-processviewerhotspots] > [data-processviewerhotspot]:first"));var e=parseInt(isNaN(s.css("left").replace("px",""))?0:s.css("left").replace("px","")),a=parseInt(isNaN(s.css("top").replace("px",""))?0:s.css("top").replace("px","")),l=Number(n.val()),h=(t.wheelDelta?t.wheelDelta:-1*t.deltaY)>=0;if(n.val(l+.1*(h?1:-1)),l!=n.val()){var c=r.offset(),u=parseInt(o.css("left").replace("px",""))+parseInt(o.css("width").replace("px",""))/2,p=parseInt(o.css("top").replace("px",""))+parseInt(o.css("height").replace("px",""))/2;i._zoomProcessViewer(t,n);var f=parseInt(o.css("left").replace("px",""))+parseInt(o.css("width").replace("px",""))/2,d=parseInt(o.css("top").replace("px",""))+parseInt(o.css("height").replace("px",""))/2,g=i.calcProcessViewerTo(f/u,t.clientX-e,t.clientX,c.left+10),v=i.calcProcessViewerTo(d/p,t.clientY-a,t.clientY,c.top+10);s.css({left:g+"px",top:v+"px"})}}))},_setResetZoom:function(e,i){var r=this;e.click((function(e){var n=t("input[type='range']",r.element);n.val(1),t(i).css({left:"0px",top:"0px"}),r._zoomProcessViewer(e,n)}))},_createSlider:function(){var e=this,i=e.validateHTML5Features.checkInput("range");if(t.support.touch||i){t(".ui-for-desktop",e.element).remove();var r=t("input[type='range']",e.element);r.attr("min",e.options.minZoom),r.attr("max",e.options.maxZoom),r.attr("step",.1),r.attr("value",1),t.support.touch&&"desktop"!==e.options.device?(r.change((function(){e._updateOutputSlider(this)})),r.bind("touchstart",(function(){t(this).prev("output").addClass("is-visible-output"),e._updateOutputSlider(this)})),r.bind("touchend",(function(){var i=t(this).val();t(this).prev("output").removeClass("is-visible-output"),e.options.configuration.processviewerPathsStageGroup.scale(i),e.options.configuration.processviewerHotSpotsContainer.css("font-size",i+"em"),e._updateHotSpotsScale(i),e._updateOutputSlider(this)}))):(r.mouseenter((function(){t(this).prev("output").addClass("is-visible-output"),e._updateOutputSlider(this)})).mouseleave((function(){t(this).prev("output").removeClass("is-visible-output")})),r.change((function(t){e._zoomProcessViewer(t,this)})))}else{t(".ui-for-touch",e.element).remove();var n=t(".processviewer-zvg-nested",e.element);n.data("real-width",n.width()),n.data("real-height",n.height());var s=function(e,i){var r=i.value||1,n='<div class="tooltip"><div class="tooltip-inner">'+(Math.round(100*r)+"%")+"</div></div>";t(".sliderTooltip").html(n)};e.options.configuration.sliderOptions={min:e.options.minZoomIE8,max:e.options.maxZoomIE8,step:.1,value:1,create:s,slide:s,stop:function(t,i){i.value>1&&(n[0].setAttribute("width",n.data("real-width")*i.value),n[0].setAttribute("height",n.data("real-height")*i.value)),e.options.configuration.processviewerPathsStageGroup.scale(i.value),e.options.configuration.processviewerHotSpotsContainer.css("font-size",i.value+"em"),e._updateHotSpotsScale(i.value),e._setDraggable()}},t("[data-processviewerslider]",e.element).slider(e.options.configuration.sliderOptions)}},_updateOutputSlider:function(e){var i=t(e);i.prev("output").text(Math.round(100*i.val())+"%")},_updateHotSpotsScale:function(e){var i=this.options.configuration.hotspotsList,r=t("[data-processviewerhotspots]",this.element),n=r;if(r.length>1){n=r[0];for(var s=1;s<r.length;s++)t(r[s]).offset().left>t(n).offset().left&&(n=r[s]);i=t(n).find(".processviewer-hotspot")}t(n).hide(),t(".processviewer-hotspot-icon svg g",this.element).each((function(){this.setAttribute("transform","scale("+e/10+")")}));for(var o=0;o<i.length;o++){var a=t(i[o]),l=a.data("real-width")*e,h=a.data("real-height")*e,c=a.data("real-left")*e,u=a.data("real-top")*e;a.outerWidth(l),a.outerHeight(h),a.css("left",c),a.css("top",u)}t(n).show()},_scaleSVG:function(){},_addHandlers:function(){var e=this;t(window).on("resize.processviewer",(function(){e._setDraggable()}))},_setDraggable:function(){if(t.support.touch&&"desktop"!==this.options.device){var e=this.options.configuration.processviewerPathsStageGroup.getScale(),i=this.options.configuration.processviewerStage.canvas.getAttribute("width")*e,r=this.options.configuration.processviewerStage.canvas.getAttribute("height")*e;t(".processviewer-wrapper",this.element).addClass("ui-scroll-touch"),t("[data-processviewercontainer]",this.element).width(i),t("[data-processviewercontainer]",this.element).height(r)}else{this.options.configuration.$processviewerStage=t(this.options.configuration.processviewerStage.canvas).parent();var n=t("[data-processviewercontainer]",this.element).position();if(n){e=this.options.configuration.processviewerPathsStageGroup.getScale();var s=this.element.width(),o=this.element.height();i=this.options.configuration.processviewerStage.width*e,r=this.options.configuration.processviewerStage.height*e;maxleft=n.left,maxTop=n.top;var a=t("[data-processviewer-wrapper-container]",this.element).is(":ui-draggable");s<i||o<r?a||(this.$el.addClass(" processviewer-drag"),this._dragLimits(),this.options.configuration.$processviewerStage.draggable({refreshPositions:!0,drag:function(t,e){}})):a&&(this.options.configuration.$processviewerStage.draggable("destroy"),this.element.removeClass("processviewer-drag"),this.options.configuration.$processviewerStage.css({left:0,top:0}),this.options.configuration.processviewerHotSpotsContainer.css({left:0,top:0}))}}},_dragLimits:function(){var t=this.options.configuration.processviewerPathsStageGroup.getScale(),e=this.element.width(),i=this.element.height(),r=this.options.configuration.processviewerStage.width*t,n=this.options.configuration.processviewerStage.height*t,s=0,o=0;return e<r&&(s=e-r),i<n&&(o=i-n),{x:s,y:o}},_movePaths:function(t,e){this.options.configuration.processviewerStage.move(t,e)},_createMarkers:function(){var e=t.bizagi.processviewer.design.markers;if(e)for(var i in e){var r=e[i].properties,n={id:i,css:i,markerHeight:10,markerWidth:10,refX:10,refY:5,orient:"auto"},s=this.options.configuration.processviewerStage.marker();t(s.node).attrSVG(n),t(s.node.lastElementChild).attrSVG(r),this.options.configuration.processviewerMarkerEndArrow||(this.options.configuration.processviewerMarkerEndArrow=[]),this.options.configuration.processviewerMarkerEndArrow.push(s)}},_createStyleFormats:function(){var e=this.options.formatStyles,i=t("<div></div>"),r="<style>";for(var n in e){var s="."+n.toLowerCase()+"{";i.css(e[n].css),r+=s+=i.attr("style")+"}"}r+="</style>",t("head").append(t(r))},_asignLabelFormat:function(e,i){if(i.bpmnLabel&&i.bpmnLabel.labelStyle){var r=i.bpmnLabel.labelStyle,n=this.options.formatStyles[r];t(e).closest("svg").length>0&&t(e).css(n.css);var s=n.cssClass;s.push(r);for(var o=0;o<s.length;o++)t(e).addClass(s[o].toLowerCase())}},_createSVGProcessPool:function(){for(var t=[],e=this.options.configuration.processviewerPathsStageGroup,i=this.options.hotspots.length-1;i>=0;i--)this.options.hotspots[i].elementType===this.constants.ELEMENT_TYPE.PROCESS&&(t.push(this.options.hotspots[i]),this.options.hotspots.splice(i,1));this._createSVGRect(e,t,"processPool")},_createSVGLanes:function(){for(var t=[],e=this.options.configuration.processviewerPathsStageGroup,i=this.options.hotspots.length-1;i>=0;i--)this.options.hotspots[i].elementType===this.constants.ELEMENT_TYPE.LANE&&(t.push(this.options.hotspots[i]),this.options.hotspots.splice(i,1));this._createSVGRect(e,t,"lanes")},_createSVGMilestones:function(){for(var t=[],e=this.options.configuration.processviewerPathsStageGroup,i=this.options.hotspots.length-1;i>=0;i--)this.options.hotspots[i].elementType===this.constants.ELEMENT_TYPE.MILESTONES&&(t.push(this.options.hotspots[i]),this.options.hotspots.splice(i,1));this._createSVGRect(e,t,"milestones")},_createSVGSequenceFlows:function(){for(var t=[],e=this.options.configuration.processviewerPathsStageGroup,i=this.options.hotspots.length-1;i>=0;i--)this.options.hotspots[i].elementType!==this.constants.ELEMENT_TYPE.SEQUENCEFLOW&&this.options.hotspots[i].elementType!==this.constants.ELEMENT_TYPE.ASSOCIATION||!this.options.hotspots[i].hasOwnProperty(this.constants.PROPERTIES.WAYPOINTS)||(t.push(this.options.hotspots[i]),this.options.hotspots[i].conditionType===this.constants.CONDITION_TYPE.NORMAL&&this.options.hotspots.splice(i,1));this._createSVGPaths(e,t)},_createSVGRect:function(e,i,r){for(var n,s=0;s<i.length;s++){var o=i[s];if(void 0===o[this.constants.PROPERTIES.BOUNDS])console.log(o);else{var a=o[this.constants.PROPERTIES.BOUNDS],l=e.rect(a.x,a.y,a.width,a.height);if(o.bpmnElementRef?l[0].setAttribute("id",o.bpmnElementRef):o.bpmnElement&&o.bpmnElement.baref&&o.bpmnElement.baref.ref&&l[0].setAttribute("id",o.bpmnElement.baref.ref),""===o.displayName&&(o.displayName="Lane"),null===o.displayName&&(o.displayName=" "),o.displayName&&(n=e.text(a.height/2*-1,10,o.displayName)),o.elementType===this.constants.ELEMENT_TYPE.PROCESS&&(n.attr({"font-weight":"600",y:o.bounds.y+a.height/2,x:10}).data("rotation",-90),n.transform("r-90")),o.elementType===this.constants.ELEMENT_TYPE.MILESTONES){n.attr({"font-weight":"600",y:o.bounds.y+16,x:o.bounds.x+a.width/2}),l.attr("height",this.options.milestonesHeight);var h=o.bounds.x+o.bounds.width,c=o.bounds.y+this.options.milestonesHeight,u=o.bounds.height,p=this._getPathString([{x:h,y:c},{x:h,y:u}]);e.path(p).attr({stroke:"#CCC","stroke-dasharray":"--"});var f=h-1,d=this._getPathString([{x:f,y:o.bounds.y},{x:f+this.options.milestonesHeight,y:this.options.milestonesHeight/2},{x:f,y:this.options.milestonesHeight}]);e.path(d).attr({stroke:"#CCC",fill:"#FFF"})}if(o.elementType===this.constants.ELEMENT_TYPE.LANE){t(n.node).width(),o.bounds.height,t(n.node).height();n.attr({y:o.bounds.y+o.bounds.height/2,x:o.bounds.x+10,"font-weight":"600"}).data("rotation",-90),n.transform("r-90");var g=o.bounds.x+30,v=o.bounds.height,m=this._getPathString([{x:g,y:o.bounds.y+25},{x:g,y:v}]);e.path(m).attr({stroke:"#E6E6E6",fill:"none"})}t(l[0]).attr("id")&&o.displayName&&t(n[0]).data("id",o.id),l.attr({stroke:"#E6E6E6",fill:"none"}),this._asignLabelFormat(n[0],o)}}},_createSVGPaths:function(e,i){for(var r=0;r<i.length;r++){var n=i[r];if(void 0===n[this.constants.PROPERTIES.WAYPOINTS])console.log(n);else{var s=!1;n.elementType!==this.constants.ELEMENT_TYPE.TEXTANNOTATION&&n.conditionType!==this.constants.CONDITION_TYPE.RELATION&&n.conditionType!==this.constants.CONDITION_TYPE.COMPENSATION&&(s=!0);var o=this._getPathString(n[this.constants.PROPERTIES.WAYPOINTS]);o+=this.options.isIE8&&s?this._getArrowPathString(n[this.constants.PROPERTIES.WAYPOINTS]):"";var a=e.path(o);n.bpmnElementRef?a[0].setAttribute("id",n.bpmnElementRef):n.bpmnElement&&n.bpmnElement.baref&&n.bpmnElement.baref.ref&&a[0].setAttribute("id",n.bpmnElement.baref.ref),s&&t(a.node).setMarkerSVG("normal");var l=a.getTotalLength()/2,h=a.getPointAtLength(l);n.displayName&&(nText=e.text(h.x,h.y,n.displayName)),t(a[0]).attr("id")&&n.displayName&&t(nText[0]).data("id",n.id),n.conditionType!==this.constants.CONDITION_TYPE.RELATION&&n.conditionType!==this.constants.CONDITION_TYPE.COMPENSATION||a.attr({"stroke-dasharray":".","stroke-width":"2"}),this._asignLabelFormat(a[0],n)}}},_createHTMLHotSpots:function(){for(var e=this,i=[],r=e.options.hotspots,n=e.options.configuration.processviewerHotSpotsContainer=t('<div class="processviewer-hotspots-container" data-processviewerhotspots style="position:absolute;"></div>'),s=0;s<r.length;s++){var o=r[s];if(o.bounds||o.x){o.number=s;var a=e._createHotSpotDiv(o);i.push(a),n.append(a)}}t("[data-processviewer-wrapper-container]",e.element).prepend(n),n.on("click",".processviewer-hotspot",(function(i){var r=t(this).data("number"),n=t(this);e.options.hotspots[r].onClick&&e.options.hotspots[r].onClick(i,n),e._triggers.click.apply(n,[e.element])})),n.on("mouseenter",".processviewer-hotspot",(function(i){var r=t(this).data("number"),n=t(this);e.options.hotspots[r].onMouseOver&&e.options.hotspots[r].onMouseOver(i,n),e._triggers.onMouseOver.apply(n,[e.element])})),n.on("mouseout",".processviewer-hotspot",(function(i){var r=t(this).data("number"),n=t(this);e.options.hotspots[r].onMouseOut&&e.options.hotspots[r].onMouseOut(i,n),e._triggers.onMouseOut.apply(n,[e.element])})),e.options.configuration.hotspotsList=t(".processviewer-hotspot",e.element)},_createHotSpotDiv:function(e){var i=t('<div class="processviewer-hotspot processviewer-hotspot-div" data-processviewerhotspot></div>'),r=t('<div class="processviewer-hotspot-label" data-processviewerlabel></div>'),n=this._getHotSpotData(e);return i.outerWidth(n.w),i.outerHeight(n.h),i.css("left",n.x+"px"),i.css("top",n.y+"px"),i.data("number",e.number),i.attr("number",e.number),e.bounds&&(i.data("real-width",e.bounds.width),i.data("real-height",e.bounds.height),i.data("real-left",e.bounds.x),i.data("real-top",e.bounds.y)),e.displayName&&e.elementType!==this.constants.ELEMENT_TYPE.SEQUENCEFLOW&&(r.text(e.displayName),i.append(r)),e.elementType&&this._createIconsForHotSpots(i,e),e.text&&e.text.content&&(r.text(e.text.content),i.append(r)),e.dataState&&e.dataState.displayName&&(r.text(e.dataState.displayName),i.append(r)),e.radius&&i.css("border-radius",e.radius),e.css&&i.addClass(e.css),e.loopCharacteristics&&(e.loopCharacteristics.isSequential?i.addClass("issequential"):e.loopCharacteristics.isSequential||i.addClass("isparallel")),this._asignLabelFormat(r[0],e),e.elementType&&i.addClass(e.elementType.toLowerCase()),e.conditionType&&i.addClass(e.conditionType.toLowerCase()),e.eventType&&i.addClass(e.eventType.toLowerCase()),e.subProcessType&&i.addClass(e.subProcessType.toLowerCase()),e.isForCompensation&&i.addClass("isforcompensation"),e.bpmnElementRef?i.attr("id",e.bpmnElementRef):e.bpmnElement&&e.bpmnElement.baref&&e.bpmnElement.baref.ref&&i.attr("id",e.bpmnElement.baref.ref),e.content&&i.append(e.content),i},_createIconsForHotSpots:function(e,i){var r=i.elementType.toLowerCase(),n=t('<div class="processviewer-hotspot-icon" data-processviewericon></div>');if(e.append(n),t.bizagi.processviewer.design.icons){var s=t.bizagi.processviewer.design.icons.scale,o=t.bizagi.processviewer.design.icons.bounds.width*s,a=t.bizagi.processviewer.design.icons.bounds.height*s,l=new Raphael(n[0],o,a).group();i.isForCompensation&&(r="isforcompensation");var h=t.bizagi.processviewer.design.icons.iconset[r];if(h){svgTmp=h.svg;for(var c=0;c<svgTmp.length;c++){var u=svgTmp[c],p=l[u.type]();for(var f in s<1&&l.node.setAttribute("transform","scale("+s+")"),u.properties)p[0].setAttribute(f,u.properties[f])}}}},_getPathString:function(t){for(var e="",i=0;i<t.length;i++)0===i&&(e+="M"),i>0&&(e+="L"),e+=t[i].x+",",e+=t[i].y+",";return e},_getArrowPathString:function(t){var e=t[t.length-1],i=t[t.length-2],r=i.x,n=e.x,s=i.y,o=e.y,a=Raphael.angle(n,o,r,s),l=Raphael.rad(a-135),h=Raphael.rad(a+135);return"M"+n+","+o+",L"+(n+10*Math.cos(l))+","+(o+10*Math.sin(l))+",M"+n+","+o+",L"+(n+10*Math.cos(h))+","+(o+10*Math.sin(h))},_getHotSpotData:function(t){var e={x:0,y:0,w:0,h:0};return t.x?e.x=t.x:t.bounds.x&&(e.x=t.bounds.x),t.y?e.y=t.y:t.bounds.y&&(e.y=t.bounds.y),t.w?e.w=t.w:t.bounds.width&&(e.w=t.bounds.width),t.h?e.h=t.h:t.bounds.height&&(e.h=t.bounds.height),e},_createSVGHotSpots:function(){for(var t=this.options.hotspots,e=0;e<t.length;e++){var i=t[e],r=this.options.configuration.processviewerStage.rect(i.x,i.y,50,50);r.id=i.id,"function"==typeof i.onClick?r.click(i.onClick):r.click(this._triggers.click);var n=this._triggers.onMouseOver,s=this._triggers.onMouseOut;"function"==typeof i.onMouseOver&&(n=i.onMouseOver),"function"==typeof i.onMouseOut&&(s=i.onMouseOut),r.hover(n,s),r.node.id=i.id,r.node.class=i.css,this.options.configuration.processviewerstageHotSpotSet.push(r)}this.options.configuration.processviewerStageSet.push(this.options.configuration.processviewerstageHotSpotSet)},_triggers:{click:function(e){var i={type:"pvClick",message:"hotspot clicked",time:new Date,ui:{control:this,id:t(this).attr("id")}};e.trigger(i)},onMouseOver:function(e){var i={type:"pvMouseIn",message:"hotspot mouse in",time:new Date,ui:{control:this,id:t(this).attr("id")}};e.trigger(i)},onMouseOut:function(e){var i={type:"pvMouseOut",message:"hotspot mouse out",time:new Date,ui:{control:this,id:t(this).attr("id")}};e.trigger(i)},error:function(e){var i={type:"pvError",time:new Date};t.extend(e,i),t.event.trigger(e)}},_createUIFailView:function(e){var i=t('<div class="'+this.options.configuration.errorImageCSS+' svg-error-content"><div class="processviewer-absolute-center"><img src="'+this.options.unavailableImage+'" class="processviewer-absolute-center"/></div><span class="processviewer-message">'+e+"</span></div>");t("[data-processviewercontainer]",this.element).append(i)},_verifyingImage:function(e){var i=t.Deferred(),r=document.createElement("img");return r.onload=function(){i.resolve(r)},r.onerror=function(){i.reject(e)},r.src=e,i.promise()},_getStageContainer:function(e){return t("[data-processviewer-wrapper-container]",this.element)[0]},_generateID:function(){var e=(new Date).getTime(),i="processviewer-xxxxxxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:7&i|8).toString(16)}));return t("#"+i).length>0?this._generateID():i},_adjustLabelsPosition:function(){for(var e=t(".processviewer-hotspot-label",this.element),i=(e.closest(".processviewer-hotspot"),0);i<e.length;i++){var r=t(e[i]),n=r.closest(".processviewer-hotspot"),s=n.outerHeight();if(n.hasClass("subprocess")||n.hasClass("callactivity")||n.hasClass("dataobject")){var o=t._ptToem(s+10);r.css({paddingTop:o})}else this.options.isIE8&&r.css({paddingTop:"1.8em"})}},_setOption:function(t,e){this.options[t]=e,this._update()},_update:function(){var t=this.options.value+"%";this.element.text(t),100===this.options.value&&this._trigger("complete",null,{value:100})},_destroy:function(){this.element.empty().removeAttr("style","").removeAttr("role",""),clearInterval(this.options.animation.interval)},_getSelectedClassCSSByWorkitemState:function(t,e){var i;e&&e.filter&&(i=e.filter((function(e){return e.guidTask===t})));var r="processviewer-shape-selected";return i&&i.length>0&&14==i[0].wiState&&(r="processviewer-shape-selected-standby"),r},selectShape:function(e,i){for(var r=t.isArray(e)?e:[e],n=0,s=r.length;n<s;n++){var o=t("#"+r[n],this.$el);if(o.length){var a=this._getSelectedClassCSSByWorkitemState(r[n],i);"div"!==o.prop("tagName").toLowerCase()?(o.addClassSVG(a),o.setMarkerSVG("selected")):o.addClass(a)}}},unSelectShape:function(e,i){for(var r=t.isArray(e)?e:[e],n=0,s=r.length;n<s;n++){var o=t("#"+r[n],this.$el),a=o.prop("tagName").toLowerCase(),l=this._getSelectedClassCSSByWorkitemState(r[n],i);"div"!==a?(o.removeClassSVG(l),o.reverseMarkerSVG()):o.removeClass(l)}},unSelectAllShapes:function(){for(var e=t(".processviewer-shape-selected",this.$el),i=0;i<e.length;i++){var r=t(e[i]);"div"!==r.prop("tagName").toLowerCase()?(r.removeClassSVG("processviewer-shape-selected"),r.reverseMarkerSVG()):r.removeClass("processviewer-shape-selected")}},drawRoute:function(e){for(var i=[],r=0;r<e.length;r++){var n=t("#"+e[r],this.$el);if(n.length>0)"div"!==n.prop("tagName").toLowerCase()?(n.addClassSVG("processviewer-highlighted"),n.setMarkerSVG("highlighted")):n.addClass("processviewer-highlighted");else i.push(e[r])}this._triggers.error({message:"Doesn't find element",ui:i})},animateRoute:function(e){this.option.counter;t.isArray(e)&&(this.options.animation.counter=0,this.options.animation.path=e,this.options.animation.status=0),0===this.options.animation.status?this._startRouteAnimation():this._stopRouteAnimation()},_startRouteAnimation:function(){var e=this,i=e.options.animation.path;e.options.animation.status=1,0===e.options.animation.counter&&e.clearRoute(),e.options.animation.interval=setInterval((function(){if(e.options.animation.counter<i.length){var r=t("[id="+i[e.options.animation.counter]+"]",e.$el).last();if(r.length>0)"div"!==r.prop("tagName").toLowerCase()?(r.addClassSVG("processviewer-highlighted"),r.setMarkerSVG("highlighted"),r[0].strokecolor="#FF7F00"):r.addClass("processviewer-highlighted");e.options.animation.counter++}else e.element.trigger({type:"animationComplete",message:"animation end!",time:new Date,ui:e.$el}),e.options.animation.counter=0,e._stopRouteAnimation()}),e.options.animation.time)},_stopRouteAnimation:function(){this.options.animation.status=0,clearInterval(this.options.animation.interval)},_isInWorkportal:function(){var t=!1;return"undefined"!=typeof bizagi&&void 0!==bizagi.workportal&&(t=!0),t},clearRoute:function(){for(var e=t(".processviewer-highlighted",this.$el),i=0;i<e.length;i++){var r=t(e[i]);"div"!==r.prop("tagName").toLowerCase()?(r.removeClassSVG("processviewer-highlighted"),r[0].strokecolor="#000",r.reverseMarkerSVG()):r.removeClass("processviewer-highlighted")}},validateHTML5Features:{checkInput:function(t){var e=document.createElement("input");return e.setAttribute("type",t),e.type==t}}}),t.fn.addClassSVG=function(e){var i=arguments[0];return e=t.extend({},t.fn.addClassSVG.config,e),this.each((function(){var t=this.getAttribute("class"),e="";null===t&&(t=""),"string"==typeof i&&-1===t.indexOf(i)&&(e=t+" "+i,this.setAttribute("class",e))}))},t.fn.addClassSVG.config={},t.fn.setMarkerSVG=function(e){var i="url(#"+arguments[0]+")";return e=t.extend({},t.fn.addClassSVG.config,e),this.each((function(){var t=this.getAttribute("marker-end");t!=i&&(this.setAttribute("marker-end",i),this.setAttribute("toggle-marker-end",t))}))},t.fn.reverseMarkerSVG=function(){return this.each((function(){var t=this.getAttribute("marker-end"),e=this.getAttribute("toggle-marker-end");null!==e&&null!==t&&(this.setAttribute("marker-end",e),this.removeAttribute("toggle-marker-end"))}))},t.fn.removeClassSVG=function(e){var i=arguments[0];return e=t.extend({},t.fn.addClassSVG.config,e),this.each((function(){var t=this.getAttribute("class"),e="";null!==t&&"string"==typeof i&&-1!==t.indexOf(i)&&(e=t.replace(i,"").replace("  "," "),this.setAttribute("class",e))}))},t.fn.removeClassSVG.config={},t.fn.hasClassSVG=function(t){var e=arguments[0],i=this[0],r=i.getAttribute("class"),n=!1;return null!==r&&"string"==typeof e&&-1!==r.indexOf(e)&&(n=!0),n},t.fn.attrSVG=function(t){var e=this[0];for(var i in t)e.setAttribute(i,t[i]);return e},t._ptToem=function(t,e){return e||(e=12),t/e+"em"}}(jQuery),function(t){t.fn.processviewerQueries=function(){this.css("color","green");var e=this;return e.data=this[0],e.internalDataSource={elements:[]},e.datasource={hotspots:[],formatStyles:[]},e.deferred=t.Deferred(),e.padding=80,e.typeDefinitions=t.bizagi.processviewer.configuration.validTypeDefinitions,e.constants=t.bizagi.processviewer.configuration.constants,this.methods={init:function(){var e=this,i=t.Deferred();return e.typeDefinitions.unshift("owner"),e.data.definition.owner={processType:e.data.definition.processType,elementType:e.data.definition.elementType,displayName:e.data.definition.displayName,id:e.data.definition.id},t.when(e.methods.processElements.apply(e,[])).done((function(){i.resolve(e.datasource)})),i.promise()},processElements:function(){var e=[];for(var i in this.data.definition){var r=this.data.definition[i];if(this.methods.validateKindObject.apply(this,[i]))if(i===this.constants.LANESETS){if(r){var n=this.methods.getLanesFromLaneSet.apply(this,[r]);e=e.concat(n)}}else e=e.concat(r)}this.internalDataSource.elements=this.internalDataSource.elements.concat(e);for(var s=0;s<this.internalDataSource.elements.length;s++){var o=this.internalDataSource.elements[s].id,a=this.methods.getElementGraphicDataById.apply(this,[o]);if(a){var l=t.extend({},a,this.internalDataSource.elements[s]);this.datasource.hotspots.push(l)}}this.datasource.dimentions=this.methods._getMaxDimentions.apply(this,[]),this.datasource.formatStyles=this.methods.getStylesFormat.apply(this,[])},getStylesFormat:function(){var e,i={};if(this.data.graphics[this.constants.BPMNLABELSTYLES]){e=this.data.graphics[this.constants.BPMNLABELSTYLES];for(var r=0;r<e.length;r++){var n=e[r],s=n.font.size?t._ptToem(n.font.size):"1em";i[n.id]={css:{fontFamily:n.font.name||"Arial",fontSize:s,fontWeight:n.font.isBold?"bold":"normal",fontStyle:n.font.isItalic?"italic":"normal",color:n.font.color||"Black"},cssClass:["alignment-"+n.alignment]}}}return i},_getMaxDimentions:function(){var t,e=0,i=0,r=[];for(var n in this.data.definition){var s=this.data.definition[n];n===this.constants.LANESETS&&s&&(r=this.methods.getLanesFromLaneSet.apply(this,[s]))}for(var o=0;o<r.length;o++)r[o].id&&(t=this.methods.getElementGraphicDataById.apply(this,[r[o].id])),"object"===_typeof(t)&&(e<t.bounds.width&&(e=t.bounds.width+this.padding),i+=t.bounds.height+this.padding);return{width:e,height:i}},_ptToEM:function(t){return t/e.pixelFontSize},getElementGraphicDataById:function(t){for(var e,i=this.data.graphics.bpmnPlane.diagramElements,r=0;r<i.length;r++){var n=this.methods.hasReferenceId(i[r]);if(n&&(localID=n,localID===t)){e=i[r];break}}return e},getLanesFromLaneSet:function(t){for(var e=[],i=0;i<t.length;i++)e=e.concat(t[i].lanes);return e},validateKindObject:function(t){for(var e=!1,i=0;i<this.typeDefinitions.length;i++)if(this.typeDefinitions[i]===t){e=!0;break}return e},hasReferenceId:function(t){var e=!1;return t.bpmnElement?t.bpmnElement.baref&&t.bpmnElement.baref.ref&&(e=t.bpmnElement.baref.ref):t.bpmnElementRef&&(e=t.bpmnElementRef),e}},this.methods.init.apply(this,[])}}(jQuery),
/*!
             * jQuery UI Touch Punch 0.2.2
             *
             * Copyright 2011, Dave Furfero
             * Dual licensed under the MIT or GPL Version 2 licenses.
             *
             * Depends:
             *  jquery.ui.widget.js
             *  jquery.ui.mouse.js
             */
function(t){if(t.support.touch="ontouchend"in document,t.support.touch){var e,i=t.ui.mouse.prototype,r=i._mouseInit;i._touchStart=function(t){!e&&this._mouseCapture(t.originalEvent.changedTouches[0])&&(e=!0,this._touchMoved=!1,n(t,"mouseover"),n(t,"mousemove"),n(t,"mousedown"))},i._touchMove=function(t){e&&(this._touchMoved=!0,n(t,"mousemove"))},i._touchEnd=function(t){e&&(n(t,"mouseup"),n(t,"mouseout"),this._touchMoved||n(t,"click"),e=!1)},i._mouseInit=function(){this.element.bind("touchstart",t.proxy(this,"_touchStart")).bind("touchmove",t.proxy(this,"_touchMove")).bind("touchend",t.proxy(this,"_touchEnd")),r.call(this)}}function n(t,e){if(!(t.originalEvent.touches.length>1)){t.preventDefault();var i=t.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(e,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(r)}}}(jQuery),function(t){var e,i,r="0.4.2",n="hasOwnProperty",s=/[\.\/]/,o=function(){},a=function(t,e){return t-e},l={n:{}},h=function t(r,n){r=String(r);var s,o=i,l=Array.prototype.slice.call(arguments,2),h=t.listeners(r),c=0,u=[],p={},f=[],d=e;e=r,i=0;for(var g=0,v=h.length;g<v;g++)"zIndex"in h[g]&&(u.push(h[g].zIndex),h[g].zIndex<0&&(p[h[g].zIndex]=h[g]));for(u.sort(a);u[c]<0;)if(s=p[u[c++]],f.push(s.apply(n,l)),i)return i=o,f;for(g=0;g<v;g++)if("zIndex"in(s=h[g]))if(s.zIndex==u[c]){if(f.push(s.apply(n,l)),i)break;do{if((s=p[u[++c]])&&f.push(s.apply(n,l)),i)break}while(s)}else p[s.zIndex]=s;else if(f.push(s.apply(n,l)),i)break;return i=o,e=d,f.length?f:null};h._events=l,h.listeners=function(t){var e,i,r,n,o,a,h,c,u=t.split(s),p=l,f=[p],d=[];for(n=0,o=u.length;n<o;n++){for(c=[],a=0,h=f.length;a<h;a++)for(i=[(p=f[a].n)[u[n]],p["*"]],r=2;r--;)(e=i[r])&&(c.push(e),d=d.concat(e.f||[]));f=c}return d},h.on=function(t,e){if(t=String(t),"function"!=typeof e)return function(){};for(var i=t.split(s),r=l,n=0,a=i.length;n<a;n++)r=(r=r.n).hasOwnProperty(i[n])&&r[i[n]]||(r[i[n]]={n:{}});for(r.f=r.f||[],n=0,a=r.f.length;n<a;n++)if(r.f[n]==e)return o;return r.f.push(e),function(t){+t==+t&&(e.zIndex=+t)}},h.f=function(t){var e=[].slice.call(arguments,1);return function(){h.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},h.stop=function(){i=1},h.nt=function(t){return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(e):e},h.nts=function(){return e.split(s)},h.off=h.unbind=function(t,e){if(t){var i,r,o,a,c,u,p,f=t.split(s),d=[l];for(a=0,c=f.length;a<c;a++)for(u=0;u<d.length;u+=o.length-2){if(o=[u,1],i=d[u].n,"*"!=f[a])i[f[a]]&&o.push(i[f[a]]);else for(r in i)i[n](r)&&o.push(i[r]);d.splice.apply(d,o)}for(a=0,c=d.length;a<c;a++)for(i=d[a];i.n;){if(e){if(i.f){for(u=0,p=i.f.length;u<p;u++)if(i.f[u]==e){i.f.splice(u,1);break}!i.f.length&&delete i.f}for(r in i.n)if(i.n[n](r)&&i.n[r].f){var g=i.n[r].f;for(u=0,p=g.length;u<p;u++)if(g[u]==e){g.splice(u,1);break}!g.length&&delete i.n[r].f}}else for(r in delete i.f,i.n)i.n[n](r)&&i.n[r].f&&delete i.n[r].f;i=i.n}}else h._events=l={n:{}}},h.once=function(t,e){return h.on(t,(function i(){return h.unbind(t,i),e.apply(this,arguments)}))},h.version=r,h.toString=function(){return"You are running Eve "+r},"undefined"!=typeof module&&module.exports?module.exports=h:t.eve=h}(this),function(t,e){!function(t,e){function i(t){if(i.is(t,"function"))return x?t():e.on("raphael.DOMload",t);if(i.is(t,W))return i._engine.create[A](i,t.splice(0,3+i.is(t[0],j))).add(t);var r=Array.prototype.slice.call(arguments,0);if(i.is(r[r.length-1],"function")){var n=r.pop();return x?n.call(i._engine.create[A](i,r)):e.on("raphael.DOMload",(function(){n.call(i._engine.create[A](i,r))}))}return i._engine.create[A](i,arguments)}function r(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var i in t)t[k](i)&&(e[i]=r(t[i]));return e}function n(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return t.push(t.splice(i,1)[0])}function s(t,e,i){return function r(){var s=Array.prototype.slice.call(arguments,0),o=s.join("␀"),a=r.cache=r.cache||{},l=r.count=r.count||[];return a[k](o)?(n(l,o),i?i(a[o]):a[o]):(l.length>=1e3&&delete a[l.shift()],l.push(o),a[o]=t[A](e,s),i?i(a[o]):a[o])}}function o(){return this.hex}function a(t,e){for(var i=[],r=0,n=t.length;n-2*!e>r;r+=2){var s=[{x:+t[r-2],y:+t[r-1]},{x:+t[r],y:+t[r+1]},{x:+t[r+2],y:+t[r+3]},{x:+t[r+4],y:+t[r+5]}];e?r?n-4==r?s[3]={x:+t[0],y:+t[1]}:n-2==r&&(s[2]={x:+t[0],y:+t[1]},s[3]={x:+t[2],y:+t[3]}):s[0]={x:+t[n-2],y:+t[n-1]}:n-4==r?s[3]=s[2]:r||(s[0]={x:+t[r],y:+t[r+1]}),i.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return i}function l(t,e,i,r,n){return t*(t*(-3*e+9*i-9*r+3*n)+6*e-12*i+6*r)-3*e+3*i}function h(t,e,i,r,n,s,o,a,h){null==h&&(h=1);for(var c=(h=h>1?1:h<0?0:h)/2,u=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],p=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],f=0,d=0;d<12;d++){var g=c*u[d]+c,v=l(g,t,i,n,o),m=l(g,e,r,s,a),y=v*v+m*m;f+=p[d]*D.sqrt(y)}return c*f}function c(t,e,i,r,n,s,o,a){if(!(F(t,i)<V(n,o)||V(t,i)>F(n,o)||F(e,r)<V(s,a)||V(e,r)>F(s,a))){var l=(t-i)*(s-a)-(e-r)*(n-o);if(l){var h=((t*r-e*i)*(n-o)-(t-i)*(n*a-s*o))/l,c=((t*r-e*i)*(s-a)-(e-r)*(n*a-s*o))/l,u=+h.toFixed(2),p=+c.toFixed(2);if(!(u<+V(t,i).toFixed(2)||u>+F(t,i).toFixed(2)||u<+V(n,o).toFixed(2)||u>+F(n,o).toFixed(2)||p<+V(e,r).toFixed(2)||p>+F(e,r).toFixed(2)||p<+V(s,a).toFixed(2)||p>+F(s,a).toFixed(2)))return{x:h,y:c}}}}function u(t,e,r){var n=i.bezierBBox(t),s=i.bezierBBox(e);if(!i.isBBoxIntersect(n,s))return r?0:[];for(var o=h.apply(0,t),a=h.apply(0,e),l=F(~~(o/5),1),u=F(~~(a/5),1),p=[],f=[],d={},g=r?0:[],v=0;v<l+1;v++){var m=i.findDotsAtSegment.apply(i,t.concat(v/l));p.push({x:m.x,y:m.y,t:v/l})}for(v=0;v<u+1;v++)m=i.findDotsAtSegment.apply(i,e.concat(v/u)),f.push({x:m.x,y:m.y,t:v/u});for(v=0;v<l;v++)for(var y=0;y<u;y++){var x=p[v],b=p[v+1],w=f[y],_=f[y+1],S=G(b.x-x.x)<.001?"y":"x",k=G(_.x-w.x)<.001?"y":"x",C=c(x.x,x.y,b.x,b.y,w.x,w.y,_.x,_.y);if(C){if(d[C.x.toFixed(4)]==C.y.toFixed(4))continue;d[C.x.toFixed(4)]=C.y.toFixed(4);var E=x.t+G((C[S]-x[S])/(b[S]-x[S]))*(b.t-x.t),T=w.t+G((C[k]-w[k])/(_[k]-w[k]))*(_.t-w.t);E>=0&&E<=1.001&&T>=0&&T<=1.001&&(r?g++:g.push({x:C.x,y:C.y,t1:V(E,1),t2:V(T,1)}))}}return g}function p(t,e,r){t=i._path2curve(t),e=i._path2curve(e);for(var n,s,o,a,l,h,c,p,f,d,g=r?0:[],v=0,m=t.length;v<m;v++){var y=t[v];if("M"==y[0])n=l=y[1],s=h=y[2];else{"C"==y[0]?(f=[n,s].concat(y.slice(1)),n=f[6],s=f[7]):(f=[n,s,n,s,l,h,l,h],n=l,s=h);for(var x=0,b=e.length;x<b;x++){var w=e[x];if("M"==w[0])o=c=w[1],a=p=w[2];else{"C"==w[0]?(d=[o,a].concat(w.slice(1)),o=d[6],a=d[7]):(d=[o,a,o,a,c,p,c,p],o=c,a=p);var _=u(f,d,r);if(r)g+=_;else{for(var S=0,k=_.length;S<k;S++)_[S].segment1=v,_[S].segment2=x,_[S].bez1=f,_[S].bez2=d;g=g.concat(_)}}}}}return g}function f(t,e,i,r,n,s){null!=t?(this.a=+t,this.b=+e,this.c=+i,this.d=+r,this.e=+n,this.f=+s):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function d(){return this.x+I+this.y+I+this.width+" × "+this.height}function g(t,e,i,r,n,s){function o(t){return((h*t+l)*t+a)*t}var a=3*e,l=3*(r-e)-a,h=1-a-l,c=3*i,u=3*(n-i)-c,p=1-c-u;return function(t,e){var i=function(t,e){var i,r,n,s,c,u;for(n=t,u=0;u<8;u++){if(s=o(n)-t,G(s)<e)return n;if(G(c=(3*h*n+2*l)*n+a)<1e-6)break;n-=s/c}if(r=1,(n=t)<(i=0))return i;if(n>r)return r;for(;i<r;){if(s=o(n),G(s-t)<e)return n;t>s?i=n:r=n,n=(r-i)/2+i}return n}(t,e);return((p*i+u)*i+c)*i}(t,1/(200*s))}function v(t,e){var i=[],r={};if(this.ms=e,this.times=1,t){for(var n in t)t[k](n)&&(r[K(n)]=t[n],i.push(K(n)));i.sort(ct)}this.anim=r,this.top=i[i.length-1],this.percents=i}function m(t,r,n,s,o,a){n=K(n);var l,h,c,u,p,d,v=t.ms,m={},y={},x={};if(s)for(_=0,S=se.length;_<S;_++){var b=se[_];if(b.el.id==r.id&&b.anim==t){b.percent!=n?(se.splice(_,1),c=1):h=b,r.attr(b.totalOrigin);break}}else s=+y;for(var _=0,S=t.percents.length;_<S;_++){if(t.percents[_]==n||t.percents[_]>s*t.top){n=t.percents[_],p=t.percents[_-1]||0,v=v/t.top*(n-p),u=t.percents[_+1],l=t.anim[n];break}s&&r.attr(t.anim[t.percents[_]])}if(l){if(h)h.initstatus=s,h.start=new Date-h.ms*s;else{for(var C in l)if(l[k](C)&&(it[k](C)||r.paper.customAttributes[k](C)))switch(m[C]=r.attr(C),null==m[C]&&(m[C]=et[C]),y[C]=l[C],it[C]){case j:x[C]=(y[C]-m[C])/v;break;case"colour":m[C]=i.getRGB(m[C]);var E=i.getRGB(y[C]);x[C]={r:(E.r-m[C].r)/v,g:(E.g-m[C].g)/v,b:(E.b-m[C].b)/v};break;case"path":var T=Mt(m[C],y[C]),A=T[1];for(m[C]=T[0],x[C]=[],_=0,S=m[C].length;_<S;_++){x[C][_]=[0];for(var B=1,P=m[C][_].length;B<P;B++)x[C][_][B]=(A[_][B]-m[C][_][B])/v}break;case"transform":var I=r._,z=Ft(I[C],y[C]);if(z)for(m[C]=z.from,y[C]=z.to,x[C]=[],x[C].real=!0,_=0,S=m[C].length;_<S;_++)for(x[C][_]=[m[C][_][0]],B=1,P=m[C][_].length;B<P;B++)x[C][_][B]=(y[C][_][B]-m[C][_][B])/v;else{var O=r.matrix||new f,R={_:{transform:I.transform},getBBox:function(){return r.getBBox(1)}};m[C]=[O.a,O.b,O.c,O.d,O.e,O.f],Rt(R,y[C]),y[C]=R._.transform,x[C]=[(R.matrix.a-O.a)/v,(R.matrix.b-O.b)/v,(R.matrix.c-O.c)/v,(R.matrix.d-O.d)/v,(R.matrix.e-O.e)/v,(R.matrix.f-O.f)/v]}break;case"csv":var D=L(l[C])[M](w),F=L(m[C])[M](w);if("clip-rect"==C)for(m[C]=F,x[C]=[],_=F.length;_--;)x[C][_]=(D[_]-m[C][_])/v;y[C]=D;break;default:for(D=[][N](l[C]),F=[][N](m[C]),x[C]=[],_=r.paper.customAttributes[C].length;_--;)x[C][_]=((D[_]||0)-(F[_]||0))/v}var V=l.easing,G=i.easing_formulas[V];if(!G)if((G=L(V).match(Q))&&5==G.length){var q=G;G=function(t){return g(t,+q[1],+q[2],+q[3],+q[4],v)}}else G=ut;if(b={anim:t,percent:n,timestamp:d=l.start||t.start||+new Date,start:d+(t.del||0),status:0,initstatus:s||0,stop:!1,ms:v,easing:G,from:m,diff:x,to:y,el:r,callback:l.callback,prev:p,next:u,repeat:a||t.times,origin:r.attr(),totalOrigin:o},se.push(b),s&&!h&&!c&&(b.stop=!0,b.start=new Date-v*s,1==se.length))return ae();c&&(b.start=new Date-b.ms*s),1==se.length&&oe(ae)}e("raphael.anim.start."+r.id,r,t)}}function y(t){for(var e=0;e<se.length;e++)se[e].el.paper==t&&se.splice(e--,1)}i.version="2.1.2",i.eve=e;var x,b,w=/[, ]+/,_={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},S=/\{(\d+)\}/g,k="hasOwnProperty",C={doc:document,win:t},E={was:Object.prototype[k].call(C.win,"Raphael"),is:C.win.Raphael},T=function(){this.ca=this.customAttributes={}},A="apply",N="concat",B="ontouchstart"in C.win||C.win.DocumentTouch&&C.doc instanceof DocumentTouch,P="",I=" ",L=String,M="split",z="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[M](I),O={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},R=L.prototype.toLowerCase,D=Math,F=D.max,V=D.min,G=D.abs,q=D.pow,H=D.PI,j="number",Y="string",W="array",$=Object.prototype.toString,U=(i._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),X={NaN:1,Infinity:1,"-Infinity":1},Q=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,Z=D.round,K=parseFloat,J=parseInt,tt=L.prototype.toUpperCase,et=i._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},it=i._availableAnimAttrs={blur:j,"clip-rect":"csv",cx:j,cy:j,fill:"colour","fill-opacity":j,"font-size":j,height:j,opacity:j,path:"path",r:j,rx:j,ry:j,stroke:"colour","stroke-opacity":j,"stroke-width":j,transform:"transform",width:j,x:j,y:j},rt=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,nt={hs:1,rg:1},st=/,?([achlmqrstvxz]),?/gi,ot=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,at=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,lt=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,ht=(i._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),ct=function(t,e){return K(t)-K(e)},ut=function(t){return t},pt=i._rectPath=function(t,e,i,r,n){return n?[["M",t+n,e],["l",i-2*n,0],["a",n,n,0,0,1,n,n],["l",0,r-2*n],["a",n,n,0,0,1,-n,n],["l",2*n-i,0],["a",n,n,0,0,1,-n,-n],["l",0,2*n-r],["a",n,n,0,0,1,n,-n],["z"]]:[["M",t,e],["l",i,0],["l",0,r],["l",-i,0],["z"]]},ft=function(t,e,i,r){return null==r&&(r=i),[["M",t,e],["m",0,-r],["a",i,r,0,1,1,0,2*r],["a",i,r,0,1,1,0,-2*r],["z"]]},dt=i._getPath={path:function(t){return t.attr("path")},circle:function(t){var e=t.attrs;return ft(e.cx,e.cy,e.r)},ellipse:function(t){var e=t.attrs;return ft(e.cx,e.cy,e.rx,e.ry)},rect:function(t){var e=t.attrs;return pt(e.x,e.y,e.width,e.height,e.r)},image:function(t){var e=t.attrs;return pt(e.x,e.y,e.width,e.height)},text:function(t){var e=t._getBBox();return pt(e.x,e.y,e.width,e.height)},set:function(t){var e=t._getBBox();return pt(e.x,e.y,e.width,e.height)}},gt=i.mapPath=function(t,e){if(!e)return t;var i,r,n,s,o,a,l;for(n=0,o=(t=Mt(t)).length;n<o;n++)for(s=1,a=(l=t[n]).length;s<a;s+=2)i=e.x(l[s],l[s+1]),r=e.y(l[s],l[s+1]),l[s]=i,l[s+1]=r;return t};if(i._g=C,i.type=C.win.SVGAngle||C.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==i.type){var vt,mt=C.doc.createElement("div");if(mt.innerHTML='<v:shape adj="1"/>',(vt=mt.firstChild).style.behavior="url(#default#VML)",!vt||"object"!=_typeof(vt.adj))return i.type=P;mt=null}i.svg=!(i.vml="VML"==i.type),i._Paper=T,i.fn=b=T.prototype=i.prototype,i._id=0,i._oid=0,i.is=function(t,e){return"finite"==(e=R.call(e))?!X[k](+t):"array"==e?t instanceof Array:"null"==e&&null===t||e==_typeof(t)&&null!==t||"object"==e&&t===Object(t)||"array"==e&&Array.isArray&&Array.isArray(t)||$.call(t).slice(8,-1).toLowerCase()==e},i.angle=function(t,e,r,n,s,o){if(null==s){var a=t-r,l=e-n;return a||l?(180+180*D.atan2(-l,-a)/H+360)%360:0}return i.angle(t,e,s,o)-i.angle(r,n,s,o)},i.rad=function(t){return t%360*H/180},i.deg=function(t){return 180*t/H%360},i.snapTo=function(t,e,r){if(r=i.is(r,"finite")?r:10,i.is(t,W)){for(var n=t.length;n--;)if(G(t[n]-e)<=r)return t[n]}else{var s=e%(t=+t);if(s<r)return e-s;if(s>t-r)return e-s+t}return e};i.createUUID=function(t,e){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(t,e).toUpperCase()}}(/[xy]/g,(function(t){var e=16*D.random()|0;return("x"==t?e:3&e|8).toString(16)}));i.setWindow=function(t){e("raphael.setWindow",i,C.win,t),C.win=t,C.doc=C.win.document,i._engine.initWin&&i._engine.initWin(C.win)};var yt=function(t){if(i.vml){var e,r=/^\s+|\s+$/g;try{var n=new ActiveXObject("htmlfile");n.write("<body>"),n.close(),e=n.body}catch(t){e=createPopup().document.body}var o=e.createTextRange();yt=s((function(t){try{e.style.color=L(t).replace(r,P);var i=o.queryCommandValue("ForeColor");return"#"+("000000"+(i=(255&i)<<16|65280&i|(16711680&i)>>>16).toString(16)).slice(-6)}catch(t){return"none"}}))}else{var a=C.doc.createElement("i");a.title="Raphaël Colour Picker",a.style.display="none",C.doc.body.appendChild(a),yt=s((function(t){return a.style.color=t,C.doc.defaultView.getComputedStyle(a,P).getPropertyValue("color")}))}return yt(t)},xt=function(){return"hsb("+[this.h,this.s,this.b]+")"},bt=function(){return"hsl("+[this.h,this.s,this.l]+")"},wt=function(){return this.hex},_t=function(t,e,r){if(null==e&&i.is(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(r=t.b,e=t.g,t=t.r),null==e&&i.is(t,Y)){var n=i.getRGB(t);t=n.r,e=n.g,r=n.b}return(t>1||e>1||r>1)&&(t/=255,e/=255,r/=255),[t,e,r]},St=function(t,e,r,n){var s={r:t*=255,g:e*=255,b:r*=255,hex:i.rgb(t,e,r),toString:wt};return i.is(n,"finite")&&(s.opacity=n),s};i.color=function(t){var e;return i.is(t,"object")&&"h"in t&&"s"in t&&"b"in t?(e=i.hsb2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.hex=e.hex):i.is(t,"object")&&"h"in t&&"s"in t&&"l"in t?(e=i.hsl2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.hex=e.hex):(i.is(t,"string")&&(t=i.getRGB(t)),i.is(t,"object")&&"r"in t&&"g"in t&&"b"in t?(e=i.rgb2hsl(t),t.h=e.h,t.s=e.s,t.l=e.l,e=i.rgb2hsb(t),t.v=e.b):(t={hex:"none"}).r=t.g=t.b=t.h=t.s=t.v=t.l=-1),t.toString=wt,t},i.hsb2rgb=function(t,e,i,r){var n,s,o,a,l;return this.is(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(i=t.b,e=t.s,r=(t=t.h).o),a=(l=i*e)*(1-G((t=(t*=360)%360/60)%2-1)),n=s=o=i-l,St(n+=[l,a,0,0,a,l][t=~~t],s+=[a,l,l,a,0,0][t],o+=[0,0,a,l,l,a][t],r)},i.hsl2rgb=function(t,e,i,r){var n,s,o,a,l;return this.is(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(i=t.l,e=t.s,t=t.h),(t>1||e>1||i>1)&&(t/=360,e/=100,i/=100),a=(l=2*e*(i<.5?i:1-i))*(1-G((t=(t*=360)%360/60)%2-1)),n=s=o=i-l/2,St(n+=[l,a,0,0,a,l][t=~~t],s+=[a,l,l,a,0,0][t],o+=[0,0,a,l,l,a][t],r)},i.rgb2hsb=function(t,e,i){var r,n;return t=(i=_t(t,e,i))[0],e=i[1],i=i[2],{h:((0==(n=(r=F(t,e,i))-V(t,e,i))?null:r==t?(e-i)/n:r==e?(i-t)/n+2:(t-e)/n+4)+360)%6*60/360,s:0==n?0:n/r,b:r,toString:xt}},i.rgb2hsl=function(t,e,i){var r,n,s,o;return t=(i=_t(t,e,i))[0],e=i[1],i=i[2],r=((n=F(t,e,i))+(s=V(t,e,i)))/2,{h:((0==(o=n-s)?null:n==t?(e-i)/o:n==e?(i-t)/o+2:(t-e)/o+4)+360)%6*60/360,s:0==o?0:r<.5?o/(2*r):o/(2-2*r),l:r,toString:bt}},i._path2string=function(){return this.join(",").replace(st,"$1")};i._preload=function(t,e){var i=C.doc.createElement("img");i.style.cssText="position:absolute;left:-9999em;top:-9999em",i.onload=function(){e.call(this),this.onload=null,C.doc.body.removeChild(this)},i.onerror=function(){C.doc.body.removeChild(this)},C.doc.body.appendChild(i),i.src=t};i.getRGB=s((function(t){if(!t||(t=L(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:o};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:o};!nt[k](t.toLowerCase().substring(0,2))&&"#"!=t.charAt()&&(t=yt(t));var e,r,n,s,a,l,h=t.match(U);return h?(h[2]&&(n=J(h[2].substring(5),16),r=J(h[2].substring(3,5),16),e=J(h[2].substring(1,3),16)),h[3]&&(n=J((a=h[3].charAt(3))+a,16),r=J((a=h[3].charAt(2))+a,16),e=J((a=h[3].charAt(1))+a,16)),h[4]&&(l=h[4][M](rt),e=K(l[0]),"%"==l[0].slice(-1)&&(e*=2.55),r=K(l[1]),"%"==l[1].slice(-1)&&(r*=2.55),n=K(l[2]),"%"==l[2].slice(-1)&&(n*=2.55),"rgba"==h[1].toLowerCase().slice(0,4)&&(s=K(l[3])),l[3]&&"%"==l[3].slice(-1)&&(s/=100)),h[5]?(l=h[5][M](rt),e=K(l[0]),"%"==l[0].slice(-1)&&(e*=2.55),r=K(l[1]),"%"==l[1].slice(-1)&&(r*=2.55),n=K(l[2]),"%"==l[2].slice(-1)&&(n*=2.55),("deg"==l[0].slice(-3)||"°"==l[0].slice(-1))&&(e/=360),"hsba"==h[1].toLowerCase().slice(0,4)&&(s=K(l[3])),l[3]&&"%"==l[3].slice(-1)&&(s/=100),i.hsb2rgb(e,r,n,s)):h[6]?(l=h[6][M](rt),e=K(l[0]),"%"==l[0].slice(-1)&&(e*=2.55),r=K(l[1]),"%"==l[1].slice(-1)&&(r*=2.55),n=K(l[2]),"%"==l[2].slice(-1)&&(n*=2.55),("deg"==l[0].slice(-3)||"°"==l[0].slice(-1))&&(e/=360),"hsla"==h[1].toLowerCase().slice(0,4)&&(s=K(l[3])),l[3]&&"%"==l[3].slice(-1)&&(s/=100),i.hsl2rgb(e,r,n,s)):((h={r:e,g:r,b:n,toString:o}).hex="#"+(16777216|n|r<<8|e<<16).toString(16).slice(1),i.is(s,"finite")&&(h.opacity=s),h)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:o}}),i),i.hsb=s((function(t,e,r){return i.hsb2rgb(t,e,r).hex})),i.hsl=s((function(t,e,r){return i.hsl2rgb(t,e,r).hex})),i.rgb=s((function(t,e,i){return"#"+(16777216|i|e<<8|t<<16).toString(16).slice(1)})),i.getColor=function(t){var e=this.getColor.start=this.getColor.start||{h:0,s:1,b:t||.75},i=this.hsb2rgb(e.h,e.s,e.b);return e.h+=.075,e.h>1&&(e.h=0,e.s-=.2,e.s<=0&&(this.getColor.start={h:0,s:1,b:e.b})),i.hex},i.getColor.reset=function(){delete this.start},i.parsePathString=function(t){if(!t)return null;var e=kt(t);if(e.arr)return Et(e.arr);var r={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},n=[];return i.is(t,W)&&i.is(t[0],W)&&(n=Et(t)),n.length||L(t).replace(ot,(function(t,e,i){var s=[],o=e.toLowerCase();if(i.replace(lt,(function(t,e){e&&s.push(+e)})),"m"==o&&s.length>2&&(n.push([e][N](s.splice(0,2))),o="l",e="m"==e?"l":"L"),"r"==o)n.push([e][N](s));else for(;s.length>=r[o]&&(n.push([e][N](s.splice(0,r[o]))),r[o]););})),n.toString=i._path2string,e.arr=Et(n),n},i.parseTransformString=s((function(t){if(!t)return null;var e=[];return i.is(t,W)&&i.is(t[0],W)&&(e=Et(t)),e.length||L(t).replace(at,(function(t,i,r){var n=[];R.call(i);r.replace(lt,(function(t,e){e&&n.push(+e)})),e.push([i][N](n))})),e.toString=i._path2string,e}));var kt=function t(e){var i=t.ps=t.ps||{};return i[e]?i[e].sleep=100:i[e]={sleep:100},setTimeout((function(){for(var t in i)i[k](t)&&t!=e&&(i[t].sleep--,!i[t].sleep&&delete i[t])})),i[e]};i.findDotsAtSegment=function(t,e,i,r,n,s,o,a,l){var h=1-l,c=q(h,3),u=q(h,2),p=l*l,f=p*l,d=c*t+3*u*l*i+3*h*l*l*n+f*o,g=c*e+3*u*l*r+3*h*l*l*s+f*a,v=t+2*l*(i-t)+p*(n-2*i+t),m=e+2*l*(r-e)+p*(s-2*r+e),y=i+2*l*(n-i)+p*(o-2*n+i),x=r+2*l*(s-r)+p*(a-2*s+r),b=h*t+l*i,w=h*e+l*r,_=h*n+l*o,S=h*s+l*a,k=90-180*D.atan2(v-y,m-x)/H;return(v>y||m<x)&&(k+=180),{x:d,y:g,m:{x:v,y:m},n:{x:y,y:x},start:{x:b,y:w},end:{x:_,y:S},alpha:k}},i.bezierBBox=function(t,e,r,n,s,o,a,l){i.is(t,"array")||(t=[t,e,r,n,s,o,a,l]);var h=Lt.apply(null,t);return{x:h.min.x,y:h.min.y,x2:h.max.x,y2:h.max.y,width:h.max.x-h.min.x,height:h.max.y-h.min.y}},i.isPointInsideBBox=function(t,e,i){return e>=t.x&&e<=t.x2&&i>=t.y&&i<=t.y2},i.isBBoxIntersect=function(t,e){var r=i.isPointInsideBBox;return r(e,t.x,t.y)||r(e,t.x2,t.y)||r(e,t.x,t.y2)||r(e,t.x2,t.y2)||r(t,e.x,e.y)||r(t,e.x2,e.y)||r(t,e.x,e.y2)||r(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)},i.pathIntersection=function(t,e){return p(t,e)},i.pathIntersectionNumber=function(t,e){return p(t,e,1)},i.isPointInsidePath=function(t,e,r){var n=i.pathBBox(t);return i.isPointInsideBBox(n,e,r)&&p(t,[["M",e,r],["H",n.x2+10]],1)%2==1},i._removedFactory=function(t){return function(){e("raphael.log",null,"Raphaël: you are calling to method “"+t+"” of removed object",t)}};var Ct=i.pathBBox=function(t){var e=kt(t);if(e.bbox)return r(e.bbox);if(!t)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var i,n=0,s=0,o=[],a=[],l=0,h=(t=Mt(t)).length;l<h;l++)if("M"==(i=t[l])[0])n=i[1],s=i[2],o.push(n),a.push(s);else{var c=Lt(n,s,i[1],i[2],i[3],i[4],i[5],i[6]);o=o[N](c.min.x,c.max.x),a=a[N](c.min.y,c.max.y),n=i[5],s=i[6]}var u=V[A](0,o),p=V[A](0,a),f=F[A](0,o),d=F[A](0,a),g=f-u,v=d-p,m={x:u,y:p,x2:f,y2:d,width:g,height:v,cx:u+g/2,cy:p+v/2};return e.bbox=r(m),m},Et=function(t){var e=r(t);return e.toString=i._path2string,e},Tt=i._pathToRelative=function(t){var e=kt(t);if(e.rel)return Et(e.rel);i.is(t,W)&&i.is(t&&t[0],W)||(t=i.parsePathString(t));var r=[],n=0,s=0,o=0,a=0,l=0;"M"==t[0][0]&&(o=n=t[0][1],a=s=t[0][2],l++,r.push(["M",n,s]));for(var h=l,c=t.length;h<c;h++){var u=r[h]=[],p=t[h];if(p[0]!=R.call(p[0]))switch(u[0]=R.call(p[0]),u[0]){case"a":u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=+(p[6]-n).toFixed(3),u[7]=+(p[7]-s).toFixed(3);break;case"v":u[1]=+(p[1]-s).toFixed(3);break;case"m":o=p[1],a=p[2];default:for(var f=1,d=p.length;f<d;f++)u[f]=+(p[f]-(f%2?n:s)).toFixed(3)}else{u=r[h]=[],"m"==p[0]&&(o=p[1]+n,a=p[2]+s);for(var g=0,v=p.length;g<v;g++)r[h][g]=p[g]}var m=r[h].length;switch(r[h][0]){case"z":n=o,s=a;break;case"h":n+=+r[h][m-1];break;case"v":s+=+r[h][m-1];break;default:n+=+r[h][m-2],s+=+r[h][m-1]}}return r.toString=i._path2string,e.rel=Et(r),r},At=i._pathToAbsolute=function(t){var e=kt(t);if(e.abs)return Et(e.abs);if(i.is(t,W)&&i.is(t&&t[0],W)||(t=i.parsePathString(t)),!t||!t.length)return[["M",0,0]];var r=[],n=0,s=0,o=0,l=0,h=0;"M"==t[0][0]&&(o=n=+t[0][1],l=s=+t[0][2],h++,r[0]=["M",n,s]);for(var c,u,p=3==t.length&&"M"==t[0][0]&&"R"==t[1][0].toUpperCase()&&"Z"==t[2][0].toUpperCase(),f=h,d=t.length;f<d;f++){if(r.push(c=[]),(u=t[f])[0]!=tt.call(u[0]))switch(c[0]=tt.call(u[0]),c[0]){case"A":c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5],c[6]=+(u[6]+n),c[7]=+(u[7]+s);break;case"V":c[1]=+u[1]+s;break;case"H":c[1]=+u[1]+n;break;case"R":for(var g=[n,s][N](u.slice(1)),v=2,m=g.length;v<m;v++)g[v]=+g[v]+n,g[++v]=+g[v]+s;r.pop(),r=r[N](a(g,p));break;case"M":o=+u[1]+n,l=+u[2]+s;default:for(v=1,m=u.length;v<m;v++)c[v]=+u[v]+(v%2?n:s)}else if("R"==u[0])g=[n,s][N](u.slice(1)),r.pop(),r=r[N](a(g,p)),c=["R"][N](u.slice(-2));else for(var y=0,x=u.length;y<x;y++)c[y]=u[y];switch(c[0]){case"Z":n=o,s=l;break;case"H":n=c[1];break;case"V":s=c[1];break;case"M":o=c[c.length-2],l=c[c.length-1];default:n=c[c.length-2],s=c[c.length-1]}}return r.toString=i._path2string,e.abs=Et(r),r},Nt=function(t,e,i,r){return[t,e,i,r,i,r]},Bt=function(t,e,i,r,n,s){var o=1/3,a=2/3;return[o*t+a*i,o*e+a*r,o*n+a*i,o*s+a*r,n,s]},Pt=function t(e,i,r,n,o,a,l,h,c,u){var p,f=120*H/180,d=H/180*(+o||0),g=[],v=s((function(t,e,i){return{x:t*D.cos(i)-e*D.sin(i),y:t*D.sin(i)+e*D.cos(i)}}));if(u)C=u[0],E=u[1],S=u[2],k=u[3];else{e=(p=v(e,i,-d)).x,i=p.y,h=(p=v(h,c,-d)).x,c=p.y;D.cos(H/180*o),D.sin(H/180*o);var m=(e-h)/2,y=(i-c)/2,x=m*m/(r*r)+y*y/(n*n);x>1&&(r*=x=D.sqrt(x),n*=x);var b=r*r,w=n*n,_=(a==l?-1:1)*D.sqrt(G((b*w-b*y*y-w*m*m)/(b*y*y+w*m*m))),S=_*r*y/n+(e+h)/2,k=_*-n*m/r+(i+c)/2,C=D.asin(((i-k)/n).toFixed(9)),E=D.asin(((c-k)/n).toFixed(9));(C=e<S?H-C:C)<0&&(C=2*H+C),(E=h<S?H-E:E)<0&&(E=2*H+E),l&&C>E&&(C-=2*H),!l&&E>C&&(E-=2*H)}var T=E-C;if(G(T)>f){var A=E,B=h,P=c;E=C+f*(l&&E>C?1:-1),g=t(h=S+r*D.cos(E),c=k+n*D.sin(E),r,n,o,0,l,B,P,[E,A,S,k])}T=E-C;var I=D.cos(C),L=D.sin(C),z=D.cos(E),O=D.sin(E),R=D.tan(T/4),F=4/3*r*R,V=4/3*n*R,q=[e,i],j=[e+F*L,i-V*I],Y=[h+F*O,c-V*z],W=[h,c];if(j[0]=2*q[0]-j[0],j[1]=2*q[1]-j[1],u)return[j,Y,W][N](g);for(var $=[],U=0,X=(g=[j,Y,W][N](g).join()[M](",")).length;U<X;U++)$[U]=U%2?v(g[U-1],g[U],d).y:v(g[U],g[U+1],d).x;return $},It=function(t,e,i,r,n,s,o,a,l){var h=1-l;return{x:q(h,3)*t+3*q(h,2)*l*i+3*h*l*l*n+q(l,3)*o,y:q(h,3)*e+3*q(h,2)*l*r+3*h*l*l*s+q(l,3)*a}},Lt=s((function(t,e,i,r,n,s,o,a){var l,h=n-2*i+t-(o-2*n+i),c=2*(i-t)-2*(n-i),u=t-i,p=(-c+D.sqrt(c*c-4*h*u))/2/h,f=(-c-D.sqrt(c*c-4*h*u))/2/h,d=[e,a],g=[t,o];return G(p)>"1e12"&&(p=.5),G(f)>"1e12"&&(f=.5),p>0&&p<1&&(l=It(t,e,i,r,n,s,o,a,p),g.push(l.x),d.push(l.y)),f>0&&f<1&&(l=It(t,e,i,r,n,s,o,a,f),g.push(l.x),d.push(l.y)),h=s-2*r+e-(a-2*s+r),u=e-r,p=(-(c=2*(r-e)-2*(s-r))+D.sqrt(c*c-4*h*u))/2/h,f=(-c-D.sqrt(c*c-4*h*u))/2/h,G(p)>"1e12"&&(p=.5),G(f)>"1e12"&&(f=.5),p>0&&p<1&&(l=It(t,e,i,r,n,s,o,a,p),g.push(l.x),d.push(l.y)),f>0&&f<1&&(l=It(t,e,i,r,n,s,o,a,f),g.push(l.x),d.push(l.y)),{min:{x:V[A](0,g),y:V[A](0,d)},max:{x:F[A](0,g),y:F[A](0,d)}}})),Mt=i._path2curve=s((function(t,e){var i=!e&&kt(t);if(!e&&i.curve)return Et(i.curve);for(var r=At(t),n=e&&At(e),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a=function(t,e,i){var r,n;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"][N](Pt[A](0,[e.x,e.y][N](t.slice(1))));break;case"S":"C"==i||"S"==i?(r=2*e.x-e.bx,n=2*e.y-e.by):(r=e.x,n=e.y),t=["C",r,n][N](t.slice(1));break;case"T":"Q"==i||"T"==i?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"][N](Bt(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"][N](Bt(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"][N](Nt(e.x,e.y,t[1],t[2]));break;case"H":t=["C"][N](Nt(e.x,e.y,t[1],e.y));break;case"V":t=["C"][N](Nt(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"][N](Nt(e.x,e.y,e.X,e.Y))}return t},l=function(t,e){if(t[e].length>7){t[e].shift();for(var i=t[e];i.length;)t.splice(e++,0,["C"][N](i.splice(0,6)));t.splice(e,1),u=F(r.length,n&&n.length||0)}},h=function(t,e,i,s,o){t&&e&&"M"==t[o][0]&&"M"!=e[o][0]&&(e.splice(o,0,["M",s.x,s.y]),i.bx=0,i.by=0,i.x=t[o][1],i.y=t[o][2],u=F(r.length,n&&n.length||0))},c=0,u=F(r.length,n&&n.length||0);c<u;c++){r[c]=a(r[c],s),l(r,c),n&&(n[c]=a(n[c],o)),n&&l(n,c),h(r,n,s,o,c),h(n,r,o,s,c);var p=r[c],f=n&&n[c],d=p.length,g=n&&f.length;s.x=p[d-2],s.y=p[d-1],s.bx=K(p[d-4])||s.x,s.by=K(p[d-3])||s.y,o.bx=n&&(K(f[g-4])||o.x),o.by=n&&(K(f[g-3])||o.y),o.x=n&&f[g-2],o.y=n&&f[g-1]}return n||(i.curve=Et(r)),n?[r,n]:r}),null,Et),zt=(i._parseDots=s((function(t){for(var e=[],r=0,n=t.length;r<n;r++){var s={},o=t[r].match(/^([^:]*):?([\d\.]*)/);if(s.color=i.getRGB(o[1]),s.color.error)return null;s.color=s.color.hex,o[2]&&(s.offset=o[2]+"%"),e.push(s)}for(r=1,n=e.length-1;r<n;r++)if(!e[r].offset){for(var a=K(e[r-1].offset||0),l=0,h=r+1;h<n;h++)if(e[h].offset){l=e[h].offset;break}l||(l=100,h=n);for(var c=((l=K(l))-a)/(h-r+1);r<h;r++)a+=c,e[r].offset=a+"%"}return e})),i._tear=function(t,e){t==e.top&&(e.top=t.prev),t==e.bottom&&(e.bottom=t.next),t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next)}),Ot=(i._tofront=function(t,e){e.top!==t&&(zt(t,e),t.next=null,t.prev=e.top,e.top.next=t,e.top=t)},i._toback=function(t,e){e.bottom!==t&&(zt(t,e),t.next=e.bottom,t.prev=null,e.bottom.prev=t,e.bottom=t)},i._insertafter=function(t,e,i){zt(t,i),e==i.top&&(i.top=t),e.next&&(e.next.prev=t),t.next=e.next,t.prev=e,e.next=t},i._insertbefore=function(t,e,i){zt(t,i),e==i.bottom&&(i.bottom=t),e.prev&&(e.prev.next=t),t.prev=e.prev,e.prev=t,t.next=e},i.toMatrix=function(t,e){var i=Ct(t),r={_:{transform:P},getBBox:function(){return i}};return Rt(r,e),r.matrix}),Rt=(i.transformPath=function(t,e){return gt(t,Ot(t,e))},i._extractTransform=function(t,e){if(null==e)return t._.transform;e=L(e).replace(/\.{3}|\u2026/g,t._.transform||P);var r,n,s=i.parseTransformString(e),o=0,a=1,l=1,h=t._,c=new f;if(h.transform=s||[],s)for(var u=0,p=s.length;u<p;u++){var d,g,v,m,y,x=s[u],b=x.length,w=L(x[0]).toLowerCase(),_=x[0]!=w,S=_?c.invert():0;"t"==w&&3==b?_?(d=S.x(0,0),g=S.y(0,0),v=S.x(x[1],x[2]),m=S.y(x[1],x[2]),c.translate(v-d,m-g)):c.translate(x[1],x[2]):"r"==w?2==b?(y=y||t.getBBox(1),c.rotate(x[1],y.x+y.width/2,y.y+y.height/2),o+=x[1]):4==b&&(_?(v=S.x(x[2],x[3]),m=S.y(x[2],x[3]),c.rotate(x[1],v,m)):c.rotate(x[1],x[2],x[3]),o+=x[1]):"s"==w?2==b||3==b?(y=y||t.getBBox(1),c.scale(x[1],x[b-1],y.x+y.width/2,y.y+y.height/2),a*=x[1],l*=x[b-1]):5==b&&(_?(v=S.x(x[3],x[4]),m=S.y(x[3],x[4]),c.scale(x[1],x[2],v,m)):c.scale(x[1],x[2],x[3],x[4]),a*=x[1],l*=x[2]):"m"==w&&7==b&&c.add(x[1],x[2],x[3],x[4],x[5],x[6]),h.dirtyT=1,t.matrix=c}t.matrix=c,h.sx=a,h.sy=l,h.deg=o,h.dx=r=c.e,h.dy=n=c.f,1==a&&1==l&&!o&&h.bbox?(h.bbox.x+=+r,h.bbox.y+=+n):h.dirtyT=1}),Dt=function(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}},Ft=i._equaliseTransform=function(t,e){e=L(e).replace(/\.{3}|\u2026/g,t),t=i.parseTransformString(t)||[],e=i.parseTransformString(e)||[];for(var r,n,s,o,a=F(t.length,e.length),l=[],h=[],c=0;c<a;c++){if(s=t[c]||Dt(e[c]),o=e[c]||Dt(s),s[0]!=o[0]||"r"==s[0].toLowerCase()&&(s[2]!=o[2]||s[3]!=o[3])||"s"==s[0].toLowerCase()&&(s[3]!=o[3]||s[4]!=o[4]))return;for(l[c]=[],h[c]=[],r=0,n=F(s.length,o.length);r<n;r++)r in s&&(l[c][r]=s[r]),r in o&&(h[c][r]=o[r])}return{from:l,to:h}};i._getContainer=function(t,e,r,n){var s;if(null!=(s=null!=n||i.is(t,"object")?t:C.doc.getElementById(t)))return s.tagName?null==e?{container:s,width:s.style.pixelWidth||s.offsetWidth,height:s.style.pixelHeight||s.offsetHeight}:{container:s,width:e,height:r}:{container:1,x:t,y:e,width:r,height:n}},i.pathToRelative=Tt,i._engine={},i.path2curve=Mt,i.matrix=function(t,e,i,r,n,s){return new f(t,e,i,r,n,s)},function(t){function e(t){return t[0]*t[0]+t[1]*t[1]}function r(t){var i=D.sqrt(e(t));t[0]&&(t[0]/=i),t[1]&&(t[1]/=i)}t.add=function(t,e,i,r,n,s){var o,a,l,h,c=[[],[],[]],u=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],p=[[t,i,n],[e,r,s],[0,0,1]];for(t&&t instanceof f&&(p=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),o=0;o<3;o++)for(a=0;a<3;a++){for(h=0,l=0;l<3;l++)h+=u[o][l]*p[l][a];c[o][a]=h}this.a=c[0][0],this.b=c[1][0],this.c=c[0][1],this.d=c[1][1],this.e=c[0][2],this.f=c[1][2]},t.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new f(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},t.clone=function(){return new f(this.a,this.b,this.c,this.d,this.e,this.f)},t.translate=function(t,e){this.add(1,0,0,1,t,e)},t.scale=function(t,e,i,r){null==e&&(e=t),(i||r)&&this.add(1,0,0,1,i,r),this.add(t,0,0,e,0,0),(i||r)&&this.add(1,0,0,1,-i,-r)},t.rotate=function(t,e,r){t=i.rad(t),e=e||0,r=r||0;var n=+D.cos(t).toFixed(9),s=+D.sin(t).toFixed(9);this.add(n,s,-s,n,e,r),this.add(1,0,0,1,-e,-r)},t.x=function(t,e){return t*this.a+e*this.c+this.e},t.y=function(t,e){return t*this.b+e*this.d+this.f},t.get=function(t){return+this[L.fromCharCode(97+t)].toFixed(4)},t.toString=function(){return i.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},t.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},t.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},t.split=function(){var t={};t.dx=this.e,t.dy=this.f;var n=[[this.a,this.c],[this.b,this.d]];t.scalex=D.sqrt(e(n[0])),r(n[0]),t.shear=n[0][0]*n[1][0]+n[0][1]*n[1][1],n[1]=[n[1][0]-n[0][0]*t.shear,n[1][1]-n[0][1]*t.shear],t.scaley=D.sqrt(e(n[1])),r(n[1]),t.shear/=t.scaley;var s=-n[0][1],o=n[1][1];return o<0?(t.rotate=i.deg(D.acos(o)),s<0&&(t.rotate=360-t.rotate)):t.rotate=i.deg(D.asin(s)),t.isSimple=!(+t.shear.toFixed(9)||t.scalex.toFixed(9)!=t.scaley.toFixed(9)&&t.rotate),t.isSuperSimple=!+t.shear.toFixed(9)&&t.scalex.toFixed(9)==t.scaley.toFixed(9)&&!t.rotate,t.noRotation=!+t.shear.toFixed(9)&&!t.rotate,t},t.toTransformString=function(t){var e=t||this[M]();return e.isSimple?(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[e.dx,e.dy]:P)+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:P)+(e.rotate?"r"+[e.rotate,0,0]:P)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(f.prototype);var Vt=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);"Apple Computer, Inc."==navigator.vendor&&(Vt&&Vt[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Vt&&Vt[1]<8?b.safari=function(){var t=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout((function(){t.remove()}))}:b.safari=function(){};for(var Gt=function(){this.returnValue=!1},qt=function(){return this.originalEvent.preventDefault()},Ht=function(){this.cancelBubble=!0},jt=function(){return this.originalEvent.stopPropagation()},Yt=function(t){var e=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,i=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft;return{x:t.clientX+i,y:t.clientY+e}},Wt=C.doc.addEventListener?function(t,e,i,r){var n=function(t){var e=Yt(t);return i.call(r,t,e.x,e.y)};return t.addEventListener(e,n,!1),B&&O[e]&&t.addEventListener(O[e],(function(e){for(var n=Yt(e),s=e,o=0,a=e.targetTouches&&e.targetTouches.length;o<a;o++)if(e.targetTouches[o].target==t){(e=e.targetTouches[o]).originalEvent=s,e.preventDefault=qt,e.stopPropagation=jt;break}return i.call(r,e,n.x,n.y)}),!1),function(){return t.removeEventListener(e,n,!1),B&&O[e]&&t.removeEventListener(O[e],n,!1),!0}}:C.doc.attachEvent?function(t,e,i,r){var n=function(t){t=t||C.win.event;var e=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,n=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft,s=t.clientX+n,o=t.clientY+e;return t.preventDefault=t.preventDefault||Gt,t.stopPropagation=t.stopPropagation||Ht,i.call(r,t,s,o)};return t.attachEvent("on"+e,n),function(){return t.detachEvent("on"+e,n),!0}}:void 0,$t=[],Ut=function(t){for(var i,r=t.clientX,n=t.clientY,s=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,o=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft,a=$t.length;a--;){if(i=$t[a],B&&t.touches){for(var l,h=t.touches.length;h--;)if((l=t.touches[h]).identifier==i.el._drag.id){r=l.clientX,n=l.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();var c,u=i.el.node,p=u.nextSibling,f=u.parentNode,d=u.style.display;C.win.opera&&f.removeChild(u),u.style.display="none",c=i.el.paper.getElementByPoint(r,n),u.style.display=d,C.win.opera&&(p?f.insertBefore(u,p):f.appendChild(u)),c&&e("raphael.drag.over."+i.el.id,i.el,c),r+=o,n+=s,e("raphael.drag.move."+i.el.id,i.move_scope||i.el,r-i.el._drag.x,n-i.el._drag.y,r,n,t)}},Xt=function t(r){i.unmousemove(Ut).unmouseup(t);for(var n,s=$t.length;s--;)(n=$t[s]).el._drag={},e("raphael.drag.end."+n.el.id,n.end_scope||n.start_scope||n.move_scope||n.el,r);$t=[]},Qt=i.el={},Zt=z.length;Zt--;)!function(t){i[t]=Qt[t]=function(e,r){return i.is(e,"function")&&(this.events=this.events||[],this.events.push({name:t,f:e,unbind:Wt(this.shape||this.node||C.doc,t,e,r||this)})),this},i["un"+t]=Qt["un"+t]=function(e){for(var r=this.events||[],n=r.length;n--;)r[n].name!=t||!i.is(e,"undefined")&&r[n].f!=e||(r[n].unbind(),r.splice(n,1),!r.length&&delete this.events);return this}}(z[Zt]);Qt.data=function(t,r){var n=ht[this.id]=ht[this.id]||{};if(0==arguments.length)return n;if(1==arguments.length){if(i.is(t,"object")){for(var s in t)t[k](s)&&this.data(s,t[s]);return this}return e("raphael.data.get."+this.id,this,n[t],t),n[t]}return n[t]=r,e("raphael.data.set."+this.id,this,r,t),this},Qt.removeData=function(t){return null==t?ht[this.id]={}:ht[this.id]&&delete ht[this.id][t],this},Qt.getData=function(){return r(ht[this.id]||{})},Qt.hover=function(t,e,i,r){return this.mouseover(t,i).mouseout(e,r||i)},Qt.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var Kt=[];Qt.drag=function(t,r,n,s,o,a){function l(l){(l.originalEvent||l).preventDefault();var h=l.clientX,c=l.clientY,u=C.doc.documentElement.scrollTop||C.doc.body.scrollTop,p=C.doc.documentElement.scrollLeft||C.doc.body.scrollLeft;if(this._drag.id=l.identifier,B&&l.touches)for(var f,d=l.touches.length;d--;)if(f=l.touches[d],this._drag.id=f.identifier,f.identifier==this._drag.id){h=f.clientX,c=f.clientY;break}this._drag.x=h+p,this._drag.y=c+u,!$t.length&&i.mousemove(Ut).mouseup(Xt),$t.push({el:this,move_scope:s,start_scope:o,end_scope:a}),r&&e.on("raphael.drag.start."+this.id,r),t&&e.on("raphael.drag.move."+this.id,t),n&&e.on("raphael.drag.end."+this.id,n),e("raphael.drag.start."+this.id,o||s||this,l.clientX+p,l.clientY+u,l)}return this._drag={},Kt.push({el:this,start:l}),this.mousedown(l),this},Qt.onDragOver=function(t){t?e.on("raphael.drag.over."+this.id,t):e.unbind("raphael.drag.over."+this.id)},Qt.undrag=function(){for(var t=Kt.length;t--;)Kt[t].el==this&&(this.unmousedown(Kt[t].start),Kt.splice(t,1),e.unbind("raphael.drag.*."+this.id));!Kt.length&&i.unmousemove(Ut).unmouseup(Xt),$t=[]},b.circle=function(t,e,r){var n=i._engine.circle(this,t||0,e||0,r||0);return this.__set__&&this.__set__.push(n),n},b.rect=function(t,e,r,n,s){var o=i._engine.rect(this,t||0,e||0,r||0,n||0,s||0);return this.__set__&&this.__set__.push(o),o},b.ellipse=function(t,e,r,n){var s=i._engine.ellipse(this,t||0,e||0,r||0,n||0);return this.__set__&&this.__set__.push(s),s},b.path=function(t){t&&!i.is(t,Y)&&!i.is(t[0],W)&&(t+=P);var e=i._engine.path(i.format[A](i,arguments),this);return this.__set__&&this.__set__.push(e),e},b.image=function(t,e,r,n,s){var o=i._engine.image(this,t||"about:blank",e||0,r||0,n||0,s||0);return this.__set__&&this.__set__.push(o),o},b.text=function(t,e,r){var n=i._engine.text(this,t||0,e||0,L(r));return this.__set__&&this.__set__.push(n),n},b.set=function(t){!i.is(t,"array")&&(t=Array.prototype.splice.call(arguments,0,arguments.length));var e=new he(t);return this.__set__&&this.__set__.push(e),e.paper=this,e.type="set",e},b.setStart=function(t){this.__set__=t||this.set()},b.setFinish=function(t){var e=this.__set__;return delete this.__set__,e},b.setSize=function(t,e){return i._engine.setSize.call(this,t,e)},b.setViewBox=function(t,e,r,n,s){return i._engine.setViewBox.call(this,t,e,r,n,s)},b.top=b.bottom=null,b.raphael=i;b.getElementByPoint=function(t,e){var i=this,r=i.canvas,n=C.doc.elementFromPoint(t,e);if(C.win.opera&&"svg"==n.tagName){var s=function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,r=i.body,n=i.documentElement,s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0;return{y:e.top+(C.win.pageYOffset||n.scrollTop||r.scrollTop)-s,x:e.left+(C.win.pageXOffset||n.scrollLeft||r.scrollLeft)-o}}(r),o=r.createSVGRect();o.x=t-s.x,o.y=e-s.y,o.width=o.height=1;var a=r.getIntersectionList(o,null);a.length&&(n=a[a.length-1])}if(!n)return null;for(;n.parentNode&&n!=r.parentNode&&!n.raphael;)n=n.parentNode;return n==i.canvas.parentNode&&(n=r),n=n&&n.raphael?i.getById(n.raphaelid):null},b.getElementsByBBox=function(t){var e=this.set();return this.forEach((function(r){i.isBBoxIntersect(r.getBBox(),t)&&e.push(r)})),e},b.getById=function(t){for(var e=this.bottom;e;){if(e.id==t)return e;e=e.next}return null},b.forEach=function(t,e){for(var i=this.bottom;i;){if(!1===t.call(e,i))return this;i=i.next}return this},b.getElementsByPoint=function(t,e){var i=this.set();return this.forEach((function(r){r.isPointInside(t,e)&&i.push(r)})),i},Qt.isPointInside=function(t,e){var r=this.realPath=dt[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(r=i.transformPath(r,this.attr("transform"))),i.isPointInsidePath(r,t,e)},Qt.getBBox=function(t){if(this.removed)return{};var e=this._;return t?(!e.dirty&&e.bboxwt||(this.realPath=dt[this.type](this),e.bboxwt=Ct(this.realPath),e.bboxwt.toString=d,e.dirty=0),e.bboxwt):((e.dirty||e.dirtyT||!e.bbox)&&(!e.dirty&&this.realPath||(e.bboxwt=0,this.realPath=dt[this.type](this)),e.bbox=Ct(gt(this.realPath,this.matrix)),e.bbox.toString=d,e.dirty=e.dirtyT=0),e.bbox)},Qt.clone=function(){if(this.removed)return null;var t=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(t),t},Qt.glow=function(t){if("text"==this.type)return null;var e={width:((t=t||{}).width||10)+(+this.attr("stroke-width")||1),fill:t.fill||!1,opacity:t.opacity||.5,offsetx:t.offsetx||0,offsety:t.offsety||0,color:t.color||"#000"},i=e.width/2,r=this.paper,n=r.set(),s=this.realPath||dt[this.type](this);s=this.matrix?gt(s,this.matrix):s;for(var o=1;o<i+1;o++)n.push(r.path(s).attr({stroke:e.color,fill:e.fill?e.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(e.width/i*o).toFixed(3),opacity:+(e.opacity/i).toFixed(3)}));return n.insertBefore(this).translate(e.offsetx,e.offsety)};var Jt=function(t,e,r,n,s,o,a,l,c){return null==c?h(t,e,r,n,s,o,a,l):i.findDotsAtSegment(t,e,r,n,s,o,a,l,function(t,e,i,r,n,s,o,a,l){if(!(l<0||h(t,e,i,r,n,s,o,a)<l)){var c,u=.5,p=1-u;for(c=h(t,e,i,r,n,s,o,a,p);G(c-l)>.01;)c=h(t,e,i,r,n,s,o,a,p+=(c<l?1:-1)*(u/=2));return p}}(t,e,r,n,s,o,a,l,c))},te=function(t,e){return function(r,n,s){for(var o,a,l,h,c,u="",p={},f=0,d=0,g=(r=Mt(r)).length;d<g;d++){if("M"==(l=r[d])[0])o=+l[1],a=+l[2];else{if(f+(h=Jt(o,a,l[1],l[2],l[3],l[4],l[5],l[6]))>n){if(e&&!p.start){if(u+=["C"+(c=Jt(o,a,l[1],l[2],l[3],l[4],l[5],l[6],n-f)).start.x,c.start.y,c.m.x,c.m.y,c.x,c.y],s)return u;p.start=u,u=["M"+c.x,c.y+"C"+c.n.x,c.n.y,c.end.x,c.end.y,l[5],l[6]].join(),f+=h,o=+l[5],a=+l[6];continue}if(!t&&!e)return{x:(c=Jt(o,a,l[1],l[2],l[3],l[4],l[5],l[6],n-f)).x,y:c.y,alpha:c.alpha}}f+=h,o=+l[5],a=+l[6]}u+=l.shift()+l}return p.end=u,(c=t?f:e?p:i.findDotsAtSegment(o,a,l[0],l[1],l[2],l[3],l[4],l[5],1)).alpha&&(c={x:c.x,y:c.y,alpha:c.alpha}),c}},ee=te(1),ie=te(),re=te(0,1);i.getTotalLength=ee,i.getPointAtLength=ie,i.getSubpath=function(t,e,i){if(this.getTotalLength(t)-i<1e-6)return re(t,e).end;var r=re(t,i,1);return e?re(r,e).end:r},Qt.getTotalLength=function(){var t=this.getPath();if(t)return this.node.getTotalLength?this.node.getTotalLength():ee(t)},Qt.getPointAtLength=function(t){var e=this.getPath();if(e)return ie(e,t)},Qt.getPath=function(){var t,e=i._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return e&&(t=e(this)),t},Qt.getSubpath=function(t,e){var r=this.getPath();if(r)return i.getSubpath(r,t,e)};var ne=i.easing_formulas={linear:function(t){return t},"<":function(t){return q(t,1.7)},">":function(t){return q(t,.48)},"<>":function(t){var e=.48-t/1.04,i=D.sqrt(.1734+e*e),r=i-e,n=-i-e,s=q(G(r),1/3)*(r<0?-1:1)+q(G(n),1/3)*(n<0?-1:1)+.5;return 3*(1-s)*s*s+s*s*s},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},elastic:function(t){return t==!!t?t:q(2,-10*t)*D.sin(2*(t-.075)*H/.3)+1},bounce:function(t){var e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}};ne.easeIn=ne["ease-in"]=ne["<"],ne.easeOut=ne["ease-out"]=ne[">"],ne.easeInOut=ne["ease-in-out"]=ne["<>"],ne["back-in"]=ne.backIn,ne["back-out"]=ne.backOut;var se=[],oe=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){setTimeout(t,16)},ae=function t(){for(var r=+new Date,n=0;n<se.length;n++){var s=se[n];if(!s.el.removed&&!s.paused){var o,a,l=r-s.start,h=s.ms,c=s.easing,u=s.from,p=s.diff,f=s.to,d=(s.t,s.el),g={},v={};if(s.initstatus?(l=(s.initstatus*s.anim.top-s.prev)/(s.percent-s.prev)*h,s.status=s.initstatus,delete s.initstatus,s.stop&&se.splice(n--,1)):s.status=(s.prev+(s.percent-s.prev)*(l/h))/s.anim.top,!(l<0))if(l<h){var y=c(l/h);for(var x in u)if(u[k](x)){switch(it[x]){case j:o=+u[x]+y*h*p[x];break;case"colour":o="rgb("+[le(Z(u[x].r+y*h*p[x].r)),le(Z(u[x].g+y*h*p[x].g)),le(Z(u[x].b+y*h*p[x].b))].join(",")+")";break;case"path":o=[];for(var b=0,w=u[x].length;b<w;b++){o[b]=[u[x][b][0]];for(var _=1,S=u[x][b].length;_<S;_++)o[b][_]=+u[x][b][_]+y*h*p[x][b][_];o[b]=o[b].join(I)}o=o.join(I);break;case"transform":if(p[x].real)for(o=[],b=0,w=u[x].length;b<w;b++)for(o[b]=[u[x][b][0]],_=1,S=u[x][b].length;_<S;_++)o[b][_]=u[x][b][_]+y*h*p[x][b][_];else{var C=function(t){return+u[x][t]+y*h*p[x][t]};o=[["m",C(0),C(1),C(2),C(3),C(4),C(5)]]}break;case"csv":if("clip-rect"==x)for(o=[],b=4;b--;)o[b]=+u[x][b]+y*h*p[x][b];break;default:var E=[][N](u[x]);for(o=[],b=d.paper.customAttributes[x].length;b--;)o[b]=+E[b]+y*h*p[x][b]}g[x]=o}d.attr(g),function(t,i,r){setTimeout((function(){e("raphael.anim.frame."+t,i,r)}))}(d.id,d,s.anim)}else{if(function(t,r,n){setTimeout((function(){e("raphael.anim.frame."+r.id,r,n),e("raphael.anim.finish."+r.id,r,n),i.is(t,"function")&&t.call(r)}))}(s.callback,d,s.anim),d.attr(f),se.splice(n--,1),s.repeat>1&&!s.next){for(a in f)f[k](a)&&(v[a]=s.totalOrigin[a]);s.el.attr(v),m(s.anim,s.el,s.anim.percents[0],null,s.totalOrigin,s.repeat-1)}s.next&&!s.stop&&m(s.anim,s.el,s.next,null,s.totalOrigin,s.repeat)}}}i.svg&&d&&d.paper&&d.paper.safari(),se.length&&oe(t)},le=function(t){return t>255?255:t<0?0:t};Qt.animateWith=function(t,e,r,n,s,o){var a=this;if(a.removed)return o&&o.call(a),a;var l=r instanceof v?r:i.animation(r,n,s,o);m(l,a,l.percents[0],null,a.attr());for(var h=0,c=se.length;h<c;h++)if(se[h].anim==e&&se[h].el==t){se[c-1].start=se[h].start;break}return a},Qt.onAnimation=function(t){return t?e.on("raphael.anim.frame."+this.id,t):e.unbind("raphael.anim.frame."+this.id),this},v.prototype.delay=function(t){var e=new v(this.anim,this.ms);return e.times=this.times,e.del=+t||0,e},v.prototype.repeat=function(t){var e=new v(this.anim,this.ms);return e.del=this.del,e.times=D.floor(F(t,0))||1,e},i.animation=function(t,e,r,n){if(t instanceof v)return t;!i.is(r,"function")&&r||(n=n||r||null,r=null),t=Object(t),e=+e||0;var s,o,a={};for(o in t)t[k](o)&&K(o)!=o&&K(o)+"%"!=o&&(s=!0,a[o]=t[o]);return s?(r&&(a.easing=r),n&&(a.callback=n),new v({100:a},e)):new v(t,e)},Qt.animate=function(t,e,r,n){var s=this;if(s.removed)return n&&n.call(s),s;var o=t instanceof v?t:i.animation(t,e,r,n);return m(o,s,o.percents[0],null,s.attr()),s},Qt.setTime=function(t,e){return t&&null!=e&&this.status(t,V(e,t.ms)/t.ms),this},Qt.status=function(t,e){var i,r,n=[],s=0;if(null!=e)return m(t,this,-1,V(e,1)),this;for(i=se.length;s<i;s++)if((r=se[s]).el.id==this.id&&(!t||r.anim==t)){if(t)return r.status;n.push({anim:r.anim,status:r.status})}return t?0:n},Qt.pause=function(t){for(var i=0;i<se.length;i++)se[i].el.id!=this.id||t&&se[i].anim!=t||!1!==e("raphael.anim.pause."+this.id,this,se[i].anim)&&(se[i].paused=!0);return this},Qt.resume=function(t){for(var i=0;i<se.length;i++)if(se[i].el.id==this.id&&(!t||se[i].anim==t)){var r=se[i];!1!==e("raphael.anim.resume."+this.id,this,r.anim)&&(delete r.paused,this.status(r.anim,r.status))}return this},Qt.stop=function(t){for(var i=0;i<se.length;i++)se[i].el.id!=this.id||t&&se[i].anim!=t||!1!==e("raphael.anim.stop."+this.id,this,se[i].anim)&&se.splice(i--,1);return this},e.on("raphael.remove",y),e.on("raphael.clear",y),Qt.toString=function(){return"Raphaël’s object"};var he=function t(e){if(this.items=[],this.length=0,this.type="set",e)for(var i=0,r=e.length;i<r;i++)!e[i]||e[i].constructor!=Qt.constructor&&e[i].constructor!=t||(this[this.items.length]=this.items[this.items.length]=e[i],this.length++)},ce=he.prototype;for(var ue in ce.push=function(){for(var t,e,i=0,r=arguments.length;i<r;i++)!(t=arguments[i])||t.constructor!=Qt.constructor&&t.constructor!=he||(this[e=this.items.length]=this.items[e]=t,this.length++);return this},ce.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},ce.forEach=function(t,e){for(var i=0,r=this.items.length;i<r;i++)if(!1===t.call(e,this.items[i],i))return this;return this},Qt)Qt[k](ue)&&(ce[ue]=function(t){return function(){var e=arguments;return this.forEach((function(i){i[t][A](i,e)}))}}(ue));ce.attr=function(t,e){if(t&&i.is(t,W)&&i.is(t[0],"object"))for(var r=0,n=t.length;r<n;r++)this.items[r].attr(t[r]);else for(var s=0,o=this.items.length;s<o;s++)this.items[s].attr(t,e);return this},ce.clear=function(){for(;this.length;)this.pop()},ce.splice=function(t,e,i){t=t<0?F(this.length+t,0):t,e=F(0,V(this.length-t,e));var r,n=[],s=[],o=[];for(r=2;r<arguments.length;r++)o.push(arguments[r]);for(r=0;r<e;r++)s.push(this[t+r]);for(;r<this.length-t;r++)n.push(this[t+r]);var a=o.length;for(r=0;r<a+n.length;r++)this.items[t+r]=this[t+r]=r<a?o[r]:n[r-a];for(r=this.items.length=this.length-=e-a;this[r];)delete this[r++];return new he(s)},ce.exclude=function(t){for(var e=0,i=this.length;e<i;e++)if(this[e]==t)return this.splice(e,1),!0},ce.animate=function(t,e,r,n){(i.is(r,"function")||!r)&&(n=r||null);var s,o,a=this.items.length,l=a,h=this;if(!a)return this;n&&(o=function(){!--a&&n.call(h)}),r=i.is(r,Y)?r:o;var c=i.animation(t,e,r,o);for(s=this.items[--l].animate(c);l--;)this.items[l]&&!this.items[l].removed&&this.items[l].animateWith(s,c,c),this.items[l]&&!this.items[l].removed||a--;return this},ce.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},ce.getBBox=function(){for(var t=[],e=[],i=[],r=[],n=this.items.length;n--;)if(!this.items[n].removed){var s=this.items[n].getBBox();t.push(s.x),e.push(s.y),i.push(s.x+s.width),r.push(s.y+s.height)}return{x:t=V[A](0,t),y:e=V[A](0,e),x2:i=F[A](0,i),y2:r=F[A](0,r),width:i-t,height:r-e}},ce.clone=function(t){t=this.paper.set();for(var e=0,i=this.items.length;e<i;e++)t.push(this.items[e].clone());return t},ce.toString=function(){return"Raphaël‘s set"},ce.glow=function(t){var e=this.paper.set();return this.forEach((function(i,r){var n=i.glow(t);null!=n&&n.forEach((function(t,i){e.push(t)}))})),e},ce.isPointInside=function(t,e){var i=!1;return this.forEach((function(r){if(r.isPointInside(t,e))return i=!0,!1})),i},i.registerFont=function(t){if(!t.face)return t;this.fonts=this.fonts||{};var e={w:t.w,face:{},glyphs:{}},i=t.face["font-family"];for(var r in t.face)t.face[k](r)&&(e.face[r]=t.face[r]);if(this.fonts[i]?this.fonts[i].push(e):this.fonts[i]=[e],!t.svg)for(var n in e.face["units-per-em"]=J(t.face["units-per-em"],10),t.glyphs)if(t.glyphs[k](n)){var s=t.glyphs[n];if(e.glyphs[n]={w:s.w,k:{},d:s.d&&"M"+s.d.replace(/[mlcxtrv]/g,(function(t){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[t]||"M"}))+"z"},s.k)for(var o in s.k)s[k](o)&&(e.glyphs[n].k[o]=s.k[o])}return t},b.getFont=function(t,e,r,n){if(n=n||"normal",r=r||"normal",e=+e||{normal:400,bold:700,lighter:300,bolder:800}[e]||400,i.fonts){var s,o=i.fonts[t];if(!o){var a=new RegExp("(^|\\s)"+t.replace(/[^\w\d\s+!~.:_-]/g,P)+"(\\s|$)","i");for(var l in i.fonts)if(i.fonts[k](l)&&a.test(l)){o=i.fonts[l];break}}if(o)for(var h=0,c=o.length;h<c&&((s=o[h]).face["font-weight"]!=e||s.face["font-style"]!=r&&s.face["font-style"]||s.face["font-stretch"]!=n);h++);return s}},b.print=function(t,e,r,n,s,o,a,l){o=o||"middle",a=F(V(a||0,1),-1),l=F(V(l||1,3),1);var h,c=L(r)[M](P),u=0,p=0,f=P;if(i.is(n,"string")&&(n=this.getFont(n)),n){h=(s||16)/n.face["units-per-em"];for(var d=n.face.bbox[M](w),g=+d[0],v=d[3]-d[1],m=0,y=+d[1]+("baseline"==o?v+ +n.face.descent:v/2),x=0,b=c.length;x<b;x++){if("\n"==c[x])u=0,S=0,p=0,m+=v*l;else{var _=p&&n.glyphs[c[x-1]]||{},S=n.glyphs[c[x]];u+=p?(_.w||n.w)+(_.k&&_.k[c[x]]||0)+n.w*a:0,p=1}S&&S.d&&(f+=i.transformPath(S.d,["t",u*h,m*h,"s",h,h,g,y,"t",(t-g)/h,(e-y)/h]))}}return this.path(f).attr({fill:"#000",stroke:"none"})},b.add=function(t){if(i.is(t,"array"))for(var e,r=this.set(),n=0,s=t.length;n<s;n++)e=t[n]||{},_[k](e.type)&&r.push(this[e.type]().attr(e));return r},i.format=function(t,e){var r=i.is(e,W)?[0][N](e):arguments;return t&&i.is(t,Y)&&r.length-1&&(t=t.replace(S,(function(t,e){return null==r[++e]?P:r[e]}))),t||P},i.fullfill=function(){var t=/\{([^\}]+)\}/g,e=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,i=function(t,i,r){var n=r;return i.replace(e,(function(t,e,i,r,s){e=e||r,n&&(e in n&&(n=n[e]),"function"==typeof n&&s&&(n=n()))})),n=(null==n||n==r?t:n)+""};return function(e,r){return String(e).replace(t,(function(t,e){return i(t,e,r)}))}}(),i.ninja=function(){return E.was?C.win.Raphael=E.is:Raphael=void 0,i},i.st=ce,function(t,e,r){null==t.readyState&&t.addEventListener&&(t.addEventListener(e,r=function(){t.removeEventListener(e,r,!1),t.readyState="complete"},!1),t.readyState="loading"),function e(){/in/.test(t.readyState)?setTimeout(e,9):i.eve("raphael.DOMload")}()}(document,"DOMContentLoaded"),e.on("raphael.DOMload",(function(){x=!0})),function(){if(i.svg){var t="hasOwnProperty",e=String,r=parseFloat,n=parseInt,s=Math,o=s.max,a=s.abs,l=s.pow,h=/[, ]+/,c=i.eve,u="",p=" ",f="http://www.w3.org/1999/xlink",d={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},g={};i.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var v=function r(n,s){if(s)for(var o in"string"==typeof n&&(n=r(n)),s)s[t](o)&&("xlink:"==o.substring(0,6)?n.setAttributeNS(f,o.substring(6),e(s[o])):n.setAttribute(o,e(s[o])));else(n=i._g.doc.createElementNS("http://www.w3.org/2000/svg",n)).style&&(n.style.webkitTapHighlightColor="rgba(0,0,0,0)");return n},m=function(t,n){var h="linear",c=t.id+n,p=.5,f=.5,d=t.node,g=t.paper,m=d.style,y=i._g.doc.getElementById(c);if(!y){if(n=(n=e(n).replace(i._radial_gradient,(function(t,e,i){if(h="radial",e&&i){p=r(e);var n=2*((f=r(i))>.5)-1;l(p-.5,2)+l(f-.5,2)>.25&&(f=s.sqrt(.25-l(p-.5,2))*n+.5)&&.5!=f&&(f=f.toFixed(5)-1e-5*n)}return u}))).split(/\s*\-\s*/),"linear"==h){var x=n.shift();if(x=-r(x),isNaN(x))return null;var b=[0,0,s.cos(i.rad(x)),s.sin(i.rad(x))],w=1/(o(a(b[2]),a(b[3]))||1);b[2]*=w,b[3]*=w,b[2]<0&&(b[0]=-b[2],b[2]=0),b[3]<0&&(b[1]=-b[3],b[3]=0)}var _=i._parseDots(n);if(!_)return null;if(c=c.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&c!=t.gradient.id&&(g.defs.removeChild(t.gradient),delete t.gradient),!t.gradient){y=v(h+"Gradient",{id:c}),t.gradient=y,v(y,"radial"==h?{fx:p,fy:f}:{x1:b[0],y1:b[1],x2:b[2],y2:b[3],gradientTransform:t.matrix.invert()}),g.defs.appendChild(y);for(var S=0,k=_.length;S<k;S++)y.appendChild(v("stop",{offset:_[S].offset?_[S].offset:S?"100%":"0%","stop-color":_[S].color||"#fff"}))}}return v(d,{fill:"url(#"+c+")",opacity:1,"fill-opacity":1}),m.fill=u,m.opacity=1,m.fillOpacity=1,1},y=function(t){var e=t.getBBox(1);v(t.pattern,{patternTransform:t.matrix.invert()+" translate("+e.x+","+e.y+")"})},x=function(r,n,s){if("path"==r.type){for(var o,a,l,h,c,p=e(n).toLowerCase().split("-"),f=r.paper,m=s?"end":"start",y=r.node,x=r.attrs,b=x["stroke-width"],w=p.length,_="classic",S=3,k=3,C=5;w--;)switch(p[w]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":_=p[w];break;case"wide":k=5;break;case"narrow":k=2;break;case"long":S=5;break;case"short":S=2}if("open"==_?(S+=2,k+=2,C+=2,l=1,h=s?4:1,c={fill:"none",stroke:x.stroke}):(h=l=S/2,c={fill:x.stroke,stroke:"none"}),r._.arrows?s?(r._.arrows.endPath&&g[r._.arrows.endPath]--,r._.arrows.endMarker&&g[r._.arrows.endMarker]--):(r._.arrows.startPath&&g[r._.arrows.startPath]--,r._.arrows.startMarker&&g[r._.arrows.startMarker]--):r._.arrows={},"none"!=_){var E="raphael-marker-"+_,T="raphael-marker-"+m+_+S+k;i._g.doc.getElementById(E)?g[E]++:(f.defs.appendChild(v(v("path"),{"stroke-linecap":"round",d:d[_],id:E})),g[E]=1);var A,N=i._g.doc.getElementById(T);N?(g[T]++,A=N.getElementsByTagName("use")[0]):(N=v(v("marker"),{id:T,markerHeight:k,markerWidth:S,orient:"auto",refX:h,refY:k/2}),A=v(v("use"),{"xlink:href":"#"+E,transform:(s?"rotate(180 "+S/2+" "+k/2+") ":u)+"scale("+S/C+","+k/C+")","stroke-width":(1/((S/C+k/C)/2)).toFixed(4)}),N.appendChild(A),f.defs.appendChild(N),g[T]=1),v(A,c);var B=l*("diamond"!=_&&"oval"!=_);s?(o=r._.arrows.startdx*b||0,a=i.getTotalLength(x.path)-B*b):(o=B*b,a=i.getTotalLength(x.path)-(r._.arrows.enddx*b||0)),(c={})["marker-"+m]="url(#"+T+")",(a||o)&&(c.d=i.getSubpath(x.path,o,a)),v(y,c),r._.arrows[m+"Path"]=E,r._.arrows[m+"Marker"]=T,r._.arrows[m+"dx"]=B,r._.arrows[m+"Type"]=_,r._.arrows[m+"String"]=n}else s?(o=r._.arrows.startdx*b||0,a=i.getTotalLength(x.path)-o):(o=0,a=i.getTotalLength(x.path)-(r._.arrows.enddx*b||0)),r._.arrows[m+"Path"]&&v(y,{d:i.getSubpath(x.path,o,a)}),delete r._.arrows[m+"Path"],delete r._.arrows[m+"Marker"],delete r._.arrows[m+"dx"],delete r._.arrows[m+"Type"],delete r._.arrows[m+"String"];for(c in g)if(g[t](c)&&!g[c]){var P=i._g.doc.getElementById(c);P&&P.parentNode.removeChild(P)}}},b={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},w=function(t,i,r){if(i=b[e(i).toLowerCase()]){for(var n=t.attrs["stroke-width"]||"1",s={round:n,square:n,butt:0}[t.attrs["stroke-linecap"]||r["stroke-linecap"]]||0,o=[],a=i.length;a--;)o[a]=i[a]*n+(a%2?1:-1)*s;v(t.node,{"stroke-dasharray":o.join(",")})}},_=function(r,s){var l=r.node,c=r.attrs,p=l.style.visibility;for(var d in l.style.visibility="hidden",s)if(s[t](d)){if(!i._availableAttrs[t](d))continue;var g=s[d];switch(c[d]=g,d){case"blur":r.blur(g);break;case"title":var b=l.getElementsByTagName("title");if(b.length&&(b=b[0]))b.firstChild.nodeValue=g;else{b=v("title");var _=i._g.doc.createTextNode(g);b.appendChild(_),l.appendChild(b)}break;case"href":case"target":var k=l.parentNode;if("a"!=k.tagName.toLowerCase()){var C=v("a");k.insertBefore(C,l),C.appendChild(l),k=C}"target"==d?k.setAttributeNS(f,"show","blank"==g?"new":g):k.setAttributeNS(f,d,g);break;case"cursor":l.style.cursor=g;break;case"transform":r.transform(g);break;case"arrow-start":x(r,g);break;case"arrow-end":x(r,g,1);break;case"clip-rect":var E=e(g).split(h);if(4==E.length){r.clip&&r.clip.parentNode.parentNode.removeChild(r.clip.parentNode);var T=v("clipPath"),A=v("rect");T.id=i.createUUID(),v(A,{x:E[0],y:E[1],width:E[2],height:E[3]}),T.appendChild(A),r.paper.defs.appendChild(T),v(l,{"clip-path":"url(#"+T.id+")"}),r.clip=A}if(!g){var N=l.getAttribute("clip-path");if(N){var B=i._g.doc.getElementById(N.replace(/(^url\(#|\)$)/g,u));B&&B.parentNode.removeChild(B),v(l,{"clip-path":u}),delete r.clip}}break;case"path":"path"==r.type&&(v(l,{d:g?c.path=i._pathToAbsolute(g):"M0,0"}),r._.dirty=1,r._.arrows&&("startString"in r._.arrows&&x(r,r._.arrows.startString),"endString"in r._.arrows&&x(r,r._.arrows.endString,1)));break;case"width":if(l.setAttribute(d,g),r._.dirty=1,!c.fx)break;d="x",g=c.x;case"x":c.fx&&(g=-c.x-(c.width||0));case"rx":if("rx"==d&&"rect"==r.type)break;case"cx":l.setAttribute(d,g),r.pattern&&y(r),r._.dirty=1;break;case"height":if(l.setAttribute(d,g),r._.dirty=1,!c.fy)break;d="y",g=c.y;case"y":c.fy&&(g=-c.y-(c.height||0));case"ry":if("ry"==d&&"rect"==r.type)break;case"cy":l.setAttribute(d,g),r.pattern&&y(r),r._.dirty=1;break;case"r":"rect"==r.type?v(l,{rx:g,ry:g}):l.setAttribute(d,g),r._.dirty=1;break;case"src":"image"==r.type&&l.setAttributeNS(f,"href",g);break;case"stroke-width":1==r._.sx&&1==r._.sy||(g/=o(a(r._.sx),a(r._.sy))||1),r.paper._vbSize&&(g*=r.paper._vbSize),l.setAttribute(d,g),c["stroke-dasharray"]&&w(r,c["stroke-dasharray"],s),r._.arrows&&("startString"in r._.arrows&&x(r,r._.arrows.startString),"endString"in r._.arrows&&x(r,r._.arrows.endString,1));break;case"stroke-dasharray":w(r,g,s);break;case"fill":var P=e(g).match(i._ISURL);if(P){T=v("pattern");var I=v("image");T.id=i.createUUID(),v(T,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),v(I,{x:0,y:0,"xlink:href":P[1]}),T.appendChild(I),function(t){i._preload(P[1],(function(){var e=this.offsetWidth,i=this.offsetHeight;v(t,{width:e,height:i}),v(I,{width:e,height:i}),r.paper.safari()}))}(T),r.paper.defs.appendChild(T),v(l,{fill:"url(#"+T.id+")"}),r.pattern=T,r.pattern&&y(r);break}var L=i.getRGB(g);if(L.error){if(("circle"==r.type||"ellipse"==r.type||"r"!=e(g).charAt())&&m(r,g)){if("opacity"in c||"fill-opacity"in c){var M=i._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,u));if(M){var z=M.getElementsByTagName("stop");v(z[z.length-1],{"stop-opacity":("opacity"in c?c.opacity:1)*("fill-opacity"in c?c["fill-opacity"]:1)})}}c.gradient=g,c.fill="none";break}}else delete s.gradient,delete c.gradient,!i.is(c.opacity,"undefined")&&i.is(s.opacity,"undefined")&&v(l,{opacity:c.opacity}),!i.is(c["fill-opacity"],"undefined")&&i.is(s["fill-opacity"],"undefined")&&v(l,{"fill-opacity":c["fill-opacity"]});L[t]("opacity")&&v(l,{"fill-opacity":L.opacity>1?L.opacity/100:L.opacity});case"stroke":L=i.getRGB(g),l.setAttribute(d,L.hex),"stroke"==d&&L[t]("opacity")&&v(l,{"stroke-opacity":L.opacity>1?L.opacity/100:L.opacity}),"stroke"==d&&r._.arrows&&("startString"in r._.arrows&&x(r,r._.arrows.startString),"endString"in r._.arrows&&x(r,r._.arrows.endString,1));break;case"gradient":("circle"==r.type||"ellipse"==r.type||"r"!=e(g).charAt())&&m(r,g);break;case"opacity":c.gradient&&!c[t]("stroke-opacity")&&v(l,{"stroke-opacity":g>1?g/100:g});case"fill-opacity":if(c.gradient){(M=i._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,u)))&&(z=M.getElementsByTagName("stop"),v(z[z.length-1],{"stop-opacity":g}));break}default:"font-size"==d&&(g=n(g,10)+"px");var O=d.replace(/(\-.)/g,(function(t){return t.substring(1).toUpperCase()}));l.style[O]=g,r._.dirty=1,l.setAttribute(d,g)}}S(r,s),l.style.visibility=p},S=function(r,s){if("text"==r.type&&(s[t]("text")||s[t]("font")||s[t]("font-size")||s[t]("x")||s[t]("y"))){var o=r.attrs,a=r.node,l=a.firstChild?n(i._g.doc.defaultView.getComputedStyle(a.firstChild,u).getPropertyValue("font-size"),10):10;if(s[t]("text")){for(o.text=s.text;a.firstChild;)a.removeChild(a.firstChild);for(var h,c=e(s.text).split("\n"),p=[],f=0,d=c.length;f<d;f++)h=v("tspan"),f&&v(h,{dy:1.2*l,x:o.x}),h.appendChild(i._g.doc.createTextNode(c[f])),a.appendChild(h),p[f]=h}else for(f=0,d=(p=a.getElementsByTagName("tspan")).length;f<d;f++)f?v(p[f],{dy:1.2*l,x:o.x}):v(p[0],{dy:0});v(a,{x:o.x,y:o.y}),r._.dirty=1;var g=r._getBBox(),m=o.y-(g.y+g.height/2);m&&i.is(m,"finite")&&v(p[0],{dy:m})}},k=function(t,e){this[0]=this.node=t,t.raphael=!0,this.id=i._oid++,t.raphaelid=this.id,this.matrix=i.matrix(),this.realPath=null,this.paper=e,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!e.bottom&&(e.bottom=this),this.prev=e.top,e.top&&(e.top.next=this),e.top=this,this.next=null},C=i.el;k.prototype=C,C.constructor=k,i._engine.path=function(t,e){var i=v("path");e.canvas&&e.canvas.appendChild(i);var r=new k(i,e);return r.type="path",_(r,{fill:"none",stroke:"#000",path:t}),r},C.rotate=function(t,i,n){if(this.removed)return this;if((t=e(t).split(h)).length-1&&(i=r(t[1]),n=r(t[2])),t=r(t[0]),null==n&&(i=n),null==i||null==n){var s=this.getBBox(1);i=s.x+s.width/2,n=s.y+s.height/2}return this.transform(this._.transform.concat([["r",t,i,n]])),this},C.scale=function(t,i,n,s){if(this.removed)return this;if((t=e(t).split(h)).length-1&&(i=r(t[1]),n=r(t[2]),s=r(t[3])),t=r(t[0]),null==i&&(i=t),null==s&&(n=s),null==n||null==s)var o=this.getBBox(1);return n=null==n?o.x+o.width/2:n,s=null==s?o.y+o.height/2:s,this.transform(this._.transform.concat([["s",t,i,n,s]])),this},C.translate=function(t,i){return this.removed?this:((t=e(t).split(h)).length-1&&(i=r(t[1])),t=r(t[0])||0,i=+i||0,this.transform(this._.transform.concat([["t",t,i]])),this)},C.transform=function(e){var r=this._;if(null==e)return r.transform;if(i._extractTransform(this,e),this.clip&&v(this.clip,{transform:this.matrix.invert()}),this.pattern&&y(this),this.node&&v(this.node,{transform:this.matrix}),1!=r.sx||1!=r.sy){var n=this.attrs[t]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":n})}return this},C.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},C.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},C.remove=function(){if(!this.removed&&this.node.parentNode){var t=this.paper;for(var e in t.__set__&&t.__set__.exclude(this),c.unbind("raphael.*.*."+this.id),this.gradient&&t.defs.removeChild(this.gradient),i._tear(this,t),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node),this)this[e]="function"==typeof this[e]?i._removedFactory(e):null;this.removed=!0}},C._getBBox=function(){if("none"==this.node.style.display){this.show();var t=!0}var e={};try{e=this.node.getBBox()}catch(t){}finally{e=e||{}}return t&&this.hide(),e},C.attr=function(e,r){if(this.removed)return this;if(null==e){var n={};for(var s in this.attrs)this.attrs[t](s)&&(n[s]=this.attrs[s]);return n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n.transform=this._.transform,n}if(null==r&&i.is(e,"string")){if("fill"==e&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==e)return this._.transform;for(var o=e.split(h),a={},l=0,u=o.length;l<u;l++)(e=o[l])in this.attrs?a[e]=this.attrs[e]:i.is(this.paper.customAttributes[e],"function")?a[e]=this.paper.customAttributes[e].def:a[e]=i._availableAttrs[e];return u-1?a:a[o[0]]}if(null==r&&i.is(e,"array")){for(a={},l=0,u=e.length;l<u;l++)a[e[l]]=this.attr(e[l]);return a}if(null!=r){var p={};p[e]=r}else null!=e&&i.is(e,"object")&&(p=e);for(var f in p)c("raphael.attr."+f+"."+this.id,this,p[f]);for(f in this.paper.customAttributes)if(this.paper.customAttributes[t](f)&&p[t](f)&&i.is(this.paper.customAttributes[f],"function")){var d=this.paper.customAttributes[f].apply(this,[].concat(p[f]));for(var g in this.attrs[f]=p[f],d)d[t](g)&&(p[g]=d[g])}return _(this,p),this},C.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var t=this.paper;return t.top!=this&&i._tofront(this,t),this},C.toBack=function(){if(this.removed)return this;var t=this.node.parentNode;"a"==t.tagName.toLowerCase()?t.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):t.firstChild!=this.node&&t.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper);this.paper;return this},C.insertAfter=function(t){if(this.removed)return this;var e=t.node||t[t.length-1].node;return e.nextSibling?e.parentNode.insertBefore(this.node,e.nextSibling):e.parentNode.appendChild(this.node),i._insertafter(this,t,this.paper),this},C.insertBefore=function(t){if(this.removed)return this;var e=t.node||t[0].node;return e.parentNode.insertBefore(this.node,e),i._insertbefore(this,t,this.paper),this},C.blur=function(t){var e=this;if(0!=+t){var r=v("filter"),n=v("feGaussianBlur");e.attrs.blur=t,r.id=i.createUUID(),v(n,{stdDeviation:+t||1.5}),r.appendChild(n),e.paper.defs.appendChild(r),e._blur=r,v(e.node,{filter:"url(#"+r.id+")"})}else e._blur&&(e._blur.parentNode.removeChild(e._blur),delete e._blur,delete e.attrs.blur),e.node.removeAttribute("filter");return e},i._engine.circle=function(t,e,i,r){var n=v("circle");t.canvas&&t.canvas.appendChild(n);var s=new k(n,t);return s.attrs={cx:e,cy:i,r:r,fill:"none",stroke:"#000"},s.type="circle",v(n,s.attrs),s},i._engine.rect=function(t,e,i,r,n,s){var o=v("rect");t.canvas&&t.canvas.appendChild(o);var a=new k(o,t);return a.attrs={x:e,y:i,width:r,height:n,r:s||0,rx:s||0,ry:s||0,fill:"none",stroke:"#000"},a.type="rect",v(o,a.attrs),a},i._engine.ellipse=function(t,e,i,r,n){var s=v("ellipse");t.canvas&&t.canvas.appendChild(s);var o=new k(s,t);return o.attrs={cx:e,cy:i,rx:r,ry:n,fill:"none",stroke:"#000"},o.type="ellipse",v(s,o.attrs),o},i._engine.image=function(t,e,i,r,n,s){var o=v("image");v(o,{x:i,y:r,width:n,height:s,preserveAspectRatio:"none"}),o.setAttributeNS(f,"href",e),t.canvas&&t.canvas.appendChild(o);var a=new k(o,t);return a.attrs={x:i,y:r,width:n,height:s,src:e},a.type="image",a},i._engine.text=function(t,e,r,n){var s=v("text");t.canvas&&t.canvas.appendChild(s);var o=new k(s,t);return o.attrs={x:e,y:r,"text-anchor":"middle",text:n,font:i._availableAttrs.font,stroke:"none",fill:"#000"},o.type="text",_(o,o.attrs),o},i._engine.setSize=function(t,e){return this.width=t||this.width,this.height=e||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},i._engine.create=function(){var t=i._getContainer.apply(0,arguments),e=t&&t.container,r=t.x,n=t.y,s=t.width,o=t.height;if(!e)throw new Error("SVG container not found.");var a,l=v("svg"),h="overflow:hidden;";return r=r||0,n=n||0,v(l,{height:o=o||342,version:1.1,width:s=s||512,xmlns:"http://www.w3.org/2000/svg"}),1==e?(l.style.cssText=h+"position:absolute;left:"+r+"px;top:"+n+"px",i._g.doc.body.appendChild(l),a=1):(l.style.cssText=h+"position:relative",e.firstChild?e.insertBefore(l,e.firstChild):e.appendChild(l)),(e=new i._Paper).width=s,e.height=o,e.canvas=l,e.clear(),e._left=e._top=0,a&&(e.renderfix=function(){}),e.renderfix(),e},i._engine.setViewBox=function(t,e,i,r,n){c("raphael.setViewBox",this,this._viewBox,[t,e,i,r,n]);var s,a,l=o(i/this.width,r/this.height),h=this.top,u=n?"xMidYMid meet":"xMinYMin";for(null==t?(this._vbSize&&(l=1),delete this._vbSize,s="0 0 "+this.width+p+this.height):(this._vbSize=l,s=t+p+e+p+i+p+r),v(this.canvas,{viewBox:s,preserveAspectRatio:u});l&&h;)a="stroke-width"in h.attrs?h.attrs["stroke-width"]:1,h.attr({"stroke-width":a}),h._.dirty=1,h._.dirtyT=1,h=h.prev;return this._viewBox=[t,e,i,r,!!n],this},i.prototype.renderfix=function(){var t,e=this.canvas,i=e.style;try{t=e.getScreenCTM()||e.createSVGMatrix()}catch(i){t=e.createSVGMatrix()}var r=-t.e%1,n=-t.f%1;(r||n)&&(r&&(this._left=(this._left+r)%1,i.left=this._left+"px"),n&&(this._top=(this._top+n)%1,i.top=this._top+"px"))},i.prototype.clear=function(){i.eve("raphael.clear",this);for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null,(this.desc=v("desc")).appendChild(i._g.doc.createTextNode("Created with Raphaël "+i.version)),t.appendChild(this.desc),t.appendChild(this.defs=v("defs"))},i.prototype.remove=function(){for(var t in c("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this)this[t]="function"==typeof this[t]?i._removedFactory(t):null};var E=i.st;for(var T in C)C[t](T)&&!E[t](T)&&(E[T]=function(t){return function(){var e=arguments;return this.forEach((function(i){i[t].apply(i,e)}))}}(T))}}(),function(){if(i.vml){var t="hasOwnProperty",e=String,r=parseFloat,n=Math,s=n.round,o=n.max,a=n.min,l=n.abs,h="fill",c=/[, ]+/,u=i.eve,p=" ",f="",d={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},g=/([clmz]),?([^clmz]*)/gi,v=/ progid:\S+Blur\([^\)]+\)/g,m=/-?[^,\s-]+/g,y="position:absolute;left:0;top:0;width:1px;height:1px",x=21600,b={path:1,rect:1,image:1},w={circle:1,ellipse:1},_=function(t){var r=/[ahqstv]/gi,n=i._pathToAbsolute;if(e(t).match(r)&&(n=i._path2curve),r=/[clmz]/g,n==i._pathToAbsolute&&!e(t).match(r)){var o=e(t).replace(g,(function(t,e,i){var r=[],n="m"==e.toLowerCase(),o=d[e];return i.replace(m,(function(t){n&&2==r.length&&(o+=r+d["m"==e?"l":"L"],r=[]),r.push(s(t*x))})),o+r}));return o}var a,l,h=n(t);o=[];for(var c=0,u=h.length;c<u;c++){a=h[c],"z"==(l=h[c][0].toLowerCase())&&(l="x");for(var v=1,y=a.length;v<y;v++)l+=s(a[v]*x)+(v!=y-1?",":f);o.push(l)}return o.join(p)},S=function(t,e,r){var n=i.matrix();return n.rotate(-t,.5,.5),{dx:n.x(e,r),dy:n.y(e,r)}},k=function(t,e,i,r,n,s){var o=t._,a=t.matrix,c=o.fillpos,u=t.node,f=u.style,d=1,g="",v=x/e,m=x/i;if(f.visibility="hidden",e&&i){if(u.coordsize=l(v)+p+l(m),f.rotation=s*(e*i<0?-1:1),s){var y=S(s,r,n);r=y.dx,n=y.dy}if(e<0&&(g+="x"),i<0&&(g+=" y")&&(d=-1),f.flip=g,u.coordorigin=r*-v+p+n*-m,c||o.fillsize){var b=u.getElementsByTagName(h);b=b&&b[0],u.removeChild(b),c&&(y=S(s,a.x(c[0],c[1]),a.y(c[0],c[1])),b.position=y.dx*d+p+y.dy*d),o.fillsize&&(b.size=o.fillsize[0]*l(e)+p+o.fillsize[1]*l(i)),u.appendChild(b)}f.visibility="visible"}};i.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var C,E=function(t,i,r){for(var n=e(i).toLowerCase().split("-"),s=r?"end":"start",o=n.length,a="classic",l="medium",h="medium";o--;)switch(n[o]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":a=n[o];break;case"wide":case"narrow":h=n[o];break;case"long":case"short":l=n[o]}var c=t.node.getElementsByTagName("stroke")[0];c[s+"arrow"]=a,c[s+"arrowlength"]=l,c[s+"arrowwidth"]=h},T=function(n,l){n.attrs=n.attrs||{};var u=n.node,d=n.attrs,g=u.style,v=b[n.type]&&(l.x!=d.x||l.y!=d.y||l.width!=d.width||l.height!=d.height||l.cx!=d.cx||l.cy!=d.cy||l.rx!=d.rx||l.ry!=d.ry||l.r!=d.r),m=w[n.type]&&(d.cx!=l.cx||d.cy!=l.cy||d.r!=l.r||d.rx!=l.rx||d.ry!=l.ry),y=n;for(var S in l)l[t](S)&&(d[S]=l[S]);if(v&&(d.path=i._getPath[n.type](n),n._.dirty=1),l.href&&(u.href=l.href),l.title&&(u.title=l.title),l.target&&(u.target=l.target),l.cursor&&(g.cursor=l.cursor),"blur"in l&&n.blur(l.blur),(l.path&&"path"==n.type||v)&&(u.path=_(~e(d.path).toLowerCase().indexOf("r")?i._pathToAbsolute(d.path):d.path),"image"==n.type&&(n._.fillpos=[d.x,d.y],n._.fillsize=[d.width,d.height],k(n,1,1,0,0,0))),"transform"in l&&n.transform(l.transform),m){var T=+d.cx,N=+d.cy,B=+d.rx||+d.r||0,P=+d.ry||+d.r||0;u.path=i.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",s((T-B)*x),s((N-P)*x),s((T+B)*x),s((N+P)*x),s(T*x)),n._.dirty=1}if("clip-rect"in l){var I=e(l["clip-rect"]).split(c);if(4==I.length){I[2]=+I[2]+ +I[0],I[3]=+I[3]+ +I[1];var L=u.clipRect||i._g.doc.createElement("div"),M=L.style;M.clip=i.format("rect({1}px {2}px {3}px {0}px)",I),u.clipRect||(M.position="absolute",M.top=0,M.left=0,M.width=n.paper.width+"px",M.height=n.paper.height+"px",u.parentNode.insertBefore(L,u),L.appendChild(u),u.clipRect=L)}l["clip-rect"]||u.clipRect&&(u.clipRect.style.clip="auto")}if(n.textpath){var z=n.textpath.style;l.font&&(z.font=l.font),l["font-family"]&&(z.fontFamily='"'+l["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,f)+'"'),l["font-size"]&&(z.fontSize=l["font-size"]),l["font-weight"]&&(z.fontWeight=l["font-weight"]),l["font-style"]&&(z.fontStyle=l["font-style"])}if("arrow-start"in l&&E(y,l["arrow-start"]),"arrow-end"in l&&E(y,l["arrow-end"],1),null!=l.opacity||null!=l["stroke-width"]||null!=l.fill||null!=l.src||null!=l.stroke||null!=l["stroke-width"]||null!=l["stroke-opacity"]||null!=l["fill-opacity"]||null!=l["stroke-dasharray"]||null!=l["stroke-miterlimit"]||null!=l["stroke-linejoin"]||null!=l["stroke-linecap"]){var O=u.getElementsByTagName(h);if(!(O=O&&O[0])&&(O=C(h)),"image"==n.type&&l.src&&(O.src=l.src),l.fill&&(O.on=!0),null!=O.on&&"none"!=l.fill&&null!==l.fill||(O.on=!1),O.on&&l.fill){var R=e(l.fill).match(i._ISURL);if(R){O.parentNode==u&&u.removeChild(O),O.rotate=!0,O.src=R[1],O.type="tile";var D=n.getBBox(1);O.position=D.x+p+D.y,n._.fillpos=[D.x,D.y],i._preload(R[1],(function(){n._.fillsize=[this.offsetWidth,this.offsetHeight]}))}else O.color=i.getRGB(l.fill).hex,O.src=f,O.type="solid",i.getRGB(l.fill).error&&(y.type in{circle:1,ellipse:1}||"r"!=e(l.fill).charAt())&&A(y,l.fill,O)&&(d.fill="none",d.gradient=l.fill,O.rotate=!1)}if("fill-opacity"in l||"opacity"in l){var F=((+d["fill-opacity"]+1||2)-1)*((+d.opacity+1||2)-1)*((+i.getRGB(l.fill).o+1||2)-1);F=a(o(F,0),1),O.opacity=F,O.src&&(O.color="none")}u.appendChild(O);var V=u.getElementsByTagName("stroke")&&u.getElementsByTagName("stroke")[0],G=!1;!V&&(G=V=C("stroke")),(l.stroke&&"none"!=l.stroke||l["stroke-width"]||null!=l["stroke-opacity"]||l["stroke-dasharray"]||l["stroke-miterlimit"]||l["stroke-linejoin"]||l["stroke-linecap"])&&(V.on=!0),("none"==l.stroke||null===l.stroke||null==V.on||0==l.stroke||0==l["stroke-width"])&&(V.on=!1);var q=i.getRGB(l.stroke);V.on&&l.stroke&&(V.color=q.hex),F=((+d["stroke-opacity"]+1||2)-1)*((+d.opacity+1||2)-1)*((+q.o+1||2)-1);var H=.75*(r(l["stroke-width"])||1);if(F=a(o(F,0),1),null==l["stroke-width"]&&(H=d["stroke-width"]),l["stroke-width"]&&(V.weight=H),H&&H<1&&(F*=H)&&(V.weight=1),V.opacity=F,l["stroke-linejoin"]&&(V.joinstyle=l["stroke-linejoin"]||"miter"),V.miterlimit=l["stroke-miterlimit"]||8,l["stroke-linecap"]&&(V.endcap="butt"==l["stroke-linecap"]?"flat":"square"==l["stroke-linecap"]?"square":"round"),"stroke-dasharray"in l){var j={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};V.dashstyle=j[t](l["stroke-dasharray"])?j[l["stroke-dasharray"]]:f}G&&u.appendChild(V)}if("text"==y.type){y.paper.canvas.style.display=f;var Y=y.paper.span,W=d.font&&d.font.match(/\d+(?:\.\d*)?(?=px)/);g=Y.style,d.font&&(g.font=d.font),d["font-family"]&&(g.fontFamily=d["font-family"]),d["font-weight"]&&(g.fontWeight=d["font-weight"]),d["font-style"]&&(g.fontStyle=d["font-style"]),W=r(d["font-size"]||W&&W[0])||10,g.fontSize=100*W+"px",y.textpath.string&&(Y.innerHTML=e(y.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var $=Y.getBoundingClientRect();y.W=d.w=($.right-$.left)/100,y.H=d.h=($.bottom-$.top)/100,y.X=d.x,y.Y=d.y+y.H/2,("x"in l||"y"in l)&&(y.path.v=i.format("m{0},{1}l{2},{1}",s(d.x*x),s(d.y*x),s(d.x*x)+1));for(var U=["x","y","text","font","font-family","font-weight","font-style","font-size"],X=0,Q=U.length;X<Q;X++)if(U[X]in l){y._.dirty=1;break}switch(d["text-anchor"]){case"start":y.textpath.style["v-text-align"]="left",y.bbx=y.W/2;break;case"end":y.textpath.style["v-text-align"]="right",y.bbx=-y.W/2;break;default:y.textpath.style["v-text-align"]="center",y.bbx=0}y.textpath.style["v-text-kern"]=!0}},A=function(t,s,o){t.attrs=t.attrs||{};t.attrs;var a=Math.pow,l="linear",h=".5 .5";if(t.attrs.gradient=s,s=(s=e(s).replace(i._radial_gradient,(function(t,e,i){return l="radial",e&&i&&(e=r(e),i=r(i),a(e-.5,2)+a(i-.5,2)>.25&&(i=n.sqrt(.25-a(e-.5,2))*(2*(i>.5)-1)+.5),h=e+p+i),f}))).split(/\s*\-\s*/),"linear"==l){var c=s.shift();if(c=-r(c),isNaN(c))return null}var u=i._parseDots(s);if(!u)return null;if(t=t.shape||t.node,u.length){t.removeChild(o),o.on=!0,o.method="none",o.color=u[0].color,o.color2=u[u.length-1].color;for(var d=[],g=0,v=u.length;g<v;g++)u[g].offset&&d.push(u[g].offset+p+u[g].color);o.colors=d.length?d.join():"0% "+o.color,"radial"==l?(o.type="gradientTitle",o.focus="100%",o.focussize="0 0",o.focusposition=h,o.angle=0):(o.type="gradient",o.angle=(270-c)%360),t.appendChild(o)}return 1},N=function(t,e){this[0]=this.node=t,t.raphael=!0,this.id=i._oid++,t.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=e,this.matrix=i.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!e.bottom&&(e.bottom=this),this.prev=e.top,e.top&&(e.top.next=this),e.top=this,this.next=null},B=i.el;N.prototype=B,B.constructor=N,B.transform=function(t){if(null==t)return this._.transform;var r,n=this.paper._viewBoxShift,s=n?"s"+[n.scale,n.scale]+"-1-1t"+[n.dx,n.dy]:f;n&&(r=t=e(t).replace(/\.{3}|\u2026/g,this._.transform||f)),i._extractTransform(this,s+t);var o,a=this.matrix.clone(),l=this.skew,h=this.node,c=~e(this.attrs.fill).indexOf("-"),u=!e(this.attrs.fill).indexOf("url(");if(a.translate(1,1),u||c||"image"==this.type)if(l.matrix="1 0 0 1",l.offset="0 0",o=a.split(),c&&o.noRotation||!o.isSimple){h.style.filter=a.toFilter();var d=this.getBBox(),g=this.getBBox(1),v=d.x-g.x,m=d.y-g.y;h.coordorigin=v*-x+p+m*-x,k(this,1,1,v,m,0)}else h.style.filter=f,k(this,o.scalex,o.scaley,o.dx,o.dy,o.rotate);else h.style.filter=f,l.matrix=e(a),l.offset=a.offset();return r&&(this._.transform=r),this},B.rotate=function(t,i,n){if(this.removed)return this;if(null!=t){if((t=e(t).split(c)).length-1&&(i=r(t[1]),n=r(t[2])),t=r(t[0]),null==n&&(i=n),null==i||null==n){var s=this.getBBox(1);i=s.x+s.width/2,n=s.y+s.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",t,i,n]])),this}},B.translate=function(t,i){return this.removed?this:((t=e(t).split(c)).length-1&&(i=r(t[1])),t=r(t[0])||0,i=+i||0,this._.bbox&&(this._.bbox.x+=t,this._.bbox.y+=i),this.transform(this._.transform.concat([["t",t,i]])),this)},B.scale=function(t,i,n,s){if(this.removed)return this;if((t=e(t).split(c)).length-1&&(i=r(t[1]),n=r(t[2]),s=r(t[3]),isNaN(n)&&(n=null),isNaN(s)&&(s=null)),t=r(t[0]),null==i&&(i=t),null==s&&(n=s),null==n||null==s)var o=this.getBBox(1);return n=null==n?o.x+o.width/2:n,s=null==s?o.y+o.height/2:s,this.transform(this._.transform.concat([["s",t,i,n,s]])),this._.dirtyT=1,this},B.hide=function(){return!this.removed&&(this.node.style.display="none"),this},B.show=function(){return!this.removed&&(this.node.style.display=f),this},B._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},B.remove=function(){if(!this.removed&&this.node.parentNode){for(var t in this.paper.__set__&&this.paper.__set__.exclude(this),i.eve.unbind("raphael.*.*."+this.id),i._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape),this)this[t]="function"==typeof this[t]?i._removedFactory(t):null;this.removed=!0}},B.attr=function(e,r){if(this.removed)return this;if(null==e){var n={};for(var s in this.attrs)this.attrs[t](s)&&(n[s]=this.attrs[s]);return n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n.transform=this._.transform,n}if(null==r&&i.is(e,"string")){if(e==h&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var o=e.split(c),a={},l=0,p=o.length;l<p;l++)(e=o[l])in this.attrs?a[e]=this.attrs[e]:i.is(this.paper.customAttributes[e],"function")?a[e]=this.paper.customAttributes[e].def:a[e]=i._availableAttrs[e];return p-1?a:a[o[0]]}if(this.attrs&&null==r&&i.is(e,"array")){for(a={},l=0,p=e.length;l<p;l++)a[e[l]]=this.attr(e[l]);return a}var f;for(var d in null!=r&&((f={})[e]=r),null==r&&i.is(e,"object")&&(f=e),f)u("raphael.attr."+d+"."+this.id,this,f[d]);if(f){for(d in this.paper.customAttributes)if(this.paper.customAttributes[t](d)&&f[t](d)&&i.is(this.paper.customAttributes[d],"function")){var g=this.paper.customAttributes[d].apply(this,[].concat(f[d]));for(var v in this.attrs[d]=f[d],g)g[t](v)&&(f[v]=g[v])}f.text&&"text"==this.type&&(this.textpath.string=f.text),T(this,f)}return this},B.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&i._tofront(this,this.paper),this},B.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper)),this)},B.insertAfter=function(t){return this.removed?this:(t.constructor==i.st.constructor&&(t=t[t.length-1]),t.node.nextSibling?t.node.parentNode.insertBefore(this.node,t.node.nextSibling):t.node.parentNode.appendChild(this.node),i._insertafter(this,t,this.paper),this)},B.insertBefore=function(t){return this.removed?this:(t.constructor==i.st.constructor&&(t=t[0]),t.node.parentNode.insertBefore(this.node,t.node),i._insertbefore(this,t,this.paper),this)},B.blur=function(t){var e=this.node.runtimeStyle,r=e.filter;return r=r.replace(v,f),0!=+t?(this.attrs.blur=t,e.filter=r+p+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+t||1.5)+")",e.margin=i.format("-{0}px 0 0 -{0}px",s(+t||1.5))):(e.filter=r,e.margin=0,delete this.attrs.blur),this},i._engine.path=function(t,e){var i=C("shape");i.style.cssText=y,i.coordsize=x+p+x,i.coordorigin=e.coordorigin;var r=new N(i,e),n={fill:"none",stroke:"#000"};t&&(n.path=t),r.type="path",r.path=[],r.Path=f,T(r,n),e.canvas.appendChild(i);var s=C("skew");return s.on=!0,i.appendChild(s),r.skew=s,r.transform(f),r},i._engine.rect=function(t,e,r,n,s,o){var a=i._rectPath(e,r,n,s,o),l=t.path(a),h=l.attrs;return l.X=h.x=e,l.Y=h.y=r,l.W=h.width=n,l.H=h.height=s,h.r=o,h.path=a,l.type="rect",l},i._engine.ellipse=function(t,e,i,r,n){var s=t.path();s.attrs;return s.X=e-r,s.Y=i-n,s.W=2*r,s.H=2*n,s.type="ellipse",T(s,{cx:e,cy:i,rx:r,ry:n}),s},i._engine.circle=function(t,e,i,r){var n=t.path();n.attrs;return n.X=e-r,n.Y=i-r,n.W=n.H=2*r,n.type="circle",T(n,{cx:e,cy:i,r:r}),n},i._engine.image=function(t,e,r,n,s,o){var a=i._rectPath(r,n,s,o),l=t.path(a).attr({stroke:"none"}),c=l.attrs,u=l.node,p=u.getElementsByTagName(h)[0];return c.src=e,l.X=c.x=r,l.Y=c.y=n,l.W=c.width=s,l.H=c.height=o,c.path=a,l.type="image",p.parentNode==u&&u.removeChild(p),p.rotate=!0,p.src=e,p.type="tile",l._.fillpos=[r,n],l._.fillsize=[s,o],u.appendChild(p),k(l,1,1,0,0,0),l},i._engine.text=function(t,r,n,o){var a=C("shape"),l=C("path"),h=C("textpath");r=r||0,n=n||0,o=o||"",l.v=i.format("m{0},{1}l{2},{1}",s(r*x),s(n*x),s(r*x)+1),l.textpathok=!0,h.string=e(o),h.on=!0,a.style.cssText=y,a.coordsize=x+p+x,a.coordorigin="0 0";var c=new N(a,t),u={fill:"#000",stroke:"none",font:i._availableAttrs.font,text:o};c.shape=a,c.path=l,c.textpath=h,c.type="text",c.attrs.text=e(o),c.attrs.x=r,c.attrs.y=n,c.attrs.w=1,c.attrs.h=1,T(c,u),a.appendChild(h),a.appendChild(l),t.canvas.appendChild(a);var d=C("skew");return d.on=!0,a.appendChild(d),c.skew=d,c.transform(f),c},i._engine.setSize=function(t,e){var r=this.canvas.style;return this.width=t,this.height=e,t==+t&&(t+="px"),e==+e&&(e+="px"),r.width=t,r.height=e,r.clip="rect(0 "+t+" "+e+" 0)",this._viewBox&&i._engine.setViewBox.apply(this,this._viewBox),this},i._engine.setViewBox=function(t,e,r,n,s){i.eve("raphael.setViewBox",this,this._viewBox,[t,e,r,n,s]);var a,l,h=this.width,c=this.height,u=1/o(r/h,n/c);return s&&(r*(a=c/n)<h&&(t-=(h-r*a)/2/a),n*(l=h/r)<c&&(e-=(c-n*l)/2/l)),this._viewBox=[t,e,r,n,!!s],this._viewBoxShift={dx:-t,dy:-e,scale:u},this.forEach((function(t){t.transform("...")})),this},i._engine.initWin=function(t){var e=t.document;e.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!e.namespaces.rvml&&e.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),C=function(t){return e.createElement("<rvml:"+t+' class="rvml">')}}catch(t){C=function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},i._engine.initWin(i._g.win),i._engine.create=function(){var t=i._getContainer.apply(0,arguments),e=t.container,r=t.height,n=t.width,s=t.x,o=t.y;if(!e)throw new Error("VML container not found.");var a=new i._Paper,l=a.canvas=i._g.doc.createElement("div"),h=l.style;return s=s||0,o=o||0,n=n||512,r=r||342,a.width=n,a.height=r,n==+n&&(n+="px"),r==+r&&(r+="px"),a.coordsize=216e5+p+216e5,a.coordorigin="0 0",a.span=i._g.doc.createElement("span"),a.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",l.appendChild(a.span),h.cssText=i.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",n,r),1==e?(i._g.doc.body.appendChild(l),h.left=s+"px",h.top=o+"px",h.position="absolute"):e.firstChild?e.insertBefore(l,e.firstChild):e.appendChild(l),a.renderfix=function(){},a},i.prototype.clear=function(){i.eve("raphael.clear",this),this.canvas.innerHTML=f,this.span=i._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},i.prototype.remove=function(){for(var t in i.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas),this)this[t]="function"==typeof this[t]?i._removedFactory(t):null;return!0};var P=i.st;for(var I in B)B[t](I)&&!P[t](I)&&(P[I]=function(t){return function(){var e=arguments;return this.forEach((function(i){i[t].apply(i,e)}))}}(I))}}(),E.was?C.win.Raphael=i:Raphael=i}(t,t.eve)}(this),
/*! */
function(t){Raphael.fn.nestedSVG=function(e,i,r){var n=this,s=(arguments[0]instanceof Array||arguments[0],arguments[0]instanceof Array?arguments[0]:arguments[1]);function o(s,o){n.set(o);var a,l=new Raphael(e,i,r);return l.canvas.setAttribute("x",0),l.canvas.setAttribute("y",0),n.canvas.appendChild(l.canvas),a={move:function(t,e){l.canvas.setAttribute("x",t),l.canvas.setAttribute("y",e)}},t.extend(l,a),l}return o(0,s)}}(jQuery),jQuery,Raphael.fn.marker=function(){var t=this,e=(arguments[0]instanceof Array||arguments[0],arguments[0]instanceof Array?arguments[0]:arguments[1]);function i(e,i){t.set(i);var r=t.raphael.vml?document.createElement("marker"):document.createElementNS("http://www.w3.org/2000/svg","marker"),n=t.path("M2,2 L2,10 L10,6 L2,2");return n.node.setAttribute("fill","black"),t.defs.appendChild(r),r.appendChild(n.node),{scale:function(t,e){var i=r.getAttribute("transform");return r.attr("transform",updateScale(i,t,e)),this},move:function(t,e){r.setAttribute("x",t),r.setAttribute("y",e)},attr:function(t,e){r.setAttribute(t,e)},attrs:function(t){for(var e in t)r.setAttribute(e,t[e])},type:"marker",node:r}}return i(0,e)},
/*! */
function(t){Raphael.fn.group=function(){var e=this,i=(arguments[0]instanceof Array||arguments[0],arguments[0]instanceof Array?arguments[0]:arguments[1]);function r(i,r){e.set(r);var n,s=e.raphael.vml?document.createElement("group"):document.createElementNS("http://www.w3.org/2000/svg","g");return e.canvas.appendChild(s),s.canvas=s,n={setScale:function(t){return e.raphael.vml?this.forEach((function(e){var i=e.data("rotation")||0;e.transform("S"+t+","+t+", 0, 0, r"+i)})):s.setAttribute("transform","scale("+t+")"),this},getScale:function(){var t=s.getAttribute("transform");return null===t&&(t="scale(1)"),t.replace("scale(","").replace(")","")}},t.extend(n,e),n.scale=n.setScale,n.canvas=s,n[0]=s,n.type="group",n.node=s,n}return r(0,i)}}(jQuery),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.graphicquery",{},{init:function(t,e,i){this.subprocesses=[],this.currentTasks=[],this.path=[],this.callStack=[],this.currentWorkflow={idCase:i.data.idCase,idWorkflow:i.data.idWorkflow},this._super(t,e,i),this.loadTemplates({"graphicquery-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-webpart-graphicquery"),"graphicquery-tooltip-currenttask":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-webpart-graphicquery-tooltip-currenttask"),"graphicquery-tooltip-subcases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-webpart-graphicquery-tooltip-subcases"),"graphicquery-subcases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-webpart-graphicquery-subcases"),"graphicquery-parentsummary":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-webpart-graphicquery-parentsummary"),"graphicquery-summary":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-webpart-graphicquery-summary"),"graphicquery-tooltip-users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-webpart-graphicquery-tooltip-users"),"graphicquery-actionbar":bizagi.getTemplate("bizagi.workportal.desktop.widgets.graphicquery").concat("#ui-bizagi-webpart-graphicquery-actionbar"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GRAPHIC_QUERY},renderContent:function(){var t=this.getTemplate("graphicquery-wrapper");return this.content=$.tmpl(t)}}),bizagi.workportal.widgets.graphicquery.extend("bizagi.workportal.widgets.graphicquery",{},{postRender:function(){this.dateFormat=this.getResource("dateFormat")+" "+this.getResource("timeFormat"),this.$header=$(".bz-gq-header",this.content),this.$actionBar=$("#bz-gq-actionbar-container",this.$header),this.$pvCanvas=$("#bz-gq-processviewer-canvas",this.content),this.$summary=$("#bz-gq-summary-container",this.$header),this.instanceBizagiGraphicQuery=new bizagi.graphicquery(this),this.renderProcessViewer(),this.eventsHandler()},renderProcessViewer:function(){return this.instanceBizagiGraphicQuery.renderProcessViewer()},eventsHandler:function(){return this.instanceBizagiGraphicQuery.eventsHandler()}});
//# sourceMappingURL=../../../../Maps/desktop/timeline.desktop.production.js.map
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.render=void 0!==bizagi.render?bizagi.render:{},bizagi.render.services=void 0!==bizagi.render.services?bizagi.render.services:{},bizagi.render.services.endPoints=[],bizagi.render.services.getEndPoints=function(e){var t="Rest/Handlers/Render";return"workflow"==e.context?{"form-get-data":e.proxyPrefix+t,"form-submit-data":e.proxyPrefix+t,"form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload","render-property-refresh":e.proxyPrefix+t,"render-multiaction":e.proxyPrefix+"Rest/Handlers/MultiAction","render-upload-cancel-image":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload","render-upload-delete-url":e.proxyPrefix+t,"render-ecm-upload-url":e.proxyPrefix+"Rest/Handlers/Metadata","render-multiaction-metadata":e.proxyPrefix+"Rest/Handlers/MetadataMultiAction","render-grid-edit-url":e.proxyPrefix+t,"render-grid-save-url":e.proxyPrefix+t,"render-grid-add-url":e.proxyPrefix+t,"render-grid-rollback-url":e.proxyPrefix+t,"render-grid-commit-url":e.proxyPrefix+t,"render-grid-checkpoint-url":e.proxyPrefix+t,"render-save-entity":e.proxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":e.proxyPrefix+"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter","render-letter-save-url":e.proxyPrefix+t,"render-letter-content-icons":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.proxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.proxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.proxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}","render-entity-layout-upload-files":e.proxyPrefix+"Api/Entities/{entity}/Files/{surrogateKey}/Array?xpath={xpath}","render-query-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsersForQueryFormsById/{queryFormId}/","case-handler-getCaseSummary":e.proxyPrefix+"Rest/Cases/{idCase}/SummaryGuid","case-handler-getCaseSummaryByGuid":e.proxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/AssigneesGuid","case-handler-getWorkItems":e.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid","admin-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsers","admin-getUsersList-FromPreferences":e.proxyPrefix+"Rest/Users/SearchUsersFromPreferences","admin-getUsersList-ForStakeholders":e.proxyPrefix+"Rest/Users/SearchUsersForStakeholders","admin-getUsersList-ForXpathIdBossUser":e.proxyPrefix+"Rest/Users/SearchUsersForBosses","admin-getUsersList-ForXpathIdDelegate":e.proxyPrefix+"Rest/Users/SearchUsersForDelegates","admin-getUsersForAssignation":e.proxyPrefix+"Rest/Users/UsersForAssignation","admin-users-config":e.proxyPrefix+"Api/Authentication/BizagiConfig","admin-usersform":e.proxyPrefix+"Rest/Handlers/Render","admin-GenerateDataToSendByEmail":e.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendUserEmail":e.proxyPrefix+"Rest/Users/SendUserEmail"}:"sharepoint"==e.context||"portal"==e.context?(void 0===e.sharepointProxyPrefix&&alert("sharepointProxyPrefix param is requiered to build endpoints when context is 'sharepoint'"),{"form-get-data":e.sharepointProxyPrefix+t,"form-submit-data":e.sharepointProxyPrefix+t,"form-submit-data-upload":e.sharepointProxyPrefix+"Rest/Handlers/Render/Upload","render-property-refresh":e.sharepointProxyPrefix+t,"render-multiaction":e.sharepointProxyPrefix+"Rest/Handlers/MultiAction","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.sharepointProxyPrefix+"Rest/Handlers/RenderFile","render-upload-add-url":e.sharepointProxyPrefix+"Rest/Handlers/Render/Upload","render-upload-delete-url":e.sharepointProxyPrefix+t,"render-ecm-upload-url":e.sharepointProxyPrefix+"Rest/Handlers/Metadata","render-grid-edit-url":e.sharepointProxyPrefix+t,"render-grid-save-url":e.sharepointProxyPrefix+t,"render-grid-add-url":e.sharepointProxyPrefix+t,"render-grid-rollback-url":e.sharepointProxyPrefix+t,"render-grid-commit-url":e.sharepointProxyPrefix+t,"render-grid-checkpoint-url":e.sharepointProxyPrefix+t,"render-save-entity":e.sharepointProxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":"jquery/css/bizagi/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.sharepointProxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.sharepointProxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.sharepointProxyPrefix+"Rest/Handlers/Letter","render-letter-content-url":e.sharepointProxyPrefix+"Rest/Handlers/Letter","render-letter-save-url":e.sharepointProxyPrefix+t,"render-letter-content-icons":"jquery/css/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.sharepointProxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.sharepointProxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.sharepointProxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}","case-handler-getCaseSummary":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-getCaseSummaryByGuid":e.sharepointProxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getWorkItems":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid"}):"entitymanagement"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=entity","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=entity","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile?h_contexttype=entity","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=entity","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=entity","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=entity","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=entity","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=entity","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:"search"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=metadata","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=metadata","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile?h_contexttype=metadata","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=metadata","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=metadata","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=metadata","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=metadata","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:{}},$.Class.extend("bizagi.render.services.context",{},{init:function(e){this.context=e.context,this.endPoints=bizagi.render.services.getEndPoints(e),this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix},getUrl:function(e){return null==this.endPoints[e]&&alert("No endpoint defined for: "+e),this.endPoints[e]},setProxyPrefix:function(e){this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.endPoints=bizagi.render.services.getEndPoints(e)}}),$.Class.extend("bizagi.render.services.service",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId",BA_MULTIACTION_WITH_LIMIT_NUMBER:5,BA_MULTIACTION_WITH_LIMIT_QUEUE:"multiaction"},{init:function(e){(e=e||{}).context=e.context||"workflow",e.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.serviceLocator=new bizagi.render.services.context(e),this.multiactionService=new bizagi.render.services.multiactionservice(this),this.multiactionServiceWithLimit=new bizagi.render.services.multiactionservice(this,this.Class.BA_MULTIACTION_WITH_LIMIT_NUMBER,this.Class.BA_MULTIACTION_WITH_LIMIT_QUEUE),this.guid=Math.guid(),bizagi.override.enableECMMetadataMultiaction&&(this.multiactionMetadataService=new bizagi.render.services.metadatamultiactionservice(this)),this.userfieldRequests={},this.deviceType=e.deviceType||(bizagi.util.isSmartphoneDevice()?bizagi.deviceEnum.smartphone:bizagi.util.isTabletDevice()?bizagi.deviceEnum.tablet:bizagi.deviceEnum.desktop),this.deviceCode=bizagi.util.getDeviceCode()},multiaction:function(){return this.multiactionService},multiactionWithLimit:function(){return this.multiactionServiceWithLimit},metadataECMMultiaction:function(){return bizagi.override.enableECMMetadataMultiaction?this.multiactionMetadataService:this},getFormData:function(e){if(e&&e.data)return e.data;e=e||{};var t={};if(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action||"LOADFORM",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,e.idProcess&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idProcess"]=e.idProcess),e.idOrganization&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idOrganization"]=e.idOrganization),e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.idEntity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEntity"]=e.idEntity),e.surrogateKey&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey),e.idRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.requestedForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"requestedForm"]=e.requestedForm),e.recordXPath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordXPath"]=e.recordXPath),e.summaryForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"summaryForm"]=e.summaryForm),e.idCase&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idWorkitem&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.idTask&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idTask"]=e.idTask),e.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.contextType&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contextType),e.guidEntity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),bizagi.util.isEmpty(e.isRefresh)||(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isRefresh"]=e.isRefresh),e.isActionStartForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=e.isActionStartForm),e.additionalXpaths&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),void 0!==e.readOnlyForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"readonlyform"]=e.readOnlyForm),void 0!==e.printversion&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"printForm"]=e.printversion),void 0!==e.recordXpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.guid&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guid"]=e.guid),e.downloadOfflineForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"downloadofflineform"]=1),!1===e.editable&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"DisplayFormAsReadOnly"]=!0),e.printversion){e[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"]&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"]=e[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"])}if(e.prepare)return t;bizagi.chrono.initAndStart("data");var i={url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:e.action||"LOAD"};return e.downloadOfflineForm&&(i.avoidLoader=!0),$.ajax(i).pipe((function(i){if(bizagi.chrono.stopAndLog("data"),e.printversion)try{i.form.properties.editable="False";i=function e(i){return null==i?i:(i.hasOwnProperty("type")&&"grid"==i.type?(i.id=t.id+"-print",i.allowAdd="False",i.allowDelete="False",i.allowEdit="False",i.allowGrouping="False",i.allowMore="False",i.allowSearch="False"):$.each(t,(function(t,r){"object"==_typeof(r)&&(i[t]=e(i[t]))})),i)}(i)}catch(e){}return i}))},getSearchFormData:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHFORM",e.xpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idSearchForm&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm),e.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-search-form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"SEARCHFORM"})},processDataValues:function(e){var t;for(t in e=$.extend(!0,{},e))e.hasOwnProperty(t)&&"object"==$.type(e[t])&&e[t].hasOwnProperty("id")&&(e[t]=e[t].id);return e},submitData:function(e){data=this.resolveData(e.data||{},e.xpathContext),data=this.processDataValues(data),data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action,(e=e||{}).xpath&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idPageCache&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.guidEntity&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),e.contexttype&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.transitions&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"transitions"]=e.transitions),e.surrogatekey&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.forcePlanCompletion&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"forcePlanCompletion"]=e.forcePlanCompletion);var t=e.action.toString().toUpperCase();return bizagi.debug("Data sent",data),e.prepare?data:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:data,type:"POST",dataType:"json",serviceType:t,beforeSend:function(e,t){e.renderingService=!0}})},resolveData:function(e,t){var i,r,a;if(!$.isEmptyObject(e)&&t&&-1!==t.search(/\[id=\d+\]/))for(i in e)-1!==i.search(/\[id=\d+\]/)&&t==i.substr(0,i.search(/\]/)+1)&&(r=i.substr(i.search(/\]/)+2),a=e[i],e[r]=a,delete e[i]);return e},getPropertyData:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,e.sessionId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.guidentity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.surrogatekey&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.pxpath&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpath"]=e.pxpath),e.prows&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.prows),e.ppage&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.ppage),null!=e.pfilter&&null!=e.pfilter&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"filter"]=e.pfilter),null!=e.psort&&null!=e.psort&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.psort),e.porder&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.porder),e.pcaseId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"caseId"]=e.pcaseId),e.pguidEntity&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidEntity"]=e.pguidEntity),e.psurrogatedKey&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.psurrogatedKey),e.pactionXpath&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"actionXpath"]=e.pactionXpath),e.ptemplateGuid&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"templateGuid"]=e.ptemplateGuid),e.pparameters&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"parameters"]=e.pparameters),bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},getData:function(e){return this.getPropertyData($.extend(e,{property:"data"}))},getSearchData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"term"]=e.term,this.getPropertyData($.extend(e,{property:"data"}))},getCollapseData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"collapseState"]=e.collapseState,this.getPropertyData($.extend(e,{property:"collapseState"}))},getGridData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.order,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,this.getPropertyData($.extend(e,{property:"data"}))},getGridDataExclusivesSelected:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathfilter"]=e.xpathfilter,this.getPropertyData($.extend(e,{property:"exclusivesSelected"}))},getUploadCancelImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-upload-cancel-image")},getUploadFileUrl:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)+"&xsrf="+bizagi.getXSRFToken()},downloadFile:function(e){var t=this,i=t.getUploadFileUrl(e);return $.ajax({url:i,type:"GET",queue:e.queue,dataType:"binary",processData:!1}).then((function(e){if("application/json"==e.type)return t.readFileAsJSON(e);if("string"==typeof e){var i=arguments[2],r=i.getResponseHeader("Content-type");e=bizagi.util.media.byteArrayToBlob(t.stringToByteArray(e),r)}return e}))},readFileAsJSON:function(e){var t=new $.Deferred,i=new FileReader;return i.onloadend=function(){t.reject({responseText:i.result})},i.readAsText(e),t.promise()},stringToByteArray:function(e){return bizagi.util.stringToByteArray(e)},getUploadFileEntityUrl:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)},getUploadAddUrl:function(){var e=this.serviceLocator.getUrl("render-upload-add-url"),t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDFILE",this.verifyPathToBase(bizagi.services.ajax.pathToBase,e)+"?"+jQuery.param(t)},getUploadAddFileUrl:function(e){var t=this.serviceLocator.getUrl("form-submit-data-upload"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=!0===e?"SAVEUSERIMAGE":"savefile",this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)},deleteImage:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="DELETEUSERIMAGE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing image '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},deleteUploadFile:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing file in upload '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},getECMMetadata:function(e){var t=e.extra||{};return t.action="getECMMetadata",t.idFileUpload=e.idFileUpload,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,t.xPath=e.xPath,t.idAttrib=e.idAttrib,e.sessionId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),bizagi.debug("Get file metadata '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},checkOutFile:function(e){var t=e.extra||{};return t.action="checkOutFile",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},cancelCheckOut:function(e){var t=e.extra||{};return t.action="cancelCheckOut",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},deleteECMFile:function(e){var t=e.extra||{};return t.action="delete",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("delete file'"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMFileContent:function(e){var t=e.extra||{};return t.action="updateECMFileContent",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file content '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMMetadata:function(e){var t=e.extra||{};return t.action="updateECMMetadata",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file meta data '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getFileProperties:function(e){var t=e.extra||{};return t.action="getFileProperties",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Get file properties '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},getFile:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},getAllDocuments:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),i={};return i.contextXpath=e.xpathContext,i.xpathAttribute=e.xpath,i.idCase=e.idCase,i.idWorkItem=e.idWorkItem,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},getUploadFileEntity:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},uploadECMFile:function(e){var t=e.extra||{};return t.action="uploadECMFile",t.fileUpload=e.fileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.fileName=e.fileName,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Upload ECM file '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getECMFileUrl:function(e){var t=e.url||this.serviceLocator.getUrl("render-ecm-upload-url")+"File",i=e.extra||{};return i.action="viewECMFile",i.idFileUpload=e.idFileUpload,i.xPath=e.xPath,i.idAttrib=e.idAttrib,i.fileName=e.fileName,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i.xpathContext=e.xpathContext,e.sessionId&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.p_sessionId&&(i.p_sessionId=e.p_sessionId),bizagi.debug("View uploaded file '"+e.xPath+"'",i),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)+"&xsrf="+bizagi.getXSRFToken()},isFileOnECM:function(e){var t={action:"isFileOnECM"};return t.idUpload=e.idUpload,$.read(this.serviceLocator.getUrl("render-ecm-upload-url"),t)},editGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EDITRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending edit request for relation '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-edit-url"),data:t,type:"POST",dataType:"json",serviceType:"EDITRELATION"})},addGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Sending add request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATION"})},addGridRecordData:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATIONWITHDATA",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype);var i=this.processDataValues(e.submitData||{});for(key in i)t[key]=i[key];return bizagi.debug("Sending add request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATIONWITHDATA"})},saveGridRecord:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disableServerGridValidations"]=e.disableServerGridValidations||!1,e.submitData.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var i=e.submitData||{};for(key in i=this.processDataValues(i))t[key]=i[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVERELATION"})},deleteGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending delete request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"REMOVERELATION"})},getFlipAssociation:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.id,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="flipped",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"flipstate"]=e.flipstate,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending request for flip association control '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:"text"}).pipe((function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}}))},rollbackGridAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ROLLBACK",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-rollback-url"),data:t,type:"POST",dataType:"json",serviceType:"ROLLBACK"})},getSearchDefaultImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-search-default-image")},processDataCriteria:function(e){var t;for(t in e=$.extend(!0,[],e))e.hasOwnProperty(t)&&e[t].hasOwnProperty("value")&&"object"==$.type(e[t].value)&&e[t].value.hasOwnProperty("id")&&e[t].value.hasOwnProperty("label")&&(e[t].value=e[t].value.id);return e},submitSearch:function(e){var t,i=e.extra||{},r=e.sort&&""!==e.sort?e.sort:"";return e.order&&""!==e.order&&""!==r&&(r+=" "+e.order),i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHENTITYFORRENDER",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=r,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"pageSize"]=e.rows,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,t=this.processDataCriteria(e.criteria),i[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchCriteria"]=JSON.encode(t),e.allowFullSearch&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"allowFullSearch"]=e.allowFullSearch),e.maxRecords&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxRowsAllowed"]=e.maxRecords),bizagi.debug("Performing advanced search",i),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-search-advanced-url"),data:i,type:"POST",dataType:"json",serviceType:"SEARCHENTITYFORRENDER"})},associateStakeholder:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey,t.associatedUser=e.associatedUser,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity,bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:e.dataType||"json"})},refreshAssociateStakeholder:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getLetterNotEditableUrl:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache;var i=e.url||this.serviceLocator.getUrl("render-letter-notEditable-url");return this.verifyPathToBase(bizagi.services.ajax.pathToBase,i)+"?"+jQuery.param(t)},getLetterContent:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-letter-content-url"),data:t,type:"POST",dataType:"html"}).pipe((function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}}))},getCanGenerateLetter:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CANGENERATELETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:this.serviceLocator.getUrl("render-letter-content-url"),data:t,type:"POST",dataType:"json"})},saveLetterContent:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="UPDATELETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache;var i=e.content||"",r=(e.url||this.serviceLocator.getUrl("render-letter-save-url"))+"?"+jQuery.param(t);return bizagi.debug("Save request for letter sent to: "+r,i),e.prepare?t:$.ajax({url:r,data:i,type:"POST",dataType:"html"})},getLetterEditorIconsPath:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-letter-content-icons")},executeButton:function(e){return this.getPropertyData($.extend(e,{property:"buttonRule"}))},getFilePrint:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="data",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},editLinkForm:function(e){return this.editGridRecord(e)},saveLinkForm:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVEFORMLINKRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.submitData.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var i=e.submitData||{};for(key in i=this.processDataValues(i))t[key]=i[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVEFORMLINKRELATION"})},rollbackLinkForm:function(e){return this.rollbackGridAction(e)},commitLinkForm:function(e){return this.commitGridAction(e)},sendCheckpoint:function(e){return this.sendCheckpointAction(e)},getUserfieldDefinition:function(e){return e=e||{},this.userfieldRequests[e.userfield]?this.userfieldRequests[e.userfield]:(this.userfieldRequests[e.userfield]=$.read(this.serviceLocator.getUrl("render-userfield-definition"),{guidUserfield:e.userfield,device:e.device||"desktop"}),this.userfieldRequests[e.userfield])},refreshControl:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESH",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"PARTIALREFRESH"})},refreshGridCell:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESHGRIDCELL",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidcolumn"]=e.column,e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.typeRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"typeRender"]=e.typeRender),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json"})},executeRule:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTERULE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidrule"]=e.rule||"",e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeInterface:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEINTERFACE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidinterface"]=e.interface||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeSAPConnector:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTESAP",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidsap"]=e.guidsap||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeConnector:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTECONNECTOR",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidConnector"]=e.guidConnector||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executePipeline:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEPIPELINE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidpipeline"]=e.pipeline||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},generateDocumentTemplate:function(e){return(e=e||{}).append=!!e.append&&e.append,$.create(this.serviceLocator.getUrl("render-document-generate"),{h_pageCacheId:e.idPageCache,contextXpath:e.xpathcontext,groupMappingId:e.groupMapping,xpathAttribute:e.xpath,append:e.append,controlId:e.id})},getAllDocumentsDownloadUrl:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),i={};return i.h_pageCacheId=e.idPageCache,i.contextXpath=e.xpathContext,i.xpathAttribute=e.xpath,i.idCase=e.idCase,i.idWorkItem=e.idWorkItem,i.p_sessionId=e.sessionId,this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)+"&xsrf="+bizagi.getXSRFToken()},getCaseNumber:function(e){return $.ajax({url:this.serviceLocator.getUrl("case-handler-getCaseSummary").replace("{idCase}",e.idCase)+"?eventAsTasks=false&onlyUserWorkItems=true&mobileDevice="+bizagi.isMobile(),type:"GET",dataType:"json"})},getCaseAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:e.idCase}).pipe((function(e){return e}))},getWorkitems:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getWorkItems"),{idCase:e.idCase,onlyUserWorkItems:e.onlyUserWorkItems||""})},getGridExportFile:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.exportType,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"idForm"]=e.idForm,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},sendEmail:function(e){e=e||{};var t={};if(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"sendEmail",e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_ACTION_PARAMETER_PREFIX+"to"]=e.to,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"subject"]=e.subject,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"message"]=e.message,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"selected"]=JSON.encode(e.selected),e.prepare)return t;var i=e.url||this.serviceLocator.getUrl("form-get-data");return $.create(i,t)},invalidatePageCache:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="INVALIDATEPAGECACHE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:t,type:"POST",dataType:"json",serviceType:"INVALIDATEPAGECACHE"})},getUsersList:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList"),e)},getUsersListFromQueryForm:function(e){return $.read(this.serviceLocator.getUrl("render-query-getUsersList"),e)},getUsersListFromPreferences:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-FromPreferences"),e)},getUsersListForXpathIdBossUser:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForXpathIdBossUser"),e)},getUsersListForXpathIdDelegate:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForXpathIdDelegate"),e)},getUsersListForStakeholders:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForStakeholders"),e)},getUsersForAssignation:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersForAssignation"),e)},getUsersForm:function(e){return $.create(this.serviceLocator.getUrl("admin-usersform"),e)},generateDataToSendByEmail:function(e){return e=e||{},$.ajax({url:this.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:e,type:"POST",dataType:"json"})},sendUserEmail:function(e){(e=e||{}).eMailTo,e.subject,e.body;return $.ajax({url:this.serviceLocator.getUrl("admin-sendUserEmail"),data:e,type:"POST",dataType:"json"})},getConfiguration:function(){var e=this.serviceLocator.getUrl("admin-users-config");return $.read(e)},verifyPathToBase:function(e,t){return-1!=t.indexOf("http")&&""!=e?t:e+t},getTemplate:function(e){var t={};e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADTEMPLATE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]="entity",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guid,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isProcessData"]=e.forcePersonalizedColumns,e.templateType&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"templatetype"]=e.templateType),e.templateGuid&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"templateguid"]=e.templateGuid),null!=e.isDefaultTemplate&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isDefaultTemplate"]=e.isDefaultTemplate);var i=bizagi.util.detectDevice();return bizagi.util.isTabletDevice()?i="tablet":bizagi.util.isSmartphoneDevice()&&(i="mobile"),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=i,e.prepare?t:$.create(this.serviceLocator.getUrl("form-get-data"),t)},hasStartForm:function(e){var t={};return e.guidWFClass&&(t.guidWFClass=e.guidWFClass),$.read(this.serviceLocator.getUrl("render-processes-startform"),t)},getStartForm:function(e){var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADSTARTFORM",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidprocess"]=e.guidprocess,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=!0,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idCase&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idWorkitem&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.additionalXpaths&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.surrogatedKey&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.surrogatedKey),e.recordXpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.mappingstakeholders&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"mappingstakeholders"]=e.mappingstakeholders),$.ajax({url:this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",cache:!0})},editActionForm:function(e){return this.editGridRecord(e)},getActions:function(e){var t=$.extend(e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.ptags&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.pmaxitems&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxitems"]=e.pmaxitems),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},executeActions:function(e){var t=$.extend({},e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.pguidConstructor&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidConstructor"]=e.pguidConstructor),e.pguidAction&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidAction"]=e.pguidAction),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getPolymorphicActions:function(e){var t=$.extend(e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.ptags&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.additionalXpaths&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},serializePolymorphicActions:function(e){var t=[],i=function t(i){i=i||{};var r="";return $.each(e,(function(e,a){a[0]==i[6]&&(r+=t(a)+a[1]+" > ")})),r};return function t(r,a){var n,o=function(t){var i=[];return t=t||"",$.each(e,(function(e,r){r[6]==t&&i.push(r)})),i}(a);return $.each(o,(function(e,a){var o=t([],a[0]);(""!==(n={guidEntity:a[0],displayName:a[1],hasConstructor:!!a[5],type:a[3],guidObject:a[4],guidConstructor:a[5],xpathContext:a[2],children:o,parents:i(a)}).guidConstructor||n.children.length>0)&&r.push(n)})),r}(t,""),t},getEntityImage64:function(e){var t={width:e.data,height:e.height,xpath:e.xpath},i=this.serviceLocator.getUrl("render-entity-layout-image64").replace("{entity}",e.entity).replace("{surrogateKey}",e.surrogateKey);return $.ajax({url:i,data:t})},getFilesDataForLayoutUploadControl:function(e){return $.read(this.serviceLocator.getUrl("render-entity-layout-upload-files"),e)},processUploadFile:function(e){return $.ajax({url:this.verifyMobilePathToBase(bizagi.services.ajax.pathToBase||"",e.url),data:e.formData,type:"POST",contentType:!1,processData:!1})},commitGridAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="COMMIT",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-commit-url"),data:t,type:"POST",dataType:"json",serviceType:"COMMIT"})},sendCheckpointAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CHECKPOINT",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending checkpoint request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-checkpoint-url"),data:t,type:"POST",dataType:"json",serviceType:"CHECKPOINT"})},verifyMobilePathToBase:function(e,t){return bizagi.util.isMashupContext()?(t||"").replaceAll(e,""):t}}),$.Class.extend("bizagi.render.services.multiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(e,t,i){this.service=e,this.serviceLocator=e.serviceLocator,this.batch={},this.batchTimer=50,this.maxNumberOfActions=t||0,this.queue=i||null,this.deferredBatchExecuting=$.Deferred(),this.deferredBatchExecuting.resolve(),this.disabledRequests=!1,this.circularDependencies=new bizagi.circularDependencies,this.replicateServiceMethods()},getService:function(){return this.service},replicateServiceMethods:function replicateServiceMethods(){var self=this;for(var key in this.service.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"multiaction"!=key&&(self[key]=eval("var tmp = function(){ return this.proxyMethod(this.getService()."+key+", arguments);};tmp"))},proxyMethod:function(e,t){var i=this.service;if(!t||1!=t.length)return e.apply(i,t);if("object"!=_typeof(t[0]))return e.apply(i,t);var r=t[0];if(1==r.prepare)return e.apply(i,t);var a=r.prepare;r.prepare=!0;var n=e.apply(i,t);return void 0===a||null==a?delete r.prepare:r.prepare=a,this.add(n)},makeCircularDependenciesError:function(e){var t=bizagi.localization.getResource("render-actions-loop-validation");return printf(t,e.dependencyFrom,e.dependencyTo)},add:function(e){var t=this,i=new $.Deferred,r=e.h_action||"unnamed";["PROCESSPROPERTYVALUE","LOADTEMPLATE","ADDRELATIONWITHDATA","GETFILE"].indexOf(r)<0&&bizagi.override.detectCircularDependencies&&t.circularDependencies.addNode(r,e),clearTimeout(t.batchTimeout);var a=e.tag=Math.guid(),n={action:e,deferred:i};t.batch[a]=n;var o=function(){var e=t.circularDependencies.resolve();if(e.error){for(var i in t.batch){var r=e.error.multiactionError;t.batch[i].deferred.reject(r)}t.batch={}}else t.disabledRequests||(t.deferredBatchExecuting=t.fire())};return t.batchTimeout=setTimeout(o,t.batchTimer),0!=t.maxNumberOfActions&&Object.keys(t.batch).length>=t.maxNumberOfActions&&(clearTimeout(t.batchTimeout),o()),i.promise()},fire:function(){var e={},t=[];return $.each(this.batch,(function(i,r){t.push(r.action),e[i]=r})),this.batch={},$.when(this.execute({actions:t,rejectDeferreds:!1})).done((function(t){$.each(t,(function(t,i){var r=i.tag;i.error?e[r].deferred.reject(i.error,i,i.error.message):e[r].deferred.resolve(i.result),delete e[r]})),$.each(e,(function(e,t){t.deferred.reject({type:"not-processed",message:"Operation didn't executed"},"","Operation didn't executed")}))})).fail((function(t,i,r){var a=void 0!==r?r.message:r||"Operation didn't executed";$.each(e,(function(e,t){t.deferred.reject({type:"not-processed",message:a},"","Operation didn't executed")}))}))},execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,(function(e,i){i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=i.tag||e,delete i.tag})),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action",r);var n=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction"),data:r,queue:this.queue,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){e.renderingService=!0,bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done((function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void n.reject(t.error,"servererror",t)}n.resolve(e)})).fail((function(e){var t=e.responseText||e,i={};try{i=JSON.parse(t)}catch(e){}n.reject(e,"servererror",i)})),n.promise()},disableRequests:function(){this.disabledRequests=!0},validateIfBatchIsExecuting:function(){return this.deferredBatchExecuting}}),bizagi.render.services.multiactionservice.extend("bizagi.render.services.metadatamultiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"h_pageCacheId"},{execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,(function(e,i){i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=i.tag||e,i[t.Class.BA_PAGE_CACHE]&&(r[t.Class.BA_PAGE_CACHE]=i[t.Class.BA_PAGE_CACHE]),delete i[t.Class.BA_PAGE_CACHE],delete i.tag})),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action metadata",r);var n=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction-metadata"),data:r,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done((function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void n.reject(this,"servererror",t)}n.resolve(e)})).fail((function(e){var t,i=e.responseText||e;try{t=JSON.parse(i)}catch(e){}n.reject(e,"servererror",t)})),n.promise()}}),$.Class.extend("bizagi.command.controllers.controller",{THROW_ERROR:!0},{init:function(e){this.form=e,this.dateFormat=e.getResource("dateFormat")},buildConditions:function(e,t,i,r){var a=e.expressions&&e.expressions.length>1?this.buildConditionOperator(e.operator):e.operator;if(r=r||[],t=t||!1,i=i||!1,"true"==a)return"true";if("false"==a)return"false";for(var n="",o=0;o<e.expressions.length;o++){var s=e.expressions[o];if(s.simple){var l=this.searchGridReferenceInCondition(s.simple);n+=this.buildSimpleCondition(s.simple,l,i,r)}else s.complex&&(n+="("+this.buildConditions(s.complex,t,i,r)+") ");n+=o<e.expressions.length-1?a:""}return n},buildConditionOperator:function(e){return"and"==e?" && ":"or"==e?" || ":e},buildSimpleCondition:function(e,t,i,r){var a,n,o="",s=e.operator,l="",d="";t=t||!1,i=i||!1;var u=e.xpath&&e.renderId?e.xpath+"."+e.renderId:e.xpath||e.renderId||e.containerId;if(t&&e.containerId){var c=this.processGridXpath(e.xpath);u=c.gridXpath+"."+e.containerId+"[]."+c.remainingXpath+"."+e.renderId}r.includes(u)||r.push(u);var p=this.detectConditionArgumentType(u,e.argumentType);if(a=this.buildXpath(u,p,t),"boolean"!=p&&(l+="!bizagi.util.isEmpty("+a+") && "),i&&u&&u.length>0&&!{boolean:""}.hasOwnProperty(p)&&(d="self.isVisible('"+u+"') && self.isEditable('"+u+"') && "),bizagi.util.isEmpty(e.argument)?""===e.argument&&(o='""'):(o=this.buildArgument(e.argument,p,t),"xpath"==p&&(l+="!bizagi.util.isEmpty("+o+") && ")),"includes"==s)return d+l+"self.includes("+a+","+o+") ";if("changes"==s)return bizagi.override&&!bizagi.override.enableActionIsChangedSupport?"self.isChanged("+a+", params.changed)":t?"self.isGridColumnChanged("+a+", params,'"+u+"')":"self.isControlChanged("+a+", params,'"+u+"')";if("equals"==s)return d+l+a+" == "+o;if("not-equals"==s)return d+a+" != "+o;if("less-than"==s)return d+l+a+" < "+o;if("less-equals-than"==s)return d+l+a+" <= "+o;if("greater-than"==s)return d+l+a+" > "+o;if("greater-equals-than"==s)return d+l+a+" >= "+o;if("like"==s)return d+l+a+".toString().indexOf("+o+") >= 0 ";if("is-empty"==s)return"entity"!=p?d+"bizagi.util.isEmpty("+a+")":d+"("+a+" == 0 || bizagi.util.isEmpty("+a+"))";if("is-not-empty"==s)return"entity"!=p?d+"!bizagi.util.isEmpty("+a+")":d+"("+a+" != 0 && !bizagi.util.isEmpty("+a+"))";if("is-true"==s)return d+"( "+a+" == true || "+a+" == 'true' )";if("is-false"==s)return d+"( "+a+" == false || "+a+" == 'false' || "+a+" == 'False' )";if("does-not-contain"==s)return d+"(bizagi.util.isEmpty("+a+") || "+a+".toString().indexOf("+o+") < 0 )";if("contains"==s)return d+l+a+".toString().indexOf("+o+") >= 0 ";if("begins-with"==s)return d+l+a+".toString().startsWith("+o+") == true ";if("does-not-begins-with"==s)return d+l+a+".toString().startsWith("+o+") == false ";if("file-uploaded"==s)return n=u,t&&n&&(n=n.replaceAll("[]","[' + i + ']")),d+"self.isFileUploaded('"+n+"') ";if("file-not-uploaded"==s)return n=u,t&&n&&(n=n.replaceAll("[]","[' + i + ']")),d+"!self.isFileUploaded('"+n+"') ";if("is-invalid-email"==s)return d+"!self.isValidEmail("+a+") ";if("letter-edited"==s)return"false";if("letter-not-edited"==s)return"false";if("cell-change"==s)return"column == "+o;if("on-press"==s)return t?"self.isGridButtonPressed("+this.buildXpath(u,"id",t)+", params.pressed)":"self.isButtonPressed('"+u+"', params.pressed)";if("on-load"==s)return"true";if("on-deleted-row"==s)return"self.onDeletedGridRow('"+(n=u||"")+"', params.rowDeleted)";throw new"There is no implementation for operator code "+s},detectConditionArgumentType:function(e,t){if(void 0===t||"const"==t){var i=this.form,r=i.getRender(e)||i.getRenderById(e);if(null==r){if(bizagi.override&&bizagi.override.breakActionWithUnavailableRenders)throw new Error("RenderNotFoundException in method detectConditionArgumentType of bizagi.command.controllers.controller");return"text"}if("grid"==r.properties.type){var a=this.processGridXpath(e);if(""===a.remainingXpath)return"xpath";if(null==(r=r.getColumn(a.remainingXpath)))throw new Error("RenderNotFoundException in method detectConditionArgumentType of bizagi.command.controllers.controller")}var n=r.properties.dataType,o=bizagi.util.normalizeType(r.properties.type);return this.isRelatedEntityRender(o)?"entity":1==n||2==n||3==n||4==n||6==n||7==n||10==n||11==n?"number":8==n?"money":12==n||13==n?1==r.properties.showTime?"datetime":"date":5==n?"boolean":"button"==o?"button":"form"===o||/queryForm/i.test(o)?"form":"text"}return"xpath"==t||"function"==t||"entity"==t?t:"text"},isRelatedEntityRender:function(e){return["combo","list","radio","search","searchCombo","columnCombo","columnSearch","queryMultiSelect"].includes(e)||/^cascadingcombo$/i.test(e)},buildXpath:function(e,t,i){return(i=i||!1)&&(e=e.replaceAll("[]","[' + i + ']")),"xpath"!=t||i?"id"==t?"'"+e+"'":"function"==t?"self.evalXpath('"+e+"', '"+this.detectConditionArgumentType(e,"const")+"')":i?"self.evalGridXpath(params, '"+e+"', '"+t+"')":"self.evalXpath('"+e+"', '"+t+"')":"self.evalXpath('"+e+"', '"+this.detectConditionArgumentType(e,"const")+"')"},buildArgument:function buildArgument(argument,argumentType,bGridDetected,xpathContext){var self=this,number;if(bGridDetected=bGridDetected||!1,"text"==argumentType)return argument=null==argument?"":argument,argument="string"!=typeof argument?argument.toString():argument,-1!=argument.indexOf("'")&&(argument=argument.replaceAll("'","\\'")),-1!=argument.indexOf("\n")&&(argument=argument.replaceAll("\n","")),"'"+argument.toString()+"'";if("boolean"==argumentType)return"string"==typeof argument?"Default"==argument?argument:1==eval(argument.toLowerCase())?"true":"false":1==eval(argument)?"true":"false";if("number"==argumentType)return number=new Number(argument),NaN==number?"-99999999":number.toString();if("money"==argumentType)return number=new Number(argument),NaN==number?"-99999999":number.toString();if("date"==argumentType){var date=bizagi.util.dateFormatter.getDateFromInvariant(argument);return date&&0!=date||(date=new Date(0)),date.setHours(0,0,0,0),"bizagi.util.dateFormatter.getDateFromInvariant('"+bizagi.util.dateFormatter.formatInvariant(date)+"').setHours(0,0,0,0)"}if("datetime"==argumentType){var date=bizagi.util.dateFormatter.getDateFromInvariant(argument,!0);return date&&0!=date||(date=new Date(0)),date.setMilliseconds(0),"bizagi.util.dateFormatter.getDateFromInvariant('"+bizagi.util.dateFormatter.formatInvariant(date,!0)+"', true).getTime()"}if("color"==argumentType)return"'"+argument.toString()+"'";if("entity"==argumentType){if(bizagi.util.isEmpty(argument))return null;try{argument="object"!=_typeof(argument)?JSON.parse(argument):argument}catch(e){argument=argument||{}}if(argument&&argument.id)result=argument.id;else if(argument&&Array.isArray(argument.value))var result=argument.value.map((function(e){return e.id}));else result=argument.id||argument;return JSON.stringify(result)}if("xpath"==argumentType){var xpath=argument.toString();return bGridDetected=self.searchGridReferenceInXpath(xpath),bGridDetected&&(xpath=xpath.replaceAll("[]","[' + i + ']")),xpathContext&&(xpath=xpathContext+"."+xpath),self.buildXpath(xpath,argumentType,bGridDetected)}if("json"==argumentType)return JSON.encode(argument);if("function"==argumentType){if("BAToday"==argument)return"self.getCurrentDate()";if("BANow"==argument)return"self.getCurrentDate(true)";throw"There is no implementation for function "+argument}if(null==argumentType)return null;throw"There is no implementation for argument type "+argumentType},isEditable:function(e){var t=this.getRender(e);if(null!=t)return t.properties.editable;this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},isVisible:function(e){var t=this.getRender(e);if(null!=t){if(t.properties.visible)return this.isParentVisible(t.parent);var i=bizagi.util.normalizeType(t.properties.type);return!!/^hidden$/i.test(i)}this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},isParentVisible:function(e){return e.parent?!!e.properties.visible&&this.isParentVisible(e.parent):e.properties.visible},evalGridXpath:function evalGridXpath(params,xpath,argumentType){var self=this;if(void 0===params)return this.evalXpath(xpath,argumentType);var grid=params.grid;if(null==grid)return self.Class.THROW_ERROR&&self.showRenderNotFoundError(xpath),null;var gridXpath=self.processGridXpath(xpath),gridColumn=grid.getColumn(gridXpath.remainingXpath);if(!gridColumn)return!1;var cellValue=grid.getCellCurrentValue(gridXpath.index,gridXpath.remainingXpath);return"columnRadio"==gridColumn.properties.type&&(cellValue&&!bizagi.util.isString(cellValue)?cellValue=cellValue.length>0&&cellValue[0].length>0?cellValue[0][0]:cellValue.id:bizagi.util.isString(cellValue)||(cellValue=0)),"columnCombo"==gridColumn.properties.type&&(cellValue=cellValue&&cellValue.id?cellValue.id:0),"columnSearch"==gridColumn.properties.type&&(cellValue=cellValue&&cellValue.id?cellValue.id:0),"columnDate"==gridColumn.properties.type&&cellValue&&(cellValue=gridColumn.properties.showTime?bizagi.util.dateFormatter.getDateFromInvariant(cellValue):bizagi.util.dateFormatter.getDateFromInvariant(cellValue).setHours(0,0,0,0)),bizagi.util.isEmpty(cellValue)&&"boolean"==argumentType?"check"!=gridColumn.properties.display&&null:"boolean"==argumentType?eval(self.buildArgument(cellValue,argumentType)):cellValue},evalXpath:function evalXpath(xpath,argumentType){var self=this,i,renderToEval,renders=self.getRenders(xpath);if(null==renders)return self.Class.THROW_ERROR&&self.showRenderNotFoundError(xpath),null;var rendersToEval=[];for($.each(renders,(function(e,t){t.properties.editable&&rendersToEval.push(t)})),0===rendersToEval.length&&$.each(renders,(function(e,t){rendersToEval.push(t)})),i=0;i<rendersToEval.length;){renderToEval=rendersToEval[i++];var bIsGrid="grid"==renderToEval.properties.type;if(bIsGrid){var gridXpath=self.processGridXpath(xpath),gridColumn=renderToEval.getColumn(gridXpath.remainingXpath);if(!gridColumn)continue;var cellValue=renderToEval.getCellCurrentValue(gridXpath.index,gridXpath.remainingXpath);return"columnRadio"==gridColumn.properties.type&&(cellValue&&!bizagi.util.isString(cellValue)?cellValue=cellValue.length>0&&cellValue[0].length>0?cellValue[0][0]:cellValue.id:bizagi.util.isString(cellValue)||(cellValue=0)),"columnCombo"!=gridColumn.properties.type&&"columnSearch"!=gridColumn.properties.type&&"columnList"!=gridColumn.properties.type||(cellValue&&cellValue.id?cellValue=cellValue.id:"number"!=typeof cellValue&&"string"!=typeof cellValue&&(cellValue=0)),bizagi.util.isEmpty(cellValue)&&"boolean"==argumentType?"check"!=gridColumn.properties.display&&null:"boolean"==argumentType||"date"==argumentType&&!bizagi.util.isEmpty(cellValue)?eval(self.buildArgument(cellValue,argumentType)):(void 0!==gridColumn&&void 0!==gridColumn.properties&&void 0!==gridColumn.properties.type&&"columnDate"==gridColumn.properties.type&&(cellValue=self.getColumnDateCorrectFunction(cellValue,gridColumn.properties.showTime)(cellValue)),cellValue)}var value=renderToEval.getValue(),renderType=bizagi.util.normalizeType(renderToEval.properties.type||"");return void 0===argumentType||"undefined"===argumentType?value:((["combo","list","search","radio"].includes(renderType)||/^cascadingcombo$/i.test(renderType))&&(bizagi.util.isEmpty(value)||""==value.id)&&(value=0),/^queryMultiSelect$/i.test(renderType)?renderToEval&&renderToEval.mapValue(value):"comboSelected"===renderType?"string"==typeof value?JSON.parse(value).value:value:bizagi.util.isEmpty(value)?("boolean"!==renderType||"check"!==renderToEval.properties.display)&&value:"xpath"===argumentType?eval(self.buildArgument(xpath,argumentType)):eval(self.buildArgument(value,argumentType)))}},isFileUploaded:function(e){var t=this.evalXpath(e);return!!(t&&t.length&&t.length>0)},isValidEmail:function(e){return!(!e||!e.match(new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/gi)))},isButtonPressed:function(e,t){var i=this.getRenderById(e);return!(null==i||!/^button$/i.test(bizagi.util.normalizeType(i.properties.type)))&&t},isGridButtonPressed:function(e,t){var i=this.processGridXpath(e),r=i.gridXpath,a=this.getRender(r),n=i.remainingXpath||"";return t&&a&&a.columns&&$.each(a.columns,(function(e,i){i.properties.xpath!==n&&i.properties.id!==n||"columnButton"!==i.properties.type||(t=!0)})),t},isChanged:function(e,t){return null!=e&&t},isControlChanged:function(e,t,i){if(null==e)return!1;if(t.changed){var r=this.getRender(i),a=t.render;return null!=r&&null!=a&&(a.properties.id===r.properties.id&&a.properties.xpath===r.properties.xpath)}return!1},isGridColumnChanged:function(e,t,i){if(null==e)return!1;if(t.changed){var r=this.processGridXpath(i),a=r.gridXpath,n=this.getRender(a);if(null==n)return!1;var o=r.remainingXpath||"",s=t.id?t.render.getColumnById(t.id):t.render.getColumn(t.column),l=n.getColumn(o);return!(!l||!s)&&(l.properties.xpath===s.properties.xpath&&l.properties.id===s.properties.id)}},includes:function(e,t){return null!=e&&(null!=t&&$.grep(e,(function(e){return e.id==t})).length>0)},onDeletedGridRow:function(e,t){return!(!(this.getRender(e)||{})||!t)},getRenders:function(e){var t=this.form,i=null,r=/id=([\w-]+)/gi.exec(e);if(r&&r.length>1){var a=this.getRenderById(r[1]);return a?0==a.length?null:((i=[]).push(a),i):null}return 0==(i=t.getRenders(e)).length?null:i},getRender:function(e){return this.form.getRender(e)},getRenderById:function(e){return this.form.getRenderById(e)},showRenderNotFoundError:function(e){bizagi.debug("Cannot find render in DOM: "+e)},showContainerNotFoundError:function(e){bizagi.debug("Cannot find container in DOM: "+e)},getCurrentDate:function(e){var t=new Date,i=bizagi.util.dateFormatter.getDateFromInvariant(bizagi.util.dateFormatter.formatInvariant(t));return e||!i||isNaN(Date.parse(i))||$.isNumeric(i)||i.setHours(0,0,0,0),i.getTime()},processGridXpath:function(e){var t,i,r,a=new RegExp(/([\w\.-]*)\[(\d*)\]\.([\w\.|\w-\.]*)/g).exec(e);return a?(r=a[1],t=a[2],i=a[3]):(t="",i=""),{xpath:e,index:t,remainingXpath:i,gridXpath:r}},searchForGridReference:function(e,t){var i;if(e)return this.searchGridReferenceInCondition(e);if(t)for(i in t){var r=t[i];return this.searchForGridReferenceInCommand(r)}return null},searchForGridReferenceInCommand:function(e){return e.xpath&&e.xpath.indexOf("[]")>0?e.xpath.substring(0,e.xpath.indexOf("[]")):e.renderId&&e.renderId.indexOf("[]")>0?e.renderId.substring(0,e.renderId.indexOf("[]")):"xpath"==e.argumentType&&e.argument.indexOf("[]")>0?e.argument.substring(0,e.argument.indexOf("[]")):void 0},searchGridReferenceInCondition:function(e){var t;if("string"==typeof e||"boolean"==typeof e)return null;if(e.expressions){for(i in e.expressions)if(e.expressions.hasOwnProperty(i)&&(t=this.searchGridReferenceInCondition(e.expressions[i])))return t}else{if(e.simple)return this.searchGridReferenceInCondition(e.simple);if(e.complex)return this.searchGridReferenceInCondition(e.complex);if(e.xpath||e.renderId){if(t=this.searchGridReferenceInXpath(e.xpath)||this.searchGridReferenceInXpath(e.renderId))return t;if("xpath"==e.argumentType&&(t=this.searchGridReferenceInXpath(e.argument)))return t}}return null},searchGridReferenceInXpath:function(e){return e&&e.indexOf("[]")>0?e.substring(0,e.indexOf("[]")):null},getGridControl:function(e,t){var i=this.processGridXpath(e).remainingXpath;return this.getRender(e).getControlCell(t,i)},getColumnDateCorrectFunction:function(e,t){return e?e&&t?this.getColumnDateValueDateAndTime:e&&!t?this.getColumnDateValueOnlyDate:e:this.getColumnDateValueForNoValue},getColumnDateValueForNoValue:function(e){return bizagi.util.dateFormatter.getDateFromInvariant(e)},getColumnDateValueOnlyDate:function(e){return bizagi.util.dateFormatter.getDateFromInvariant(e).setHours(0,0,0,0)},getColumnDateValueDateAndTime:function(e){return bizagi.util.dateFormatter.getDateFromInvariant(e,!0).getTime()}}),bizagi.command.controllers.controller.extend("bizagi.command.controllers.validation",{},{init:function(e,t,i){this.enableDebug=!1,this._super(e),this.initializeValidations(i,t)},initializeValidations:function(e,t){var i=this,r=$("<div />").appendTo(e);$.widget("ui.bizagi_notifications",$.ui.bizagi_notifications,{expand:function(){this._super(),i.form.triggerGlobalHandler("modalViewDidAppear",{})},collapse:function(){this._super(),i.form.triggerGlobalHandler("modalViewDidDisappear",{})},hide:function(){this._super(),i.form.triggerGlobalHandler("modalViewDidDisappear",{})}}),r.bizagi_notifications({itemIcon:"ui-icon-circle-close",minimized:!1,clearEnabled:!1,title:bizagi.localization.getResource("render-form-validations-header-text"),device:bizagi.util.detectDevice(),orientation:i.form.properties.orientation}),r.bind("itemClick",(function(e,t){i.onNotificationClick(t.data)})),t&&i.buildValidations(t),i.validationBox=r,i.validations=t||[]},buildValidations:function(e){var t=this,i=t.buildAllValidations(e);t.form.bind("rendervalidate",(function(){return i(t)}))},showErrorMessage:function(e){bizagi.showErrorAlertDialog=!1,this.showValidationMessage(e,null,"ui-icon-circle-close","ui-state-error")},showAlertMessage:function(e){this.showValidationMessage(e,null,"ui-icon-alert","ui-state-highlight")},showInfoMessage:function(e){this.showValidationMessage(e,null,"ui-icon-info","ui-state-highlight")},showValidationMessage:function(e,t,i,r,a,n){var o=this,s=o.form,l=null;l=n?s.getRenderById(n)||null:t?s.getRender(t):null,bizagi.showErrorAlertDialog=!1;var d=function(){o.clearValidationMessages();var e=s?s.getLastActionButton():{};e&&"nextWithoutValidations"===e.action||(o.validating=!0,o.performValidations(),o.validating=!1),0==o.countValidationMessages()?(o.hideValidationMessages(),o.form.triggerGlobalHandler("modalViewDidDisappear",{})):o.form.triggerGlobalHandler("modalViewDidAppear",{})};o.form.triggerGlobalHandler("modalViewDidAppear",{}),o.validationBox.bizagi_notifications("addNotification",e,t,i,r,d,a,n),l&&(l.setValidationMessage(e),bizagi.util.isIE8()||o.validating||l.bind("rendervalidate",(function(){d(),"double"!=l.properties.retype&&l.unbind("rendervalidate")})))},countValidationMessages:function(){return this.validationBox.bizagi_notifications("count")},clearValidationMessages:function(e){return $(".ui-bizagi-notifications-container","body").not(".ui-bizagi-log-container").bizagi_notifications("clearAll",void 0,e)},hideValidationMessages:function(){return this.validationBox.bizagi_notifications("hide")},showValidationMessages:function(){return this.validationBox.bizagi_notifications("show")},expandNotificationBox:function(e){return!1!==e&&this.validationBox.bizagi_notifications("autoFocusFirstError"),this.validationBox.bizagi_notifications("expand")},isExpandedNotificationBox:function(){return this.validationBox.bizagi_notifications("isExpanded")&&this.validationBox.bizagi_notifications("isContentVisible")},performValidations:function(e){this.clearValidationMessages(),this.validationBox.bizagi_notifications("initBatch");var t=this.validateRenders(e),i=!(this.validations.length>0)||this.form.triggerHandler("rendervalidate");return this.validationBox.bizagi_notifications("endBatch"),!(!i||!t)||(this.validationBox.bizagi_notifications("show"),!1)},buildAllValidations:function(e){for(var t="",i=0;i<e.length;i++){if(null==e[i].enabled||e[i].enabled)try{t+=this.buildValidation(e[i].conditions,e[i].validationCommand)}catch(t){"RenderNotFoundException"!=t.message&&bizagi.logError("Validation cannot be parsed: "+t.message,e[i])}}var r="var baTmpFn = function(self, params){\r\n var bValid = true;\r\n "+t+"\r\n return bValid;}; baTmpFn";return this.evalValidation(r)},buildValidation:function(e,t){var i="",r="",a=this.searchForGridReference(e),n=null!=a,o=void 0===bizagi.override.validateEditabilityOnValidations||bizagi.override.validateEditabilityOnValidations;i+="( "+this.buildConditions(e,n,o)+" )",t.message=t.message.replace(/'/g,"\\'"),t.message=t.message.replace(/\n/g," ");var s=t.focus||"";if(n&&(s=a),t.tokens?r+="self.showValidationMessage(' "+t.message+"', '"+s+"', JSON.parse('"+JSON.encode(t.tokens)+"')); bValid = false;\r\n":r+="self.showValidationMessage(' "+t.message+"', '"+s+"'); bValid = false;\r\n",n){var l="var grid = self.form.getRender('"+a+"');\r\n";return l+="if(grid === null) return true;\r\n",l+="var data = grid.getIndexes();\r\n",l+="var bGridValid = true;\r\n",l+="$.each(data, function(_, i) {\r\n",l+="if ("+i+"){\r\n bGridValid = false; \r\n}",l+="});\r\n",l+="if (bGridValid == false){\r\n "+r+"\r\n}"}return"if ("+i+"){\r\n "+r+" \r\n}"},onNotificationClick:function(e){var t=this.form,i=e.focus,r=e.id;if(i){var a=r?t.getRenderById(r):t.getRender(i);a&&a.focus()}},validateRenders:function(e){var t=this;e=e||[];var i=t.form.isValid(e);return i||e.forEach((function(e){e.id?t.showValidationMessageById(e.message,e.xpath,e.id):(e.message||e.xpath)&&t.showValidationMessage(e.message,e.xpath)})),i},evalValidation:function evalValidation(command){var self=this;return self.enableDebug&&null!=console&&console.log(command),eval(command)},showValidationMessageById:function(e,t,i){this.showValidationMessage(e,t,void 0,!1,void 0,i)}}),bizagi.command.controllers.controller.extend("bizagi.command.controllers.action",{overridesInitiated:!1},{init:function(e,t){this.configureOverrides(),this._super(e),this.globalDependencies={},this.initialCallFunctions={},this.funtionsToExecuteARefreshCommand=[],this.initialCallFunctionsDeferred=new $.Deferred,t&&this.buildActions(t),this.actions=t,this.internalSubmitActions={},this.initialCallTimeout=25,this.initialCallIncrements=25,this.actionsHistory={},this.period=50},processInternalSubmitAction:function(e,t){this.internalSubmitActions[e]||(this.internalSubmitActions[e]=t,this.buildAction(t,!0))},isSummaryOrGlobalForm:function(){var e=!1;return"SummaryForm"!==this.form.properties.typeForm&&"GlobalForm"!==this.form.properties.typeForm||(e=!0),e},evalClientAction:function(e){for(var t,i=0,r=!1,a=[].concat(e.commands,e.elseCommands),n=a.length;i<n;i++)if(t=a[i],!this.isClientAction(t)){r=!0;break}r&&(e.enabled=!1)},buildActions:function(e,t){var i,r,a={};this.funtionsToExecuteARefreshCommand=[];var n=this.isSummaryOrGlobalForm();for(i=0,r=e.length;i<r;i++)try{var o=e[i],s=bizagi.util.md5(JSON.stringify(o.conditions)),l=bizagi.util.md5(JSON.stringify(o.commands));a[s]?-1===a[s].indexOf(l)&&(n&&this.evalClientAction(o),this.buildAction(o,t),a[s].push(l)):(n&&this.evalClientAction(o),this.buildAction(o,t),a[s]=[l])}catch(t){"RenderNotFoundException"!==t.message&&bizagi.logError("Action cannot be parsed: "+t.message,e[i])}},unbindActions:function(){$.each(this.globalDependencies,(function(e,t){t.unbind("renderchange.action")})),this.globalDependencies={},$.each(this.initialCallFunctions,(function(e,t){clearTimeout(t)})),this.initialCallFunctions={}},refreshActions:function(e){var t=this;t.initialCallTimeout=25,t.initialCallFunctions={},e=e||[],t.actions=t.actions.concat(e),t.buildActions(t.actions,!0),$.each(t.internalSubmitActions,(function(e,i){try{t.buildAction(i,!1)}catch(e){"RenderNotFoundException"!==e.message&&bizagi.logError("Action cannot be parsed: "+e.message,i)}}))},buildAction:function(e,t){var i=this,r=i.form,a=[],n=[],o=[];if(e.commands=e.commands||[],e.elseCommands=e.elseCommands||[],null==e.enabled||e.enabled){e.conditions&&"true"==e.conditions.operator&&$.each(e.commands,(function(e,t){var r=i.searchGridReferenceInXpath(t.xpath);r&&(o.includes(r)||o.push(r))}));var s=i.buildFunction(e.conditions,e.commands,e.elseCommands,o);if(o)for(var l=0;l<o.length;l++)if(void 0!==o[l]){var d=r.getRenders(o[l]);if(0===d.length){var u=r.getRenderById(o[l]);d=u?[u]:null}d&&($.each(d,(function(e,t){$.inArray(t.properties.id,n)<0&&t.properties.editable&&h(t)})),0===a.length&&h(d[0]))}var c=function(t){this.commandDependencies=e.commands.concat(e.elseCommands).map((function(e){return e.xpath||e.container||e.renderId})),this.commandNames=e.commands.concat(e.elseCommands).map((function(e){return e.command})),this.fn=t};c.prototype={hasDependency:function(e){return null!=e&&this.commandDependencies.indexOf(e)>=0},hasRefreshCommand:function(){return this.commandNames.indexOf("refresh")>=0},execute:function(e){return s(i,e)}},i.funtionsToExecuteARefreshCommand=i.funtionsToExecuteARefreshCommand||[];var p=new c(s);if(p.hasRefreshCommand()||i.funtionsToExecuteARefreshCommand.push(p),$.each(a,(function(r,a){a.bind("renderchange.action",(function(t,r){if((r=r||{}).changed=void 0===r.changed||r.changed,r.column){for(var a=0;a<e.gridColumns.length;a++)if(r.column==e.gridColumns[a])return void s(i,r)}else s(i,r)})),i.globalDependencies[a.properties.id]=a,"grid"===a.properties.type&&(t=!0,e.gridColumns=[],i.searchGridColumns(e.conditions,e.gridColumns))})),!t){!function(e){var t=Math.guid(),i=setTimeout((function(){try{s(e),delete e.initialCallFunctions[t]}catch(e){}finally{clearTimeout(i)}}),e.initialCallTimeout);e.initialCallFunctions[t]=i,e.initialCallTimeout+=e.initialCallIncrements}(i)}}function h(e){var t;t=e.properties.type,-1===["groupedgrid","collectionnavigator"].indexOf(t)&&(n.push(e.properties.id),a.push(e))}},tryToExecuteFunction:function(e){if(bizagi.override&&!0===bizagi.override.enableExecuteRefreshAction)for(var t=0;t<this.funtionsToExecuteARefreshCommand.length;t++){var i=this.funtionsToExecuteARefreshCommand[t];i.hasDependency(e)&&i.execute()}},buildFunction:function buildFunction(conditions,commands,elseCommands,innerDependencies){var self=this,gridReference=self.searchForGridReference(conditions,commands),bGridDetected=null!=gridReference&&gridReference,sJsCondition="",sJsAction="",sStatement,sJsElseAction="",bAutomaticRestore=!elseCommands,bCondition=!!conditions,i;for(bCondition&&(sJsCondition+=self.buildConditions(conditions,bGridDetected,!1,innerDependencies)),i=0;i<commands.length;i++){var queueAction=self.isServerCommand(commands[i])?"addParallel":"add",command=self.buildCommand(commands[i],bGridDetected);command=command.indexOf(";")>=1?command.replace(";",""):command,sJsAction+="actionQueue."+queueAction+"(function(){return "+command+" ;}); \r\n",bAutomaticRestore&&(sJsElseAction+=self.buildRestoreCommand(commands[i],bGridDetected))}if(!bAutomaticRestore){for(sJsElseAction+="var actionQueue = new bizagiQueue(); \r\n",sJsElseAction+="if (params.render){params.render.startActionExecution();} \r\n",i=0;i<elseCommands.length;i++){var queueAction=self.isServerCommand(elseCommands[i])?"addParallel":"add",elseCommand=self.buildCommand(elseCommands[i],bGridDetected);elseCommand=elseCommand.indexOf(";")>=1?elseCommand.replace(";",""):elseCommand,sJsElseAction+="actionQueue."+queueAction+"(function(){return "+elseCommand+" ;}); \r\n"}sJsElseAction+="var execute = actionQueue.execute().always(function(){ \r\n",sJsElseAction+="if (params.render){ params.render.endActionExecution();} \r\n });\r\n",sJsElseAction+="self.form.appendWaitForLoader({ promise: execute, create: true });\r\n"}if(sStatement="var baTmpFn = function(self, params){ \r\n",sStatement+="params = params || {};\r\n",bGridDetected&&(sStatement+="var i = params.key;\r\n",sStatement+="var column = params.column;\r\n"),bCondition&&(sStatement+="if ("+sJsCondition+"){ \r\n"),sStatement+="var actionQueue = new bizagiQueue(); \r\n",sStatement+="if (params.render){params.render.startActionExecution();} \r\n",sStatement+=sJsAction,sStatement+="var execute = actionQueue.execute().always(function(){ \r\n",sStatement+="if (params.render){ params.render.endActionExecution();} \r\n });\r\n",sStatement+="self.form.appendWaitForLoader({ promise: execute, create: true });\r\n",bCondition&&(sStatement+="\r\n } ",sJsElseAction.length>0&&(sStatement+="else { \r\n"+sJsElseAction+" }\r\n")),sStatement+="};\r\n",bGridDetected){var sGridStatement="var baGridTmpFn = function(self, args){ \r\n";sGridStatement+="args = args || {};\r\n",sGridStatement+="\t var grid = args.render || self.form.getRender('"+gridReference+"') || []; \r\n",sGridStatement+="\t grid = grid.grid ? grid : (self.form.getRender('"+gridReference+"') || []); \r\n",sGridStatement+="\t args.grid = grid; \r\n",sGridStatement+="if(args.surrogateKey === undefined){\r\n",sGridStatement+="\t var data = grid.getIndexes();\r\n",sGridStatement+="\t $.each(data, function(i, index) {\r\n",sGridStatement+="\t\t args.key = index; \r\n",sGridStatement+="\t\t baTmpFn(self, args);\r\n",sGridStatement+="\t });\r\n",sGridStatement+="} else {\r\n",sGridStatement+="\t args.key = args.surrogateKey; \r\n",sGridStatement+="\t\t baTmpFn(self, args ); \r\n",sGridStatement+="}\r\n",sGridStatement+="};\r\n",sStatement+=sGridStatement,sStatement+="baGridTmpFn"}else sStatement+="baTmpFn";return eval(sStatement)},isServerCommand:function(e){var t=e.command;return["refresh","submit-data","execute-rule","execute-interface","execute-sap","execute-connector","execute-excel-bot","execute-pipeline"].includes(t)},isClientAction:function(e){var t=e.command;return["background-color","forecolor","visible","required","collapse","set-active"].includes(t)},isRecentAction:function(e,t){var i=this,r=e+"@"+t;return null!=i.actionsHistory[r]||($.when(i.runAction(e,t)).done((function(){delete i.actionsHistory[r],bizagi.log("resolve "+r)})),!1)},runAction:function(e,t){var i=e+"@"+t;this.actionsHistory[i]=new $.Deferred;var r=setTimeout(this.actionsHistory[i].resolve,this.period);return this.actionsHistory[i].done(clearTimeout.bind(null,r)),this.actionsHistory[i].promise()},buildCommand:function(e,t){var i=t=t||!1,r=e.command,a=this.detectCommandArgumentType(e.argumentType,r),n=this.buildArgument(e.argument,a,t,e.xpathContext),o=e.xpath,s=this.searchForGridReferenceInCommand(e);if(s&&e.containerId){var l=this.processGridXpath(o);o=l.gridXpath+"."+e.containerId+"[]."+l.remainingXpath+"."+e.renderId}else o&&e.renderId?o=o+"."+e.renderId:t&&e.renderId?o=e.renderId:e.renderId&&(o="id="+e.renderId);if(t&&o&&(o=o.replaceAll("[]","[' + i + ']")),e.xpath&&e.xpath.length>0||e.renderId&&e.renderId.length>0)switch(r){case"background-color":return"activityFlowButton"===e.controlType?"self.changeButtonBackground('"+o+"', "+n+");":"self.changeRenderBackground('"+o+"', "+n+");";case"forecolor":return"activityFlowButton"===e.controlType?"self.changeButtonForeground('"+o+"', "+n+");":"self.changeRenderForeground('"+o+"', "+n+");";case"visible":return"activityFlowButton"===e.controlType?"self.changeButtonVisibility('"+o+"', "+n+");":"self.changeRenderVisibility('"+o+"', "+n+");";case"readonly":return"activityFlowButton"===e.controlType?"self.changeButtonEditability('"+o+"', "+n+");":"self.changeRenderEditability('"+o+"', '"+n+"');";case"required":return"self.changeRenderRequired('"+o+"', "+n+");";case"set-value":return t&&"xpath"===e.argumentType&&e.xpathContext&&(void 0!==e.xpathContext&&(e.argument=e.xpathContext+"."+e.argument),n=this.buildArgument(e.argument,a,t)),"self.changeRenderValue('"+o+"', "+n+");";case"set-min":return"self.changeRenderMinValue('"+o+"', "+n+");";case"set-max":return"self.changeRenderMaxValue('"+o+"', "+n+");";case"calculate":return"self.executeCalculatedField('"+o+"');";case"submit-value":return"self.submitRender('"+o+"', '"+n+"');";case"clean-data":return"self.cleanRenderData('"+o+"');";case"refresh":return(s=this.searchForGridReferenceInCommand(e))?"self.refreshGridCell('"+o+"', '"+(e.xpathContext||"")+"');":"self.refreshControl('"+o+"', '"+(e.xpathContext||"")+"','"+r+"');";case"trigger-click":return"self.triggerClick('"+o+"');"}else switch(r){case"background-color":return"self.changeContainerBackground('"+e.container+"', "+n+");";case"visible":return"self.changeContainerVisibility('"+e.container+"', "+n+");";case"collapse":return"self.toogleContainer('"+e.container+"', "+!bizagi.util.parseBoolean(n)+");";case"set-active":return"self.changeActiveItem('"+e.container+"');";case"readonly":return"self.changeContainerEditability('"+e.container+"', '"+n+"');";case"refresh":return"self.refreshContainer('"+e.container+"', '"+(e.xpathContext||"")+"');"}if("submit-data"===r)return"self.submitFormData();";if("execute-rule"===r){var d=e.argument||{},u="";try{u=JSON.parse(d).guid}catch(e){}var c=e.xpathContext||"";if(t){var p=i+"[id=%s]";return"self.executeRule('"+u+"', printf('"+p+"',i) ,'"+r+"');"}return"self.executeRule('"+u+"','"+c+"','"+r+"');"}if("execute-interface"===r){var h=e.argument||{},g="";try{g=JSON.parse(h).guid}catch(e){}return c=e.xpathContext||"",t?"self.executeInterface('"+g+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executeInterface('"+g+"','"+c+"');"}if("execute-sap"===r){var m=e.argument||{},f="";try{f=JSON.parse(m).guid}catch(e){}return c=e.xpathContext||"",t?"self.executeSAPConnector('"+f+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executeSAPConnector('"+f+"','"+c+"');"}if("execute-connector"===r||"execute-excel-bot"===r){m=e.argument||{};var b="";try{b=JSON.parse(m).guid}catch(e){}return c=e.xpathContext||"",t?"self.executeConnector('"+b+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executeConnector('"+b+"','"+c+"');"}if("execute-pipeline"===r){var v=e.argument||{},y="";try{y=JSON.parse(v).guid}catch(e){}return c=e.xpathContext||"",t?"self.executePipeline('"+y+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executePipeline('"+y+"','"+c+"');"}return bizagi.log("There is no definition for commandType: "+r),""},buildRestoreCommand:function(e,t){var i=e.xpath,r=e.command;return t=t||!1,e.renderId&&(i="id="+e.renderId),t&&(i=i.replaceAll("[]","[' + i + ']")),i&&i.length>0?"self.restoreRender('"+i+"', '"+r+"');":"self.restoreContainer('"+e.container+"', '"+r+"');"},detectCommandArgumentType:function(e,t){if(void 0===e)return e;if("const"==e){if("background-color"==t)return"color";if("forecolor"==t)return"color";if("visible"==t)return"boolean";if("readonly"==t)return"boolean";if("required"==t)return"boolean";if("set-value"==t)return"text";if("collapse"==t)return"boolean";if("set-active"==t)return"number";if("set-min"==t)return"text";if("set-max"==t)return"text";if("calculate"==t)return;if("refresh"==t)return;if("submit-value"==t)return"json"}else if("xpath"===e||"entity"===e||"function"===e)return e;return bizagi.log("There is no definition for commandType: "+t),null},restoreRender:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){var n=a.originalProperties,o=n.textFormat||{};"background-color"==t&&i.changeRenderBackground(e,o.background||""),"forecolor"==t&&i.changeRenderForeground(e,o.color||"none"),"visible"==t&&i.changeRenderVisibility(e,null==n.visible||n.visible),"readonly"==t&&i.changeRenderEditability(e,null==n.editable||n.editable),"required"==t&&i.changeRenderRequired(e,null!=n.required&&n.required)})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},restoreContainer:function(e,t){var i=this.form.getContainer(e);if(null!=i){var r=i.originalProperties;"background-color"==t&&this.changeContainerBackground(e,r.backgroundColor||"none"),"visible"==t&&this.changeContainerVisibility(e,null==r.visible||r.visible),"collapse"==t&&this.toogleContainer(e,!0),"readonly"==t&&this.changeContainerEditability(e,null==r.editable||r.editable)}else this.Class.THROW_ERROR&&this.showContainerNotFoundError(xpath)},changeRenderBackground:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"backgroundColor",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellBackgroundColor(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellBackgroundColor(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){a.changeBackgroundColor(t),i.logVisualChange(n)}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonBackground:function(e,t){var i=e.substring(3),r=this.form.getButton(i);r.css("background-image","none"),r.addClass("ui-fast-transition"),void 0!==r[0]&&r[0].style.setProperty("background-color",t,"important")},changeRenderForeground:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"color",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellColor(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellColor(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){a.changeColor(t),i.logVisualChange(n)}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonForeground:function(e,t){var i=e.substring(3);this.form.getButton(i).css("color",t,"!important")},changeRenderVisibility:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"visibility",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){a.changeColumnVisibility(o.remainingXpath,t);var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellVisibility(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellVisibility(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){$.when(a.renderingDeferred).done((function(){a.changeVisibility(t),i.logVisualChange(n)}))}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonVisibility:function(e,t){var i=e.substring(3),r=1==bizagi.util.parseBoolean(t);if(bizagi.util.isMobileDevice())this.changeFormButtonVisibility(i,r);else{var a=this.form.getButton(i);r?(a.show(),a.css("display","")):a.hide()}},changeRenderEditability:function(e,t){var i=this;if(bizagi.override.changeEditabilityOnReadOnlyForms||!i.form.properties.displayAsReadOnly){var r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"editability",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){a.changeColumnEditability(o.remainingXpath,t);var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellEditability(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellEditability(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){$.when(a.renderingDeferred).done((function(){a.changeEditability(t),i.logVisualChange(n)}))}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)}},changeButtonEditability:function(e,t){var i=e.substring(3),r=this.form.getButton(i);1==bizagi.util.parseBoolean(t)?r.removeAttr("disabled"):r.attr("disabled","disabled")},triggerClick:function(e){var t=e.substring(3),i=this.form.buttons.find((function(e){return e.id==t}));i?this.form.buttonExecutionHandler(i):console.warn("Button properties were not found")},changeRenderRequired:function(e,t){var i=this,r=i.getRenders(e),a=[];null!=r?($.each(r,(function(e,t){bizagi.util.parseBoolean(t.properties.editable)&&a.push(t)})),0===a.length&&(a=r),$.each(a,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"required",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){a.changeColumnRequired(o.remainingXpath,t);var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellRequired(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellRequired(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){$.when(a.renderingDeferred).done((function(){a.changeRequired(t),i.logVisualChange(n)}))}))}}))):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderValue:function(e,t){var i=this;null!=t&&"object"===_typeof(t)&&(t=$.extend(t,{fromAction:!0}));var r=i.getRenders(e);if(null!=r){var a=[];$.each(r,(function(e,t){t.properties.editable&&a.push(t)})),0==a.length&&$.each(r,(function(e,t){a.push(t)})),$.each(a,(function(r,a){if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellValue(r[e],n.remainingXpath,t)}else a.changeCellValue(n.index,n.remainingXpath,t)}))}else $.when(a.ready()).done((function(){a.asyncRenderDeferred?$.when(a.asyncRenderDeferred).done((function(){a.setDisplayValue(t)})):a.setDisplayValue(t)}))}))}else i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderMinValue:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){var n=i.getVisualChange(a,"minValue",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellMinValue(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellMinValue(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){var e=bizagi.util.normalizeQueryType(a.properties.type);["number","date","money"].includes(e)&&(a.changeMinValue(t),i.logVisualChange(n))}))})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderMaxValue:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){var n=i.getVisualChange(a,"maxValue",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellMaxValue(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellMaxValue(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){a.changeMaxValue(t),i.logVisualChange(n)}))})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},executeCalculatedField:function(e){var t=this.getRenders(e);null!=t?$.each(t,(function(e,t){$.when(t.ready()).done((function(){t.runFormula()}))})):this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshControl:function(e,t,i){var r=this.getRenders(e)||this.form.getContainer(e),a=new bizagiQueue;if(null!=r)return $.each(r,(function(i,r){a.add(r.ready().pipe((function(){return r.refreshControl({xpath:e,xpathContext:t})})))})),a.execute();this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshContainer:function(e,t){var i=this.form.getContainer(e);if(null!=i)return $.when(i.ready()).pipe((function(){return i.refreshContainer({xpathContext:t})}));this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshGridCell:function(e,t){var i=this,r=new bizagiQueue,a=new $.Deferred,n=i.getRenders(e)||i.form.getContainer(e);if(null==n)return i.Class.THROW_ERROR&&i.showRenderNotFoundError(e),null;var o=[];return $.each(n,(function(e,t){if(t.properties.editable)return o.push(t),!1})),0==o.length&&$.each(n,(function(e,t){return o.push(t),!1})),0!==o.length?(i.form&&""!==i.form.properties.xpathContext&&(t=""!==t?i.form.properties.xpathContext+"."+t:i.form.properties.xpathContext),r.add(a.promise()),$.when.apply($,$.map(o,(function(e){e.ready()}))).done((function(){for(var r=o.length,n=new bizagiQueue,s=0;s<r;s++){var l=o[s],d=i.processGridXpath(e);if(bizagi.util.isEmpty(d.index))for(var u=l.getIndexes(),c=u.length,p=0;p<c;p++)n.addParallel(l.refreshCell({key:u[p],column:d.remainingXpath,xpathContext:t}));else n.add(l.refreshCell({key:d.index,column:d.remainingXpath,xpathContext:t}))}$.when(n.execute()).done((function(){a.resolve()}))})),r.execute()):void 0},submitFormData:function(e){var t=this.form;return $.when(t.ready()).pipe((function(){return t.submitData(e)}))},executeRule:function(e,t,i){var r=this.form,a=e+"."+t;return this.isRecentAction(a,i)?void 0:$.when(r.ready()).pipe((function(){return r.executeRule({rule:e,xpathContext:t})}))},executeInterface:function(e,t){var i=this.form;return $.when(i.ready()).pipe((function(){return i.executeInterface({interface:e,xpathContext:t})}))},executeSAPConnector:function(e,t){var i=this.form;return $.when(i.ready).pipe((function(){return i.executeSAPConnector({guidsap:e,xpathContext:t})}))},executeConnector:function(e,t){var i=this.form;return $.when(i.ready).pipe((function(){return i.executeConnector({guidConnector:e,xpathContext:t})}))},executePipeline:function(e,t){var i=this.form;return $.when(i.ready()).pipe((function(){return i.executePipeline({pipeline:e,xpathContext:t})}))},submitRender:function(e,t){var i=this.getRender(e);if(null!=i)return $.when(i.ready()).pipe((function(){return i.submitOnChange()}));this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},cleanRenderData:function(e){var t=this,i=t.getRenders(e),r=[];if(null!=i)return $.each(i,(function(i,a){if(t.isGridComponent(a,e)){var n=t.processGridXpath(e);r.push($.when(a.ready()).then((function(){var e=[];if(bizagi.util.isEmpty(n.index)){var t,i,r=a.getIndexes();for(t=0,i=r.length;t<i;t++)e.push($.when(a.cleanCellData(r[t],n.remainingXpath)))}else e.push($.when(a.cleanCellData(n.index,n.remainingXpath)));return $.when.apply($,e)})))}else r.push($.when(a.ready()).then((function(){return $.when(a.renderingDeferred).then((function(){return $.when(a.cleanData()).then((function(){return t.changeRenderRequired(e,null!=a.properties.required&&a.properties.required)}))}))})))})),$.when.apply($,r);t.Class.THROW_ERROR&&t.showRenderNotFoundError(e)},changeContainerBackground:function(e,t){var i=this.form.getContainer(e);null!=i?$.when(i.ready()).done((function(){i.changeBackgroundColor(t),i.visualChanges.backgroundColor=t})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeContainerVisibility:function(e,t){var i=this.form.getContainer(e);null!=i?$.when(i.ready(!0)).done((function(){$.when(i.renderingDeferred).done((function(){i.changeVisibility(t),i.visualChanges.visibility=t}))})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},toogleContainer:function(e,t){var i=this.form.getContainer(e);null!=i?/group/i.test(i.properties.type)&&$.when(i.ready()).done((function(){i.toogleContainer(t)})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeActiveItem:function(e){var t=this.form.getContainer(e);null!=t?("tabItem"===t.properties.type&&t.loadingDeferred&&t.loadingDeferred.resolve(),$.when(t.ready()).done((function(){t.setAsActiveContainer()}))):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeContainerEditability:function(e,t){if(bizagi.override.changeEditabilityOnReadOnlyForms||!this.form.properties.displayAsReadOnly){var i=this.form.getContainer(e);null!=i?$.when(i.ready()).done((function(){i.changeEditability(t),i.visualChanges.editability=t})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)}},searchGridColumns:function(e,t){var i;if("string"==typeof e||"boolean"==typeof e)return null;if(e.expressions){var r,a;for(r=0,a=e.expressions.length;r<a;r++)this.searchGridColumns(e.expressions[r],t)}else{if(e.simple)return this.searchGridColumns(e.simple,t);if(e.complex)return this.searchGridColumns(e.complex,t);var n=e.xpath||e.renderId;n&&(n&&n.indexOf("[]")>0&&(i=n.substring(n.indexOf("[]")+3),t.push(i)),"xpath"===e.argumentType&&e.argument.indexOf("[]")>0&&(i=e.argument.substring(e.argument.indexOf("[]")+3),t.push(i)))}return null},isGridComponent:function(e,t){var i=bizagi.util.normalizeType(e.properties.type);return/grid$/i.test(i)&&t.indexOf("[")>=0},isValidRender:function(e){return-1===["collectionnavigator"].indexOf(e.properties.type)},changeFormButtonVisibility:function(e,t){var i=this.form,r=i.buttons&&i.buttons.length?i.buttons:i.properties.buttons||[],a=r.findIndex((function(t){return t.id===e})),n=i.getNavigation();-1!==a&&(r[a].visible=t),i.buttons=r||[],n.setNavigationButtons(i)},getVisualChange:function(e,t,i){return new Object({element:e,command:t,argument:i,indexes:[],xpath:""})},logVisualChange:function(e){if(e.indexes.length>0)for(var t=0;t<e.indexes.length;t++){var i=e.element.getControlCell(e.indexes[t],e.xpath);i&&(i.visualChanges[e.command]=e.argument)}else e.element.visualChanges[e.command]=e.argument},configureOverrides:function(){if(!this.Class.overridesInitiated){switch(bizagi.override.enableExecuteRefreshAction||void 0!==bizagi.override.refreshActionBehavior||(bizagi.override.refreshActionBehavior="DEPRECATED-11.2.3"),bizagi.override.refreshActionBehavior=bizagi.override.refreshActionBehavior||"11.2.5"){case"DEPRECATED-11.2.3":bizagi.override.enableExecuteRefreshAction=!1,bizagi.override.restoreAppearanceAfterRefresh=!1;break;case"DEPRECATED-11.2.4":bizagi.override.enableExecuteRefreshAction=!0,bizagi.override.restoreAppearanceAfterRefresh=!1;break;case"11.2.5":default:bizagi.override.enableExecuteRefreshAction=!1,bizagi.override.restoreAppearanceAfterRefresh=!0}this.Class.overridesInitiated=!0}}}),$.Class.extend("bizagi.rendering.element",{ELEMENT_TYPE_CONTAINER:1,ELEMENT_TYPE_RENDER:2,ELEMENT_TYPE_COLUMN:3},{init:function(e){this.renderFactory=e.renderFactory,this.dataService=e.dataService,this.parent=e.parent,this.resources=bizagi.localization,this.observableElement=$("<div />"),this.disposed=!1,this.initializeData(e.data),this.subscribers=[]},initializeData:function(e){this.properties={},e&&e.properties&&(this.properties=e.properties),this.properties.xpathContext=this.getXpathContext(),this.properties.idPageCache=this.getPageCache(),this.visualChanges=this.visualChanges||{}},getXpathContext:function(){return null!=this.parent&&"function"==typeof this.parent.getXpathContext?this.parent.getXpathContext():""},getXpath:function(){return this.properties.xpath},getPageCache:function(){return null!=this.parent&&"function"==typeof this.parent.getPageCache?this.parent.getPageCache():""},getFormContainer:function(){if(void 0!==this.parent)return this.parent.getFormContainer()},getResource:function(e){return this.resources.getResource(e)},getElementType:function(){},resize:function(e){},focus:function(){if(this.properties.required){var e=$("#ui-bizagi-wp-app-render-form-content");bizagi.util.isScrolledIntoView(this.element,e)||$(this.element).attr("tabindex",-1).focus(),this.element&&this.element.effect("highlight",2e3)}this.parent&&"function"==typeof this.parent.focus&&this.parent.focus()},triggerGlobalHandler:function(e,t){return this.disposed?null:this.parent?this.parent.triggerGlobalHandler(e,t):null},trigger:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.trigger(e,t):null},triggerHandler:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.triggerHandler(e,t):null},bind:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.bind(e,t):(this.subscribers.push({event:e}),null)},unbind:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.unbind(e,t):null},one:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.one(e,t):(this.subscribers.push({event:e}),null)},getRenderedElement:function(){},getMode:function(){if(this.parent)return this.parent.getMode()},getParams:function(){if(this.parent)return this.parent.getParams()},getFormType:function(){return this.getFormContainer().properties.type||"form"},ready:function(){},isReadyToSave:function(){},getCustomHandlers:function(){return null},dispose:function(){var e=this;e.disposed=!0;var t=setTimeout((function(){null!=e.subscribers&&$.each(e.subscribers,(function(t,i){e.unbind(i.event)})),delete e.subscribers,e.observableElement&&e.observableElement.off(),bizagi.util.dispose(e),clearTimeout(t)}),bizagi.override.disposeTime||50)},isDisposed:function(){return this.disposed},processFailMessage:function(e){var t=this.getFormContainer(),i=bizagi.util.isOfflineForm({context:this});if("CustomMessageException"===e.errorType){t.validationController.clearValidationMessages();var r=bizagi.localization.getResource(e.message);t.validationController.showErrorMessage(r)}else if("InvalidCaseStateException"===e.errorType){var a=t.getParams();t.validationController.clearValidationMessages(),t.container.trigger("routing",{idCase:a.idCase||bizagi.context.idCase})}else{var n=(e="string"==typeof(e=e||{})?JSON.parse(e):e).type||"error",o=e.code||"code";if(e=e.responseText||e.message||e,"not-processed"===n)return;if("not-shown"===n)return;if(i&&"AUTH_ERROR"===o)return;t.validationController.clearValidationMessages(),"alert"==n?t.validationController.showAlertMessage(e):t.validationController.showErrorMessage(e)}return e},startLoading:function(){},endLoading:function(){},beforeToRefresh:function(){},afterToRefresh:function(){bizagi.override&&!0===bizagi.override.enableExecuteRefreshAction&&this.getFormContainer().tryToExecuteFunction(this.properties.xpath||this.properties.id)},getResourceByKey:function(e,t){return t=t||e,bizagi.localization.getResource(e,t)},restoreAppearance:function(){for(var e in this.visualChanges)switch(e){case"color":this.changeColor(this.visualChanges[e]);break;case"backgroundColor":this.changeBackgroundColor(this.visualChanges[e]);break;case"required":this.changeRequired(this.visualChanges[e]);break;case"editability":this.changeEditability(this.visualChanges[e]);break;case"visibility":this.changeVisibility(this.visualChanges[e]);break;case"minValue":this.changeMinValue(this.visualChanges[e]);break;case"maxValue":this.changeMaxValue(this.visualChanges[e])}},getOrientation:function(){for(var e=this;e;){if(properties=e.properties||{},"auto"!==properties.orientation)return properties.orientation;e=e.parent}return"auto"}}),bizagi.rendering.element.extend("bizagi.rendering.container",{TYPE_QUERY_FORM:"queryForm"},{initializeData:function(e){var t=this;t._super(e);var i=t.properties;i.uniqueId=Math.ceil(1e6*Math.random()),i.editable=void 0===i.editable||bizagi.util.parseBoolean(i.editable),i.visible=void 0===i.visible||bizagi.util.parseBoolean(i.visible),i.orientation=i.orientation||"auto",this.originalProperties=JSON.parse(JSON.encode(i)),this.children=[],this.childrenHash={},e.elements&&$.each(e.elements,(function(e,i){i.render?t.createRenderElement(i):i.container?t.createContainerElement(i):i.form&&t.createFormElement(i)}))},createRenderElement:function(e){var t,i=this.properties;0==i.editable&&(e.render.properties.editable=i.editable),!1===i.required&&(e.render.properties.required=i.required),"duplicate"==e.render.properties.retype&&(t=bizagi.clone(e));var r=this.renderFactory.getRender({type:e.render.properties.type,data:e.render,dataService:this.dataService,parent:this,mode:this.getMode()});this.children.push(r),"duplicate"==e.render.properties.retype&&this.processDuplicateRender(r,t),this.getFormContainer().registerRender(r)},createContainerElement:function(e){var t=this.properties;0==t.editable&&(e.container.properties.editable=t.editable),!1===t.required&&(e.container.properties.required=t.required);var i=this.renderFactory.getContainer({type:e.container.properties.type,data:e.container,parent:this,dataService:this.dataService,mode:this.getMode(),isDesign:"design"===this.getMode()});this.children.push(i),this.getFormContainer().registerRender(i)},createFormElement:function(e){var t=this.properties;0==t.editable&&(e.container.properties.editable=t.editable);var i=this.renderFactory.getContainer({type:e.form.properties.type||"form",data:e.form,parent:this,dataService:this.dataService,mode:this.getMode()});this.children.push(i)},getElement:function(){return this.container},getElementsByType:function(e,t){t=t||[];return $.each(this.children,(function(i,r){r.properties.type==e&&t.push(r),r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&r.getElementsByType(e,t)})),t},processDuplicateRender:function(e,t){var i=JSON.parse(JSON.encode(t.render));i.properties.displayName=i.properties.displayName+" "+this.getResource("render-text-duplicate-label-sufix"),i.properties.xpath=i.properties.xpath+".clone",i.properties.isClone=!0;var r=this.renderFactory.getRender({type:i.properties.type,data:i,parent:this,mode:this.getMode()});e.cloneRender=r,this.children.push(r)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_CONTAINER},render:function(){var e;this.getMode();return e=this.internalRender(),this.applyContainerDefaults(),e.attr("data-container-id",this.properties.id),this.properties.tag&&e.attr("data-tag",this.properties.tag),this.params&&this.params.requestedForm&&e.addClass(this.params.requestedForm),e},internalRender:function(){var e=this.renderContainerHtml(),t=this.container=$(e);return this.postRenderContainer(t),this.container},renderContainerHtml:function(){return this.renderingDeferred=this.renderingDeferred||new $.Deferred,this.renderContainer()},isRendered:function(){return!!this.renderingDeferred&&this.renderingDeferred.promise()},getRenderedElement:function(){return bizagi.util.isEmpty(this.container)&&alert("container hasn't been rendered!"),this.container},applyContainerDefaults:function(){var e=this.properties;e.backgroundColor&&this.changeBackgroundColor(e.backgroundColor),e.visible||this.changeVisibility(e.visible)},changeBackgroundColor:function(e){this.properties.backgroundColor=e,$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.changeBackgroundColor(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeBackgroundColor(e)}))},changeVisibility:function(e){var t=this.properties;t.visible=bizagi.util.parseBoolean(e),t.visible?this.container.show():this.container.hide()},changeEditability:function(e){this.properties.editable="Default"==e?this.originalProperties.editable:bizagi.util.parseBoolean(e),$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?$.when(i.ready()).done((function(){i.changeEditability(e)})):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeEditability(e)}))},replaceTag:function(e,t,i){bizagi.util.replaceSelector(e,t,i)},replaceChildrenTag:function(e,t){this.replaceTag(e,".children",t)},replaceChildrenHtml:function(e,t){return e.replaceFirstWithoutPatterns("{{children}}",t)},renderContainer:function(){},postRenderContainer:function(e){var t=this.getMode();this.renderingDeferred&&this.renderingDeferred.resolve(),this.container=e,this.executeChildrenPostRender(e),"execution"==t&&(this.configureHandlers(),this.applyPlaceHolderPolyfill()),"design"==t&&this.configureDesignView(),"layout"==t&&(this.configureDesignView(),this.configureLayoutView())},applyPlaceHolderPolyfill:function(){var e=window.placeHolderConfig||{};("placeholder"in $("<input>")[0]||"placeHolder"in $("<input>")[0])&&!e.forceApply||Placeholders.enable()},executeChildrenPostRender:function(e){var t=this,i=e.children();$.each(i,(function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var a=t.childrenHash[r];if(a){var n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&a.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&a.postRenderContainer(i)}}else t.executeChildrenPostRender(i)}))},configureHandlers:function(){},configureDesignView:function(){},configureLayoutView:function(){},renderChildrenHtml:function(){var e=this,t="";return $.each(e.children,(function(i,r){var a=r.getElementType();a==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(t+=r.renderElement()),a==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(t+=r.renderContainerHtml()),e.childrenHash[r.properties.uniqueId]=r})),t},collectRenderValues:function(e){this.children&&$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValues(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSent()&&i.collectData(e)}))},hasChanged:function(e){if((e=e||[]).length)return e;this.children&&$.each(this.children,(function(t,i){if(e.length||i.hasChanged(e))return!1}))},collectRenderValuesQueryForm:function(e){$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValuesQueryForm(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSentQueryForm()&&i.collectDataQueryForm(e)}))},firstChild:function(){return this.children[0]},getRenders:function(e,t){return t=t||[],e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),$.each(this.children,(function(i,r){r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.getRenders(e,t):r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&e==r.properties.xpath&&t.push(r)})),t},getRender:function(e){var t=this.getRenders(e),i=null;return $.each(t,(function(e,t){t.properties.editable&&null==i&&(i=t)})),null==i&&$.each(t,(function(e,t){i=t})),i},getRendersByXpath:function(e){return this.getRenders(e)},getContainer:function(e){var t;return this.properties.id==e?this:($.each(this.children,(function(i,r){if(r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var a=r.getContainer(e);if(null!=a)return t=a,!1}})),t)},isValid:function(e){return this.children&&$.each(this.children,(function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.isValid(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.isValid(e))})),0==e.length},hasValidGrids:function(e){return $.each(this.children,(function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.hasValidGrids(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&void 0!==i.grid&&i.isValid(e))})),0==e.length},ready:function(){return $.when(this.parent.ready(),this.isRendered())},isReadyToSave:function(){var e=$.map(this.children,(function(e){return e.isReadyToSave()}));return $.when.apply($,e)},getFocus:function(){var e;return $.each(this.children,(function(t,i){if(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var r=i.getFocus();bizagi.util.isEmpty(r)||(e=r)}})),e},getCustomHandlers:function(){var e=this.getFormContainer();if(e)return e.getCustomHandlers()},getCustomHandler:function(e){var t=this.getCustomHandlers();if(t)return t[e]},dispose:function(){var e=this,t=setTimeout((function(){e.children&&$.each(e.children,(function(e,t){t.dispose()})),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()},refreshContainer:function(e){var t=this,i=t.properties,r=t.getFormContainer();return t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||e.xpathContext,contexttype:t.properties.contexttype||"",idForm:r&&r.properties&&r.properties.id?r.properties.id:""})).done((function(e){if(!t.isDisposed()){bizagi.override.restoreAppearanceAfterRefresh&&t.saveChildrenVisualChanges(t),t.unregisterChildren(),delete t.children,delete t.childrenHash,t.getFormContainer().removeActions(),!1===t.properties.editable&&e.container&&e.container.properties&&(e.container.properties.editable=!1),t.initializeData(e.container);var i=t.container,r=t.render();"tabItem"==t.properties.type&&$(r).addClass("childrenActive"),i.replaceWith(r);var a=e.container&&e.container.actions?e.container.actions:[];t.getFormContainer().refreshActions(a),t.triggerChildrenActions(),bizagi.override.restoreAppearanceAfterRefresh&&(t.restoreChildrenVisualChanges(t),delete t.childrenVisualChanges,t.restoreAppearance(e.container)),t.afterToRefresh()}})).fail((function(e){e=t.processFailMessage(e)})).always((function(){t.endLoading()}))},refreshDesignContainer:function(e){var t=this.properties;if(this.beforeToRefresh(e),$.extend(e.properties,{editable:t.editable,contexttype:t.contexttype||"",idPageCache:t.idPageCache,idRender:t.id,messageValidation:t.messageValidation,uniqueId:t.uniqueId,visible:t.visible,xpath:t.xpath,mode:"design",xpathContext:t.xpathContext||""}),!this.isDisposed()){this.unregisterChildren(),delete this.children,delete this.childrenHash,!1===this.properties.editable&&e.container&&e.container.properties&&(e.container.properties.editable=!1),this.initializeData(e.container);var i=this.container,r=this.render();"tabItem"==this.properties.type&&$(r).addClass("childrenActive"),i&&i.replaceWith(r),this.afterToRefresh()}},beforeToRefresh:function(){for(var e=0;e<this.children.length;e++)this.children[e].beforeToRefresh()},afterToRefresh:function(){bizagi.override&&!0===bizagi.override.enableExecuteRefreshAction&&this.getFormContainer().tryToExecuteFunction(this.properties.id);for(var e=0;e<this.children.length;e++)this.children[e].afterToRefresh()},triggerChildrenActions:function(){for(var e=this.children,t=0,i=e.length;t<i;t++){var r=e[t],a=r.getElementType();a===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.triggerChildrenActions():a===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&r.triggerRenderChange({changed:!1})}},registerActions:function(e){var t=this.getFormContainer();e&&t.actionController.buildActions(e)},unregisterChildren:function(){for(var e=this.getFormContainer(),t=this.children,i=0,r=t.length;i<r;i++){var a=t[i],n=a.getElementType();n===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?a.unregisterChildren():n===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&e.unregisterRender(a)}},replaceChild:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){if(t[i].properties.uniqueId==e.properties.uniqueId){t.splice(i,1),t.splice(i,0,e);break}}},getChildById:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){var a=t[i];if(a.properties.id==e)return a}return null},restoreAppearance:function(e){var t=this;t._super(),(e.elements||[]).forEach((function(e){t.restoreElementAppearance(e.container||e.render)}))},restoreElementAppearance:function(e){var t=this.getChildById(e.properties.id);t&&t.restoreAppearance(e)},saveChildrenVisualChanges:function(e){var t=this;t.childrenVisualChanges=t.childrenVisualChanges||{},(e.children||[]).forEach((function(e){var i=e.getElementType();i===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?(t.childrenVisualChanges[e.properties.id]=e.visualChanges,t.saveChildrenVisualChanges(e)):i===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(t.childrenVisualChanges[e.properties.id]=e.visualChanges)}))},restoreChildrenVisualChanges:function(e){var t=this;(e.children||[]).forEach((function(e){var i=e.getElementType(),r=t.childrenVisualChanges&&t.childrenVisualChanges[e.properties.id]||{};i===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?(e.visualChanges=r,t.restoreChildrenVisualChanges(e)):i===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(e.visualChanges=r)}))}}),bizagi.rendering.container.extend("bizagi.rendering.desktop.container",{},{initializeData:function(e){this._super(e),this.containsGrid=0!=this.countByRenderType("grid")},createRenderElement:function(e){if((this.getFormContainer()&&this.getFormContainer().properties).isSearchesQueryForm){var t=e.render.properties;t.rangeQuery&&"none"!=t.rangeQuery&&(t.xpath=t.xpath+"@"+t.rangeQuery),"multiselect"!==t.type&&this._super(e)}else this._super(e)},resize:function(e){var t=this.container.width();t<300||0!=this.containsGrid&&$.each(this.children,(function(e,i){$.when(i.isRendered()).done((function(){i.resize({width:t})}))}))},startLoading:function(){var e=this.container;e&&e.startLoading({delay:250,overlay:!0})},endLoading:function(){var e=this.container;e&&e.endLoading()},countByRenderType:function(e){for(var t=0,i=0;i<this.children.length;i++){var r=this.children[i];r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(t+=r.countByRenderType(e)),r.properties.type==e&&t++}return t},countByRenderTypeWithParams:function(e,t){for(var i=0,r=0;r<this.children.length;r++){var a=this.children[r];a.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(i+=a.countByRenderType(e)),a.properties.type==e&&t==a.properties.height&&i++}return i},configureLayoutView:function(){this.container},getChildrenSumHeight:function(e){for(var t=0,i=0;i<this.children.length;i++){var r=this.children[i];if(e&&e==r.properties.type&&-1==r.properties.height);else if(r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var a=$(r.container).height();t+=null!=a?a:0}else if(r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER){var n=$(r.element).height();t+=null!=n?n:0}}return t},getChildreCount:function(){return this.children.length}}),$.Class.extend("bizagi.rendering.form",{},{init:function(e){var t=e.data,i=bizagi.util.detectDevice();this.rendersById={},this.rendersByXpath={},this.rendersByXpathId={},this.rendersByType={},this.idPageCache=t.pageCacheId,this.compatibilityVersion=t.properties.compatibilityVersion||0,this.mode=e.mode||"execution",this.focus=e.focus,this.params=e,this._super(e);var r="";r="desktop"!==i?this.getResource("render-form-user-confirmation-message").replace(/<br(\/| \/)>/g,"\n"):this.getResource("render-form-user-confirmation-message");var a=this.properties;a.sessionId=t.sessionId,a.displayAsReadOnly=bizagi.util.parseBoolean(t.displayAsReadOnly)||!1,a.userConfirmationMessage=a.userConfirmationMessage||r,a.orientation=a.orientation||"ltr",a.hasRule=bizagi.util.parseBoolean(a.hasRule)||!1,a.contexttype=e.contexttype||"",a.paramsRender=e.paramsRender||{},a.processPath=e.data.processPath?e.data.processPath.replaceAll("|/|","  &rsaquo;  "):"",a.breadCrumb=e.data.processPath?e.data.processPath.split("|/|"):[],a.type=a.type||"form",this.validations=t.validations,this.actions=t.actions,this.allowValidateAndSaveAction=bizagi.override&&!0===bizagi.override.enableActionValidateAndSave;var n=bizagi.util.isFeatureEnabled("enableExecuteQuickActions"),o=null===n||n;if(this.useQuickActions=o&&this.hasQuickActions(t,o),this.initializeButtons(t),t.transitions&&(this.transitions=t.transitions),this.originalProcessButton=this.processButton,this.isRoutingDisabled=!1,e.applicationParent)switch(e.applicationParent){case"NEWWORKPORTAL":this.isRoutingDisabled=!0}this.isOfflineFormsV2Supported=bizagi.util.isMobileDevice()&&bizagi.util.isOfflineFormsV2Supported(),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.rendersById[a.id]=this},initializeButtons:function(e){var t=this;t.buttons=[],e.buttons&&$.each(e.buttons,(function(e,i){var r=i.button.properties;r.caption=bizagi.util.isEmpty(r.caption)||t.getResource(r.caption)===r.caption?r.caption:t.getResource(r.caption),r.actions&&$.each(r.actions,(function(e,t){r[t]=!0})),r.ordinal=e,r.action=r.next?"next":r.nextWithoutValidations?"nextWithoutValidations":r.submitData?"save":r.cancel?"cancel":r.back?"back":r.createnewcase?"createnewcase":r.validate?"validate":"",r.save="save"===r.action,r.quickAction="quickactions"===r.type,(r.next||r.back||r.nextWithoutValidations)&&(r.routing=!0),r.hasRule&&(r.executeRule=!0),t.allowValidateAndSaveAction&&r.validate&&(r.submitData=!0,r.refresh=!0,r.save=!0,"next"!==r.action&&"createnewcase"!==r.action||(r.refresh=!1)),r.style=t.buildButtonStyle(r),t.buttons.push(r)}))},getParams:function(){return this.params},setParam:function(e,t){this.params&&(this.params[e]=t)},getMode:function(){return this.mode},getCustomHandlers:function(){if(this.params)return this.params.customHandlers},registerRender:function(e){var t=e.properties.xpath,i=e.properties.id,r=e.properties.type,a=t?t+"."+i:void 0;this.rendersById[i]=e,t&&(this.rendersByXpath[t]||(this.rendersByXpath[t]=[]),this.rendersByXpath[t].push(e)),a&&(this.rendersByXpathId[a]||(this.rendersByXpathId[a]=[]),this.rendersByXpathId[a].push(e)),this.rendersByType[r]||(this.rendersByType[r]=[]),this.rendersByType[r].push(e)},unregisterRender:function(e){if(this.rendersById[e.properties.id]&&delete this.rendersById[e.properties.id],e.properties.xpath){var t;if($.isArray(this.rendersByXpath[e.properties.xpath])&&this.rendersByXpath[e.properties.xpath].length>1)-1!==(t=this.rendersByXpath[e.properties.xpath].findIndex((function(t){return bizagi.util.md5(JSON.stringify(t.properties))===bizagi.util.md5(JSON.stringify(e.properties))})))&&this.rendersByXpath[e.properties.xpath].splice(t,1);else delete this.rendersByXpath[e.properties.xpath];if(e.properties.id)if($.isArray(this.rendersByXpathId[e.properties.xpath+"."+e.properties.id])&&this.rendersByXpathId[e.properties.xpath+"."+e.properties.id].length>1)-1!==(t=this.rendersByXpathId[e.properties.xpath+"."+e.properties.id].findIndex((function(t){return bizagi.util.md5(JSON.stringify(t.properties))===bizagi.util.md5(JSON.stringify(e.properties))})))&&this.rendersByXpathId[e.properties.xpath+"."+e.properties.id].splice(t,1);else delete this.rendersByXpathId[e.properties.xpath+"."+e.properties.id]}if(e.properties.type)for(var i=this.getRenderByType(e.properties.type),r=i.length,a=e.properties.id||e.properties.xpath,n=0;n<r;n++){var o=i[n];if(void 0!==o.properties.id&&o.properties.id==a||void 0!==o.properties.xpath&&o.properties.xpath==a){this.rendersByType[e.properties.type].splice(n,1);break}}},getRenderById:function(e){return this.rendersById[e]},getGridByColumn:function(e){for(var t=this.getRenderByType("grid"),i=0;i<t.length;i++)if(-1!=t[i].columnsIds.indexOf(e))return t[i];return null},getRenders:function(e){return e&&e.indexOf&&e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),this.rendersByXpathId[e]?this.rendersByXpathId[e]:this.rendersByXpath[e]?this.rendersByXpath[e]:[]},getRenderByType:function(e){return"string"==typeof e&&e.length>0&&this.rendersByType[e]?this.rendersByType[e]:[]},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("form"),i=$.fasttmpl(t,{buttons:this.buttons,transitions:this.transitions,uniqueId:e.uniqueId,helptext:e.helpText,mode:this.getMode(),queryForm:"queryForm"===this.getFormType(),summaryForm:this.params.summaryForm||!1,globalForm:this.properties.displayAsReadOnly||!1,idCase:"",displayName:this.params.displayName||"",processPath:e.processPath,breadCrumb:e.breadCrumb,orientation:e.orientation,isEmpty:bizagi.util.isEmpty(this.children)&&bizagi.util.isEmpty(this.transitions),allowQuickActions:this.useQuickActions});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){var t=this.getMode();e.addClass("ui-bizagi-rendering-mode-"+t),this._super(e)},configureHandlers:function(){var e,t=this,i=t.container;i.length>1?$(i).each((function(){$(this).hasClass("ui-bizagi-container-complexgateway")&&(e=this)})):e=$(".ui-bizagi-container-complexgateway",i),t.activeTransitions={},t.processButtons(i),t.bind("ondomincluded",(function(e,i){var r=t.getValidationsContainer(i);t.validationController=new bizagi.command.controllers.validation(t,t.validations,r),t.actionController=new bizagi.command.controllers.action(t,t.actions),t.readyDeferred.resolve()})),$(e).find(".ui-checkbox").bind("click",(function(){var e=$("label",this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),bizagi.util.parseBoolean(e.data("checked"))?(e.removeClass("ui-checkbox-state-checked"),e.removeClass("bz-check").addClass("bz-full-ball"),e.data("checked",!1),t.activeTransitions[i]=!1):(e.addClass("ui-checkbox-state-checked"),e.addClass("bz-mo-icon").addClass("bz-check").removeClass("bz-full-ball"),e.data("checked",!0),t.activeTransitions[i]=!0)}))},configureDesignView:function(){var e=this;e.bind("ondomincluded",(function(){e.readyDeferred.resolve()}))},buildButtonStyle:function(e){var t={};if(e.format){if(e.format.size&&"0"!=e.format.size){var i=100+10*Number(e.format.size)+"%";t["font-size"]=i+" !important"}if(e.format.bold&&(t["font-weight"]="bold !important",bizagi.util.isIE()&&(t["font-family"]="'Open Sans', 'Helvetica Neue', Arial, Helvetica, sans-serif !important")),e.format.italic&&(t["font-style"]="italic !important"),e.format.underline||e.format.strikethru){var r=bizagi.util.parseBoolean(e.format.strikethru)?"line-through ":"",a=bizagi.util.parseBoolean(e.format.underline)?"underline ":"";t["text-decoration"]=r+a+" !important"}e.format.background&&(t["background-color"]=e.format.background+" !important",t["background-image"]="none !important"),e.format.color&&(t.color=e.format.color+" !important")}var n="";for(key in t)n+=key+":"+t[key]+";";return n},render:function(){return this.readyDeferred||(this.readyDeferred=new $.Deferred),this._super()},ready:function(){return this.readyDeferred.promise()},getXpathContext:function(){return this.properties.xpathContext||""},getContextType:function(){return this.properties.contexttype||""},getEndPointAction:function(){if("startform"==this.properties.formtype)return"LOADSTARTFORM"},getPageCache:function(){return this.idPageCache},getFormContainer:function(){return this},processButtons:function(){var e=this,t=e.getButtons();t&&0!==t.length&&t.on("click",(function(t){t.preventDefault(),t.stopImmediatePropagation();var i=$(this),r=i.attr("ordinal"),a=e.buttons.find((function(e){return e.ordinal==r}));i.prop("disabled",!0),i.hasOwnProperty("disabled")&&i.button("disable"),e.propagateExternalEvents(t);var n=setTimeout((function(){$.when(e.buttonExecutionHandler(a)).always((function(){$.contains(document.documentElement,i.get(0))&&(i.prop("disabled",!1),i.hasOwnProperty("enable")&&i.button("enable"))})),clearTimeout(n)}),100)}))},buttonExecutionHandler:function(e){var t=this;return t.startLoading(),t.lastActionButton=e,"next"===e.action&&(e.routingDisabled=t.isRoutingDisabled),$.when(t.processButton(e)).always((function(){t.processDefer=void 0,t.endLoading()}))},preProcessButton:function(e){return!0},postProcessButton:function(e,t){return!0},setLoaderDeferred:function(){this.loaderDeferred=$.Deferred().resolve()},deleteLoaderDeferred:function(){var e=this;e.isLoaderDeferredSet()&&$.when(e.loaderDeferred.promise()).done((function(){delete e.loaderDeferred})).fail((function(){delete e.loaderDeferred}))},useOrSetLoaderDeferred:function(){this.isLoaderDeferredSet()||this.setLoaderDeferred()},getLoaderPromise:function(){return this.isLoaderDeferredSet()?this.loaderDeferred.promise():void 0},isLoaderDeferredSet:function(){return!!this.loaderDeferred},appendWaitForLoader:function(e){var t=e.promise,i=e.create||!1;if(!this.isLoaderDeferredSet()){if(!i)return;this.setLoaderDeferred()}this.loaderDeferred=this.loaderDeferred.then((function(){return t}))},getResolveOrReject:function(){var e=$.Deferred();return this.isLoaderDeferredSet()?$.when(this.loaderDeferred.promise()).done((function(){e.resolve()})).fail((function(){e.resolve()})):e.resolve(),e.promise()},processButton:function(e){var t=this,i=$.Deferred(),r=t.properties;e.routing||bizagi.chrono.initAndStart("submitForm"),bizagi.chrono.init("waiting"),t.validationController.clearValidationMessages();var a=t.getFormContainer(),n=a.getRenderByType("tabItem"),o=n.length;a.innerTabsLoading=!0,t.useOrSetLoaderDeferred();for(var s=0;s<o;s++){var l=n[s];l.loadingDeferred&&l.parent.container&&l.loadingDeferred.resolve()}return delete a.innerTabsLoading,$.when(t.ready(),t.getResolveOrReject()).done((function(){if(t.deleteLoaderDeferred(),!bizagi.util.parseBoolean(e.validate)||t.validationController.performValidations()){["save","next","back","createnewcase","nextWithoutValidations"].includes(e.action)&&!t.isOfflineForm&&$(document).data("auto-save","");var a=t.getConfirmationStatus(r,e);a.hasConfirmation?(t.endLoading(),$.when(bizagi.showConfirmationBox(a.message,null,!1)).done((function(){t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done((function(){i.resolve()})).fail((function(){i.reject(arguments)})))})).fail((function(){i.reject()}))):t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done((function(){$(document).trigger("FORMACTION",e),i.resolve()})).fail((function(){i.reject(arguments)})))}else t.endLoading(),e.submitData?$.when(t.submitData()).done((function(){i.reject()})):i.reject(),t.validationController.expandNotificationBox();var n=t.getCustomHandler("afterFormButtonClick");n&&n(e)})),i.promise()},validateForm:function(){return this.validationController.clearValidationMessages(),this.validationController.performValidations()},saveForm:function(){var e=this;if(bizagi.util.isNativeMobileDevice()&&!this.allowOnlineActions())return $.when((function(){return null}));var t=e.collectRenderValuesForSubmit(),i=null;return t.deferreds&&(i=$.when.apply($,t.deferreds),delete t.deferreds),$.when(i).pipe((function(){e.startLoading();var i={action:"SAVE",data:t,idCase:e.params.idCase,idWorkitem:e.params.idWorkitem,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,isOfflineForm:e.isOfflineForm||!1};return e.isOfflineForm&&(i.offlineType=e.params.offlineType),$.when(e.dataService.submitData(i)).always((function(){e.endLoading()}))}))},removeCaseSyncError:function(){if(this.removeSyncErrorOnSubmit)return this.removeSyncErrorOnSubmit=!1,"start"==("task"==this.params.offlineType?"task":"start")?this.dataService.removeStartCaseSyncError(this.params):this.dataService.removeTaskCaseSyncError(this.params)},submitForm:function(e){var t=this,i=$.Deferred();return $.when(t.isReadyToSave()).then((function(){t.isOfflineForm?$.when(t.removeCaseSyncError()).then((function(){return t.internalSubmitFormOffline(e)}),(function(){return t.internalSubmitFormOffline(e)})).then((function(){i.resolve()})).fail((function(){i.reject(arguments)})):$.when(t.internalSubmitForm(e)).done((function(){i.resolve()})).fail((function(){i.reject(arguments)}))})).fail((function(){t.endLoading(),bizagi.log("The form is not saved, no changes were found"),i.reject()})),i.promise()},checkWidgetsData:function(){},isComplexGatewayPainted:function(){return!1},getLastActionButton:function(){return this.lastActionButton},internalSubmitFormOffline:function(e){var t,i=this,r=$.Deferred();if(i.isOfflineForm&&i.properties&&!i.properties.idPageCache&&(i.properties.idPageCache=""),e.submitData||e.executeRule||e.save){t=i.collectRenderValuesForSubmit();var a=null;if(bizagi.loading.start(),e.executeRule&&(null==t&&(t={}),(a=i.dataService.executeButton({idRender:e.id,xpathContext:i.properties.xpathContext||"",idPageCache:i.properties.idPageCache,prepare:!0})).tag="executeRule_"+e.id),i.transitions){var n=[];if($.each(this.activeTransitions,(function(e,t){t&&n.push(e)})),0==bizagi.util.countProps(n))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),""}var o=[],s=null;t&&t.deferreds&&(s=$.when.apply($,t.deferreds),o.push(s),delete t.deferreds);var l=[];a&&l.push(a),$.when.apply($,o).done((function(){$.when(i.dataService.submitData({action:e.action,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,idForm:i.properties.id,prepare:!0,transitions:n||"",idCase:i.params.idCase,idWorkitem:i.params.idWorkitem,isOfflineForm:i.isOfflineForm||!1,offlineType:i.params.offlineType||"",actions:l})).then((function(t){if(i.postProcessButton(t,e)){var a="task"!==i.params.offlineType&&"save"===e.action;if(i.online&&i.isOfflineFormsV2Supported&&!a){var n=new $.Deferred,o=$.extend({deferred:n},i.params);$(document).trigger("tryPushCase.offline",o)}i.isOfflineFormsV2Supported||$(document).trigger("tryPushData.offline"),$.when(n).then((function(t){if(bizagi.loading.stop(),e.routing)!i.online&&i.isOfflineFormsV2Supported?i.triggerHandler("routing",{offlineAction:e.action,idCase:i.params.idCase,idWorkitem:i.params.idWorkitem,buttonPropertiesAction:e.action,radNumber:i.params.radNumber}):(i.showToastOnSuccessSync&&(i.showToastOnSuccessSync=!1,bizagi.util.showMobileToast({type:"success",message:bizagi.localization.getResource("workportal-offline-sync-success")})),i.triggerHandler("routing",{idCase:t.IdCase,caseNumber:t.CaseNumber,buttonPropertiesAction:e.action}));else if(i.online||null!=t||(i.isOfflineRefreshWithEdition=!0),(e.refresh||t&&t.shouldRefresh)&&i.refreshForm(),i.showToastOnSuccessSync&&i.online)i.showToastOnSuccessSync=!1,bizagi.util.showMobileToast({type:"success",message:bizagi.localization.getResource("workportal-offline-save-and-sync-success")});else{var a=bizagi.localization.getResource("workportal-mobile-offline-form-successful","Saved");bizagi.util.showNotification({text:a,stop:!1,type:"success"})}r.resolve()})).fail((function(e){bizagi.loading.stop(),bizagi.util.recreateNativeButtons(i);var t=bizagi.localization.getResource("workportal-mobile-offline-sync-fail","Synchronization failed");if(bizagi.util.showNotification({text:t,stop:!1,type:"error"}),$.isArray(e)){var a,n=e,o="";$.each(n,(function(e,t){var r=i.validationToDisplayMessages(a,t.result.type,t.result.messages,o);a=r.bHasValidations,o=r.alertMessage})),a&&""!==o&&bizagi.modalError.show(o,"workportal-general-word-information",!1)}i.failHandler(e),r.reject(e)}))}})).fail((function(e){var t=bizagi.localization.getResource("workportal-mobile-offline-sync-fail","Synchronization failed");bizagi.util.showNotification({text:t,stop:!1,type:"error"}),r.reject(e)}))}))}},partialSubmitFormOffline:function(e){var t=$.Deferred();return $.when(this.dataService.submitData({action:"save",data:e,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,idForm:this.properties.id,prepare:!0,transitions:"",idCase:this.params.idCase,idWorkitem:this.params.idWorkitem,isOfflineForm:this.isOfflineForm||!1,offlineType:this.params.offlineType||"",actions:[]})).fail((function(e){var i=bizagi.localization.getResource("workportal-mobile-offline-form-fail","Not saved");bizagi.util.showNotification({text:i,stop:!1,type:"error"}),t.reject(e)})),t.promise()},internalSubmitForm:function(e){var t=this,i=$.Deferred(),r={};(e.submitData||e.executeRule||e.createnewcase||e.back)&&(r=t.collectRenderValuesForSubmit()),$.when(t.startLoading()).done((function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")}));var a=null,n=null,o=null,s=null,l=null,d=[],u=null;if(e.executeRule&&(r.deferreds&&(u=$.when.apply($,r.deferreds),d.push(u),delete r.deferreds),(a=t.dataService.submitData({action:"SUBMITDATA",data:r,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0})).tag="submitData",s=t.prepareCheckpointAction(e.id),r={},(n=t.dataService.executeButton({idRender:e.id,xpathContext:t.properties.xpathContext||"",idPageCache:t.properties.idPageCache,prepare:!0})).tag="executeRule",l=t.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase||e.nextWithoutValidations){if(t.transitions){var c=[];if($.each(this.activeTransitions,(function(e,t){t&&c.push(e)})),0==bizagi.util.countProps(c))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),t.endLoading(),i.reject(),i.promise()}r&&r.deferreds&&(u=$.when.apply($,r.deferreds),d.push(u),delete r.deferreds),(o=t.dataService.submitData({action:t.getButtonAction(e.action),forcePlanCompletion:e.forcePlanCompletion,data:r,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0,transitions:c||"",contexttype:t.properties.contextType,surrogatekey:t.properties.surrogateKey})).tag="performAction"}var p=[];n&&(p.push(a),p.push(s),p.push(n),p.push(l)),o&&p.push(o),bizagi.chrono.initAndStart("submitForm-ajax");var h=new $.Deferred;return r&&r.deferreds?$.when.apply(this,r.deferreds).done((function(e){h.resolve(e)})).fail((function(){h.reject(),console.log("Error: It was not possible resolve async actions on form ")})):h.resolve(),d.push(h),$.when.apply($,d).done((function(){$.when(t.dataService.multiaction().execute({actions:p})).done((function(r){var a;bizagi.chrono.stop("submitForm-ajax"),t.endLoading();var n="";if($.each(r,(function(e,i){var r=t.validationToDisplayMessages(a,i.result.type,i.result.messages,n);a=r.bHasValidations,n=r.alertMessage})),a)""!==n&&bizagi.modalError.show(n,"workportal-general-word-information",!1),e.executeRule&&t.sendRollbackAction(e.id);else{if(!t.postProcessButton(r,e))return;e.refresh&&t.refreshForm(),e.routing&&(bizagi.jqxhrList.abortAll("rendering_"+t.dataService.guid),t.triggerHandler("routing",{idCase:t.params.idCase,routingDisabled:e.routingDisabled})),e.createnewcase&&r.length>0&&(bizagi.jqxhrList.abortAll("rendering_"+t.dataService.guid),t.triggerHandler("routing",{idCase:r[0].result.IdCase,caseNumber:r[0].result.CaseNumber}))}i.resolve()})).fail((function(r,a,n){e.executeRule&&t.sendRollbackAction(e.id),n&&n.error&&("WaitForCompletionPlanException"===n.error.errorType||"InvalidPlanStateException"===n.error.errorType||"CustomMessageException"===n.error.errorType)?(t.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(n.error.message),null,!1)).then((function(){return $.when(t.internalSubmitForm($.extend({},e,{forcePlanCompletion:!0})))})).done((function(){i.resolve()})).fail((function(){i.reject()}))):(t.failHandler(n),i.reject(n))}))})),i.promise()},validationToDisplayMessages:function(e,t,i,r){return"validationMessages"==t&&(this.addValidationMessage(i),e=!0),"alertMessages"==t&&(r=""===r?i:r+"\n\n"+i,e=!0),{bHasValidations:e,alertMessage:r}},addValidationMessage:function(e,t,i,r,a,n){var o=this;if(bizagi.util.isNativeMobileDevice()&&!this.allowOnlineActions()&&this.clearValidationMessages(),!o.validationController){var s=o.getValidationsContainer();o.validationController=new bizagi.command.controllers.validation(o,void 0,s)}"string"==typeof e?o.validationController.showValidationMessage(e,t,i,r,n):$.each(e,(function(e,a){o.validationController.showValidationMessage(a,t,i,r,n)})),o.validationController.expandNotificationBox(a)},clearValidationMessages:function(e){this.validationController&&this.validationController.clearValidationMessages(e)},addErrorMessage:function(e){bizagi.util.isNativeMobileDevice()&&!this.allowOnlineActions()&&this.clearValidationMessages(),this.validationController&&(this.validationController.showErrorMessage(e),this.validationController.expandNotificationBox())},refreshForm:function(e){var t=this,i=t.properties,r=$.Deferred();(e=e||t.getFocus())&&!e.id&&(e={id:e});var a={idCase:t.params.idCase||"",idWorkitem:t.params.idWorkitem||"",idTask:t.params.idTask||"",focus:e,selectedTabs:t.getSelectedTabs(),selectedSection:t.getSelectedSection(),xpathContext:i.xpathContext,idPageCache:i.idPageCache,isRefresh:!0,contextType:t.getContextType()||"",action:t.getEndPointAction(),idStartScope:t.properties.idStartScope||""};return t.isOfflineRefreshWithEdition&&(a.isEdited=!0,t.isOfflineRefreshWithEdition=!1),t.startLoading(),$.when(t.triggerHandler("refresh",a)).done((function(){r.resolve()})).fail((function(){r.reject()})).always((function(){t.endLoading()})),r.promise()},getSelectedTabs:function(){for(var e=this.getElementsByType("tab"),t=$.map(e,(function(e){return{tab:e.properties.id,selected:e.activeTab}})),i={},r=0,a=t.length;r<a;r++)i[t[r].tab]=t[r].selected;return i},getSelectedSection:function(){return(this.getParams()||{}).selectedSection},getButtons:function(){},addSubmitAction:function(e,t){this.actionController.processInternalSubmitAction(e,t)},startLoading:function(){var e=this.renderFactory.getTemplate("form-waiting");if(!this.waitingOverlay||!this.waitingMessage)if(bizagi.util.isTabletDevice())this.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo("body",$(document)),this.waitingMessage=$.tmpl(e).appendTo("body",$(document));else{var t="sharepoint"===this.params.context,i=this.params.canvas;t&&(i=bizagi.util.scrollTop(i)).context||(i=$("body",$(document)));var r=this.getSize(),a=this.getOffset();r.height==$(window).height()&&(a.top=0),this.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo(i),this.waitingMessage=$.tmpl(e).appendTo(i),this.waitingOverlay.css({height:"100%",width:"100%","min-height":r.height,"min-width":r.width}),this.waitingMessage.css({top:a.top+Math.ceil((r.height-this.waitingMessage.outerHeight())/2)+"px",left:Math.ceil((r.width-this.waitingMessage.outerWidth())/2)+"px"}),i.css("position","relative")}},endLoading:function(){if(this.waitingOverlay&&this.waitingMessage){this.waitingOverlay.remove(),this.waitingMessage.remove(),this.waitingOverlay=null,this.waitingMessage=null;var e=this.params.canvas;null!=e&&e.css("position","")}},getFocusedElement:function(){return this.focus},setFocusedElement:function(e){this.focus=e},triggerGlobalHandler:function(e,t){return this.triggerHandler("globalHandler",{eventType:e,data:t})},failHandler:function(e){try{e=JSON.parse(e)}catch(e){}if(e&&e.length&&e.length>1&&(e=e[0]),e.error&&(e=e.error),e.error&&(e=e.error),"object"==_typeof(e)&&e.message)e="WaitForCompletionPlanException"===e.errorType||"InvalidPlanStateException"===e.errorType||"CustomMessageException"===e.errorType?bizagi.localization.getResource(e.message):e.message;else if("string"==typeof e)try{var t=JSON.parse(e);"WaitForCompletionPlanException"!==t.errorType&&"InvalidPlanStateException"!==t.errorType&&"CustomMessageException"!==e.errorType||(t.message=bizagi.localization.getResource(t.message)),e=t.message}catch(e){}this.addErrorMessage(e),this.endLoading()},resize:function(e){this.setSize(e)},setSize:function(e){this.size=e},getSize:function(){if(this.size)return this.size;var e=this.params.canvas?this.params.canvas:this.getFormContainer().container;return{width:e.width(),height:e.height()}},getOffset:function(){return this.getFormContainer().container.offset()},submitData:function(e){var t=this;if(!bizagi.util.isNativeMobileDevice()||this.allowOnlineActions()){var i=t.collectRenderValuesForSubmit(),r=bizagi.util.isOfflineForm({context:t});if(r&&t.properties&&!t.properties.idPageCache&&(t.properties.idPageCache=""),$.each(i,(function(e,i){var r=t.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))})),!$.isEmptyObject(i)){var a=[],n=null,o=null;return i&&i.deferreds&&(n=$.when.apply($,i.deferreds),a.push(n),delete i.deferreds),o=r?t.dataService.submitData({action:t.isRefreshingAfterSync?"submitdata":"save",data:i,xpathContext:t.properties.xpathContext,contexttype:t.properties.contexttype||"",isOfflineForm:r,offlineType:t.params.offlineType,idCase:t.params.idCase,idWorkitem:t.params.idWorkitem}):t.dataService.multiaction().submitData({action:"SUBMITDATA",data:i,idPageCache:t.properties.idPageCache,xpathContext:t.properties.xpathContext,contexttype:t.properties.contexttype||""}),$.when.apply($,a).then((function(){return $.when(o).fail((function(e){e=t.processFailMessage(e)}))}))}t.isOfflineRefreshWithEdition=!1}},executeRule:function(e){var t=this,i=t.properties,r=e.xpathContext,a=$.Deferred();return""!==i.xpathContext&&(r=""!==r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeRule({idPageCache:i.idPageCache,rule:e.rule,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){var i=e&&e.type?e.type:"",r=t.getFormContainer();t.getFormContainer().clearValidationMessages({clearOnlyServer:!0}),["validationMessages","alertMessages"].includes(i)?("alertMessages"===i?bizagi.modalError&&bizagi.modalError.show(e.messages.join("\n\n"),"workportal-general-word-information",!1):r.addValidationMessage.apply(t,[e.messages,void 0,void 0,void 0,!1,"serverMessage"]),a.reject(e)):a.resolve(e)})).fail((function(e){e=t.processFailMessage(e),a.reject(e)})),a.promise()},executeInterface:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeInterface({idPageCache:i.idPageCache,interface:e.interface,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executeSAPConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeSAPConnector({idPageCache:i.idPageCache,guidsap:e.guidsap,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executeConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeConnector({idPageCache:i.idPageCache,guidConnector:e.guidConnector,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executePipeline:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executePipeline({idPageCache:i.idPageCache,pipeline:e.pipeline,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},refreshActions:function(e){this.actionController.refreshActions(e)},tryToExecuteFunction:function(e){"execution"==this.getMode()&&this.actionController&&this.actionController.tryToExecuteFunction(e)},removeActions:function(){this.actionController.unbindActions()},collectRenderValuesForSubmit:function(e){var t=this;return e=e||{},t.collectRenderValues(e),$.each(e,(function(e,i){var r=t.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))})),e},internalSubmitOnChange:function(e){var t=this,i=(e=e||{}).properties,r=new $.Deferred,a=e.data||{},n=void 0===e.bRefreshForm||e.bRefreshForm;(e.notCollect?e.notCollect:void 0)&&!$.isEmptyObject(a)||t.collectRenderValuesForSubmit(a),t.startLoading();var o=null;return a.deferreds&&(o=$.when.apply($,a.deferreds),delete a.deferreds),$.when(o).then((function(){t.dataService.multiaction().submitData({action:"SUBMITONCHANGE",data:a,idRender:i.id,xpath:i.xpath,xpathContext:t.properties.xpathContext,idPageCache:i.idPageCache,contexttype:i.contexttype}).done((function(e){if(t.cancelPreviousRequest(),t.endLoading(),e&&"validationMessages"==e.type)"function"==typeof t.clearValidationMessages&&t.clearValidationMessages(),t.addValidationMessage(e.messages),r.resolve();else if(n){var a={id:i.id,xpath:i.xpath};void 0!==i.idCase&&$.extend(a,{idCaseObject:bizagi.cache.idCaseObject}),e.IdScope&&(t.properties.idStartScope=e.IdScope),$.when(t.refreshForm(a)).done((function(){r.resolve()})).fail((function(){r.resolve()}))}else r.resolve()})).fail((function(e){t.endLoading();var i="object"==_typeof(e)?e.responseText?JSON.parse(e.responseText):e:{},a=i.message||e,n=i.type||"error";["not-processed","not-shown"].includes(n)||(t.validationController.clearValidationMessages(),"alert"===i.type?t.validationController.showAlertMessage(a):t.validationController.showErrorMessage(a)),r.resolve()}))})),r.promise()},cancelPreviousRequest:function(){if(bizagi.multiactionConnection&&bizagi.multiactionConnection.length)for(var e,t=bizagi.multiactionConnection.length,i=0;i<t;i++)(e=bizagi.multiactionConnection.pop())&&e.abort&&(bizagi.showErrorAlertDialog=!1,e.abort())},prepareCheckpointAction:function(e){var t=this.dataService.sendCheckpoint({url:this.properties.checkpointUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0});return t.tag="checkpoint",t},prepareCommitAction:function(e){var t=this.dataService.commitLinkForm({url:this.properties.commitUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0});return t.tag="commit",t},sendRollbackAction:function(e){this.dataService.rollbackLinkForm({url:this.properties.rollbackUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache})},dispose:function(){var e=this;e.endLoading();var t=setTimeout((function(){e.params&&delete e.params.canvas,delete e.params,delete e.control,e.validationController&&(e.unbind("rendervalidate"),delete e.validationController),e.actionController&&(e.actionController.unbindActions(),delete e.actionController),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()},getButton:function(e){return $(".ui-bizagi-button[data-id='"+e+"']",this.container)},getFloatingButton:function(e){return $("li[data-id='"+e+"']",this.container)},propagateExternalEvents:function(e){$(".bz-overflow-menu")&&$(document).trigger("click.overflow"),$(".jquery-image-zoom")&&"block"==$(".jquery-image-zoom").css("display")&&$("div.jquery-image-zoom a").click()},getButtonAction:function(e){return this.allowValidateAndSaveAction&&"validate"===e?"save":e},isConnected:function(){return!0},configureNetworkHandlers:function(){this.online=bizagi.util.isConnected(),this.isOfflineForm&&bizagi.util.isMobileDevice()&&"debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase()&&(this.online=this.getParams().online,console.log("CONNECTED: ",this.online)),(bizagi.util.isNativeMobileDevice()||bizagi.util.isMobileDevice()&&"debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase())&&($(document).off("online.form"),$(document).on("online.form",this.handleConnectionChange.bind(this)),$(document).off("offline.form"),$(document).on("offline.form",this.handleConnectionChange.bind(this)),$(document).off("offline-notify-form-sync-event"),$(document).on("offline-notify-form-sync-event",this.handleOfflineSyncEvent.bind(this)))},handleConnectionChange:function(e){var t=this.getFormContainer();bizagi.util.isMobileDevice()&&"debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase()?this.online="online"===e.type:this.online=bizagi.util.isConnected(),"offline"===e.type&&t.triggerHandler("offlineForm"),"online"===e.type&&t.triggerHandler("onlineForm")},handleOfflineSyncEvent:function(e,t){var i=this,r=i.params||{};if(!r.hasSyncError){var a=r.idCase+"-"+r.idWorkitem;switch(t.type){case"download-form-success":var n=t.idCase+"-"+t.idWorkitem;a===n&&(console.log("Form downloaded successfully. It will be refreshed",t),$.when(i.dataService.database.validateLocalDataForTaskExists(n).then((function(e){!0===e&&(i.isOfflineRefreshWithEdition=!0),$.when(i.refreshForm(null,!1)).then((function(){o(!1)}))}))));break;case"push-tasks-started":null!=t.tasks&&t.tasks[a]&&o(!0);break;case"push-tasks-error":o(!1),null!=i.validationController&&(i.validationController.clearValidationMessages(),i.validationController.showErrorMessage(t.message));break;case"fetch-tasks-started":null!=t.tasks&&t.tasks[a]&&o(!0);break;case"download-finished":case"download-error":o(!1);break;default:console.warn("Event hast not implementation in bizagi.rendering.form - handleOfflineSyncEvent",t.type,t)}}function o(e){if(e?!(!0===i.isSyncLoaderRunning):!0===i.isSyncLoaderRunning){i.isSyncLoaderRunning=e;for(var t=0;t<3;t++)e?bizagi.loading.start():bizagi.loading.stop()}}},allowOnlineActions:function(){return void 0===this.online||(this.online||!this.online&&this.isOfflineForm)},processQuickButton:function(e){var t=this,i=t.buttons.find((function(t){return t.ordinal==e}));i&&(t.startLoading(),t.lastActionButton=i,"next"===i.action&&(i.routingDisabled=t.isRoutingDisabled),setTimeout((function(){$.when(t.processButton(i)).always((function(){t.processDefer=void 0,t.endLoading()}))}),100))},hasQuickActions:function(e,t){return!!t&&(e.buttons||[]).some((function(e){var t=e.button.properties;return t&&"quickactions"===t.type}))},getValidationsContainer:function(e){return(void 0!==e?e:this).container},getConfirmationStatus:function(e,t){var i=bizagi.util.parseBoolean(t.needsUserConfirmation)||!1,r=t.userConfirmationMessage||"",a=bizagi.util.parseBoolean(e.needsUserConfirmation)&&bizagi.util.parseBoolean(t.routing),n=e.userConfirmationMessage||"";return{hasConfirmation:i||a,message:i?r:n}},saveWorkInProgress:function(){var e=this.collectRenderValuesForSubmit();return bizagi.util.isEmpty(e)?$.Deferred().resolve(void 0).promise():this.dataService.submitData({action:"submitdata",data:e,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,idForm:this.properties.id,prepare:!0,idCase:this.params.idCase,idWorkitem:this.params.idWorkitem,isOfflineForm:this.isOfflineForm||!1,offlineType:this.params.offlineType||"",actions:[]})},isStartForm:function(){var e=this.getFormContainer(),t=e&&e.properties&&e.properties.formtype||"";return/startform/i.test(t)}}),$.Class.extend("bizagi.rendering.formTemplate",{init:function(e){this._super(e),e.paramsRender&&e.paramsRender.contextEvent&&(self.contextEvent=e.paramsRender.contextEvent)},processTemplate:function(e,t){var i=e.replace(/\{\{(((repeater)\s*(\{["':,-\[\]\w\s]*\}))|([\/repeater]+:item)|(\/repeater)|(repeater)|(separator))\}\}/g,"");return i=(i=i.replace(/\{\{([\w:]*)\s*(\{["':,-\[\]\w\s]*\})\}\}/g,(function(e,i,r,a,n){var o=JSON.parse(r);return t[o.id]||""}))).replace(/{{([\w:]*)\s*}}/g,(function(){return""}))},renderContainer:function(){var e=this,t=e.getRenderByType("layout"),i=t.length>0?t[0]:{},r="function"==typeof i.getTemplate?i.getTemplate():"",a="function"==typeof i.getCss?i.getCss():"",n=e.getMode(),o=e.properties.layoutguid||Math.guid(),s={};return i.children&&$.each(i.children,(function(t,i){if("execution"!=n||"layoutPlaceholder"!=i.properties.type){var r=i.getElementType();r==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(s[i.properties.id]=i.renderElement()),r==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(s[i.properties.id]=i.renderContainerHtml()),e.childrenHash[i.properties.uniqueId]=i}})),bizagi.util.loadStyle(a,o),e.processTemplate(r,s)},getContextEvent:function(){return self.contextEvent}}),$.Class.extend("bizagi.rendering.layout",{},{getTemplate:function(){var e=this.getMode(),t=this.properties.html||"";return"design"==e&&t&&(t="<div class='bz-design-template'>"+t+"</div>"),bizagi.util.stripslashes(t)},getCss:function(){var e=this.properties.css||"";return"design"==this.getMode()&&(e=e&&e.desktop),bizagi.util.stripslashes(e)},postRenderContainer:function(e){var t=this.getMode();this.renderingDeferred&&this.renderingDeferred.resolve(),this.container=e,this.executeChildrenPostRender(e),"execution"==t&&this.configureHandlers(),"design"==t&&this.configureDesignView(),"layout"==t&&(this.configureDesignView(),this.configureLayoutView())}}),$.Class.extend("bizagi.rendering.accordion",{},{initializeData:function(e){this._super(e),$.each(this.children,(function(e,t){t.properties.ordinal=e}))},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("accordion"),i=$.fasttmpl(t,{uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),$.Class.extend("bizagi.rendering.accordionItem",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("accordionItem"),i=$.fasttmpl(t,{id:e.id,ordinal:e.ordinal,displayName:e.displayName,orientation:e.orientation,uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},activate:function(){this.active=!0},getFocus:function(){var e=this._super();return bizagi.util.isEmpty(e)&&this.active&&(e=this.properties.id),e}}),$.Class.extend("bizagi.rendering.group",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||"cssClassContainer",t.collapse=!(void 0===t.collapse||!bizagi.util.parseBoolean(t.collapse))},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("group");this.expandedIcon=this.getExpandedIcon(),this.collapsedIcon=this.getCollapsedIcon();var i=$.fasttmpl(t,{expandedClassIcon:this.expandedIcon,displayName:e.displayName,editable:e.editable,orientation:e.orientation,uniqueId:e.uniqueId,collapse:e.collapse,isDesign:"execution"!==this.getMode(),messageValidation:e.messageValidation,cssclass:e.cssclass,guid:e.guid});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},getExpandedIcon:function(){},getCollapsedIcon:function(){},toogleContainer:function(e,t){}}),$.Class.extend("bizagi.rendering.section",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.displayAs=t.displayAs||"section"},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("section-header"),i=$.fasttmpl(t,{displayName:e.displayName,editable:e.editable,orientation:e.orientation,uniqueId:e.uniqueId,isDesign:"execution"!==this.getMode(),messageValidation:e.messageValidation,guid:e.guid});return this.sectionContent=$(this.renderSectionContent())[0],i},renderSectionContent:function(){},getBreadcrumb:function(){for(var e=this,t=[];e;){var i=e.properties||{},r=e.params||{};if("section"===i.type){var a=i.displayName?i.displayName:"";t.unshift(a)}else"form"===r.type&&t.unshift(this.getResourceByKey("render-section-breadcrumb-main-form","Main form"));e=e.parent}return t},getParentDisplayName:function(){var e=this.getSectionParent(this.parent);return"form"==e.properties.type?e.properties.formtype&&"startform"==e.properties.formtype?e.params&&e.params.originalParams&&e.params.originalParams.displayName?e.params.originalParams.displayName:"":e.properties.displayName||e.params.displayName||e.params.radNumber||e.params.idCase:e.properties.displayName||""},getSectionParent:function(e){return"section"!==e.properties.type&&e.parent?this.getSectionParent(e.parent):e},getSectionOrientationRTL:function(e){return!(e&&e.properties&&e.properties.orientation&&"ltr"===e.properties.orientation)&&(!!(e&&e.properties&&e.properties.orientation&&"rtl"===e.properties.orientation)||!!e.parent&&this.getSectionOrientationRTL(e.parent))}}),$.Class.extend("bizagi.rendering.horizontal",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("horizontal"),i=$.fasttmpl(t,{uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),$.Class.extend("bizagi.rendering.panel",{},{initializeData:function(e){this._super(e);var t=this.properties;(t.displayName=t.displayName||"","nestedForm"==t.type)&&(this.getFormContainer().rendersById[t.idForm]=this)},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("panel"),i=$.fasttmpl(t,{displayName:e.displayName,loading:e.loading,message:e.message,orientation:e.orientation,uniqueId:e.uniqueId,cssClass:e.cssclass});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){var t=this.properties;t.height&&e.height(t.height),this._super(e)}}),$.Class.extend("bizagi.rendering.contentPanel",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayName=t.displayName||""},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("contentPanel"),i=$.fasttmpl(t,{displayName:e.displayName,mode:this.getMode(),uniqueId:e.uniqueId,isDesign:"design"===this.getMode(),messageValidation:e.messageValidation,cssClass:e.cssclass,guid:e.guid});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){this._super(e)}}),$.Class.extend("bizagi.rendering.searchForm",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("searchForm");"entity"!==e.contexttype&&this.parent&&(e.contexttype="function"==typeof this.parent.getContextType?this.parent.getContextType():"");var i=$.fasttmpl(t,{displayName:e.displayName,uniqueId:e.uniqueId});return i=(i=this.replaceChildrenHtml(i,this.renderChildrenHtml())).replaceFirstWithoutPatterns("{{result}}",this.renderResult())},performSearch:function(e){this.properties.searchParams=e,this.submitSearch()},submitSearch:function(){this.refreshResults()},ready:function(){return this.parent.ready()},getRemoteData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.collectSearchValues();return bizagi.util.isMapEmpty(a)?(bizagi.showMessageBox(this.getResource("render-search-advanced-no-filters"),this.getResource("render-form-dialog-box-search"),"error"),null):(e.rows=i.searchParams&&i.searchParams.maxRecords&&i.searchParams.maxRecords>0?i.searchParams.maxRecords:e.rows,i.searchParams&&void 0!==i.searchParams.maxRows&&(e.rows=i.searchParams.maxRows||e.rows),t.dataService.submitSearch($.extend(e,{url:i.dataUrl,idRender:i.idRender,idPageCache:i.idPageCache,idSearchForm:i.id,allowFullSearch:i.searchParams.allowFullSearch?i.searchParams.allowFullSearch:null,maxRecords:i.searchParams.maxRecords>0?i.searchParams.maxRecords:null,criteria:a})).done((function(e){i.page=e.page,i.records=e.records,i.totalPages=e.totalPages||0,e.records>1e4?(i.deviceMaxRecordsExceeded=!0,e.deviceMaxRecordsExceeded=!0):delete i.deviceMaxRecordsExceeded,r.resolve(e),t.onSearchFinished()})).fail((function(e){if(bizagi.showErrorAlertDialog=!1,e.responseText)try{var t=JSON.parse(e.responseText).message;bizagi.showMessageBox(t,"","error")}catch(e){}r.reject()})),r.promise())},collectSearchValues:function(){var e={};this.collectRenderValues(e);var t=[];for(key in e){var i=key,r=e[key],a=this.getCriteriaOperation(this.getRender(i)),n={};bizagi.util.isEmpty(r)||(n.xpath=i,n.value=r,n.operation=a,t.push(n))}return t},getCriteriaOperation:function(e){var t=this.properties,i="EQUALS";return"15"==e.properties.dataType&&(void 0!==e.properties.typeSearch&&"approx"!==e.properties.typeSearch||(i=t.allowFullSearch?"FULLLIKE":"LIKE")),i},renderResult:function(){},refreshResults:function(){},parseAdditionalProperties:function(e){return 1==e||2==e||3==e||4==e||6==e||7==e||10==e||11==e?{type:"columnNumber"}:29==e?{type:"columnNumberScientificNotation"}:8==e?{type:"columnMoney"}:12==e||13==e?{type:"columnDate"}:5==e?{type:"columnBoolean"}:{type:"columnText"}},onSearchFinished:function(){}}),$.Class.extend("bizagi.rendering.tab",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||""},renderContainer:function(){for(var e=this.properties,t=$.map(this.children,(function(e,t){return e.properties.counter=t,e.properties.tooltip=e.properties.tooltip||e.properties.displayName||"",e.properties})),i=this.renderFactory.getTemplate("tab"),r=this.getMode(),a=$.fasttmpl(i,{id:e.id,tabs:t,mode:r,isDesign:"execution"!==this.getMode(),editable:e.editable,tabOrientation:e.orientation,uniqueId:e.uniqueId,cssclass:e.cssclass}),n=this.activeTab=this.getActiveTab(),o=0,s=this.children.length;o<s;o++)this.children[o].properties.loadOnDemand=o!=n;return a=this.replaceChildrenHtml(a,this.renderChildrenHtml())},getActiveTab:function(){var e=this.properties,t=this.getFormContainer().getParams();"execution"===this.getMode()&&!t.isRefresh&&e.activeTab&&this.getFormContainer().setFocusedElement(e.activeTab);var i=t&&t.selectedTabs?t.selectedTabs:{};if(i[this.properties.id]>=0)return i[this.properties.id];for(var r=0,a=this.children.length;r<a;r++)if(this.children[r].containsFocusedElement())return r;return 0},setActiveTab:function(e){if(this.triggerHandler("selected",{index:e,tab:this.children[e]}),this.children[e]){var t=this.getFormContainer();this.children[e].activate(),this.activeTab=e;var i={};i[this.children[e].parent.properties.id]=e,t.setParam("selectedTabs",i)}}}),$.Class.extend("bizagi.rendering.tabItem",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("tabItem"),i=$.fasttmpl(t,{id:e.id,uniqueId:e.uniqueId,counter:e.counter,tabOrientation:e.orientation,isDesign:"execution"!==this.getMode()});return i=this.renderTabContent(i)},renderTabContent:function(e){return this.replaceChildrenHtml(e,this.renderChildrenHtml())},activate:function(){this.active=!0},getFocus:function(){var e=this._super();return bizagi.util.isEmpty(e)&&this.active&&(e=this.properties.id),e},containsFocusedElement:function(){var e=this.getFormContainer().getFocusedElement();if(e){if(e.xpath){var t=this.getFormContainer().getRenders(e.xpath);$.each(t,(function(t,r){r.properties.id==e.id&&r.properties.editable&&(i=r)}))}else var i=this.getFormContainer().getContainer(e)||this.getFormContainer().getRenderById(e);if(i)for(;i.parent;){if(i.properties.id==this.properties.id||i.parent.properties.id==this.properties.id)return!0;i=i.parent}}return!1}}),bizagi.rendering.element.extend("bizagi.rendering.render",{postRenderTimeout:0,maxRendersPerScreen:50,rendersExecuted:0,renderOptimization:!1,TYPE_QUERY_FORM:"queryForm",startOptimization:function(){bizagi.rendering.render.postRenderTimeout=500,bizagi.rendering.render.rendersExecuted=0,bizagi.rendering.render.renderOptimization=!1},stopOptimization:function(){bizagi.rendering.render.postRenderTimeout=0,bizagi.rendering.render.rendersExecuted=0,bizagi.rendering.render.renderOptimization=!1}},{initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;i.included=void 0!==i.included&&bizagi.util.parseBoolean(i.included),i.uniqueId=Math.ceil(1e6*Math.random()),i.displayName=i.displayName||"",i.editable=void 0===i.editable||bizagi.util.parseBoolean(i.editable),i.visible=void 0===i.visible||bizagi.util.parseBoolean(i.visible),i.includedInResult=void 0!==i.includedInResult&&bizagi.util.parseBoolean(i.includedInResult);var r=bizagi.util.normalizeType(i.type);(/^hidden$/i.test(r)||/^queryHidden$/i.test(r))&&(i.visible=!1),i.required=void 0!==i.required&&bizagi.util.parseBoolean(i.required),i.submitOnChange=void 0!==i.submitOnChange&&bizagi.util.parseBoolean(i.submitOnChange),i.maxLength=i.maxLength||0,i.helpText=bizagi.util.trim(i.helpText)||"",i.textFormat=i.textFormat||{},i.valueFormat=i.valueFormat||{},i.isHidden=void 0!==i.isHidden&&bizagi.util.parseBoolean(i.isHidden),i.visible=!i.isHidden&&i.visible,i.editabilityEnabled=!1,i.color&&(i.textFormat.color=i.color),i.backgroundColor&&(i.textFormat.backgroundColor=i.backgroundColor),i.required=!!i.editable&&i.required,i.orientation=i.orientation||"auto",i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",this.originalProperties={textFormat:{color:i.textFormat.color,backgroundColor:i.textFormat.backgroundColor},valueFormat:{color:i.textFormat.color,backgroundColor:i.textFormat.backgroundColor},visible:i.visible,editable:i.editable,required:i.required,labelAlign:i.labelAlign,valueAlign:i.valueAlign},this.value=void 0!==i.value?i.value:null,this.properties.originalValue=this.value,this.properties.previousValue=this.value,this.calculateInitialLayoutProperties()},calculateInitialLayoutProperties:function(){var e=this.properties;e.displayType=e.displayType||"normal",e.labelAlign=e.labelAlign||this.getDefaultLabelAlign(e.displayType),e.valueAlign=e.valueAlign||this.getDefaultValueAlign(e.displayType),"rtl"===e.orientation&&(e.labelAlign=this.getRTLAlign(e.labelAlign),e.valueAlign=this.getRTLAlign(e.valueAlign));var t=this.calculateRenderWidth(e.labelWidth,e.valueWidth,e.displayType);e.labelWidth=t.label,e.valueWidth=t.control,"percentage"===e.layoutType&&(e.valueWidth=t.control),0==e.labelWidth&&(e.displayType="value",e.valueWidth=t.control),0==e.valueWidth&&(e.displayType="label"),"userfield"===e.type&&(["both","normal","reversed"].includes(e.displayType)?(e.valueWidth=e.valueWidth||50,e.labelWidth=e.labelWidth||50):"vertical"===e.displayType?(e.valueWidth=100,e.labelWidth=100):"label"===e.displayType?(e.valueWidth=0,e.labelWidth=100):(e.valueWidth=100,e.labelWidth=0))},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_RENDER},render:function(e){return this.renderElement(e)},renderElement:function(e){var t=this.properties,i=this.getFormContainer();this.renderingDeferred=new $.Deferred,e=e||"render";var r=this.renderFactory.getTemplate(e),a=t.displayName;"string"==typeof a&&(a=bizagi.util.encodeString(a));var n="desktop"!==bizagi.util.detectDevice()&&("association"===t.type||"uploadecm"===t.type||("actionLauncher"===t.type||"polymorphicLauncher"===t.type)&&bizagi.util.isTabletDevice()||"grid"===t.type&&!bizagi.util.isTabletDevice()),o=parseFloat(t.labelWidth),s=$.fasttmpl(r,{label:a,helpText:t.helpText,editable:t.editable,isExtendedText:"text"==t.type&&t.isExtended,orientation:t.orientation,uniqueId:t.uniqueId,id:t.id,xpath:t.xpath,tag:t.tag,displayType:t.displayType,displayOptionClass:this.getDisplayOptionClass(t.displayType),labelAlignClass:this.getAlignClass(t.labelAlign),valueAlignClass:this.getAlignClass(t.valueAlign),flexAlignClass:bizagi.util.mapAlignClassName(t.columnAlign),labelWidth:o,stringLabelWidth:o+("pixels"==t.layoutType?"px":"%"),valueWidth:parseFloat(t.valueWidth),stringValueWidth:parseFloat(t.valueWidth)+("pixels"==t.layoutType?"px":"%"),layoutType:t.layoutType,isDesign:"design"===this.getMode(),messageValidation:t.messageValidation,printVersion:i.params.printversion,cssClass:t.cssclass||"",includedInResult:t.includedInResult,included:t.included,type:t.type,showFullRender:n,required:t.required}),l=this.internalRenderControl();return l||(l=""),"object"===_typeof(l)&&l.done?"resolved"===l.state()?(s=this.replaceControlHtml(s,this.resolveResult(l)),this.asyncRenderDeferred=null):(this.asyncRenderDeferred=l,s=this.replaceControlHtml(s,"")):s=this.replaceControlHtml(s,l),s},resolveResult:function(e){return bizagi.resolveResult(e)},isRendered:function(){return!!this.renderingDeferred&&this.renderingDeferred.promise()},internalRenderControl:function(){var e=this.properties;return this.control=null,this.renderFactory.printVersion?(e.editable=!1,this.renderControl()):e.editable?this.renderControl():this.renderReadOnly()},postRenderElement:function(e){var t=this,i=t.properties;t.element=e,i.submitOnChange&&t.configureSubmitOnChange(),isLabelFormat=!0;var r=function(e){if(bizagi.rendering.render.renderOptimization&&bizagi.rendering.render.rendersExecuted>bizagi.rendering.render.maxRendersPerScreen)var i=setTimeout((function(){t.internalPostRender(e),bizagi.rendering.render.postRenderTimeout+=50,clearTimeout(i)}),bizagi.rendering.render.postRenderTimeout);else t.internalPostRender(e);bizagi.rendering.render.rendersExecuted++};t.asyncRenderDeferred?$.when(t.asyncRenderDeferred).done((function(i){var a=t.getControl();"function"==typeof t.emptyControlByAsyncRenderDeferred&&t.emptyControlByAsyncRenderDeferred(),a.append(i),r(e),t.processLayout(!isLabelFormat,t.properties.valueFormat||{})})):r(e)},internalPostRender:function(e){var t=this.properties,i=this.getMode();this.control=this.getControl(),this.renderingDeferred&&this.renderingDeferred.resolve(),t.editable?this.renderFactory.printVersion&&this.postRenderPrintVersion?this.postRenderPrintVersion():this.postRender():this.postRenderReadOnly(e),"execution"==i?this.performExecutionModeMethods():this.performDesignModeMethods(),this.processLayout(isLabelFormat,this.properties.textFormat||{}),this.processLayout(!isLabelFormat,this.properties.valueFormat||{})},performExecutionModeMethods:function(){var e=this.properties;this.getFormType()==this.Class.TYPE_QUERY_FORM&&this.configureHandlersQueryForm(),e.editable?this.configureHandlers():this.configureHandlersReadOnly(),this.internalSetInitialValue()},performDesignModeMethods:function(){this.configureDesignView(),this.internalSetInitialValue()},replaceControlHtml:function(e,t){return t=t||"",(e=e||"").replaceFirstWithoutPatterns("{{control}}",t)},getRenderedElement:function(){return bizagi.util.isEmpty(this.element)&&bizagi.log(" render hasn't been rendered!",this,"error"),this.element},internalSetInitialValue:function(){var e=this.properties;this.internalSetInitialValueFlag=!0,e.editable,bizagi.util.isEmpty(this.value)||this.setDisplayValue(this.value),this.internalSetInitialValueFlag=!1},isValid:function(e){var t,i=this.properties,r=this.grid&&this.grid.properties&&this.grid.properties.inlineAdd;if(!1===bizagi.util.parseBoolean(i.visible))return!0;if(!1===bizagi.util.parseBoolean(i.editable)&&!r)return!0;if(this.setValidationMessage(""),bizagi.util.parseBoolean(i.required)){var a=this.getFormContainer(),n=!1,o=this.grid?[this]:a.getRenders(i.xpath),s=/^query/i.test(i.type);if(o.filter((function(e){return e.properties.id==i.id})).forEach((function(e){if(e.hasValue()&&(e.properties.editable||r))return n=!0,!1})),!n&&!this.properties.isClone){t=this.getResource("render-required-text").replaceAll("#label#",i.displayName);var l={xpath:i.xpath,message:t,id:i.id};return s&&(l=$.extend({},l,{id:i.id,isQuery:s})),e.push(l),!1}}if("duplicate"==i.retype){if(this.cloneRender&&this.cloneRender.getValue()!=this.getValue())return t=this.getResource("render-text-retype-error"),e.push({xpath:i.xpath,message:t}),!1}else if("double"==i.retype){var d=$("input",this.element);if(d&&d.data("oldValue")){if(""===d.val())return t=this.getResource("render-text-retype-error"),e.push({xpath:i.xpath,message:t}),!1;if(d.val()!=d.data("oldValue"))return t=this.getResource("render-text-retype-error"),e.push({xpath:i.xpath,message:t}),!1}}var u=!this.grid||!this.grid.getColumn||this.grid.getColumn(this.properties.xpath).properties.editable;if("userPassword"!==i.type&&void 0!==i.maxLength&&i.maxLength>0&&bizagi.util.isNumeric(i.maxLength)&&(u||!u&&this.controlValueIsChanged())){var c=new Number(i.maxLength),p=this.getValue();if(p&&p.toString().length>c)return t=this.getResource("render-text-maxLength-error").replaceAll("#maxLength#",c),e.push({xpath:i.xpath,message:t}),!1}return!0},hasValue:function(){var e=this.getValue();return e&&"text"===this.properties.type&&(e="string"==typeof e?e.trim():e),!bizagi.util.isEmpty(e)},postRender:function(){},postRenderReadOnly:function(){},configureHandlers:function(){},configureHandlersReadOnly:function(){},configureDesignView:function(){},processLayout:function(e,t){var i=this.properties;if(null!=this.getControl()){(t=t||{}).color&&this.changeColor(t.color,e),t.background&&this.changeBackgroundColor(t.background),!t.bold&&t.bold&&e||this.changeFontBold(t.bold,e),t.italic&&this.changeFontItalic(t.italic,e),t.underline&&this.changeFontUnderline(t.underline,e),t.strikethru&&this.changeFontStrikethru(t.strikethru,e),t.size&&this.changeFontSize(t.size,e),i.required=null!=i.required&&bizagi.util.parseBoolean(i.required);var r=null==i.visible||bizagi.util.parseBoolean(i.visible);i.required&&this.changeRequired(i.required),r||(this.grid?this.changeCellVisibility(r):this.changeVisibility(r))}},setValue:function(e,t){t=void 0===t||t,bizagi.util.identicalObjects(e,this.value)||(this.properties.previousValue=this.properties.originalValue=this.value,this.value=this.properties.value=e,this.properties.required&&"execution"==this.getMode()&&(this.checkRequired([])?this.changeRequiredLabel(!1):this.changeRequiredLabel(!0)),t&&!this.internalSetInitialValueFlag&&(this.triggerRenderChange(),this.triggerRenderValidate()))},checkRequired:function(e){var t=this.properties;return!(bizagi.util.parseBoolean(t.required)&&!this.hasValue())||(message=this.getResource("render-required-text").replaceAll("#label#",t.displayName),e.push({xpath:t.xpath,message:message}),!1)},validateInputRetype:function(){return!this.properties.retype||!this.cloneRender||this.getValue()==this.cloneRender.getValue()},triggerRenderChange:function(e){(e=e||{}).changed=void 0===e.changed||e.changed,this.triggerHandler("renderchange",{render:this,changed:e.changed})},triggerRenderValidate:function(){this.triggerHandler("rendervalidate",{render:this})},setDisplayValue:function(e){var t=this.getControl();if(this.setValue(e,!1),!this.properties.editable&&("check"!==this.properties.display||"check"===this.properties.display&&!0===bizagi.override.enableCheck)){var i=this.getDisplayValue(e);"string"!=typeof i&&"number"!=typeof i||(i=bizagi.util.sanitizeHTML(i),$(t).html("<label class='readonly-control'>"+i+"</label>"))}},getValue:function(){return this.value},getDisplayValue:function(){return this.getValue()},getLabel:function(){bizagi.util.mustImplement("getLabel")},getControl:function(){bizagi.util.mustImplement("getControl")},getControlFiller:function(){bizagi.util.mustImplement("getControlFiller")},renderControl:function(){},setValidationMessage:function(e){this.validationMessage=e},renderReadOnly:function(){var e=this.getValue(),t="";return bizagi.util.isObject(e)&&void 0!==e.value?t=bizagi.util.sanitizeHTML(e.value):bizagi.util.isEmpty(e)||(t=bizagi.util.isString(e)?bizagi.util.encodeHtmlText(e):e),t},postRenderPrintVersion:function(){},changeDisplayOption:function(e){this.properties.displayType=e},getDisplayOptionClass:function(e){return""},changeLabelAlign:function(e){this.properties.labelAlign=e},changeValueAlign:function(e){this.properties.valueAlign=e},getAlignClass:function(e){return""},customizeRenderWidth:function(){},changeColor:function(e,t){var i=this,r=i.getControl(),a=i.getLabel();t=void 0===t&&null==t||t;r&&a&&("none"!=e?"value"!==i.properties.displayType&&t?(i.element.each((function(){this.style.setProperty("color",e,"important")})),"grid"==i.properties.type&&i.getControl().find(".bz-mobile-grid__header-title").each((function(){this.style.setProperty("color",e,"important")})),i.getLabel().find("label").css("color",e,"!important"),!1===i.properties.editable&&(i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getElementsToStylize($("label",i.getControl()).css("color",e,"!important")))):(i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getControl().find("*").each((function(t,r){i.getElementsToStylize(r).css("color",e,"!important")}))):(i.element.css("color",""),i.getLabel().find("label").css("color",""),i.getControl().css("color",""),i.getControl().find("input, textarea").each((function(e,t){var r=$(t).data("originalColor")||"";i.getElementsToStylize(t).css("color",r)}))))},changeBackgroundColor:function(e){var t=this.getControl(),i=this.getLabel();if(t&&i)if("none"!=e){this.element.each((function(){this.style.setProperty("background-color",e,"important")})),void 0!==i.find("label").style?this.getLabel().find("label").style("background-color",e,"important"):this.getLabel().find("label").css("background-color",e,"!important");var r=this.getLabel().attr("style");r+="; background-color:"+e+"!important",this.getLabel().attr("style",r)}else this.element.css("background-color",""),this.getLabel().find("label").css("background-color",""),this.getControl().css("background-color",""),this.getControl().find("input, textarea").each((function(e,t){var i=$(t).data("originalColor")||"";$(t).css("background-color",i)}))},getFormattingLabel:function(){return this.getLabel().find("label")},changeFontBold:function(e,t){t=void 0===t&&null==t||t;0!=bizagi.util.parseBoolean(e)&&t?(this.getFormattingLabel().css("font-weight","bold","!important"),this.getControl().find("*").each((function(e,t){$(t).css("font-weight","bold","!important")}))):t&&this.getFormattingLabel().css("font-weight","normal","!important"),t||(1==bizagi.util.parseBoolean(e)?this.getControl().find("*").each((function(e,t){$(t).css("font-weight","bold","!important")})):this.surrogateKey&&"summary"==this.surrogateKey||(this.getControl().find("*").each((function(e,t){$(t).css("font-weight","normal","!important")})),this.getControl().css("font-weight","normal","!important")))},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue,a=!0,n=bizagi.util.normalizeType(e.type),o=this.getFormContainer();if("duplicate"===e.retype&&this.cloneRender&&o.isStartForm())return!0;if($.forceCollectData)return!0;if("grid"===n&&"pending"===this.ready().state())return!1;if(["combo","queryCombo","list","queryList","radio","queryRadio"].includes(n)||/^cascadingcombo$/i.test(n))t&&void 0!==t.length&&(t=t[0]),i&&void 0!==i.length&&(i=i[0]),r&&void 0!==r.length&&(r=r[0]),t=t&&t.id?t.id:t,i=i&&i.id?i.id:i,a=void 0!==(r=r&&r.id?r.id:r)&&null!=r?i!=t||i==r:i!=t;else if("boolean"===n||"queryBoolean"===n||"queryCheck"===n)a=bizagi.util.parseBoolean(i)!=bizagi.util.parseBoolean(t);else if("searchNumber"===n)a=!!t;else if("number"===n)a=(null!==t&&""!==t||null!==i&&""!==i)&&i!==t;else if("text"===n)a=(null!==t&&""!==t||null!==i&&""!==i)&&i!==t;else if("date"===n)i||t?(e.showTime||(t=bizagi.util.getNormalizedDate(t,e.fullFormat),i=bizagi.util.getNormalizedDate(i,e.fullFormat)),a=i!=t):a=!1;else if("actionLauncher"===n){a=!1;var s=[];try{s="string"==typeof i?JSON.parse(i):i}catch(e){}var l=function(e,t){e=e||"";for(var i=!1,r=0,a=(t=t||[]).length;r<a;r++)if(t[r].guidAction==e){i=!0;break}return i};if(s.length==t.length)for(var d=0,u=s.length;d<u;d++)l(s[d].guidAction,t)||(a=!0);else a=!0}else if("polymorphicLauncher"===n||"entityTemplate"===n)a=i.length!=t.length||JSON.encode(t)!=JSON.encode(i);else if("searchList"===n){var c={};try{c=JSON.parse(t)}catch(e){console.log("Error when detect change value on searchList control")}a=JSON.encode(i)!=JSON.encode(c.value)}else a=!["signature","image"].includes(n)&&i!==t;return a},changeFontItalic:function(e,t){var i=this;t=void 0===t&&null==t||t;"value"!=i.properties.displayType&&t?1==bizagi.util.parseBoolean(e)?i.getFormattingLabel().css("font-style","italic","!important"):i.getFormattingLabel().css("font-style","normal","!important"):1==bizagi.util.parseBoolean(e)?(t&&i.getFormattingLabel().css("font-style","italic","!important"),i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("font-style","italic","!important")})):i.getElementsToStylize(i.getControl()).css("font-style","italic","!important")):(t&&i.getFormattingLabel().css("font-style","normal","!important"),i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("font-style","normal","!important")})):i.getElementsToStylize(i.getControl()).css("font-style","normal","!important"))},changeFontUnderline:function(e,t){var i=this,r=i.properties.textFormat||{},a=i.properties.valueFormat||{},n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(a.strikethru)?"line-through ":"";t=void 0===t&&null==t||t;1==bizagi.util.parseBoolean(e)&&t?(i.getFormattingLabel().css("text-decoration",n+"underline","!important"),i.getControl().each((function(e,t){i.getElementsToStylize(t).css("text-decoration",n+"underline")}))):t&&i.getFormattingLabel().css("text-decoration",n,"!important"),"value"!=i.properties.displayType&&t||(1==bizagi.util.parseBoolean(e)?i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o+"underline","!important")})):i.getElementsToStylize(i.getControl()).css("text-decoration",o+"underline","!important"):i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o,"!important")})))},changeFontStrikethru:function(e,t){var i=this,r=i.properties.textFormat||{},a=i.properties.valueFormat||{},n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(a.underline)?"underline ":"";t=void 0===t&&null==t||t;1==bizagi.util.parseBoolean(e)&&t?i.getFormattingLabel().css("text-decoration",n+"line-through","!important"):t&&i.getFormattingLabel().css("text-decoration",n,"!important"),"value"!=i.properties.displayType&&t||(1==bizagi.util.parseBoolean(e)?i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o+"line-through","!important")})):i.getElementsToStylize(i.getControl()).css("text-decoration",o+"line-through","!important"):i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o,"!important")})):i.getElementsToStylize(i.getControl()).css("text-decoration",o,"!important"))},changeFontSize:function(e,t){t=void 0===t&&null==t||t;if("0"!=e){var i=this.getFormattingLabel(),r=100+10*Number(e)+"%";if(t&&i.css("font-size",r,"!important"),"value"==this.properties.displayType||!t){var a=this.getControl();"object"==_typeof(a.children())&&a.children().length>0?this.getElementsToStylize(a.children()).css("font-size",r,"!important"):(this.getElementsToStylize(a).css("font-size",r,"!important"),-1!=this.properties.type.indexOf("ombo")&&e>4&&a.children(0).height(2*e+20)),this.getElementsToStylize(a.find(".ui-bizagi-render-date")).css("line-height","normal")}}},getElementsToStylize:function(e){return $(e)},changeVisibility:function(e){var t=this.properties;1==bizagi.util.parseBoolean(e)?"hidden"!==t.type&&(this.element.show(),this.element.css("display",""),t.required&&(this.hasValue()||this.changeRequiredLabel(!0))):this.element&&this.element.hide(),t.visible=e},changeEditability:function(e){var t=this,i=t.properties,r=t.getControl();i.editable="Default"==e?t.originalProperties.editable:bizagi.util.parseBoolean(e),i.editabilityEnabled=i.editabilityEnabled||i.editable,r.empty(),"function"==typeof t.internalRenderControl&&$.when(t.internalRenderControl()).done((function(e){"function"==typeof t.emptyControlByChangeEditability&&t.emptyControlByChangeEditability(),t.asyncRenderDeferred||r.append(e),t.postRenderElement(t.element)}))},changeEditabilityCellControl:function(e,t,i){var r=this.properties,a=this.grid.getColumn(i),n=a.getDecorated(t);r.editable="Default"===e?this.originalProperties.editable:bizagi.util.parseBoolean(e),r.editabilityEnabled=r.editabilityEnabled||r.editable,this.internalRenderCellControl(r.editable,t,a,n)},internalRenderCellControl:function(e,t,i,r){var a=this,n=a.getControl();n.empty(),"function"==typeof a.internalRenderControl&&$.when(a.internalRenderControl()).done((function(o){a.asyncRenderDeferred||n.append(o),a.postRenderElement(a.element),e&&(i.bind("rendered",(function(){i.readyDeferred.resolve()})),r.unbind("renderchange"),r.bind("renderchange",(function(e,r){i.changed=!0,a.grid.onCellChange(i,null,t,r)})))}))},changeRequired:function(e){var t=this.properties,i=t.displayName||"",r=$("label",this.getLabel()),a=this.getControl();t.required=e,"execution"==this.getMode()&&this.checkRequired([])?this.changeRequiredLabel(!1):1==bizagi.util.parseBoolean(e)&&t.editable?"rtl"==this.properties.orientation?a.prepend('<div class="ui-bizagi-render-control-required-rtl"></div>'):(a.addClass("control-required"),a.prepend('<div class="ui-bizagi-render-control-required"></div>')):"rtl"==this.properties.orientation?$(".ui-bizagi-render-control-required-rtl",a).remove():(a.removeClass("control-required"),$(".ui-bizagi-render-control-required",a).remove()),r.html(i),this.triggerRenderValidate()},changeRequiredLabel:function(e){var t=this.properties,i=t.displayName||"",r=$("label",this.getLabel()),a=this.getControl();1==bizagi.util.parseBoolean(e)&&t.editable?"rtl"==this.properties.orientation?a.prepend('<div class="ui-bizagi-render-control-required-rtl"></div>'):(a.addClass("control-required"),a.append('<div class="ui-bizagi-render-control-required"></div>')):"rtl"==this.properties.orientation?$(".ui-bizagi-render-control-required-rtl",a).remove():(a.removeClass("control-required"),$(".ui-bizagi-render-control-required",a).remove()),r.html(i),this.triggerRenderValidate()},refreshControl:function(e){var t=this,i=t.properties,r=(t.value,t.getFormContainer().properties.id||"");return e=e||{},t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||e.xpathContext,idForm:r})).pipe((function(e){t.grid&&bizagi.override.restoreAppearanceAfterRefresh&&t.saveGridChildrenVisualChanges(),t.control=t.controlFiller=t.label=null;var i=t.element;return t.initializeData(e.render),$.when(t.render()).pipe((function(e){var i=$(e);t.postRenderElement(i);return t.properties.originalValue=t.value,i})).pipe((function(e){i.replaceWith(e),t.grid||t.triggerRenderChange({changed:!1}),bizagi.override.restoreAppearanceAfterRefresh&&(t.grid?(t.restoreGridChildrenVisualChanges(),t.restoreGridAppearance()):t.restoreAppearance()),t.afterToRefresh()}))})).fail((function(e){e=t.processFailMessage(e)})).always((function(){t.endLoading()}))},refreshDesignControl:function(e){var t=this,i=t.properties;t.beforeToRefresh(),t.control=t.controlFiller=t.label=null,$.extend(e.render.properties,{xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext||"form",idPageCache:i.idPageCache});var r=t.element;return t.initializeData(e.render),$.when(t.render()).pipe((function(e){var i=$(e);t.postRenderElement(i);return t.properties.originalValue=t.value,i})).pipe((function(e){r.replaceWith(e),t.triggerRenderChange(),t.beforeToRefresh()}))},cleanData:function(){this.setValue(""),this.clearDisplayValue()},clearDisplayValue:function(){var e=this.getControl(),t=e.find("input");t.length>0?t.val(this.getValue()):!1===this.properties.editable&&$(e).html("<label class='readonly-control'></label>")},updateOriginalValue:function(){this.properties.originalValue=this.value},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();this.controlValueIsChanged()&&(bizagi.util.isEmpty(i)||(bizagi.util.isEmpty(r)?""!==r&&null!==r||(e[t.xpath]=""):e[t.xpath]=r)),this.validateInputRetype()||(e[t.xpath]="")},hasChanged:function(e){return!!this.controlValueIsChanged()&&(e.push(!0),!0)},configureHandlersQueryForm:function(){var e=this;e.element.find(".ui-bizagi-render-control-included").change((function(){e.properties.included=$(this).is(":checked")}))},getRenderId:function(){var e=this;return bizagi.util.tryCatch((function(){return e.properties.id}),null)},collectDataQueryForm:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=null;if(!bizagi.util.isEmpty(i)){if(null!=r)a=void 0!==r.id?bizagi.util.isEmpty(r.id)?null:[r]:""!==r?r:null;if(null!==a||t.included){var n=(this.properties.typeSearch||this.properties.rangeQuery||"NONE").toUpperCase(),o={value:a,included:this.properties.included,xpath:t.xpath,searchType:n,orderType:"NONE",renderId:this.getRenderId()};void 0!==t.displayXpath&&""!==t.displayXpath&&(o.displayXpath=t.displayXpath),e.push(o)}}},canBeSent:function(){var e,t=this.properties,i=bizagi.util.parseBoolean(t.displayOnly)||!1,r=bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editabilityEnabled);if(t.isClone)return!1;if(!i&&r)return!0;if(t.xpath&&1==this.getFormContainer().getRenders(t.xpath).length){if(e=!!$.forceCollectData&&$.forceCollectData.toString(),$.forceCollectData=e?void 0:$.forceCollectData,this.controlValueIsChanged())return $.forceCollectData=e?bizagi.util.parseBoolean(e):$.forceCollectData,!0;$.forceCollectData=e?bizagi.util.parseBoolean(e):$.forceCollectData}return!1},canBeSentQueryForm:function(){return!this.properties.isClone},focus:function(e){var t=this;if(t.properties.visible){this._super();var i=$("#ui-bizagi-wp-app-render-form-content"),r=function(){var e=t.getControl(),r="grid"!=t.properties.type?$("input, select, option, textarea",e):$("input, select, option, textarea",e).first();r.length>0&&$.each(r,(function(e){var t=r[e];if("hidden"!=$(t).attr("type")&&"none"!=$(t).css("display")&&"hidden"!=$(t).css("visibility"))try{bizagi.util.isIE()||bizagi.util.autoScrollBottom(i),t.focus()}catch(e){}}))};$.when(t.ready()).done((function(){if(e>0)var t=setTimeout((function(){r(),clearTimeout(t)}),e);else r()}))}},getDefaultLabelAlign:function(e){return"default"},getDefaultValueAlign:function(e){return"default"},getRTLAlign:function(e){return e},configureSubmitOnChange:function(){var e=this,t=e.properties,i="",r=t.id;if(t.editable){t.dependencies=t.dependencies||"all";var a={conditions:{expressions:[{simple:{xpath:i=t.xpath?t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.xpath:t.xpath:t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.id:t.id,renderId:t.id,operator:"changes",argumentType:"const"}}]},commands:[{xpath:i,command:"submit-value",argument:t.dependencies}],dependencies:[i],elseCommands:[]};t.submitOnChangexpathContext&&e.grid&&(a.conditions.expressions[0].simple.containerId=e.grid.properties.id),$.when(e.ready()).done((function(){e.getFormContainer().addSubmitAction(i+"."+r,a)}))}},submitOnChange:function(e,t,i){var r=this,a=$.Deferred();return""!=r.properties.contexttype&&e&&(e[r.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=r.properties.contexttype),$.when(r.isReadyToSave()).done((function(){r.internalSubmitOnChange(e,t,i).done((function(){a.resolve()})).fail((function(){a.reject()}))})),a.promise()},getCacheIdCase:function(){var e=this.getParams().idCase;return void 0===bizagi.cache?(bizagi.cache={},bizagi.cache.idCaseObject={idCase:void 0!==e?e:void 0!==bizagi.cache.idCase?bizagi.cache.idCase:void 0}):void 0!==e&&void 0!==bizagi.cache.idCaseObject?bizagi.cache.idCaseObject.idCase=e:void 0!==e&&void 0===bizagi.cache.idCaseObject&&(bizagi.cache.idCaseObject={},bizagi.cache.idCaseObject.idCase=e),e=void 0===e?void 0===bizagi.cache.idCaseObject?void 0:bizagi.cache.idCaseObject.idCase:e},internalSubmitOnChange:function(e,t,i){var r=this.getFormContainer(),a=this.properties,n={data:e,bRefreshForm:t,notCollect:i,properties:{idCase:this.getCacheIdCase(),id:a.id,xpath:a.xpath,idPageCache:a.idPageCache,contexttype:a.contexttype}};return r.internalSubmitOnChange(n)},ready:function(){return $.when(this.parent.ready(),this.isRendered())},getCustomHandlers:function(){var e=this.getFormContainer();return e?e.getCustomHandlers():null},getCustomHandler:function(e){var t=this.getCustomHandlers();return t?t[e]:null},calculateRenderWidth:function(e,t,i){if(e="100"==t&&void 0===e?"0":e?"0"!=e?e:"50":"50%",t=t?"0"!=t?t:"50":"50%","normal"==i||"both"==i||"reversed"==i){if(e&&bizagi.util.percent2Number(e)<5&&t&&bizagi.util.percent2Number(t)<5)return{label:0,control:100};e&&!t?t=100-(e=bizagi.util.percent2Number(e)):!e&&t?e=100-(t=bizagi.util.percent2Number(t)):(e=bizagi.util.percent2Number(e))+(t=bizagi.util.percent2Number(t))!=100&&void 0!==this.properties&&"pixels"!=this.properties.layoutType&&(t=100-e)}else e=100,t=100;return{label:e,control:t}},getIdCase:function(){return this.getFormContainer().params.idCase||bizagi.context.idCase},getIdWorkitem:function(){return this.getFormContainer().params.idWorkitem||bizagi.context.idWorkitem},getidTask:function(){return this.getFormContainer().params.idTask||bizagi.context.idTask},getSessionId:function(){return this.getFormContainer().properties.sessionId},changeCellColor:function(e){var t=this.getControl();t&&("none"!=e?(t.css("color",e),t.find("input, textarea, label").each((function(t,i){$(i).css("color",e)}))):(t.css("color",""),t.find("input, textarea, label").each((function(e,t){$(t).css("color","")}))))},changeCellBackgroundColor:function(e){var t=this.getControl(),i="",r="";if(t)if("none"!=e&&(i=e,r="none"),this.properties.editable){var a=!1;t.find("input, textarea, .ui-selectmenu").each((function(e,t){"text"!=t.type&&"textarea"!=t.type||$(t).hasClass("ui-select-data")||(a=!0),$(t).css({"background-color":i,"background-image":r})})),a||t.closest("td").each((function(e,t){$(t).css({"background-color":i,"background-image":r})}))}else t.each((function(e,a){($(a).hasClass("ui-bizagi-cell-readonly")?t.closest("td"):$(a)).css({"background-color":i,"background-image":r})}))},changeCellVisibility:function(e){var t=this.properties,i=this.getControl();i&&(1==bizagi.util.parseBoolean(e)?(i.css("visibility","visible"),i.css("display",""),this.element&&this.element.show()):i.css("visibility","hidden")),t.visible=e},changeCellRequired:function(e){var t=this.properties,i=this.getControl();i&&(1==bizagi.util.parseBoolean(e)&&bizagi.util.isEmpty(this.value)?(i.addClass("control-required"),i.append('<div class="ui-bizagi-render-control-required"></div>')):(i.removeClass("control-required"),$(".ui-bizagi-render-control-required",i).remove()),t.required=e)},startActionExecution:function(){this.startLoading(),this.actionExecutionDeferred=new $.Deferred},endActionExecution:function(){this.endLoading(),this.actionExecutionDeferred&&this.actionExecutionDeferred.resolve(),delete this.actionExecutionDeferred},readyActionExecution:function(){return this.actionExecutionDeferred?this.actionExecutionDeferred.promise():$.when(!0)},isFromCreatedRow:function(){if(this.grid)for(var e=this.grid.columns.length;e-- >0;)if(this.grid.columns[e].properties.xpath==this.properties.xpath&&1==this.grid.columns[e].isNewRow)return!0;return!1},submitInvalidatePageCacheRequest:function(e){var t=this.properties,i=e?e.idPageCache:t.idPageCache;this.dataService.invalidatePageCache({idPageCache:i})},isDesignMode:function(){return"design"===this.getMode()},isExecutionMode:function(){return"execution"===this.getMode()},preventDefaultForAnchorTag:function(){(bizagi.util.isSharepointContext()||bizagi.util.isWebpartContext())&&$("a[href='#']",this.getControl()).click((function(e){e.preventDefault()}))},getMainForm:function(e){var t=e.params.fromRender;if(void 0===t)return e;this.getMainForm(t.getFormContainer())},setInterceptionObserver:function(e,t){var i=this,r=new IntersectionObserver((function(){i.pluginInitialized||0===e.width()||("function"==typeof t&&t(),r.disconnect())}));r.POLL_INTERVAL=100,r.observe(e.get(0))},setResizeObserver:function(e,t){var i=this,r=new ResizeObserver((function(){i.pluginInitialized||0===e.width()||("function"==typeof t&&t(),r.disconnect())}));r.observe(e.get(0))},restoreGridAppearance:function(){var e=this.getIndexes();this.restoreAppearance(),this.columns.length>0&&$.each(this.columns,(function(t,i){for(var r=0;r<e.length;r++)i.decorateRenders[e[r]].restoreCellAppearance()}))},saveGridChildrenVisualChanges:function(){var e=this,t=e.getIndexes();e.gridChildrenVisualChanges=[],e.columns.length>0&&$.each(e.columns,(function(i,r){if(r.properties.xpath)for(var a=0;a<t.length;a++){var n=r.decorateRenders[t[a]];n&&n.properties&&(e.gridChildrenVisualChanges[n.properties.id+t[a]]=n.visualChanges)}}))},restoreGridChildrenVisualChanges:function(){var e=this,t=e.getIndexes();e.columns.length>0&&$.each(e.columns,(function(i,r){if(r.properties.xpath)for(var a=0;a<t.length;a++){var n=r.decorateRenders[t[a]];n&&n.properties&&(n.visualChanges=e.gridChildrenVisualChanges[n.properties.id+t[a]]||{})}})),delete e.gridChildrenVisualChanges},restoreCellAppearance:function(){for(var e in this.visualChanges)switch(e){case"color":this.changeCellColor(this.visualChanges[e]);break;case"backgroundColor":this.changeCellBackgroundColor(this.visualChanges[e]);break;case"required":this.changeCellRequired(this.visualChanges[e]);break;case"editability":this.changeEditabilityCellControl(this.visualChanges[e],this.surrogateKey,this.properties.xpath);break;case"visibility":this.changeCellVisibility(this.visualChanges[e]);break;case"minValue":this.changeMinValue(this.visualChanges[e]);break;case"maxValue":this.changeMaxValue(this.visualChanges[e])}},formatValue:function(e){return e}}),$.Class.extend("bizagi.rendering.render.base",{},{processLayout:function(e,t){var i=this.properties;if("boolean"==typeof e)if(e)this.processLabelLayout(t);else{this.processControlLayout(t),i.required=void 0!==i.required&&bizagi.util.parseBoolean(i.required);var r=void 0===i.visible||bizagi.util.parseBoolean(i.visible);i.required&&this.changeRequired(i.required),r||this.changeVisibility(r)}else console.warm("error calling processLayout, 'isLabelFormat' is not boolean")},processLabelLayout:function(e){var t=this.getLabel();null!=t&&(void 0===(e=e||{}).bold&&(e.bold=!0),this.changeBackgroundColor(e.background).changeFontColor(t,e.color).changeFontBold(t,e.bold).changeFontSize(t,e.size).changeFontItalic(t,e.italic).changeTextDecoration(t,(e.underline?"underline":"")+(e.strikethru?" line-through":"")))},processControlLayout:function(e){var t=this.getControl(),i=this.getElementsToStylize(t);e=e||{},this.changeFontColor(i,e.color).changeFontBold(i,e.bold).changeFontItalic(i,e.italic).changeFontSize(i,e.size).changeTextDecoration(i,(e.underline?"underline":"")+(e.strikethru?" line-through":""))},changeColor:function(e){var t=this.getLabel(),i=this.getControl(),r=this.getElementsToStylize(i);return this.changeFontColor(t,e).changeFontColor(r,e)},changeFontColor:function(e,t){if(void 0===e)return this;if(void 0===t)return this;var i="none"!==t?t:"";return e.css("color",i),this},changeFontSize:function(e,t){if(void 0===t)return this;if(void 0===e)return this;if("0"!==t){var i=100+10*Number(t)+"%";e.css("font-size",i)}return this},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)},changeFontItalic:function(e,t){var i=bizagi.util.parseBoolean(t)?"italic":"normal";return e.css("font-style",i),this},changeFontBold:function(e,t){var i=bizagi.util.parseBoolean(t)?"bold":"normal";return e.css("font-weight",i),this},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.element.css("background-color",e):this.element.css("background-color",""),this)},changeCellBackgroundColor:function(e){return this.getCellBackgroundFunction(this.properties.editable.toString(),this.properties.type)(e)},getCellBackgroundFunction:function(e,t){var i={true:{columnDate:this.changeInputBackgroundColor.bind(this)},false:{default:this.changeBackgroundColor.bind(this)},default:this.changeBackgroundColor.bind(this)};return i[e][t]||i.default},changeInputBackgroundColor:function(e){return void 0===e?this:("none"!==e?$(".bz-input-icon",this.element).css("background-color",e):$(".bz-input-icon",this.element).css("background-color",""),this)},changeRequiredLabel:function(){},changeCellRequired:function(e){this.changeRequired(e)},getRTLAlign:function(e){return void 0===e||""==e?"default":e},getDefaultLabelAlign:function(){return"default"},getDefaultValueAlign:function(){return"default"}}),bizagi.rendering.render.extend("bizagi.rendering.desktop.render",{},{postRender:function(){var e=this.properties;this._super(),"double"==e.retype&&this.processClassicRetype(),e.hint&&this.processRenderHint(),e.helpText&&e.helpText.length>0&&this.showIcon("help")},postRenderReadOnly:function(){var e=this.properties;e.helpText&&e.helpText.length>0&&this.showIcon("help")},processLayout:function(e,t){this._super(e,t)},startLoading:function(){var e=this.element;e&&e.startLoading({delay:250,overlay:!0})},endLoading:function(){var e=this.element;e&&e.endLoading()},getLabel:function(){return this.label||(this.label=$(".ui-bizagi-label",this.element||this.observableElement)),this.label},getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=$(".ui-bizagi-render-control",this.element||this.observableElement)),this.control&&0!=this.control.length?this.control:null},getControlFiller:function(){return this.controlFiller||(this.controlFiller=$(".ui-bizagi-control",this.element||this.observableElement)),this.controlFiller},setValidationMessage:function(e){var t=this;t._super(e),bizagi.util.isIE8()||$.when(t.ready()).done((function(){var i=t.element,r=$(".ui-bizagi-render-icon-error",i),a=$(".ui-bizagi-render-icon-help",i);e&&e.length>0?(t.showIcon("error"),bizagi.util.isIE9()?r.attr("data-title",e):r.attr("title",e),r.tooltip(),$(r).parent().removeClass("ui-hidden"),t.isNewRenderForm&&$(r).parent().removeClass("bz-forms-icons__hidden")):(t.hideIcon("error"),""==$(a).text()&&($(r).parent().addClass("ui-hidden"),t.isNewRenderForm&&$(r).parent().addClass("bz-forms-icons__hidden")))}))},processClassicRetype:function(){},processRenderHint:function(){var e=this.element,t=this.properties,i=$("input[type!=hidden], select",e);if(i){var r=i.parent();if(r){r.prepend('<label class="ui-bizagi-render-hint">'+t.hint+"</label>");var a=$(".ui-bizagi-render-hint",e);i.focus((function(){a.addClass("focus")})),i.keypress((function(){a.addClass("has-text").removeClass("focus")})),i.blur((function(){""==$(this).val()&&a.removeClass("has-text").removeClass("focus")})),a.click((function(){i.focus()}))}}},focus:function(e){for(var t=this;t;){var i=t.properties||{},r=t.params||{};if("section"===i.type){t.openAutomatically();break}if("form"===i.type||"form"===r.type){var a=t.getElement()[0],n=a?a.querySelector(".ui-bizagi-container-form-wrapper-animation"):null;if(null!=n&&""!==n.style.transform){n.style.transform="",$(".ui-bizagi-main-section",n)[0].classList.remove("ui-bizagi-section-animation-fade-out");var o=this.getFormContainer()||{},s=o.rendersByType?o.rendersByType.section:[];s.length>0&&s[0].closeAllSections()}}t=t.parent}this._super(e)},getDisplayOptionClass:function(e){return"normal"==e||"both"==e?"ui-bizagi-render-display-normal":"vertical"==e?"ui-bizagi-render-display-vertical":"reversed"==e?"ui-bizagi-render-display-reversed":"verticalReversed"==e?"ui-bizagi-render-display-vertical-reversed":"label"==e?"ui-bizagi-render-display-label":"value"==e?"ui-bizagi-render-display-value":""},changeDisplayOption:function(e){var t=this.element;this._super(e),t.removeClass("ui-bizagi-render-display-normal ui-bizagi-render-display-vertical ui-bizagi-render-display-reversed").removeClass("ui-bizagi-render-display-vertical-reversed ui-bizagi-render-display-label ui-bizagi-render-display-value"),t.addClass(this.getDisplayOptionClass(e))},getAlignClass:function(e){return"left"==e?"ui-bizagi-render-align-left":"center"==e?"ui-bizagi-render-align-center":"right"==e?"ui-bizagi-render-align-right":"justify"==e?"ui-bizagi-render-align-justify":""},changeLabelAlign:function(e){var t=this.getLabel();t.removeClass("ui-bizagi-render-align-left ui-bizagi-render-align-center ui-bizagi-render-align-right"),t.addClass(this.getAlignClass(e)),this._super(e)},changeValueAlign:function(e){var t=this.getControlFiller();t.removeClass("ui-bizagi-render-align-left ui-bizagi-render-align-center ui-bizagi-render-align-right"),t.addClass(this.getAlignClass(e)),this._super(e)},getContainerIcons:function(){return $(".ui-bizagi-render-icons",this.element)},showIcon:function(e){var t,i=this.getContainerIcons(),r=$(".ui-bizagi-render-icon-error",i),a=$(".ui-bizagi-render-icon-help",i);i.removeClass("ui-hidden"),this.isNewRenderForm&&i.removeClass("bz-forms-icons__hidden"),"error"==e&&(t=r.css("display","inline-block")),"help"==e&&(t=a.css("display","inline-block")),a.is(":visible")&&r.is(":visible")?i.css({width:"48px","min-width":"48px"}):(a.is(":visible")||r.is(":visible"))&&i.css({width:"24px","min-width":"24px"}),this.getControlFiller().addClass("ui-bizagi-state-show-icons"),t.mouseover((function(e){e.preventDefault(),e.stopPropagation(),void 0===t.data("tooltip")&&(t.tooltip({tooltipClass:"ui-widget-content ui-help-tooltip",items:t.attr("title")?".ui-icon[title]":".ui-icon[data-title]",content:function(){var e=/<\s*script[^>]*>[\s\S]*?(<\s*\/script[^>]*>|$)/gi,t=$(this);t.hasClass("ui-bizagi-render-icon-error");if(t[0]&&t[0].attributes["data-title"]){var i=t[0].attributes["data-title"].value;return e.test(i)?bizagi.util.sanitizeHTML(i):i}if(t[0]&&t[0].title){var r=t[0].title;return t[0].title="",e.test(r)?bizagi.util.sanitizeHTML(r):r}}}),t.tooltip("open"),$(".ui-help-tooltip").css("z-index",$.ui.dialog.prototype._getMaxZindex()))}))},hideIcon:function(e){var t=$(".ui-bizagi-render-icons",this.element),i=$(".ui-bizagi-render-icon-error",this.element);$(".ui-bizagi-render-icon-help",this.element).is(":visible")&&i.is(":visible")&&t.css({width:"24px","min-width":"24px"}),"error"==e&&$(".ui-bizagi-render-icon-error",this.element).css("display","none"),"help"==e&&$(".ui-bizagi-render-icon-help",this.element).css("display","none");var r=$(".ui-bizagi-render-icons span",this.element);r.length>0&&"none"!=r[0].style.display&&this.getControlFiller().removeClass("ui-bizagi-state-show-icons")},performDesignModeMethods:function(){var e=this.getControl();null!==e&&$("input, select, button, textarea",e).attr("readonly",!0),this._super()}}),$.Class.extend("bizagi.rendering.combo",{},{initializeData:function(e){this._super(e);var t=this.properties;t.hasLocalData=t.data||!1,t.value=t.value&&t.value.length>0?t.value[0]:t.defaultValue&&t.defaultValue.length>0?t.defaultValue[0]:null,void 0===t.enableTyping&&(t.enableTyping=!0),t.value&&void 0===t.value.id&&(t.value=null),this.value=t.value,t.hasLocalData&&(t.data=this.complementData(t.data)),t.loadOnDemand=!1},renderControl:function(){var e={},t=bizagi.util.normalizeType(this.properties.type);if(this.isDependant&&this.properties&&/^cascadingcombo$/i.test(t)&&this.getParentCombo){var i=this.getParentCombo().getValue();i&&i.id&&(e[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=i.id)}return this.renderCombo(e)},renderCombo:function(e){var t=this;if(t.properties.loadOnDemand)return t.renderComboTemplate();var i=new $.Deferred,r=t.getData(e);return $.when(r).done((function(e){var r=t.renderComboTemplate(e);t.properties.data=e,i.resolve(r)})).fail((function(e){var r=t.renderComboTemplate({});i.resolve(r)})),i.promise()},renderComboTemplate:function(e){var t=this.properties,i=this.renderFactory.getTemplate(this.getTemplateName()),r=bizagi.override.emptyLabelForCombo||this.getResource("render-combo-empty-selection"),a=t.value?"":r;return e=e||this.properties.data||{},"columnCombo"!==this.properties.type||""!==a||"object"!==_typeof(t.value)||""!==t.value.id||""!==t.value.value&&t.value.value!==this.getResource("render-combo-empty-value")||(a=this.getResource("render-combo-empty-selection")),$.fasttmpl(i,$.extend(this.getTemplateParams(),{id:t.id,xpath:t.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:t.idPageCache,items:e,align:t.valueAlign,value:a,editable:t.editable}))},postRenderReadOnly:function(){this._super();var e=this.getValue(),t=this.getControl();this.control&&this.control.parent()&&this.control.parent().addClass("ui-bizagi-noneditable-"+this.properties.displayType),e?(null!=e.value&&"boolean"==typeof e.value&&(!0===bizagi.util.parseBoolean(e.value)?e.value=this.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(e.value)&&(e.value=this.getResource("render-boolean-no"))),this.getResource("render-combo-empty-value")===e.value||this.getResource("render-combo-empty-selection")===e.value?t.text(""):t.html("<label class='readonly-control'>"+this.formatItem(e.value)+"</label>")):t.text("")},getTemplateName:function(){return"combo"},showEmpty:function(){return!0},showCurrentData:function(){return!0},getData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.getMode(),n=bizagi.util.isOfflineForm({context:t});if("execution"!==a)return t.getDummyData();if(i.hasLocalData||n)r.resolve(i.data);else{var o=bizagi.util.normalizeType(i.type);i.remoteDataLoaded&&!/^cascadingcombo$/i.test(o)?r.resolve(i.data):t.dataService.multiaction().getData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,extra:e,contexttype:t.properties.contexttype||null}).done((function(e){i.recalculate||(i.remoteDataLoaded=!0),i.data=t.complementData(e),r.resolve(i.data)})).fail((function(e){var i=!0,a=t.getFormContainer();if(bizagi.util.isNativeMobileDevice()&&void 0!==a&&(i=a.allowOnlineActions()),"not-processed"!==e.type||!i){var n=t.properties.displayName+": ";if("string"==typeof e)var o=JSON&&JSON.parse(e)||$.parseJSON(e);else o=e;n+=o.message,a.addValidationMessage(n),r.reject(e)}}))}return r.promise()},getDummyData:function(){var e=this.properties;return e.data?e.data:(e.data=[],e.data=this.complementData(e.data),e.data.push({id:"",value:"Item 1"}),e.data.push({id:"",value:"Item 2"}),e.data)},resetData:function(){var e=this.properties;e.hasLocalData=!1,e.data=null,e.remoteDataLoaded=!1},getDisplayValue:function(){if(this.combo&&this.combo.length>0)return this.getSelectedValue();var e="",t=this.getValue();return t&&(e=this.formatItem(t.value)),e},getSelectedValue:function(){},getTemplateParams:function(){return{}},formatItem:function(e){if(null!=e){if($.isArray(e)){for(var t=0,i=e.length;t<i;t++)null!=e[t]&&"boolean"==typeof e[t]&&(!0===bizagi.util.parseBoolean(e[t])?e[t]=this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e[t])&&(e[t]=this.getResource("render-boolean-no")));return e.join(" - ")}return e}return""},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();this.controlValueIsChanged()&&(bizagi.util.isEmpty(i)||null==r||("object"!==_typeof(r)||void 0!==r.id&&""!==r.id?e[t.xpath]=void 0!==r.id?r.id:"":e[t.xpath]=""))},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue,a=!0;return $.forceCollectData?a:(t=t&&void 0!==t.length?t[0]:t,i=i&&void 0!==i.length?i[0]:i,r=r&&void 0!==r.length?r[0]:r,t=t&&void 0!==t.id?t.id:t,i=i&&void 0!==i.id?i.id:i,a=void 0!==(r=r&&void 0!==r.id?r.id:r)?r!=i||r!=t:t!=i)},parseAdditionalValues:function(e){var t=this;return $.map(e,(function(e){var i=e.value?t.formatItem(e.value):e,r={id:e.id,value:i};return e.hidden&&(r.hidden=!0),e}))},complementData:function(e){var t=this,i=t.properties,r=!1;if($.each(e,(function(e,a){void 0!==a.value&&null!==a.value?(a.value=t.formatItem(a.value),i.value&&a.id==i.value.id&&(r=!0)):a.value=""})),t.showEmpty()){for(var a=!1,n=0,o=e.length;n<o;n++)if(""===e[n].id){a=!0;break}if(!a){var s=bizagi.override.emptyLabelForCombo||bizagi.localization.getResource("render-combo-empty-value");e.unshift({id:"",value:s})}}return i.value&&!r&&t.showCurrentData()&&e.unshift({id:i.value.id,value:i.value.value,hidden:!0}),t.parseAdditionalValues(e)},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmpty(e)&&("[object Object]"!==Object.prototype.toString.apply(e)||!bizagi.util.isEmpty(e.id)&&0!=e.id)},cleanData:function(){var e={id:"",label:""};this.setDisplayValue(e),this.setValue(e,!1)},beforeToRefresh:function(){this.column&&!this.column.comboData&&this.getData()},isExtraItem:function(){var e=(this.value||{}).value||"";return""===e||e===this.getResource("render-combo-empty-selection")||e===this.getResource("render-combo-empty-value")},escapeValue:function(e){return bizagi.util.isString(e)?e.replaceAll("<","&lt;").replaceAll(">","&gt;"):e},mapValue:function(e){return e&&e.fromAction?{id:e.value,value:e.label,label:e.label}:e},preprocessValue:function(e){var t=this;if(null==e)return e;var i={id:"",value:void 0};if(e.fromAction&&(e={id:e.value,value:e.label}),"number"==typeof e||"string"==typeof e){i.id="string"==typeof e?Number(e):e;var r=t.findDataValueById(i.id);i.value=r?r.value:""}else if("object"===_typeof(e)){if(void 0!==e.id&&null!==e.id&&("string"==typeof e.id&&""!==e.id?(i.id=Number(e.id),isNaN(i.id)&&(i.id=e.id)):i.id=e.id,""!==i.id&&(void 0===e.value||null===e.value||""===e.value))){r=t.findDataValueById(i.id);i.value=r?r.value:e.value}void 0!==e.value&&null!==e.value&&""!==e.value&&("boolean"==typeof e.value?i.value=e.value?t.getResource("render-boolean-yes"):t.getResource("render-boolean-no"):Array.isArray(e.value)?i.value=e.value.map((function(e){return"boolean"==typeof e?e?t.getResource("render-boolean-yes"):t.getResource("render-boolean-no"):e})).join(" - "):i.value=e.value)}return i},validateValue:function(e){if(null!=e.id&&("number"==typeof e.id&&null!==e.id||"string"==typeof e.id&&e.id.length>0))if(null!==e.value&&"boolean"==typeof e.value)translated=!0,!0===bizagi.util.parseBoolean(e.value)?e.value=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value)&&(e.value=bizagi.localization.getResource("render-boolean-no"));else if(null!=e.value&&"object"===_typeof(e.value))for(var t=0,i=e.value.length;t<i;t++)null!=e.value[t]&&"boolean"==typeof e.value[t]&&(!0===bizagi.util.parseBoolean(e.value[t])?e.value[t]=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value[t])&&(e.value[t]=bizagi.localization.getResource("render-boolean-no")));return e},findDataValueById:function(e){return(this.properties.data||[]).find((function(t){return t.id==e}))}}),$.Class.extend("bizagi.rendering.collectionnavigator",{},{initializeData:function(e){this._super(e);var t=this.properties;t.allowAdd=void 0===t.allowAdd||bizagi.util.parseBoolean(t.allowAdd),t.withAddForm=t.withAddForm&&t.allowAdd,t.allowEdit=void 0===t.allowEdit||bizagi.util.parseBoolean(t.allowEdit),t.withEditForm=t.withEditForm&&t.allowEdit,t.allowDetail=void 0!==t.allowDetail&&bizagi.util.parseBoolean(t.allowDetail),t.inlineAdd=void 0===t.inlineAdd||bizagi.util.parseBoolean(t.inlineAdd),t.inlineAdd=t.inlineAdd&&t.allowAdd,t.inlineEdit=void 0===t.inlineEdit||bizagi.util.parseBoolean(t.inlineEdit),t.inlineEdit=t.inlineEdit&&t.allowEdit,t.allowDelete=void 0===t.allowDelete||bizagi.util.parseBoolean(t.allowDelete),this.orientation=this.properties.orientation||"ltr",this.data=this.properties.data,this.keys=this.data?this.getKeys(this.data.rows):[],this.pointer=0,this.totalRows=0,this.inlineAddRecords=[],this.data&&(this.totalRows=this.data.rows.length)},getKeys:function(e){for(var t=[],i=0,r=(e=e||[]).length;i<r;i++){var a=e[i];t.push(a[0])}return t},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("collectionnavigator"),i=this.getMode(),r=$.fasttmpl(t,{uniqueId:e.uniqueId,displayName:e.displayName?e.displayName:"",id:e.id,guid:e.guid,showPreview:this.showPreview(),mode:i,orientation:this.getFormContainer().properties.orientation});return r=this.drawControls(r)},renderReadOnly:function(){return this.renderControl()},drawControls:function(e){},drawActions:function(e){},drawControl:function(e){},drawForms:function(e){},drawPreview:function(){var e="execution"===this.getMode()?"collectionnavigator-execution":"collectionnavigator-preview",t=this.renderFactory.getTemplate(e),i=$.tmpl(t);this.canvas.append(i)},hasData:function(){return this.getTotalRows()>0},getRow:function(){return this.keys[this.pointer]},getNextRow:function(){return this.getTotalRows()>this.pointer+1&&(this.pointer+=1),this.getRow()},getPreviousRow:function(){return this.pointer>0&&(this.pointer-=1),this.getRow()},getFirstRow:function(){return this.pointer=0,this.getRow()},getLastRow:function(){return this.pointer=this.keys.length-1,this.getRow()},getTotalRows:function(){return this.keys.length},getIndexes:function(){return this.properties.data.rows},setPointer:function(e){this.pointer=e-1},isTherePendingInlineRow:function(){return this.inlineAddRecords.length>0},addKey:function(e){this.keys.push(e)},removeKey:function(){var e=this.pointer;if(e>=0){this.keys.splice(e,1);var t=this.getTotalRows();t>0&&e>=t&&this.setPointer(t)}},showPreview:function(){var e=this.getMode(),t=this.properties;return"execution"==e?!this.hasData():!bizagi.util.parseBoolean(t.navigationform)},getParameters:function(e){var t={},i=this.properties,r=i.xpath+"[id="+e.id+"]";return t.idRender=i.id,t.recordXPath=r,t.xpathContext=i.xpathContext,t.idPageCache=i.idPageCache,t.requestedForm=e.requestedForm,t.contextType=i.contextType||i.contexttype,t.url=e.url,t.editable=e.editable,i.orientation,t},submitAddRequest:function(){var e=this,t=e.properties;return e.dataService.addGridRecord({url:t.addUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,contexttype:t.contextType||t.contexttype,idPageCache:t.idPageCache,orientation:t.orientation||"ltr"}).pipe((function(t){return e.properties.temporalRecord=!0,t.idEntity})).promise()},submitEditRequest:function(e){var t=this.properties,i=t.xpath+"[id="+e+"]";return this.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType||t.contexttype||"",orientation:t.orientation||"ltr"})},submitDeleteRequest:function(e){var t=this,i=t.properties,r=i.xpath+"[id="+e+"]";return t.dataService.deleteGridRecord({url:i.deleteUrl,idRender:i.id,xpath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType||i.contexttype}).pipe((function(e){if("validationMessages"==e.type){var i=t.getFormContainer(),r=e.messages.join(" ");i.failHandler({message:r})}return e}))},submitSaveRequest:function(e,t){var i=this,r=i.properties,a=$.Deferred(),n=r.xpathContext.length>0?r.xpathContext+"."+r.xpath+"[id="+e+"]":r.xpath+"[id="+e+"]",o=null;return t.deferreds&&(o=$.when.apply($,t.deferreds),delete t.deferreds),$.when(o).then((function(){!bizagi.util.isEmpty(t)||i.properties.temporalRecord?(t.idPageCache=t.idPageCache||i.form.getPageCache(),i.dataService.saveGridRecord({url:r.saveUrl,idRender:r.id,xpath:r.xpath,xpathContext:n,contexttype:r.contextType||r.contexttype||"",submitData:t}).done((function(e){delete i.properties.temporalRecord,a.resolve(e)})).fail((function(e){var t=i.getFormContainer(),r=e.responseText?e.responseText:"string"==typeof e?e:e.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=e);t.validateForm(),t.clearValidationMessages(),t.addValidationMessage(r)}))):a.resolve()})),a.promise()},submitRollbackRequest:function(e){var t=this.properties;return this.dataService.rollbackGridAction({url:t.rollbackUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:e.idPageCache,contexttype:this.properties.contexttype||""})},getRemoteData:function(e){var t=this.properties;return e=e||{},$.extend(e,{url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,contexttype:t.contextType||t.contexttype,idPageCache:t.idPageCache}),this.dataService.getData(e)},isValid:function(e){var t=this.form;return void 0!==t&&this.totalRows>0&&(t.children||[]).forEach((function(t){if(t.properties.visible)if(t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER)t.isValid(e);else if(t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&!t.isValid(e)){var i=e[e.length-1];e[e.length-1]=$.extend(i,{id:t.properties.id})}})),0===e.length},validateControls:function(e){return!!this.form&&this.form.validationController.performValidations(e)}}),$.Class.extend("bizagi.rendering.check",{},{initializeData:function(e){this._super(e);var t=this.properties;t.value=void 0!==t.value?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var e=this.renderFactory.getTemplate("check"),t=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(e,{id:t,editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()},postRender:function(){this._super()},getDisplayValue:function(){var e=this.getValue();return!0===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-no"):""},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmpty(e)&&!(!1===bizagi.util.parseBoolean(e)&&this.properties.required)}}),$.Class.extend("bizagi.rendering.number",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.setGroupDigits(),t.colorize=t.colorizeOnNegative||!1,t.dataTypeMinValue=this.calculateMinValue(t.dataType),t.dataTypeMaxValue=this.calculateMaxValue(t.dataType)},renderControl:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{id:this.properties.id,editable:this.properties.editable,value:bizagi.isMobile()?this.getDisplayValue():"",type:bizagi.util.isAndroidDevice()?"tel":"text",isDesign:"execution"!==this.getMode()})},postRender:function(){this._super();var e=this.getControl(),t=this.properties;this.numericInput=e.find("input"),this.numericInput.numeric(this.properties.decimalSymbol),"double"===t.retype&&this.attachRetypeDouble()},configureHandlers:function(){this.attachFormatCurrency()},removeValidations:function(){(this.getFormContainer().parent||this.getFormContainer()).clearValidationMessages()},attachRetypeDouble:function(){},formatNumericInput:function(e){var t=this.properties,i=bizagi.localization.getResource("render-number-retype-fail"),r=this.getFormContainer();if(void 0===r.validationController){var a=r.getValidationsContainer();r.validationController=new bizagi.command.controllers.validation(r,this.validations,a)}var n=r.validationController||r.parent.validationController,o=".",s=",";"undefined"==typeof BIZAGI_DEFAULT_CURRENCY_INFO?(o=this.getResource("numericFormat").decimalSymbol||".",s=this.getResource("numericFormat").digitGroupSymbol||","):(o=BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,s=BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator);var l=this.getMinValue(),d=this.getMaxValue();t.percentage&&this.numericInput.val(this.numericInput.val().replace("%",""));var u=this.numericInput.val();u=(u=","==o?u.replace(/\,0+$/,""):u.replace(/\.0+$/,"")).replace(t.symbol,""),-1!=(u=bizagi.util.replaceAll(u,s,"")).toString().indexOf(o)&&(","==o&&(u=u.replace(/([0-9]+(\,[0-9]+[1-9])?)(\,?0+$)/,"$1")),"."==o&&(u=u.replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1"))),null!=u&&u.length>0&&this.numericInput.val(u),/(.+)-$/.test(u)&&(u=u.replace(/(.+)-$/,"-$1"),this.numericInput.val(u));var c=u.replace(/[^0-9]+/g,"").length,p=this.properties.xpath,h=this.numericInput.val();if(null!=this.isInvalidFormat&&1==this.isInvalidFormat||""!=u&&-1!=["$","£","€","¥",t.symbol].indexOf(u))return this.setValue(""),this.getControl().find("input").val(""),void this.numericInput.val("");if(""!=bizagi.util.trim(u)){var g=parseFloat(u.replace(",","."));if(isNaN(g)&&(g=this.numericInput.asNumber()),i=void 0!==l&&null!=l&&g<l?bizagi.localization.getResource("render-numeric-minimum-validation").replaceAll("#label#",t.displayName+" ("+h+")").replaceAll("#minValue#",l.toString()):null!=d&&g>d?bizagi.localization.getResource("render-numeric-maximum-validation").replaceAll("#label#",t.displayName+" ("+h+")").replaceAll("#maxValue#",d.toString()):i+" "+h,null!=l&&g<l||null!=d&&g>d||10==this.properties.dataType&&c>15||1==this.properties.dataType&&c>19||11==this.properties.dataType&&c>7||11==this.properties.dataType&&c>7||h.match(/[^$£€¥,-.()\d]/)){if(void 0!==n&&null!=n){this.removeValidations();var m=i;-1===m.indexOf(h)&&(m=i+" "+h),n.showValidationMessage(m,p),this.isValidRender=!1,this.isValidRenderMessage=m}i=i.replace(h,"")}else this.isValidRender=!0,this.isValidRenderMessage="",e.value.toString().length>0&&!t.allowDecimals&&!t.groupDigits?(e.value=e.value.toString().replace(/^0+/,""),t.symbol.length>0&&(e.value=e.value.toString().replace(t.symbol+"0",t.symbol)),e.value=e.value.toString().replace(/^0+/,""),0==e.value.replaceAll("0","").length?e.value=t.symbol+"0":e.value.toString()==parseInt(e.value)&&(e.value=t.symbol+e.value)):"money"!==this.properties.type&&"number"!==this.properties.type&&"columnMoney"!==this.properties.type&&"columnNumber"!==this.properties.type||(e.value=e.value.toString().replace(/^0+/,""),""===e.value&&(e.value=0)),this.executeFormatCurrencyPlugin(),this.setValue(this.numericInput.asNumber({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits})),t.percentage&&this.numericInput&&-1==this.numericInput.val().indexOf("%")&&this.numericInput.val(this.numericInput.val()+"%"),i=i.replace(h,"")}else this.setValue("")},attachFormatCurrency:function attachFormatCurrency(){var self=this,properties=self.properties;self.isValidRender=self.isValidRender||!0,null==$.formatCurrency.regions[bizagi.language]&&($.formatCurrency.regions[bizagi.language]=this.getResource("numericFormat")),self.numericInput.blur((function(){self.formatNumericInput(this)})).bind("paste",(function(e){try{var tmpData=bizagi.util.isIE()||bizagi.util.isIE11()?window.clipboardData.getData("text"):e.originalEvent.clipboardData.getData("Text"),totalVal="/[^0-9";properties.decimalSymbol.length>0&&(totalVal+=properties.decimalSymbol),8==properties.dataType&&(properties.symbol.length>0&&(totalVal+=properties.symbol),properties.digitGroupSymbol.length>0&&(totalVal+=properties.digitGroupSymbol)),totalVal+="\\-\\s]/gi";try{tmpData.replace(eval(totalVal),"").length!=tmpData.length&&e.preventDefault()}catch(e){}}catch(e){bizagi.log("Error to pasting content"),self.isInvalidFormat=!0}})).keydown((function(e){self.previousValue=this.value;var t=(e=window.event&&window.event.preventDefault?window.event:e).charCode||e.keyCode;if("undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO&&0==BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits&&(properties.allowDecimals=!1),(properties.dataType<5||8==properties.dataType&&0==properties.allowDecimals)&&(188!=t&&190!=t&&110!=t||e.preventDefault()),this.value&&void 0!==e&&this.value.length>0&&(8==properties.dataType||10==properties.dataType))if(t>47&&t<58){self.formatTimeout&&clearTimeout(self.formatTimeout);var i=this.value+"";properties.digitGroupSymbol&&properties.digitGroupSymbol.length>0&&(i=i.replaceAll(properties.digitGroupSymbol,"")),properties.symbol.length>0&&(i=i.replaceAll(properties.symbol,"")),i=$.trim(i),properties.decimalSymbol&&properties.decimalSymbol.length>0&&(i=i.replaceAll(properties.decimalSymbol,".")),10*i>properties.dataTypeMaxValue&&e.preventDefault()}else if(109==t||189==t)if(0!=this.selectionStart||this.selectionEnd!=this.value.length){var r=this.selectionEnd;this.value=properties.symbol+"-"+this.value.replace(properties.symbol,""),this.selectionStart=this.selectionEnd=r+1}else 0==this.selectionStart&&this.selectionEnd==this.value.length&&(this.value="-",this.selectionStart=this.selectionEnd=this.value.length)})).keyup((function(e){var t=(e=window.event||e).charCode||e.keyCode;if(void 0!==e)switch(t){case 16:case 17:case 13:case 18:break;case 27:this.value=""}})).keypress((function(e){var t=(e=window.event&&window.event.preventDefault?window.event:e).charCode||e.keyCode;if(void 0!==e){35==t||37==t||39==t?e.preventDefault():8!=properties.dataType&&36==t&&e.preventDefault();var i=String.fromCharCode(t);!1===properties.allowDecimals&&0===properties.numDecimals&&i===properties.decimalSymbol&&e.preventDefault()}}))},executeFormatCurrencyPlugin:function(){var e=this.properties;if(this.numericInput&&this.numericInput.formatCurrency({symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,roundToDecimalPlace:e.numDecimals,colorize:e.colorize}),8!==e.dataType&&!0===bizagi.override.removeTrailingZeros){var t=this.numericInput.val(),i=!0;-1!==t.indexOf(")")&&(i=!1,t=t.replace("(","").replace(")",""));var r=new RegExp("("+e.decimalSymbol+"\\d*?[1-9])0+$","g");t=t.replace(r,"$1"),r=new RegExp("\\"+e.decimalSymbol+"0+$","g"),t=t.replace(r,""),this.numericInput.val(t),i||this.numericInput.val("("+t+")")}e.percentage&&this.numericInput.val(this.numericInput.val()+"%")},getDisplayValue:function(){var e=this.properties,t=this.getControl(),i=void 0!==this.getValue()&&null!==this.getValue()?this.getValue():e.defaultValue||e.defaultvalue||$("input",t).val()||"",r=$("<label/>").html(bizagi.util.numberToFixedString(i));if(r.formatCurrency({symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,roundToDecimalPlace:e.numDecimals,colorize:e.colorize}),e.percentage&&(r=$("<label/>").html(r.text()+"%")),!e.editable&&8!==e.dataType&&!0===bizagi.override.removeTrailingZeros){var a=!0;-1!==(i=r.text()).toString().indexOf(")")&&(a=!1,i=i.replace("(","").replace(")",""));var n=new RegExp("("+e.decimalSymbol+"\\d*?[1-9])0+$","g");return i=i.replace(n,"$1"),n=new RegExp("\\"+e.decimalSymbol+"0+$","g"),i=i.replace(n,""),a||(i="("+i+")"),i}return r.text()},isValid:function(e){var t,i=this.properties,r=this._super(e),a=this.getValue(),n=this.getMinValue(),o=this.getMaxValue();if("string"==typeof a&&""!=a&&(a=Number(a)),this.hasValue()&&(bizagi.util.isEmpty(n)||a<n&&(t=this.getResource("render-numeric-minimum-validation").replaceAll("#label#",i.displayName.toString()+" ("+a+")").replaceAll("#minValue#",n.toString()),e.push({xpath:i.xpath,message:t}),r=!1),bizagi.util.isEmpty(o)||a>o&&(t=this.getResource("render-numeric-maximum-validation").replaceAll("#label#",i.displayName.toString()+" ("+a+")").replaceAll("#maxValue#",o.toString()),e.push({xpath:i.xpath,message:t}),r=!1)),!(!1!==this.isValidRender||r&&bizagi.util.isMobileDevice())){r=!1;var s=this.isValidRenderMessage?this.isValidRenderMessage:"error";e.push({xpath:i.xpath,message:s})}return r},getMinValue:function(){var e=this.properties.minValue;return null!=e?e:this.properties.dataTypeMinValue},getMaxValue:function(){var e=this.properties.maxValue;return null!=e?e:this.properties.dataTypeMaxValue},getDefaultAllowDecimals:function(e){if(e){if(1===e||2===e||3===e||4===e||7===e)return!1;if(6===e||8===e||10===e||11===e)return!0}return!1},getDefaultGroupDigits:function(e){if(e){if(1===e||2===e||3===e||4===e||7===e)return!1;if(6===e||8===e||10===e||11===e)return!0}return!1},setGroupDigits:function(){return void 0!==this.properties.thousands?!!this.properties.digitGroupSymbol&&bizagi.util.parseBoolean(this.properties.thousands):!!this.properties.digitGroupSymbol&&this.getDefaultGroupDigits(this.properties.dataType)},calculateMinValue:function(e){return 8===e||10===e?-922337203685477:4===e?0:3===e?-32768:2===e?-2147483648:1===e?-999999999999999:null},calculateMaxValue:function(e){return 8===e||10===e?922337203685477:4===e?255:3===e?32767:2===e?2147483647:1===e?999999999999999:null},performMinValue:function(e){var t=Number(e);return isNaN(t)&&(t=this.calculateMinValue(this.properties.dataType)),t},performMaxValue:function(e){var t=Number(e);return isNaN(t)&&(t=this.calculateMaxValue(this.properties.dataType)),t},changeMinValue:function(e){var t=this.performMinValue(e);this.properties.minValue=this.properties.dataTypeMinValue=t},changeMaxValue:function(e){var t=this.performMaxValue(e);this.properties.maxValue=this.properties.dataTypeMaxValue=t},createTooltip:function(e,t,i){e.data("oldValue",t),e.val("");try{e.tooltip("destroy")}catch(e){}e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",(function(e,t){t.tooltip.zIndex(r)})),e.tooltip("open");var a=setTimeout((function(){e.focus(),clearTimeout(a)}),100)}}),$.Class.extend("bizagi.rendering.numberScientificNotation",{initializeData:function(e){this._super(e),this.properties.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:format.decimalSymbol},renderControl:function(){var e=this.renderFactory.getTemplate("numberScientificNotation");return $.fasttmpl(e,{})},postRender:function(){var e=this.getControl();this.numericInput=e.find("input"),this.numericInput.numericSN(this.properties.decimalSymbol)},getDisplayValue:function(){return this.getValue().replace(".",this.properties.decimalSymbol)},setValue:function(e){e=(e||"").toString().replace(this.properties.decimalSymbol,"."),this._super(e)},controlValueIsChanged:function(){var e=this.properties,t=this.getValue()||"",i=e.originalValue||"";return!!$.forceCollectData||i.toLowerCase()!=t.toLowerCase()}}),$.Class.extend("bizagi.rendering.date",{},{initializeData:function(e){var t=bizagi.util.dateFormatter;this._super(e);var i=this.properties,r=this.getResource("dateFormat"),a=this.getResource("timeFormat");if(i.displayValue="",i.showTime=void 0!==i.showTime&&bizagi.util.parseBoolean(i.showTime),i.dateFormat=i.dateFormat||r,i.timeFormat=i.timeFormat||a,i.fullFormat=i.dateFormat,i.showTime&&-1===i.fullFormat.search(/[h|H]+/gi)&&(i.fullFormat=i.fullFormat+" "+i.timeFormat),i.value){var n=t.getDateFromInvariant(i.value,i.showTime);if(0!=n){this.value=i.value;var o=bizagi.localization.getResource("datePickerRegional");i.displayValue=bizagi.util.dateFormatter.formatDate(n,i.fullFormat,o)}else this.value=null}r=this.getDateFormat(i.fullFormat);var s=i.fullFormat.substring(0,i.fullFormat.indexOf(":")).lastIndexOf(" ");i.showTime||(i.fullFormat=s>0?i.fullFormat.substring(0,s):i.fullFormat),i.datePickerFormat=r.datePickerFormat,i.timePickerFormat=r.timePickerFormat,this.i18n=bizagi.localization.getResource("datePickerRegional")},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("date"),i=e.fullFormat;return $.fasttmpl(t,{id:e.id,showTime:e.showTime,value:e.value,editable:e.editable,dateFormat:bizagi.override&&!0===bizagi.override.uppercaseDatePlaceholder?i.toUpperCase():i,rtl:"rtl"==e.orientation})},configureHandlers:function(e,t){var i=this,r=i.properties,a=i.getDateControl(),n=i.getTimeControl();a.bind("change",(function(){i.onChangeHandler()})),r.showTime&&n.bind("change",(function(e,t){i.updatingTime?delete i.updatingTime:i.onChangeHandler(t)}))},onChangeHandler:function(){},getDisplayValue:function(e){var t,i=this.properties;if(!i.displayValue&&e){var r=bizagi.util.dateFormatter.getDateFromInvariant(e,i.showTime),a=bizagi.localization.getResource("datePickerRegional");t=bizagi.util.dateFormatter.formatDate(r,i.fullFormat,a)}else t="";return i.displayValue||t||""},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();if(this.controlValueIsChanged()&&!bizagi.util.isEmpty(i))if(bizagi.util.isEmpty(r))""===r&&(e[t.xpath]="");else{var a=bizagi.util.dateFormatter.getDateFromInvariant(r,t.showTime);void 0!==a&&0!==a&&(t.showTime||a.setHours(0,0,0,0),e[t.xpath]=bizagi.util.dateFormatter.formatInvariant(a,!0))}},getDateControl:function(){},getTimeControl:function(){},isValid:function(e){var t,i=this.properties,r=this._super(e),a=this.getValue();if(a&&(!0===bizagi.util.parseBoolean(i.editable)&&0!=(a=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromInvariant(a,i.showTime))))){if(i.minValue&&("string"==typeof i.minValue||"number"==typeof i.minValue)){var n=this.getNormalizeDate("string"==typeof i.minValue?bizagi.util.dateFormatter.getDateFromInvariant(i.minValue,i.showTime):new Date(i.minValue));a<n&&(t=this.getResource("render-date-minimum-validation").replaceAll("#label#",i.displayName).replaceAll("#minValue#",bizagi.util.dateFormatter.formatDate(n,i.fullFormat)),e.push({xpath:i.xpath,message:t}),r=!1)}if(i.maxValue&&("string"==typeof i.maxValue||"number"==typeof i.maxValue)){var o=this.getNormalizeDate("string"==typeof i.maxValue?bizagi.util.dateFormatter.getDateFromInvariant(i.maxValue,i.showTime):new Date(i.maxValue));a>o&&(t=this.getResource("render-date-maximum-validation").replaceAll("#label#",i.displayName).replaceAll("#maxValue#",bizagi.util.dateFormatter.formatDate(o,i.fullFormat)),e.push({xpath:i.xpath,message:t}),r=!1)}}return r},getDateFormat:function(e){var t,i=e,r=void 0;return-1==e.search("h")&&-1==e.search("H")||(t=-1!=e.search("h")?e.search("h"):e.search("H"),i=e.substring(0,t-1),r=e.substr(t)),i.indexOf("MMMM")>=0?i=i.replaceAll("MMMM","MM"):i.indexOf("MMM")>=0?i=i.replaceAll("MMM","M"):i.indexOf("MM")>=0?i=i.replaceAll("MM","mm"):i.indexOf("M")>=0&&(i=i.replaceAll("M","m")),-1!=i.search("yyyy")?i=i.replaceAll("yyyy","yy"):-1!=i.search("yy")&&(i=i.replaceAll("yy","y")),{datePickerFormat:i=i.replaceAll("dddd","DD"),timePickerFormat:r}},postRender:function(){var e=this.properties;this._super(),void 0===e.maxValue&&(e.maxValue="12/31/"+parseInt((new Date).getFullYear()+200).toString()+" 00:00:00"),void 0===e.minValue&&(e.minValue="01/01/"+parseInt((new Date).getFullYear()-200).toString()+" 00:00:00")},getNormalizeDate:function(e){return 0!=e&&null!=e&&(this.properties.showTime?e.setMilliseconds(0):e.setHours(0,0,0,0)),e},getTimeFormat:function(e){return e.replaceAll("m","i").replaceAll("tt","A")},setValueFromCalendarButtons:function(e){e?e=this.getNormalizeDate(e):(value=null,this.setValue(""),this.setDisplayValue(""))},changeMinValue:function(e){var t=this.properties,i=bizagi.util.dateFormatter;e&&t.editable&&("number"==typeof e?e=i.formatInvariant(this.getNormalizeDate(new Date(e)),t.showTime):(e=this.getNormalizeDate("object"===_typeof(e)?e:i.getDateFromInvariant(e,t.showTime)),e=i.formatInvariant(e)),t.minValue=e)},changeMaxValue:function(e){var t=this.properties,i=bizagi.util.dateFormatter;e&&t.editable&&("number"==typeof e?e=i.formatInvariant(this.getNormalizeDate(new Date(e)),t.showTime):(e=this.getNormalizeDate("object"===_typeof(e)?e:i.getDateFromInvariant(e,t.showTime)),e=i.formatInvariant(e)),t.maxValue=e)}}),$.Class.extend("bizagi.rendering.extendedText",{},{initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.hasMaxLines=!!this.properties.maxLines;var t=this.properties;if(t.maxLines=this.properties.maxLines||6,t.regularExpressionExpression){var i=t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message");t.regularExpression={expression:t.regularExpressionExpression,message:i}}},renderControl:function(){var e=this.renderFactory.getTemplate("extendedText");return $.fasttmpl(e,{id:this.properties.id,isEmptyField:void 0===this.properties.value,editable:this.properties.editable})},postRender:function(){this._super();var e=this.getControl();this.textarea=e.find("textarea"),this.textarea?this.textarea.css({resize:"both"}):this.textarea.css({resize:"none"}),"double"===this.properties.retype&&this.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var e=this,t=e.properties;t.maxLength&&e.textarea.prop("maxlength",t.maxLength),t.maxLines?e.textarea.prop("rows",t.maxLines):e.textarea.prop("rows",6),e.textarea.bind("change",(function(){e.setValue(e.textarea.val());var i=[];if("duplicate"!==t.retype)if(e.isValid(i)||void 0===t.regularExpression)e.setValue(e.textarea.val(),!0);else{var r=i[0].message;bizagi.showMessageBox(r,"Bizagi","error")}})),e.textarea.bind("blur",(function(){e.setValue(e.textarea.val())}))},isValid:function(e){var t,i=this.properties,r=this._super(e),a=this.getValue(),n=new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g");return this.isOfflineForm&&bizagi.util.isMobileDevice()&&(a=a&&"object"===_typeof(a)&&a.value?a.value:a),i.regularExpression?i.editable&&(a&&(a.match(n)||!a.match(new RegExp(i.regularExpression.expression))&&this.properties&&"userName"===this.properties.xpath)?(t=i.regularExpression.message,e.push({xpath:i.xpath,message:t}),r=!1):!a||!a.match(n)&&a.match(new RegExp(i.regularExpression.expression))||(t=i.regularExpression.message,e.push({xpath:i.xpath,message:t}),r=!1)):a&&a.match(new RegExp(".*?eval\\(","g"))&&a.match(new RegExp(".*?eval\\u0028","g"))&&i.editable&&(t=this.getResource("render-text-regular-expression-default-message"),e.push({xpath:i.xpath,message:t}),r=!1),r},setDisplayValue:function(e){var t=this.getControl();if(0==this.properties.editable&&"string"==typeof e){var i=bizagi.util.encodeHtmlText(this.getDisplayValue());t.html(i)}this.setValue(e,!1)},collectData:function(e){this._super(e)},createTooltip:function(e,t,i){e.data("oldValue",t),e.val(""),e.data("ui-tooltip")&&e.tooltip("destroy"),e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",(function(e,t){t.tooltip.zIndex(r)})),e.tooltip("open");var a=setTimeout((function(){e.focus(),clearTimeout(a)}),100)},validateValue:function(e,t){return t<1||e.length<=t?e:e.substr(0,t)}}),$.Class.extend("bizagi.rendering.grid",{},{initializeData:function(e){var t=this;this._super(e),t.originalProperties=bizagi.clone(e.properties);var i,r,a=this.properties;t.initProperties(),t.columns=[],t.columnsIds=[],t.enabledChecks={},t.exclusiveChanges={},t.originalEnabledChecks=[],$.each(e.elements,(function(e,n){var o=n.render.properties;o.groupBy&&(a.groupBy=o.xpath||"",a.allowGrouping=!bizagi.util.isEmpty(a.groupBy)),/columnBoolean/i.test(o.type)&&o.isExclusive&&(a.hasExclusiveCheck=!0,n.render.properties.required=!1,t.enabledChecks[o.xpath]=[]),t.properties.inlineEdit||(n.render.properties.editable=!1);var s=t.renderFactory.getColumn({type:o.type,data:n.render,parent:t,singleInstance:a.singleInstance});t.columns.push(s),t.columnsIds.push(n.render.properties.id),o.editable&&(i=!0),o.totalize&&o.totalize.operation&&(r=!0,o.totalize.format=o.totalize.format||{},o.totalize.format.bold=void 0===o.totalize.format.bold||o.totalize.format.bold)})),"rtl"===a.orientation&&(t.columns=t.columns.reverse()),a.inlineEdit&&!i&&(a.inlineEdit=!1,a.allowEdit=!1),r&&(a.showSummary=!0,a.rowsPerPage=0)},initProperties:function(){var e=this.getFormContainer(),t=this.properties;$.extend(t,this.initEditabilityProperties(t.editable,t.allowEdit,t.inlineEdit,t.withEditForm),this.initAddAndDeleteProperties(t.editable,t.allowAdd,t.inlineAdd,t.allowDelete)),t.allowDetail=null!=bizagi.util.parseBoolean(t.allowDetail)&&bizagi.util.parseBoolean(t.allowDetail),t.isSortable=null==bizagi.util.parseBoolean(t.isSortable)||bizagi.util.parseBoolean(t.isSortable),t.keyColumn="",t.data=t.data||null,t.displayType="value",t.skipInitialLoad=t.skipInitialLoad||!1,t.allowMore=bizagi.util.parseBoolean(t.allowMore)||!1,t.allowFilter=bizagi.util.parseBoolean(t.allowFilter)||!1,t.allowGrouping=!1,t.groupBy="",t.groupSummary=t.groupSummary||null,t.groupText=this.getResource("render-grid-group-text"),t.groupCollapsed=bizagi.util.parseBoolean(t.groupCollapsed)||!1,t.groupOrder=t.groupOrder||"asc",t.formShowMode=bizagi.util.parseBoolean(t.formShowMode)||"popup",t.floatingHeader=bizagi.util.parseBoolean(t.floatingHeader)||!1,t.sortBy=t.sortBy?t.sortBy:t.data&&t.data.sort?t.data.sort:t.keyColumn,t.sortOrder=void 0!==t.sortOrder&&null!==t.sortOrder?"True"===t.sortOrder?"asc":"desc":t.data&&t.data.order?t.data.order:"asc",t.sort=t.sortBy+" "+t.sortOrder,t.rowsPerPage=t.allowGrouping?1e3:t.rowsPerPage||20,t.page=1,t.records=0,t.totalPages=0,t.addLabel=t.addLabel||$.trim(this.getResource("render-grid-add-label"))+" "+t.displayName,t.editLabel=t.editLabel||$.trim(this.getResource("render-grid-edit-label"))+" "+t.displayName,t.deleteLabel=t.deleteLabel||this.getResource("render-ecm-confirm-bt-delete")+" "+t.displayName,t.exportOptionsLabel=t.exportOptionsLabel||this.getResource("render-grid-export-options-label")+t.displayName,t.detailLabel=t.detailLabel||this.getResource("render-collection-navigator-details-form"),t.tableCssClass=t.cssClass||"",t.alreadySaved=!1,"entity"!=t.contexttype&&(t.contexttype="function"==typeof this.parent.getContextType?this.parent.getContextType():"");try{(this.parent&&"boolean"==typeof this.parent.properties.editable&&!this.parent.properties.editable||!t.editable)&&(t.editable=!1,t.allowEdit=!1,t.inlineEdit=!1,t.allowAdd=!1,t.inlineAdd=!1,t.allowDelete=!1)}catch(e){}t.allowEdit&&(t.inlineEdit||t.withEditForm)||(t.editable=!1),t.labelWidth=0,t.valueWidth="100%",t.overrideGetRemoteData=t.overrideGetRemoteData||void 0,t.singleInstance=!!bizagi.util.isEmpty(t.singleInstance)||t.singleInstance,t.contextType=e.params&&e.params.data&&e.params.data.contextType?e.params.data.contextType:null,this.changes={},this.cellOverrides={},this.isRTL()&&null!=t.data&&(t.data.rows=this.changeOrderData(t.data.rows))},initEditabilityProperties:function(e,t,i,r){return e=null===bizagi.util.parseBoolean(e)||bizagi.util.parseBoolean(e),t=null===bizagi.util.parseBoolean(t)||bizagi.util.parseBoolean(t),i=null===bizagi.util.parseBoolean(i)||bizagi.util.parseBoolean(i),r=null!==bizagi.util.parseBoolean(r)&&bizagi.util.parseBoolean(r),e||(t=i=r=!1),{editable:e,allowEdit:t,inlineEdit:i,withEditForm:r}},initAddAndDeleteProperties:function(e,t,i,r){return e=null===bizagi.util.parseBoolean(e)||bizagi.util.parseBoolean(e),t=null==bizagi.util.parseBoolean(t)||bizagi.util.parseBoolean(t),i=null==bizagi.util.parseBoolean(i)||bizagi.util.parseBoolean(i),r=null==bizagi.util.parseBoolean(r)||bizagi.util.parseBoolean(r),t||(i=!1),e||(t=i=r=!1),{allowAdd:t,inlineAdd:i,allowDelete:r}},hasValue:function(){return this.properties.data&&this.properties.data.rows.length>0},isRTL:function(){var e=this.properties;return!e||"string"==typeof e.orientation&&"RTL"==e.orientation.toUpperCase()},changeOrderData:function(e){var t,i=[],r=e||[];return $.each(r,(function(e,a){t=a.shift(),(i=a.reverse()).unshift(t),r[e]=i})),r},removeRemainingColumns:function(e,t){var i=e||[],r=0;return i.length>0&&(r=i[0].length-t-1),r>0&&$.each(i,(function(e,t){for(var i=0;i<r;i++)t.pop()})),i},getColumn:function(e){var t=null;return $.each(this.columns,(function(i,r){r.properties.xpath!=e&&r.properties.id!=e&&r.properties.xpath+"."+r.properties.id!=e||(t=r)})),t},getColumnType:function(e){var t=this.columnsIds.indexOf(e);return-1!=t?this.columns[t].properties.type:null},getColumnById:function(e){var t=this.columnsIds.indexOf(e);return-1!==t?this.columns[t]:null},renderControl:function(){var e=this.properties,t=new $.Deferred;"execution"!==this.getMode()&&(e.data=this.getDummyData());var i=this.getGridTemplate(),r=this.applyTemplate(i),a=[];return $.each(this.columns,(function(e,t){var i=t.initialize();i&&a.push(i)})),$.when.apply($,a).done((function(){t.resolve(r)})),t.promise()},postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-grid-container").addClass("ui-bizagi-render-display-block")},getGridTemplate:function(){return this.renderFactory.getTemplate("grid")},applyTemplate:function(e){var t=this.properties;return orientation=this.properties.orientation,$.fasttmpl(e,{id:bizagi.util.encodeXpath(t.xpath),displayName:bizagi.util.encodeXpath(t.displayName),allowAdd:t.allowAdd,addLabel:t.addLabel})},renderReadOnly:function(){return this.renderControl()},getRemoteData:function(e){var t=this,i=t.properties;return e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,sort:i.sortBy,order:i.sortType,page:i.page,rows:i.rowsPerPage,searchFilter:i.searchFilter,orientation:i.orientation||"ltr"}),i.overrideGetRemoteData?i.overrideGetRemoteData(e):t.dataService.multiaction().getGridData(e).then((function(e){return t.originalProperties=t.originalProperties||{},t.originalProperties.data=bizagi.clone(e),i.page=e.page,i.records=e.records,i.totalPages=e.totalPages,e})).fail((function(e){console.error(e.message||"Error")}))},spliceRowData:function(e,t){"execution"===this.getMode()&&e&&e.rows&&$.each(e.rows,(function(i,r){var a=t||e.rows[i].length;e.rows[i].splice(a,0,"")}))},spliceRowDataVisible:function(e,t){"execution"===this.getMode()&&e&&e.visible&&$.each(e.visible,(function(i,r){var a=t||e.visible[i].length;e.visible[i].splice(a,0,!0)}))},spliceRowDataEditable:function(e,t){"execution"===this.getMode()&&e&&e.editable&&$.each(e.editable,(function(i,r){var a=t||e.editable[i].length;e.editable[i].splice(a,0,!0)}))},getDummyData:function(){var e=this.properties;if(e.data)return e.data;for(var t=["1"],i=0;i<this.columns.length;i++)t.push("");return{page:1,total:1,records:1,rows:[t]}},submitEditRequest:function(e){var t=this.properties,i=t.xpath+this.buildCellXpathFilter(e);return this.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType})},submitSaveRequest:function(e,t){var i=this,r=i.properties,a=null;t.deferreds&&(a=$.when.apply($,t.deferreds),delete t.deferreds);var n=r.xpathContext.length>0?r.xpathContext+"."+r.xpath+i.buildCellXpathFilter(e):r.xpath+i.buildCellXpathFilter(e);return $.when(a).pipe((function(){return i.startLoading(),i.dataService.saveGridRecord({url:r.saveUrl,idRender:r.id,xpath:r.xpath,xpathContext:n,submitData:t,contexttype:r.contextType,disableServerGridValidations:t.disableServerGridValidations||!1}).pipe((function(e){return i.endLoading(),e})).fail((function(e){var t=i.getFormContainer(),r=e.responseText?e.responseText:"string"==typeof e?e:e.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=e);t.validateForm(),t.clearValidationMessages(),t.addValidationMessage(r)}))}))},submitDeleteRequest:function(e){var t=this,i=t.properties,r=i.xpath+t.buildCellXpathFilter(e);return t.dataService.deleteGridRecord({url:i.deleteUrl,idRender:i.id,xpath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType}).pipe((function(e){if("validationMessages"==e.type){var i=t.getFormContainer(),r=e.messages.join(" ");i.failHandler({message:r})}return e}))},submitAddRequest:function(){var e=this.properties;return this.dataService.addGridRecord({url:e.addUrl,idRender:e.id,xpath:e.xpath,xpathContext:e.xpathContext,contexttype:e.contextType,idPageCache:e.idPageCache}).pipe((function(e){return e.idEntity})).promise()},submitRollbackRequest:function(e){var t=this.properties;return this.dataService.rollbackGridAction({url:t.rollbackUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:e?e.idPageCache:t.idPageCache,contexttype:this.properties.contexttype||""})},collectGridChange:function(e){var t=(e=e||{}).id,i=e.dataType,r=e.xpath,a=e.value,n=void 0===e.trigger||e.trigger,o=e.pressed||!1,s=i&&bizagi.util.normalizeType(i),l=e.renderId||"";this.changes[t]=this.changes[t]||{},/^columnsearch$/i.test(s)&&a&&void 0!==a.id?this.changes[t][r]=a.id:this.changes[t][r]=a,n&&this.triggerRenderChange({key:t,column:r,pressed:o,id:l})},configureColumnSubmitOnChange:function(e){var t=this,i=t.properties,r=i.id,a={commands:[{xpath:i.xpath,command:"submit-value",argument:"all"}],conditions:{operator:"and",expressions:[{simple:{operator:"cell-change",xpath:i.xpath+"[]."+e,argumentType:"text",argument:e}}]},dependencies:[i.xpath]};$.when(t.ready()).done((function(){t.getFormContainer().addSubmitAction(e+"."+r,a)}))},collectData:function(e){var t=this,i=t.properties,r=[];if(t.exclusiveChanges)for(var a in t.exclusiveChanges){var n=t.exclusiveChanges[a],o=t.enabledChecks[a];if(n&&o)e[i.xpath+"["+a+"=true]."+a]=!1}for(var s in t.changes){if("summary"!=s)for(var l in t.changes[s])if(t.canColumnBeSent(s,l)){a=i.xpath+t.buildCellXpathFilter(s)+"."+l;var d=t.changes[s][l];e[a]=d}r.push(s)}if(t.exclusiveChanges)for(var a in t.exclusiveChanges){n=t.exclusiveChanges[a],o=t.enabledChecks[a];if(n&&o){var u=t.exclusiveChanges[a];if(u&&u.value)e[i.xpath+t.buildCellXpathFilter(u.key)+"."+a]=u.value}}$.each(r,(function(e,i){delete t.changes[i]}))},hasChanged:function(e){return $.isEmptyObject(this.changes)?!$.isEmptyObject(this.exclusiveChanges)&&(e.push(!0),!0):(e.push(!0),!0)},canColumnBeSent:function(e,t){var i,r;for(i in this.columns)if(this.columns.hasOwnProperty(i)){var a=this.columns[i];if("columnUserfield"!==a.properties.type){if(a.properties.xpath==t){var n=this.getCellOverride(e,a.columnIndex-1);return a.canBeSent(e,n)}}else for(r in a.properties)if(a.properties.hasOwnProperty(r)&&"[object String]"===Object.prototype.toString.apply(a.properties[r])&&a.properties[r].substr(a.properties[r].lastIndexOf(".")+1)===t)return!0}return!1},canBeSent:function(){var e=this.properties;return!(bizagi.util.parseBoolean(e.displayOnly)||!1||!e.inlineEdit&&!e.inlineAdd&&$.isEmptyObject(this.changes))},getCellValue:function(e,t){for(var i=this.properties.data.rows,r=0;r<i.length;r++)if(i[r][0]==e)for(var a=0;a<this.columns.length;a++){if(this.columns[a].properties.xpath==t)return i[r][a+1]}return null},getCellCurrentValue:function(e,t){var i=this.getControlCell(e,t);return i&&"function"==typeof i.getValue?i.getValue():null},getControlCell:function(e,t){var i=null;if(void 0!==this.columns)for(var r=0;r<this.columns.length;r++)if(this.columns[r].properties.xpath==t||this.columns[r].properties.id==t||this.columns[r].properties.xpath+"."+this.columns[r].properties.id==t){i=this.columns[r].getDecorated(e);break}return i},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("grid-control-required"):t.removeClass("grid-control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("grid-control-required"):t.removeClass("grid-control-required")),this.triggerRenderValidate()},refresh:function(){},setError:function(e,t){},changeCellBackgroundColor:function(e,t,i){},changeCellColor:function(e,t,i){},changeCellVisibility:function(e,t,i){},changeCellRequired:function(e,t,i){},changeCellEditability:function(e,t,i){},changeCellProperties:function(e,t,i){},changeCellMaxValue:function(e,t,i){},changeCellMinValue:function(e,t,i){},changeColumnEditability:function(e,t){},changeColumnVisibility:function(e,t){},changeColumnRequired:function(e,t){},cleanCellData:function(e,t){},changeEditability:function(e){var t=this,i=t.getControl();t.saveGrid().done((function(){var r="Default"==e?t.originalProperties.editable:bizagi.util.parseBoolean(e);i.empty();var a=t.originalProperties;$.extend(t.properties,t.initEditabilityProperties(r,a.allowEdit,a.inlineEdit,a.withEditForm),t.initAddAndDeleteProperties(r,a.allowAdd,a.inlineAdd,a.allowDelete)),t.properties.editabilityEnabled=t.properties.editabilityEnabled||t.properties.editable,r?t.properties.allowEdit&&t.properties.inlineEdit&&t.changeColumnsEditability(e):t.changeColumnsEditability(!1),"function"==typeof t.internalRenderControl&&$.when(t.internalRenderControl()).done((function(e){i.append(e),t.postRenderElement(t.element)}))}))},saveGrid:function(){var e=this,t=$.Deferred(),i=$("[data-bizagi-component=rows]",e.element).find("[data-new-row=true]");if(i.length>0){var r=$.map(i,(function(e,t){return $(e).data("business-key")}));e.saveInlineAddedRows(r).done((function(){$.when(e.saveRows()).done((function(){e.refresh(),t.resolve()}))}))}else t.resolve();return t.promise()},changeColumnsEditability:function(e){var t=this.columns||[];$.each(t,(function(t,i){i.properties.editable="Default"==e?i.originalProperties.editable:bizagi.util.parseBoolean(e)}))},refreshCell:function(e){var t=this,i=t.properties,r=e.key,a=e.column,n=""!==e.xpathContext?e.xpathContext+"."+t.properties.xpath+t.buildCellXpathFilter(r):t.properties.xpath+t.buildCellXpathFilter(r),o=t.getControlCell(r,e.column),s=t.getFormContainer().properties.id;if(o)return o.beforeToRefresh(),$.when(t.dataService.multiaction().refreshGridCell({idRender:i.id,column:o.properties.id,idPageCache:i.idPageCache,xpathContext:n,idForm:s,typeRender:bizagi.util.normalizeType(o.properties.type)})).done((function(e){var i=function(e){return e&&"object"==_typeof(e)&&e.length>=1?e[0].length>=1?e[0][0]:e[0]:""},n=i(e.rows),s=i(e.editable);bizagi.util.isBoolean(s)||(s=s||!0);var l=i(e.visible);bizagi.util.isBoolean(l)||(l=l||!0),t.changeCellVisibility(r,a,l),t.changeCellEditability(r,a,s);var d=o.formatValue(n);o.setValue(d),o.setDisplayValue(d),t.triggerRenderChange({key:r,column:a,changed:!1}),bizagi.override.restoreAppearanceAfterRefresh&&o.restoreCellAppearance(),null!=o.column&&"desktop"==bizagi.util.detectDevice()&&t.updateAffectedCellManually(r,d,o.column.columnIndex),t.afterToRefresh({action:"refreshCell"})}))},triggerRenderChange:function(e){e=e||{},bizagi.util.isEmpty(e)||0==e.changed||(this.properties.canBeExported=!1),this.triggerHandler("renderchange",{render:this,surrogateKey:e.key,column:e.column,changed:e.changed,rowDeleted:e.rowDeleted,pressed:e.pressed,id:e.id||""})},validate:function(){this.isValid([])},isValid:function(e){var t=!0;if(this.hasErrors=!1,this.setValidationMessage(""),this.properties.data&&this.properties.data.rows){var i=this.getDataNewRows();0==i.length&&bizagi.util.parseBoolean(this.properties.required)&&(this.hasValue()||(message=this.getResource("render-required-text").replaceAll("#label#",this.properties.displayName),e.push({xpath:this.properties.xpath,message:message}),t=!1));for(var r=$.merge($.merge([],this.properties.data.rows),i),a=0;a<this.columns.length;a++){for(var n=[],o={},s=0;s<r.length;s++){var l=r[s][a+1],d=r[s][0];this.columns[a].properties.xpath;void 0!==this.changes[d]&&void 0!==this.changes[d][this.columns[a].properties.xpath]&&(l=this.changes[d][this.columns[a].properties.xpath]),this.columns[a].isValueValid(d,l,n,this.getCellOverride(d,a))||(t=!1,this.hasErrors=!0,this.setError(d,this.columns[a].properties.xpath))}for(var u=0,c=n.length;u<c;u++)null==o[n[u]]&&(o[n[u]]=n[u]);if(n.length>0){var p=this.getResource("render-grid-validation").replaceAll("#grid#",this.properties.displayName);for(d in o)e.push({xpath:this.properties.xpath,message:p+" "+d})}}}return t},configureSubmitOnChange:function(){},getCellOverride:function(e,t){t=Number(t);var i=this.columns[t].properties;return this.cellOverrides[e]||(this.cellOverrides[e]={}),this.cellOverrides[e][t]||(this.cellOverrides[e][t]={visible:i.columnVisible&&i.visible,editable:i.editable,required:i.required}),this.cellOverrides[e][t]},setCellOverrides:function(e,t){var i;if(e.visible)for(var r=0,a=e.visible.length;r<a;r++){i=e.visible[r][0];for(var n=0,o=e.visible[r].length;n<o;n++)if(n>0){var s=this.getCellOverride(i,n-1).visible;this.cellOverrides[i][n-1].visible=!!s&&bizagi.util.parseBoolean(e.visible[r][n])}}if(e.editable)for(r=0,a=e.editable.length;r<a;r++){i=e.editable[r][0];for(n=0,o=e.editable[r].length;n<o;n++)if(n>0){var l=!t||bizagi.util.parseBoolean(t[n-1].properties.editable);this.getCellOverride(i,n-1).editable=!!l&&bizagi.util.parseBoolean(e.editable[r][n])}}if(e.required)for(r=0,a=e.required.length;r<a;r++){i=e.required[r][0];for(n=0,o=e.required[r].length;n<o;n++)n>0&&(this.getCellOverride(i,n-1).required=bizagi.util.parseBoolean(e.required[r][n]))}},getIndexes:function(){var e=$.merge(this.properties.data.rows,this.getDataNewRows());return $.map(e,(function(e,t){return e[0]}))},getDataNewRows:function(){var e=this,t=[];return"object"!=_typeof(e.newRecords)||$.isEmptyObject(e.newRecords)||$.each(e.newRecords,(function(i){var r=[];r.push(i);for(var a=0,n=e.columns.length;a<n;a++)r.push(e.getCellCurrentValue(i,e.columns[a].properties.xpath));t.push(r)})),t},getGridExportFile:function(e){var t=this.properties;return this.dataService.getGridExportFile({idRender:t.id,xpathContext:t.xpathContext||"",idPageCache:t.idPageCache,disposition:e.disposition,exportType:e.exportType,sort:t.sort,idForm:this.getFormContainer().properties.id}).then((function(e){return bizagi.util.handleJSONResponse(e)}))},submitForGridChange:function(){return this.submitOnChange(null,!1)},dispose:function(){var e=this,t=setTimeout((function(){e.columns&&$.each(e.columns,(function(e,t){t.dispose()})),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()},getEnabledChecks:function(e){var t=this,i=t.properties;e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,rows:i.rowsPerPage,xpathfilter:e.xpath});var r=new $.Deferred;return t.dataService.multiaction().getGridDataExclusivesSelected(e).done((function(e){i.page=e.page,i.records=e.records,i.totalPages=e.totalPages,t.isRTL()&&(e.rows=t.changeOrderData(e.rows)),r.resolve(e)})),r.promise()},buildCellXpathFilter:function(e){return bizagi.util.isNumeric(e)?"[id="+e+"]":"[id='"+e+"']"},cleanNewRecords:function(){this.newRecords={}},setRowAsSaved:function(e){var t=this.getControl();$("[data-bizagi-component=rows]",t).find("tr[data-business-key="+e+"]").attr("data-new-row","false")},changeBackgroundColor:function(e){this._super(e);var t=this.getControl();return t.find(".bz-rn-grid-header-title, .bz-rn-grid-header-title-rtl").css("background-color",e,"!important"),t.find(".bz-rn-grid-container-foother, .bz-rn-grid-container-foother-rtl").css("background-color",e,"!important"),this},hasColorHeader:function(){var e=this.properties.headerFormat||{};return!!e&&!bizagi.util.isEmpty(e.color)},isRTLOrientation:function(e,t){return t&&"auto"!==t||!e?/^rtl$/i.test(t):this.isRTLOrientation(e.parent,e.properties.orientation)},canBeExport:function(){for(var e in this.changes)if("summary"!==e)for(var t in this.changes[e])if(this.canColumnBeSent(e,t))return!1;if(this.exclusiveChanges)for(var i in this.exclusiveChanges)if(this.exclusiveChanges[i]&&this.enabledChecks[i])return!1;return!0},getExclusiveChangeByRow:function(e){var t={};for(var i in this.enabledChecks)if(this.enabledChecks.hasOwnProperty(i)){var r=(this.enabledChecks[i]||[]).find((function(t){return t.id==e&&t.changed}));r&&(t[i]=r.value)}return t},isCurrentGridCell:function(e,t,i){return e===i||t===i||e+"."+t===i},getIndexForCurrentCell:function(e){var t=this;return(t.columns||[]).findIndex((function(i){return t.isCurrentGridCell(i.properties.xpath,i.properties.id,e)}))||0},isSummaryOrGlobalForm:function(){var e=this.getFormContainer(),t=e&&e.properties||{};return e&&["SummaryForm","GlobalForm"].includes(t.typeForm)}}),$.Class.extend("bizagi.rendering.hidden",{},{renderControl:function(){return"design"===this.getMode()?"<div>"+bizagi.localization.getResource("render-hidden-displayName")+"</div>":"<div />"},postRender:function(){var e=this.properties;this._super(),void 0!==e.value&&this.setDisplayValue(e.value)}}),$.Class.extend("bizagi.rendering.label",{},{initializeData:function(e){this._super(e),this.properties.required=!1,this.properties.displayType="label",this.properties.displayName=e.properties.displayName||"",bizagi.util.parseBoolean(this.properties.allowDinamiclabel)&&(this.properties.displayName=e.properties.displayName||bizagi.localization.getResource("render-label-default-display-name")),this.bindingValue(),this.calculateInitialLayoutProperties()},postRender:function(){this._super(),this.changeDisplayOption("label"),"function"==typeof this.configureHelpText&&this.configureHelpText()},postRenderReadOnly:function(){this._super(),this.changeDisplayOption("label"),this.changeLabelAlign(this.properties.labelAlign||"left")},isValid:function(e){},canBeSent:function(){return!1},bindingValue:function(){this.properties.allowDinamiclabel&&this.properties.value&&("object"===_typeof(this.properties.value)&&this.properties.value[0]?this.properties.displayName=this.properties.value[0].value:"string"==typeof this.properties.value&&""!==this.properties.value&&(this.properties.displayName=this.performLabelLineBreak(this.properties.value)))},controlValueIsChanged:function(){return!1},performLabelLineBreak:function(e){return(e||"").replace(/\\n/gm,"\n")}}),$.Class.extend("bizagi.rendering.search",{},{initializeData:function(e){var t=e.properties.submitOnChange;"execution"===this.getMode()&&e.properties.advancedSearch&&(t=void 0!==t?t:!((e.properties.submitVersion||1)>1)),this._super(e);var i=this.properties;i.submitOnChange=bizagi.util.parseBoolean(t)||!1,i.searchForms=i.searchForms||[],i.maxRecords=Number(i.maxRecords)||20,i.advancedSearch=null!==bizagi.util.parseBoolean(i.advancedSearch)&&bizagi.util.parseBoolean(i.advancedSearch),i.allowSuggest=null!==bizagi.util.parseBoolean(i.allowSuggest)&&bizagi.util.parseBoolean(i.allowSuggest),i.allowFullSearch=i.allowFullSearch||!1,i.allowAdd=bizagi.util.parseBoolean(i.allowAdd)||!1,i.allowTyping=null!==bizagi.util.parseBoolean(i.allowTyping)&&bizagi.util.parseBoolean(i.allowTyping),i.allowTyping=!!bizagi.util.parseBoolean(i.allowSuggest)||i.allowTyping,i.allowClear=null!==bizagi.util.parseBoolean(i.allowClear)&&bizagi.util.parseBoolean(i.allowClear),i.editable=null===bizagi.util.parseBoolean(i.editable)||bizagi.util.parseBoolean(i.editable),i.searchLength=i.searchLength||2,i.enableLocalStorage=!1,i.expireCache=9e5},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("search");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,allowTyping:e.allowTyping,advancedSearch:e.advancedSearch,allowSuggest:e.allowSuggest,editable:e.editable,allowClear:e.allowClear,hasValue:this.hasValue()})},getData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.getFormContainer(),n=a.getContextType()||a.params.contexttype||!1;if(e=e||{},t.properties.contexttype?e.h_contexttype=t.properties.contexttype:n&&(e.h_contexttype=n),e.h_contexttype=t.properties.enableQuerySuggestBehavior?"metadata":e.h_contexttype,e&&e.h_contexttype&&"metadata"===e.h_contexttype&&(i.xpathContext=""),i.term.indexOf("'")>-1){var o=new RegExp("'","g");i.term=i.term.replace(o,"\\'\\'")}if(i.term.indexOf('"')>-1){o=new RegExp('"',"g");i.term=i.term.replace(o,'"')}return t.dataService.multiaction().getSearchData({url:i.dataUrl,contexttype:e.h_contexttype,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.allowFullSearch?"%"+i.term:i.term,extra:e}).done((function(e){i.data=e,r.resolve(i.data)})).fail((function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)})),r.promise(r)},setValue:function(e,t){t=void 0===t||t,this._super(e,t),null!=e?(this.value=e,this.selectedValue=e.label):(this.value=null,this.selectedValue=null)},mapValue:function(e){return e&&e.fromAction?{id:e.value,value:e.label,label:e.label}:e},collectData:function(e){var t=this.properties.xpath,i=this.getValue();if(this.controlValueIsChanged()&&!bizagi.util.isEmpty(t)&&null!=i){if("object"==_typeof(i)&&void 0===i.id)return;e[t]=i}},submitData:function(){var e={};this.grid||(e[this.properties.xpath]=this.getValue()),this.submitOnChange(e,void 0,!1)},isValid:function(e){return this._super(e)},hasValue:function(){var e=this.getValue();return void 0!==e&&null!=e&&("object"===_typeof(e)&&""!==e.id&&void 0!==e.id||!bizagi.util.isEmpty(e))},formatItem:function(e){return bizagi.util.formatItem(e)}}),$.Class.extend("bizagi.rendering.text",{},{initializeData:function(e){this._super(e);var t=this.properties;if(t.regularExpressionExpression){var i=t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message");t.regularExpression={expression:t.regularExpressionExpression,message:i}}},renderControl:function(){var e=this.renderFactory.getTemplate("text");return $.fasttmpl(e,{id:this.properties.id,value:this.properties.value,isEmptyField:void 0===this.properties.value,helpText:this.properties.helpText,editable:this.properties.editable})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("text-read-only"),t=this.getValue();return bizagi.util.isString(t)&&(t=t.replaceAll("`","&#96;")),$.fasttmpl(e,{value:t,editable:this.properties.editable})},postRender:function(){this._super(),this.input=this.getControl().find("input"),"double"===this.properties.retype&&this.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var e=this,t=e.properties;t.mask&&e.input.mask({mask:t.mask}),e.input.bind("change",(function(){e.setValue(e.input.val(),!1);"duplicate"!==t.retype&&(e.isValid([])||void 0===t.regularExpression)&&e.setValue(e.input.val(),!0)})).keypress((function(e){var t=(e=window.event||e).charCode||e.keyCode;void 0!==e&&13==t&&$(this).trigger("change")})),bizagi.util.isAndroidDevice()&&t.maxLength>0&&e.input.bind("keyup",(function(e){($(this).val()&&$(this).val().length)>=t.maxLength&&(e.preventDefault(),e.target.value=e.target.value.substring(0,t.maxLength))}))},isValid:function(e){var t=this.properties,i=this._super(e),r=this.getValue();if("string"==typeof r)if(t.regularExpression){if(t.editable){var a=new RegExp("");try{a=new RegExp(t.regularExpression.expression)}catch(r){bizagi.override.showDesignValidations&&(bizagi.log(r),e.push({xpath:t.xpath,message:r.message}),i=!1)}if(r&&(r.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!r.match(a)&&this.properties&&"userName"===this.properties.xpath)){var n=t.regularExpression.message;e.push({xpath:t.xpath,message:n}),i=!1}else if(r&&(r.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!r.match(a))){n=t.regularExpression.message;e.push({xpath:t.xpath,message:n}),i=!1}}}else if(r&&r.match(new RegExp(".*?eval\\(","g"))&&r.match(new RegExp(".*?eval\\u0028","g"))&&t.editable){n=this.getResource("render-text-regular-expression-default-message");e.push({xpath:t.xpath,message:n}),i=!1}return i},setDisplayValue:function(e){var t=this.getControl(),i=bizagi.util.decodeURI(e);if(!bizagi.util.parseBoolean(this.properties.editable))if("string"==typeof e){var r=bizagi.util.encodeHtmlText(this.getDisplayValue());t.html("<label class='readonly-control'>"+r+"</label>")}else bizagi.util.isNull(e)&&t.html("");this.setValue(i,!1)},setValue:function(e){this._super(e)},createTooltip:function(e,t,i){e.data("oldValue",t),e.val(""),e.data("ui-tooltip")&&e.tooltip("destroy"),e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",(function(e,t){t.tooltip.zIndex(r)})),e.tooltip("open");var a=setTimeout((function(){e.focus(),clearTimeout(a)}),100)},validateValue:function(e,t){return"string"!=typeof e||t<1||e.length<=t?e:e.substr(0,t)}}),$.Class.extend("bizagi.rendering.readonly",{},{initializeData:function(e){this._super(e)},renderControl:function(){var e=this.renderFactory.getTemplate("readonly-value"),t="execution"==this.getMode()?this.getFormattedValue(this.properties.value,this.properties.dataType):this.getDesignModeValue(this.properties.renderType);return $.fasttmpl(e,{id:this.properties.id,value:t})},renderReadOnly:function(){return this.renderControl()},setDisplayValue:function(e){},setValue:function(e,t){},getFormattedValue:function(e,t){return bizagi.util.isEmpty(e)?"":[1,2,3,4,7].includes(t)?e:[5,17].includes(t)?bizagi.util.formatBoolean(e):[8].includes(t)?bizagi.util.formatMonetaryValue(e):[6,10,11].includes(t)?bizagi.util.formatDecimalValue(e):[12,13].includes(t)?bizagi.util.formatDateValue(e):bizagi.util.sanitizeHTML(e)||""},getDesignModeValue:function(e){return"number"==e?"123":"string"==e?"abc":"date"==e?"1/1/1900":"boolean"==e?"false":"currency"==e?"$123":""},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.element.style("background",e,"important"):this.element.css("background",""),this)},getElementsToStylize:function(e){return $(".bz-input--readonly",e)}}),$.Class.extend("bizagi.rendering.button",{},{initializeData:function(e){this._super(e);var t=this.properties;t.caption=t.caption||"",t.displayType="value",t.required=!1,t.preventDefault=t.preventDefault||!1},renderControl:function(){var e=this.renderFactory.getTemplate("button");return $.fasttmpl(e,{caption:this.properties.caption,cssClass:this.properties.cssclass||"",editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},saveForm:function(){return this.getFormContainer().saveForm()},executeButton:function(){var e=this,t=e.properties,i=t.xpathContext||"";return t.submitOnChangexpathContextRow&&(i=i?i+"."+t.submitOnChangexpathContextRow:t.submitOnChangexpathContextRow),e.getFormContainer().startLoading(),e.dataService.multiaction().executeButton({idRender:t.id,xpath:t.xpath||"",xpathContext:i||"",idPageCache:t.idPageCache}).always((function(){return e.getFormContainer().endLoading(),arguments?arguments[0]:void 0}))},refreshForm:function(){this.getFormContainer().refreshForm(this.properties.id)},processButton:function(){this.properties.editable&&this.runButtonAction()},triggerRenderChange:function(e){var t=(e=e||{}).pressed||!1;this.triggerHandler("renderchange",{render:this,pressed:t})},runButtonAction:function(){var e=this;e.getFormContainer().clearValidationMessages(),e.saveForm().pipe((function(){return e.executeButton()})).done((function(t){var i=t&&t.type?t.type:"";if(null==t||1==t||"success"===t.result||"success"===t.type)return e.refreshForm();if(["validationMessages","alertMessages"].includes(i))try{"alertMessages"===i?bizagi.modalError&&bizagi.modalError.show(t.messages.join("\n\n"),"workportal-general-word-information",!1):e.getFormContainer().addValidationMessage(t.messages)}catch(e){}})).fail((function(t){try{var i=bizagi.util.getErrorFormatted(t),r=void 0===i?{message:bizagi.localization.getResource("workportal-general-error")}:i;e.getFormContainer().failHandler(r)}catch(e){}}))},processLayout:function(e,t){e&&(this.changeBackgroundColor(t.background),this._super(!e,t))},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.getElementsToStylize(this.getControl()).style("background",e,"important"):this.getElementsToStylize(this.getControl()).css("background",""),this)},getElementsToStylize:function(e){return $("input",e)},canBeSent:function(){return!1},configureSubmitOnChange:function(){var e=this,t=e.properties,i="";if(t.editable){t.dependencies=t.dependencies||"all";var r={conditions:{expressions:[{simple:{renderId:i=t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.id:t.id,operator:"changes",argumentType:"const"}}]},commands:[{xpath:i,command:"submit-value",argument:t.dependencies}],dependencies:[i],elseCommands:[]};$.when(e.ready()).done((function(){e.getFormContainer().addSubmitAction(i,r)}))}}}),$.Class.extend("bizagi.rendering.fileprint",{},{initializeData:function(e){this._super(e);var t=this.properties,i=$.trim(t.caption);t.caption=bizagi.util.isEmpty(i)?"render-fileprint-property-caption":i,t.filesCount=t.filesCount?t.filesCount:0,t.displayType="value",this.calculateInitialLayoutProperties(),t.required=!1},renderControl:function(){var e=this.renderFactory.getTemplate("fileprint");return $.fasttmpl(e,{caption:this.properties.caption})},renderReadOnly:function(){return this.renderControl()},downloadFile:function(){return this.dataService.getFilePrint({idRender:this.properties.id,xpathContext:this.properties.xpathContext||"",idPageCache:this.properties.idPageCache,contexttype:this.properties.contexttype,disposition:"download"}).then((function(e){return bizagi.util.handleJSONResponse(e)}))}}),$.Class.extend("bizagi.rendering.link",{},{initializeData:function(e){this._super(e);var t=this.properties;t.required=!1,t.displayType="value",this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.renderFactory.getTemplate("link");return $.fasttmpl(e,{displayName:this.properties.displayName,align:this.properties.valueAlign,editable:this.properties.editable})},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},isValid:function(e){},setDisplayValue:function(e){},canBeSent:function(){return!1}}),$.Class.extend("bizagi.rendering.checkList",{},{initializeData:function(e){this._super(e);var t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1,this.setValue(t.items),this.updateOriginalValue()},postRender:function(){var e=this.getControl();this._super(),this.checkListGroup=$(".ui-bizagi-render-checkList .ui-bizagi-render-checkList-item",e)},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate(this.getTemplateName()),i=this.properties.items||[];return $.fasttmpl(t,$.extend(this.getTemplateParams(),{id:e.id,xpath:e.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:e.idPageCache,items:i}))},getTemplateName:function(){return"checkList"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){return{vertical:!this.properties.horizontal}},cleanData:function(){},setValue:function(e){this.value=bizagi.clone(e)},getValue:function(e){return this.value||[]}}),$.Class.extend("bizagi.rendering.layoutRender",{},{renderElement:function(e){var t=this.properties,i=this.getFormContainer();this.renderingDeferred=new $.Deferred,e=e||"render-layout";var r=this.renderFactory.getTemplate(e),a=t.displayName;"string"==typeof a&&(a=bizagi.util.encodeString(a));var n=$.fasttmpl(r,{label:a,isExtendedText:"text"==t.type&&t.isExtended,orientation:t.orientation,uniqueId:t.uniqueId,id:t.id,isDesign:"design"===this.getMode(),messageValidation:t.messageValidation,printVersion:i.params.printversion,cssClass:t.cssclass||"",hide:t.hide}),o=this.internalRenderControl();return o||(o=""),"object"===_typeof(o)&&o.done?"resolved"===o.state()?(n=this.replaceControlHtml(n,this.resolveResult(o)),this.asyncRenderDeferred=null):(this.asyncRenderDeferred=o,n=this.replaceControlHtml(n,"")):n=this.replaceControlHtml(n,o),n},getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=this.element),this.control&&0!=this.control.length?this.control:null},changeFontItalic:function(e){return bizagi.util.parseBoolean(e)?this.getControl().css("font-style","italic","!important"):this.getControl().css("font-style","normal","!important"),this},changeFontUnderline:function(e){var t=this.properties.valueFormat||{},i=bizagi.util.parseBoolean(t.strikethru)?"line-through ":"";return bizagi.util.parseBoolean(e)?this.getControl().css("text-decoration",i+"underline","!important"):this.getControl().find("*").each((function(e,t){$(t).css("text-decoration",i,"!important")})),this}}),$.Class.extend("bizagi.rendering.layoutImage",{},{init:function(e){this._super(e)},renderControl:function(){this.getMode(),this.properties.value;var e=this.renderFactory.getTemplate("layout-image");return $.fasttmpl(e,{useDefaultImage:!0})},getImage64:function(){var e={xpath:this.properties.xpath,entity:this.value.guid,surrogateKey:this.value.surrogateKey,width:96,height:96};return this.dataService.getEntityImage64(e)},getImageUri:function(){var e={entity:this.value.guid,surrogateKey:this.value.surrogateKey,xpath:this.properties.xpath,width:96,height:96,hash:this.value.value};return this.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(e)}}),$.Class.extend("bizagi.rendering.layoutLink",{},{init:function(e){this._super(e)},renderControl:function(){var e=this.renderFactory.getTemplate("layout-link");return $.fasttmpl(e,{displayName:this.properties.displayName})}}),$.Class.extend("bizagi.rendering.layoutLabel",{},{init:function(e){this._super(e),this.properties.required=!1,this.properties.displayType="label",this.properties.labelAlign=this.originalProperties.labelAlign||"left",this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.renderFactory.getTemplate("layout-label"),t=this.properties.displayName||this.properties.value||"";return $.fasttmpl(e,{value:t})}}),$.Class.extend("bizagi.rendering.layoutText",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);this.properties},renderControl:function(){var e=this.renderFactory.getTemplate("layout-text");return $.fasttmpl(e,{value:this.properties.value,editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()}}),$.Class.extend("bizagi.rendering.layoutUpload",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;i.editable=!0,i.allowDelete=!0,i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",i.allowSendInMail=i.allowSendInMail||!1},getValueFilesByData:function(e){var t,i,r=$.Deferred();t=e.value.value?e.value.value:e.value;try{this.isContextContainerWidgetRender()?(i=JSON.parse('{ "files": '+t+"}"),r.resolve(e,i)):$.when(this.getDataFilesWithoutScope()).done((function(t){i=JSON.parse('{ "files": '+t+"}"),r.resolve(e,i)}))}catch(t){i=JSON.parse('{ "files": []}'),r.resolve(e,i),console.warn("Exception converting data files. Error: ",t)}return r.promise()},isContextContainerWidgetRender:function(){var e=this.getFormContainer();return e.params.paramsRender&&e.params.paramsRender.idRender},getDataFilesWithoutScope:function(){var e={xpath:this.properties.xpath,entity:this.value.guid,surrogateKey:this.value.surrogateKey};return this.dataService.getFilesDataForLayoutUploadControl(e)},getValue:function(){return this.files},getUploadXpath:function(){return this.properties.xpath}}),$.Class.extend("bizagi.rendering.layoutBoolean",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e),this.properties.editable=!1},renderControl:function(){var e=this.renderFactory.getTemplate("layout-boolean");return $.fasttmpl(e,{value:this.properties.value})},renderReadOnly:function(){return this.renderControl()},setValue:function(e,t){null===e||""===e?this.properties.value="":"true"!==e.toString().toLowerCase()&&"false"!==e.toString().toLowerCase()||(this.properties.value=bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):this.getResource("render-boolean-no")),this._super(this.properties.value,t)}}),$.Class.extend("bizagi.rendering.layoutDateTime",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("dateFormat"),r=this.getResource("timeFormat");if(t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||i,t.timeFormat=t.timeFormat||r,t.fullFormat=t.dateFormat,t.showTime)-1===t.fullFormat.search(/[h|H]+/gi)&&(t.fullFormat=t.fullFormat+" "+t.timeFormat);else{var a=t.fullFormat.search(/[h|H]+/gi);-1!==a&&(t.fullFormat=t.fullFormat.substring(0,a-1))}if(t.value){var n=bizagi.util.dateFormatter.getDateFromInvariant(t.value,t.showTime);if(0!=n){var o=bizagi.localization.getResource("datePickerRegional");this.value=t.value,t.displayValue=bizagi.util.dateFormatter.formatDate(n,t.fullFormat,o)}else this.value=null}else this.value=null,t.value="",t.displayValue=""},renderControl:function(){var e=this.renderFactory.getTemplate("layout-date-time"),t=null===this.properties.value||""===this.properties.value?"":this.properties.value;return $.fasttmpl(e,{value:t})},setDisplayValue:function(e){var t,i=this.properties,r=this.getDateControl();if(this.i18n=bizagi.localization.getResource("datePickerRegional"),e.length=="MM/dd/yyyy H:mm:ss".length||e.length=="MM/dd/yyyy H:mm:ss".length+1?t=bizagi.util.dateFormatter.getDateFromInvariant(e,!0):!(t=bizagi.util.dateFormatter.getDateFromInvariant(e))||isNaN(Date.parse(t))||$.isNumeric(t)||t.setHours(0,0,0,0),e&&!isNaN(Date.parse(e))){var a=bizagi.util.dateFormatter.formatDate(t,i.fullFormat,this.i18n);r.text(a)}},getDateControl:function(){return this.dateControl=$(".ui-bizagi-render-date-time",this.getControl()),this.dateControl}}),$.Class.extend("bizagi.rendering.layoutNumber",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.getDefaultGroupDigits(t.dataType),t.colorize=t.colorizeOnNegative||!1},renderControl:function(){var e=this.renderFactory.getTemplate("layout-number");return $.fasttmpl(e,{value:this.properties.value})},renderReadOnly:function(){return this.renderControl()},getDisplayValue:function(e){var t=this.properties,i=(this.getControl(),$("<label/>").html(e));return e.toString().match(/[\u20AC \u0024\u00A3]/)||i.formatCurrency({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize}),i.text()},getDefaultAllowDecimals:function(e){if(e){if(1==e||2==e||3==e||4==e||7==e)return!1;if(6==e||8==e||10==e||11==e)return!0}return!1},getDefaultGroupDigits:function(e){if(e){if(1==e||2==e||3==e||4==e||7==e)return!1;if(6==e||8==e||10==e||11==e)return!0}return!1}}),$.Class.extend("bizagi.rendering.layoutMoney",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol?t.symbol=t.currencySymbol?t.currencySymbol:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol:t.symbol="",t.groupDigits=!0}}),$.Class.extend("bizagi.rendering.layoutPlaceholder",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);this.properties},renderControl:function(){var e=this.renderFactory.getTemplate("layout-placeholder"),t=this.properties.value||this.properties.displayName||"";return $.fasttmpl(e,{value:t})}}),$.Class.extend("bizagi.rendering.geolocation",{},{init:function(e){this._super(e),this.geolocation=window.navigator.geolocation;var t=this.properties;t.allowUpdate=!0===bizagi.util.parseBoolean(t.allowUpdate)},renderControl:function(){var e=this.renderFactory.getTemplate("geolocation");return $.fasttmpl(e,this.properties)},isValid:function(e){return this._super(e)},setDisplayValue:function(e){this.setValue(e,!1)},configureHandlers:function(){},getCurrentPosition:function(e,t){var i=this;if(void 0!==i.geolocation){return i.geolocation.getCurrentPosition((function(t){e&&e(t)}),(function(e){var r=i.getErrorMessage(e);t&&t(r)}))}t&&t(bizagi.localization.getResource("render-control-unsuported-by-browser").replace("{0}",i.properties.type))},getErrorMessage:function(e){var t="";switch(e.code){case e.PERMISSION_DENIED:case 1:t=bizagi.localization.getResource("render-geolocation-permission-denied");break;case e.POSITION_UNAVAILABLE:case 2:t=bizagi.localization.getResource("render-geolocation-position-unavailable");break;case e.TIMEOUT:case 3:t=bizagi.localization.getResource("render-geolocation-timeout");break;default:t="WD: "+bizagi.localization.getResource("render-geolocation-permission-denied")}return t},performPrecision:function(e){var t=e.split(" ")||"";if(!t)return e;try{var i=parseFloat(t[0].trim()),r=parseFloat(t[1].trim());return i.toPrecision(10)+" "+r.toPrecision(10)}catch(t){return e}}}),$.Class.extend("bizagi.rendering.upload",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties,r=Number(i.maxSize)||0,a="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):4091904;if(i.maxSize=r||a,i.maxfiles=Number(i.maxfiles)||999,i.validExtensions=i.validExtensions||"",i.validExtensions.length>0&&i.validExtensions.indexOf(".")<0){for(var n=i.validExtensions.replace(/\ /gi,"").split(";"),o=[],s=0;s<n.length;s++)if(n[s].length>0)o.push("*."+n[s]);else{n.indexOf(n[s]);n.splice(s,1)}i.validExtensions=o.join(";")}i.addUrl=i.addUrl||this.dataService.getUploadAddUrl(),i.deleteUrl=i.deleteUrl||void 0,i.editable=bizagi.util.parseBoolean(i.editable)||!1,i.allowDelete=!(null===bizagi.util.parseBoolean(i.allowDelete)||!i.editable)&&bizagi.util.parseBoolean(i.allowDelete),i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",i.allowSendInMail=i.allowSendInMail||!1,this.files=i.value||[],this.filesCount=this.files.length},renderControl:function(){for(var e=this.properties,t=this.renderFactory.getTemplate("upload"),i=$.fasttmpl(t,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),editable:e.editable,haveFiles:0!==this.filesCount,noFiles:0===this.filesCount,allowSendInMail:e.allowSendInMail}),r="",a=0;a<this.filesCount;a++){var n={id:this.files[a][0],fileName:this.files[a][1]};r+=this.renderUploadItem(n)}return i=this.replaceFilesHtml(i,r)},renderReadOnly:function(){return this.renderControl()},renderUploadItem:function(e){var t=this.getMode(),i=this.getTemplateItemName(),r=this.renderFactory.getTemplate(i),a=this.getFormContainer(),n=a.params&&a.params.printversion,o=this.isExecutionMode()?this.buildItemUrl(e):"";return $.fasttmpl(r,{id:e.id,mode:t,url:o,allowDelete:this.properties.allowDelete,filename:bizagi.util.decodeURI(e.fileName),editable:this.properties.editable,printVersion:n||!1})},buildItemUrl:function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getUploadXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},deleteUploadItem:function(e,t){var i=this,r=i.properties,a=i.getUploadXpath()+(bizagi.util.isNumeric(t)?"[id="+t+"]":"[id='"+t+"']");return i.dataService.deleteUploadFile({url:r.deleteUrl,idRender:r.id,xpath:a,xpathContext:r.xpathContext,idPageCache:r.idPageCache,contexttype:r.contexttype}).pipe((function(){i.filesCount=i.filesCount-1,i.files=$.grep(i.files,(function(e){return e[0]!=t}))}))},canBeSent:function(){return!1},setValue:function(e,t){this.files=e||[],this.filesCount=this.files.length,this._super(e,t)},getValue:function(){return this.files},isValid:function(e){var t,i=this.properties,r=!0;if(this.setValidationMessage(""),i.required&&i.editable){var a=this.grid&&this.grid.isFromCreatedRow.apply(this);if(this.filesCount<=0&&!a)(!this.grid||this.grid.properties.inlineEdit)&&(t=this.getResource("render-required-upload").replaceAll("#label#",i.displayName),e.push({xpath:i.xpath,message:t}),r=!1)}return r},buildAddParams:function(){var e=this.properties,t=this.getFormContainer(),i={},r=this.Class.BA_CONTEXT_PARAMETER_PREFIX;i[r+"xpath"]=this.getUploadXpath(),i[r+"idRender"]=e.id,i[r+"xpathContext"]=e.xpathContext,i[r+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=t.properties.sessionId,i[r+"contexttype"]=e.contexttype;try{"undefined"!=typeof BIZAGI_SESSION_NAME?i[BIZAGI_SESSION_NAME]=t.properties.sessionId:i.JSESSIONID=t.properties.sessionId}catch(e){i.JSESSIONID=t.properties.sessionId}return i},getUploadXpath:function(){return this.properties.xpath},getUploadXpathContext:function(){return this.getXpathContext()||this.properties.xpathContext},checkRequired:function(e){var t=this.properties;if(bizagi.util.parseBoolean(t.required))if(this.grid&&!0===this.grid.properties.inlineAdd){if(!this.hasValue()&&!this.getControl().parents("tr").data("new-row"))return this.setRenderRequired(e,t),!1}else if(!this.hasValue())return this.setRenderRequired(e,t),!1;return!0},setRenderRequired:function(e,t){var i=this.getResource("render-required-text").replaceAll("#label#",t.displayName);e.push({xpath:t.xpath,message:i})},getTemplateItemName:function(){return"uploadItem"},formatValue:function(e){var t=function(e){return!(!e.uploadId||!e.fileName)},i=function(e){return!(!e[0]||!e[1])};return(e||[]).reduce((function(e,r){var a=!1,n=bizagi.util.bzValidator(r).add(t).validate((function(t){(a=t.errors&&!t.errors.length)&&e.push([r.uploadId,r.fileName])}));return a||n.add(i,"The value is not in a valid format").validate((function(t){t.errors&&t.errors.length>0?console.warn(t.errors):e.push([r])})),e}),[])}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.upload",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.upload.extend("bizagi.rendering.desktop.upload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.upload.prototype),bizagi.rendering.desktop.upload.extend("bizagi.rendering.desktop.upload",{},{renderControl:function(){for(var e=this.properties,t=this.renderFactory.getTemplate("upload"),i=$.fasttmpl(t,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),editable:e.editable,haveFiles:0!=this.filesCount,allowSendInMail:e.allowSendInMail}),r="",a=0;a<this.filesCount;a++){var n={id:this.files[a][0],fileName:this.files[a][1]};r+=this.renderUploadItem(n)}return i=this.replaceFilesHtml(i,r)},renderElement:function(){return this._super("render-base")},postRender:function(){this._super(),this.isClicked=!1,this.properties.allowSendInMail&&this.bindEmailDialog(),this.checkMaxFiles(),this.preventDefaultForAnchorTag()},postRenderReadOnly:function(){this._super(),this.properties.allowSendInMail&&this.bindEmailDialog()},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},setValidationMessage:function(e){this._super(e);var t=$(".ui-bizagi-render-icon-error",this.element);$(t).parent().removeClass("ui-hidden")},bindEmailDialog:function(){var e=this.getControl(),t=this.getXpathContext()||"",i=this.properties.xpath,r="rtl"===this.properties.orientation?"dialog-send-email-rtl":"dialog-send-email";$(".ui-bizagi-render-upload-sendmail",e).bizagiSendEmail({tmpl:this.renderFactory.getTemplate(r),value:this.value,self:this,dataService:this.dataService,properties:this.properties,xpath:i,xpathContext:t})},bindExternalPopup:function(){var e=this,t=e.getControl(),i=e.getParams(),r=e.properties,a=!!e.grid,n={idCase:i.idCase||bizagi.context.idCase,idWorkitem:i.idWorkitem||bizagi.context.idWorkitem,field:r.xpath.split(".")[r.xpath.split(".").length-1]},o=e.getXpathContext(),s=r.xpath;a||""!==o?"string"==typeof o?$.extend(n,{xPath:o.split("[")[0]+"."+s}):$.extend(n,{xPath:e.grid.properties.xpath+"."+s}):$.extend(n,{xPath:s}),$(".ui-bizagi-render-upload-sendmail",t).tooltip(),$(".ui-bizagi-render-upload-sendmail",t).click((function(){var t="App/Upload/SendAttachedDocs.aspx?";t+="idCase="+n.idCase,t+="&idWorkitem="+n.idWorkitem,t+="&xPath="+n.xPath,t+="&field="+n.field,e.dataService.getCaseNumber({idCase:n.idCase}).done((function(i){var r=i.caseNumber;t+="&radNumber="+(r=r||n.idCase);var a=[];if(e.value)for(var o=0;o<e.value.length;o++)a.push(e.value[o][1]);e.currentPopup="genericiframe",$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:t,injectCss:[".ui-bizagi-old-render*",".ui-bizagi-old-render-upload"],modalParameters:{title:"Send attached documents",id:"sendEmail"},afterLoad:function(e){var t=document.getElementById("btnClose");if(t&&(t.style.display="none"),(t=document.getElementById("btnCloseConfirm"))&&(t.style.display="none"),e&&e.values){var i=e.values,r=document.getElementsByTagName("label");if(r)for(var a=0;a<r.length;a++){var n=r[a];void 0!==n.innerText&&-1===i.indexOf(n.innerText)&&(n.control?(n.control.checked=!1,n.parentElement.style.display="none"):(n.previousSibling.checked=!1,n.parentElement.style.display="none")),void 0!==n.textContent&&-1===i.indexOf(n.textContent)&&(n.control?(n.control.checked=!1,n.parentElement.style.display="none"):(n.previousSibling.checked=!1,n.parentElement.style.display="none"))}}},afterLoadParams:{values:a}})}))}))},configureHandlers:function(){var e=this,t=e.getControl(),i=e.properties;e._super(),e.pluginUpload=$(".ui-bizagi-render-upload-wrapper",t).bizagiUpload({renderReference:this,dialogTemplate:e.renderFactory.getTemplate("upload.dialog"),properties:{url:i.addUrl,xpath:this.getUploadXpath(),idRender:i.id,xpathContext:e.getUploadXpathContext(),idPageCache:i.idPageCache,idSession:i.sessionId,validExtensions:i.validExtensions,maxSize:i.maxSize,contexttype:i.contexttype,networkSpeed:networkSpeed()},onUploadFileCompletedCallback:e.onUploadFileCompleted,onChangeFile:e.onChangeFile,onCheckMaxSize:e.checkMaxSize,onValidate:e.validate,maxAllowedFiles:i.maxfiles,uploadedFiles:e.filesCount,dialogTitle:e.getResource("render-upload-link-label")}),t.off("click").on("click",".bz-file-name",(function(t){t.preventDefault();var i=$(this).closest(".ui-bizagi-render-upload-item");e.downloadFile(i.data())})),t.on("click",".bz-btn-icn--delete",(function(){var t=$(this).closest(".ui-bizagi-render-upload-item"),i=t.data();$.when(e.deleteUploadItem(t,i.id)).done((function(){t.hide(),t.remove(),e.checkMaxFiles(),e.setValue(e.files,!1),e.triggerRenderChange()}))}))},configureHandlersReadOnly:function(){var e=this;e.getControl().off("click").on("click",".bz-file-name",(function(t){var i=$(this).closest(".ui-bizagi-render-upload-item");e.downloadFile(i.data())}))},downloadFile:function(e){var t=this,i=t.properties;t.dataService.getFile({idRender:i.id,xpath:i.xpath,xpathContext:t.getXpathContext(),idPageCache:i.idPageCache,fileId:e.id,contexttype:i.contexttype}).then((function(e){return bizagi.util.handleJSONResponse(e)})).then((function(t){bizagi.util.downloadBlobFile(t,e.filename)})).fail((function(e){var i=t.getFormContainer();i&&i.failHandler(e)}))},openUploadDialog:function(){var e=this,t=e.properties,i=window.document;e.isClicked=!1;var r=e.dialogBox=$("<div class='ui-bizagi-component-loading'/>");r.empty(),r.appendTo("body",i);var a={};a[e.getResource("render-upload-dialog-select")]=function(t){t.stopPropagation(),e.isClicked||(e.isClicked=!0,e.checkMaxSize()&&e.checkFileTypes()&&!e.maxFilesLimit()?$.when(e.processUploadFile()).done((function(t){e.onUploadFileCompleted(t),e.closeUploadDialog()})):e.isClicked=!1)},a[e.getResource("text-cancel")]=function(){e.closeUploadDialog()},r.dialog({width:500,height:350,title:e.getResource("render-upload-link-label"),modal:!0,buttons:a,close:function(){e.closeUploadDialog()},resizeStop:function(t,i){e.form&&e.form.resize(i.size)}});var n=e.renderFactory.getTemplate("upload.dialog");$.tmpl(n,{url:t.addUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,idSession:t.sessionId,validExtensions:t.validExtensions.replace(";",","),maxSize:t.maxSize,contexttype:t.contexttype}).appendTo(r),$(".ui-bizagi-loading-message").remove()},processUploadFile:function(){var e=this,t=new $.Deferred,i=e.dialogBox,r=$("form",i),a=$("iframe",r);return function i(){try{var r="";if(a[0].contentWindow)r=(bizagi.util.isIE8()?$(a[0].contentWindow.document.body):$(a[0].contentWindow.eval("document.body"))).text();if(r.length>0)t.resolve(r);else var n=setTimeout((function(){i(),clearTimeout(n)}),50)}catch(t){e.closeUploadDialog(),window.alert("Error:"+t.toString())}}(),r.submit(),t.promise()},closeUploadDialog:function(){this.isClicked=!1,this.dialogBox.dialog("destroy"),this.dialogBox.remove()},maxFilesLimit:function(){return this.filesCount>=this.properties.maxfiles},checkMaxFiles:function(){this.properties;var e=this.getControl(),t=$(".ui-bizagi-render-upload-wrapper",e);this.maxFilesLimit()?(bizagi.util.cssExtended(t.find("a"),"display:none!important"),this.enabled=!1):(bizagi.util.cssExtended(t.find("a"),"display:block!important"),this.enabled=!0),0==this.filesCount?$(".no-files",e).css("display","block"):$(".no-files",e).hide()},onChangeFile:function(e){var t,i=0,r=this.properties.maxSize;if(e)for(t=e.length;i<t;)if(e[i++].size>r)return void(this.previousCheck=!1);this.previousCheck=!0},getDefaultValueAlign:function(){return""},onUploadFileCompleted:function(e,t){var i=e,r=i.getControl(),a=$(".ui-bizagi-render-upload-wrapper",r);t=t.replace(/<.+>({.*})\r?\n?.*<.+>/gm,"$1");try{var n=JSON.parse(t)}catch(e){var o=[{toFind:"Maximum request length",message:i.getResource("render-upload-alert-maxsize").replace("{0}",i.properties.maxSize)}];$.each(o,(function(e,i){t.indexOf(i.toFind)>=0&&!n&&(n={type:"error",message:i.message})})),n||(n={type:"error",message:"Error:"+n})}if("error"!=n.type){var s=i.renderUploadItem({id:n.id,fileName:n.fileName});$(s).insertBefore(a),i.processControlLayout(i.properties.valueFormat),i.filesCount=i.filesCount+1;var l=i.files.slice();l.push([n.id,n.fileName]),i.checkMaxFiles(),i.setValue(l,!1),i.triggerRenderChange(),void 0!==i.grid&&void 0!==i.grid.properties&&(i.grid.properties.canBeExported=!0)}else"Error:undefined"===n.message&&t.indexOf("HTTP Error 404.13")>-1&&(n.message=i.getResource("render-upload-iis-maxsize")),n.isMaintenanceWindow||bizagi.showMessageBox(n.message)},changeFontItalic:function(e,t){return this._super(e,t),e.hasClass("ui-bizagi-render-control")&&bizagi.util.parseBoolean(t)&&this.getElementsToStylize(control).css("padding","0 .1em"),this},getElementsToStylize:function(e){return $(".ui-bizagi-render-upload-item .bz-file-name, .no-files",e)},checkMaxSize:function(e){var t=e,i=t.properties,r=t.dialogBox,a=$("input[type=file]",r).get(0);return null!=a.files?a.files.length>0?0===a.files[0].size?(t.showError(t.getResource("render-upload-error-file-empty").replace("%s",a.files[0].name)),!1):!(a.files[0].size>i.maxSize)||(t.showError(t.getResource("render-upload-alert-maxsize").replace("{0}",i.maxSize)),!1):(t.showError(t.getResource("render-required-upload").replace("#label#","")),!1):!bizagi.util.isIE()||(""!==a.value&&a.value?!!t.previousCheck||(!(document.documentMode>9)||(t.showError(t.getResource("render-upload-alert-maxsize").replace("{0}",i.maxSize)),!1)):(t.showError(t.getResource("render-required-upload").replace("#label#","")),!1))},checkFileTypes:function(){var e=this.properties,t=this.dialogBox,i=$("input[type=file]",t).val();if(e.validExtensions&&e.validExtensions.length>0){var r=e.validExtensions.replaceAll("*.","").split(";");if(!this.stringEndsWithValidExtension(i,r,!0))return this.showError(this.getResource("render-upload-allowed-extensions")+e.validExtensions),!1}return!0},validate:function(e){var t=e,i=(t.properties,$("input[type=file]",t.dialogBox).get(0)||{});if(t.files)for(var r=0;r<t.files.length;r++){if(t.files[r][1].toUpperCase()==i.files[0].name.toUpperCase())return t.showError(t.getResource("render-upload-error-file-exists")),!1}return!0},stringEndsWithValidExtension:function(e,t,i){if(0==i&&0==e.length)return!0;for(var r=0;r<t.length;r++){if("*"==t[r].toLowerCase())return!0;if(e.toLowerCase().endsWith(t[r].toLowerCase()))return!0}return!1},showError:function(e){var t=$("#alert-file-upload",this.dialogBox);t.empty(),t.show(),t.html(e)},cleanData:function(){return this.setValue(null),$.when(this.clearDisplayValue())},clearDisplayValue:function(){var e=this,t=e.getControl().find(".ui-bizagi-render-upload-item"),i=[];return $.each(t,(function(t,r){var a=$(r),n=a.data();if(n){var o=$.when(e.deleteUploadItem(a,n.id)).done((function(){a.remove(),e.triggerRenderChange()}));i.push(o)}})),t.hide(),e.filesCount=0,e.checkMaxFiles(),$.when.apply($,i)},setDisplayValue:function(e){var t;this.properties.editable&&e&&0===e.length&&((t=this.getControl().find(".ui-bizagi-render-upload-item")).hide(),t.remove(),this.checkMaxFiles()),this._super(e)},getLabel:function(){return $("label",this._super())}}),$.Class.extend("bizagi.rendering.ecm",{},{initializeData:function(e){this._super(e);var t=this.properties;if(t.maxSize=Number(t.maxSize)||("undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):t.maxSize=Number(t.maxSize)||4091904),t.maxFiles=Number(t.maxfiles)||999,t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var i=t.validExtensions.split(";"),r=0;r<i.length;r++)i[r]="*."+i[r];t.validExtensions=i.join(";")}t.addUrl=this.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=uploadECMFile",t.editUrl=this.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=updateECMFileContent",t.deleteUrl=t.deleteUrl||void 0,t.allowDelete=null===bizagi.util.parseBoolean(t.allowDelete)||bizagi.util.parseBoolean(t.allowDelete),t.q_xpath=bizagi.util.encodeXpath(t.xpath),t.showMetadata=void 0===t.showMetadata||null===t.showMetadata||bizagi.util.parseBoolean(t.showMetadata);var a=this.getResource("dateFormat"),n=this.getResource("timeFormat");t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||a,t.timeFormat=t.timeFormat||n,t.fullFormat=t.dateFormat,this.files=t.value||[],this.filesCount=this.files.length,t.xpathContext=this.parent.properties.xpathContext||t.xpathContext||""},renderControl:function(e,t){var i=this,r=i.properties,a=i.renderFactory.getTemplate("ecm"),n=i.getMode(),o=new $.Deferred;r.value=t?[[t.idFileUpload,t.fileName]]:i.value;var s=$.fasttmpl(a,r,{getFileExtension:i.getFileExtension,isImage:i.isImage});if(null!=i.properties.value){var l=i.properties.value.length;0===l&&o.resolve(s),$.each(i.properties.value,(function(e,r){var a={};a.idFileUpload=r[0],a.fileName=r[1],a.idPageCache=i.properties.idPageCache,a.xpathContext=i.getXpathContext(),a.xPath=i.properties.xpath,a.editable=i.properties.editable,a.idAttrib=i.properties.idAttrib;var d=i.getFormContainer();d&&d.properties&&d.properties.sessionId&&(a.sessionId=d.properties.sessionId),"execution"===n&&$.when(i.renderFileLayout(a,t)).done((function(e){l--,bizagi.loader.productBuildToAbout&&0===bizagi.loader.productBuildToAbout.indexOf("10.4")&&(e=e.replaceAll("Handlers/MetadataFile","Handlers/Metadata")),s=i.replaceItemHtml(s,i.properties.id+"-"+a.idFileUpload,e),0===l&&o.resolve(s)}))}))}else o.resolve(s);return o.promise()},replaceItemHtml:function(e,t,i){return e.replace("{{"+t+"}}",i)},renderFileLayout:function(e,t){var i=this,r=i.getFormContainer(),a=i.renderFactory.getTemplate("ecm-metadata"),n=$.Deferred();return $.when(i.dataService.getECMMetadata(e),t?[t]:i.dataService.getFileProperties(e)).done((function(t,o){o[0].data=e,o[0].xpathContext=o[0].xpathContext||r.properties.xpathContext||"",o[0].xpath=i.properties.xpath,t[0].filename=e.fileName,t[0].url=i.buildItemUrl(o[0]),t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].ecm_isVisible=o[0].isVisible,t[0].ecm_allowUpdateMetadata=o[0].allowUpdateMetadata,t[0].ecm_allowDelete=o[0].allowDelete,t[0].ecm_allowUpdateContent=o[0].allowUpdateContent,t[0].ecm_allowView=o[0].allowView,t[0].ecm_allowCheckOut=o[0].allowCheckOut,t[0].ecm_allowCancelCheckOut=o[0].allowCancelCheckOut,t[0].ecm_allowEdit=e.editable&&o[0].allowEdit,t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].idFileUploads=o[0].idFileUpload,t[0].xpath=o[0].xpath,t[0].value=bizagi.util.parseBoolean(o[0].value),t[0].deviceType=bizagi.detectDevice();var s=$.fasttmpl(a,t[0]);n.resolve(s)})),n.promise()},isImage:function(e){var t=this.getFileExtension(e);return["JPG","JPEG","GIF","PNG","BMP"].indexOf(t.toUpperCase())>-1},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},renderReadOnly:function(){return this.renderControl()},canBeSent:function(){return!1},buildItemUrl:function(e){var t=bizagi.cookie("JSESSIONID");return e.data||(e.data={fileName:e.fileName,idAttrib:e.idAttrib}),this.dataService.getECMFileUrl({idFileUpload:e.idFileUpload,xPath:e.xpath||e.xPath,xpathContext:e.xpathContext,idAttrib:e.data.idAttrib,idPageCache:this.properties.idPageCache,fileName:e.data.fileName.replace(/ /g,"_"),p_sessionId:t,sessionId:e.data.sessionId||""})},buildAddParams:function(){var e=this.properties,t={};return t.xPath=e.xpath,t.idAttrib=e.idAttrib,t.xpathContext=e.xpathContext,t.metaValues=[],t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t},getFileExtension:function(e){return(e=e||"").split(".").pop()},setValue:function(e,t){var i=this.properties;this._super(e,t),this.files=i.value||[],this.filesCount=this.files.length?this.files.length:i.value},getXpathContext:function(){return this.properties.xpathContext||""},getUploadXpath:function(){return this.properties.xpath},deleteUploadItem:function(e,t){var i=this,r=i.properties,a={idFileUpload:t,xPath:r.xpath,idAttrib:r.idAttrib,idPageCache:r.idPageCache,xpathContext:i.getXpathContext()};return i.dataService.deleteECMFile(a).pipe((function(){i.filesCount=i.filesCount-1,i.files=$.grep(i.files,(function(e){return e[0]!=t}))}))},lockUploadItem:function(e){var t=this.properties,i={idFileUpload:e,xPath:t.xpath,idAttrib:t.idAttrib,idPageCache:t.idPageCache,xpathContext:this.getXpathContext()};return this.dataService.checkOutFile(i)},unlockUploadItem:function(e){var t=this.properties,i={idFileUpload:e,xPath:t.xpath,idAttrib:t.idAttrib,idPageCache:t.idPageCache,xpathContext:this.getXpathContext()};return this.dataService.cancelCheckOut(i)}}),$.Class.extend("bizagi.rendering.yesno",{},{initializeData:function(e){this._super(e);var t=this.properties;t.value=void 0!==t.value?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var e=this.renderFactory.getTemplate("yesno"),t=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(e,{id:t,editable:this.properties.editable})},getDisplayValue:function(){var e=this.getValue();return!0===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-no"):""},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmptyValue(e)&&null!==bizagi.util.parseBoolean(e)}}),$.Class.extend("bizagi.rendering.letter",{},{initializeData:function(e){this._super(e),this.letterOpened=!1},renderControl:function(){var e=this.renderFactory.getTemplate("letter");return $.fasttmpl(e)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("letter.readonly");return $.fasttmpl(e)},getLetterContent:function(){return this.letterOpened=!0,this.dataService.getLetterContent({url:this.properties.getUrl,idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache})},saveLetterContent:function(e){return this.dataService.saveLetterContent({url:this.properties.saveUrl,idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache,content:e})},getCanGenerateLetter:function(){return this.dataService.getCanGenerateLetter({idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache})},saveForm:function(){return this.getFormContainer().saveForm()},isValid:function(e){var t,i=this.properties;return 0==bizagi.util.parseBoolean(i.visible)||(0==bizagi.util.parseBoolean(i.editable)||(this.setValidationMessage(""),!i.required||0!=this.letterOpened||(t=this.getResource("render-letter-required-text").replaceAll("#label#",i.displayName),e.push({xpath:i.xpath,message:t}),!1)))},getXpath:function(){return this.properties.xpath},getContextXpath:function(){return this.properties.xpathContext}}),$.Class.extend("bizagi.rendering.formLink",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayType="value",t.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("formLink");return $.fasttmpl(t,{id:e.id,align:e.valueAlign,displayName:e.displayName,value:e.value,editable:e.editable,likeButton:bizagi.util.parseBoolean(e.likeButton)||!1})},renderReadOnly:function(){return this.renderControl()},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},submitEditRequest:function(){var e=this.properties;return e.editable||e.value?this.dataService.editLinkForm({url:e.editUrl,idRender:e.id,xpath:this.getFormLinkXpath(),xpathContext:e.xpathContext,idPageCache:e.idPageCache}):null},submitSaveRequest:function(e){var t=this,i=t.properties;if(!i.editable&&!i.value)return null;var r=t.getFormLinkXpath(),a=r;return void 0!==i.xpathContext&&""!==i.xpathContext&&(a=r?i.xpathContext+"."+r:i.xpathContext),t.dataService.saveLinkForm({url:i.saveUrl,idRender:i.id,xpathContext:a,submitData:e}).done((function(e){var i=!0;e&&"validationMessages"===e.type&&(i=!1),i&&t.submitOnChange({})}))},saveFormLinkData:function(e){var t=this.properties,i=this.getFormLinkXpath(),r=i;void 0!==t.xpathContext&&""!==t.xpathContext&&(r=i?t.xpathContext+"."+i:t.xpathContext);var a=$.extend({},e);return delete a.idPageCache,$.when(bizagi.util.isEmpty(a)?void 0:this.dataService.multiaction().submitData({action:"SAVE",data:a,idPageCache:e.idPageCache,xpathContext:r}))},submitRollbackRequest:function(e){var t=this,i=t.properties;return $.when(i.editable||i.value?t.dataService.rollbackLinkForm({url:i.rollbackUrl,idRender:i.id,xpath:t.getFormLinkXpath(),xpathContext:i.xpathContext,idPageCache:e?e.idPageCache:i.idPageCache}):null)},submitCommitRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.commitLinkForm({url:t.commitUrl,idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},submitCheckpointRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.sendCheckpoint({url:t.checkpointUrl,idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},submitDataRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.submitData({url:t.checkpointUrl,action:"SUBMITDATA",idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},isValid:function(e){},getFormLinkXpath:function(){return this.properties.xpath},canBeSent:function(){return!1},setDisplayValue:function(e){},cleanData:function(){}}),$.Class.extend("bizagi.rendering.document",{},{initializeData:function(e){this._super(e);var t=this.properties;t.validate=null!=bizagi.util.parseBoolean(t.validate)&&bizagi.util.parseBoolean(t.validate),t.downloadalldocuments=!!t.downloadalldocuments&&t.downloadalldocuments,t.allowGenerate=void 0===t.allowGenerate||t.allowGenerate,t.append=!!t.append&&t.append,t.caption?(t.caption=$.trim(t.caption),0===t.caption.length&&(t.caption=this.getResource("render-documentgenerator-button-label"))):t.caption=this.getResource("render-documentgenerator-button-label")},renderControl:function(){this.preRenderControl();var e=this.properties,t=this.getMode(),i=e.downloadalldocuments,r=e.allowGenerate,a=this.renderFactory.getTemplate(this.getTemplate()),n=e.value||[],o=!n||0===n.length,s=this.getControlHtml(a,t,i,r,e,o),l=this.renderDocumentsHtml(n);return l+=this.renderActionsHtml(n,o,i),s=this.replaceFilesHtml(s,l)},getControlHtml:function(e,t,i,r,a,n){return $.fasttmpl(e,{noActivateButton:!1,editable:"execution"!==t,mode:t,downloadalldocuments:i,required:a.required,allowgenerate:r,xpath:this.getXpath(a.xpath),append:a.append,caption:a.caption,noFiles:n,allowSendInMail:a.allowSendInMail})},getXpath:function(e){return e},preRenderControl:function(){},activateButton:function(){return!0},getDocumentXpath:function(e){return e},getContextXpath:function(){return this.properties.xpathContext},renderDocumentItem:function(e){var t=this.getMode(),i=this.renderFactory.getTemplate(this.getTemplateItem()),r=this.buildItemUrl(e);return"execution"!==t&&(r="javascript:void(0);"),$.fasttmpl(i,{url:r,allowDelete:this.properties.allowDelete,filename:e.fileName,id:e.id,mode:t,editable:this.properties.editable,joined:!1})},buildItemUrl:function(e){var t=this.properties;return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getDocumentXpath(t.xpath),xpathContext:this.getContextXpath(),idPageCache:t.idPageCache,fileId:e.id,sessionId:this.getSessionId()})},buildAllDocumentsUrl:function(){var e=this.properties;return this.dataService.getAllDocumentsDownloadUrl({xpath:this.getDocumentXpath(e.xpath),xpathContext:this.getContextXpath(),idPageCache:e.idPageCache,idCase:e.caseId,idWorkItem:e.workitemId,sessionId:this.getSessionId()})},postRender:function(){return this._super(),"<div></div>"},postRenderReadOnly:function(){if("design"!==this.getMode()){var e=this.getControl(),t=this.renderControl();e.append(t),this.updateControlForPrintMode(e),this.postRender()}},validateContainer:function(){return this.getFormContainer().validateForm()},save:function(){return this.getFormContainer().saveForm()},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},replaceActionsHtml:function(e,t){return e.replace("{{actions}}",t)},canBeSent:function(){return!1},isValid:function(e){var t,i=this.properties;return!1===bizagi.util.parseBoolean(i.visible)||(!1===bizagi.util.parseBoolean(i.editable)||(this.setValidationMessage(""),!(i.required&&!i.buttonExecuted&&this.value)||(this.value.length>0||(t=this.getResource("render-document-required-text"),e.push({xpath:i.xpath,message:t}),!1))))},configureHandlers:function(){var e=this;e._super();var t=$(".ui-bizagi-button-documentgenerator",e.getControl());e.isExecutionMode()&&(t.click((function(t){if(!t.isPropagationStopped()){if(t.stopPropagation(),e.properties.buttonExecuted=!0,e.properties.validate)e.validateContainer()&&e.documentTemplateGenerate();else e.documentTemplateGenerate();e.properties.buttonExecuted=!1}})),e.attachEvents())},configureHandlersReadOnly:function(){this.isExecutionMode()&&this.attachEvents()},attachEvents:function(){var e=this,t=e.getControl();$(".ui-bizagi-document-upload-item a > span",t).click((function(t){if(!t.isPropagationStopped()){t.stopPropagation();var i=$(this).closest(".ui-bizagi-document-upload-item").data();i.joined?e.downloadAllFiles({filename:"TemplatesConcatFilesToPDF.pdf"}):e.downloadFile(i)}})),$(".ui-bizagi-container-documents-item-delete",t).click((function(t){t.isPropagationStopped()||(t.stopPropagation(),e.deleteDocumentTemplate($(this).data("filename")))}))},deleteDocumentTemplate:function(e){var t=this,i={xpath:t.properties.xpath+"[fileName='"+e+"']",idRender:t.properties.id,xpathContext:t.getContextXpath(),idPageCache:t.properties.idPageCache};t.startLoading(),$.when(t.dataService.deleteUploadFile(i)).done((function(){$.when(t.dataService.multiaction().getPropertyData({xpath:t.properties.xpath,idRender:t.properties.id,xpathContext:t.getContextXpath(),idPageCache:t.properties.idPageCache,property:"value"})).done((function(e){t.resolveDeleteDocumentTemplate(e,!1,t.properties.downloadalldocuments),t.endLoading()}))}))},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath),e.save().done((function(){bizagi.showErrorAlertDialog=!1,$.when(e.dataService.generateDocumentTemplate(t)).done((function(){$.when(e.dataService.multiaction().getPropertyData({xpath:t.xpath,idRender:t.id,xpathContext:e.getContextXpath(),idPageCache:t.idPageCache,property:"value"})).done((function(i){e.resolveDocumentTemplateGenerate(i,!1,t.downloadalldocuments),e.endLoading()}))})).fail((function(t){e.endLoading(),e.showErrorMessage(t)}))})).fail((function(t){e.endLoading(),e.showErrorMessage(t)}))},showErrorMessage:function(e){var t=this.getFormContainer(),i=this.resources.getResource("render-upload-alert-maxsize").replace("{0}",BIZAGI_SETTINGS.UploadMaxFileSize);try{i=e&&void 0!==e.responseText?JSON.parse(e.responseText.replace(/(\r\n|\n|\r)/gm,"")).message:e}catch(e){}t.addErrorMessage(i),t.endLoading()},autoOpenDocuments:function(){},showDocumentPreview:function(e,t){},returnCssTypeFile:function(e){if(null==e||0===e.lenght)return"ui-bizagi-document-upload-item-generic-file";switch(e.substr(e.lastIndexOf(".")+1)){case"docx":return"ui-bizagi-document-upload-item-doc";case"pdf":return"ui-bizagi-document-upload-item-pdf";case"xlsx":return"ui-bizagi-document-upload-item-xls";default:return"ui-bizagi-document-upload-item-generic-file"}},redrawDocuments:function(e,t,i){var r=this.getControl(),a="",n=$("[data-component='files']",r);n.empty(),a+=this.renderDocumentsHtml(e),a+=this.renderActionsHtml(e,t,i),n.append(a),this.setValue(e)},renderAllDocumentDownload:function(e){var t=this.properties,i=this.getMode(),r=this.renderFactory.getTemplate(this.getTemplateItem()),a=this.buildAllDocumentsUrl();"execution"!==i&&(a="javascript:void(0);");var n=$.fasttmpl(r,{url:a,allowDelete:t.allowDelete,filename:e.fileName,mode:i,joined:!0});return this.removeDeleteButton(n)},removeDeleteButton:function(e){var t=e.indexOf('<span class="ui-bizagi-container-documents-item-delete');if(t>0){var i=e.substring(t),r=i.indexOf("</span>")+7;return e.substring(0,t)+i.substring(r)}return e},resolveDocumentTemplateGenerate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e,this.autoOpenDocuments(),this.configureHandlers()},resolveDeleteDocumentTemplate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e,this.configureHandlers()},renderDocumentsHtml:function(e){for(var t="",i=0;i<e.length;i++){var r={id:e[i][0],fileName:e[i][1]};t+=this.renderDocumentItem(r)}return t},renderActionsHtml:function(e,t,i){var r="";if(i&&!t&&e.length>0){var a={fileName:this.getResource("render-document-downloadalldocuments")};r+=this.renderAllDocumentDownload(a)}return r},getTemplate:function(){return"document"},getTemplateItem:function(){return"document-item"},getErrorTemplate:function(){return"form-error"},getTemplateDownload:function(){return"document-download"},getTemplateReadonly:function(){return"document-readonly"},getDocumentFile:function(e){var t=this.properties;return this.dataService.getFile({idRender:t.id,xpath:this.getDocumentXpath(t.xpath),xpathContext:this.getContextXpath(),idPageCache:t.idPageCache,fileId:e.id,contexttype:t.contexttype}).then((function(e){return bizagi.util.handleJSONResponse(e)}))},getAllDocumentFiles:function(){return this.dataService.getAllDocuments({xpath:this.getDocumentXpath(this.properties.xpath),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache,idCase:this.properties.caseId,idWorkItem:this.properties.workitemId}).then((function(e){return bizagi.util.handleJSONResponse(e)}))},downloadFile:function(e){var t=this;this.getDocumentFile(e).then((function(t){bizagi.util.downloadBlobFile(t,e.filename)})).fail((function(e){var i=t.getFormContainer();i&&i.failHandler(e)}))},downloadAllFiles:function(e){var t=this;this.getAllDocumentFiles().then((function(t){bizagi.util.downloadBlobFile(t,e.filename)})).fail((function(e){var i=t.getFormContainer();i&&i.failHandler(e)}))}}),$.Class.extend("bizagi.rendering.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{init:function(e){this._super(e),this.dependants=[],this.isDependant=!1},initializeData:function(e){this._super(e);var t=this.properties;t.hasLocalData=!!bizagi.util.isEmpty(t.parentCombo)&&t.hasLocalData,t.value&&void 0===t.value.id&&(t.value=null),this.value=t.value,t.hasLocalData&&(t.data=this.complementData(t.data))},renderControl:function(){var e=this.getMode(),t=this.parentCombo=this.getParentCombo();if(null!=t){var i=bizagi.util.normalizeType(t.properties.type);/^cascadingcombo$/i.test(i)&&(this.isDependant=!0)}this.initializingCascadingCombo=!0;var r=this._super();return"execution"!==e&&(this.initializingCascadingCombo=!1),r},configureHandlers:function(){this.initializingCascadingCombo=!1,this.isDependant&&this.parentCombo.bindDependantCombo(this)},configureHandlersReadOnly:function(){this.initializingCascadingCombo=!1,this.isDependant&&this.parentCombo.bindDependantCombo(this)},refresh:function(e,t){var i=this;$.when(i.isRendered()).done((function(){var r=i.getControl(),a=i.getMode();r.empty(),$.when(i.renderCombo(e)).then((function(e){r.html(e),i.postRender(),"execution"==a&&i.configureHandlers(),void 0!==i.getValue()&&i.setDisplayValue(i.getValue()),i.deferredVisible&&i.deferredVisible.resolve(),i.trigger("select",[i.value,t])}))}))},getData:function(e){if("execution"!=this.getMode())return this.getDummyData();if(this.isDependant){this.parentCombo&&e&&(this.properties.remoteDataLoaded=!1);var t=this.parentCombo.selectedValue?this.parentCombo.selectedValue.id:"";return""!=t?((e=e||{})[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]||(e[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t),this._super(e)):[]}return this._super(e)},bindDependantCombo:function(e){var t=this,i=bizagi.util.normalizeType(e.properties.type);/^cascadingcombo$/i.test(i)&&(t.dependants.push(e),e.onChangeFunction=function(i,r,a){t.refreshDependantCombo(e,r.id,t.focusDependant,a),a||e.cleanInput()},t.isEventBinded("select")||t.bind("select",e.onChangeFunction),bizagi.util.isEmpty(t.getValue())||t.properties.hasLocalData&&t.refreshDependantCombo(e,t.getValue().id))},isEventBinded:function(e){return void 0!==$._data(this.observableElement.get(0),"events")&&void 0!==$._data(this.observableElement.get(0),"events")[e]},unbindDependantCombo:function(e){this.unbind("select",e.onChangeFunction)},refreshDependantCombo:function(e,t,i,r){var a={};a[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t,e.deferredVisible=$.Deferred(),r||e.setValue("",!1),e.refresh(a,r),i&&$.when(e.deferredVisible.promise()).done((function(){e.inputCombo.trigger("click")}))},emptyControlByChangeEditability:function(){this.getControl().empty()},cleanInput:function(){this.triggerHandler("select",{id:0})},getParentCombo:function(){var e=this.properties;if(void 0===e.parentCombo)return null;for(var t=this.getFormContainer(),i=bizagi.util.normalizeType(this.properties.type),r=/^cascadingcombo$/i.test(i)?t.getRenderByType(e.type):[],a=0,n=0,o=[],s=null;a<r.length;a++)e.parentCombo===r[a].properties.id&&o.push({control:r[a],index:a});if(o.length>1){for(var l,d;n<o.length;n++)if(l=(d=o[n].control.properties.xpath.split(".")).length,d.slice(0,l-1).join(".")===e.xpath){s=r[o[n].index];break}}else s=t.getRenderById(e.parentCombo);return s},canBeSent:function(){return this._super()&&bizagi.util.isMapEmpty(this.dependants)},showCurrentData:function(){return"execution"!=this.getMode()},configureSubmitOnChange:function(){this.configured||(this._super(),this.configured=!0)},internalSubmitOnChange:function(e,t){var i=new $.Deferred;return this.isDependant&&this.canBeSent()&&void 0!==this.itemSelected?this._super(e,t):i.resolve()},internalSetInitialValue:function(){this._super(),this.value&&0==this.isDependant&&(this.internalSetInitialValueFlag=!0,this.trigger("select",[this.value,!0])),this.internalSetInitialValueFlag=!1}}),$.Class.extend("bizagi.rendering.list",{},{initializeData:function(e){this._super(e);var t=this.properties;t.listSize=t.listSize||0},getTemplateName:function(){return"list"},showCurrentData:function(){return!1}}),$.Class.extend("bizagi.rendering.multiSelect",{},{initializeData:function(e){this._super(e),Array.isArray(this.value)&&(this.value=this.properties.value=JSON.encode({value:this.value}),this.properties.originalValue=this.properties.previousValue=this.value);var t=this.properties;t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),t.enableTyping=null===bizagi.util.parseBoolean(t.enableTyping)||bizagi.util.parseBoolean(t.enableTyping),t.maxRecords=Number(t.maxRecords)||20},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("list-multiselect");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,align:e.valueAlign},{formatItem:this.formatItem})},renderReadOnly:function(){var e=this.properties,t=this.renderFactory.getTemplate("list-multiselect");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,align:e.valueAlign},{formatItem:this.formatItem})},getData:function(){var e=this,t=new $.Deferred,i=this.properties;return e.dataService.multiaction().getData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contexttype||null,idPageCache:i.idPageCache}).done((function(r){i.data=e.normalizeData(r),t.resolve(i.data)})).fail((function(i){var r=!0,a=e.getFormContainer();bizagi.util.isNativeMobileDevice()&&void 0!==a&&(r=a.allowOnlineActions()),"not-processed"===i.type&&r||t.reject(i)})),t.promise()},setValue:function(e,t){t=void 0===t||t,Array.isArray(e)&&(e=JSON.encode({value:e})),this._super(e,t)},setDisplayValue:function(e){this.setValue(e,!1)},canBeSent:function(){return!0},getValue:function(){return this.value||[]},getDataValue:function(){try{return JSON.parse(this.value).value||[]}catch(e){return[]}},hasValue:function(){var e=this.getDataValue();return e&&e.length>0},getElementsToStylize:function(e){return $(".bz-multiselect .bz-multiselect__tag:not(.bz-multiselect__plus)",e)},addElement:function(e){var t=this.getDataValue();t.push(e),this.setValue(t)},removeElement:function(e){var t=e.id,i=this.getDataValue().filter((function(e){return e.id!==t}));this.setValue(i)},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.submitOnChange(e)},markAsChecked:function(e){var t=this;return t.selected.some((function(i,r){var a=i.id===e;return a&&t.selected.splice(r,1),a}))},isChecked:function(e,t){return e.some((function(e){return e.id==t}))},canAddMoreItems:function(e){var t=this;return parseInt(e.css("width"))>e.children().toArray().reduce((function(e,i){return e+=t.getElementWidth(i)}),0)+t.Class.MORE_OPTION_WIDTH},getElementWidth:function(e){var t=window.getComputedStyle(e);return $(e).outerWidth()+["padding-left","padding-right","margin-left","margin-right"].reduce((function(e,i){return e+=parseInt(t[i])}),0)},filterList:function(e,t){t.filter((function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()})).show()},addSelectedElements:function(){},findItemById:function(e){return(this.properties.data||[]).find((function(t){return t.id==e}))},formatItem:function(e){return bizagi.util.formatItem(e)},normalizeData:function(e){return(e||[]).forEach((function(e){e.value=void 0!==e.value&&null!==e.value?e.value:""})),e}}),$.Class.extend("bizagi.rendering.searchList",{},{initializeData:function(e){this._super(e);var t=this.properties;t.maxRecords=Number(t.maxRecords)||20,t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),this.setValue(t.value)},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("searchList");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,value:e.value,allowTyping:e.allowTyping,items:e.value,hasSearchForm:!!e.searchForms,editable:e.editable},{formatItem:this.formatItem})},renderReadOnly:function(){return this.renderControl()},setValue:function(e){this.value=JSON.encode({value:e}),this.triggerRenderChange()},addElement:function(e){var t=JSON.parse(this.value);t.value.push(e),this.setValue(t.value)},removeElement:function(e){var t=JSON.parse(this.value),i=[];$.each(t.value,(function(t,r){r.id!=e.id&&i.push({id:r.id,value:r.value})})),this.setValue(i)},removeLastElement:function(){var e=JSON.parse(this.value);e.value.length>0&&(e.value.pop(),this.setValue(e.value))},getData:function(e){var t=this,i=t.properties,r=new $.Deferred;return t.dataService.getSearchData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.term,extra:e}).done((function(e){i.data=e,r.resolve(i.data)})).fail((function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)})),r.promise()},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.submitOnChange(e)},canBeSent:function(){return!0},hasValue:function(){return this.getListItems().length>0},getListItems:function(){var e=this.getValue();return("string"==typeof e?JSON.parse(e).value:e.value)||[]},formatItem:function(e){return bizagi.util.formatItem(e)}}),$.Class.extend("bizagi.rendering.handSignature",{},{BASE_IMAGE:"data:image/png;base64,",EMPTY_IMAGE:"R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",EMPTY_VALUE:"",DELAY_TO_SAVE:1e3,RESOURCES_FALLBACK:{DONE_BUTTON:"Done",EDIT_BUTTON:"Edit",CLEAR_BUTTON:"Clear",UPLOAD_SUCCESS:"Your signature have been uploaded successfully",UPLOAD_ERROR:"The signature have not been uploaded. Try again",TITLE_DONE:'Click "Done" to upload the signature',TITLE_DRAW:"Draw here your signature",TITLE_EDIT:'Click "Edit" to start drawing'},STATE_TYPE:{edit:1,draw:2,done:3,success:4,error:5},pluginInitialized:!1,saveDeferred:null,saveTimestamp:0,initializeData:function(e){this._super(e);var t=this.properties;t.editable=!0===bizagi.util.parseBoolean(t.editable),t.addUrl=t.addUrl||this.dataService.serviceLocator.getUrl("form-submit-data-upload"),t.deleteUrl=t.deleteUrl||this.dataService.serviceLocator.getUrl("render-upload-delete-url"),t.isChanged=!1,this.currentState=this.STATE_TYPE.edit},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("hand-signature");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,isDesign:!this.isExecutionMode(),render_signature_action_edit:this.getResourceByKey("render-signature-action-edit",this.RESOURCES_FALLBACK.EDIT_BUTTON),render_signature_action_done:this.getResourceByKey("render-signature-action-done",this.RESOURCES_FALLBACK.DONE_BUTTON),render_signature_action_clear:this.getResourceByKey("render-signature-action-clear",this.RESOURCES_FALLBACK.CLEAR_BUTTON)})},postRender:function(){var e=this;if(this.isExecutionMode()){var t=e.getSignatureContainer();e.setResizeObserver(t,(function(i){e.renderSignature(),e.setState(e.currentState),[e.STATE_TYPE.draw,e.STATE_TYPE.done].includes(e.currentState)&&t.BzjSignature("enable")}))}},postRenderReadOnly:function(){var e=this;if(this.isExecutionMode()){var t=e.getSignatureContainer();e.setResizeObserver(t,(function(){e.renderSignature()}))}},renderReadOnly:function(){var e=this.properties,t=this.renderFactory.getTemplate("hand-signature-readonly");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,isDesign:!this.isExecutionMode()})},setData:function(e){var t=this.getData();if(bizagi.util.isEmpty(e)?this.properties.binaryValue=null:e instanceof Blob?this.properties.binaryValue=e:this.properties.binaryValue=bizagi.util.b64toBlob(e,"image/png"),t!=this.properties.binaryValue){if(this.properties.required&&this.isExecutionMode()){var i=!this.checkRequired([]);this.changeRequiredLabel(i)}this.properties.isChanged&&(this.triggerRenderChange(),this.triggerRenderValidate())}},getData:function(){return this.properties.binaryValue||[]},getBase64:function(){return this.properties.base64||""},getValue:function(){return this.properties.value||[]},hasValue:function(){if(this.pluginInitialized){var e=this.getData();return!bizagi.util.isEmpty(e)}return!bizagi.util.isEmpty(this.properties.value)},isValid:function(e){if(!1===bizagi.util.parseBoolean(this.properties.visible))return!0;if(!1===bizagi.util.parseBoolean(this.properties.editable))return!0;if(this.setValidationMessage(""),this.properties.required&&!this.hasValue()){var t=this.getResource("render-required-text").replaceAll("#label#",this.properties.displayName);return e.push({xpath:this.properties.xpath,message:t}),!1}return!0},canBeSent:function(){return!this.getFormContainer().isOfflineForm||this.properties.isChanged},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},buildAddFileParams:function(e){var t=this.properties,i=this.Class.BA_CONTEXT_PARAMETER_PREFIX,r=new FormData,a=this.getFormContainer();r.append(i+"xpath",t.xpath),r.append(i+"idRender",t.id),r.append(i+"xpathContext",t.xpathContext),r.append(i+this.Class.BA_PAGE_CACHE,t.idPageCache),r.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",a.properties.sessionId),r.append(i+"action","savefile");var n="signature_"+bizagi.util.randomNumber()+".png";r.append(this.properties.xpath,e,n),t.contexttype&&r.append(i+"contexttype",t.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?r.append(BIZAGI_SESSION_NAME,a.properties.sessionId):r.append("JSESSIONID",a.properties.sessionId)}catch(e){r.append("JSESSIONID",a.properties.sessionId)}return r},buildItemUrl:function(){var e=this,t=e.getFormContainer(),i=e.properties,r=t.properties.compatibilityVersion>=2,a="";if(!this.isExecutionMode())return $.Deferred().resolve(a).promise();var n={url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,property:"fileFullContent",queue:"onlineimages",sessionId:t.properties.sessionId,contexttype:i.contexttype||void 0,dataType:"text"};return r?bizagi.util.isEmpty(e.properties.value)&&!e.hasValue()?$.Deferred().resolve("").promise():(n.property="fileBinaryContent",n.sessionId=t.properties.sessionId,e.dataService.downloadFile(n).then((function(t){return e.setData(t),null==t||window.Blob&&t instanceof Blob&&0===t.size?null:bizagi.util.blobTob64(t,!1)})).then((function(e){return bizagi.util.getDataUrl(e,i.url)}))):e.dataService.multiaction().getPropertyData(n,"text").then((function(t){return'"'===t.charAt(0)&&(t=t.slice(1,-1)),""!==t&&(a=e.BASE_IMAGE+t),e.setData(bizagi.util.b64toBlob(t)),a}))},executeFormFailHandler:function(e){var t=bizagi.util.getErrorFormatted(e),i=t;(void 0===t||t&&!t.message)&&(i=Object.assign({},"object"===_typeof(t)?t:{},{message:bizagi.localization.getResource("workportal-general-error")})),this.getFormContainer().failHandler(i)},saveSignature:function(e){var t=this,i=new $.Deferred,r=t.getFormContainer();return r.useOrSetLoaderDeferred(),r.appendWaitForLoader({promise:i.promise()}),$.when(t.postSignature(e)).then((function(e){t.setData(e),t.properties.url=bizagi.util.getDataUrl(e,t.EMPTY_VALUE),t.executePartialSaveForm(),i.resolve()})).fail((function(e){t.executeFormFailHandler(e),i.reject()}))},executePartialSaveForm:function(){var e={},t=this.getFormContainer();t.isOfflineForm&&(this.collectDataToSave(e),t.partialSubmitFormOffline(e).then((function(){})))},deleteImage:function(){return this.dataService.deleteImage({url:this.properties.deleteUrl,idRender:this.properties.id,xpath:this.properties.xpath,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,contexttype:this.properties.contexttype})},postSignature:function(e){var t=e.replace(/^data:image\/(png|jpg|jpeg);base64,/,"");return this.postSignatureOnline(t)},postSignatureOnline:function(e){var t=this,i=t.getDataFileFromSignature(e);return bizagi.util.isEmpty(i)?t.getData():t.processUploadFile(i).then((function(){return t.properties.isChanged=!0,e}))},emptyControlByAsyncRenderDeferred:function(){this.getControl().empty()},saveImageOffline:function(e){var t=this,i=t.buildOfflineImageId();return $.when(e).then((function(e){var r=t.getFormParams(),a={idCase:r.idCase,idWorkitem:r.idWorkitem,id:i,operationType:"edition",offlineType:r.offlineType};return t.dataService.saveOfflineImage(a,e)}))},collectDataToSave:function(e){if(this.isOfflineForm&&bizagi.util.isOfflineFormsV2Supported()){if(!this.properties.isChanged)return;e[this.properties.xpath]={offlineId:this.buildOfflineImageId(),name:this.dataService.fileService.getOfflineImageName(this.getValue()),isSignature:!0}}},collectData:function(e){var t=this;if(0!=t.saveTimestamp){var i=(new Date).getTime()-t.saveTimestamp;if(i<t.DELAY_TO_SAVE){var r=new $.Deferred;setTimeout((function(){$.when(t.saveDeferred).always((function(){r.resolve()}))}),t.DELAY_TO_SAVE+10-i),e.deferreds=e.deferreds||[],e.deferreds.push(r.promise())}else t.saveDeferred&&(e.deferreds=e.deferreds||[],e.deferreds.push(t.saveDeferred.promise()))}},buildItemUrlOffline:function(){var e=this,t=e.properties,i=e.getFormParams(),r=e.buildOfflineImageId(),a=!t.isChanged,n={idCase:i.idCase,idWorkitem:i.idWorkitem,id:r,offlineType:i.offlineType,loadImageFromForm:a};return $.when(e.dataService.getOfflineImage(n,bizagi.util.db.AttachmentType.Blob)).then((function(t){return e.setData(t),null==t||window.Blob&&t instanceof Blob&&0===t.size?null:bizagi.util.blobTob64(t,!1)})).then((function(e){return bizagi.util.getDataUrl(e,t.url)}))},setState:function(e){var t=$(".bz-actions",this.getControl()),i="";switch(this.currentState=e,e){case this.STATE_TYPE.edit:i=this.getResourceByKey("render-signature-title-edit",this.RESOURCES_FALLBACK.TITLE_EDIT);break;case this.STATE_TYPE.draw:i=this.getResourceByKey("render-signature-title-draw",this.RESOURCES_FALLBACK.TITLE_DRAW);break;case this.STATE_TYPE.done:i=this.getResourceByKey("render-signature-title-done",this.RESOURCES_FALLBACK.TITLE_DONE)}$(".bz-actions__status",t).text(i),this.setActions(e)},setActions:function(e){var t=$(".bz-actions",this.getControl());[this.STATE_TYPE.draw].includes(e)?(t.find("[data-action='edit']").addClass("bz-hidden"),t.find("[data-action='clear']").removeClass("bz-hidden"),t.find("[data-action='save']").removeClass("bz-hidden")):[this.STATE_TYPE.edit].includes(e)&&(t.find("[data-action='edit']").removeClass("bz-hidden"),t.find("[data-action='clear']").addClass("bz-hidden"),t.find("[data-action='save']").addClass("bz-hidden"))},buildOfflineImageId:function(){var e=this.getFormContainer(),t=e.properties.compatibilityVersion>=2,i=!e.properties.isTaskForm;return this.dataService.fileService.buildOfflineImageId(this.properties.value,this.properties.xpathContext,this.properties.xpath,t,i)},buildOfflineFileLoadingKey:function(){var e=this.getFormContainer(),t=e.getParams().idCase,i=e.getParams().idWorkitem,r=t;return bizagi.util.isEmpty(i)||(r+="-"+i),r+="-",bizagi.util.isEmpty(this.properties.xpathContext)||(r+="-"+this.properties.xpathContext),r+=this.properties.xpath},getDataFileFromSignature:function(e){try{var t=atob(e),i=bizagi.util.stringToByteArray(t);return new Blob([new Uint8Array(i)],{type:"image/png"})}catch(e){return""}},setSignature:function(e){var t=this.properties&&this.properties.url;try{bizagi.util.isEmpty(t)||(e.BzjSignature("reset"),e.BzjSignature("setData",t))}catch(e){}},setResizeObserver:function(e,t){var i=0;new ResizeObserver((function(e){var r=e[0];r.contentRect&&i!==r.contentRect.width&&0!==r.contentRect.width&&(i=r.contentRect.width,"function"==typeof t&&t())})).observe(e.get(0))},getSignatureContainer:function(e){var t=e||".bz-signature__container";return this.getSignatureContext(t)},getSignatureContext:function(e){var t=this.getControl();return $(e,t)},onSignatureClear:function(){},cleanData:function(){var e=this.getFormContainer(),t=this.onSignatureClear(this.getSignatureContainer());return e.useOrSetLoaderDeferred(),e.appendWaitForLoader({promise:t.promise()}),t}}),$.Class.extend("bizagi.rendering.money",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");if(t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol){var r="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol;t.symbol=t.currencySymbol?t.currencySymbol:r}else t.symbol="";t.groupDigits=!0}}),$.Class.extend("bizagi.rendering.radio",{},{initializeData:function(e){this._super(e);var t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1,t.unique=bizagi.util.randomNumber(1e3,1e6)},getTemplateName:function(){return"radio"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){var e=this.properties;return{vertical:!e.horizontal,horizontal:e.horizontal}},cleanData:function(){var e={id:"",label:""};this.element.find(".ui-radio-state-checked").removeClass("ui-radio-state-checked"),this.setDisplayValue(e),this.setValue(e,!1),this.clearDisplayValue()},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue;return t&&void 0!==t.length&&(t=t[0]),i&&void 0!==i.length&&(i=i[0]),r&&void 0!==r.length&&(r=r[0]),t=t&&void 0!==t.id?t.id:t,i=i&&void 0!==i.id?i.id:i,void 0!==(r=r&&void 0!==r.id?r.id:r)?(r!=t||t!=i)&&((null!==t&&""!==t||null!==i&&""!==i)&&i!=t):(null!==t&&""!==t||null!==i&&""!==i)&&i!=t},emptyControlByAsyncRenderDeferred:function(){this.getControl().empty()}}),$.Class.extend("bizagi.rendering.userfieldDefinition",{},{getFileDependencies:function(){return null},postRender:function(){var e=this;e._super();var t=$.Deferred(),i=e.getFileDependencies();return i&&i.length>0?bizagi.loader.loadFile(i).then((function(){e.internalRenderControl(),t.resolve()})):$.when(e.renderUserfieldControl()).done((function(){t.resolve()})),t.promise()},renderUserfieldControl:function(){var e=this,t=e.getControl(),i=e.properties,r=new $.Deferred;i.extendedData&&i.extendedData.length>0?e.extendedData=bizagi.services.ajax.parseJSON(i.extendedData):e.extendedData={};var a;return(a=e.getEditableControl())&&(e.input=t.html(a)),e.renderComplex(),r.resolve(),r.promise()},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.properties;i.extendedData&&i.extendedData.length>0?e.extendedData=bizagi.services.ajax.parseJSON(i.extendedData):e.extendedData={};var r=function(){try{var i=e.getReadonlyControl();i&&(e.input=t.html(i)),e.renderComplex()}catch(i){var r=e.properties.displayName||"Widget";t.html("<h6>"+r+"</h6>")}};e.ready?e.ready().done((function(){r()})):r()},getDisplayValue:function(){return this.getReadonlyValue()},setDisplayValue:function(e){this.setValue(e),this.setEditableValue(e)},getValue:function(){return this.getEditableValue()},getPropertyValue:function(e,t){var i=this,r=i.properties,a=new $.Deferred,n=i.getFormContainer();return n.useOrSetLoaderDeferred(),n.appendWaitForLoader({promise:a.promise()}),i.dataService.multiaction().getPropertyData({url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done((function(e){"error"==e.type?(i.getFormContainer().addErrorMessage(e.message),a.reject(e)):a.resolve(e)})).fail((function(e,t,i){a.reject(e,t,i)})),a.promise()},saveForm:function(){return this.getFormContainer().saveForm()},getRenderElements:function(e){var t=$(),i=this.getFormContainer().getRenders(e);return $.each(i,(function(e,i){t=t.add($(i.element))})),t},getServerResourceURL:function(e){var t="Rest/Userfields/{0}/resource/{1}/{2}";t=t.replace("{0}",this.properties.userfieldGuid),e=e.replace("\\","__").replace("/","__");var i=bizagi.util.detectDevice();return t=(t=t.replace("{1}",i)).replace("{2}",e)},getRenderValue:function(e){var t,i=this.getFormContainer().getRenders(e);return $.each(i,(function(e,i){t&&!i.properties.editable||(t=i)})),t?t.getValue():null},refreshForm:function(){var e=this.properties;this.getFormContainer().refreshForm(e.id)},showDialog:function(e,t){bizagi.util.mustImplement("Must implement the showDialog method")},showPopup:function(e,t){bizagi.util.mustImplement("Must implement the showPopup method")},updateOriginalValue:function(){this.properties.originalValue=this.value=this.properties.value}}),$.Class.extend("bizagi.rendering.basicUserField",{},{getEditableControl:function(){},renderComplex:function(){},getEditableValue:function(){return bizagi.rendering.render.prototype.getValue.apply(this,arguments)},setEditableValue:function(e){return bizagi.rendering.render.prototype.setValue.apply(this,arguments)},getReadonlyControl:function(){},getReadonlyValue:function(){return bizagi.rendering.render.prototype.getDisplayValue.apply(this,arguments)},dispose:function(){this._super()}}),$.Class.extend("bizagi.rendering.userfieldWrapper",{},{init:function(e){this._super(e),this.initialParams=e,this.userfieldGuid=this.properties.userfieldGuid,this.userfieldName=this.properties.control},startUserfieldLoading:function(){},endUserfieldLoading:function(){},internalPostRender:function(){var e=this;e.startUserfieldLoading(),$.when(e.getUserfieldControl()).done((function(t){return t.element=e.element,e.column&&(t.isColumn=!0,t.grid=e.grid,t.surrogateKey=e.surrogateKey,t.properties.xpathContext=e.getControlXpathContext(t),t.getControl=e.column.getControl),t.internalPostRender()})).always((function(){e.endUserfieldLoading()}))},getControlXpathContext:function(e){var t=e.properties;return e.isColumn?t.xpathContext.length>0?t.xpathContext+"."+e.grid.properties.xpath+"[id="+e.surrogateKey+"]":e.grid.properties.xpath+"[id="+e.surrogateKey+"]":t.xpathContext},getUserFieldInstance:function(e){console.log("not implemented")},replicateUserfieldMethods:function replicateUserfieldMethods(control){var self=this;for(var key in control.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"subscribe"!=key&&"unsubscribe"!=key&&"publish"!=key&&"render"!=key&&"triggerHandler"!=key&&"dispose"!=key&&(self[key]=eval("var tmp = function(){ if (this.userfieldInstance) return this.userfieldInstance."+key+".apply(this.userfieldInstance, arguments); return null;};tmp"));control.properties=self.properties,control.value=self.value},dispose:function(){var e=this,t=setTimeout((function(){e.userfieldInstance&&(e.userfieldInstance.unbind("renderchange"),e.userfieldInstance.dispose()),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()}}),$.Class.extend("bizagi.rendering.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{BASE_IMAGE:"data:image/png;base64,",initializeData:function(e){this._super(e);var t=this.properties,i=4091904;if(t.maxSize?i=Number(t.maxSize):"undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize&&(i=Number(BIZAGI_SETTINGS.UploadMaxFileSize)),t.maxSize=i,t.editable=!0===bizagi.util.parseBoolean(t.editable),t.validExtensions=t.validExtensions||"",t.isChanged=!1,t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var r=t.validExtensions.replace(/\ /gi,"").split(";"),a=0;a<r.length;a++)if(0!=r[a].length)r[a]="*."+r[a].replaceAll(" ","");else{r.indexOf(r[a]);r.splice(a,1)}t.validExtensions=r.join(";")}t.addUrl=t.addUrl||this.dataService.getUploadAddFileUrl(t.isUserPreference),t.allowDelete=null!==bizagi.util.parseBoolean(t.allowDelete),this.formCompatibilityVersion=this.getFormContainer().compatibilityVersion,this.initializeWidthAndHeight()},initializeWidthAndHeight:function(){var e=this.properties;e.isAutoWidth=!1,e.isAutoHeight=!1,-1===e.width?(e.width="100%",e.isAutoWidth=!0):e.width=e.width+"px",-1===e.height?(e.height="auto",e.isAutoHeight=!0):e.height=e.height+"px"},setData:function(e){var t=this.getData();if(bizagi.util.isEmpty(e)?this.properties.binaryValue=null:this.properties.binaryValue=e instanceof Blob?e:bizagi.util.b64toBlob(e,"image/png"),t!=this.properties.binaryValue){if(this.properties.required&&this.isExecutionMode()){var i=!this.checkRequired([]);this.changeRequiredLabel(i)}this.properties.isChanged&&(this.triggerRenderChange(),this.triggerRenderValidate())}},getData:function(){return this.properties.binaryValue||[]},renderControl:function(){var e=this,t=e.renderFactory.getTemplate("image");return e.buildItemUrl().then((function(i){if(!e.isDisposed())return e.properties.url=""!==i?i:"",bizagi.util.isEmpty(e.properties.url)?e.properties.value=[]:e.formCompatibilityVersion<2&&(e.properties.value=[[0,"uploaded"]]),e.setValue(e.properties.value),$.fasttmpl(t,{url:e.properties.url})}))},renderReadOnly:function(){var e=this.renderFactory.getTemplate("image-readonly");return $.fasttmpl(e)},getTemplateItem:function(){return this.renderFactory.getTemplate("image-item")},renderUploadItem:function(){var e=this,t=e.getMode(),i=e.getTemplateItem();return e.buildItemUrl().then((function(r){var a=r||"",n=$.fasttmpl(i,{url:a,allowDelete:e.properties.allowDelete,editable:e.properties.editable,mode:t});return e.properties.url=a,n}))},buildItemUrl:function(e){var t=this,i=t.getFormContainer(),r=t.properties,a=i.properties.compatibilityVersion>=2,n="";if(!this.isExecutionMode())return $.Deferred().resolve("").promise();var o={url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,contexttype:r.contexttype,property:e&&e.property?e.property:"fileContent",dataType:"text"};if(r.isUserPreference&&(t.currentUser=bizagi.currentUser.idUser,o.xpathContext="@Context.Users[id == "+t.currentUser+"]",o.contexttype="entity",o.surrogatekey=t.currentUser),a){if(bizagi.util.isEmpty(t.properties.value)&&!t.hasValue())return $.Deferred().resolve("").promise();if(!t.properties.forceBase64)return o.sessionId=i.properties.sessionId,o.property="fileBinaryContent",t.dataService.downloadFile(o).then((function(e){return t.setData(e),null==e||window.Blob&&e instanceof Blob&&0===e.size?null:bizagi.util.blobTob64(e,!1)})).then((function(e){return bizagi.util.getDataUrl(e,r.url)}))}return t.dataService.multiaction().getPropertyData(o,"text").then((function(e){return'"'===e.charAt(0)&&(e=e.slice(1,-1)),""!==e&&(n=t.BASE_IMAGE+e),t.setData(bizagi.util.b64toBlob(e)),n}))},buildItemUrlOffline:function(){var e=this,t=e.properties,i=e.getFormParams(),r=!t.isChanged,a=e.buildOfflineImageId(),n={idCase:i.idCase,idWorkitem:i.idWorkitem,id:a,offlineType:i.offlineType,loadImageFromForm:r};return $.when(e.dataService.getOfflineImage(n,bizagi.util.db.AttachmentType.Blob)).then((function(t){return e.setData(t),null==t||window.Blob&&t instanceof Blob&&0===t.size?null:bizagi.util.blobTob64(t,!1)})).then((function(e){return bizagi.util.getDataUrl(e,t.url)}))},saveImageOffline:function(e){var t=this,i=t.buildOfflineImageId(),r=void 0!==t.fileProperties?t.fileProperties.name:e.name;return t.dataService.getFileService().resolveBlobFromPath(e,r).then((function(e){var r=t.getFormParams(),a={idCase:r.idCase,idWorkitem:r.idWorkitem,id:i,operationType:"edition",offlineType:r.offlineType};return t.dataService.saveOfflineImage(a,e)}))},buildFullItemUrl:function(){return this.buildItemUrl({property:"fileFullContent"})},canBeSent:function(){return this.properties.isChanged},getValue:function(){return this.properties.value||[]},isValid:function(e){if(!1===bizagi.util.parseBoolean(this.properties.visible))return!0;if(!1===bizagi.util.parseBoolean(this.properties.editable))return!0;if((this.setValidationMessage(""),this.properties.required)&&(!(this.grid&&this.grid.isFromCreatedRow.apply(this))&&!this.hasValue())){var t=this.getResource("render-required-text").replaceAll("#label#",this.properties.displayName);return e.push({xpath:this.properties.xpath,message:t}),!1}return!0},buildAddParams:function(){var e=this.properties,t=this.getFormContainer(),i={};i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=this.getUploadXpath(),i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.id,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=t.properties.sessionId,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="savefile",e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?i[BIZAGI_SESSION_NAME]=t.properties.sessionId:i.JSESSIONID=t.properties.sessionId}catch(e){i.JSESSIONID=t.properties.sessionId}return i},getUploadXpath:function(){return this.properties.xpath},emptyControlByAsyncRenderDeferred:function(){this.getControl().empty()},buildOfflineImageId:function(){var e=this.getFormContainer().properties.compatibilityVersion>=2;return this.dataService.fileService.buildOfflineImageId(this.properties.value,this.properties.xpathContext,this.properties.xpath,e)}}),bizagi.rendering.element.extend("bizagi.rendering.columns.column",{},{init:function(e){this._super(e),this.originalProperties=JSON.parse(JSON.encode(this.properties)),this.decoratedClass=e.decorated,this.data=e.data,e.singleInstance?(this.decorated=new this.decoratedClass({data:this.data,parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService}),this.decorated.getControl=this.getControl,e.decorated=this.decorated,this.decorated.properties.isColumn=!0):this.decorateRenders=[],this.grid=e.parent;var t=this.properties;t.columnVisible=null==bizagi.util.parseBoolean(t.columnVisible)||bizagi.util.parseBoolean(t.columnVisible),t.align=t.align||"center",t.textFormat=t.textFormat||{},t.submitOnChange=void 0!==t.submitOnChange&&bizagi.util.parseBoolean(t.submitOnChange),t.singleInstance=e.singleInstance,t.editable=void 0===t.editable||bizagi.util.parseBoolean(t.editable),t.visible=void 0===t.visible||bizagi.util.parseBoolean(t.visible),t.required=void 0!==t.required&&bizagi.util.parseBoolean(t.required),t.showColumn=void 0===t.showColumn||bizagi.util.parseBoolean(t.showColumn),t.isSortable=void 0===t.isSortable||bizagi.util.parseBoolean(t.isSortable);try{e.parent&&"boolean"==typeof e.parent.properties.editable&&!e.parent.properties.editable&&(t.editable=!1)}catch(e){}this.readonly=void 0!==t.readonly&&t.readonly,this.readonly&&(t.editable=required=!1)},isReadonly:function(){return!1},getControl:function(){return $(".ui-bizagi-render-control",this.element||this.observableElement)},getDecorated:function(e){if(this.properties.singleInstance)return this.decorated;var t=this.decorateRenders[e];if(null==t){"object"!=_typeof(this.decorateRenders)&&(this.decorateRenders=[]);var i=new this.decoratedClass({data:bizagi.clone(this.data),parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService});t=i,this.decorateRenders[e]=i,t.surrogateKey=e,this.applyOverrides(t);var r=bizagi.util.normalizeType(t.properties.type);"summary"!==e||/columnMoney/i.test(r)||/columnNumber/i.test(r)||(t.setDisplayValue=function(e){this.getControl().html(e)})}return t},ready:function(){return this.readyDeferred.promise()},initialize:function(){},canBeSent:function(e,t){var i=this.getDecorated(e);return t&&(i.properties.visible=t.visible,i.properties.editable=t.editable),i.canBeSent()||!this.properties.editable&&this.hasChanged()||!i.properties.editable&&this.hasChanged()},isValueValid:function(e,t,i,r){var a=this.getDecorated(e),n=[];return r.visible&&(this.setValue(e,t),a.properties=$.extend(a.properties,r),this.grid&&void 0===a.grid&&(a.grid=this.grid),a.isValid(n)),!(n.length>0)||($.each(n,(function(e,t){i.push(t.message)})),!1)},applyOverrides:function(e){},render:function(e,t){try{var i=this,r=i.properties,a=i.getDecorated(e);if(a.grid=i.grid,a.column=this,a.surrogateKey=e,i.setValue(e,t),i.overrideDecoratedRenderProperties(e),i.changed=!1,!r.editable&&"CALLER_RENDER_READ_ONLY_COLUMNSLINK"!==arguments[3])return i.renderReadOnly.apply(i,arguments);i.readyDeferred=new $.Deferred;var n=a.render("cell");return a.bind("renderchange",(function(){i.changed=!0})),i.bind("rendered",(function(){i.readyDeferred.resolve()})),n}catch(e){return console.log(e),""}},postRender:function(e,t){this.getDecorated(e).postRenderElement(t)},renderReadOnly:function(e,t){var i=this,r=i.getDecorated(e);r.grid=i.grid,r.column=this,r.surrogateKey=e,i.setValue(e,t),i.overrideDecoratedRenderProperties(e),r.properties.editable=!1,i.readyDeferred=new $.Deferred;var a=r.render("cell.readonly");return i.bind("rendered",(function(){i.readyDeferred.resolve()})),a},renderSummary:function(e,t){var i=this.renderFactory.getTemplate("cell.summary");return $.tmpl(i).html()},postRenderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties.editable;i.properties.editable=!1,this.properties.singleInstance&&(i.element=t),i.postRenderElement(t),i.properties.editable=r},postRenderSummary:function(){return!1},getCell:function(){return this.decorated.getDisplayValue()},setSurrogateKey:function(e){this.surrogateKey=e},setValue:function(e,t){var i=this.getDecorated(e);"undefined"!=i&&null!=i&&(i.properties.originalValue=t,i.properties.previousValue=t,"summary"==e||null!=t||void 0===this.properties.defaultvalue&&void 0===this.properties.defaultValue||null==i.grid||(t=this.setDefaultValue(e,i)),i.properties.value=t,i.setValue(t,!1))},setDefaultValue:function(e,t){var i=void 0;return null!==this.properties.defaultvalue&&void 0!==this.properties.defaultvalue?i=this.properties.defaultvalue:null!==this.properties.defaultValue&&void 0!==this.properties.defaultValue&&(i=this.properties.defaultValue),t.grid.changes[e]=t.grid.changes[e]||{},t.grid.changes[e][this.properties.xpath]=i,i},getValue:function(e){return this.getDecorated(e).getValue()},getCompositeValue:function(e){return this.getValue(e)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_COLUMN},hasChanged:function(){return this.changed},trigger:function(e,t){this.decorated&&this.decorated.trigger(e,t)},triggerHandler:function(e,t){this.decorated&&this.decorated.triggerHandler(e,t)},bind:function(e,t){this.decorated&&this.decorated.bind(e,t)},unbind:function(e,t){this.decorated&&this.decorated.unbind(e,t)},overrideDecoratedRenderProperties:function(e){var t=this.getDecorated(e);t.properties.editable=this.properties.editable,t.properties.visible=this.properties.visible,t.properties.required=this.properties.required},overrideProperties:function(e){this.properties.editable=e.editable||this.properties.editable,this.properties.visible=e.visible||this.properties.visible,this.properties.required=e.required||this.properties.required},getSortName:function(){var e=this.getAnyDecoratedInstance();return e&&e.getSortColumn?e.getSortColumn():this.properties.xpath},getAnyDecoratedInstance:function(){var e;for(e in this.decorateRenders)break;return e?this.decorateRenders[e]:null},dispose:function(){var e=this,t=setTimeout((function(){e.decorated&&(e.decorated.unbind("renderchange"),e.decorated.dispose()),e.decorateRenders&&bizagi.util.arrayEach(e.decorateRenders,(function(e,t){t&&(t.unbind("renderchange"),t.dispose())})),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()}}),$.Class.extend("bizagi.rendering.columns.readonly",{},{init:function(e){this._super(e),this.properties.editable=required=!1},isReadonly:function(){return!0},isValueValid:function(){return!0}}),$.Class.extend("bizagi.rendering.columns.document",{},{}),$.Class.extend("bizagi.rendering.columns.letter",{},{}),bizagi.rendering.columns.column.extend("bizagi.rendering.desktop.columns.column",{},{applyOverrides:function(e){e&&(e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl),e.getFormattingLabel=function(e){return this.getControl()})},getControl:function(){var e=this._super();return e&&0!=e.length||(e=$(".ui-bizagi-cell-readonly",this.element||this.observableElement)),e},postRenderReadOnly:function(e,t){var i=this.properties;if(this._super(e,t),t&&t.length>0){var r=$(".ui-bizagi-cell-icon",t);i.editable||r.remove(),this.applyColumnStyles(t),"left"==i.align&&r.addClass("ui-bizagi-cell-icon-right")}},applyColumnStyles:function(e){var t=this.properties;t.textFormat.background&&(e.css("background-color",t.textFormat.background),e.css("background-image","none"))}}),$.Class.extend("bizagi.rendering.columns.combo",{},{init:function(e){this._super(e);var t=this.properties;t.recalculate=bizagi.util.parseBoolean(t.recalculate)||!1,bizagi.util.isOfflineForm({context:this})&&(t.recalculate=!1)},applyOverrides:function(e){var t=this.properties;this._super(e),t.recalculate||(e.originalGetData=e.getData,e.getData=this.getDataForAllCells,e.findDataById=this.findDataById)},findDataById:function(e){var t={};return this.column&&this.column.comboData&&$.each(this.column.comboData,(function(i,r){r.id==e&&(t=r)})),t},getDataForAllCells:function(e){var t=this.column;return t.comboData?t.comboData:t.fetchingData?t.dataPromise:(t.fetchingData=!0,t.dataPromise=$.when(this.originalGetData(e)).pipe((function(e){return t.comboData=e,t.fetchingData=!1,e})),t.dataPromise)},setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if("summary"==e)return this._super(e,t);if(t&&bizagi.util.isString(t))this._super(e,t);else if(t&&t.length>0){var r={id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!=t})):t[0][1]};this._super(e,r),i.selectedValue=r.value}else t&&t.id&&t.value?(this._super(e,t),i.selectedValue=t.value):"columnRadio"==this.properties.type?(this._super(e,null),i.selectedValue=t):t&&"number"==typeof t?this._super(e,t):(this._super(e,null),i.selectedValue="")}},setDefaultValue:function(e,t){var i=this.properties.defaultValue[0];return t.grid.changes[e]=t.grid.changes[e]||{},t.grid.changes[e][this.properties.xpath]=i.id,i},getCompositeValue:function(e){var t=this.getDecorated(e),i=t.getValue(),r=t.getSelectedValue(),a=[];return i&&(i.id>0||bizagi.util.isString(i.id))?(a.push([]),a[0].push(i.id),a[0].push(r)):a.push([]),a},getValue:function(e){var t=this.getDecorated(e).getValue();return t?t.id:t},render:function(e,t,i){var r=this.getDecorated(e),a=this.properties;a.recalculate&&r.resetData();var n=a.xpathContext.length>0?a.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return r.properties.xpathContext=n,this._super(e,t,i)},renderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties,a=r.xpathContext.length>0?r.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return i.properties.xpathContext=a,this._super(e,t)}}),$.Class.extend("bizagi.rendering.columns.search",{},{init:function(e){this._super(e)},applyOverrides:function(e){var t;this._super(e),t=this.properties.xpathContext.length>0?this.properties.xpathContext+"."+this.grid.properties.xpath+"[id="+e.surrogateKey+"]":this.grid.properties.xpath+"[id="+e.surrogateKey+"]",e.properties.xpathContext=t},render:function(e,t,i){var r=this.getDecorated(e);return this.properties.recalculate&&r.resetData(),this._super(e,t,i)},getValue:function(e){return this.getDecorated(e).getValue()},setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if("summary"==e)return this._super(e,t);var r=this.getCompositeValue(e);if(r&&void 0!==r.id&&r.id==t&&(t=r),t&&t.length>0){var a={id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!=t})):t[0][1]};this._super(e,a),i.selectedValue=a.value}else t&&t.id&&t.value?(this._super(e,t),i.selectedValue=t.value):t&&t.id&&t.label?(this._super(e,t),i.selectedValue=t.label):(this._super(e,t),i.selectedValue="")}}}),$.Class.extend("bizagi.rendering.columns.date",{},{setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if(this._super(e,t),null==t&&void 0!==this.properties.defaultvalue&&(t=this.setDefaultValue(e,i)),"summary"===e)return this._super(e,t);null==t&&(i.setValue(t,!1),i.properties.displayValue="");var r=bizagi.util.dateFormatter.getDateFromInvariant(t,i.properties.showTime);if(0===r&&(r=bizagi.util.dateFormatter.getDateFromInvariant(t,!i.properties.showTime)),0!==r){var a=bizagi.localization.getResource("datePickerRegional"),n=bizagi.util.dateFormatter.formatDate(r,i.properties.fullFormat,a);i.properties.displayValue=n,i.setValue(t,!1)}}},setDefaultValue:function(e,t){var i=this.properties.defaultvalue;return t.grid.changes[e]=t.grid.changes[e]||{},i=bizagi.util.dateFormatter.getDateFromInvariant(i,t.properties.showTime||!1),i=bizagi.util.dateFormatter.formatInvariant(i,!0),t.grid.changes[e][this.properties.xpath]=i,i}}),$.Class.extend("bizagi.rendering.columns.hidden",{},{canBeSent:function(){return!0}}),$.Class.extend("bizagi.rendering.dialog.form",{POPUP_WIDTH:768,POPUP_HEIGHT:550},{init:function(e,t,i){var r=this,a=window.document;for(var n in r.buttons={},i.extraButtons)r.buttons[bizagi.localization.getResource(n)]=i.extraButtons[n];this.dataService=e,this.renderFactory=t,this.dialogDeferred=new $.Deferred,i=r.dialogParams=i||{},r.dialogBox=$("<div class='ui-bizagi-component-loading'/>"),r.dialogBox.empty(),r.dialogBox.appendTo("body",a),r.showDialogBox(r.dialogBox,i).done((function(e){r.dialogDeferred.resolve(e)})).fail((function(){r.dialogDeferred.reject({idPageCache:r.form.getPageCache()})}))},render:function(e){return this.renderDialogBox(this.dialogBox,e),this.dialogDeferred.promise()},showDialogBox:function(e,t,i){var r=this,a=(r.dialogParams.orientation,{}),n=new $.Deferred,o=null===bizagi.util.parseBoolean(t.showSaveButton)||bizagi.util.parseBoolean(t.showSaveButton),s=null===bizagi.util.parseBoolean(t.showCancelButton)||bizagi.util.parseBoolean(t.showCancelButton),l=t.saveButtonLabel?t.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"),d=t.cancelButtonLabel?t.cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-cancel"),u=null!==bizagi.util.parseBoolean(t.maximized)&&bizagi.util.parseBoolean(t.maximized),c=function(e){if(!!r.dialogParams.isPlanForm||r.form.validateForm()){var i={};t.forceCollectData?($.forceCollectData=!0,r.form.collectRenderValues(i),$.forceCollectData=!1):r.form.collectRenderValues(i),t.allowGetOriginalFormValues&&(i.formValues=r.form.children),i.idPageCache=r.form.getPageCache(),t.onSave&&!$(e.currentTarget).prop("disabled")?($(e.currentTarget).prop("disabled",!0),$(e.currentTarget).button("disable"),$.when(t.onSave(i)).done((function(t){$(e.currentTarget).prop("disabled",!1),$(e.currentTarget).button("enable"),null==t||1==t||"success"==t.type?(n.resolve(i),r.closeDialogBox()):["validationMessages","alertMessages"].includes(t.type)?("validationMessages"===t.type?r.form.addValidationMessage(t.messages):bizagi.modalError.show(t.messages,"workportal-general-word-information",!1),$.each(i,(function(e,t){var i=r.form.getRenders(e);$.each(i,(function(e,t){t.updateOriginalValue()}))}))):"error"===t.type&&r.form.addErrorMessage(t.message)})).fail((function(){$(e.currentTarget).prop("disabled",!1),$(e.currentTarget).button("enable")}))):(n.resolve(),r.closeDialogBox())}};if(o&&(a[l]=function(e){if(r.form){var t=r.form,i=$.Deferred(),a=t.getRenderByType("tabItem"),n=a.length;t.innerTabsLoading=!0,$(e.currentTarget).prop("disabled",!0),t.useOrSetLoaderDeferred();for(var o=0;o<n;o++){var s=a[o];s.loadingDeferred&&s.parent.container&&s.loadingDeferred.resolve()}delete t.innerTabsLoading,i.resolve({event:e}),$.when(i.promise(),t.getLoaderPromise()).done((function(e){var i=e.event;$(i.currentTarget).prop("disabled",!1),t.deleteLoaderDeferred(),c(i)})).fail((function(){$(e.currentTarget).prop("disabled",!1),t.deleteLoaderDeferred(),c(e)}))}}),s&&(a[d]=function(){t.onCancel&&t.onCancel(),n.reject(),r.closeDialogBox()}),r.buttons=$.extend(a,r.buttons),"rtl"==r.dialogParams.orientation){var p,h;for(var g in a){p=a[g],h=g;break}delete a[h],a[h]=p}return e.dialog({width:this.Class.POPUP_WIDTH,height:this.Class.POPUP_HEIGHT,title:t.title,modal:!0,buttons:r.buttons,resizable:!1,maximized:u,open:function(e,t){u&&"undefined"==typeof isWebpart&&$("body",window.document).css("position","fixed"),(bizagi.util.isSharepointContext()||bizagi.util.isWebpartContext())&&$(document).trigger("hide-webpart-scroll")},close:function(){$("body",window.document).css("position","static"),t.onCancel&&t.onCancel(),n.reject(),r.closeDialogBox()},resizeStop:function(e,t){r.form&&r.form.resize(t.size)},maximize:function(e){r.form&&(r.form.triggerHandler("maximazedForm"),r.dialogBox.trigger("resize"))},unmaximize:function(e){r.form&&(r.form.triggerHandler("unmaximazedForm"),r.dialogBox.trigger("resize"))}}),r.adjustOverlay(),n.promise()},_appresize:function(e){$(this.dialogBox).dialog("widget").css({left:window.screen.width/2-this.Class.POPUP_WIDTH/2+"px",top:window.screen.height/2-this.Class.POPUP_HEIGHT/2+"px",width:this.Class.POPUP_WIDTH+"px",height:this.Class.POPUP_HEIGHT+"px"}).show()},closeDialogBox:function(){var e=this.dialogBox;$("body",window.document).css("position","static"),(bizagi.util.isSharepointContext()||bizagi.util.isWebpartContext())&&$(document).trigger("show-webpart-scroll"),e.dialog("destroy"),e.remove(),this.dispose()},focusFirstControl:function(e,t){var i=this,r=function(){var t=$("input:visible, select:visible, option:visible, textarea:visible",e.container).not(".bz-input-icon--date .bz-input-icon__input, .ui-bizagi-render-search");if(t.length>0){var r=$(t[0]).closest(".ui-bizagi-render"),a=r.length>0?r.data("render-xpath"):"",n=a?e.getRender(a):"";if(n&&n.properties&&n.properties.retype&&"double"===n.properties.retype)return;var o=t[0];if(i.isValidControlForFocus(o,e))try{o.focus(),$(o).triggerHandler("focusInput")}catch(e){}}else{(o=$(".ui-bizagi-render",e.container)[0])&&($(o).attr("tabindex",0),o.focus(),$(o).removeAttr("tabindex"))}};if(t>0)var a=setTimeout((function(){r(),clearTimeout(a)}),t);else r()},isValidControlForFocus:function(e,t){var i=!0,r=$(e).closest("[data-render-id]"),a=r.data("render-id"),n=!(!a||!r.length)&&"cellContent"==r.data("bizagi-component");if(a&&n){var o=t.getGridByColumn(a),s=o?o.getColumnType(a):null;s&&"columnCombo"==s&&(i=!1)}return i},renderDialogBox:function(e,t){var i=this,r=new $.Deferred;e.empty();try{i.form&&i.form.params.data.contextType&&(t.contextType=i.form.params.data.contextType)}catch(e){}return t.rewriteContextType,$.when(i.dataService.getFormData(t)).pipe((function(e){return t.recordXPath&&(e.form.properties.recordXpath=t.recordXPath),e.form.contextType=t.contextType,t.rewriteContextType&&(e.form.contextType=void 0),!1===t.editable&&(e.form.properties.editable=!1,i.removeActions(e.form)),!1===t.required&&(e.form.properties.required=!1),i.removeTransitions(e.form),i.form=i.renderFactory.getContainer({type:"form",data:e.form,canvas:i.dialogBox,focus:t.focus||!1,selectedTabs:t.selectedTabs,isRefresh:t.isRefresh||!1,requestedForm:t.requestedForm,fromRender:t.fromRender}),r.resolve(i.form),i.form.render()}),(function(t){var r=i.renderFactory.getCommonTemplate("form-error");if("object"==_typeof(t)&&t.responseText){var a=JSON.parse(t.responseText);t="Error:"+a.errorType+"<br>"+a.message||" Error in form "}$("*",e).remove(),$.tmpl(r,{message:t}).appendTo(e)})).done((function(r){$(".ui-bizagi-button-container",r).remove(),$(".ui-bizagi-loading-message",e).remove(),e.data("loading",!1),e.removeClass("ui-bizagi-component-loading"),e.html(r),e=i.customizeDialogBox(e),i.form.triggerHandler("ondomincluded",i.form),bizagi.override.adjustButtonPositionDialogForm&&i.adjustButtonPosition(e),t.scrollTop?i.form.container.parent().scrollTop(t.scrollTop):i.focusFirstControl(i.form,150),i.form.bind("refresh",(function(r,a){return a.scrollTop=i.form.container.parent().scrollTop(),a=$.extend({focus:focus,selectedTabs:i.form.getSelectedTabs(),isRefresh:!0,mainForm:t.mainForm},a),i.renderDialogBox(e,a)}))}))},adjustButtonPosition:function(e){var t=e.find(".ui-bizagi-container:first")[0],i=e.parent().height()-29-58;new ResizeSensor(t,(function(){i=e.parent().height()-29-58,r()}));var r=function(){t.clientHeight>i?(e.height(i-20),$(".ui-dialog-buttonpane",e.parent()).css("top",29+i)):(e.height(t.clientHeight+20),$(".ui-dialog-buttonpane",e.parent()).css("top",29+e.height()))};r()},customizeDialogBox:function(e){return e},removeTransitions:function(e){(e=e||{}).transitions&&delete e.transitions},removeActions:function(e){(e=e||{}).actions&&delete e.actions},dispose:function(){this.form&&this.form.dispose(),bizagi.util.dispose(this.buttons),bizagi.util.dispose(this)},adjustOverlay:function(){var e=$(".ui-widget-overlay.ui-front"),t=$("body"),i=$("#render-canvas"),r=parseInt(e.height()),a=parseInt(t.height()),n=parseInt(i.height());r<a&&(e.height(a),r=a),r<n&&e.height(n)}}),$.Class.extend("bizagi.rendering.dialog.startForm",{POPUP_WIDTH:900,POPUP_HEIGHT:650},{init:function(e,t,i){var r=this,a=window.document;for(var n in r.buttons={},i.extraButtons)r.buttons[bizagi.localization.getResource(n)]=i.extraButtons[n];this.dataService=e,this.renderFactory=t,this.dialogDeferred=new $.Deferred,i=r.dialogParams=i||{},r.dialogBox=$("<div class='ui-bizagi-component-loading'/>"),r.dialogBox.empty(),r.dialogBox.appendTo("body",a),r.showDialogBox(r.dialogBox,i).done((function(e){r.dialogDeferred.resolve(e)})).fail((function(){r.dialogDeferred.reject()}))},render:function(e){return this.renderDialogBox(this.dialogBox,e),this.dialogDeferred.promise()},showDialogBox:function(e,t){var i=this,r={},a=new $.Deferred,n=null===bizagi.util.parseBoolean(t.showSaveButton)||bizagi.util.parseBoolean(t.showSaveButton),o=null===bizagi.util.parseBoolean(t.showCancelButton)||bizagi.util.parseBoolean(t.showCancelButton),s=t.saveButtonLabel?t.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"),l=t.cancelButtonLabel?t.cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-cancel"),d=null!==bizagi.util.parseBoolean(t.maximized)&&bizagi.util.parseBoolean(t.maximized);return n&&(r[s]=function(){if(i.form&&i.form.validateForm()){var e={};t.forceCollectData?($.forceCollectData=!0,i.form.collectRenderValues(e),$.forceCollectData=!1):i.form.collectRenderValues(e),t.allowGetOriginalFormValues&&(e.formValues=i.form.children),e.idPageCache=i.form.getPageCache(),t.onSave?$.when(t.onSave(e)).done((function(t){null==t||1==t||"success"==t.type?(a.resolve(),i.closeDialogBox()):["validationMessages","alertMessages"].includes(t.type)?("validationMessages"===t.type?i.form.addValidationMessage(t.messages):bizagi.modalError.show(t.messages,"workportal-general-word-information",!1),$.each(e,(function(e){var t=i.form.getRenders(e);$.each(t,(function(e,t){t.updateOriginalValue()}))}))):"error"===t.type&&i.form.addErrorMessage(t.message)})):(a.resolve(),i.closeDialogBox())}}),o&&(r[l]=function(){t.onCancel&&t.onCancel(),i.closeDialogBox()}),i.buttons=$.extend(r,i.buttons),e.dialog({width:this.Class.POPUP_WIDTH,height:this.Class.POPUP_HEIGHT,title:t.title,modal:!0,buttons:i.buttons,resizable:!1,maximized:d,open:function(){d&&$("body",window.document).css("position","fixed")},close:function(){$("body",window.document).css("position","static"),a.reject(),i.closeDialogBox()},resizeStop:function(e,t){i.form&&i.form.resize(t.size)},maximize:function(e){i.form&&i.form.triggerHandler("maximazedForm")},unmaximize:function(e){i.form&&i.form.triggerHandler("unmaximazedForm")}}),i.adjustOverlay(),a.promise()},_appresize:function(){$(this.dialogBox).dialog("widget").css({left:window.screen.width/2-this.Class.POPUP_WIDTH/2+"px",top:window.screen.height/2-this.Class.POPUP_HEIGHT/2+"px",width:this.Class.POPUP_WIDTH+"px",height:this.Class.POPUP_HEIGHT+"px"}).show()},closeDialogBox:function(){var e=this.dialogBox;$("body",window.document).css("position","static"),e.dialog("destroy"),e.remove(),this.dispose()},renderDialogBox:function(e,t){var i=this,r=new $.Deferred;e.empty();try{i.form&&i.form.params.data.contextType&&(t.contextType=i.form.params.data.contextType)}catch(e){}return $.when(i.dataService.getStartForm(t)).pipe((function(e){return e.form.contextType=t.contextType,0==t.editable&&(e.form.properties.editable=!1,i.removeActions(e.form)),i.removeTransitions(e.form),i.form=i.renderFactory.getContainer({type:"form",data:e.form,focus:t.focus||!1,selectedTabs:t.selectedTabs,isRefresh:t.isRefresh||!1}),r.resolve(i.form),i.form.render()}),(function(t){var r=i.renderFactory.getCommonTemplate("form-error");if("object"==_typeof(t)&&t.responseText){var a=JSON.parse(t.responseText);t="Error:"+a.errorType+"<br>"+a.message||" Error in form "}$("*",e).remove(),$.tmpl(r,{message:t}).appendTo(e)})).done((function(r){$(".ui-bizagi-button-container",r).remove(),$(".ui-bizagi-loading-message",e).remove(),e.data("loading",!1),e.removeClass("ui-bizagi-component-loading"),e.html(r),e=i.customizeDialogBox(e),i.form.triggerHandler("ondomincluded");var a=setTimeout((function(){if(i.dialogParams.maximized){var e=i.dialogBox.data("ui-dialog");e.recalculate&&e.recalculate()}clearTimeout(a)}),650);i.form.bind("refresh",(function(r,a){return a=$.extend({focus:focus,selectedTabs:i.form.getSelectedTabs(),isRefresh:!0},t,a),i.renderDialogBox(e,a)}))}))},customizeDialogBox:function(e){return e},removeTransitions:function(e){(e=e||{}).transitions&&delete e.transitions},removeActions:function(e){(e=e||{}).actions&&delete e.actions},dispose:function(){this.form&&this.form.dispose(),bizagi.util.dispose(this.buttons),bizagi.util.dispose(this)},adjustOverlay:function(){var e=$(".ui-widget-overlay"),t=$("body"),i=parseInt(e.height()),r=parseInt(t.height());i<r&&e.height(r)}}),$.Class.extend("bizagi.rendering.dialog.search",{POPUP_WIDTH:800,POPUP_HEIGHT:600},{init:function(e,t,i,r,a){var n=this,o=window.document;a=a||{},this.dataService=e,this.renderFactory=t,this.searchForms=i,this.searchParams=r,this.dialogDeferred=new $.Deferred,this.extraButtons=!!a.hasOwnProperty("buttons")&&a.buttons,n.dialogBox=$("<div class='ui-bizagi-component-loading'/>"),n.dialogBox.empty(),n.dialogBox.appendTo("body",o),n.showDialogBox(n.dialogBox).done((function(e){n.dialogDeferred.resolve(e),n.form.unbindAutoSaveForm()})).fail((function(){n.dialogDeferred.reject(),n.form.unbindAutoSaveForm()}))},render:function(e){return this.renderSearchDialog(e),this.dialogDeferred.promise()},renderSearchDialog:function(e){var t=this;t.form=null,$.when(t.getSearchContainerData(e)).pipe((function(i){void 0!==i.form.properties&&(i.form.properties.orientation=e.orientation||"ltr");var r=t.renderFactory.getContainer({type:"form",data:i.form,canvas:t.dialogBox});return e.contexttype&&(r.properties.contexttype=e.contexttype),t.form=r,t.form.render()})).done((function(i){$(".ui-bizagi-button-container",i).remove(),$(".ui-bizagi-loading-message",t.dialogBox).remove(),i.appendTo(t.dialogBox),t.form.triggerHandler("ondomincluded");var r="tab"==t.form.firstChild().properties.type?t.form.firstChild():null;r?(r.bind("selected",(function(i,r){var a=t.searchForms[r.index];$.when(t.loadSearchTab(e,r.tab,a)).done((function(){t.currentSearchForm=r.tab.firstChild(),t.currentSearchForm.triggerHandler("ondomincluded")}))})),r.container.tabs("option","active",0),t.currentSearchForm=r.firstChild().firstChild(),t.currentSearchForm.triggerHandler("ondomincluded")):(t.currentSearchForm=t.form.firstChild(),t.currentSearchForm.triggerHandler("ondomincluded")),t.focusFirstControl(t.currentSearchForm,100),t.currentSearchForm.bind("instanceSelected",(function(e,i){t.closeDialogBox(),t.dialogBoxDeferred.resolve({id:i.id,label:""})})),t.currentSearchForm.bind("multiSelect",(function(e,i){t.closeDialogBox(),t.dialogBoxDeferred.resolve({id:i.id,label:i.data})}))}))},focusFirstControl:function(e,t){var i=function(){var t=$("input:visible, select:visible, option:visible, textarea:visible",e.container);if(t.length>0){var i=t[0];try{i.focus()}catch(e){}}};t>0?setTimeout(i,t):i()},loadSearchTab:function(e,t,i){var r=this,a=new $.Deferred;return t.children.length>0?null:($.when(r.getSearchFormData(e,i)).pipe((function(e){var i=r.renderFactory.getContainer({type:"searchForm",data:e.form});return t.children.push(i),i.render()})).done((function(e){$(".ui-bizagi-button-container",e).remove(),t.container.append(e),a.resolve()})),a.promise())},showDialogBox:function(e,t){var i=this,r=(t="rtl"==i.searchParams.orientation,[]);i.dialogBoxDeferred=new $.Deferred;var a=[{text:bizagi.localization.getResource("render-form-dialog-box-search"),click:function(){i.searchParams&&(i.searchParams.searchTriggeredBy="button"),i.currentSearchForm.performSearch(i.searchParams)}},{text:bizagi.localization.getResource("render-form-dialog-box-cancel"),click:function(){i.dialogBoxDeferred.reject(),i.closeDialogBox()}}];this.extraButtons&&r.push(this.extraButtons),r=r.concat(a),t&&r.reverse();var n=this.Class.POPUP_WIDTH,o=this.Class.POPUP_HEIGHT;return n>$(window).width()&&(n=.9*$(window).width()),e.addClass("ui-bizagi-dialog-search").dialog({title:bizagi.localization.getResource("render-search-dialog-title"),width:n,height:o,resizable:!1,modal:!0,buttons:r,close:function(){i.dialogBoxDeferred.reject(),i.closeDialogBox()},resizeStop:function(e,t){i.form.resize(t.size)},maximize:function(e){i.currentSearchForm&&(i.currentSearchForm.triggerHandler("maximazedForm"),i.dialogBox.trigger("resize"))},unmaximize:function(e){i.currentSearchForm&&(i.currentSearchForm.triggerHandler("unmaximazedForm"),i.dialogBox.trigger("resize"))}}),i.dialogBoxDeferred.promise()},closeDialogBox:function(){var e=this.dialogBox;e.dialog("destroy"),e.detach();var t=this.currentSearchForm.getPageCache();this.dataService.invalidatePageCache({idPageCache:t})},addButtons:function(e){},getSearchContainerData:function(e){var t=this,i=new $.Deferred,r={form:{properties:{},elements:[]}},a=r.form,n=t.searchForms[0];if(t.searchForms.length>1){var o={properties:{type:"tab"},elements:[]},s=[];$.each(t.searchForms,(function(e,i){var r=i.default||!1,l={};l.properties={id:e,type:"tabItem",displayName:i.caption},l.elements=[],r?(o.elements.push({container:l}),a=l,n=t.searchForms[0]):s.push({container:l})})),$.each(s,(function(e,t){o.elements.push(t)})),r.form.elements.push({container:o})}return $.when(t.getSearchFormData(e,n)).done((function(e){e&&(a.elements.push(e),a.pageCacheId=e.form.pageCacheId,i.resolve(r))})).fail((function(){console.log("Error")})),i.promise()},getSearchFormData:function(e,t){if(null==t||null==t.id){var i=bizagi.localization.getResource("render-search-without-form"),r=$("<div>").append(i);return this.dialogBox.dialog("close"),$(r).dialog({modal:!0,buttons:[{text:bizagi.localization.getResource("render-form-dialog-box-close"),click:function(){$(this).dialog("close")}}],maximize:function(e){console.log("please check if executed, which form trigger the event 'dialog.search'")},unmaximize:function(e){console.log("please check if executed, which form trigger the event 'dialog.search'")}}),!1}return this.dataService.getSearchFormData($.extend(e,{idSearchForm:t.id,url:t.url})).pipe((function(t){return t.form.properties.idRender=e.idRender,t}))},dispose:function(){this.form.dispose(),bizagi.util.dispose(this.buttons),bizagi.util.dispose(this)}}),bizagi.rendering.dialog.search.extend("bizagi.rendering.dialog.searchUser",{},{init:function(e,t,i,r,a){this._super(e,t,i,r,a)},getSearchFormData:function(e){return{form:{properties:{id:"3ad923cf-f21e-439e-90b5-f2df8ffe4559",type:"searchForm",displayName:"SearchWFuser",xpathContext:"",columns:[{caption:"idUser",dataType:7,xpath:"idUser"},{caption:"userName",dataType:15,xpath:"userName"},{caption:"domain",dataType:15,xpath:"domain"},{caption:"fullName",dataType:15,xpath:"fullName"},{caption:"enabledForAssignation",dataType:5,xpath:"enabledForAssignation"},{caption:"enabled",dataType:5,xpath:"enabled"}]},elements:[{render:{properties:{id:"e0babe1d-7924-4d2a-8fb3-b915b746dbe6",type:"searchText",xpath:"domain",displayName:"domain",dataType:15}}},{render:{properties:{id:"87b14b2e-992d-4e40-a17b-eecbcbc2466a",type:"searchText",xpath:"userName",displayName:"userName",dataType:15}}},{render:{properties:{id:"c5d137d9-a392-4d8e-9088-d5eba64b4c2a",type:"searchText",xpath:"fullName",displayName:"fullName",dataType:15}}}],buttons:[],sessionId:"bcy5gtv11xxao4oy4xrlk3o3",pageCacheId:1876964702},type:"form"}}}),$.Class.extend("bizagi.rendering.dialog.letter",{POPUP_WIDTH:800,POPUP_HEIGHT:550},{init:function(e,t){this.dataService=e,this.renderFactory=t},render:function(e){var t=window.document,i=this.renderFactory.getTemplate("letter.dialog"),r=$.tmpl(i);r.appendTo("body",t);var a=$("#ui-bizagi-rtfeditor",r);return a.width(this.Class.POPUP_WIDTH-30),a.height(this.Class.POPUP_HEIGHT-150),new nicEditor({iconsPath:this.dataService.getLetterEditorIconsPath(),fullPanel:!0}).panelInstance("ui-bizagi-rtfeditor"),this.templateParts=e.split(/(<body>|<\/body>)/gi),nicEditors.findEditor("ui-bizagi-rtfeditor").setContent(e),this.showDialogBox(r)},showDialogBox:function(e){var t=this,i={},r=new $.Deferred;return i[bizagi.localization.getResource("render-letter-dialog-box-save")]=function(){var i=nicEditors.findEditor("ui-bizagi-rtfeditor").getContent();e.dialog("destroy"),e.remove(),"<body>"==t.templateParts[1]?(t.templateParts[2]=i.replaceAll("<header></header>",""),r.resolve(t.templateParts.join(""))):r.resolve(t.templateParts[0]+"<body>"+i+"</body>"+(t.templateParts.length>2?t.templateParts[2]:""))},i[bizagi.localization.getResource("render-letter-dialog-box-cancel")]=function(){e.dialog("close")},e.dialog({width:this.Class.POPUP_WIDTH,height:this.Class.POPUP_HEIGHT,title:bizagi.localization.getResource("render-letter-dialog-title"),modal:!0,buttons:i,close:function(t,i){e.dialog("destroy"),e.remove(),r.reject()}}),r.promise()}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.form",bizagi.rendering.form.prototype),bizagi.rendering.desktop.form.extend("bizagi.rendering.desktop.form",{},{postRenderContainer:function(e){var t=this;if(t.useQuickActions&&t.initFormButton(),t._super(e),"execution"===t.getMode()){var i=t.getButtons();i.button(),(i?i.length:0)&&"form"===t.params.type&&!0!==t.params.isEntityForm?($(document).data("auto-save",t.properties.id),t.configureBindAutoSave((function(e){t.autoSaveEvents(e)})),t.beforeUnloadFunction=function(e){var i={};if(t.collectRenderValues(i),!$.isEmptyObject(i)&&$(document).data("auto-save"))return bizagi.localization.getResource("confirmation-savebox-message2")},$(window).unbind("beforeunload").bind("beforeunload",t.beforeUnloadFunction)):$._data(document).events&&!$._data(document).events["save-form"]&&t.configureBindAutoSave((function(e){e.resolve()})),t.buildProcessPath(),("undefined"!=typeof isWebpart?$(document):$("#ui-bizagi-wp-app-render-form-content")).scroll((function(){$(".modal-ecm",this).hide()}))}},configureBindAutoSave:function(e){this.autoSaveFunction=function(t,i){e(i)},this.haveAutosaveAssociated()?$(document).unbind("save-form",this.saveFormDelegate):this.saveFormDelegate=$.proxy(this.autoSaveFunction,this),$(document).unbind("save-form").bind("save-form",{idAutoSave:this.getIdentifierFormForAutosave(),functionSaveFormDelegate:this.saveFormDelegate},this.saveFormDelegate)},unbindAutoSaveForm:function(){this.saveFormDelegate&&$(document).unbind("save-form",this.saveFormDelegate)},getIdentifierFormForAutosave:function(){return this.properties.id?this.properties.id.concat("_"+this.properties.uniqueId):this.properties.uniqueId},haveAutosaveAssociated:function(){for(var e=!1,t=this.getIdentifierFormForAutosave(),i=$._data($(document)[0],"events")["save-form"]||[],r=0,a=i.length;r<a;r+=1)if(i[r].data.idAutoSave===t){this.saveFormDelegate=i[r].data.functionSaveFormDelegate,e=!0;break}return e},autoSaveEvents:function(e,t){var i=this,r={},a=[];i.getFormContainer().hasChanged(a),a.length>0?$.when(bizagi.showSaveBox(bizagi.localization.getResource("confirmation-savebox-message1"),"Bizagi","warning",i.properties.orientation)).done((function(){i.collectRenderValues(r),$.when(i.saveForm(r)).done((function(){i.saveFormDelegate&&$(document).unbind("save-form",i.saveFormDelegate),bizagi.util.isSharepointContext()&&$(document).data("auto-save",""),e.resolve()}))})).fail((function(t){"cancel"==t?e.reject():(e.resolve(),i.saveFormDelegate&&$(document).unbind("save-form",i.saveFormDelegate),bizagi.util.isSharepointContext()&&$(document).data("auto-save",""))})):(i.saveFormDelegate&&$(document).unbind("save-form",i.saveFormDelegate),e.resolve())},getButtons:function(){var e=this.container;return $(".ui-bizagi-button-container .ui-bizagi-button",e)},configureLayoutView:function(){},dispose:function(){$(window).unbind("beforeunload",this.beforeUnloadFunction),$(document).unbind("save-form",this.saveFormDelegate),this._super()},saveForm:function(e){var t=this,i=bizagi.util.isOfflineForm({context:t}),r=null;return(e=t.collectRenderValuesForSubmit(e)).deferreds&&(r=$.when.apply($,e.deferreds),delete e.deferreds),$.when(r).pipe((function(){return t.startLoading(),t.dataService.submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,isOfflineForm:i||!1}).always(t.endLoading.bind(t))}))},getChanges:function(){var e={};return void 0!==this.collectRenderValues&&this.collectRenderValues(e),e},buildProcessPath:function(e){var t=this.properties,i=this.getMode(),r="queryForm"==this.getFormType(),a=this.params.summaryForm||!1,n=this.properties.displayAsReadOnly||!1;if("execution"==i&&!r&&!a&&!n&&this.properties.processPath&&this.properties.processPath.length>0){var o=this.renderFactory.getTemplate("form-process-path"),s=$.fasttmpl(o,{processPath:t.processPath});this.pathProcess=s}else this.pathProcess=""},initFormButton:function(){var e=this,t=e.getFormContainer(),i=bizagi.override&&bizagi.override.maxButtonForQuickActions>0?bizagi.override.maxButtonForQuickActions:6,r=e.buttons||[],a=e.getListWithPriority(r,i);a.length>0&&$(".ui-bizagi-button-container.bz-form-buttons",t.container).formButtons({maxButtons:i,buttons:a,click:function(t,i){e.processQuickButton(i.ordinal)}})},getListWithPriority:function(e,t){return e.filter((function(e){return!1!==bizagi.util.parseBoolean(e.visible)})).map((function(e,i){return Object.assign(e,{visible:!1!==bizagi.util.parseBoolean(e.visible),additional:i+1>t,priority:!0!==e.quickAction?1:i,ranked:!0,index:i})}))}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.panel",bizagi.rendering.panel.prototype),bizagi.rendering.desktop.panel.extend("bizagi.rendering.desktop.panel",{},{}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.contentPanel",bizagi.rendering.contentPanel.prototype),bizagi.rendering.desktop.contentPanel.extend("bizagi.rendering.desktop.contentPanel",{},{}),bizagi.rendering.desktop.panel.extend("bizagi.rendering.desktop.nestedForm",{},{configureDesignView:function(){var e=this.properties,t=this.container;t.removeClass("ui-bizagi-container-panel"),t.addClass("ui-bizagi-container-nestedform");var i=$("<span class= 'ui-bizagi-container-nestedform-title'/>");i.text("Nested Form: "+e.formDisplayName),t.prepend(i)}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.tab",bizagi.rendering.tab.prototype),bizagi.rendering.desktop.tab.extend("bizagi.rendering.desktop.tab",{},{postRenderContainer:function(e){var t=this;t._super(e),e.tabs({active:t.activeTab,activate:function(e,i){t.children[t.activeTab].visibleTab();var r=setTimeout((function(){t.resize({width:t.container.width(),height:t.container.height()}),void 0!==t.getParams()&&("sharepoint"!=t.getParams().context&&window.self===window.top||t.resizeInPopUpHTML()),clearTimeout(r)}),50)},beforeActivate:function(e,i){var r=i.newTab.index();t.setActiveTab(r)}});var i=setTimeout((function(){t.children.forEach((function(t){var i=t.properties;if(i.tooltip){var r=$("a[href=#ui-bizagi-tab-"+i.id+"]",e);r.tooltip({content:r.attr("title"),position:{at:"center top-55"}})}})),clearTimeout(i)}),10)},resizeInPopUpHTML:function(){if($(".activitiFormContainer").length>0){var e=$(".activitiFormContainer").height()||0,t=$(".activitiFormContainer #ui-bizagi-webpart-render-container"),i=$(".ui-bizagi-button-container",".activitiFormContainer");if(this.getParams().idWorkitem||i.length>0){var r=i.height()||0;t.height(e-110-r)}else t.height(e-110)}},configureLayoutView:function(){}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.tabItem",bizagi.rendering.tabItem.prototype),bizagi.rendering.desktop.tabItem.extend("bizagi.rendering.desktop.tabItem",{},{init:function(e){this._super(e),this.tabReadyDeferred=new $.Deferred,this.loadingDeferred=new $.Deferred,this.tabActiveDeferred=new $.Deferred},resize:function(e){var t=this,i=t.container,r=i.width(),a=0;$.when(t.ready()).done((function(){!function e(){if(!(a>10))if(i.is(":visible"))$.each(t.children,(function(e,t){t.resize({width:r})}));else{a++;var n=setTimeout((function(){e(),clearTimeout(n)}),200)}}()}))},setAsActiveContainer:function(e){var t=this;$.when(t.ready()).done((function(){var e=t.parent;e.container.data("ui-tabs")&&e.container.tabs("option","active",t.container.data("tab-counter"))}))},activate:function(){this._super(),this.loadingDeferred&&this.loadingDeferred.resolve()},visibleTab:function(){this.tabActiveDeferred&&this.tabActiveDeferred.resolve()},focus:function(){this.activate(),this.setAsActiveContainer(),this._super()},renderTabContent:function(e){var t=this,i=this.properties,r=t.getFormContainer();if(void 0===i.loadOnDemand||0==i.loadOnDemand||r.innerTabsLoading||r.params.printversion||t.canSkipThisFormType(r.properties.type))return e=t.replaceChildrenHtml(e,t.renderChildrenHtml()),t.tabReadyDeferred.resolve(),t.tabActiveDeferred.resolve(),e;if(t.startLoading(),"execution"==t.getMode())var a=setTimeout((function(){t.loadingDeferred&&t.loadingDeferred.resolve(),clearTimeout(a)}),10500);return $.when(t.loadingDeferred.promise()).done((function(){t.isDisposed()?(t.tabReadyDeferred.reject(),t.tabActiveDeferred.reject()):$.when(t.parent.ready()).done((function(){t.replaceChildrenTag(t.container,t.renderChildrenHtml()),t.postRenderContainer(t.container),t.endLoading(),t.tabReadyDeferred.resolve(),t.tabActiveDeferred.resolve()}))})),e=t.replaceChildrenHtml(e,'<div class="children"/>')},canSkipThisFormType:function(e){return"execution"==this.getMode()&&/^queryForm$/i.test(e)},ready:function(e){var t=this;if(bizagi.util.parseBoolean(e)&&t.container&&t.container.length&&(t.loadingDeferred&&t.loadingDeferred.resolve(),$.when(t.tabReadyDeferred.promise()).done((function(){t.activate()}))),bizagi.util.parseBoolean(e)&&(!t.container||!t.container.length))var i=setInterval((function(){t.container&&t.container.length&&(clearInterval(i),t.loadingDeferred&&t.loadingDeferred.resolve())}),50);return $.when(t.tabReadyDeferred.promise(),t.parent.ready(),t.tabActiveDeferred.promise())},changeVisibility:function(e){var t=this,i=t.properties;t._super(e);var r=t.parent.container,a="ui-bizagi-tab-"+i.id,n=$("ul li[aria-controls = '"+a+"']",r),o=t.parent.getActiveTab();$.when(t.ready()).done((function(){i.visible?(n&&n.show(),t.setAsActiveContainer()):"execution"===t.getMode()&&n&&n.hide()})).always((function(){r.data("ui-tabs")&&r.tabs("option","active",o)}))},afterToRefresh:function(){this._super(),$(this.parent.container).tabs("refresh")}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.horizontal",bizagi.rendering.horizontal.prototype),bizagi.rendering.desktop.horizontal.extend("bizagi.rendering.desktop.horizontal",{},{postRenderContainer:function(e){var t=this.children,i=t.length;this._super(e),$.each(t,(function(e,t){var r,a,n,o=t.properties.width;o=null==o||0==o.length?100/i:bizagi.util.percent2Number(o),r=e,a=t,n=i,$.when(a.ready()).done((function(){var e=a.getRenderedElement();e.css({width:o+"%"}),e.addClass("ui-panel-area"),r==n-1&&e.addClass("ui-bizagi-render-last")}))}))}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.layout",bizagi.rendering.layout.prototype),bizagi.rendering.desktop.layout.extend("bizagi.rendering.desktop.layout",{},{}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.accordion",bizagi.rendering.accordion.prototype),bizagi.rendering.desktop.accordion.extend("bizagi.rendering.desktop.accordion",{},{postRenderContainer:function(e){this._super(e),e.accordion({autoHeight:!1})},configureLayoutView:function(){}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.accordionItem",bizagi.rendering.accordionItem.prototype),bizagi.rendering.desktop.accordionItem.extend("bizagi.rendering.desktop.accordionItem",{},{setAsActiveContainer:function(e){var t=this;$.when(t.ready()).done((function(){t.parent.container.accordion("option","active",t.properties.ordinal)}))},focus:function(){this.activate(),this.setAsActiveContainer(),this._super()}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.group",bizagi.rendering.group.prototype),bizagi.rendering.desktop.group.extend("bizagi.rendering.desktop.group",{},{postRenderContainer:function(e){var t=this.properties,i="rtl"==t.orientation?"-rtl":"";this._super(e);var r=$(".ui-icon",$(".ui-bizagi-container-group-header:first",this.container));$(".ui-bizagi-container-group-header",this.container);bizagi.util.parseBoolean(t.collapse)?(t.expanded=!1,r.addClass("ui-state-collapse"+i).removeClass("ui-state-expand"+i)):(t.expanded=!0,r.addClass("ui-state-expand"+i).removeClass("ui-state-collapse"+i))},configureHandlers:function(){var e,t=this.properties,i="rtl"==t.orientation?"-rtl":"",r=this.container,a=$(".ui-bizagi-container-group-header:first",r);$(a).click((function(a){a.preventDefault&&a.preventDefault(),(e=$(".ui-icon",r)).toggleClass("ui-icon-triangle-1-s ui-icon-triangle-1-n"),$(".ui-bizagi-container-group-wrapper:first",r).toggle(),t.expanded?(t.expanded=!1,e.addClass("ui-state-collapse"+i).removeClass("ui-state-expand"+i),$(this).addClass("group-collapse").removeClass("group-expand")):(t.expanded=!0,e.addClass("ui-state-expand"+i).removeClass("ui-state-collapse"+i),$(this).addClass("group-expand").removeClass("group-collapse"))}))},isOpen:function(){return!!this.properties.expanded},focus:function(){this.expand(),this._super()},expand:function(){var e=this.container,t=$(".ui-bizagi-container-group-header:first",e);this.isOpen()||$(t).trigger("click")},collapse:function(){var e=this.container,t=$(".ui-bizagi-container-group-header:first",e);this.isOpen()&&$(t).trigger("click")},toogleContainer:function(e){e?this.expand():this.collapse()}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.section",bizagi.rendering.section.prototype),bizagi.rendering.desktop.section.extend("bizagi.rendering.desktop.section",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("section-header"),i=$.fasttmpl(t,{displayName:e.displayName,editable:e.editable,orientation:this.getOrientation(),uniqueId:e.uniqueId,isDesign:"execution"!==this.getMode(),messageValidation:e.messageValidation,guid:e.guid,displayAs:e.displayAs});return this.sectionContent=$(this.renderSectionContent())[0],i},renderSectionContent:function(){var e=this.renderFactory.getTemplate("section-content"),t=this.properties,i=this.getBreadcrumb();this.orderSection=i.length-1;var r=$.fasttmpl(e,{displayName:t.displayName,editable:t.editable,orientation:this.getOrientation(),uniqueId:t.uniqueId,isDesign:"execution"!==this.getMode(),messageValidation:t.messageValidation,guid:t.guid,breadCrumb:i});return r=this.replaceChildrenHtml(r,this.renderChildrenHtml())},postRenderContainer:function(e){e.closest(".ui-bizagi-container-form-wrapper-animation").append(this.sectionContent),this._super(e),this.isActive()&&this.openAutomatically()},configureHandlers:function(){var e=this,t=e.container[0],i=e.getFormContainer(),r=i.params&&i.params.printversion,a=t.querySelector(".ui-bizagi-container-section-header"),n=this.sectionContent.querySelector(".ui-bizagi-container-section-breadcrumb").querySelectorAll(".ui-bizagi-container-section-breadcrumb-element");this.openSectionFromClick=this.openSectionFromClick.bind(this),r?a.classList.add("ui-bizagi-section-print"):(a.addEventListener("click",this.openSectionFromClick),Array.prototype.forEach.call(n,(function(t){var i=parseInt(t.getAttribute("data-steps-back"));0!==i&&t.addEventListener("click",(function(){e.goBack(i)}))})))},executeChildrenPostRender:function(e){var t=this,i=$(".ui-bizagi-container-section-children",this.sectionContent).children();$.each(i,(function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var a=t.childrenHash[r];if(a){var n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&a.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&a.postRenderContainer(i)}}else t.executeChildrenPostRender(i)}))},openSectionFromClick:function(e){var t=this,i=t.container[0],r=this.sectionContent.parentElement,a=i.querySelector(".ui-bizagi-container-section-header");a.removeEventListener("click",this.openSectionFromClick),bizagi.util.isIE()||"rtl"===this.getFormOrientation()||r.scrollIntoView({behavior:"smooth",block:"start"}),this.openSection().then((function(){a.addEventListener("click",t.openSectionFromClick)})),this.setAsActive()},openSection:function(){var e=new $.Deferred,t=this.sectionContent.parentElement,i="rtl"===this.getFormOrientation()?1:-1,r=this.getSectionParent(),a=r&&r.properties||{},n=r&&r.params||{};return"form"!==a.type&&"form"!==n.type||(r=this.getFormParent(r)),t.classList.remove("ui-bizagi-container-form-wrapper-animation-inactive"),t.style.transform="translateX("+100*this.orderSection*i+"%)",setTimeout((function(){e.resolve()}),600),this.removeAnimationClasses(r.sectionContent),r.sectionContent.classList.add("ui-bizagi-section-animation-fade-out"),this.restoreSectionsOutOfPath(),this.removeAnimationClasses(this.sectionContent),this.sectionContent.classList.add("ui-bizagi-section-animation-fade-in"),this.sectionContent.style.order=this.orderSection,this.sectionContent.style.msOrder=this.orderSection,e.promise()},openAutomatically:function(){this.closeAllSections();for(var e=[],t=this,i=t.properties||{},r=t.params||{},a=this.orderSection;"form"!==i.type&&"form"!==r.type;)e.push(t),i=(t=t.getSectionParent()).properties||{},r=t.params||{};this.translateWithoutAnimation(a),this.openFormWithoutAnimation();for(var n=e.length-1;n>=0;n--)e[n].openSectionWithoutAnimation(0===n);this.setAsActive()},translateWithoutAnimation:function(e){var t=this.sectionContent.parentElement,i="rtl"===this.getFormOrientation()?1:-1;t.classList.add("ui-bizagi-container-form-wrapper-animation-inactive"),t.style.transform="translateX("+100*e*i+"%)"},openSectionWithoutAnimation:function(e){this.sectionContent.style.order=this.orderSection,this.sectionContent.style.msOrder=this.orderSection,this.removeAnimationClasses(this.sectionContent),this.sectionContent.classList.add("ui-bizagi-section-without-animation"),this.sectionContent.classList.add(e?"ui-bizagi-section-animation-fade-in":"ui-bizagi-section-animation-fade-out")},openFormWithoutAnimation:function(){var e=this.getFormParent();e.sectionContent.style.order=e.orderSection,e.sectionContent.style.msOrder=e.orderSection,this.removeAnimationClasses(e.sectionContent),e.sectionContent.classList.add("ui-bizagi-section-without-animation"),e.sectionContent.classList.add("ui-bizagi-section-animation-fade-out")},closeAllSections:function(e){var t=this.getFormContainer()||{};(t.rendersByType?t.rendersByType.section:[]).forEach((function(e){e.removeAnimationClasses(e.sectionContent),e.sectionContent.classList.add("ui-bizagi-container-section-initial-state"),e.sectionContent.style.order=99999,e.sectionContent.style.msOrder=99999}))},restoreSectionsOutOfPath:function(){for(var e=[],t=this.getSectionParent(),i=t.properties||{},r=t.params||{};"form"!==i.type&&"form"!==r.type;)e.push(i.id),i=(t=t.getSectionParent()).properties||{},r=t.params||{};var a=this.getFormContainer()||{};(a.rendersByType?a.rendersByType.section:[]).forEach((function(t){!e.includes(t.properties.id)&&t.sectionContent&&(t.removeAnimationClasses(t.sectionContent),t.sectionContent.classList.add("ui-bizagi-container-section-initial-state"),t.sectionContent.style.order=99999,t.sectionContent.style.msOrder=99999)}))},goBackInPath:function(e){var t=this.sectionContent.parentElement,i=this,r="rtl"===this.getFormOrientation()?1:-1;t.classList.remove("ui-bizagi-container-form-wrapper-animation-inactive");for(var a=0;a<e;a++)this.removeAnimationClasses(i.sectionContent),i.sectionContent.classList.add("ui-bizagi-section-animation-fade-in-out"),"section"!==(i=i.getSectionParent()).properties.type&&(i=this.getFormParent());return this.removeAnimationClasses(i.sectionContent),i.sectionContent.classList.add("ui-bizagi-section-animation-fade-in"),t.style.transform="translateX("+100*i.orderSection*r+"%)",i},removeAnimationClasses:function(e){["ui-bizagi-section-animation-fade-in","ui-bizagi-section-animation-fade-out","ui-bizagi-section-animation-fade-in-out","ui-bizagi-section-hide-in-background","ui-bizagi-container-section-initial-state","ui-bizagi-section-without-animation"].forEach((function(t){e.classList.remove(t)}))},getSectionParent:function(){for(var e=this;e.parent;){var t=(e=e.parent).params||{},i=e.properties||{};if("section"===i.type||"form"===i.type||"form"===t.type)return e}return this},getFormParent:function(){var e=this.getFormContainer();return{sectionContent:$(".ui-bizagi-main-section",e.container)[0],orderSection:0,setAsActive:function(){e.setParam("selectedSection",void 0)}}},isActive:function(){return(this.getFormContainer().getParams()||{}).selectedSection===this.properties.id},setAsActive:function(){this.getFormContainer().setParam("selectedSection",this.properties.id)},goBack:function(e){this.goBackInPath(e).setAsActive()},getOrientation:function(){for(var e=this;e;){if(properties=e.properties||{},"auto"!==properties.orientation)return properties.orientation;e=e.parent}return"auto"},getFormOrientation:function(){return(((this.getFormContainer()||{}).properties||{}).orientation||"auto").toLowerCase()}}),bizagi.rendering.desktop.form.extend("bizagi.rendering.desktop.searchForm",bizagi.rendering.searchForm.prototype),bizagi.rendering.desktop.searchForm.extend("bizagi.rendering.desktop.searchForm",{},{renderResult:function(){var e=this,t=e.properties,i={};i.properties={displayName:e.getResource("render-search-advanced-results-label"),type:"grid",xpath:"searchForm"+t.id,id:t.id,skipInitialLoad:!0,rowsPerPage:10,inlineAdd:!1,allowDelete:!1,allowAdd:!1,hideActionsColumn:!0,floatingHeader:!0,sortBy:t.sortBy,sortOrder:t.sortOrder,overrideGetRemoteData:function(t){return e.getRemoteData(t)}},i.elements=[];var r=t.columns;$.each(r,(function(t){var a={render:{}};a.render.properties={displayName:r[t].caption,xpath:r[t].xpath,editable:!1},$.extend(a.render.properties,e.parseAdditionalProperties(r[t].dataType)),0==r[t].dataType&&(a.render.properties.columnVisible=!1),7!=r[t].dataType&&8!=r[t].dataType||(a.render.properties.allowDecimals=r[t].allowDecimals),10!=r[t].dataType&&11!=r[t].dataType||(a.render.properties.allowDecimals=!0),12==r[t].dataType&&(a.render.properties.showTime=r[t].showTime),i.elements.push(a)}));var a=e.renderFactory.getRender({type:"grid",data:i,parent:e,mode:e.getMode(),jqgrid:!1});return e.resultsGrid=a,a.render()},postRenderContainer:function(e){var t=this,i=e.find(".ui-bizagi-container-search-criteria"),r=e.find(".ui-bizagi-container-search-results"),a=i.children(),n=t.getMode();t.container=e,$.each(a,(function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var a=t.childrenHash[r];if(a){var n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&a.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&a.postRenderContainer(i)}}}));var o=$(r.children()[0]);t.resultsGrid.postRenderElement(o),"execution"==n&&t.configureHandlers(),"design"==n&&t.configureDesignView(),"layout"==n&&(t.configureDesignView(),t.configureLayoutView())},configureHandlers:function(){var e=this;return e.criteriaContainer=$(".ui-bizagi-container-search-criteria",e.container),e.resultsContainer=$(".ui-bizagi-container-search-results",e.container),e.resultsGrid.bind("rowSelected",(function(t,i){e.properties.searchParams.hasOwnProperty("multiSelect")?e.trigger("multiSelect",i):e.trigger("instanceSelected",i)})),e},refreshResults:function(){var e=this,t=e.resultsGrid;t.refresh(),$.when(t.dataReady()).done((function(){e.resultsContainer.show(),e.resizeResults()}))},resize:function(){this.resizeResults()},resizeResults:function(){var e=this.resultsGrid;this.resultsContainer.is(":visible")?this.criteriaContainer.height("auto"):this.criteriaContainer.height("100%"),e.resize({width:this.criteriaContainer.width(),onSearchFinished:function(){this.properties&&(0==this.properties.records?($(".ui-bizagi-container-search-results",this.container).show(),$(".ui-bizagi-container-search-results .ui-jqgrid-title",this.container).hide()):$(".ui-bizagi-container-search-results .ui-jqgrid-title",this.container).show())}})}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.text",bizagi.rendering.text.prototype),bizagi.rendering.desktop.text.extend("bizagi.rendering.desktop.text",{},{postRender:function(){this._super(),this.properties.maxLength>0&&this.input.attr("maxlength",this.properties.maxLength)},setDisplayValue:function(e){var t=bizagi.util.decodeURI(e);e=this.validateValue(t,this.properties.maxLength),this.setValue(e),this._super(e),!bizagi.util.isEmpty(e)&&this.properties.editable?this.input&&this.input.val(e):null===e&&this.properties.editable&&this.input&&this.input.val("")},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!=i.length&&i.blur((function(){var t=$(this);e.retypeDouble(t)}))},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.tooltip({disabled:!0}),t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},retypeDouble:function(e){var t=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility")&&null==$(this).data("newValue"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===t)return;t!=e.data("oldValue")?(this.setValue(""),this.createTooltip(e,"",this.getResource("render-text-retype-error"))):(e.data("newValue",t),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""===t||t===e.data("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},collectData:function(e){var t=this.properties.xpath,i=this.getValue();null!=i&&void 0!==i&&"number"!=typeof i&&(i=(i=(i=i.replaceAll(String.fromCharCode("030"),"")).replaceAll(String.fromCharCode("018"),"")).replaceAll(String.fromCharCode("016"),"")),this.controlValueIsChanged()&&(bizagi.util.isEmpty(t)||(bizagi.util.isEmpty(i)?""===i&&(e[t]=""):e[t]=i)),this.validateInputRetype()||(e[this.properties.xpath]="")},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $("input.ui-bizagi-render-text, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.readonly",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.readonly.extend("bizagi.rendering.desktop.readonly",bizagi.rendering.readonly.prototype),bizagi.rendering.desktop.readonly.extend("bizagi.rendering.desktop.readonly",{},{renderElement:function(){return this._super("render-base")},getLabel:function(){return $("label",this._super())}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.extendedText",bizagi.rendering.extendedText.prototype),bizagi.rendering.desktop.extendedText.extend("bizagi.rendering.desktop.extendedText",{postRender:function(){this._super(),bizagi.util.isIE8()&&this.textarea.attr("cols","5000")},postRenderReadOnly:function(){this._super(),$(this.getControl()).addClass("ui-bizagi-text-extended-readonly")},configureHandlers:function(){var e=this,t=e.properties;e._super(),t.maxLength>0&&(e.textarea.attr("maxlength",t.maxLength),e.actualMaxLength=t.maxLength),e.ready().done((function(){if(t.autoExtend){var i=e.textarea.css("height");void 0===t.maxLines&&("string"==typeof i&&-1!==i.search("px")?Number(i.split("px")[0])<=150&&(i="150px"):i="150px"),e.textarea.css({overflow:"hidden",resize:"none",minHeight:i});var r=setTimeout((function(){e.changeHeightAutoExtended(e.textarea[0]),clearTimeout(r)}),100);e.textarea.bind("keyup",(function(){e.changeHeightAutoExtended(this)}))}}))},setDisplayValue:function(e){var t=this.getControl();e=this.validateValue("string"==typeof e?e:"",this.properties.maxLength),this.setValue(e);var i=$.br2nl(e);if(this.textarea&&this.textarea.val(i),!bizagi.util.parseBoolean(this.properties.editable))if("string"==typeof e){var r=bizagi.util.encodeHtmlText(this.getDisplayValue());t.html("<label class='readonly-control'>"+r+"</label>")}else bizagi.util.isNull(e)&&t.html("")},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();null!=this.getValue()&&void 0!==this.getValue()&&(r=this.getValue().replaceAll(String.fromCharCode("030"),""),r=this.getValue().replaceAll(String.fromCharCode("018"),""),r=this.getValue().replaceAll(String.fromCharCode("016"),"")),$.controlValueIsChanged(this)&&(bizagi.util.isEmpty(i)||(bizagi.util.isEmpty(r)?""===r&&(e[i]=""):e[i]=r)),this.validateInputRetype()||(e[t.xpath]="")},cleanData:function(){this.setValue(""),this.setDisplayValue(this.getValue()),this.textarea&&this.textarea[0].style.removeProperty("height")},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input, textarea",t);i&&0!=i.length&&i.blur((function(){var t=$(this),i=e.previousValue,r=e.value;null!=i&&r!=i&&null!=$(this).data("newValue")&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)}))},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},retypeDouble:function(e){var t=e.val();if("hidden"!=$(e).attr("type")&&"none"!=$(e).css("display")&&"hidden"!=$(e).css("visibility")&&null==$(this).data("newValue"))if(e.data("oldValue")&&""!=$(this).data("oldValue")){if(""==t)return;t!=e.data("oldValue")?(this.setValue(""),this.createTooltip(e,"",this.getResource("render-text-retype-fail"))):(e.data("newValue",t),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""==t||t==e.data("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},changeHeightAutoExtended:function(e){e.scrollHeight<20*this.properties.maxLines?e.style.height=20*this.properties.maxLines:e.style.height=e.scrollHeight+"px"},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $("input.ui-bizagi-render-text, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.label",bizagi.rendering.label.prototype),bizagi.rendering.desktop.label.extend("bizagi.rendering.desktop.label",{},{renderReadOnly:function(){return this.setValue(this.properties.displayName),this._super()},postRender:function(){this.getLabel().addClass("ui-bizagi-render-label")},postRenderReadOnly:function(){this.getLabel().addClass("ui-bizagi-render-label")}}),bizagi.rendering.desktop.label.extend("bizagi.rendering.desktop.queryLabel",{},{}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.number",bizagi.rendering.number.prototype),bizagi.rendering.desktop.number.extend("bizagi.rendering.desktop.number",{},{setDisplayValue:function(e){this._super(e),null!=e&&this.properties.editable&&(this.numericInput.val(bizagi.util.numberToFixedString(e)),this.value=this.properties.value=e,this.executeFormatCurrencyPlugin())},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur((function(){var t=$(this),i=e.previousValue,r=e.value;"grid"===e.parent.properties.type?(null!=i&&r!==i&&void 0!==$(this).data("newValue")&&t.val()!==$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)):e.retypeDouble(t)}))},retypeDouble:function(e){var t=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility")&&void 0===$(this).data("newValue"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===t)return;if(t!==e.data("oldValue"))this.setValue(""),this.createTooltip(e,"",this.getResource("render-text-retype-error"));else{e.data("newValue",e.val()),e.data("oldValue","");try{e.tooltip("destroy")}catch(e){}}}else{if(""===t||t===e.data("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},changeCellRequired:function(e){this.changeRequired(e)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $("input.ui-bizagi-render-numeric, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}}),bizagi.rendering.desktop.number.extend("bizagi.rendering.desktop.queryNumber",{},{setDisplayValue:function(e){var t=this.properties;this._super(e),null!==e&&t.editable&&this.setValue(this.numericInput.asNumber({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.date",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.date.extend("bizagi.rendering.desktop.date",bizagi.rendering.date.prototype),bizagi.rendering.desktop.date.extend("bizagi.rendering.desktop.date",{},{renderElement:function(e){return this._super(e||"render-base")},renderReadOnly:function(){var e=this.properties,t=bizagi.util.dateFormatter,i=t.getDateFromInvariant(this.getValue(),e.showTime),r=t.formatDate(i,e.fullFormat,this.i18n),a={value:"execution"!==this.getMode()?e.fullFormat:r,editable:e.editable},n=this.renderFactory.getTemplate("readonly");return $.fasttmpl(n,a)},getElementsToStylize:function(e){return $(".bz-input-icon__input, .bz-input--readonly, .readonly-control",e)},configureHandlers:function(){var e=this,t=e.getDateControl(),i=$(".bz-input-icon__input",t);e.configureMobiscollCalendar(),e.calendarInstance=$(".bz-hidden",t).mobiscroll("getInst"),i.on("focusInput",(function(t){e.getCalendarInstance().isVisible()||(e.getCalendarInstance().show(!1,!0),i.focus())})).on("keydown",(function(t){"9"==t.keyCode&&e.getCalendarInstance().hide();var r=setTimeout((function(){var a=i.val();if(bizagi.util.isEmpty(a))e.compareDates(a,e.getCalendarInstance().getVal())&&e.setValueFromCalendarButtons(null,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.setValue(""),e.setDisplayValue("")}));else{var n=e.getNormalizeDate(bizagi.util.dateFormatter.getDateFromFormat(a,e.properties.fullFormat,e.i18n));0==n?(e.setValue(""),e.getCalendarInstance().setVal(null)):e.compareDates(i.val(),e.getCalendarInstance().getVal())&&(e.getCalendarInstance().setVal(n,!1,!1,!1),e.onChangeHandler())}"13"==t.keyCode&&e.onChangeHandler(),clearTimeout(r)}),1)})).on("blur",(function(t){e.compareDates(i.val(),e.getCalendarInstance().getVal())&&e.onChangeHandler()})),t.click((function(t){e.getCalendarInstance().show(!1,!0),i.focus()}))},configureMobiscollCalendar:function(){var e=this,t=e.properties;e.elementCalendar=null;var i=t.showTime?["calendar","time"]:["calendar"],r=e.getDateControl(),a=$(".bz-hidden",r),n=$(".bz-input-icon__input",r),o=e.getOrientation();a.mobiscroll().calendar({touchUi:!1,display:"bubble",animate:!1,anchor:r.get(0),focusOnClose:n.get(0),controls:i,min:e.getNormalizeDate(new Date(t.minValue)),max:e.getNormalizeDate(new Date(t.maxValue)),defaultValue:e.getDisplayValue(),timeFormat:t.timePickerFormat?e.getTimeFormat(t.timePickerFormat):"",dateFormat:t.datePickerFormat,dateWheels:"dd/MM/yyyy",select:"single",selectType:"Day",rtl:o&&"rtl"===o,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||bizagi.localization.language||"en",cssClass:"mbsc-bizagi-theme",buttons:e.properties.showTime?[{text:e.getResource("render-timeentry-now"),handler:function(){e.setValueFromCalendarButtons(new Date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))},cssClass:"mbsc-fr-btn mbsc-btnNow"},{text:e.getResource("render-plugin-search-users-select-link"),handler:"set",cssClass:"mbsc-fr-btn mbsc-btnSet"},{text:e.getResource("render-plugin-search-users-clear-button-name"),handler:function(e,t){t.clear()},cssClass:"mbsc-fr-btn mbsc-btnClear"}]:[{text:e.getResource("render-timeentry-now"),handler:function(){e.setValueFromCalendarButtons(new Date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))},cssClass:"mbsc-fr-btn mbsc-btnNow"},{text:e.getResource("render-plugin-search-users-clear-button-name"),handler:function(e,t){t.clear()},cssClass:"mbsc-fr-btn mbsc-btnClear"}],onSet:function(){e.onChangeHandler()},onDayChange:function(t){e.setValueFromCalendarButtons(t.date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.properties.showTime||e.getCalendarInstance().hide()}))},onChange:function(t){if(e.elementCalendar)if(0==$(".mbsc-sc-whl-anim",e.elementCalendar).length)e.setDateFromTimeSelector(t.valueText);else var i=setInterval((function(){e.elementCalendar&&0!=$(".mbsc-sc-whl-anim",e.elementCalendar).length||(e.setDateFromTimeSelector(t.valueText),clearInterval(i))}),100)},onClear:function(){e.setValueFromCalendarButtons(null,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))},onBeforeShow:function(e,i){i.option({max:bizagi.util.dateFormatter.getDateFromInvariant(t.maxValue,t.showTime),min:bizagi.util.dateFormatter.getDateFromInvariant(t.minValue,t.showTime)})},onShow:function(t){e.elementCalendar=calendar=$(".mbsc-fr-popup",t.target),$(".mbsc-btnNow",calendar).parent().addClass("mbsc-div-btnNow"),$(".mbsc-btnSet",calendar).parent().addClass("mbsc-div-btnSet")},onClose:function(){e.elementCalendar=null}})},setDateFromTimeSelector:function(e){var t=this;t.setValueFromCalendarButtons(bizagi.util.dateFormatter.getDateFromFormat(e,t.properties.fullFormat),(function(e){t.getCalendarInstance().setVal(e,!1,!1,!1),t.properties.showTime||t.getCalendarInstance().hide()}))},compareDates:function(e,t){var i=bizagi.util.dateFormatter,r=this.getNormalizeDate;return e=r.call(this,"string"!=typeof e?e:i.getDateFromFormat(e,this.properties.fullFormat,this.i18n)),t=r.call(this,"string"!=typeof t?t:i.getDateFromFormat(t,this.properties.fullFormat,this.i18n)),!(!e&&!t)&&(!!(!e&&t||e&&!t)||e.getTime()!=t.getTime())},getCalendarInstance:function(){return this.calendarInstance||(this.calendarInstance=$(".bz-hidden",this.getDateControl()).mobiscroll("getInst"))},configureDesignView:function(){},getDateControl:function(){return this.properties.editable?$(".bz-input-icon, .bz-input",this.getControl()):this.getControl()},removeValidations:function(){var e=this.getFormContainer();e.clearValidationMessages?e.clearValidationMessages():e.getFormContainer().parent&&e.getFormContainer().parent.getFormContainer&&(e=e.getFormContainer().parent.getFormContainer()).clearValidationMessages&&e.clearValidationMessages()},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.properties,i=this.getControl();i.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&t.editable?i.addClass("control-required"):i.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&t.editable?i.addClass("control-required"):i.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},onChangeHandler:function(e){var t=this.properties,i=this.getNormalizeDate(this.getCalendarInstance().getVal()),r="",a=bizagi.util.dateFormatter;if(i&&0!=i){var n=this.value;if(1==e?(i=this.getNormalizeDate(new Date),r=a.formatDate(i,"MM/dd/yyyy HH:mm:ss"),this.value=r):this.value=a.formatInvariant(i,t.showTime),t.showTime&&!t.fullFormat.includes("s")&&(i.setSeconds(0),this.value=a.formatInvariant(i,t.showTime)),e||i){var o=this.getFormContainer();if(void 0===o.validationController){var s=o.getValidationsContainer();o.validationController=new bizagi.command.controllers.validation(o,this.validations,s)}if(this.removeValidations(),!this.isValid([])){var l=this.getCalendarInstance().getVal(),d=bizagi.localization.getResource("workportal-general-invalid-date");d=d.replace("{0}",t.displayName),(o.validationController||o.parent.validationController).showValidationMessage(d+" "+l)}this.value=n,r=a.formatDate(i,"MM/dd/yyyy HH:mm:ss"),this.setValue(r),this.setDisplayValue(r)}}},getLabel:function(){return this.label||(this.label=$(".ui-bizagi-label > label",this.element||this.observableElement)),this.label},hideIcon:function(e){this._super(e);var t=$(".ui-bizagi-render-icons",this.element),i=$(".ui-bizagi-render-icon-error",this.element);$(".ui-bizagi-render-icon-help",this.element).is(":visible")||i.is(":visible")||t.css({width:"1px","min-width":"1px"})},getFullFormatedDate:function(e,t){var i="",r=bizagi.util.dateFormatter;i=e.length>0?e:void 0!==e?r.formatISO(e,!1):r.formatISO(new Date,!1),i+=t;var a=r.getDateFromFormat(i,"yyyy-MM-dd H:m");return r.formatDate(0!==a?a:e,"yyyy-MM-dd H:mm:ss")},setDisplayValue:function(e){if("execution"===this.getMode()){var t=this.properties,i=this.getControl(),r=bizagi.util.dateFormatter;bizagi.util.isNumeric(e)&&0!==e&&(e=r.formatInvariant(new Date(e),t.showTime)),e&&(e="string"==typeof e?this.getNormalizeDate(r.getDateFromInvariant(e,t.showTime)):this.getNormalizeDate(e));var a=this.getCalendarInstance();t.editable&&a.setVal&&a.setVal(e),this.setValue(r.formatInvariant(e,!0)),t.displayValue=r.formatDate(e,t.fullFormat,this.i18n);var n=t.editable?$(".bz-input-icon__input, .bz-input--readonly",i):$(".readonly-control",i);"string"!=typeof t.displayValue&&"number"!=typeof t.displayValue||(t.editable?n.prop("value",t.displayValue):n.html(t.displayValue),n.prop("title",t.displayValue))}},setValueFromCalendarButtons:function(e,t){this._super(e),"function"==typeof t&&t(e),this.onChangeHandler()},cleanData:function(){this.setValue(""),this.setDisplayValue("")},disablePopup:function(){this.getCalendarInstance()&&this.getCalendarInstance().disable()}}),bizagi.rendering.desktop.date.extend("bizagi.rendering.desktop.queryDate",{},{collectDataQueryForm:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=null;this.controlValueIsChanged();if(!bizagi.util.isEmpty(i)&&(null!=r&&""!==r&&(a=r),null!==a||t.included)){var n=this.properties.typeSearch||this.properties.rangeQuery||"NONE";n=n.toUpperCase(),e.push({value:a,included:this.properties.included,xpath:t.xpath,searchType:n,orderType:"NONE",renderId:this.getRenderId()})}}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.yesno",bizagi.rendering.yesno.prototype),bizagi.rendering.desktop.yesno.extend("bizagi.rendering.desktop.yesno",{},{postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-boolean-yesno"),e[0]&&$.removeData(e[0]),e.optiongroup({orientation:this.properties.orientation})},configureHandlers:function(){var e=this,t=e.getControl();e._super(),t.bind("optiongroupchange",(function(t,i){bizagi.util.parseBoolean(e.value)!==bizagi.util.parseBoolean(i.value)&&e.setValue(i.value)}))},configureDesignView:function(){this.getControl().find("input").unbind("click")},setDisplayValue:function(e){var t=this.getControl();if(this._super(e),null!=e&&this.properties.editable){var i=bizagi.util.parseBoolean(e);null!=i&&t.optiongroup("setValue",i.toString())}},cleanData:function(){this.setDisplayValue(null),this.clearDisplayValue()},clearDisplayValue:function(){this.element.find(".ui-radio-state-checked").removeClass("ui-radio-state-checked")}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.check",bizagi.rendering.check.prototype),bizagi.rendering.desktop.check.extend("bizagi.rendering.desktop.check",{},{postRender:function(){var e=this.getControl();this._super(),this.input=e.find("label"),this.performStyles()},postRenderReadOnly:function(){var e=this.getControl(),t=!0===bizagi.override.enableCheck&&!this.properties.editable;if(this.input=e.find("label"),!t){this.performStyles();var i=$("input",e);i.attr("readonly","readonly"),i.attr("disabled","disabled")}},renderReadOnly:function(){var e="";if(!0===bizagi.override.enableCheck&&!this.properties.editable){var t=this.renderFactory.getTemplate("readonly"),i=bizagi.util.randomNumber(100,1e7);e=$.fasttmpl(t,{id:i,editable:this.properties.editable})}else e=this._super();return e},configureHandlers:function(){var e=this;e._super(),bizagi.util.isIE()?e.input.bind("change",(function(t,i){var r=$("input",e.input).is(":checked");e.setValue(r),e.setDisplayValue(r)})):e.input.bind("checkchange",(function(t,i){e.setValue(i.value)}))},configureDesignView:function(){this.getControl().find("input").unbind("click")},setDisplayValue:function(e){var t=bizagi.util.parseBoolean(e),i=!0===bizagi.override.enableCheck&&!this.properties.editable;if(this._super(t),i)this.input&&this.input.val(this.getDisplayValue());else if(bizagi.util.isIE())this.input&&(!0===t?(this.input.addClass("ui-checkbox-state-checked"),$("input",this.input).attr("checked","checked")):(this.input.removeClass("ui-checkbox-state-checked"),$("input",this.input).removeAttr("checked")));else try{!0===t?this.input.check("checkItem"):this.input.check("uncheckItem")}catch(e){}},cleanData:function(){this.setDisplayValue(!1),this.setValue(!1,!1)},performStyles:function(){var e=this.getControl();e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-boolean-yesno"),this.properties.required&&$(".ui-bizagi-render-control-required",e).css({height:"22px"}),bizagi.util.isIE()?(e.removeClass(),e.addClass("ui-bizagi-render-control ui-bizagi-render-boolean-yesno-ie"),e.find("label").addClass("checkbox-ie")):this.input.check()},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},changeFontSize:function(e,t){t&&this._super(e,t)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.combo",bizagi.rendering.combo.prototype),bizagi.rendering.desktop.combo.extend("bizagi.rendering.desktop.combo",{},{initializeData:function(e){this._super(e),this.properties.loadOnDemand=!0},postRender:function(){this.inputCombo=$(".ui-selectmenu-value",this.getControl()),this.selectedValue=this.properties.value,this._super()},configureHandlers:function(){var e=this;e.inputCombo.focus((function(){$(this).select()})),e.inputCombo.blur((function(){e.setDisplayValue(e.getValue()),e.isExtraItem()||e.setDisplayValue(e.value)})),e.getFormContainer().bind("maximazedForm unmaximazedForm",(function(t){e.isPreferencesDialog(e.inputCombo)?e.onResizeCloseDialog():e.resizeCombo()})),e.inputCombo.click((function(){var t="dd-"+e.inputCombo.attr("id");0===$("#"+t,e.getControl().parent()).length?e.comboDropDown():e.dropDownDestroy($("#"+t)),e.inputCombo.focus()})),$(".ui-selectmenu-btn",e.control).length>1&&void 0!==window.addEventListener?$(".ui-selectmenu-btn",e.control)[0].addEventListener("click",(function(){e.inputCombo[0].click()})):$(".ui-selectmenu-btn",e.control).bind("click.combo",(function(){e.inputCombo.trigger("click")})),e.inputCombo.keyup((function(t){e.keyUpFunction(t)})),e.inputCombo.keydown((function(t){e.keyDownFunction(t)})),e._super()},comboDropDown:function(){var e=this;e.showLoadingData(),$.when(e.getData()).done((function(t){e.hideLoadingData();try{e.internalComboDropDown(t)}catch(e){bizagi.log(e.message)}}))},showLoadingData:function(){var e=$("body",document),t=this.loading=$("<div class='ui-select-dropdown open loading'><ul><li class='ui-bizagi-render-loading ui-bizagi-loading'></li></ul></div>");t.css("width",this.inputCombo.outerWidth()+"px"),$("li",t).css({padding:0,margin:0}),t.css("overflow","hidden"),t.appendTo(e),t.position({my:"left top",at:"left bottom",of:this.inputCombo,collision:"none flip"})},hideLoadingData:function(){this.loading.remove()},internalComboDropDown:function(e){var t=this,i={},r={};$(".ui-select-dropdown.open").remove();var a=$("<div class='ui-select-dropdown open bz-combo__list--comfortable' role='popup'></div>"),n=t.inputCombo.parents(".ui-bizagi-control").last(),o=n.closest(".ui-bizagi-render"),s="dd-"+t.inputCombo.attr("id"),l=t.findDataByValue(t.inputCombo.val()),d=0,u="rtl"===t.properties.orientation?"ui-bizagi-rtl":"";if(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0){var c=o.closest(".ui-dialog-content");c.length>0&&c.css("overflow-y","hidden")}e=e||t.properties.data,t.properties.data=e,t.repositionInterval,o.addClass("ac-is-visible"),n.addClass("ac-is-visible ac-clear-floats"),a.attr("id",s),t.inputCombo.attr("aria-expanded","true");for(var p=0;p<e.length;p++)null!==e[p].value&&"boolean"==typeof e[p].value&&(!0===bizagi.util.parseBoolean(e[p].value)?e[p].value=this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e[p].value)&&(e[p].value=this.getResource("render-boolean-no")));i=e.length>1e3?t.getResource("render-combo-too-many-elements"):$.tmpl("<ul role='listbox' id='listbox-${id}' aria-labelledby='label-${id}' aria-expanded='true'>   {{each datasource}}{{if typeof hidden == 'undefined'}}       <li id='opt-${id}' data-value='${id}' role='option' tabindex='0' aria-selected='false'>${value}</li>{{/if}}   {{/each}}</ul>",{id:t.properties.id,datasource:e});var h=a.append(i);n.append(h);var g=$(".ui-selectmenu",t.control);$(h).find("li:last-child").css("padding-bottom","13px");var m=h.width(),f=g.width();if(h.width(f<m?m:f),t.isPreferencesDialog(o)){var b=o.closest(".ui-dialog-content"),v=$.scrollerParent(h[0]),y=$(b),C=h.offset().top-y.offset().top,x=h.offset().left-y.offset().left,z=$("<div/>",{css:{position:"absolute",top:C,left:x}});z.attr("id","wrapper-"+s),z.appendTo(y),$(h).appendTo(z),$(v).off("scroll.combo").on("scroll.combo",(function(e){var i=$(e.target);t.dropDownValidClose(i,h),$(v).unbind("scroll.combo")}))}h.position({my:"left top",at:"left bottom",of:$(".ui-selectmenu",t.control),collision:"fit"}).hide(),h.show(),(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)&&c.length>0&&c.css("overflow-y","auto"),t.recalculateComboOffset(h,g),h.data("formWidth",n.width()),h.data("parentCombo",t.control),h.addClass(u),-1!==l&&$("li",h).length>0&&0!==(r=l&&""===l.id?$("li[data-value='']",h):$("li[data-value='"+l.id+"']",h)).length&&(r.addClass("ui-selected"),r.addClass("active"),r.attr("aria-selected","true"),t.inputCombo.attr("aria-activedescendant","opt-"+l.id),d=parseInt(r.position().top),h.scrollTop(d)),h.delegate("li","click",(function(){var e={id:$(this).data("value")?$(this).data("value"):"",value:$(this).text()},i=t.getValue();i=i&&i.id?i.id:0,e.id!==i?t.onComboItemSelected(e):e.value!==t.inputCombo.val()&&t.setDisplayValue({value:e.value}),t.inputCombo.select(),h.hide(),t.dropDownDestroy(h),$(document).unbind("click.closecombo")})),$.makeArray(h,t.getControl()).bind("click",(function(e){return e.preventDefault(),!1})),$(document).one("click.closecombo",(function(e){var i=$(e.target);t.dropDownValidClose(i,h)}))},dropDownValidClose:function(e,t){t.hide(),this.dropDownDestroy(t),$(document).unbind("click.closecombo")},dropDownReposition:function(e,t){if(t.width()!=e.data("formWidth")){var i=$(".ui-selectmenu",this.control);e.width(this.control.width()<100?100:i.width());var r=e.data("parentCombo")||i;e.position({my:"left top",at:"left bottom",of:$(".ui-selectmenu-value",r),collision:"none"}),e.data("formWidth",t.width())}},dropDownDestroy:function(e){var t=(this.inputCombo?this.inputCombo:$(".ui-selectmenu-value",this.getControl())).closest(".ui-bizagi-control"),i=t.closest(".ui-bizagi-render"),r=""+e.attr("id");this.inputCombo.attr("aria-expanded","false"),t.hasClass("ac-is-visible")&&t.removeClass("ac-is-visible"),t.hasClass("ac-clear-floats")&&t.removeClass("ac-clear-floats"),i.hasClass("ac-is-visible")&&i.removeClass("ac-is-visible"),e.remove();var a=$("#wrapper-"+r);a&&a.length>0&&a.remove(),$(document).unbind("mousedown.closecombo"),$(document).unbind("mouseup.resizecombo"),$(window).unbind("resize.resizecombo"),$(window).unbind("mouseup.closecombo"),this.repositionInterval&&clearInterval(this.repositionInterval)},validateValueInDatasource:function(e,t){var i=this.inputCombo.val(),r=this.findDataByValue(i,t);this.value||(this.value={id:""}),r.id>0?e?(this.setValue({id:r.id}),this.setDisplayValue(r)):(this.setValue({id:r.id},!1),this.setDisplayValue(r)):""===r.id?(this.value.id!=r.id&&this.setValue(r,!1),this.setDisplayValue(r)):this.setDisplayValue(this.selectedValue)},keyDownFunction:function(e){var t="dd-"+this.inputCombo.attr("id"),i=$("#"+t),r=$("li.active",i);return(e=e||window.event).altKey||e.ctrlKey||e.metaKey?1:(0!==i.length||this.properties.data||(this.comboDropDown(this.combo),i=$("#"+t)),e.shiftKey&&9==e.keyCode||9==e.keyCode?(r.length>0&&this.inputCombo.val(r.text()),this.focusDependant=!0,this.validateValueInDatasource(!0,!0),i.remove(),1):(27==e.keyCode&&(this.setDisplayValue(this.selectedValue),i.remove()),9==e.keyCode||13==e.keyCode?(r.length>0&&this.inputCombo.val(r.text()),this.validateValueInDatasource(!0,!0),i.remove(),1):"38"==e.keyCode||"37"==e.keyCode?(this.selectPreviousElement(i),0):"40"==e.keyCode||"39"==e.keyCode?(this.selectNextElement(i),0):36==e.keyCode?(this.selectFirstElement(i),0):35==e.keyCode?(this.selectLastElement(i),0):(this.properties.enableTyping="boolean"==typeof bizagi.override.typingForCombos?bizagi.override.typingForCombos:this.properties.enableTyping,this.properties.enableTyping?1:(e.preventDefault(),e.stopPropagation(),!1))))},keyUpFunction:function(e){var t="dd-"+this.inputCombo.attr("id"),i=$("#"+t);if((e=e||window.event).altKey||e.ctrlKey||e.metaKey||13==e.keyCode||9==e.keyCode||27==e.keyCode||16==e.keyCode||36==e.keyCode||35==e.keyCode||33==e.keyCode||34==e.keyCode)return 0;0===i.length&&(this.comboDropDown(this.combo),i=$("#"+t));var r=!1;return e.keyCode>=37&&e.keyCode<=40&&(r=!0),this.selectItemByKeyUp(r),1},selectItemByKeyUp:function(e){var t;null==bizagi.util.parseBoolean(e)&&(e=!1);var i="dd-"+this.inputCombo.attr("id"),r=$("#"+i);$(".active",r).removeClass("active");var a=this.findDataByValue(this.inputCombo.val(),!0,e);-1!==a?((t=$("li[data-value='"+a.id+"']",r)).addClass("active"),this.inputCombo.attr("aria-activedescendant","opt-"+a.id)):t=$("li.ui-selected",r),r.length>0&&t.length>0&&(scrollPosition=parseInt(t.position().top),r.scrollTop(scrollPosition))},selectFirstElement:function(e){var t=$("li:first",e);$("li",e).removeClass("active"),t.addClass("active"),scrollPosition=t.position().top,e.scrollTop(scrollPosition),this.inputCombo.val($(t).text())},selectLastElement:function(e){var t=$("li:last",e);$("li",e).removeClass("active"),t.addClass("active"),scrollPosition=t.position().top,e.scrollTop(scrollPosition),this.inputCombo.val($(t).text())},selectPreviousElement:function(e){var t=0,i=$("li.active",e);0===i.length&&(i=$("li:first",e));var r=i.prev();0!==r.length&&(i.removeClass("active"),$(r).addClass("active"),t=$(r).position().top,e.scrollTop(t),this.inputCombo.val($(r).text()))},selectNextElement:function(e){var t=0,i=$("li.active",e);0===i.length&&(i=$("li:first",e));var r=i.next();0!==r.length&&(i.removeClass("active"),$(r).addClass("active"),t=$(r).position().top,e.scrollTop(t),this.inputCombo.val($(r).text()))},onComboItemSelected:function(e){var t=e.id||"",i=e.value||"";this.properties.originalValue=this.getValue(),""===t?this.inputCombo.val(""):this.inputCombo.val(i),this.setValue({id:t}),this.setDisplayValue({id:t,value:i})},setDisplayValue:function(e){var t,i=this.properties,r="";if(e=this.mapValue(e),e=this.preprocessValue(e),i.editable&&null!==e){if("object"===_typeof(e)&&void 0!==e.label){var a=bizagi.util.isNumeric(e.id)?e.id:e.value,n=e.label;!bizagi.util.isString(n)&&bizagi.util.isString(e.value)&&(n=e.value),r=this.findDataById(a).value||e.label,this.setValue({id:a,value:n})}else{if("number"==typeof e||"string"==typeof e||e.id)if(e.id){var o=!1;if(null!=e.value&&"boolean"==typeof e.value)o=!0,!0===bizagi.util.parseBoolean(e.value)?e.value=this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value)&&(e.value=this.getResource("render-boolean-no"));else if(null!=e.value&&"object"===_typeof(e.value))for(var s=0;s<e.value.length;s++)null!=e.value[s]&&"boolean"==typeof e.value[s]&&(!0===bizagi.util.parseBoolean(e.value[s])?e.value[s]=this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value[s])&&(e.value[s]=this.getResource("render-boolean-no")));r=o?e.value:this.findDataById(e.id).value||e.value}else r=this.findDataById(Number(e)).value||e.label;else r="object"==_typeof(e.value)?e.value.join(" - "):e.value;(i.hasLocalData||i.remoteDataLoaded)&&-1===this.findDataByValue(r)&&(r=""),e&&e.id&&(null!=e.id&&("number"==typeof e.id&&e.id>0||"string"==typeof e.id&&e.id.length>0)?null==this.value||null==this.value?this.setValue({id:e.id}):this.value.id!=e.id&&this.setValue({id:e.id}):null==this.value||null==this.value?this.setValue({id:e}):this.value.id!=e&&this.setValue({id:e}))}this.inputCombo?(this.inputCombo.val(e.value),$(this.inputCombo).attr("title",e.value)):(t=$(".ui-selectmenu-value",this.getControl()))&&t.val(e.value)}else if(i.editable||null===e)if(null===e&&i.editable){var l=this.getResource("render-combo-empty-selection");this.inputCombo.val(l),$(this.inputCombo).attr("title","")}else null!==e||i.editable||this.getControl().text("");else"number"==typeof e||"string"==typeof e?(r=this.findDataById(Number(e)).value,(t=this.getControl()).html("<label class='readonly-control'>"+this.escapeValue(this.formatItem(r))+"</label>")):"object"===_typeof(e)&&(void 0!==e.label?(a=bizagi.util.isNumeric(e.id)?e.id:e.value,r=this.findDataById(a).value||e.label,$.isArray(r)&&(r=r.join(" - ")),this.setValue({id:a,value:r})):null==this.value||null==this.value?this.setValue(e):this.value.id!=e.id&&this.setValue(e),this.control.html("<label class='readonly-control'>"+this.escapeValue(this.formatItem(e.label||e.value))+"</label>"))},clearDisplayValue:function(){var e=this.getControl();if(this.inputCombo){var t=bizagi.override.emptyLabelForCombo||this.getResource("render-combo-empty-selection");this.inputCombo.val(t)}else this.properties.editable||$(e).html("<label class='readonly-control'></label>");this.value=this.properties.value=this.selectedValue},cleanData:function(){this.value=this.properties.value=this.selectedValue={id:"",value:""},this.clearDisplayValue()},getSelectedValue:function(){return this.selectedValue},findDataById:function(e){return(this.properties.data||[]).find((function(t){return t.id==e}))||{}},findDataByValue:function(e,t,i){var r=-1;if(null!=e&&null!=this.properties.data)if(t)for(var a,n,o,s,l,d=-1,u=this.properties.data.length-1;d++<u;)a=this.properties.data[d],s="object"==_typeof(e)?e.join(" - "):"boolean"==typeof e?e.toString():e,l=$.trim(s).substring(0,s.length).toLowerCase(),n="object"===_typeof(a)&&"object"===_typeof(a.value)?"object"==_typeof(a.value)?a.value.join(" - "):a.value:$.trim(a.value),o=String(n).toLowerCase(),i?o==l&&o.length==l.length&&(r={id:a.id,value:a.value},d=u):0==o.indexOf(l)&&(r={id:a.id,value:a.value},d=u);else this.getValue()&&((r=this.getValue()).value||(r.value=this.inputCombo.val()));return r},setValue:function(e,t){if(null===e&&(e={id:""}),e){var i="object"===_typeof(e)?this.getValueFromData(e.id)||"":"number"==typeof e||"string"==typeof e?this.getValueFromData(e):"",r=void 0!==e.value&&null!==e.value?e.value:this.findDataById(i).value||"";this.selectedValue={id:i,value:r},this._super(this.selectedValue,t)}},getValueFromData:function(e){var t=Number(e);return isNaN(t)&&(t=e),t},recalculateComboOffset:function(e,t){if(bizagi.util.isIE()&&9==bizagi.util.getInternetExplorerVersion()&&e.width()!==t.width()){var i=t.width()-e.width();e.width(t.width()+i)}},resizeCombo:function(){var e=$(".ui-selectmenu",this.control),t=$(".ui-select-dropdown.open",this.element),i=e.width();t&&t.get(0)&&t.width()!==i&&t.width(i)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},isPreferencesDialog:function(e){var t=e&&e.closest(".bz-wp-userpreferences-main")||[];return t&&t.length>0},onResizeCloseDialog:function(){var e=$(".ui-selectmenu",this.control).closest(".ui-dialog-content"),t=$(".ui-select-dropdown.open",e);this.dropDownValidClose(void 0,t)},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $("input.ui-selectmenu-value, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}});var originalRefreshPositionMethod=$.ui.selectmenu.prototype._refreshPosition;$.ui.selectmenu.prototype._refreshPosition=function(){this.list.height(0);var e=originalRefreshPositionMethod.apply(this,arguments);return this.list.css("width",this.newelement.width()+"px"),e},bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.cascadingCombo",bizagi.rendering.combo.prototype),bizagi.rendering.desktop.cascadingCombo.extend("bizagi.rendering.desktop.cascadingCombo",bizagi.rendering.cascadingCombo.prototype),bizagi.rendering.desktop.cascadingCombo.extend("bizagi.rendering.desktop.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{postRender:function(){var e=this;bizagi.rendering.desktop.combo.prototype.postRender.apply(e,arguments),e.processLayout(!1,e.properties.valueFormat||{})},configureHandlers:function(){this._super(),bizagi.rendering.desktop.combo.prototype.configureHandlers.apply(this,arguments)},comboDropDown:function(){bizagi.rendering.desktop.combo.prototype.comboDropDown.apply(this,arguments)},showLoadingData:function(){bizagi.rendering.desktop.combo.prototype.showLoadingData.apply(this,arguments)},hideLoadingData:function(){bizagi.rendering.desktop.combo.prototype.hideLoadingData.apply(this,arguments)},internalComboDropDown:function(){bizagi.rendering.desktop.combo.prototype.internalComboDropDown.apply(this,arguments)},resizeCombo:function(){bizagi.rendering.desktop.combo.prototype.resizeCombo.apply(this,arguments)},validateValueInDatasource:function(){bizagi.rendering.desktop.combo.prototype.validateValueInDatasource.apply(this,arguments)},keyDownFunction:function(e){bizagi.rendering.desktop.combo.prototype.keyDownFunction.apply(this,arguments)},keyUpFunction:function(e){bizagi.rendering.desktop.combo.prototype.keyUpFunction.apply(this,arguments)},selectItemByKeyUp:function(){bizagi.rendering.desktop.combo.prototype.selectItemByKeyUp.apply(this,arguments)},selectFirstElement:function(){bizagi.rendering.desktop.combo.prototype.selectFirstElement.apply(this,arguments)},selectLastElement:function(){bizagi.rendering.desktop.combo.prototype.selectLastElement.apply(this,arguments)},selectPreviousElement:function(){bizagi.rendering.desktop.combo.prototype.selectPreviousElement.apply(this,arguments)},selectNextElement:function(){bizagi.rendering.desktop.combo.prototype.selectNextElement.apply(this,arguments)},setDisplayValue:function(){bizagi.rendering.desktop.combo.prototype.setDisplayValue.apply(this,arguments)},clearDisplayValue:function(){bizagi.rendering.desktop.combo.prototype.clearDisplayValue.apply(this,arguments)},getSelectedValue:function(){return bizagi.rendering.desktop.combo.prototype.getSelectedValue.apply(this,arguments)},onComboItemSelected:function(){return this.itemSelected=!0,bizagi.rendering.desktop.combo.prototype.onComboItemSelected.apply(this,arguments)},postRenderPrintVersion:function(){var e=this.getControl();e.empty(),e.append(this.value.value)},dropDownValidClose:function(){return bizagi.rendering.desktop.combo.prototype.dropDownValidClose.apply(this,arguments)},dropDownReposition:function(e,t){return bizagi.rendering.desktop.combo.prototype.dropDownReposition.apply(this,arguments)},dropDownDestroy:function(e){return bizagi.rendering.desktop.combo.prototype.dropDownDestroy.apply(this,arguments)},findDataById:function(){return bizagi.rendering.desktop.combo.prototype.findDataById.apply(this,arguments)},findDataByValue:function(){return bizagi.rendering.desktop.combo.prototype.findDataByValue.apply(this,arguments)},recalculateComboOffset:function(){return bizagi.rendering.desktop.combo.prototype.recalculateComboOffset.apply(this,arguments)},isPreferencesDialog:function(e){return bizagi.rendering.desktop.combo.prototype.isPreferencesDialog.apply(this,arguments)},setValue:function(e,t){if(t=void 0===t||t,""===e&&(e={id:"",value:""}),e){var i=e.id||"",r=e.value||this.findDataById(i).value;this.selectedValue={id:i,value:r},this.internalSetInitialValueFlag||null!==this.value&&this.value.id===e.id||this.triggerHandler("select",[{id:i,value:r},!1]),this._super(this.selectedValue,t)}},cleanData:function(){this.value=this.properties.value=this.selectedValue={id:"",value:""},this.setValue(this.value,!1),this.setDisplayValue(this.value),this.clearDisplayValue()},changeRequired:function(e){return bizagi.rendering.desktop.combo.prototype.changeRequired.apply(this,arguments)},changeRequiredLabel:function(e){return bizagi.rendering.desktop.combo.prototype.changeRequiredLabel.apply(this,arguments)},changeRequiredControl:function(e){return bizagi.rendering.desktop.combo.prototype.changeRequiredControl.apply(this,arguments)},changeFontUnderline:function(e,t){bizagi.rendering.desktop.combo.prototype.changeFontUnderline.apply(this,arguments)},changeFontStrikethru:function(e,t){bizagi.rendering.desktop.combo.prototype.changeFontStrikethru.apply(this,arguments)},getElementsToStylized:function(e){return bizagi.rendering.desktop.combo.prototype.getElementsToStylized.apply(this,arguments)},changeTextDecoration:function(e,t){return bizagi.rendering.desktop.combo.prototype.changeTextDecoration.apply(this,arguments)}});var originalRefreshPositionMethod=$.ui.selectmenu.prototype._refreshPosition;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}$.ui.selectmenu.prototype._refreshPosition=function(){this.list.height(0);var e=originalRefreshPositionMethod.apply(this,arguments);return this.list.css("width",this.newelement.width()+"px"),e},bizagi.rendering.desktop.combo.extend("bizagi.rendering.desktop.queryCombo",{},{}),bizagi.rendering.desktop.cascadingCombo.extend("bizagi.rendering.desktop.queryCascadingCombo",{},{initializeData:function(e){this._super(e),this.properties.contexttype=this.properties.contexttype||"metadata"},postRender:function(){var e=this;null!==e.parentCombo&&e.isDependant&&e.parentCombo.isRendered().done((function(){$(".ui-bizagi-render-control-included",e.parentCombo.getRenderedElement()).hide()})),this._super()},renderControl:function(){var e=this.getMode(),t=this.parentCombo=this.getParentCombo();null!==t&&"queryCascadingCombo"===t.properties.type&&(this.isDependant=!0),this.initializingCascadingCombo=!0;var i=this._super();return"execution"!==e&&(this.initializingCascadingCombo=!1),i},bindDependantCombo:function(e){var t=this,i=t.properties;"queryCascadingCombo"===e.properties.type&&(t.dependants.push(e),e.onChangeFunction=function(i,r,a){t.refreshDependantCombo(e,r.id,!1,a),a||e.cleanInput()},t.isEventBinded("select")||t.bind("select",e.onChangeFunction),bizagi.util.isEmpty(t.getValue())||i.hasLocalData&&t.refreshDependantCombo(e,t.getValue().id))},canBeSentQueryForm:function(){return!0}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.collectionnavigator",bizagi.rendering.collectionnavigator.prototype),bizagi.rendering.desktop.collectionnavigator.extend("bizagi.rendering.desktop.collectionnavigator",{},{initializeData:function(e){e.properties.displayType="value",this._super(e)},postRender:function(){this._super();var e=this.getControl();this.navigationControls=e.find(".bz-collectionnavigator-controls"),this.canvas=this.getCanvas(),$("[title]",e).tooltip()},configureHandlers:function(){var e=this;e._super(),$.when(e.isRendered()).done((function(){e.hasData()&&e.showRow(e.getFirstRow()),e.refreshControls()})),e.navigationControls.find(".bz-navigation-controls").on("click","span",(function(t){var i=t.currentTarget;$(i).hasClass("ui-state-disabled")||e.paginationActions(i)})),e.navigationControls.find(".bz-navigation-current-row").on("change",(function(t){if(e.isValidRow()){var i=$(this).val();$.when(e.saveChanges()).done((function(){e.updateRow(i)}))}})),e.navigationControls.find(".bz-collectionnavigator-addform").on("click",(function(t){var i=t.currentTarget;$(i).hasClass("ui-state-disabled")||(e.hasData()&&e.isValidRow()?$.when(e.saveChanges()).done((function(){e.addRow()})):e.hasData()||e.addRow())})),e.navigationControls.find(".bz-collectionnavigator-editform").on("click",(function(t){var i=t.currentTarget;$(i).hasClass("ui-state-disabled")||e.isValidRow()&&$.when(e.saveChanges()).done((function(){e.editRow()}))})),e.navigationControls.find(".bz-collectionnavigator-detailform").on("click",(function(t){var i=t.currentTarget;$(i).hasClass("ui-state-disabled")||e.isValidRow()&&$.when(e.saveChanges()).done((function(){e.showDetailForm()}))})),e.navigationControls.find(".bz-collectionnavigator-save").on("click",(function(t){var i=t.currentTarget;if(!$(i).hasClass("ui-state-disabled")&&e.isValidRow()){!e.properties.inlineEdit&&e.isTherePendingInlineRow();$.when(e.saveChanges()).done((function(){e.showRow(e.getRow())}))}})),e.navigationControls.find(".bz-collectionnavigator-cancel").on("click",(function(t){var i=t.currentTarget;$(i).hasClass("ui-state-disabled")||e.cancelChanges()})),e.configureButtonsForm()},postRenderReadOnly:function(){this.postRender(),this.configureHandlers()},refreshControls:function(){this.refreshForwardButtons(),this.refreshBackButtons(),this.refreshPagination(),this.refreshTotal(),this.refreshRemoveAction()},refreshForwardButtons:function(){var e=this.getInnerControl("navigation","next"),t=this.getInnerControl("navigation","last"),i=this.keys.length;this.hasData()&&this.pointer<i-1?(e.removeClass("ui-state-disabled"),t.removeClass("ui-state-disabled")):(e.addClass("ui-state-disabled"),t.addClass("ui-state-disabled"))},refreshBackButtons:function(){var e=this.getInnerControl("navigation","previous"),t=this.getInnerControl("navigation","first");this.hasData()&&this.pointer>0?(e.removeClass("ui-state-disabled"),t.removeClass("ui-state-disabled")):(e.addClass("ui-state-disabled"),t.addClass("ui-state-disabled"))},refreshRemoveAction:function(){if(this.properties.editable){var e=this.getInnerControl("navigation","remove");this.hasData()&&!this.isTherePendingInlineRow()?e.removeClass("ui-state-disabled"):e.addClass("ui-state-disabled")}},refreshPagination:function(){var e=this.getInnerControl("navigation","current");this.keys.length>0?(e.val(this.pointer+1),e.removeClass("ui-state-disabled")):(e.val(this.pointer),e.addClass("ui-state-disabled"))},refreshTotal:function(){this.totalRows=this.getTotalRows(),this.getInnerControl("navigation","total").text(this.totalRows)},refreshActions:function(e,t){var i=this.navigationControls.find(".bz-collectionnavigator-save"),r=this.navigationControls.find(".bz-collectionnavigator-cancel");e?i.removeClass("ui-state-disabled"):i.addClass("ui-state-disabled"),t?r.removeClass("ui-state-disabled"):r.addClass("ui-state-disabled")},getInnerControl:function(e,t){var i=this.properties,r=$("div[data-navigation-id='"+i.id+"']");if(e){if("next"===t)return r.find(".bz-navigation-next");if("last"===t)return r.find(".bz-navigation-last");if("previous"===t)return r.find(".bz-navigation-previous");if("first"===t)return r.find(".bz-navigation-first");if("current"===t)return r.find(".bz-navigation-current-row");if("total"===t)return r.find(".bz-navigation-total-rows");if("add"===t)return r.find(".bz-navigation-add");if("remove"===t)return r.find(".bz-navigation-remove");if("save"===t)return r.find(".bz-collectionnavigator-save");if("cancel"===t)return r.find(".bz-collectionnavigator-cancel")}},showRow:function(e,t){var i=this,r=i.properties;if(e){var a={id:e,requestedForm:"navigationForm",url:i.properties.navigationPage,editable:!!r.editable&&r.inlineEdit};$.when(i.renderForm(i.getParameters(a))).done((function(e){i.loadForm(e,t),i.refreshControls()}))}},showDetailForm:function(){var e=this.properties;new bizagi.rendering.dialog.form(this.dataService,this.renderFactory,{title:e.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!1,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close")}).render(this.getParameters({id:this.getRow(),requestedForm:"detailForm",url:e.editPage,editable:!1}))},showInlineRow:function(e,t){var i=this,r={id:e,requestedForm:"navigationForm",url:i.properties.navigationPage,editable:!0};i.startLoading(),$.when(i.renderForm(i.getParameters(r))).done((function(e){i.loadForm(e,t),i.refreshControls()})).always((function(){i.endLoading()}))},updateRow:function(e){$.isNumeric(e)&&this.isValidKey(e)?(e=parseInt(e),this.setPointer(e),this.showRow(this.getRow()),this.refreshControls()):this.refreshPagination()},isValidKey:function(e){return!(e<=0)&&!(e>this.keys.length)},renderForm:function(e){var t=this,i=new $.Deferred,r=t.getFormContainer();return r.useOrSetLoaderDeferred(),r.appendWaitForLoader({promise:i.promise()}),$.when(t.dataService.getFormData(e)).pipe((function(r){r.form.contextType=e.contextType,delete r.form.buttons,0==e.editable&&(r.form.properties.editable=!1),t.removeTransitions(r.form);var a=t.getFormContainer();t.form=t.renderFactory.getContainer({type:"form",data:r.form,canvas:a.params.canvas||a.container,focus:e.focus||!1,selectedTabs:e.selectedTabs,isRefresh:e.isRefresh||!1}),t.form.render(),a.rendersById=$.extend(a.rendersById,t.form.rendersById),t.form.triggerHandler("ondomincluded",t.getFormContainer()),t.form.bind("refresh",(function(e,i){t.showRow(t.getRow())})),t.bindRenderChangeEvent(t.form.children),i.resolve(t.form)})),i.promise()},bindRenderChangeEvent:function(e){for(var t=this,i=0,r=(e=e||[]).length;i<r;i++){var a,n=e[i],o=n.getElementType();o==bizagi.rendering.element.ELEMENT_TYPE_RENDER?n.bind("renderchange",(function(e,i){var r,n=(i=i||{}).render,o=i.changed;if(!n||"collectionnavigator"!=n.properties.type&&"grid"!=n.properties.type)a=[],t.form.hasChanged(a),r=0===a.length;else if(r=!1,!o&&"grid"==n.properties.type){a=[];var s=$.forceCollectData;$.forceCollectData=!1,t.form.hasChanged(a),$.forceCollectData=s,r=0===a.length}t.refreshActions(!r,!r),t.triggerRenderChange()})):o==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&t.bindRenderChangeEvent(n.children)}},getCanvas:function(){return this.getControl().find(".bz-collectionnavigator-navigationform")},isValidRow:function(){return!!this.form&&this.form.validationController.performValidations()},saveChanges:function(){var e=this,t=e.getChanges(),i=[],r=!1;if(e.form){var a=e.getChildCollectionNavigator(e.form.children,i);return r=a.length>0,$.when((function(){if(r)return e.saveChangesChildren(i)})).then((function(){return e.submitSaveRequest(e.getRow(),t).pipe((function(t){if("success"==(t=t||{}).type)return e.form.collectRenderValuesForSubmit(),e.removeInlineAddRecord(),e.refreshControls(),e.refreshActions(!1,!1),e.fetchData();if("validationMessages"==t.type){var i=e.getFormContainer(),r=t.messages.join(" ");i.failHandler({message:r})}return!1}))}))}return e.removeInlineAddRecord(),e.refreshControls(),e.refreshActions(!1,!1),!0},cancelChanges:function(){if(this.refreshActions(!1,!1),this.inlineAddRecords.length>0)this.removeKey(),this.inlineAddRecords.pop(),this.submitRollbackRequest({idPageCache:this.form.properties.idPageCache}),this.refreshTotal(),this.refreshControls(),0==this.getTotalRows()?(this.removeNavigationForm(),this.drawPreview()):this.showRow(this.getRow());else{var e=this.getChanges();$.isEmptyObject(e)||this.showRow(this.getRow())}},getChanges:function(){var e=this,t={};return e.form&&e.form.collectRenderValues(t),$.each(t,(function(t,i){var r=e.form.getRenders(t);$.each(r,(function(e,t){t.updateOriginalValue()}))})),t},addInlineRow:function(){var e=this;$.when(e.submitAddRequest()).done((function(t){e.refreshActions(!0,!0),e.inlineAddRecords.push(t),e.addKey(t),e.showInlineRow(e.getLastRow(),!0),e.refreshTotal(),e.refreshControls()}))},addRow:function(){var e=this,t=e.properties;$.when(e.submitAddRequest()).done((function(i){new bizagi.rendering.dialog.form(e.dataService,e.renderFactory,{title:t.addLabel,orientation:t.orientation||"ltr",onSave:function(r){return t.contextType&&(r[e.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=t.contextType),e.submitSaveRequest(i,r)}}).render(e.getParameters({id:i,requestedForm:"addForm",url:t.addPage,editable:!0})).done((function(){e.startLoading(),$.when(e.fetchData()).done((function(){e.showRow(e.getLastRow())})),e.endLoading()})).fail((function(t){$.when(e.submitRollbackRequest(t)).done((function(){e.submitInvalidatePageCacheRequest(t)}))}))}))},editRow:function(){var e=this,t=e.properties,i=e.getRow();$.when(e.submitEditRequest(i)).done((function(){new bizagi.rendering.dialog.form(e.dataService,e.renderFactory,{title:t.editLabel,orientation:t.orientation||"ltr",onSave:function(t){return e.submitSaveRequest(i,t)}}).render(e.getParameters({id:i,requestedForm:"editForm",url:e.properties.editPage,editable:!0})).done((function(){$.when(e.fetchData()).done((function(){e.showRow(e.getRow())}))})).fail((function(t){$.when(e.submitRollbackRequest(t)).done((function(){e.submitInvalidatePageCacheRequest(t)}))}))}))},removeRow:function(){var e=this,t=e.getRow();bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){$.when(e.submitDeleteRequest(t)).done((function(t){"success"==(t=t||{}).type&&(e.startLoading(),e.removeKey(),e.refreshTotal(),e.refreshControls(),0==e.getTotalRows()?(e.removeNavigationForm(),e.drawPreview()):e.showRow(e.getRow()),e.endLoading())}))}))},removeInlineAddRecord:function(){this.isTherePendingInlineRow()&&this.inlineAddRecords.pop()},loadForm:function(e,t){this.removeNavigationForm(),e.container.find(".ui-bizagi-button-container").remove(),this.addNavigationForm(e.container),t&&this.focusFirstControl(e)},configureButtonsForm:function(){var e=this,t=e.getFormContainer();t.processButton=function(i){var r=$.Deferred();return e.form&&""!==i.action?"save"===i.action?$.when(e.saveChanges()).done((function(){t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()}))})).fail((function(t){e.processFailMessage(t),r.resolve()})):["next","createnewcase"].includes(i.action)?!bizagi.util.parseBoolean(i.validate)||e.isValidRow()?$.when(e.saveChanges()).done((function(){t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()}))})).fail((function(t){e.processFailMessage(t),r.resolve()})):t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()})):"nextWithoutValidations"===i.action?$.when(e.saveChanges()).done((function(){t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()}))})).fail((function(t){e.processFailMessage(t),r.resolve()})):"validate"===i.action&&t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()})):t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()})),r.promise()}},removeNavigationForm:function(){this.canvas.children().remove()},addNavigationForm:function(e){this.canvas.append(e)},fetchData:function(){var e=this,t=new $.Deferred,i=e.getFormContainer();return i.useOrSetLoaderDeferred(),i.appendWaitForLoader({promise:t.promise()}),e.startLoading(),$.when(e.getRemoteData()).done((function(i){e.endLoading(),e.disposed||(i?(e.refresh(i),t.resolve()):t.reject())})),t.promise()},refresh:function(e){var t=this.getKeys(e.rows);this.keys=t,-1==t.indexOf(this.getRow())&&(this.totalRows=t.length,this.pointer=this.pointer>0?this.pointer-1:this.pointer,0==this.totalRows&&(this.removeNavigationForm(),this.drawPreview(),this.refreshControls()))},focusFirstControl:function(e,t){var i=function(){var t=$("input:visible, select:visible, option:visible, textarea:visible",e.container).not(".ui-bizagi-render-date,.ui-bizagi-render-search");if(t.length>0){var i=t[0];try{i.focus()}catch(e){}}};if(t>0)var r=setTimeout((function(){i(),clearTimeout(r)}),t);else i()},getChildCollectionNavigator:function(e,t){for(var i=0,r=(e=e||[]).length;i<r;i++){var a=e[i],n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER?"collectionnavigator"!=a.properties.type&&"grid"!=a.properties.type||t.push(a):n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&this.getChildCollectionNavigator(a.children,t)}return t},saveChangesChildren:function(e){for(var t=[],i=0,r=e.length;i<r;i++)if("collectionnavigator"==e[i].properties.type){var a=e[i].saveChanges();t.push(a)}return $.when.apply($,t)},drawControls:function(e){var t=this.properties;e=$(e);var i=this.collectionControls=$(".bz-collectionnavigator-controls",e);return this.drawForms(i),this.drawControl(i),t.editable&&this.drawActions(i),e[0].outerHTML},drawActions:function(e){var t=$(".actions-group",e),i=this.renderFactory.getTemplate("collectionnavigator-actions");return $.tmpl(i).appendTo(t),e},drawControl:function(e){var t=this.properties,i=t.editable,r=$(".control-group",e),a=this.renderFactory.getTemplate("collectionnavigator-control");return $.tmpl(a,{inlineAdd:i&&t.inlineAdd,allowDelete:i&&t.allowDelete,total:this.totalRows}).appendTo(r),e},drawForms:function(e){var t=this.properties,i=t.withAddForm,r=t.withEditForm,a=t.allowDetail,n=$(".bz-navigation-group",e);return t.editable&&(i||r||a)?(n.addClass("group-visible"),i&&this.getActionsTemplate("add").appendTo(n),r&&this.getActionsTemplate("edit").appendTo(n),a&&this.getActionsTemplate("details").appendTo(n)):n.addClass("group-no-visible"),e},removeTransitions:function(e){(e=e||{}).transitions&&delete e.transitions},collectData:function(e){var t;this.isRendered()&&!0!==(t=this.saveChanges())&&(e.deferreds=e.deferreds||[],e.deferreds.push(t))},getActionsTemplate:function(e){var t=this.renderFactory.getTemplate("collectionnavigator-form-button"),i=null;switch(e){case"add":i=$.tmpl(t,{actionClass:"bz-collectionnavigator-addform",buttonClass:"ui-icon bz-collectionnavigator-addform-icon",title:bizagi.localization.getResource("render-collection-navigator-add-form")});break;case"edit":i=$.tmpl(t,{actionClass:"bz-collectionnavigator-editform",buttonClass:"ui-icon bz-collectionnavigator-editform-icon",title:bizagi.localization.getResource("render-collection-navigator-edit-form")});break;case"details":i=$.tmpl(t,{actionClass:"bz-collectionnavigator-detailform",buttonClass:"ui-icon bz-collectionnavigator-detailform-icon",title:bizagi.localization.getResource("render-collection-navigator-details-form")})}return i},paginationActions:function(e){var t=this;$(e).hasClass("bz-navigation-next")&&t.isValidRow()?$.when(t.saveChanges()).done((function(){t.showRow(t.getNextRow())})):$(e).hasClass("bz-navigation-previous")&&t.isValidRow()?$.when(t.saveChanges()).done((function(){t.showRow(t.getPreviousRow())})):$(e).hasClass("bz-navigation-first")&&t.isValidRow()?$.when(t.saveChanges()).done((function(){t.showRow(t.getFirstRow())})):$(e).hasClass("bz-navigation-last")&&t.isValidRow()?$.when(t.saveChanges()).done((function(){t.showRow(t.getLastRow())})):$(e).hasClass("bz-navigation-remove")?t.hasData()&&t.removeRow():$(e).hasClass("bz-navigation-add")&&(t.hasData()&&t.isValidRow()?$.when(t.saveChanges()).done((function(){t.addInlineRow()})):t.hasData()||t.addInlineRow())}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.ecm.prototype),bizagi.rendering.desktop.ecm.extend("bizagi.rendering.desktop.ecm",{},{renderControl:function(e,t){},postRender:function(){var e=this.getControl(),t=this.properties,i=this.getResource("dateFormat"),r=this.getResource("timeFormat"),a=this.getMode();if(this._super(),t.maxSize=Number(t.maxSize)||("undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):t.maxSize=Number(t.maxSize)||4091904),t.maxFiles=Number(t.maxfiles)||999,t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var n=t.validExtensions.split(";"),o=0,s=n.length;o<s;o++)n[o]="*."+n[o];t.validExtensions=n.join(";")}t.addUrl=t.addUrl||this.dataService.getUploadAddUrl(),t.deleteUrl=t.deleteUrl||void 0,t.allowDelete=null===bizagi.util.parseBoolean(t.allowDelete)||bizagi.util.parseBoolean(t.allowDelete),t.q_xpath=bizagi.util.encodeXpath(this.getUploadXpath()),t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||i,t.timeFormat=t.timeFormat||r,t.fullFormat=t.dateFormat,t.datePickerFormat=t.dateFormat.replaceAll("M","m"),t.datePickerFormat=t.datePickerFormat.replaceAll("yyyy","yy"),t.datePickerFormat=t.datePickerFormat.replaceAll("dddd","DD"),t.datePickerFormat=t.datePickerFormat.replaceAll("mmmm","MM"),this.files=t.value||[],this.filesCount=this.files.length,t.xpathContext=this.parent.properties.xpathContext||t.xpathContext||"",e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-upload"),e.addClass("ui-bizagi-render-ecm"),$(e).closest(".ui-bizagi-control-wrapper").addClass("ui-bizagi-control-wrapper-ecm"),this.properties.showRenderOptions=!0,"execution"==a?this.renderUploadItem():e.append("<div class='ui-icon ecm-file'></div>"),this.checkMaxFiles(),this.preventDefaultForAnchorTag()},configureHandlers:function(){var e=this.getControl();this._super(),data=this.buildAddParams(),data.networkSpeed=networkSpeed(),$(".biz-render-ecm-upload-wrapper",e).bizagiUpload({renderReference:this,dialogTemplate:this.renderFactory.getTemplate("upload.ecm.dialog"),properties:data,uploadedFiles:this.filesCount,isECM:!0,onUploadFileCompletedCallback:this.onUploadFileCompleted,dialogTitle:this.getResource("render-upload-link-label")})},configureUploadHandlers:function(e,t,i){var r=e,a=r.buildUpgradeParams(i);$(i).bizagiUpload({renderReference:r,dialogTemplate:r.renderFactory.getTemplate("upload.ecm.dialog"),properties:a,uploadedFiles:r.filesCount,isECM:!0,isUpdatingECM:!0,onUploadFileCompletedCallback:r.onUpdateUploadFileCompleted,dialogTitle:r.getResource("render-upload-link-label")})},onUpdateUploadFileCompleted:function(e,t,i,r){var a=e;i.empty(),a.waiting(i,!0),a.filesCount++,a.renderFileLayout(a,t,i,r)},renderUploadItem:function(e,t){var i=this,r=i.getMode(),a=i.getControl(),n=i.renderFactory.getTemplate("upload-ecm-view-default"),o=i.properties;o.value=t?[[t.idFileUpload,t.fileName]]:i.value,void 0===t||void 0===t.status||"error"!=t.status?$.when($.tmpl(n,o,{getFileExtension:i.getFileExtension,isImage:i.isImage,allowSendInMail:o.allowSendInMail})).done((function(n){e&&e.length>0?n.insertAfter(e.last()):a.append(n),a.find(".uploadifyQueueItem").remove(),null!=i.properties.value&&$.each(i.properties.value,(function(e,n){var o={};o.idFileUpload=n[0]||n.uploadId,o.fileName=n[1]||n.fileName,o.idPageCache=i.properties.idPageCache,o.xpathContext=i.getXpathContext(),o.xPath=i.properties.xpath,o.idAttrib=i.properties.idAttrib,"execution"==r&&i.renderFileLayout(i,o,$("."+i.properties.id+"-"+o.idFileUpload,a),t)})),i.properties.allowSendInMail&&i.bindEmailDialog()})):bizagi.showMessageBox(t.message)},bindEmailDialog:function(){var e=this.getControl(),t=this.getXpathContext()||"",i=this.properties.xpath;$(".ui-bizagi-render-ecm-sendmail",e).bizagiSendEmail({tmpl:this.renderFactory.getTemplate("dialog-send-email"),value:this.value,self:this,dataService:this.dataService,properties:this.properties,xpath:i,xpathContext:t})},renderFileLayout:function(e,t,i,r){var a=(e=e||this).getFormContainer(),n=e.renderFactory.getTemplate("upload-ecm-view-default-metadata"),o={zIndex:$.getMaxZindex()+1},s=$.extend({},t),l=r?[r]:e.dataService.metadataECMMultiaction().getFileProperties(s);$.when(e.dataService.metadataECMMultiaction().getECMMetadata(t),l).done((function(r,s){e.waiting(i,!0),Array.isArray(s)&&(s=s[0]),Array.isArray(r)&&(r=r[0]),s.data=t,s.xpathContext=s.xpathContext||a.properties.xpathContext||"",s.xpath=e.properties.xpath,r.filename=t.fileName,r.ecm_ecmStatus=s.ecmStatus,r.ecm_isVisible=s.isVisible,r.ecm_allowUpdateMetadata=s.allowUpdateMetadata,r.ecm_allowDelete=s.allowDelete,r.ecm_allowUpdateContent=s.allowUpdateContent,r.ecm_allowView=s.allowView,r.ecm_allowCheckOut=s.allowCheckOut,r.ecm_allowCancelCheckOut=s.allowCancelCheckOut,r.ecm_allowEdit=s.allowEdit,r.idFileUploads=s.idFileUpload,r.xpath=s.xpath,r.value=bizagi.util.parseBoolean(s.value);var l=i.parent().find(".extension:last");if(e.isImage(r.filename)){l.empty(),l.append("<img>");var d=l.find("img");l.addClass("thumb-image"),e.requestFile({id:r.idFileUploads,filename:r.filename},!1).then((function(e){d.attr({src:e,width:32,height:32})})),d.imageZoom(o),$(".checkuot , .readonly",i.parent()).off("click").on("click",(function(){d.click()}))}else i.parent().find("li:first").off("click").on("click",(function(t){t.stopPropagation(),e.requestFile({id:r.idFileUploads,filename:r.filename},!0)}));if(s.isVisible){i.empty();var u=$.extend(r,{showMetadata:e.properties.showMetadata,orientation:a.properties.orientation||"ltr"});$.when($.tmpl(n,u).appendTo(i)).done((function(){switch($(".ecm-options-slide li",i).hover((function(){$(this).toggleClass("ecm-options-slide-hover")})),$(".filename_download",i).off("click").on("click",(function(t){t.stopPropagation(),e.requestFile({id:r.idFileUploads,filename:r.filename},!0)})),e.isImage(r.filename)&&$(".filename a",i).imageZoom(o),e.setControlEvents(i,t),r.ecm_allowUpdateContent&&e.configureUploadHandlers(e,t,i,s),s.ecmStatus){case 1:break;case 2:i.parent().find(".checkuot").css("visibility","hidden"),i.parent().find(".checkuot").hide();break;case 3:break;case 4:$(".emc-options",i).hide(),i.parent().find(".readonly").css("visibility","visible"),i.parent().find(".readonly").show();break;case 5:i.parent().find(".checkuot").css("visibility","visible"),i.parent().find(".checkuot").show();break;case 6:bizagi.debug("ECM control return undefined status",s);break;default:i.parent().find(".checkuot").css("visibility","hidden").hide(),i.parent().find(".readonly").css("visibility","hidden").hide()}if(bizagi.util.parseBoolean(e.properties.editable)){var a=!0;i.data("pluginAvailable",!1),$(".emc-options",i).on("click",(function(n){if(n.stopPropagation(),a){a=!1;$.when(function(i){var a=new $.Deferred,n=$(".modal-ecm",i),o=e.control;if(n.is(":visible"))$(".modal-ecm",o).hide(),$(".ecm-options-slide",n).hide(),n.hide(),a.resolve(!0);else{var s=function(){$(".modal-ecm",o).hide(),$(".ecm-options-slide",n).show(),n.show().position({my:"center top",at:"center bottom",of:$(".emc-options",i),collision:"none"})};e.configureToggleHandlers(),a.resolve(!0),void 0!==e.properties.isAsync?(r.ecm_allowUpdateContent||$(".ecm-options-upgrade",n).hide(),void 0===e.asynCheckEnabled&&(e.asynCheckEnabled=!0,e.asyncCheckTimeout=setTimeout((function(){e.asynCheckEnabled=void 0,e.asyncCheckTimeout=void 0,clearTimeout(e.asyncCheckTimeout)}),2e3),t.IsFileOnECM?s():($(".ecm-options-checkout",n).hide(),$(".ecm-options-cancelcheckout",n).hide(),$(".ecm-options-upgrade",n).hide(),$.when(e.dataService.isFileOnECM({idUpload:t.idFileUpload})).done((function(e){e.IsFileOnECM&&(r.ecm_allowUpdateContent&&$(".ecm-options-upgrade",n).show(),r.ecm_allowCheckOut&&$(".ecm-options-checkout",n).show(),r.ecm_allowCancelCheckOut&&$(".ecm-options-cancelcheckout",n).show()),t.IsFileOnECM=e.IsFileOnECM,s()})).fail((function(e){bizagi.log("isFileOnECM error")}))))):s()}return a.promise()}(i)).done((function(){a=!0}))}}))}else $(".emc-options",i).hide(),$(e.getControl()).trigger("ecmLoaded",{container:l})}))}}))},requestFile:function(e,t){var i=this;t=void 0===t||t;var r=i.properties;return i.dataService.getFile({idRender:r.id,xpath:r.xpath,xpathContext:i.getXpathContext(),idPageCache:r.idPageCache,fileId:e.id,contexttype:r.contexttype}).then((function(e){return bizagi.util.handleJSONResponse(e)})).then((function(i){if(!t)return window.URL.createObjectURL(i);bizagi.util.downloadBlobFile(i,e.filename)})).fail((function(e){var t=i.getFormContainer();t&&t.failHandler(e)}))},setControlEvents:function(e,t){var i=this,r=(i.properties,i.getControl());$(".ecm-options-delete",e).on("click",(function(a){a.stopPropagation(),$(".emc-options",e).click(),$(".biz-render-ecm-delete-confirmation",r).first().clone().dialog({resizable:!1,modal:!0,title:i.getResource("render-ecm-confirm-title"),buttons:[{text:i.getResource("render-ecm-confirm-bt-delete"),click:function(){delete t.prepare,i.dataService.deleteECMFile(t),$(this).dialog("close"),e.parent("ul").hide("highlight",{},100);for(var r=[].concat(i.files),a=0;a<r.length;a++)r[a][0]==t.idFileUpload&&r.splice(a,1);i.setValue(r),i.checkMaxFiles()}},{text:i.getResource("render-ecm-confirm-bt-cancel"),click:function(){$(this).dialog("close")}}]})})),$(".ecm-options-cancelcheckout",e).on("click",(function(r){r.stopPropagation(),$(".emc-options",e).click(),i.waiting(e,!1),e.find(".filename").empty(),delete t.prepare,$.when(i.dataService.cancelCheckOut(t)).done((function(r){i.renderFileLayout(i,t,e,r)}))})),$(".ecm-options-checkout",e).off("click").on("click",(function(r){r.stopPropagation(),$(".meta-data-wrapper",e).click(),i.waiting(e,!1),e.find(".filename").empty(),delete t.prepare,$.when(i.dataService.checkOutFile(t)).done((function(r){i.renderFileLayout(i,t,e,r)}))})),4!=$(".ecm-metadata-value",e).data("ecmstatus")&&$(".ecm-metadata-value",e).data("allowupdatemetadata")&&$(".ecm-metadata-value",e).bind("activeeditmode",(function(t){if(t.stopPropagation(),!$(this).data("readonly")&&("false"==$(this).data("edit-mode")||""==$(this).data("edit-mode")))switch($(this).data("edit-mode","true"),$(this).data("metadatatype")){case"STRING":i.makeStringMetaDataControler($(this),e);break;case"INTEGER":i.makeStringMetaDataControler($(this),e,(function(e){var t=e.match(/\d+/);return null!=t&&t[0]==t.input}));break;case"DATETIME":i.makeDatetimeMetaDataControler($(this),e);break;case"DECIMAL":i.makeStringMetaDataControler($(this),e,(function(e,t){var r=i.getResource("numericFormat"),a=new RegExp("\\d+(\\"+r.decimalSymbol+"\\d)*"),n=e.match(a);try{var o=e.substr(e.length-1,1)}catch(e){return!1}return null!=n&&(n[0]==n.input||o==r.decimalSymbol)}));break;case"BOOL":i.makeBooleanMetaDataControler($(this),e);break;default:i.makeStringMetaDataControler($(this),e)}})),$(".ecm-metadata-done",e).on("click",(function(e){e.stopPropagation();var t=$(this).parent("td"),r=$(".ecm-metadata-field-edit",t),a="",n="";switch(t.data("metadatatype")){case"STRING":case"DECIMAL":case"INTEGER":a=$(".ecm-metadata-input",t).val(),n=$(".ecm-metadata-input",t).val();break;case"BOOL":a=$(".biz-render-ecm-upload-boolean input:checked",t).val(),n=bizagi.util.parseBoolean(a)?"True":"False",a="False"==a?i.getResource("render-boolean-no"):i.getResource("render-boolean-yes");break;case"DATETIME":if(a=$(".ecm-metadata-input",t).val()){var o=bizagi.util.dateFormatter.getDateFromFormat(a,i.properties.datePickerFormat);n=bizagi.util.dateFormatter.formatInvariant(o,!0)}}t.data("value",n);var s=$("<span></span>").addClass("ecm-metadata-text").text(a);r.replaceWith(s),$(".ecm-metadata-edit",t).css("display","block"),$(".ecm-metadata-done",t).hide(),$(".ecm-metadata-cancel",t).hide(),t.data("edit-mode","false")})),$(".ecm-options-edit",e).on("click",(function(r,a){var n=e,o=a&&a.checkData||!1;if(r.stopPropagation(),"block"===$(".emc-options",e).css("display")&&$(".modal-ecm",e).hide(),!(o&&i.isValidFields(n)||"true"==$(".ecm-options-edit",n).data("editmode"))){$(".ecm-options-edit",n).data("editmode","true");var s=i.renderFactory.getTemplate("upload-ecm-view-default-edit-buttons"),l=[],d=$.tmpl(s);$(".ecm-metadata-value[data-allowUpdateMetadata=true]",e).trigger("activeeditmode"),d.insertAfter($("table",e)),$(".biz-render-ecm-metadata-edit",e).show(500),$(".biz-render-ecm-metadata-edit button:first",e).on("click",(function(r){var a=!1,n=e;r.stopPropagation(),$.each($(".ecm-metadata-value[data-mandatory='true']",e),(function(e,t){var r;""===(r="BOOL"==$(t).data("metadatatype")?$(".biz-render-ecm-upload-boolean input:checked",t).val():$(t).find(".ecm-metadata-field-edit").val())||null===r?($(t).find("input").attr("placeholder",i.getResource("render-ecm-tooltip-mandatory")),$(t).parent().find(".ecm-metadata-key").addClass("mandatory-error"),$(t).parent().effect("highlight",500),a=!0):$(t).parent().find(".ecm-metadata-key").removeClass("mandatory-error")})),a||($(".ecm-metadata-done",e).click(),$(".biz-render-ecm-metadata-edit",e).hide(300,(function(){$(".biz-render-ecm-metadata-edit",e).remove()})),$.each($(".ecm-metadata-value",e),(function(t,i){l.push({idMetadata:$($(".ecm-metadata-key",e)[t]).data("idmetadata"),value:$(i).data("value")})})),t.metaValues=JSON.encode({metadataValues:l}),delete t.prepare,$.when(i.dataService.updateECMMetadata(t)).done((function(e){$(".ecm-options-edit",n).data("editmode","false")})))})),$(".biz-render-ecm-metadata-edit button:last",e).on("click",(function(t){var i=e;t.stopPropagation(),$(".ecm-metadata-cancel",e).click(),$(".biz-render-ecm-metadata-edit button:first",e).unbind("click"),$(".ecm-options-slide",i).is(":visible")&&$(".emc-options",e).click(),$(".biz-render-ecm-metadata-edit",e).hide(500,(function(){$(".biz-render-ecm-metadata-edit",e).remove()})),$(".ecm-options-edit",i).data("editmode","false")}))}})),$(".ecm-metadata-cancel",e).on("click",(function(e){e.stopPropagation();var t=$(this).parent("td"),i=$(".ecm-metadata-field-edit",t),r=$("<span></span>").addClass("ecm-metadata-text").text(i.data("original-value"));i.replaceWith(r),$(".ecm-metadata-edit",t).css("display","block"),$(".ecm-metadata-done",t).hide(),$(".ecm-metadata-cancel",t).hide(),t.data("edit-mode","false")}))},makeStringMetaDataControler:function(e,t,i){var r=$(".ecm-metadata-text",e),a=$("<input></input>").addClass("ecm-metadata-field-edit ecm-metadata-input").val(r.text());a.data("original-value",r.text()),r.replaceWith(a),a.focus(),$(".ecm-metadata-edit",e).hide(),$(".ecm-metadata-done",e).css("visibility","visible").show(),$(".ecm-metadata-cancel",e).css("visibility","visible").show(),$(".ecm-metadata-input",e).bind("keyup",(function(e){var t=a.val();i&&(i(t)||""==t?a.data("latestdonevalue",t):a.val(a.data("latestdonevalue")||""))}))},makeDatetimeMetaDataControler:function(e,t){var i=$(".ecm-metadata-text",e),r=$("<input></input>").addClass("ecm-metadata-field-edit ecm-metadata-input").val(i.text());r.data("original-value",i.text()),i.replaceWith(r),r.datepicker({dateFormat:this.properties.datePickerFormat,changeYear:!0,onSelect:function(e,t){r.val(e+" 00:00 AM")}}),$(".ecm-metadata-edit",e).hide(),$(".ecm-metadata-done",e).css("visibility","visible").show(),$(".ecm-metadata-cancel",e).css("visibility","visible").show(),$(".ecm-metadata-input",e).bind("keypress",(function(e){13==e.keyCode&&$(".ecm-metadata-done",t).trigger("click")}))},makeDecimalMetaDataControler:function(e,t){this.getResource("decimalSymbol");this.makeStringMetaDataControler($(this),t,(function(e,t){var i=new RegExp("\\d+(\\"+t+"\\d)*"),r=e.match(i);return null!=r&&(r[0]==r.input||null==r[1])}))},makeBooleanMetaDataControler:function(e,t){var i=this.renderFactory.getTemplate("upload-ecm-view-default-yesno"),r=$(".ecm-metadata-text",e),a=$(e).data("value")||!1,n=!!bizagi.util.parseBoolean(a),o=Math.ceil(100*Math.random()),s=$.tmpl(i,{id:this.properties.id,checked:n,rnd:o});s.data("original-value",r.text()),r.replaceWith(s),$(".ecm-metadata-edit",e).hide(),$(".ecm-metadata-done",e).css("visibility","visible").show(),$(".ecm-metadata-cancel",e).css("visibility","visible").show()},isImage:function(e){var t=this.getFileExtension(e);return $.inArray(t.toUpperCase(),["JPG","JPEG","GIF","PNG","BMP"])>-1},postRenderReadOnly:function(){var e=this.getControl();"execution"==this.getMode()?(e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-upload"),$(".biz-render-ecm-upload-wrapper",e).remove(),this.properties.showRenderOptions=!1,this.renderUploadItem(),$(".emc-options",e).remove()):e.append("<div class='ui-icon upload-file'></div>")},buildAddParams:function(){var e=this.properties,t={url:e.addUrl,xPath:e.xpath,idAttrib:e.idAttrib,xpathContext:e.xpathContext,metaValues:[],idPageCache:e.idPageCache,folder:BIZAGI_PATH_TO_BASE,contexttype:e.contexttype,validExtensions:e.validExtensions,maxSize:e.maxSize},i={};return $.extend(i,i,t),t.scriptData=i,t},buildUpgradeParams:function(e){var t=this.properties,i={url:t.editUrl,xPath:t.xpath,idFileUpload:$(".ecm-options-upgrade > input",e).data("idfileupload"),idPageCache:t.idPageCache,idAttrib:t.idAttrib,xpathContext:this.getXpathContext(),folder:BIZAGI_PATH_TO_BASE,validExtensions:t.validExtensions,maxSize:t.maxSize},r={};return $.extend(r,r,i),i.scriptData=r,i},checkMaxFiles:function(){var e=this.properties,t=this.getControl(),i=$(".biz-render-ecm-upload-wrapper",t);e.maxFiles>0&&this.filesCount>=e.maxFiles?i.hide():this.filesCount<e.maxFiles&&i.show()},onUploadFileCompleted:function(e,t){var i=e,r=i.getControl();if("error"!=t.type){i.properties.showRenderOptions=!1;var a=$(".biz-render-ecm-view-default",r);a=a.length>0?a:$(".biz-render-ecm-delete-confirmation",r),i.filesCount=i.filesCount+1,i.checkMaxFiles();var n=[].concat(i.files);n.push([t.idFileUpload,t.fileName]),i.setValue(n,!1),i.triggerRenderChange(),i.renderUploadItem(a,t)}else t.isMaintenanceWindow||bizagi.showMessageBox(t.message)},isValid:function(e){var t=this.getControl(),i=[],r=!1,a=this.properties,n=!0,o=this.grid&&this.grid.isFromCreatedRow.apply(this),s=!((a.required||a.editable)&&!o)||this._super(e);if(a.required&&(n=!!o||s,0==this.filesCount&&n&&(e.push({xPath:a.xpath,message:this.getResource("render-required-text").replaceAll("#label#",a.displayName)}),n=!1)),a.editable&&(n=!!o||s,!o)){var l=$("ul:visible",t).find(".ecm-metadata-value[data-mandatory='true']");$.each(l,(function(e,t){""==$(".ecm-metadata-text",t).text()&&(i.push($(t).data("mandatoryfield")),r=!0)}))}if(r){var d=this.getResource("render-required-text").replaceAll("#label#",i.join(", "));e.push({xPath:a.xpath,message:d}),"true"!=$(".ecm-options-edit",t).data("editmode")&&$(".ecm-options-edit",t).trigger("click",{checkData:!0})}return n},cleanData:function(){this.setValue(null),this.clearDisplayValue()},clearDisplayValue:function(){var e=this,t=e.getControl().find(".biz-render-ecm-view-default");t.length;$.each(t,(function(t,i){var r=$(i),a=r.data();a&&$.when(e.deleteUploadItem(r,a.id)).done((function(){r.remove(),e.triggerRenderChange()}))})),t.hide(),e.filesCount=0,e.checkMaxFiles()},waiting:function(e,t){e.find(".ecm-file-name").css("visibility",t?"visible":"hidden"),e.find("table").css("visibility",t?"visible":"hidden"),e.css("background",t?"":"transparent"),t?e.removeClass("waiting"):e.addClass("waiting")},configureToggleHandlers:function(){$(document.body).off("click").on("click",(function(e){$(e.target).hasClass("emc-options")||$(e.target).hasClass("ui-icon-gear")||($(".modal-ecm",this).hide(),$("#content-wrapper, .bz-rn-grid-data-wraper").unbind("scroll"),$(document.body).unbind("click"))})),$("#content-wrapper, .bz-rn-grid-data-wraper, .ui-bizagi-dialog-search").off("scroll").on("scroll",(function(e){$(e.target).hasClass("emc-options")||$(e.target).hasClass("ui-icon-gear")||($(".modal-ecm",this).hide(),$(document.body).unbind("click"),$("#content-wrapper, .bz-rn-grid-data-wraper").unbind("scroll"))}))},isValidFields:function(e){var t=!0,i=$(e).find(".ecm-metadata-value[data-mandatory='true']");return $.each(i,(function(e,i){var r=$(".ecm-metadata-text",i).text();bizagi.util.isEmpty(r)&&(t=!1)})),t}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.grid.bizagi",bizagi.rendering.grid.prototype),bizagi.rendering.desktop.grid.bizagi.extend("bizagi.rendering.desktop.grid.bizagi",{},{initializeData:function(e){this.isRTLDirection=this.isRTLOrientation(this.parent,e&&e.properties?e.properties.orientation:""),e.properties.orientation=this.isRTLDirection?"rtl":e.properties.orientation,this.showActionColumn(e),e.properties.singleInstance=!1,this._super(e),this.cellMetadata={},this.pendingActions=[];var t=this.properties;this.collapseState=t.collapseState,t.displayType="vertical",t.labelAlign="left"},showActionColumn:function(e){var t=this.getMode(),i=this.getFormContainer(),r=e.properties||{},a=null==bizagi.util.parseBoolean(r.editable)||bizagi.util.parseBoolean(r.editable),n=null!=bizagi.util.parseBoolean(r.columnActions)&&bizagi.util.parseBoolean(r.columnActions);if(i.getParams()&&i.getParams().printversion&&(n=!1),this.columnActionParams={columnActions:n,allowDelete:!(void 0!==r.allowDelete||!a),allowEdit:!(void 0!==r.allowEdit||!a),allowDetail:void 0!==r.allowDetail,withEditForm:void 0!==r.withEditForm},!e.properties.hideActionsColumn&&"execution"===t){var o={render:{properties:{id:"e51580f3-fd6c-49c0-8c69-73dff93723e5",type:"columnActions","xpath-column":'constant("")',displayName:"",submitOnChange:!1,totalize:{format:{}},hasTotalizer:!1,preventDefault:!0,columnwidth:"24px",headerStyles:{header:"width: 24px",label:"width: 24px"},cssclass:"bz-grid-header-actions"}}};this.isRTLDirection?(e.elements.push(o),this.spliceRowData(e.properties.data)):(e.elements.splice(0,0,o),this.spliceRowData(e.properties.data,1),this.spliceRowDataVisible(e.properties.data,1),this.spliceRowDataEditable(e.properties.data,1))}},hasActions:function(e){return void 0!==this.columnActionParams&&(this.columnActionParams.columnActions&&(this.columnActionParams.allowDelete||this.columnActionParams.allowEdit&&this.columnActionParams.withEditForm||this.columnActionParams.allowDetail))},getGridTemplate:function(){return this.renderFactory.getTemplate("grid.bizagi")},postRender:function(){var e=this,t=e.properties,i=e.getControl();this._super();var r=e.grid=$(">div",i),a=e.buildColumnModel();for(var n in e.getLabel().hide(),e.cleanNewRecords(),e.applyGridPlugin(),t.data&&(""===t.data||0===t.data.rows.length&&t.data.page>1?e.fetchData(void 0,e.sortBy,e.sortType):(e.updateData(t.data),$.when(e.ready()).done((function(){e.triggerRenderChange({changed:!1})})))),e.initialLoadDone=!0,e.pendingActions)"function"==typeof e.pendingActions[n].method&&e.pendingActions[n].method.apply(e,e.pendingActions[n].arguments);var o=$("[data-bizagi-component='buttons'] li[title!='']",e.getControl());o.tooltip(),(o=$("[data-bizagi-component='cellContent'] button[title!='']",e.getControl())).tooltip(),$("[data-bizagi-component='columns'] th > div[title!='']",e.getControl()).tooltip(),e.applyColumnsWidth(r,a)},changeFontBold:function(){return this},applyGridPlugin:function(){var e=this,t=e.grid,i=e.properties,r=e.getMode(),a=e.renderFactory.getTemplate("bizagi.grid.pagination"),n=e.getFormContainer(),o=n.container;n.params&&"search"==n.params.context&&n.parent&&n.parent.params&&n.parent.params.canvas?o=n.parent.params.canvas:n.params&&n.params.canvas&&(o=n.params.canvas);var s="scroll"==o.css("overflow-y")||"auto"==o.css("overflow-y")?o:o.scrollParent();t.bizagi_grid_desktop({columns:e.buildColumnModel(),showSummary:i.showSummary,title:i.displayName,mode:e.getMode(),scrollableArea:s,floatingHeader:i.floatingHeader||!1,hasExclusiveCheck:i.hasExclusiveCheck||!1,tableCssClass:"",sortBy:i.sortBy||"",collapse:"execution"===r,collapseState:"execution"===r&&e.collapseState,buttonsPst:"execution"===r&&i.buttonsPst,sortOrder:i.sortOrder||"",smartPagination:!0,sortType:bizagi.override.gridDefaultSortBy||"asc",isSortable:i.isSortable,headerStyles:e.getHeaderStyles(),orientation:i.orientation||"ltr",template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),gridRtl:e.renderFactory.getTemplate("bizagi.grid.grid.rtl"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),rowButtonsRtl:e.renderFactory.getTemplate("bizagi.grid.row.buttons.rtl"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:a,buttons:e.renderFactory.getTemplate("bizagi.grid.buttons"),buttonsRtl:e.renderFactory.getTemplate("bizagi.grid.buttons.rtl"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),summary:e.renderFactory.getTemplate("bizagi.grid.summary"),summaryCell:e.renderFactory.getTemplate("bizagi.grid.summaryCell"),exportOptions:e.renderFactory.getTemplate("bizagi.grid.exportOptions")},actions:{add:i.allowAdd,edit:i.allowEdit&&i.withEditForm&&null!=i.data,remove:i.allowDelete,details:i.allowDetail,inlineAdd:i.inlineAdd,allowMore:i.allowMore,enableXlsExport:i.enableXlsExport,enablePdfExport:i.enablePdfExport},tooltips:{addLabel:i.addLabel,editLabel:i.editLabel,deleteLabel:i.deleteLabel,detailLabel:i.detailLabel,exportOptionsLabel:i.exportOptionsLabel},isValid:function(){var t=[],i=e.getFormContainer();if(void 0!==i.validationController&&i.validationController.clearValidationMessages(),e.isValid(t),t.length>0){for(var r=0;r<t.length;r++)i.validationController.showValidationMessage(t[r].message,t[r].xpath);return!1}return!0},pageRequested:function(t){if("execution"===r){var i=e.changes&&Object.keys(e.changes).length>=1||e.exclusiveChanges&&Object.keys(e.exclusiveChanges).length>=1;!e.isSummaryOrGlobalForm()&&i?$.when(e.getFormContainer().saveForm()).done((function(){e.sortRequestedPage(t)})):e.sortRequestedPage(t)}},sortRequested:function(t){if("execution"==r&&void 0!==t.sortBy){var i,a=e.getColumn(t.sortBy);a?i=a.getSortName():(a=e.getColumn(t.sortBy.split(".")[0]))&&(i=a.getSortName()),t.sortBy.split(".").length>1&&t.sortBy.split(".")[0]==i&&(i=t.sortBy),e.fetchData(t.page,i,t.sortType)}},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){"execution"==r&&e.triggerHandler("rowSelected",{id:t.key})},addRow:function(){"execution"==r&&e.addRow.apply(e,arguments)},editRow:function(t){"execution"==r&&e.properties.withEditForm&&e.editRow(t.key)},deleteRow:function(t){"execution"==r&&e.deleteRow(t.key)},moreRows:function(t){"execution"==r&&e.moreRows(t)},saveAddedRows:function(t){$.when(e.saveInlineAddedRows(t.keys)).done((function(){e.properties.inlineEdit?$.when(e.saveRows()).done((function(){e.refresh(),e.properties.canBeExported=!0})):e.refresh()}))},beforeInlineAdd:function(){e.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(){e.inlineAddDeferred&&(e.inlineAddDeferred.resolve(),e.properties.canBeExported=!$("li[data-action='save']",e.grid).is(":visible"))},showFormDetails:function(t){e.showFormDetails(t.key)},cancelEdition:function(t){t.refresh=!0,e.removeNewRecords(t)},removeNewRecords:function(t){e.removeNewRecords(t)},showGridExportOptions:function(){e.showGridExportOptions()},performExportGrid:function(t){e.performExportGrid(t)},performCollapseGrid:function(){e.performCollapseGrid()},rowdblclick:function(t){"execution"==r&&e.canEditRow()&&e.editRow(t.businessKey)}})},triggerGridPluginHandler:function(){try{var e=Array.prototype.slice.call(arguments,0);return this.grid.bizagi_grid_desktop.apply(this.grid,e)}catch(e){}},postRenderReadOnly:function(){this.postRender()},buildColumnModel:function(){var e=this.columns,t=[];return t.push({name:"id",index:0,label:"id",hidden:!0,key:!0,tooltip:""}),$.each(e,(function(e,i){i.columnIndex=e+1;var r=bizagi.util.normalizeType(i.properties.type),a=bizagi.util.isEmpty(i.properties.displayName)?" ":i.properties.displayName,n={name:i.properties.xpath,index:e+1,label:a,key:!1,tooltip:i.properties.tooltip||"",hidden:!i.properties.visible||/columnHidden/i.test(r)||0==i.properties.columnVisible,summarizeBy:i.properties.totalize&&i.properties.totalize.operation?i.properties.totalize.operation:void 0,bizAgiProperties:i.properties};t.push(n)})),t},refresh:function(){this.parent&&this.parent.properties&&this.parent.properties.searchParams&&this.parent.properties.searchParams.searchTriggeredBy?this.fetchData(1):this.fetchData()},dataReady:function(){return null!=this.dataReadyDeferred?this.dataReadyDeferred.promise():null},loadChanges:function(e){for(var t=0;t<e.length;t++){var i=this.changes[e[t][0]];if(this.exclusiveChanges&&(i=$.extend(i||{},this.getExclusiveChangeByRow(e[t][0]))),void 0!==i)for(var r in i)if(i.hasOwnProperty(r)){var a=this.getColumn(r);e[t][a.columnIndex]=this.mapChangeValue(a.properties.type,i[r],a.comboData)}}},mapChangeValue:function(e,t,i){i=i||[];var r=t;if(null!=t&&("columnCombo"==e||"columnRadio"==e)&&!bizagi.util.isArray(t)){var a=i.find((function(e){return e.id==t}));a&&(r=[[a.id,a.value]])}return r},updateData:function(e){var t=this.grid,i=this.columns;e&&(this.properties.data=e,this.setCellOverrides(e,i),this.triggerGridPluginHandler("setData",e),this.applyColumnsWidthUpdate(t,i),this.processLayout(isLabelFormat,this.properties.textFormat||{}),this.processLayout(!isLabelFormat,this.properties.valueFormat||{}))},fetchData:function(e,t,i){var r=this,a=r.properties;r.dataReadyDeferred=new $.Deferred,r.sortBy=t,r.sortType=i,e=e||a.page||1,t=t||a.sortBy||"",i=i||a.sortOrder||"asc",a.page=e,a.sortBy=t,a.sortType=i,a.sort=t+" "+i,r.startLoading(),$.when(r.getRemoteData()).then((function(e){r.endLoading(),r.disposed||e&&(a.hideActionsColumn||(r.isRTLDirection?r.spliceRowData(e):(r.spliceRowData(e,1),r.spliceRowDataVisible(e,1),r.spliceRowDataEditable(e,1))),r.isRTL()&&(e.rows=r.removeRemainingColumns(e.rows,r.columns.length),e.rows=r.changeOrderData(e.rows)),r.loadChanges(e.rows),r.updateData(e),!1===r.properties.changed&&"delete"!==r.properties.method||(r.triggerRenderChange({changed:!1}),delete r.properties.changed,delete r.properties.method),r.properties.textFormat&&void 0!==r.properties.textFormat.color&&$(".bz-rn-grid-header-title, .bz-rn-grid-header-title-rtl",r.grid).style("color",r.properties.textFormat.color,"important"),r.properties.textFormat&&void 0!==r.properties.textFormat.background&&($(".bz-rn-grid-cn-header, .bz-rn-grid-cn-header-rtl",r.grid).css("backgroundColor",r.properties.textFormat.background),$(".bz-rn-grid-container-foother, .bz-rn-grid-container-foother-rtl",r.grid).css("backgroundColor",r.properties.textFormat.background)),$("th",r.grid).css("fontWeight","400"),r.dataReadyDeferred.resolve())})).fail((function(e){r.endLoading()}))},isReadyToSave:function(){var e=this;if(e.grid&&e.properties.inlineAdd&&(e.properties.allowEdit||this.hasNewRecordsToSave())){var t=[],i=e.triggerGridPluginHandler("getNewRowKeys"),r=e.getFormContainer();if(i&&i.length>0&&e.isValid(t))return e.properties.alreadySaved=!0,e.saveInlineAddedRows(i).then((function(){e.refresh()}));if(t.length>0){var a=$.Deferred();return t.forEach((function(e,t){r.validationController.showValidationMessage(e.message,e.xpath)})),a.reject("error"),a.promise()}}return null},collectData:function(e){var t,i,r=this,a=r.getFormContainer(),n=a?a.getLastActionButton():{},o=n&&"next"===n.action,s=[];if(r.grid&&(r.properties.inlineAdd||r.properties.inlineEdit)){try{i=(i=r.triggerGridPluginHandler("getNewRowKeys"))||[]}catch(e){i=[]}if(i&&i.length>0&&o&&(r.properties.alreadySaved=!1,!r.isValid(s)))return e;i&&i.length>0&&!r.properties.alreadySaved&&r.isValid(s)&&(t=r.saveInlineAddedRows(i).then((function(){r.refresh()})),e.deferreds=e.deferreds||[],e.deferreds.push(t)),i&&i.length>0&&!r.isValid(s)&&t&&r.cleanNewRecords();for(var l=0;l<i.length;l++)r.changes[i[l]]&&delete r.changes[i[l]]}r._super(e)},sortRequestedPage:function(e){var t,i=this.getColumn(e.sortBy);i?t=i.getSortName():(i=this.getColumn(e.sortBy.split(".")[0]))&&(t=i.getSortName()),e.sortBy.split(".").length>1&&e.sortBy.split(".")[0]==t&&(t=e.sortBy),this.fetchData(e.page,t,e.sortType)},drawCell:function(e,t,i,r){if(e.key)return i;var a=this.getCellOverride(t,e.index-1),n=e.index-1,o=this.columns[n];this.newRecords=this.newRecords||{},this.cellMetadata[t]||(this.cellMetadata[t]={}),this.cellMetadata[t][n]||(this.cellMetadata[t][n]={});var s=this.cellMetadata[t][n].properties||o.properties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;return l=a.visible,d=!!s.editable&&a.editable,r&&"columnFormLink"!==e.bizAgiProperties.type&&(d=!0),o.properties.displayType="value","columnActions"===e.bizAgiProperties.type&&(d=!0),"summary"==t&&(d=!1),l?d?this.drawEditableCell(o,s,t,i,r):this.drawReadonlyCell(o,s,t,i):(this.drawReadonlyCell(o,s,t,i),"<label></label>")},drawEditableCell:function(e,t,i,r,a){var n=this,o=new $.Deferred,s=e.properties.editable;return e.properties.editable=!0,e.overrideProperties({required:t.required}),$.when(e.render(i,r)).done((function(t){a&&!n.newRecords[i]&&(n.newRecords[i]={});for(var r=0;r<n.columns.length;r++)n.cellOverrides[i]=n.cellOverrides[i]||{},n.getCellOverride(i,r).visible=null==n.getCellOverride(i,r).visible||n.getCellOverride(i,r).visible;e.getDecorated(i).unbind("renderchange.draweditable").bind("renderchange.draweditable",(function(r,a){n.onCellChange(e,t,i,a)})),o.resolve(t)})),e.properties.editable=s,o.promise()},drawReadonlyCell:function(e,t,i,r){var a="";if("summary"===i){var n=e.properties.textFormat;e.properties.totalize&&(e.properties.textFormat=e.properties.totalize.format),a=e.renderSummary(i,r),e.properties.textFormat=n}else a=e.renderReadOnly(i,r);return a},onCellChange:function(e,t,i,r){var a,n=this,o=e.getValue(i),s=e.getCompositeValue(i),l=n.triggerGridPluginHandler("isNewRecord",i),d=!l,u=e.properties.type;try{if("columnDate"==u&&1==e.data.properties.showTime)if(bizagi.util.isEmpty(o))""===o&&(o="");else{var c=bizagi.util.dateFormatter.getDateFromInvariant(o,!0);o=bizagi.util.dateFormatter.formatInvariant(c,!0)}else if("columnDate"==u)if(bizagi.util.isEmpty(o))""===o&&(o="");else(c=bizagi.util.dateFormatter.getDateFromInvariant(o,!1)).setHours(0,0,0,0),o=bizagi.util.dateFormatter.formatInvariant(c,!0);else if("columnSearch"===u){var p=!1;if(n.properties.submitOnChange&&(p=e.properties.advancedSearch||!1),l&&n.properties.inlineAdd&&p){n.collectGridChange($.extend(r,{id:i,xpath:e.properties.xpath||e.properties.id,value:o,compositeValue:s,columnIndex:e.columnIndex,trigger:d,dataType:u,renderId:e.properties.id}));try{a=n.triggerGridPluginHandler("getNewRowKeys")}catch(e){a=[]}r.render.startActionExecution();for(var h=n.saveInlineAddedRows(a),g=0;g<a.length;g++)n.changes[a[g]]&&delete n.changes[a[g]];return void $.when(h).done((function(){bizagi.util.isEmpty(n.changes)?n.refresh():$.when(n.saveRows()).done((function(){n.refresh()})),r.render.endActionExecution()}))}}var m="columnBoolean"===u&&e.properties.isExclusive;m||!n.properties.allowEdit&&!l||n.collectGridChange($.extend(r,{id:i,xpath:e.properties.xpath||e.properties.id,value:o,compositeValue:s,columnIndex:e.columnIndex,trigger:d,dataType:u,renderId:e.properties.id})),m&&n.properties.allowEdit&&n.triggerGridPluginHandler("deleteCellExclusiveValues",e.columnIndex),n.triggerGridPluginHandler("changeCellValue",i,e.columnIndex,o),e.properties.totalize&&e.properties.totalize.operation&&n.triggerGridPluginHandler("refreshSummary",e.columnIndex)}catch(e){bizagi.log(e.message)}},onCellReady:function(e,t,i,r){var a=e.index-1,n=this.getCellOverride(t,a),o=this.columns[a],s=this.cellMetadata[t][a].properties||o.properties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;if(l=n.visible,e.bizAgiProperties.columnwidth&&(/boolean/i.test(e.bizAgiProperties.type)?$(i).css({"min-width":e.bizAgiProperties.columnwidth,width:e.bizAgiProperties.columnwidth}):$(i).css({"min-width":e.bizAgiProperties.columnwidth,"max-width":e.bizAgiProperties.columnwidth})),"summary"==t&&(d=!1),r&&(d=!0),"columnActions"===e.bizAgiProperties.type&&(d=!0),l)if(d){var u=o.properties.editable;if(o.properties.editable=d,o.properties.submitOnChange){var c=o.getDecorated(t);c&&(c.properties.submitOnChangexpathContext=this.properties.xpath+"[]",c.properties.submitOnChangexpathContextRow=this.properties.xpath+"[id="+t+"]")}o.postRender(t,i),o.properties.editable=u}else"summary"==t?o.postRenderSummary(t,i)||this.applySummaryColumnStyles(i,s):o.postRenderReadOnly(t,i)},getAlignClass:function(e){switch(e){case"right":return"ui-bizagi-grid-align-right";case"left":return"ui-bizagi-grid-align-left";case"center":return"ui-bizagi-grid-align-center";case"justify":return"ui-bizagi-grid-align-justify"}},addRow:function(e){var t=this,i=t.properties,r="rtl"==i.orientation,a=[];if(e){if(e.open)return;e.open=!0}$.when(t.submitAddRequest()).done((function(n){var o=new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:i.addLabel,orientation:i.orientation||"ltr",maximized:bizagi.override.maximizeGridPopup||!1,onSave:function(e){return i.contextType&&(e[t.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=i.contextType),t.submitSaveRequest(n,e)},onCancel:function(){}});a[0]={text:bizagi.localization.getResource("render-form-dialog-box-save"),click:function(e){return i.contextType&&(e[t.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=i.contextType),t.submitSaveRequest(n,e)}},a[1]={text:bizagi.localization.getResource("render-form-dialog-box-cancel"),click:function(){t.submitRollbackRequest()}},r&&a.reverse();var s=i.xpath+"[id="+n+"]";o.render({idRender:i.id,recordXPath:s,xpathContext:i.xpathContext,idPageCache:i.idPageCache,requestedForm:"addForm",contextType:i.contextType,url:i.addPage,fromRender:t,mainForm:t.getMainForm(t.getFormContainer())}).done((function(e){t.addExclusiveChange(n,e),t.startLoading(),i.submitOnChange?t.submitOnChange().always((function(){t.endLoading()})):t.fetchData()})).fail((function(i){e.open=!1,$.when(t.submitRollbackRequest(i)).done((function(){t.submitInvalidatePageCacheRequest(i)}))}))}))},canEditRow:function(){var e=this.properties;return e.allowEdit&&e.withEditForm&&null!=e.data},editRow:function(e){if(0!=e&&null!=e){var t=this,i=t.properties;if(void 0!==t.changes[e]||t.exclusiveChanges&&Object.keys(t.exclusiveChanges).length>=1){var r=$.extend(t.changes[e],{});r.idPageCache=i.idPageCache,r.disableServerGridValidations=!0,$(".ui-tooltip").remove(),$.when(t.submitSaveRequest(e,r)).done((function(){t.startLoading(),i.submitOnChange?t.submitForGridChange().always((function(){t.endLoading(),t.executeSubmitEditRequest(e,(function(i){t.addExclusiveChange(e,i)}))})):t.fetchData()}))}else t.executeSubmitEditRequest(e,(function(i){t.addExclusiveChange(e,i)}))}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},getHeaderStyles:function(){var e="",t="",i=this.properties;if(i.headerFormat){var r=i.headerFormat;if(r.color&&(e+="color: "+r.color+" !important;"),r.background&&(t+="background-color: "+r.background+";"),e+="font-weight: "+(r.bold?"bold; ":"normal; "),r.italic&&(e+="font-style: italic; "),r.underline||r.strikethru)e+="text-decoration: "+(bizagi.util.parseBoolean(r.strikethru)?"line-through ":"")+(bizagi.util.parseBoolean(r.underline)?"underline ":"")+";";if(r.size&&"0"!=r.size)e+="font-size: "+(100+10*Number(r.size)+"%")+";"}return{label:e,header:t}},editInlineRow:function(e){var t=this.getControl();if(0!=e&&null!=e){var i=$("[data-bizagi-component=buttons]",t);i.find("[data-action=save]").css("display","inline-block"),i.find("[data-action=cancel]").css("display","inline-block"),this.changeRowEditable(e,!0)}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},changeRowEditable:function(e,t){},changeCellBackgroundColor:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeCellBackgroundColor(i)}else r.pendingActions.push({method:r.changeCellBackgroundColor,arguments:arguments})},changeCellColor:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeColor(i)}else r.pendingActions.push({method:r.changeCellColor,arguments:arguments})},changeCellVisibility:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a){a.changeCellVisibility(i);var n=(r.columns||[]).findIndex((function(e){return r.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0,o=r.getColumn(t),s=o&&o.properties.columnVisible&&i;r.cellOverrides[e]=r.cellOverrides[e]||{},r.getCellOverride(e,n).visible=s}}else r.pendingActions.push({method:r.changeCellVisibility,arguments:arguments})},changeCellEditability:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a&&a.control){a.changeEditabilityCellControl(i,e,t);var n=(r.columns||[]).findIndex((function(e){return r.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0;r.cellOverrides[e]=r.cellOverrides[e]||{},r.getCellOverride(e,n).editable=i}}else r.pendingActions.push({method:r.changeEditability,arguments:arguments})},changeColumnEditability:function(e,t){var i=this;if(i.initialLoadDone){var r=i.getColumn(e);r&&(r.properties.editable="Default"===t?i.originalProperties.editable:bizagi.util.parseBoolean(t))}else i.pendingActions.push({method:i.changeEditability,arguments:arguments})},changeColumnVisibility:function(e,t){var i=this;if(i.initialLoadDone){var r=i.getColumn(e);r&&(r.properties.visible="Default"===t?i.originalProperties.visible:bizagi.util.parseBoolean(t))}else i.pendingActions.push({method:i.changeCellVisibility,arguments:arguments})},changeColumnRequired:function(e,t){var i=this;if(i.initialLoadDone){var r=i.getColumn(e);r&&(r.properties.required="Default"===t?i.originalProperties.required:bizagi.util.parseBoolean(t))}else i.pendingActions.push({method:i.changeCellRequired,arguments:arguments})},afterToRefresh:function(){var e,t=this,i=Array.prototype.slice.call(arguments);bizagi.override.enableGridRefreshAfterCellRefresh&&i[0]&&bizagi.util.isObject(i[0])&&"refreshCell"==i[0].action&&(e=t.getFormContainer(),$.when(e.getLoaderPromise()).done((function(){e.actionController.refreshControl(t.properties.xpath,e.properties.xpathContext,"refresh")})))},cleanCellData:function(e,t){var i=this;if(i.initialLoadDone){var r=i.getControlCell(e,t);if(r)return $.when(r.cleanData()).then((function(){for(var r=(i.columns||[]).findIndex((function(e){return i.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0,a=i.properties.data.rows,n=0,o=a.length;n<o;n++)if(Number(e)===a[n][0]){a[n][r+1]="";break}i.cellOverrides[e]=i.cellOverrides[e]||{},i.getCellOverride(e,r).value=null}))}else i.pendingActions.push({method:i.cleanData,arguments:""})},changeCellRequired:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a){a.changeCellRequired(i);var n=(r.columns||[]).findIndex((function(e){return r.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0;r.cellOverrides[e]=r.cellOverrides[e]||{},r.getCellOverride(e,n).required=i}}else r.pendingActions.push({method:r.changeCellRequired,arguments:arguments})},changeCellValue:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a){a.setDisplayValue(i);var n=a.column||{},o=n.properties&&n.properties.type,s=r.getCellValueFormatted(n,n.getValue(e));a.triggerHandler("renderchange",{render:r,changed:!0}),r.collectGridChange({id:e,xpath:n.properties.xpath,value:s,compositeValue:n.getCompositeValue(e),columnIndex:a.columnIndex,trigger:!1,dataType:o,renderId:n.properties.id})}}else r.pendingActions.push({method:r.setDisplayValue,arguments:arguments})},changeCellMaxValue:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeMaxValue(i)}else r.pendingActions.push({method:r.changeMaxValue,arguments:arguments})},changeCellMinValue:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeMinValue(i)}else r.pendingActions.push({method:r.changeMinValue,arguments:arguments})},deleteRow:function(e){var t=this;e&&0!=e?bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){t.startLoading(),$.when(t.saveRows()).then((function(){return $.when(t.submitDeleteRequest(e)).then((function(i){if(t.removeNewRecords({keys:[e]}),"success"==i.type)for(var r in t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e}),t.enabledChecks){var a=t.enabledChecks[r],n=a.findIndex((function(t){return t.id==e}));a.splice(n,1)}t.properties.changed=!1,t.properties.method="delete",t.calculateFetchData(i,e)}))})).always((function(){t.endLoading()}))})):bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},calculateFetchData:function(e,t){var i,r=this.properties;return"success"===e.type&&1===(i=r.data&&r.data.rows).length&&i[0][0]===Number(t)&&r.page>1?this.fetchData(r.page-1):this.fetchData()},saveRows:function(){var e={},t=this.getFormContainer();return this.collectData(e),$.isEmptyObject(e)?void 0:this.dataService.submitData({action:"SUBMITDATA",data:e,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache})},moreRows:function(e){var t=this,i=t.properties;void 0===i.originalrowsPerPage&&(i.originalrowsPerPage=i.rowsPerPage),i.rowsPerPage+=i.originalrowsPerPage;var r={};t.collectData(r),jQuery.isEmptyObject(r)?t.moreRowsCommon(e):t.dataService.submitData({action:"SUBMITDATA",data:r,idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,idPageCache:i.idPageCache}).done((function(){t.moreRowsCommon(e)}))},moreRowsCommon:function(e){var t=this,i=t.properties;t.fetchData(e.page,e.sortBy,e.sortType),$.when(t.dataReadyDeferred).done((function(){0!=i.records&&i.records+1<=i.rowsPerPage&&$(".ui-bizagi-grid-dynamic-pager",t.getControl()).hide()}))},executeSubmitEditRequest:function(e,t){var i=this,r=i.properties,a="rtl"==r.orientation,n=[],o=1!=i.getFormContainer().properties.displayAsReadOnly;$.when(i.submitEditRequest(e)).done((function(){var s=r.xpath+"[id="+e+"]",l=new bizagi.rendering.dialog.form(i.dataService,i.renderFactory,{title:r.editLabel,showSaveButton:o,orientation:r.orientation||"ltr",maximized:bizagi.override.maximizeGridPopup||!1,onSave:function(t){return i.submitSaveRequest(e,t)},extraButtons:bizagi.override.enablePrintFromEditForm?{"workportal-widget-dialog-box-print":function(){i.printFormCommand=new bizagi.workportal.command.printform(i.renderFactory);var e={idRender:r.id,recordXPath:s,xpathContext:r.xpathContext,idPageCache:r.idPageCache,requestedForm:"editForm",contextType:r.contextType,fileName:r.displayName};i.printFormCommand.print(e)}}:{}});n[0]={text:bizagi.localization.getResource("render-form-dialog-box-save"),click:function(t){return i.submitSaveRequest(e,t)}},a&&n.reverse(),l.render({idRender:r.id,recordXPath:s,xpathContext:r.xpathContext,idPageCache:r.idPageCache,requestedForm:"editForm",url:r.editPage,contextType:r.contextType}).done((function(e){t&&t(e),i.startLoading(),r.submitOnChange?i.submitOnChange().always((function(){i.endLoading()})):i.fetchData()})).fail((function(e){$.when(i.submitRollbackRequest(e)).done((function(){i.submitInvalidatePageCacheRequest(e)}))}))}))},showFormDetails:function(e){var t=this.properties;if(0!=e&&null!=e){var i=new bizagi.rendering.dialog.form(this.dataService,this.renderFactory,{title:t.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!1,maximized:bizagi.override.maximizeGridPopup||!1,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close")}),r=t.xpath+"[id="+e+"]";i.render({idRender:t.id,recordXPath:r,xpathContext:t.xpathContext,idPageCache:t.idPageCache,requestedForm:"detailForm",url:t.editPage,editable:!1})}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},saveInlineAddedRows:function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.prepareAddAction(e[i]));this.properties.alreadySaved=!0;var r=this.getFormContainer(),a=new $.Deferred;return r.useOrSetLoaderDeferred(),r.appendWaitForLoader({promise:a.promise()}),$.when.apply($,t).always((function(){a.resolve()}))},prepareAddAction:function(e){var t=this,i=t.properties,r=t.changes[e];return t.dataService.multiaction().addGridRecordData({url:i.addUrl,idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,contexttype:i.contexttype,idPageCache:i.idPageCache,submitData:r}).then((function(i){return delete t.changes[e],delete t.cellOverrides[e],delete t.newRecords[e],t.setRowAsSaved(e),i}))},removeNewRecords:function(e){var t=this,i=!1;e&&e.refresh&&(i=t.changes&&Object.keys(t.changes).length>0&&!t.isValid([])),e&&e.keys&&$.each(e.keys,(function(e,i){t.newRecords[i]&&delete t.newRecords[i]})),i&&(t.properties.changed=!1,t.refresh())},showGridExportOptions:function(){var e,t=this.getControl(),i=[],r=this.getFormContainer(),a=!0===this.properties.buttonsPst?"top":"bottom",n="rtl"===this.properties.orientation,o=n?".ui-bizagi-grid-export-options-wrapper-rtl":".ui-bizagi-grid-export-options-wrapper",s=n?".ui-bizagi-grid-export-options-content-rtl":".ui-bizagi-grid-export-options-content";if(e=!0===this.properties.buttonsPst?$(o,t).outerHeight():-1*$(s,t).outerHeight(),$(s,t).css(a,e),$(s,t).hasClass("hidden")?($(s,t).removeClass("hidden"),$(s,t).show()):$(s,t).addClass("hidden"),r)if(this.hasChanged(i)&&!1===this.properties.alreadySaved&&r.properties.editable||!1===this.properties.canBeExported&&r.properties.editable){var l=$("li[data-action='save']",this.grid).is(":visible");!this.hasChanged(i)&&!1===this.properties.alreadySaved&&!l||this.canBeExport()?this.properties.canBeExported=!0:1===Object.keys(this.changes).length&&this.changes.summary||($("#print-grid-save-first",t).show(),$("#print-grid-pdf",t).hide(),$("#print-grid-xls",t).hide())}else this.properties.canBeExported=!0},performCollapseGrid:function(){var e=this.getControl(),t="rtl"===this.properties.orientation,i=t?".bz-rn-grid-cn-header-rtl":".bz-rn-grid-cn-header",r=$(".bz-rn-grid-wrapper",e),a=$(i+" .ui-icon",e);t||$(".bz-rn-grid-cn-header",e).toggleClass("bz-rn-grid-header-state-collapsed").toggleClass("bz-rn-grid-header-state-active");a.toggleClass("ui-state-collapse").toggleClass("ui-state-expand"),r.toggleClass("bz-rn-grid-body-collapse"),this.collapseState=r.hasClass("bz-rn-grid-body-collapse"),this.triggerGridPluginHandler("updateCollapseState",this.collapseState),this.updateCollapseState()},updateCollapseState:function(){var e=this.properties,t={url:e.dataUrl,xpath:e.xpath,idRender:e.id,xpathContext:e.xpathContext,contexttype:e.contextType,idPageCache:e.idPageCache,collapseState:this.collapseState};return this.dataService.multiaction().getCollapseData(t)},performExportGrid:function(e){var t=this,i=!0;if("pdfExport"===e.exportType){var r=t.checkAdobePlugin();$.browser.msie&&!r&&(i=!1,$.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-acrobat-message"))).done((function(){t.downloadExportedGrid(e)})))}i&&t.downloadExportedGrid(e)},updateAffectedCellManually:function(e,t,i){this.columns.length;var r=this.getRowIndexByKey(e);if(void 0!==r&&this.properties.data.rows[r][i]!==t){this.properties.data.rows[r][i]=t;var a=$(".ui-bizagi-grid-summary",this.grid);a.empty(),a.html(this.grid.bizagi_grid_desktop("drawSummary")),this.grid.bizagi_grid_desktop("postRenderSummary",a)}},getRowIndexByKey:function(e){for(var t=this.properties.data.rows.length;t-- >0;)if(e==this.properties.data.rows[t][0])return t},checkAdobePlugin:function(){var e;try{e=new ActiveXObject("AcroPDF.PDF")}catch(e){bizagi.log(e)}if(!e)try{e=new ActiveXObject("PDF.PdfCtrl")}catch(e){bizagi.log(e)}return e},downloadExportedGrid:function(e){var t=this;t.getGridExportFile(e).then((function(i){var r=t.properties.displayName;r+="xlsExport"===e.exportType?".xlsx":".pdf",bizagi.util.downloadBlobFile(i,r)})).fail((function(e){var i=t.getFormContainer();i&&i.failHandler(e)}))},formatGrid:function(e){var t=$(".ui-bizagi-grid-table",e),i=$(".ui-jqgrid-titlebar-close",e);$("th.ui-bizagi-column-hidden, td.ui-bizagi-grid-key, .bz-rn-grid-container-foother",e).remove(),$("[data-action], ul li, .ui-bizagi-grid-column, tr, th",t).unbind("click"),$(i).remove()},ready:function(){var e=this._super(),t=this.inlineAddDeferred?this.inlineAddDeferred.promise():null;return $.when(e,t)},applyColumnsWidth:function(e,t){for(var i=0;i<t.length;i++){var r=e.find(".resizableColumn")[i];if(r){var a=1==$(r).find(">.ui-bizagi-grid-column").length?Number($(r).find(">.ui-bizagi-grid-column").data("column-index")):i,n=t[a].bizAgiProperties.columnwidth,o="auto";t[a].bizAgiProperties&&n&&"auto"!=n&&(o=n),$(r).css("width",o),$(r).find(".ui-bizagi-grid-column").css("width","auto")}}},applyColumnsWidthUpdate:function(e,t){for(var i=null,r=null,a=null,n=null,o=e.find(".resizableColumn"),s=o.length,l=0;l<s;l++)r=o[l],a=t[i=1==$(r).find(">.ui-bizagi-grid-column").length?Number($(r).find(">.ui-bizagi-grid-column").data("column-index"))-1:l].properties.columnwidth,n="auto",t[i].properties&&a&&"auto"!=a&&(n=a),$(r).css("width",n),$(r).find(".ui-bizagi-grid-column").css("width","auto")},applySummaryColumnStyles:function(e,t){var i=e.find(".ui-bizagi-grid-summary-readonly");if(null!=t.totalize&&null!=t.totalize.format){var r=t.totalize.format,a="";if(r.background&&(e.css("background-color",r.background),e.css("background-image","none")),r.size&&"0"!=r.size){var n=r.size.toString(),o=n.substring(0,1),s=n.substring(1,n.length);s="+"==o?100+10*Number(s):100-10*Number(s),i.css("font-size",s+"%")}r.italic&&i.css("font-style","italic"),r.color&&$("label",i).css("color",r.color),r.underline&&(a+="underline "),r.strikethru&&(a+="line-through"),1!=r.bold&&null!=r.bold||i.css("font-weight","bold"),i.css("text-decoration",a)}},getContainerIcons:function(){return $("> .ui-bizagi-control > .ui-bizagi-control-wrapper > .ui-bizagi-render-icons",this.element)},changeColor:function(e,t){var i=this,r=i.getControl(),a=i.getLabel();t=void 0===t&&null==t||t;if(r&&a)if("none"!=e)if("value"!==i.properties.displayType&&t){if(i.element.each((function(){this.style.setProperty("color",e,"important")})),i.getControl().find("[data-bizagi-component=header] span").each((function(){this.style.setProperty("color",e,"important")})),i.getLabel().find("label").css("color",e,"!important"),!i.properties.editable){var n=i.getControl();i.getElementsToStylize(n).css("color",e,"!important"),bizagi.override&&!0===bizagi.override.enableColorHeaderGrid&&i.hasColorHeader()&&(n=n.find("[data-bizagi-component=rows]")),i.getElementsToStylize($("label",n).css("color",e,"!important"))}}else i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getControl().find("*").each((function(t,r){i.getElementsToStylize(r).css("color",e,"!important")}));else this._super(e,t)},hasNewRecordsToSave:function(){var e;try{e=this.triggerGridPluginHandler("getNewRowKeys")}catch(t){e=[]}return e&&e.length>0&&!this.properties.alreadySaved},getCellValueFormatted:function(e,t){var i=t;if("columnDate"===e.properties.type){var r=e.data.properties;if(bizagi.util.isEmpty(i))""===t&&(i="");else{var a=bizagi.util.dateFormatter.getDateFromInvariant(i,r.showTime);void 0!==a&&0!==a&&(r.showTime||a.setHours(0,0,0,0),i=bizagi.util.dateFormatter.formatInvariant(a,!0))}}return i},addExclusiveChange:function(e,t){if(this.properties.hasExclusiveCheck)for(var i in t){var r=this.columns.find((function(e){return e.properties.xpath==i})),a=t[i];r&&r.properties.isExclusive&&a&&(this.exclusiveChanges[i]={xpath:i,simpleXpath:i,value:a,key:e})}}}),bizagi.rendering.desktop.grid.bizagi.extend("bizagi.rendering.desktop.grid.grouped",{},{initializeData:function(e){e.properties.hideActionsColumn=!0,e.properties=this.convertProperties(e.properties),e.properties.singleInstance=!1,this._super(e),this.cellMetadata={},this.pendingActions=[];var t=this.properties;t.withEditForm=t.allowEdit,this.collapseState=t.collapseState,t.displayType="vertical",t.labelAlign="left"},drawCell:function(e,t,i,r){if(e.key)return i;var a=this.getCellOverride(t,e.index-1),n=e.index-1,o=this.columns[n];this.newRecords=this.newRecords||{},this.cellMetadata[t]||(this.cellMetadata[t]={}),this.cellMetadata[t][n]||(this.cellMetadata[t][n]={});var s=this.cellMetadata[t][n].properties||o.originalProperties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;return l=a.visible,d=!!s.editable&&a.editable,r&&(d=!0),o.properties.displayType="value","string"==typeof t&&t.indexOf("summary")>=0&&(d=!1),l?d?this.drawEditableCell(o,s,t,i,r):this.drawReadonlyCell(o,s,t,i):"<label></label>"},drawReadonlyCell:function(e,t,i,r){var a="";if("string"==typeof i&&i.indexOf("summary")>=0){var n=e.properties.textFormat;e.properties.totalize&&(e.properties.textFormat=e.properties.totalize.format),a=e.renderSummary(i,r),e.properties.textFormat=n}else a=e.renderReadOnly(i,r);return a},onCellReady:function(e,t,i,r){var a=e.index-1,n=this.columns[a],o=this.cellMetadata[t][a].properties||n.originalProperties,s=void 0===o.visible||o.visible,l=void 0===o.editable||o.editable;if("string"==typeof t&&t.indexOf("summary")>=0&&(l=!1),r&&(l=!0),s)if(l){var d=n.properties.editable;if(n.properties.editable=l,n.properties.submitOnChange){var u=n.getDecorated(t);u&&(u.properties.submitOnChangexpathContext=this.properties.xpath+"[]")}n.postRender(t,i),n.properties.editable=d}else"string"==typeof t&&t.indexOf("summary")>=0?n.postRenderSummary(t,i)||this.applySummaryColumnStyles(i,o):n.postRenderReadOnly(t,i)},convertProperties:function(e){return e.inlineAdd=!1,e.inlineEdit=!1,e},changeFontBold:function(){return this},applyGridPlugin:function(){var e=this,t=e.grid,i=e.properties,r=e.getMode(),a=e.renderFactory.getTemplate("bizagi.grid.pagination"),n=e.getFormContainer().params.canvas.scrollParent();t.bizagi_grid_grouped_desktop({columns:e.buildColumnModel(),showSummary:i.showSummary,title:i.displayName,mode:e.getMode(),scrollableArea:n,floatingHeader:i.floatingHeader||!1,tableCssClass:"",sortBy:i.sortBy||"",sortOrder:i.sortOrder||"",isSortable:i.isSortable,smartPagination:!0,collapse:"execution"===r,collapseState:"execution"===r&&e.collapseState,buttonsPst:"execution"===r&&i.buttonsPst,sortType:bizagi.override.gridDefaultSortBy||"asc",headerStyles:e.getHeaderStyles(),groupByColumns:e.groupByColumns()||[],template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.grouped.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.grouped.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.grouped.row"),headerRow:e.renderFactory.getTemplate("bizagi.grid.grouped.header.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),emptyCell:e.renderFactory.getTemplate("bizagi.grid.grouped.emptyCell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:a,buttons:e.renderFactory.getTemplate("bizagi.grid.buttons"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),summary:e.renderFactory.getTemplate("bizagi.grid.grouped.summary"),summaryCell:e.renderFactory.getTemplate("bizagi.grid.grouped.summaryCell"),exportOptions:e.renderFactory.getTemplate("bizagi.grid.exportOptions")},actions:{add:i.allowAdd,edit:i.allowEdit&&i.withEditForm&&null!=i.data,remove:i.allowDelete,details:i.allowDetail,inlineAdd:i.inlineAdd,allowMore:i.allowMore,enableXlsExport:i.enableXlsExport,enablePdfExport:i.enablePdfExport},tooltips:{addLabel:i.addLabel,editLabel:i.editLabel,deleteLabel:i.deleteLabel,detailLabel:i.detailLabel,exportOptionsLabel:i.exportOptionsLabel},isValid:function(){var t=[],i=e.getFormContainer();if(void 0!==i.validationController&&i.validationController.clearValidationMessages(),e.isValid(t),t.length>0){for(var r=0;r<t.length;r++)i.validationController.showValidationMessage(t[r].message,t[r].xpath);return!1}return!0},pageRequested:function(t){if("execution"===r){var i,a=e.getColumn(t.sortBy);a?i=a.getSortName():(a=e.getColumn(t.sortBy.split(".")[0]))&&(i=a.getSortName()),t.sortBy.split(".").length>1&&t.sortBy.split(".")[0]==i&&(i=t.sortBy),e.fetchData(t.page,i,t.sortType)}},sortRequested:function(t){if("execution"===r){var i,a=e.getColumn(t.sortBy);a?i=a.getSortName():(a=e.getColumn(t.sortBy.split(".")[0]))&&(i=a.getSortName()),t.sortBy.split(".").length>1&&t.sortBy.split(".")[0]==i&&(i=t.sortBy),e.fetchData(t.page,i,t.sortType)}},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){"execution"===r&&e.triggerHandler("rowSelected",{id:t.key})},addRow:function(){"execution"===r&&e.addRow.apply(e,arguments)},editRow:function(t){"execution"===r&&e.properties.withEditForm&&e.editRow(t.key)},deleteRow:function(t){"execution"===r&&e.deleteRow(t.key)},moreRows:function(t){"execution"===r&&e.moreRows(t)},saveAddedRows:function(t){e.saveInlineAddedRows(t.keys).done((function(){e.refresh()}))},beforeInlineAdd:function(){e.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(){e.inlineAddDeferred&&e.inlineAddDeferred.resolve()},showFormDetails:function(t){e.showFormDetails(t.key)},cancelEdition:function(t){e.removeNewRecords(t)},removeNewRecords:function(t){e.removeNewRecords(t)},showGridExportOptions:function(){e.showGridExportOptions()},performExportGrid:function(t){e.performExportGrid(t)},performCollapseGrid:function(){e.performCollapseGrid()},rowdblclick:function(t){"execution"==r&&e.canEditRow()&&e.editRow(t.businessKey)}})},groupByColumns:function(){for(var e=[],t=0,i=this.columns.length;t<i;t++){this.columns[t].properties.groupBy&&e.push(t+1)}return e},triggerGridPluginHandler:function(){var e=this,t=Array.prototype.slice.call(arguments,0);return e.grid.bizagi_grid_grouped_desktop.apply(e.grid,t)},fetchData:function(e,t,i){var r=this,a=r.properties;r.dataReadyDeferred=new $.Deferred,e=e||a.page||1,t=t||a.sortBy||"id",i=i||a.sortOrder||"asc",a.page=e,a.sortBy=t,a.sortType=i,a.sort=t+" "+i,r.startLoading(),$.when(r.getRemoteData()).then((function(e){r.endLoading(),r.disposed||e&&(r.loadChanges(e.rows),r.updateData(e),r.triggerRenderChange(),r.dataReadyDeferred.resolve())}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.search",bizagi.rendering.search.prototype),bizagi.rendering.desktop.search.extend("bizagi.rendering.desktop.search",{ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,CLEAR_SEARCH_ID:-3,NO_RESULTS_SEARCH_ID:-4,SEARCH_DELAY:750,SEARCH_MAX_RECORDS:50},{initializeData:function(e){this._super(e);var t=this.properties;t.searchImage=t.searchImage||this.dataService.getSearchDefaultImage(),this.deferredReference=null},postRender:function(){var e=this.getControl();this._super(),this.searchInput=$("input",e),this.advancedSearch=$("button",e),this.properties.advancedSearch&&e.addClass("ui-bizagi-advanced-search"),this.applyAutocompletePlugin()},postRenderReadOnly:function(){this.setDisplayValue(this.properties.value)},configureHandlers:function(){var e=this;e._super();var t=e.searchInput;if(t.bind("autocompleteselect",(function(i,r){if(r.item.id==e.Class.ADVANCED_SEARCH_ID||r.item.id==e.Class.ADVANCED_ADDITION_ID||r.item.id==e.Class.CLEAR_SEARCH_ID||r.item.id==e.Class.NO_RESULTS_SEARCH_ID)return!1;if(e.setValue(r.item),e.selectedValue=r.item.value,r.item.value=e.formatItem(r.item.value),document.selection){t.focus();var a=document.selection.createRange();a.moveStart("character",-e.selectedValue.length),a.moveStart("character",0),a.moveEnd("character",e.selectedValue.length),a.select()}return!0})),e.bind("onSearchError",(function(t,i){var r=e.getFormContainer();r.clearValidationMessages();try{var a=e.properties.displayName+": ";a+=JSON.parse(i.responseText).message,r.addValidationMessage(a,"","ui-icon-alert")}catch(t){r.addValidationMessage(i)}e.hideAutocompleteLoading()})),t.click((function(){t.autocomplete("widget").is(":visible")?t.autocomplete("close"):t.autocomplete("search",$(t).val())})),e.advancedSearch.click((function(){e.showSearchDialog()})),!e.properties.advancedSearch){t.on("blur",(function(t){if(""===this.value&&e.properties.allowClear){var i={id:""};e.setDisplayValue(i),e.setValue(i)}else e.setDisplayValue(e.getValue())}))}},applyAutocompletePlugin:function(){var e=this,t=e.searchInput,i=e.getFormContainer().properties.orientation,r="rtl"==i?"right":"left",a="rtl"==i?" suggest-rtl":"",n="sg-"+e.properties.id;t.autocomplete({autoFocus:!0,messages:{noResults:null,results:function(){}},search:function(e,t){},source:function(t,i){e.activeRequestTerm=t.term;var r=(new Date).getTime(),a=encodeURIComponent(t.term),n=e.properties.xpath+"_"+a+"_expire",o=e.properties.xpath+"_"+a,s=bizagi.util.getItemLocalStorage(n);if(s&&e.properties.enableLocalStorage&&r<s)try{i(JSON.parse(bizagi.util.getItemLocalStorage(o))),e.hideAutocompleteLoading()}catch(r){e.processRequest(t,i)}else e.processRequest(t,i)},open:function(){var i=t.data("ui-autocomplete").menu.element,o=t.closest(".ui-bizagi-control"),s=o.parent(),l=e.calculateSuggestionWidth();$("li",i).each((function(){$(this).addClass(a),$(this).index()%2<1&&$(this).addClass("biz-ui-even")})),i.css({top:0,left:0}),i.attr("id",n),o.addClass("ac-is-visible"),s.addClass("ac-is-visible ac-clear-floats");var d=i.appendTo(o);if(e.isPreferencesDialog(o)){var u=$(o.closest(".ui-dialog-content")),c=d.offset().top-u.offset().top,p=d.offset().left-u.offset().left,h=$("#wrapper-"+n);h&&h.length>0&&h.remove();var g=$("<div/>",{id:"wrapper-"+n,css:{position:"absolute",top:c,left:p}});g.appendTo(u),$(d).appendTo(g)}d.position({my:r+" top",at:r+" bottom",of:this,collision:"flipfit"}),d.css("z-index",$.getMaxZindex()+10),d.attr("visible",!0),$(".ui-bizagi-render-search-item",d).width(l),$(".ui-bizagi-render-search-item-label",d).width(l),d.width(l),e.hideAutocompleteLoading()},close:function(){t.data("ui-autocomplete").menu.element.attr("visible",!1)},delay:this.Class.SEARCH_DELAY}),t.data("ui-autocomplete")._renderItem=function(t,i){return i.id==e.Class.CLEAR_SEARCH_ID?e.renderClearItem(t,i).appendTo(t):i.id==e.Class.ADVANCED_SEARCH_ID?e.renderAdvancedItem(t,i).appendTo(t):i.id==e.Class.ADVANCED_ADDITION_ID?e.renderAddItem(t,i).appendTo(t):e.renderSearchItem(i).appendTo(t)},t.data("ui-autocomplete")._resizeMenu=function(){this.menu.element.outerWidth(this.element.outerWidth())}},renderSearchItem:function(e){var t=this.properties,i=this.renderFactory.getTemplate("searchItem"),r=$.tmpl(i,{image:t.searchImage,label:e.label,orientation:this.properties.orientation||"lrt"});return r.data("item.autocomplete",e),r},renderAdvancedItem:function(){var e=this,t=e.renderSearchItem({id:e.Class.ADVANCED_SEARCH_ID,label:this.getResource("render-search-advanced-label")});return t.click((function(){e.showSearchDialog()})),t},renderClearItem:function(){var e=this,t=e.renderSearchItem({id:e.Class.CLEAR_SEARCH_ID,label:this.getResource("render-search-clear-label")});return t.click((function(){var t={id:""};e.setDisplayValue(t),e.setValue(t)})),t},renderAddItem:function(){var e={id:this.Class.ADVANCED_ADDITION_ID,label:this.getResource("render-search-add-label")};return this.renderSearchItem(e)},processRequest:function(e,t){var i=this,r=i.properties,a=[];function n(e,a){r.allowClear&&void 0!==i.value&&e.push({id:i.Class.CLEAR_SEARCH_ID,label:"",value:""}),r.advancedSearch&&e.push({id:i.Class.ADVANCED_SEARCH_ID,label:"",value:""}),r.allowAdd&&e.push({id:i.Class.ADVANCED_ADDITION_ID,label:"",value:""});var n=(new Date).getTime()+i.properties.expireCache,o=encodeURIComponent(a);if(i.properties.enableLocalStorage){var s=i.properties.xpath+"_"+o+"_expire",l=i.properties.xpath+"_"+o;bizagi.util.setItemLocalStorage(s,n),bizagi.util.setItemLocalStorage(l,JSON.encode(e))}t(e)}i.properties.allowSuggest&&e.term.length>=i.properties.searchLength?(i.showAutocompleteLoading(),r.term=e.term,this.deferredReference&&"function"==typeof this.deferredReference.reject&&"resolved"!==this.deferredReference.state()&&this.deferredReference.reject({hideStatus:!0}),i.deferredReference=this.getData().done((function(t){t&&t.length>0?((t=t.slice(0,r.maxRecords)).length>i.Class.SEARCH_MAX_RECORDS?(t=t.slice(0,i.Class.SEARCH_MAX_RECORDS),a.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-search-maximum-records-allowed"),value:""})):t=t.slice(0,r.maxRecords),$.each(t,(function(t,i){if(0==r.maxRecords||t<r.maxRecords){var n=bizagi.util.performTermMatches(i.value,e.term),o=bizagi.util.performTermMatches(i.value,e.term,!0);a.push({id:i.id,label:n,labelWithoutFormat:o,value:i.value})}}))):a.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-grid-no-records"),value:""}),n(a,e.term),i.hideAutocompleteLoading()}))):n(a,e.term)},calculateSuggestionWidth:function(){return this.searchInput.data("ui-autocomplete").menu.element.width()},setDisplayValue:function(e){var t=this.properties,i="";if(null!=(e=this.mapValue(e))&&null!=e)if(t.editable)void 0!==e.value&&e.value?(void 0!==e.labelWithoutFormat?this.searchInput.val(e.labelWithoutFormat):this.searchInput.val(this.formatItem(e.value)),this.setValue(e)):e.additionallabel&&e.label?(i=e.label+" - "+e.additionallabel,this.searchInput.val(i)):e.label?this.searchInput.val(e.label):e&&void 0!==e.id&&""===e.id?this.searchInput.val(""):"object"!=_typeof(e)&&this.searchInput.val(e);else{var r=this.getControl();null!=(i=void 0!==e.labelWithoutFormat?e.labelWithoutFormat:e.label||e.value)?"object"==_typeof(i)&&(i=i.join(" - ")):i="","string"==typeof i&&(e.additionallabel&&(i+=" - "+e.additionallabel),i=bizagi.util.sanitizeHTML(i)),r.html(i)}},getDisplayValue:function(){return this.selectedValue},showAddRecordDialog:function(){var e=this,t=e.properties;return{buttons:{text:bizagi.localization.getResource("render-form-dialog-box-add"),click:function(){var i=new bizagi.rendering.dialog.form(e.dataService,e.renderFactory,{showSaveButton:t.editable,title:bizagi.localization.getResource("render-dialog-entity"),orientation:e.properties.orientation||"ltr",onSave:function(r){var a=r.idPageCache,n=$.Deferred(),o={action:"SAVE",data:r,idPageCache:a,guidEntity:t.entity,contexttype:"entity"},s={};return $.forceCollectData=!0,i.form.collectRenderValues(s),$.forceCollectData=!1,bizagi.util.isMapEmpty(s)?(bizagi.showMessageBox(e.getResource("render-search-advanced-no-filters"),"","error"),n.resolve()):$.when(e.dataService.submitData(o)).done((function(a){function o(t){var i=e.searchDialog.currentSearchForm.getRender(t);return"object"==_typeof(i)&&null!=i?{found:!0,obj:i}:{found:!1,obj:{}}}if(a&&"validationMessages"===a.type)n.resolve(a);else{for(var l in s){var d=o(l);d.found&&(d.obj.setValue(s[l]),e.setDisplayValueToControl(d.obj,i.form,l,s))}e.searchDialog.currentSearchForm.performSearch({allowFullSearch:t.allowFullSearch,maxRecords:t.maxRecords}),i.form.properties.needsUserConfirmation?$.when(bizagi.showConfirmationBox(i.form.properties.userConfirmationMessage,null,!1)).done((function(){n.resolve(r),i.closeDialogBox()})).fail((function(){n.reject()})):(n.resolve(r),i.closeDialogBox())}})).fail((function(e,t,i){"parsererror"==t?n.resolve({type:"error",message:i.message}):n.reject(arguments)})),n.promise()},close:function(){i.dialog("destroy"),i.remove()}});i.render({idRender:t.id,idPageCache:t.idPageCache,requestedForm:"addForm",guidEntity:t.entity,contextType:"entity"}).fail((function(){}))}}}},setDisplayValueToControl:function(e,t,i,r){"searchSuggest"===e.properties.type?e.setDisplayValue(t.getRender(i).getDisplayValue()):e.setDisplayValue(r[i])},showSearchDialog:function(){var e,t=this,i=t.properties,r=i.searchForms.length>0&&"searchForm"===i.searchForms[0].type?"metadata":"entity";i.allowNew&&(e=t.showAddRecordDialog()),t.searchDialog=new bizagi.rendering.dialog.search(t.dataService,t.renderFactory,i.searchForms,{allowFullSearch:i.allowFullSearch,maxRecords:i.maxRecords,orientation:i.orientation||"ltr"},e),t.searchDialog.render({idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:r,orientation:i.orientation||"ltr"}).done((function(e){t.setValue(e),t.readyActionExecution().done((function(){var e=t.getFormContainer();t.properties.submitOnChange||$.when(e.submitData()).done((function(){t.refreshControl()}))}))}))},showAutocompleteLoading:function(){$("i",this.getControl()).addClass("ui-autocomplete-loading")},hideAutocompleteLoading:function(){$("i",this.getControl()).removeClass("ui-autocomplete-loading")},cleanData:function(){var e=this.getControl(),t={id:""};this.setDisplayValue(t),this.setValue(t,!1),this.properties.editable||$(e).html("<label class='readonly-control'></label>")},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},getValueId:function(e){var t=e.id||"";return bizagi.util.isString(t)&&/idEntity(.*)businessKey/gi.test(t)?t:bizagi.util.isNumeric(t)?t:e.value},getValueLabel:function(e){var t=e.label;return!bizagi.util.isString(t)&&bizagi.util.isString(e.value)&&(t=e.value),t},isPreferencesDialog:function(e){var t=e&&e.closest(".bz-wp-userpreferences-main")||[];return t&&t.length>0}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.letter",bizagi.rendering.letter.prototype),bizagi.rendering.desktop.letter.extend("bizagi.rendering.desktop.letter",{},{postRender:function(){$(":button",this.getControl()).button()},configureHandlers:function(){var e=this,t=$(":button",e.getControl());e._super(),t.click((function(){$.when(e.saveForm()).done((function(){e.showLetterDialog()}))}))},postRenderReadOnly:function(){},configureHandlersReadOnly:function(){var e=this,t=e.getControl(),i=e.dataService.getLetterNotEditableUrl({idRender:e.properties.id,xpath:e.getXpath(),xpathContext:e.getContextXpath(),idPageCache:e.properties.idPageCache});$(".ui-bizagi-render-letter-readonly",t).click((function(){$.when(e.saveForm()).done((function(){$.when(e.getCanGenerateLetter()).done((function(e){e&&bizagi.util.parseBoolean(e.canGenerate)?window.open(i):bizagi.showMessageBox(bizagi.localization.getResource("render-letter-not-generated"))}))}))}))},showLetterDialog:function(){var e=this,t=new bizagi.rendering.dialog.letter(e.dataService,e.renderFactory);$.when(e.getCanGenerateLetter()).done((function(i){i&&bizagi.util.parseBoolean(i.canGenerate)?$.when(e.getLetterContent()).pipe((function(e){return t.render(e)})).done((function(t){e.saveLetterContent(t)})):bizagi.showMessageBox(bizagi.localization.getResource("render-letter-not-generated"))}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.button",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.button.extend("bizagi.rendering.desktop.button",bizagi.rendering.button.prototype),bizagi.rendering.desktop.button.extend("bizagi.rendering.desktop.button",{},{postRender:function(){var e=this.getControl(),t=$(":button",e),i=$(e.find("input"));t.button(),i.addClass("ui-button--ellipsis"),i.attr("title",$(e.find("input")).val())},configureHandlers:function(){var e=this,t=$(":button",e.getControl());e._super(),t.on("click",(function(){$("input",e.element).attr("disabled",!0),e.processButton();var t=setTimeout((function(){$("input",e.element).removeAttr("disabled"),clearTimeout(t)}),1500)}))},postRenderReadOnly:function(){this.postRender(),$(":button",this.getControl()).button("option","disabled","true")},processButton:function(){var e=this,t=e.properties,i=e.getMode();if(t.editable){if(void 0!==e.getFormContainer)var r=e.getFormContainer();if(0!=bizagi.override.validateGridsOnButtonClick&&"execution"==i&&r&&!r.hasValidGrids([]))r.validationController.performValidations();else if(t.needsUserConfirmation){var a=$("<div>").append(t.userConfirmationMessage),n=$.Deferred();$(a).dialog({modal:!0,width:500,height:250,draggable:!1,resizable:!0,maximize:!1,title:t.caption||t.displayName,buttons:[{text:bizagi.localization.getResource("confirmation-box-ok"),click:function(){n.resolve(),e.triggerRenderChange({pressed:!0}),$(this).dialog("close")}},{text:bizagi.localization.getResource("confirmation-box-cancel"),click:function(){n.reject(),$(this).dialog("close")}}]}),t.preventDefault||$.when(n.promise()).done((function(){e.runButtonAction()}))}else t.preventDefault||e.runButtonAction(),e.triggerRenderChange({pressed:!0})}}}),bizagi.rendering.desktop.button.extend("bizagi.rendering.desktop.uiPathButton",{},{initializeData:function(e){this._super(e),this.properties.rpabot=this.properties.rpabot||{}},postRender:function(){this._super(),"execution"===this.getMode()&&(bizagi.bzToast.init({zIndex:bizagi.util.getMaxZIndex()+1}),this.initializeRobot())},configureHandlers:function(){var e=this,t=$(":button",e.getControl());e._super(),t.on("click",(function(){e.robotInstance&&e.runRobot()}))},initializeRobot:function(){var e=this;UiPathRobot.getProcesses().then((function(t){if(0===t.length){var i=e.getResourceByKey("workportal-rpa-uipath-error-proccess-not-found","UIPath processes cannot be found or are not available.");return bizagi.showMessageBox(i,"Error"),void e.disabledButton()}if(e.robotInstance=t.find((function(t){return t.name.includes(e.properties.rpabot.robotName)})),!e.robotInstance){i=e.getResourceByKey("workportal-rpa-error-bot-not-found","bot is not found");bizagi.showMessageBox(e.properties.rpabot.robotName+" "+i,"Error"),e.disabledButton()}}),(function(t){var i=e.getResourceByKey("workportal-rpa-error-loading-bots","Something went wrong,");bizagi.showMessageBox(i+" "+t,"Error"),e.disabledButton()}))},runRobot:function(){var e=this;e.disabledButton();var t=e.getResourceByKey("workportal-rpa-bot-queue","The bot is being executed, please wait");e.properties.toast?e.properties.toast.relaunch().setLoaderStatus().setContent(t):e.properties.toast=bizagi.bzToast.addItem({title:e.properties.rpabot.robotName,content:t,onClickIcon:function(e){"error"===e.status&&e.relaunch().setLoaderStatus().setContent(t)},onCanStartJob:function(){e.startJob()}})},startJob:function(){var e=this,t=e.properties.toast,i=e.properties,r=i.rpabot.inputs||[],a=i.rpabot.outputs||[],n=this.areAllControlsInForm(r.concat(a));if(n.allControlsFound){r=e.getRobotInputs();e.disabledButton(),t.setLoaderStatus(),e.robotInstance.start(r).onStatus((function(e){t.setContent(e)})).then((function(i){e.processOutput(i);var r=e.getResourceByKey("workportal-rpa-bot-executed-succesfully","Bot executed succesfully");t.setSuccessStatus().setContent(r),e.properties.toast=void 0,e.enableButton()}),(function(i){var r=i.InnerException?i.InnerException.Message:e.getResourceByKey("workportal-rpa-bot-error-executed","There is an error in the bot execution");t.setErrorStatus().setContent(r),e.enableButton()}))}else e.handleNotFoundControls(n.controlsNotFound)},processOutput:function(e){var t=this.getFormContainer();(this.properties.rpabot.outputs||[]).forEach((function(i){var r=e[i.robotArgumentName];if(r){var a=t.getRenders(i.xpath)[0];bizagi.util.isEmpty(a)||a.setDisplayValue(r)}}))},disabledButton:function(){$("input",this.getControl()).attr("disabled",!0).addClass("ui-state-disabled rpa-disabled")},enableButton:function(){$("input",this.getControl()).removeAttr("disabled").removeClass("ui-state-disabled rpa-disabled")},getRobotInputs:function(){var e=this.getFormContainer(),t={};return(this.properties.rpabot.inputs||[]).forEach((function(i){var r=e.getRenders(i.xpath)[0],a="";bizagi.util.isEmpty(r)||(a=r.getValue()),t[i.robotArgumentName]=a})),t},areAllControlsInForm:function(e){var t=this.getFormContainer(),i={allControlsFound:!0,controlsNotFound:[]};return(e=e||[]).forEach((function(e){var r=t.getRenders(e.xpath)[0];bizagi.util.isEmpty(r)&&(i.allControlsFound=!1,i.controlsNotFound.push(e.xpath))})),i},handleNotFoundControls:function(e){var t=this.getResourceByKey("workportal-rpa-controls-not-found","Controls associated with the bot’s inputs and outputs are not within the form");this.properties.toast.setErrorStatus().setContent(t),t+=":",e.forEach((function(e){t+=e+",\n"})),bizagi.showMessageBox(t,"Error"),this.disabledButton()}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.fileprint",bizagi.rendering.fileprint.prototype),bizagi.rendering.desktop.fileprint.extend("bizagi.rendering.desktop.fileprint",{},{postRender:function(){$(":button",this.getControl()).button()},configureHandlers:function(){var e=this,t=e.properties,i=$(":button",e.getControl());e._super(),t.filesCount>0?i.click((function(){e.processButton()})):i.button("option","disabled","true")},postRenderReadOnly:function(){var e=this.getFormContainer().properties.typeForm;this.postRender();var t=$(":button",this.getControl());"SummaryForm"===e||"GlobalForm"===e?this.configureHandlers():t.button("option","disabled","true")},processButton:function(){var e=this.getFormContainer().properties.typeForm;(this.properties.editable||"SummaryForm"===e||"GlobalForm"===e)&&this.runButtonAction()},runButtonAction:function(){var e=this,t=e.getFormContainer();t.clearValidationMessages(),t.startLoading(),e.downloadFile().then((function(t){if($.browser.mozilla)bizagi.util.downloadBlobFile(t,"PDF.pdf");else{var i=e.getControl();$("iframe",i).remove();var r="bz-render-fileprint-iframe-"+(new Date).getTime(),a=e.renderFactory.getTemplate("fileprint-iframe"),n=window.URL.createObjectURL(t),o=$.tmpl(a,{url:n,id:r});i.append(o);var s=document.getElementById(r).contentWindow;void 0===s.print||bizagi.util.isIE()?bizagi.util.downloadBlobFile(t,"PDF.pdf"):s.print(),window.URL.revokeObjectURL(n)}})).fail((function(e){t&&t.failHandler(e)})).always((function(){t&&t.endLoading()}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.link",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.link.extend("bizagi.rendering.desktop.link",bizagi.rendering.link.prototype),bizagi.rendering.desktop.link.extend("bizagi.rendering.desktop.link",{},{postRender:function(){},configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},linkSolver:function(e){var t=(e=e||{}).url||"",i=e.target||"_blank";switch(!0===bizagi.override.linkPrefix&&t&&-1===t.indexOf("http")&&-1===t.indexOf("\\\\")&&(t="//"+bizagi.util.trim(t)),e.linkType){case"newwindow":var r=printf("width=%s,height=%s,resizable,scrollbars=yes,status=1,toolbar=yes",window.screen.width,window.screen.height);this.windowObjReference=window.open(t,i,r);break;case"newtab":default:this.windowObjReference=window.open(t,i)}},postRenderReadOnly:function(){this.postRender()},attachEvents:function(){var e=this,t=e.getControl(),i=e.properties,r=$(".ui-bizagi-render-link",t);i.value?(r.attr("href",i.value),r.attr("target","_blank"),r.click((function(){return e.linkSolver({linkType:i.linktarget,url:i.value}),!1}))):r.addClass("ui-state-disabled"),e.preventDefaultForAnchorTag()},processLayout:function(e){e?void 0!==this.properties.textFormat.background&&this._super(e,{background:this.properties.textFormat.background}):this._super(e,this.properties.textFormat)},getElementsToStylize:function(e){return $(".ui-bizagi-render-link",e)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.layoutRender",bizagi.rendering.layoutRender.prototype),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutPlaceholder",bizagi.rendering.layoutPlaceholder.prototype),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutBoolean",bizagi.rendering.layoutBoolean.prototype),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutImage",bizagi.rendering.layoutImage.prototype),bizagi.rendering.desktop.layoutImage.extend("bizagi.rendering.desktop.layoutImage",{},{postRender:function(){var e=this.getControl();if(this.value&&void 0!==this.value.value&&""!==this.value.value&&null!==this.value.value){var t=this.getImageUri();$.ajax({url:t,type:"GET",dataType:"binary",processData:!1,success:function(t){if("string"==typeof t){var i=arguments[2],r=i.getResponseHeader("Content-type");t=bizagi.util.byteArrayToBlob(bizagi.util.stringToByteArray(t),r)}var a=window.URL||window.webkitURL,n=a.createObjectURL(t);$(e).find("img").attr("src",n)}})}},getImageUri:function(){var e=this.parent.parent.properties.paramsRender||{},t={entity:this.value.guid,surrogateKey:this.value.surrogateKey,xpath:this.properties.xpath,width:96,height:96,hash:this.value.value,idcase:e.idRender?bizagi.context.idCase:"_",idworkitem:e.idRender?bizagi.context.idWorkitem:"_",contextxpath:e.idRender?e.xpathActions:"_"};return this.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(t)}}),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutLink",bizagi.rendering.layoutLink.prototype),bizagi.rendering.desktop.layoutLink.extend("bizagi.rendering.desktop.layoutLink",{},{postRender:function(){var e=this.element;this._super(),e&&$(e).on("click",$.proxy(this.onClickElement,this))},onClickElement:function(){var e=this.properties||{},t={displayName:e.displayName,reference:e.reference,referenceType:e.referenceType,xpath:e.xpath,contextEvent:this.getFormContainer().getContextEvent?this.getFormContainer().getContextEvent():""};this.triggerGlobalHandler("DATA-NAVIGATION",t)}}),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutLabel",bizagi.rendering.layoutLabel.prototype),bizagi.rendering.desktop.layoutLabel.extend("bizagi.rendering.desktop.layoutLabel",{},{setValue:function(e,t){this.properties.displayName=e,this._super(e,t);var i=this.getControl();i&&$(".ui-bizagi-render-label",i).text(e)}}),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutText",bizagi.rendering.layoutText.prototype),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutDateTime",bizagi.rendering.layoutDateTime.prototype),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutNumber",bizagi.rendering.layoutNumber.prototype),bizagi.rendering.desktop.layoutNumber.extend("bizagi.rendering.desktop.layoutNumber",{},{setValue:function(e,t){var i=this.getControl();"execution"===this.getMode()&&(e=null===e||""===e?"":this.getDisplayValue(e)),this.properties.displayName=e,this._super(e,t),i&&$(".ui-bizagi-render-number",i).text(e)}}),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutMoney",bizagi.rendering.layoutNumber.prototype),bizagi.rendering.desktop.layoutMoney.extend("bizagi.rendering.desktop.layoutMoney",bizagi.rendering.layoutMoney.prototype),bizagi.rendering.desktop.layoutMoney.extend("bizagi.rendering.desktop.layoutMoney",{},{setValue:function(e,t){var i=this.getControl();"execution"===this.getMode()&&(e=null===e||""===e?"":this.getDisplayValue(e)),this.properties.displayName=e,this._super(e,t),i&&$(".ui-bizagi-render-number",i).text(e)}}),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutUpload",bizagi.rendering.layoutUpload.prototype),bizagi.rendering.desktop.layoutUpload.extend("bizagi.rendering.desktop.layoutUpload",{},{renderControl:function(){var e=this,t=e.properties,i=$.Deferred();return"execution"===e.getMode()?$.when(e.getValueFilesByData(bizagi.clone(t))).done((function(t,r){e.properties=t,e.files=r.files,i.resolve(e.getHTMLFiles(t))})):(e.files=[],i.resolve(e.getHTMLFiles())),i.promise()},getHTMLFiles:function(){this.filesCount=this.files.length;for(var e=this.renderFactory.getTemplate("layout-upload"),t=$.fasttmpl(e,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),noFiles:0==this.filesCount}),i="",r=0;r<this.filesCount;r++){var a={id:this.files[r][0],fileName:this.files[r][1]};i+=this.renderUploadItem(a)}return t=this.replaceFilesHtml(t,i)},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},renderUploadItem:function(e){var t=this.properties,i=this.renderFactory.getTemplate("layout-uploadItem");return $.fasttmpl(i,{allowDelete:t.allowDelete,filename:e.fileName,id:e.id,mode:this.getMode(),editable:t.editable})},configureHandlers:function(){var e=this,t=e.getControl();e.isExecutionMode()&&$(".ui-bizagi-render-upload-layout-item",t).on("click",(function(t){t.stopPropagation(),e.downloadFile($(this).data())}))},downloadFile:function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileEntity({isContextContainerWidgetRender:this.isContextContainerWidgetRender(),xpath:this.getUploadXpath(),fileId:e.id,idRender:i.properties.paramsRender.idRender||"undefined",xpathContext:t.xpathContext,idPageCache:i.properties.paramsRender.idPageCache||"undefined",xpathActions:i.properties.paramsRender.xpathActions||"undefined",surrogatekey:this.properties.value.surrogateKey,guidentity:this.properties.value.guid}).then((function(t){bizagi.util.downloadBlobFile(t,e.filename)})).fail((function(e){i&&i.failHandler(e)}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.formLink",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},bizagi.rendering.formLink.prototype),bizagi.rendering.desktop.formLink.extend("bizagi.rendering.desktop.formLink",{},{configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},executeRule:function(e){var t=new $.Deferred;return this.dataService.multiaction().getPropertyData({url:this.properties.dataUrl,xpath:this.properties.xpath,idRender:this.properties.id,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,property:e}).done((function(e){if("error"===e.type)t.reject(e);else if(null!=e.messages){var i=e.messages[0];t.reject({type:e.type,message:i})}else t.resolve(e)})).fail((function(e,i,r){t.reject({type:"error",message:e.message})})),t.promise()},executeExitRule:function(e){var t=this,i=new $.Deferred;return t.properties.hasexitrule&&!t.isThisFormReadOnly()?t.saveFormLinkData(e).then((function(){return t.executeRule("exitrule")})):(i.resolve(),i.promise())},executeEntryRule:function(){var e=new $.Deferred;return this.properties.hasentryrule&&!this.isThisFormReadOnly()?this.executeRule("entryrule"):(e.resolve(),e.promise())},submitSaveRequest:function(e){var t=this.properties;if(!t.editable&&!t.value)return null;var i=this.getFormLinkXpath(),r=i;return void 0!==t.xpathContext&&""!==t.xpathContext&&(r=i?t.xpathContext+"."+i:t.xpathContext),this.dataService.saveLinkForm({url:t.saveUrl,idRender:t.id,xpathContext:r,submitData:e})},isThisFormReadOnly:function(){var e=this.getFormContainer();return e&&e.properties.displayAsReadOnly},openFormLink:function(){var e=this,t=e.properties,i=e.getFormContainer();return void 0===t.canBeSaved&&(t.canBeSaved=!0),(!1===t.editable||i.properties.displayAsReadOnly)&&(t.canBeSaved=!1),$.when(i.properties.editable&&!e.isThisFormReadOnly()?i.submitData():void 0).then((function(){return $.when(e.submitEditRequest()).then((function(){return e.executeEntryRule().then((function(){e.openFormLinkDialog()})).fail((function(t){e.submitRollbackRequest(),e.handleFailRuleExecution(t)}))})).fail((function(){console.warn("EDITRELATION action Fails")}))}))},openFormLinkDialog:function(){var e=this,t=e.properties,i=e.getFormContainer();e.dialog=new bizagi.rendering.dialog.form(e.dataService,e.renderFactory,{showSaveButton:t.canBeSaved,isPlanForm:t.isPlanForm||!1,maximized:t.maximized,title:t.displayName,orientation:t.orientation||"ltr",onSave:function(t){var r=new $.Deferred,a=null;return t&&t.deferreds&&(a=$.when.apply($,t.deferreds),delete t.deferreds),$.when(a).then((function(){e.handleOnSaveDialog(t).then((function(e){r.resolve(e),i.refreshForm()})).fail((function(){r.reject()}))})),r.promise()},close:function(){}}),e.dialog.render({idRender:t.id,xpathContext:e.getFormLinkXpathContext(),idPageCache:t.idPageCache,recordXPath:e.getFormLinkXpath(),requestedForm:"linkform",editable:t.editable,url:t.editPage,fromRender:e,mainForm:e.getMainForm(e.getFormContainer())}).fail((function(t){$.when(e.submitRollbackRequest(t)).done((function(){e.submitInvalidatePageCacheRequest(t)}))}))},handleFailRuleExecution:function(e){if("alertMessages"===e.type)bizagi.modalError&&bizagi.modalError.show(e.message,"workportal-general-word-information",!1);else{var t=this.getFormContainer();"validationMessages"===e.type?t.validationController.showErrorMessage(e.message):t.addErrorMessage(e.message)}},handleOnSaveDialog:function(e){var t=this;return t.executeExitRule(e).then((function(){var i=new $.Deferred,r=t.properties.hasexitrule?{idPageCache:e.idPageCache}:e;return t.submitSaveRequest(r).then((function(e){if("error"===e.type)i.reject(e);else if(null!=e.messages){var t=e.messages[0];i.reject({type:e.type,message:t})}else i.resolve(e)})).fail((function(e){i.reject({type:"error",message:e.message})})),i.promise()})).fail((function(e){return t.handleFailRuleExecution(e),e}))},getFormLinkXpathContext:function(){var e=this.properties.xpathContext,t=this.getXpathContext();return t&&e?0===e.indexOf(t)?e:t+"."+e:e},attachEvents:function(){var e=this,t=$(".ui-bizagi-render-link",e.getControl());e.dialog=null,t.on("click",(function(){var t=$(this);t.prop("disabled",!0),$.when(e.openFormLink()).always((function(){t.prop("disabled",!1)}))}))},changeColor:function(e){var t=this.getControl(),i=this.getLabel();t&&i&&("none"!==e?(this.getControl().find("a").css("color",e,"!important"),"function"==typeof this.getControl().find("a").style&&this.getControl().find("a").style("color",e,"!important")):(this.getControl().find("a").css("color",""),"function"==typeof this.getControl().find("a").style&&this.getControl().find("a").style("color",""))),this._super(e)},changeFontBold:function(){var e=this.getControl().children();void 0!==this.properties.textFormat.bold&&"object"==_typeof(e)&&e.length>0&&this.getElementsToStylize(e).css("font-weight","bold","!important")}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.geolocation",bizagi.rendering.geolocation.prototype),bizagi.rendering.desktop.geolocation.extend("bizagi.rendering.desktop.geolocation",{},{renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.postRender()},postRender:function(){this._super(),this.cordinate=$(".ui-geolocation-cordinate",this.getControl())},configureHandlers:function(){var e=this;if(e.isExecutionMode()){var t=e.getControl();null==e.value&&e.setDisplayValue().then((function(){})).fail((function(t){e.cordinate.html("<span style='color: red'>"+t+"</span>")})),$(".ui-bizagi-render-geolocation",t).bind("click",(function(){e.cordinate.empty(),e.setDisplayValue().then((function(){})).fail((function(t){e.cordinate.html("<span style='color: red'>"+t+"</span>")}))}))}},clearDisplayValue:function(){var e=this.getControl().find("span");e.length>0&&e.val("")},setDisplayValue:function(e){var t=this,i=new $.Deferred;if(null!=e&&""!==e)t.cordinate.html(t.performPrecision(e)),t.setValue(e,!1),i.resolve();else{t.getCurrentPosition((function(e){var r=e.coords.latitude+" "+e.coords.longitude;t.cordinate.html(t.performPrecision(r)),t.setValue(r,!1),i.resolve()}),(function(e){t.cordinate.html(t.properties.value),i.reject(e)}))}return i.promise()}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.hidden",bizagi.rendering.hidden.prototype),bizagi.rendering.desktop.hidden.extend("bizagi.rendering.desktop.hidden",{},{}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.money",bizagi.rendering.number.prototype),bizagi.rendering.desktop.money.extend("bizagi.rendering.desktop.money",bizagi.rendering.money.prototype),bizagi.rendering.desktop.money.extend("bizagi.rendering.desktop.money",{},{setDisplayValue:function(e){var t=this.properties;this._super(e),null!=e&&t.editable&&(this.numericInput.val(bizagi.util.numberToFixedString(e)),this.executeFormatCurrencyPlugin())},changeCellRequired:function(e){this.changeRequired(e)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $("input.ui-bizagi-render-numeric, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}}),bizagi.rendering.desktop.money.extend("bizagi.rendering.desktop.queryMoney",{},{attachFormatCurrency:function(){var e=this.properties;e.showSymbol&&""===e.symbol&&"undefined"!=typeof bizagi&&8==e.dataType&&void 0!==bizagi.currentUser&&void 0!==bizagi.currentUser.symbol&&(e.symbol=bizagi.currentUser.symbol),this._super()}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.radio",bizagi.rendering.combo.prototype),bizagi.rendering.desktop.radio.extend("bizagi.rendering.desktop.radio",bizagi.rendering.radio.prototype),bizagi.rendering.desktop.radio.extend("bizagi.rendering.desktop.radio",{},{postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-boolean-yesno"),this.properties.unique=Math.ceil(1e3*Math.random()),this.radiogroup=$(".ui-bizagi-render-radio",e),this.radiogroup.optiongroup({orientation:this.properties.orientation}),this.selectedValue&&this.radiogroup.optiongroup("setValue",this.selectedValue)},configureHandlers:function(){var e=this;e._super(),e.radiogroup.bind("optiongroupchange",(function(t,i){e.onOptionGroupChange(i)}))},onOptionGroupChange:function(e){var t={id:e.value,value:e.text};this.selectedValue=t.value,this.setValue(t)},configureDesignView:function(){this.getControl().find("input").unbind("click")},setDisplayValue:function(e){this.properties.editable&&void 0!==e&&""!=e.id&&this.radiogroup.optiongroup("setValue",e.id||e.value)},clearDisplayValue:function(){var e=this.getControl();this.radiogroup?$.data(this.radiogroup[0])["ui-optiongroup"]?this.radiogroup.optiongroup("setValue",0):$(e).html("<label class='readonly-control'></label>"):this.properties.editable||$(e).html("<label class='readonly-control'></label>")},getSelectedValue:function(){return this.selectedValue},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $(".ui-bizagi-render-radio label, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}}),bizagi.rendering.desktop.radio.extend("bizagi.rendering.desktop.queryRadio",{},{postRender:function(){var e=this.getControl();this._super(),e.removeClass("ui-bizagi-render-boolean-yesno")}}),bizagi.rendering.desktop.radio.extend("bizagi.rendering.desktop.queryState",{},{initializeData:function(e){var t=void 0===e.properties.horizontal||bizagi.util.parseBoolean(e.properties.horizontal);this._super(e);var i=this.properties;i.horizontal=t,void 0===i.defaultValue&&null===i.value&&this.setValue({id:"0"},!1)},getValue:function(){return this.value&&this.value.id&&!isNaN(this.value.id)?{id:parseInt(this.value.id),value:this.value.value}:this.value},setDisplayValue:function(e){e.id=e.id+"",this._super(e)}}),bizagi.rendering.desktop.radio.extend("bizagi.rendering.desktop.queryCaseState",{},{initializeData:function(e){var t=void 0===e.properties.horizontal||bizagi.util.parseBoolean(e.properties.horizontal);this._super(e);var i=this.properties;i.horizontal=t,void 0===i.defaultValue&&null===i.value&&this.setValue({id:"0"},!1)},getValue:function(){return this.value&&this.value.id&&!isNaN(this.value.id)?{id:parseInt(this.value.id),value:this.value.value}:this.value},setDisplayValue:function(e){e.id=e.id+"",this._super(e)}}),bizagi.rendering.desktop.panel.extend("bizagi.rendering.desktop.queryGrid",{},{initializeData:function(e){var t=this;console.log("sucede initializeData queryGrid"),t._super(e);var i=t.properties;i.uniqueId=Math.ceil(1e6*Math.random()),i.editable=void 0===i.editable||bizagi.util.parseBoolean(i.editable),i.visible=void 0===i.visible||bizagi.util.parseBoolean(i.visible),i.orientation=i.orientation||(t.parent?t.parent.properties.orientation:"ltr"),this.originalProperties=JSON.parse(JSON.encode(i)),this.children=[],this.childrenHash={},e.elements&&$.each(e.elements,(function(e,i){i.render.properties.xpath=t.properties.xpath+"."+i.render.properties.xpath,i.render?t.createRenderElement(i):i.container?t.createContainerElement(i):i.form&&t.createFormElement(i)}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.list",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.list.extend("bizagi.rendering.desktop.list",bizagi.rendering.combo.prototype),bizagi.rendering.desktop.list.extend("bizagi.rendering.desktop.list",bizagi.rendering.list.prototype),bizagi.rendering.desktop.list.extend("bizagi.rendering.desktop.list",{},{postRender:function(){var e=this,t=e.getControl(),i=e.properties;if(e._super(),t.addClass("ui-bizagi-render-display-block"),t.addClass("ui-bizagi-render-boolean-yesno"),e.list=$(".ui-bizagi-render-list",t),e.list.selectable2({closest:!1,multiple:!1,select:function(t,i){if(!t.isPropagationStopped()){var r=$("li[tabindex='0']",this),a={id:$(r).data("value"),value:$(r).text()};e.setValue(a),e.selectedValue=a.value,e.focusSelectedItem(r),t.stopPropagation()}}}),i.listSize>0){var r=23*Number(i.listSize);e.list.height(r+"px")}},focusSelectedItem:function(e){$.when(this.ready()).done((function(){e.focus(0)}))},configureHandlers:function(){this._super()},configureDesignView:function(){this._super(),this.properties.editable&&(this.list.unbind("mousedown.selectable"),this.list.unbind("focus.selectable"),this.list.unbind("blur.selectable"),this.list.unbind("keydown.selectable"))},setDisplayValue:function(e){e=this.mapValue(e),this.properties.editable&&void 0!==e&&""!==e.id&&this.list.selectable2("select","[id='ui-bizagi-list-"+e.id+"']")},clearDisplayValue:function(){var e=this.getControl(),t=e.find(".ui-state-active");if(t.length>0){var i=this.getValue();this.selectedValue=i.value,t.removeClass("ui-state-focus ui-selected ui-state-active")}else this.properties.editable||$(e).html("<label class='readonly-control'></label>")},getSelectedValue:function(){return this.selectedValue},cleanData:function(){this.value=this.properties.value=this.selectedValue={id:"",value:""},this.clearDisplayValue()},getLabel:function(){return $("label",this._super())},getElementsToStylize:function(e){return $("ul li",e)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();"execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.multiSelect",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.multiSelect.extend("bizagi.rendering.desktop.multiSelect",bizagi.rendering.multiSelect.prototype),bizagi.rendering.desktop.multiSelect.extend("bizagi.rendering.desktop.multiSelect",{MORE_OPTION_WIDTH:40},{initializeData:function(e){this._super(e),this.isNewRenderForm=!0},postRender:function(){var e=this.getControl();this.multiSelect=$(".bz-multiselect",e),this._super()},renderElement:function(){return this._super("render-base")},postRenderReadOnly:function(){var e=this.getControl();this.multiSelect=$(".bz-multiselect",e),this._super()},setDisplayValue:function(e){var t=this;t._super(e);var i=setTimeout((function(){t.addSelectedElements(),clearTimeout(i)}),100)},configureHandlers:function(){var e=this,t=e.getControl();$(".bz-multiselect",t).on("click, mousedown.multiselect",(function(t){($(t.target).hasClass("bz-multiselect__tags")||$(t.target).hasClass("bz-multiselect__arrow"))&&e.onToggleDataView(t)})),$("ul.bz-multiselect__tags",t).on("click","li div.bz-btn-icn",this.onUnselectElement.bind(this)).on("click","li.bz-multiselect__plus",this.onShowSelectedElements.bind(this))},configureHandlersReadOnly:function(){var e=this.getControl();$("ul.bz-multiselect__tags",e).on("click","li.bz-multiselect__plus",this.onShowSelectedElements.bind(this))},addSelectedElements:function(){var e=this,t=this.getControl(),i=this.getDataValue()||[],r=i.length,a=$("ul.bz-multiselect__tags",t),n=this.properties.editable,o=this.renderFactory.getTemplate("list-multiselect-tag");if(a.empty(),r>0)if(this.getFormContainer().params.printversion)t.html(i.map((function(t){return e.formatItem(t.value)})).join(", "));else for(var s=0;s<r;s++){var l=i[s],d={id:l.id,value:l.value,editable:n},u=$.tmpl(o,d,{formatItem:e.formatItem});if(a.append(u),this.processControlLayout(this.properties.valueFormat||{}),!this.canAddMoreItems(a)){a.children().last().remove();var c=$.tmpl(this.renderFactory.getTemplate("list-multiselect-view-more"),{value:r-s,index:s});a.append(c);break}}},renderFloatView:function(){var e=this,t=e.renderFactory.getTemplate("list-multiselect-item");e.updateArrow(),$.when(e.getData()).done((function(i){try{var r={datasource:i},a={selected:e.getDataValue(),isChecked:function(t){return e.markAsChecked.call(this,t)},formatItem:e.formatItem},n=e.showFloatListView(t,r,a);e.floatListHandlers(n)}catch(e){bizagi.log(e.message)}})).fail((function(t){var i=e.properties.displayName+": ",r=e.getFormContainer();i+=("string"==typeof t?JSON&&JSON.parse(t)||$.parseJSON(t):t).message,r.addValidationMessage(i)}))},showFloatListView:function(e,t,i){var r=this.getControl().closest(".ui-bizagi-control-wrapper"),a=r.closest(".bz-form-old-item"),n=$.tmpl(e,t,i),o=this.multiSelect.width();a.addClass("bz-multiselect__visible"),r.addClass("bz-multiselect__visible bz-multiselect__floats"),r.append(n),n.width(o),n.position({my:"left top",at:"left bottom",of:this.multiSelect,collision:"fit"}).hide(),n.show(),n.on("mousedown",(function(e){return e.preventDefault(),!1}));var s=setTimeout((function(){$(document).one("mousedown.multiselect",(function(e){n.trigger("closeView")})),clearTimeout(s)}),0);return n},destroyFloatView:function(e){var t=this.getControl().closest(".ui-bizagi-control-wrapper"),i=t.closest(".bz-form-old-item");t.hasClass("bz-multiselect__visible")&&t.removeClass("bz-multiselect__visible"),t.hasClass("bz-multiselect__floats")&&t.removeClass("bz-multiselect__floats"),i.hasClass("bz-multiselect__visible")&&i.removeClass("bz-multiselect__visible"),e.remove()},closeFloatView:function(){var e=this.getControl().closest(".ui-bizagi-control-wrapper").closest(".bz-form-old-item"),t=$(e).find(".bz-multiselect__content");t.hide(),this.updateArrow(),this.destroyFloatView(t)},updateArrow:function(){this.getControl().find(".bz-multiselect__arrow").toggleClass("bz-multiselect__arrow-collapse")},floatViewIsCollapsed:function(){var e=$(".bz-multiselect__content",this.element);return e&&e.length>0},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},onUnselectElement:function(e){var t=$(e.target).data("id");this.removeElement({id:t}),this.addSelectedElements()},onShowSelectedElements:function(e){var t=this,i=$(e.currentTarget).data("index"),r=(this.getDataValue()||[]).slice(i),a=this.renderFactory.getTemplate("list-multiselect-tags"),n=this.showFloatListView(a,{datasource:r,editable:t.properties.editable},{formatItem:t.formatItem}),o=$("ul.bz-multiselect__tags",n);o.on("click, mousedown","li div.bz-btn-icn",(function(e){t.onUnselectElement(e),n.remove(),e.stopPropagation()})),n.on("closeView",(function(){o.off("click","li div.bz-btn-icn",t.onUnselectElement.bind(t)),n.remove()}))},onToggleDataView:function(e){this.floatViewIsCollapsed()?this.closeFloatView():this.renderFloatView()},floatListHandlers:function(e){var t=this,i=e.find(".bz-multiselect__list li"),r=i.find("input[type=checkbox]"),a=e.find(".bz-multiselect__search_input");this.properties.enableTyping?a.bind("change keypress keyup mousedown",(function(e){e.stopPropagation(),t.filterList(this.value,i)})):a.addClass("bz-multiselect__search--disabled"),r.change((function(){var e=$(this),i=e.is(":checked"),r=e.data("id"),a={id:r,value:t.findItemById(r).value};i?t.addElement(a):t.removeElement(a),t.addSelectedElements()})),e.on("closeView",(function(){t.closeFloatView(),$(document).unbind("mousedown.multiselect")}))},getLabel:function(){return $("label",this._super())}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.handSignature",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.handSignature.extend("bizagi.rendering.desktop.handSignature",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.handSignature.prototype),bizagi.rendering.desktop.handSignature.extend("bizagi.rendering.desktop.handSignature",{},{renderElement:function(){return this._super("render-base")},postRenderReadOnly:function(){var e=this,t=e.getFormContainer(),i=t.params&&t.params.printversion;if(this.isExecutionMode())if(i)e.postRenderPrintVersion();else{var r=e.getSignatureContainer();e.setResizeObserver(r,(function(){e.renderSignature()}))}},postRenderPrintVersion:function(){var e=this.getSignatureContainer(),t=document.createElement("img");this.buildItemUrl().then((function(i){t.src=i,e.append(t)}))},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},getLabel:function(){return $("label",this._super())},configureHandlers:function(){var e=this,t=$(".bz-actions",this.getControl()),i=e.getSignatureContainer(),r=bizagi.util.debounce2((function(t){if(a){var i=Array.prototype.slice.call(t||[]),r=(i&&i[0]||[]).dataImage||"";e.saveDeferred=$.when(e.saveSignature(r))}}),e.DELAY_TO_SAVE),a=!1;i.bind("change",(function(){if(a=!0,$(this).BzjSignature("isModified")){e.saveTimestamp=(new Date).getTime();var t=$(".bz-signature__container-canvas",this)[0].toDataURL("image/png");r.fire({dataImage:t}),e.setData(t.replace(/^data:image\/(png|jpg|jpeg);base64,/,"")),e.properties.url=t,e.setState(e.STATE_TYPE.done)}})),t.on("click","[data-action='clear']",(function(){a=!0,r.cancel(),e.onSignatureClear(i)})),t.on("click","[data-action='edit']",(function(){e.onSignatureEdit(i),a=!1})),t.on("click","[data-action='save']",(function(){if(!a)return e.setState(e.STATE_TYPE.edit),void i.BzjSignature("disable");e.onSignatureSave(i,r),a=!1}))},onSignatureClear:function(e){var t=this;return e.BzjSignature("reset"),t.hasValue()&&(t.setData(t.EMPTY_VALUE),t.properties.url=t.EMPTY_VALUE,t.saveDeferred=$.when(t.deleteImage()).done((function(){t.setData(t.EMPTY_VALUE),t.properties.url=t.EMPTY_VALUE})).fail((function(e){t.executeFormFailHandler(e)}))),$.when(t.saveDeferred)},onSignatureEdit:function(e){this.setState(this.STATE_TYPE.draw),e.BzjSignature("enable")},onSignatureSave:function(e,t){var i=this;if(e.BzjSignature("disable"),e&&e.BzjSignature("isModified")){var r=$(".bz-signature__container-canvas",e)[0];t.cancel(),i.saveSignature(r.toDataURL("image/png")).always((function(){i.setState(i.STATE_TYPE.edit)}))}else i.setState(i.STATE_TYPE.edit)},renderSignature:function(){var e=this.getSignatureContainer();e.empty(),e.BzjSignature({sizeRatio:3,cssclass:"bz-signature__container-canvas",color:"#000",background:"#FFFFFF"}),e.BzjSignature("disable"),this.pluginInitialized&&this.properties.url?this.setSignature(e):this.renderSignatureValue(e),this.pluginInitialized=!0},renderSignatureValue:function(e){var t=this;return t.buildItemUrl().then((function(i){if(!t.isDisposed()){var r=""!==i?i:"";t.properties.url=r,bizagi.util.isEmpty(r)?t.setData(t.EMPTY_VALUE):e.BzjSignature("setData",r)}}))}}),bizagi.rendering.desktop.list.extend("bizagi.rendering.desktop.queryList",{},{}),bizagi.rendering.desktop.multiSelect.extend("bizagi.rendering.desktop.queryMultiSelect",{},{getData:function(){var e=this.properties;return e.data?this.normalizeData(e.data):[]},collectDataQueryForm:function(e){var t=this.properties,i=t.xpath,r=this.mapValue(this.getValue());if(!bizagi.util.isEmpty(i)&&(!bizagi.util.isEmpty(r)||t.included)){var a=(this.properties.typeSearch||this.properties.rangeQuery||"NONE").toUpperCase(),n={value:r,included:this.properties.included,xpath:t.xpath,searchType:a,orderType:"NONE",renderId:this.getRenderId()};void 0!==t.displayXpath&&""!==t.displayXpath&&(n.displayXpath=t.displayXpath),e.push(n)}},mapValue:function(e){var t=e||[],i=Array.isArray(t)?{}:JSON.parse(e);return bizagi.util.isEmpty(e)||void 0===i.value||(t=bizagi.util.isEmpty(i.value)?[]:e),t}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.userfieldWrapper",bizagi.rendering.userfieldWrapper.prototype),bizagi.rendering.desktop.userfieldWrapper.extend("bizagi.rendering.desktop.userfieldWrapper",{},{getUserfieldControl:function getUserfieldControl(){var self=this,sControl=self.userfieldName,mode=self.getMode(),exists=eval("typeof bizagi.rendering.desktop."+sControl+" !== 'undefined'"),def=new $.Deferred;if(exists)$.when(self.parent.ready()).done((function(){def.resolve(self.createUserfieldInstance(sControl))}));else if("execution"!=mode)var timeOutTrigger=setTimeout((function(){$.when(self.triggerGlobalHandler("loadUserField",{userfield:self.userfieldGuid,device:"Desktop"})).pipe((function(e){e&&def.resolve(self.createUserfieldInstance(sControl))})),clearTimeout(timeOutTrigger)}),10);else $.when(self.dataService.getUserfieldDefinition({userfield:self.userfieldGuid,device:"desktop"})).pipe((function(e){self.loadUserfield(e),def.resolve(self.createUserfieldInstance(sControl))}));return def.promise()},createUserfieldInstance:function createUserfieldInstance(sControl){var self=this,control;try{var dynamicFunction="var baDynamicFn = function(renderParams){ \r\n";dynamicFunction+="return new bizagi.rendering.desktop."+sControl+"(renderParams);\r\n",dynamicFunction+="}\r\n",dynamicFunction+="baDynamicFn",dynamicFunction=eval(dynamicFunction),control=dynamicFunction(self.initialParams)}catch(e){control=self.getUserFieldInstance(self.initialParams)}return control.properties.isUserField=!0,self.userfieldInstance=control,self.replicateUserfieldMethods(control),self.userfieldInstance.bind("renderchange",(function(){self.triggerHandler("renderchange",arguments)})),control},loadUserfield:function loadUserfield(data){var self=this,styleContent="";self.properties.styleGuid=self.properties.styleGuid||Math.guid();try{try{data=eval(data)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}$.each(data,(function(e,t){if("js"===t.type)try{t.content=t.content.replace(/bizagi\.rendering\.[^\s]+\.extend(\s|\n|\s)*\((\s|\n|\s)*\"bizagi\.rendering\.[^\s]+\"/gim,(function(e){return e.replace(/bizagi.rendering/gi,"bizagi.rendering.desktop")})),window.eval(t.content)}catch(e){bizagi.log("Could not parse result userfield3 "+self.userfieldName,e.message)}"css"===t.type&&(styleContent+=t.content)})),""!==$.trim(styleContent)&&bizagi.util.loadStyle(styleContent,self.properties.styleGuid);var control=eval("bizagi.rendering."+self.userfieldName)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}},getUserFieldInstance:function(e){return"execution"===this.getMode()?new bizagi.rendering.desktop.defaultUserField(e):new bizagi.rendering.desktop.designUserField(e)},startUserfieldLoading:function(){this.element.addClass("bz-form-userfield__loader"),this.startLoading()},endUserfieldLoading:function(){this.element.removeClass("bz-form-userfield__loader"),this.endLoading()}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.basicUserField",bizagi.rendering.userfieldDefinition.prototype),bizagi.rendering.desktop.basicUserField.extend("bizagi.rendering.desktop.basicUserField",bizagi.rendering.basicUserField.prototype),bizagi.rendering.desktop.basicUserField.extend("bizagi.rendering.desktop.basicUserField",{},{showDialog:function(e,t){var i=this,r=$("<div class='iframeContent'><iframe scrolling='yes' id='innerFrameContent' src='"+e+"' style='width:100%;height:100%;border:0'  /></div>"),a=$("#innerFrameContent",r);a.load((function(){a.callInside((function(e){this.BACloseWindow=function(t,i){e.formDialog.dialog("close"),e.formDialog.callback(t,i)}}),{formDialog:r,container:i}),r.callback=function(e,t){$.each(e,(function(e,t){t.xpath||bizagi.showMessageBox("Error calling closeWindow, the xpath was not defined.","Userfield error"),t.value||bizagi.showMessageBox("Error calling closeWindow, the value was not defined.","Userfield error"),i.getFormContainer().getRender(t.xpath).setDisplayValue(t.value)})),t&&i.submitOnChange()}})),r.dialog({height:t.height,width:t.width,title:t.title})},showPopup:function(e,t){var i=this;bizagi.showPopup(e,t,(function(e,t){$.each(e,(function(e,t){t.xpath||bizagi.showMessageBox("Error calling closeWindow, the xpath was not defined.","Userfield error"),t.value||bizagi.showMessageBox("Error calling closeWindow, the value was not defined.","Userfield error"),i.getFormContainer().getRender(t.xpath).setDisplayValue(t.value)})),t&&i.submitOnChange()}))}}),bizagi.rendering.desktop.basicUserField.extend("bizagi.rendering.desktop.defaultUserField",{},{getEditableControl:function(){var e=this.getControl(),t=this.properties.control;this.input=$("<label>Userfield: "+t+" not found</label>").appendTo(e)},collectData:function(e){},getDisplayValue:function(){return"Userfield: "+this.properties.control+" not found"},getReadonlyControl:function(){var e=this.getControl(),t=this.properties.control;return $("<label>Userfield: "+t+" not found</label>").appendTo(e)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.document",bizagi.rendering.document.prototype),bizagi.rendering.desktop.document.extend("bizagi.rendering.desktop.document",{},{postRender:function(){this.applyDocumentTemplatesFormat(),this.properties.allowSendInMail&&this.bindEmailDialog()},renderReadOnly:function(){return""},bindEmailDialog:function(){var e=this.getControl(),t=this.properties.xpathContext||"",i=this.properties.xpath;$(".ui-bizagi-render-documentgenerator-sendmail",e).bizagiSendEmail({tmpl:this.renderFactory.getTemplate("dialog-send-email"),value:this.value,self:this,dataService:this.dataService,properties:this.properties,xpath:i,xpathContext:t})},applyDocumentTemplatesFormat:function(){var e=this,t=e.getControl();t.addClass("ui-bizagi-render-display-block");var i=$(".ui-bizagi-document-upload-item",t);$.each(i,(function(t,i){$(".ui-bizagi-document-type",i).addClass("ui-bizagi-document-extension");var r=e.returnCssTypeFile($("a > span",i).html());$(".ui-bizagi-document-type",i).addClass(r)}))},updateControlForPrintMode:function(e){$(".ui-bizagi-render-button",e).each((function(){$(this).remove()})),$(".ui-bizagi-div-error-container",e).each((function(){$(this).remove()})),$(".ui-bizagi-document-type",e).each((function(){$(this).remove()})),$("a",e).each((function(){$(this).attr("target","_blank").attr("title",$("span",this).html()).css("text-decoration","none")})),$("ol",e).each((function(){$(this).removeClass("ui-bizagi-container-documents"),$(this).addClass("ui-bizagi-container-documents-print")}))},showDocumentPreview:function(e,t){var i,r,a,n;navigator.sayswho=(r=navigator.appName,a=navigator.userAgent,(n=a.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i))&&null!=(i=a.match(/version\/([\.\d]+)/i))&&(n[2]=i[1]),n=n?[n[1],n[2]]:[r,navigator.appVersion,"-?"]);var o=$("<div style='overflow:hidden;'></div>");o.empty(),o.appendTo("body",window.document);var s=$.browser.mozilla||$.browser.msie?this.renderFactory.getTemplate("document-item-preview-object"):this.renderFactory.getTemplate("document-item-preview");o.append($.fasttmpl(s,{url:e}));var l={};l[this.getResource("confirmation-box-ok")]=function(){!bizagi.util.isIE()&&window.URL.revokeObjectURL(e),o.dialog("destroy"),o.remove()},"Firefox"!==navigator.sayswho[0]&&(l[this.getResource("render-actions-print")]=function(){var e=0;!function t(i){if(!document.getElementById("ui-bizagi-document-pdf-preview")&&e<5){e+=1;var r=setTimeout((function(){t(i),clearTimeout(r)}),1e3)}else $.browser.mozilla||$.browser.msie?($(".ui-bizagi-document-pdf-preview").focus(),$(".ui-bizagi-document-pdf-preview")[0].print()):(document.getElementById("ui-bizagi-document-pdf-preview").focus(),document.getElementById("ui-bizagi-document-pdf-preview").contentWindow.print())}($("#ui-bizagi-document-pdf-preview",o)[0])}),o.dialog({width:800,height:600,title:t,maximized:!1,modal:!0,buttons:l,close:function(){!bizagi.util.isIE()&&window.URL.revokeObjectURL(e),o.dialog("destroy"),o.remove()}})},redrawDocuments:function(e,t,i){this._super(e,t,i),this.applyDocumentTemplatesFormat()},autoOpenDocuments:function(){var e=this,t=e.properties,i=e.getControl();if(t.autoOpen)if(t.downloadalldocuments){var r=$(".ui-bizagi-document-upload-item[data-joined=true]",i);if(r&&1===r.length){var a=r.attr("data-filename");e.getAllDocumentFiles({filename:a}).then((function(t){var i=bizagi.util.isIE()?r.attr("data-url")+"&h_disposition=inline":window.URL.createObjectURL(t);e.showDocumentPreview(i,a),!bizagi.util.isIE()&&window.URL.revokeObjectURL(i)})).fail((function(t){var i=e.getFormContainer();i&&i.failHandler(t)}))}}else $.each($(".ui-bizagi-document-upload-item",i),(function(){var t=$(this).data(),i=t.filename;"PDF"!==i.substr(i.lastIndexOf(".")+1).toUpperCase()||t.joined||e.getDocumentFile(t).then((function(r){var a=bizagi.util.isIE()?t.url+"&h_disposition=inline":window.URL.createObjectURL(r);e.showDocumentPreview(a,i)})).fail((function(t){var i=e.getFormContainer();i&&i.failHandler(t)}))}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.image.prototype),bizagi.rendering.desktop.image.extend("bizagi.rendering.desktop.image",{},{initializeData:function(e){this._super(e),this.properties.forceBase64=!0,this.properties.value=this.properties.value||[]},postRender:function(){var e,t=this,i=t.getControl(),r=t.properties,a=t.getMode(),n=t.renderFactory.getTemplate("images"),o=t.properties.width,s=t.properties.height;t.properties.flashVersion=!1;var l=$.fasttmpl(n,{xpath:bizagi.util.encodeXpath(t.getUploadXpath()),editable:r.editable,url:t.properties.url,allowDelete:r.allowDelete,mode:a});if($(".image-wrapper",i).empty().append(l),"design"===a||"layout"===a||0===t.properties.url.length){var d=setTimeout((function(){if("auto"===s){if("grid"===t.parent.properties.type)e=$(i).height()+"px",bizagi.util.cssExtended($(".image-wrapper",i),"width:100%!important");else{var r="panel"===t.parent.properties.type?t.parent.parent:t.parent,a=i.height();e=r.container.height()-17;var n=t.parent.getChildreCount(),l=t.parent.getChildrenSumHeight("image");void 0!==t.getFormContainer().properties&&t.parent.properties.id==t.getFormContainer().properties.id?e=50:n>1&&(e-=l-a),$(".image-wrapper",i).height(e)}s=e}$("a",i).css({width:o,height:s}),$(".resizable_img",i).css({width:o,height:s}),clearTimeout(d)}),150);if($(".resizable_img",i).hasClass("background-image")){var u=$(".resizable_img",i).css("background-image").replace(/url\(|\)|"|'/g,""),c=$("<img src="+u+">");c.css({width:o,height:s}),$(".resizable_img",i).append(c),$(".resizable_img",i).css({"background-image":"none","border-top-width":"0","border-left-width":"0","border-right-width":"0","border-down-width":"0",padding:"0",display:"inline-block"})}}else var p=!1,h=i.width(),g=setTimeout((function(){var e=t.properties.isAutoWidth;if(e&&"grid"===t.parent.properties.type){var r=$(".img",i).width();r<h&&0<r?o=r:r>=h&&(o=h-20,p=!0),$("a",i).css({height:"auto"})}else $("a",i).css({width:o,height:"auto"});$(".img, .ui-bizagi-render-image-wrapper .image-file",i).css({width:o,height:"auto"}),$(".ui-bizagi-render-upload-wrapper",i).addClass("uploaded");var a=48;-1!==(t.properties.width+"").indexOf("px")&&(a=(t.properties.width+"").replace("px","")),$(".ui-bizagi-render-image-wrapper .image-file",i).addClass("w-size-"+a),$("img",i).css("width",o),$("img",i).css("height","auto"),e&&Number($("a",i).css("width").slice(0,-2))>Number($(".img",i).css("width").slice(0,-2))&&$("a",i).css({width:$(".img",i).css("width")}),e&&p&&"grid"===t.parent.properties.type&&$("a",i).closest(".ui-bizagi-render").css("text-align","left"),clearTimeout(g)}),50);t.preventDefaultForAnchorTag(),t.isPostRendered&&t.isPostRendered.resolve()},isReadyToSave:function(){return this.ready()},configureHandlers:function(){var e=this.getControl(),t=this.properties;this._super(),this.deleteHandler(),$(".ui-bizagi-render-image-wrapper",e).bizagiUpload({renderReference:this,dialogTemplate:this.renderFactory.getTemplate("image-dialog"),properties:{scriptData:this.buildAddParams(),url:t.addUrl,xpath:t.xpath,validExtensions:t.validExtensions,maxSize:t.maxSize},onUploadFileCompletedCallback:this.onUploadFileCompleted,dialogTitle:this.getResource("render-upload-link-label")}),e.delegate(".ui-bizagi-render-upload-item","mouseover",(function(){var e=$(this);$(".ui-bizagi-render-upload-icon",e).css("display","inline-block"),e.removeClass("ui-state-default").addClass("ui-state-hover")})),e.delegate(".ui-bizagi-render-upload-item","mouseout",(function(){var e=$(this);$(".ui-bizagi-render-upload-icon",e).css("display","none"),e.addClass("ui-state-default").removeClass("ui-state-hover")}))},deleteHandler:function(){var e=this,t=e.getControl();$(".delete-button",t).bind("click",(function(t){t.stopPropagation(),e.deleteImage()}))},deleteImage:function(){var e=this,t=e.properties;return e.dataService.deleteImage({url:t.deleteUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contexttype}).done((function(){e.properties.value=[],e.refreshControl()}))},configureDesignView:function(){var e=this.getControl();this._super(),$("*:not(.ui-bizagi-render-control-required)",e).css({padding:"0px",margin:"0px",border:"0px","line-height":"0px",position:"relative",display:"inline-block",top:"0"}),$(".image-file",e).css({width:this.properties.width,height:this.properties.height})},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){var e=this.getControl(),t=this.renderFactory.getTemplate("images"),i=this.getMode(),r=$.fasttmpl(t,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),editable:!1,url:this.properties.url,allowDelete:!1,mode:i});$(".ui-bizagi-render-upload-wrapper",e).empty().append(r),$("a,.img, .ui-bizagi-render-image-wrapper .image-file, .ui-bizagi-render-image-wrapper",e).css({width:this.properties.width,height:this.properties.height})},getTemplateItem:function(){return this.renderFactory.getTemplate("image-item")},openUploadDialog:function(){var e=this,t=e.properties,i=window.document,r=e.dialogBox=$("<div class='ui-bizagi-component-loading'/>");r.empty(),r.appendTo("body",i);var a={};a[e.getResource("render-upload-dialog-select")]=function(){e.checkMaxSize()&&e.checkFileTypes()&&$.when(e.processUploadFile()).done((function(t){e.onUploadFileCompleted(t),e.closeUploadDialog()}))},a[e.getResource("text-cancel")]=function(){e.closeUploadDialog()},r.dialog({width:500,height:200,title:e.getResource("render-upload-link-label"),modal:!0,buttons:a,close:function(){e.closeUploadDialog()},resizeStop:function(t,i){e.form&&e.form.resize(i.size)}});var n=e.renderFactory.getTemplate("image-dialog");$.tmpl(n,{scriptData:e.buildAddParams(),url:t.addUrl,xpath:t.xpath,validExtensions:t.validExtensions.replace(";",","),maxSize:t.maxSize}).appendTo(r),$(".ui-bizagi-loading-message").remove()},closeUploadDialog:function(){this.dialogBox.dialog("destroy"),this.dialogBox.remove()},onUploadFileCompleted:function(e,t){var i=e,r=i.getControl(),a=$(".ui-bizagi-render-image-wrapper",r),n=JSON.parse(t),o=0,s=r.width(),l=r.find(".img").size()>0,d=r.find(".resizable_img").width();o=i.properties.isAutoWidth?"image"!=i.properties.type?r.width():"99%":i.properties.width,$(".uploadifyQueueItem",r).css({width:i.properties.width}),"error"!==n.type?(bizagi.util.isEmpty(i.properties.value)&&(i.properties.value=[[0,"uploaded"]]),$.when(i.renderUploadItem()).done((function(e){$(a).empty(),$(a).append(e),i.deleteHandler(),i.triggerRenderChange();var t=setTimeout((function(){var e=!1,a=i.properties.isAutoWidth;a&&"grid"===i.parent.properties.type?($(".img",r).width()<s?o=$(".img",r).width():$(".img",r).width()>=s&&(o=s-20,e=!0),l||$("a",r).closest("td").css("width",d),$("a",r).css({height:"auto"})):$("a",r).css({width:o,height:"auto"}),$(".img, .ui-bizagi-render-image-wrapper .image-file",r).css({width:o,height:"auto"}),$(".ui-bizagi-render-upload-wrapper",r).addClass("uploaded");var n=48;-1!==(i.properties.width+"").indexOf("px")&&(n=(i.properties.width+"").replace("px","")),$(".ui-bizagi-render-image-wrapper .image-file",r).addClass("w-size-"+n),$("img",r).css("width",o),$("img",r).css("height","auto"),$(".image-wrapper",r).css("height","auto"),a&&Number($("a",r).css("width").slice(0,-2))>Number($(".img",r).css("width").slice(0,-2))&&$("a",r).css({width:$(".img",r).css("width")}),"grid"===i.parent.properties.type&&a&&(e?$("a",r).closest(".ui-bizagi-render").css("text-align","left"):i.properties.columnAlign?($("a",r).closest(".ui-bizagi-render").css("text-align",i.properties.columnAlign),$(".image-wrapper",r).css("text-align",i.properties.columnAlign)):$("a",r).closest(".ui-bizagi-render").css("text-align","center")),clearTimeout(t)}),50)}))):n.isMaintenanceWindow||bizagi.showMessageBox(n.message)},buildAddParams:function(){var e=this.properties,t=this.getFormContainer(),i=[],r="savefile";e.isUserPreference&&(r="SAVEUSERIMAGE",i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",value:"entity"}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey",value:this.currentUser})),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath",value:this.getUploadXpath()}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender",value:e.id}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext",value:e.xpathContext}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE,value:e.idPageCache}),i.push({key:this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",value:t.properties.sessionId}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action",value:r}),e.contexttype&&i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",value:e.contexttype});try{"undefined"!=typeof BIZAGI_SESSION_NAME?i.push({key:BIZAGI_SESSION_NAME,value:t.properties.sessionId}):i.push({key:"JSESSIONID",value:t.properties.sessionId})}catch(e){i.push({key:"JSESSIONID",value:t.properties.sessionId})}return i},checkMaxSize:function(){var e=this.properties,t=this.dialogBox,i=$("input[type=file]",t).get(0)||{};return null!=i.files?i.files.length>0?!(i.files[0].size>e.maxSize)||(this.showError(this.getResource("render-upload-alert-maxsize").replace("{0}",e.maxSize)),!1):(this.showError(this.getResource("render-required-upload").replace("#label#","")),!1):!bizagi.util.isIE()||(!(""===i.value||!i.value)||(this.showError(this.getResource("render-required-upload").replace("#label#","")),!1))},checkFileTypes:function(){var e=this.properties,t=this.dialogBox,i=$("input[type=file]",t).val();if(e.validExtensions&&e.validExtensions.length>0){var r=e.validExtensions.replaceAll("*.","").split(";");if(!this.stringEndsWithValidExtension(i,r,!0))return this.showError(this.getResource("render-upload-allowed-extensions")+e.validExtensions),!1}return!0},stringEndsWithValidExtension:function(e,t,i){if(0==i&&0==e.length)return!0;for(var r=0;r<t.length;r++){if("*"==t[r].toLowerCase())return!0;if(e.toLowerCase().endsWith(t[r].toLowerCase()))return!0}return!1},showError:function(e){var t=$("#alert-file-upload",this.dialogBox);t.empty(),t.show(),t.html(e)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},processUploadFile:function(){var e=this,t=new $.Deferred,i=e.dialogBox,r=$("form",i),a=$("iframe",r);return function i(){try{var r="";if(a[0].contentWindow)r=(bizagi.util.isIE8()?$(a[0].contentWindow.document.body):$(a[0].contentWindow.eval("document.body"))).text();if(r.length>0)t.resolve(r);else var n=setTimeout((function(){i(),clearTimeout(n)}),50)}catch(t){e.closeUploadDialog(),bizagi.showMessageBox(t.toString())}}(),r.submit(),t.promise()},cleanData:function(){if(this.hasValue())return $.when(this.deleteImage())}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.combo",bizagi.rendering.columns.combo.prototype),bizagi.rendering.desktop.columns.combo.extend("bizagi.rendering.desktop.columns.combo",{},{postRender:function(e,t,i){this._super(e,t,i);var r=this.getMode(),a=$(".ui-selectmenu-status",t);(this.applyColumnStyles(a),this.properties.editable&&i&&i.addClass("ui-bizagi-cell-combo"),"execution"===r)&&(this.getDecorated(e).getControl().parents("tr").data("new-row")?this.isNewRow=!0:this.isNewRow=!1)},postRenderReadOnly:function(e,t,i){this._super(e,t,i);var r=$(".ui-selectmenu-status",t);this.applyColumnStyles(r),i&&i.removeClass("ui-bizagi-cell-combo")},applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath,e.cleanData=function(){this.value=this.properties.value=this.selectedValue={id:0,value:this.getResource("render-combo-empty-value")},this.setValue(this.value);var e=this.getControl().find("input");e&&e.val(this.getValue().value)}}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.document",bizagi.rendering.columns.document.prototype),bizagi.rendering.desktop.columns.document.extend("bizagi.rendering.desktop.columns.document",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),e.getControlHtml=this.getControlHtml,"design"!==t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.getDocumentXpath=this.getDocumentXpath,e.getContextXpath=this.getContextXpath,e.documentTemplateGenerate=this.documentTemplateGenerate,e.preRenderControl=this.preRenderControl,e.deleteDocumentTemplate=this.deleteDocumentTemplate,e.getTemplateItem=this.getTemplateItem,e.properties.xpathContext=this.getContextXpath())},getTemplateItem:function(){return"document-column-item"},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath),t.buttonExecuted=!0;var i=e.parent,r=e.getFormContainer();$.when(r.submitData()).done((function(){$.when(e.dataService.generateDocumentTemplate(t)).done((function(t){$.when(i.refresh()).done((function(){e.autoOpenDocuments()})),e.endLoading()})).fail((function(){e.showErrorMessage(),e.endLoading()}))})).fail((function(t){e.getFormContainer().addErrorMessage(t),e.endLoading()})),t.buttonExecuted=!1},getControlHtml:function(e,t,i,r,a,n){for(var o=!0,s=0;s<this.parent.properties.data.rows.length;s++)if(this.parent.properties.data.rows[s][0]==this.surrogateKey){o=!1;break}return $.fasttmpl(e,{noActivateButton:o,editable:"execution"!==t,downloadalldocuments:i,required:a.required,allowgenerate:r,xpath:this.getXpath(a.xpath),append:!!a.append&&a.append,caption:a.caption,noFiles:n,allowSendInMail:a.allowSendInMail,mode:t}).replace("ui-bizagi-document-upload-item-design","ui-bizagi-document-upload-item-design-column")},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!=i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getDocumentXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!=i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),t},postRenderReadOnly:function(e,t,i){this._super(e,t,i)},getContextXpath:function(){var e=this.getFormContainer();return(e.properties.xpathContext?e.properties.xpathContext+".":"")+this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},preRenderControl:function(){null!=this.value&&null!=this.properties.value&&(this.properties.value=this.value)},deleteDocumentTemplate:function(e){var t=this.parent,i={};i.xpath=this.properties.xpath+"[fileName='"+e+"']",i.idRender=this.properties.id,i.xpathContext=this.getContextXpath(),i.idPageCache=this.properties.idPageCache,$.when(this.dataService.deleteUploadFile(i)).done((function(){t.refresh()}))}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.letter",bizagi.rendering.columns.letter.prototype),bizagi.rendering.desktop.columns.letter.extend("bizagi.rendering.desktop.columns.letter",{},{applyOverrides:function(e){this.properties,this.getMode();this._super(e),e.getContextXpath=this.getContextXpath,e.getXpath=this.getXpath,e.getControl=this.getControl,e.setDisplayValue=this.setDisplayValue,e.postRenderReadOnly=function(t){var i=e.renderReadOnly.apply(e);$(".ui-bizagi-cell",t).append(i)}},getContextXpath:function(){var e=this.getMode(),t=this.properties;return"execution"===e?t.xpathContext&&t.xpathContext.length>0?t.xpathContext+"."+this.grid.properties.xpath+"[id="+this.surrogateKey+"]":this.grid.properties.xpath+"[id="+this.surrogateKey+"]":""},getXpath:function(){var e=this.properties.xpath,t=e.indexOf(this.grid.properties.xpath);return-1!=t&&(e=e.substr(t+this.grid.properties.xpath.length+1)),e},postRender:function(e,t){this._super(e,t);var i=this.getMode();if(this.setSurrogateKey(e),"execution"==i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")&&r.html(bizagi.localization.getResource("render-grid-column-letter-mandatory-key"))}},getControl:function(){return this.properties.editable?$(".ui-bizagi-render-control",this.element):$(".ui-bizagi-cell",this.element)},setDisplayValue:function(e){this.setValue(e,!1)}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.search",bizagi.rendering.columns.search.prototype),bizagi.rendering.desktop.columns.search.extend("bizagi.rendering.desktop.columns.search",{},{postRender:function(e,t){this._super(e,t);var i=this.getDecorated(e),r=$(".ui-selectmenu-status",i.getControl());this.applyColumnStyles(r),this.properties.editable&&i.getControl().addClass("ui-bizagi-cell-search")},postRenderReadOnly:function(e,t,i){this._super(e,t);var r=$(".ui-selectmenu-status",t);this.applyColumnStyles(r)},applyOverrides:function(e){if(this._super(e),e.refreshControl=this.refreshControl,e.properties.advancedSearch){var t=e.internalRenderCellControl;e.internalRenderCellControl=function(e,i,r,a){var n=this,o=r.properties.editable;r.properties.editable=e,$.when(r.render(i,a.getValue(i))).done((function(o){n.element&&n.element.find("[data-bizagi-component=cellContent] > div").replaceWith(o),t.call(n,e,i,r,a)})),r.properties.editable=o}}},refreshControl:function(){this.grid.refreshCell({key:this.surrogateKey,column:this.properties.xpath,xpathContext:this.getFormContainer().properties.xpathContext})}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.date",bizagi.rendering.columns.date.prototype),bizagi.rendering.desktop.columns.date.extend("bizagi.rendering.desktop.columns.date",{},{applyOverrides:function(e){e.originalRenderElement=e.renderElement,e.renderElement=function(){return this.originalRenderElement("render-base")},this._super(e)},resolveValue:function(e,t){var i="";if((bizagi.util.isString(t)||bizagi.util.isNumeric(t))&&(i=t),bizagi.util.isArray(t)){var r=e.grid.getIndexes(),a=e.surrogateKey,n=r.indexOf(a);-1!==n&&(i=t[n])}return i},postRender:function(e,t){this._super(e,t);var i=this.properties;this.getDecorated(e).properties.showTime=!!i.showTime&&i.showTime;var r=$(".bz-input-icon",t);this.applyColumnStyles(r)},postRenderReadOnly:function(e,t){this._super(e,t);var i=this.properties;this.getDecorated(e).properties.showTime=!!i.showTime&&i.showTime}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.text",{},{postRender:function(e,t){this._super(e,t);var i=$("input, textarea",t);this.applyColumnStyles(i)},postRenderReadOnly:function(e,t){if(this.properties.autoExtend){var i=t.find(".ui-bizagi-cell-readonly");i.length>0&&i.css("max-height","none")}this._super(e,t)},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!=i.length&&i.blur((function(){var t=$(this),i=e.previousValue,r=e.value;null!=i&&r!=i&&null!=$(this).data("newValue")&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)}))},applyOverrides:function(e){this._super(e);var t=e.internalRenderCellControl;e.internalRenderCellControl=function(e,i,r,a){var n=this,o=r.properties.editable;r.properties.editable=e,$.when(r.render(i,a.getValue(i))).done((function(o){n.element&&n.element.find("[data-bizagi-component=cellContent] > div").replaceWith(o),t.call(n,e,i,r,a)})),r.properties.editable=o}}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.searchList",{},{init:function(e){this._super(e);this.properties},render:function(e,t,i){var r=this.getDecorated(e),a=this.properties;a.recalculate&&r.resetData();var n=a.xpathContext.length>0?a.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return r.properties.xpathContext=n,this._super(e,t,i)},setValue:function(e,t){var i=this.getDecorated(e);"undefined"!=i&&null!=i&&(i.properties.originalValue=t,i.properties.previousValue=t,null==t&&void 0!==this.properties.defaultvalue&&null!=i.grid&&(t=this.setDefaultValue(e,i)),null==t&&(t=[]),i.properties.value=t,i.setValue(t,!1))}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.number",{},{postRender:function(e,t){this._super(e,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(e,t){return this.renderReadOnly(e,t)},postRenderSummary:function(e,t){return this.postRenderReadOnly(e,t),!0},applyOverrides:function(e){this._super(e);var t=e.internalRenderCellControl;e.internalRenderCellControl=function(e,i,r,a){var n=this,o=r.properties.editable;r.properties.editable=e,$.when(r.render(i,a.getValue(i))).done((function(o){n.element&&n.element.find("[data-bizagi-component=cellContent] > div").replaceWith(o),t.call(n,e,i,r,a)})),r.properties.editable=o}}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.numberScientificNotation",{},{postRender:function(e,t){this._super(e,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(e,t){return this.renderReadOnly(e,t)},postRenderSummary:function(e,t){return this.postRenderReadOnly(e,t),!0}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.upload",{},{applyOverrides:function(e){var t=this.getMode();if(this._super(e),e.getUploadXpath=this.getUploadXpath,"design"!==t&&"layout"!==t){var i=e.applyUploadPlugin;e.getXpathContext=function(){var e=this.grid.properties.xpath+"[id="+this.surrogateKey+"]";return this.properties.xpathContext.length>0?this.properties.xpathContext+"."+e:e},e.getUploadXpathContext=function(){return this.properties.xpathContext.length>0?this.properties.xpathContext:""},e.applyUploadPlugin=function(){var t=this.getControl();i.apply(e,arguments),t.undelegate(".ui-bizagi-render-upload-item","mouseover"),t.undelegate(".ui-bizagi-render-upload-item","mouseout"),$(".ui-bizagi-render-upload-icon",t).css("display","inline-block"),$(".ui-bizagi-render-upload-wrapper object",t).css({position:"relative"}),$(".ui-bizagi-render-upload-queue",t).css({"max-width":"150px"})},e.postRender=function(){var e=this.getControl();this.properties.allowSendInMail&&this.bindEmailDialog(),e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-upload"),this.checkMaxFiles()},e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getUploadXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})}}e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),r=this.getXpathContext();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:t.xpath,xpathContext:r,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})},e.processUploadFile=function(){var e=this,t=e.dialogBox,i=new $.Deferred,r=$("form",t),a=$("iframe",r),n=e.getXpathContext();$("[name=h_xpathContext]",r).val(n);return function t(){try{var r="";if(a[0].contentWindow)r=(bizagi.util.isIE8()?$(a[0].contentWindow.document.body):$(a[0].contentWindow.eval("document.body"))).text();if(r.length>0)i.resolve(r);else var n=setTimeout((function(){t(),clearTimeout(n)}),50)}catch(t){e.closeUploadDialog(),window.alert(t.toString())}}(),r.submit(),i.promise()}},renderReadOnly:function(e,t){var i,r=this,a=this.getDecorated(e);if(r.setValue(e,t),r.setSurrogateKey(e),r.applyOverrides(a),a.grid=this.grid,a.column=this,a.surrogateKey=e,r.readyDeferred=new $.Deferred,a.files.length>0){var n=this.properties.editable;a.properties.editable=!1,i=a.render("cell.upload"),a.properties.editable=n}return r.bind("rendered",(function(){r.readyDeferred.resolve()})),i},postRenderReadOnly:function(e,t){if(this._super(e,t),0==this.getDecorated(e).files.length){var i=this.getResource("render-upload-no-files");$(".ui-bizagi-cell-readonly",t).html(i),$(".ui-bizagi-cell-icon",t).addClass("ui-bizagi-cell-icon-right")}else t&&t.length>0&&this.applyColumnStyles(t)},postRender:function(e,t){var i=this.getMode();if(this._super(e,t),this.setSurrogateKey(e),"design"!=i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")?(r.html(bizagi.localization.getResource("render-grid-column-upload-mandatory-key")),this.isNewRow=!0):this.isNewRow=!1}},canBeSent:function(){return!1},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath}}),bizagi.rendering.desktop.columns.combo.extend("bizagi.rendering.desktop.columns.radio",{},{applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath,e.cleanData=function(){var e={id:"",label:""};this.element.find(".ui-radio-state-checked").removeClass("ui-radio-state-checked"),this.setDisplayValue(e),this.setValue(e)}}}),bizagi.rendering.desktop.columns.combo.extend("bizagi.rendering.desktop.columns.list",{},{applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath,e.cleanData=function(){var e=this.getControl().find(".ui-state-active"),t=this.getValue();this.value=this.properties.value=this.selectedValue={id:"",value:""},this.selectedValue=t.value,e.removeClass("ui-state-focus ui-selected ui-state-active")}}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.image",{},{applyOverrides:function(e){var t=this,i=t.properties,r=t.getMode();this._super(e),e.getUploadXpath=this.getUploadXpath;var a=e.applyUploadPlugin;e.properties.flashVersion&&(e.applyUploadPlugin=function(){var t=this,i=t.getControl();a.apply(e,arguments),i.undelegate(".ui-bizagi-render-upload-item","mouseover"),i.undelegate(".ui-bizagi-render-upload-item","mouseout"),$(".ui-bizagi-render-upload-icon",i).css("display","inline-block"),$(".ui-bizagi-render-upload-wrapper object",i).css({position:"relative"})});var n=e.renderControl,o=e.internalPostRender;e.renderControl=function(){return""},e.internalPostRender=function(){var i=e.getControl();i.parents("tr").data("new-row")?(i.html(bizagi.localization.getResource("render-grid-column-upload-mandatory-key")),t.isNewRow=!0):(t.isNewRow=!1,$.when(n.apply(e,arguments)).done((function(t){(i.hasClass("ui-bizagi-render-control")||i.hasClass("ui-bizagi-cell-readonly"))&&(i.append(t),o.apply(e,arguments))})))},e.buildAddParams=function(){var e=this.properties,t=this.getFormContainer(),i=[];i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath",value:e.xpath}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender",value:e.id}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext",value:e.xpathContext}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE,value:e.idPageCache}),i.push({key:this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",value:t.properties.sessionId}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action",value:"savefile"}),e.contexttype&&i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",value:e.contexttype});try{null!=BIZAGI_SESSION_NAME?i.push({key:BIZAGI_SESSION_NAME,value:t.properties.sessionId}):i.push({key:"JSESSIONID",value:t.properties.sessionId})}catch(e){i.push({key:"JSESSIONID",value:t.properties.sessionId})}return i},e.refreshControl=this.refreshControl,"execution"===r&&(i.xpathContext.length>0?e.properties.xpathContext=i.xpathContext+"."+t.grid.properties.xpath+"[id="+e.surrogateKey+"]":e.properties.xpathContext=t.grid.properties.xpath+"[id="+e.surrogateKey+"]")},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath},refreshControl:function(){this.grid.refreshCell({key:this.surrogateKey,column:this.properties.xpath,xpathContext:this.getFormContainer().properties.xpathContext})},canBeSent:function(){return!1}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.uploadecm",{},{applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath;var t=e.applyUploadPlugin;e.applyUploadPlugin=function(){var i=this,r=i.getControl();t.apply(e,arguments),r.undelegate(".ui-bizagi-render-upload-item","mouseover"),r.undelegate(".ui-bizagi-render-upload-item","mouseout"),$(".ui-bizagi-render-upload-icon",r).css("display","inline-block"),$(".ui-bizagi-render-upload-wrapper object",r).css({position:"relative"})},e.buildAddParams=function(){var e=this.properties,t={},i=this.getUploadXpath(this.surrogateKey);i=i.split(".");var r=this.getXpathContext(this.surrogateKey);return t.url=e.addUrl,t.xpath=e.xpath,t.idAttrib=e.idAttrib,t.xpathContext=r,t.metaValues=[],t.idPageCache=e.idPageCache,t.contexttype="entity",t.validExtensions=e.validExtensions,t.maxSize=e.maxSize,t},e.getXpathContext=function(){var e=this.grid.properties.xpath+"[id="+this.surrogateKey+"]";return this.properties.xpathContext.length>0?this.properties.xpathContext+"."+e:e}},renderReadOnly:function(e,t){var i,r=this,a=this.getDecorated(e);if(a.setValue(t),r.setValue(e,t),r.setSurrogateKey(e),r.applyOverrides(a),a.grid=this.grid,a.column=this,a.surrogateKey=e,r.readyDeferred=new $.Deferred,a.files.length>0){this.properties.editable;a.properties.editable=!1,i=a.render("cell.upload")}return r.bind("rendered",(function(){r.readyDeferred.resolve()})),i},postRenderReadOnly:function(e,t){this._super(e,t);if(0==this.getDecorated(e).files.length){var i=this.getResource("render-upload-no-files");$(".ui-bizagi-cell-readonly",t).html(i),$(".ui-bizagi-cell-icon",t).addClass("ui-bizagi-cell-icon-right")}else t&&t.length>0&&this.applyColumnStyles(t)},postRender:function(e,t){this._super(e,t);var i=this.getMode();if(this.setSurrogateKey(e),"execution"==i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")?(r.html(bizagi.localization.getResource("render-grid-column-upload-mandatory-key")),this.isNewRow=!0):this.isNewRow=!1}},getUploadXpath:function(e){e=this.surrogateKey||e||"";var t=this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath;return this.properties.xpathContext.length>0?this.properties.xpathContext+"."+t:t}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.link",{},{applyOverrides:function(e){var t=this;this._super(e),e.getControl=this.getControl,"columnFormLink"===e.properties.type&&(e.getFormLinkXpath=this.getFormLinkXpath);var i=e.renderControl,r=e.internalPostRender;e.internalPostRender=function(){var a=e.getControl();a.parents("tr").data("new-row")?(a.html('<label style="font-weight: normal;">'+bizagi.localization.getResource("render-grid-column-button-mandatory-key")+"</label>"),t.isNewRow=!0):(t.isNewRow=!1,$.when(i.apply(e,arguments)).done((function(t){(a.hasClass("ui-bizagi-render-control")||a.hasClass("ui-bizagi-cell-readonly"))&&r.apply(e,arguments)})))}},getControl:function(){var e=this.properties,t=this.element||this.observableElement;return e.editable?$(".ui-bizagi-render-control",t):$(".ui-bizagi-cell-readonly",t).length>0?$(".ui-bizagi-cell-readonly",t):$(".ui-bizagi-render-control",t)},render:function(e,t,i,r){var a=this.getDecorated(e);return a.properties.xpathContext=this.grid.properties.xpath+"[id="+e+"]",this.grid.properties.xpathContext&&-1==a.properties.xpathContext.indexOf(this.grid.properties.xpathContext)&&(a.properties.xpathContext=this.grid.properties.xpathContext+"."+a.properties.xpathContext),this._super(e,t,i,r)},renderReadOnly:function(e,t,i){return void 0===this.properties.canBeSaved&&(this.properties.canBeSaved=1==this.properties.editable),this.render(e,t,i,"CALLER_RENDER_READ_ONLY_COLUMNSLINK")},postRenderReadOnly:function(e,t,i){this.postRender(e,t,i)},getFormLinkXpath:function(){if(this.properties.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties(),this.properties.xpath)return this.properties.xpath}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.button",{},{applyOverrides:function(e){this.properties,this.getMode();this._super(e),e.configureHandlers=function(){var t=this,i=e.getControl();$(":button",i).bind("click",(function(i){e.processButton.apply(t)}))}},postRender:function(e,t){this._super(e,t);var i=this.getMode();if(this.setSurrogateKey(e),"execution"==i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")?(r.html(bizagi.localization.getResource("render-grid-column-button-mandatory-key")),this.isNewRow=!0):this.isNewRow=!1}},postRenderReadOnly:function(e,t){this.properties;this._super(e,t)},renderReadOnly:function(e,t){var i,r=this,a=this.getDecorated(e);r.setSurrogateKey(e),r.applyOverrides(a),a.grid=this.grid,a.column=this,a.surrogateKey=e,r.readyDeferred=new $.Deferred;var n=this.properties.editable;return a.properties.editable=!1,i=a.render("cell.button"),a.properties.editable=n,r.bind("rendered",(function(){r.readyDeferred.resolve()})),i}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.actions",{},{postRender:function(e,t){var i=this.getMode();if(this._super(e,t),this.configureHandlersActions(e),$(".ui-bizagi-render",t).css("overflow","auto"),"execution"==i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")&&r.html(this.renderDraftControl())}},configureHandlersActions:function(e){var t=this,i=t.getDecorated(e),r=i.element.find(".gn-bz-grid__more"),a=[];i.element.on("click",".gn-bz-grid__delete",(function(e){$(this).closest("tr[data-new-row='true']").trigger("delete-row")})),t.grid.columnActionParams.allowDetail&&a.push({name:t.parent.properties.detailLabel,icon:"icon-detail",fn:function(){t.grid.showFormDetails(e)}}),t.grid.columnActionParams.allowEdit&&t.grid.columnActionParams.withEditForm&&a.push({name:t.parent.properties.editLabel,icon:"icon-edit",fn:function(){t.grid.editRow(e)}}),t.grid.columnActionParams.allowDelete&&a.push({name:t.parent.properties.deleteLabel,icon:"icon-delete",fn:function(){t.grid.deleteRow(e)}}),r.overflowMenu({items:a})},renderDraftControl:function(){var e=this.renderFactory.getTemplate("gridActions-delete");return $.fasttmpl(e,{})}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.exclusiveCheck",{},{render:function(e,t){var i=this;i.changed=!1;var r=i.properties,a=i.grid.changes,n=i.getDecorated(e);if(n.grid=i.grid,n.column=this,n.surrogateKey=e,"execution"==i.getMode()){i.setValue(e,t||!1);var o=i.grid.enabledChecks[i.properties.xpath].find((function(t){return t.id==e}));void 0===o&&i.grid.enabledChecks[i.properties.xpath].push({id:e,value:t||!1,originalValue:t||!1,changed:!1})}if(null==t){i.changed=!0;var s={};s[i.properties.xpath]=i.getValue(e),bizagi.util.isEmpty(a[e])&&(a[e]={}),a[e]=$.extend({},a[e],s)}if(i.overrideDecoratedRenderProperties(e),!r.editable)return i.renderReadOnly.apply(i,arguments);i.readyDeferred=new $.Deferred;var l=n.render("cell");return n.bind("renderchange",(function(){i.changed=!0,i.grid.enabledChecks[i.properties.xpath].forEach((function(t){if(t.id==e)t.value=n.value,t.changed=!0;else if(n.value&&t.value){i.getDecorated(t.id).setDisplayValue(!1),i.setValue(t.id,!1),t.value=!1,t.changed=!0}}));var t=i.properties.xpath.split(".");i.grid.exclusiveChanges[i.properties.xpath]={xpath:i.properties.xpath,simpleXpath:t[t.length-1],value:i.getValue(e),key:e}})),i.bind("rendered",(function(){i.readyDeferred.resolve()})),l},postRender:function(e,t){this._super(e,t);var i=this.getMode();if(this.setSurrogateKey(e),"execution"==i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")?(r.html('<input type="checkbox" name="exclusiveCheck" title="'+bizagi.localization.getResource("render-grid-column-button-mandatory-key")+'" disabled="disabled" style="width:16.5px;height:16.5px;">'),this.isNewRow=!0):this.isNewRow=!1}},isValueValid:function(e,t,i,r){if(this.grid.enabledChecks=this.grid.enabledChecks||{},(this.grid.enabledChecks[this.properties.xpath]||[]).filter((function(e){return e.value})).length>1){var a=this.getResource("render-exclusive-column-check-error").replaceAll("#label#",this.properties.displayName);return i.push(a),!1}return!0}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.readonly",bizagi.rendering.columns.readonly.prototype),bizagi.rendering.desktop.columns.readonly.extend("bizagi.rendering.desktop.columns.readonly",{},{}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.hidden",bizagi.rendering.columns.hidden.prototype),bizagi.rendering.desktop.columns.hidden.extend("bizagi.rendering.desktop.columns.hidden",{},{}),$.Class.extend("bizagi.rendering.base.factory",{},{init:function(e){this.templates={},this.dataService=e},loadOverrides:function(){},initAsyncStuff:function(){return $.when.apply($,[this.loadOverrides(),this.loadTemplates()])},loadTemplates:function(){},loadTemplate:function(e,t){var i=this;return bizagi.templateService.getTemplate(t,e).done((function(t){i.templates[e]=t}))},getCommonTemplate:function(e){return this.templates[e]},getContainer:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==t?new bizagi.rendering.form(r):"mobileform"==t?new bizagi.rendering.mobileform(r):"template"==t?new bizagi.rendering.formTemplate(r):"queryForm"==t?new bizagi.rendering.queryForm(r):"layout"==t?new bizagi.rendering.layout(r):"usersForm"==t?new bizagi.rendering.usersForm(r):"panel"==t?new bizagi.rendering.panel(r):"section"==t?new bizagi.rendering.section(r):"contentPanel"==t||"contentpanel"==t?new bizagi.rendering.contentPanel(r):"nestedform"==t.toLowerCase()?new bizagi.rendering.nestedForm(r):"tab"==t?new bizagi.rendering.tab(r):"tabItem"==t||"tabitem"==t?new bizagi.rendering.tabItem(r):"horizontal"==t?new bizagi.rendering.horizontal(r):"accordion"==t?new bizagi.rendering.accordion(r):"accordionItem"==t?new bizagi.rendering.accordionItem(r):"group"==t?new bizagi.rendering.group(r):"mobilegroup"==t?new bizagi.rendering.mobilegroup(r):"searchForm"==t?(r.context="search",r.contexttype="metadata",new bizagi.rendering.searchForm(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return t||(t="label"),"text"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.extendedText(r):new bizagi.rendering.text(r):"mobiletext"==t?new bizagi.rendering.mobiletext(r):"association"==t?new bizagi.rendering.association(r):"label"==t?new bizagi.rendering.label(r):"hidden"==t?new bizagi.rendering.hidden(r):"number"==t?new bizagi.rendering.number(r):"money"==t?new bizagi.rendering.money(r):"date"==t?new bizagi.rendering.date(r):"boolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.check(r):new bizagi.rendering.yesno(r):"combo"==t?new bizagi.rendering.combo(r):/^cascadingcombo$/i.test(t)?new bizagi.rendering.cascadingCombo(r):"list"==t?new bizagi.rendering.list(r):"multiSelect"==t?new bizagi.rendering.multiSelect(r):"radio"==t?new bizagi.rendering.radio(r):"image"==t?new bizagi.rendering.image(r):"uploadecm"==t?new bizagi.rendering.ecm(r):"upload"==t?new bizagi.rendering.upload(r):"grid"==t?new bizagi.rendering.grid(r):"groupedgrid"==t?new bizagi.rendering.grid(r):"search"==t?new bizagi.rendering.search(r):"suggest"==t?(r.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.search(r)):"searchList"==t?new bizagi.rendering.searchList(r):"letter"==t?new bizagi.rendering.letter(r):"button"==t?new bizagi.rendering.button(r):"formLink"==t?new bizagi.rendering.formLink(r):"link"==t?new bizagi.rendering.link(r):"layoutImage"==t?new bizagi.rendering.layoutImage(r):"layoutLink"==t?new bizagi.rendering.layoutLink(r):"layoutLabel"==t?new bizagi.rendering.layoutLabel(r):"layoutText"==t?new bizagi.rendering.layoutText(r):"layoutDateTime"==t?new bizagi.rendering.layoutDateTime(r):"layoutNumber"==t?new bizagi.rendering.layoutNumber(r):"layoutMoney"==t?new bizagi.rendering.layoutMoney(r):"layoutPlaceholder"==t?new bizagi.rendering.layoutPlaceholder(r):"actionLauncher"==t?new bizagi.rendering.actionLauncher(r):"layoutBoolean"==t?new bizagi.rendering.layoutBoolean(r):"layoutUpload"==t?new bizagi.rendering.layoutUpload(r):"entityTemplate"==t?new bizagi.rendering.entityTemplate(r):"polymorphicLauncher"==t?new bizagi.rendering.polymorphicLauncher(r):"userfield"==t?new bizagi.rendering.userfieldWrapper(r):0==t.indexOf("search")?this.getSearchRender(e):0==t.indexOf("query")?this.getQueryRender(e):"document"==t?new bizagi.rendering.document(r):"image"==t?new bizagi.rendering.image(r):"fileprint"==t?new bizagi.rendering.fileprint(r):"geolocation"==t?new bizagi.rendering.geolocation(r):"collectionnavigator"==t?new bizagi.rendering.collectionnavigator(r):"getUser"==t?new bizagi.rendering.getUser(r):"rangeDate"==t?new bizagi.rendering.rangeDate(r):"rangeMoney"==t?new bizagi.rendering.rangeMoney(r):"rangeNumber"==t?new bizagi.rendering.rangeNumber(r):"activityCheckList"==t?new bizagi.rendering.activityCheckList(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnText"==t){var a=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return r.decorated=a?bizagi.rendering.extendedText:bizagi.rendering.text,new bizagi.rendering.columns.text(r)}if("columnSearchList"==t)return r.decorated=bizagi.rendering.searchList,new bizagi.rendering.columns.searchList(r);if("columnNumber"==t)return r.decorated=bizagi.rendering.number,new bizagi.rendering.columns.number(r);if("columnMoney"==t)return r.decorated=bizagi.rendering.money,new bizagi.rendering.columns.number(r);if("columnDate"==t)return r.decorated=bizagi.rendering.date,new bizagi.rendering.columns.date(r);if("columnBoolean"==t){if("check"==(i.properties.display||"option")){if(r.decorated=bizagi.rendering.check,e.data.properties.isExclusive)return new bizagi.rendering.columns.exclusiveCheck(r)}else r.decorated=bizagi.rendering.yesno;return new bizagi.rendering.columns.column(r)}return"columnCombo"==t?(r.decorated=bizagi.rendering.combo,new bizagi.rendering.columns.combo(r)):"columnRadio"==t?(r.decorated=bizagi.rendering.radio,new bizagi.rendering.columns.radio(r)):"columnList"==t?(r.decorated=bizagi.rendering.list,new bizagi.rendering.columns.list(r)):"columnHidden"==t?(r.decorated=bizagi.rendering.hidden,new bizagi.rendering.columns.column(r)):"columnUpload"==t?(r.decorated=bizagi.rendering.upload,new bizagi.rendering.columns.upload(r)):"columnImage"==t?(r.decorated=bizagi.rendering.image,new bizagi.rendering.columns.image(r)):"columnUploadEcm"==t?(r.decorated=bizagi.rendering.ecm,new bizagi.rendering.columns.uploadecm(r)):"columnLink"==t?(r.decorated=bizagi.rendering.link,new bizagi.rendering.columns.link(r)):"columnFormLink"==t?(r.decorated=bizagi.rendering.formLink,new bizagi.rendering.columns.link(r)):"columnUserfield"==t?(r.decorated=bizagi.rendering.userfieldWrapper,new bizagi.rendering.columns.column(r)):"columnSearch"==t?(r.decorated=bizagi.rendering.search,new bizagi.rendering.columns.search(r)):"columnLabel"==t?(r.decorated=bizagi.rendering.label,new bizagi.rendering.columns.column(r)):"columnReadonly"==t?(r.decorated=bizagi.rendering.label,new bizagi.rendering.columns.readonly(r)):"columnDocument"==t?(r.decorated=bizagi.rendering.document,new bizagi.rendering.columns.document(r)):"columnLetter"==t?(r.decorated=bizagi.rendering.letter,new bizagi.rendering.columns.letter(r)):"columnButton"==t?(r.decorated=bizagi.rendering.button,new bizagi.rendering.columns.button(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.extendedText(r):new bizagi.rendering.text(r):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.check(r):new bizagi.rendering.yesno(r):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.numberScientificNotation(r):new bizagi.rendering.number(r):"searchMoney"==t?new bizagi.rendering.money(r):"searchDate"==t?new bizagi.rendering.date(r):"searchCombo"==t?new bizagi.rendering.combo(r):"searchSuggest"==t?new bizagi.rendering.search(r):"searchLabel"==t?new bizagi.rendering.label(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getQueryRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"queryText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.queryExtendedText(r):new bizagi.rendering.queryText(r):"queryBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.queryCheck(r):new bizagi.rendering.queryYesNo(r):"queryNumber"==t?new bizagi.rendering.queryNumber(r):"queryMoney"==t?new bizagi.rendering.queryMoney(r):"queryDate"==t?new bizagi.rendering.queryDate(r):"queryCombo"==t?new bizagi.rendering.queryCombo(r):"queryCascadingCombo"==t?new bizagi.rendering.queryCascadingCombo(r):"querySuggest"==t?new bizagi.rendering.querySuggest(r):"queryLabel"==t?new bizagi.rendering.queryLabel(r):"queryList"==t?new bizagi.rendering.queryList(r):"queryMultiSelect"==t?new bizagi.rendering.queryMultiSelect(r):"querySearch"==t?new bizagi.rendering.querySearch(r):"queryRadio"==t?new bizagi.rendering.queryRadio(r):"queryState"==t?new bizagi.rendering.queryState(r):"queryCaseState"==t?new bizagi.rendering.queryCaseState(r):"queryProcess"==t?new bizagi.rendering.queryProcess(r):"querySearchUser"==t?new bizagi.rendering.querySearchUser(r):"queryHidden"==t?new bizagi.rendering.hidden(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getTemplate:function(e){return this.templates[e]}}),bizagi.rendering.base.factory.extend("bizagi.rendering.desktop.factory",{},{init:function(e){this._super(e),this.printVersion=!1},loadTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("icons",bizagi.getTemplate("common.bizagi.rendering.icons")),e.loadTemplate("form-error",bizagi.getTemplate("bizagi.rendering.desktop.form-error")),e.loadTemplate("form-waiting",bizagi.getTemplate("bizagi.rendering.desktop.form-waiting")),e.loadTemplate("info-message",bizagi.getTemplate("common.bizagi.desktop.info-message")),e.loadTemplate("form",bizagi.getTemplate("bizagi.rendering.desktop.form")+"#ui-bizagi-render-form"),e.loadTemplate("form-process-path",bizagi.getTemplate("bizagi.rendering.desktop.form")+"#ui-bizagi-render-form-process-path"),e.loadTemplate("panel",bizagi.getTemplate("bizagi.rendering.desktop.panel")),e.loadTemplate("contentPanel",bizagi.getTemplate("bizagi.rendering.desktop.contentPanel")),e.loadTemplate("tab",bizagi.getTemplate("bizagi.rendering.desktop.tab")),e.loadTemplate("tabItem",bizagi.getTemplate("bizagi.rendering.desktop.tabItem")),e.loadTemplate("collectionnavigator",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator"),e.loadTemplate("collectionnavigator-form-button",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-form-button"),e.loadTemplate("collectionnavigator-control",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-control"),e.loadTemplate("collectionnavigator-actions",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-actions"),e.loadTemplate("collectionnavigator-preview",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-preview"),e.loadTemplate("collectionnavigator-execution",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-execution"),e.loadTemplate("horizontal",bizagi.getTemplate("bizagi.rendering.desktop.horizontal")),e.loadTemplate("accordion",bizagi.getTemplate("bizagi.rendering.desktop.accordion")),e.loadTemplate("accordionItem",bizagi.getTemplate("bizagi.rendering.desktop.accordionItem")),e.loadTemplate("group",bizagi.getTemplate("bizagi.rendering.desktop.group")),e.loadTemplate("section-header",bizagi.getTemplate("bizagi.rendering.desktop.section")+"#ui-bizagi-container-section"),e.loadTemplate("section-content",bizagi.getTemplate("bizagi.rendering.desktop.section")+"#ui-bizagi-container-section-content"),e.loadTemplate("searchForm",bizagi.getTemplate("bizagi.rendering.desktop.searchForm")),e.loadTemplate("render",bizagi.getTemplate("bizagi.rendering.desktop.render")),e.loadTemplate("render-base",bizagi.getTemplate("bizagi.rendering.desktop.render.base")),e.loadTemplate("render-layout",bizagi.getTemplate("bizagi.rendering.desktop.render.layout")),e.loadTemplate("render-userPassword",bizagi.getTemplate("bizagi.rendering.desktop.userPassword")+"#bz-rendering-userPassword"),e.loadTemplate("render-getUser",bizagi.getTemplate("bizagi.rendering.desktop.getUser")+"#bz-rendering-getUser"),e.loadTemplate("render-user-email",bizagi.getTemplate("bizagi.rendering.desktop.userEmail")+"#bz-rendering-user-email"),e.loadTemplate("render-comboSelected",bizagi.getTemplate("bizagi.rendering.desktop.comboSelected")+"#bz-rendering-comboSelected"),e.loadTemplate("render-comboSelectedReadOnly",bizagi.getTemplate("bizagi.rendering.desktop.comboSelected")+"#bz-rendering-comboSelected-ReadOnly"),e.loadTemplate("render-querySearchUser",bizagi.getTemplate("bizagi.rendering.desktop.querySearchUser")+"#ui-bizagi-render-querySearchUser"),e.loadTemplate("text",bizagi.getTemplate("bizagi.rendering.desktop.text")+"#ui-bizagi-render-text"),e.loadTemplate("text-read-only",bizagi.getTemplate("bizagi.rendering.desktop.text")+"#ui-bizagi-render-text-read-only"),e.loadTemplate("extendedText",bizagi.getTemplate("bizagi.rendering.desktop.extendedText")),e.loadTemplate("number",bizagi.getTemplate("bizagi.rendering.desktop.number")),e.loadTemplate("numberScientificNotation",bizagi.getTemplate("bizagi.rendering.desktop.numberScientificNotation")+"#bz-rendering-numberScientificNotation"),e.loadTemplate("date",bizagi.getTemplate("bizagi.rendering.desktop.date")),e.loadTemplate("yesno",bizagi.getTemplate("bizagi.rendering.desktop.yesno")),e.loadTemplate("check",bizagi.getTemplate("bizagi.rendering.desktop.check")),e.loadTemplate("combo",bizagi.getTemplate("bizagi.rendering.desktop.combo")),e.loadTemplate("list",bizagi.getTemplate("bizagi.rendering.desktop.list")),e.loadTemplate("geolocation",bizagi.getTemplate("bizagi.rendering.desktop.geolocation")),e.loadTemplate("radio",bizagi.getTemplate("bizagi.rendering.desktop.radio")),e.loadTemplate("image",bizagi.getTemplate("bizagi.rendering.desktop.image")+"#ui-bizagi-render-image"),e.loadTemplate("images",bizagi.getTemplate("bizagi.rendering.desktop.image")+"#ui-bizagi-render-images"),e.loadTemplate("image-dialog",bizagi.getTemplate("bizagi.rendering.desktop.image")+"#ui-bizagi-render-image-dialog"),e.loadTemplate("image-item",bizagi.getTemplate("bizagi.rendering.desktop.image")+"#ui-bizagi-render-image-item"),e.loadTemplate("upload-ecm-view-default",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default"),e.loadTemplate("upload-ecm-view-default-metadata",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default-metadata"),e.loadTemplate("upload-ecm-view-default-yesno",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default-yesno"),e.loadTemplate("upload-ecm-view-default-edit-buttons",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default-edit-buttons"),e.loadTemplate("document",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator"),e.loadTemplate("document-item",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-item"),e.loadTemplate("document-column-item",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-column-item"),e.loadTemplate("document-item-preview",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-item-preview"),e.loadTemplate("document-item-preview-object",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-item-preview-object"),e.loadTemplate("uploadItem",bizagi.getTemplate("bizagi.rendering.desktop.uploadItem")),e.loadTemplate("upload",bizagi.getTemplate("bizagi.rendering.desktop.upload")),e.loadTemplate("upload.dialog",bizagi.getTemplate("bizagi.rendering.desktop.upload.dialog")),e.loadTemplate("upload.template.dialog",bizagi.getTemplate("bizagi.rendering.desktop.upload.template.dialog")),e.loadTemplate("upload.ecm.dialog",bizagi.getTemplate("bizagi.rendering.desktop.upload.ecm.dialog")),e.loadTemplate("dialog-send-email",bizagi.getTemplate("bizagi.rendering.desktop.dialog-sendEmail")+"#dialog-send-email"),e.loadTemplate("dialog-send-email-rtl",bizagi.getTemplate("bizagi.rendering.desktop.dialog-sendEmail")+"#dialog-send-email-rtl"),e.loadTemplate("grid",bizagi.getTemplate("bizagi.rendering.desktop.grid")),e.loadTemplate("cell",bizagi.getTemplate("bizagi.rendering.desktop.cell")),e.loadTemplate("cell.readonly",bizagi.getTemplate("bizagi.rendering.desktop.cell.readonly")),e.loadTemplate("cell.summary",bizagi.getTemplate("bizagi.rendering.desktop.cell.summary")),e.loadTemplate("cell.upload",bizagi.getTemplate("bizagi.rendering.desktop.cell.upload")),e.loadTemplate("cell.button",bizagi.getTemplate("bizagi.rendering.desktop.cell.button")),e.loadTemplate("search",bizagi.getTemplate("bizagi.rendering.desktop.search")),e.loadTemplate("searchItem",bizagi.getTemplate("bizagi.rendering.desktop.searchItem")),e.loadTemplate("searchList",bizagi.getTemplate("bizagi.rendering.desktop.searchList")+"#bz-searchList"),e.loadTemplate("searchListTag",bizagi.getTemplate("bizagi.rendering.desktop.searchList")+"#bz-searchList-tag"),e.loadTemplate("letter",bizagi.getTemplate("bizagi.rendering.desktop.letter")),e.loadTemplate("letter.readonly",bizagi.getTemplate("bizagi.rendering.desktop.letter.readonly")),e.loadTemplate("letter.dialog",bizagi.getTemplate("bizagi.rendering.desktop.dialog-letter")),e.loadTemplate("button",bizagi.getTemplate("bizagi.rendering.desktop.button")),e.loadTemplate("fileprint",bizagi.getTemplate("bizagi.rendering.desktop.fileprint")+"#ui-bizagi-render-fileprint"),e.loadTemplate("fileprint-object",bizagi.getTemplate("bizagi.rendering.desktop.fileprint")+"#ui-bizagi-render-fileprint-object"),e.loadTemplate("fileprint-iframe",bizagi.getTemplate("bizagi.rendering.desktop.fileprint")+"#ui-bizagi-render-fileprint-iframe"),e.loadTemplate("link",bizagi.getTemplate("bizagi.rendering.desktop.link")),e.loadTemplate("formLink",bizagi.getTemplate("bizagi.rendering.desktop.formLink")),e.loadTemplate("association",bizagi.getTemplate("bizagi.rendering.desktop.association")),e.loadTemplate("stakeholder",bizagi.getTemplate("bizagi.rendering.desktop.stakeholder")+"#bz-rendering-stakeholder"),e.loadTemplate("stakeholder-grid",bizagi.getTemplate("bizagi.rendering.desktop.stakeholder")+"#bz-rendering-stakeholder-grid"),e.loadTemplate("stakeholder-paginator",bizagi.getTemplate("bizagi.rendering.desktop.stakeholder")+"#bz-rendering-stakeholder-paginator"),e.loadTemplate("queryProcess",bizagi.getTemplate("bizagi.rendering.desktop.queryProcess")+"#ui-bizagi-render-query-process"),e.loadTemplate("checkList",bizagi.getTemplate("bizagi.rendering.desktop.checkList")+"#bz-rendering-checkList"),e.loadTemplate("checkList-disabled",bizagi.getTemplate("bizagi.rendering.desktop.checkList")+"#bz-rendering-checkList-disabled"),e.loadTemplate("readonly",bizagi.getTemplate("bizagi.rendering.desktop.readonly")+"#readonly"),e.loadTemplate("readonly-gn",bizagi.getTemplate("bizagi.rendering.desktop.readonly")+"#readonly-gn"),e.loadTemplate("readonly-value",bizagi.getTemplate("bizagi.rendering.desktop.readonly")+"#readonly-value"),e.loadTemplate("hand-signature",bizagi.getTemplate("bizagi.rendering.desktop.handSignature")+"#bz-signature"),e.loadTemplate("hand-signature-readonly",bizagi.getTemplate("bizagi.rendering.desktop.handSignature")+"#bz-signature-readonly"),e.loadTemplate("layout-link",bizagi.getTemplate("bizagi.rendering.desktop.layout.link")),e.loadTemplate("layout-image",bizagi.getTemplate("bizagi.rendering.desktop.layout.image")+"#ui-bizagi-render-layout-image"),e.loadTemplate("layout-image64",bizagi.getTemplate("bizagi.rendering.desktop.layout.image")+"#ui-bizagi-render-layout-image64"),e.loadTemplate("layout-label",bizagi.getTemplate("bizagi.rendering.desktop.layout.label")),e.loadTemplate("layout-text",bizagi.getTemplate("bizagi.rendering.desktop.layout.text")),e.loadTemplate("layout-upload",bizagi.getTemplate("bizagi.rendering.desktop.layout.upload")),e.loadTemplate("layout-uploadItem",bizagi.getTemplate("bizagi.rendering.desktop.layout.uploadItem")),e.loadTemplate("layout-date-time",bizagi.getTemplate("bizagi.rendering.desktop.layout.dateTime")),e.loadTemplate("layout-number",bizagi.getTemplate("bizagi.rendering.desktop.layout.number")),e.loadTemplate("layout-money",bizagi.getTemplate("bizagi.rendering.desktop.layout.money")),e.loadTemplate("layout-placeholder",bizagi.getTemplate("bizagi.rendering.desktop.layout.placeholder")),e.loadTemplate("layout-boolean",bizagi.getTemplate("bizagi.rendering.desktop.layout.yesno")),e.loadTemplate("render-actionLauncher",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher"),e.loadTemplate("render-actionLauncher-horizontal",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-horizontal"),e.loadTemplate("render-actionLauncher-horizontal-more",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-horizontal-more"),e.loadTemplate("render-actionLauncher-vertical",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-vertical"),e.loadTemplate("render-actionLauncher-actions-to-execute",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-actions-to-execute"),e.loadTemplate("render-actionLauncher-design",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-design"),e.loadTemplate("render-actionLauncher-confirm",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-confirm"),e.loadTemplate("render-polymorphicLauncher",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher"),e.loadTemplate("render-polymorphicLauncher-vertical-tree",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree"),e.loadTemplate("render-polymorphicLauncher-vertical-tree-item",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree-item"),e.loadTemplate("render-polymorphicLauncher-actions-to-execute",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-actions-to-execute"),e.loadTemplate("render-polymorphicLauncher-design",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-design"),e.loadTemplate("render-polymorphicLauncher-confirm",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-confirm"),bizagi.override.enablePrintFromEditForm?e.loadTemplate("print-frame",bizagi.getTemplate("bizagi.workportal.desktop.widget.print")+"#bz-wp-widget-print-frame"):null,bizagi.override.enablePrintFromEditForm?e.loadTemplate("print-frame-header",bizagi.getTemplate("bizagi.workportal.desktop.widget.print")+"#bz-wp-widget-print-frame-header"):null,e.loadTemplate("grid.bizagi",bizagi.getTemplate("bizagi.rendering.desktop.grid.component")),e.loadTemplate("bizagi.grid.grid",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid"),e.loadTemplate("bizagi.grid.grid.rtl",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-rtl"),e.loadTemplate("bizagi.grid.waiting",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-waiting"),e.loadTemplate("bizagi.grid.table",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-table"),e.loadTemplate("bizagi.grid.table.empty",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-table-empty"),e.loadTemplate("bizagi.grid.column",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-column"),e.loadTemplate("bizagi.grid.column.special",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-column-special"),e.loadTemplate("bizagi.grid.row",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-row"),e.loadTemplate("bizagi.grid.row.buttons",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-row-buttons"),e.loadTemplate("bizagi.grid.row.buttons.rtl",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-row-buttons-rtl"),e.loadTemplate("bizagi.grid.cell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-cell"),e.loadTemplate("bizagi.grid.cell.special",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-cell-special"),e.loadTemplate("bizagi.grid.pagination",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-pagination"),e.loadTemplate("bizagi.grid.pager",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-pager"),e.loadTemplate("bizagi.grid.buttons",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-buttons"),e.loadTemplate("bizagi.grid.buttons.rtl",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-buttons-rtl"),e.loadTemplate("bizagi.grid.dynamicpager",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-dynamic-pager"),e.loadTemplate("bizagi.grid.summary",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-summary"),e.loadTemplate("bizagi.grid.summaryCell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-summary-cell"),e.loadTemplate("bizagi.grid.grouped.table",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-table"),e.loadTemplate("bizagi.grid.grouped.column",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-column"),e.loadTemplate("bizagi.grid.grouped.row",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-row"),e.loadTemplate("bizagi.grid.grouped.header.row",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-header-row"),e.loadTemplate("bizagi.grid.grouped.summary",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-summary"),e.loadTemplate("bizagi.grid.grouped.summaryCell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-summary-cell"),e.loadTemplate("bizagi.grid.grouped.emptyCell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-empty-cell"),e.loadTemplate("bizagi.plugin.search.user",bizagi.getTemplate("bizagi.plugin.searchuser")+"#ui-bizagi-plugin-search-user"),e.loadTemplate("gridActions",bizagi.getTemplate("bizagi.rendering.desktop.gridActions")+"#ui-bizagi-grid-actions-more"),e.loadTemplate("gridActions-delete",bizagi.getTemplate("bizagi.rendering.desktop.gridActions")+"#ui-bizagi-grid-actions-delete"),e.loadTemplate("list-multiselect",bizagi.getTemplate("bizagi.rendering.desktop.multiSelect")+"#bz-list-multiselect"),e.loadTemplate("list-multiselect-item",bizagi.getTemplate("bizagi.rendering.desktop.multiSelect")+"#bz-list-multiselect-item"),e.loadTemplate("list-multiselect-tag",bizagi.getTemplate("bizagi.rendering.desktop.multiSelect")+"#bz-list-multiselect-tag"),e.loadTemplate("list-multiselect-tags",bizagi.getTemplate("bizagi.rendering.desktop.multiSelect")+"#bz-list-multiselect-tags"),e.loadTemplate("list-multiselect-view-more",bizagi.getTemplate("bizagi.rendering.desktop.multiSelect")+"#bz-list-multiselect-view-more"),e.loadTemplate("render-range",bizagi.getTemplate("bizagi.rendering.desktop.range")+"#bz-rendering-range"),e.loadTemplate("query.advanced",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced"),e.loadTemplate("query.advanced.readonly",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-readonly"),e.loadTemplate("query.advanced-item",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-item"),e.loadTemplate("query.advanced-filter",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-filter"),e.loadTemplate("query.advanced-content",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-content"),e.loadTemplate("query.advanced-input",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-filter_input"),e.loadTemplate("query.advanced-text",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-filter_text"),e.loadTemplate("query.advanced-date",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-filter_date"),e.loadTemplate("query.advanced-pill",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced__pills"),e.loadTemplate("query.advanced-tooltip",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced__wildcard-tooltip"),e.loadTemplate("bizagi.grid.exportOptions",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-export-options")).done((function(){var i=$.fasttmpl(e.getTemplate("icons"));0===$("head").find("#genome-forms-icons").length&&$("head").append(i),t.resolve()})),t.promise()},loadOverrides:function(){if(bizagi.enableCustomizations)return bizagi.util.loadFile({src:bizagi.getJavaScript("bizagi.rendering.desktop.overrides"),type:"js"})},getContainer:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==t?new bizagi.rendering.desktop.form(r):"template"==t?new bizagi.rendering.desktop.formTemplate(r):"queryForm"==t?new bizagi.rendering.desktop.queryForm(r):"layout"==t?new bizagi.rendering.desktop.layout(r):"usersForm"==t?new bizagi.rendering.desktop.usersForm(r):"panel"==t?new bizagi.rendering.desktop.panel(r):/^contentpanel$/i.test(t)?new bizagi.rendering.desktop.contentPanel(r):/^nestedform$/i.test(t)?new bizagi.rendering.desktop.nestedForm(r):"tab"==t?new bizagi.rendering.desktop.tab(r):/^tabitem$/i.test(t)?new bizagi.rendering.desktop.tabItem(r):"horizontal"==t?new bizagi.rendering.desktop.horizontal(r):"accordion"==t?new bizagi.rendering.desktop.accordion(r):"accordionItem"==t?new bizagi.rendering.desktop.accordionItem(r):"group"==t?new bizagi.rendering.desktop.group(r):"section"==t?new bizagi.rendering.desktop.section(r):"searchForm"==t?(r.context="search",r.contexttype="metadata",new bizagi.rendering.desktop.searchForm(r)):"mobileform"==t?new bizagi.rendering.mobileform(r):"mobilegroup"==t?new bizagi.rendering.mobilegroup(r):"mobiletext"==t?new bizagi.rendering.mobiletext(renderParams):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,r=i.properties,a=bizagi.util.parseBoolean(r.advancedQuery)||!1,n=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return t||(t="label"),!/^query/i.test(t)&&a?this.getAdvancedQueryRender(n):"text"===t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.desktop.extendedText(n):new bizagi.rendering.desktop.text(n):"association"===t?new bizagi.rendering.desktop.association(n):"label"===t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.label(n)):"hidden"===t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.hidden(n)):"number"===t?r&&29===r.dataType?new bizagi.rendering.desktop.numberScientificNotation(n):new bizagi.rendering.desktop.number(n):"money"===t?new bizagi.rendering.desktop.money(n):"date"===t?new bizagi.rendering.desktop.date(n):"boolean"===t?"check"===(i.properties.display||"option")?new bizagi.rendering.desktop.check(n):new bizagi.rendering.desktop.yesno(n):"combo"===t?new bizagi.rendering.desktop.combo(n):/^cascadingcombo$/i.test(t)?new bizagi.rendering.desktop.cascadingCombo(n):"list"===t?new bizagi.rendering.desktop.list(n):"radio"===t?new bizagi.rendering.desktop.radio(n):"image"===t?new bizagi.rendering.desktop.image(n):"uploadecm"===t?new bizagi.rendering.desktop.ecm(n):"upload"===t?new bizagi.rendering.desktop.upload(n):"grid"===t?new bizagi.rendering.desktop.grid.bizagi(n):"groupedgrid"===t?new bizagi.rendering.desktop.grid.grouped(n):"search"===t?new bizagi.rendering.desktop.search(n):"suggest"===t?(n.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.desktop.search(n)):"searchList"===t?new bizagi.rendering.desktop.searchList(n):"multiSelect"==t?new bizagi.rendering.desktop.multiSelect(n):"letter"===t?new bizagi.rendering.desktop.letter(n):"button"===t?!bizagi.util.isEmpty(i.properties.rpabot)?new bizagi.rendering.desktop.uiPathButton(n):new bizagi.rendering.desktop.button(n):"formLink"===t?new bizagi.rendering.desktop.formLink(n):"link"===t?new bizagi.rendering.desktop.link(n):"actionLauncher"===t?new bizagi.rendering.desktop.actionLauncher(n):"entityTemplate"===t?new bizagi.rendering.desktop.entityTemplate(n):"polymorphicLauncher"===t?new bizagi.rendering.desktop.polymorphicLauncher(n):"userfield"===t?new bizagi.rendering.desktop.userfieldWrapper(n):0===t.indexOf("layout")?this.getLayoutRender(e):0===t.indexOf("search")?this.getSearchRender(e):0===t.indexOf("query")?this.getQueryRender(e):0===t.indexOf("range")?this.getRangeRender(e):"document"===t?new bizagi.rendering.desktop.document(n):"image"===t?new bizagi.rendering.desktop.image(n):"fileprint"===t?new bizagi.rendering.desktop.fileprint(n):"geolocation"===t?new bizagi.rendering.desktop.geolocation(n):"collectionnavigator"===t?new bizagi.rendering.desktop.collectionnavigator(n):"activityCheckList"===t?new bizagi.rendering.desktop.activityCheckList(n):"getUser"===t?new bizagi.rendering.desktop.getUser(n):"userPassword"==t?new bizagi.rendering.desktop.userPassword(n):"comboSelected"==t?new bizagi.rendering.desktop.comboSelected(n):"stakeholder"==t?new bizagi.rendering.desktop.stakeholder(n):/^signature$/i.test(t)?new bizagi.rendering.desktop.handSignature(n):/^readonly$/i.test(t)?new bizagi.rendering.desktop.readonly(n):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,r=i.properties,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnText"===t){var n=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return a.decorated=n?bizagi.rendering.desktop.extendedText:bizagi.rendering.desktop.text,new bizagi.rendering.desktop.columns.text(a)}if("columnSearchList"===t)return a.decorated=bizagi.rendering.desktop.searchList,new bizagi.rendering.desktop.columns.searchList(a);if("columnNumberScientificNotation"===t)return a.decorated=bizagi.rendering.desktop.numberScientificNotation,new bizagi.rendering.desktop.columns.numberScientificNotation(a);if("columnNumber"===t)return r&&29===r.dataType?(a.decorated=bizagi.rendering.desktop.numberScientificNotation,new bizagi.rendering.desktop.columns.numberScientificNotation(a)):(a.decorated=bizagi.rendering.desktop.number,new bizagi.rendering.desktop.columns.number(a));if("columnMoney"===t)return a.decorated=bizagi.rendering.desktop.money,new bizagi.rendering.desktop.columns.number(a);if("columnDate"===t)return a.decorated=bizagi.rendering.desktop.date,new bizagi.rendering.desktop.columns.date(a);if("columnBoolean"===t){if("check"===(i.properties.display||"option")){if(a.decorated=bizagi.rendering.desktop.check,e.data.properties.isExclusive)return new bizagi.rendering.desktop.columns.exclusiveCheck(a)}else a.decorated=bizagi.rendering.desktop.yesno;return new bizagi.rendering.desktop.columns.column(a)}return"columnCombo"===t?(a.decorated=bizagi.rendering.desktop.combo,new bizagi.rendering.desktop.columns.combo(a)):"columnRadio"===t?(a.decorated=bizagi.rendering.desktop.radio,new bizagi.rendering.desktop.columns.radio(a)):"columnList"===t?(a.decorated=bizagi.rendering.desktop.list,new bizagi.rendering.desktop.columns.list(a)):"columnHidden"===t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,a.decorated=bizagi.rendering.desktop.hidden,new bizagi.rendering.desktop.columns.hidden(a)):"columnUpload"===t?(a.decorated=bizagi.rendering.desktop.upload,new bizagi.rendering.desktop.columns.upload(a)):"columnImage"===t?(a.decorated=bizagi.rendering.desktop.image,new bizagi.rendering.desktop.columns.image(a)):"columnUploadEcm"===t?(a.decorated=bizagi.rendering.desktop.ecm,new bizagi.rendering.desktop.columns.uploadecm(a)):"columnLink"===t?(a.decorated=bizagi.rendering.desktop.link,new bizagi.rendering.desktop.columns.link(a)):"columnFormLink"===t?(a.decorated=bizagi.rendering.desktop.formLink,new bizagi.rendering.desktop.columns.link(a)):"columnUserfield"===t?(a.decorated=bizagi.rendering.desktop.userfieldWrapper,new bizagi.rendering.desktop.columns.column(a)):"columnSearch"===t?(a.decorated=bizagi.rendering.desktop.search,new bizagi.rendering.desktop.columns.search(a)):"columnLabel"===t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,a.decorated=bizagi.rendering.desktop.label,new bizagi.rendering.desktop.columns.column(a)):"columnReadonly"===t?(a.decorated=bizagi.rendering.desktop.readonly,new bizagi.rendering.desktop.columns.readonly(a)):"columnDocument"===t?(a.decorated=bizagi.rendering.desktop.document,new bizagi.rendering.desktop.columns.document(a)):"columnLetter"===t?(a.decorated=bizagi.rendering.desktop.letter,new bizagi.rendering.desktop.columns.letter(a)):"columnButton"===t?(a.decorated=bizagi.rendering.desktop.button,new bizagi.rendering.desktop.columns.button(a)):"columnActions"===t?(a.decorated=bizagi.rendering.desktop.gridActions,new bizagi.rendering.desktop.columns.actions(a)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getLayoutRender:function(e){var t=e.type,i=e.data,r=i.properties,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"layoutImage"===t?new bizagi.rendering.desktop.layoutImage(a):"layoutLink"===t?new bizagi.rendering.desktop.layoutLink(a):"layoutLabel"===t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.layoutLabel(a)):"layoutText"===t?new bizagi.rendering.desktop.layoutText(a):"layoutDateTime"===t?new bizagi.rendering.desktop.layoutDateTime(a):"layoutNumber"===t?new bizagi.rendering.desktop.layoutNumber(a):"layoutMoney"===t?new bizagi.rendering.desktop.layoutMoney(a):"layoutPlaceholder"===t?new bizagi.rendering.desktop.layoutPlaceholder(a):"layoutBoolean"===t?new bizagi.rendering.desktop.layoutBoolean(a):"layoutUpload"===t?new bizagi.rendering.desktop.layoutUpload(a):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,r=i.properties,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.desktop.extendedText(a):new bizagi.rendering.desktop.text(a):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.desktop.check(a):new bizagi.rendering.desktop.yesno(a):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.desktop.numberScientificNotation(a):new bizagi.rendering.desktop.number(a):"searchMoney"==t?new bizagi.rendering.desktop.money(a):"searchDate"==t?new bizagi.rendering.desktop.date(a):"searchCombo"==t?new bizagi.rendering.desktop.combo(a):"searchSuggest"==t?new bizagi.rendering.desktop.search(a):"searchLabel"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.label(a)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getQueryRender:function(e){var t=e.type,i=e.data,r=i.properties,a=bizagi.util.parseBoolean(i.properties.advancedQuery)||!1,n=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"queryText"===t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.desktop.queryExtendedText(n):a?new bizagi.rendering.desktop.queryTextAdvanced(n):new bizagi.rendering.desktop.queryText(n):"queryBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.desktop.queryCheck(n):new bizagi.rendering.desktop.queryYesNo(n):"queryNumber"===t?a?new bizagi.rendering.desktop.queryNumberAdvanced(n):new bizagi.rendering.desktop.queryNumber(n):"queryMoney"===t?a?new bizagi.rendering.desktop.queryMoneyAdvanced(n):new bizagi.rendering.desktop.queryMoney(n):"queryDate"===t?a?new bizagi.rendering.desktop.queryDateAdvanced(n):new bizagi.rendering.desktop.queryDate(n):"queryCombo"==t?new bizagi.rendering.desktop.queryCombo(n):"queryCascadingCombo"==t?new bizagi.rendering.desktop.queryCascadingCombo(n):"querySuggest"==t?new bizagi.rendering.desktop.querySuggest(n):"queryLabel"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.queryLabel(n)):"queryList"==t?new bizagi.rendering.desktop.queryList(n):"queryMultiSelect"==t?new bizagi.rendering.desktop.queryMultiSelect(n):"querySearch"==t?new bizagi.rendering.desktop.querySearch(n):"queryRadio"==t?new bizagi.rendering.desktop.queryRadio(n):"queryState"==t?new bizagi.rendering.desktop.queryState(n):"queryCaseState"==t?new bizagi.rendering.desktop.queryCaseState(n):"queryProcess"==t?new bizagi.rendering.desktop.queryProcess(n):"querySearchUser"==t?new bizagi.rendering.desktop.querySearchUser(n):"queryHidden"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.hidden(n)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRangeRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"rangeDate"===t?new bizagi.rendering.desktop.rangeDate(r):"rangeMoney"===t?new bizagi.rendering.desktop.rangeMoney(r):"rangeNumber"===t?new bizagi.rendering.desktop.rangeNumber(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getAdvancedQueryRender:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"text"===t?new bizagi.rendering.desktop.queryTextAdvanced(i):"number"===t?new bizagi.rendering.desktop.queryNumberAdvanced(i):"money"===t?new bizagi.rendering.desktop.queryMoneyAdvanced(i):"date"===t?new bizagi.rendering.desktop.queryDateAdvanced(i):void 0}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.searchList",bizagi.rendering.searchList.prototype),bizagi.rendering.desktop.searchList.extend("bizagi.rendering.desktop.searchList",{SEARCH_MIN_LENGTH:2},{postRender:function(){var e=this.getControl();this._super(),this.searchInput=$("input",e),$(e).find("input").css({width:"100%","padding-right":"25px"}),this.applyAutocompletePlugin(),this.attachKeyEvents()},attachKeyEvents:function(){var e=this;e.element.keydown((function(t){var i=(t=window.event||t).charCode||t.keyCode;if(void 0!==t)switch(i){case 8:0===$("input:first",e.element)[0].selectionStart&&(e.removeLastElement(),$("li:nth-last-child(2)",e.element).remove(),$(".biz-render-input-search",e.getControl()).focus())}}))},applyAutocompletePlugin:function(){var e=this,t=e.getControl(),i=e.searchInput;i.autocomplete({autoFocus:!0,messages:{noResults:null,results:function(){}},source:function(t,i){e.activeRequestTerm=t.term;var r=(new Date).getTime(),a=encodeURIComponent(t.term),n=e.properties.xpath+"_"+a+"_expire",o=e.properties.xpath+"_"+a,s=bizagi.util.getItemLocalStorage(n);if(s&&e.properties.enableLocalStorage&&r<s)try{i(JSON.parse(bizagi.util.getItemLocalStorage(o))),e.hideAutocompleteLoading()}catch(r){e.processRequest(t,i)}else e.processRequest(t,i)},select:function(t,r){var a=JSON.parse(e.getValue()).value,n=!0;void 0===r.item.id?n=!1:$.each(a,(function(e,t){if(r.item.id==t.id)return n=!1})),n&&(e.appendFoundItem(t,r),e.changeRequired(!1)),i.autocomplete("close"),r.item.value=""},open:function(){var t=i.data("ui-autocomplete").menu.element,r=i.closest(".ui-bizagi-control"),a=r.parent(),n=e.calculateSuggestionWidth();$("li",t).each((function(){$(this).index()%2<1&&$(this).addClass("biz-ui-even")})),t.css({top:0,left:0}),r.addClass("ac-is-visible"),a.addClass("ac-is-visible ac-clear-floats"),t.appendTo(r).position({my:"left top",at:"left bottom",of:this,collision:"flipfit"}),t.css("z-index",$.getMaxZindex()+10),t.attr("visible",!0),$(".ui-bizagi-render-search-item",t).width(n),t.width(n),e.hideAutocompleteLoading()},close:function(){i.data("ui-autocomplete").menu.element.attr("visible",!1)},delay:this.Class.SEARCH_DELAY,minLength:e.Class.SEARCH_MIN_LENGTH}),i.data("ui-autocomplete")._renderItem=function(t,i){return e.renderSearchItem(i).appendTo(t)},$("[data-action=remove]",t).click((function(){e.deleteItem($(this))}))},appendFoundItem:function(e,t){var i,r=this,a=this.getControl(),n=$(".biz-render-input-search",a).closest("ul"),o=$("li:last",n);t.item.value=r.formatItem(t.item.value);var s=r.renderFactory.getTemplate("searchListTag");i=$.fasttmpl(s,{id:t.item.id,value:t.item.value,editable:!0},{formatItem:r.formatItem}),$(o).before(i),$("[data-action=remove]",n).click((function(){r.deleteItem($(this))})),$(".biz-render-input-search",a).data("selected","1"),$(".biz-render-input-search",a).focus(),$("li",n).removeClass("selected"),this.addElement({id:t.item.id,value:t.item.value})},deleteItem:function(e){var t=this.getControl(),i=e.parent(".bz-pill");this.removeElement({id:i.data("id")}),i.remove(),0===JSON.parse(this.value).value.length&&this.changeRequired(this.properties.required),$(".biz-render-input-search",t).focus()},renderSearchItem:function(e){var t=this.properties,i=this.renderFactory.getTemplate("searchItem"),r=$.tmpl(i,{image:t.searchImage,label:e.label,orientation:this.properties.orientation||"lrt"});return r.data("item.autocomplete",e),r},processRequest:function(e,t){var i=this,r=i.properties;i.showAutocompleteLoading();var a=[];e.term.length>=this.Class.SEARCH_MIN_LENGTH&&(r.term=e.term,$.when(this.getData()).done((function(n){(n=n.slice(0,r.maxRecords)).length>50?(n=n.slice(0,50),a.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-search-maximum-records-allowed"),value:""})):n=n.slice(0,r.maxRecords),n&&n.length>0?$.each(n,(function(t,i){if(0==r.maxRecords||t<r.maxRecords){var n=bizagi.util.performTermMatches(i.value,e.term);a.push({id:i.id,label:n,value:i.value})}})):a.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-grid-no-records"),value:""}),function(e,r){var a=(new Date).getTime()+i.properties.expireCache,n=encodeURIComponent(r);if(i.properties.enableLocalStorage){var o=i.properties.xpath+"_"+n+"_expire",s=i.properties.xpath+"_"+n;bizagi.util.setItemLocalStorage(o,a),bizagi.util.setItemLocalStorage(s,JSON.encode(e))}t(e)}(a,e.term),i.hideAutocompleteLoading()})))},showAutocompleteLoading:function(){$("i",this.getControl()).addClass("ui-autocomplete-loading")},hideAutocompleteLoading:function(){$("i",this.getControl()).removeClass("ui-autocomplete-loading")},calculateSuggestionWidth:function(){return this.searchInput.data("ui-autocomplete").menu.element.width()},setDisplayValue:function(e){void 0!==e&&this.properties.editable&&this.searchInput.val(e.label)},getDisplayValue:function(){return this.selectedValue},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.properties.value.map((function(t){return e.formatItem(t.value)})).join(", "),r=$.tmpl("<label class='readonly-control'>${value}</label>",{value:i});t.empty(),t.append(r)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)}}),$.Class.extend("bizagi.rendering.association",{},{initializeData:function(e){this._super(e);var t=this.properties;t.property="flipped",t.idRender=this.properties.id,t.allowFlip=void 0===t.allowFlip||bizagi.util.parseBoolean(t.allowFlip),t.flipped=void 0!==t.flipped&&bizagi.util.parseBoolean(t.flipped),t.flipstate=t.flipped,t.leftData=t.leftData||[],t.rightData=t.rightData||[],t.value&&this.processPropertyValue()},renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done((function(r){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(r)||!1;var a=$.fasttmpl(t,e.properties,{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(a)})),i.promise()},getFlipAssociation:function(){return"execution"==this.getMode()&&this.dataService.getFlipAssociation(this.properties)},getDisplayValue:function(){return this.getValue()},getTemplateName:function(){return"association"},getColumnData:function(){var e=this.data,t=[],i=e.flipped?e.rightData:e.leftData;return $.each(i,(function(e,i){t.push({id:i.id,value:i.value})})),t},getRightAssociation:function(e){var t=this.data,i=[],r=function(e,i){var r=!1;return $.each(t.formatJson.value,(function(t,a){!r&&a.id==e&&a.value.indexOf(i)>=0&&(r=!0)})),r};return t.flipped?$.each(t.leftData,(function(t,a){i.push({id:a.id,name:a.value,checked:r(a.id,e)})})):$.each(t.rightData,(function(t,a){i.push({id:a.id,name:a.value,checked:r(e,a.id)})})),i},removeElement:function(e,t){var i=this;$.each(i.properties.formatJson.value,(function(r,a){i.properties.flipped?a.id==t&&$.each(i.properties.formatJson.value[r].value,(function(t,a){e==a&&i.properties.formatJson.value[r].value.splice(t,1)})):a.id==e&&$.each(i.properties.formatJson.value[r].value,(function(e,a){t==a&&i.properties.formatJson.value[r].value.splice(e,1)}))})),i.setValue(JSON.encode(i.properties.formatJson))},addElement:function(e,t){var i=this;$.each(i.properties.formatJson.value,(function(r,a){i.properties.flipped?a.id==t&&i.properties.formatJson.value[r].value.push(e):a.id==e&&i.properties.formatJson.value[r].value.push(t)})),i.setValue(JSON.encode(i.properties.formatJson))},makeJsonBase:function(){this.properties.formatJson=this.properties.formatJson||{leftXpath:this.properties.leftXpath,rightXpath:this.properties.rightXpath,leftFactName:this.properties.leftFactName,rightFactName:this.properties.rightFactName,value:this.properties.value}},hasValue:function(){if(this.properties.formatJson)var e=this.properties.formatJson.value;else e=this.properties.value;for(var t=0,i=e.length;t<i;t++){var r=e[t];if(r&&r.value.length>0)return!0}return!1},processPropertyValue:function(){for(var e=this.properties,t=e.value,i=[],r=0,a=t.length;r<a;r++){var n=t[r];i.push({id:n[0],value:n[1]})}e.value=i}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.association",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.association.extend("bizagi.rendering.desktop.association",bizagi.rendering.association.prototype),bizagi.rendering.desktop.association.extend("bizagi.rendering.desktop.association",{},{postRender:function(){},configureHandlers:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=e.getControl();e._super(),$("ol .deleteBotton",i).bind("click",(function(){e.closeElement($(this).parent("li"))})),$(".bz-render-association-accordion",i).togglepanels({header:"> div > h3",autoHeight:!1,animated:!1}),$.when(e.isRendered()).done((function(){$(".bz-render-association-accordion h3",i).first().click()})),e.properties.allowFlip&&$(".bz-render-association .flip-arrow",i).bind("click",(function(){$(i).empty(),e.properties.flipped=!e.properties.flipped,e.properties.flipstate=e.properties.flipped,e.dataService.getFlipAssociation(e.properties),$.tmpl(t,e.properties,{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation}).appendTo(i),e.internalPostRender()})),e.properties.editable&&($(".bz-render-association bz-render-association-check-mask, .bz-render-association .bz-render-association-check",i).bind("click",(function(t){t.stopPropagation();var i=$(this),r=$(this).parents("ol").data("id"),a=$(this).data("id");i.prop("checked")?(i.prop("checked",!0),e.addElement(r,a)):(i.prop("checked",!1),e.removeElement(r,a))})),$(".bz-render-association .bz-render-association-left-container li",i).bind("click",(function(t,i){t.stopPropagation();var r=$(this).find("input").length>0?$(this).find("input"):$(this),a=$(".bz-render-association-check-mask",$(this)),n=$(this).parent("ol").data("id"),o=$(this).data("id")||$(this).parents("li").data("id");r.prop("checked")?(r.removeAttr("checked"),a.removeClass("checked"),a.addClass("unchecked"),e.removeElement(n,o)):(r.prop("checked",!0),a.removeClass("unchecked"),a.addClass("checked"),e.addElement(n,o))})))},setBindToClose:function(e){var t=this;e.find(".deleteBotton").bind("click",(function(){t.closeElement($(this).parent("li"))}))},closeElement:function(e){var t=e.parent("ol");this.removeElement($(t).data("id"),e.data("id")),e.hide("highlight",1e3,(function(){$(this).remove()}))},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.renderFactory.getTemplate("association");e.properties.classCss="read-only",e.makeJsonBase(),$.tmpl(i,e.properties,{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation,getLeftName:e.getLeftName}).appendTo(t),$(".bz-render-association-accordion",t).togglepanels({header:"> div > h3",autoHeight:!1}),$.when(e.isRendered()).done((function(){$(".bz-render-association-accordion h3",t).first().click()})),e.properties.allowFlip&&$(".bz-render-association .flip-arrow",t).bind("click",(function(){$(t).empty(),e.properties.flipped=!e.properties.flipped,e.postRenderReadOnly()}))},collectData:function(e){this._super(e)},renderReadOnly:function(){var e=this.getValue();return"object"===_typeof(e)?"":e}}),$.Class.extend("bizagi.rendering.getUser",{},{init:function(e){this._super(e),this.properties.allowDelegatedUser=this.properties.xpath&&"idDelegate"===this.properties.xpath},renderControl:function(){var e=this.renderFactory.getTemplate("render-getUser");return $.fasttmpl(e,{})},renderReadOnly:function(){var e=this._super(),t=e;return bizagi.util.isString(t)||(t=e[0]&&e[0].value?e[0].value:""),t},isValid:function(e){return this._super(e)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.getUser",bizagi.rendering.getUser.prototype),bizagi.rendering.desktop.getUser.extend("bizagi.rendering.desktop.getUser",{},{postRender:function(){this.input=$(".ui-bizagi-render-text",this.getControl()),null!=this.properties.value&&this.properties.value.length>0&&this.setDisplayValue(this.properties.value[0]),this._super()},configureHandlers:function(){var e=this,t=e.getControl();e.bindSearchUserPlugin(t),$("#btn-clear-user",t).on("click",(function(){e.clearValue()}))},setDisplayValue:function(e,t){t=0!=t||t;var i=void 0!==e?e.value:null;this.properties.editable&&this.input.val(i),this.setValue(e,t)},clearValue:function(){this.input&&this.setDisplayValue("",!1)},bindSearchUserPlugin:function(e){var t=this,i={title:t.getResource("render-plugin-search-users-title"),maximize:!1,filters:["domain","userName","fullName"],displayNames:[t.getResource("render-plugin-search-users-domain"),t.getResource("render-plugin-search-users-user-name"),t.getResource("render-plugin-search-users-full-name")],searchButtonName:t.getResource("render-plugin-search-users-search-button-name"),clearButtonName:t.getResource("render-plugin-search-users-clear-button-name"),valuesToSelect:["iduser","user"],renderFactoryReference:t.renderFactory,getResourceReference:t.getResource.bind(t),selectItem:function(){var e=$.Deferred();return e.done((function(e){t.onItemSelectedSuccess(e)})).fail((function(e){bizagi.log(e)})),e},searchUsers:function(e){return t.callSearchUserEndpointByContext(t.properties,e)},showError:function(e){bizagi.log(e)},showMessageBox:function(e){bizagi.showMessageBox(bizagi.localization.getResource(e),"Bizagi","warning")}};t.properties.allowDelegatedUser&&(i.editingUser=t.properties.idUser),opt=i;var r=t.getParams();void 0!==r.isEntityForm&&r.isEntityForm&&(i.allowAddUser=bizagi.menuSecurity.UserAdmin||!1,i.dataService=t.dataService,i.renderFactory=t.renderFactory),$("#btn-get-user",e).bizagiSearchUser(i)},callSearchUserEndpointByContext:function(e,t){return"usersForm"===this.getFormContainer().params.type?this.callSearchUserEndpointInUsersForm(e,t):"userPreferencesForm"===this.getFormContainer().params.context?this.callSearchUserEndpointInUserPreferencesForm(e,t):this.callSearchUserEndpointInOtherCases(e,t)},callSearchUserEndpointInUsersForm:function(e,t){return"idBossUser"===e.xpath?this.dataService.getUsersListForXpathIdBossUser(t):this.xpathIsDelegated(e)?this.dataService.getUsersListForXpathIdDelegate(t):this.callSearchUserEndpointInOtherCases(e,t)},callSearchUserEndpointInUserPreferencesForm:function(e,t){if(this.xpathIsDelegated(e))return this.dataService.getUsersListForXpathIdDelegate(t)},xpathIsDelegated:function(e){return"idDelegate"===e.xpath},callSearchUserEndpointInOtherCases:function(e,t){return e.allowDelegatedUser?this.dataService.getUsersListFromPreferences(t):this.dataService.getUsersListForStakeholders(t)},getOptions:function(){return opt},onItemSelectedSuccess:function(e){var t={id:e.iduser,value:e.user};this.setDisplayValue(t)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeRequiredControl:function(e){this.changeRequiredLabel(e)}}),$.Class.extend("bizagi.rendering.queryProcess",{},{init:function(e){this._super(e)},renderControl:function(){var e=this.renderFactory.getTemplate("queryProcess");return $.fasttmpl(e,{})},loadtemplates:function(){}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.queryProcess",bizagi.rendering.queryProcess.prototype),bizagi.rendering.desktop.queryProcess.extend("bizagi.rendering.desktop.queryProcess",{},{postRender:function(){var e=this;this._super();e.renderFactory.getTemplate("queryProcessWrapper"),e.getControl();e.getElement("row").bind("click",(function(){var t=e.getWrapper();if(t.properties.visible)t.element.hide(),t.element.css("visibility","hidden"),t.element.empty();else{t.element.show(),t.element.css("visibility","visible");var i=e.loadData("aplications");e.renderData(i,t.element)}}))},getWrapper:function(){var e=this.getElement("wrapper"),t={element:e,properties:{}};return t.properties.visible="visible"===e.css("visibility"),t},getElement:function(e){var t=this.getControl();return{row:$(".ui-selectmenu-btn , .ui-bizagi-container-query-process :input[type=text]",t),wrapper:$(".ui-selectmenu-wrapper",t),linkApplication:$(".linkApplication",t)}[e]},loadData:function(e){if("aplications"==e)var t={items:[{id:1,displayName:"My App 1"},{id:2,displayName:"My App 2"},{id:3,displayName:"My App 3"}]};if("process"==e)t={items:[{id:4,displayName:"My Category 1",process:!1},{id:5,displayName:"My Process 1",process:!0},{id:6,displayName:"My Category 2",process:!1}]};return t},renderData:function(e,t){$(t).empty(),void 0===e.items[0].process&&t.append('<a class="linkApplication" data-idcategory="0" data-typeitem="process"><i class="biz-ico biz-wp-tree-icon biz-wp-tree-image-process"></i>All process </a>'),$.each(e.items,(function(e,i){t.append('<a class="linkApplication" data-idCategory="'+i.id+'"><i  name="app" class="biz-wp-tree-icon biz-wp-tree-expand-icon"></i><i class="biz-ico biz-wp-tree-icon"></i>'+i.displayName+"</a>");var r=$("[data-idCategory="+i.id+"]",t);if(i.process){r.find("i").last().addClass("biz-wp-tree-image-process"),r.find("i").first().remove(),r.css("margin-left","25px"),r.attr("data-typeItem","process")}else{if(0==i.process)r.find("i").last().addClass("biz-wp-tree-image-category"),r.attr("data-typeItem","category");else r.find("i").last().addClass("biz-wp-tree-image-application"),r.attr("data-typeItem","app");var a="ui-selectmenu-wrapper"!=$(t).attr("class")?$(t).attr("id").replace("category_",""):"",n=""!=a?"category_"+a+"-"+i.id:"category_"+i.id;t.append("<div class='ui-bizagi-contCategory' id='"+n+"'></div>")}})),this.setupLinks(t)},setupLinks:function(e){var t=this;$(".linkApplication",e).on("click",(function(){var i=$(this).attr("data-idCategory"),r="ui-selectmenu-wrapper"!=$(e).attr("class")?$(e).attr("id").replace("category_",""):"",a=""!=r?$("#category_"+r+"-"+i):$("#category_"+i);if("process"==$(this).attr("data-typeItem")){var n=$(this).text(),o=t.getWrapper();o.element.hide(),o.element.css("visibility","hidden");var s="",l=this,d=[];if($(this).attr("data-idcategory")>0)for(;"app"!=s||null==s;)s=(l=$(l).closest("div").prev())[0].getAttribute("data-typeItem"),d.push(l.text());o.element.empty(),d=""==(d=d.reverse().join(" > "))?n:d+=" > "+n,$(".ui-bizagi-container-query-process :input[type=text]").val(d)}else{var u=$(this).find("i").first();if("visible"===a.css("visibility"))u.addClass("biz-wp-tree-expand-icon"),u.removeClass("biz-wp-tree-collapse-icon"),a.hide(),a.css("visibility","hidden"),a.empty();else{var c=t.loadData("process");u.removeClass("biz-wp-tree-expand-icon"),u.addClass("biz-wp-tree-collapse-icon"),a.show(),a.css("visibility","visible"),t.renderData(c,a)}}}))}}),$.Class.extend("bizagi.rendering.querySearchUser",{},{init:function(e){this._super(e)},renderControl:function(){var e=this.renderFactory.getTemplate("render-querySearchUser");return $.fasttmpl(e,{})},getUserData:function(e){var t=this.properties,i=new $.Deferred,r=this.getFormContainer().getContextType()||!1;e=e||{},this.properties.contexttype?e.h_contexttype=this.properties.contexttype:r&&(e.h_contexttype=r);return t.data=[{id:1,value:"user1"},{id:2,value:"user2"},{id:3,value:"user3"},{id:4,value:"user4"},{id:5,value:"user5"},{id:6,value:"user6"},{id:7,value:"user7"},{id:8,value:"user8"},{id:9,value:"user9"},{id:10,value:"user10"}],i.resolve(t.data),i.promise(i)},setDisplayValue:function(e){var t=this.getControl(),i=this.getDisplayValue();if(0==this.properties.editable&&"string"==typeof e){var r=bizagi.util.encodeString(i);t.html(r)}this.setValue(e,!1)}}),$.Class.extend("bizagi.rendering.queryAdvanced",{},{MAX_TAGS_SUPPORTED:50,OPERATORS:{like:{label:"workportal-widget-filter-operators-contains",defaultLabel:"Contains",appliesTo:["Text"],operator:"APPROX",action:"like"},equals:{label:"workportal-widget-filter-operators-equals-to",appliesTo:["Text","Number","Currency"],operator:"EXACT",action:"tags"},equal:{label:"workportal-widget-filter-operators-equals-to",appliesTo:["DateTime"],operator:"EXACT",action:"equal"},"not-equals":{label:"workportal-widget-filter-operators-different-to",appliesTo:["Text","Number","Currency"],operator:"NOTEXACTORNULL",action:"tags"},"starts-with":{label:"workportal-widget-filter-operators-starts-with",defaultLabel:"Starts with",appliesTo:["Text"],operator:"WILDCARD",action:"starts-with"},"ends-with":{label:"workportal-widget-filter-operators-ends-with",defaultLabel:"Ends with",appliesTo:["Text"],operator:"WILDCARD",action:"ends-with"},"greater-equals-than":{label:"workportal-widget-filter-operators-greater-or-equal-than",appliesTo:["Number","DateTime","Currency"],operator:"FROM",action:"from"},"less-equals-than":{label:"workportal-widget-filter-operators-less-or-equal-than",appliesTo:["Number","DateTime","Currency"],operator:"TO",action:"to"},between:{label:"workportal-widget-filter-operators-between",defaultLabel:"Between",appliesTo:["Number","DateTime","Currency"],operator:"BETWEEN",action:"between"},"is-null":{label:"workportal-widget-filter-operators-is-empty",defaultLabel:"Is empty",appliesTo:["Text","Number","DateTime","Currency"],operator:"EXACT",action:"is-null"},wildcard:{label:"Wildcard",appliesTo:["Text"],operator:"WILDCARD",action:"wildcard",skip:!0},default:{label:"Default",appliesTo:["Number","Currency"],operator:"EXACT",action:"default",skip:!0}},initializeData:function(e){this._super(e);var t=this.properties;t.filterType=t.filterType||"",t.renderType=this.Class.DATATYPE,t.data=this.getOptions(),t.orientation=t.orientation||"",this.currentFilter={},this.controlInitial=null,this.controlEnd=null},postRender:function(){var e=this.getControl();this.queryFilter=$(".bz-query-filter",e),this._super()},renderControl:function(){var e=this.renderFactory.getTemplate("query.advanced");return $.fasttmpl(e,{})},processComplexValue:function(e){var t=e,i=t&&$.trim(t).length>0,r=i&&/^\[.*?\]$/i.test(t);return t=i&&r?JSON.parse(t):i?[t]:t||[]},renderReadOnly:function(){return this.isCurrentDefaultFilter()?this._super():this.renderReadOnlyFilter()},renderReadOnlyFilter:function(){var e=this.renderFactory.getTemplate("query.advanced.readonly"),t=this.getCurrentFilter(),i="null"==this.getValue()||bizagi.util.isNull(this.getValue())?"":this.getValue(),r=$.tmpl(e,{filterName:this.getResourceByKey(t.label,t.defaultLabel)}),a=$(".bz-query-advanced__filter",r);return this.isCurrentBetweenFilter()?this.renderReadOnlyBetween(a):this.isCurrentTagFilter()?this.renderReadOnlyTags(a):a.append("<li class='bz-query-advanced__filter-input'><span>"+i+"</span></li>"),r},renderReadOnlyBetween:function(e){var t=this.processComplexValue(this.getValue());if(0!==t.length){var i="<li class='bz-query-advanced__filter-input-from'><span>"+("null"==t[0]||bizagi.util.isNull(t[0])?"":t[0])+"</span></li>",r="<li class='bz-query-advanced__filter-input-to'><span>"+("null"==t[1]||bizagi.util.isNull(t[1])?"":t[1])+"</span></li>";e.append(i).append(r)}},renderReadOnlyTags:function(e){var t=this.processComplexValue(this.getValue());if(0!==t.length){var i=this.renderFactory.getTemplate("query.advanced-pill");t.forEach((function(t){var r=$.tmpl(i,{id:this.getTagId(),value:this.formatTagItem(t||""),editable:!1});e.append(r)}))}},configureHandlers:function(){this._super(),this.configureFilterHandlers(),this.configureTagHandlers(),/Text/i.test(this.properties.renderType)||this.configureDefaultHandlers()},configureFilterHandlers:function(){var e=this,t=e.getControl();$(".bz-query-advanced__tags",t).on("click",(function(i){var r=$(i.target),a=t.find(".bz-query-advanced").data("mode-wildcard")||!1,n=e.filterOptionIsShowed(),o=r.hasClass("bz-query-advanced__filter")||r.hasClass("bz-query-advanced__tag")||r.hasClass("bz-query-advanced__tag-span")||r.hasClass("bz-btn-icn bz-query-advanced__tag-arrow");!a&&(n&&o||!n)&&e.onToggleDataView()})),t.on("click",".bz-query-advanced__clean",(function(){e.onToggleDataOptions()}))},configureTagHandlers:function(){var e=this,t=this.getControl();t.on("keydown","input[data-action='tags']",(function(t){var i=t.key||t.charCode||t.keyCode,r=null;if("Tab"===i||"Enter"===i){var a=$(this);(r=e.getValidTagValue(a.val()))&&(e.addTag({id:e.getTagId(),value:r,displayValue:r}),a.val(""),t.preventDefault())}else"Backspace"===i&&((r=$(this).val())||e.removeLastTag())})),t.on("blur","input[data-action='tags']",(function(){var t=$(this),i=e.getValidTagValue(t.val());i&&(e.addTag({id:e.getTagId(),value:i,displayValue:i}),t.val(""))})),t.on("click",".bz-query-advanced__remove-pill-icon",(function(t){var i=Number($(t.target).attr("data-id")||0);e.removeTag(i)}))},configureDefaultHandlers:function(){var e=this,t=e.getControl(),i=$(".bz-query-advanced__clean",t);t.on("change",".bz-query-advanced__input",(function(){e.filterOptionIsShowed()||($.trim(this.value).length>0?(e.setCurrentFilter({id:"default"}),i.removeClass("bz-hidden"),e.closeFloatView()):(e.setCurrentFilter({id:""}),i.addClass("bz-hidden")))}))},isValid:function(e){return!!this._super(e)&&(!(this.controlInitial&&!this.controlInitial.isValid(e))&&!(this.controlEnd&&!this.controlEnd.isValid(e)))},hasValue:function(){return!!this.isCurrentNullFilter()||this._super()},onToggleDataView:function(){this.floatViewIsCollapsed()?this.closeFloatView():this.renderFloatView()},floatViewIsCollapsed:function(){var e=$(".bz-query-advanced__content",this.element);return e&&e.length>0},renderFloatView:function(){var e=this.renderFactory.getTemplate("query.advanced-item"),t=this.properties.data,i=this.showFloatListView(e,{datasource:t},{});this.floatListHandlers(i)},showFloatListView:function(e,t){var i=this.getControl().closest(".ui-bizagi-control-wrapper"),r=i.closest(".bz-form-old-item"),a=$.tmpl(e,t),n=this.queryFilter.width()-2;r.addClass("bz-query-advanced__visible"),i.addClass("bz-query-advanced__visible bz-query-advanced__floats"),i.append(a),a.width(n),a.position({my:"left top",at:"left bottom",of:this.queryFilter,collision:"fit"}).hide(),a.show(),a.on("mousedown",(function(e){return e.preventDefault(),!1}));var o=setTimeout((function(){$(document).one("mousedown.query-advanced",(function(){a.trigger("closeView")})),clearTimeout(o)}),0);return a},closeFloatView:function(){var e=this.getControl().closest(".ui-bizagi-control-wrapper").closest(".bz-form-old-item"),t=$(e).find(".bz-query-advanced__content");t.hide(),this.destroyFloatView(t)},destroyFloatView:function(e){var t=this.getControl().closest(".ui-bizagi-control-wrapper"),i=t.closest(".bz-form-old-item");t.hasClass("bz-query-advanced__visible")&&t.removeClass("bz-query-advanced__visible"),t.hasClass("bz-query-advanced__floats")&&t.removeClass("bz-query-advanced__floats"),i.hasClass("bz-query-advanced__visible")&&i.removeClass("bz-query-advanced__visible"),e.remove()},floatListHandlers:function(e){var t=this;e.find(".bz-query-advanced__list li").click((function(){var e=$(this),i={id:e.data("id"),value:$("span",e)[0].innerText};t.getCurrentFilter().id!==i.id?(t.filterOptionIsShowed()||t.showHideCleanButton(!0),t.destroyFilterContent(),t.setSelectedFilter(i)):t.closeFloatView(),t.controlInitial&&$("input",t.controlInitial.getControl()).focus()})),e.on("closeView",(function(){t.closeFloatView(),$(document).unbind("mousedown.query-advanced")}))},setSelectedFilter:function(e){this.onFilterChange(e),this.closeFloatView()},tagIsAdded:function(e){return(this.getDataValue()||[]).map((function(e){return e.value})).includes(e.value)},addTag:function(e){if(!this.tagIsAdded(e)){var t=this.getFormContainer();if(t.clearValidationMessages(),this.isMaximumTagsValid()){var i=$(".bz-query-advanced__filter-input",this.getControl()),r=this.renderFactory.getTemplate("query.advanced-pill"),a=$.tmpl(r,{id:e.id,value:e.displayValue,editable:this.properties.editable});i.before(a),this.addElement(e)}else{var n=this.getResourceByKey("workportal-tags-error-limit-exceeded","You cannot add more than #maxTags# criteria elements").replace("#maxTags#",this.MAX_TAGS_SUPPORTED);t.addErrorMessage(n)}}},removeTag:function(e){$("li[data-id="+e+"]",this.getControl()).remove(),this.removeElement({id:e})},removeLastTag:function(){var e=this.getDataValue(),t=e[e.length-1];t&&this.removeTag(t.id)},getTagId:function(){return Math.ceil(1e6*Math.random())},formatTagItem:function(e){return $.trim(e)},performTagItems:function(){var e=(this.getDataValue()||[]).filter((function(e){return e&&!!e.value})).map((function(e){return e.value}));return e.length>1?JSON.encode(e):e&&e[0]||""},isMaximumTagsValid:function(){var e=this.getDataValue()||[];return e&&e.length<this.MAX_TAGS_SUPPORTED},getDataValue:function(){try{return JSON.parse(this.value)||[]}catch(e){return[]}},getValue:function(){return this.isCurrentTagFilter()?this.performTagItems():this._super()},getValidTagValue:function(e){return $.trim(e)},addElement:function(e){var t=this.getDataValue();t.push(e),this.setValue(t)},removeElement:function(e){var t=e.id,i=this.getDataValue().filter((function(e){return e.id!==t}));this.setValue(i)},filterOptionIsShowed:function(){var e=this.getControl(),t=$(".bz-query-advanced__filter > .bz-query-advanced__tag",e);return t&&t.length>0},onToggleDataOptions:function(){this.showHideCleanButton(),this.cleanDataFilter(!0)},onFilterChange:function(e){this.cleanDataFilter(!1),this.setCurrentFilter(e);var t=this.getControl(),i=this.getCurrentAction();$(".bz-query-advanced__input",t).removeAttr("data-action"),$(".bz-query-advanced__tags",t).removeAttr("data-action"),i&&($(".bz-query-advanced__tags",t).attr("data-action",i),this.defineLiteControl({typeFilter:i}),this.isCurrentNullFilter()&&this.setValue(this.getValue()))},cleanDataFilter:function(e){this.controlInitial=null,this.controlEnd=null,this.destroyFilterContent(),this.setCurrentFilter({id:""}),this.cleanData(),$(".bz-query-advanced__tag",this.getControl()).remove(),e&&this.defineLiteControl({typeFilter:""})},getSearchType:function(){var e=this.getCurrentFilter();return e&&e.operator||"EXACT"},destroyFilterContent:function(){$(".bz-query-advanced__filter",this.getControl()).empty()},performQueryValue:function(e,t){var i=e;return"starts-with"===t?i=i?i+"%":"%":"ends-with"===t?i=i?"%"+i:"%":"is-null"===t?i="null":["equals","not-equals"].includes(t)&&(i=this.performTagItems()),i},formatInputValue:function(e){return void 0===e||bizagi.util.isEmpty(e)?"null":e},addSelectedElements:function(){var e=this,t=this.getControl(),i=this.getDataValue()||[],r=this.properties.editable,a=$(".bz-query-advanced__filter-input",t),n=this.renderFactory.getTemplate("query.advanced-pill");a.remove(".bz-query-advanced__pill"),i.forEach((function(t){var i=$.tmpl(n,{id:t.id,value:e.formatTagItem(t.value||""),editable:r});a.before(i)}))},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;e=e||{};var r={id:i.id,xpath:i.xpath+"_"+e.typeControl,displayType:"value",type:i.type,orientation:i.orientation},a={data:{properties:$.extend({},r,this.getRequiredProperties())},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return e.isRange&&(a.data.properties.isRange=e.isRange||!1,a.data.properties.isMinimumValue=e.isMinimum||!1,a.data.properties.isMaximumValue=e.isMaximum||!1,e.isMinimum?a.data.properties.displayName=bizagi.localization.getResource("bz-rp-components-time-from-label"):a.data.properties.displayName=bizagi.localization.getResource("bz-rp-components-time-to-label")),a},defineLiteControl:function(e){},setLiteControls:function(e,t){},renderLiteControl:function(e,t,i){},getTemplateByType:function(e){},getRequiredProperties:function(){return{}},getOptions:function(){var e=this.OPERATORS,t=this.properties.renderType,i=[];for(var r in e){var a=e[r];$.inArray(t,a.appliesTo)>=0&&!a.skip&&i.push({value:this.getResourceByKey(a.label,a.defaultLabel),id:r})}return i},showHideCleanButton:function(e){var t=this.getControl();if(t){var i=$(".bz-query-advanced__clean",t);i&&e?i.removeClass("bz-hidden"):i.addClass("bz-hidden")}},onToggleHideElement:function(e){var t=this.getControl();if(t){var i=$(e,t);i&&i.toggleClass("bz-hidden")}},setCurrentFilter:function(e){var t=this.OPERATORS,i=e&&e.id?e.id:"";i&&t[i]?this.currentFilter=Object.assign({},t[i],{id:i}):this.currentFilter={}},getCurrentFilter:function(){return this.currentFilter||{}},getCurrentAction:function(){var e=this.getCurrentFilter();return e&&e.action||""},isCurrentTagFilter:function(){return this.isCurrentFilter("tags")},isCurrentBetweenFilter:function(){return this.isCurrentFilter("between")},isCurrentNullFilter:function(){return this.isCurrentFilter("is-null")},isCurrentWildcardFilter:function(){return this.isCurrentFilter("wildcard")},isCurrentContainsFilter:function(){return this.isCurrentFilter("like")},isCurrentStartsWithFilter:function(){return this.isCurrentFilter("starts-with")},isCurrentEqualsThanFilter:function(){return this.isCurrentFilter("less-equals-than")||this.isCurrentFilter("greater-equals-than")},isCurrentEndsWithFilter:function(){return this.isCurrentFilter("ends-with")},isCurrentFilter:function(e){return this.getCurrentAction()===e},isCurrentDefaultFilter:function(){var e=this.getCurrentAction();return e===this.defaultFilter||e==={}||""===e},getResourceByKey:function(e,t){return t=t||e,bizagi.localization.getResource(e,t)},prepareForSetValue:function(){var e=this.getCurrentFilter();bizagi.util.isEmpty(e)&&this.setFilter(this.defaultFilter)},performDataValue:function(e){var t=this,i=e;if(t.isCurrentTagFilter()){var r=[],a=i&&$.trim(i).length>0,n=a&&/^\[.*?\]$/i.test(i);return a&&!n?r=[i]:n&&(r=t.getDataValue()||[]),(r||[]).map((function(e){return{id:t.getTagId(),value:e}}))||""}return i&&$.trim(i).length>0&&(t.isCurrentStartsWithFilter()?i=i.replace(/%$/i,""):t.isCurrentEndsWithFilter()&&(i=i.replace(/^%/i,""))),i},performListValue:function(e){var t=e;if("between"===this.getCurrentAction()){var i=[],r=t&&$.trim(t).length>0,a=r&&/^\[.*?\]$/i.test(t);t=r&&a?{from:(i=JSON.parse(e))[0]&&"null"!==i[0]?i[0]:"",to:i[1]&&"null"!==i[1]?i[1]:""}:{from:e,to:e}}return t},setFilter:function(e){var t="",i=bizagi.util.isEmpty(this.getCurrentFilter());e&&(this.setCurrentFilter({id:e}),t=this.getCurrentAction()),!i&&this.showHideCleanButton(!0),this.defineLiteControl({typeFilter:t})},collectDataQueryForm:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=null;if(!bizagi.util.isEmpty(i)){var n=this.getSearchType(),o=this.getCurrentFilter(),s=o&&o.id||"";if(null!=r&&(a=""!==r?r:null),null!==a||t.included||"is-null"===s){var l={value:this.performQueryValue(a,s),included:this.properties.included,xpath:t.xpath,searchType:n,orderType:"NONE",filterType:s,advancedQuery:t.advancedQuery||!1,renderId:this.getRenderId()};void 0!==t.displayXpath&&""!==t.displayXpath&&(l.displayXpath=t.displayXpath),e.push(l)}}}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.querySearchUser",bizagi.rendering.querySearchUser.prototype),bizagi.rendering.desktop.querySearchUser.extend("bizagi.rendering.desktop.querySearchUser",{},{initializeData:function(e){this._super(e)},postRender:function(){this.input=$(".ui-bizagi-render-text",this.getControl()),this._super()},setDisplayValue:function(e){e="object"===_typeof(e)?"object"===_typeof(e[0])&&void 0!==e[0].label?e[0].label:e.label:"";var t=this.properties;this._super(e),!bizagi.util.isEmpty(e)&&t.editable&&this.input.val(e)},configureHandlers:function(){var e=this.getControl();this.bindSearchUserPlugin(e)},bindSearchUserPlugin:function(e){var t=this,i=t.getFormContainer().properties.id,r={title:t.getResource("render-plugin-search-users-title"),filters:["domain","userName","fullName"],displayNames:[t.getResource("render-plugin-search-users-domain"),t.getResource("render-plugin-search-users-user-name"),t.getResource("render-plugin-search-users-full-name")],searchButtonName:t.getResource("render-plugin-search-users-search-button-name"),clearButtonName:t.getResource("render-plugin-search-users-clear-button-name"),valuesToSelect:["iduser","username"],renderFactoryReference:t.renderFactory,getResourceReference:t.getResource.bind(t),selectItem:function(){var e=$.Deferred();return e.done((function(e){t.onItemSelectedSuccess(e)})).fail((function(e){bizagi.log(e)})),e},searchUsers:function(e){return t.dataService.getUsersListFromQueryForm($.extend(e,{queryFormId:i}))},showError:function(e){bizagi.log(e)},showMessageBox:function(e){bizagi.showMessageBox(bizagi.localization.getResource(e),"Bizagi","warning")}};opt=r,$("#btn-get-user",e).bizagiSearchUser(r)},getOptions:function(){return opt},onItemSelectedSuccess:function(e){var t=this.getControl();$(".ui-bizagi-render-text",t).val(e.username);var i={};i.id=e.iduser,i.label=e.username,i.value=e.username,this.setValue(i)}}),$.Class.extend("bizagi.rendering.device.factory",{},{init:function(e){this.execution_device=bizagi.util.detectDevice(),this.cachedFactory={}},getRenderFactory:function(e,t){var i=this;t=t||"desktop";var r=new $.Deferred;return void 0!==i.cachedFactory[t]?(i.cachedFactory[t].printVersion=!1,r.resolve(i.cachedFactory[t])):"print"===t?(i.cachedFactory[t]=new bizagi.rendering.print.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):"desktop"===t?(i.cachedFactory[t]=new bizagi.rendering.desktop.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):bizagi.util.isTabletDevice(t)?(i.cachedFactory[t]=new bizagi.rendering.tablet.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):bizagi.util.isSmartphoneDevice(t)?(i.cachedFactory[t]=new bizagi.rendering.smartphone.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):(bizagi.showMessageBox("Not supported device: "+t),r.reject("Not supported device: "+t)),r.promise()},getDataService:function(){return this.dataService}}),bizagi.rendering=bizagi.rendering||{},$.Class.extend("bizagi.rendering.facade",{form:void 0,executionDeferred:new $.Deferred},{init:function(e){e=e||{},this.observableElement=$({});var t=e.device||"";this.deviceFactory=new bizagi.rendering.device.factory,this.dataService=new bizagi.render.services.service(e),this.renderFactory=this.deviceFactory.getRenderFactory(this.dataService,t)},getFactory:function(){return{deviceFactory:this.deviceFactory,dataService:this.dataService,renderFactory:this.renderFactory}},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){return this.observableElement.triggerHandler.apply(this.observableElement,arguments)},update:function(e){return e.mode&&(this.mode=e.mode),this.execute($.extend({canvas:this.canvas,mode:this.mode},e))},execute:function(e){var t=this,i=this.ownerDocument,r=$("body",i);if(e=e||{},t.executionDeferred&&t.executionDeferred.state?"resolved"==t.executionDeferred.state()&&(t.executionDeferred=$.Deferred()):t.executionDeferred=$.Deferred(),bizagi.chrono.initAndStart("rendering+data",!0),bizagi.rendering.render.startOptimization(),void 0===e.mode&&!bizagi.util.isEmpty(window.location.search)){var a=bizagi.util.getQueryString();e.mode=a.mode}var n=t.canvas=e.canvas=e.canvas||$("<div />").appendTo(r);return t.mode=e.mode,t.sendExecutingPostMessageWebparts(),t.process(e).done((function(i){e.refreshing||n.empty(),n.append(i.container),$(i.pathProcess).insertBefore(i.container),t.form=i,t.form.setSize({width:t.lastWidth,height:t.lastHeight});var r=setTimeout((function(){t.lastWidth=$(window).width(),t.lastHeight=$(window).height(),window.self!==window.top&&t.resizeInPopUpHTML(),clearTimeout(r)}),2e3);i.triggerHandler("ondomincluded"),t.publish("rendering-formRendered",{form:i}),t.configureOpenForm(i),t.configureRefresh(i,n),t.configureRouting(i,n),t.configureRenderError(i,n),t.configureResize(i),t.configureGlobalHandlers(i),e.summaryForm&&i.container.addClass("ui-bizagi-summary-form"),bizagi.chrono.stopAndLog("rendering"),bizagi.chrono.stopAndLog("rendering+data"),bizagi.chrono.stopAndLog("submitForm"),bizagi.chrono.stopAndLog("submitForm-ajax"),bizagi.chrono.stopAndLog("waiting"),bizagi.rendering.render.stopOptimization(),bizagi.override.enableE2EInterface&&(t.Class.form=t.form,t.Class.executionDeferred.resolve(t.form)),t.executionDeferred.resolve(t.form)})).fail((function(e,i){$.when(t.renderFactory).done((function(i){void 0!==e&&""!==e||(e=bizagi.localization.getResource("render-error-unknown"));var r=i.getCommonTemplate("form-error");n.empty(),n.append($.tmpl(r,{message:e})),t.publish("rendering-formRenderedError",e),t.canvas.triggerHandler("errorform",e),bizagi.chrono.stopAndLog("rendering"),bizagi.chrono.stopAndLog("rendering+data"),t.executionDeferred.reject()}))})),t.executionDeferred.promise()},ready:function(){return this.executionDeferred.promise()},process:function(e){var t=this,i=new $.Deferred,r=t.dataService.getFormData(e),a=t.canvas||e.canvas;return bizagi.showErrorAlertDialog=!1,$.when(r,t.renderFactory).done((function(r,n){if(bizagi.showErrorAlertDialog=!0,bizagi.util.isEmpty(r))return t.publish("no-data-found"),void i.fail();if(r&&"reload"==r.type)(l=t.form)&&(l.endLoading(),l.dispose()),a.triggerHandler("routing",r);else if(r&&"suspended"==r.type){var o=n.getTemplate("info-message"),s=bizagi.localization.getResource("render-case-suspended");$.tmpl(o,{message:s}).appendTo(a),i.fail()}else if(r&&"error"!=r.type){e.hasOwnProperty("printversion")&&((r=t.transformGridControl(r)).form.properties.editable="False"),bizagi.chrono.initAndStart("rendering"),e.type=r.form&&r.form.properties.type||e.type;var l=t.processForm(r.form,n,e);i.resolve(l)}else t.getFailDeferred(r,i)})).fail((function(e){t.getFailDeferred(e,i)})),i.promise()},transformGridControl:function(e){var t=this;return null==e?e:(e.hasOwnProperty("type")&&"grid"==e.type?(e.id=e.id+"-print",e.allowAdd="False",e.allowDelete="False",e.allowEdit="False",e.allowGrouping="False",e.allowMore="False",e.allowSearch="False"):$.each(e,(function(i,r){"object"==_typeof(r)&&(e[i]=t.transformGridControl(e[i]))})),e)},getFailDeferred:function(e,t){var i="",r={};try{r=JSON.parse(e.responseText)}catch(t){r={message:e.responseText,errorType:"ERRORUNKNOWN"}}r.message?(i+="<br>Error Type: "+r.errorType,i+="<br>Error Message: "+r.message):"JSharpNotSupportedException"==r.errorType&&(i+="<br>Error Message: "+bizagi.localization.getResource("jsharp-required")),"ERRORUNKNOWN"==r.errorType?t.reject(i,r.errorType):t.reject(i)},processForm:function(e,t,i){var r=t.getContainer($.extend(i,{type:i.type||"form",data:e}));return r.render(),r},resize:function(e){this.form&&this.form.trigger("renderresize",e)},configureRefresh:function(e,t){var i=this;e.bind("refresh",(function(r,a){var n=e.container.parent(),o=(n=bizagi.util.scrollTop(n)).scrollTop();$(i.form).trigger("onRefreshStarted"),e.dispose(a),t.fastEmpty();var s=t.parent();s.find(".ui-bizagi-button-container").length>0&&s.find(".ui-bizagi-button-container").remove(),i.executionDeferred&&i.executionDeferred.state&&"resolved"==i.executionDeferred.state()&&(i.executionDeferred=$.Deferred());var l=i.form.getParams();return bizagi.util.isMobileDevice()&&!0===l.isOfflineForm&&($.extend(a,{isOfflineForm:!0,offlineType:l.offlineType,isOpen:l.isOpen}),a.online="debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase()?e.online:bizagi.util.isConnected()),$.when(i.execute($.extend(a,{canvas:t,refreshing:!0,idCase:l.idCase,displayName:l.displayName}))).done((function(){var e=setTimeout((function(){n.scrollTop(o),$(i.form).trigger("onRefreshFinished"),clearTimeout(e)}),100)})),i.executionDeferred.promise()}))},configureResize:function(e){var t=this;e.bind("renderresize",(function(i,r){if(r=r||{},!t.resizeTimeout){t.resizeTimeout=setTimeout((function(){var i=$(window).width(),a=$(window).height();(r.forceResize||i!=t.lastWidth)&&(bizagi.chrono.initAndStart("resize"),e.resize({width:i,height:a}),t.lastWidth=i,t.lastHeight=a,bizagi.chrono.stopAndLog("resize"),bizagi.chrono.log("resize")),t.resizeTimeout=null,clearTimeout(t.resizeTimeout)}),0)}})),t.resize()},configureRouting:function(e,t){e.bind("routing",(function(i,r){e.dispose(),t.triggerHandler("routing",r)}))},configureGlobalHandlers:function(e){var t=this;e.bind("globalHandler",(function(e,i){return t.publish(i.eventType,i.data)}))},configureOpenForm:function(e){$(document).trigger("openForm",{form:e})},configureRenderError:function(e,t){var i=this;e.bind("formRenderingError",(function(e,r){$.when(i.renderFactory).done((function(e){var a="<br>Error: ";r=r.replace(/(\r\n|\n|\r)/gm,"");var n=JSON.parse(r);n.message&&(a+=n.message,a+="<br>Error Type: "+n.errorType);var o=e.getCommonTemplate("form-error");t.empty(),t.append($.tmpl(o,{message:a})),i.canvas.triggerHandler("errorform","renderItemError"),bizagi.chrono.stopAndLog("rendering+data"),bizagi.chrono.stopAndLog("rendering")}))}))},dispose:function(){this.form&&this.form.dispose(),bizagi.util.dispose(this)},resizeInPopUpHTML:function(){if($(".activitiFormContainer").length>0&&"cases"!=bizagi.util.getQueryString().type){var e=$(".activitiFormContainer").height()||0,t=$(".activitiFormContainer #ui-bizagi-webpart-render-container"),i=$(".ui-bizagi-button-container",".activitiFormContainer"),r=i.outerHeight()||0,a=bizagi.util.getQueryString().renderBehavior||"";if("PopUp"==(a=a.replace("#",""))){if(void 0===self.postMessageSocket){var n=$(".activitiFormContainer").height()-50||396;$("#render-canvas").height(n),$("#render-canvas").css("overflowY","scroll")}else $(".activitiFormContainer").height($(".activitiFormContainer").height()+$(".ui-bizagi-button-container").height()+30);$(".ui-bizagi-button-container").css("position","absolute"),$(".ui-bizagi-button-container").appendTo(".activitiFormContainer"),$(".ui-bizagi-button-container").length>1&&($(".ui-bizagi-button-container:first").hide(),t.css("marginTop","-17px"))}i.length>0&&t.height(e-97-r),0==$(".ui-bizagi-button-container").children().length?$("#render-canvas").height($("#render-canvas").height()+r):(i.width("100%"),i.css("marginLeft",0),i.css("bottom",0))}else"render"==bizagi.util.getQueryString().type&&($("html").css("overflowX","hidden"),$("#render").height()<=window.innerHeight+5?$("html").css("overflowY","hidden"):$("html").css("overflowY","scroll"),$(".ui-widget-overlay").height(650))},sendExecutingPostMessageWebparts:function(){bizagi&&bizagi.iframeCommunicator&&bizagi.iframeCommunicator.trigger("executing-rendering",{})}}),$.Class("bizagi.workportal.command.printform",{},{init:function(e){this.renderFactory=e},print:function(e){var t=this,i=$.extend({},e);$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PRINT,modalParameters:{title:bizagi.localization.getResource("render-actions-print"),refreshInbox:!1},params:i,referrer:bizagi.hasOwnProperty("referrerParams")&&bizagi.referrerParams.hasOwnProperty("referrer")?bizagi.referrerParams.referrer:"inboxGrid",buttons:[{text:bizagi.localization.getResource("workportal-widget-dialog-box-print"),click:function(){var e=$(this),r=t.renderFactory.getTemplate("print-frame"),a=t.renderFactory.getTemplate("print-frame-header"),n=function(){var t,n="printer-"+(new Date).getTime(),o=$.tmpl(r,{printID:n}),s=$.tmpl(a,{environment:bizagi.loader.environment,productBuild:bizagi.loader.productBuildToAbout,build:bizagi.loader.productBuild});if(i.fileName||(i.fileName=window.parent.document.title),o.appendTo($("body:first")),bizagi.util.isIE()){if(!(t=window.frames[n]))for(var l=0,d=window.frames.length;l<d;l++)if(window.frames[l]&&window.frames[l].name==n){t=window.frames[l];break}}else t=window.frames[n];var u=t.document||t.contentWindow.document;u.open();var c='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">';if(c+="<html style='overflow: visible !important'> <head> <title>"+i.fileName+"</title>",c+=s[0].innerHTML,c+="</head> <body class='bz-wp-widget-print bz-wp-widget-print-load' style='overflow: visible !important'>",c+=$(".bz-wp-widget-print").html(),c+="</body></html>",u.write(c),u.close(),$(".ui-bizagi-cell-readonly",u).css("maxHeight","100%"),bizagi.util.isIE()){var p=window.open("","","top=0,left=0,width=10,height=10");"<style>","html{background: #293f55; color: #fff; text-align: center;}","</style>";p.document.open(),p.document.write('<style>html{background: #293f55; color: #fff; text-align: center;}</style><div id="loading-emp" style="padding:10px auto; width:100%; text-align:center; font-family:Arial; font-size:12px;">'+bizagi.localization.getResource("webpart-render-loading")+"</div>"),p.document.close(),p.document.open(),p.document.write(c),p.document.close(),p.print();var h=setTimeout((function(){p.close(),clearTimeout(h)}),1e4)}else{t.focus();var g=window.parent.document.title;window.parent.document.title=i.fileName;var m=setTimeout((function(){t.print(),window.parent.document.title=g,clearTimeout(m)}),500)}var f=setTimeout((function(){o.remove(),clearTimeout(f)}),1e3);e.removeAttr("disabled")};if(e.attr("disabled","disabled"),0===$("#bz-wp-widget-print").length)var o=setTimeout((function(){n(),clearTimeout(o)}),1e3);else n()}}]})}}),bizagi.override.enableDeprecatedProperties=!0,bizagi.jqxhrList.intercept=!0,bizagi.override.changeEditabilityOnReadOnlyForms=!1;var renderInterface=function(){var e=this,t={isRequired:function(){return this.properties.required},getControl:function(){return this.control},getDisplayNameObj:function(){return this.getLabel()},getDisplayNameText:function(){return this.properties.displayName},getValue:function(){return this.value},getDisplayValueText:function(){return this.getDisplayValue()},getFocus:function(){return!!this.focus()},find:function(e){return this.getControl().find(e)},getType:function(){return this.properties.type},setControlValue:function(e){this.setValue(e)},setControlDisplayValue:function(e){this.setDisplayValue(e)}},i={getColumnByXpath:function(e){return void 0===e?{}:this.getColumn(e)},getColumnByName:function(e){var t={};return $.each(this.columns,(function(i,r){r.properties.displayName===e&&(t=r)})),t},getRecord:function(e){return $('[data-business-key="'+e+'"]',this.getControl())},getNewRows:function(){return $('[data-new-row="true"]',this.getControl())},getCell:function(e,t){var i=this.getControlCell(e,t);return i=renderInterface.extendControlInterface(i)},getGridButtonsPanel:function(){return $('[data-bizagi-component="buttons"]',this.getControl())},getGridPaginationPanel:function(){return $('[data-bizagi-component="pager"]',this.getControl())},getGridHeaderPanel:function(){return $('[data-bizagi-component="columns"]',this.getControl())}},r={getFiles:function(){var e=[];return this.files&&$.each(this.files,(function(t,i){e.push(i[1])})),e},hasFile:function(e){var t=this.getFiles(),i=!1;return t.length>0&&$.each(t,(function(t,r){r.indexOf(e)>=0&&(i=!0)})),i}},a={checkByName:function(e){var t=this.getControl(),i=$(".ui-bizagi-render-boolean-yesno label",t);$.each(i,(function(t,i){i&&$.trim($(i).text())==e&&i.click()}))},isChecked:function(e){var t=this.getControl(),i=$("label.ui-radio-state-checked",t),r=!1;return i.length>0&&$.each(i,(function(t,i){i&&$.trim($(i).text())==e&&(r=!0)})),r}},n={getComboArrow:function(){return $(".ui-selectmenu-btn",this.getControl())},getComboOptions:function(){return $(".ui-select-dropdown ul",this.getControl().parent())}};return e._getInterface=function(e){var o;switch(e){case"generic":o=t;break;case"grid":o=i;break;case"upload":o=r;break;case"boolean":o=a;break;case"combo":o=n}return o},e._getExtendedInterfaceByControl=function(t){var i,r=function(e,t){return t.length>0&&$.each(t,(function(t,i){"object"===_typeof(i)&&$.each(i,(function(t,i){e[t]=i}))})),e};switch(void 0!==t&&t.properties&&t.properties.type?t.properties.type:""){case"grid":i=r(t,[e._getInterface("generic"),e._getInterface("grid")]);break;case"upload":case"columnUpload":i=r(t,[e._getInterface("generic"),e._getInterface("upload")]);break;case"boolean":case"columnBoolean":i=r(t,[e._getInterface("generic"),e._getInterface("boolean")]);break;case"combo":case"columnCombo":i=r(t,[e._getInterface("generic"),e._getInterface("combo")]);break;default:i=r(t,[e._getInterface("generic")])}return i},e._extendControlInterface=function(t){var i;if(t)return t.length&&t.length>1?(i=[],$.each(t,(function(t,r){i.push(e._getExtendedInterfaceByControl(r))}))):i=t.length&&1==t.length?e._getExtendedInterfaceByControl(t[0]):e._getExtendedInterfaceByControl(t),"function"==typeof i.focus&&i.focus(),i},{getInterface:e._getInterface,extendControlInterface:e._extendControlInterface}}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.e2e=function(){var e=this,t=!1,i=function(){t||(e.form=bizagi.rendering.facade.form,e.formReady=bizagi.rendering.facade.executionDeferred.promise(),e.form||$.when(e.formReady).done((function(t){e.form=t})).fail((function(e){console.log("Error: "+e.toString())})))};return bizagi.rendering.dialog.form.extend("bizagi.rendering.dialog.form",{},{renderDialogBox:function(i,r){$.when(this._super(i,r)).done((function(i){t=!0,e.form=i}))},closeDialogBox:function(){t=!1,this._super()}}),bizagi.rendering.searchForm.extend("bizagi.rendering.searchForm",{},{configureHandlers:function(i){$.when(this._super(i)).done((function(i){t=!0,e.form=i.getFormContainer()}))},closeDialogBox:function(){t=!1,this._super()}}),bizagi.rendering.dialog.search.extend("bizagi.rendering.dialog.search",{},{closeDialogBox:function(){t=!1,this._super()}}),e._getAllrenders=function(){return{rendersById:e.form.rendersById,rendersByXpath:e.form.rendersByXpath,rendersByType:e.form.rendersByType}},e._findRenderByProperty=function(t,i){var r=[],a=e._getAllrenders()||{};return t&&$.each(a.rendersById,(function(e,a){a.properties.hasOwnProperty(t)&&a.properties[t]==i&&r.push(a)})),r},e.getRenderById=function(t){return i(),t=t||"",renderInterface.extendControlInterface(e.form.getRenderById(t))},e.getRenderByType=function(t){return i(),t=t||"",renderInterface.extendControlInterface(e.form.getRenderByType(t))},e.getRenderByXpath=function(t){return i(),t=t||"",renderInterface.extendControlInterface(e.form.getRender(t))},e.getRenderByDisplayName=function(t){return i(),renderInterface.extendControlInterface(e._findRenderByProperty("displayName",t))},e.getRenderByValue=function(t){return i(),renderInterface.extendControlInterface(e._findRenderByProperty("value",t))},e.getNotificationPanel=function(){return i(),{getMessages:e=function(){var e=[],t=$(".ui-bizagi-notification-item",$(".ui-bizagi-notifications-container-bottom .ui-bizagi-notifications-content"));return t.length>0&&$.each(t,(function(t,i){e.push($.trim($(i).find("label").text()))})),e},hasMessage:function(t){var i=e(),r=!1;return""!==t&&i.length>0&&$.each(i,(function(e,i){i.indexOf(t)>=0&&(r=!0)})),r}};var e},e.getFormButtonByCaption=function(t){i();var r=e.form.getButtons(),a=$("<button>");return $.each(r,(function(e,i){i.value===t&&(a=i)})),a},e.getFormButtons=function(){return i(),e.form.getButtons()},e.ready=function(){return"resolved"===bizagi.rendering.facade.executionDeferred.state()},{getRenderById:e.getRenderById,getRenderByType:e.getRenderByType,getRenderByXpath:e.getRenderByXpath,getRenderByDisplayName:e.getRenderByDisplayName,getRenderByValue:e.getRenderByValue,getNotificationPanel:e.getNotificationPanel(),getFormButtonByCaption:e.getFormButtonByCaption,getFormButtons:e.getFormButtons,ready:e.ready}}(),bizagi.rendering.desktop.search.extend("bizagi.rendering.desktop.querySuggest",{},{getData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.getFormContainer(),n=a.getContextType()||a.params.contexttype||!1;if(e=e||{},t.properties.contexttype?e.h_contexttype=t.properties.contexttype:n&&(e.h_contexttype=n),e&&e.h_contexttype&&"metadata"===e.h_contexttype&&(i.xpathContext=""),i.term.indexOf("'")>-1){var o=new RegExp("'","g");i.term=i.term.replace(o,"\\'\\'")}if(i.term.indexOf('"')>-1){o=new RegExp('"',"g");i.term=i.term.replace(o,'"')}return t.dataService.multiaction().getSearchData({url:i.dataUrl,contexttype:"metadata",xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.allowFullSearch?"%"+i.term:i.term,extra:e}).done((function(e){i.data=e,r.resolve(i.data)})).fail((function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)})),r.promise(r)},renderClearItem:function(){var e=this,t=e.renderSearchItem({id:e.Class.CLEAR_SEARCH_ID,label:this.getResource("render-search-clear-label")});return t.click((function(){e.setValue({id:""}),e.setDisplayValue("")})),t}}),bizagi.rendering.desktop.extendedText.extend("bizagi.rendering.desktop.queryExtendedText",{},{}),bizagi.rendering.desktop.text.extend("bizagi.rendering.desktop.queryText",{},{}),bizagi.rendering.desktop.check.extend("bizagi.rendering.desktop.queryCheck",{},{getValue:function(){return bizagi.util.parseBoolean(this.value)}}),bizagi.rendering.desktop.yesno.extend("bizagi.rendering.desktop.queryYesNo",{},{getValue:function(){return bizagi.util.parseBoolean(this.value)}}),bizagi.rendering.desktop.search.extend("bizagi.rendering.desktop.querySearch",{},{showSearchDialog:function(){var e,t=this,i=t.properties,r=i.searchForms.length>0&&"searchForm"==i.searchForms[0].type?"metadata":"entity";i.allowNew&&(e=t.showAddRecordDialog()),t.searchDialog=new bizagi.rendering.dialog.search(t.dataService,t.renderFactory,i.searchForms,{allowFullSearch:i.allowFullSearch,maxRecords:i.maxRecords},e),t.searchDialog.render({idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:r}).done((function(e){data={id:e.id,value:e.id},t.setDisplayValue(data),t.setValue(data)}))}}),bizagi.rendering.desktop.form.extend("bizagi.rendering.desktop.queryForm",{},{postRenderContainer:function(e){var t=this.container.find(".ui-bizagi-render-control-included-all");this._super(e),this.container.find(".ui-bizagi-render-control-included").length<=0&&t.parent().hide()},collectRenderValuesForSubmit:function(e){var t=this,i=[];return t.collectRenderValuesQueryForm(i),$.each(i,(function(e,i){var r=t.getRenders(i.xpath),a=function(e,t){return e.filter((function(e){return bizagi.util.tryCatch((function(){return i=e.properties.rangeQuery,r=t.searchType,i.toUpperCase()===r.toUpperCase();var i,r}),!0)}))}(r,i);0===a.length&&(a=r),i.displayHeader=a[0].properties.xpath.indexOf("@")>-1?a[0].properties.xpath:null,$.each(a,(function(e,t){t.updateOriginalValue()}))})),e.parameters=i,e},getSearchParams:function(e){var t=this.getValidationsContainer();return this.validationController=new bizagi.command.controllers.validation(this,this.validations,t),this.validationController.performValidations()?this.collectRenderValuesForSubmit(e):(this.validationController.expandNotificationBox(),null)},configureHandlers:function(){var e=this;e._super();var t=e.container.find(".ui-bizagi-render-control-included-all");t.tooltip({position:{my:"right-20 center",at:"right center"},tooltipClass:"bz-wp-queryForm-check-all"}),t.change((function(){var i=t.is(":checked");!function t(r){$.each(r.children,(function(r,a){a.element?e.isControlVisible(a)&&!0===a.properties.includedInResult&&(a.properties.included=i,a.element.find(".ui-bizagi-render-control-included").prop("checked",i)):a.children&&t(a)}))}(e)}))},isControlVisible:function(e){return e.parent?!!e.properties.visible&&this.isControlVisible(e.parent):e.properties.visible}}),bizagi.rendering.desktop.form.extend("bizagi.rendering.desktop.formTemplate",bizagi.rendering.formTemplate.prototype),bizagi.rendering.desktop.formTemplate.extend("bizagi.rendering.desktop.formTemplate",{},{}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.queryTextAdvanced",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.queryTextAdvanced.extend("bizagi.rendering.desktop.queryTextAdvanced",bizagi.rendering.queryAdvanced.prototype),bizagi.rendering.desktop.queryTextAdvanced.extend("bizagi.rendering.desktop.queryTextAdvanced",{DATATYPE:"Text",TOOLTIP_TITLE:"Use the (%) percent to get accurate results related to your keyword. e.g:",TOOLTIP_CONTENT:"<br/>&#9679; %ABC if the keyword ends with ABC.</br>&#9679; AB%C if the keyword starts with AB and ends with C.<br/>&#9679; ABC% if the keyword starts with ABC."},{initializeData:function(e){this.maxLength=e.properties.maxLength,e.properties.maxLength=0,this.defaultFilter="wildcard",this._super(e),this.isNewRenderForm=!0},postRender:function(){var e=this.properties.filterType||"";this._super(),this.setFilter(e)},setValue:function(e,t){t=void 0===t||t,e=Array.isArray(e)?JSON.encode(e):e,this._super(e,t)},prepareForSetValue:function(){var e=this.getCurrentFilter(),t=bizagi.util.isEmpty(e)?this.defaultFilter:e.id;this.setFilter(t)},setDisplayValue:function(e){var t=this.getControl();this.properties.editable&&this.prepareForSetValue();var i=this.getCurrentAction(),r=this.performDataValue(e);if(this.setValue(r,!1),this.isExecutionMode()?this.showHideCleanButton(!0):this.controlInitial&&this.controlInitial.setDisplayValue(e),this.isCurrentTagFilter())this.addSelectedElements();else if(["wildcard","like","starts-with","ends-with"].includes(i)){if(e&&$.trim(e).length>0)if(this.controlInitial&&this.controlInitial.setDisplayValue(r),this.isCurrentWildcardFilter())t.find(".bz-query-advanced").data("mode-wildcard",!0)}},configureHandlers:function(){this._super(),this.configureWildcardHandlers()},configureWildcardHandlers:function(){var e=this,t=e.getControl(),i=e.renderFactory.getTemplate("query.advanced-tooltip"),r=$.tmpl(i,{title:bizagi.localization.getResource("workportal-widget-filter-wildcard-tooltip-title",e.Class.TOOLTIP_TITLE),content:bizagi.localization.getResource("workportal-widget-filter-wildcard-tooltip-content",e.Class.TOOLTIP_CONTENT)});t.on("keyup",".bz-query-advanced__input",(function(){if(!e.filterOptionIsShowed()){var i,a=t.find(".bz-query-advanced"),n=$(".bz-query-advanced__clean",a);$.trim(this.value).length>0?(a.data("mode-wildcard",!0),i=n.hasClass("bz-hidden"),e.setCurrentFilter({id:"wildcard"}),e.closeFloatView()):(a.data("mode-wildcard",!1),n.addClass("bz-hidden"),i=!n.hasClass("bz-hidden"),e.setCurrentFilter({id:""})),i&&e.showHideCleanButton(!0),e.isCurrentWildcardFilter()&&e.showTooltip(a,r.html())}}))},showTooltip:function(e,t){e.attr("title",t),void 0===e.data("tooltip")&&e.tooltip({tooltipClass:"bz-query-advanced__wildcard-tooltip",position:{my:"left bottom",at:"left top"},content:function(){var e=$(this)[0];if(e&&e.title){var t=e.title;return e.title="",t}}}),e.tooltip("open")},renderElement:function(){return this._super("render-base")},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeCellRequired:function(e){this.changeRequired(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},getValue:function(){return this.isCurrentTagFilter()?this.performTagItems():this.isCurrentNullFilter()?null:this.controlInitial?this.controlInitial.getValue():""},getLabel:function(){return $("label",this._super())},cleanDataFilter:function(e){var t=$(".bz-query-advanced",this.getControl());t.data("ui-tooltip")&&(t.tooltip("destroy"),t.removeAttr("title")),t.data("mode-wildcard",!1),this._super(e)},defineLiteControl:function(e){var t=e&&e.typeFilter||"advanced",i=new bizagi.rendering.desktop.textAdvanced(this.getRenderProperties({typeControl:t,isRange:this.isCurrentBetweenFilter()}));this.setLiteControls(i,null)},setLiteControls:function(e,t){var i=this.getControl(),r=this.getCurrentFilter(),a=r&&r.action||"default";this.controlInitial=e||null,this.controlEnd=t||null;var n=this.renderFactory.getTemplate("query.advanced-content"),o=$.tmpl(n,{value:this.getResourceByKey(r.label,r.defaultLabel),id:r.id,filterType:a}),s=$(".bz-query-advanced__filter",i).empty();s.append(o);var l=$(".bz-query-advanced__filter-input",s);this.renderLiteControl(a,l,e)},renderLiteControl:function(e,t,i){var r=this;$.when(i.render(this.getTemplateByType(e))).done((function(e){t.empty().append(e);var a=r.getCurrentAction(),n=$(".bz-query-advanced__input",t);n.attr("data-action",a),r.isCurrentNullFilter()&&n.attr("readonly",!0),i.postRenderElement(t,!0),r.isCurrentTagFilter()||r.configureInternalHandlers(i)}))},getTemplateByType:function(e){return["between","tags"].includes(e)?"query.advanced-text":"query.advanced-input"},configureInternalHandlers:function(e){var t=this;e.getInputControl().bind("updateData",(function(e,i){t.setValue(t.getValue())}))},getRequiredProperties:function(){return{maxLength:this.maxLength}}}),bizagi.rendering.desktop.text.extend("bizagi.rendering.desktop.textAdvanced",{},{getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=$(this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},setValue:function(e){e=e||"",this._super(e);var t=this.getInputControl();t&&t.trigger("updateData",{data:e})},getInputControl:function(){return $("input",this.getControl())||null}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.queryNumberAdvanced",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.queryNumberAdvanced.extend("bizagi.rendering.desktop.queryNumberAdvanced",bizagi.rendering.queryAdvanced.prototype),bizagi.rendering.desktop.queryNumberAdvanced.extend("bizagi.rendering.desktop.queryNumberAdvanced",{DATATYPE:"Number"},{initializeData:function(e){this._super(e),this.isNewRenderForm=!0,this.defaultFilter="default";var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.setGroupDigits(),t.colorize=t.colorizeOnNegative||!1,t.minValue=t.minValue||null,t.maxValue=t.maxValue||null,t.dataType=t.dataType||1},postRender:function(){var e=this.properties.filterType||"";this._super(),this.setFilter(e)},setValue:function(e,t){t=void 0===t||t,e=Array.isArray(e)?JSON.encode(e):e,this._super(e,t)},setDisplayValue:function(e){this.properties.editable&&this.prepareForSetValue();var t=this.getCurrentAction(),i=this.performDataValue(e);if(this.setValue(i,!1),this.isExecutionMode()&&t!==this.defaultFilter?this.showHideCleanButton(!0):this.controlInitial&&this.controlInitial.setDisplayValue(e),this.isCurrentTagFilter())this.addSelectedElements();else if(["to","from"].includes(t))this.controlInitial&&this.controlInitial.setDisplayValue(i);else if(e&&["between"].includes(t)){var r=this.performListValue(e);r&&r.from&&this.controlInitial&&this.controlInitial.setDisplayValue(r.from),r&&r.to&&this.controlEnd&&this.controlEnd.setDisplayValue(r.to)}},renderElement:function(){return this._super("render-base")},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeCellRequired:function(e){this.changeRequired(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},getValue:function(){if(this.isCurrentTagFilter())return this.performTagItems();if(this.isCurrentBetweenFilter()){var e=this.controlInitial?this.formatInputValue(this.controlInitial.getValue()):"null",t=this.controlEnd?this.formatInputValue(this.controlEnd.getValue()):"null",i=[e,t];return"null"===e&&"null"===t?"":JSON.encode(i)}return this.isCurrentNullFilter()?null:this.controlInitial?this.controlInitial.getValue():""},getValidTagValue:function(e){return this.controlInitial&&this.controlInitial.numericInput.asNumber()||$.trim(e)},setGroupDigits:function(){return void 0!==this.properties.thousands?!!this.properties.digitGroupSymbol&&bizagi.util.parseBoolean(this.properties.thousands):!!this.properties.digitGroupSymbol&&this.getDefaultGroupDigits(this.properties.dataType)},getDefaultAllowDecimals:function(e){if(e){if([1,2,3,4,7].includes(e))return!1;if([6,8,10,11].includes(e))return!0}return!1},getDefaultGroupDigits:function(e){if(e){if([1,2,3,4,7].includes(e))return!1;if([6,8,10,11].includes(e))return!0}return!1},getLabel:function(){return $("label",this._super())},defineLiteControl:function(e){var t=e&&e.typeFilter||"advanced",i=null,r=new bizagi.rendering.desktop.numberAdvanced(this.getRenderProperties({typeControl:t,isRange:this.isCurrentBetweenFilter(),isMinimum:!0}));this.isCurrentBetweenFilter()&&(i=new bizagi.rendering.desktop.numberAdvanced(this.getRenderProperties({typeControl:t+"_max",isRange:this.isCurrentBetweenFilter(),isMaximum:!0})),r.subscribe(i),i.subscribe(r)),this.setLiteControls(r,i)},setLiteControls:function(e,t){var i=this.getControl(),r=this.getCurrentFilter(),a=r&&r.action||"default";this.controlInitial=e||null,this.controlEnd=t||null;var n=this.renderFactory.getTemplate("query.advanced-content"),o=$.tmpl(n,{value:this.getResourceByKey(r.label,r.defaultLabel),id:r.id,filterType:a}),s=$(".bz-query-advanced__filter",i).empty();if(this.isCurrentBetweenFilter()){s.append(o);var l=$(".bz-query-advanced__filter-input-from",s),d=$(".bz-query-advanced__filter-input-to",s);this.renderLiteControl(a,l,e),this.renderLiteControl(a,d,t)}else{s.append(o);var u=$(".bz-query-advanced__filter-input",s);this.renderLiteControl(a,u,e)}},renderLiteControl:function(e,t,i){var r=this;$.when(i.render(this.getTemplateByType(e))).done((function(e){t.empty().append(e);var a=r.getCurrentAction(),n=$(".bz-query-advanced__input",t);n.attr("data-action",a),r.isCurrentNullFilter()&&n.attr("readonly",!0),i.postRenderElement(t,!0),r.isCurrentTagFilter()||r.configureInternalHandlers(i)}))},getTemplateByType:function(e){return["between","tags"].includes(e)?"query.advanced-text":"query.advanced-input"},configureInternalHandlers:function(e){var t=this;e.getInputControl().bind("updateData",(function(e,i){t.setValue(t.getValue())}))},getRequiredProperties:function(){var e=this.properties;return{allowDecimals:e.allowDecimals,numDecimals:e.numDecimals,symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,colorize:e.colorize,minValue:e.minValue,maxValue:e.maxValue,dataType:e.dataType,percentage:e.percentage}},addTag:function(e){var t=this.controlInitial;if(t){var i=t.numericInput;if(t.formatNumericInput(i[0]),bizagi.util.isEmpty(t.getValue()))return;e.value=t.getValue()||"",e.displayValue=i.val()||""}this._super(e)},formatTagItem:function(e){var t=this.properties,i={symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize};return bizagi.util.formatDecimal(e,i)},changeMinValue:function(e){if(this.controlInitial){var t=this.controlInitial.performMinValue(e);this.properties.minValue=this.properties.dataTypeMinValue=t,this.controlInitial.changeMinValue(e),this.controlEnd&&this.controlInitial&&this.controlEnd.changeMinValue(e)}},changeMaxValue:function(e){if(this.controlInitial){var t=this.controlInitial.performMaxValue(e);this.properties.maxValue=this.properties.dataTypeMaxValue=t,this.controlEnd&&this.controlInitial?this.controlEnd.changeMaxValue(e):this.controlInitial.changeMaxValue(e)}},changeColor:function(e){var t=this.getControl();return this.controlInitial&&this.controlInitial.changeColor(e,!0),this.controlEnd&&this.controlEnd.changeColor(e,!0),this._super(e).changeFontColor($("label",t),e)},getElementsToStylize:function(e){return this._super(e)}}),bizagi.rendering.desktop.number.extend("bizagi.rendering.desktop.numberAdvanced",{},{getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=$(this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},subscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){if(this.properties.isRange)for(var t=this.observer.length-1;t>=0;t--)this.properties.isMaximumValue?(e=bizagi.util.isNumeric(e)?e:this.properties.maxValue||this.calculateMaxValue(this.properties.dataType),this.observer[t].changeMaxValue(e)):this.properties.isMinimumValue&&(e=bizagi.util.isNumeric(e)?e:this.properties.minValue||this.calculateMinValue(this.properties.dataType),this.observer[t].changeMinValue(e))},setValue:function(e){this._super(e),this.notify(e);var t=this.getInputControl();t&&t.trigger("updateData",{data:e})},getInputControl:function(){return $("input",this.getControl())||null}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.queryMoneyAdvanced",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.queryMoneyAdvanced.extend("bizagi.rendering.desktop.queryMoneyAdvanced",bizagi.rendering.queryAdvanced.prototype),bizagi.rendering.desktop.queryMoneyAdvanced.extend("bizagi.rendering.desktop.queryMoneyAdvanced",{DATATYPE:"Currency"},{initializeData:function(e){this._super(e),this.isNewRenderForm=!0,this.defaultFilter="default";var t=this.properties,i=this.getResource("numericFormat");if(t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.setGroupDigits(),t.colorize=t.colorizeOnNegative||!1,t.minValue=t.minValue||null,t.maxValue=t.maxValue||null,t.dataType=t.dataType||6,t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol){var r="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol;t.symbol=t.currencySymbol?t.currencySymbol:r}else t.symbol="";t.groupDigits=!0},postRender:function(){var e=this.properties.filterType||"";this._super(),this.setFilter(e)},setValue:function(e,t){t=void 0===t||t,e=Array.isArray(e)?JSON.encode(e):e,this._super(e,t)},setDisplayValue:function(e){this.properties.editable&&this.prepareForSetValue();var t=this.getCurrentAction(),i=this.performDataValue(e);if(this.setValue(i,!1),this.isExecutionMode()&&t!==this.defaultFilter?this.showHideCleanButton(!0):this.controlInitial&&this.controlInitial.setDisplayValue(e),this.isCurrentTagFilter())this.addSelectedElements();else if(["to","from"].includes(t))this.controlInitial&&this.controlInitial.setDisplayValue(i);else if(e&&["between"].includes(t)){var r=this.performListValue(e);r&&r.from&&this.controlInitial&&this.controlInitial.setDisplayValue(r.from),r&&r.to&&this.controlEnd&&this.controlEnd.setDisplayValue(r.to)}},renderElement:function(){return this._super("render-base")},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeCellRequired:function(e){this.changeRequired(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},getValue:function(){if(this.isCurrentTagFilter())return this.performTagItems();if(this.isCurrentBetweenFilter()){var e=this.controlInitial?this.formatInputValue(this.controlInitial.getValue()):"null",t=this.controlEnd?this.formatInputValue(this.controlEnd.getValue()):"null",i=[e,t];return"null"===e&&"null"===t?"":JSON.encode(i)}return this.isCurrentNullFilter()?null:this.controlInitial?this.controlInitial.getValue():""},getValidTagValue:function(e){return this.controlInitial&&this.controlInitial.numericInput.asNumber()||$.trim(e)},setGroupDigits:function(){return void 0!==this.properties.thousands?!!this.properties.digitGroupSymbol&&bizagi.util.parseBoolean(this.properties.thousands):!!this.properties.digitGroupSymbol&&this.getDefaultGroupDigits(this.properties.dataType)},getDefaultAllowDecimals:function(e){if(e){if([1,2,3,4,7].includes(e))return!1;if([6,8,10,11].includes(e))return!0}return!1},getDefaultGroupDigits:function(e){if(e){if([1,2,3,4,7].includes(e))return!1;if([6,8,10,11].includes(e))return!0}return!1},getLabel:function(){return $("label",this._super())},defineLiteControl:function(e){var t=e&&e.typeFilter||"advanced",i=null,r=new bizagi.rendering.desktop.moneyAdvanced(this.getRenderProperties({typeControl:t,isRange:this.isCurrentBetweenFilter(),isMinimum:!0}));this.isCurrentBetweenFilter()&&(i=new bizagi.rendering.desktop.moneyAdvanced(this.getRenderProperties({typeControl:t+"_max",isRange:this.isCurrentBetweenFilter(),isMaximum:!0})),r.subscribe(i),i.subscribe(r)),this.setLiteControls(r,i)},setLiteControls:function(e,t){var i=this.getControl(),r=this.getCurrentFilter(),a=r&&r.action||"default";this.controlInitial=e||null,this.controlEnd=t||null;var n=this.renderFactory.getTemplate("query.advanced-content"),o=$.tmpl(n,{value:this.getResourceByKey(r.label,r.defaultLabel),id:r.id,filterType:a}),s=$(".bz-query-advanced__filter",i).empty();if(this.isCurrentBetweenFilter()){s.append(o);var l=$(".bz-query-advanced__filter-input-from",s),d=$(".bz-query-advanced__filter-input-to",s);this.renderLiteControl(a,l,e),this.renderLiteControl(a,d,t)}else{s.append(o);var u=$(".bz-query-advanced__filter-input",s);this.renderLiteControl(a,u,e)}},renderLiteControl:function(e,t,i){var r=this;$.when(i.render(this.getTemplateByType(e))).done((function(e){t.empty().append(e);var a=r.getCurrentAction(),n=$(".bz-query-advanced__input",t);n.attr("data-action",a),r.isCurrentNullFilter()&&n.attr("readonly",!0),i.postRenderElement(t,!0),r.isCurrentTagFilter()||r.configureInternalHandlers(i)}))},getTemplateByType:function(e){return["between","tags"].includes(e)?"query.advanced-text":"query.advanced-input"},configureInternalHandlers:function(e){var t=this;e.getInputControl().bind("updateData",(function(e,i){t.setValue(t.getValue())}))},getRequiredProperties:function(){var e=this.properties;return{allowDecimals:e.allowDecimals,numDecimals:e.numDecimals,symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,colorize:e.colorize,minValue:e.minValue,maxValue:e.maxValue,dataType:e.dataType}},addTag:function(e){var t=this.controlInitial;if(t){var i=t.numericInput;t.formatNumericInput(i[0]),e.value=t.getValue()||"",e.displayValue=i.val()||""}this._super(e)},formatTagItem:function(e){var t=this.properties,i={symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize};return bizagi.util.formatDecimal(e,i)},changeMinValue:function(e){if(this.controlInitial){var t=this.controlInitial.performMinValue(e);this.properties.minValue=this.properties.dataTypeMinValue=t,this.controlInitial.changeMinValue(e),this.controlEnd&&this.controlInitial&&this.controlEnd.changeMinValue(e)}},changeMaxValue:function(e){if(this.controlInitial){var t=this.controlInitial.performMaxValue(e);this.properties.maxValue=this.properties.dataTypeMaxValue=t,this.controlEnd&&this.controlInitial?this.controlEnd.changeMaxValue(e):this.controlInitial.changeMaxValue(e)}},changeColor:function(e){var t=this.getControl();return this.controlInitial&&this.controlInitial.changeColor(e,!0),this.controlEnd&&this.controlEnd.changeColor(e,!0),this._super(e).changeFontColor($("label",t),e)},getElementsToStylize:function(e){return this._super(e)}}),bizagi.rendering.desktop.money.extend("bizagi.rendering.desktop.moneyAdvanced",{},{getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=$(this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},subscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){if(this.properties.isRange)for(var t=this.observer.length-1;t>=0;t--)this.properties.isMaximumValue?(e=bizagi.util.isNumeric(e)?e:this.properties.maxValue||this.calculateMaxValue(this.properties.dataType),this.observer[t].changeMaxValue(e)):this.properties.isMinimumValue&&(e=bizagi.util.isNumeric(e)?e:this.properties.minValue||this.calculateMinValue(this.properties.dataType),this.observer[t].changeMinValue(e))},setValue:function(e){this._super(e),this.notify(e);var t=this.getInputControl();t&&t.trigger("updateData",{data:e})},getInputControl:function(){return $("input",this.getControl())||null}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.queryDateAdvanced",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.queryDateAdvanced.extend("bizagi.rendering.desktop.queryDateAdvanced",bizagi.rendering.queryAdvanced.prototype),bizagi.rendering.desktop.queryDateAdvanced.extend("bizagi.rendering.desktop.queryDateAdvanced",{DATATYPE:"DateTime"},{initializeData:function(e){this._super(e),this.isNewRenderForm=!0,this.defaultFilter=this.isExecutionMode()?"equal":"";var t=this.properties,i=this.getResource("dateFormat"),r=this.getResource("timeFormat");t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||i,t.timeFormat=t.timeFormat||r,t.fullFormat=t.dateFormat;var a=parseInt((new Date).getFullYear()+200).toString(),n=parseInt((new Date).getFullYear()-200).toString();void 0===t.maxValue&&(t.maxValue="12/31/"+a+" 00:00:00"),void 0===t.minValue&&(t.minValue="01/01/"+n+" 00:00:00"),t.value&&(this.value=t.value)},postRender:function(){var e=this.properties.filterType||"";this._super(),this.setFilter(e)},setValue:function(e,t){t=void 0===t||t,e=Array.isArray(e)?JSON.encode(e):e,this._super(e,t)},setDisplayValue:function(e){this.properties.editable&&this.prepareForSetValue();var t=this.getCurrentAction();if(this.setValue(e,!1),this.isExecutionMode()?this.showHideCleanButton(!0):this.controlInitial&&this.controlInitial.setDisplayValue(e),e&&["to","from","equal"].includes(t))this.controlInitial&&this.controlInitial.setDisplayValue(e);else if(e&&["between"].includes(t)){var i=this.performListValue(e);i.from&&this.controlInitial&&this.controlInitial.setDisplayValue(i.from),i.to&&this.controlEnd&&this.controlEnd.setDisplayValue(i.to)}},renderElement:function(){return this._super("render-base")},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeCellRequired:function(e){this.changeRequired(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},getValue:function(){if(this.isCurrentBetweenFilter()){var e=this.controlInitial?this.formatInputValue(this.controlInitial.getValue()):"null",t=this.controlEnd?this.formatInputValue(this.controlEnd.getValue()):"null",i=[e,t];return"null"===e&&"null"===t?"":JSON.encode(i)}return this.isCurrentNullFilter()?null:this.controlInitial?this.controlInitial.getValue():""},getLabel:function(){return $("label",this._super())},defineLiteControl:function(e){var t=e&&e.typeFilter||"advanced",i=null,r=new bizagi.rendering.desktop.dateAdvanced(this.getRenderProperties({typeControl:t,isRange:this.isCurrentBetweenFilter(),isMinimum:!0}));this.isCurrentBetweenFilter()&&(i=new bizagi.rendering.desktop.dateAdvanced(this.getRenderProperties({typeControl:t+"_to",isRange:this.isCurrentBetweenFilter(),isMaximum:!0})),r.subscribe(i),i.subscribe(r)),this.setLiteControls(r,i)},setLiteControls:function(e,t){var i=this.getControl(),r=this.getCurrentFilter(),a=r&&r.action||"default";this.controlInitial=e||null,this.controlEnd=t||null;var n=this.renderFactory.getTemplate("query.advanced-content"),o=$.tmpl(n,{value:this.getResourceByKey(r.label,r.defaultLabel),id:r.id,filterType:a}),s=$(".bz-query-advanced__filter",i).empty();if(this.isCurrentBetweenFilter()){s.append(o);var l=$(".bz-query-advanced__filter-input-from",s),d=$(".bz-query-advanced__filter-input-to",s);this.renderLiteControl(a,l,this.controlInitial),this.renderLiteControl(a,d,this.controlEnd)}else{s.append(o);var u=$(".bz-query-advanced__filter-input",s);this.renderLiteControl(a,u,e)}},renderLiteControl:function(e,t,i){var r=this;$.when(i.render(this.getTemplateByType(e))).done((function(a){t.empty().append(a);var n=$(".bz-query-advanced__input, .bz-input-icon__input",t);(r.isCurrentNullFilter()||"default"===e)&&n.attr("readonly",!0),i.postRenderElement(t,!0),r.configureInternalHandlers(i),"default"!==e||r.isDesignMode()||i.disablePopup()}))},getTemplateByType:function(e){return"is-null"===e?"query.advanced-input":"query.advanced-date"},configureInternalHandlers:function(e){var t=this;e.getDateControl().bind("change",(function(){t.setValue(t.getValue())}))},getRequiredProperties:function(){var e=this.properties;return{showTime:!1,minValue:e.minValue,maxValue:e.maxValue,dateFormat:e.dateFormat,timeFormat:e.timeFormat,fullFormat:e.fullFormat}},getNormalizeDate:function(e){return 0!=e&&null!=e&&(this.properties.showTime?e.setMilliseconds(0):e.setHours(0,0,0,0)),e},changeMinValue:function(e){var t=this.properties,i=bizagi.util.dateFormatter;"number"==typeof e?e=i.formatInvariant(this.getNormalizeDate(new Date(e)),t.showTime):(e=this.getNormalizeDate("object"===_typeof(e)?e:i.getDateFromInvariant(e,t.showTime)),e=i.formatInvariant(e)),t.minValue=e,this.controlInitial&&this.controlInitial.changeMinValue(e),this.controlEnd&&this.controlEnd.changeMinValue(e)},changeMaxValue:function(e){var t=this.properties,i=bizagi.util.dateFormatter;"number"==typeof e?e=i.formatInvariant(this.getNormalizeDate(new Date(e)),t.showTime):(e=this.getNormalizeDate("object"===_typeof(e)?e:i.getDateFromInvariant(e,t.showTime)),e=i.formatInvariant(e)),t.maxValue=e,this.controlInitial&&this.controlInitial.changeMaxValue(e),this.controlEnd&&this.controlEnd.changeMaxValue(e)},changeColor:function(e){var t=this.getControl();return this.controlInitial&&this.controlInitial.changeColor(e,!0),this.controlEnd&&this.controlEnd.changeColor(e,!0),this._super(e).changeFontColor($("label",t),e)}}),bizagi.rendering.desktop.date.extend("bizagi.rendering.desktop.dateAdvanced",{},{getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=$(this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},subscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){if(this.properties.isRange)for(var t=this.observer.length-1;t>=0;t--)this.properties.isMaximumValue?this.observer[t].changeMaxValue(e):this.properties.isMinimumValue&&this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)},getInputControl:function(){return $("input",this.getControl())||null}}),$.Class.extend("bizagi.rendering.comboSelected",{},{init:function(e){this._super(e),this.leftValues=this.filterData(),this.rightValues=JSON.parse(JSON.stringify(this.properties.value))},renderControl:function(){var e=this.renderFactory.getTemplate("render-comboSelected");return $.fasttmpl(e,{dataList:this.leftValues})},orderArraySelected:function(e){return e.sort((function(e,t){var i=void 0===e.value||null===e.value?"":e.value.toString().toLowerCase(),r=void 0===t.value||null===t.value?"":t.value.toString().toLowerCase();return i<r?-1:i>r?1:0}))},filterData:function(){var e=this,t=[];return e.properties.data&&$.each(e.properties.data,(function(i,r){$.grep(e.properties.value,(function(t,i){return"Organizations"==e.properties.xpath?t.id==r.id:t.id===r.id})).length||t.push(r)})),t},renderControlReadOnly:function(){var e=this.renderFactory.getTemplate("render-comboSelectedReadOnly");return $.fasttmpl(e,{})}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.comboSelected",bizagi.rendering.comboSelected.prototype),bizagi.rendering.desktop.comboSelected.extend("bizagi.rendering.desktop.comboSelected",{},{postRender:function(){this._super();var e=this.getControl();this.showInitialData(this.properties.value),this.selectedItemsToUpdate.length>=0&&$.each(this.selectedItemsToUpdate,(function(t,i){$("#listBoxComboData",e).append("<option value='"+i.id+"'>"+i.value+" </option>")})),$(e).closest(".ui-bizagi-render-control").addClass("ui-bizagi-render-comboselected")},orderArrayList:function(){var e=this.properties.value.sort((function(e,t){var i=void 0!==e.value&&null!==e.value?e.value.toLowerCase():"",r=void 0!==t.value&&null!==t.value?t.value.toLowerCase():"";return i<r?-1:i>r?1:0}));this.properties.value=e},configureHandlers:function(){var e=this,t=e.getControl();$("#move_right",t).click((function(i){e.addItem();var r=$("#bz-render-comboSelected-listBoxResults .ui-bizagi-render-text",t);e.filterFunction(r.val(),e.rightValues,$("#bz-render-comboSelected-listBoxResults select",t)),r.focus()})),$("#move_left",t).click((function(i){e.removeItem();var r=$("#bz-render-comboSelected-selectOptions .ui-bizagi-render-text",t);e.filterFunction(r.val(),e.leftValues,$("#bz-render-comboSelected-selectOptions select",t)),r.focus()})),$("#bz-render-comboSelected-selectOptions .ui-bizagi-render-text",t).bind("keyup input",(function(i){e.filterFunction(this.value,e.leftValues,$("#bz-render-comboSelected-selectOptions select",t))})),$("#bz-render-comboSelected-listBoxResults .ui-bizagi-render-text",t).bind("keyup input",(function(i){e.filterFunction(this.value,e.rightValues,$("#bz-render-comboSelected-listBoxResults select",t))}))},filterFunction:function(e,t,i){$(i).empty();var r=t.reduce((function(t,i){return-1!==i.value.toUpperCase().indexOf(e.toUpperCase())&&(t+="<option value='"+i.id+"'>"+i.value+" </option>"),t}),"");i.append(r)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},setDisplayValue:function(e){this.setValue(e,!1)},addItem:function(){var e=this,t=e.getControl(),i=$("#selectionData option:selected",t);$("#listBoxComboData",t);$.each(i,(function(t,i){var r={id:parseInt(i.value),value:i.text};$.grep(e.selectedItemsToUpdate,(function(e){return e.id==r.id})).length<=0&&(e.selectedItemsToUpdate.push(r),e.rightValues.push(r),e.leftValues=$.grep(e.leftValues,(function(e){return e.id!=r.id})))})),i.remove(),e.setValue(e.selectedItemsToUpdate)},removeItem:function(){var e=this,t=e.getControl(),i=$("#listBoxComboData option:selected",t),r=$("#selectionData",t);$.each(i,(function(t,i){var a={id:parseInt(i.value),value:i.text};$.grep(r,(function(e){return e.id==a.id})).length<=0&&(e.leftValues.push(a),e.rightValues=$.grep(e.rightValues,(function(e){return e.id!=a.id})),e.selectedItemsToUpdate=$.grep(e.selectedItemsToUpdate,(function(e){return e.id!=a.id})))})),i.remove(),e.setValue(e.selectedItemsToUpdate)},showListBoxComboData:function(){var e=this.getControl();$("#move_left",e).show(),$("#bz-render-comboSelected-listBoxResults",e).show()},showInitialData:function(e){var t=this;t.orderArrayList(),t.selectedItemsToUpdate=[],e&&$.each(e,(function(e,i){t.selectedItemsToUpdate.push({id:i.id,value:i.value})}))},renderReadOnly:function(){var e=this.renderFactory.getTemplate("render-comboSelectedReadOnly");return this.showInitialData(this.properties.value),$.fasttmpl(e,{datasource:this.selectedItemsToUpdate})},hasValue:function(){var e="string"==typeof this.value?JSON.parse(this.value).value:this.value;return!bizagi.util.isEmpty(e)},setValue:function(e,t){this.properties.previousValue=this.properties.originalValue=JSON.stringify({value:this.value}),this.value=this.properties.value=JSON.stringify({value:e}),this.properties.required&&"execution"==this.getMode()&&(this.checkRequired([])?this.changeRequiredLabel(!1):this.changeRequiredLabel(!0)),(t=void 0===t||t)&&!this.internalSetInitialValueFlag&&(this.triggerRenderChange(),this.triggerRenderValidate())}}),bizagi.rendering.desktop.form.extend("bizagi.rendering.desktop.usersForm",{},{init:function(e){this.form=this.getFormContainer(),this.observableElement=$({}),this.collectedValues={},this._super(e)},startLoading:function(){var e=this.renderFactory.getTemplate("form-waiting");if(!this.waitingOverlay||!this.waitingMessage){var t=$(this.params.canvas).closest(".ui-dialog"),i=t.offset();this.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo(t),this.waitingMessage=$.tmpl(e).appendTo($("body",$(document))),this.waitingMessage.css({top:i.top+Math.ceil((t.height()-this.waitingMessage.outerHeight())/2)+"px",left:i.left+Math.ceil((t.width()-this.waitingMessage.outerWidth())/2)+"px"})}},processButtons:function(){var e=this,t=e.getButtons();t&&0!==t.length&&("rtl"===e.properties.orientation&&e.buttons.reverse(),t.click((function(){var t=$(this).attr("ordinal"),i=e.buttons[t];e.processButton(i)})))},processButton:function(e){var t=this;t.validationController.clearValidationMessages(),$.when(t.ready()).done((function(){switch(e.action){case"save":var i=t.form.getRender("sendMail"),r=t.form.getRender("password"),a={formAction:"save",sendMail:i&&i.getValue()||!1,password:null===r?"":r.getValue()};i&&r&&a.sendMail&&""===a.password?$.when(t.dataService.getConfiguration()).done((function(e){if(e.redirectErrorPage)window.location.href=e.redirectErrorPage;else{var i=e.passwordMinLength,n=e.passwordMaxLength;t.generateRandomPassword(r,i,n),a.password=r.getValue(),t.processSave(a)}})).fail((function(e){t.generateRandomPassword(r,8,12),a.password=r.getValue(),t.processSave(a);var i=JSON.parse(e.responseText);t.validationController.showValidationMessage(i.message)})):t.processSave(a);break;case"cancel":t.triggerHandler("endUsersForm",{formAction:"cancel",sendMail:!1})}}))},processSave:function(e){var t=this;if(t.validationController.performValidations()){var i;t.startLoading(),$.extend(t.collectedValues,t.collectRenderValuesForSubmit());var r={action:"SAVEUSER",data:{},contexttype:"entity",idPageCache:t.idPageCache};delete t.collectedValues.sendMail,delete t.collectedValues["@Metadata.Stakeholders"],"add"===t.params.action?i=t.createUser(r,e):"edit"===t.params.action&&(i=t.updateUser(r)),$.extend(e,r.data),$.when(i).done((function(){t.triggerHandler("endUsersForm",e)})).fail((function(i){var r=i;i&&i.responseText&&(r=JSON.parse(i.responseText)),t.endLoading(),t.validationController.showValidationMessage(r.message),t.triggerHandler("endUsersForm",$.extend(e,{error:r}))}))}else t.validationController.expandNotificationBox()},generateRandomPassword:function(e,t,i){for(var r=this.getLengthPassword(t,i),a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz",n="",o=0;o<r;o++){var s=Math.floor(Math.random()*a.length);n+=a.substring(s,s+1)}e.saveValue(n)},getLengthPassword:function(e,t){return e=e&&t?e:8,t=t&&e?t:12,Math.floor(Math.random()*(t-(e-1)))+e},createUser:function(e,t){var i=this,r=i.getCollectedData();$.extend(e,{data:{domain:r.domain,fullName:r.fullName,userName:r.userName},prepare:!0});var a=i.dataService.submitData(e);a.tag="submitData",delete r.userName,delete r.domain,$.extend(e,{data:r,surrogatekey:!1,prepare:!0});var n=i.dataService.submitData(e);n.tag="performAction";var o=[];return o.push(a),o.push(n),$.when(i.dataService.multiaction().execute({actions:o})).then((function(e){var r={};e&&bizagi.util.isArray(e)&&e.length>0&&(r=e[0]&&e[0].result||{}),i.params.action="edit",i.params.userId=r.idEntity||void 0,$.extend(t,{userId:r.idEntity||void 0})}))},updateUser:function(e){var t=this.collectedValues;return $.extend(e,{data:t,surrogatekey:this.params.userId}),this.dataService.submitData(e)},getCollectedData:function(){var e=this.collectedValues,t=this.form.getRender("expiredAccount"),i=this.form.getRender("lockedAccount"),r=this.form.getRender("domain");return e.expiredAccount=t?t.getValue():null,e.lockedAccount=i?i.getValue():null,e.domain=r?r.getValue():"",e}}),$.Class.extend("bizagi.rendering.userPassword",{},{init:function(e){this._super(e),this.properties.value=null,self.properties=this.properties},renderControl:function(){var e=this.renderFactory.getTemplate("render-userPassword");return $.fasttmpl(e,{valuePassword:this.properties.value})},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t}}),$.Class.extend("bizagi.rendering.stakeholder",{},{init:function(e){this._super(e),void 0===this.properties.value&&(this.properties.value=[]),void 0===this.properties.data&&(this.properties.data=[]),self.properties=this.properties},renderControl:function(){var e=this.renderFactory.getTemplate("stakeholder"),t={currentUser:bizagi.currentUser.userName,userNames:"string"==typeof this.properties.value?JSON.parse(this.properties.value).value:this.properties.value,entities:this.properties.data};return $.fasttmpl(e,t)},getData:function(e,t,i,r,a){void 0!==t&&null!=t||(t="1");var n={pxpath:e,prows:"10",ppage:t.toString(),xpath:e,idRender:this.properties.id,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,property:"dataxpath",contexttype:"entity",pfilter:i,psort:r};return a&&(n.porder=a),this.dataService.multiaction().getPropertyData(n)},associatedUser:function(e,t,i){return this.dataService.associateStakeholder({idPageCache:this.properties.idPageCache,contexttype:"entity",surrogateKey:parseInt(e),associatedUser:JSON.encode({dataType:"Int",value:"null"==i?i:parseInt(i)}),guidentity:t})},refreshStakeholderList:function(){return this.dataService.refreshAssociateStakeholder({idRender:this.properties.id,contexttype:"entity",property:"value",idPageCache:this.properties.idPageCache})}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.stakeholder",bizagi.rendering.stakeholder.prototype),bizagi.rendering.desktop.stakeholder.extend("bizagi.rendering.desktop.stakeholder",{},{postRender:function(){this.getControl();var e=$(".ui-bizagi-render-stakeholder-container").closest(".ui-bizagi-control.ui-bizagi-render-align-left ");e.css("width","100%"),e.prev().css("display","none"),this.maxElemShow=10,this.maxPageToShow=5,this.selectedItems=[],this.valueXpath,this.guidEntity,this.currentPage,this._super()},configureHandlers:function(){var e=this,t=e.getControl();$("#ui-bizagi-render-stakeholder-add",t).click($.proxy(e.addInstance,e)),$(".ui-bizagi-render-stakeholder-entity-row",t).click($.proxy(e.addGrid,e)),$(".ui-bizagi-render-stakeholder-back",t).click($.proxy(e.goToBack,e)),$(".ui-bizagi-render-stakeholder-link",t).click($.proxy(e.removeAssociated,e)),$(".ui-bizagi-render-stakeholder-search",t).keyup($.proxy(e.onKeyUpFilter,e)),t.on("click","table .sortColumnsData-stakeholder",(function(t){var i=$(t.currentTarget),r=i.data("orderfield"),a=i.data("ordertype");e.gridDataService(e.currentPage,null,r,"DESC"===a?"ASC":"DESC")}))},goToBack:function(){var e=this.getControl();"step1"===this.status?($("#ui-bizagi-render-stakeholder-entity-list",e).hide(),$("#ui-bizagi-render-stakeholder-add-instance",e).hide(),$("#ui-bizagi-render-stakeholder-associated-list",e).show(),$(".ui-bizagi-render-stakeholder-associated",e).show(),$("#ui-bizagi-render-stakeholder-add",e).show(),$(".ui-bizagi-render-stakeholder-back",e).hide(),this.status=null):"step2"===this.status&&($("#ui-bizagi-render-stakeholder-grid",e).hide(),$("#ui-bizagi-render-stakeholder-add-instance",e).show(),this.status="step1")},addInstance:function(){var e=this.getControl();this.status="step1",$("#ui-bizagi-render-stakeholder-associated-list",e).hide(),$(".ui-bizagi-render-stakeholder-associated",e).hide(),$("#ui-bizagi-render-stakeholder-add",e).hide(),$("#ui-bizagi-render-stakeholder-entity-list",e).show(),$("#ui-bizagi-render-stakeholder-add-instance",e).show(),$(".ui-bizagi-render-stakeholder-back",e).show(),$(".ui-bizagi-render-stakeholder-entity-row").removeClass("ui-bizagi-render-stakeholder-selected")},addGrid:function(e){var t=this.getControl();this.valueXpath=$(e.currentTarget).attr("data-value"),this.guidEntity=$(e.currentTarget).attr("guid-entity"),this.status="step2",$(".ui-bizagi-render-stakeholder-entity-row").removeClass("ui-bizagi-render-stakeholder-selected"),$(e.currentTarget).addClass("ui-bizagi-render-stakeholder-selected"),$("#ui-bizagi-render-stakeholder-add-instance",t).hide(),$("#ui-bizagi-render-stakeholder-grid",t).show(),$(".ui-bizagi-render-stakeholder-search",t).val(""),this.gridDataService(null,"","","DESC")},gridDataService:function(e,t,i,r){var a=this;a.getData(a.valueXpath,e,t,i,r).done((function(e){a.onGetData(e,r)})).fail((function(e){a.onGetDataFail(e)}))},onGetData:function(e,t){var i=this,r=i.getControl(),a=i.renderFactory.getTemplate("stakeholder-grid");if(i.currentPage=e.page,e.rows.length>0){var n=e.rows[0][1],o=n.slice(1,n.length),s=[];for(m=0;m<o.length;m++){var l={name:o[m][0],displayName:o[m][1],orderType:t};s.push(l)}var d=i.selectedItems[i.valueXpath];$.each(e.rows,(function(e,t){var r=t[2][0][0];(!d&&null!=r||d&&r==d.id)&&(i.selectedItems[i.valueXpath]={id:t[0],idInstance:r,nameInstance:t[2][0][1]})})),i.selectedItems[i.valueXpath]&&"null"==i.selectedItems[i.valueXpath].idUser&&delete i.selectedItems[i.valueXpath];for(var u=[],c=0;c<e.rows.length;c++){var p="",h="";e.rows[c][2][0][0]&&e.rows[c][2][0][0]!=i.properties.idUser?(p="associatedWithAnotherUser",h=bizagi.localization.getResource("render-stakeholder-link-tooltip-associate-another-user").replace("{0}",e.rows[c][2][0][1])):e.rows[c][2][0][0]==i.properties.idUser?(p="associateMe",h=bizagi.localization.getResource("render-stakeholder-link-tooltip-associate")):(p="unassociated",h=bizagi.localization.getResource("render-stakeholder-link-tooltip-unassociate"));var g={columns:[]};g.columns.push({stateInstance:p,value:e.rows[c][0],tooltipLink:h});for(var m=0;m<e.rows[c][2].length;m++)m>0&&g.columns.push({value:e.rows[c][2][m]});u.push(g)}var f=$.tmpl(a,{datasource:u,columns:s,tooltipUnassociated:bizagi.localization.getResource("render-stakeholder-link-tooltip-unassociate")});$(".ui-bizagi-render-stakeholder-items-grid-content",r).empty().append(f);var b=i.renderFactory.getTemplate("stakeholder-paginator");i.totalRecords=e.records,i.totalPages=e.total;var v=i.maxPageToShow>i.totalPages?i.totalPages:i.maxPageToShow,y={};y.pagination=i.totalPages>1,y.page=e.page,y.pages={};for(var C=1;C<=v;C++)y.pages[C]={pageNumber:C};paginationHtml=$.tmpl(b,y).html(),$(".ui-bizagi-render-stakeholder-paginator",r).empty().append(paginationHtml);var x=$(".ui-bizagi-render-stakeholder-paginator ul",r);x.bizagiPagination({maxElemShow:i.maxPageToShow,totalPages:i.totalPages,actualPage:i.currentPage,listElement:x,clickCallBack:function(e){i.gridDataService(e.page)}}),i.setRowsEvents()}else $(".ui-bizagi-render-stakeholder-items-grid-content",r).empty(),$(".ui-bizagi-render-stakeholder-paginator",r).empty()},onGetDataFail:function(e){console.log("process property value error: "+e)},setRowsEvents:function(){$(".ui-bizagi-render-stakeholder-table-link").click($.proxy(this.onLinkClick,this))},onLinkClick:function(e){var t,i=this,r=$(e.currentTarget).attr("data-value");function a(e){$(e.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-link-close")?($(".ui-bizagi-render-stakeholder-table-link").removeClass("ui-bizagi-render-stakeholder-table-link-close"),t="null"):($(".ui-bizagi-render-stakeholder-table-link").removeClass("ui-bizagi-render-stakeholder-table-link-close"),$(e.currentTarget).addClass("ui-bizagi-render-stakeholder-table-link-close"),t=i.properties.idUser),i.selectedItems[i.valueXpath]={id:r,idUser:t},i.associatedUser(r,i.guidEntity,t).done((function(){i.refreshStakeholderValue(),$(e.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-stakeholder-associated-other-user")&&($(".ui-bizagi-render-stakeholder-table-link").removeClass("ui-bizagi-render-stakeholder-table-stakeholder-associated-other-user"),$(e.currentTarget).addClass("ui-bizagi-render-stakeholder-table-link-close"),t=i.properties.idUser,i.associatedUser(r,i.guidEntity,t).done((function(){i.refreshStakeholderValue()})).fail((function(e){i.onStakeAssociatedFail(e)})))})).fail((function(e){i.onStakeAssociatedFail(e)}))}if($(e.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-link-close")&&$(e.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-stakeholder-associated-other-user")){var n=bizagi.localization.getResource("render-stakeholder-delete-associate-instance-other-user-confirm-msg");$.when(bizagi.showConfirmationBox(n,"Bizagi","warning")).done((function(){a(e)}))}else a(e)},removeAssociated:function(e){var t=this,i=$(e.currentTarget).attr("data-value");t.guidEntity=$(e.currentTarget).attr("guid-entity");t.selectedItems[t.valueXpath]={id:i,idUser:"null"},t.associatedUser(i,t.guidEntity,"null").done((function(){t.refreshStakeholderValue()})).fail((function(e){t.onStakeAssociatedFail(e)}))},onKeyUpFilter:function(e){if(13==e.keyCode){var t=$(e.target).val();this.gridDataService(null,t)}},refreshStakeholderValue:function(){var e=this,t=e.getControl();e.refreshStakeholderList().done((function(i){e.setValue(i),t.empty().append(e.renderControl()),e.configureHandlers()})).fail((function(t){e.onStakeAssociatedFail(t)}))},onStakeAssociatedFail:function(e){console.log("stakeholder associated error: "+e)},setDisplayValue:function(e){this.setValue(e)},setValue:function(e){this.properties.previousValue=this.properties.originalValue=JSON.stringify({value:this.value}),this.value=this.properties.value=JSON.stringify({value:e})}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.userPassword",bizagi.rendering.userPassword.prototype),bizagi.rendering.desktop.userPassword.extend("bizagi.rendering.desktop.userPassword",{},{postRender:function(){var e=this.getControl();this._super(),this.input=e.find("input#bz-render-userPassword-inputPassword"),this.properties.maxLength>0&&this.input.attr("maxlength",this.properties.maxLength)},configureHandlers:function(){var e=this;e.getControl();e.input.bind("change",(function(){var t=e.input.val();""!==t?e.saveValue(t):e.setValue(t)})).keypress((function(e){var t=(e=window.event||e).charCode||e.keyCode;void 0!==e&&13==t&&$(this).trigger("change")}))},saveValue:function(e){var t=CryptoJS,i=t.enc.Utf8.parse("pc30n84e15lvdD68"),r=CryptoJS.enc.Latin1.parse("1v00628X62bJE2mi"),a=t.algo.AES.createEncryptor(i,{mode:t.mode.CBC,padding:t.pad.Pkcs7,iv:r}).finalize(e),n=t.enc.Base64.stringify(a);this.setValue(n)},postRenderReadOnly:function(){var e=this.getControl(),t=$.tmpl("<label class='readonly-control'></label>",{});e.append(t)}}),bizagi.rendering.render.extend("bizagi.rendering.desktop.gridActions",{},{renderControl:function(){var e=this.renderFactory.getTemplate("gridActions"),t=this.grid&&this.grid.hasActions()||!1;return $.fasttmpl(e,{hasActions:t})}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.numberScientificNotation",bizagi.rendering.numberScientificNotation.prototype),bizagi.rendering.desktop.numberScientificNotation.extend("bizagi.rendering.desktop.numberScientificNotation",{},{postRender:function(){this._super(),this.attachFormatScientificNotation()},setDisplayValue:function(e){null!=(e=bizagi.util.scientificNotationFormat(e.replace(this.properties.decimalSymbol,".")))&&this.properties.editable&&(this.numericInput.val(e.replace(".",this.properties.decimalSymbol)),this.setValue(e)),this._super(e.replace(".",this.properties.decimalSymbol))},attachFormatScientificNotation:function(){var e=this;e.numericInput.blur((function(){var t=e.numericInput.val(),i=bizagi.util.scientificNotationFormat(t,e.properties.decimalSymbol);e.setValue(i),e.numericInput.val(i)}))}}),$.Class.extend("bizagi.rendering.actionLauncher",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer();this.typeForm=t.properties.typeForm||"";var i=this.getMode(),r=this.properties;this.deferredActions=new $.Deferred,this.deferredActions.promise(),"execution"==i&&(this.engine=new bizagi.templateEngine({renderFactory:this.renderFactory,cache:!0,autoGenerateData:!1,templateGuid:r.selecttemplate})),this.processPropertyValueArgs={pcaseId:this.getIdCase(),pguidEntity:this.properties.guidEntity,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,property:"data",psurrogatedKey:this.properties.surrogatedKey,ptags:this.properties.tagslist||[],pmaxitems:this.properties.maxItems,pactionXpath:this.properties.xpathActions},this.processPropertyValueDataTmplArgs={pactionXpath:this.properties.xpathActions,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,ptemplateGuid:r.selecttemplate,property:"dataTemplate",xpathActions:this.properties.xpathActions},this.properties.valueWidth=100,this.properties.displayType="value";var a="entityTemplate"!==e.properties.type;this.properties.allowactions=void 0===e.properties.allowactions?a:e.properties.allowactions,this.properties.isHorizontal=void 0===e.properties.isHorizontal||e.properties.isHorizontal,this.properties.allowSearch=void 0!==e.properties.allowSearch&&e.properties.allowSearch,this.properties.selecttemplate=void 0===e.properties.selecttemplate?"":e.properties.selecttemplate,this.properties.templatetype=void 0!==r.templatetype?r.templatetype:"none",this.properties.sessionId=t.params.data.sessionId,this.properties.value?"string"==typeof this.properties.value&&(this.properties.value=this.value=JSON.parse(this.properties.value)):(this.properties.value=this.value=[],this.properties.originalValue=[])},executeActionImmediately:function(e){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeAction",psurrogatedKey:t.properties.surrogatedKey,pguidAction:e.guidAction,pparameters:JSON.encode({idStartScope:e.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:e.idPageCache})};t.dataService.executeActions(r).done((function(i){t.notifyExecution(i,e)})).fail((function(i){t.notifyExecution("Error",e)}))},notifyExecution:function(e,t){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0,this.postRender()},renderControl:function(){var e,t=this.properties,i="";if("design"==this.getMode()){e=this.renderFactory.getTemplate("render-actionLauncher-design");var r={type:t.type,isHorizontal:t.isHorizontal,allowSearch:t.allowSearch,templateDefined:"none"!=t.templatetype,allowactions:t.allowactions};i=$.fasttmpl(e,r)}else t.surrogatedKey&&(e=this.renderFactory.getTemplate("render-actionLauncher"),i=$.fasttmpl(e,{allowactions:this.properties.allowactions}));return i},isValid:function(e){var t=this.properties;this.getValue();return 0==bizagi.util.parseBoolean(t.visible)||(0==bizagi.util.parseBoolean(t.editable)||!(!t.required||!this.value)&&(this.value.length>0||(message=this.getResource("render-required-register-action"),e.push({xpath:t.xpath,message:message}),!1)))},setDisplayValue:function(e){this.getControl();this.setValue(e,!1)},actionManager:function(e){var t=this,i=e.guidProcess||"",r=new $.Deferred;switch(e.recordXpath=t.getFormContainer().properties.recordXpath,e.actionType){case"Process":var a={guidWFClass:i};$.when(t.dataService.hasStartForm(a)).done((function(a){a.hasStartForm?$.when(t.processStartForm({guidprocess:i,title:e.displayName,recordXpath:e.recordXpath})).done((function(t){e.idStartScope=t,r.resolve(e)})):r.resolve(e)}));break;case"Rule":r.resolve(e);break;case"Form":e.xpathContext?$.when(t.processActionFormCollection(e)).done((function(t){e.idStartScope=t,r.resolve(e)})):("Form"===e.actionType&&(e.xpathContext=void 0,e.contextType="entitytemplate",e.guidEntity=e.guidEntity||t.properties.guidEntity),$.when(t.processActionForm(e)).done((function(t){e.idStartScope=t,r.resolve(e)})))}return r.promise()},addActionToQueue:function(e){var t=this.getValue(),i=this.getFormContainer().getParams();e.params=e.params||{};var r=this.properties.xpathContext;switch(e.actionType){case"Process":e.params={idStartScope:e.idStartScope,additionalXpaths:this.properties.additionalXpath.join(","),idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,recordXpath:r};break;case"Form":e.params={idStartScope:e.idStartScope,additionalXpaths:this.properties.additionalXpath.join(","),entityXpath:this.properties.xpathActions,idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,idEntity:e.idEntity};break;case"Rule":e.params={xpathActions:e.xpathActions||"",recordXpath:r}}var a=bizagi.clone(t);a.push(e),this.setValue(a),this.setDisplayValue(a)},removeActionToQueue:function(e){var t=bizagi.clone(this.getValue());t.splice(e,1),this.setValue(t),this.setDisplayValue(t)},collectData:function(e){if(this.controlValueIsChanged()){var t=this.properties.xpath,i=this.getValue(),r=[];$.each(i,(function(e,t){var i={};i.params=t.params||{},i.guidAction=t.guidAction,r.push(i)})),e[t]=0==r.length?"":JSON.encode(r)}},countSameActions:function(e){var t=this.getValue(),i=0;return $.each(t,(function(t,r){r.guidAction==e.guidAction&&i++})),i},getPropertiesActionLaucher:function(e){for(var t=this.getFormContainer(),i=0,r=e.length;i<r;i+=1)6===e[i].length&&(e[i].splice(5,0,""),"Process"==e[i][3]&&t.properties.xpathContext&&(e[i][5]=t.properties.xpathContext));return e}}),$.Class.extend("bizagi.rendering.range",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e)},renderControl:function(){var e;this.properties;return e=this.renderFactory.getTemplate("render-range"),$.fasttmpl(e,{})},setRanageControls:function(e,t){this.minControl=e||null,this.maxControl=t||null;var i=this.getControl(),r=$(".bz-range-maximum",i),a=$(".bz-range-minimum",i);this.renderRangeControl(a,e),this.renderRangeControl(r,t)},getValue:function(){return{min:this.minControl.getValue(),max:this.maxControl.getValue()}},renderRangeControl:function(e,t){$.when(t.render("render")).done((function(i){e.empty().append(i),t.postRenderElement(e)}))}}),$.Class.extend("bizagi.rendering.rangeDate",{},{defineRangeControl:function(e){var t=bizagi.rendering.date.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=bizagi.rendering.date.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),r=new t(this.getRenderProperties("min")),a=new i(this.getRenderProperties("max"));r.suscribe(a),a.suscribe(r),this.setRanageControls(r,a)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,r={data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return r.data.properties.displayName="min"===e?"From":"To",r}}),$.Class.extend("bizagi.rendering.rangeMoney",{},{defineRangeControl:function(){var e=bizagi.rendering.money.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),t=bizagi.rendering.money.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=new e(this.getRenderProperties("min")),r=new t(this.getRenderProperties("max"));i.suscribe(r),r.suscribe(i),this.setRanageControls(i,r)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService}}}),$.Class.extend("bizagi.rendering.rangeNumber",{},{defineRangeControl:function(){var e=bizagi.rendering.number.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),t=bizagi.rendering.number.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=new e(this.getRenderProperties("min")),r=new t(this.getRenderProperties("max"));i.suscribe(r),r.suscribe(i),this.setRanageControls(i,r)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService}}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.actionLauncher",bizagi.rendering.actionLauncher.prototype),bizagi.rendering.desktop.actionLauncher.extend("bizagi.rendering.desktop.actionLauncher",{},{postRender:function(){var e,t=this,i=t.properties,r=t.getMode(),a={},n=new $.Deferred;if("design"==r||!t.properties.surrogatedKey)return"";function o(i,r){var a=t.getControl(),o=$(".bz-action-launcher-actions-container",a);e=$.fasttmpl(i,r),o.append(e),r.template&&o.find(".actions-container.actions-container-template").append(r.template),t.configureHandlers(),n.resolve(o)}return t.configureQueueVisibility(),$.when(t.dataService.multiaction().getActions(t.processPropertyValueArgs)).pipe((function(e){return e=t.getPropertiesActionLaucher(e),a.actions=e,"none"!=i.templatetype?t.dataService.multiaction().getPropertyData(t.processPropertyValueDataTmplArgs):null})).done((function(e){var r=a.actions;t.deferredActions.resolve(r),t.totalActions=bizagi.clone(r);var n=bizagi.clone(r),s={},l=t.moreActionsManager(n),d=l.isMoreActions;if(n=l.actions,t.lessActions=bizagi.clone(n),i.isHorizontal)"none"!=i.templatetype?$.when(t.engine.render($.extend(e,{isDefaultTemplate:"default"==i.templatetype}),t.processPropertyValueDataTmplArgs)).done((function(e){s={actions:t.getPropertiesActionLaucher(n),template:e,isMoreActions:d,moreActions:t.moreActions,allowactions:i.allowactions},o(e=t.renderFactory.getTemplate("render-actionLauncher-horizontal"),s)})):(s={actions:t.getPropertiesActionLaucher(n),isMoreActions:d,template:!1,moreActions:t.moreActions,allowactions:i.allowactions},o(t.renderFactory.getTemplate("render-actionLauncher-horizontal"),s));else{var u=d?t.lessActions:t.totalActions;s={actions:t.getPropertiesActionLaucher(u),allowSearch:i.allowSearch,isMoreActions:d,isExpanded:!1,moreButtonTitle:t.getResource("render-action-launcher-more-actions")},o(t.renderFactory.getTemplate("render-actionLauncher-vertical"),s)}})).fail((function(e){n.fail(e)})),t.engine.subscribe("onLoadDataNavigation",(function(e,t){bizagi.loader.start("entity-engine-view").then((function(){$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_DIALOGNAV,data:t,modalParameters:{title:t.data.displayName,refreshInbox:!1},maximizeOnly:!1})}))})),n.promise()},moreActionsManager:function(e){var t=this.properties,i=e.length>t.maxItems||!1;if(i){var r=e.splice(0,t.maxItems);this.moreActions=bizagi.clone(e),e=r}return{isMoreActions:i,actions:e}},configureHandlers:function(){var e=this,t=e.getFormContainer();if(void 0===t.params.printversion||0==t.params.printversion){var i=e.getControl(),r=$(".action-launcher-control",i),a=$(".action-launcher-more-vertical",i),n=e.properties;e.configureMoreActionsHandler(),a.on("click",(function(t){var i=!1,r="",a={};$(this).hasClass("expanded")?(i=!1,a=e.lessActions,r=e.getResource("render-action-launcher-more-actions")):(i=!0,a=e.totalActions,r=e.getResource("render-action-launcher-less-actions"));var o={actions:e.getPropertiesActionLaucher(a),allowSearch:n.allowSearch,isMoreActions:!0,isExpanded:i,moreButtonTitle:r};!function(t,i){var r=e.getControl(),a=$(".bz-action-launcher-actions-container",r);a.empty();var n=$.fasttmpl(t,i);a.append(n),e.configureHandlers()}(e.renderFactory.getTemplate("render-actionLauncher-vertical"),o)})),r.on("click",(function(){var t={guidProcess:$(this).data("guidprocess"),guidAction:$(this).data("guidaction"),displayName:$(this).data("display-name"),actionType:$(this).data("action-type"),xpathContext:$(this).data("xpathcontext"),readOnlyForm:$(this).data("readonlyform")||!1,guidEntity:e.properties.guidEntity,xpathActions:e.properties.xpathActions||""};e.onActionClicked(t)})),$.expr[":"].FilterAction=function(e,t,i){var r=i[3];return!!r&&new RegExp(r,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",i).keyup((function(){var e=$(this).val();$(".ui-bizagi-render-actionLauncher-vertical-item",i).show(0),a.hasClass("expanded")||(a.trigger("click"),$("input#ui-bizagi-render-action-launcher-filter-input").val(e),$("input#ui-bizagi-render-action-launcher-filter-input").focus()),e&&$(".ui-bizagi-render-actionLauncher-vertical-item",i).not(":FilterAction("+e+")").hide(0)}))}},configureMoreActionsHandler:function(){var e=this,t=e.getControl(),i=$(".action-launcher-more",t);bizagi.loader.startAndThen("kendo").then((function(){e.tooltip=i.kendoTooltip({autoHide:!1,content:function(t){var i=e.renderFactory.getTemplate("render-actionLauncher-horizontal-more");return $.fasttmpl(i,{actions:e.getPropertiesActionLaucher(e.moreActions)})},show:function(){$("div[role='tooltip']").addClass("bizagi-custom-tooltip-more-actions"),$(".action-launcher-control-more").off("click").on("click",(function(t){var i={guidProcess:$(this).data("guidprocess"),guidAction:$(this).data("guidaction"),displayName:$(this).data("display-name"),actionType:$(this).data("action-type"),xpathContext:$(this).data("xpathcontext"),readOnlyForm:$(this).data("readonlyform")||!1,xpathActions:e.properties.xpathActions||""};e.onActionClicked(i),e.tooltip.hide()}))},width:185}).data("kendoTooltip")}))},onActionClicked:function(e){var t=this,i=t.getControl(),r=t.properties;void 0===r.multipleSelection||r.multipleSelection?"Form"==e.actionType&&t.countSameActions(e)>=1&&!e.xpathContext?$(".action-to-execute-control[data-guidaction='"+e.guidAction+"'] label",i).click():$.when(t.actionManager(e)).done((function(e){t.executeAction(e)})):t.getValue().length>0?t.showConfirmationDialog(e):$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))},notifyExecution:function(e,t){var i=new bizagi.INotifications;"success"==e.response?i.showSucessMessage(printf(this.getResource("render-action-launcher-success-excecution"),t.displayName),null,{}):i.showErrorMessage(printf(this.getResource("render-action-launcher-failed-excecution"),t.displayName),null,{})},processActionForm:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=t.properties.additionalXpath.join(","),n=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,o=new $.Deferred,s=new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){return t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:s.form.properties.xpathContext,idPageCache:s.form.properties.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe((function(i){e.editMode||0!=t.countSameActions(e)||(e.idStartScope=i.IdScope),o.resolve(i.IdScope)}))},onCancel:function(e){}}),l={idForm:e.guidProcess,contextType:"start",idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=r.properties.typeForm?bizagi.context.idWorkitem:void 0,additionalXpaths:a,xpathContext:n,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath};return"Form"===e.actionType&&(l.contextType="entitytemplate",l.xpathContext=void 0,l.guidEntity=e.guidEntity,l.rewriteContextType=!0),s.render(l),o.promise()},processActionFormCollection:function(e){var t=this,i=t.properties,r=(t.getFormContainer(),t.properties.additionalXpath.join(",")),a=new $.Deferred,n=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,o=""!=n?printf("%s[id=%s]",n,e.idEntity):n,s=""!=n?printf("%s[]",n):n;return new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(r){return e.editMode?t.dataService.multiaction().submitData({action:"SAVE",data:r,xpathContext:o,idPageCache:r.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe((function(e){a.resolve(e.IdScope)})):t.dataService.addGridRecordData({idRender:i.id,xpathContext:n,contexttype:"start",idPageCache:r.idPageCache,submitData:r}).pipe((function(i){e.idStartScope=i.IdScope,e.idEntity=i.IdEntity,t.addActionToQueue(e),a.resolve(i.IdScope)}))},onCancel:function(e){}}).render({idForm:e.guidProcess,contextType:"start",idCase:bizagi.context.idCase,additionalXpaths:r,xpathContext:e.editMode?o:s,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath}),a.promise()},processStartForm:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=new $.Deferred;return e=e||{},new bizagi.rendering.dialog.startForm(t.dataService,t.renderFactory,{maximized:i.maximized,title:e.title||"",saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==this.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return r.startLoading(),t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe((function(e){r.endLoading(),a.resolve(e.IdScope)}))}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=r.properties.typeForm?bizagi.context.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),a.promise()},executeAction:function(e){var t=this;"GlobalForm"===t.typeForm||"SummaryForm"===t.typeForm?"Form"!==e.actionType?$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation"),null,!1)).done((function(i){t.executeActionImmediately(e)})):t.setValue([]):t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this;t.confirmTemplate=t.renderFactory.getTemplate("render-actionLauncher-confirm");var i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation"),r=$.tmpl(t.confirmTemplate,{confirmationMessage:i}),a={resizable:!1,modal:!0,title:"Bizagi",buttons:[]};a.buttons=[{text:bizagi.localization.getResource("render-boolean-yes"),click:function(){t.setValue([]),$.when(t.actionManager(e)).done((function(e){t.executeAction(e)})),$(this).dialog("close")}},{text:bizagi.localization.getResource("render-boolean-no"),click:function(){$(this).dialog("close")}}],$(r).dialog(a)},setDisplayValue:function(e){var t=this,i=t.getControl(),r=$(".bz-action-launcher-actions-to-execute-container",i),a=t.renderFactory.getTemplate("render-actionLauncher-actions-to-execute");t.configureQueueVisibility(),$.when(t.deferredActions).done((function(i){$.each(e,(function(t,r){var a=function(e){var t=[];return $.each(i,(function(i,r){r[4]==e&&(t=r)})),t}(r.guidAction);e[t].displayName=a[1],e[t].guidProcess=a[0],e[t].actionType=a[3],e[t].xpathContext=a[5],e[t].readOnlyForm=a[6],e[t].params&&e[t].params.idStartScope&&(e[t].idStartScope=e[t].params.idStartScope),e[t].params&&e[t].params.idPageCache&&(e[t].idPageCache=e[t].params.idPageCache),e[t].params&&e[t].params.idEntity&&(e[t].idEntity=e[t].params.idEntity)})),$.when($.fasttmpl(a,{actions:e})).done((function(e){r.empty(),r.append(e);var i=$(".action-to-execute-control i",r),a=$(".action-to-execute-control label",r);i.bind("click",(function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)})),a.bind("click",(function(){var e=$(this).parent(),i=e.data("actiontype"),r=e.data("guidprocess"),a=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("readonlyform")||!1,l=e.data("identity")||"",d=e.data("guidaction"),u=o||t.properties.xpathContext;switch(i){case"Process":a&&t.processStartForm({guidprocess:r,idStartScope:a,title:n,xpathContext:o,recordXpath:u});break;case"Form":var c={guidProcess:r,idStartScope:a,editMode:!0,xpathContext:o,readOnlyForm:s,idEntity:l,recordXpath:u};if(c.xpathContext)t.processActionFormCollection(c);else{var p={},h=t.value.filter((function(e){return e.guidAction==d}));h.length>0&&(p={actionType:"Form",contextType:"entitytemplate",guidEntity:t.properties.guidEntity||h[0].guidEntity}),t.processActionForm($.extend(c,p))}}}))}))}))},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-action-launcher-actions-to-execute-container",e),i=$(".actions-to-execute-title",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.range",bizagi.rendering.range.prototype),bizagi.rendering.desktop.range.extend("bizagi.rendering.desktop.range",{},{postRender:function(){this.properties},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.desktop.range.extend("bizagi.rendering.desktop.rangeDate",bizagi.rendering.rangeDate.prototype),bizagi.rendering.desktop.rangeDate.extend("bizagi.rendering.desktop.rangeDate",{},{postRender:function(){this.defineRangeControl()}}),bizagi.rendering.desktop.range.extend("bizagi.rendering.desktop.rangeMoney",bizagi.rendering.rangeMoney.prototype),bizagi.rendering.desktop.rangeMoney.extend("bizagi.rendering.desktop.rangeMoney",{},{postRender:function(){this.defineRangeControl()},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.desktop.range.extend("bizagi.rendering.desktop.rangeNumber",bizagi.rendering.rangeNumber.prototype),bizagi.rendering.desktop.rangeNumber.extend("bizagi.rendering.desktop.rangeNumber",{},{postRender:function(){this.defineRangeControl()}}),$.Class.extend("bizagi.rendering.entityTemplate",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.getFormContainer();this.deferredActions=new $.Deferred,this.deferredActions.promise(),this.processPropertyValueArgs={pcaseId:this.getIdCase(),pguidEntity:this.properties.guidEntity,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,property:"data",psurrogatedKey:this.properties.surrogatedKey},this.properties.valueWidth=100,this.properties.displayType="value",this.properties.allowactions=void 0===e.properties.allowactions||e.properties.allowactions,this.properties.value?"string"==typeof this.properties.value&&(this.properties.value=this.value=JSON.parse(this.properties.value)):this.properties.value=this.value=[]},renderControl:function(){var e,t="";return"design"==this.getMode()?(e=this.renderFactory.getTemplate("render-entityTemplate-design"),t=$.fasttmpl(e,{})):this.properties.surrogatedKey&&(e=this.renderFactory.getTemplate("render-entityTemplate"),t=$.fasttmpl(e,{allowactions:this.properties.allowactions})),t},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t},setDisplayValue:function(e){this.getControl();this.setValue(e,!1)}}),bizagi.rendering.desktop.actionLauncher.extend("bizagi.rendering.desktop.entityTemplate",{},{initializeData:function(e){var t=(e=e||{}).properties||{};this._super(e),this.properties.allowactions=void 0!==t.allowactions&&bizagi.util.parseBoolean(t.allowactions),this.properties.templatetype=void 0!==t.templatetype?t.templatetype:"default"},postRender:function(){var e=this,t=e.properties,i=e.getMode(),r=e.getControl();if("design"==i||!e.properties.surrogatedKey)return"";e.configureQueueVisibility(),$.when(e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs)).done((function(i){void 0!==i.templateGuid&&i.templateGuid&&(i.isDefaultTemplate=!1,i.guidTemplate=i.templateGuid,delete i.templateGuid),$.when(e.engine.render(i,e.processPropertyValueDataTmplArgs)).done((function(i){var a=i,n=$(".bz-action-launcher-actions-container",r);if(i=e.renderFactory.getTemplate("render-actionLauncher-horizontal"),t.allowactions)$.when(e.dataService.multiaction().getActions(e.processPropertyValueArgs)).done((function(r){e.deferredActions.resolve(r);var o=bizagi.clone(r),s=e.moreActionsManager(o),l=s.isMoreActions;o=s.actions;var d=$.fasttmpl(i,{actions:o,template:!0,isMoreActions:l,allowactions:t.allowactions});n.append(d),n.find(".actions-container.actions-container-template").append(a),e.configureHandlers()})).fail((function(e){}));else{var o=$.fasttmpl(i,{template:!0,allowactions:t.allowactions});n.append(o),n.find(".actions-container.actions-container-template").append(a)}}))})).fail((function(e){})),e.engine.subscribe("onLoadDataNavigation",(function(e,t){bizagi.loader.start("entity-engine-view").then((function(){t.skipRefresh=!0,$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_DIALOGNAV,data:t,modalParameters:{refreshInbox:!1,title:t.data.displayName},maximizeOnly:!1})}))}))},configureHandlers:function(){var e=this,t=e.getFormContainer();if(void 0===t.params.printversion||0==t.params.printversion){var i=e.getControl(),r=(e.properties,$(".action-launcher-control",i));e.configureMoreActionsHandler(),r.on("click",(function(){var t={guidProcess:$(this).data("guidprocess"),guidAction:$(this).data("guidaction"),displayName:$(this).data("display-name"),actionType:$(this).data("action-type"),xpathContext:$(this).data("xpathcontext"),xpathActions:e.properties.xpathActions||""};"Form"===t.actionType&&(t.xpathContext=void 0,t.contextType="entitytemplate",t.guidEntity=e.properties.guidEntity),e.onActionClicked(t)}))}}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.checkList",bizagi.rendering.checkList.prototype),bizagi.rendering.desktop.checkList.extend("bizagi.rendering.desktop.checkList",{},{postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-display-block"),this.properties.unique=Math.ceil(1e3*Math.random()),$(".ui-bizagi-render-checkList-label",this.checkListGroup).check()},configureHandlers:function(){var e=this;e._super(),bizagi.util.isIE(),$("input[type=checkbox]",e.checkListGroup).bind("change",(function(t,i){var r=$(this).data("item-guid"),a=$(this).is(":checked");e.updateDisplay($(this),a),e.onCheckListGroupChange(r,a)}))},updateDisplay:function(e,t){var i=e.closest(".ui-bizagi-render-checkList-item");t?i.addClass("checked"):i.removeClass("checked")},onCheckListGroupChange:function(e,t){var i,r=$.grep(this.properties.items,(function(t,i){return t.guid===e}));r&&r.length>0&&(i=r[0]),i.checked=t},clearDisplayValue:function(){bizagi.util.isIE()?$("input[type=checkbox]",this.checkListGroup).removeAttr("checked"):$("input[type=checkbox]",this.checkListGroup).check("uncheckItem")},setDisplayValue:function(e){}}),bizagi.rendering.desktop.checkList.extend("bizagi.rendering.desktop.activityCheckList",{},{postRender:function(){this.getControl();this._super(),this.addButton=$(".ui-bizagi-render-checkList-add-item",this.element),this.newItemName=$(".ui-bizagi-render-checkList-input-name",this.control),this.separator=$(".ui-bizagi-render-checkList-separator",this.element),this.goalActivity=$(".ui-bizagi-render-checkList-goal-activity",this.element),this.additionalElements(),this.notifyLoadItems()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("checkList-disabled");return $.fasttmpl(e,{items:this.value})},additionalElements:function(){this.getControl(),this.getResource("render-activity-check-list-activitywork"),this.properties.activityWork,this.getResource("render-activity-check-list-form");if(!(this.addButton&&this.addButton.length>0)){var e=$("<div/>").addClass("ui-bizagi-render-checkList-add-item");e.append($("<h4 />").text(bizagi.localization.getResource("workportal-project-plan-activity-work-title"))),e.append($("<button class=''/>").text("+ "+bizagi.localization.getResource("workportal-project-plan-activity-action-add"))),this.element.prepend(e)}this.separator&&this.separator.length>0||this.element.append($("<div/>").addClass("ui-bizagi-render-checkList-separator").append($("<span/>"))),this.goalActivity&&this.goalActivity.length>0||this.properties.activityDescription&&""!==this.properties.activityDescription&&this.element.prepend($("<div/>").addClass("ui-bizagi-render-checkList-goal-activity").append("<h3><span class='ui-bizagi-wp-bold'>"+bizagi.localization.getResource("workportal-project-plan-activity-goal")+": </span><span>"+this.properties.activityDescription+"</span></h3>"))},notifyLoadItems:function(){var e=this;setTimeout((function(){e.triggerGlobalHandler("onLoadDataItemsFromFormActivityPlan",{items:e.properties.items,activityWork:e.properties.activityWork})}),100)},configureHandlers:function(){var e=this;e.getControl();this._super(),$(".ui-bizagi-render-checkList-add-item button",e.element).unbind("click").click((function(){var t=$(".ui-bizagi-render-checkList-item.selected",e.control);t.length<=0?e.prepareNewItem():$(".ui-bizagi-render-checkList-input-name",t).focus()})),$(".item-button.delete",e.checkListGroup).bind("click",(function(t,i){var r=$(this).closest(".ui-bizagi-render-checkList-item").data("item-guid");e.deleteItem(r)})),$("label.item-name",e.checkListGroup).bind("click",(function(t,i){var r=$(this).closest(".ui-bizagi-render-checkList-item").data("item-guid");e.selectItem(r)}))},selectItem:function(e){for(var t=0;t<this.properties.items.length;t++)this.properties.items[t].guid===e?this.properties.items[t].selected=!0:this.properties.items[t].selected=!1;this.repaintControl();var i=$(".ui-bizagi-render-checkList-item.selected"),r=$(".ui-bizagi-render-checkList-input-name",i),a=r.val();r.focus(),r[0].setSelectionRange(a.length,a.length),this.configureHandlers(),this.addSelectedHandlers()},deleteItem:function(e){for(var t=0;t<this.properties.items.length;t++)if(this.properties.items[t].guid===e){this.properties.items.splice(t,1);break}this.setValue(this.properties.items),this.repaintControl(),this.configureHandlers(),this.refreshValue(this.properties.items)},prepareNewItem:function(){var e={guid:Math.guid(),resolved:!1,name:"",selected:!0};this.properties.items.push(e),this.repaintControl(),this.configureHandlers(),this.addSelectedHandlers()},addSelectedHandlers:function(){var e=this,t=$(".ui-bizagi-render-checkList-item.selected",e.control),i=$(".ui-bizagi-render-checkList-input-name",t);i.focus(),i.blur((function(){var t=i.val();t&&""!==t?e.addItem():(e.properties.items.splice(e.properties.items.length-1,1),e.setValue(e.properties.items),e.repaintControl(),e.configureHandlers())})),i.keypress((function(t){if(13==t.which){t.preventDefault();var r=i.val();r&&""!==r&&(e.addItem(),e.prepareNewItem())}}))},addItem:function(){this.getControl();var e=$(".ui-bizagi-render-checkList-item.selected",this.control),t=$(".ui-bizagi-render-checkList-input-name",e).val();this.addButton.show(),$.each(this.properties.items,(function(e,i){i.selected&&(i.name=t,i.selected=!1)})),this.updateOriginalValue(),this.setValue(this.properties.items),this.repaintControl(),this.configureHandlers(),this.refreshValue(this.properties.items)},repaintControl:function(){this.getControl();var e=this.renderControl();$(".ui-bizagi-render-checkList",this.control).replaceWith(e),this.postRender()},onCheckListGroupChange:function(e,t){var i,r=$.grep(this.properties.items,(function(t,i){return t.guid===e}));r&&r.length>0&&(i=r[0]),i.resolved=t,this.setValue(this.properties.items),this.refreshValue(this.properties.items)},refreshValue:function(e){this.getControl();for(var t=e.length,i=0,r=0;r<t;r++)e[r].resolved&&(i+=1);this.properties.activityWork=t>0?Math.floor(100*i/t):0;var a=this.getResource("render-activity-check-list-activitywork")+" ("+this.properties.activityWork+"%)";$(".ui-bizagi-render-checkList-activity-work span",this.element).html(a),this.triggerGlobalHandler("onLoadDataItemsFromFormActivityPlan",{items:this.properties.items,activityWork:this.properties.activityWork})},getValue:function(e){return this.value||[]},controlValueIsChanged:function(){return JSON.stringify(this.properties.originalValue)!==JSON.stringify(this.value)},allCheckedItems:function(){var e=!1;return Array.isArray(this.value)&&(e=this.value.every((function(e){return 1==e.resolved}))),e},updateOriginalValue:function(){this.properties.originalValue=bizagi.clone(this.value)},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=this.properties.idActivity,n=!0,o=this.getFormContainer().getLastActionButton();if(o&&"next"==o.action&&(n=this.allCheckedItems()),this.controlValueIsChanged()&&n&&!bizagi.util.isEmpty(i)&&!bizagi.util.isEmpty(a))if(Array.isArray(r)){var s={idActivity:a,items:r};e[t.xpath]=JSON.stringify(s)}else""===r&&(e[t.xpath]="")},isValid:function(e){var t,i=this.properties,r=this.getValue(),a=!0;t=this.getResource("render-activity-check-list-validation");for(var n=0;n<r.length;n+=1){if(!r[n].resolved){e.push({xpath:i.xpath,message:t}),a=!1;break}}return a}}),$.Class.extend("bizagi.rendering.polymorphicLauncher",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.getFormContainer();this.typeForm=t.properties.typeForm||"";this.getMode();this.deferredActions=new $.Deferred,this.deferredActions.promise(),this.properties.valueWidth=100,this.properties.displayType="value",this.properties.allowSearch=void 0!==e.properties.allowSearch&&e.properties.allowSearch,this.properties.additionalXpath=this.properties.additionalXpath||[],this.properties.value?"string"==typeof this.properties.value&&(this.properties.value=this.value=JSON.parse(this.properties.value)):(this.properties.value=this.value=[],this.properties.originalValue=[]),this.processPropertyValueArgs={pcaseId:this.getIdCase(),pguidEntity:this.properties.guidEntity,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,property:"data",ptags:this.getTagList(this.properties.tagslist),additionalXpaths:this.properties.additionalXpath}},executeActionImmediately:function(e){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeConstructor",psurrogatedKey:t.properties.surrogatedKey,pguidConstructor:e.guidConstructor,pparameters:JSON.encode({idStartScope:e.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:e.idPageCache})};t.dataService.executeActions(r).done((function(i){t.notifyExecution(i.response,e)})).fail((function(i){t.notifyExecution("Error",e)}))},notifyExecution:function(e,t){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0,this.postRender()},renderControl:function(){var e,t=this.properties,i="";if("design"==this.getMode()){e=this.renderFactory.getTemplate("render-polymorphicLauncher-design");var r={type:t.type,allowSearch:t.allowSearch};i=$.fasttmpl(e,r)}else t.surrogatedKey&&(e=this.renderFactory.getTemplate("render-polymorphicLauncher"),i=$.fasttmpl(e));return i},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t},setDisplayValue:function(e){this.setValue(e,!1)},actionManager:function(e){var t=this,i=e.guidObject||"",r=new $.Deferred;switch(e.recordXpath=t.getFormContainer().properties.recordXpath,e.actionType){case"Process":var a={guidWFClass:i};$.when(t.dataService.hasStartForm(a)).done((function(a){a.hasStartForm?$.when(t.processStartForm({guidprocess:i,title:e.displayNamee,recordXpath:e.recordXpath})).done((function(t){e.idStartScope=t,r.resolve(e)})):r.resolve(e)}));break;case"Rule":r.resolve(e);break;case"Form":$.when(t.processActionForm(e)).done((function(t){e.idStartScope=t,r.resolve(e)}))}return r.promise()},addActionToQueue:function(e){var t=this.getValue(),i=this.getFormContainer().getParams();e.params=e.params||{};var r=this.properties.xpathContext;switch(e.actionType){case"Process":e.params={additionalXpaths:this.properties.additionalXpath.join(","),idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,recordXpath:r},void 0!==e.idStartScope&&(e.params.idStartScope=e.idStartScope);break;case"Form":e.params={idStartScope:e.idStartScope,additionalXpaths:this.properties.additionalXpath.join(","),entityXpath:this.properties.xpathActions,idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,idEntity:e.idEntity,guidEntity:e.guidEntity}}t.push(e),this.setValue(t),this.setDisplayValue(t)},removeActionToQueue:function(e){var t=this.getValue();t.splice(e,1),this.setValue(t),this.setDisplayValue(t)},collectData:function(e){if(this.controlValueIsChanged()){var t=this.properties.xpath,i=this.getValue(),r=[];$.each(i,(function(e,t){var i={};i.params=t.params||{},i.guidAction=t.guidObject||t.guidAction,i.displayName=t.displayName,i.guidConstructor=t.guidConstructor,i.actionType=t.actionType,i.xpathContext=t.xpathContext,i.guidEntity=t.guidEntity,r.push(i)})),e[t]=0==r.length?"":JSON.encode(r)}},countSameActions:function(e){var t=this.getValue(),i=0;return $.each(t,(function(t,r){r.guidAction==e.guidAction&&i++})),i},getTagList:function(e){for(var t=[],i=(e=e||[]).length;i>0;i--)t.push(e[i-1].value);return t.length>0?t:""}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.polymorphicLauncher",bizagi.rendering.polymorphicLauncher.prototype),bizagi.rendering.desktop.polymorphicLauncher.extend("bizagi.rendering.desktop.polymorphicLauncher",{},{postRender:function(){var e,t=this,i=t.properties,r=t.getMode(),a=new $.Deferred;if("design"==r||!t.properties.surrogatedKey)return"";return t.configureQueueVisibility(),$.when(t.dataService.multiaction().getPolymorphicActions(t.processPropertyValueArgs)).done((function(r){r=t.dataService.serializePolymorphicActions(r),t.totalActions=bizagi.clone(r);var n=bizagi.clone(r);t.lessActions=bizagi.clone(n);var o={actions:n,allowSearch:i.allowSearch,treeActionsList:t.getTreeItems(n)};!function(i,r){var n=t.getControl(),o=$(".bz-action-launcher-actions-container",n);e=$.fasttmpl(i,r),o.append(e),!0!==t.properties.readOnly&&t.configureHandlers(),a.resolve(o)}(t.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree"),o)})).fail((function(e){a.fail(e)})),a.promise()},getTreeItems:function(e,t){var i=this,r="<ul>",a=i.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree-item");return e=e||{},t=t||1,$.each(e,(function(e,n){r+=$.fasttmpl(a,n),n.children&&(r+=i.getTreeItems(n.children,t+1))})),r+="</ul>"},configureHandlers:function(){var e=this,t=e.getControl(),i=e.getFormContainer();void 0!==i.params.printversion&&0!=i.params.printversion||($(".ui-bizagi-render-polymorphicLauncher-list li>span",t).on("click",(function(){var t=$(this).parent(),i={guidEntity:t.data("guidentity"),guidObject:t.data("guidobject"),guidConstructor:t.data("guidconstructor"),displayName:t.data("display-name"),actionType:t.data("action-type"),xpathContext:t.data("xpathcontext")};e.onActionClicked(i)})),$.expr[":"].FilterAction=function(e,t,i){var r=i[3];return!!r&&new RegExp(r,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup((function(){var e=$(this).val();e?($("li",t).hide(0),$("li[data-hasconstructor='true']",t).filter(":FilterAction("+e+")").show(0,(function(){var e=$("label",this).html(),t=$(this),i=t.data("parents")+t.data("title");t.data("cachedvalue")||t.data("cachedvalue",e),$("label",this).html(i)}))):$("li",t).show(0,(function(){var e=$(this).data("cachedvalue");$("label",this).html(e)}))})))},onActionClicked:function(e){var t=this;$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))},notifyExecution:function(e,t){var i=new bizagi.INotifications;"success"==e?i.showSucessMessage(printf(this.getResource("render-action-launcher-success-excecution"),t.displayName),null,{}):i.showErrorMessage(printf(this.getResource("render-action-launcher-failed-excecution"),t.displayName),null,{})},processActionForm:function(e){var t,i=this,r=i.properties,a=i.getFormContainer(),n=i.properties.additionalXpath.join(","),o=new $.Deferred;e.xpathContext;"polymorphicLauncher"!==i.properties.type&&(t="object"==_typeof(i.properties.surrogatedKey)&&i.properties.surrogatedKey.length>1?i.properties.surrogatedKey:i.properties.surrogatedKey[0]);var s=i.properties.recordXpath,l=new bizagi.rendering.dialog.form(i.dataService,i.renderFactory,{title:r.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(t){var r=t.idPageCache;return t.idPageCache=null,i.dataService.multiaction().submitData({action:"SAVE",data:t,xpathContext:l.form.properties.xpathContext,idPageCache:r,isOfflineForm:!1,isActionStartForm:!0}).pipe((function(t){e.editMode||0!=i.countSameActions(e)||(e.idStartScope=t.IdScope),o.resolve(t.IdScope)}))},onCancel:function(e){}});return l.render({idForm:e.guidObject,contextType:"entity",guidEntity:e.guidEntity,idCase:i.properties.caseId,idWorkitem:"SummaryForm"!=a.properties.typeForm?bizagi.context.idWorkitem:void 0,additionalXpaths:n,idStartScope:e.idStartScope,surrogateKey:t,recordXpath:s}),o.promise()},processStartForm:function(e){var t,i=this,r=i.properties,a=i.getFormContainer(),n=new $.Deferred;return"polymorphicLauncher"!==i.properties.type&&(t="object"==_typeof(i.properties.surrogatedKey)&&i.properties.surrogatedKey.length>1?i.properties.surrogatedKey:i.properties.surrogatedKey[0]),e=e||{},new bizagi.rendering.dialog.startForm(i.dataService,i.renderFactory,{maximized:r.maximized,title:e.title||"",saveButtonLabel:"GlobalForm"==i.typeForm||"SummaryForm"==this.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return a.startLoading(),i.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:i.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe((function(e){a.endLoading(),n.resolve(e.IdScope)}))}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:i.properties.caseId,idWorkitem:"SummaryForm"!=a.properties.typeForm?bizagi.context.idWorkitem:void 0,additionalXpaths:i.properties.additionalXpath.join(","),surrogatedKey:t,recordXpath:e.recordXpath,mappingstakeholders:!0}),n.promise()},executeAction:function(e){var t=this;"GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm?$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation"),null,!1)).done((function(i){t.executeActionImmediately(e)})):t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this;t.confirmTemplate=t.renderFactory.getTemplate("render-polymorphicLauncher-confirm");var i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation"),r=$.tmpl(t.confirmTemplate,{confirmationMessage:i}),a={resizable:!1,modal:!0,title:"Bizagi",buttons:[]};a.buttons=[{text:bizagi.localization.getResource("render-boolean-yes"),click:function(){t.setValue([]),$.when(t.actionManager(e)).done((function(e){t.executeAction(e)})),$(this).dialog("close")}},{text:bizagi.localization.getResource("render-boolean-no"),click:function(){$(this).dialog("close")}}],$(r).dialog(a)},setDisplayValue:function(e){var t=this,i=t.getControl(),r=$(".bz-action-launcher-actions-to-execute-container",i),a=t.renderFactory.getTemplate("render-polymorphicLauncher-actions-to-execute");t.configureQueueVisibility(),$.when($.fasttmpl(a,{actions:e})).done((function(e){r.empty(),r.append(e);var i=$(".action-to-execute-control i",r),a=$(".action-to-execute-control label",r);i.bind("click",(function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)})),a.bind("click",(function(){var e=$(this).parent(),i=e.data("actiontype"),r=e.data("guidprocess"),a=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("identity")||"",l=e.data("guidentity"),d=o||t.properties.xpathContext;switch(i){case"Process":a&&t.processStartForm({guidprocess:r,idStartScope:a,title:n,xpathContext:o,recordXpath:d});break;case"Form":var u={guidProcess:r,idStartScope:a,editMode:!0,xpathContext:o,idEntity:s,guidEntity:l,guidObject:r};t.processActionForm(u)}}))}))},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-action-launcher-actions-to-execute-container",e),i=$(".actions-to-execute-title",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),function(e){function t(t,i){function m(t){l=e("li.dw-v",t).eq(0).index(),d=e("li.dw-v",t).eq(-1).index(),s=$.height,u=S}function b(){S.temp=B&&null!==S.val&&S.val!=t.val()||null===S.values?$.parseValue(t.val()?t.val():"",S):S.values.slice(0),S.setValue(!0)}function C(t,i,r,a,n){$.validate.call(k,D,r),e(".dww ul",D).each((function(a){var o=e(this),s=(o=(l=e('li[data-val="'+S.temp[a]+'"]',o)).index(),l),l=o;if(!s.hasClass("dw-v")){for(var d=s,u=0,c=0;d.prev().length&&!d.hasClass("dw-v");)d=d.prev(),u++;for(;s.next().length&&!s.hasClass("dw-v");)s=s.next(),c++;c<u&&c&&1==!n||!u||!d.hasClass("dw-v")||1==n?l+=c:(s=d,l-=u),S.temp[a]=s.data("val")}o==l&&a!=r&&void 0!==r||S.scroll(e(this),l,a==r?t:0,i,a)})),S.change(a)}function R(){var t,i,r=0,a=0,n=e(window).width(),o=e(window).height(),s=e(window).scrollTop(),l=e(".dwo",D),d=e(".dw",D);e(".dwc",D).each((function(){t=e(this).outerWidth(!0),r+=t,a=t>a?t:a})),t=r>n?a:r,d.width(t),t=d.outerWidth(),i=d.outerHeight(),d.css({left:(n-t)/2,top:s+(o-i)/2}),l.height(0).height(function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}())}function E(e){var t=+e.data("pos")+1;n(e,t>d?l:t,1)}function F(e){var t=+e.data("pos")-1;n(e,t<l?d:t,2)}var _,P,D,S=this,k=t,$=(t=e(k),e.extend({},w)),I={},V={},B=t.is("input"),O=!1;S.enable=function(){$.disabled=!1,B&&t.prop("disabled",!1)},S.disable=function(){$.disabled=!0,B&&t.prop("disabled",!0)},S.scroll=function(e,t,i,r,a){var n=(P-t)*$.height;if(e.attr("style",(i?z+"-transition:all "+i.toFixed(1)+"s ease-out;":"")+(x?z+"-transform:translate3d(0,"+n+"px,0);":"top:"+n+"px;")),i){var o=0;clearInterval(I[a]),I[a]=setInterval((function(){o+=.1,e.data("pos",Math.round((t-r)*Math.sin(o/i*(Math.PI/2))+r)),o>=i&&(clearInterval(I[a]),e.data("pos",t))}),100),clearTimeout(V[a]),V[a]=setTimeout((function(){"mixed"==$.mode&&!e.hasClass("dwa")&&e.closest(".dwwl").find(".dwwb").fadeIn("fast")}),1e3*i)}else e.data("pos",t)},S.setValue=function(e,i,r){var a=$.formatResult(S.temp);S.val=a,S.values=S.temp.slice(0),O&&e&&C(r),i&&B&&t.val(a).trigger("change")},S.validate=function(e,t,i,r){C(e,t,i,!0,r)},S.change=function(t){var i=$.formatResult(S.temp);"inline"==$.display?S.setValue(!1,t):e(".dwv",D).html(function(e){var t=$.headerText;return t?"function"==typeof t?t.call(k,e):t.replace(/{value}/i,e):""}(i)),t&&$.onChange.call(k,i,S)},S.hide=function(){if(!1===$.onClose.call(k,S.val,S))return!1;e(".dwtd").prop("disabled",!1).removeClass("dwtd"),t.blur(),D&&D.remove(),O=!1,e(window).unbind(".dw")},S.show=function(){if($.disabled||O)return!1;var i=$.height,a=$.rows*i;b();for(var s='<div class="'+$.theme+'">'+("inline"==$.display?'<div class="dw dwbg dwi"><div class="dwwr">':'<div class="dwo"></div><div class="dw dwbg"><div class="dwwr">'+($.headerText?'<div class="dwv"></div>':"")),l=0;l<$.wheels.length;l++){var d;s=s+'<div class="dwc'+("scroller"!=$.mode?" dwpm":" dwsc")+($.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>';for(d in $.wheels[l]){var u;s=s+'<td><div class="dwwl dwrc">'+("scroller"!=$.mode?'<div class="dwwb dwwbp" style="height:'+i+"px;line-height:"+i+'px;"><span>+</span></div><div class="dwwb dwwbm" style="height:'+i+"px;line-height:"+i+'px;"><span>&ndash;</span></div>':"")+'<div class="dwl">'+d+'</div><div class="dww dwrc" style="height:'+a+"px;min-width:"+$.width+'px;"><ul>';for(u in $.wheels[l][d])s+='<li class="dw-v" data-val="'+u+'" style="height:'+i+"px;line-height:"+i+'px;">'+$.wheels[l][d][u]+"</li>";s+='</ul><div class="dwwo"></div></div><div class="dwwol"></div></div></td>'}s+="</tr></table></div></div>"}s+=("inline"!=$.display?'<div class="dwbc"><span class="dwbw dwb-s"><a href="#" class="dwb">'+$.setText+'</a></span><span class="dwbw dwb-c"><a href="#" class="dwb">'+$.cancelText+"</a></span></div>":'<div class="dwcc"></div>')+"</div></div></div>",D=e(s),C(),"inline"!=$.display?D.appendTo("body"):t.is("div")?t.html(D):D.insertAfter(t),O=!0,_.init(D,S),"inline"!=$.display&&(e(".dwb-s a",D).click((function(){return S.setValue(!1,!0),S.hide(),$.onSelect.call(k,S.val,S),!1})),e(".dwb-c a",D).click((function(){return S.hide(),$.onCancel.call(k,S.val,S),!1})),e("input,select").each((function(){e(this).prop("disabled")||e(this).addClass("dwtd")})),e("input,select").prop("disabled",!0),R(),e(window).bind("resize.dw",R)),D.delegate(".dwwl","DOMMouseScroll mousewheel",(function(t){if(!$.readonly){t.preventDefault();t=(t=t.originalEvent).wheelDelta?t.wheelDelta/120:t.detail?-t.detail/3:0;var i=e("ul",this),r=+i.data("pos");r=Math.round(r-t);m(i),n(i,r,t<0?1:2)}})).delegate(".dwb, .dwwb",T,(function(){e(this).addClass("dwb-a")})).delegate(".dwwb",T,(function(t){if(!$.readonly){t.preventDefault(),t.stopPropagation();var i=e(this).closest(".dwwl").find("ul");func=e(this).hasClass("dwwbp")?E:F,m(i),clearInterval(o),o=setInterval((function(){func(i)}),$.delay),func(i)}})).delegate(".dwwl",T,(function(t){v||"clickpick"==$.mode||$.readonly||(t.preventDefault(),v=!0,y=e("ul",this).addClass("dwa"),"mixed"==$.mode&&e(".dwwb",this).fadeOut("fast"),g=+y.data("pos"),m(y),c=r(t),h=new Date,p=c,S.scroll(y,g))})),$.onShow.call(k,D,S)},S.init=function(i){_=e.extend({defaults:{},init:f},e.scroller.themes[i.theme?i.theme:$.theme]),e.extend($,_.defaults,i),S.settings=$,P=Math.floor($.rows/2);var r=e.scroller.presets[$.preset];t.unbind(".dw"),r&&(r=r.call(k,S),e.extend($,r,i),e.extend(A,r.methods)),void 0!==t.data("dwro")&&(k.readOnly=a(t.data("dwro"))),O&&S.hide(),"inline"==$.display?S.show():(b(),B&&$.showOnFocus&&(t.data("dwro",k.readOnly),k.readOnly=!0,t.bind("focus.dw",S.show)))},S.values=null,S.val=null,S.temp=null,S.init(i)}function i(e){for(var t in e)if(void 0!==C[e[t]])return!0;return!1}function r(e){return R?e.originalEvent?e.originalEvent.changedTouches[0].pageY:e.changedTouches[0].pageY:e.pageY}function a(e){return!0===e||"true"==e}function n(t,i,r,a,n){var o=t.closest(".dwwr").find("ul").index(t);i=(i=i>d?d:i)<l?l:i,t=e("li",t).eq(i);u.temp[o]=t.data("val"),u.validate(a?i==n?.1:Math.abs(.1*(i-n)):0,n,o,r)}var o,s,l,d,u,c,p,h,g,m={},f=function(){},b=(new Date).getTime(),v=!1,y=null,C=document.createElement(C).style,x=i(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"])&&"webkitPerspective"in document.documentElement.style,z=function(){var e,t=["Webkit","Moz","O","ms"];for(e in t)if(i([t[e]+"Transform"]))return"-"+t[e].toLowerCase();return""}(),R="ontouchstart"in window,T=R?"touchstart":"mousedown",E=R?"touchend":"mouseup",w={width:70,height:40,rows:3,delay:300,disabled:!1,readonly:!1,showOnFocus:!0,showLabel:!0,wheels:[],theme:"",headerText:"{value}",display:"modal",mode:"scroller",preset:"",setText:"Set",cancelText:"Cancel",onShow:f,onClose:f,onSelect:f,onCancel:f,onChange:f,formatResult:function(e){for(var t="",i=0;i<e.length;i++)t+=(0<i?" ":"")+e[i];return t},parseValue:function(e,t){for(var i=t.settings.wheels,r=(e=e.split(" "),[]),a=0,n=0;n<i.length;n++)for(var o in i[n]){if(void 0!==i[n][o][e[a]])r.push(e[a]);else for(var s in i[n][o]){r.push(s);break}a++}return r},validate:f},A={init:function(e){return void 0===e&&(e={}),this.each((function(){this.id||(b+=1,this.id="scoller"+b),m[this.id]=new t(this,e)}))},enable:function(){return this.each((function(){var e=m[this.id];e&&e.enable()}))},disable:function(){return this.each((function(){var e=m[this.id];e&&e.disable()}))},isDisabled:function(){var e=m[this[0].id];if(e)return e.settings.disabled},option:function(e,t){return this.each((function(){var i=m[this.id];if(i){var r={};"object"===_typeof(e)?r=e:r[e]=t,i.init(r)}}))},setValue:function(e,t,i){return this.each((function(){var r=m[this.id];r&&(r.temp=e,r.setValue(!0,t,i))}))},getInst:function(){return m[this[0].id]},getValue:function(){var e=m[this[0].id];if(e)return e.values},show:function(){var e=m[this[0].id];if(e)return e.show()},hide:function(){return this.each((function(){var e=m[this.id];e&&e.hide()}))},destroy:function(){return this.each((function(){var t=m[this.id];t&&(t.hide(),e(this).unbind(".dw"),delete m[this.id],e(this).is("input")&&(this.readOnly=a(e(this).data("dwro"))))}))}};e(document).bind(R?"touchmove":"mousemove",(function(e){v&&(e.preventDefault(),p=r(e),e=(e=(e=g+(c-p)/s)>d+1?d+1:e)<l-1?l-1:e,u.scroll(y,e))})),e(document).bind(E,(function(t){if(v){t.preventDefault(),y.removeClass("dwa");var i=new Date-h;t=(t=(t=g+(c-p)/s)>d+1?d+1:t)<l-1?l-1:t;300>i?(i=(i=(p-c)/i)*i/.0012,0>p-c&&(i=-i)):i=p-c,n(y,Math.round(g-i/s),0,!0,Math.round(t)),v=!1,y=null}clearInterval(o),e(".dwb-a").removeClass("dwb-a")})),e.fn.scroller=function(t){return A[t]?A[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==_typeof(t)&&t?void e.error("Unknown method"):A.init.apply(this,arguments)},e.scroller={setDefaults:function(t){e.extend(w,t)},presets:{},themes:{}}}(jQuery),function(e){var t={dateFormat:"mm/dd/yy",dateOrder:"mmddy",timeWheels:"hhiiA",timeFormat:"hh:ii A",startYear:(i=new Date).getFullYear()-100,endYear:i.getFullYear()+1,monthNames:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),monthNamesShort:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),dayNames:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),dayNamesShort:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",stepHour:1,stepMinute:1,stepSecond:1,separator:" "},i=function(i){function r(e,t,i){return void 0!==p[t]?+e[p[t]]:void 0!==i?i:x[h[t]]?x[h[t]]():h[t](x)}function a(e,t){return Math.floor(e/t)*t}function n(e){var t=r(e,"h",0);return new Date(r(e,"y"),r(e,"m"),r(e,"d"),r(e,"ap")?t+12:t,r(e,"i",0),r(e,"s",0))}var o;if((l=e(this)).is("input")){switch(l.attr("type")){case"date":o="yy-mm-dd";break;case"datetime":o="yy-mm-ddTHH:ii:ssZ";break;case"datetime-local":o="yy-mm-ddTHH:ii:ss";break;case"month":o="yy-mm",t.dateOrder="mmyy";break;case"time":o="HH:ii:ss"}var s=l.attr("min"),l=l.attr("max");s&&(t.minDate=e.scroller.parseDate(o,s)),l&&(t.maxDate=e.scroller.parseDate(o,l))}var d=e.extend({},t,i.settings),u=0,c=(s=[],[]),p={},h={y:"getFullYear",m:"getMonth",d:"getDate",h:function(e){return e=e.getHours(),a(e=y&&12<=e?e-12:e,z)},i:function(e){return a(e.getMinutes(),R)},s:function(e){return a(e.getSeconds(),T)},ap:function(e){return v&&11<e.getHours()?1:0}},g=d.preset,m=d.dateOrder,f=d.timeWheels,b=m.match(/D/),v=f.match(/a/i),y=f.match(/h/),C="datetime"==g?d.dateFormat+d.separator+d.timeFormat:"time"==g?d.timeFormat:d.dateFormat,x=new Date,z=d.stepHour,R=d.stepMinute,T=d.stepSecond,E=d.minDate,w=d.maxDate;if(o=o||C,g.match(/date/i)){e.each(["y","m","d"],(function(e,t){-1<(e=m.search(RegExp(t,"i")))&&c.push({o:e,v:t})})),c.sort((function(e,t){return e.o>t.o?1:-1})),e.each(c,(function(e,t){p[t.v]=e}));l={};for(var A=0;3>A;A++)if(A==p.y){u++,l[d.yearText]={};for(var F=E?E.getFullYear():d.startYear,_=w?w.getFullYear():d.endYear;F<=_;F++)l[d.yearText][F]=m.match(/yy/i)?F:(F+"").substr(2,2)}else if(A==p.m)for(u++,l[d.monthText]={},F=0;12>F;F++)l[d.monthText][F]=m.match(/MM/)?d.monthNames[F]:m.match(/M/)?d.monthNamesShort[F]:m.match(/mm/)&&9>F?"0"+(F+1):F+1;else if(A==p.d)for(u++,l[d.dayText]={},F=1;32>F;F++)l[d.dayText][F]=m.match(/dd/i)&&10>F?"0"+F:F;s.push(l)}if(g.match(/time/i)){if(l={},f.match(/h/i))for(p.h=u++,l[d.hourText]={},F=0;F<(y?12:24);F+=z)l[d.hourText][F]=y&&0==F?12:f.match(/hh/i)&&10>F?"0"+F:F;if(f.match(/i/))for(p.i=u++,l[d.minuteText]={},F=0;60>F;F+=R)l[d.minuteText][F]=f.match(/ii/)&&10>F?"0"+F:F;if(f.match(/s/))for(p.s=u++,l[d.secText]={},F=0;60>F;F+=T)l[d.secText][F]=f.match(/ss/)&&10>F?"0"+F:F;v&&(p.ap=u++,u=f.match(/A/),l[d.ampmText]={0:u?"AM":"am",1:u?"PM":"pm"}),s.push(l)}return{wheels:s,headerText:function(){return e.scroller.formatDate(C,n(i.temp),d)},formatResult:function(t){return e.scroller.formatDate(o,n(t),d)},parseValue:function(t){var i=new Date,r=[];try{i=e.scroller.parseDate(o,t,d)}catch(e){}for(var a in p)r[p[a]]=i[h[a]]?i[h[a]]():h[a](i);return r},validate:function(t,n){var o=i.temp,s={m:0,d:1,h:0,i:0,s:0,ap:0},l={m:11,d:31,h:a(y?11:23,z),i:a(59,R),s:a(59,T),ap:1},u=!0,c=!0;e.each(E||w?"y,m,d,ap,h,i,s".split(","):n==p.y||n==p.m||void 0===n?["d"]:[],(function(i,a){if(void 0!==p[a]){var n,g,f=s[a],v=l[a],y=31,C=r(o,a),x=e("ul",t).eq(p[a]);if("d"==a&&(n=r(o,"y"),g=r(o,"m"),v=y=32-new Date(n,g,32).getDate(),b&&e("li",x).each((function(){var t=e(this),i=t.data("val"),r=new Date(n,g,i).getDay();t.html(m.replace(/[my]/gi,"").replace(/dd/,10>i?"0"+i:i).replace(/d/,i).replace(/DD/,d.dayNames[r]).replace(/D/,d.dayNamesShort[r]))}))),u&&E&&(f=E[h[a]]?E[h[a]]():h[a](E)),c&&w&&(v=w[h[a]]?w[h[a]]():h[a](w)),"y"!=a){var z=e('li[data-val="'+f+'"]',x).index(),R=e('li[data-val="'+v+'"]',x).index();e("li",x).removeClass("dw-v").slice(z,R+1).addClass("dw-v"),"d"==a&&e("li",x).removeClass("dw-h").slice(y).addClass("dw-h"),C<f&&(C=f),C>v&&(C=v)}if(u&&(u=C==f),c&&(c=C==v),d.invalid&&"d"==a){var T=[];if(d.invalid.dates&&e.each(d.invalid.dates,(function(e,t){t.getFullYear()==n&&t.getMonth()==g&&T.push(t.getDate()-1)})),d.invalid.daysOfWeek){var A=new Date(n,g,1).getDay();e.each(d.invalid.daysOfWeek,(function(e,t){for(var i=t-A;i<y;i+=7)i>=0&&T.push(i)}))}d.invalid.daysOfMonth&&e.each(d.invalid.daysOfMonth,(function(e,t){(t=(t+"").split("/"))[1]?t[0]-1==g&&T.push(t[1]-1):T.push(t[0]-1)})),e.each(T,(function(t,i){e("li",x).eq(i).removeClass("dw-v")}))}}}))},methods:{getDate:function(t){var i=e(this).scroller("getInst");if(i)return n(t?i.temp:i.values)},setDate:function(t,i,r){return null==i&&(i=!1),this.each((function(){var a=e(this).scroller("getInst");if(a){for(var n in p)a.temp[p[n]]=t[h[n]]?t[h[n]]():h[n](t);a.setValue(!0,i,r)}}))}}}};e.scroller.presets.date=i,e.scroller.presets.datetime=i,e.scroller.presets.time=i,e.scroller.formatDate=function(i,r,a){if(!r)return null;a=e.extend({},t,a);for(var n=function(e){for(var t=0;u+1<i.length&&i.charAt(u+1)==e;)t++,u++;return t},o=function(e,t,i){if(t=""+t,n(e))for(;t.length<i;)t="0"+t;return t},s=function(e,t,i,r){return n(e)?r[t]:i[t]},l="",d=!1,u=0;u<i.length;u++)if(d)"'"!=i.charAt(u)||n("'")?l+=i.charAt(u):d=!1;else switch(i.charAt(u)){case"d":l+=o("d",r.getDate(),2);break;case"D":l+=s("D",r.getDay(),a.dayNamesShort,a.dayNames);break;case"o":l+=o("o",(r.getTime()-new Date(r.getFullYear(),0,0).getTime())/864e5,3);break;case"m":l+=o("m",r.getMonth()+1,2);break;case"M":l+=s("M",r.getMonth(),a.monthNamesShort,a.monthNames);break;case"y":l+=n("y")?r.getFullYear():(10>r.getYear()%100?"0":"")+r.getYear()%100;break;case"h":var c=r.getHours();l=l+o("h",12<c?c-12:0==c?12:c,2);break;case"H":l+=o("H",r.getHours(),2);break;case"i":l+=o("i",r.getMinutes(),2);break;case"s":l+=o("s",r.getSeconds(),2);break;case"a":l+=11<r.getHours()?"pm":"am";break;case"A":l+=11<r.getHours()?"PM":"AM";break;case"'":n("'")?l+="'":d=!0;break;default:l+=i.charAt(u)}return l},e.scroller.parseDate=function(i,r,a){var n=new Date;if(!i||!r)return n;r="object"==_typeof(r)?r.toString():r+"";for(var o=e.extend({},t,a),s=(a=n.getFullYear(),n.getMonth()+1),l=n.getDate(),d=-1,u=n.getHours(),c=(n=n.getMinutes(),0),p=-1,h=!1,g=function(e){return(e=v+1<i.length&&i.charAt(v+1)==e)&&v++,e},m=function(e){return g(e),(e=r.substr(b).match(RegExp("^\\d{1,"+("@"==e?14:"!"==e?20:"y"==e?4:"o"==e?3:2)+"}")))?(b+=e[0].length,parseInt(e[0],10)):0},f=function(e,t,i){for(e=g(e)?i:t,t=0;t<e.length;t++)if(r.substr(b,e[t].length).toLowerCase()==e[t].toLowerCase())return b+=e[t].length,t+1;return 0},b=0,v=0;v<i.length;v++)if(h)"'"!=i.charAt(v)||g("'")?b++:h=!1;else switch(i.charAt(v)){case"d":l=m("d");break;case"D":f("D",o.dayNamesShort,o.dayNames);break;case"o":d=m("o");break;case"m":s=m("m");break;case"M":s=f("M",o.monthNamesShort,o.monthNames);break;case"y":a=m("y");break;case"H":u=m("H");break;case"h":u=m("h");break;case"i":n=m("i");break;case"s":c=m("s");break;case"a":p=f("a",["am","pm"],["am","pm"])-1;break;case"A":p=f("A",["am","pm"],["am","pm"])-1;break;case"'":g("'")?b++:h=!0;break;default:b++}if(100>a&&(a+=(new Date).getFullYear()-(new Date).getFullYear()%100+(a<=o.shortYearCutoff?0:-100)),-1<d)for(s=1,l=d;;){if(l<=(o=32-new Date(a,s-1,32).getDate()))break;s++,l-=o}if((u=new Date(a,s-1,l,-1==p?u:p&&12>u?u+12:p||12!=u?u:0,n,c)).getFullYear()!=a||u.getMonth()+1!=s||u.getDate()!=l)throw"Invalid date";return u}}(jQuery),function(e){var t={inputClass:""};e.scroller.presets.select=function(i){var r=e.extend({},t,i.settings),a=e(this),n=this.id+"_dummy";e('label[for="'+this.id+'"]').attr("for",n);var o=(o=e('label[for="'+n+'"]')).length?o.text():a.attr("name"),s=[],l=[{}];l[0][o]={};var d=l[0][o];e("option",a).each((function(){var t=e(this).attr("value");d[t]=e(this).text(),e(this).prop("disabled")&&s.push(t)})),e("#"+n).remove();var u=e('<input type="text" id="'+n+'" value="'+d[a.val()]+'" class="'+r.inputClass+'" readonly />').insertBefore(a);return r.showOnFocus&&u.focus((function(){i.show()})),a.hide().closest(".ui-field-contain").trigger("create"),{width:200,wheels:l,headerText:!1,formatResult:function(e){return d[e[0]]},parseValue:function(){return[a.val()]},validate:function(t){e.each(s,(function(i,r){e('li[data-val="'+r+'"]',t).removeClass("dw-v")}))},onSelect:function(e,t){u.val(e),a.val(t.values[0]).trigger("change")},onChange:function(e,t){"inline"==r.display&&(u.val(e),a.val(t.temp[0]).trigger("change"))},onClose:function(){u.blur()}}}}(jQuery),jQuery.scroller.themes.android={defaults:{dateOrder:"Mddyy",mode:"clickpick",height:50}},function(e){var t={defaults:{dateOrder:"Mddyy",mode:"mixed",rows:5,width:70,showLabel:!1}};e.scroller.themes["android-ics"]=t,e.scroller.themes["android-ics light"]=t}(jQuery),jQuery.scroller.themes.ios={defaults:{dateOrder:"MMdyy",rows:5,height:30,width:55,headerText:!1,showLabel:!1}},function(e){e.scroller.themes.jqm={defaults:{jqmBody:"c",jqmHeader:"b",jqmWheel:"d",jqmClickPick:"c",jqmSet:"b",jqmCancel:"c"},init:function(t,i){var r=i.settings;e(".dw",t).removeClass("dwbg").addClass("ui-overlay-shadow ui-corner-all ui-body-a"),e(".dwb-s a",t).attr("data-role","button").attr("data-theme",r.jqmSet),e(".dwb-c a",t).attr("data-role","button").attr("data-theme",r.jqmCancel),e(".dwwb",t).attr("data-role","button").attr("data-theme",r.jqmClickPick),e(".dwv",t).addClass("ui-header ui-bar-"+r.jqmHeader),e(".dwwr",t).addClass("ui-body-"+r.jqmBody),e(".dwpm .dww",t).addClass("ui-body-"+r.jqmWheel),"inline"!=r.display&&e(".dw",t).addClass("pop in"),t.trigger("create"),e(".dwo",t).click((function(){i.hide()}))}}}(jQuery);
//# sourceMappingURL=../../../../Maps/desktop/timeline.desktop.production.js.map
function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu",{},{onDiscussionsMenuStatusChange:function(e,t){this.updateDiscussionsIcons(t.hasDiscussionsOrComment)},updateDiscussionsIcons:function(e){this.sub("UPDATE_DISCUSSIONS_MENU_STATUS",$.proxy(this.onDiscussionsMenuStatusChange,this)),$(".bz-icon-discussion-comment").toggle(e),$(".bz-icon-discussion-no-comment").toggle(!e),this.params.hasDiscussionsOrComment=e},clean:function(){this.unsub("UPDATE_DISCUSSIONS_MENU_STATUS",$.proxy(this.onDiscussionsMenuStatusChange,this))}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu],!0),bizagi.workportal.widgets.project.dashboard.menu.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(e,t,i){this.params=i||{},this._super(e,t,i),this.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e._super(),e.params.contextsLeftSidebarCaseDashboard.forEach((function(t){e.sub(t,$.proxy(e.updateView,e))}))},updateView:function(e,t){this.params=$.extend(this.params,t.args),this.params.plan.idActivitySelected=void 0,this.clean();var i=this.getContent().empty();void 0!==e.type&&(this.params.showContextByMenuDashboard=e.type);var a={showFormOverview:this.params.menuDashboard.showFormOverview,showFormActivity:this.params.menuDashboard.showFormActivity,showCommentsOptionMenu:this.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:this.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:this.params.menuDashboard.showTimeLineOptionMenu&&(!this.params.isAdhocProcess||this.params.isAdhocProcess&&bizagi.util.isEnableFeature("enableTimelineOnLiveProcesses")),showPlanOptionMenu:this.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:this.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:this.params.menuDashboard.contextFormActivityOptionMenu};this.getTemplate("project-dashboard-menu").render(a).appendTo(i),this.params.showContextByMenuDashboard&&$("li[data-context='"+this.params.showContextByMenuDashboard.toUpperCase()+"']",this.content).addClass("active").siblings().removeClass("active"),this.updateDiscussionsIcons(this.params.hasDiscussionsOrComment),this.handlerEvents()},loadContentById:function(e){e.preventDefault();var t=$(e.target).closest("li");if(!t.hasClass("active")){var i=t.data("context");if(i){var a=this.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),r=parseInt(a[0],10),o="",n=r;"PLANACTIVITIES"==i&&(n=r+1,o=bizagi.localization.getResource("workportal-project-casedashboard-plan")),this.params.refreshLastItemBreadcrumb=!1,this.pub("notify",{type:i.toUpperCase(),args:$.extend(this.params,{showContextByMenuDashboard:i,histName:o,level:n})}),$("li[data-context='"+this.params.showContextByMenuDashboard.toUpperCase()+"']",this.content).addClass("active").siblings().removeClass("active")}}},subMenuHandler:function(){var e=this.getContent(),t=$("[data-context='COMMENTS']",e),i=$("[data-context='FILES']",e),a=$("[data-context='TIMELINE']",e);$(".ui-bizagi-wp-project-tab-submenu a",e).on("click",(function(){t.toggle(),i.toggle(),a.toggle()}))},handlerEvents:function(){var e=this,t=e.getContent();e.subMenuHandler(),$(".ui-bizagi-wp-project-tab-links a",t).on("click",$.proxy(e.loadContentById,e)),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).on("click",(function(){var t={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.params.idCase,idTask:e.params.idTask,idWorkflow:e.params.idWorkflow,idWorkItem:e.params.idWorkitem,referrer:e.params.referrer||"inboxGrid"};e.publish("executeAction",t)}))},clean:function(){var e=this,t=e.getContent();e._super(),e.params&&e.params.contextsLeftSidebarCaseDashboard&&e.params.contextsLeftSidebarCaseDashboard.forEach((function(t){e.unsub(t,$.proxy(e.updateView,e))})),$(".ui-bizagi-wp-project-tab-links a",t).off(),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).off()}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var e=this.getTemplate("project-content-dashboard");return this.content=e.render({}),this.content},postRender:function(){setTimeout((function(){$(window).trigger("resize")}),1e3)}}),bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0),bizagi.workportal.widgets.project.base.extend("bizagi.workportal.widgets.project.timeline",{},{init:function(e,t,i){i.data&&$.extend(i,i.data),this._super(e,t,i),this.usersByName={},this.userPictures={},this.usersInformation=[],this.showCurrentDate=i.showCurrentDate||!1,this.timelineData=null,this.auxNoRepeatTypesUser={},this.hashTypesUser={assigned:bizagi.localization.getResource("workportal-project-user-assigned"),owner:bizagi.localization.getResource("workportal-project-user-owner")},this.numberOfResults=0,this.loadTemplates({"project-timeline-markup":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.timeline").concat("#project-timeline-markup"),"project-timeline-empty-process":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.timeline").concat("#project-timeline-empty-process"),"project-timeline-single-process":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.timeline").concat("#project-timeline-single-process"),"project-timeline-activity-assignee":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.timeline").concat("#project-timeline-activity-assignee"),"project-timeline-empty-results":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.timeline").concat("#project-timeline-empty-results")})},showMoreUsersModal:function(e,t){var i=$(t.target).closest(".bz-project-timeline-content").data("workitem");$.when(e.dataService.getItemsAssignees(i)).done((function(t){e.getUsersForUnassignedActivityModal(e,t).done((function(t){var a=e.timelineData.events.find((function(e){return e.idWorkitem==i})),r={users:t,isActivity:"activity"===a.type,activityName:a.displayName};e.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL,closeVisible:!0,data:r,maximize:!0,modalParameters:{title:bizagi.localization.getResource("workportal-widget-timeline-show-more-users-modal-title")+" ("+t.length+")",width:790,height:526,refreshInbox:!1}})}))}))},getUsersForUnassignedActivityModal:function(e,t){var i=$.Deferred(),a=[],r=[];return t.map((function(t){var i=e.usersInformation.find((function(e){return t.guidUser==e.id}));void 0===i?r.push(t.guidUser):a.push(i)})),0==r.length?i.resolve(e.prepareUsersForModal(a)):$.when(e.getUsersData(r.join(","))).done((function(t){i.resolve(e.prepareUsersForModal(a.concat(t)))})),i},prepareUsersForModal:function(e){var t=[];return e.map((function(e){var i=null==e.initials?e.name.getInitials():e.initials,a=usersAdapter.createJsonUserInfo(e.id,e.name,e.username,e.picture,e.email,i,null,null,[],[]);t.push(a)})),usersAdapter.usersWithoutAnonymized(t)},renderContent:function(){var e=this,t=e.getTemplate("project-timeline-markup");e.viewProcesses=!1,e.viewActivities=!0,e.currentDate=e.getDataObj().date;var i=e.content=t.render({viewProcesses:e.viewProcesses,viewActivities:e.viewActivities,showCurrentDate:e.showCurrentDate,date:e.currentDate}),a=$("#bz-project-timeline-activities",e.content);return e.renderActivities(a),$(".bz-project-timeline-search .bz-icon-search",i).on("click",(function(){var t=$(".bz-project-timeline-search input",i).val();e.filterActivities(a,t)})),$(".bz-project-timeline-search input",i).change((function(){var t=$(".bz-project-timeline-search input",i).val();e.filterActivities(a,t)})).keypress((function(t){if(bizagi.util.isIE()&&13==(t.keyCode||t.which)){var r=$(".bz-project-timeline-search input",i).val();e.filterActivities(a,r)}})),e.content},renderActivities:function(e){var t=this,i=t.getContent();e.empty();var a={getFormattedDate:t.getFormattedDate,getFormattedTime:t.getFormattedTime,getPastEvents:t.getPastEvents,getCurrentEvents:t.getCurrentEvents,canShowActivity:$.proxy(t,"canShowActivity"),canShowGraphicQuery:$.proxy(t,"canShowGraphicQuery"),canShowStateLog:$.proxy(t,"canShowStateLog")};$.when(t.getRadNumber(t.radNumber)).done((function(r){$.when(t.getTimelineData(r)).done((function(r){if(r.events.length>0){t.numberOfResults=0;var o=t.getTemplate("project-timeline-single-process").render($.extend(r,{security:bizagi.menuSecurity}),a);if(0===t.numberOfResults){var n=t.getTemplate("project-timeline-empty-results");e.append(n.render($.extend(r,{security:bizagi.menuSecurity}),a))}else e.append(o);$(".bz-more-users-link",i).click((function(e){t.showMoreUsersModal(t,e)})),$(".bz-project-timeline-type-activity .bz-project-timeline-content h2, .bz-project-timeline-type-event .bz-project-timeline-content h2",e).on("click",(function(){var e=$(this).closest(".bz-project-timeline-content").data("case");t.showGlobalForm(e)})),$(".bz-project-timeline-content .bz-show-diagrams",e).on("click",(function(){var e=$(this).closest(".bz-project-timeline-content").data("case"),i=$(this).closest(".bz-project-timeline-content").data("workflow");t.showGraphicQuery({idCase:e,idWorkflow:i})})),$(".bz-project-timeline-content .bz-show-log",e).on("click",(function(){var e=$(this).closest(".bz-project-timeline-content").data("case");bizagi.loader.startAndThen("activity").then((function(){t.showLog(e)}))})),$(".bz-project-timeline-content .bz-show-case",e).on("click",(function(e){var i=$(this).closest(".bz-project-timeline-content").data("case"),a=$(this).closest(".bz-project-timeline-content").data("workitem"),r=$(this).closest(".bz-project-timeline-content").data("workflow");t.publish("closeAllDialogs"),t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i,idWorkItem:a,idTask:"",idWorkflow:r,eventAsTasks:!0,onlyUserWorkItems:"true"})})),$("#bz-project-timeline-content",i).addClass("bz-project-timeline-content-bounce"),t.renderAssignees(e)}else t.showEmptyTimelineTemplate(e,r,a,i,bizagi.menuSecurity)}))}))},showEmptyTimelineTemplate:function(e,t,i,a,r){var o=this.getEmptyTimelineContent(t,i,r);e.append(o),this.adjustElementsForEmptyTimeline(a)},getEmptyTimelineContent:function(e,t,i){var a,r,o,n=this.getTemplate("project-timeline-empty-process"),s={security:i,messages:(a=e.message,r=bizagi.localization.getResource("workportal-general-first-line-not-find-a-historical-record"),o=bizagi.localization.getResource("workportal-general-second-line-not-find-a-historical-record"),{first:a||r,second:a?"":o})},c=$.extend(e,s);return n.render(c,t)},adjustElementsForEmptyTimeline:function(e){$(".bz-project-timeline-search",e).css("display","none"),$("#bz-project-timeline-content",e).css("visibility","visible")},getIdCase:function(e){var t=$.Deferred();return bizagi.util.isGUID(e)?$.when(this.dataService.getCaseByPlan({idPlan:e})).done((function(e){t.resolve(e.id)})):(void 0===this.params.idCase&&!0===this.params.plan.contextualized&&(this.params.idCase=this.params.plan.parent.idCase),t.resolve(this.params.idCase)),t.promise()},getRadNumber:function(e){var t=$.Deferred();return void 0===e&&(e=this.params.plan.id),bizagi.util.isGUID(e)?(e=this.params.plan.id,$.when(this.dataService.getCaseByPlan({idPlan:e})).done((function(e){t.resolve("idCase="+e.id)}))):""===this.params.caseNumber?t.resolve("idCase="+encodeURIComponent(e)):t.resolve("radNumber="+encodeURIComponent(e)),t.promise()},showGlobalForm:function(e){var t=bizagi.injector.get("dialogWidgets"),i={closeVisible:!0,modalParameters:{title:bizagi.localization.getResource("workportal-project-casedashboard-overview"),refreshInbox:!1},idCase:e};i.widgetInstance=bizagi.injector.get("bizagi.workportal.widgets.project.overview",i),i.widgetInstance.sub("closeDialog",(function(e,i){t.close(),defer.resolve(i)})),t.renderWidget(i)},showLog:function(e){var t=bizagi.injector.get("dialogWidgets"),i={closeVisible:!0,modalParameters:{title:bizagi.localization.getResource("workportal-project-casedashboard-history"),refreshInbox:!1},idCase:e};i.widgetInstance=bizagi.injector.get("bizagi.workportal.widgets.activity.log",i),i.widgetInstance.sub("closeDialog",(function(e,i){t.close(),defer.resolve(i)})),t.renderWidget(i)},renderAssignees:function(e){var t={};$.each($(".bz-assignee",e),(function(e,i){var a=$(i).data("guidassignee");t[a]=a})),this.renderAssigneePictures(Object.keys(t),e)},renderAssigneePictures:function(e,t,i){var a=this,r=a.getTemplate("project-timeline-activity-assignee"),o={getInitials:function(e){return e.getInitials()}};null==i&&(i=e);var n=!0,s=$.map(a.userPictures,(function(e){return e.id}));$.each(e,(function(e,t){-1===$.inArray(Number(t),s)&&(n=!1)})),n?$.each(e,(function(e,i){$(".bz-assignee[data-guidassignee="+i+"]",t).append(r.render(a.userPictures[i],o))})):$.when(a.dataService.getAssigneePicture(i)).done((function(e){a.joinUsersInformation(e),$.each(e,(function(e,i){var n=!1;a.timelineData.events.map((function(e){n|="open"==e.status&&e.assignee==i.id})),n&&(i.types=i.types||[],i.types.push("assigned")),$(".bz-assignee[data-guidassignee="+i.id+"]",t).append(r.render(i,o)),a.usersByName[i.name]=i.id,a.userPictures[i.id]=i})),a.addEventHandlersTooltip(e,t)}))},joinUsersInformation:function(e){var t=this;null==t.usersInformation&&(t.usersInformation=[]),e.map((function(e){var i=!1;t.usersInformation.map((function(t){t.id==e.id&&(i=!0,t=$.extend(t,e))})),0==i&&(null==e.types&&(e.types=[]),null==e.initials&&(e.initials=e.name.getInitials()),t.usersInformation.push(e))}))},addEventHandlersTooltip:function(e,t){var i=this,a=[];$.when(i.getIdCase(i.radNumber)).done((function(e){i.dataService.getCaseSummary({idCase:e}).done((function(t){a=[{id:t.createdBy.userId,typeName:"owner"}],i.dataService.getCaseAssignees({idCase:e}).done((function(e){var t=i.getCSVUserGuids(e.assignees,a);$.when(i.getUsersData(t)).done((function(t){var r=i.prepareData(t,a,e);i.joinUsersInformation(r)}))}))}))})),$(".bz-project-timeline-content > .bz-assignee",i.content).on("mouseenter","",(function(e){var t=$(e.target),a=t.closest(".bz-assignee").attr("data-assignee"),r=i.usersInformation.find((function(e){return e.id==a}));if(r&&r.id==a){void 0===r.types||0===r.types.length?(r.owner=!1,r.isAssignee=!1):r.types.forEach((function(e){"owner"==e&&(r.owner=!0),r.isAssignee="assigned"==e.toLowerCase()}));var o=usersAdapter.createJsonUserInfo(r.id,r.name,r.username,r.picture?"data:image/png;base64,"+r.picture:void 0,r.email,r.initials,r.isAssignee,r.owner,[],[]);t.parent().usertooltip(i,{target:t,user:o})}}))},getCSVUserGuids:function(e,t){var i=$.map(e,(function(e){return e.idUser}));return i.unshift(t[0].id),i.join(",")},getUsersData:function(e){var t=$.Deferred(),i={usersGuids:e,width:50,height:50};return this.dataService.getUsersData(i).done((function(e){t.resolve(e)})).fail((function(){t.resolve([])})),t.promise()},mergeTypesToAssignUsers:function(e,t){for(var i=0,a=t.assignees.length;i<a;i++){void 0===this.auxNoRepeatTypesUser[t.assignees[i].idUser.toString()+"assigned"]&&(this.auxNoRepeatTypesUser[t.assignees[i].idUser.toString()+"assigned"]="",e.push({id:t.assignees[i].idUser||-1,typeName:"assigned"}))}},prepareData:function(e,t,i){var a=[];if(e){this.mergeTypesToAssignUsers(t,i);for(var r=0,o=e.length;r<o;r++){var n=this.prepareDataUser(e[r],t,i);a.push(n)}}return a},prepareDataUser:function(e,t,i){var a=this,r=e.id,o={id:r,name:e.name,username:e.username,email:e.email,initials:e.name.getInitials(),picture:e.picture?"data:image/png;base64,"+e.picture:void 0,types:a.assignUserTypes(r.toString(),t),tasks:a.getTasksUser(i,r.toString())};return o.typesString=$.map(o.types,(function(e){return a.hashTypesUser[e]})).join(","),o},getTasksUser:function(e,t){for(var i=[],a=e.assignees.filter((function(e){return e.idUser.toString()===t})),r=0,o=a.length;r<o;r+=1)i.push({taskType:bizagi.util.parseBoolean(a[r].isEvent)?bizagi.localization.getResource("workportal-project-user-event"):bizagi.localization.getResource("workportal-project-user-task"),taskName:a[r].taskName});return i},assignUserTypes:function(e,t){for(var i=[],a=0,r=t.length;a<r;a+=1)e===t[a].id.toString()&&i.push(t[a].typeName);return i},filterActivities:function(e,t){this.filter=t.trim().toLowerCase(),this.renderActivities(e)},getTimelineData:function(e){var t=this;return t.timelineData?$.Deferred().resolve(t.timelineData):$.when(t.dataService.getTimeLineActivities(e)).done((function(e){t.timelineData=e}))},getFormattedDate:function(e){var t=new Date(e);return bizagi.localization.getResource("datePickerRegional").monthNames[t.getMonth()]+" "+bizagi.util.dateFormatter.formatDate(t,"d yyyy")},getFormattedTime:function(e){var t=new Date(e);return bizagi.util.dateFormatter.formatDate(t,"HH:mm")},getPastEvents:function(e){return $.grep(e,(function(e){return null!=e.date}))},getCurrentEvents:function(e){return $.grep(e,(function(e){return null==e.date}))},canShowActivity:function(e){var t=this;if(!t.filter)return t.numberOfResults=t.numberOfResults+1,!0;if(""===t.filter)return t.numberOfResults=t.numberOfResults+1,!0;if(e.displayName.toLowerCase().indexOf(t.filter)>-1)return t.numberOfResults=t.numberOfResults+1,!0;var i=$.grep(Object.keys(t.usersByName),(function(e){return e.toLowerCase().indexOf(t.filter)>-1})),a=$.map(i,(function(e){return t.usersByName[e]}));return $.inArray(e.assignee,a)>-1&&(t.numberOfResults=t.numberOfResults+1,!0)},canShowGraphicQuery:function(){var e=!1;return bizagi.menuSecurity.GraphicQuery&&(e=!0),e},canShowStateLog:function(){var e=!1;return bizagi.menuSecurity.StateLog&&(e=!0),e},getDataObj:function(){var e,t=this.getResource("datePickerRegional"),i=new Date,a=t.dayNames[i.getDay()],r=t.monthNames[i.getMonth()],o=bizagi.services.preferences().getPreferences()||{};return e=a+", "+r+" "+i.getDate()+", "+i.getFullYear(),o.longDateFormat&&(e=bizagi.util.dateFormatter.formatDate(i,o.longDateFormat)),{date:e}}}),bizagi.injector.register("bizagi.workportal.widgets.project.timeline",["workportalFacade","dataService",bizagi.workportal.widgets.project.timeline],!0),bizagi.workportal.widgets.project.base.extend("bizagi.workportal.widgets.project.timeline.sidebar",{},{init:function(e,t,i,a){this._super(e,t,a),this.loadTemplates({"project-timeline-sidebar":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.timeline.sidebar").concat("#project-timeline-sidebar")})},renderContent:function(){var e=this,t=!1;t=!(!e.params.isAdhocProcess||void 0===e.params.isAdhocProcess)&&this.params.isAdhocProcess;var i=e.getTemplate("project-timeline-sidebar"),a=e.content=i.render({isAdhocProcess:t});return $(".bz-timeline-show-process-map",a).on("click",(function(){e.showProcessMap()})),$(".bz-timeline-show-activity-map",a).on("click",(function(){e.showActivityMap()})),e.content},showProcessMap:function(){var e=bizagi.injector.get("dialogWidgets"),t={closeVisible:!0,modalParameters:{title:bizagi.localization.getResource("workportal-project-casedashboard-timeline-diagram-popup-title"),refreshInbox:!1},idWorkflow:this.params.idWorkflow,idCase:this.params.idCase,plan:this.params.plan,radNumber:this.params.caseNumber,showProcessDiagram:!1,showActivityMap:!1,showProcessMap:!0};t.widgetInstance=bizagi.injector.getNewInstance("bizagi.workportal.widgets.project.processMap",t),t.widgetInstance.sub("closeDialog",(function(t,i){e.close(),defer.resolve(i)})),e.renderWidget(t),this.publish("addDialogToDialogStack",e)},showActivityMap:function(){var e=bizagi.injector.get("dialogWidgets"),t={closeVisible:!0,modalParameters:{title:bizagi.localization.getResource("workportal-project-casedashboard-timeline-diagram-popup-title"),refreshInbox:!1},idWorkflow:this.params.idWorkflow,idCase:this.params.idCase,plan:this.params.plan,showProcessDiagram:!1,showActivityMap:!0,showProcessMap:!1};t.widgetInstance=bizagi.injector.getNewInstance("bizagi.workportal.widgets.project.processMap",t),t.widgetInstance.sub("closeDialog",(function(t,i){e.close(),defer.resolve(i)})),e.renderWidget(t),this.publish("addDialogToDialogStack",e)}}),bizagi.injector.register("bizagi.workportal.widgets.project.timeline.sidebar",["workportalFacade","dataService","notifier",bizagi.workportal.widgets.project.timeline.sidebar],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.overview",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"project-overview":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview"),"project-overview-no-summary-form-found":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview-no-summary-form-found")})},renderContent:function(){var e=this.getTemplate("project-overview");return this.content=e.render({}),this.content},postRender:function(){var e=this,t=e.getContent(),i=$("#ui-bizagi-wp-project-overview-wrapper",t);i.bind("oldrenderintegration",(function(t){if(!t.isPropagationStopped()){t.stopPropagation();var a=e.workportalFacade.getTemplate("inbox-common-case-summary-oldrender"),r={};bizagi.oldrenderevent=!0;var o=window.addEventListener?"addEventListener":"attachEvent";(0,window[o])("attachEvent"==o?"onmessage":"message",(function(t){t.stopPropagation(),e.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.data})}),!1),$.when(e.dataService.getWorkitems({idCase:e.params.idCase,onlyUserWorkItems:!0})).done((function(t){if("object"==_typeof(t.workItems)&&t.workItems.length>=1){var o=t.workItems[0].idWorkItem,n=t.workItems[0].idTask;r.url=e.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+e.idCase+"&idWorkitem="+o+"&idTask="+n+"&isSummary=1"}else r.url=e.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+e.idCase+"&isSummary=1";i.empty(),$.tmpl(a,r).appendTo(i),e.iframeOldRender($("iframe",i))}))}}));var a={idCase:e.params.idCase};$.when(e.dataService.getCaseFormsRenderVersion(a)).done((function(a){1==a.formsRenderVersion?i.trigger("oldrenderintegration"):e.renderSummaryForm(e.params.idCase,$("#ui-bizagi-wp-project-overview-wrapper",t))}))},renderSummaryForm:function(e,t){var i=this,a=null!=_typeof(i.dataService.serviceLocator.proxyPrefix)?i.dataService.serviceLocator.proxyPrefix:"",r=new bizagi.rendering.facade({proxyPrefix:a});r.execute({canvas:t,summaryForm:!0,idCase:e}),r.subscribe("no-data-found",(function(){var e=i.getTemplate("project-overview-no-summary-form-found");t.append(e.render())})),i.renderingFacade=r,setTimeout((function(){i.resizeLayout()}),1e3)},iframeOldRender:function(e){this.getContent();var t,i=bizagi.readQueryString();$.each(e,(function(){$(this).is("iframe")&&(t=$(this))})),t.load((function(){var e=$(this).contents(),t=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";t=t.replace("%theme%",i.theme||"bizagiDefault"),$("body",e).append("<link type='text/css' rel='stylesheet' href='"+t+"'>")}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.overview",["workportalFacade","dataService",bizagi.workportal.widgets.project.overview],!0),bizagi.workportal.services.service.extend("bizagi.workportal.services.service",{},{getActivityMap:function(e){var t=this.serviceLocator.getUrl("activity-map"),i={};return e.radNumber&&(i.radNumber=e.radNumber),$.read({url:t,data:i})},getActivitySummary:function(e){var t={};return t.guidWorkitem=e.guidWorkitem,$.ajax({url:this.serviceLocator.getUrl("activity-map-getActivitySummary"),data:t,type:"GET",dataType:"json"})},getSubProcessMap:function(e){var t=this.serviceLocator.getUrl("subprocess-map"),i={};return(e=e||{}).radNumber&&(i.radNumber=e.radNumber),$.read({url:t,data:i})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processMap",{},{init:function(e,t,i){this._super(e,t,i),this.instanceBizagiProcessMap=new bizagi.processMap(this),this.loadTemplates({"project-processmap":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-wrapper"),"project-process-diagram":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-process-diagram"),"project-activity-map":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-activity-map"),"project-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-subprocess")})},renderContent:function(){var e=this.instanceBizagiProcessMap.renderContent();return this.content=e.render(this.viewOptions),this.content},postRender:function(){this.instanceBizagiProcessMap.postRender()},configureHandlers:function(){this.instanceBizagiProcessMap.configureHandlers()},onProcessDiagram:function(){this.instanceBizagiProcessMap.onProcessDiagram()},onActivityMap:function(){this.instanceBizagiProcessMap.onActivityMap()},onSupprocess:function(){this.instanceBizagiProcessMap.onSupprocess()},navigationManager:function(e){var t=this.instanceBizagiProcessMap.navigationManager(e);t.container.append(t.template.render(t.viewOptions))},renderProcessDiagram:function(){this.instanceBizagiProcessMap.renderProcessDiagram()},resize:function(){this.instanceBizagiProcessMap.resize()},renderActivityMap:function(){this.instanceBizagiProcessMap.renderActivityMap()},renderSubProcessMap:function(){this.instanceBizagiProcessMap.renderSubProcessMap()},appendActivityMapZoom:function(){this.instanceBizagiProcessMap.appendActivityMapZoom()},appendProcessMapZoom:function(){this.instanceBizagiProcessMap.appendProcessMapZoom()},appendSubprocessZoom:function(){this.instanceBizagiProcessMap.appendSubprocessZoom()},appendSubprocessDragScroll:function(){this.instanceBizagiProcessMap.appendSubprocessDragScroll()},bindTooltip:function(e){this.instanceBizagiProcessMap.bindTooltip(e)}}),bizagi.injector.register("bizagi.workportal.widgets.project.processMap",["workportalFacade","dataService",bizagi.workportal.widgets.project.processMap]),bizagi.workportal.widgets.graphicquery.extend("bizagi.workportal.widgets.project.processDiagram.helper",{},{getPVHeight:function(){var e=$(window).height()-50,t=this.$header.height()+180;return($(".ui-bizagi-wp-project-tab-content").height()||e)-t}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityMap.tooltip",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"project-tooltip":bizagi.getTemplate("bizagi.workportal.desktop.widget.activityMap.tooltip").concat("#project-processmap-tooltip")}),this.cache={},this.radNumber=i.radNumber},renderContent:function(){},postRender:function(){this.dateFormat=this.getResource("dateFormat")+" "+this.getResource("timeFormat")},configureHandlers:function(e,t){e.find(".ui-bizagi-wp-project-processmap-process").on("click",$.proxy(this.onProcess,this,t)),e.find(".ui-bizagi-wp-project-processmap-tooltip-title").on("click",$.proxy(this.onIdCase,this,t))},onProcess:function(e,t){this.showGraphicQuery(e)},onIdCase:function(e,t){var i=$(t.currentTarget).data("idcase"),a=$(t.currentTarget).data("idworkitem"),r=$(t.currentTarget).data("idtask"),o=$(t.currentTarget).data("idworkflow");this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i,idWorkItem:a,idTask:r,idWorkflow:o})},bindTooltip:function(e){var t=this;t.tooltipClass=e.tooltipClass,e.$container.tooltip({items:e.items,content:function(i){if(!(e.$container.data("clicked")||!1)){if("activityMap"==e.diagram){if(!$(this).is("circle"))return;if(this.className.baseVal.indexOf("activity-map-activity-highlight")<0)return;$.when(t.getActivityMapTooltipContent($(this))).done((function(e){i(e)}))}else{var a=t.getSubprocessTooltipContent($(this));i(a)}return"loading.."}},open:function(e,t){for(var i=0;i<$(".ui-tooltip").length-1;i++)$("#"+$(".ui-tooltip")[i].id).remove()},show:{duration:60,effect:"none"},tooltipClass:t.tooltipClass,hide:{delay:60,duration:60},position:{my:"left+20 top+20"},close:function(e,t){t.tooltip.hover((function(){$(this).stop(!0).fadeTo(120,1)}),(function(){$(this).fadeOut(20,(function(){$(this).remove()}))}))}})},getActivityMapTooltipContent:function(e){var t=this,i=new $.Deferred,a=e.data("guidWorkitem"),r={guidWorkitem:a,gqData:{idCase:e.data("idCase"),idWorkflow:e.data("idWorkflow")}};if(t.guidWorkitem=a,t.isCached(r.guidWorkitem)){var o=t.cache[r.guidWorkitem];i.resolve(t.buildContent(o,r.gqData))}else $.when(t.dataService.getActivitySummary(r)).done((function(e){i.resolve(t.buildContent(e,r.gqData)),t.appendToCache(r.guidWorkitem,e)}));return i.promise()},getSubprocessTooltipContent:function(e){var t={gqData:{idCase:e.data("idcase"),idWorkflow:e.data("idworkflow")}},i={endDate:e.data("enddate"),startDate:e.data("startdate"),process:e.data("process"),idCase:e.data("idcase")};return this.buildContent(i,t.gqData)},appendToCache:function(e,t){this.cache[e]=t},isCached:function(e){return void 0!==this.cache[e]},buildContent:function(e,t){var i=$("<div></div>"),a=this.getTemplate("project-tooltip"),r=void 0!==e.assigneeName;return e.assignee=r,e.radNumber=this.radNumber,e.idWorkflow=t.idWorkflow,e.idTask=e.idTask||0,e.idWorkitem=e.idWorkItem||0,e.graphicQuery=bizagi.menuSecurity.GraphicQuery,i=a.render(e),$("."+this.tooltipClass).html(i),bizagi.util.formatInvariantDate(i,this.dateFormat),this.configureHandlers(i,t),i}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.activity.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ACTIVITY_LOG},renderContent:function(){var e=this.getTemplate("activity.log");return this.idCase=this.params.idCase,this.idWorkflow=this.params.idWorkflow,this.content=$.tmpl(e,{idCase:this.idCase})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.authentication.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_AUTHENTICATION_LOG},renderContent:function(){var e=this.getTemplate("authentication.log");return this.content=$.tmpl(e,{})}}),bizagi.workportal.widgets.activity.log.extend("bizagi.workportal.widgets.activity.log",{ATTR_VALUE_INDEX_COLUMN:{ActivityLog:2,EntityLog:1,UserLog:2},ATTR_VALUE_MAX_LENGTH:89,SELECTORS:{ATTR_VALUE_VIEW_MORE:".activity-log-attribute-value-container > a",DETAIL_WRAPPER:"#activity-log-data-detail-wrapper"}},{init:function(e,t,i){this.totalPages=0,this.maxRows=10,this.maxPages=10,this.currentPage=1,this._super(e,t,i),this.loadTemplates({"activity.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log"),"activity.log.general.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-general-content"),"activity.log.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-header"),"activity.log.detail.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-header"),"activity.log.detail.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-content"),useNewEngine:!1})},postRender:function(){var e=this;e.generalContentTmpl=e.getTemplate("activity.log.general.content"),e.generalHeaderContentTmpl=e.getTemplate("activity.log.header"),e.detailHeaderTmpl=e.getTemplate("activity.log.detail.header"),e.detailContentTmpl=e.getTemplate("activity.log.detail.content"),e.logCategories={ACTIVITIES:{id:"ActivityLog",serviceMethod:"getActivityLog",detailServiceMethod:"getActivityDetailLog",selectedDetailId:0},ENTITIES:{id:"EntityLog",serviceMethod:"getEntityLog",detailServiceMethod:"getEntityDetailLog",selectedDetailId:0},USERS:{id:"UserLog",serviceMethod:"getUserLog",detailServiceMethod:"getUserDetailLog",selectedDetailId:0},ADMINISTRATION:{id:"AdminLog",serviceMethod:"getAdminLog"}},e.containtersID={GENERAL:"general",DETAIL:"detail"};var t=null!=_typeof(e.dataService.serviceLocator.proxyPrefix)?e.dataService.serviceLocator.proxyPrefix:"";new bizagi.render.services.service({proxyPrefix:t}).getCaseNumber({idCase:e.idCase}).done((function(t){var i=t.caseNumber;e.caseNumber=i||e.idCase,e.initWidget()}))},initWidget:function(){this.displayNoResults(!1),this.setupHeader()},setupHeader:function(){var e=this;content=e.getContent();var t=$("#activity-log-data-header-wrapper",content);$.when(e.dataService.supportedLogTypes()).done((function(i){$.tmpl(e.generalHeaderContentTmpl,{supportedLogTypes:i.Supported}).appendTo(t);var a=e.getFirstAvailableLogTypes(i.Supported);e.currentPage=1,e.getActivityLogByCategory(e.logCategories[a]),e.bindHeaderElementInteraction($("#LnkActivities",e.content),e.logCategories.ACTIVITIES),e.bindHeaderElementInteraction($("#LnkEntities",e.content),e.logCategories.ENTITIES),e.bindHeaderElementInteraction($("#LnkUsers",e.content),e.logCategories.USERS),e.bindHeaderElementInteraction($("#LnkAdmin",e.content),e.logCategories.ADMINISTRATION)})).fail((function(e){}))},getFirstAvailableLogTypes:function(e){for(var t in this.logCategories)for(var i in e)if(this.logCategories[t].id==i&&("true"==e[i]||1==e[i]))return t;return""},bindHeaderElementInteraction:function(e,t){var i=this;e.click((function(){$(this).hasClass("active")||($(".active",i.content).removeClass("active"),$(this).addClass("active"),i.currentPage=1,i.getActivityLogByCategory(t))}))},getActivityLogByCategory:function(e){var t,i=this;i.selectedCategoryObj=$.isEmptyObject(e)?i.selectedCategoryObj:$.extend({},e),t={idCase:i.idCase,idActualPage:i.currentPage,pageSize:i.maxRows},$("#activity-log-data-general-wrapper",content).addClass("ui-bizagi-component-loading"),$.when(i.dataService[i.selectedCategoryObj.serviceMethod](t)).done((function(e){i.totalPages=e.total,i.generalActivityDataValidator(e)})).fail((function(e){bizagi.showErrorAlertDialog=!1,bizagi.showMessageBox(JSON.parse(e.responseText).message,"Bizagi","Error")}))},generalActivityDataValidator:function(e){var t=this.getContent();$("#activity-log-data-general-wrapper",t);e.rows?this.currentLogData=[].concat(e.rows):this.currentLogData=[],this.renderContentByCategory()},renderContentByCategory:function(){var e=this,t=e.getContent(),i=$("#activity-log-data-general-wrapper",t);$("#activity-log-data-detail-wrapper",t);i.removeClass("ui-bizagi-component-loading"),i.empty(),e.switchContent(e.containtersID.GENERAL);var a=e.getPaginationData();$.tmpl(e.generalContentTmpl,{logCategory:e.selectedCategoryObj.id,idCase:e.caseNumber,logItems:e.currentLogData,pagData:a,getIcon:e.getIcon}).appendTo(i),e.setUpPagination($("#biz-wp-activitylog-category-pager ul",e.content),"getActivityLogByCategory"),e.currentLogData.length>0?(e.displayNoResults(!1),$(".activity-log-table",i).show()):(e.displayNoResults(!0),$(".activity-log-table",i).hide()),$(".detail-item",i).click((function(t){t.preventDefault(),e.selectedLogItemIndex=$($(t.currentTarget).closest("tr")[0]).index()-1,e.currentPage=1,e.preprocessDetailRender($(this))})),$(".listHeaderLinks",i).click((function(e){e.preventDefault()}))},getPaginationData:function(){for(var e=this.totalPages>1,t={page:this.currentPage,pagesArray:[],pagination:e},i=this.maxPages>this.totalPages?this.totalPages:this.maxPages,a=0;a<i;a++)t.pagesArray.push(a+1);return t},setUpPagination:function(e,t){var i=this;e.bizagiPagination({maxElemShow:i.maxRows,totalPages:i.totalPages,actualPage:i.currentPage,listElement:e,clickCallBack:function(a){i.currentPage=parseInt(a.page),i[t]({},e)}})},preprocessDetailRender:function(e){var t=this,i=(t.getContent(),t.getDetailRenderParams(e));t.selectedCategoryObj.detailServiceMethod&&$.when(t.dataService[t.selectedCategoryObj.detailServiceMethod](i)).done((function(e){t.totalPages=e.total,t.switchContent(t.containtersID.DETAIL),e.rows?t.currentDetailLogData=[].concat(e.rows):t.currentDetailLogData=[],t.renderLogDetail(e)})).fail((function(e){}))},getDetailRenderParams:function(e){var t,i;switch(this.selectedCategoryObj.id){case this.logCategories.ACTIVITIES.id:$.isEmptyObject(e)?i=this.logCategories.ACTIVITIES.selectedDetailId:this.logCategories.ACTIVITIES.selectedDetailId=i=e.attr("data-id"),t={idCase:this.idCase,idWorkItemFrom:i};break;case this.logCategories.ENTITIES.id:$.isEmptyObject(e)?i=this.logCategories.ENTITIES.selectedDetailId:this.logCategories.ENTITIES.selectedDetailId=i=e.attr("data-id"),t={idCase:this.idCase,idEntity:i};break;case this.logCategories.USERS.id:$.isEmptyObject(e)?i=this.logCategories.USERS.selectedDetailId:this.logCategories.USERS.selectedDetailId=i=e.attr("data-id"),t={idCase:this.idCase,idUser:i}}return $.extend(t,{idActualPage:this.currentPage,pageSize:this.maxRows}),t},renderLogDetail:function(e){var t=this,i=t.getContent(),a=$("#activity-log-data-detail-wrapper",i);a.empty(),a.removeClass("ui-bizagi-component-loading"),$.when(t.renderDetailContent()).done((function(){var e=$("#log-filter-wrapper",i);t.showDetailResultMessage(),$("#back-general-content",a).click((function(e){e.preventDefault(),t.displayNoResults(!1),t.switchContent(t.containtersID.GENERAL)})),$("#apply-filter",e).click((function(e){e.preventDefault(),t.currentPage=1,t.applyDetailFilter()})),$("#remove-filter",e).click((function(i){i.preventDefault(),$("input",e).val(""),t.currentPage=1,t.applyDetailFilter()})),$(".listHeaderLinks",a).click((function(e){e.preventDefault()})),t._eventsDeclare()}))},showDetailResultMessage:function(){var e=$("#activity-log-data-detail-wrapper",this.getContent());this.currentDetailLogData.length>0?(this.displayNoResults(!1),$(".activity-log-table",e).show()):(this.displayNoResults(!0),$(".activity-log-table",e).hide())},applyDetailFilter:function(){var e=this,t=e.getFilterParams(),i=e.getContent();e.selectedCategoryObj.detailServiceMethod&&$.when(e.dataService[e.selectedCategoryObj.detailServiceMethod](t)).done((function(t){e.totalPages=t.total,t.rows?e.currentDetailLogData=[].concat(t.rows):e.currentDetailLogData=[];var a=e.getPaginationData(),r=e._renderDetailContentTmpl(a);$("#bz-workportal-activitylog-detailcontent-wrapper",i).remove(),$(r).insertAfter("#activity-log-data-detail-header-wrapper",i),e.showDetailResultMessage(),e.setUpPagination($("#biz-wp-activitylog-detail-pager ul",i),"applyDetailFilter"),e._eventsDeclare()}))},getFilterParams:function(){var e,t,i,a=this.getContent(),r=$("#log-filter-wrapper",a),o=this.getDetailRenderParams();return this.selectedCategoryObj.id==this.logCategories.ENTITIES.id?e=$("#filterUser",r).val().toLowerCase():this.selectedCategoryObj.id==this.logCategories.USERS.id&&(i=$("#filterEntity",r).val().toLowerCase()),t=$("#filterAttribute",r).val().toLowerCase(),$.extend(o,{userFullName:e,attribDisplayName:t,entDisplayName:i}),o},_eventsDeclare:function(){var e=this.Class.SELECTORS,t=this.getContent(),i=$(e.DETAIL_WRAPPER,t);$(e.ATTR_VALUE_VIEW_MORE,i).click(this._showCompleteAttributeValue)},_renderDetailContentTmpl:function(e){var t={logCategory:this.selectedCategoryObj.id,title:this.selectedCategoryObj.title,detailItems:this.currentDetailLogData,pagData:e,isAttrValue:this._isAttrValue.bind(this,this.selectedCategoryObj.id),attrValue2show:this._attrValue2show.bind(this),showMoreButton4AttrValue:this._showMoreButton4AttrValue.bind(this)};return $.tmpl(this.detailContentTmpl,t)},_showCompleteAttributeValue:function(e){var t=$(this).find("span").html();e.preventDefault(),bizagi.showSimpleBox(t,bizagi.localization.getResource("workportal-widget-activity-log-table-details-title-attrvalue"))},_isAttrValue:function(e,t){var i=this.Class.ATTR_VALUE_INDEX_COLUMN[e];return void 0===i&&console.error("_isAttrValue: the selectedCategoryObjId "+e+" does not exist"),t==i},_attrValue2show:function(e){return e.substr(0,this.Class.ATTR_VALUE_MAX_LENGTH)},_showMoreButton4AttrValue:function(e){return e.length>this.Class.ATTR_VALUE_MAX_LENGTH},renderDetailContent:function(){var e=this,t=e.getContent(),i=$.Deferred(),a=$("#activity-log-data-detail-wrapper",t),r=e.getPaginationData(),o=$.tmpl(e.detailHeaderTmpl,{logCategory:e.selectedCategoryObj.id,idCase:e.caseNumber,data:e.currentLogData[e.selectedLogItemIndex]}),n=e._renderDetailContentTmpl(r);return $.when(o,n).done((function(t,r){a.append(t),r.insertAfter("#activity-log-data-detail-header-wrapper",a),e.setUpPagination($("#biz-wp-activitylog-detail-pager ul",e.content),"preprocessDetailRender"),i.resolve()})),i.promise()},switchContent:function(e){var t=this.getContent(),i=$("#activity-log-data-general-wrapper",t),a=$("#activity-log-data-detail-wrapper",t);this.containtersID.DETAIL==e?(i.hide(),a.show()):(i.show(),a.hide())},displayNoResults:function(e){var t=this.getContent();e?$("#activity-log-no-results",t).show():$("#activity-log-no-results",t).hide()},getIcon:function(e){var t="bzg-case-allocation",i="bzg-case-allocation-info",a="bzg-case-canceled",r="";switch(e){case 1:case 6:case 7:case 1002:r=t;break;case 3:case 4:r=i;break;case 1001:r=a}return r}}),bizagi.injector.register("bizagi.workportal.widgets.activity.log",["workportalFacade","dataService",bizagi.workportal.widgets.activity.log],!0);
//# sourceMappingURL=../../../../Maps/desktop/timeline.desktop.production.js.map
