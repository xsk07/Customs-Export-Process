bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.casestemplate",{},{init:function(e,t,i,o,s,n,a,r){this._super(e,t,r),this.loadTemplates({"casestemplate-container":bizagi.getTemplate("bizagi.workportal.desktop.widget.casestemplate").concat("#casestemplate-wrapper"),"casestemplate-item":bizagi.getTemplate("bizagi.workportal.desktop.widget.casestemplate").concat("#casestemplate-item"),"casestemplate-empty-data":bizagi.getTemplate("bizagi.workportal.desktop.widget.casestemplate").concat("#casestemplate-empty-message")}),this.selectorCheckboxItems=".casetemplate-box-check-selector input:checkbox",this.actionService=i,this.casetoolbar=o,this.usersCasesService=s,this.actionsEventsService=n,this.hasBatchActions=!1,this.sequenceCall=0,this.accumulatedcontext=a},renderContent:function(){var e=this.getTemplate("casestemplate-container");return this.content=e.render({}),this.content},postRender:function(){var e=this,t=e.getContent();e.sub("CASES-TEMPLATE-VIEW",$.proxy(e.updateCases,e)),e.sub("UPDATE-DATATEMPLATE-VIEW",$.proxy(e.updateCases,e)),e.sub("GET-COMMON-ACTIONS",$.proxy(e.getCommonActions,e)),e.sub("SET-RECORDS",$.proxy(e.updateCases,e)),e.sub("SET-VALUES",(function(t,i){return e.setValues(i)})),e.actionService.subscribe("onFormActionExecuted",$.proxy(e.onFormActionExecuted,e)),e.actionService.subscribe("onFormRuleExecuted",$.proxy(e.onFormRuleExecuted,e)),t.find("#casestemplate-dataviewer-list").on("click",e.selectorCheckboxItems,$.proxy(e.onCaseChecked,e))},clean:function(){var e=this.getContent();this.checkAll=!1,this.sequenceCall=0,e&&(this.actionService.unsubscribe("onFormActionExecuted"),this.actionService.unsubscribe("onFormRuleExecuted"),this.unsub("CASES-TEMPLATE-VIEW"),this.unsub("UPDATE-DATATEMPLATE-VIEW"),this.unsub("GET-COMMON-ACTIONS"),this.sub("SET-VALUES"),e.find("#casestemplate-dataviewer-list").off("click",this.selectorCheckboxItems))},updateCases:function(e,t){var i,o=this,s=t.args,n=new $.Deferred,a=$("#casestemplate-dataviewer-list",o.getContent());return a.empty(),o.actionService.init(),o.casesSelected={},o.sequenceCall++,o.page=s.page||o.page,o.idworkflow=null==s.idworkflow?o.idworkflow:s.idworkflow,o.route=s.route||o.route,o.filter=s.filter||o.filter,o.pageSize=s.pageSize||o.pageSize,i=o.sequenceCall,$.when(o.getCasesData({page:o.page,idworkflow:o.idworkflow,pageSize:o.pageSize})).pipe((function(e){return o.sequenceCall!==i?(n.resolve(),null):(o.pub("notify",{type:"PAGINATOR-UPDATE",args:$.extend(s,e,{event:t.type})}),o.getCasesTemplates(e))})).done((function(e){if(null!==e){var t=(o.casesLength=e.length)>0?"":o.getEmptyDataMessage(),s=null,r=$();o.hasBatchActions=!1;for(var c=0,l=e.length;c<l;c++){if(o.sequenceCall!==i)return void n.resolve();s=o.renderCase(e[c],!1,i),r.push.apply(r,s)}o.hasBatchActions||o.pub("notify",{type:"HIDE-CHECK-ALL",args:{}}),r.length>0?a.append(r):a.append(t),o.checkAll=!1,o.pub("notify",{type:"ENABLE-BATCHS-ACTIONS",args:{commonActions:o.setValues({args:{value:o.checkAll}})}}),n.resolve(e)}})),n.promise()},renderCase:function(e,t,i){var o=this,s=e.actionData,n=s.idCase,a=s.surrogateKey,r=s.guidEntity,c=o.getTemplate("casestemplate-item"),l=new bizagi.workportal.command.security(o.dataService),d=c.render({idCase:n,guidEntity:r,surrogateKey:a});return d.find("#template").append(e.tmpl),$.when(l.checkSecurityPerm("GraphicQuery")).done((function(t){e.casetoolbarData.graphicQuery=t,setTimeout((function(){var t=o.casetoolbar.getCaseToolbar({casetoolbarData:$.extend(e.casetoolbarData,{referrer:"CasesTemplate"})}),s=o.getContent().find("#casetemplate-box-wrapper-"+n+" .casetemplate-box-element");i===o.sequenceCall&&s.append(t)}),0)})),setTimeout((function(){var s=o.getContent().find("#casetemplate-box-wrapper-"+n+" .casetemplate-box-footer");s.startLoading({delay:0,overlay:!0}),$.when(o.actionService.getActionsView({actionData:e.actionData,loadEvents:!0,isRefresh:t})).done((function(e){var t=e.actionsView,a=e.actionsData,r=0===a.length?[]:o.pub("notify",{type:"BATCH-ACTIONS",args:{actionsData:a}})[0],c=o.getContent().find("#casetemplate-box-wrapper-"+n+" .casetemplate-box-element .casetemplate-box-footer");t&&i===o.sequenceCall?(c.append(t),r.length>0&&-1!=o.getCheckBox(c).data("surrogatekey")?(o.hasBatchActions=!0,o.showCheckItem(c),o.pub("notify",{type:"SOME-ITEM-ALLOW-SELECT",args:{}})):o.removeCheckItem(c)):o.removeCheckItem(c),s.endLoading()}))}),0),setTimeout((function(){$.when(o.usersCasesService.getAssignees(n)).done((function(e){e&&i===o.sequenceCall&&o.getContent().find("#casetemplate-box-wrapper-"+n+" .casetemplate-box-element .casetemplate-box-footer").append(e)}))}),0),d},getCheckBox:function(e){return e.closest(".casetemplate-box-element").find(this.selectorCheckboxItems)},removeCheckItem:function(e){this.getCheckBox(e).remove()},showCheckItem:function(e){this.getCheckBox(e).show()},onFormActionExecuted:function(e,t){(t=t||{}).refresh&&this.refreshCase(t.idCase)},onFormRuleExecuted:function(e,t){(t=t||{}).refresh&&this.refreshCase(t.idCase)},refreshCase:function(e){var t=this,i="#casetemplate-box-wrapper-"+e,o=$(i),s=o.find(".casetemplate-box-check-selector > input").is(":checked");o.startLoading({delay:250,overlay:!0}),$.when(t.getCasesData({idCase:e})).then((function(e){return t.getCasesTemplates(e,!0)})).done((function(e){var n=null;null!=e[0]&&null!=e[0]&&(n=t.renderCase(e[0],!0,t.sequenceCall),o.replaceWith(n)),o.endLoading(),s&&(o=$(i)).find(".casetemplate-box-check-selector > input").prop("checked",!0)}))},getCasesData:function(e){return"following"==this.route?this.dataService.getActivitiesData(e):"pendings"==this.route?this.dataService.getPendingsData(e):"Green"==this.route||"Yellow"==this.route||"Red"==this.route?($.extend(e,{taskState:this.route}),this.dataService.getPendingsData(e)):void 0},getCasesTemplates:function(e,t){var i=this,o=[],s=new $.Deferred;return $.when(i.getTemplateEngine()).then((function(t){return $.when.apply($,$.map(e.entities,(function(e){return t.render(e)})))})).done((function(){for(var n=$.makeArray(arguments),a=[],r=e.entities.length,c=0;c<r;c++){var l=1===r?n[c]:n[c][0],d=e.entities[c];o.push({tmpl:l,casetoolbarData:{guidFavorite:e.entities[c].guidFavorite,idcase:e.entities[c].idCase,idWorkflow:e.entities[c].idWorkflow,radNumber:e.entities[c].radNumber||e.entities[c].idCase},actionData:{guidEntity:d.guid,idCase:d.idCase,radNumber:d.radNumber,surrogateKey:d.surrogateKey}}),a.push(d.idCase)}t||(i.usersCasesService.render(a),i.actionsEventsService.render(a)),s.resolve(o)})),s.promise()},getTemplateEngine:function(){var e=this;if(e.templateEngine)return e.templateEngine;var t={};t.proxyPrefix=bizagi.RPproxyPrefix;var i=new bizagi.render.services.service(t),o=new bizagi.rendering.desktop.factory(i),s=new $.Deferred;return $.when(o.initAsyncStuff()).done((function(){e.templateEngine=new bizagi.templateEngine({renderFactory:o,cache:!0,forcePersonalizedColumns:!0}),e.templateEngine.subscribe("onLoadDataNavigation",(function(t,i){var o=i.data||{},s={reference:o.reference,surrogateKey:o.surrogateKey,referenceType:o.referenceType,fromActionLauncher:!1,histName:o.displayName,guidEntityCurrent:o.guidEntityCurrent,page:1};void 0!==o.xpath&&o.xpath&&(s.xpath=o.xpath),e.accumulatedcontext.clean(),e.pubDeadLockDetection("notify",{type:"TEMPLATEENGINE-VIEW",args:s})})),s.resolve(e.templateEngine)})),s.promise()},getEmptyDataMessage:function(){return this.getTemplate("casestemplate-empty-data").render()[0].outerHTML},onCaseChecked:function(e){var t=$(e.target),i=t.data("surrogatekey"),o=t.data("idcase"),s=t.data("guidentity"),n=t.is(":checked");this.casesSelected[o]={surrogateKey:i,guidEntity:s,idCase:o},n||delete this.casesSelected[o],this.pub("notify",{type:"ENABLE-BATCHS-ACTIONS",args:{commonActions:this.getCommonActions()}})},getCommonActions:function(){var e={};for(var t in e.actions=this.actionService.getCommonActions(this.casesSelected),e.surrogateKeys=[],e.parentsid=[],this.casesSelected){var i=this.casesSelected[t];-1!==i.surrogateKey&&(e.surrogateKeys.push(i.surrogateKey),e.parentsid.push(i.idCase))}return e.guidEntity=void 0!==t?this.casesSelected[t].guidEntity:"",0==e.surrogateKeys.length?(this.checkAll=!1,e.checkAll=!1):e.surrogateKeys.length==this.casesLength&&(this.checkAll=!0,e.checkAll=!0),e.itemsSelected=this.casesSelected,e},setValues:function(e){var t=this,i=t.getContent(),o=(e.args||{}).value;if(i){t.casesSelected={};var s=i.find(t.selectorCheckboxItems);return $.map(s,(function(e){if($(e).prop("checked",o),o){var i=$(e).data("surrogatekey"),s=$(e).data("idcase"),n=$(e).data("guidentity");t.casesSelected[s]={surrogateKey:i,guidEntity:n,idCase:s}}})),t.checkAll=o,t.getCommonActions()}}}),bizagi.injector.register("bizagi.workportal.widgets.casestemplate",["workportalFacade","dataService","actionService","casetoolbar","usersCasesService","actionsEventsService","accumulatedcontext",bizagi.workportal.widgets.casestemplate]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.filtercases",{},{init:function(e,t,i){this._super(e,t,i),this.lastIdworkflow,this.loadTemplates({filtercases:bizagi.getTemplate("bizagi.workportal.desktop.widget.filtercases").concat("#filtercases-wrapper")})},renderContent:function(e,t){var i=this.getTemplate("filtercases");return this.content=i.render({}),this.content},postRender:function(e,t){var i=this.getContent();$("li.ui-bizagi-wp-app-inbox-tab",i).on("click",$.proxy(this.onClickButtonFilter,this)),this.sub("CASES-TEMPLATE-VIEW",$.proxy(this.updateUI,this))},onClickButtonFilter:function(e){var t=$(e.currentTarget);if(!t.hasClass("active")){var i,o=t.attr("id"),s=this.pub("notify",{type:"GETIDWORKFLOW_FROM_PROCESSESLIST"})[0];if(t.addClass("active").siblings().removeClass("active"),"pendings"===o)i=this.pub("notify",{type:"GETHISTNAME_FROM_PROCESSESLIST"})[0];else{var n="workportal-widget-inboxcommon-filter-"+o.toLowerCase();i=bizagi.localization.getResource(n)}this.lastIdworkflow=s,this.pub("notify",{type:"CASES-TEMPLATE-VIEW",args:{histName:i,page:1,refreshLastItemBreadcrumb:!1,route:o,idworkflow:s||""}})}},updateUI:function(e,t){"following"===t.args.route?$(this.content).hide():$(this.content).show(),t.args.idworkflow!=(this.lastIdworkflow||"")&&$(".ui-bizagi-wp-app-inbox-tab:first-child").addClass("active").siblings().removeClass("active")},clean:function(){this.unsub("CASES-TEMPLATE-VIEW")}}),bizagi.injector.register("bizagi.workportal.widgets.filtercases",["workportalFacade","dataService",bizagi.workportal.widgets.filtercases]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.paginator",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({paginator:bizagi.getTemplate("bizagi.workportal.desktop.widget.paginator").concat("#paginator-wrapper"),content:bizagi.getTemplate("bizagi.workportal.desktop.widget.paginator").concat("#paginator-content")})},renderContent:function(){var e="ENTITY"===this.params.referenceType,t=this.getTemplate("paginator"+this.getSuffixWidget());return this.content=t.render({hide:e}),this.content},postRender:function(){this.sub("PAGINATOR-UPDATE",$.proxy(this.updateView,this)),this.configureHandlers()},getSuffixWidget:function(){return""},updateView:function(e,t){var i=this,o=t.args,s="ENTITY"===o.referenceType,n=i.getContent();function a(){i.getTemplate("content"+i.getSuffixWidget()).render({totalRecords:i.totalRecords,totalPages:i.totalPages,displayName:i.displayName,currentPage:i.currentPage,hide:s}).appendTo(n)}i.setModel(o),n.empty(),o.fromActionLauncher?i.totalRecords>1?a():i.clean():a()},setModel:function(e){this.totalRecords=void 0===e.totalRecords?this.totalRecords:e.totalRecords,this.totalPages=e.totalPages||this.totalPages,this.displayName=e.histName||this.displayName,this.currentPage=e.currentPage||this.currentPage,this.action=e.action,this.reference=e.reference||this.reference,this.surrogateKey=e.surrogateKey||this.surrogateKey,this.referenceType=e.referenceType,this.event=e.event,this.guidSearch=e.guidSearch},getModel:function(){return{page:this.currentPage,totalRecords:this.totalRecords,action:this.action,reference:this.reference,surrogateKey:this.surrogateKey,referenceType:this.referenceType,stopNavigation:!0,guidSearch:this.guidSearch}},configureHandlers:function(){this.getContent().on("click",$.proxy(this.onPageBreak,this))},onPageBreak:function(e){var t=$(e.target),i=this.getContent();if(t.hasClass("control-icon")&&!t.hasClass("ui-state-disabled")){var o=t.data("type");"forward"==o?this.currentPage+=1:"rewind"==o?this.currentPage-=1:this.currentPage="fastrewind"==o?1:this.totalPages,this.disabledPaginatorButtonsByLimits(),i.find(".paginator-controls__currentPage").text(this.currentPage),this.pub("notify",{type:"UPDATE-DATATEMPLATE-VIEW",args:this.getModel()})}},disabledPaginatorButtonsByLimits:function(){var e=$("[data-type='fastrewind']",this.content),t=$("[data-type='rewind']",this.content),i=$("[data-type='forward']",this.content),o=$("[data-type='fastforward']",this.content);1===this.totalPages?(e.addClass("ui-state-disabled"),t.addClass("ui-state-disabled"),i.addClass("ui-state-disabled"),o.addClass("ui-state-disabled")):1===this.currentPage?(e.addClass("ui-state-disabled"),t.addClass("ui-state-disabled"),i.removeClass("ui-state-disabled"),o.removeClass("ui-state-disabled")):this.currentPage===this.totalPages?(e.removeClass("ui-state-disabled"),t.removeClass("ui-state-disabled"),i.addClass("ui-state-disabled"),o.addClass("ui-state-disabled")):(e.removeClass("ui-state-disabled"),t.removeClass("ui-state-disabled"),i.removeClass("ui-state-disabled"),o.removeClass("ui-state-disabled"))},calculateNewPage:function(e,t,i){var o=(t=t||10)*i-t+1,s=Math.ceil(o/e);return s||1},clean:function(){var e=this.getContent();e&&e.empty()}}),bizagi.injector.register("bizagi.workportal.widgets.paginator",["workportalFacade","dataService",bizagi.workportal.widgets.paginator]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.sortbar",{},{init:function(e,t,i,o,s){this._super(e,t,s),this.loadTemplates({sortbar:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-wrapper"),content:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-content"),"right-content":bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-right"),addButton:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-content-add-button"),sortMenu:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-sort-menu"),actions:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-content-actions"),recordsPerPage:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-records-per-page"),recordsMenu:bizagi.getTemplate("bizagi.workportal.desktop.widget.sortbar").concat("#sortbar-records-menu")}),this.processActionService=i,this.accumulatedcontext=o},renderContent:function(){var e=this.getTemplate("sortbar");return this.content=e.render({enableFilter:!0}),this.$checkAll=this.content.find(".sortbar-left-check-uncheck input"),this.content},postRender:function(){var e=this.getTemplate("right-content");this.setVisibleSortbar(!0),this.configureHandlers(),$(".sortbar-right",this.content).append(e.render()),this.configureAfterPaintHandlers()},configureHandlers:function(){var e=this,t=e.getContent();e.sub("TEMPLATEENGINE-VIEW",$.proxy(e.initializeAndProcessFilterButton,e)),e.sub("SEARCH-ENGINE-VIEW",$.proxy(e.initializeAndProcessFilterButton,e)),e.sub("SET-FILTERS-DATA",$.proxy(e.setFiltersSortData,e)),e.sub("HIDE-FILTER-BUTTONANDBAR",$.proxy(e.hideFilterButtonAndBar,e)),e.sub("HIDE-SORT-BUTTONS",$.proxy(e.hideSortButtons,e)),e.sub("ENABLE-BATCHS-ACTIONS",(function(t,i){return e.enableBatchActions(i)})),e.sub("UPDATE-COUNTER-FILTERS-APPLIED",(function(t,i){return e.updateCounterByFilterApplied(i)})),e.sub("CASES-TEMPLATE-VIEW",(function(t,i){e.showingFiltering=!1,e.setVisibleCheckAll(!1)})),e.sub("SOME-ITEM-ALLOW-SELECT",(function(t,i){e.setVisibleCheckAll(!0)})),e.sub("HIDE-CHECK-ALL",(function(t,i){e.setVisibleCheckAll(!1)})),e.sub("BATCH-ACTIONS",(function(t,i){return e.validActions(i.args.actionsData)})),t.find(".wgd-sortbar-add-button").tooltip(),e.$checkAll.on("click",$.proxy(e.onCheckUncheck,e))},configureAfterPaintHandlers:function(){var e=this,t=e.getContent();t.find(".right-menu").on("click",(function(t){e.showSortMenu(t,$(this))})),t.find(".records-menu").on("click",(function(t){e.showRecordsMenu(t,$(this))})),t.find(".sortbar-az").on("click",(function(){e.sortSelection.attribute&&(e.setIconSortType($(this),e._sortType),e.pub("notify",{type:"SET-ORDERBY",args:{properties:{xpath:e.sortSelection.attribute,orderType:e._sortType,typeSearch:"none"}}}))})),t.find(".filter-icon").on("click",(function(){e.pub("notify",{type:"OPENCLOSE-MYSEARCHFILTER",args:{guidSearch:e.params.guidSearch,target:$(this)}})})),$(".remove-selected-items-collections",t).on("click",$.proxy(e.onRemoveSelectedItemsCollections,e))},setVisibleSortbar:function(e){var t=this.getContent();e?t.show():t.hide()},setVisibleCheckAll:function(e){e?(this.$checkAll.closest(".border-check-uncheck").show(),this.showingCheckAll=!0):(this.$checkAll.closest(".border-check-uncheck").hide(),this.showingCheckAll=!1)},showSelectedItems:function(e){if(e&&e>0){this.content.addClass("there-are-actions");var t=this.getResource("workportal-general-word-selected-singular");e>1&&(t=this.getResource("workportal-general-word-selected-plural")),$(".actions-count-selected",this.content).text(e+" "+t+" ")}else this.content.removeClass("there-are-actions")},setIconSortType:function(e,t){"asc"===t?(this._sortType="desc",e.removeClass("bz-icon-order-ascendant-outline").addClass("bz-icon-order-descendant-outline")):(this._sortType="asc",e.removeClass("bz-icon-order-descendant-outline").addClass("bz-icon-order-ascendant-outline"))},onClickBatchAction:function(e){var t=this,i=$(e.target).closest("li"),o=i.data("guid"),s=t.getAction(o);t.requestsInProgressActionGuid[o]||(t.requestsInProgressActionGuid[o]=!0,t.addLoadingButtonAction(i),$.when(t.processActionService.executeBatchAction({action:s,commonActionsmodel:t.commonActionsmodel})).always((function(){t.quitLoadingButtonAction(i),t.requestsInProgressActionGuid[o]=void 0})))},addLoadingButtonAction:function(e){e.find(".wdg-tple-button").addClass("state-loading"),e.find(".wdg-tple-button").prepend('<div class="ui-bizagi-loading-icon ui-bizagi-loading-button"></div>').find("i").hide()},quitLoadingButtonAction:function(e){e.find(".wdg-tple-button").removeClass("state-loading"),e.find(".ui-bizagi-loading-button").remove(),e.find("i").show()},onRemoveSelectedItemsCollections:function(){var e=this.pub("notify",{type:"SET-VALUES",args:{value:!1}})[0];this.enableBatchActions({args:{commonActions:e}})},showSortMenu:function(e,t){var i=this,o=i.getContent(),s=i.getTemplate("sortMenu").render({filters:i._filters},{displayValue:function(e){return e}});$(".sortbar-box-menu",t).length&&$(".sortbar-box-menu",t).remove(),t.append(s),s.show("fast",(function(){s.click((function(e){e.stopPropagation()})),$(document).one("click",(function(){s.hide("fast"),s.remove()}))})),o.find(".sortbar-option").on("click",(function(e){var n=$(e.currentTarget).data(),a=i._filters[n.index];o.find(".sortbar-az").removeClass("disabled"),i.sortSelection!=a&&(i.sortSelection=a,$(".sortbar-selected",t).text(i.sortSelection.display.split(".").pop()),i.pub("notify",{type:"SET-ORDERBY",args:{properties:{xpath:a.attribute,orderType:i._sortType,typeSearch:"none"}}})),s.hide("fast")}))},showRecordsMenu:function(e,t){var i=this,o=i.getContent(),s=i.getTemplate("recordsMenu").render({});$(".sortbar-records-box-menu",t).length&&$(".sortbar-records-box-menu",t).remove(),t.append(s),s.show("fast",(function(){s.click((function(e){e.stopPropagation()})),$(document).one("click",(function(){s.hide("fast"),s.remove()}))})),o.find(".sortbar-records-option").on("click",(function(e){i.oldPageSize=i.oldPageSize?i.oldPageSize:10;var o=Number(bizagi.util.trim(this.textContent)),n=bizagi.injector.get("bizagi.workportal.widgets.paginator"),a=n.currentPage?n.currentPage:1,r=n.calculateNewPage(o,i.oldPageSize,a);$(".sortbar-records-selected",t).text(o),i.pub("notify",{type:"SET-RECORDS",args:{pageSize:o,page:r}}),i.oldPageSize=o,s.hide("fast")}))},initializeAndProcessFilterButton:function(e,t){this.showingFiltering=!1,this.setVisibleCheckAll(!1),this.restoreOrderSelected(),this.setIconSortType($(".sortbar-az",this.content),"desc"),this.params=t.args,this.sortSelection={},this.processAddButton(e,t)},processAddButton:function(e,t){var i=this,o=i.getContent(),s=t.args,n=s.action,a=o.find(".sortbar-left .add-button");i._lastReferenceEntity=s.reference,a.children().remove(),$(".wrapper-sortbar-actions",o).remove(),i._haveAddButton=!1,s.reference&&"ENTITY"!==s.referenceType?(a.startLoading({delay:0,overlay:!0}),i.dataService.getProcessAddAction(t).done((function(e){i._lastReferenceEntity===e.referenceEntity&&void 0!==e&&Object.getOwnPropertyNames(e).length>1&&e.guidEntity&&e.id&&i.renderButton(a,e)})).always((function(){a.endLoading()}))):n&&i.renderButton(a,n)},renderButton:function(e,t){var i=this,o=i.getTemplate("addButton").render({action:t});e.empty(),o.appendTo(e),i._haveAddButton=!0,o.on("click",(function(){i.clickAddButton(t)}))},clickAddButton:function(e){var t=this;$.when(t.dataService.getMapping({guidEntity:e.guidEntity,accumulatedContext:t.accumulatedcontext.getContext({}),xpathContext:"Process"===e.type?e.xpathContext:"",collectionId:e.referenceEntity,collectionType:e.referenceType})).done((function(i){"Process"===e.type?t.onExecuteProcess(e,i):t.onExecuteForm(e,i)}))},onCheckUncheck:function(e){var t=$(e.target).is(":checked"),i=this.pub("notify",{type:"SET-VALUES",args:{value:t}})[0];this.enableBatchActions({args:{commonActions:i}})},enableBatchActions:function(e){var t=e.args,i=this.commonActionsmodel=t.commonActions,o=this.validActions(i.actions);(o.length>0||this._haveAddButton)&&$(this.getContent()).show(),this.showBatchActions(o,i,"batchAction"),void 0!==i.checkAll&&this.$checkAll.prop("checked",i.checkAll)},showBatchActions:function(e,t,i){var o=this,s=o.getContent(),n=o.getTemplate("actions");o.showSelectedItems(Object.keys(t.itemsSelected).length);var a=e.slice(3,9999),r=n.render({actions:e.slice(0,3),moreActions:a,typeActions:i});$(".wdg-tple-button.batchAction",o.content).off("click",$.proxy(o.onClickBatchAction,o)),$(".wrapper-sortbar-actions",s).remove(),$(".sortbar-left .sortbar-menu",s).append(r),$(".wdg-tple-button.batchAction",o.content).on("click",$.proxy(o.onClickBatchAction,o)),a.length>0&&(o.content.data("ui-tooltip")&&$(o.content).tooltip("destroy"),$(o.content).tooltip({tooltipClass:"sortbar-tooltip-more-actions",items:".bz-actions-showmore",content:$(".template-box-tooltip",o.content).html(),open:function(e,t){$(".wdg-tple-button.batchAction",t.tooltip).on("click",$.proxy(o.onClickBatchAction,o));var i=$("div.ui-tooltip");if(void 0===e.originalEvent)return i.remove(),!1;var s=$(t.tooltip).attr("id");for(var n in i.not("#"+s).remove(),o.requestsInProgressActionGuid)if(o.requestsInProgressActionGuid[n]){var a=$("li[data-guid='"+n+"']",t.tooltip);o.addLoadingButtonAction(a)}$("li[id='emptyLi0']").focus((function(){$("div.bz-actions-showmore.ellipsis-icon")[0].focus(),$("ul[class='actions-container'] li:nth-child(3")[0].focus()})),$("li[id='emptyLi1']").focus((function(){$("div.bz-actions-showmore.ellipsis-icon")[0].focus(),$("a.remove-selected-items-collections")[0].focus()})),$("li",t.tooltip)[1].focus()},close:function(e,t){t.tooltip.hover((function(){$(this).stop(!0).fadeTo(400,1)}),(function(){$(this).fadeOut("400",(function(){$(".wdg-tple-button.batchAction",this).off("click",$.proxy(o.onClickBatchAction,o)),$(this).remove()}))}))}}))},setFiltersSortData:function(e,t){var i=t.args.filtersAppliedCounter,o=t.args.totalRecords;if(this._filters=t.args.calculateFilters?t.args.filters:this._filters,t.args.calculateFilters){for(var s,n=-1,a=0,r=0;s=this._filters[++n];)"Text"!=s.type&&"Link"!==s.type&&s.data&&(s.data.defaultValues&&s.data.defaultValues.length>0||s.data.min&&s.data.max)&&a++,""!==s.display&&r++;o>0?(a>0?this.showFilterButton():this.hideFilterButton(),r>0?this.showSortButtons():this.hideSortButtons()):0===i&&(this.hideFilterButton(),this.hideSortButtons())}this.updateCounter(i)},showFilterButton:function(){$(".filter-icon",this.getContent()).show()},hideFilterButton:function(){$(".filter-icon",this.getContent()).hide(),this.showingFiltering=!1},showSortButtons:function(){$(".sortbar-text",this.getContent()).show(),$(".sortbar-icon",this.getContent()).show(),$(".sortbar-az",this.getContent()).show(),this.showingSorting=!0,this.showingFiltering=!0},hideSortButtons:function(){var e=$(".sortbar-az",this.getContent());$(".sortbar-text",this.getContent()).hide(),e.addClass("disabled"),e.removeClass("bz-icon-order-ascendant-outline"),e.removeClass("bz-icon-order-descendant-outline"),e.addClass("bz-icon-order-ascendant-outline"),e.hide(),this.showingSorting=!1},restoreOrderSelected:function(){$(".sortbar-selected",this.getContent()).text(this.getResource("workportal-my-search-order-by"))},updateCounterByFilterApplied:function(e){e.args.filtersApplied&&this.updateCounter(e.args.filtersApplied.length)},updateCounter:function(e){var t=this.getContent(),i=$(".counter-filters-applied",t);e>0?(i.html(e),i.show()):i.hide()},hideFilterButtonAndBar:function(){this.showingFilter=!1,$(".filter-icon",this.getContent()).hide(),this.pub("notify",{type:"CLOSE-MYSEARCHFILTER",args:{show:!1,$target:null}})},onExecuteProcess:function(e,t){var i=this;e.startForm&&(e.hasStartForm=e.startForm),$.when(i.processActionService.executeProcessAction({action:e,mappingData:t})).done((function(t){(t=t||{})&&!1!==t.refreshTemplateData&&i.loadTemplateData(e)}))},loadTemplateData:function(e){this.pub("notify",{type:"TEMPLATEENGINE-VIEW",args:{action:e,isRefresh:!0}})},onExecuteForm:function(e,t){var i=this;$.when(i.processActionService.executeFormAction({action:e,mappingData:t})).done((function(t){t.refresh&&i.pub("notify",{type:"UPDATE-DATATEMPLATE-VIEW",args:{action:e,isRefresh:!0,calculateFilters:!0}})}))},getAction:function(e){return this.commonActionsmodel.actions.filter((function(t){return t.id==e}))[0]},validActions:function(e){return $.grep(e,(function(e){return 2==e.multiplicity||"Collection"!=e.mode&&("Form"!=e.type&&(!e.isEvent&&("Process"!=e.type||!e.hasStartForm)))}))},clean:function(){var e=this.getContent();this.requestsInProgressActionGuid={},e&&(this.unsub("TEMPLATEENGINE-VIEW"),this.unsub("ENABLE-BATCHS-ACTIONS"),this.unsub("SEARCH-ENGINE-VIEW"),this.unsub("SET-FILTERS-DATA"),this.unsub("HIDE-FILTER-BUTTONANDBAR"),this.unsub("HIDE-SORT-BUTTONS"),this.$checkAll.off("click"),e.find(".right-menu").off("click"),e.find(".sortbar-az").off("click"),e.find(".filter-icon").off("click"),e.find(".sortbar-action").off("click"),$(".wdg-tple-button.batchAction",e).off("click",$.proxy(this.onClickBatchAction,this)),$(".remove-selected-items-collections",e).off("click",$.proxy(this.onRemoveSelectedItemsCollections,this)))}}),bizagi.injector.register("bizagi.workportal.widgets.sortbar",["workportalFacade","dataService","processActionService","accumulatedcontext",bizagi.workportal.widgets.sortbar]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.processeslist",{},{init:function(e,t,i){this.params=i,this._super(e,t,i),this.idworkflow=i.idworkflow,this.histName=i.histName,this.loadTemplates({processeslist:bizagi.getTemplate("bizagi.workportal.desktop.widget.processeslist").concat("#processeslist-wrapper"),processeslistEmptyData:bizagi.getTemplate("bizagi.workportal.desktop.widget.processeslist").concat("#processeslist-empty-message")})},renderContent:function(){var e=this,t=e.getTemplate("processeslist");return $.when(e.getData()).done((function(i){e.content=i.length>0?t.render({processes:i}):e.getEmptyDataMessage().render({}),e.setSelectedList($(".wdg-process-card:first",e.getContent()))}))},postRender:function(){var e=this;e.configureHandlers(),e.sub("GETIDWORKFLOW_FROM_PROCESSESLIST",(function(){return e.getIdworkflow()})),e.sub("GETHISTNAME_FROM_PROCESSESLIST",(function(){return e.getHistname()}))},configureHandlers:function(){var e=this.getContent();$(".wdg-process-card",e).on("click",$.proxy(this.onClickProcess,this))},getData:function(){var e=this,t={},i=e.params.route;switch(i){case"pendings":t={taskState:"all",myPendings:!0};break;case"following":t={taskState:"all",myActivities:!0,onlyFavorites:!0};break;case"Green":case"Red":case"Yellow":t={taskState:i}}return t.followingOrMyPending=!0,e.dataService.getAllProcesses(t).then((function(t){return e.getInfoToProcessesList(t)}))},getInfoToProcessesList:function(e){for(var t=e.categories,i=[],o=[],s=0,n=t.length;s<n;s++)for(var a=0,r=(i=t[s].workflows).length;a<r;a++)o.push({process:i[a].name,idworkflow:i[a].idworkflow});return o},onClickProcess:function(e){var t=bizagi.clone(this.params),i=$(e.target).closest(".wdg-process-card");this.setSelectedList(i),this.idworkflow=i.data("idworkflow"),this.histName=i.data("title"),this.pubDeadLockDetection("notify",{type:"CASES-TEMPLATE-VIEW",args:$.extend(t,{histName:this.histName,level:3,idworkflow:this.idworkflow})})},getIdworkflow:function(){return this.idworkflow},getHistname:function(){return this.histName},setSelectedList:function(e){$(e).addClass("wdg-plst-selected").siblings().removeClass("wdg-plst-selected")},getEmptyDataMessage:function(){return this.getTemplate("processeslistEmptyData")},clean:function(){var e=this.getContent();e&&$(".wdg-process-card",e).off("click"),this.unsub("GETIDWORKFLOW_FROM_PROCESSESLIST"),this.unsub("GETHISTNAME_FROM_PROCESSESLIST")}}),bizagi.injector.register("bizagi.workportal.widgets.processeslist",["workportalFacade","dataService",bizagi.workportal.widgets.processeslist],!0);
//# sourceMappingURL=../../../../Maps/desktop/cases-template-view.desktop.production.js.map
