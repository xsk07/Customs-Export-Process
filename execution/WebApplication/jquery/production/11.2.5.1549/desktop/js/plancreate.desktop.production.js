function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu",{},{onDiscussionsMenuStatusChange:function(e,t){this.updateDiscussionsIcons(t.hasDiscussionsOrComment)},updateDiscussionsIcons:function(e){this.sub("UPDATE_DISCUSSIONS_MENU_STATUS",$.proxy(this.onDiscussionsMenuStatusChange,this)),$(".bz-icon-discussion-comment").toggle(e),$(".bz-icon-discussion-no-comment").toggle(!e),this.params.hasDiscussionsOrComment=e},clean:function(){this.unsub("UPDATE_DISCUSSIONS_MENU_STATUS",$.proxy(this.onDiscussionsMenuStatusChange,this))}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu],!0),bizagi.workportal.widgets.project.dashboard.menu.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(e,t,i){this.params=i||{},this._super(e,t,i),this.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e._super(),e.params.contextsLeftSidebarCaseDashboard.forEach((function(t){e.sub(t,$.proxy(e.updateView,e))}))},updateView:function(e,t){this.params=$.extend(this.params,t.args),this.params.plan.idActivitySelected=void 0,this.clean();var i=this.getContent().empty();void 0!==e.type&&(this.params.showContextByMenuDashboard=e.type);var a={showFormOverview:this.params.menuDashboard.showFormOverview,showFormActivity:this.params.menuDashboard.showFormActivity,showCommentsOptionMenu:this.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:this.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:this.params.menuDashboard.showTimeLineOptionMenu&&(!this.params.isAdhocProcess||this.params.isAdhocProcess&&bizagi.util.isEnableFeature("enableTimelineOnLiveProcesses")),showPlanOptionMenu:this.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:this.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:this.params.menuDashboard.contextFormActivityOptionMenu};this.getTemplate("project-dashboard-menu").render(a).appendTo(i),this.params.showContextByMenuDashboard&&$("li[data-context='"+this.params.showContextByMenuDashboard.toUpperCase()+"']",this.content).addClass("active").siblings().removeClass("active"),this.updateDiscussionsIcons(this.params.hasDiscussionsOrComment),this.handlerEvents()},loadContentById:function(e){e.preventDefault();var t=$(e.target).closest("li");if(!t.hasClass("active")){var i=t.data("context");if(i){var a=this.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),r=parseInt(a[0],10),o="",s=r;"PLANACTIVITIES"==i&&(s=r+1,o=bizagi.localization.getResource("workportal-project-casedashboard-plan")),this.params.refreshLastItemBreadcrumb=!1,this.pub("notify",{type:i.toUpperCase(),args:$.extend(this.params,{showContextByMenuDashboard:i,histName:o,level:s})}),$("li[data-context='"+this.params.showContextByMenuDashboard.toUpperCase()+"']",this.content).addClass("active").siblings().removeClass("active")}}},subMenuHandler:function(){var e=this.getContent(),t=$("[data-context='COMMENTS']",e),i=$("[data-context='FILES']",e),a=$("[data-context='TIMELINE']",e);$(".ui-bizagi-wp-project-tab-submenu a",e).on("click",(function(){t.toggle(),i.toggle(),a.toggle()}))},handlerEvents:function(){var e=this,t=e.getContent();e.subMenuHandler(),$(".ui-bizagi-wp-project-tab-links a",t).on("click",$.proxy(e.loadContentById,e)),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).on("click",(function(){var t={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.params.idCase,idTask:e.params.idTask,idWorkflow:e.params.idWorkflow,idWorkItem:e.params.idWorkitem,referrer:e.params.referrer||"inboxGrid"};e.publish("executeAction",t)}))},clean:function(){var e=this,t=e.getContent();e._super(),e.params&&e.params.contextsLeftSidebarCaseDashboard&&e.params.contextsLeftSidebarCaseDashboard.forEach((function(t){e.unsub(t,$.proxy(e.updateView,e))})),$(".ui-bizagi-wp-project-tab-links a",t).off(),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).off()}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var e=this.getTemplate("project-content-dashboard");return this.content=e.render({}),this.content},postRender:function(){setTimeout((function(){$(window).trigger("resize")}),1e3)}}),bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0),bizagi.workportal.widgets.project.base.extend("bizagi.workportal.widgets.project.plan",{},{init:function(e,t,i,a){this._super(e,t,a),this.params=$.extend(this.params,a),this.planCreate=i,this.loadTemplates({"project-plan":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.plan").concat("#project-plan-wrapper"),"project-plan-popup":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.plan").concat("#project-plan-popup-template")})},renderContent:function(){var e=this.getTemplate("project-plan");return this.content=e.render({}),this.content},postRender:function(){var e=this.getContent();this.form={buttonShowPopupPlanToAdd:$("#buttonShowPopupCreatePlan",e)},this.form.buttonShowPopupPlanToAdd.on("click",$.proxy(this.onShowPopupPlan,this))},onShowPopupPlan:function(){var e=this,t=void 0===e.params.plan.contextualized||e.params.plan.contextualized;e.planCreate.showPopupAddPlan(e.params,e.dataService,t),e.planCreate.unsub("planCreated"),e.planCreate.sub("planCreated",(function(t,i){var a=i.paramsNewPlan;if(e.params.planChild={},-1!=e.params.showContextByMenuDashboard.indexOf("ACTIVITYPLAN")){var r=new bizagi.workportal.services.behaviors.plan(e.dataService);e.params.planParent=r.getPlanAsParent(e.params.plan)}e.params.planChild=bizagi.clone(a),e.pub("notify",{type:"UPDATE_LASTCRUMBPARAMS_INFO",args:{planChild:e.params.planChild}}),e.params.menuDashboard.contextPlanOptionMenu="PLANACTIVITIES";var o=e.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),s=parseInt(o[0],10)+1,n=bizagi.localization.getResource("workportal-project-casedashboard-plan");e.pub("notify",{type:"PLANACTIVITIES",args:$.extend(e.params,{showContextByMenuDashboard:"PLANACTIVITIES",histName:n,level:s})})}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.plan",["workportalFacade","dataService","bizagi.workportal.widgets.project.plan.create",bizagi.workportal.widgets.project.plan],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.overview",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"project-overview":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview"),"project-overview-no-summary-form-found":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.overview").concat("#project-overview-no-summary-form-found")})},renderContent:function(){var e=this.getTemplate("project-overview");return this.content=e.render({}),this.content},postRender:function(){var e=this,t=e.getContent(),i=$("#ui-bizagi-wp-project-overview-wrapper",t);i.bind("oldrenderintegration",(function(t){if(!t.isPropagationStopped()){t.stopPropagation();var a=e.workportalFacade.getTemplate("inbox-common-case-summary-oldrender"),r={};bizagi.oldrenderevent=!0;var o=window.addEventListener?"addEventListener":"attachEvent";(0,window[o])("attachEvent"==o?"onmessage":"message",(function(t){t.stopPropagation(),e.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t.data})}),!1),$.when(e.dataService.getWorkitems({idCase:e.params.idCase,onlyUserWorkItems:!0})).done((function(t){if("object"==_typeof(t.workItems)&&t.workItems.length>=1){var o=t.workItems[0].idWorkItem,s=t.workItems[0].idTask;r.url=e.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+e.idCase+"&idWorkitem="+o+"&idTask="+s+"&isSummary=1"}else r.url=e.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+e.idCase+"&isSummary=1";i.empty(),$.tmpl(a,r).appendTo(i),e.iframeOldRender($("iframe",i))}))}}));var a={idCase:e.params.idCase};$.when(e.dataService.getCaseFormsRenderVersion(a)).done((function(a){1==a.formsRenderVersion?i.trigger("oldrenderintegration"):e.renderSummaryForm(e.params.idCase,$("#ui-bizagi-wp-project-overview-wrapper",t))}))},renderSummaryForm:function(e,t){var i=this,a=null!=_typeof(i.dataService.serviceLocator.proxyPrefix)?i.dataService.serviceLocator.proxyPrefix:"",r=new bizagi.rendering.facade({proxyPrefix:a});r.execute({canvas:t,summaryForm:!0,idCase:e}),r.subscribe("no-data-found",(function(){var e=i.getTemplate("project-overview-no-summary-form-found");t.append(e.render())})),i.renderingFacade=r,setTimeout((function(){i.resizeLayout()}),1e3)},iframeOldRender:function(e){this.getContent();var t,i=bizagi.readQueryString();$.each(e,(function(){$(this).is("iframe")&&(t=$(this))})),t.load((function(){var e=$(this).contents(),t=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";t=t.replace("%theme%",i.theme||"bizagiDefault"),$("body",e).append("<link type='text/css' rel='stylesheet' href='"+t+"'>")}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.overview",["workportalFacade","dataService",bizagi.workportal.widgets.project.overview],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(e,t,i){this._super(e,t,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining"),"project-cancel-case-button":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-cancel-case-button")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;(e.contextsSidebarActivity||[]).forEach((function(t){e.sub(t,$.proxy(e.updateView,e))}))},updateView:function(e,t){var i=this;$.extend(i.params,t.args);var a=t.args;i.getContent().empty();var r={isFavoriteCase:"off"};if(a.isFavorite&&JSON.parse(a.isFavorite)?r.isFavoriteCase="bz-icon-star":r.isFavoriteCase="bz-icon-star-outline",i.showCaseNumber(a,r),a.creationDate){var o=bizagi.currentUser.timeZoneName,s=a.creationDate,n=i.getDateWithTimezone("MM/DD/yyyy H:mm",o,s);r.creationDateFormat=i.getFormattedDate(n);var c=i.getDateWithTimezone("MM/DD/yyyy H:mm",o,a.solutionDate);r.solutionDateFormat=i.getFormattedDate(c);var p=i.getDateWithTimezone("MM/DD/yyyy H:mm",o);i.calculateDataForTemplate(r,n,p,c,a)}$(i.getContent()).on("click",".show-diagram-case",(function(){!(!i.params.isAdhocProcess||void 0===i.params.isAdhocProcess)?i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkFlow,isAdhoc:!0,idProcess:i.params.idAdhocProcess}):i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkflow})})),$(i.getContent()).on("click",".show-process-help",(function(){i.showHelpUrl(i.params.helpUrl)}))},calculateDataForTemplate:function(e,t,i,a,r){var o=this.getContent(),s=bizagi.currentUser.timeZoneName,n={};n.idUser=bizagi.currentUser.idUser,bizagi.util.parseBoolean(r.isOpen)?(n.fromDate=t.getTime(),n.toDate=i.getTime()):(n.fromDate=a.getTime(),n.toDate=i.getTime());var c=n.toDate-n.fromDate,p=this.getDateWithTimezone("MM/DD/yyyy H:mm",s),d=bizagi.util.dateFormatter.getRelativeTime(new Date(p.getTime()-c),null,!1,s);bizagi.util.parseBoolean(r.isOpen)?(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",d),e.colorStateCase="Opened"):(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",d),e.colorStateCase="Closed"),e.percentCompleteBar=100,e.isOpen=bizagi.util.parseBoolean(r.isOpen),this.getTemplate("project-caseState-remaining").render($.extend(r,e)).appendTo($("#ui-bizagi-remaining",o))},showCancelCase:function(e,t,i){var a=this,r=a.getContent(),o=a.getTemplate("project-cancel-case-button");t.buttonCancelCase=i,o.render($.extend(e,t)).appendTo($("#ui-bizagi-cancel-case",r)),$("#ui-bizagi-wp-project-activity-cancel-case-button > a",a.content).click((function(){var e={widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_CANCEL_CASE,maximize:!1,dialogClass:"bz-cancel-case-widget",idWorkitem:a.params.idWorkitem,idCase:a.params.idCase,modalParameters:{refreshInbox:!1,title:bizagi.localization.getResource("workportal-widget-cancel-case-title"),width:420,height:400},closeVisible:!1};a.publish("showDialogWidget",e)}))},showCaseNumber:function(e,t){var i=this.getContent(),a=this.getTemplate("project-caseState"),r=!1;r=!(!this.params.isAdhocProcess||void 0===this.params.isAdhocProcess)&&this.params.isAdhocProcess,this.params.helpUrl=bizagi.util.validateUrlWellFormed(this.params.helpUrl),a.render($.extend(e,t,{security:bizagi.menuSecurity,isAdhocProcess:r,urlHelp:!bizagi.util.isEmpty(this.params.helpUrl)})).appendTo(i),this._startShowCancelCase(e,t),$(".case-summary-favorite",i).on("click",$.proxy(this.onClickFavorite,this)),$(".case-summary-back",this.content).on("click",$.proxy(this.goToCase,this,"back")),$(".case-summary-next",this.content).on("click",$.proxy(this.goToCase,this,"next")),this.showBackNextNavigation()},_startShowCancelCase:function(e,t){var i=bizagi.injector.get("bizagi.workportal.widgets.navigator"),a=this.showCancelCase.bind(this,e,t);i.getShowCancelCase().done(a)},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,i=e.getMonth(),a=BIZAGI_LANGUAGE;return null!=a&&null!=a&&a.length>0&&"fr"==a.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[i]:t[i]+" "+$.datepicker.formatDate("dd",e)},onClickFavorite:function(e){e.preventDefault();var t=this,i={};$(e.target).hasClass("bz-icon-star-outline")?(i={idObject:t.params.idCase,favoriteType:"CASES"},$.when(t.dataService.addFavorite(i)).done((function(i){t.params.guidFavorite=i.idFavorites,$(e.target).removeClass("bz-icon-star-outline"),$(e.target).addClass("bz-icon-star")}))):(i={idObject:t.params.guidFavorite,favoriteType:"CASES"},$.when(t.dataService.delFavorite(i)).done((function(){$(e.target).addClass("bz-icon-star-outline"),$(e.target).removeClass("bz-icon-star")})))},showHelpUrl:function(e){window.open(e)},callGetEffectiveDuration:function(e){var t=$.Deferred();return e.fromDate?$.when(this.dataService.getEffectiveDuration(e)).done((function(e){t.resolve(e)})):t.resolve(null),t.promise()},clean:function(){var e=this;$(".show-diagram-case",e.getContent()).off();var t=e.contextsSidebarActivity||[];this.params={},t.forEach((function(t){e.unsub(t,$.proxy(e.updateView,e))}))},goToCase:function(e){var t="back"==e?this.getBackCase():this.getNextCase();t>0&&this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t})},getListKey:function(){if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(var e=0;e<bizagi.lstIdCases.length;e++)if(this.params.idCase==bizagi.lstIdCases[e])return e;return-1},getNextCase:function(){var e=this.getListKey();return bizagi.lstIdCases.length==e+1||1==bizagi.lstIdCases.length?-1:bizagi.lstIdCases[e+1]},getBackCase:function(){var e=this.getListKey();return 0==e?-1:bizagi.lstIdCases[e-1]||-1},showBackNextNavigation:function(){var e=this.getNextCase(),t=this.getBackCase();e<=0?$(".case-summary-next",this.content).hide():$(".case-summary-next",this.content).show(),t<=0?$(".case-summary-back",this.content).hide():$(".case-summary-back",this.content).show(),e<=0&&t<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}}),bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(e,t,i){this._super(e,t,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach((function(t){e.sub(t,$.proxy(e.updateView,e))}))},updateView:function(e,t){var i=t.args;this.params=i,this.getContent();var a=bizagi.currentUser.timeZoneName,r={},o=i.currentState||[],s=o.filter((function(e){return e.idWorkItem==i.idWorkitem}))[0];if(s){r.activityName=s.state,r.activityIsEvent=bizagi.util.parseBoolean(s.isEvent);var n=this.getDateWithTimezone("MM/DD/yyyy H:mm",a,s.entryDateWorkItem);n.getTime&&(r.initDateFormat=this.getFormattedDate(n));var c=this.getDateWithTimezone("MM/DD/yyyy H:mm",a),p=this.getDateWithTimezone("MM/DD/yyyy H:mm",a,s.estimatedSolutionDate);r.estimatedSolutionDateFormat="",n.getTime&&p.getTime&&s?this.calculateDataForTemplate(s,r,n,c,p,o):this.updateTemplateWidget(r,o)}},initilizeActionMenu:function(e){var t=this,i=!1;if(e&&e.length>0)for(j=0;j<e.length;++j)e[j]&&t.params&&e[j].idWorkItem==t.params.idWorkitem&&(i=bizagi.util.parseBoolean(e[j].allowsReassign)||!1);var a=$("#bt-case-action-reassing",t.content),r=$("#ui-bizagi-wp-project-activity-button:not(.ui-bizagi-wp-project-activity-shared)",t.content);i&&a.show(),a.on("click",(function(){t.onClickMenuReasign()})),r.on("click",(function(){t.onClickShareActivity()}))},onClickMenuReasign:function(){var e=this,t=e.params.idCase,i=e.params.idWorkitem,a=function(){e.publish("closeCurrentDialog")};bizagi.loader.startAndThen("admin").then((function(){$.when(e.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:t,idWorkItem:i,closeDialogWidget:a},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))}))},onClickShareActivity:function(){var e={idWorkItem:this.params.idWorkitem},t=$("#ui-bizagi-wp-project-activity-button",this.content);t.attr("disabled",!0),$.when(this.dataService.getShareActivity(e)).done((function(e){var i=window.parent.bizagi.injector.get("notifier");!0===e.value?(t.addClass("ui-bizagi-wp-project-activity-shared").unbind("click"),i.showSucessMessage(bizagi.localization.getResource("workportal-project-activity-success-message"),"")):i.showErrorMessage(bizagi.localization.getResource("workportal-project-activity-error-message"),"")})).always((function(){t.attr("disabled",!1)}))},calculateDataForTemplate:function(e,t,i,a,r,o){var s=bizagi.currentUser.timeZoneName,n=a.getTime()-r.getTime(),c=i.getTime()-r.getTime(),p=(bizagi.currentUser.idUser,i.getTime()),d=this.getDateWithTimezone("MM/DD/yyyy H:mm",s).getTime(),u=!1,l={idUser:bizagi.currentUser.idUser,fromDate:a.getTime(),toDate:r.getTime()},g={};n>0?(l.fromDate=r.getTime(),l.toDate=a.getTime(),u=!0):(g.idUser=bizagi.currentUser.idUser,g.fromDate=i.getTime(),g.toDate=r.getTime());var h=d-p,m=l.toDate-l.fromDate,b=n>0?0:g.toDate-g.fromDate,v=this.getDateWithTimezone("MM/DD/yyyy H:mm",s),w=bizagi.util.dateFormatter.getRelativeTime(new Date(v.getTime()-h),null,!1,s);if(t.colorState=e.colorState,t.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",w),t.percentCompleteBar=100,0===c)t.showEstimatedSolutionDate=!1;else if(t.showEstimatedSolutionDate=!0,!1===u){var f=this.getPercentBar(b/1e3/60,m/1e3/60);t.percentCompleteBar=f.percent}e&&(t.isEvent=bizagi.util.parseBoolean(e.isEvent),t.canShareActivity=e.canShareActivity,t.isShared=e.isShared),t.estimatedSolutionDateFormat=this.getFormattedDate(r),this.updateTemplateWidget(t,o)},getPercentBar:function(e,t){var i={};return i.percent=Math.round(100*(1-t/e)),i},updateTemplateWidget:function(e,t){var i=this.getContent().empty();!1===bizagi.override.enableShareActivity&&(e.canShareActivity=!1,e.isShared=!1),this.getTemplate("project-activityState-wrapper").render(e).appendTo(i),t.length>0&&this.initilizeActionMenu(t),this.shareActivityTooltip()},shareActivityTooltip:function(){var e=$("#ui-bizagi-wp-project-activity-button",this.content);e.on("mouseenter",(function(){var t=e.hasClass("ui-bizagi-wp-project-activity-shared")?"workportal-project-activity-shared":"workportal-project-activity-share";e.attr("title",bizagi.localization.getResource(t))})),e.tooltip({tooltipClass:"custom-tooltip-styling-bottom-bar",position:{my:"right top",at:"left top",of:e,collision:"flip"}})},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,i=e.getMonth(),a=BIZAGI_LANGUAGE;return null!=a&&null!=a&&a.length>0&&"fr"==a.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[i]:t[i]+" "+$.datepicker.formatDate("dd",e)},clean:function(){var e=this,t=e.contextsSidebarActivity||[];this.params={},t.forEach((function(t){e.unsub(t,$.proxy(e.updateView,e))}))},callGetEffectiveDuration:function(e){var t=this,i=$.Deferred();return setTimeout((function(){e.fromDate?$.when(t.dataService.getEffectiveDuration(e)).done((function(e){i.resolve(e)})):i.resolve(null)}),200),i.promise()}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(e,t,i){this._super(e,t,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var e=this.getTemplate("project-process-state");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach((function(t){e.sub(t,$.proxy(e.updateView,e))}))},updateView:function(e,t){var i=t.args,a=this.getContent().empty();this.params=i;var r={};r.showParentProcess=i.idParentCase>=1,r.parentProcess={displayName:i.parentDisplayName,idCase:i.idParentCase,idWorkItem:i.idWorkItem,idTask:"0"==i.idTask?"":i.idTask,idWorkflow:i.idWorkflowParentCase},this.getTemplate("project-process-state").render($.extend(i,r)).appendTo(a),$("#go-to-parent-case",a).on("click",$.proxy(this.onClickGoToParentCase,this))},onClickGoToParentCase:function(e){e.preventDefault();this.routingExecute($(e.target).closest("#go-to-parent-case"))},clean:function(){var e=this;e.params={},e.contextsSidebarActivity.forEach((function(t){e.unsub(t,$.proxy(e.updateView,e))}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(e,t,i,a){this.relatedusers=i,this._super(e,t,a),this.contextsSidebarActivity=a.contextsSidebarActivity,this.plugins={},this.users=[],this.loadedUsers=!1,this.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach((function(t){e.sub(t,$.proxy(e.updateView,e))})),e.sub("ON_RENDER_FINISH",$.proxy(e.onRenderFinish,e))},updateView:function(e,t){var i=this;i.params=t,setTimeout((function(){!1===i.loadedUsers&&i.onRenderFinish()}),500)},onRenderFinish:function(){var e=this.params.args,t=this.getContent().empty();this.loadedUsers=!0,this.getTemplate("project-users").render().appendTo(t),this.showCreatorInformation(t);var i=[{id:e.createdBy.userId,typeName:"owner"}];e.idCase>0&&this.relatedusers.render(this.content,".relatedusers-wrapper",e.idCase,i)},showCreatorInformation:function(e){var t=this,i={userIds:t.params.args.createdBy.userId,width:50,height:50};t.dataService.getUsersData(i).done((function(i){var a=usersAdapter.createJsonUserInfo(i[0].id,i[0].name,i[0].username,i[0].picture?"data:image/png;base64,"+i[0].picture:void 0,i[0].email,i[0].name.getInitials(),!1,!0,[],[]);e.find("#ui-bizagi-wp-project-users-wrapper .ui-bizagi-wp-project-users-creator-info").userinformation(t,{user:a})}))},clean:function(){var e=this;e.loadedUsers=!1,e.contextsSidebarActivity.forEach((function(t){e.unsub(t,$.proxy(e.updateView,e))}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses.data",{responseSubprocessState:{},responseSubprocess:function(e){return e&&(responseSubprocessState=e),responseSubprocessState},auxArrayListSubprocessesState:[],auxArrayListSubprocesses:function(e){return e?jQuery.isArray(e)&&0===e.length?void(this.auxArrayListSubprocessesState.length=0):this.auxArrayListSubprocessesState.push(e):this.auxArrayListSubprocessesState}},{init:function(e,t,i){this._super(e,t,i),this.Class.auxArrayListSubprocesses([]),this.loadTemplates({"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.subprocesses.data").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},initializeTooltip:function(e){var t=this,i=t.getContent();$(e,i).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){var e,i,a,r=$(this).closest("li").find("#idCase").val(),o=t.Class.auxArrayListSubprocesses().filter((function(e){return e.idCase==r}));if(o.length>0)return e=o[0].indexSubprocess,i=o[0].idCustData,a=$(this).text(),t.getContentTooltip(e,i,a,t.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(e,t){if(void 0===e.originalEvent)return!1;var i=$(t.tooltip).attr("id");$("div.ui-tooltip").not("#"+i).remove()},close:function(e,t){t.tooltip.hover((function(){$(this).stop(!0).fadeTo(400,1)}),(function(){$(this).fadeOut("400",(function(){$(this).remove()}))}))}})},getContentTooltip:function(e,t,i,a){"-1"==t&&(t="0");var r=function(e,t){return{nameProperty:e,valueProperty:t}},o=[],s="",n=this.getSubprocessData(e,t),c=n.custData,p=n.custDataTypes,d=n.custFields,u=n.displayName;if(o.push(new r(bizagi.localization.getResource("workportal-widget-inboxcommon-subprocess"),u)),c.length)for(var l=0;l<c.length;l+=1)s=c[l],p&&("Money"==p[l]?s=bizagi.util.formatMonetaryCell(s):"Boolean"==p[l]?s=bizagi.util.formatBoolean(s):"Float"==p[l]||"Real"==p[l]?s=bizagi.util.formatDecimalCell(s):"function"==typeof s&&(s="")),o.push(new r(d[l],s));var g={};g.arrayCustomsProperties=o,g.nameSubprocess=i;var h=a,m=$('<div class="bizagi-custom-tooltip-subprocesses"></div>');return h.render(g).appendTo(m),m.html()},getSubprocessData:function(e,t){var i={},a=this.Class.responseSubprocess().subProcesses,r=this.Class.responseSubprocess().subProcPersonalized;if(a&&a.length>0){i.custData=a[e].custData,i.custDataTypes=a[e].custDataTypes;var o=this.Class.responseSubprocess().CustFields[t];i.custFields=o[Object.keys(o)[0]],i.displayName=a[e].displayName}else r&&Object.keys(r).length>0&&(i.custData=r[0].subProcesses[e].custData,i.custDataTypes=r[0].subProcesses[e].custDataTypes,i.custFields=r[0].CustFields[0],i.displayName=r[0].subProcesses[e].displayName);return i},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses.data",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses.data]),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.events",{},{init:function(e,t,i){this._super(e,t,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var e=this.getTemplate("project-events");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach((function(t){e.sub(t,$.proxy(e.updateView,e))}))},updateView:function(e,t){var i=this,a=t.args,r=i.getContent().empty();i.params=a,$.when(i.getArgsTemplate(a)).done((function(e){i.getTemplate("project-events").render($.extend(a,e)).appendTo(r),$(".list-events li.event a",r).on("click",$.proxy(i.onClickGoEvent,i)),i.initializeTooltip(".list-events li")}))},getArgsTemplate:function(e){var t=$.Deferred(),i={};if(e.countEvents>=1)for(var a=0;a<e.currentState.length;a++)"true"==e.currentState[a].isEvent&&e.currentState[a].idWorkItem==e.idWorkitem&&(e.countEvents=e.countEvents-1);return i.showEvents=e.countEvents>=1,i.showEvents?$.when(this.callSummaryCaseEvents(e.idCase)).done((function(a){e.showEvents=a.events.length>=1,e.showEvents&&(i.events=[],a.events.forEach((function(e){i.events.push($.extend(e[Object.keys(e)[0]],{idWorkFlow:a.idWorkFlow}))}))),t.resolve(i)})):t.resolve(i),t.promise()},onClickGoEvent:function(e){e.preventDefault();var t=this;$.when(bizagi.util.autoSave()).done((function(){t.routingExecute($(e.target).closest("li"))}))},callSummaryCaseEvents:function(e){var t=$.Deferred();return $.when(this.dataService.summaryCaseEvents({idCase:e})).done((function(e){t.resolve(e)})),t.promise()},clean:function(){var e=this;this.params={},e.contextsSidebarActivity.forEach((function(t){e.unsub(t,$.proxy(e.updateView,e))}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.subprocesses",{responseSubprocess:function(e){return this._super(e)},auxArrayListSubprocesses:function(e){return this._super(e)}},{init:function(e,t,i){this._super(e,t,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach((function(t){e.sub(t,$.proxy(e.updateView,e))}))},updateView:function(e,t){var i=this,a=t.args;i.getContent().empty();i.params=a,i.params.idCase>0&&$.when(i.dataService.summarySubProcess({idCase:i.params.idCase})).done((function(e){i.Class.responseSubprocess(e),i.organizeDataForSubprocesses(i.params)}))},organizeDataForSubprocesses:function(e){var t=this;if(t.Class.responseSubprocess().showSubProcess){$.each(t.Class.responseSubprocess().subProcesses,(function(e){var i=t.Class.responseSubprocess().subProcesses[e].custData;if(i&&i.length)for(var a=0;a<i.length;a+=1)null===i[a]&&(i[a]="")}));var i=t.Class.responseSubprocess().subProcesses||t.Class.responseSubprocess().subProcPersonalized;t.Class.auxArrayListSubprocesses([]);for(var a=0;a<Object.keys(i).length;a+=1){var r=i[a];t.Class.auxArrayListSubprocesses({isOpen:r.isOpen,radNumber:r.radNumber,displayName:r.displayName,idCase:r.idCase,indexSubprocess:a,idCustData:r.idCustData}),r.subProcesses&&Object.keys(r).forEach((function(e){t.Class.auxArrayListSubprocesses({isOpen:r[e].isOpen,radNumber:r[e].radNumber,displayName:r[e].displayName,idCase:r[e].idCase,indexSubprocess:a,idCustData:r[e].idCustData})}))}t.renderWidget()}},renderWidget:function(){var e=this.getContent();this.getTemplate("project-subprocesses").render({auxArrayListSubprocesses:this.Class.auxArrayListSubprocesses()}).appendTo(e),$(".list-subprocesses a",e).on("click",$.proxy(this.onClickGoSubprocess,this)),this.initializeTooltip(".list-subprocesses li")},onClickGoSubprocess:function(e){e.preventDefault();this.routingExecute($(e.target).closest("li"))},clean:function(){var e=this;e.params={},e.pluginTooltip=null,e.contextsSidebarActivity.forEach((function(t){e.unsub(t,$.proxy(e.updateView,e))}))}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.description",{},{init:function(e,t,i){this._super(e,t,i),i=i||{},this.loadTemplates({"project-activity-description":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.description").concat("#project-activity-description")})},renderContent:function(){var e=this.getTemplate("project-activity-description");return this.content=e.render(),this.content},postRender:function(){this.description=this.getWorkitemDescription(),this.description?this.callTaskDescription():this.content=$("<div />")},callTaskDescription:function(){var e={container:$("#ui-bizagi-wp-project-activity-task_description_container",this.content),description:this.description,width:310};this.taskDescriptionWidget=new bizagi.workportal.widgets.task.description(this.workportalFacade,this.dataService,e),this.taskDescriptionWidget.render()},getWorkitemDescription:function(){for(var e=this.params||{},t=e.idWorkitem||0,i=e.currentState||[],a="",r=0;r<i.length;r++)if(t==i[r].idWorkItem){a=i[r].tskDescription;break}return a},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity.description",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.description],!0);
//# sourceMappingURL=../../../../Maps/desktop/plancreate.desktop.production.js.map
