function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.rendering.container.extend("bizagi.rendering.desktop.container",{},{initializeData:function(e){this._super(e),this.containsGrid=0!=this.countByRenderType("grid")},createRenderElement:function(e){if((this.getFormContainer()&&this.getFormContainer().properties).isSearchesQueryForm){var t=e.render.properties;t.rangeQuery&&"none"!=t.rangeQuery&&(t.xpath=t.xpath+"@"+t.rangeQuery),"multiselect"!==t.type&&this._super(e)}else this._super(e)},resize:function(e){var t=this.container.width();t<300||0!=this.containsGrid&&$.each(this.children,(function(e,i){$.when(i.isRendered()).done((function(){i.resize({width:t})}))}))},startLoading:function(){var e=this.container;e&&e.startLoading({delay:250,overlay:!0})},endLoading:function(){var e=this.container;e&&e.endLoading()},countByRenderType:function(e){for(var t=0,i=0;i<this.children.length;i++){var r=this.children[i];r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(t+=r.countByRenderType(e)),r.properties.type==e&&t++}return t},countByRenderTypeWithParams:function(e,t){for(var i=0,r=0;r<this.children.length;r++){var a=this.children[r];a.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(i+=a.countByRenderType(e)),a.properties.type==e&&t==a.properties.height&&i++}return i},configureLayoutView:function(){this.container},getChildrenSumHeight:function(e){for(var t=0,i=0;i<this.children.length;i++){var r=this.children[i];if(e&&e==r.properties.type&&-1==r.properties.height);else if(r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var a=$(r.container).height();t+=null!=a?a:0}else if(r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER){var n=$(r.element).height();t+=null!=n?n:0}}return t},getChildreCount:function(){return this.children.length}}),bizagi.rendering.render.extend("bizagi.rendering.desktop.render",{},{postRender:function(){var e=this.properties;this._super(),"double"==e.retype&&this.processClassicRetype(),e.hint&&this.processRenderHint(),e.helpText&&e.helpText.length>0&&this.showIcon("help")},postRenderReadOnly:function(){var e=this.properties;e.helpText&&e.helpText.length>0&&this.showIcon("help")},processLayout:function(e,t){this._super(e,t)},startLoading:function(){var e=this.element;e&&e.startLoading({delay:250,overlay:!0})},endLoading:function(){var e=this.element;e&&e.endLoading()},getLabel:function(){return this.label||(this.label=$(".ui-bizagi-label",this.element||this.observableElement)),this.label},getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=$(".ui-bizagi-render-control",this.element||this.observableElement)),this.control&&0!=this.control.length?this.control:null},getControlFiller:function(){return this.controlFiller||(this.controlFiller=$(".ui-bizagi-control",this.element||this.observableElement)),this.controlFiller},setValidationMessage:function(e){var t=this;t._super(e),bizagi.util.isIE8()||$.when(t.ready()).done((function(){var i=t.element,r=$(".ui-bizagi-render-icon-error",i),a=$(".ui-bizagi-render-icon-help",i);e&&e.length>0?(t.showIcon("error"),bizagi.util.isIE9()?r.attr("data-title",e):r.attr("title",e),r.tooltip(),$(r).parent().removeClass("ui-hidden"),t.isNewRenderForm&&$(r).parent().removeClass("bz-forms-icons__hidden")):(t.hideIcon("error"),""==$(a).text()&&($(r).parent().addClass("ui-hidden"),t.isNewRenderForm&&$(r).parent().addClass("bz-forms-icons__hidden")))}))},processClassicRetype:function(){},processRenderHint:function(){var e=this.element,t=this.properties,i=$("input[type!=hidden], select",e);if(i){var r=i.parent();if(r){r.prepend('<label class="ui-bizagi-render-hint">'+t.hint+"</label>");var a=$(".ui-bizagi-render-hint",e);i.focus((function(){a.addClass("focus")})),i.keypress((function(){a.addClass("has-text").removeClass("focus")})),i.blur((function(){""==$(this).val()&&a.removeClass("has-text").removeClass("focus")})),a.click((function(){i.focus()}))}}},focus:function(e){for(var t=this;t;){var i=t.properties||{},r=t.params||{};if("section"===i.type){t.openAutomatically();break}if("form"===i.type||"form"===r.type){var a=t.getElement()[0],n=a?a.querySelector(".ui-bizagi-container-form-wrapper-animation"):null;if(null!=n&&""!==n.style.transform){n.style.transform="",$(".ui-bizagi-main-section",n)[0].classList.remove("ui-bizagi-section-animation-fade-out");var o=this.getFormContainer()||{},s=o.rendersByType?o.rendersByType.section:[];s.length>0&&s[0].closeAllSections()}}t=t.parent}this._super(e)},getDisplayOptionClass:function(e){return"normal"==e||"both"==e?"ui-bizagi-render-display-normal":"vertical"==e?"ui-bizagi-render-display-vertical":"reversed"==e?"ui-bizagi-render-display-reversed":"verticalReversed"==e?"ui-bizagi-render-display-vertical-reversed":"label"==e?"ui-bizagi-render-display-label":"value"==e?"ui-bizagi-render-display-value":""},changeDisplayOption:function(e){var t=this.element;this._super(e),t.removeClass("ui-bizagi-render-display-normal ui-bizagi-render-display-vertical ui-bizagi-render-display-reversed").removeClass("ui-bizagi-render-display-vertical-reversed ui-bizagi-render-display-label ui-bizagi-render-display-value"),t.addClass(this.getDisplayOptionClass(e))},getAlignClass:function(e){return"left"==e?"ui-bizagi-render-align-left":"center"==e?"ui-bizagi-render-align-center":"right"==e?"ui-bizagi-render-align-right":"justify"==e?"ui-bizagi-render-align-justify":""},changeLabelAlign:function(e){var t=this.getLabel();t.removeClass("ui-bizagi-render-align-left ui-bizagi-render-align-center ui-bizagi-render-align-right"),t.addClass(this.getAlignClass(e)),this._super(e)},changeValueAlign:function(e){var t=this.getControlFiller();t.removeClass("ui-bizagi-render-align-left ui-bizagi-render-align-center ui-bizagi-render-align-right"),t.addClass(this.getAlignClass(e)),this._super(e)},getContainerIcons:function(){return $(".ui-bizagi-render-icons",this.element)},showIcon:function(e){var t,i=this.getContainerIcons(),r=$(".ui-bizagi-render-icon-error",i),a=$(".ui-bizagi-render-icon-help",i);i.removeClass("ui-hidden"),this.isNewRenderForm&&i.removeClass("bz-forms-icons__hidden"),"error"==e&&(t=r.css("display","inline-block")),"help"==e&&(t=a.css("display","inline-block")),a.is(":visible")&&r.is(":visible")?i.css({width:"48px","min-width":"48px"}):(a.is(":visible")||r.is(":visible"))&&i.css({width:"24px","min-width":"24px"}),this.getControlFiller().addClass("ui-bizagi-state-show-icons"),t.mouseover((function(e){e.preventDefault(),e.stopPropagation(),void 0===t.data("tooltip")&&(t.tooltip({tooltipClass:"ui-widget-content ui-help-tooltip",items:t.attr("title")?".ui-icon[title]":".ui-icon[data-title]",content:function(){var e=/<\s*script[^>]*>[\s\S]*?(<\s*\/script[^>]*>|$)/gi,t=$(this);t.hasClass("ui-bizagi-render-icon-error");if(t[0]&&t[0].attributes["data-title"]){var i=t[0].attributes["data-title"].value;return e.test(i)?bizagi.util.sanitizeHTML(i):i}if(t[0]&&t[0].title){var r=t[0].title;return t[0].title="",e.test(r)?bizagi.util.sanitizeHTML(r):r}}}),t.tooltip("open"),$(".ui-help-tooltip").css("z-index",$.ui.dialog.prototype._getMaxZindex()))}))},hideIcon:function(e){var t=$(".ui-bizagi-render-icons",this.element),i=$(".ui-bizagi-render-icon-error",this.element);$(".ui-bizagi-render-icon-help",this.element).is(":visible")&&i.is(":visible")&&t.css({width:"24px","min-width":"24px"}),"error"==e&&$(".ui-bizagi-render-icon-error",this.element).css("display","none"),"help"==e&&$(".ui-bizagi-render-icon-help",this.element).css("display","none");var r=$(".ui-bizagi-render-icons span",this.element);r.length>0&&"none"!=r[0].style.display&&this.getControlFiller().removeClass("ui-bizagi-state-show-icons")},performDesignModeMethods:function(){var e=this.getControl();null!==e&&$("input, select, button, textarea",e).attr("readonly",!0),this._super()}}),bizagi.rendering.columns.column.extend("bizagi.rendering.desktop.columns.column",{},{applyOverrides:function(e){e&&(e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl),e.getFormattingLabel=function(e){return this.getControl()})},getControl:function(){var e=this._super();return e&&0!=e.length||(e=$(".ui-bizagi-cell-readonly",this.element||this.observableElement)),e},postRenderReadOnly:function(e,t){var i=this.properties;if(this._super(e,t),t&&t.length>0){var r=$(".ui-bizagi-cell-icon",t);i.editable||r.remove(),this.applyColumnStyles(t),"left"==i.align&&r.addClass("ui-bizagi-cell-icon-right")}},applyColumnStyles:function(e){var t=this.properties;t.textFormat.background&&(e.css("background-color",t.textFormat.background),e.css("background-image","none"))}}),$.Class.extend("bizagi.rendering.dialog.form",{POPUP_WIDTH:768,POPUP_HEIGHT:550},{init:function(e,t,i){var r=this,a=window.document;for(var n in r.buttons={},i.extraButtons)r.buttons[bizagi.localization.getResource(n)]=i.extraButtons[n];this.dataService=e,this.renderFactory=t,this.dialogDeferred=new $.Deferred,i=r.dialogParams=i||{},r.dialogBox=$("<div class='ui-bizagi-component-loading'/>"),r.dialogBox.empty(),r.dialogBox.appendTo("body",a),r.showDialogBox(r.dialogBox,i).done((function(e){r.dialogDeferred.resolve(e)})).fail((function(){r.dialogDeferred.reject({idPageCache:r.form.getPageCache()})}))},render:function(e){return this.renderDialogBox(this.dialogBox,e),this.dialogDeferred.promise()},showDialogBox:function(e,t,i){var r=this,a=(r.dialogParams.orientation,{}),n=new $.Deferred,o=null===bizagi.util.parseBoolean(t.showSaveButton)||bizagi.util.parseBoolean(t.showSaveButton),s=null===bizagi.util.parseBoolean(t.showCancelButton)||bizagi.util.parseBoolean(t.showCancelButton),l=t.saveButtonLabel?t.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"),d=t.cancelButtonLabel?t.cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-cancel"),c=null!==bizagi.util.parseBoolean(t.maximized)&&bizagi.util.parseBoolean(t.maximized),u=function(e){if(!!r.dialogParams.isPlanForm||r.form.validateForm()){var i={};t.forceCollectData?($.forceCollectData=!0,r.form.collectRenderValues(i),$.forceCollectData=!1):r.form.collectRenderValues(i),t.allowGetOriginalFormValues&&(i.formValues=r.form.children),i.idPageCache=r.form.getPageCache(),t.onSave&&!$(e.currentTarget).prop("disabled")?($(e.currentTarget).prop("disabled",!0),$(e.currentTarget).button("disable"),$.when(t.onSave(i)).done((function(t){$(e.currentTarget).prop("disabled",!1),$(e.currentTarget).button("enable"),null==t||1==t||"success"==t.type?(n.resolve(i),r.closeDialogBox()):["validationMessages","alertMessages"].includes(t.type)?("validationMessages"===t.type?r.form.addValidationMessage(t.messages):bizagi.modalError.show(t.messages,"workportal-general-word-information",!1),$.each(i,(function(e,t){var i=r.form.getRenders(e);$.each(i,(function(e,t){t.updateOriginalValue()}))}))):"error"===t.type&&r.form.addErrorMessage(t.message)})).fail((function(){$(e.currentTarget).prop("disabled",!1),$(e.currentTarget).button("enable")}))):(n.resolve(),r.closeDialogBox())}};if(o&&(a[l]=function(e){if(r.form){var t=r.form,i=$.Deferred(),a=t.getRenderByType("tabItem"),n=a.length;t.innerTabsLoading=!0,$(e.currentTarget).prop("disabled",!0),t.useOrSetLoaderDeferred();for(var o=0;o<n;o++){var s=a[o];s.loadingDeferred&&s.parent.container&&s.loadingDeferred.resolve()}delete t.innerTabsLoading,i.resolve({event:e}),$.when(i.promise(),t.getLoaderPromise()).done((function(e){var i=e.event;$(i.currentTarget).prop("disabled",!1),t.deleteLoaderDeferred(),u(i)})).fail((function(){$(e.currentTarget).prop("disabled",!1),t.deleteLoaderDeferred(),u(e)}))}}),s&&(a[d]=function(){t.onCancel&&t.onCancel(),n.reject(),r.closeDialogBox()}),r.buttons=$.extend(a,r.buttons),"rtl"==r.dialogParams.orientation){var p,g;for(var h in a){p=a[h],g=h;break}delete a[g],a[g]=p}return e.dialog({width:this.Class.POPUP_WIDTH,height:this.Class.POPUP_HEIGHT,title:t.title,modal:!0,buttons:r.buttons,resizable:!1,maximized:c,open:function(e,t){c&&"undefined"==typeof isWebpart&&$("body",window.document).css("position","fixed"),(bizagi.util.isSharepointContext()||bizagi.util.isWebpartContext())&&$(document).trigger("hide-webpart-scroll")},close:function(){$("body",window.document).css("position","static"),t.onCancel&&t.onCancel(),n.reject(),r.closeDialogBox()},resizeStop:function(e,t){r.form&&r.form.resize(t.size)},maximize:function(e){r.form&&(r.form.triggerHandler("maximazedForm"),r.dialogBox.trigger("resize"))},unmaximize:function(e){r.form&&(r.form.triggerHandler("unmaximazedForm"),r.dialogBox.trigger("resize"))}}),r.adjustOverlay(),n.promise()},_appresize:function(e){$(this.dialogBox).dialog("widget").css({left:window.screen.width/2-this.Class.POPUP_WIDTH/2+"px",top:window.screen.height/2-this.Class.POPUP_HEIGHT/2+"px",width:this.Class.POPUP_WIDTH+"px",height:this.Class.POPUP_HEIGHT+"px"}).show()},closeDialogBox:function(){var e=this.dialogBox;$("body",window.document).css("position","static"),(bizagi.util.isSharepointContext()||bizagi.util.isWebpartContext())&&$(document).trigger("show-webpart-scroll"),e.dialog("destroy"),e.remove(),this.dispose()},focusFirstControl:function(e,t){var i=this,r=function(){var t=$("input:visible, select:visible, option:visible, textarea:visible",e.container).not(".bz-input-icon--date .bz-input-icon__input, .ui-bizagi-render-search");if(t.length>0){var r=$(t[0]).closest(".ui-bizagi-render"),a=r.length>0?r.data("render-xpath"):"",n=a?e.getRender(a):"";if(n&&n.properties&&n.properties.retype&&"double"===n.properties.retype)return;var o=t[0];if(i.isValidControlForFocus(o,e))try{o.focus(),$(o).triggerHandler("focusInput")}catch(e){}}else{(o=$(".ui-bizagi-render",e.container)[0])&&($(o).attr("tabindex",0),o.focus(),$(o).removeAttr("tabindex"))}};if(t>0)var a=setTimeout((function(){r(),clearTimeout(a)}),t);else r()},isValidControlForFocus:function(e,t){var i=!0,r=$(e).closest("[data-render-id]"),a=r.data("render-id"),n=!(!a||!r.length)&&"cellContent"==r.data("bizagi-component");if(a&&n){var o=t.getGridByColumn(a),s=o?o.getColumnType(a):null;s&&"columnCombo"==s&&(i=!1)}return i},renderDialogBox:function(e,t){var i=this,r=new $.Deferred;e.empty();try{i.form&&i.form.params.data.contextType&&(t.contextType=i.form.params.data.contextType)}catch(e){}return t.rewriteContextType,$.when(i.dataService.getFormData(t)).pipe((function(e){return t.recordXPath&&(e.form.properties.recordXpath=t.recordXPath),e.form.contextType=t.contextType,t.rewriteContextType&&(e.form.contextType=void 0),!1===t.editable&&(e.form.properties.editable=!1,i.removeActions(e.form)),!1===t.required&&(e.form.properties.required=!1),i.removeTransitions(e.form),i.form=i.renderFactory.getContainer({type:"form",data:e.form,canvas:i.dialogBox,focus:t.focus||!1,selectedTabs:t.selectedTabs,isRefresh:t.isRefresh||!1,requestedForm:t.requestedForm,fromRender:t.fromRender}),r.resolve(i.form),i.form.render()}),(function(t){var r=i.renderFactory.getCommonTemplate("form-error");if("object"==_typeof(t)&&t.responseText){var a=JSON.parse(t.responseText);t="Error:"+a.errorType+"<br>"+a.message||" Error in form "}$("*",e).remove(),$.tmpl(r,{message:t}).appendTo(e)})).done((function(r){$(".ui-bizagi-button-container",r).remove(),$(".ui-bizagi-loading-message",e).remove(),e.data("loading",!1),e.removeClass("ui-bizagi-component-loading"),e.html(r),e=i.customizeDialogBox(e),i.form.triggerHandler("ondomincluded",i.form),bizagi.override.adjustButtonPositionDialogForm&&i.adjustButtonPosition(e),t.scrollTop?i.form.container.parent().scrollTop(t.scrollTop):i.focusFirstControl(i.form,150),i.form.bind("refresh",(function(r,a){return a.scrollTop=i.form.container.parent().scrollTop(),a=$.extend({focus:focus,selectedTabs:i.form.getSelectedTabs(),isRefresh:!0,mainForm:t.mainForm},a),i.renderDialogBox(e,a)}))}))},adjustButtonPosition:function(e){var t=e.find(".ui-bizagi-container:first")[0],i=e.parent().height()-29-58;new ResizeSensor(t,(function(){i=e.parent().height()-29-58,r()}));var r=function(){t.clientHeight>i?(e.height(i-20),$(".ui-dialog-buttonpane",e.parent()).css("top",29+i)):(e.height(t.clientHeight+20),$(".ui-dialog-buttonpane",e.parent()).css("top",29+e.height()))};r()},customizeDialogBox:function(e){return e},removeTransitions:function(e){(e=e||{}).transitions&&delete e.transitions},removeActions:function(e){(e=e||{}).actions&&delete e.actions},dispose:function(){this.form&&this.form.dispose(),bizagi.util.dispose(this.buttons),bizagi.util.dispose(this)},adjustOverlay:function(){var e=$(".ui-widget-overlay.ui-front"),t=$("body"),i=$("#render-canvas"),r=parseInt(e.height()),a=parseInt(t.height()),n=parseInt(i.height());r<a&&(e.height(a),r=a),r<n&&e.height(n)}}),$.Class.extend("bizagi.rendering.dialog.startForm",{POPUP_WIDTH:900,POPUP_HEIGHT:650},{init:function(e,t,i){var r=this,a=window.document;for(var n in r.buttons={},i.extraButtons)r.buttons[bizagi.localization.getResource(n)]=i.extraButtons[n];this.dataService=e,this.renderFactory=t,this.dialogDeferred=new $.Deferred,i=r.dialogParams=i||{},r.dialogBox=$("<div class='ui-bizagi-component-loading'/>"),r.dialogBox.empty(),r.dialogBox.appendTo("body",a),r.showDialogBox(r.dialogBox,i).done((function(e){r.dialogDeferred.resolve(e)})).fail((function(){r.dialogDeferred.reject()}))},render:function(e){return this.renderDialogBox(this.dialogBox,e),this.dialogDeferred.promise()},showDialogBox:function(e,t){var i=this,r={},a=new $.Deferred,n=null===bizagi.util.parseBoolean(t.showSaveButton)||bizagi.util.parseBoolean(t.showSaveButton),o=null===bizagi.util.parseBoolean(t.showCancelButton)||bizagi.util.parseBoolean(t.showCancelButton),s=t.saveButtonLabel?t.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"),l=t.cancelButtonLabel?t.cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-cancel"),d=null!==bizagi.util.parseBoolean(t.maximized)&&bizagi.util.parseBoolean(t.maximized);return n&&(r[s]=function(){if(i.form&&i.form.validateForm()){var e={};t.forceCollectData?($.forceCollectData=!0,i.form.collectRenderValues(e),$.forceCollectData=!1):i.form.collectRenderValues(e),t.allowGetOriginalFormValues&&(e.formValues=i.form.children),e.idPageCache=i.form.getPageCache(),t.onSave?$.when(t.onSave(e)).done((function(t){null==t||1==t||"success"==t.type?(a.resolve(),i.closeDialogBox()):["validationMessages","alertMessages"].includes(t.type)?("validationMessages"===t.type?i.form.addValidationMessage(t.messages):bizagi.modalError.show(t.messages,"workportal-general-word-information",!1),$.each(e,(function(e){var t=i.form.getRenders(e);$.each(t,(function(e,t){t.updateOriginalValue()}))}))):"error"===t.type&&i.form.addErrorMessage(t.message)})):(a.resolve(),i.closeDialogBox())}}),o&&(r[l]=function(){t.onCancel&&t.onCancel(),i.closeDialogBox()}),i.buttons=$.extend(r,i.buttons),e.dialog({width:this.Class.POPUP_WIDTH,height:this.Class.POPUP_HEIGHT,title:t.title,modal:!0,buttons:i.buttons,resizable:!1,maximized:d,open:function(){d&&$("body",window.document).css("position","fixed")},close:function(){$("body",window.document).css("position","static"),a.reject(),i.closeDialogBox()},resizeStop:function(e,t){i.form&&i.form.resize(t.size)},maximize:function(e){i.form&&i.form.triggerHandler("maximazedForm")},unmaximize:function(e){i.form&&i.form.triggerHandler("unmaximazedForm")}}),i.adjustOverlay(),a.promise()},_appresize:function(){$(this.dialogBox).dialog("widget").css({left:window.screen.width/2-this.Class.POPUP_WIDTH/2+"px",top:window.screen.height/2-this.Class.POPUP_HEIGHT/2+"px",width:this.Class.POPUP_WIDTH+"px",height:this.Class.POPUP_HEIGHT+"px"}).show()},closeDialogBox:function(){var e=this.dialogBox;$("body",window.document).css("position","static"),e.dialog("destroy"),e.remove(),this.dispose()},renderDialogBox:function(e,t){var i=this,r=new $.Deferred;e.empty();try{i.form&&i.form.params.data.contextType&&(t.contextType=i.form.params.data.contextType)}catch(e){}return $.when(i.dataService.getStartForm(t)).pipe((function(e){return e.form.contextType=t.contextType,0==t.editable&&(e.form.properties.editable=!1,i.removeActions(e.form)),i.removeTransitions(e.form),i.form=i.renderFactory.getContainer({type:"form",data:e.form,focus:t.focus||!1,selectedTabs:t.selectedTabs,isRefresh:t.isRefresh||!1}),r.resolve(i.form),i.form.render()}),(function(t){var r=i.renderFactory.getCommonTemplate("form-error");if("object"==_typeof(t)&&t.responseText){var a=JSON.parse(t.responseText);t="Error:"+a.errorType+"<br>"+a.message||" Error in form "}$("*",e).remove(),$.tmpl(r,{message:t}).appendTo(e)})).done((function(r){$(".ui-bizagi-button-container",r).remove(),$(".ui-bizagi-loading-message",e).remove(),e.data("loading",!1),e.removeClass("ui-bizagi-component-loading"),e.html(r),e=i.customizeDialogBox(e),i.form.triggerHandler("ondomincluded");var a=setTimeout((function(){if(i.dialogParams.maximized){var e=i.dialogBox.data("ui-dialog");e.recalculate&&e.recalculate()}clearTimeout(a)}),650);i.form.bind("refresh",(function(r,a){return a=$.extend({focus:focus,selectedTabs:i.form.getSelectedTabs(),isRefresh:!0},t,a),i.renderDialogBox(e,a)}))}))},customizeDialogBox:function(e){return e},removeTransitions:function(e){(e=e||{}).transitions&&delete e.transitions},removeActions:function(e){(e=e||{}).actions&&delete e.actions},dispose:function(){this.form&&this.form.dispose(),bizagi.util.dispose(this.buttons),bizagi.util.dispose(this)},adjustOverlay:function(){var e=$(".ui-widget-overlay"),t=$("body"),i=parseInt(e.height()),r=parseInt(t.height());i<r&&e.height(r)}}),$.Class.extend("bizagi.rendering.dialog.search",{POPUP_WIDTH:800,POPUP_HEIGHT:600},{init:function(e,t,i,r,a){var n=this,o=window.document;a=a||{},this.dataService=e,this.renderFactory=t,this.searchForms=i,this.searchParams=r,this.dialogDeferred=new $.Deferred,this.extraButtons=!!a.hasOwnProperty("buttons")&&a.buttons,n.dialogBox=$("<div class='ui-bizagi-component-loading'/>"),n.dialogBox.empty(),n.dialogBox.appendTo("body",o),n.showDialogBox(n.dialogBox).done((function(e){n.dialogDeferred.resolve(e),n.form.unbindAutoSaveForm()})).fail((function(){n.dialogDeferred.reject(),n.form.unbindAutoSaveForm()}))},render:function(e){return this.renderSearchDialog(e),this.dialogDeferred.promise()},renderSearchDialog:function(e){var t=this;t.form=null,$.when(t.getSearchContainerData(e)).pipe((function(i){void 0!==i.form.properties&&(i.form.properties.orientation=e.orientation||"ltr");var r=t.renderFactory.getContainer({type:"form",data:i.form,canvas:t.dialogBox});return e.contexttype&&(r.properties.contexttype=e.contexttype),t.form=r,t.form.render()})).done((function(i){$(".ui-bizagi-button-container",i).remove(),$(".ui-bizagi-loading-message",t.dialogBox).remove(),i.appendTo(t.dialogBox),t.form.triggerHandler("ondomincluded");var r="tab"==t.form.firstChild().properties.type?t.form.firstChild():null;r?(r.bind("selected",(function(i,r){var a=t.searchForms[r.index];$.when(t.loadSearchTab(e,r.tab,a)).done((function(){t.currentSearchForm=r.tab.firstChild(),t.currentSearchForm.triggerHandler("ondomincluded")}))})),r.container.tabs("option","active",0),t.currentSearchForm=r.firstChild().firstChild(),t.currentSearchForm.triggerHandler("ondomincluded")):(t.currentSearchForm=t.form.firstChild(),t.currentSearchForm.triggerHandler("ondomincluded")),t.focusFirstControl(t.currentSearchForm,100),t.currentSearchForm.bind("instanceSelected",(function(e,i){t.closeDialogBox(),t.dialogBoxDeferred.resolve({id:i.id,label:""})})),t.currentSearchForm.bind("multiSelect",(function(e,i){t.closeDialogBox(),t.dialogBoxDeferred.resolve({id:i.id,label:i.data})}))}))},focusFirstControl:function(e,t){var i=function(){var t=$("input:visible, select:visible, option:visible, textarea:visible",e.container);if(t.length>0){var i=t[0];try{i.focus()}catch(e){}}};t>0?setTimeout(i,t):i()},loadSearchTab:function(e,t,i){var r=this,a=new $.Deferred;return t.children.length>0?null:($.when(r.getSearchFormData(e,i)).pipe((function(e){var i=r.renderFactory.getContainer({type:"searchForm",data:e.form});return t.children.push(i),i.render()})).done((function(e){$(".ui-bizagi-button-container",e).remove(),t.container.append(e),a.resolve()})),a.promise())},showDialogBox:function(e,t){var i=this,r=(t="rtl"==i.searchParams.orientation,[]);i.dialogBoxDeferred=new $.Deferred;var a=[{text:bizagi.localization.getResource("render-form-dialog-box-search"),click:function(){i.searchParams&&(i.searchParams.searchTriggeredBy="button"),i.currentSearchForm.performSearch(i.searchParams)}},{text:bizagi.localization.getResource("render-form-dialog-box-cancel"),click:function(){i.dialogBoxDeferred.reject(),i.closeDialogBox()}}];this.extraButtons&&r.push(this.extraButtons),r=r.concat(a),t&&r.reverse();var n=this.Class.POPUP_WIDTH,o=this.Class.POPUP_HEIGHT;return n>$(window).width()&&(n=.9*$(window).width()),e.addClass("ui-bizagi-dialog-search").dialog({title:bizagi.localization.getResource("render-search-dialog-title"),width:n,height:o,resizable:!1,modal:!0,buttons:r,close:function(){i.dialogBoxDeferred.reject(),i.closeDialogBox()},resizeStop:function(e,t){i.form.resize(t.size)},maximize:function(e){i.currentSearchForm&&(i.currentSearchForm.triggerHandler("maximazedForm"),i.dialogBox.trigger("resize"))},unmaximize:function(e){i.currentSearchForm&&(i.currentSearchForm.triggerHandler("unmaximazedForm"),i.dialogBox.trigger("resize"))}}),i.dialogBoxDeferred.promise()},closeDialogBox:function(){var e=this.dialogBox;e.dialog("destroy"),e.detach();var t=this.currentSearchForm.getPageCache();this.dataService.invalidatePageCache({idPageCache:t})},addButtons:function(e){},getSearchContainerData:function(e){var t=this,i=new $.Deferred,r={form:{properties:{},elements:[]}},a=r.form,n=t.searchForms[0];if(t.searchForms.length>1){var o={properties:{type:"tab"},elements:[]},s=[];$.each(t.searchForms,(function(e,i){var r=i.default||!1,l={};l.properties={id:e,type:"tabItem",displayName:i.caption},l.elements=[],r?(o.elements.push({container:l}),a=l,n=t.searchForms[0]):s.push({container:l})})),$.each(s,(function(e,t){o.elements.push(t)})),r.form.elements.push({container:o})}return $.when(t.getSearchFormData(e,n)).done((function(e){e&&(a.elements.push(e),a.pageCacheId=e.form.pageCacheId,i.resolve(r))})).fail((function(){console.log("Error")})),i.promise()},getSearchFormData:function(e,t){if(null==t||null==t.id){var i=bizagi.localization.getResource("render-search-without-form"),r=$("<div>").append(i);return this.dialogBox.dialog("close"),$(r).dialog({modal:!0,buttons:[{text:bizagi.localization.getResource("render-form-dialog-box-close"),click:function(){$(this).dialog("close")}}],maximize:function(e){console.log("please check if executed, which form trigger the event 'dialog.search'")},unmaximize:function(e){console.log("please check if executed, which form trigger the event 'dialog.search'")}}),!1}return this.dataService.getSearchFormData($.extend(e,{idSearchForm:t.id,url:t.url})).pipe((function(t){return t.form.properties.idRender=e.idRender,t}))},dispose:function(){this.form.dispose(),bizagi.util.dispose(this.buttons),bizagi.util.dispose(this)}}),bizagi.rendering.dialog.search.extend("bizagi.rendering.dialog.searchUser",{},{init:function(e,t,i,r,a){this._super(e,t,i,r,a)},getSearchFormData:function(e){return{form:{properties:{id:"3ad923cf-f21e-439e-90b5-f2df8ffe4559",type:"searchForm",displayName:"SearchWFuser",xpathContext:"",columns:[{caption:"idUser",dataType:7,xpath:"idUser"},{caption:"userName",dataType:15,xpath:"userName"},{caption:"domain",dataType:15,xpath:"domain"},{caption:"fullName",dataType:15,xpath:"fullName"},{caption:"enabledForAssignation",dataType:5,xpath:"enabledForAssignation"},{caption:"enabled",dataType:5,xpath:"enabled"}]},elements:[{render:{properties:{id:"e0babe1d-7924-4d2a-8fb3-b915b746dbe6",type:"searchText",xpath:"domain",displayName:"domain",dataType:15}}},{render:{properties:{id:"87b14b2e-992d-4e40-a17b-eecbcbc2466a",type:"searchText",xpath:"userName",displayName:"userName",dataType:15}}},{render:{properties:{id:"c5d137d9-a392-4d8e-9088-d5eba64b4c2a",type:"searchText",xpath:"fullName",displayName:"fullName",dataType:15}}}],buttons:[],sessionId:"bcy5gtv11xxao4oy4xrlk3o3",pageCacheId:1876964702},type:"form"}}}),$.Class.extend("bizagi.rendering.dialog.letter",{POPUP_WIDTH:800,POPUP_HEIGHT:550},{init:function(e,t){this.dataService=e,this.renderFactory=t},render:function(e){var t=window.document,i=this.renderFactory.getTemplate("letter.dialog"),r=$.tmpl(i);r.appendTo("body",t);var a=$("#ui-bizagi-rtfeditor",r);return a.width(this.Class.POPUP_WIDTH-30),a.height(this.Class.POPUP_HEIGHT-150),new nicEditor({iconsPath:this.dataService.getLetterEditorIconsPath(),fullPanel:!0}).panelInstance("ui-bizagi-rtfeditor"),this.templateParts=e.split(/(<body>|<\/body>)/gi),nicEditors.findEditor("ui-bizagi-rtfeditor").setContent(e),this.showDialogBox(r)},showDialogBox:function(e){var t=this,i={},r=new $.Deferred;return i[bizagi.localization.getResource("render-letter-dialog-box-save")]=function(){var i=nicEditors.findEditor("ui-bizagi-rtfeditor").getContent();e.dialog("destroy"),e.remove(),"<body>"==t.templateParts[1]?(t.templateParts[2]=i.replaceAll("<header></header>",""),r.resolve(t.templateParts.join(""))):r.resolve(t.templateParts[0]+"<body>"+i+"</body>"+(t.templateParts.length>2?t.templateParts[2]:""))},i[bizagi.localization.getResource("render-letter-dialog-box-cancel")]=function(){e.dialog("close")},e.dialog({width:this.Class.POPUP_WIDTH,height:this.Class.POPUP_HEIGHT,title:bizagi.localization.getResource("render-letter-dialog-title"),modal:!0,buttons:i,close:function(t,i){e.dialog("destroy"),e.remove(),r.reject()}}),r.promise()}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.form",bizagi.rendering.form.prototype),bizagi.rendering.desktop.form.extend("bizagi.rendering.desktop.form",{},{postRenderContainer:function(e){var t=this;if(t.useQuickActions&&t.initFormButton(),t._super(e),"execution"===t.getMode()){var i=t.getButtons();i.button(),(i?i.length:0)&&"form"===t.params.type&&!0!==t.params.isEntityForm?($(document).data("auto-save",t.properties.id),t.configureBindAutoSave((function(e){t.autoSaveEvents(e)})),t.beforeUnloadFunction=function(e){var i={};if(t.collectRenderValues(i),!$.isEmptyObject(i)&&$(document).data("auto-save"))return bizagi.localization.getResource("confirmation-savebox-message2")},$(window).unbind("beforeunload").bind("beforeunload",t.beforeUnloadFunction)):$._data(document).events&&!$._data(document).events["save-form"]&&t.configureBindAutoSave((function(e){e.resolve()})),t.buildProcessPath(),("undefined"!=typeof isWebpart?$(document):$("#ui-bizagi-wp-app-render-form-content")).scroll((function(){$(".modal-ecm",this).hide()}))}},configureBindAutoSave:function(e){this.autoSaveFunction=function(t,i){e(i)},this.haveAutosaveAssociated()?$(document).unbind("save-form",this.saveFormDelegate):this.saveFormDelegate=$.proxy(this.autoSaveFunction,this),$(document).unbind("save-form").bind("save-form",{idAutoSave:this.getIdentifierFormForAutosave(),functionSaveFormDelegate:this.saveFormDelegate},this.saveFormDelegate)},unbindAutoSaveForm:function(){this.saveFormDelegate&&$(document).unbind("save-form",this.saveFormDelegate)},getIdentifierFormForAutosave:function(){return this.properties.id?this.properties.id.concat("_"+this.properties.uniqueId):this.properties.uniqueId},haveAutosaveAssociated:function(){for(var e=!1,t=this.getIdentifierFormForAutosave(),i=$._data($(document)[0],"events")["save-form"]||[],r=0,a=i.length;r<a;r+=1)if(i[r].data.idAutoSave===t){this.saveFormDelegate=i[r].data.functionSaveFormDelegate,e=!0;break}return e},autoSaveEvents:function(e,t){var i=this,r={},a=[];i.getFormContainer().hasChanged(a),a.length>0?$.when(bizagi.showSaveBox(bizagi.localization.getResource("confirmation-savebox-message1"),"Bizagi","warning",i.properties.orientation)).done((function(){i.collectRenderValues(r),$.when(i.saveForm(r)).done((function(){i.saveFormDelegate&&$(document).unbind("save-form",i.saveFormDelegate),bizagi.util.isSharepointContext()&&$(document).data("auto-save",""),e.resolve()}))})).fail((function(t){"cancel"==t?e.reject():(e.resolve(),i.saveFormDelegate&&$(document).unbind("save-form",i.saveFormDelegate),bizagi.util.isSharepointContext()&&$(document).data("auto-save",""))})):(i.saveFormDelegate&&$(document).unbind("save-form",i.saveFormDelegate),e.resolve())},getButtons:function(){var e=this.container;return $(".ui-bizagi-button-container .ui-bizagi-button",e)},configureLayoutView:function(){},dispose:function(){$(window).unbind("beforeunload",this.beforeUnloadFunction),$(document).unbind("save-form",this.saveFormDelegate),this._super()},saveForm:function(e){var t=this,i=bizagi.util.isOfflineForm({context:t}),r=null;return(e=t.collectRenderValuesForSubmit(e)).deferreds&&(r=$.when.apply($,e.deferreds),delete e.deferreds),$.when(r).pipe((function(){return t.startLoading(),t.dataService.submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,isOfflineForm:i||!1}).always(t.endLoading.bind(t))}))},getChanges:function(){var e={};return void 0!==this.collectRenderValues&&this.collectRenderValues(e),e},buildProcessPath:function(e){var t=this.properties,i=this.getMode(),r="queryForm"==this.getFormType(),a=this.params.summaryForm||!1,n=this.properties.displayAsReadOnly||!1;if("execution"==i&&!r&&!a&&!n&&this.properties.processPath&&this.properties.processPath.length>0){var o=this.renderFactory.getTemplate("form-process-path"),s=$.fasttmpl(o,{processPath:t.processPath});this.pathProcess=s}else this.pathProcess=""},initFormButton:function(){var e=this,t=e.getFormContainer(),i=bizagi.override&&bizagi.override.maxButtonForQuickActions>0?bizagi.override.maxButtonForQuickActions:6,r=e.buttons||[],a=e.getListWithPriority(r,i);a.length>0&&$(".ui-bizagi-button-container.bz-form-buttons",t.container).formButtons({maxButtons:i,buttons:a,click:function(t,i){e.processQuickButton(i.ordinal)}})},getListWithPriority:function(e,t){return e.filter((function(e){return!1!==bizagi.util.parseBoolean(e.visible)})).map((function(e,i){return Object.assign(e,{visible:!1!==bizagi.util.parseBoolean(e.visible),additional:i+1>t,priority:!0!==e.quickAction?1:i,ranked:!0,index:i})}))}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.panel",bizagi.rendering.panel.prototype),bizagi.rendering.desktop.panel.extend("bizagi.rendering.desktop.panel",{},{}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.contentPanel",bizagi.rendering.contentPanel.prototype),bizagi.rendering.desktop.contentPanel.extend("bizagi.rendering.desktop.contentPanel",{},{}),bizagi.rendering.desktop.panel.extend("bizagi.rendering.desktop.nestedForm",{},{configureDesignView:function(){var e=this.properties,t=this.container;t.removeClass("ui-bizagi-container-panel"),t.addClass("ui-bizagi-container-nestedform");var i=$("<span class= 'ui-bizagi-container-nestedform-title'/>");i.text("Nested Form: "+e.formDisplayName),t.prepend(i)}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.tab",bizagi.rendering.tab.prototype),bizagi.rendering.desktop.tab.extend("bizagi.rendering.desktop.tab",{},{postRenderContainer:function(e){var t=this;t._super(e),e.tabs({active:t.activeTab,activate:function(e,i){t.children[t.activeTab].visibleTab();var r=setTimeout((function(){t.resize({width:t.container.width(),height:t.container.height()}),void 0!==t.getParams()&&("sharepoint"!=t.getParams().context&&window.self===window.top||t.resizeInPopUpHTML()),clearTimeout(r)}),50)},beforeActivate:function(e,i){var r=i.newTab.index();t.setActiveTab(r)}});var i=setTimeout((function(){t.children.forEach((function(t){var i=t.properties;if(i.tooltip){var r=$("a[href=#ui-bizagi-tab-"+i.id+"]",e);r.tooltip({content:r.attr("title"),position:{at:"center top-55"}})}})),clearTimeout(i)}),10)},resizeInPopUpHTML:function(){if($(".activitiFormContainer").length>0){var e=$(".activitiFormContainer").height()||0,t=$(".activitiFormContainer #ui-bizagi-webpart-render-container"),i=$(".ui-bizagi-button-container",".activitiFormContainer");if(this.getParams().idWorkitem||i.length>0){var r=i.height()||0;t.height(e-110-r)}else t.height(e-110)}},configureLayoutView:function(){}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.tabItem",bizagi.rendering.tabItem.prototype),bizagi.rendering.desktop.tabItem.extend("bizagi.rendering.desktop.tabItem",{},{init:function(e){this._super(e),this.tabReadyDeferred=new $.Deferred,this.loadingDeferred=new $.Deferred,this.tabActiveDeferred=new $.Deferred},resize:function(e){var t=this,i=t.container,r=i.width(),a=0;$.when(t.ready()).done((function(){!function e(){if(!(a>10))if(i.is(":visible"))$.each(t.children,(function(e,t){t.resize({width:r})}));else{a++;var n=setTimeout((function(){e(),clearTimeout(n)}),200)}}()}))},setAsActiveContainer:function(e){var t=this;$.when(t.ready()).done((function(){var e=t.parent;e.container.data("ui-tabs")&&e.container.tabs("option","active",t.container.data("tab-counter"))}))},activate:function(){this._super(),this.loadingDeferred&&this.loadingDeferred.resolve()},visibleTab:function(){this.tabActiveDeferred&&this.tabActiveDeferred.resolve()},focus:function(){this.activate(),this.setAsActiveContainer(),this._super()},renderTabContent:function(e){var t=this,i=this.properties,r=t.getFormContainer();if(void 0===i.loadOnDemand||0==i.loadOnDemand||r.innerTabsLoading||r.params.printversion||t.canSkipThisFormType(r.properties.type))return e=t.replaceChildrenHtml(e,t.renderChildrenHtml()),t.tabReadyDeferred.resolve(),t.tabActiveDeferred.resolve(),e;if(t.startLoading(),"execution"==t.getMode())var a=setTimeout((function(){t.loadingDeferred&&t.loadingDeferred.resolve(),clearTimeout(a)}),10500);return $.when(t.loadingDeferred.promise()).done((function(){t.isDisposed()?(t.tabReadyDeferred.reject(),t.tabActiveDeferred.reject()):$.when(t.parent.ready()).done((function(){t.replaceChildrenTag(t.container,t.renderChildrenHtml()),t.postRenderContainer(t.container),t.endLoading(),t.tabReadyDeferred.resolve(),t.tabActiveDeferred.resolve()}))})),e=t.replaceChildrenHtml(e,'<div class="children"/>')},canSkipThisFormType:function(e){return"execution"==this.getMode()&&/^queryForm$/i.test(e)},ready:function(e){var t=this;if(bizagi.util.parseBoolean(e)&&t.container&&t.container.length&&(t.loadingDeferred&&t.loadingDeferred.resolve(),$.when(t.tabReadyDeferred.promise()).done((function(){t.activate()}))),bizagi.util.parseBoolean(e)&&(!t.container||!t.container.length))var i=setInterval((function(){t.container&&t.container.length&&(clearInterval(i),t.loadingDeferred&&t.loadingDeferred.resolve())}),50);return $.when(t.tabReadyDeferred.promise(),t.parent.ready(),t.tabActiveDeferred.promise())},changeVisibility:function(e){var t=this,i=t.properties;t._super(e);var r=t.parent.container,a="ui-bizagi-tab-"+i.id,n=$("ul li[aria-controls = '"+a+"']",r),o=t.parent.getActiveTab();$.when(t.ready()).done((function(){i.visible?(n&&n.show(),t.setAsActiveContainer()):"execution"===t.getMode()&&n&&n.hide()})).always((function(){r.data("ui-tabs")&&r.tabs("option","active",o)}))},afterToRefresh:function(){this._super(),$(this.parent.container).tabs("refresh")}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.horizontal",bizagi.rendering.horizontal.prototype),bizagi.rendering.desktop.horizontal.extend("bizagi.rendering.desktop.horizontal",{},{postRenderContainer:function(e){var t=this.children,i=t.length;this._super(e),$.each(t,(function(e,t){var r,a,n,o=t.properties.width;o=null==o||0==o.length?100/i:bizagi.util.percent2Number(o),r=e,a=t,n=i,$.when(a.ready()).done((function(){var e=a.getRenderedElement();e.css({width:o+"%"}),e.addClass("ui-panel-area"),r==n-1&&e.addClass("ui-bizagi-render-last")}))}))}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.layout",bizagi.rendering.layout.prototype),bizagi.rendering.desktop.layout.extend("bizagi.rendering.desktop.layout",{},{}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.accordion",bizagi.rendering.accordion.prototype),bizagi.rendering.desktop.accordion.extend("bizagi.rendering.desktop.accordion",{},{postRenderContainer:function(e){this._super(e),e.accordion({autoHeight:!1})},configureLayoutView:function(){}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.accordionItem",bizagi.rendering.accordionItem.prototype),bizagi.rendering.desktop.accordionItem.extend("bizagi.rendering.desktop.accordionItem",{},{setAsActiveContainer:function(e){var t=this;$.when(t.ready()).done((function(){t.parent.container.accordion("option","active",t.properties.ordinal)}))},focus:function(){this.activate(),this.setAsActiveContainer(),this._super()}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.group",bizagi.rendering.group.prototype),bizagi.rendering.desktop.group.extend("bizagi.rendering.desktop.group",{},{postRenderContainer:function(e){var t=this.properties,i="rtl"==t.orientation?"-rtl":"";this._super(e);var r=$(".ui-icon",$(".ui-bizagi-container-group-header:first",this.container));$(".ui-bizagi-container-group-header",this.container);bizagi.util.parseBoolean(t.collapse)?(t.expanded=!1,r.addClass("ui-state-collapse"+i).removeClass("ui-state-expand"+i)):(t.expanded=!0,r.addClass("ui-state-expand"+i).removeClass("ui-state-collapse"+i))},configureHandlers:function(){var e,t=this.properties,i="rtl"==t.orientation?"-rtl":"",r=this.container,a=$(".ui-bizagi-container-group-header:first",r);$(a).click((function(a){a.preventDefault&&a.preventDefault(),(e=$(".ui-icon",r)).toggleClass("ui-icon-triangle-1-s ui-icon-triangle-1-n"),$(".ui-bizagi-container-group-wrapper:first",r).toggle(),t.expanded?(t.expanded=!1,e.addClass("ui-state-collapse"+i).removeClass("ui-state-expand"+i),$(this).addClass("group-collapse").removeClass("group-expand")):(t.expanded=!0,e.addClass("ui-state-expand"+i).removeClass("ui-state-collapse"+i),$(this).addClass("group-expand").removeClass("group-collapse"))}))},isOpen:function(){return!!this.properties.expanded},focus:function(){this.expand(),this._super()},expand:function(){var e=this.container,t=$(".ui-bizagi-container-group-header:first",e);this.isOpen()||$(t).trigger("click")},collapse:function(){var e=this.container,t=$(".ui-bizagi-container-group-header:first",e);this.isOpen()&&$(t).trigger("click")},toogleContainer:function(e){e?this.expand():this.collapse()}}),bizagi.rendering.desktop.container.extend("bizagi.rendering.desktop.section",bizagi.rendering.section.prototype),bizagi.rendering.desktop.section.extend("bizagi.rendering.desktop.section",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("section-header"),i=$.fasttmpl(t,{displayName:e.displayName,editable:e.editable,orientation:this.getOrientation(),uniqueId:e.uniqueId,isDesign:"execution"!==this.getMode(),messageValidation:e.messageValidation,guid:e.guid,displayAs:e.displayAs});return this.sectionContent=$(this.renderSectionContent())[0],i},renderSectionContent:function(){var e=this.renderFactory.getTemplate("section-content"),t=this.properties,i=this.getBreadcrumb();this.orderSection=i.length-1;var r=$.fasttmpl(e,{displayName:t.displayName,editable:t.editable,orientation:this.getOrientation(),uniqueId:t.uniqueId,isDesign:"execution"!==this.getMode(),messageValidation:t.messageValidation,guid:t.guid,breadCrumb:i});return r=this.replaceChildrenHtml(r,this.renderChildrenHtml())},postRenderContainer:function(e){e.closest(".ui-bizagi-container-form-wrapper-animation").append(this.sectionContent),this._super(e),this.isActive()&&this.openAutomatically()},configureHandlers:function(){var e=this,t=e.container[0],i=e.getFormContainer(),r=i.params&&i.params.printversion,a=t.querySelector(".ui-bizagi-container-section-header"),n=this.sectionContent.querySelector(".ui-bizagi-container-section-breadcrumb").querySelectorAll(".ui-bizagi-container-section-breadcrumb-element");this.openSectionFromClick=this.openSectionFromClick.bind(this),r?a.classList.add("ui-bizagi-section-print"):(a.addEventListener("click",this.openSectionFromClick),Array.prototype.forEach.call(n,(function(t){var i=parseInt(t.getAttribute("data-steps-back"));0!==i&&t.addEventListener("click",(function(){e.goBack(i)}))})))},executeChildrenPostRender:function(e){var t=this,i=$(".ui-bizagi-container-section-children",this.sectionContent).children();$.each(i,(function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var a=t.childrenHash[r];if(a){var n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&a.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&a.postRenderContainer(i)}}else t.executeChildrenPostRender(i)}))},openSectionFromClick:function(e){var t=this,i=t.container[0],r=this.sectionContent.parentElement,a=i.querySelector(".ui-bizagi-container-section-header");a.removeEventListener("click",this.openSectionFromClick),bizagi.util.isIE()||"rtl"===this.getFormOrientation()||r.scrollIntoView({behavior:"smooth",block:"start"}),this.openSection().then((function(){a.addEventListener("click",t.openSectionFromClick)})),this.setAsActive()},openSection:function(){var e=new $.Deferred,t=this.sectionContent.parentElement,i="rtl"===this.getFormOrientation()?1:-1,r=this.getSectionParent(),a=r&&r.properties||{},n=r&&r.params||{};return"form"!==a.type&&"form"!==n.type||(r=this.getFormParent(r)),t.classList.remove("ui-bizagi-container-form-wrapper-animation-inactive"),t.style.transform="translateX("+100*this.orderSection*i+"%)",setTimeout((function(){e.resolve()}),600),this.removeAnimationClasses(r.sectionContent),r.sectionContent.classList.add("ui-bizagi-section-animation-fade-out"),this.restoreSectionsOutOfPath(),this.removeAnimationClasses(this.sectionContent),this.sectionContent.classList.add("ui-bizagi-section-animation-fade-in"),this.sectionContent.style.order=this.orderSection,this.sectionContent.style.msOrder=this.orderSection,e.promise()},openAutomatically:function(){this.closeAllSections();for(var e=[],t=this,i=t.properties||{},r=t.params||{},a=this.orderSection;"form"!==i.type&&"form"!==r.type;)e.push(t),i=(t=t.getSectionParent()).properties||{},r=t.params||{};this.translateWithoutAnimation(a),this.openFormWithoutAnimation();for(var n=e.length-1;n>=0;n--)e[n].openSectionWithoutAnimation(0===n);this.setAsActive()},translateWithoutAnimation:function(e){var t=this.sectionContent.parentElement,i="rtl"===this.getFormOrientation()?1:-1;t.classList.add("ui-bizagi-container-form-wrapper-animation-inactive"),t.style.transform="translateX("+100*e*i+"%)"},openSectionWithoutAnimation:function(e){this.sectionContent.style.order=this.orderSection,this.sectionContent.style.msOrder=this.orderSection,this.removeAnimationClasses(this.sectionContent),this.sectionContent.classList.add("ui-bizagi-section-without-animation"),this.sectionContent.classList.add(e?"ui-bizagi-section-animation-fade-in":"ui-bizagi-section-animation-fade-out")},openFormWithoutAnimation:function(){var e=this.getFormParent();e.sectionContent.style.order=e.orderSection,e.sectionContent.style.msOrder=e.orderSection,this.removeAnimationClasses(e.sectionContent),e.sectionContent.classList.add("ui-bizagi-section-without-animation"),e.sectionContent.classList.add("ui-bizagi-section-animation-fade-out")},closeAllSections:function(e){var t=this.getFormContainer()||{};(t.rendersByType?t.rendersByType.section:[]).forEach((function(e){e.removeAnimationClasses(e.sectionContent),e.sectionContent.classList.add("ui-bizagi-container-section-initial-state"),e.sectionContent.style.order=99999,e.sectionContent.style.msOrder=99999}))},restoreSectionsOutOfPath:function(){for(var e=[],t=this.getSectionParent(),i=t.properties||{},r=t.params||{};"form"!==i.type&&"form"!==r.type;)e.push(i.id),i=(t=t.getSectionParent()).properties||{},r=t.params||{};var a=this.getFormContainer()||{};(a.rendersByType?a.rendersByType.section:[]).forEach((function(t){!e.includes(t.properties.id)&&t.sectionContent&&(t.removeAnimationClasses(t.sectionContent),t.sectionContent.classList.add("ui-bizagi-container-section-initial-state"),t.sectionContent.style.order=99999,t.sectionContent.style.msOrder=99999)}))},goBackInPath:function(e){var t=this.sectionContent.parentElement,i=this,r="rtl"===this.getFormOrientation()?1:-1;t.classList.remove("ui-bizagi-container-form-wrapper-animation-inactive");for(var a=0;a<e;a++)this.removeAnimationClasses(i.sectionContent),i.sectionContent.classList.add("ui-bizagi-section-animation-fade-in-out"),"section"!==(i=i.getSectionParent()).properties.type&&(i=this.getFormParent());return this.removeAnimationClasses(i.sectionContent),i.sectionContent.classList.add("ui-bizagi-section-animation-fade-in"),t.style.transform="translateX("+100*i.orderSection*r+"%)",i},removeAnimationClasses:function(e){["ui-bizagi-section-animation-fade-in","ui-bizagi-section-animation-fade-out","ui-bizagi-section-animation-fade-in-out","ui-bizagi-section-hide-in-background","ui-bizagi-container-section-initial-state","ui-bizagi-section-without-animation"].forEach((function(t){e.classList.remove(t)}))},getSectionParent:function(){for(var e=this;e.parent;){var t=(e=e.parent).params||{},i=e.properties||{};if("section"===i.type||"form"===i.type||"form"===t.type)return e}return this},getFormParent:function(){var e=this.getFormContainer();return{sectionContent:$(".ui-bizagi-main-section",e.container)[0],orderSection:0,setAsActive:function(){e.setParam("selectedSection",void 0)}}},isActive:function(){return(this.getFormContainer().getParams()||{}).selectedSection===this.properties.id},setAsActive:function(){this.getFormContainer().setParam("selectedSection",this.properties.id)},goBack:function(e){this.goBackInPath(e).setAsActive()},getOrientation:function(){for(var e=this;e;){if(properties=e.properties||{},"auto"!==properties.orientation)return properties.orientation;e=e.parent}return"auto"},getFormOrientation:function(){return(((this.getFormContainer()||{}).properties||{}).orientation||"auto").toLowerCase()}}),bizagi.rendering.desktop.form.extend("bizagi.rendering.desktop.searchForm",bizagi.rendering.searchForm.prototype),bizagi.rendering.desktop.searchForm.extend("bizagi.rendering.desktop.searchForm",{},{renderResult:function(){var e=this,t=e.properties,i={};i.properties={displayName:e.getResource("render-search-advanced-results-label"),type:"grid",xpath:"searchForm"+t.id,id:t.id,skipInitialLoad:!0,rowsPerPage:10,inlineAdd:!1,allowDelete:!1,allowAdd:!1,hideActionsColumn:!0,floatingHeader:!0,sortBy:t.sortBy,sortOrder:t.sortOrder,overrideGetRemoteData:function(t){return e.getRemoteData(t)}},i.elements=[];var r=t.columns;$.each(r,(function(t){var a={render:{}};a.render.properties={displayName:r[t].caption,xpath:r[t].xpath,editable:!1},$.extend(a.render.properties,e.parseAdditionalProperties(r[t].dataType)),0==r[t].dataType&&(a.render.properties.columnVisible=!1),7!=r[t].dataType&&8!=r[t].dataType||(a.render.properties.allowDecimals=r[t].allowDecimals),10!=r[t].dataType&&11!=r[t].dataType||(a.render.properties.allowDecimals=!0),12==r[t].dataType&&(a.render.properties.showTime=r[t].showTime),i.elements.push(a)}));var a=e.renderFactory.getRender({type:"grid",data:i,parent:e,mode:e.getMode(),jqgrid:!1});return e.resultsGrid=a,a.render()},postRenderContainer:function(e){var t=this,i=e.find(".ui-bizagi-container-search-criteria"),r=e.find(".ui-bizagi-container-search-results"),a=i.children(),n=t.getMode();t.container=e,$.each(a,(function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var a=t.childrenHash[r];if(a){var n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&a.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&a.postRenderContainer(i)}}}));var o=$(r.children()[0]);t.resultsGrid.postRenderElement(o),"execution"==n&&t.configureHandlers(),"design"==n&&t.configureDesignView(),"layout"==n&&(t.configureDesignView(),t.configureLayoutView())},configureHandlers:function(){var e=this;return e.criteriaContainer=$(".ui-bizagi-container-search-criteria",e.container),e.resultsContainer=$(".ui-bizagi-container-search-results",e.container),e.resultsGrid.bind("rowSelected",(function(t,i){e.properties.searchParams.hasOwnProperty("multiSelect")?e.trigger("multiSelect",i):e.trigger("instanceSelected",i)})),e},refreshResults:function(){var e=this,t=e.resultsGrid;t.refresh(),$.when(t.dataReady()).done((function(){e.resultsContainer.show(),e.resizeResults()}))},resize:function(){this.resizeResults()},resizeResults:function(){var e=this.resultsGrid;this.resultsContainer.is(":visible")?this.criteriaContainer.height("auto"):this.criteriaContainer.height("100%"),e.resize({width:this.criteriaContainer.width(),onSearchFinished:function(){this.properties&&(0==this.properties.records?($(".ui-bizagi-container-search-results",this.container).show(),$(".ui-bizagi-container-search-results .ui-jqgrid-title",this.container).hide()):$(".ui-bizagi-container-search-results .ui-jqgrid-title",this.container).show())}})}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.text",bizagi.rendering.text.prototype),bizagi.rendering.desktop.text.extend("bizagi.rendering.desktop.text",{},{postRender:function(){this._super(),this.properties.maxLength>0&&this.input.attr("maxlength",this.properties.maxLength)},setDisplayValue:function(e){var t=bizagi.util.decodeURI(e);e=this.validateValue(t,this.properties.maxLength),this.setValue(e),this._super(e),!bizagi.util.isEmpty(e)&&this.properties.editable?this.input&&this.input.val(e):null===e&&this.properties.editable&&this.input&&this.input.val("")},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!=i.length&&i.blur((function(){var t=$(this);e.retypeDouble(t)}))},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.tooltip({disabled:!0}),t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},retypeDouble:function(e){var t=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility")&&null==$(this).data("newValue"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===t)return;t!=e.data("oldValue")?(this.setValue(""),this.createTooltip(e,"",this.getResource("render-text-retype-error"))):(e.data("newValue",t),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""===t||t===e.data("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},collectData:function(e){var t=this.properties.xpath,i=this.getValue();null!=i&&void 0!==i&&"number"!=typeof i&&(i=(i=(i=i.replaceAll(String.fromCharCode("030"),"")).replaceAll(String.fromCharCode("018"),"")).replaceAll(String.fromCharCode("016"),"")),this.controlValueIsChanged()&&(bizagi.util.isEmpty(t)||(bizagi.util.isEmpty(i)?""===i&&(e[t]=""):e[t]=i)),this.validateInputRetype()||(e[this.properties.xpath]="")},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $("input.ui-bizagi-render-text, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.readonly",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.readonly.extend("bizagi.rendering.desktop.readonly",bizagi.rendering.readonly.prototype),bizagi.rendering.desktop.readonly.extend("bizagi.rendering.desktop.readonly",{},{renderElement:function(){return this._super("render-base")},getLabel:function(){return $("label",this._super())}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.extendedText",bizagi.rendering.extendedText.prototype),bizagi.rendering.desktop.extendedText.extend("bizagi.rendering.desktop.extendedText",{postRender:function(){this._super(),bizagi.util.isIE8()&&this.textarea.attr("cols","5000")},postRenderReadOnly:function(){this._super(),$(this.getControl()).addClass("ui-bizagi-text-extended-readonly")},configureHandlers:function(){var e=this,t=e.properties;e._super(),t.maxLength>0&&(e.textarea.attr("maxlength",t.maxLength),e.actualMaxLength=t.maxLength),e.ready().done((function(){if(t.autoExtend){var i=e.textarea.css("height");void 0===t.maxLines&&("string"==typeof i&&-1!==i.search("px")?Number(i.split("px")[0])<=150&&(i="150px"):i="150px"),e.textarea.css({overflow:"hidden",resize:"none",minHeight:i});var r=setTimeout((function(){e.changeHeightAutoExtended(e.textarea[0]),clearTimeout(r)}),100);e.textarea.bind("keyup",(function(){e.changeHeightAutoExtended(this)}))}}))},setDisplayValue:function(e){var t=this.getControl();e=this.validateValue("string"==typeof e?e:"",this.properties.maxLength),this.setValue(e);var i=$.br2nl(e);if(this.textarea&&this.textarea.val(i),!bizagi.util.parseBoolean(this.properties.editable))if("string"==typeof e){var r=bizagi.util.encodeHtmlText(this.getDisplayValue());t.html("<label class='readonly-control'>"+r+"</label>")}else bizagi.util.isNull(e)&&t.html("")},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();null!=this.getValue()&&void 0!==this.getValue()&&(r=this.getValue().replaceAll(String.fromCharCode("030"),""),r=this.getValue().replaceAll(String.fromCharCode("018"),""),r=this.getValue().replaceAll(String.fromCharCode("016"),"")),$.controlValueIsChanged(this)&&(bizagi.util.isEmpty(i)||(bizagi.util.isEmpty(r)?""===r&&(e[i]=""):e[i]=r)),this.validateInputRetype()||(e[t.xpath]="")},cleanData:function(){this.setValue(""),this.setDisplayValue(this.getValue()),this.textarea&&this.textarea[0].style.removeProperty("height")},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input, textarea",t);i&&0!=i.length&&i.blur((function(){var t=$(this),i=e.previousValue,r=e.value;null!=i&&r!=i&&null!=$(this).data("newValue")&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)}))},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},retypeDouble:function(e){var t=e.val();if("hidden"!=$(e).attr("type")&&"none"!=$(e).css("display")&&"hidden"!=$(e).css("visibility")&&null==$(this).data("newValue"))if(e.data("oldValue")&&""!=$(this).data("oldValue")){if(""==t)return;t!=e.data("oldValue")?(this.setValue(""),this.createTooltip(e,"",this.getResource("render-text-retype-fail"))):(e.data("newValue",t),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""==t||t==e.data("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},changeHeightAutoExtended:function(e){e.scrollHeight<20*this.properties.maxLines?e.style.height=20*this.properties.maxLines:e.style.height=e.scrollHeight+"px"},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $("input.ui-bizagi-render-text, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.label",bizagi.rendering.label.prototype),bizagi.rendering.desktop.label.extend("bizagi.rendering.desktop.label",{},{renderReadOnly:function(){return this.setValue(this.properties.displayName),this._super()},postRender:function(){this.getLabel().addClass("ui-bizagi-render-label")},postRenderReadOnly:function(){this.getLabel().addClass("ui-bizagi-render-label")}}),bizagi.rendering.desktop.label.extend("bizagi.rendering.desktop.queryLabel",{},{}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.number",bizagi.rendering.number.prototype),bizagi.rendering.desktop.number.extend("bizagi.rendering.desktop.number",{},{setDisplayValue:function(e){this._super(e),null!=e&&this.properties.editable&&(this.numericInput.val(bizagi.util.numberToFixedString(e)),this.value=this.properties.value=e,this.executeFormatCurrencyPlugin())},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur((function(){var t=$(this),i=e.previousValue,r=e.value;"grid"===e.parent.properties.type?(null!=i&&r!==i&&void 0!==$(this).data("newValue")&&t.val()!==$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)):e.retypeDouble(t)}))},retypeDouble:function(e){var t=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility")&&void 0===$(this).data("newValue"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===t)return;if(t!==e.data("oldValue"))this.setValue(""),this.createTooltip(e,"",this.getResource("render-text-retype-error"));else{e.data("newValue",e.val()),e.data("oldValue","");try{e.tooltip("destroy")}catch(e){}}}else{if(""===t||t===e.data("newValue"))return;this.createTooltip(e,t,this.getResource("render-number-retype"))}},changeCellRequired:function(e){this.changeRequired(e)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $("input.ui-bizagi-render-numeric, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}}),bizagi.rendering.desktop.number.extend("bizagi.rendering.desktop.queryNumber",{},{setDisplayValue:function(e){var t=this.properties;this._super(e),null!==e&&t.editable&&this.setValue(this.numericInput.asNumber({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.date",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.date.extend("bizagi.rendering.desktop.date",bizagi.rendering.date.prototype),bizagi.rendering.desktop.date.extend("bizagi.rendering.desktop.date",{},{renderElement:function(e){return this._super(e||"render-base")},renderReadOnly:function(){var e=this.properties,t=bizagi.util.dateFormatter,i=t.getDateFromInvariant(this.getValue(),e.showTime),r=t.formatDate(i,e.fullFormat,this.i18n),a={value:"execution"!==this.getMode()?e.fullFormat:r,editable:e.editable},n=this.renderFactory.getTemplate("readonly");return $.fasttmpl(n,a)},getElementsToStylize:function(e){return $(".bz-input-icon__input, .bz-input--readonly, .readonly-control",e)},configureHandlers:function(){var e=this,t=e.getDateControl(),i=$(".bz-input-icon__input",t);e.configureMobiscollCalendar(),e.calendarInstance=$(".bz-hidden",t).mobiscroll("getInst"),i.on("focusInput",(function(t){e.getCalendarInstance().isVisible()||(e.getCalendarInstance().show(!1,!0),i.focus())})).on("keydown",(function(t){"9"==t.keyCode&&e.getCalendarInstance().hide();var r=setTimeout((function(){var a=i.val();if(bizagi.util.isEmpty(a))e.compareDates(a,e.getCalendarInstance().getVal())&&e.setValueFromCalendarButtons(null,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.setValue(""),e.setDisplayValue("")}));else{var n=e.getNormalizeDate(bizagi.util.dateFormatter.getDateFromFormat(a,e.properties.fullFormat,e.i18n));0==n?(e.setValue(""),e.getCalendarInstance().setVal(null)):e.compareDates(i.val(),e.getCalendarInstance().getVal())&&(e.getCalendarInstance().setVal(n,!1,!1,!1),e.onChangeHandler())}"13"==t.keyCode&&e.onChangeHandler(),clearTimeout(r)}),1)})).on("blur",(function(t){e.compareDates(i.val(),e.getCalendarInstance().getVal())&&e.onChangeHandler()})),t.click((function(t){e.getCalendarInstance().show(!1,!0),i.focus()}))},configureMobiscollCalendar:function(){var e=this,t=e.properties;e.elementCalendar=null;var i=t.showTime?["calendar","time"]:["calendar"],r=e.getDateControl(),a=$(".bz-hidden",r),n=$(".bz-input-icon__input",r),o=e.getOrientation();a.mobiscroll().calendar({touchUi:!1,display:"bubble",animate:!1,anchor:r.get(0),focusOnClose:n.get(0),controls:i,min:e.getNormalizeDate(new Date(t.minValue)),max:e.getNormalizeDate(new Date(t.maxValue)),defaultValue:e.getDisplayValue(),timeFormat:t.timePickerFormat?e.getTimeFormat(t.timePickerFormat):"",dateFormat:t.datePickerFormat,dateWheels:"dd/MM/yyyy",select:"single",selectType:"Day",rtl:o&&"rtl"===o,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||bizagi.localization.language||"en",cssClass:"mbsc-bizagi-theme",buttons:e.properties.showTime?[{text:e.getResource("render-timeentry-now"),handler:function(){e.setValueFromCalendarButtons(new Date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))},cssClass:"mbsc-fr-btn mbsc-btnNow"},{text:e.getResource("render-plugin-search-users-select-link"),handler:"set",cssClass:"mbsc-fr-btn mbsc-btnSet"},{text:e.getResource("render-plugin-search-users-clear-button-name"),handler:function(e,t){t.clear()},cssClass:"mbsc-fr-btn mbsc-btnClear"}]:[{text:e.getResource("render-timeentry-now"),handler:function(){e.setValueFromCalendarButtons(new Date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))},cssClass:"mbsc-fr-btn mbsc-btnNow"},{text:e.getResource("render-plugin-search-users-clear-button-name"),handler:function(e,t){t.clear()},cssClass:"mbsc-fr-btn mbsc-btnClear"}],onSet:function(){e.onChangeHandler()},onDayChange:function(t){e.setValueFromCalendarButtons(t.date,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.properties.showTime||e.getCalendarInstance().hide()}))},onChange:function(t){if(e.elementCalendar)if(0==$(".mbsc-sc-whl-anim",e.elementCalendar).length)e.setDateFromTimeSelector(t.valueText);else var i=setInterval((function(){e.elementCalendar&&0!=$(".mbsc-sc-whl-anim",e.elementCalendar).length||(e.setDateFromTimeSelector(t.valueText),clearInterval(i))}),100)},onClear:function(){e.setValueFromCalendarButtons(null,(function(t){e.getCalendarInstance().setVal(t,!1,!1,!1),e.getCalendarInstance().hide()}))},onBeforeShow:function(e,i){i.option({max:bizagi.util.dateFormatter.getDateFromInvariant(t.maxValue,t.showTime),min:bizagi.util.dateFormatter.getDateFromInvariant(t.minValue,t.showTime)})},onShow:function(t){e.elementCalendar=calendar=$(".mbsc-fr-popup",t.target),$(".mbsc-btnNow",calendar).parent().addClass("mbsc-div-btnNow"),$(".mbsc-btnSet",calendar).parent().addClass("mbsc-div-btnSet")},onClose:function(){e.elementCalendar=null}})},setDateFromTimeSelector:function(e){var t=this;t.setValueFromCalendarButtons(bizagi.util.dateFormatter.getDateFromFormat(e,t.properties.fullFormat),(function(e){t.getCalendarInstance().setVal(e,!1,!1,!1),t.properties.showTime||t.getCalendarInstance().hide()}))},compareDates:function(e,t){var i=bizagi.util.dateFormatter,r=this.getNormalizeDate;return e=r.call(this,"string"!=typeof e?e:i.getDateFromFormat(e,this.properties.fullFormat,this.i18n)),t=r.call(this,"string"!=typeof t?t:i.getDateFromFormat(t,this.properties.fullFormat,this.i18n)),!(!e&&!t)&&(!!(!e&&t||e&&!t)||e.getTime()!=t.getTime())},getCalendarInstance:function(){return this.calendarInstance||(this.calendarInstance=$(".bz-hidden",this.getDateControl()).mobiscroll("getInst"))},configureDesignView:function(){},getDateControl:function(){return this.properties.editable?$(".bz-input-icon, .bz-input",this.getControl()):this.getControl()},removeValidations:function(){var e=this.getFormContainer();e.clearValidationMessages?e.clearValidationMessages():e.getFormContainer().parent&&e.getFormContainer().parent.getFormContainer&&(e=e.getFormContainer().parent.getFormContainer()).clearValidationMessages&&e.clearValidationMessages()},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.properties,i=this.getControl();i.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&t.editable?i.addClass("control-required"):i.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&t.editable?i.addClass("control-required"):i.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},onChangeHandler:function(e){var t=this.properties,i=this.getNormalizeDate(this.getCalendarInstance().getVal()),r="",a=bizagi.util.dateFormatter;if(i&&0!=i){var n=this.value;if(1==e?(i=this.getNormalizeDate(new Date),r=a.formatDate(i,"MM/dd/yyyy HH:mm:ss"),this.value=r):this.value=a.formatInvariant(i,t.showTime),t.showTime&&!t.fullFormat.includes("s")&&(i.setSeconds(0),this.value=a.formatInvariant(i,t.showTime)),e||i){var o=this.getFormContainer();if(void 0===o.validationController){var s=o.getValidationsContainer();o.validationController=new bizagi.command.controllers.validation(o,this.validations,s)}if(this.removeValidations(),!this.isValid([])){var l=this.getCalendarInstance().getVal(),d=bizagi.localization.getResource("workportal-general-invalid-date");d=d.replace("{0}",t.displayName),(o.validationController||o.parent.validationController).showValidationMessage(d+" "+l)}this.value=n,r=a.formatDate(i,"MM/dd/yyyy HH:mm:ss"),this.setValue(r),this.setDisplayValue(r)}}},getLabel:function(){return this.label||(this.label=$(".ui-bizagi-label > label",this.element||this.observableElement)),this.label},hideIcon:function(e){this._super(e);var t=$(".ui-bizagi-render-icons",this.element),i=$(".ui-bizagi-render-icon-error",this.element);$(".ui-bizagi-render-icon-help",this.element).is(":visible")||i.is(":visible")||t.css({width:"1px","min-width":"1px"})},getFullFormatedDate:function(e,t){var i="",r=bizagi.util.dateFormatter;i=e.length>0?e:void 0!==e?r.formatISO(e,!1):r.formatISO(new Date,!1),i+=t;var a=r.getDateFromFormat(i,"yyyy-MM-dd H:m");return r.formatDate(0!==a?a:e,"yyyy-MM-dd H:mm:ss")},setDisplayValue:function(e){if("execution"===this.getMode()){var t=this.properties,i=this.getControl(),r=bizagi.util.dateFormatter;bizagi.util.isNumeric(e)&&0!==e&&(e=r.formatInvariant(new Date(e),t.showTime)),e&&(e="string"==typeof e?this.getNormalizeDate(r.getDateFromInvariant(e,t.showTime)):this.getNormalizeDate(e));var a=this.getCalendarInstance();t.editable&&a.setVal&&a.setVal(e),this.setValue(r.formatInvariant(e,!0)),t.displayValue=r.formatDate(e,t.fullFormat,this.i18n);var n=t.editable?$(".bz-input-icon__input, .bz-input--readonly",i):$(".readonly-control",i);"string"!=typeof t.displayValue&&"number"!=typeof t.displayValue||(t.editable?n.prop("value",t.displayValue):n.html(t.displayValue),n.prop("title",t.displayValue))}},setValueFromCalendarButtons:function(e,t){this._super(e),"function"==typeof t&&t(e),this.onChangeHandler()},cleanData:function(){this.setValue(""),this.setDisplayValue("")},disablePopup:function(){this.getCalendarInstance()&&this.getCalendarInstance().disable()}}),bizagi.rendering.desktop.date.extend("bizagi.rendering.desktop.queryDate",{},{collectDataQueryForm:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=null;this.controlValueIsChanged();if(!bizagi.util.isEmpty(i)&&(null!=r&&""!==r&&(a=r),null!==a||t.included)){var n=this.properties.typeSearch||this.properties.rangeQuery||"NONE";n=n.toUpperCase(),e.push({value:a,included:this.properties.included,xpath:t.xpath,searchType:n,orderType:"NONE",renderId:this.getRenderId()})}}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.yesno",bizagi.rendering.yesno.prototype),bizagi.rendering.desktop.yesno.extend("bizagi.rendering.desktop.yesno",{},{postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-boolean-yesno"),e[0]&&$.removeData(e[0]),e.optiongroup({orientation:this.properties.orientation})},configureHandlers:function(){var e=this,t=e.getControl();e._super(),t.bind("optiongroupchange",(function(t,i){bizagi.util.parseBoolean(e.value)!==bizagi.util.parseBoolean(i.value)&&e.setValue(i.value)}))},configureDesignView:function(){this.getControl().find("input").unbind("click")},setDisplayValue:function(e){var t=this.getControl();if(this._super(e),null!=e&&this.properties.editable){var i=bizagi.util.parseBoolean(e);null!=i&&t.optiongroup("setValue",i.toString())}},cleanData:function(){this.setDisplayValue(null),this.clearDisplayValue()},clearDisplayValue:function(){this.element.find(".ui-radio-state-checked").removeClass("ui-radio-state-checked")}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.check",bizagi.rendering.check.prototype),bizagi.rendering.desktop.check.extend("bizagi.rendering.desktop.check",{},{postRender:function(){var e=this.getControl();this._super(),this.input=e.find("label"),this.performStyles()},postRenderReadOnly:function(){var e=this.getControl(),t=!0===bizagi.override.enableCheck&&!this.properties.editable;if(this.input=e.find("label"),!t){this.performStyles();var i=$("input",e);i.attr("readonly","readonly"),i.attr("disabled","disabled")}},renderReadOnly:function(){var e="";if(!0===bizagi.override.enableCheck&&!this.properties.editable){var t=this.renderFactory.getTemplate("readonly"),i=bizagi.util.randomNumber(100,1e7);e=$.fasttmpl(t,{id:i,editable:this.properties.editable})}else e=this._super();return e},configureHandlers:function(){var e=this;e._super(),bizagi.util.isIE()?e.input.bind("change",(function(t,i){var r=$("input",e.input).is(":checked");e.setValue(r),e.setDisplayValue(r)})):e.input.bind("checkchange",(function(t,i){e.setValue(i.value)}))},configureDesignView:function(){this.getControl().find("input").unbind("click")},setDisplayValue:function(e){var t=bizagi.util.parseBoolean(e),i=!0===bizagi.override.enableCheck&&!this.properties.editable;if(this._super(t),i)this.input&&this.input.val(this.getDisplayValue());else if(bizagi.util.isIE())this.input&&(!0===t?(this.input.addClass("ui-checkbox-state-checked"),$("input",this.input).attr("checked","checked")):(this.input.removeClass("ui-checkbox-state-checked"),$("input",this.input).removeAttr("checked")));else try{!0===t?this.input.check("checkItem"):this.input.check("uncheckItem")}catch(e){}},cleanData:function(){this.setDisplayValue(!1),this.setValue(!1,!1)},performStyles:function(){var e=this.getControl();e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-boolean-yesno"),this.properties.required&&$(".ui-bizagi-render-control-required",e).css({height:"22px"}),bizagi.util.isIE()?(e.removeClass(),e.addClass("ui-bizagi-render-control ui-bizagi-render-boolean-yesno-ie"),e.find("label").addClass("checkbox-ie")):this.input.check()},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},changeFontSize:function(e,t){t&&this._super(e,t)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.combo",bizagi.rendering.combo.prototype),bizagi.rendering.desktop.combo.extend("bizagi.rendering.desktop.combo",{},{initializeData:function(e){this._super(e),this.properties.loadOnDemand=!0},postRender:function(){this.inputCombo=$(".ui-selectmenu-value",this.getControl()),this.selectedValue=this.properties.value,this._super()},configureHandlers:function(){var e=this;e.inputCombo.focus((function(){$(this).select()})),e.inputCombo.blur((function(){e.setDisplayValue(e.getValue()),e.isExtraItem()||e.setDisplayValue(e.value)})),e.getFormContainer().bind("maximazedForm unmaximazedForm",(function(t){e.isPreferencesDialog(e.inputCombo)?e.onResizeCloseDialog():e.resizeCombo()})),e.inputCombo.click((function(){var t="dd-"+e.inputCombo.attr("id");0===$("#"+t,e.getControl().parent()).length?e.comboDropDown():e.dropDownDestroy($("#"+t)),e.inputCombo.focus()})),$(".ui-selectmenu-btn",e.control).length>1&&void 0!==window.addEventListener?$(".ui-selectmenu-btn",e.control)[0].addEventListener("click",(function(){e.inputCombo[0].click()})):$(".ui-selectmenu-btn",e.control).bind("click.combo",(function(){e.inputCombo.trigger("click")})),e.inputCombo.keyup((function(t){e.keyUpFunction(t)})),e.inputCombo.keydown((function(t){e.keyDownFunction(t)})),e._super()},comboDropDown:function(){var e=this;e.showLoadingData(),$.when(e.getData()).done((function(t){e.hideLoadingData();try{e.internalComboDropDown(t)}catch(e){bizagi.log(e.message)}}))},showLoadingData:function(){var e=$("body",document),t=this.loading=$("<div class='ui-select-dropdown open loading'><ul><li class='ui-bizagi-render-loading ui-bizagi-loading'></li></ul></div>");t.css("width",this.inputCombo.outerWidth()+"px"),$("li",t).css({padding:0,margin:0}),t.css("overflow","hidden"),t.appendTo(e),t.position({my:"left top",at:"left bottom",of:this.inputCombo,collision:"none flip"})},hideLoadingData:function(){this.loading.remove()},internalComboDropDown:function(e){var t=this,i={},r={};$(".ui-select-dropdown.open").remove();var a=$("<div class='ui-select-dropdown open bz-combo__list--comfortable' role='popup'></div>"),n=t.inputCombo.parents(".ui-bizagi-control").last(),o=n.closest(".ui-bizagi-render"),s="dd-"+t.inputCombo.attr("id"),l=t.findDataByValue(t.inputCombo.val()),d=0,c="rtl"===t.properties.orientation?"ui-bizagi-rtl":"";if(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0){var u=o.closest(".ui-dialog-content");u.length>0&&u.css("overflow-y","hidden")}e=e||t.properties.data,t.properties.data=e,t.repositionInterval,o.addClass("ac-is-visible"),n.addClass("ac-is-visible ac-clear-floats"),a.attr("id",s),t.inputCombo.attr("aria-expanded","true");for(var p=0;p<e.length;p++)null!==e[p].value&&"boolean"==typeof e[p].value&&(!0===bizagi.util.parseBoolean(e[p].value)?e[p].value=this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e[p].value)&&(e[p].value=this.getResource("render-boolean-no")));i=e.length>1e3?t.getResource("render-combo-too-many-elements"):$.tmpl("<ul role='listbox' id='listbox-${id}' aria-labelledby='label-${id}' aria-expanded='true'>   {{each datasource}}{{if typeof hidden == 'undefined'}}       <li id='opt-${id}' data-value='${id}' role='option' tabindex='0' aria-selected='false'>${value}</li>{{/if}}   {{/each}}</ul>",{id:t.properties.id,datasource:e});var g=a.append(i);n.append(g);var h=$(".ui-selectmenu",t.control);$(g).find("li:last-child").css("padding-bottom","13px");var m=g.width(),b=h.width();if(g.width(b<m?m:b),t.isPreferencesDialog(o)){var f=o.closest(".ui-dialog-content"),v=$.scrollerParent(g[0]),y=$(f),z=g.offset().top-y.offset().top,C=g.offset().left-y.offset().left,x=$("<div/>",{css:{position:"absolute",top:z,left:C}});x.attr("id","wrapper-"+s),x.appendTo(y),$(g).appendTo(x),$(v).off("scroll.combo").on("scroll.combo",(function(e){var i=$(e.target);t.dropDownValidClose(i,g),$(v).unbind("scroll.combo")}))}g.position({my:"left top",at:"left bottom",of:$(".ui-selectmenu",t.control),collision:"fit"}).hide(),g.show(),(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)&&u.length>0&&u.css("overflow-y","auto"),t.recalculateComboOffset(g,h),g.data("formWidth",n.width()),g.data("parentCombo",t.control),g.addClass(c),-1!==l&&$("li",g).length>0&&0!==(r=l&&""===l.id?$("li[data-value='']",g):$("li[data-value='"+l.id+"']",g)).length&&(r.addClass("ui-selected"),r.addClass("active"),r.attr("aria-selected","true"),t.inputCombo.attr("aria-activedescendant","opt-"+l.id),d=parseInt(r.position().top),g.scrollTop(d)),g.delegate("li","click",(function(){var e={id:$(this).data("value")?$(this).data("value"):"",value:$(this).text()},i=t.getValue();i=i&&i.id?i.id:0,e.id!==i?t.onComboItemSelected(e):e.value!==t.inputCombo.val()&&t.setDisplayValue({value:e.value}),t.inputCombo.select(),g.hide(),t.dropDownDestroy(g),$(document).unbind("click.closecombo")})),$.makeArray(g,t.getControl()).bind("click",(function(e){return e.preventDefault(),!1})),$(document).one("click.closecombo",(function(e){var i=$(e.target);t.dropDownValidClose(i,g)}))},dropDownValidClose:function(e,t){t.hide(),this.dropDownDestroy(t),$(document).unbind("click.closecombo")},dropDownReposition:function(e,t){if(t.width()!=e.data("formWidth")){var i=$(".ui-selectmenu",this.control);e.width(this.control.width()<100?100:i.width());var r=e.data("parentCombo")||i;e.position({my:"left top",at:"left bottom",of:$(".ui-selectmenu-value",r),collision:"none"}),e.data("formWidth",t.width())}},dropDownDestroy:function(e){var t=(this.inputCombo?this.inputCombo:$(".ui-selectmenu-value",this.getControl())).closest(".ui-bizagi-control"),i=t.closest(".ui-bizagi-render"),r=""+e.attr("id");this.inputCombo.attr("aria-expanded","false"),t.hasClass("ac-is-visible")&&t.removeClass("ac-is-visible"),t.hasClass("ac-clear-floats")&&t.removeClass("ac-clear-floats"),i.hasClass("ac-is-visible")&&i.removeClass("ac-is-visible"),e.remove();var a=$("#wrapper-"+r);a&&a.length>0&&a.remove(),$(document).unbind("mousedown.closecombo"),$(document).unbind("mouseup.resizecombo"),$(window).unbind("resize.resizecombo"),$(window).unbind("mouseup.closecombo"),this.repositionInterval&&clearInterval(this.repositionInterval)},validateValueInDatasource:function(e,t){var i=this.inputCombo.val(),r=this.findDataByValue(i,t);this.value||(this.value={id:""}),r.id>0?e?(this.setValue({id:r.id}),this.setDisplayValue(r)):(this.setValue({id:r.id},!1),this.setDisplayValue(r)):""===r.id?(this.value.id!=r.id&&this.setValue(r,!1),this.setDisplayValue(r)):this.setDisplayValue(this.selectedValue)},keyDownFunction:function(e){var t="dd-"+this.inputCombo.attr("id"),i=$("#"+t),r=$("li.active",i);return(e=e||window.event).altKey||e.ctrlKey||e.metaKey?1:(0!==i.length||this.properties.data||(this.comboDropDown(this.combo),i=$("#"+t)),e.shiftKey&&9==e.keyCode||9==e.keyCode?(r.length>0&&this.inputCombo.val(r.text()),this.focusDependant=!0,this.validateValueInDatasource(!0,!0),i.remove(),1):(27==e.keyCode&&(this.setDisplayValue(this.selectedValue),i.remove()),9==e.keyCode||13==e.keyCode?(r.length>0&&this.inputCombo.val(r.text()),this.validateValueInDatasource(!0,!0),i.remove(),1):"38"==e.keyCode||"37"==e.keyCode?(this.selectPreviousElement(i),0):"40"==e.keyCode||"39"==e.keyCode?(this.selectNextElement(i),0):36==e.keyCode?(this.selectFirstElement(i),0):35==e.keyCode?(this.selectLastElement(i),0):(this.properties.enableTyping="boolean"==typeof bizagi.override.typingForCombos?bizagi.override.typingForCombos:this.properties.enableTyping,this.properties.enableTyping?1:(e.preventDefault(),e.stopPropagation(),!1))))},keyUpFunction:function(e){var t="dd-"+this.inputCombo.attr("id"),i=$("#"+t);if((e=e||window.event).altKey||e.ctrlKey||e.metaKey||13==e.keyCode||9==e.keyCode||27==e.keyCode||16==e.keyCode||36==e.keyCode||35==e.keyCode||33==e.keyCode||34==e.keyCode)return 0;0===i.length&&(this.comboDropDown(this.combo),i=$("#"+t));var r=!1;return e.keyCode>=37&&e.keyCode<=40&&(r=!0),this.selectItemByKeyUp(r),1},selectItemByKeyUp:function(e){var t;null==bizagi.util.parseBoolean(e)&&(e=!1);var i="dd-"+this.inputCombo.attr("id"),r=$("#"+i);$(".active",r).removeClass("active");var a=this.findDataByValue(this.inputCombo.val(),!0,e);-1!==a?((t=$("li[data-value='"+a.id+"']",r)).addClass("active"),this.inputCombo.attr("aria-activedescendant","opt-"+a.id)):t=$("li.ui-selected",r),r.length>0&&t.length>0&&(scrollPosition=parseInt(t.position().top),r.scrollTop(scrollPosition))},selectFirstElement:function(e){var t=$("li:first",e);$("li",e).removeClass("active"),t.addClass("active"),scrollPosition=t.position().top,e.scrollTop(scrollPosition),this.inputCombo.val($(t).text())},selectLastElement:function(e){var t=$("li:last",e);$("li",e).removeClass("active"),t.addClass("active"),scrollPosition=t.position().top,e.scrollTop(scrollPosition),this.inputCombo.val($(t).text())},selectPreviousElement:function(e){var t=0,i=$("li.active",e);0===i.length&&(i=$("li:first",e));var r=i.prev();0!==r.length&&(i.removeClass("active"),$(r).addClass("active"),t=$(r).position().top,e.scrollTop(t),this.inputCombo.val($(r).text()))},selectNextElement:function(e){var t=0,i=$("li.active",e);0===i.length&&(i=$("li:first",e));var r=i.next();0!==r.length&&(i.removeClass("active"),$(r).addClass("active"),t=$(r).position().top,e.scrollTop(t),this.inputCombo.val($(r).text()))},onComboItemSelected:function(e){var t=e.id||"",i=e.value||"";this.properties.originalValue=this.getValue(),""===t?this.inputCombo.val(""):this.inputCombo.val(i),this.setValue({id:t}),this.setDisplayValue({id:t,value:i})},setDisplayValue:function(e){var t,i=this.properties,r="";if(e=this.mapValue(e),e=this.preprocessValue(e),i.editable&&null!==e){if("object"===_typeof(e)&&void 0!==e.label){var a=bizagi.util.isNumeric(e.id)?e.id:e.value,n=e.label;!bizagi.util.isString(n)&&bizagi.util.isString(e.value)&&(n=e.value),r=this.findDataById(a).value||e.label,this.setValue({id:a,value:n})}else{if("number"==typeof e||"string"==typeof e||e.id)if(e.id){var o=!1;if(null!=e.value&&"boolean"==typeof e.value)o=!0,!0===bizagi.util.parseBoolean(e.value)?e.value=this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value)&&(e.value=this.getResource("render-boolean-no"));else if(null!=e.value&&"object"===_typeof(e.value))for(var s=0;s<e.value.length;s++)null!=e.value[s]&&"boolean"==typeof e.value[s]&&(!0===bizagi.util.parseBoolean(e.value[s])?e.value[s]=this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value[s])&&(e.value[s]=this.getResource("render-boolean-no")));r=o?e.value:this.findDataById(e.id).value||e.value}else r=this.findDataById(Number(e)).value||e.label;else r="object"==_typeof(e.value)?e.value.join(" - "):e.value;(i.hasLocalData||i.remoteDataLoaded)&&-1===this.findDataByValue(r)&&(r=""),e&&e.id&&(null!=e.id&&("number"==typeof e.id&&e.id>0||"string"==typeof e.id&&e.id.length>0)?null==this.value||null==this.value?this.setValue({id:e.id}):this.value.id!=e.id&&this.setValue({id:e.id}):null==this.value||null==this.value?this.setValue({id:e}):this.value.id!=e&&this.setValue({id:e}))}this.inputCombo?(this.inputCombo.val(e.value),$(this.inputCombo).attr("title",e.value)):(t=$(".ui-selectmenu-value",this.getControl()))&&t.val(e.value)}else if(i.editable||null===e)if(null===e&&i.editable){var l=this.getResource("render-combo-empty-selection");this.inputCombo.val(l),$(this.inputCombo).attr("title","")}else null!==e||i.editable||this.getControl().text("");else"number"==typeof e||"string"==typeof e?(r=this.findDataById(Number(e)).value,(t=this.getControl()).html("<label class='readonly-control'>"+this.escapeValue(this.formatItem(r))+"</label>")):"object"===_typeof(e)&&(void 0!==e.label?(a=bizagi.util.isNumeric(e.id)?e.id:e.value,r=this.findDataById(a).value||e.label,$.isArray(r)&&(r=r.join(" - ")),this.setValue({id:a,value:r})):null==this.value||null==this.value?this.setValue(e):this.value.id!=e.id&&this.setValue(e),this.control.html("<label class='readonly-control'>"+this.escapeValue(this.formatItem(e.label||e.value))+"</label>"))},clearDisplayValue:function(){var e=this.getControl();if(this.inputCombo){var t=bizagi.override.emptyLabelForCombo||this.getResource("render-combo-empty-selection");this.inputCombo.val(t)}else this.properties.editable||$(e).html("<label class='readonly-control'></label>");this.value=this.properties.value=this.selectedValue},cleanData:function(){this.value=this.properties.value=this.selectedValue={id:"",value:""},this.clearDisplayValue()},getSelectedValue:function(){return this.selectedValue},findDataById:function(e){return(this.properties.data||[]).find((function(t){return t.id==e}))||{}},findDataByValue:function(e,t,i){var r=-1;if(null!=e&&null!=this.properties.data)if(t)for(var a,n,o,s,l,d=-1,c=this.properties.data.length-1;d++<c;)a=this.properties.data[d],s="object"==_typeof(e)?e.join(" - "):"boolean"==typeof e?e.toString():e,l=$.trim(s).substring(0,s.length).toLowerCase(),n="object"===_typeof(a)&&"object"===_typeof(a.value)?"object"==_typeof(a.value)?a.value.join(" - "):a.value:$.trim(a.value),o=String(n).toLowerCase(),i?o==l&&o.length==l.length&&(r={id:a.id,value:a.value},d=c):0==o.indexOf(l)&&(r={id:a.id,value:a.value},d=c);else this.getValue()&&((r=this.getValue()).value||(r.value=this.inputCombo.val()));return r},setValue:function(e,t){if(null===e&&(e={id:""}),e){var i="object"===_typeof(e)?this.getValueFromData(e.id)||"":"number"==typeof e||"string"==typeof e?this.getValueFromData(e):"",r=void 0!==e.value&&null!==e.value?e.value:this.findDataById(i).value||"";this.selectedValue={id:i,value:r},this._super(this.selectedValue,t)}},getValueFromData:function(e){var t=Number(e);return isNaN(t)&&(t=e),t},recalculateComboOffset:function(e,t){if(bizagi.util.isIE()&&9==bizagi.util.getInternetExplorerVersion()&&e.width()!==t.width()){var i=t.width()-e.width();e.width(t.width()+i)}},resizeCombo:function(){var e=$(".ui-selectmenu",this.control),t=$(".ui-select-dropdown.open",this.element),i=e.width();t&&t.get(0)&&t.width()!==i&&t.width(i)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},isPreferencesDialog:function(e){var t=e&&e.closest(".bz-wp-userpreferences-main")||[];return t&&t.length>0},onResizeCloseDialog:function(){var e=$(".ui-selectmenu",this.control).closest(".ui-dialog-content"),t=$(".ui-select-dropdown.open",e);this.dropDownValidClose(void 0,t)},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $("input.ui-selectmenu-value, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}});var originalRefreshPositionMethod=$.ui.selectmenu.prototype._refreshPosition;$.ui.selectmenu.prototype._refreshPosition=function(){this.list.height(0);var e=originalRefreshPositionMethod.apply(this,arguments);return this.list.css("width",this.newelement.width()+"px"),e},bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.cascadingCombo",bizagi.rendering.combo.prototype),bizagi.rendering.desktop.cascadingCombo.extend("bizagi.rendering.desktop.cascadingCombo",bizagi.rendering.cascadingCombo.prototype),bizagi.rendering.desktop.cascadingCombo.extend("bizagi.rendering.desktop.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{postRender:function(){var e=this;bizagi.rendering.desktop.combo.prototype.postRender.apply(e,arguments),e.processLayout(!1,e.properties.valueFormat||{})},configureHandlers:function(){this._super(),bizagi.rendering.desktop.combo.prototype.configureHandlers.apply(this,arguments)},comboDropDown:function(){bizagi.rendering.desktop.combo.prototype.comboDropDown.apply(this,arguments)},showLoadingData:function(){bizagi.rendering.desktop.combo.prototype.showLoadingData.apply(this,arguments)},hideLoadingData:function(){bizagi.rendering.desktop.combo.prototype.hideLoadingData.apply(this,arguments)},internalComboDropDown:function(){bizagi.rendering.desktop.combo.prototype.internalComboDropDown.apply(this,arguments)},resizeCombo:function(){bizagi.rendering.desktop.combo.prototype.resizeCombo.apply(this,arguments)},validateValueInDatasource:function(){bizagi.rendering.desktop.combo.prototype.validateValueInDatasource.apply(this,arguments)},keyDownFunction:function(e){bizagi.rendering.desktop.combo.prototype.keyDownFunction.apply(this,arguments)},keyUpFunction:function(e){bizagi.rendering.desktop.combo.prototype.keyUpFunction.apply(this,arguments)},selectItemByKeyUp:function(){bizagi.rendering.desktop.combo.prototype.selectItemByKeyUp.apply(this,arguments)},selectFirstElement:function(){bizagi.rendering.desktop.combo.prototype.selectFirstElement.apply(this,arguments)},selectLastElement:function(){bizagi.rendering.desktop.combo.prototype.selectLastElement.apply(this,arguments)},selectPreviousElement:function(){bizagi.rendering.desktop.combo.prototype.selectPreviousElement.apply(this,arguments)},selectNextElement:function(){bizagi.rendering.desktop.combo.prototype.selectNextElement.apply(this,arguments)},setDisplayValue:function(){bizagi.rendering.desktop.combo.prototype.setDisplayValue.apply(this,arguments)},clearDisplayValue:function(){bizagi.rendering.desktop.combo.prototype.clearDisplayValue.apply(this,arguments)},getSelectedValue:function(){return bizagi.rendering.desktop.combo.prototype.getSelectedValue.apply(this,arguments)},onComboItemSelected:function(){return this.itemSelected=!0,bizagi.rendering.desktop.combo.prototype.onComboItemSelected.apply(this,arguments)},postRenderPrintVersion:function(){var e=this.getControl();e.empty(),e.append(this.value.value)},dropDownValidClose:function(){return bizagi.rendering.desktop.combo.prototype.dropDownValidClose.apply(this,arguments)},dropDownReposition:function(e,t){return bizagi.rendering.desktop.combo.prototype.dropDownReposition.apply(this,arguments)},dropDownDestroy:function(e){return bizagi.rendering.desktop.combo.prototype.dropDownDestroy.apply(this,arguments)},findDataById:function(){return bizagi.rendering.desktop.combo.prototype.findDataById.apply(this,arguments)},findDataByValue:function(){return bizagi.rendering.desktop.combo.prototype.findDataByValue.apply(this,arguments)},recalculateComboOffset:function(){return bizagi.rendering.desktop.combo.prototype.recalculateComboOffset.apply(this,arguments)},isPreferencesDialog:function(e){return bizagi.rendering.desktop.combo.prototype.isPreferencesDialog.apply(this,arguments)},setValue:function(e,t){if(t=void 0===t||t,""===e&&(e={id:"",value:""}),e){var i=e.id||"",r=e.value||this.findDataById(i).value;this.selectedValue={id:i,value:r},this.internalSetInitialValueFlag||null!==this.value&&this.value.id===e.id||this.triggerHandler("select",[{id:i,value:r},!1]),this._super(this.selectedValue,t)}},cleanData:function(){this.value=this.properties.value=this.selectedValue={id:"",value:""},this.setValue(this.value,!1),this.setDisplayValue(this.value),this.clearDisplayValue()},changeRequired:function(e){return bizagi.rendering.desktop.combo.prototype.changeRequired.apply(this,arguments)},changeRequiredLabel:function(e){return bizagi.rendering.desktop.combo.prototype.changeRequiredLabel.apply(this,arguments)},changeRequiredControl:function(e){return bizagi.rendering.desktop.combo.prototype.changeRequiredControl.apply(this,arguments)},changeFontUnderline:function(e,t){bizagi.rendering.desktop.combo.prototype.changeFontUnderline.apply(this,arguments)},changeFontStrikethru:function(e,t){bizagi.rendering.desktop.combo.prototype.changeFontStrikethru.apply(this,arguments)},getElementsToStylized:function(e){return bizagi.rendering.desktop.combo.prototype.getElementsToStylized.apply(this,arguments)},changeTextDecoration:function(e,t){return bizagi.rendering.desktop.combo.prototype.changeTextDecoration.apply(this,arguments)}});var originalRefreshPositionMethod=$.ui.selectmenu.prototype._refreshPosition;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}$.ui.selectmenu.prototype._refreshPosition=function(){this.list.height(0);var e=originalRefreshPositionMethod.apply(this,arguments);return this.list.css("width",this.newelement.width()+"px"),e},bizagi.rendering.desktop.combo.extend("bizagi.rendering.desktop.queryCombo",{},{}),bizagi.rendering.desktop.cascadingCombo.extend("bizagi.rendering.desktop.queryCascadingCombo",{},{initializeData:function(e){this._super(e),this.properties.contexttype=this.properties.contexttype||"metadata"},postRender:function(){var e=this;null!==e.parentCombo&&e.isDependant&&e.parentCombo.isRendered().done((function(){$(".ui-bizagi-render-control-included",e.parentCombo.getRenderedElement()).hide()})),this._super()},renderControl:function(){var e=this.getMode(),t=this.parentCombo=this.getParentCombo();null!==t&&"queryCascadingCombo"===t.properties.type&&(this.isDependant=!0),this.initializingCascadingCombo=!0;var i=this._super();return"execution"!==e&&(this.initializingCascadingCombo=!1),i},bindDependantCombo:function(e){var t=this,i=t.properties;"queryCascadingCombo"===e.properties.type&&(t.dependants.push(e),e.onChangeFunction=function(i,r,a){t.refreshDependantCombo(e,r.id,!1,a),a||e.cleanInput()},t.isEventBinded("select")||t.bind("select",e.onChangeFunction),bizagi.util.isEmpty(t.getValue())||i.hasLocalData&&t.refreshDependantCombo(e,t.getValue().id))},canBeSentQueryForm:function(){return!0}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.collectionnavigator",bizagi.rendering.collectionnavigator.prototype),bizagi.rendering.desktop.collectionnavigator.extend("bizagi.rendering.desktop.collectionnavigator",{},{initializeData:function(e){e.properties.displayType="value",this._super(e)},postRender:function(){this._super();var e=this.getControl();this.navigationControls=e.find(".bz-collectionnavigator-controls"),this.canvas=this.getCanvas(),$("[title]",e).tooltip()},configureHandlers:function(){var e=this;e._super(),$.when(e.isRendered()).done((function(){e.hasData()&&e.showRow(e.getFirstRow()),e.refreshControls()})),e.navigationControls.find(".bz-navigation-controls").on("click","span",(function(t){var i=t.currentTarget;$(i).hasClass("ui-state-disabled")||e.paginationActions(i)})),e.navigationControls.find(".bz-navigation-current-row").on("change",(function(t){if(e.isValidRow()){var i=$(this).val();$.when(e.saveChanges()).done((function(){e.updateRow(i)}))}})),e.navigationControls.find(".bz-collectionnavigator-addform").on("click",(function(t){var i=t.currentTarget;$(i).hasClass("ui-state-disabled")||(e.hasData()&&e.isValidRow()?$.when(e.saveChanges()).done((function(){e.addRow()})):e.hasData()||e.addRow())})),e.navigationControls.find(".bz-collectionnavigator-editform").on("click",(function(t){var i=t.currentTarget;$(i).hasClass("ui-state-disabled")||e.isValidRow()&&$.when(e.saveChanges()).done((function(){e.editRow()}))})),e.navigationControls.find(".bz-collectionnavigator-detailform").on("click",(function(t){var i=t.currentTarget;$(i).hasClass("ui-state-disabled")||e.isValidRow()&&$.when(e.saveChanges()).done((function(){e.showDetailForm()}))})),e.navigationControls.find(".bz-collectionnavigator-save").on("click",(function(t){var i=t.currentTarget;if(!$(i).hasClass("ui-state-disabled")&&e.isValidRow()){!e.properties.inlineEdit&&e.isTherePendingInlineRow();$.when(e.saveChanges()).done((function(){e.showRow(e.getRow())}))}})),e.navigationControls.find(".bz-collectionnavigator-cancel").on("click",(function(t){var i=t.currentTarget;$(i).hasClass("ui-state-disabled")||e.cancelChanges()})),e.configureButtonsForm()},postRenderReadOnly:function(){this.postRender(),this.configureHandlers()},refreshControls:function(){this.refreshForwardButtons(),this.refreshBackButtons(),this.refreshPagination(),this.refreshTotal(),this.refreshRemoveAction()},refreshForwardButtons:function(){var e=this.getInnerControl("navigation","next"),t=this.getInnerControl("navigation","last"),i=this.keys.length;this.hasData()&&this.pointer<i-1?(e.removeClass("ui-state-disabled"),t.removeClass("ui-state-disabled")):(e.addClass("ui-state-disabled"),t.addClass("ui-state-disabled"))},refreshBackButtons:function(){var e=this.getInnerControl("navigation","previous"),t=this.getInnerControl("navigation","first");this.hasData()&&this.pointer>0?(e.removeClass("ui-state-disabled"),t.removeClass("ui-state-disabled")):(e.addClass("ui-state-disabled"),t.addClass("ui-state-disabled"))},refreshRemoveAction:function(){if(this.properties.editable){var e=this.getInnerControl("navigation","remove");this.hasData()&&!this.isTherePendingInlineRow()?e.removeClass("ui-state-disabled"):e.addClass("ui-state-disabled")}},refreshPagination:function(){var e=this.getInnerControl("navigation","current");this.keys.length>0?(e.val(this.pointer+1),e.removeClass("ui-state-disabled")):(e.val(this.pointer),e.addClass("ui-state-disabled"))},refreshTotal:function(){this.totalRows=this.getTotalRows(),this.getInnerControl("navigation","total").text(this.totalRows)},refreshActions:function(e,t){var i=this.navigationControls.find(".bz-collectionnavigator-save"),r=this.navigationControls.find(".bz-collectionnavigator-cancel");e?i.removeClass("ui-state-disabled"):i.addClass("ui-state-disabled"),t?r.removeClass("ui-state-disabled"):r.addClass("ui-state-disabled")},getInnerControl:function(e,t){var i=this.properties,r=$("div[data-navigation-id='"+i.id+"']");if(e){if("next"===t)return r.find(".bz-navigation-next");if("last"===t)return r.find(".bz-navigation-last");if("previous"===t)return r.find(".bz-navigation-previous");if("first"===t)return r.find(".bz-navigation-first");if("current"===t)return r.find(".bz-navigation-current-row");if("total"===t)return r.find(".bz-navigation-total-rows");if("add"===t)return r.find(".bz-navigation-add");if("remove"===t)return r.find(".bz-navigation-remove");if("save"===t)return r.find(".bz-collectionnavigator-save");if("cancel"===t)return r.find(".bz-collectionnavigator-cancel")}},showRow:function(e,t){var i=this,r=i.properties;if(e){var a={id:e,requestedForm:"navigationForm",url:i.properties.navigationPage,editable:!!r.editable&&r.inlineEdit};$.when(i.renderForm(i.getParameters(a))).done((function(e){i.loadForm(e,t),i.refreshControls()}))}},showDetailForm:function(){var e=this.properties;new bizagi.rendering.dialog.form(this.dataService,this.renderFactory,{title:e.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!1,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close")}).render(this.getParameters({id:this.getRow(),requestedForm:"detailForm",url:e.editPage,editable:!1}))},showInlineRow:function(e,t){var i=this,r={id:e,requestedForm:"navigationForm",url:i.properties.navigationPage,editable:!0};i.startLoading(),$.when(i.renderForm(i.getParameters(r))).done((function(e){i.loadForm(e,t),i.refreshControls()})).always((function(){i.endLoading()}))},updateRow:function(e){$.isNumeric(e)&&this.isValidKey(e)?(e=parseInt(e),this.setPointer(e),this.showRow(this.getRow()),this.refreshControls()):this.refreshPagination()},isValidKey:function(e){return!(e<=0)&&!(e>this.keys.length)},renderForm:function(e){var t=this,i=new $.Deferred,r=t.getFormContainer();return r.useOrSetLoaderDeferred(),r.appendWaitForLoader({promise:i.promise()}),$.when(t.dataService.getFormData(e)).pipe((function(r){r.form.contextType=e.contextType,delete r.form.buttons,0==e.editable&&(r.form.properties.editable=!1),t.removeTransitions(r.form);var a=t.getFormContainer();t.form=t.renderFactory.getContainer({type:"form",data:r.form,canvas:a.params.canvas||a.container,focus:e.focus||!1,selectedTabs:e.selectedTabs,isRefresh:e.isRefresh||!1}),t.form.render(),a.rendersById=$.extend(a.rendersById,t.form.rendersById),t.form.triggerHandler("ondomincluded",t.getFormContainer()),t.form.bind("refresh",(function(e,i){t.showRow(t.getRow())})),t.bindRenderChangeEvent(t.form.children),i.resolve(t.form)})),i.promise()},bindRenderChangeEvent:function(e){for(var t=this,i=0,r=(e=e||[]).length;i<r;i++){var a,n=e[i],o=n.getElementType();o==bizagi.rendering.element.ELEMENT_TYPE_RENDER?n.bind("renderchange",(function(e,i){var r,n=(i=i||{}).render,o=i.changed;if(!n||"collectionnavigator"!=n.properties.type&&"grid"!=n.properties.type)a=[],t.form.hasChanged(a),r=0===a.length;else if(r=!1,!o&&"grid"==n.properties.type){a=[];var s=$.forceCollectData;$.forceCollectData=!1,t.form.hasChanged(a),$.forceCollectData=s,r=0===a.length}t.refreshActions(!r,!r),t.triggerRenderChange()})):o==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&t.bindRenderChangeEvent(n.children)}},getCanvas:function(){return this.getControl().find(".bz-collectionnavigator-navigationform")},isValidRow:function(){return!!this.form&&this.form.validationController.performValidations()},saveChanges:function(){var e=this,t=e.getChanges(),i=[],r=!1;if(e.form){var a=e.getChildCollectionNavigator(e.form.children,i);return r=a.length>0,$.when((function(){if(r)return e.saveChangesChildren(i)})).then((function(){return e.submitSaveRequest(e.getRow(),t).pipe((function(t){if("success"==(t=t||{}).type)return e.form.collectRenderValuesForSubmit(),e.removeInlineAddRecord(),e.refreshControls(),e.refreshActions(!1,!1),e.fetchData();if("validationMessages"==t.type){var i=e.getFormContainer(),r=t.messages.join(" ");i.failHandler({message:r})}return!1}))}))}return e.removeInlineAddRecord(),e.refreshControls(),e.refreshActions(!1,!1),!0},cancelChanges:function(){if(this.refreshActions(!1,!1),this.inlineAddRecords.length>0)this.removeKey(),this.inlineAddRecords.pop(),this.submitRollbackRequest({idPageCache:this.form.properties.idPageCache}),this.refreshTotal(),this.refreshControls(),0==this.getTotalRows()?(this.removeNavigationForm(),this.drawPreview()):this.showRow(this.getRow());else{var e=this.getChanges();$.isEmptyObject(e)||this.showRow(this.getRow())}},getChanges:function(){var e=this,t={};return e.form&&e.form.collectRenderValues(t),$.each(t,(function(t,i){var r=e.form.getRenders(t);$.each(r,(function(e,t){t.updateOriginalValue()}))})),t},addInlineRow:function(){var e=this;$.when(e.submitAddRequest()).done((function(t){e.refreshActions(!0,!0),e.inlineAddRecords.push(t),e.addKey(t),e.showInlineRow(e.getLastRow(),!0),e.refreshTotal(),e.refreshControls()}))},addRow:function(){var e=this,t=e.properties;$.when(e.submitAddRequest()).done((function(i){new bizagi.rendering.dialog.form(e.dataService,e.renderFactory,{title:t.addLabel,orientation:t.orientation||"ltr",onSave:function(r){return t.contextType&&(r[e.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=t.contextType),e.submitSaveRequest(i,r)}}).render(e.getParameters({id:i,requestedForm:"addForm",url:t.addPage,editable:!0})).done((function(){e.startLoading(),$.when(e.fetchData()).done((function(){e.showRow(e.getLastRow())})),e.endLoading()})).fail((function(t){$.when(e.submitRollbackRequest(t)).done((function(){e.submitInvalidatePageCacheRequest(t)}))}))}))},editRow:function(){var e=this,t=e.properties,i=e.getRow();$.when(e.submitEditRequest(i)).done((function(){new bizagi.rendering.dialog.form(e.dataService,e.renderFactory,{title:t.editLabel,orientation:t.orientation||"ltr",onSave:function(t){return e.submitSaveRequest(i,t)}}).render(e.getParameters({id:i,requestedForm:"editForm",url:e.properties.editPage,editable:!0})).done((function(){$.when(e.fetchData()).done((function(){e.showRow(e.getRow())}))})).fail((function(t){$.when(e.submitRollbackRequest(t)).done((function(){e.submitInvalidatePageCacheRequest(t)}))}))}))},removeRow:function(){var e=this,t=e.getRow();bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){$.when(e.submitDeleteRequest(t)).done((function(t){"success"==(t=t||{}).type&&(e.startLoading(),e.removeKey(),e.refreshTotal(),e.refreshControls(),0==e.getTotalRows()?(e.removeNavigationForm(),e.drawPreview()):e.showRow(e.getRow()),e.endLoading())}))}))},removeInlineAddRecord:function(){this.isTherePendingInlineRow()&&this.inlineAddRecords.pop()},loadForm:function(e,t){this.removeNavigationForm(),e.container.find(".ui-bizagi-button-container").remove(),this.addNavigationForm(e.container),t&&this.focusFirstControl(e)},configureButtonsForm:function(){var e=this,t=e.getFormContainer();t.processButton=function(i){var r=$.Deferred();return e.form&&""!==i.action?"save"===i.action?$.when(e.saveChanges()).done((function(){t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()}))})).fail((function(t){e.processFailMessage(t),r.resolve()})):["next","createnewcase"].includes(i.action)?!bizagi.util.parseBoolean(i.validate)||e.isValidRow()?$.when(e.saveChanges()).done((function(){t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()}))})).fail((function(t){e.processFailMessage(t),r.resolve()})):t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()})):"nextWithoutValidations"===i.action?$.when(e.saveChanges()).done((function(){t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()}))})).fail((function(t){e.processFailMessage(t),r.resolve()})):"validate"===i.action&&t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()})):t.originalProcessButton.apply(t,[i]).done((function(){r.resolve()})).fail((function(){r.reject()})),r.promise()}},removeNavigationForm:function(){this.canvas.children().remove()},addNavigationForm:function(e){this.canvas.append(e)},fetchData:function(){var e=this,t=new $.Deferred,i=e.getFormContainer();return i.useOrSetLoaderDeferred(),i.appendWaitForLoader({promise:t.promise()}),e.startLoading(),$.when(e.getRemoteData()).done((function(i){e.endLoading(),e.disposed||(i?(e.refresh(i),t.resolve()):t.reject())})),t.promise()},refresh:function(e){var t=this.getKeys(e.rows);this.keys=t,-1==t.indexOf(this.getRow())&&(this.totalRows=t.length,this.pointer=this.pointer>0?this.pointer-1:this.pointer,0==this.totalRows&&(this.removeNavigationForm(),this.drawPreview(),this.refreshControls()))},focusFirstControl:function(e,t){var i=function(){var t=$("input:visible, select:visible, option:visible, textarea:visible",e.container).not(".ui-bizagi-render-date,.ui-bizagi-render-search");if(t.length>0){var i=t[0];try{i.focus()}catch(e){}}};if(t>0)var r=setTimeout((function(){i(),clearTimeout(r)}),t);else i()},getChildCollectionNavigator:function(e,t){for(var i=0,r=(e=e||[]).length;i<r;i++){var a=e[i],n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER?"collectionnavigator"!=a.properties.type&&"grid"!=a.properties.type||t.push(a):n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&this.getChildCollectionNavigator(a.children,t)}return t},saveChangesChildren:function(e){for(var t=[],i=0,r=e.length;i<r;i++)if("collectionnavigator"==e[i].properties.type){var a=e[i].saveChanges();t.push(a)}return $.when.apply($,t)},drawControls:function(e){var t=this.properties;e=$(e);var i=this.collectionControls=$(".bz-collectionnavigator-controls",e);return this.drawForms(i),this.drawControl(i),t.editable&&this.drawActions(i),e[0].outerHTML},drawActions:function(e){var t=$(".actions-group",e),i=this.renderFactory.getTemplate("collectionnavigator-actions");return $.tmpl(i).appendTo(t),e},drawControl:function(e){var t=this.properties,i=t.editable,r=$(".control-group",e),a=this.renderFactory.getTemplate("collectionnavigator-control");return $.tmpl(a,{inlineAdd:i&&t.inlineAdd,allowDelete:i&&t.allowDelete,total:this.totalRows}).appendTo(r),e},drawForms:function(e){var t=this.properties,i=t.withAddForm,r=t.withEditForm,a=t.allowDetail,n=$(".bz-navigation-group",e);return t.editable&&(i||r||a)?(n.addClass("group-visible"),i&&this.getActionsTemplate("add").appendTo(n),r&&this.getActionsTemplate("edit").appendTo(n),a&&this.getActionsTemplate("details").appendTo(n)):n.addClass("group-no-visible"),e},removeTransitions:function(e){(e=e||{}).transitions&&delete e.transitions},collectData:function(e){var t;this.isRendered()&&!0!==(t=this.saveChanges())&&(e.deferreds=e.deferreds||[],e.deferreds.push(t))},getActionsTemplate:function(e){var t=this.renderFactory.getTemplate("collectionnavigator-form-button"),i=null;switch(e){case"add":i=$.tmpl(t,{actionClass:"bz-collectionnavigator-addform",buttonClass:"ui-icon bz-collectionnavigator-addform-icon",title:bizagi.localization.getResource("render-collection-navigator-add-form")});break;case"edit":i=$.tmpl(t,{actionClass:"bz-collectionnavigator-editform",buttonClass:"ui-icon bz-collectionnavigator-editform-icon",title:bizagi.localization.getResource("render-collection-navigator-edit-form")});break;case"details":i=$.tmpl(t,{actionClass:"bz-collectionnavigator-detailform",buttonClass:"ui-icon bz-collectionnavigator-detailform-icon",title:bizagi.localization.getResource("render-collection-navigator-details-form")})}return i},paginationActions:function(e){var t=this;$(e).hasClass("bz-navigation-next")&&t.isValidRow()?$.when(t.saveChanges()).done((function(){t.showRow(t.getNextRow())})):$(e).hasClass("bz-navigation-previous")&&t.isValidRow()?$.when(t.saveChanges()).done((function(){t.showRow(t.getPreviousRow())})):$(e).hasClass("bz-navigation-first")&&t.isValidRow()?$.when(t.saveChanges()).done((function(){t.showRow(t.getFirstRow())})):$(e).hasClass("bz-navigation-last")&&t.isValidRow()?$.when(t.saveChanges()).done((function(){t.showRow(t.getLastRow())})):$(e).hasClass("bz-navigation-remove")?t.hasData()&&t.removeRow():$(e).hasClass("bz-navigation-add")&&(t.hasData()&&t.isValidRow()?$.when(t.saveChanges()).done((function(){t.addInlineRow()})):t.hasData()||t.addInlineRow())}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.ecm.prototype),bizagi.rendering.desktop.ecm.extend("bizagi.rendering.desktop.ecm",{},{renderControl:function(e,t){},postRender:function(){var e=this.getControl(),t=this.properties,i=this.getResource("dateFormat"),r=this.getResource("timeFormat"),a=this.getMode();if(this._super(),t.maxSize=Number(t.maxSize)||("undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):t.maxSize=Number(t.maxSize)||4091904),t.maxFiles=Number(t.maxfiles)||999,t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var n=t.validExtensions.split(";"),o=0,s=n.length;o<s;o++)n[o]="*."+n[o];t.validExtensions=n.join(";")}t.addUrl=t.addUrl||this.dataService.getUploadAddUrl(),t.deleteUrl=t.deleteUrl||void 0,t.allowDelete=null===bizagi.util.parseBoolean(t.allowDelete)||bizagi.util.parseBoolean(t.allowDelete),t.q_xpath=bizagi.util.encodeXpath(this.getUploadXpath()),t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||i,t.timeFormat=t.timeFormat||r,t.fullFormat=t.dateFormat,t.datePickerFormat=t.dateFormat.replaceAll("M","m"),t.datePickerFormat=t.datePickerFormat.replaceAll("yyyy","yy"),t.datePickerFormat=t.datePickerFormat.replaceAll("dddd","DD"),t.datePickerFormat=t.datePickerFormat.replaceAll("mmmm","MM"),this.files=t.value||[],this.filesCount=this.files.length,t.xpathContext=this.parent.properties.xpathContext||t.xpathContext||"",e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-upload"),e.addClass("ui-bizagi-render-ecm"),$(e).closest(".ui-bizagi-control-wrapper").addClass("ui-bizagi-control-wrapper-ecm"),this.properties.showRenderOptions=!0,"execution"==a?this.renderUploadItem():e.append("<div class='ui-icon ecm-file'></div>"),this.checkMaxFiles(),this.preventDefaultForAnchorTag()},configureHandlers:function(){var e=this.getControl();this._super(),data=this.buildAddParams(),data.networkSpeed=networkSpeed(),$(".biz-render-ecm-upload-wrapper",e).bizagiUpload({renderReference:this,dialogTemplate:this.renderFactory.getTemplate("upload.ecm.dialog"),properties:data,uploadedFiles:this.filesCount,isECM:!0,onUploadFileCompletedCallback:this.onUploadFileCompleted,dialogTitle:this.getResource("render-upload-link-label")})},configureUploadHandlers:function(e,t,i){var r=e,a=r.buildUpgradeParams(i);$(i).bizagiUpload({renderReference:r,dialogTemplate:r.renderFactory.getTemplate("upload.ecm.dialog"),properties:a,uploadedFiles:r.filesCount,isECM:!0,isUpdatingECM:!0,onUploadFileCompletedCallback:r.onUpdateUploadFileCompleted,dialogTitle:r.getResource("render-upload-link-label")})},onUpdateUploadFileCompleted:function(e,t,i,r){var a=e;i.empty(),a.waiting(i,!0),a.filesCount++,a.renderFileLayout(a,t,i,r)},renderUploadItem:function(e,t){var i=this,r=i.getMode(),a=i.getControl(),n=i.renderFactory.getTemplate("upload-ecm-view-default"),o=i.properties;o.value=t?[[t.idFileUpload,t.fileName]]:i.value,void 0===t||void 0===t.status||"error"!=t.status?$.when($.tmpl(n,o,{getFileExtension:i.getFileExtension,isImage:i.isImage,allowSendInMail:o.allowSendInMail})).done((function(n){e&&e.length>0?n.insertAfter(e.last()):a.append(n),a.find(".uploadifyQueueItem").remove(),null!=i.properties.value&&$.each(i.properties.value,(function(e,n){var o={};o.idFileUpload=n[0]||n.uploadId,o.fileName=n[1]||n.fileName,o.idPageCache=i.properties.idPageCache,o.xpathContext=i.getXpathContext(),o.xPath=i.properties.xpath,o.idAttrib=i.properties.idAttrib,"execution"==r&&i.renderFileLayout(i,o,$("."+i.properties.id+"-"+o.idFileUpload,a),t)})),i.properties.allowSendInMail&&i.bindEmailDialog()})):bizagi.showMessageBox(t.message)},bindEmailDialog:function(){var e=this.getControl(),t=this.getXpathContext()||"",i=this.properties.xpath;$(".ui-bizagi-render-ecm-sendmail",e).bizagiSendEmail({tmpl:this.renderFactory.getTemplate("dialog-send-email"),value:this.value,self:this,dataService:this.dataService,properties:this.properties,xpath:i,xpathContext:t})},renderFileLayout:function(e,t,i,r){var a=(e=e||this).getFormContainer(),n=e.renderFactory.getTemplate("upload-ecm-view-default-metadata"),o={zIndex:$.getMaxZindex()+1},s=$.extend({},t),l=r?[r]:e.dataService.metadataECMMultiaction().getFileProperties(s);$.when(e.dataService.metadataECMMultiaction().getECMMetadata(t),l).done((function(r,s){e.waiting(i,!0),Array.isArray(s)&&(s=s[0]),Array.isArray(r)&&(r=r[0]),s.data=t,s.xpathContext=s.xpathContext||a.properties.xpathContext||"",s.xpath=e.properties.xpath,r.filename=t.fileName,r.ecm_ecmStatus=s.ecmStatus,r.ecm_isVisible=s.isVisible,r.ecm_allowUpdateMetadata=s.allowUpdateMetadata,r.ecm_allowDelete=s.allowDelete,r.ecm_allowUpdateContent=s.allowUpdateContent,r.ecm_allowView=s.allowView,r.ecm_allowCheckOut=s.allowCheckOut,r.ecm_allowCancelCheckOut=s.allowCancelCheckOut,r.ecm_allowEdit=s.allowEdit,r.idFileUploads=s.idFileUpload,r.xpath=s.xpath,r.value=bizagi.util.parseBoolean(s.value);var l=i.parent().find(".extension:last");if(e.isImage(r.filename)){l.empty(),l.append("<img>");var d=l.find("img");l.addClass("thumb-image"),e.requestFile({id:r.idFileUploads,filename:r.filename},!1).then((function(e){d.attr({src:e,width:32,height:32})})),d.imageZoom(o),$(".checkuot , .readonly",i.parent()).off("click").on("click",(function(){d.click()}))}else i.parent().find("li:first").off("click").on("click",(function(t){t.stopPropagation(),e.requestFile({id:r.idFileUploads,filename:r.filename},!0)}));if(s.isVisible){i.empty();var c=$.extend(r,{showMetadata:e.properties.showMetadata,orientation:a.properties.orientation||"ltr"});$.when($.tmpl(n,c).appendTo(i)).done((function(){switch($(".ecm-options-slide li",i).hover((function(){$(this).toggleClass("ecm-options-slide-hover")})),$(".filename_download",i).off("click").on("click",(function(t){t.stopPropagation(),e.requestFile({id:r.idFileUploads,filename:r.filename},!0)})),e.isImage(r.filename)&&$(".filename a",i).imageZoom(o),e.setControlEvents(i,t),r.ecm_allowUpdateContent&&e.configureUploadHandlers(e,t,i,s),s.ecmStatus){case 1:break;case 2:i.parent().find(".checkuot").css("visibility","hidden"),i.parent().find(".checkuot").hide();break;case 3:break;case 4:$(".emc-options",i).hide(),i.parent().find(".readonly").css("visibility","visible"),i.parent().find(".readonly").show();break;case 5:i.parent().find(".checkuot").css("visibility","visible"),i.parent().find(".checkuot").show();break;case 6:bizagi.debug("ECM control return undefined status",s);break;default:i.parent().find(".checkuot").css("visibility","hidden").hide(),i.parent().find(".readonly").css("visibility","hidden").hide()}if(bizagi.util.parseBoolean(e.properties.editable)){var a=!0;i.data("pluginAvailable",!1),$(".emc-options",i).on("click",(function(n){if(n.stopPropagation(),a){a=!1;$.when(function(i){var a=new $.Deferred,n=$(".modal-ecm",i),o=e.control;if(n.is(":visible"))$(".modal-ecm",o).hide(),$(".ecm-options-slide",n).hide(),n.hide(),a.resolve(!0);else{var s=function(){$(".modal-ecm",o).hide(),$(".ecm-options-slide",n).show(),n.show().position({my:"center top",at:"center bottom",of:$(".emc-options",i),collision:"none"})};e.configureToggleHandlers(),a.resolve(!0),void 0!==e.properties.isAsync?(r.ecm_allowUpdateContent||$(".ecm-options-upgrade",n).hide(),void 0===e.asynCheckEnabled&&(e.asynCheckEnabled=!0,e.asyncCheckTimeout=setTimeout((function(){e.asynCheckEnabled=void 0,e.asyncCheckTimeout=void 0,clearTimeout(e.asyncCheckTimeout)}),2e3),t.IsFileOnECM?s():($(".ecm-options-checkout",n).hide(),$(".ecm-options-cancelcheckout",n).hide(),$(".ecm-options-upgrade",n).hide(),$.when(e.dataService.isFileOnECM({idUpload:t.idFileUpload})).done((function(e){e.IsFileOnECM&&(r.ecm_allowUpdateContent&&$(".ecm-options-upgrade",n).show(),r.ecm_allowCheckOut&&$(".ecm-options-checkout",n).show(),r.ecm_allowCancelCheckOut&&$(".ecm-options-cancelcheckout",n).show()),t.IsFileOnECM=e.IsFileOnECM,s()})).fail((function(e){bizagi.log("isFileOnECM error")}))))):s()}return a.promise()}(i)).done((function(){a=!0}))}}))}else $(".emc-options",i).hide(),$(e.getControl()).trigger("ecmLoaded",{container:l})}))}}))},requestFile:function(e,t){var i=this;t=void 0===t||t;var r=i.properties;return i.dataService.getFile({idRender:r.id,xpath:r.xpath,xpathContext:i.getXpathContext(),idPageCache:r.idPageCache,fileId:e.id,contexttype:r.contexttype}).then((function(e){return bizagi.util.handleJSONResponse(e)})).then((function(i){if(!t)return window.URL.createObjectURL(i);bizagi.util.downloadBlobFile(i,e.filename)})).fail((function(e){var t=i.getFormContainer();t&&t.failHandler(e)}))},setControlEvents:function(e,t){var i=this,r=(i.properties,i.getControl());$(".ecm-options-delete",e).on("click",(function(a){a.stopPropagation(),$(".emc-options",e).click(),$(".biz-render-ecm-delete-confirmation",r).first().clone().dialog({resizable:!1,modal:!0,title:i.getResource("render-ecm-confirm-title"),buttons:[{text:i.getResource("render-ecm-confirm-bt-delete"),click:function(){delete t.prepare,i.dataService.deleteECMFile(t),$(this).dialog("close"),e.parent("ul").hide("highlight",{},100);for(var r=[].concat(i.files),a=0;a<r.length;a++)r[a][0]==t.idFileUpload&&r.splice(a,1);i.setValue(r),i.checkMaxFiles()}},{text:i.getResource("render-ecm-confirm-bt-cancel"),click:function(){$(this).dialog("close")}}]})})),$(".ecm-options-cancelcheckout",e).on("click",(function(r){r.stopPropagation(),$(".emc-options",e).click(),i.waiting(e,!1),e.find(".filename").empty(),delete t.prepare,$.when(i.dataService.cancelCheckOut(t)).done((function(r){i.renderFileLayout(i,t,e,r)}))})),$(".ecm-options-checkout",e).off("click").on("click",(function(r){r.stopPropagation(),$(".meta-data-wrapper",e).click(),i.waiting(e,!1),e.find(".filename").empty(),delete t.prepare,$.when(i.dataService.checkOutFile(t)).done((function(r){i.renderFileLayout(i,t,e,r)}))})),4!=$(".ecm-metadata-value",e).data("ecmstatus")&&$(".ecm-metadata-value",e).data("allowupdatemetadata")&&$(".ecm-metadata-value",e).bind("activeeditmode",(function(t){if(t.stopPropagation(),!$(this).data("readonly")&&("false"==$(this).data("edit-mode")||""==$(this).data("edit-mode")))switch($(this).data("edit-mode","true"),$(this).data("metadatatype")){case"STRING":i.makeStringMetaDataControler($(this),e);break;case"INTEGER":i.makeStringMetaDataControler($(this),e,(function(e){var t=e.match(/\d+/);return null!=t&&t[0]==t.input}));break;case"DATETIME":i.makeDatetimeMetaDataControler($(this),e);break;case"DECIMAL":i.makeStringMetaDataControler($(this),e,(function(e,t){var r=i.getResource("numericFormat"),a=new RegExp("\\d+(\\"+r.decimalSymbol+"\\d)*"),n=e.match(a);try{var o=e.substr(e.length-1,1)}catch(e){return!1}return null!=n&&(n[0]==n.input||o==r.decimalSymbol)}));break;case"BOOL":i.makeBooleanMetaDataControler($(this),e);break;default:i.makeStringMetaDataControler($(this),e)}})),$(".ecm-metadata-done",e).on("click",(function(e){e.stopPropagation();var t=$(this).parent("td"),r=$(".ecm-metadata-field-edit",t),a="",n="";switch(t.data("metadatatype")){case"STRING":case"DECIMAL":case"INTEGER":a=$(".ecm-metadata-input",t).val(),n=$(".ecm-metadata-input",t).val();break;case"BOOL":a=$(".biz-render-ecm-upload-boolean input:checked",t).val(),n=bizagi.util.parseBoolean(a)?"True":"False",a="False"==a?i.getResource("render-boolean-no"):i.getResource("render-boolean-yes");break;case"DATETIME":if(a=$(".ecm-metadata-input",t).val()){var o=bizagi.util.dateFormatter.getDateFromFormat(a,i.properties.datePickerFormat);n=bizagi.util.dateFormatter.formatInvariant(o,!0)}}t.data("value",n);var s=$("<span></span>").addClass("ecm-metadata-text").text(a);r.replaceWith(s),$(".ecm-metadata-edit",t).css("display","block"),$(".ecm-metadata-done",t).hide(),$(".ecm-metadata-cancel",t).hide(),t.data("edit-mode","false")})),$(".ecm-options-edit",e).on("click",(function(r,a){var n=e,o=a&&a.checkData||!1;if(r.stopPropagation(),"block"===$(".emc-options",e).css("display")&&$(".modal-ecm",e).hide(),!(o&&i.isValidFields(n)||"true"==$(".ecm-options-edit",n).data("editmode"))){$(".ecm-options-edit",n).data("editmode","true");var s=i.renderFactory.getTemplate("upload-ecm-view-default-edit-buttons"),l=[],d=$.tmpl(s);$(".ecm-metadata-value[data-allowUpdateMetadata=true]",e).trigger("activeeditmode"),d.insertAfter($("table",e)),$(".biz-render-ecm-metadata-edit",e).show(500),$(".biz-render-ecm-metadata-edit button:first",e).on("click",(function(r){var a=!1,n=e;r.stopPropagation(),$.each($(".ecm-metadata-value[data-mandatory='true']",e),(function(e,t){var r;""===(r="BOOL"==$(t).data("metadatatype")?$(".biz-render-ecm-upload-boolean input:checked",t).val():$(t).find(".ecm-metadata-field-edit").val())||null===r?($(t).find("input").attr("placeholder",i.getResource("render-ecm-tooltip-mandatory")),$(t).parent().find(".ecm-metadata-key").addClass("mandatory-error"),$(t).parent().effect("highlight",500),a=!0):$(t).parent().find(".ecm-metadata-key").removeClass("mandatory-error")})),a||($(".ecm-metadata-done",e).click(),$(".biz-render-ecm-metadata-edit",e).hide(300,(function(){$(".biz-render-ecm-metadata-edit",e).remove()})),$.each($(".ecm-metadata-value",e),(function(t,i){l.push({idMetadata:$($(".ecm-metadata-key",e)[t]).data("idmetadata"),value:$(i).data("value")})})),t.metaValues=JSON.encode({metadataValues:l}),delete t.prepare,$.when(i.dataService.updateECMMetadata(t)).done((function(e){$(".ecm-options-edit",n).data("editmode","false")})))})),$(".biz-render-ecm-metadata-edit button:last",e).on("click",(function(t){var i=e;t.stopPropagation(),$(".ecm-metadata-cancel",e).click(),$(".biz-render-ecm-metadata-edit button:first",e).unbind("click"),$(".ecm-options-slide",i).is(":visible")&&$(".emc-options",e).click(),$(".biz-render-ecm-metadata-edit",e).hide(500,(function(){$(".biz-render-ecm-metadata-edit",e).remove()})),$(".ecm-options-edit",i).data("editmode","false")}))}})),$(".ecm-metadata-cancel",e).on("click",(function(e){e.stopPropagation();var t=$(this).parent("td"),i=$(".ecm-metadata-field-edit",t),r=$("<span></span>").addClass("ecm-metadata-text").text(i.data("original-value"));i.replaceWith(r),$(".ecm-metadata-edit",t).css("display","block"),$(".ecm-metadata-done",t).hide(),$(".ecm-metadata-cancel",t).hide(),t.data("edit-mode","false")}))},makeStringMetaDataControler:function(e,t,i){var r=$(".ecm-metadata-text",e),a=$("<input></input>").addClass("ecm-metadata-field-edit ecm-metadata-input").val(r.text());a.data("original-value",r.text()),r.replaceWith(a),a.focus(),$(".ecm-metadata-edit",e).hide(),$(".ecm-metadata-done",e).css("visibility","visible").show(),$(".ecm-metadata-cancel",e).css("visibility","visible").show(),$(".ecm-metadata-input",e).bind("keyup",(function(e){var t=a.val();i&&(i(t)||""==t?a.data("latestdonevalue",t):a.val(a.data("latestdonevalue")||""))}))},makeDatetimeMetaDataControler:function(e,t){var i=$(".ecm-metadata-text",e),r=$("<input></input>").addClass("ecm-metadata-field-edit ecm-metadata-input").val(i.text());r.data("original-value",i.text()),i.replaceWith(r),r.datepicker({dateFormat:this.properties.datePickerFormat,changeYear:!0,onSelect:function(e,t){r.val(e+" 00:00 AM")}}),$(".ecm-metadata-edit",e).hide(),$(".ecm-metadata-done",e).css("visibility","visible").show(),$(".ecm-metadata-cancel",e).css("visibility","visible").show(),$(".ecm-metadata-input",e).bind("keypress",(function(e){13==e.keyCode&&$(".ecm-metadata-done",t).trigger("click")}))},makeDecimalMetaDataControler:function(e,t){this.getResource("decimalSymbol");this.makeStringMetaDataControler($(this),t,(function(e,t){var i=new RegExp("\\d+(\\"+t+"\\d)*"),r=e.match(i);return null!=r&&(r[0]==r.input||null==r[1])}))},makeBooleanMetaDataControler:function(e,t){var i=this.renderFactory.getTemplate("upload-ecm-view-default-yesno"),r=$(".ecm-metadata-text",e),a=$(e).data("value")||!1,n=!!bizagi.util.parseBoolean(a),o=Math.ceil(100*Math.random()),s=$.tmpl(i,{id:this.properties.id,checked:n,rnd:o});s.data("original-value",r.text()),r.replaceWith(s),$(".ecm-metadata-edit",e).hide(),$(".ecm-metadata-done",e).css("visibility","visible").show(),$(".ecm-metadata-cancel",e).css("visibility","visible").show()},isImage:function(e){var t=this.getFileExtension(e);return $.inArray(t.toUpperCase(),["JPG","JPEG","GIF","PNG","BMP"])>-1},postRenderReadOnly:function(){var e=this.getControl();"execution"==this.getMode()?(e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-upload"),$(".biz-render-ecm-upload-wrapper",e).remove(),this.properties.showRenderOptions=!1,this.renderUploadItem(),$(".emc-options",e).remove()):e.append("<div class='ui-icon upload-file'></div>")},buildAddParams:function(){var e=this.properties,t={url:e.addUrl,xPath:e.xpath,idAttrib:e.idAttrib,xpathContext:e.xpathContext,metaValues:[],idPageCache:e.idPageCache,folder:BIZAGI_PATH_TO_BASE,contexttype:e.contexttype,validExtensions:e.validExtensions,maxSize:e.maxSize},i={};return $.extend(i,i,t),t.scriptData=i,t},buildUpgradeParams:function(e){var t=this.properties,i={url:t.editUrl,xPath:t.xpath,idFileUpload:$(".ecm-options-upgrade > input",e).data("idfileupload"),idPageCache:t.idPageCache,idAttrib:t.idAttrib,xpathContext:this.getXpathContext(),folder:BIZAGI_PATH_TO_BASE,validExtensions:t.validExtensions,maxSize:t.maxSize},r={};return $.extend(r,r,i),i.scriptData=r,i},checkMaxFiles:function(){var e=this.properties,t=this.getControl(),i=$(".biz-render-ecm-upload-wrapper",t);e.maxFiles>0&&this.filesCount>=e.maxFiles?i.hide():this.filesCount<e.maxFiles&&i.show()},onUploadFileCompleted:function(e,t){var i=e,r=i.getControl();if("error"!=t.type){i.properties.showRenderOptions=!1;var a=$(".biz-render-ecm-view-default",r);a=a.length>0?a:$(".biz-render-ecm-delete-confirmation",r),i.filesCount=i.filesCount+1,i.checkMaxFiles();var n=[].concat(i.files);n.push([t.idFileUpload,t.fileName]),i.setValue(n,!1),i.triggerRenderChange(),i.renderUploadItem(a,t)}else t.isMaintenanceWindow||bizagi.showMessageBox(t.message)},isValid:function(e){var t=this.getControl(),i=[],r=!1,a=this.properties,n=!0,o=this.grid&&this.grid.isFromCreatedRow.apply(this),s=!((a.required||a.editable)&&!o)||this._super(e);if(a.required&&(n=!!o||s,0==this.filesCount&&n&&(e.push({xPath:a.xpath,message:this.getResource("render-required-text").replaceAll("#label#",a.displayName)}),n=!1)),a.editable&&(n=!!o||s,!o)){var l=$("ul:visible",t).find(".ecm-metadata-value[data-mandatory='true']");$.each(l,(function(e,t){""==$(".ecm-metadata-text",t).text()&&(i.push($(t).data("mandatoryfield")),r=!0)}))}if(r){var d=this.getResource("render-required-text").replaceAll("#label#",i.join(", "));e.push({xPath:a.xpath,message:d}),"true"!=$(".ecm-options-edit",t).data("editmode")&&$(".ecm-options-edit",t).trigger("click",{checkData:!0})}return n},cleanData:function(){this.setValue(null),this.clearDisplayValue()},clearDisplayValue:function(){var e=this,t=e.getControl().find(".biz-render-ecm-view-default");t.length;$.each(t,(function(t,i){var r=$(i),a=r.data();a&&$.when(e.deleteUploadItem(r,a.id)).done((function(){r.remove(),e.triggerRenderChange()}))})),t.hide(),e.filesCount=0,e.checkMaxFiles()},waiting:function(e,t){e.find(".ecm-file-name").css("visibility",t?"visible":"hidden"),e.find("table").css("visibility",t?"visible":"hidden"),e.css("background",t?"":"transparent"),t?e.removeClass("waiting"):e.addClass("waiting")},configureToggleHandlers:function(){$(document.body).off("click").on("click",(function(e){$(e.target).hasClass("emc-options")||$(e.target).hasClass("ui-icon-gear")||($(".modal-ecm",this).hide(),$("#content-wrapper, .bz-rn-grid-data-wraper").unbind("scroll"),$(document.body).unbind("click"))})),$("#content-wrapper, .bz-rn-grid-data-wraper, .ui-bizagi-dialog-search").off("scroll").on("scroll",(function(e){$(e.target).hasClass("emc-options")||$(e.target).hasClass("ui-icon-gear")||($(".modal-ecm",this).hide(),$(document.body).unbind("click"),$("#content-wrapper, .bz-rn-grid-data-wraper").unbind("scroll"))}))},isValidFields:function(e){var t=!0,i=$(e).find(".ecm-metadata-value[data-mandatory='true']");return $.each(i,(function(e,i){var r=$(".ecm-metadata-text",i).text();bizagi.util.isEmpty(r)&&(t=!1)})),t}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.grid.bizagi",bizagi.rendering.grid.prototype),bizagi.rendering.desktop.grid.bizagi.extend("bizagi.rendering.desktop.grid.bizagi",{},{initializeData:function(e){this.isRTLDirection=this.isRTLOrientation(this.parent,e&&e.properties?e.properties.orientation:""),e.properties.orientation=this.isRTLDirection?"rtl":e.properties.orientation,this.showActionColumn(e),e.properties.singleInstance=!1,this._super(e),this.cellMetadata={},this.pendingActions=[];var t=this.properties;this.collapseState=t.collapseState,t.displayType="vertical",t.labelAlign="left"},showActionColumn:function(e){var t=this.getMode(),i=this.getFormContainer(),r=e.properties||{},a=null==bizagi.util.parseBoolean(r.editable)||bizagi.util.parseBoolean(r.editable),n=null!=bizagi.util.parseBoolean(r.columnActions)&&bizagi.util.parseBoolean(r.columnActions);if(i.getParams()&&i.getParams().printversion&&(n=!1),this.columnActionParams={columnActions:n,allowDelete:!(void 0!==r.allowDelete||!a),allowEdit:!(void 0!==r.allowEdit||!a),allowDetail:void 0!==r.allowDetail,withEditForm:void 0!==r.withEditForm},!e.properties.hideActionsColumn&&"execution"===t){var o={render:{properties:{id:"e51580f3-fd6c-49c0-8c69-73dff93723e5",type:"columnActions","xpath-column":'constant("")',displayName:"",submitOnChange:!1,totalize:{format:{}},hasTotalizer:!1,preventDefault:!0,columnwidth:"24px",headerStyles:{header:"width: 24px",label:"width: 24px"},cssclass:"bz-grid-header-actions"}}};this.isRTLDirection?(e.elements.push(o),this.spliceRowData(e.properties.data)):(e.elements.splice(0,0,o),this.spliceRowData(e.properties.data,1),this.spliceRowDataVisible(e.properties.data,1),this.spliceRowDataEditable(e.properties.data,1))}},hasActions:function(e){return void 0!==this.columnActionParams&&(this.columnActionParams.columnActions&&(this.columnActionParams.allowDelete||this.columnActionParams.allowEdit&&this.columnActionParams.withEditForm||this.columnActionParams.allowDetail))},getGridTemplate:function(){return this.renderFactory.getTemplate("grid.bizagi")},postRender:function(){var e=this,t=e.properties,i=e.getControl();this._super();var r=e.grid=$(">div",i),a=e.buildColumnModel();for(var n in e.getLabel().hide(),e.cleanNewRecords(),e.applyGridPlugin(),t.data&&(""===t.data||0===t.data.rows.length&&t.data.page>1?e.fetchData(void 0,e.sortBy,e.sortType):(e.updateData(t.data),$.when(e.ready()).done((function(){e.triggerRenderChange({changed:!1})})))),e.initialLoadDone=!0,e.pendingActions)"function"==typeof e.pendingActions[n].method&&e.pendingActions[n].method.apply(e,e.pendingActions[n].arguments);var o=$("[data-bizagi-component='buttons'] li[title!='']",e.getControl());o.tooltip(),(o=$("[data-bizagi-component='cellContent'] button[title!='']",e.getControl())).tooltip(),$("[data-bizagi-component='columns'] th > div[title!='']",e.getControl()).tooltip(),e.applyColumnsWidth(r,a)},changeFontBold:function(){return this},applyGridPlugin:function(){var e=this,t=e.grid,i=e.properties,r=e.getMode(),a=e.renderFactory.getTemplate("bizagi.grid.pagination"),n=e.getFormContainer(),o=n.container;n.params&&"search"==n.params.context&&n.parent&&n.parent.params&&n.parent.params.canvas?o=n.parent.params.canvas:n.params&&n.params.canvas&&(o=n.params.canvas);var s="scroll"==o.css("overflow-y")||"auto"==o.css("overflow-y")?o:o.scrollParent();t.bizagi_grid_desktop({columns:e.buildColumnModel(),showSummary:i.showSummary,title:i.displayName,mode:e.getMode(),scrollableArea:s,floatingHeader:i.floatingHeader||!1,hasExclusiveCheck:i.hasExclusiveCheck||!1,tableCssClass:"",sortBy:i.sortBy||"",collapse:"execution"===r,collapseState:"execution"===r&&e.collapseState,buttonsPst:"execution"===r&&i.buttonsPst,sortOrder:i.sortOrder||"",smartPagination:!0,sortType:bizagi.override.gridDefaultSortBy||"asc",isSortable:i.isSortable,headerStyles:e.getHeaderStyles(),orientation:i.orientation||"ltr",template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),gridRtl:e.renderFactory.getTemplate("bizagi.grid.grid.rtl"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),rowButtonsRtl:e.renderFactory.getTemplate("bizagi.grid.row.buttons.rtl"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:a,buttons:e.renderFactory.getTemplate("bizagi.grid.buttons"),buttonsRtl:e.renderFactory.getTemplate("bizagi.grid.buttons.rtl"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),summary:e.renderFactory.getTemplate("bizagi.grid.summary"),summaryCell:e.renderFactory.getTemplate("bizagi.grid.summaryCell"),exportOptions:e.renderFactory.getTemplate("bizagi.grid.exportOptions")},actions:{add:i.allowAdd,edit:i.allowEdit&&i.withEditForm&&null!=i.data,remove:i.allowDelete,details:i.allowDetail,inlineAdd:i.inlineAdd,allowMore:i.allowMore,enableXlsExport:i.enableXlsExport,enablePdfExport:i.enablePdfExport},tooltips:{addLabel:i.addLabel,editLabel:i.editLabel,deleteLabel:i.deleteLabel,detailLabel:i.detailLabel,exportOptionsLabel:i.exportOptionsLabel},isValid:function(){var t=[],i=e.getFormContainer();if(void 0!==i.validationController&&i.validationController.clearValidationMessages(),e.isValid(t),t.length>0){for(var r=0;r<t.length;r++)i.validationController.showValidationMessage(t[r].message,t[r].xpath);return!1}return!0},pageRequested:function(t){if("execution"===r){var i=e.changes&&Object.keys(e.changes).length>=1||e.exclusiveChanges&&Object.keys(e.exclusiveChanges).length>=1;!e.isSummaryOrGlobalForm()&&i?$.when(e.getFormContainer().saveForm()).done((function(){e.sortRequestedPage(t)})):e.sortRequestedPage(t)}},sortRequested:function(t){if("execution"==r&&void 0!==t.sortBy){var i,a=e.getColumn(t.sortBy);a?i=a.getSortName():(a=e.getColumn(t.sortBy.split(".")[0]))&&(i=a.getSortName()),t.sortBy.split(".").length>1&&t.sortBy.split(".")[0]==i&&(i=t.sortBy),e.fetchData(t.page,i,t.sortType)}},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){"execution"==r&&e.triggerHandler("rowSelected",{id:t.key})},addRow:function(){"execution"==r&&e.addRow.apply(e,arguments)},editRow:function(t){"execution"==r&&e.properties.withEditForm&&e.editRow(t.key)},deleteRow:function(t){"execution"==r&&e.deleteRow(t.key)},moreRows:function(t){"execution"==r&&e.moreRows(t)},saveAddedRows:function(t){$.when(e.saveInlineAddedRows(t.keys)).done((function(){e.properties.inlineEdit?$.when(e.saveRows()).done((function(){e.refresh(),e.properties.canBeExported=!0})):e.refresh()}))},beforeInlineAdd:function(){e.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(){e.inlineAddDeferred&&(e.inlineAddDeferred.resolve(),e.properties.canBeExported=!$("li[data-action='save']",e.grid).is(":visible"))},showFormDetails:function(t){e.showFormDetails(t.key)},cancelEdition:function(t){t.refresh=!0,e.removeNewRecords(t)},removeNewRecords:function(t){e.removeNewRecords(t)},showGridExportOptions:function(){e.showGridExportOptions()},performExportGrid:function(t){e.performExportGrid(t)},performCollapseGrid:function(){e.performCollapseGrid()},rowdblclick:function(t){"execution"==r&&e.canEditRow()&&e.editRow(t.businessKey)}})},triggerGridPluginHandler:function(){try{var e=Array.prototype.slice.call(arguments,0);return this.grid.bizagi_grid_desktop.apply(this.grid,e)}catch(e){}},postRenderReadOnly:function(){this.postRender()},buildColumnModel:function(){var e=this.columns,t=[];return t.push({name:"id",index:0,label:"id",hidden:!0,key:!0,tooltip:""}),$.each(e,(function(e,i){i.columnIndex=e+1;var r=bizagi.util.normalizeType(i.properties.type),a=bizagi.util.isEmpty(i.properties.displayName)?" ":i.properties.displayName,n={name:i.properties.xpath,index:e+1,label:a,key:!1,tooltip:i.properties.tooltip||"",hidden:!i.properties.visible||/columnHidden/i.test(r)||0==i.properties.columnVisible,summarizeBy:i.properties.totalize&&i.properties.totalize.operation?i.properties.totalize.operation:void 0,bizAgiProperties:i.properties};t.push(n)})),t},refresh:function(){this.parent&&this.parent.properties&&this.parent.properties.searchParams&&this.parent.properties.searchParams.searchTriggeredBy?this.fetchData(1):this.fetchData()},dataReady:function(){return null!=this.dataReadyDeferred?this.dataReadyDeferred.promise():null},loadChanges:function(e){for(var t=0;t<e.length;t++){var i=this.changes[e[t][0]];if(this.exclusiveChanges&&(i=$.extend(i||{},this.getExclusiveChangeByRow(e[t][0]))),void 0!==i)for(var r in i)if(i.hasOwnProperty(r)){var a=this.getColumn(r);e[t][a.columnIndex]=this.mapChangeValue(a.properties.type,i[r],a.comboData)}}},mapChangeValue:function(e,t,i){i=i||[];var r=t;if(null!=t&&("columnCombo"==e||"columnRadio"==e)&&!bizagi.util.isArray(t)){var a=i.find((function(e){return e.id==t}));a&&(r=[[a.id,a.value]])}return r},updateData:function(e){var t=this.grid,i=this.columns;e&&(this.properties.data=e,this.setCellOverrides(e,i),this.triggerGridPluginHandler("setData",e),this.applyColumnsWidthUpdate(t,i),this.processLayout(isLabelFormat,this.properties.textFormat||{}),this.processLayout(!isLabelFormat,this.properties.valueFormat||{}))},fetchData:function(e,t,i){var r=this,a=r.properties;r.dataReadyDeferred=new $.Deferred,r.sortBy=t,r.sortType=i,e=e||a.page||1,t=t||a.sortBy||"",i=i||a.sortOrder||"asc",a.page=e,a.sortBy=t,a.sortType=i,a.sort=t+" "+i,r.startLoading(),$.when(r.getRemoteData()).then((function(e){r.endLoading(),r.disposed||e&&(a.hideActionsColumn||(r.isRTLDirection?r.spliceRowData(e):(r.spliceRowData(e,1),r.spliceRowDataVisible(e,1),r.spliceRowDataEditable(e,1))),r.isRTL()&&(e.rows=r.removeRemainingColumns(e.rows,r.columns.length),e.rows=r.changeOrderData(e.rows)),r.loadChanges(e.rows),r.updateData(e),!1===r.properties.changed&&"delete"!==r.properties.method||(r.triggerRenderChange({changed:!1}),delete r.properties.changed,delete r.properties.method),r.properties.textFormat&&void 0!==r.properties.textFormat.color&&$(".bz-rn-grid-header-title, .bz-rn-grid-header-title-rtl",r.grid).style("color",r.properties.textFormat.color,"important"),r.properties.textFormat&&void 0!==r.properties.textFormat.background&&($(".bz-rn-grid-cn-header, .bz-rn-grid-cn-header-rtl",r.grid).css("backgroundColor",r.properties.textFormat.background),$(".bz-rn-grid-container-foother, .bz-rn-grid-container-foother-rtl",r.grid).css("backgroundColor",r.properties.textFormat.background)),$("th",r.grid).css("fontWeight","400"),r.dataReadyDeferred.resolve())})).fail((function(e){r.endLoading()}))},isReadyToSave:function(){var e=this;if(e.grid&&e.properties.inlineAdd&&(e.properties.allowEdit||this.hasNewRecordsToSave())){var t=[],i=e.triggerGridPluginHandler("getNewRowKeys"),r=e.getFormContainer();if(i&&i.length>0&&e.isValid(t))return e.properties.alreadySaved=!0,e.saveInlineAddedRows(i).then((function(){e.refresh()}));if(t.length>0){var a=$.Deferred();return t.forEach((function(e,t){r.validationController.showValidationMessage(e.message,e.xpath)})),a.reject("error"),a.promise()}}return null},collectData:function(e){var t,i,r=this,a=r.getFormContainer(),n=a?a.getLastActionButton():{},o=n&&"next"===n.action,s=[];if(r.grid&&(r.properties.inlineAdd||r.properties.inlineEdit)){try{i=(i=r.triggerGridPluginHandler("getNewRowKeys"))||[]}catch(e){i=[]}if(i&&i.length>0&&o&&(r.properties.alreadySaved=!1,!r.isValid(s)))return e;i&&i.length>0&&!r.properties.alreadySaved&&r.isValid(s)&&(t=r.saveInlineAddedRows(i).then((function(){r.refresh()})),e.deferreds=e.deferreds||[],e.deferreds.push(t)),i&&i.length>0&&!r.isValid(s)&&t&&r.cleanNewRecords();for(var l=0;l<i.length;l++)r.changes[i[l]]&&delete r.changes[i[l]]}r._super(e)},sortRequestedPage:function(e){var t,i=this.getColumn(e.sortBy);i?t=i.getSortName():(i=this.getColumn(e.sortBy.split(".")[0]))&&(t=i.getSortName()),e.sortBy.split(".").length>1&&e.sortBy.split(".")[0]==t&&(t=e.sortBy),this.fetchData(e.page,t,e.sortType)},drawCell:function(e,t,i,r){if(e.key)return i;var a=this.getCellOverride(t,e.index-1),n=e.index-1,o=this.columns[n];this.newRecords=this.newRecords||{},this.cellMetadata[t]||(this.cellMetadata[t]={}),this.cellMetadata[t][n]||(this.cellMetadata[t][n]={});var s=this.cellMetadata[t][n].properties||o.properties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;return l=a.visible,d=!!s.editable&&a.editable,r&&"columnFormLink"!==e.bizAgiProperties.type&&(d=!0),o.properties.displayType="value","columnActions"===e.bizAgiProperties.type&&(d=!0),"summary"==t&&(d=!1),l?d?this.drawEditableCell(o,s,t,i,r):this.drawReadonlyCell(o,s,t,i):(this.drawReadonlyCell(o,s,t,i),"<label></label>")},drawEditableCell:function(e,t,i,r,a){var n=this,o=new $.Deferred,s=e.properties.editable;return e.properties.editable=!0,e.overrideProperties({required:t.required}),$.when(e.render(i,r)).done((function(t){a&&!n.newRecords[i]&&(n.newRecords[i]={});for(var r=0;r<n.columns.length;r++)n.cellOverrides[i]=n.cellOverrides[i]||{},n.getCellOverride(i,r).visible=null==n.getCellOverride(i,r).visible||n.getCellOverride(i,r).visible;e.getDecorated(i).unbind("renderchange.draweditable").bind("renderchange.draweditable",(function(r,a){n.onCellChange(e,t,i,a)})),o.resolve(t)})),e.properties.editable=s,o.promise()},drawReadonlyCell:function(e,t,i,r){var a="";if("summary"===i){var n=e.properties.textFormat;e.properties.totalize&&(e.properties.textFormat=e.properties.totalize.format),a=e.renderSummary(i,r),e.properties.textFormat=n}else a=e.renderReadOnly(i,r);return a},onCellChange:function(e,t,i,r){var a,n=this,o=e.getValue(i),s=e.getCompositeValue(i),l=n.triggerGridPluginHandler("isNewRecord",i),d=!l,c=e.properties.type;try{if("columnDate"==c&&1==e.data.properties.showTime)if(bizagi.util.isEmpty(o))""===o&&(o="");else{var u=bizagi.util.dateFormatter.getDateFromInvariant(o,!0);o=bizagi.util.dateFormatter.formatInvariant(u,!0)}else if("columnDate"==c)if(bizagi.util.isEmpty(o))""===o&&(o="");else(u=bizagi.util.dateFormatter.getDateFromInvariant(o,!1)).setHours(0,0,0,0),o=bizagi.util.dateFormatter.formatInvariant(u,!0);else if("columnSearch"===c){var p=!1;if(n.properties.submitOnChange&&(p=e.properties.advancedSearch||!1),l&&n.properties.inlineAdd&&p){n.collectGridChange($.extend(r,{id:i,xpath:e.properties.xpath||e.properties.id,value:o,compositeValue:s,columnIndex:e.columnIndex,trigger:d,dataType:c,renderId:e.properties.id}));try{a=n.triggerGridPluginHandler("getNewRowKeys")}catch(e){a=[]}r.render.startActionExecution();for(var g=n.saveInlineAddedRows(a),h=0;h<a.length;h++)n.changes[a[h]]&&delete n.changes[a[h]];return void $.when(g).done((function(){bizagi.util.isEmpty(n.changes)?n.refresh():$.when(n.saveRows()).done((function(){n.refresh()})),r.render.endActionExecution()}))}}var m="columnBoolean"===c&&e.properties.isExclusive;m||!n.properties.allowEdit&&!l||n.collectGridChange($.extend(r,{id:i,xpath:e.properties.xpath||e.properties.id,value:o,compositeValue:s,columnIndex:e.columnIndex,trigger:d,dataType:c,renderId:e.properties.id})),m&&n.properties.allowEdit&&n.triggerGridPluginHandler("deleteCellExclusiveValues",e.columnIndex),n.triggerGridPluginHandler("changeCellValue",i,e.columnIndex,o),e.properties.totalize&&e.properties.totalize.operation&&n.triggerGridPluginHandler("refreshSummary",e.columnIndex)}catch(e){bizagi.log(e.message)}},onCellReady:function(e,t,i,r){var a=e.index-1,n=this.getCellOverride(t,a),o=this.columns[a],s=this.cellMetadata[t][a].properties||o.properties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;if(l=n.visible,e.bizAgiProperties.columnwidth&&(/boolean/i.test(e.bizAgiProperties.type)?$(i).css({"min-width":e.bizAgiProperties.columnwidth,width:e.bizAgiProperties.columnwidth}):$(i).css({"min-width":e.bizAgiProperties.columnwidth,"max-width":e.bizAgiProperties.columnwidth})),"summary"==t&&(d=!1),r&&(d=!0),"columnActions"===e.bizAgiProperties.type&&(d=!0),l)if(d){var c=o.properties.editable;if(o.properties.editable=d,o.properties.submitOnChange){var u=o.getDecorated(t);u&&(u.properties.submitOnChangexpathContext=this.properties.xpath+"[]",u.properties.submitOnChangexpathContextRow=this.properties.xpath+"[id="+t+"]")}o.postRender(t,i),o.properties.editable=c}else"summary"==t?o.postRenderSummary(t,i)||this.applySummaryColumnStyles(i,s):o.postRenderReadOnly(t,i)},getAlignClass:function(e){switch(e){case"right":return"ui-bizagi-grid-align-right";case"left":return"ui-bizagi-grid-align-left";case"center":return"ui-bizagi-grid-align-center";case"justify":return"ui-bizagi-grid-align-justify"}},addRow:function(e){var t=this,i=t.properties,r="rtl"==i.orientation,a=[];if(e){if(e.open)return;e.open=!0}$.when(t.submitAddRequest()).done((function(n){var o=new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:i.addLabel,orientation:i.orientation||"ltr",maximized:bizagi.override.maximizeGridPopup||!1,onSave:function(e){return i.contextType&&(e[t.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=i.contextType),t.submitSaveRequest(n,e)},onCancel:function(){}});a[0]={text:bizagi.localization.getResource("render-form-dialog-box-save"),click:function(e){return i.contextType&&(e[t.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=i.contextType),t.submitSaveRequest(n,e)}},a[1]={text:bizagi.localization.getResource("render-form-dialog-box-cancel"),click:function(){t.submitRollbackRequest()}},r&&a.reverse();var s=i.xpath+"[id="+n+"]";o.render({idRender:i.id,recordXPath:s,xpathContext:i.xpathContext,idPageCache:i.idPageCache,requestedForm:"addForm",contextType:i.contextType,url:i.addPage,fromRender:t,mainForm:t.getMainForm(t.getFormContainer())}).done((function(e){t.addExclusiveChange(n,e),t.startLoading(),i.submitOnChange?t.submitOnChange().always((function(){t.endLoading()})):t.fetchData()})).fail((function(i){e.open=!1,$.when(t.submitRollbackRequest(i)).done((function(){t.submitInvalidatePageCacheRequest(i)}))}))}))},canEditRow:function(){var e=this.properties;return e.allowEdit&&e.withEditForm&&null!=e.data},editRow:function(e){if(0!=e&&null!=e){var t=this,i=t.properties;if(void 0!==t.changes[e]||t.exclusiveChanges&&Object.keys(t.exclusiveChanges).length>=1){var r=$.extend(t.changes[e],{});r.idPageCache=i.idPageCache,r.disableServerGridValidations=!0,$(".ui-tooltip").remove(),$.when(t.submitSaveRequest(e,r)).done((function(){t.startLoading(),i.submitOnChange?t.submitForGridChange().always((function(){t.endLoading(),t.executeSubmitEditRequest(e,(function(i){t.addExclusiveChange(e,i)}))})):t.fetchData()}))}else t.executeSubmitEditRequest(e,(function(i){t.addExclusiveChange(e,i)}))}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},getHeaderStyles:function(){var e="",t="",i=this.properties;if(i.headerFormat){var r=i.headerFormat;if(r.color&&(e+="color: "+r.color+" !important;"),r.background&&(t+="background-color: "+r.background+";"),e+="font-weight: "+(r.bold?"bold; ":"normal; "),r.italic&&(e+="font-style: italic; "),r.underline||r.strikethru)e+="text-decoration: "+(bizagi.util.parseBoolean(r.strikethru)?"line-through ":"")+(bizagi.util.parseBoolean(r.underline)?"underline ":"")+";";if(r.size&&"0"!=r.size)e+="font-size: "+(100+10*Number(r.size)+"%")+";"}return{label:e,header:t}},editInlineRow:function(e){var t=this.getControl();if(0!=e&&null!=e){var i=$("[data-bizagi-component=buttons]",t);i.find("[data-action=save]").css("display","inline-block"),i.find("[data-action=cancel]").css("display","inline-block"),this.changeRowEditable(e,!0)}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},changeRowEditable:function(e,t){},changeCellBackgroundColor:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeCellBackgroundColor(i)}else r.pendingActions.push({method:r.changeCellBackgroundColor,arguments:arguments})},changeCellColor:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeColor(i)}else r.pendingActions.push({method:r.changeCellColor,arguments:arguments})},changeCellVisibility:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a){a.changeCellVisibility(i);var n=(r.columns||[]).findIndex((function(e){return r.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0,o=r.getColumn(t),s=o&&o.properties.columnVisible&&i;r.cellOverrides[e]=r.cellOverrides[e]||{},r.getCellOverride(e,n).visible=s}}else r.pendingActions.push({method:r.changeCellVisibility,arguments:arguments})},changeCellEditability:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a&&a.control){a.changeEditabilityCellControl(i,e,t);var n=(r.columns||[]).findIndex((function(e){return r.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0;r.cellOverrides[e]=r.cellOverrides[e]||{},r.getCellOverride(e,n).editable=i}}else r.pendingActions.push({method:r.changeEditability,arguments:arguments})},changeColumnEditability:function(e,t){var i=this;if(i.initialLoadDone){var r=i.getColumn(e);r&&(r.properties.editable="Default"===t?i.originalProperties.editable:bizagi.util.parseBoolean(t))}else i.pendingActions.push({method:i.changeEditability,arguments:arguments})},changeColumnVisibility:function(e,t){var i=this;if(i.initialLoadDone){var r=i.getColumn(e);r&&(r.properties.visible="Default"===t?i.originalProperties.visible:bizagi.util.parseBoolean(t))}else i.pendingActions.push({method:i.changeCellVisibility,arguments:arguments})},changeColumnRequired:function(e,t){var i=this;if(i.initialLoadDone){var r=i.getColumn(e);r&&(r.properties.required="Default"===t?i.originalProperties.required:bizagi.util.parseBoolean(t))}else i.pendingActions.push({method:i.changeCellRequired,arguments:arguments})},afterToRefresh:function(){var e,t=this,i=Array.prototype.slice.call(arguments);bizagi.override.enableGridRefreshAfterCellRefresh&&i[0]&&bizagi.util.isObject(i[0])&&"refreshCell"==i[0].action&&(e=t.getFormContainer(),$.when(e.getLoaderPromise()).done((function(){e.actionController.refreshControl(t.properties.xpath,e.properties.xpathContext,"refresh")})))},cleanCellData:function(e,t){var i=this;if(i.initialLoadDone){var r=i.getControlCell(e,t);if(r)return $.when(r.cleanData()).then((function(){for(var r=(i.columns||[]).findIndex((function(e){return i.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0,a=i.properties.data.rows,n=0,o=a.length;n<o;n++)if(Number(e)===a[n][0]){a[n][r+1]="";break}i.cellOverrides[e]=i.cellOverrides[e]||{},i.getCellOverride(e,r).value=null}))}else i.pendingActions.push({method:i.cleanData,arguments:""})},changeCellRequired:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a){a.changeCellRequired(i);var n=(r.columns||[]).findIndex((function(e){return r.isCurrentGridCell(e.properties.xpath,e.properties.id,t)}))||0;r.cellOverrides[e]=r.cellOverrides[e]||{},r.getCellOverride(e,n).required=i}}else r.pendingActions.push({method:r.changeCellRequired,arguments:arguments})},changeCellValue:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);if(a){a.setDisplayValue(i);var n=a.column||{},o=n.properties&&n.properties.type,s=r.getCellValueFormatted(n,n.getValue(e));a.triggerHandler("renderchange",{render:r,changed:!0}),r.collectGridChange({id:e,xpath:n.properties.xpath,value:s,compositeValue:n.getCompositeValue(e),columnIndex:a.columnIndex,trigger:!1,dataType:o,renderId:n.properties.id})}}else r.pendingActions.push({method:r.setDisplayValue,arguments:arguments})},changeCellMaxValue:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeMaxValue(i)}else r.pendingActions.push({method:r.changeMaxValue,arguments:arguments})},changeCellMinValue:function(e,t,i){var r=this;if(r.initialLoadDone){var a=r.getControlCell(e,t);a&&a.changeMinValue(i)}else r.pendingActions.push({method:r.changeMinValue,arguments:arguments})},deleteRow:function(e){var t=this;e&&0!=e?bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){t.startLoading(),$.when(t.saveRows()).then((function(){return $.when(t.submitDeleteRequest(e)).then((function(i){if(t.removeNewRecords({keys:[e]}),"success"==i.type)for(var r in t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e}),t.enabledChecks){var a=t.enabledChecks[r],n=a.findIndex((function(t){return t.id==e}));a.splice(n,1)}t.properties.changed=!1,t.properties.method="delete",t.calculateFetchData(i,e)}))})).always((function(){t.endLoading()}))})):bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},calculateFetchData:function(e,t){var i,r=this.properties;return"success"===e.type&&1===(i=r.data&&r.data.rows).length&&i[0][0]===Number(t)&&r.page>1?this.fetchData(r.page-1):this.fetchData()},saveRows:function(){var e={},t=this.getFormContainer();return this.collectData(e),$.isEmptyObject(e)?void 0:this.dataService.submitData({action:"SUBMITDATA",data:e,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache})},moreRows:function(e){var t=this,i=t.properties;void 0===i.originalrowsPerPage&&(i.originalrowsPerPage=i.rowsPerPage),i.rowsPerPage+=i.originalrowsPerPage;var r={};t.collectData(r),jQuery.isEmptyObject(r)?t.moreRowsCommon(e):t.dataService.submitData({action:"SUBMITDATA",data:r,idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,idPageCache:i.idPageCache}).done((function(){t.moreRowsCommon(e)}))},moreRowsCommon:function(e){var t=this,i=t.properties;t.fetchData(e.page,e.sortBy,e.sortType),$.when(t.dataReadyDeferred).done((function(){0!=i.records&&i.records+1<=i.rowsPerPage&&$(".ui-bizagi-grid-dynamic-pager",t.getControl()).hide()}))},executeSubmitEditRequest:function(e,t){var i=this,r=i.properties,a="rtl"==r.orientation,n=[],o=1!=i.getFormContainer().properties.displayAsReadOnly;$.when(i.submitEditRequest(e)).done((function(){var s=r.xpath+"[id="+e+"]",l=new bizagi.rendering.dialog.form(i.dataService,i.renderFactory,{title:r.editLabel,showSaveButton:o,orientation:r.orientation||"ltr",maximized:bizagi.override.maximizeGridPopup||!1,onSave:function(t){return i.submitSaveRequest(e,t)},extraButtons:bizagi.override.enablePrintFromEditForm?{"workportal-widget-dialog-box-print":function(){i.printFormCommand=new bizagi.workportal.command.printform(i.renderFactory);var e={idRender:r.id,recordXPath:s,xpathContext:r.xpathContext,idPageCache:r.idPageCache,requestedForm:"editForm",contextType:r.contextType,fileName:r.displayName};i.printFormCommand.print(e)}}:{}});n[0]={text:bizagi.localization.getResource("render-form-dialog-box-save"),click:function(t){return i.submitSaveRequest(e,t)}},a&&n.reverse(),l.render({idRender:r.id,recordXPath:s,xpathContext:r.xpathContext,idPageCache:r.idPageCache,requestedForm:"editForm",url:r.editPage,contextType:r.contextType}).done((function(e){t&&t(e),i.startLoading(),r.submitOnChange?i.submitOnChange().always((function(){i.endLoading()})):i.fetchData()})).fail((function(e){$.when(i.submitRollbackRequest(e)).done((function(){i.submitInvalidatePageCacheRequest(e)}))}))}))},showFormDetails:function(e){var t=this.properties;if(0!=e&&null!=e){var i=new bizagi.rendering.dialog.form(this.dataService,this.renderFactory,{title:t.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!1,maximized:bizagi.override.maximizeGridPopup||!1,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close")}),r=t.xpath+"[id="+e+"]";i.render({idRender:t.id,recordXPath:r,xpathContext:t.xpathContext,idPageCache:t.idPageCache,requestedForm:"detailForm",url:t.editPage,editable:!1})}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},saveInlineAddedRows:function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.prepareAddAction(e[i]));this.properties.alreadySaved=!0;var r=this.getFormContainer(),a=new $.Deferred;return r.useOrSetLoaderDeferred(),r.appendWaitForLoader({promise:a.promise()}),$.when.apply($,t).always((function(){a.resolve()}))},prepareAddAction:function(e){var t=this,i=t.properties,r=t.changes[e];return t.dataService.multiaction().addGridRecordData({url:i.addUrl,idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,contexttype:i.contexttype,idPageCache:i.idPageCache,submitData:r}).then((function(i){return delete t.changes[e],delete t.cellOverrides[e],delete t.newRecords[e],t.setRowAsSaved(e),i}))},removeNewRecords:function(e){var t=this,i=!1;e&&e.refresh&&(i=t.changes&&Object.keys(t.changes).length>0&&!t.isValid([])),e&&e.keys&&$.each(e.keys,(function(e,i){t.newRecords[i]&&delete t.newRecords[i]})),i&&(t.properties.changed=!1,t.refresh())},showGridExportOptions:function(){var e,t=this.getControl(),i=[],r=this.getFormContainer(),a=!0===this.properties.buttonsPst?"top":"bottom",n="rtl"===this.properties.orientation,o=n?".ui-bizagi-grid-export-options-wrapper-rtl":".ui-bizagi-grid-export-options-wrapper",s=n?".ui-bizagi-grid-export-options-content-rtl":".ui-bizagi-grid-export-options-content";if(e=!0===this.properties.buttonsPst?$(o,t).outerHeight():-1*$(s,t).outerHeight(),$(s,t).css(a,e),$(s,t).hasClass("hidden")?($(s,t).removeClass("hidden"),$(s,t).show()):$(s,t).addClass("hidden"),r)if(this.hasChanged(i)&&!1===this.properties.alreadySaved&&r.properties.editable||!1===this.properties.canBeExported&&r.properties.editable){var l=$("li[data-action='save']",this.grid).is(":visible");!this.hasChanged(i)&&!1===this.properties.alreadySaved&&!l||this.canBeExport()?this.properties.canBeExported=!0:1===Object.keys(this.changes).length&&this.changes.summary||($("#print-grid-save-first",t).show(),$("#print-grid-pdf",t).hide(),$("#print-grid-xls",t).hide())}else this.properties.canBeExported=!0},performCollapseGrid:function(){var e=this.getControl(),t="rtl"===this.properties.orientation,i=t?".bz-rn-grid-cn-header-rtl":".bz-rn-grid-cn-header",r=$(".bz-rn-grid-wrapper",e),a=$(i+" .ui-icon",e);t||$(".bz-rn-grid-cn-header",e).toggleClass("bz-rn-grid-header-state-collapsed").toggleClass("bz-rn-grid-header-state-active");a.toggleClass("ui-state-collapse").toggleClass("ui-state-expand"),r.toggleClass("bz-rn-grid-body-collapse"),this.collapseState=r.hasClass("bz-rn-grid-body-collapse"),this.triggerGridPluginHandler("updateCollapseState",this.collapseState),this.updateCollapseState()},updateCollapseState:function(){var e=this.properties,t={url:e.dataUrl,xpath:e.xpath,idRender:e.id,xpathContext:e.xpathContext,contexttype:e.contextType,idPageCache:e.idPageCache,collapseState:this.collapseState};return this.dataService.multiaction().getCollapseData(t)},performExportGrid:function(e){var t=this,i=!0;if("pdfExport"===e.exportType){var r=t.checkAdobePlugin();$.browser.msie&&!r&&(i=!1,$.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-acrobat-message"))).done((function(){t.downloadExportedGrid(e)})))}i&&t.downloadExportedGrid(e)},updateAffectedCellManually:function(e,t,i){this.columns.length;var r=this.getRowIndexByKey(e);if(void 0!==r&&this.properties.data.rows[r][i]!==t){this.properties.data.rows[r][i]=t;var a=$(".ui-bizagi-grid-summary",this.grid);a.empty(),a.html(this.grid.bizagi_grid_desktop("drawSummary")),this.grid.bizagi_grid_desktop("postRenderSummary",a)}},getRowIndexByKey:function(e){for(var t=this.properties.data.rows.length;t-- >0;)if(e==this.properties.data.rows[t][0])return t},checkAdobePlugin:function(){var e;try{e=new ActiveXObject("AcroPDF.PDF")}catch(e){bizagi.log(e)}if(!e)try{e=new ActiveXObject("PDF.PdfCtrl")}catch(e){bizagi.log(e)}return e},downloadExportedGrid:function(e){var t=this;t.getGridExportFile(e).then((function(i){var r=t.properties.displayName;r+="xlsExport"===e.exportType?".xlsx":".pdf",bizagi.util.downloadBlobFile(i,r)})).fail((function(e){var i=t.getFormContainer();i&&i.failHandler(e)}))},formatGrid:function(e){var t=$(".ui-bizagi-grid-table",e),i=$(".ui-jqgrid-titlebar-close",e);$("th.ui-bizagi-column-hidden, td.ui-bizagi-grid-key, .bz-rn-grid-container-foother",e).remove(),$("[data-action], ul li, .ui-bizagi-grid-column, tr, th",t).unbind("click"),$(i).remove()},ready:function(){var e=this._super(),t=this.inlineAddDeferred?this.inlineAddDeferred.promise():null;return $.when(e,t)},applyColumnsWidth:function(e,t){for(var i=0;i<t.length;i++){var r=e.find(".resizableColumn")[i];if(r){var a=1==$(r).find(">.ui-bizagi-grid-column").length?Number($(r).find(">.ui-bizagi-grid-column").data("column-index")):i,n=t[a].bizAgiProperties.columnwidth,o="auto";t[a].bizAgiProperties&&n&&"auto"!=n&&(o=n),$(r).css("width",o),$(r).find(".ui-bizagi-grid-column").css("width","auto")}}},applyColumnsWidthUpdate:function(e,t){for(var i=null,r=null,a=null,n=null,o=e.find(".resizableColumn"),s=o.length,l=0;l<s;l++)r=o[l],a=t[i=1==$(r).find(">.ui-bizagi-grid-column").length?Number($(r).find(">.ui-bizagi-grid-column").data("column-index"))-1:l].properties.columnwidth,n="auto",t[i].properties&&a&&"auto"!=a&&(n=a),$(r).css("width",n),$(r).find(".ui-bizagi-grid-column").css("width","auto")},applySummaryColumnStyles:function(e,t){var i=e.find(".ui-bizagi-grid-summary-readonly");if(null!=t.totalize&&null!=t.totalize.format){var r=t.totalize.format,a="";if(r.background&&(e.css("background-color",r.background),e.css("background-image","none")),r.size&&"0"!=r.size){var n=r.size.toString(),o=n.substring(0,1),s=n.substring(1,n.length);s="+"==o?100+10*Number(s):100-10*Number(s),i.css("font-size",s+"%")}r.italic&&i.css("font-style","italic"),r.color&&$("label",i).css("color",r.color),r.underline&&(a+="underline "),r.strikethru&&(a+="line-through"),1!=r.bold&&null!=r.bold||i.css("font-weight","bold"),i.css("text-decoration",a)}},getContainerIcons:function(){return $("> .ui-bizagi-control > .ui-bizagi-control-wrapper > .ui-bizagi-render-icons",this.element)},changeColor:function(e,t){var i=this,r=i.getControl(),a=i.getLabel();t=void 0===t&&null==t||t;if(r&&a)if("none"!=e)if("value"!==i.properties.displayType&&t){if(i.element.each((function(){this.style.setProperty("color",e,"important")})),i.getControl().find("[data-bizagi-component=header] span").each((function(){this.style.setProperty("color",e,"important")})),i.getLabel().find("label").css("color",e,"!important"),!i.properties.editable){var n=i.getControl();i.getElementsToStylize(n).css("color",e,"!important"),bizagi.override&&!0===bizagi.override.enableColorHeaderGrid&&i.hasColorHeader()&&(n=n.find("[data-bizagi-component=rows]")),i.getElementsToStylize($("label",n).css("color",e,"!important"))}}else i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getControl().find("*").each((function(t,r){i.getElementsToStylize(r).css("color",e,"!important")}));else this._super(e,t)},hasNewRecordsToSave:function(){var e;try{e=this.triggerGridPluginHandler("getNewRowKeys")}catch(t){e=[]}return e&&e.length>0&&!this.properties.alreadySaved},getCellValueFormatted:function(e,t){var i=t;if("columnDate"===e.properties.type){var r=e.data.properties;if(bizagi.util.isEmpty(i))""===t&&(i="");else{var a=bizagi.util.dateFormatter.getDateFromInvariant(i,r.showTime);void 0!==a&&0!==a&&(r.showTime||a.setHours(0,0,0,0),i=bizagi.util.dateFormatter.formatInvariant(a,!0))}}return i},addExclusiveChange:function(e,t){if(this.properties.hasExclusiveCheck)for(var i in t){var r=this.columns.find((function(e){return e.properties.xpath==i})),a=t[i];r&&r.properties.isExclusive&&a&&(this.exclusiveChanges[i]={xpath:i,simpleXpath:i,value:a,key:e})}}}),bizagi.rendering.desktop.grid.bizagi.extend("bizagi.rendering.desktop.grid.grouped",{},{initializeData:function(e){e.properties.hideActionsColumn=!0,e.properties=this.convertProperties(e.properties),e.properties.singleInstance=!1,this._super(e),this.cellMetadata={},this.pendingActions=[];var t=this.properties;t.withEditForm=t.allowEdit,this.collapseState=t.collapseState,t.displayType="vertical",t.labelAlign="left"},drawCell:function(e,t,i,r){if(e.key)return i;var a=this.getCellOverride(t,e.index-1),n=e.index-1,o=this.columns[n];this.newRecords=this.newRecords||{},this.cellMetadata[t]||(this.cellMetadata[t]={}),this.cellMetadata[t][n]||(this.cellMetadata[t][n]={});var s=this.cellMetadata[t][n].properties||o.originalProperties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;return l=a.visible,d=!!s.editable&&a.editable,r&&(d=!0),o.properties.displayType="value","string"==typeof t&&t.indexOf("summary")>=0&&(d=!1),l?d?this.drawEditableCell(o,s,t,i,r):this.drawReadonlyCell(o,s,t,i):"<label></label>"},drawReadonlyCell:function(e,t,i,r){var a="";if("string"==typeof i&&i.indexOf("summary")>=0){var n=e.properties.textFormat;e.properties.totalize&&(e.properties.textFormat=e.properties.totalize.format),a=e.renderSummary(i,r),e.properties.textFormat=n}else a=e.renderReadOnly(i,r);return a},onCellReady:function(e,t,i,r){var a=e.index-1,n=this.columns[a],o=this.cellMetadata[t][a].properties||n.originalProperties,s=void 0===o.visible||o.visible,l=void 0===o.editable||o.editable;if("string"==typeof t&&t.indexOf("summary")>=0&&(l=!1),r&&(l=!0),s)if(l){var d=n.properties.editable;if(n.properties.editable=l,n.properties.submitOnChange){var c=n.getDecorated(t);c&&(c.properties.submitOnChangexpathContext=this.properties.xpath+"[]")}n.postRender(t,i),n.properties.editable=d}else"string"==typeof t&&t.indexOf("summary")>=0?n.postRenderSummary(t,i)||this.applySummaryColumnStyles(i,o):n.postRenderReadOnly(t,i)},convertProperties:function(e){return e.inlineAdd=!1,e.inlineEdit=!1,e},changeFontBold:function(){return this},applyGridPlugin:function(){var e=this,t=e.grid,i=e.properties,r=e.getMode(),a=e.renderFactory.getTemplate("bizagi.grid.pagination"),n=e.getFormContainer().params.canvas.scrollParent();t.bizagi_grid_grouped_desktop({columns:e.buildColumnModel(),showSummary:i.showSummary,title:i.displayName,mode:e.getMode(),scrollableArea:n,floatingHeader:i.floatingHeader||!1,tableCssClass:"",sortBy:i.sortBy||"",sortOrder:i.sortOrder||"",isSortable:i.isSortable,smartPagination:!0,collapse:"execution"===r,collapseState:"execution"===r&&e.collapseState,buttonsPst:"execution"===r&&i.buttonsPst,sortType:bizagi.override.gridDefaultSortBy||"asc",headerStyles:e.getHeaderStyles(),groupByColumns:e.groupByColumns()||[],template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.grouped.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.grouped.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.grouped.row"),headerRow:e.renderFactory.getTemplate("bizagi.grid.grouped.header.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),emptyCell:e.renderFactory.getTemplate("bizagi.grid.grouped.emptyCell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:a,buttons:e.renderFactory.getTemplate("bizagi.grid.buttons"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),summary:e.renderFactory.getTemplate("bizagi.grid.grouped.summary"),summaryCell:e.renderFactory.getTemplate("bizagi.grid.grouped.summaryCell"),exportOptions:e.renderFactory.getTemplate("bizagi.grid.exportOptions")},actions:{add:i.allowAdd,edit:i.allowEdit&&i.withEditForm&&null!=i.data,remove:i.allowDelete,details:i.allowDetail,inlineAdd:i.inlineAdd,allowMore:i.allowMore,enableXlsExport:i.enableXlsExport,enablePdfExport:i.enablePdfExport},tooltips:{addLabel:i.addLabel,editLabel:i.editLabel,deleteLabel:i.deleteLabel,detailLabel:i.detailLabel,exportOptionsLabel:i.exportOptionsLabel},isValid:function(){var t=[],i=e.getFormContainer();if(void 0!==i.validationController&&i.validationController.clearValidationMessages(),e.isValid(t),t.length>0){for(var r=0;r<t.length;r++)i.validationController.showValidationMessage(t[r].message,t[r].xpath);return!1}return!0},pageRequested:function(t){if("execution"===r){var i,a=e.getColumn(t.sortBy);a?i=a.getSortName():(a=e.getColumn(t.sortBy.split(".")[0]))&&(i=a.getSortName()),t.sortBy.split(".").length>1&&t.sortBy.split(".")[0]==i&&(i=t.sortBy),e.fetchData(t.page,i,t.sortType)}},sortRequested:function(t){if("execution"===r){var i,a=e.getColumn(t.sortBy);a?i=a.getSortName():(a=e.getColumn(t.sortBy.split(".")[0]))&&(i=a.getSortName()),t.sortBy.split(".").length>1&&t.sortBy.split(".")[0]==i&&(i=t.sortBy),e.fetchData(t.page,i,t.sortType)}},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){"execution"===r&&e.triggerHandler("rowSelected",{id:t.key})},addRow:function(){"execution"===r&&e.addRow.apply(e,arguments)},editRow:function(t){"execution"===r&&e.properties.withEditForm&&e.editRow(t.key)},deleteRow:function(t){"execution"===r&&e.deleteRow(t.key)},moreRows:function(t){"execution"===r&&e.moreRows(t)},saveAddedRows:function(t){e.saveInlineAddedRows(t.keys).done((function(){e.refresh()}))},beforeInlineAdd:function(){e.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(){e.inlineAddDeferred&&e.inlineAddDeferred.resolve()},showFormDetails:function(t){e.showFormDetails(t.key)},cancelEdition:function(t){e.removeNewRecords(t)},removeNewRecords:function(t){e.removeNewRecords(t)},showGridExportOptions:function(){e.showGridExportOptions()},performExportGrid:function(t){e.performExportGrid(t)},performCollapseGrid:function(){e.performCollapseGrid()},rowdblclick:function(t){"execution"==r&&e.canEditRow()&&e.editRow(t.businessKey)}})},groupByColumns:function(){for(var e=[],t=0,i=this.columns.length;t<i;t++){this.columns[t].properties.groupBy&&e.push(t+1)}return e},triggerGridPluginHandler:function(){var e=this,t=Array.prototype.slice.call(arguments,0);return e.grid.bizagi_grid_grouped_desktop.apply(e.grid,t)},fetchData:function(e,t,i){var r=this,a=r.properties;r.dataReadyDeferred=new $.Deferred,e=e||a.page||1,t=t||a.sortBy||"id",i=i||a.sortOrder||"asc",a.page=e,a.sortBy=t,a.sortType=i,a.sort=t+" "+i,r.startLoading(),$.when(r.getRemoteData()).then((function(e){r.endLoading(),r.disposed||e&&(r.loadChanges(e.rows),r.updateData(e),r.triggerRenderChange(),r.dataReadyDeferred.resolve())}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.search",bizagi.rendering.search.prototype),bizagi.rendering.desktop.search.extend("bizagi.rendering.desktop.search",{ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,CLEAR_SEARCH_ID:-3,NO_RESULTS_SEARCH_ID:-4,SEARCH_DELAY:750,SEARCH_MAX_RECORDS:50},{initializeData:function(e){this._super(e);var t=this.properties;t.searchImage=t.searchImage||this.dataService.getSearchDefaultImage(),this.deferredReference=null},postRender:function(){var e=this.getControl();this._super(),this.searchInput=$("input",e),this.advancedSearch=$("button",e),this.properties.advancedSearch&&e.addClass("ui-bizagi-advanced-search"),this.applyAutocompletePlugin()},postRenderReadOnly:function(){this.setDisplayValue(this.properties.value)},configureHandlers:function(){var e=this;e._super();var t=e.searchInput;if(t.bind("autocompleteselect",(function(i,r){if(r.item.id==e.Class.ADVANCED_SEARCH_ID||r.item.id==e.Class.ADVANCED_ADDITION_ID||r.item.id==e.Class.CLEAR_SEARCH_ID||r.item.id==e.Class.NO_RESULTS_SEARCH_ID)return!1;if(e.setValue(r.item),e.selectedValue=r.item.value,r.item.value=e.formatItem(r.item.value),document.selection){t.focus();var a=document.selection.createRange();a.moveStart("character",-e.selectedValue.length),a.moveStart("character",0),a.moveEnd("character",e.selectedValue.length),a.select()}return!0})),e.bind("onSearchError",(function(t,i){var r=e.getFormContainer();r.clearValidationMessages();try{var a=e.properties.displayName+": ";a+=JSON.parse(i.responseText).message,r.addValidationMessage(a,"","ui-icon-alert")}catch(t){r.addValidationMessage(i)}e.hideAutocompleteLoading()})),t.click((function(){t.autocomplete("widget").is(":visible")?t.autocomplete("close"):t.autocomplete("search",$(t).val())})),e.advancedSearch.click((function(){e.showSearchDialog()})),!e.properties.advancedSearch){t.on("blur",(function(t){if(""===this.value&&e.properties.allowClear){var i={id:""};e.setDisplayValue(i),e.setValue(i)}else e.setDisplayValue(e.getValue())}))}},applyAutocompletePlugin:function(){var e=this,t=e.searchInput,i=e.getFormContainer().properties.orientation,r="rtl"==i?"right":"left",a="rtl"==i?" suggest-rtl":"",n="sg-"+e.properties.id;t.autocomplete({autoFocus:!0,messages:{noResults:null,results:function(){}},search:function(e,t){},source:function(t,i){e.activeRequestTerm=t.term;var r=(new Date).getTime(),a=encodeURIComponent(t.term),n=e.properties.xpath+"_"+a+"_expire",o=e.properties.xpath+"_"+a,s=bizagi.util.getItemLocalStorage(n);if(s&&e.properties.enableLocalStorage&&r<s)try{i(JSON.parse(bizagi.util.getItemLocalStorage(o))),e.hideAutocompleteLoading()}catch(r){e.processRequest(t,i)}else e.processRequest(t,i)},open:function(){var i=t.data("ui-autocomplete").menu.element,o=t.closest(".ui-bizagi-control"),s=o.parent(),l=e.calculateSuggestionWidth();$("li",i).each((function(){$(this).addClass(a),$(this).index()%2<1&&$(this).addClass("biz-ui-even")})),i.css({top:0,left:0}),i.attr("id",n),o.addClass("ac-is-visible"),s.addClass("ac-is-visible ac-clear-floats");var d=i.appendTo(o);if(e.isPreferencesDialog(o)){var c=$(o.closest(".ui-dialog-content")),u=d.offset().top-c.offset().top,p=d.offset().left-c.offset().left,g=$("#wrapper-"+n);g&&g.length>0&&g.remove();var h=$("<div/>",{id:"wrapper-"+n,css:{position:"absolute",top:u,left:p}});h.appendTo(c),$(d).appendTo(h)}d.position({my:r+" top",at:r+" bottom",of:this,collision:"flipfit"}),d.css("z-index",$.getMaxZindex()+10),d.attr("visible",!0),$(".ui-bizagi-render-search-item",d).width(l),$(".ui-bizagi-render-search-item-label",d).width(l),d.width(l),e.hideAutocompleteLoading()},close:function(){t.data("ui-autocomplete").menu.element.attr("visible",!1)},delay:this.Class.SEARCH_DELAY}),t.data("ui-autocomplete")._renderItem=function(t,i){return i.id==e.Class.CLEAR_SEARCH_ID?e.renderClearItem(t,i).appendTo(t):i.id==e.Class.ADVANCED_SEARCH_ID?e.renderAdvancedItem(t,i).appendTo(t):i.id==e.Class.ADVANCED_ADDITION_ID?e.renderAddItem(t,i).appendTo(t):e.renderSearchItem(i).appendTo(t)},t.data("ui-autocomplete")._resizeMenu=function(){this.menu.element.outerWidth(this.element.outerWidth())}},renderSearchItem:function(e){var t=this.properties,i=this.renderFactory.getTemplate("searchItem"),r=$.tmpl(i,{image:t.searchImage,label:e.label,orientation:this.properties.orientation||"lrt"});return r.data("item.autocomplete",e),r},renderAdvancedItem:function(){var e=this,t=e.renderSearchItem({id:e.Class.ADVANCED_SEARCH_ID,label:this.getResource("render-search-advanced-label")});return t.click((function(){e.showSearchDialog()})),t},renderClearItem:function(){var e=this,t=e.renderSearchItem({id:e.Class.CLEAR_SEARCH_ID,label:this.getResource("render-search-clear-label")});return t.click((function(){var t={id:""};e.setDisplayValue(t),e.setValue(t)})),t},renderAddItem:function(){var e={id:this.Class.ADVANCED_ADDITION_ID,label:this.getResource("render-search-add-label")};return this.renderSearchItem(e)},processRequest:function(e,t){var i=this,r=i.properties,a=[];function n(e,a){r.allowClear&&void 0!==i.value&&e.push({id:i.Class.CLEAR_SEARCH_ID,label:"",value:""}),r.advancedSearch&&e.push({id:i.Class.ADVANCED_SEARCH_ID,label:"",value:""}),r.allowAdd&&e.push({id:i.Class.ADVANCED_ADDITION_ID,label:"",value:""});var n=(new Date).getTime()+i.properties.expireCache,o=encodeURIComponent(a);if(i.properties.enableLocalStorage){var s=i.properties.xpath+"_"+o+"_expire",l=i.properties.xpath+"_"+o;bizagi.util.setItemLocalStorage(s,n),bizagi.util.setItemLocalStorage(l,JSON.encode(e))}t(e)}i.properties.allowSuggest&&e.term.length>=i.properties.searchLength?(i.showAutocompleteLoading(),r.term=e.term,this.deferredReference&&"function"==typeof this.deferredReference.reject&&"resolved"!==this.deferredReference.state()&&this.deferredReference.reject({hideStatus:!0}),i.deferredReference=this.getData().done((function(t){t&&t.length>0?((t=t.slice(0,r.maxRecords)).length>i.Class.SEARCH_MAX_RECORDS?(t=t.slice(0,i.Class.SEARCH_MAX_RECORDS),a.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-search-maximum-records-allowed"),value:""})):t=t.slice(0,r.maxRecords),$.each(t,(function(t,i){if(0==r.maxRecords||t<r.maxRecords){var n=bizagi.util.performTermMatches(i.value,e.term),o=bizagi.util.performTermMatches(i.value,e.term,!0);a.push({id:i.id,label:n,labelWithoutFormat:o,value:i.value})}}))):a.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-grid-no-records"),value:""}),n(a,e.term),i.hideAutocompleteLoading()}))):n(a,e.term)},calculateSuggestionWidth:function(){return this.searchInput.data("ui-autocomplete").menu.element.width()},setDisplayValue:function(e){var t=this.properties,i="";if(null!=(e=this.mapValue(e))&&null!=e)if(t.editable)void 0!==e.value&&e.value?(void 0!==e.labelWithoutFormat?this.searchInput.val(e.labelWithoutFormat):this.searchInput.val(this.formatItem(e.value)),this.setValue(e)):e.additionallabel&&e.label?(i=e.label+" - "+e.additionallabel,this.searchInput.val(i)):e.label?this.searchInput.val(e.label):e&&void 0!==e.id&&""===e.id?this.searchInput.val(""):"object"!=_typeof(e)&&this.searchInput.val(e);else{var r=this.getControl();null!=(i=void 0!==e.labelWithoutFormat?e.labelWithoutFormat:e.label||e.value)?"object"==_typeof(i)&&(i=i.join(" - ")):i="","string"==typeof i&&(e.additionallabel&&(i+=" - "+e.additionallabel),i=bizagi.util.sanitizeHTML(i)),r.html(i)}},getDisplayValue:function(){return this.selectedValue},showAddRecordDialog:function(){var e=this,t=e.properties;return{buttons:{text:bizagi.localization.getResource("render-form-dialog-box-add"),click:function(){var i=new bizagi.rendering.dialog.form(e.dataService,e.renderFactory,{showSaveButton:t.editable,title:bizagi.localization.getResource("render-dialog-entity"),orientation:e.properties.orientation||"ltr",onSave:function(r){var a=r.idPageCache,n=$.Deferred(),o={action:"SAVE",data:r,idPageCache:a,guidEntity:t.entity,contexttype:"entity"},s={};return $.forceCollectData=!0,i.form.collectRenderValues(s),$.forceCollectData=!1,bizagi.util.isMapEmpty(s)?(bizagi.showMessageBox(e.getResource("render-search-advanced-no-filters"),"","error"),n.resolve()):$.when(e.dataService.submitData(o)).done((function(a){if(a&&"validationMessages"===a.type)n.resolve(a);else{for(var o in s){var l=(d=o,c=void 0,c=e.searchDialog.currentSearchForm.getRender(d),"object"==_typeof(c)&&null!=c?{found:!0,obj:c}:{found:!1,obj:{}});l.found&&(l.obj.setValue(s[o]),e.setDisplayValueToControl(l.obj,i.form,o,s))}e.searchDialog.currentSearchForm.performSearch({allowFullSearch:t.allowFullSearch,maxRecords:t.maxRecords}),i.form.properties.needsUserConfirmation?$.when(bizagi.showConfirmationBox(i.form.properties.userConfirmationMessage,null,!1)).done((function(){n.resolve(r),i.closeDialogBox()})).fail((function(){n.reject()})):(n.resolve(r),i.closeDialogBox())}var d,c})).fail((function(e,t,i){"parsererror"==t?n.resolve({type:"error",message:i.message}):n.reject(arguments)})),n.promise()},close:function(){i.dialog("destroy"),i.remove()}});i.render({idRender:t.id,idPageCache:t.idPageCache,requestedForm:"addForm",guidEntity:t.entity,contextType:"entity"}).fail((function(){}))}}}},setDisplayValueToControl:function(e,t,i,r){"searchSuggest"===e.properties.type?e.setDisplayValue(t.getRender(i).getDisplayValue()):e.setDisplayValue(r[i])},showSearchDialog:function(){var e,t=this,i=t.properties,r=i.searchForms.length>0&&"searchForm"===i.searchForms[0].type?"metadata":"entity";i.allowNew&&(e=t.showAddRecordDialog()),t.searchDialog=new bizagi.rendering.dialog.search(t.dataService,t.renderFactory,i.searchForms,{allowFullSearch:i.allowFullSearch,maxRecords:i.maxRecords,orientation:i.orientation||"ltr"},e),t.searchDialog.render({idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:r,orientation:i.orientation||"ltr"}).done((function(e){t.setValue(e),t.readyActionExecution().done((function(){var e=t.getFormContainer();t.properties.submitOnChange||$.when(e.submitData()).done((function(){t.refreshControl()}))}))}))},showAutocompleteLoading:function(){$("i",this.getControl()).addClass("ui-autocomplete-loading")},hideAutocompleteLoading:function(){$("i",this.getControl()).removeClass("ui-autocomplete-loading")},cleanData:function(){var e=this.getControl(),t={id:""};this.setDisplayValue(t),this.setValue(t,!1),this.properties.editable||$(e).html("<label class='readonly-control'></label>")},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},getValueId:function(e){var t=e.id||"";return bizagi.util.isString(t)&&/idEntity(.*)businessKey/gi.test(t)?t:bizagi.util.isNumeric(t)?t:e.value},getValueLabel:function(e){var t=e.label;return!bizagi.util.isString(t)&&bizagi.util.isString(e.value)&&(t=e.value),t},isPreferencesDialog:function(e){var t=e&&e.closest(".bz-wp-userpreferences-main")||[];return t&&t.length>0}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.letter",bizagi.rendering.letter.prototype),bizagi.rendering.desktop.letter.extend("bizagi.rendering.desktop.letter",{},{postRender:function(){$(":button",this.getControl()).button()},configureHandlers:function(){var e=this,t=$(":button",e.getControl());e._super(),t.click((function(){$.when(e.saveForm()).done((function(){e.showLetterDialog()}))}))},postRenderReadOnly:function(){},configureHandlersReadOnly:function(){var e=this,t=e.getControl(),i=e.dataService.getLetterNotEditableUrl({idRender:e.properties.id,xpath:e.getXpath(),xpathContext:e.getContextXpath(),idPageCache:e.properties.idPageCache});$(".ui-bizagi-render-letter-readonly",t).click((function(){$.when(e.saveForm()).done((function(){$.when(e.getCanGenerateLetter()).done((function(e){e&&bizagi.util.parseBoolean(e.canGenerate)?window.open(i):bizagi.showMessageBox(bizagi.localization.getResource("render-letter-not-generated"))}))}))}))},showLetterDialog:function(){var e=this,t=new bizagi.rendering.dialog.letter(e.dataService,e.renderFactory);$.when(e.getCanGenerateLetter()).done((function(i){i&&bizagi.util.parseBoolean(i.canGenerate)?$.when(e.getLetterContent()).pipe((function(e){return t.render(e)})).done((function(t){e.saveLetterContent(t)})):bizagi.showMessageBox(bizagi.localization.getResource("render-letter-not-generated"))}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.button",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.button.extend("bizagi.rendering.desktop.button",bizagi.rendering.button.prototype),bizagi.rendering.desktop.button.extend("bizagi.rendering.desktop.button",{},{postRender:function(){var e=this.getControl(),t=$(":button",e),i=$(e.find("input"));t.button(),i.addClass("ui-button--ellipsis"),i.attr("title",$(e.find("input")).val())},configureHandlers:function(){var e=this,t=$(":button",e.getControl());e._super(),t.on("click",(function(){$("input",e.element).attr("disabled",!0),e.processButton();var t=setTimeout((function(){$("input",e.element).removeAttr("disabled"),clearTimeout(t)}),1500)}))},postRenderReadOnly:function(){this.postRender(),$(":button",this.getControl()).button("option","disabled","true")},processButton:function(){var e=this,t=e.properties,i=e.getMode();if(t.editable){if(void 0!==e.getFormContainer)var r=e.getFormContainer();if(0!=bizagi.override.validateGridsOnButtonClick&&"execution"==i&&r&&!r.hasValidGrids([]))r.validationController.performValidations();else if(t.needsUserConfirmation){var a=$("<div>").append(t.userConfirmationMessage),n=$.Deferred();$(a).dialog({modal:!0,width:500,height:250,draggable:!1,resizable:!0,maximize:!1,title:t.caption||t.displayName,buttons:[{text:bizagi.localization.getResource("confirmation-box-ok"),click:function(){n.resolve(),e.triggerRenderChange({pressed:!0}),$(this).dialog("close")}},{text:bizagi.localization.getResource("confirmation-box-cancel"),click:function(){n.reject(),$(this).dialog("close")}}]}),t.preventDefault||$.when(n.promise()).done((function(){e.runButtonAction()}))}else t.preventDefault||e.runButtonAction(),e.triggerRenderChange({pressed:!0})}}}),bizagi.rendering.desktop.button.extend("bizagi.rendering.desktop.uiPathButton",{},{initializeData:function(e){this._super(e),this.properties.rpabot=this.properties.rpabot||{}},postRender:function(){this._super(),"execution"===this.getMode()&&(bizagi.bzToast.init({zIndex:bizagi.util.getMaxZIndex()+1}),this.initializeRobot())},configureHandlers:function(){var e=this,t=$(":button",e.getControl());e._super(),t.on("click",(function(){e.robotInstance&&e.runRobot()}))},initializeRobot:function(){var e=this;UiPathRobot.getProcesses().then((function(t){if(0===t.length){var i=e.getResourceByKey("workportal-rpa-uipath-error-proccess-not-found","UIPath processes cannot be found or are not available.");return bizagi.showMessageBox(i,"Error"),void e.disabledButton()}if(e.robotInstance=t.find((function(t){return t.name.includes(e.properties.rpabot.robotName)})),!e.robotInstance){i=e.getResourceByKey("workportal-rpa-error-bot-not-found","bot is not found");bizagi.showMessageBox(e.properties.rpabot.robotName+" "+i,"Error"),e.disabledButton()}}),(function(t){var i=e.getResourceByKey("workportal-rpa-error-loading-bots","Something went wrong,");bizagi.showMessageBox(i+" "+t,"Error"),e.disabledButton()}))},runRobot:function(){var e=this;e.disabledButton();var t=e.getResourceByKey("workportal-rpa-bot-queue","The bot is being executed, please wait");e.properties.toast?e.properties.toast.relaunch().setLoaderStatus().setContent(t):e.properties.toast=bizagi.bzToast.addItem({title:e.properties.rpabot.robotName,content:t,onClickIcon:function(e){"error"===e.status&&e.relaunch().setLoaderStatus().setContent(t)},onCanStartJob:function(){e.startJob()}})},startJob:function(){var e=this,t=e.properties.toast,i=e.properties,r=i.rpabot.inputs||[],a=i.rpabot.outputs||[],n=this.areAllControlsInForm(r.concat(a));if(n.allControlsFound){r=e.getRobotInputs();e.disabledButton(),t.setLoaderStatus(),e.robotInstance.start(r).onStatus((function(e){t.setContent(e)})).then((function(i){e.processOutput(i);var r=e.getResourceByKey("workportal-rpa-bot-executed-succesfully","Bot executed succesfully");t.setSuccessStatus().setContent(r),e.properties.toast=void 0,e.enableButton()}),(function(i){var r=i.InnerException?i.InnerException.Message:e.getResourceByKey("workportal-rpa-bot-error-executed","There is an error in the bot execution");t.setErrorStatus().setContent(r),e.enableButton()}))}else e.handleNotFoundControls(n.controlsNotFound)},processOutput:function(e){var t=this.getFormContainer();(this.properties.rpabot.outputs||[]).forEach((function(i){var r=e[i.robotArgumentName];if(r){var a=t.getRenders(i.xpath)[0];bizagi.util.isEmpty(a)||a.setDisplayValue(r)}}))},disabledButton:function(){$("input",this.getControl()).attr("disabled",!0).addClass("ui-state-disabled rpa-disabled")},enableButton:function(){$("input",this.getControl()).removeAttr("disabled").removeClass("ui-state-disabled rpa-disabled")},getRobotInputs:function(){var e=this.getFormContainer(),t={};return(this.properties.rpabot.inputs||[]).forEach((function(i){var r=e.getRenders(i.xpath)[0],a="";bizagi.util.isEmpty(r)||(a=r.getValue()),t[i.robotArgumentName]=a})),t},areAllControlsInForm:function(e){var t=this.getFormContainer(),i={allControlsFound:!0,controlsNotFound:[]};return(e=e||[]).forEach((function(e){var r=t.getRenders(e.xpath)[0];bizagi.util.isEmpty(r)&&(i.allControlsFound=!1,i.controlsNotFound.push(e.xpath))})),i},handleNotFoundControls:function(e){var t=this.getResourceByKey("workportal-rpa-controls-not-found","Controls associated with the bot’s inputs and outputs are not within the form");this.properties.toast.setErrorStatus().setContent(t),t+=":",e.forEach((function(e){t+=e+",\n"})),bizagi.showMessageBox(t,"Error"),this.disabledButton()}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.fileprint",bizagi.rendering.fileprint.prototype),bizagi.rendering.desktop.fileprint.extend("bizagi.rendering.desktop.fileprint",{},{postRender:function(){$(":button",this.getControl()).button()},configureHandlers:function(){var e=this,t=e.properties,i=$(":button",e.getControl());e._super(),t.filesCount>0?i.click((function(){e.processButton()})):i.button("option","disabled","true")},postRenderReadOnly:function(){var e=this.getFormContainer().properties.typeForm;this.postRender();var t=$(":button",this.getControl());"SummaryForm"===e||"GlobalForm"===e?this.configureHandlers():t.button("option","disabled","true")},processButton:function(){var e=this.getFormContainer().properties.typeForm;(this.properties.editable||"SummaryForm"===e||"GlobalForm"===e)&&this.runButtonAction()},runButtonAction:function(){var e=this,t=e.getFormContainer();t.clearValidationMessages(),t.startLoading(),e.downloadFile().then((function(t){if($.browser.mozilla)bizagi.util.downloadBlobFile(t,"PDF.pdf");else{var i=e.getControl();$("iframe",i).remove();var r="bz-render-fileprint-iframe-"+(new Date).getTime(),a=e.renderFactory.getTemplate("fileprint-iframe"),n=window.URL.createObjectURL(t),o=$.tmpl(a,{url:n,id:r});i.append(o);var s=document.getElementById(r).contentWindow;void 0===s.print||bizagi.util.isIE()?bizagi.util.downloadBlobFile(t,"PDF.pdf"):s.print(),window.URL.revokeObjectURL(n)}})).fail((function(e){t&&t.failHandler(e)})).always((function(){t&&t.endLoading()}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.link",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.link.extend("bizagi.rendering.desktop.link",bizagi.rendering.link.prototype),bizagi.rendering.desktop.link.extend("bizagi.rendering.desktop.link",{},{postRender:function(){},configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},linkSolver:function(e){var t=(e=e||{}).url||"",i=e.target||"_blank";switch(!0===bizagi.override.linkPrefix&&t&&-1===t.indexOf("http")&&-1===t.indexOf("\\\\")&&(t="//"+bizagi.util.trim(t)),e.linkType){case"newwindow":var r=printf("width=%s,height=%s,resizable,scrollbars=yes,status=1,toolbar=yes",window.screen.width,window.screen.height);this.windowObjReference=window.open(t,i,r);break;case"newtab":default:this.windowObjReference=window.open(t,i)}},postRenderReadOnly:function(){this.postRender()},attachEvents:function(){var e=this,t=e.getControl(),i=e.properties,r=$(".ui-bizagi-render-link",t);i.value?(r.attr("href",i.value),r.attr("target","_blank"),r.click((function(){return e.linkSolver({linkType:i.linktarget,url:i.value}),!1}))):r.addClass("ui-state-disabled"),e.preventDefaultForAnchorTag()},processLayout:function(e){e?void 0!==this.properties.textFormat.background&&this._super(e,{background:this.properties.textFormat.background}):this._super(e,this.properties.textFormat)},getElementsToStylize:function(e){return $(".ui-bizagi-render-link",e)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.layoutRender",bizagi.rendering.layoutRender.prototype),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutPlaceholder",bizagi.rendering.layoutPlaceholder.prototype),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutBoolean",bizagi.rendering.layoutBoolean.prototype),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutImage",bizagi.rendering.layoutImage.prototype),bizagi.rendering.desktop.layoutImage.extend("bizagi.rendering.desktop.layoutImage",{},{postRender:function(){var e=this.getControl();if(this.value&&void 0!==this.value.value&&""!==this.value.value&&null!==this.value.value){var t=this.getImageUri();$.ajax({url:t,type:"GET",dataType:"binary",processData:!1,success:function(t){if("string"==typeof t){var i=arguments[2],r=i.getResponseHeader("Content-type");t=bizagi.util.byteArrayToBlob(bizagi.util.stringToByteArray(t),r)}var a=window.URL||window.webkitURL,n=a.createObjectURL(t);$(e).find("img").attr("src",n)}})}},getImageUri:function(){var e=this.parent.parent.properties.paramsRender||{},t={entity:this.value.guid,surrogateKey:this.value.surrogateKey,xpath:this.properties.xpath,width:96,height:96,hash:this.value.value,idcase:e.idRender?bizagi.context.idCase:"_",idworkitem:e.idRender?bizagi.context.idWorkitem:"_",contextxpath:e.idRender?e.xpathActions:"_"};return this.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(t)}}),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutLink",bizagi.rendering.layoutLink.prototype),bizagi.rendering.desktop.layoutLink.extend("bizagi.rendering.desktop.layoutLink",{},{postRender:function(){var e=this.element;this._super(),e&&$(e).on("click",$.proxy(this.onClickElement,this))},onClickElement:function(){var e=this.properties||{},t={displayName:e.displayName,reference:e.reference,referenceType:e.referenceType,xpath:e.xpath,contextEvent:this.getFormContainer().getContextEvent?this.getFormContainer().getContextEvent():""};this.triggerGlobalHandler("DATA-NAVIGATION",t)}}),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutLabel",bizagi.rendering.layoutLabel.prototype),bizagi.rendering.desktop.layoutLabel.extend("bizagi.rendering.desktop.layoutLabel",{},{setValue:function(e,t){this.properties.displayName=e,this._super(e,t);var i=this.getControl();i&&$(".ui-bizagi-render-label",i).text(e)}}),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutText",bizagi.rendering.layoutText.prototype),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutDateTime",bizagi.rendering.layoutDateTime.prototype),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutNumber",bizagi.rendering.layoutNumber.prototype),bizagi.rendering.desktop.layoutNumber.extend("bizagi.rendering.desktop.layoutNumber",{},{setValue:function(e,t){var i=this.getControl();"execution"===this.getMode()&&(e=null===e||""===e?"":this.getDisplayValue(e)),this.properties.displayName=e,this._super(e,t),i&&$(".ui-bizagi-render-number",i).text(e)}}),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutMoney",bizagi.rendering.layoutNumber.prototype),bizagi.rendering.desktop.layoutMoney.extend("bizagi.rendering.desktop.layoutMoney",bizagi.rendering.layoutMoney.prototype),bizagi.rendering.desktop.layoutMoney.extend("bizagi.rendering.desktop.layoutMoney",{},{setValue:function(e,t){var i=this.getControl();"execution"===this.getMode()&&(e=null===e||""===e?"":this.getDisplayValue(e)),this.properties.displayName=e,this._super(e,t),i&&$(".ui-bizagi-render-number",i).text(e)}}),bizagi.rendering.desktop.layoutRender.extend("bizagi.rendering.desktop.layoutUpload",bizagi.rendering.layoutUpload.prototype),bizagi.rendering.desktop.layoutUpload.extend("bizagi.rendering.desktop.layoutUpload",{},{renderControl:function(){var e=this,t=e.properties,i=$.Deferred();return"execution"===e.getMode()?$.when(e.getValueFilesByData(bizagi.clone(t))).done((function(t,r){e.properties=t,e.files=r.files,i.resolve(e.getHTMLFiles(t))})):(e.files=[],i.resolve(e.getHTMLFiles())),i.promise()},getHTMLFiles:function(){this.filesCount=this.files.length;for(var e=this.renderFactory.getTemplate("layout-upload"),t=$.fasttmpl(e,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),noFiles:0==this.filesCount}),i="",r=0;r<this.filesCount;r++){var a={id:this.files[r][0],fileName:this.files[r][1]};i+=this.renderUploadItem(a)}return t=this.replaceFilesHtml(t,i)},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},renderUploadItem:function(e){var t=this.properties,i=this.renderFactory.getTemplate("layout-uploadItem");return $.fasttmpl(i,{allowDelete:t.allowDelete,filename:e.fileName,id:e.id,mode:this.getMode(),editable:t.editable})},configureHandlers:function(){var e=this,t=e.getControl();e.isExecutionMode()&&$(".ui-bizagi-render-upload-layout-item",t).on("click",(function(t){t.stopPropagation(),e.downloadFile($(this).data())}))},downloadFile:function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileEntity({isContextContainerWidgetRender:this.isContextContainerWidgetRender(),xpath:this.getUploadXpath(),fileId:e.id,idRender:i.properties.paramsRender.idRender||"undefined",xpathContext:t.xpathContext,idPageCache:i.properties.paramsRender.idPageCache||"undefined",xpathActions:i.properties.paramsRender.xpathActions||"undefined",surrogatekey:this.properties.value.surrogateKey,guidentity:this.properties.value.guid}).then((function(t){bizagi.util.downloadBlobFile(t,e.filename)})).fail((function(e){i&&i.failHandler(e)}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.formLink",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},bizagi.rendering.formLink.prototype),bizagi.rendering.desktop.formLink.extend("bizagi.rendering.desktop.formLink",{},{configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},executeRule:function(e){var t=new $.Deferred;return this.dataService.multiaction().getPropertyData({url:this.properties.dataUrl,xpath:this.properties.xpath,idRender:this.properties.id,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,property:e}).done((function(e){if("error"===e.type)t.reject(e);else if(null!=e.messages){var i=e.messages[0];t.reject({type:e.type,message:i})}else t.resolve(e)})).fail((function(e,i,r){t.reject({type:"error",message:e.message})})),t.promise()},executeExitRule:function(e){var t=this,i=new $.Deferred;return t.properties.hasexitrule&&!t.isThisFormReadOnly()?t.saveFormLinkData(e).then((function(){return t.executeRule("exitrule")})):(i.resolve(),i.promise())},executeEntryRule:function(){var e=new $.Deferred;return this.properties.hasentryrule&&!this.isThisFormReadOnly()?this.executeRule("entryrule"):(e.resolve(),e.promise())},submitSaveRequest:function(e){var t=this.properties;if(!t.editable&&!t.value)return null;var i=this.getFormLinkXpath(),r=i;return void 0!==t.xpathContext&&""!==t.xpathContext&&(r=i?t.xpathContext+"."+i:t.xpathContext),this.dataService.saveLinkForm({url:t.saveUrl,idRender:t.id,xpathContext:r,submitData:e})},isThisFormReadOnly:function(){var e=this.getFormContainer();return e&&e.properties.displayAsReadOnly},openFormLink:function(){var e=this,t=e.properties,i=e.getFormContainer();return void 0===t.canBeSaved&&(t.canBeSaved=!0),(!1===t.editable||i.properties.displayAsReadOnly)&&(t.canBeSaved=!1),$.when(i.properties.editable&&!e.isThisFormReadOnly()?i.submitData():void 0).then((function(){return $.when(e.submitEditRequest()).then((function(){return e.executeEntryRule().then((function(){e.openFormLinkDialog()})).fail((function(t){e.submitRollbackRequest(),e.handleFailRuleExecution(t)}))})).fail((function(){console.warn("EDITRELATION action Fails")}))}))},openFormLinkDialog:function(){var e=this,t=e.properties,i=e.getFormContainer();e.dialog=new bizagi.rendering.dialog.form(e.dataService,e.renderFactory,{showSaveButton:t.canBeSaved,isPlanForm:t.isPlanForm||!1,maximized:t.maximized,title:t.displayName,orientation:t.orientation||"ltr",onSave:function(t){var r=new $.Deferred,a=null;return t&&t.deferreds&&(a=$.when.apply($,t.deferreds),delete t.deferreds),$.when(a).then((function(){e.handleOnSaveDialog(t).then((function(e){r.resolve(e),i.refreshForm()})).fail((function(){r.reject()}))})),r.promise()},close:function(){}}),e.dialog.render({idRender:t.id,xpathContext:e.getFormLinkXpathContext(),idPageCache:t.idPageCache,recordXPath:e.getFormLinkXpath(),requestedForm:"linkform",editable:t.editable,url:t.editPage,fromRender:e,mainForm:e.getMainForm(e.getFormContainer())}).fail((function(t){$.when(e.submitRollbackRequest(t)).done((function(){e.submitInvalidatePageCacheRequest(t)}))}))},handleFailRuleExecution:function(e){if("alertMessages"===e.type)bizagi.modalError&&bizagi.modalError.show(e.message,"workportal-general-word-information",!1);else{var t=this.getFormContainer();"validationMessages"===e.type?t.validationController.showErrorMessage(e.message):t.addErrorMessage(e.message)}},handleOnSaveDialog:function(e){var t=this;return t.executeExitRule(e).then((function(){var i=new $.Deferred,r=t.properties.hasexitrule?{idPageCache:e.idPageCache}:e;return t.submitSaveRequest(r).then((function(e){if("error"===e.type)i.reject(e);else if(null!=e.messages){var t=e.messages[0];i.reject({type:e.type,message:t})}else i.resolve(e)})).fail((function(e){i.reject({type:"error",message:e.message})})),i.promise()})).fail((function(e){return t.handleFailRuleExecution(e),e}))},getFormLinkXpathContext:function(){var e=this.properties.xpathContext,t=this.getXpathContext();return t&&e?0===e.indexOf(t)?e:t+"."+e:e},attachEvents:function(){var e=this,t=$(".ui-bizagi-render-link",e.getControl());e.dialog=null,t.on("click",(function(){var t=$(this);t.prop("disabled",!0),$.when(e.openFormLink()).always((function(){t.prop("disabled",!1)}))}))},changeColor:function(e){var t=this.getControl(),i=this.getLabel();t&&i&&("none"!==e?(this.getControl().find("a").css("color",e,"!important"),"function"==typeof this.getControl().find("a").style&&this.getControl().find("a").style("color",e,"!important")):(this.getControl().find("a").css("color",""),"function"==typeof this.getControl().find("a").style&&this.getControl().find("a").style("color",""))),this._super(e)},changeFontBold:function(){var e=this.getControl().children();void 0!==this.properties.textFormat.bold&&"object"==_typeof(e)&&e.length>0&&this.getElementsToStylize(e).css("font-weight","bold","!important")}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.geolocation",bizagi.rendering.geolocation.prototype),bizagi.rendering.desktop.geolocation.extend("bizagi.rendering.desktop.geolocation",{},{renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.postRender()},postRender:function(){this._super(),this.cordinate=$(".ui-geolocation-cordinate",this.getControl())},configureHandlers:function(){var e=this;if(e.isExecutionMode()){var t=e.getControl();null==e.value&&e.setDisplayValue().then((function(){})).fail((function(t){e.cordinate.html("<span style='color: red'>"+t+"</span>")})),$(".ui-bizagi-render-geolocation",t).bind("click",(function(){e.cordinate.empty(),e.setDisplayValue().then((function(){})).fail((function(t){e.cordinate.html("<span style='color: red'>"+t+"</span>")}))}))}},clearDisplayValue:function(){var e=this.getControl().find("span");e.length>0&&e.val("")},setDisplayValue:function(e){var t=this,i=new $.Deferred;if(null!=e&&""!==e)t.cordinate.html(t.performPrecision(e)),t.setValue(e,!1),i.resolve();else{t.getCurrentPosition((function(e){var r=e.coords.latitude+" "+e.coords.longitude;t.cordinate.html(t.performPrecision(r)),t.setValue(r,!1),i.resolve()}),(function(e){t.cordinate.html(t.properties.value),i.reject(e)}))}return i.promise()}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.hidden",bizagi.rendering.hidden.prototype),bizagi.rendering.desktop.hidden.extend("bizagi.rendering.desktop.hidden",{},{}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.money",bizagi.rendering.number.prototype),bizagi.rendering.desktop.money.extend("bizagi.rendering.desktop.money",bizagi.rendering.money.prototype),bizagi.rendering.desktop.money.extend("bizagi.rendering.desktop.money",{},{setDisplayValue:function(e){var t=this.properties;this._super(e),null!=e&&t.editable&&(this.numericInput.val(bizagi.util.numberToFixedString(e)),this.executeFormatCurrencyPlugin())},changeCellRequired:function(e){this.changeRequired(e)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $("input.ui-bizagi-render-numeric, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}}),bizagi.rendering.desktop.money.extend("bizagi.rendering.desktop.queryMoney",{},{attachFormatCurrency:function(){var e=this.properties;e.showSymbol&&""===e.symbol&&"undefined"!=typeof bizagi&&8==e.dataType&&void 0!==bizagi.currentUser&&void 0!==bizagi.currentUser.symbol&&(e.symbol=bizagi.currentUser.symbol),this._super()}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.radio",bizagi.rendering.combo.prototype),bizagi.rendering.desktop.radio.extend("bizagi.rendering.desktop.radio",bizagi.rendering.radio.prototype),bizagi.rendering.desktop.radio.extend("bizagi.rendering.desktop.radio",{},{postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-boolean-yesno"),this.properties.unique=Math.ceil(1e3*Math.random()),this.radiogroup=$(".ui-bizagi-render-radio",e),this.radiogroup.optiongroup({orientation:this.properties.orientation}),this.selectedValue&&this.radiogroup.optiongroup("setValue",this.selectedValue)},configureHandlers:function(){var e=this;e._super(),e.radiogroup.bind("optiongroupchange",(function(t,i){e.onOptionGroupChange(i)}))},onOptionGroupChange:function(e){var t={id:e.value,value:e.text};this.selectedValue=t.value,this.setValue(t)},configureDesignView:function(){this.getControl().find("input").unbind("click")},setDisplayValue:function(e){this.properties.editable&&void 0!==e&&""!=e.id&&this.radiogroup.optiongroup("setValue",e.id||e.value)},clearDisplayValue:function(){var e=this.getControl();this.radiogroup?$.data(this.radiogroup[0])["ui-optiongroup"]?this.radiogroup.optiongroup("setValue",0):$(e).html("<label class='readonly-control'></label>"):this.properties.editable||$(e).html("<label class='readonly-control'></label>")},getSelectedValue:function(){return this.selectedValue},changeFontUnderline:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(e)?"underline":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},changeFontStrikethru:function(e,t){var i=this.properties.textFormat||{},r=this.properties.valueFormat||{},a=bizagi.util.parseBoolean(i.underline)?"underline ":"",n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(e)?"line-through":"",s=void 0===t&&null==t||t,l=s?this.getFormattingLabel():this.getElementsToStylized(this.getControl()),d=s?a:n;this.changeTextDecoration(l,d+o)},getElementsToStylized:function(e){return $(".ui-bizagi-render-radio label, label.readonly-control",e)},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)}}),bizagi.rendering.desktop.radio.extend("bizagi.rendering.desktop.queryRadio",{},{postRender:function(){var e=this.getControl();this._super(),e.removeClass("ui-bizagi-render-boolean-yesno")}}),bizagi.rendering.desktop.radio.extend("bizagi.rendering.desktop.queryState",{},{initializeData:function(e){var t=void 0===e.properties.horizontal||bizagi.util.parseBoolean(e.properties.horizontal);this._super(e);var i=this.properties;i.horizontal=t,void 0===i.defaultValue&&null===i.value&&this.setValue({id:"0"},!1)},getValue:function(){return this.value&&this.value.id&&!isNaN(this.value.id)?{id:parseInt(this.value.id),value:this.value.value}:this.value},setDisplayValue:function(e){e.id=e.id+"",this._super(e)}}),bizagi.rendering.desktop.radio.extend("bizagi.rendering.desktop.queryCaseState",{},{initializeData:function(e){var t=void 0===e.properties.horizontal||bizagi.util.parseBoolean(e.properties.horizontal);this._super(e);var i=this.properties;i.horizontal=t,void 0===i.defaultValue&&null===i.value&&this.setValue({id:"0"},!1)},getValue:function(){return this.value&&this.value.id&&!isNaN(this.value.id)?{id:parseInt(this.value.id),value:this.value.value}:this.value},setDisplayValue:function(e){e.id=e.id+"",this._super(e)}}),bizagi.rendering.desktop.panel.extend("bizagi.rendering.desktop.queryGrid",{},{initializeData:function(e){var t=this;console.log("sucede initializeData queryGrid"),t._super(e);var i=t.properties;i.uniqueId=Math.ceil(1e6*Math.random()),i.editable=void 0===i.editable||bizagi.util.parseBoolean(i.editable),i.visible=void 0===i.visible||bizagi.util.parseBoolean(i.visible),i.orientation=i.orientation||(t.parent?t.parent.properties.orientation:"ltr"),this.originalProperties=JSON.parse(JSON.encode(i)),this.children=[],this.childrenHash={},e.elements&&$.each(e.elements,(function(e,i){i.render.properties.xpath=t.properties.xpath+"."+i.render.properties.xpath,i.render?t.createRenderElement(i):i.container?t.createContainerElement(i):i.form&&t.createFormElement(i)}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.list",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.list.extend("bizagi.rendering.desktop.list",bizagi.rendering.combo.prototype),bizagi.rendering.desktop.list.extend("bizagi.rendering.desktop.list",bizagi.rendering.list.prototype),bizagi.rendering.desktop.list.extend("bizagi.rendering.desktop.list",{},{postRender:function(){var e=this,t=e.getControl(),i=e.properties;if(e._super(),t.addClass("ui-bizagi-render-display-block"),t.addClass("ui-bizagi-render-boolean-yesno"),e.list=$(".ui-bizagi-render-list",t),e.list.selectable2({closest:!1,multiple:!1,select:function(t,i){if(!t.isPropagationStopped()){var r=$("li[tabindex='0']",this),a={id:$(r).data("value"),value:$(r).text()};e.setValue(a),e.selectedValue=a.value,e.focusSelectedItem(r),t.stopPropagation()}}}),i.listSize>0){var r=23*Number(i.listSize);e.list.height(r+"px")}},focusSelectedItem:function(e){$.when(this.ready()).done((function(){e.focus(0)}))},configureHandlers:function(){this._super()},configureDesignView:function(){this._super(),this.properties.editable&&(this.list.unbind("mousedown.selectable"),this.list.unbind("focus.selectable"),this.list.unbind("blur.selectable"),this.list.unbind("keydown.selectable"))},setDisplayValue:function(e){e=this.mapValue(e),this.properties.editable&&void 0!==e&&""!==e.id&&this.list.selectable2("select","[id='ui-bizagi-list-"+e.id+"']")},clearDisplayValue:function(){var e=this.getControl(),t=e.find(".ui-state-active");if(t.length>0){var i=this.getValue();this.selectedValue=i.value,t.removeClass("ui-state-focus ui-selected ui-state-active")}else this.properties.editable||$(e).html("<label class='readonly-control'></label>")},getSelectedValue:function(){return this.selectedValue},cleanData:function(){this.value=this.properties.value=this.selectedValue={id:"",value:""},this.clearDisplayValue()},getLabel:function(){return $("label",this._super())},getElementsToStylize:function(e){return $("ul li",e)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();"execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.multiSelect",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.multiSelect.extend("bizagi.rendering.desktop.multiSelect",bizagi.rendering.multiSelect.prototype),bizagi.rendering.desktop.multiSelect.extend("bizagi.rendering.desktop.multiSelect",{MORE_OPTION_WIDTH:40},{initializeData:function(e){this._super(e),this.isNewRenderForm=!0},postRender:function(){var e=this.getControl();this.multiSelect=$(".bz-multiselect",e),this._super()},renderElement:function(){return this._super("render-base")},postRenderReadOnly:function(){var e=this.getControl();this.multiSelect=$(".bz-multiselect",e),this._super()},setDisplayValue:function(e){var t=this;t._super(e);var i=setTimeout((function(){t.addSelectedElements(),clearTimeout(i)}),100)},configureHandlers:function(){var e=this,t=e.getControl();$(".bz-multiselect",t).on("click, mousedown.multiselect",(function(t){($(t.target).hasClass("bz-multiselect__tags")||$(t.target).hasClass("bz-multiselect__arrow"))&&e.onToggleDataView(t)})),$("ul.bz-multiselect__tags",t).on("click","li div.bz-btn-icn",this.onUnselectElement.bind(this)).on("click","li.bz-multiselect__plus",this.onShowSelectedElements.bind(this))},configureHandlersReadOnly:function(){var e=this.getControl();$("ul.bz-multiselect__tags",e).on("click","li.bz-multiselect__plus",this.onShowSelectedElements.bind(this))},addSelectedElements:function(){var e=this,t=this.getControl(),i=this.getDataValue()||[],r=i.length,a=$("ul.bz-multiselect__tags",t),n=this.properties.editable,o=this.renderFactory.getTemplate("list-multiselect-tag");if(a.empty(),r>0)if(this.getFormContainer().params.printversion)t.html(i.map((function(t){return e.formatItem(t.value)})).join(", "));else for(var s=0;s<r;s++){var l=i[s],d={id:l.id,value:l.value,editable:n},c=$.tmpl(o,d,{formatItem:e.formatItem});if(a.append(c),this.processControlLayout(this.properties.valueFormat||{}),!this.canAddMoreItems(a)){a.children().last().remove();var u=$.tmpl(this.renderFactory.getTemplate("list-multiselect-view-more"),{value:r-s,index:s});a.append(u);break}}},renderFloatView:function(){var e=this,t=e.renderFactory.getTemplate("list-multiselect-item");e.updateArrow(),$.when(e.getData()).done((function(i){try{var r={datasource:i},a={selected:e.getDataValue(),isChecked:function(t){return e.markAsChecked.call(this,t)},formatItem:e.formatItem},n=e.showFloatListView(t,r,a);e.floatListHandlers(n)}catch(e){bizagi.log(e.message)}})).fail((function(t){var i=e.properties.displayName+": ",r=e.getFormContainer();i+=("string"==typeof t?JSON&&JSON.parse(t)||$.parseJSON(t):t).message,r.addValidationMessage(i)}))},showFloatListView:function(e,t,i){var r=this.getControl().closest(".ui-bizagi-control-wrapper"),a=r.closest(".bz-form-old-item"),n=$.tmpl(e,t,i),o=this.multiSelect.width();a.addClass("bz-multiselect__visible"),r.addClass("bz-multiselect__visible bz-multiselect__floats"),r.append(n),n.width(o),n.position({my:"left top",at:"left bottom",of:this.multiSelect,collision:"fit"}).hide(),n.show(),n.on("mousedown",(function(e){return e.preventDefault(),!1}));var s=setTimeout((function(){$(document).one("mousedown.multiselect",(function(e){n.trigger("closeView")})),clearTimeout(s)}),0);return n},destroyFloatView:function(e){var t=this.getControl().closest(".ui-bizagi-control-wrapper"),i=t.closest(".bz-form-old-item");t.hasClass("bz-multiselect__visible")&&t.removeClass("bz-multiselect__visible"),t.hasClass("bz-multiselect__floats")&&t.removeClass("bz-multiselect__floats"),i.hasClass("bz-multiselect__visible")&&i.removeClass("bz-multiselect__visible"),e.remove()},closeFloatView:function(){var e=this.getControl().closest(".ui-bizagi-control-wrapper").closest(".bz-form-old-item"),t=$(e).find(".bz-multiselect__content");t.hide(),this.updateArrow(),this.destroyFloatView(t)},updateArrow:function(){this.getControl().find(".bz-multiselect__arrow").toggleClass("bz-multiselect__arrow-collapse")},floatViewIsCollapsed:function(){var e=$(".bz-multiselect__content",this.element);return e&&e.length>0},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},onUnselectElement:function(e){var t=$(e.target).data("id");this.removeElement({id:t}),this.addSelectedElements()},onShowSelectedElements:function(e){var t=this,i=$(e.currentTarget).data("index"),r=(this.getDataValue()||[]).slice(i),a=this.renderFactory.getTemplate("list-multiselect-tags"),n=this.showFloatListView(a,{datasource:r,editable:t.properties.editable},{formatItem:t.formatItem}),o=$("ul.bz-multiselect__tags",n);o.on("click, mousedown","li div.bz-btn-icn",(function(e){t.onUnselectElement(e),n.remove(),e.stopPropagation()})),n.on("closeView",(function(){o.off("click","li div.bz-btn-icn",t.onUnselectElement.bind(t)),n.remove()}))},onToggleDataView:function(e){this.floatViewIsCollapsed()?this.closeFloatView():this.renderFloatView()},floatListHandlers:function(e){var t=this,i=e.find(".bz-multiselect__list li"),r=i.find("input[type=checkbox]"),a=e.find(".bz-multiselect__search_input");this.properties.enableTyping?a.bind("change keypress keyup mousedown",(function(e){e.stopPropagation(),t.filterList(this.value,i)})):a.addClass("bz-multiselect__search--disabled"),r.change((function(){var e=$(this),i=e.is(":checked"),r=e.data("id"),a={id:r,value:t.findItemById(r).value};i?t.addElement(a):t.removeElement(a),t.addSelectedElements()})),e.on("closeView",(function(){t.closeFloatView(),$(document).unbind("mousedown.multiselect")}))},getLabel:function(){return $("label",this._super())}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.handSignature",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.handSignature.extend("bizagi.rendering.desktop.handSignature",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.handSignature.prototype),bizagi.rendering.desktop.handSignature.extend("bizagi.rendering.desktop.handSignature",{},{renderElement:function(){return this._super("render-base")},postRenderReadOnly:function(){var e=this,t=e.getFormContainer(),i=t.params&&t.params.printversion;if(this.isExecutionMode())if(i)e.postRenderPrintVersion();else{var r=e.getSignatureContainer();e.setResizeObserver(r,(function(){e.renderSignature()}))}},postRenderPrintVersion:function(){var e=this.getSignatureContainer(),t=document.createElement("img");this.buildItemUrl().then((function(i){t.src=i,e.append(t)}))},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},getLabel:function(){return $("label",this._super())},configureHandlers:function(){var e=this,t=$(".bz-actions",this.getControl()),i=e.getSignatureContainer(),r=bizagi.util.debounce2((function(t){if(a){var i=Array.prototype.slice.call(t||[]),r=(i&&i[0]||[]).dataImage||"";e.saveDeferred=$.when(e.saveSignature(r))}}),e.DELAY_TO_SAVE),a=!1;i.bind("change",(function(){if(a=!0,$(this).BzjSignature("isModified")){e.saveTimestamp=(new Date).getTime();var t=$(".bz-signature__container-canvas",this)[0].toDataURL("image/png");r.fire({dataImage:t}),e.setData(t.replace(/^data:image\/(png|jpg|jpeg);base64,/,"")),e.properties.url=t,e.setState(e.STATE_TYPE.done)}})),t.on("click","[data-action='clear']",(function(){a=!0,r.cancel(),e.onSignatureClear(i)})),t.on("click","[data-action='edit']",(function(){e.onSignatureEdit(i),a=!1})),t.on("click","[data-action='save']",(function(){if(!a)return e.setState(e.STATE_TYPE.edit),void i.BzjSignature("disable");e.onSignatureSave(i,r),a=!1}))},onSignatureClear:function(e){var t=this;return e.BzjSignature("reset"),t.hasValue()&&(t.setData(t.EMPTY_VALUE),t.properties.url=t.EMPTY_VALUE,t.saveDeferred=$.when(t.deleteImage()).done((function(){t.setData(t.EMPTY_VALUE),t.properties.url=t.EMPTY_VALUE})).fail((function(e){t.executeFormFailHandler(e)}))),$.when(t.saveDeferred)},onSignatureEdit:function(e){this.setState(this.STATE_TYPE.draw),e.BzjSignature("enable")},onSignatureSave:function(e,t){var i=this;if(e.BzjSignature("disable"),e&&e.BzjSignature("isModified")){var r=$(".bz-signature__container-canvas",e)[0];t.cancel(),i.saveSignature(r.toDataURL("image/png")).always((function(){i.setState(i.STATE_TYPE.edit)}))}else i.setState(i.STATE_TYPE.edit)},renderSignature:function(){var e=this.getSignatureContainer();e.empty(),e.BzjSignature({sizeRatio:3,cssclass:"bz-signature__container-canvas",color:"#000",background:"#FFFFFF"}),e.BzjSignature("disable"),this.pluginInitialized&&this.properties.url?this.setSignature(e):this.renderSignatureValue(e),this.pluginInitialized=!0},renderSignatureValue:function(e){var t=this;return t.buildItemUrl().then((function(i){if(!t.isDisposed()){var r=""!==i?i:"";t.properties.url=r,bizagi.util.isEmpty(r)?t.setData(t.EMPTY_VALUE):e.BzjSignature("setData",r)}}))}}),bizagi.rendering.desktop.list.extend("bizagi.rendering.desktop.queryList",{},{}),bizagi.rendering.desktop.multiSelect.extend("bizagi.rendering.desktop.queryMultiSelect",{},{getData:function(){var e=this.properties;return e.data?this.normalizeData(e.data):[]},collectDataQueryForm:function(e){var t=this.properties,i=t.xpath,r=this.mapValue(this.getValue());if(!bizagi.util.isEmpty(i)&&(!bizagi.util.isEmpty(r)||t.included)){var a=(this.properties.typeSearch||this.properties.rangeQuery||"NONE").toUpperCase(),n={value:r,included:this.properties.included,xpath:t.xpath,searchType:a,orderType:"NONE",renderId:this.getRenderId()};void 0!==t.displayXpath&&""!==t.displayXpath&&(n.displayXpath=t.displayXpath),e.push(n)}},mapValue:function(e){var t=e||[],i=Array.isArray(t)?{}:JSON.parse(e);return bizagi.util.isEmpty(e)||void 0===i.value||(t=bizagi.util.isEmpty(i.value)?[]:e),t}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.userfieldWrapper",bizagi.rendering.userfieldWrapper.prototype),bizagi.rendering.desktop.userfieldWrapper.extend("bizagi.rendering.desktop.userfieldWrapper",{},{getUserfieldControl:function getUserfieldControl(){var self=this,sControl=self.userfieldName,mode=self.getMode(),exists=eval("typeof bizagi.rendering.desktop."+sControl+" !== 'undefined'"),def=new $.Deferred;if(exists)$.when(self.parent.ready()).done((function(){def.resolve(self.createUserfieldInstance(sControl))}));else if("execution"!=mode)var timeOutTrigger=setTimeout((function(){$.when(self.triggerGlobalHandler("loadUserField",{userfield:self.userfieldGuid,device:"Desktop"})).pipe((function(e){e&&def.resolve(self.createUserfieldInstance(sControl))})),clearTimeout(timeOutTrigger)}),10);else $.when(self.dataService.getUserfieldDefinition({userfield:self.userfieldGuid,device:"desktop"})).pipe((function(e){self.loadUserfield(e),def.resolve(self.createUserfieldInstance(sControl))}));return def.promise()},createUserfieldInstance:function createUserfieldInstance(sControl){var self=this,control;try{var dynamicFunction="var baDynamicFn = function(renderParams){ \r\n";dynamicFunction+="return new bizagi.rendering.desktop."+sControl+"(renderParams);\r\n",dynamicFunction+="}\r\n",dynamicFunction+="baDynamicFn",dynamicFunction=eval(dynamicFunction),control=dynamicFunction(self.initialParams)}catch(e){control=self.getUserFieldInstance(self.initialParams)}return control.properties.isUserField=!0,self.userfieldInstance=control,self.replicateUserfieldMethods(control),self.userfieldInstance.bind("renderchange",(function(){self.triggerHandler("renderchange",arguments)})),control},loadUserfield:function loadUserfield(data){var self=this,styleContent="";self.properties.styleGuid=self.properties.styleGuid||Math.guid();try{try{data=eval(data)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}$.each(data,(function(e,t){if("js"===t.type)try{t.content=t.content.replace(/bizagi\.rendering\.[^\s]+\.extend(\s|\n|\s)*\((\s|\n|\s)*\"bizagi\.rendering\.[^\s]+\"/gim,(function(e){return e.replace(/bizagi.rendering/gi,"bizagi.rendering.desktop")})),window.eval(t.content)}catch(e){bizagi.log("Could not parse result userfield3 "+self.userfieldName,e.message)}"css"===t.type&&(styleContent+=t.content)})),""!==$.trim(styleContent)&&bizagi.util.loadStyle(styleContent,self.properties.styleGuid);var control=eval("bizagi.rendering."+self.userfieldName)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}},getUserFieldInstance:function(e){return"execution"===this.getMode()?new bizagi.rendering.desktop.defaultUserField(e):new bizagi.rendering.desktop.designUserField(e)},startUserfieldLoading:function(){this.element.addClass("bz-form-userfield__loader"),this.startLoading()},endUserfieldLoading:function(){this.element.removeClass("bz-form-userfield__loader"),this.endLoading()}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.basicUserField",bizagi.rendering.userfieldDefinition.prototype),bizagi.rendering.desktop.basicUserField.extend("bizagi.rendering.desktop.basicUserField",bizagi.rendering.basicUserField.prototype),bizagi.rendering.desktop.basicUserField.extend("bizagi.rendering.desktop.basicUserField",{},{showDialog:function(e,t){var i=this,r=$("<div class='iframeContent'><iframe scrolling='yes' id='innerFrameContent' src='"+e+"' style='width:100%;height:100%;border:0'  /></div>"),a=$("#innerFrameContent",r);a.load((function(){a.callInside((function(e){this.BACloseWindow=function(t,i){e.formDialog.dialog("close"),e.formDialog.callback(t,i)}}),{formDialog:r,container:i}),r.callback=function(e,t){$.each(e,(function(e,t){t.xpath||bizagi.showMessageBox("Error calling closeWindow, the xpath was not defined.","Userfield error"),t.value||bizagi.showMessageBox("Error calling closeWindow, the value was not defined.","Userfield error"),i.getFormContainer().getRender(t.xpath).setDisplayValue(t.value)})),t&&i.submitOnChange()}})),r.dialog({height:t.height,width:t.width,title:t.title})},showPopup:function(e,t){var i=this;bizagi.showPopup(e,t,(function(e,t){$.each(e,(function(e,t){t.xpath||bizagi.showMessageBox("Error calling closeWindow, the xpath was not defined.","Userfield error"),t.value||bizagi.showMessageBox("Error calling closeWindow, the value was not defined.","Userfield error"),i.getFormContainer().getRender(t.xpath).setDisplayValue(t.value)})),t&&i.submitOnChange()}))}}),bizagi.rendering.desktop.basicUserField.extend("bizagi.rendering.desktop.defaultUserField",{},{getEditableControl:function(){var e=this.getControl(),t=this.properties.control;this.input=$("<label>Userfield: "+t+" not found</label>").appendTo(e)},collectData:function(e){},getDisplayValue:function(){return"Userfield: "+this.properties.control+" not found"},getReadonlyControl:function(){var e=this.getControl(),t=this.properties.control;return $("<label>Userfield: "+t+" not found</label>").appendTo(e)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.document",bizagi.rendering.document.prototype),bizagi.rendering.desktop.document.extend("bizagi.rendering.desktop.document",{},{postRender:function(){this.applyDocumentTemplatesFormat(),this.properties.allowSendInMail&&this.bindEmailDialog()},renderReadOnly:function(){return""},bindEmailDialog:function(){var e=this.getControl(),t=this.properties.xpathContext||"",i=this.properties.xpath;$(".ui-bizagi-render-documentgenerator-sendmail",e).bizagiSendEmail({tmpl:this.renderFactory.getTemplate("dialog-send-email"),value:this.value,self:this,dataService:this.dataService,properties:this.properties,xpath:i,xpathContext:t})},applyDocumentTemplatesFormat:function(){var e=this,t=e.getControl();t.addClass("ui-bizagi-render-display-block");var i=$(".ui-bizagi-document-upload-item",t);$.each(i,(function(t,i){$(".ui-bizagi-document-type",i).addClass("ui-bizagi-document-extension");var r=e.returnCssTypeFile($("a > span",i).html());$(".ui-bizagi-document-type",i).addClass(r)}))},updateControlForPrintMode:function(e){$(".ui-bizagi-render-button",e).each((function(){$(this).remove()})),$(".ui-bizagi-div-error-container",e).each((function(){$(this).remove()})),$(".ui-bizagi-document-type",e).each((function(){$(this).remove()})),$("a",e).each((function(){$(this).attr("target","_blank").attr("title",$("span",this).html()).css("text-decoration","none")})),$("ol",e).each((function(){$(this).removeClass("ui-bizagi-container-documents"),$(this).addClass("ui-bizagi-container-documents-print")}))},showDocumentPreview:function(e,t){var i,r,a,n;navigator.sayswho=(r=navigator.appName,a=navigator.userAgent,(n=a.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i))&&null!=(i=a.match(/version\/([\.\d]+)/i))&&(n[2]=i[1]),n=n?[n[1],n[2]]:[r,navigator.appVersion,"-?"]);var o=$("<div style='overflow:hidden;'></div>");o.empty(),o.appendTo("body",window.document);var s=$.browser.mozilla||$.browser.msie?this.renderFactory.getTemplate("document-item-preview-object"):this.renderFactory.getTemplate("document-item-preview");o.append($.fasttmpl(s,{url:e}));var l={};l[this.getResource("confirmation-box-ok")]=function(){!bizagi.util.isIE()&&window.URL.revokeObjectURL(e),o.dialog("destroy"),o.remove()},"Firefox"!==navigator.sayswho[0]&&(l[this.getResource("render-actions-print")]=function(){var e=0;!function t(i){if(!document.getElementById("ui-bizagi-document-pdf-preview")&&e<5){e+=1;var r=setTimeout((function(){t(i),clearTimeout(r)}),1e3)}else $.browser.mozilla||$.browser.msie?($(".ui-bizagi-document-pdf-preview").focus(),$(".ui-bizagi-document-pdf-preview")[0].print()):(document.getElementById("ui-bizagi-document-pdf-preview").focus(),document.getElementById("ui-bizagi-document-pdf-preview").contentWindow.print())}($("#ui-bizagi-document-pdf-preview",o)[0])}),o.dialog({width:800,height:600,title:t,maximized:!1,modal:!0,buttons:l,close:function(){!bizagi.util.isIE()&&window.URL.revokeObjectURL(e),o.dialog("destroy"),o.remove()}})},redrawDocuments:function(e,t,i){this._super(e,t,i),this.applyDocumentTemplatesFormat()},autoOpenDocuments:function(){var e=this,t=e.properties,i=e.getControl();if(t.autoOpen)if(t.downloadalldocuments){var r=$(".ui-bizagi-document-upload-item[data-joined=true]",i);if(r&&1===r.length){var a=r.attr("data-filename");e.getAllDocumentFiles({filename:a}).then((function(t){var i=bizagi.util.isIE()?r.attr("data-url")+"&h_disposition=inline":window.URL.createObjectURL(t);e.showDocumentPreview(i,a),!bizagi.util.isIE()&&window.URL.revokeObjectURL(i)})).fail((function(t){var i=e.getFormContainer();i&&i.failHandler(t)}))}}else $.each($(".ui-bizagi-document-upload-item",i),(function(){var t=$(this).data(),i=t.filename;"PDF"!==i.substr(i.lastIndexOf(".")+1).toUpperCase()||t.joined||e.getDocumentFile(t).then((function(r){var a=bizagi.util.isIE()?t.url+"&h_disposition=inline":window.URL.createObjectURL(r);e.showDocumentPreview(a,i)})).fail((function(t){var i=e.getFormContainer();i&&i.failHandler(t)}))}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.image.prototype),bizagi.rendering.desktop.image.extend("bizagi.rendering.desktop.image",{},{initializeData:function(e){this._super(e),this.properties.forceBase64=!0,this.properties.value=this.properties.value||[]},postRender:function(){var e,t=this,i=t.getControl(),r=t.properties,a=t.getMode(),n=t.renderFactory.getTemplate("images"),o=t.properties.width,s=t.properties.height;t.properties.flashVersion=!1;var l=$.fasttmpl(n,{xpath:bizagi.util.encodeXpath(t.getUploadXpath()),editable:r.editable,url:t.properties.url,allowDelete:r.allowDelete,mode:a});if($(".image-wrapper",i).empty().append(l),"design"===a||"layout"===a||0===t.properties.url.length){var d=setTimeout((function(){if("auto"===s){if("grid"===t.parent.properties.type)e=$(i).height()+"px",bizagi.util.cssExtended($(".image-wrapper",i),"width:100%!important");else{var r="panel"===t.parent.properties.type?t.parent.parent:t.parent,a=i.height();e=r.container.height()-17;var n=t.parent.getChildreCount(),l=t.parent.getChildrenSumHeight("image");void 0!==t.getFormContainer().properties&&t.parent.properties.id==t.getFormContainer().properties.id?e=50:n>1&&(e-=l-a),$(".image-wrapper",i).height(e)}s=e}$("a",i).css({width:o,height:s}),$(".resizable_img",i).css({width:o,height:s}),clearTimeout(d)}),150);if($(".resizable_img",i).hasClass("background-image")){var c=$(".resizable_img",i).css("background-image").replace(/url\(|\)|"|'/g,""),u=$("<img src="+c+">");u.css({width:o,height:s}),$(".resizable_img",i).append(u),$(".resizable_img",i).css({"background-image":"none","border-top-width":"0","border-left-width":"0","border-right-width":"0","border-down-width":"0",padding:"0",display:"inline-block"})}}else var p=!1,g=i.width(),h=setTimeout((function(){var e=t.properties.isAutoWidth;if(e&&"grid"===t.parent.properties.type){var r=$(".img",i).width();r<g&&0<r?o=r:r>=g&&(o=g-20,p=!0),$("a",i).css({height:"auto"})}else $("a",i).css({width:o,height:"auto"});$(".img, .ui-bizagi-render-image-wrapper .image-file",i).css({width:o,height:"auto"}),$(".ui-bizagi-render-upload-wrapper",i).addClass("uploaded");var a=48;-1!==(t.properties.width+"").indexOf("px")&&(a=(t.properties.width+"").replace("px","")),$(".ui-bizagi-render-image-wrapper .image-file",i).addClass("w-size-"+a),$("img",i).css("width",o),$("img",i).css("height","auto"),e&&Number($("a",i).css("width").slice(0,-2))>Number($(".img",i).css("width").slice(0,-2))&&$("a",i).css({width:$(".img",i).css("width")}),e&&p&&"grid"===t.parent.properties.type&&$("a",i).closest(".ui-bizagi-render").css("text-align","left"),clearTimeout(h)}),50);t.preventDefaultForAnchorTag(),t.isPostRendered&&t.isPostRendered.resolve()},isReadyToSave:function(){return this.ready()},configureHandlers:function(){var e=this.getControl(),t=this.properties;this._super(),this.deleteHandler(),$(".ui-bizagi-render-image-wrapper",e).bizagiUpload({renderReference:this,dialogTemplate:this.renderFactory.getTemplate("image-dialog"),properties:{scriptData:this.buildAddParams(),url:t.addUrl,xpath:t.xpath,validExtensions:t.validExtensions,maxSize:t.maxSize},onUploadFileCompletedCallback:this.onUploadFileCompleted,dialogTitle:this.getResource("render-upload-link-label")}),e.delegate(".ui-bizagi-render-upload-item","mouseover",(function(){var e=$(this);$(".ui-bizagi-render-upload-icon",e).css("display","inline-block"),e.removeClass("ui-state-default").addClass("ui-state-hover")})),e.delegate(".ui-bizagi-render-upload-item","mouseout",(function(){var e=$(this);$(".ui-bizagi-render-upload-icon",e).css("display","none"),e.addClass("ui-state-default").removeClass("ui-state-hover")}))},deleteHandler:function(){var e=this,t=e.getControl();$(".delete-button",t).bind("click",(function(t){t.stopPropagation(),e.deleteImage()}))},deleteImage:function(){var e=this,t=e.properties;return e.dataService.deleteImage({url:t.deleteUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contexttype}).done((function(){e.properties.value=[],e.refreshControl()}))},configureDesignView:function(){var e=this.getControl();this._super(),$("*:not(.ui-bizagi-render-control-required)",e).css({padding:"0px",margin:"0px",border:"0px","line-height":"0px",position:"relative",display:"inline-block",top:"0"}),$(".image-file",e).css({width:this.properties.width,height:this.properties.height})},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){var e=this.getControl(),t=this.renderFactory.getTemplate("images"),i=this.getMode(),r=$.fasttmpl(t,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),editable:!1,url:this.properties.url,allowDelete:!1,mode:i});$(".ui-bizagi-render-upload-wrapper",e).empty().append(r),$("a,.img, .ui-bizagi-render-image-wrapper .image-file, .ui-bizagi-render-image-wrapper",e).css({width:this.properties.width,height:this.properties.height})},getTemplateItem:function(){return this.renderFactory.getTemplate("image-item")},openUploadDialog:function(){var e=this,t=e.properties,i=window.document,r=e.dialogBox=$("<div class='ui-bizagi-component-loading'/>");r.empty(),r.appendTo("body",i);var a={};a[e.getResource("render-upload-dialog-select")]=function(){e.checkMaxSize()&&e.checkFileTypes()&&$.when(e.processUploadFile()).done((function(t){e.onUploadFileCompleted(t),e.closeUploadDialog()}))},a[e.getResource("text-cancel")]=function(){e.closeUploadDialog()},r.dialog({width:500,height:200,title:e.getResource("render-upload-link-label"),modal:!0,buttons:a,close:function(){e.closeUploadDialog()},resizeStop:function(t,i){e.form&&e.form.resize(i.size)}});var n=e.renderFactory.getTemplate("image-dialog");$.tmpl(n,{scriptData:e.buildAddParams(),url:t.addUrl,xpath:t.xpath,validExtensions:t.validExtensions.replace(";",","),maxSize:t.maxSize}).appendTo(r),$(".ui-bizagi-loading-message").remove()},closeUploadDialog:function(){this.dialogBox.dialog("destroy"),this.dialogBox.remove()},onUploadFileCompleted:function(e,t){var i=e,r=i.getControl(),a=$(".ui-bizagi-render-image-wrapper",r),n=JSON.parse(t),o=0,s=r.width(),l=r.find(".img").size()>0,d=r.find(".resizable_img").width();o=i.properties.isAutoWidth?"image"!=i.properties.type?r.width():"99%":i.properties.width,$(".uploadifyQueueItem",r).css({width:i.properties.width}),"error"!==n.type?(bizagi.util.isEmpty(i.properties.value)&&(i.properties.value=[[0,"uploaded"]]),$.when(i.renderUploadItem()).done((function(e){$(a).empty(),$(a).append(e),i.deleteHandler(),i.triggerRenderChange();var t=setTimeout((function(){var e=!1,a=i.properties.isAutoWidth;a&&"grid"===i.parent.properties.type?($(".img",r).width()<s?o=$(".img",r).width():$(".img",r).width()>=s&&(o=s-20,e=!0),l||$("a",r).closest("td").css("width",d),$("a",r).css({height:"auto"})):$("a",r).css({width:o,height:"auto"}),$(".img, .ui-bizagi-render-image-wrapper .image-file",r).css({width:o,height:"auto"}),$(".ui-bizagi-render-upload-wrapper",r).addClass("uploaded");var n=48;-1!==(i.properties.width+"").indexOf("px")&&(n=(i.properties.width+"").replace("px","")),$(".ui-bizagi-render-image-wrapper .image-file",r).addClass("w-size-"+n),$("img",r).css("width",o),$("img",r).css("height","auto"),$(".image-wrapper",r).css("height","auto"),a&&Number($("a",r).css("width").slice(0,-2))>Number($(".img",r).css("width").slice(0,-2))&&$("a",r).css({width:$(".img",r).css("width")}),"grid"===i.parent.properties.type&&a&&(e?$("a",r).closest(".ui-bizagi-render").css("text-align","left"):i.properties.columnAlign?($("a",r).closest(".ui-bizagi-render").css("text-align",i.properties.columnAlign),$(".image-wrapper",r).css("text-align",i.properties.columnAlign)):$("a",r).closest(".ui-bizagi-render").css("text-align","center")),clearTimeout(t)}),50)}))):n.isMaintenanceWindow||bizagi.showMessageBox(n.message)},buildAddParams:function(){var e=this.properties,t=this.getFormContainer(),i=[],r="savefile";e.isUserPreference&&(r="SAVEUSERIMAGE",i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",value:"entity"}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey",value:this.currentUser})),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath",value:this.getUploadXpath()}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender",value:e.id}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext",value:e.xpathContext}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE,value:e.idPageCache}),i.push({key:this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",value:t.properties.sessionId}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action",value:r}),e.contexttype&&i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",value:e.contexttype});try{"undefined"!=typeof BIZAGI_SESSION_NAME?i.push({key:BIZAGI_SESSION_NAME,value:t.properties.sessionId}):i.push({key:"JSESSIONID",value:t.properties.sessionId})}catch(e){i.push({key:"JSESSIONID",value:t.properties.sessionId})}return i},checkMaxSize:function(){var e=this.properties,t=this.dialogBox,i=$("input[type=file]",t).get(0)||{};return null!=i.files?i.files.length>0?!(i.files[0].size>e.maxSize)||(this.showError(this.getResource("render-upload-alert-maxsize").replace("{0}",e.maxSize)),!1):(this.showError(this.getResource("render-required-upload").replace("#label#","")),!1):!bizagi.util.isIE()||(!(""===i.value||!i.value)||(this.showError(this.getResource("render-required-upload").replace("#label#","")),!1))},checkFileTypes:function(){var e=this.properties,t=this.dialogBox,i=$("input[type=file]",t).val();if(e.validExtensions&&e.validExtensions.length>0){var r=e.validExtensions.replaceAll("*.","").split(";");if(!this.stringEndsWithValidExtension(i,r,!0))return this.showError(this.getResource("render-upload-allowed-extensions")+e.validExtensions),!1}return!0},stringEndsWithValidExtension:function(e,t,i){if(0==i&&0==e.length)return!0;for(var r=0;r<t.length;r++){if("*"==t[r].toLowerCase())return!0;if(e.toLowerCase().endsWith(t[r].toLowerCase()))return!0}return!1},showError:function(e){var t=$("#alert-file-upload",this.dialogBox);t.empty(),t.show(),t.html(e)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},processUploadFile:function(){var e=this,t=new $.Deferred,i=e.dialogBox,r=$("form",i),a=$("iframe",r);return function i(){try{var r="";if(a[0].contentWindow)r=(bizagi.util.isIE8()?$(a[0].contentWindow.document.body):$(a[0].contentWindow.eval("document.body"))).text();if(r.length>0)t.resolve(r);else var n=setTimeout((function(){i(),clearTimeout(n)}),50)}catch(t){e.closeUploadDialog(),bizagi.showMessageBox(t.toString())}}(),r.submit(),t.promise()},cleanData:function(){if(this.hasValue())return $.when(this.deleteImage())}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.searchList",bizagi.rendering.searchList.prototype),bizagi.rendering.desktop.searchList.extend("bizagi.rendering.desktop.searchList",{SEARCH_MIN_LENGTH:2},{postRender:function(){var e=this.getControl();this._super(),this.searchInput=$("input",e),$(e).find("input").css({width:"100%","padding-right":"25px"}),this.applyAutocompletePlugin(),this.attachKeyEvents()},attachKeyEvents:function(){var e=this;e.element.keydown((function(t){var i=(t=window.event||t).charCode||t.keyCode;if(void 0!==t)switch(i){case 8:0===$("input:first",e.element)[0].selectionStart&&(e.removeLastElement(),$("li:nth-last-child(2)",e.element).remove(),$(".biz-render-input-search",e.getControl()).focus())}}))},applyAutocompletePlugin:function(){var e=this,t=e.getControl(),i=e.searchInput;i.autocomplete({autoFocus:!0,messages:{noResults:null,results:function(){}},source:function(t,i){e.activeRequestTerm=t.term;var r=(new Date).getTime(),a=encodeURIComponent(t.term),n=e.properties.xpath+"_"+a+"_expire",o=e.properties.xpath+"_"+a,s=bizagi.util.getItemLocalStorage(n);if(s&&e.properties.enableLocalStorage&&r<s)try{i(JSON.parse(bizagi.util.getItemLocalStorage(o))),e.hideAutocompleteLoading()}catch(r){e.processRequest(t,i)}else e.processRequest(t,i)},select:function(t,r){var a=JSON.parse(e.getValue()).value,n=!0;void 0===r.item.id?n=!1:$.each(a,(function(e,t){if(r.item.id==t.id)return n=!1})),n&&(e.appendFoundItem(t,r),e.changeRequired(!1)),i.autocomplete("close"),r.item.value=""},open:function(){var t=i.data("ui-autocomplete").menu.element,r=i.closest(".ui-bizagi-control"),a=r.parent(),n=e.calculateSuggestionWidth();$("li",t).each((function(){$(this).index()%2<1&&$(this).addClass("biz-ui-even")})),t.css({top:0,left:0}),r.addClass("ac-is-visible"),a.addClass("ac-is-visible ac-clear-floats"),t.appendTo(r).position({my:"left top",at:"left bottom",of:this,collision:"flipfit"}),t.css("z-index",$.getMaxZindex()+10),t.attr("visible",!0),$(".ui-bizagi-render-search-item",t).width(n),t.width(n),e.hideAutocompleteLoading()},close:function(){i.data("ui-autocomplete").menu.element.attr("visible",!1)},delay:this.Class.SEARCH_DELAY,minLength:e.Class.SEARCH_MIN_LENGTH}),i.data("ui-autocomplete")._renderItem=function(t,i){return e.renderSearchItem(i).appendTo(t)},$("[data-action=remove]",t).click((function(){e.deleteItem($(this))}))},appendFoundItem:function(e,t){var i,r=this,a=this.getControl(),n=$(".biz-render-input-search",a).closest("ul"),o=$("li:last",n);t.item.value=r.formatItem(t.item.value);var s=r.renderFactory.getTemplate("searchListTag");i=$.fasttmpl(s,{id:t.item.id,value:t.item.value,editable:!0},{formatItem:r.formatItem}),$(o).before(i),$("[data-action=remove]",n).click((function(){r.deleteItem($(this))})),$(".biz-render-input-search",a).data("selected","1"),$(".biz-render-input-search",a).focus(),$("li",n).removeClass("selected"),this.addElement({id:t.item.id,value:t.item.value})},deleteItem:function(e){var t=this.getControl(),i=e.parent(".bz-pill");this.removeElement({id:i.data("id")}),i.remove(),0===JSON.parse(this.value).value.length&&this.changeRequired(this.properties.required),$(".biz-render-input-search",t).focus()},renderSearchItem:function(e){var t=this.properties,i=this.renderFactory.getTemplate("searchItem"),r=$.tmpl(i,{image:t.searchImage,label:e.label,orientation:this.properties.orientation||"lrt"});return r.data("item.autocomplete",e),r},processRequest:function(e,t){var i=this,r=i.properties;i.showAutocompleteLoading();var a=[];e.term.length>=this.Class.SEARCH_MIN_LENGTH&&(r.term=e.term,$.when(this.getData()).done((function(n){(n=n.slice(0,r.maxRecords)).length>50?(n=n.slice(0,50),a.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-search-maximum-records-allowed"),value:""})):n=n.slice(0,r.maxRecords),n&&n.length>0?$.each(n,(function(t,i){if(0==r.maxRecords||t<r.maxRecords){var n=bizagi.util.performTermMatches(i.value,e.term);a.push({id:i.id,label:n,value:i.value})}})):a.push({id:i.Class.NO_RESULTS_SEARCH_ID,label:i.getResource("render-grid-no-records"),value:""}),function(e,r){var a=(new Date).getTime()+i.properties.expireCache,n=encodeURIComponent(r);if(i.properties.enableLocalStorage){var o=i.properties.xpath+"_"+n+"_expire",s=i.properties.xpath+"_"+n;bizagi.util.setItemLocalStorage(o,a),bizagi.util.setItemLocalStorage(s,JSON.encode(e))}t(e)}(a,e.term),i.hideAutocompleteLoading()})))},showAutocompleteLoading:function(){$("i",this.getControl()).addClass("ui-autocomplete-loading")},hideAutocompleteLoading:function(){$("i",this.getControl()).removeClass("ui-autocomplete-loading")},calculateSuggestionWidth:function(){return this.searchInput.data("ui-autocomplete").menu.element.width()},setDisplayValue:function(e){void 0!==e&&this.properties.editable&&this.searchInput.val(e.label)},getDisplayValue:function(){return this.selectedValue},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.properties.value.map((function(t){return e.formatItem(t.value)})).join(", "),r=$.tmpl("<label class='readonly-control'>${value}</label>",{value:i});t.empty(),t.append(r)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.association",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.association.extend("bizagi.rendering.desktop.association",bizagi.rendering.association.prototype),bizagi.rendering.desktop.association.extend("bizagi.rendering.desktop.association",{},{postRender:function(){},configureHandlers:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=e.getControl();e._super(),$("ol .deleteBotton",i).bind("click",(function(){e.closeElement($(this).parent("li"))})),$(".bz-render-association-accordion",i).togglepanels({header:"> div > h3",autoHeight:!1,animated:!1}),$.when(e.isRendered()).done((function(){$(".bz-render-association-accordion h3",i).first().click()})),e.properties.allowFlip&&$(".bz-render-association .flip-arrow",i).bind("click",(function(){$(i).empty(),e.properties.flipped=!e.properties.flipped,e.properties.flipstate=e.properties.flipped,e.dataService.getFlipAssociation(e.properties),$.tmpl(t,e.properties,{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation}).appendTo(i),e.internalPostRender()})),e.properties.editable&&($(".bz-render-association bz-render-association-check-mask, .bz-render-association .bz-render-association-check",i).bind("click",(function(t){t.stopPropagation();var i=$(this),r=$(this).parents("ol").data("id"),a=$(this).data("id");i.prop("checked")?(i.prop("checked",!0),e.addElement(r,a)):(i.prop("checked",!1),e.removeElement(r,a))})),$(".bz-render-association .bz-render-association-left-container li",i).bind("click",(function(t,i){t.stopPropagation();var r=$(this).find("input").length>0?$(this).find("input"):$(this),a=$(".bz-render-association-check-mask",$(this)),n=$(this).parent("ol").data("id"),o=$(this).data("id")||$(this).parents("li").data("id");r.prop("checked")?(r.removeAttr("checked"),a.removeClass("checked"),a.addClass("unchecked"),e.removeElement(n,o)):(r.prop("checked",!0),a.removeClass("unchecked"),a.addClass("checked"),e.addElement(n,o))})))},setBindToClose:function(e){var t=this;e.find(".deleteBotton").bind("click",(function(){t.closeElement($(this).parent("li"))}))},closeElement:function(e){var t=e.parent("ol");this.removeElement($(t).data("id"),e.data("id")),e.hide("highlight",1e3,(function(){$(this).remove()}))},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.renderFactory.getTemplate("association");e.properties.classCss="read-only",e.makeJsonBase(),$.tmpl(i,e.properties,{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation,getLeftName:e.getLeftName}).appendTo(t),$(".bz-render-association-accordion",t).togglepanels({header:"> div > h3",autoHeight:!1}),$.when(e.isRendered()).done((function(){$(".bz-render-association-accordion h3",t).first().click()})),e.properties.allowFlip&&$(".bz-render-association .flip-arrow",t).bind("click",(function(){$(t).empty(),e.properties.flipped=!e.properties.flipped,e.postRenderReadOnly()}))},collectData:function(e){this._super(e)},renderReadOnly:function(){var e=this.getValue();return"object"===_typeof(e)?"":e}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.upload",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.upload.extend("bizagi.rendering.desktop.upload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.upload.prototype),bizagi.rendering.desktop.upload.extend("bizagi.rendering.desktop.upload",{},{renderControl:function(){for(var e=this.properties,t=this.renderFactory.getTemplate("upload"),i=$.fasttmpl(t,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),editable:e.editable,haveFiles:0!=this.filesCount,allowSendInMail:e.allowSendInMail}),r="",a=0;a<this.filesCount;a++){var n={id:this.files[a][0],fileName:this.files[a][1]};r+=this.renderUploadItem(n)}return i=this.replaceFilesHtml(i,r)},renderElement:function(){return this._super("render-base")},postRender:function(){this._super(),this.isClicked=!1,this.properties.allowSendInMail&&this.bindEmailDialog(),this.checkMaxFiles(),this.preventDefaultForAnchorTag()},postRenderReadOnly:function(){this._super(),this.properties.allowSendInMail&&this.bindEmailDialog()},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeCellRequired:function(e){this.changeRequired(e)},setValidationMessage:function(e){this._super(e);var t=$(".ui-bizagi-render-icon-error",this.element);$(t).parent().removeClass("ui-hidden")},bindEmailDialog:function(){var e=this.getControl(),t=this.getXpathContext()||"",i=this.properties.xpath,r="rtl"===this.properties.orientation?"dialog-send-email-rtl":"dialog-send-email";$(".ui-bizagi-render-upload-sendmail",e).bizagiSendEmail({tmpl:this.renderFactory.getTemplate(r),value:this.value,self:this,dataService:this.dataService,properties:this.properties,xpath:i,xpathContext:t})},bindExternalPopup:function(){var e=this,t=e.getControl(),i=e.getParams(),r=e.properties,a=!!e.grid,n={idCase:i.idCase||bizagi.context.idCase,idWorkitem:i.idWorkitem||bizagi.context.idWorkitem,field:r.xpath.split(".")[r.xpath.split(".").length-1]},o=e.getXpathContext(),s=r.xpath;a||""!==o?"string"==typeof o?$.extend(n,{xPath:o.split("[")[0]+"."+s}):$.extend(n,{xPath:e.grid.properties.xpath+"."+s}):$.extend(n,{xPath:s}),$(".ui-bizagi-render-upload-sendmail",t).tooltip(),$(".ui-bizagi-render-upload-sendmail",t).click((function(){var t="App/Upload/SendAttachedDocs.aspx?";t+="idCase="+n.idCase,t+="&idWorkitem="+n.idWorkitem,t+="&xPath="+n.xPath,t+="&field="+n.field,e.dataService.getCaseNumber({idCase:n.idCase}).done((function(i){var r=i.caseNumber;t+="&radNumber="+(r=r||n.idCase);var a=[];if(e.value)for(var o=0;o<e.value.length;o++)a.push(e.value[o][1]);e.currentPopup="genericiframe",$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:t,injectCss:[".ui-bizagi-old-render*",".ui-bizagi-old-render-upload"],modalParameters:{title:"Send attached documents",id:"sendEmail"},afterLoad:function(e){var t=document.getElementById("btnClose");if(t&&(t.style.display="none"),(t=document.getElementById("btnCloseConfirm"))&&(t.style.display="none"),e&&e.values){var i=e.values,r=document.getElementsByTagName("label");if(r)for(var a=0;a<r.length;a++){var n=r[a];void 0!==n.innerText&&-1===i.indexOf(n.innerText)&&(n.control?(n.control.checked=!1,n.parentElement.style.display="none"):(n.previousSibling.checked=!1,n.parentElement.style.display="none")),void 0!==n.textContent&&-1===i.indexOf(n.textContent)&&(n.control?(n.control.checked=!1,n.parentElement.style.display="none"):(n.previousSibling.checked=!1,n.parentElement.style.display="none"))}}},afterLoadParams:{values:a}})}))}))},configureHandlers:function(){var e=this,t=e.getControl(),i=e.properties;e._super(),e.pluginUpload=$(".ui-bizagi-render-upload-wrapper",t).bizagiUpload({renderReference:this,dialogTemplate:e.renderFactory.getTemplate("upload.dialog"),properties:{url:i.addUrl,xpath:this.getUploadXpath(),idRender:i.id,xpathContext:e.getUploadXpathContext(),idPageCache:i.idPageCache,idSession:i.sessionId,validExtensions:i.validExtensions,maxSize:i.maxSize,contexttype:i.contexttype,networkSpeed:networkSpeed()},onUploadFileCompletedCallback:e.onUploadFileCompleted,onChangeFile:e.onChangeFile,onCheckMaxSize:e.checkMaxSize,onValidate:e.validate,maxAllowedFiles:i.maxfiles,uploadedFiles:e.filesCount,dialogTitle:e.getResource("render-upload-link-label")}),t.off("click").on("click",".bz-file-name",(function(t){t.preventDefault();var i=$(this).closest(".ui-bizagi-render-upload-item");e.downloadFile(i.data())})),t.on("click",".bz-btn-icn--delete",(function(){var t=$(this).closest(".ui-bizagi-render-upload-item"),i=t.data();$.when(e.deleteUploadItem(t,i.id)).done((function(){t.hide(),t.remove(),e.checkMaxFiles(),e.setValue(e.files,!1),e.triggerRenderChange()}))}))},configureHandlersReadOnly:function(){var e=this;e.getControl().off("click").on("click",".bz-file-name",(function(t){var i=$(this).closest(".ui-bizagi-render-upload-item");e.downloadFile(i.data())}))},downloadFile:function(e){var t=this,i=t.properties;t.dataService.getFile({idRender:i.id,xpath:i.xpath,xpathContext:t.getXpathContext(),idPageCache:i.idPageCache,fileId:e.id,contexttype:i.contexttype}).then((function(e){return bizagi.util.handleJSONResponse(e)})).then((function(t){bizagi.util.downloadBlobFile(t,e.filename)})).fail((function(e){var i=t.getFormContainer();i&&i.failHandler(e)}))},openUploadDialog:function(){var e=this,t=e.properties,i=window.document;e.isClicked=!1;var r=e.dialogBox=$("<div class='ui-bizagi-component-loading'/>");r.empty(),r.appendTo("body",i);var a={};a[e.getResource("render-upload-dialog-select")]=function(t){t.stopPropagation(),e.isClicked||(e.isClicked=!0,e.checkMaxSize()&&e.checkFileTypes()&&!e.maxFilesLimit()?$.when(e.processUploadFile()).done((function(t){e.onUploadFileCompleted(t),e.closeUploadDialog()})):e.isClicked=!1)},a[e.getResource("text-cancel")]=function(){e.closeUploadDialog()},r.dialog({width:500,height:350,title:e.getResource("render-upload-link-label"),modal:!0,buttons:a,close:function(){e.closeUploadDialog()},resizeStop:function(t,i){e.form&&e.form.resize(i.size)}});var n=e.renderFactory.getTemplate("upload.dialog");$.tmpl(n,{url:t.addUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,idSession:t.sessionId,validExtensions:t.validExtensions.replace(";",","),maxSize:t.maxSize,contexttype:t.contexttype}).appendTo(r),$(".ui-bizagi-loading-message").remove()},processUploadFile:function(){var e=this,t=new $.Deferred,i=e.dialogBox,r=$("form",i),a=$("iframe",r);return function i(){try{var r="";if(a[0].contentWindow)r=(bizagi.util.isIE8()?$(a[0].contentWindow.document.body):$(a[0].contentWindow.eval("document.body"))).text();if(r.length>0)t.resolve(r);else var n=setTimeout((function(){i(),clearTimeout(n)}),50)}catch(t){e.closeUploadDialog(),window.alert("Error:"+t.toString())}}(),r.submit(),t.promise()},closeUploadDialog:function(){this.isClicked=!1,this.dialogBox.dialog("destroy"),this.dialogBox.remove()},maxFilesLimit:function(){return this.filesCount>=this.properties.maxfiles},checkMaxFiles:function(){this.properties;var e=this.getControl(),t=$(".ui-bizagi-render-upload-wrapper",e);this.maxFilesLimit()?(bizagi.util.cssExtended(t.find("a"),"display:none!important"),this.enabled=!1):(bizagi.util.cssExtended(t.find("a"),"display:block!important"),this.enabled=!0),0==this.filesCount?$(".no-files",e).css("display","block"):$(".no-files",e).hide()},onChangeFile:function(e){var t,i=0,r=this.properties.maxSize;if(e)for(t=e.length;i<t;)if(e[i++].size>r)return void(this.previousCheck=!1);this.previousCheck=!0},getDefaultValueAlign:function(){return""},onUploadFileCompleted:function(e,t){var i=e,r=i.getControl(),a=$(".ui-bizagi-render-upload-wrapper",r);t=t.replace(/<.+>({.*})\r?\n?.*<.+>/gm,"$1");try{var n=JSON.parse(t)}catch(e){var o=[{toFind:"Maximum request length",message:i.getResource("render-upload-alert-maxsize").replace("{0}",i.properties.maxSize)}];$.each(o,(function(e,i){t.indexOf(i.toFind)>=0&&!n&&(n={type:"error",message:i.message})})),n||(n={type:"error",message:"Error:"+n})}if("error"!=n.type){var s=i.renderUploadItem({id:n.id,fileName:n.fileName});$(s).insertBefore(a),i.processControlLayout(i.properties.valueFormat),i.filesCount=i.filesCount+1;var l=i.files.slice();l.push([n.id,n.fileName]),i.checkMaxFiles(),i.setValue(l,!1),i.triggerRenderChange(),void 0!==i.grid&&void 0!==i.grid.properties&&(i.grid.properties.canBeExported=!0)}else"Error:undefined"===n.message&&t.indexOf("HTTP Error 404.13")>-1&&(n.message=i.getResource("render-upload-iis-maxsize")),n.isMaintenanceWindow||bizagi.showMessageBox(n.message)},changeFontItalic:function(e,t){return this._super(e,t),e.hasClass("ui-bizagi-render-control")&&bizagi.util.parseBoolean(t)&&this.getElementsToStylize(control).css("padding","0 .1em"),this},getElementsToStylize:function(e){return $(".ui-bizagi-render-upload-item .bz-file-name, .no-files",e)},checkMaxSize:function(e){var t=e,i=t.properties,r=t.dialogBox,a=$("input[type=file]",r).get(0);return null!=a.files?a.files.length>0?0===a.files[0].size?(t.showError(t.getResource("render-upload-error-file-empty").replace("%s",a.files[0].name)),!1):!(a.files[0].size>i.maxSize)||(t.showError(t.getResource("render-upload-alert-maxsize").replace("{0}",i.maxSize)),!1):(t.showError(t.getResource("render-required-upload").replace("#label#","")),!1):!bizagi.util.isIE()||(""!==a.value&&a.value?!!t.previousCheck||(!(document.documentMode>9)||(t.showError(t.getResource("render-upload-alert-maxsize").replace("{0}",i.maxSize)),!1)):(t.showError(t.getResource("render-required-upload").replace("#label#","")),!1))},checkFileTypes:function(){var e=this.properties,t=this.dialogBox,i=$("input[type=file]",t).val();if(e.validExtensions&&e.validExtensions.length>0){var r=e.validExtensions.replaceAll("*.","").split(";");if(!this.stringEndsWithValidExtension(i,r,!0))return this.showError(this.getResource("render-upload-allowed-extensions")+e.validExtensions),!1}return!0},validate:function(e){var t=e,i=(t.properties,$("input[type=file]",t.dialogBox).get(0)||{});if(t.files)for(var r=0;r<t.files.length;r++){if(t.files[r][1].toUpperCase()==i.files[0].name.toUpperCase())return t.showError(t.getResource("render-upload-error-file-exists")),!1}return!0},stringEndsWithValidExtension:function(e,t,i){if(0==i&&0==e.length)return!0;for(var r=0;r<t.length;r++){if("*"==t[r].toLowerCase())return!0;if(e.toLowerCase().endsWith(t[r].toLowerCase()))return!0}return!1},showError:function(e){var t=$("#alert-file-upload",this.dialogBox);t.empty(),t.show(),t.html(e)},cleanData:function(){return this.setValue(null),$.when(this.clearDisplayValue())},clearDisplayValue:function(){var e=this,t=e.getControl().find(".ui-bizagi-render-upload-item"),i=[];return $.each(t,(function(t,r){var a=$(r),n=a.data();if(n){var o=$.when(e.deleteUploadItem(a,n.id)).done((function(){a.remove(),e.triggerRenderChange()}));i.push(o)}})),t.hide(),e.filesCount=0,e.checkMaxFiles(),$.when.apply($,i)},setDisplayValue:function(e){var t;this.properties.editable&&e&&0===e.length&&((t=this.getControl().find(".ui-bizagi-render-upload-item")).hide(),t.remove(),this.checkMaxFiles()),this._super(e)},getLabel:function(){return $("label",this._super())}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.getUser",bizagi.rendering.getUser.prototype),bizagi.rendering.desktop.getUser.extend("bizagi.rendering.desktop.getUser",{},{postRender:function(){this.input=$(".ui-bizagi-render-text",this.getControl()),null!=this.properties.value&&this.properties.value.length>0&&this.setDisplayValue(this.properties.value[0]),this._super()},configureHandlers:function(){var e=this,t=e.getControl();e.bindSearchUserPlugin(t),$("#btn-clear-user",t).on("click",(function(){e.clearValue()}))},setDisplayValue:function(e,t){t=0!=t||t;var i=void 0!==e?e.value:null;this.properties.editable&&this.input.val(i),this.setValue(e,t)},clearValue:function(){this.input&&this.setDisplayValue("",!1)},bindSearchUserPlugin:function(e){var t=this,i={title:t.getResource("render-plugin-search-users-title"),maximize:!1,filters:["domain","userName","fullName"],displayNames:[t.getResource("render-plugin-search-users-domain"),t.getResource("render-plugin-search-users-user-name"),t.getResource("render-plugin-search-users-full-name")],searchButtonName:t.getResource("render-plugin-search-users-search-button-name"),clearButtonName:t.getResource("render-plugin-search-users-clear-button-name"),valuesToSelect:["iduser","user"],renderFactoryReference:t.renderFactory,getResourceReference:t.getResource.bind(t),selectItem:function(){var e=$.Deferred();return e.done((function(e){t.onItemSelectedSuccess(e)})).fail((function(e){bizagi.log(e)})),e},searchUsers:function(e){return t.callSearchUserEndpointByContext(t.properties,e)},showError:function(e){bizagi.log(e)},showMessageBox:function(e){bizagi.showMessageBox(bizagi.localization.getResource(e),"Bizagi","warning")}};t.properties.allowDelegatedUser&&(i.editingUser=t.properties.idUser),opt=i;var r=t.getParams();void 0!==r.isEntityForm&&r.isEntityForm&&(i.allowAddUser=bizagi.menuSecurity.UserAdmin||!1,i.dataService=t.dataService,i.renderFactory=t.renderFactory),$("#btn-get-user",e).bizagiSearchUser(i)},callSearchUserEndpointByContext:function(e,t){return"usersForm"===this.getFormContainer().params.type?this.callSearchUserEndpointInUsersForm(e,t):"userPreferencesForm"===this.getFormContainer().params.context?this.callSearchUserEndpointInUserPreferencesForm(e,t):this.callSearchUserEndpointInOtherCases(e,t)},callSearchUserEndpointInUsersForm:function(e,t){return"idBossUser"===e.xpath?this.dataService.getUsersListForXpathIdBossUser(t):this.xpathIsDelegated(e)?this.dataService.getUsersListForXpathIdDelegate(t):this.callSearchUserEndpointInOtherCases(e,t)},callSearchUserEndpointInUserPreferencesForm:function(e,t){if(this.xpathIsDelegated(e))return this.dataService.getUsersListForXpathIdDelegate(t)},xpathIsDelegated:function(e){return"idDelegate"===e.xpath},callSearchUserEndpointInOtherCases:function(e,t){return e.allowDelegatedUser?this.dataService.getUsersListFromPreferences(t):this.dataService.getUsersListForStakeholders(t)},getOptions:function(){return opt},onItemSelectedSuccess:function(e){var t={id:e.iduser,value:e.user};this.setDisplayValue(t)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},changeRequiredControl:function(e){this.changeRequiredLabel(e)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.queryProcess",bizagi.rendering.queryProcess.prototype),bizagi.rendering.desktop.queryProcess.extend("bizagi.rendering.desktop.queryProcess",{},{postRender:function(){var e=this;this._super();e.renderFactory.getTemplate("queryProcessWrapper"),e.getControl();e.getElement("row").bind("click",(function(){var t=e.getWrapper();if(t.properties.visible)t.element.hide(),t.element.css("visibility","hidden"),t.element.empty();else{t.element.show(),t.element.css("visibility","visible");var i=e.loadData("aplications");e.renderData(i,t.element)}}))},getWrapper:function(){var e=this.getElement("wrapper"),t={element:e,properties:{}};return t.properties.visible="visible"===e.css("visibility"),t},getElement:function(e){var t=this.getControl();return{row:$(".ui-selectmenu-btn , .ui-bizagi-container-query-process :input[type=text]",t),wrapper:$(".ui-selectmenu-wrapper",t),linkApplication:$(".linkApplication",t)}[e]},loadData:function(e){if("aplications"==e)var t={items:[{id:1,displayName:"My App 1"},{id:2,displayName:"My App 2"},{id:3,displayName:"My App 3"}]};if("process"==e)t={items:[{id:4,displayName:"My Category 1",process:!1},{id:5,displayName:"My Process 1",process:!0},{id:6,displayName:"My Category 2",process:!1}]};return t},renderData:function(e,t){$(t).empty(),void 0===e.items[0].process&&t.append('<a class="linkApplication" data-idcategory="0" data-typeitem="process"><i class="biz-ico biz-wp-tree-icon biz-wp-tree-image-process"></i>All process </a>'),$.each(e.items,(function(e,i){t.append('<a class="linkApplication" data-idCategory="'+i.id+'"><i  name="app" class="biz-wp-tree-icon biz-wp-tree-expand-icon"></i><i class="biz-ico biz-wp-tree-icon"></i>'+i.displayName+"</a>");var r=$("[data-idCategory="+i.id+"]",t);if(i.process){r.find("i").last().addClass("biz-wp-tree-image-process"),r.find("i").first().remove(),r.css("margin-left","25px"),r.attr("data-typeItem","process")}else{if(0==i.process)r.find("i").last().addClass("biz-wp-tree-image-category"),r.attr("data-typeItem","category");else r.find("i").last().addClass("biz-wp-tree-image-application"),r.attr("data-typeItem","app");var a="ui-selectmenu-wrapper"!=$(t).attr("class")?$(t).attr("id").replace("category_",""):"",n=""!=a?"category_"+a+"-"+i.id:"category_"+i.id;t.append("<div class='ui-bizagi-contCategory' id='"+n+"'></div>")}})),this.setupLinks(t)},setupLinks:function(e){var t=this;$(".linkApplication",e).on("click",(function(){var i=$(this).attr("data-idCategory"),r="ui-selectmenu-wrapper"!=$(e).attr("class")?$(e).attr("id").replace("category_",""):"",a=""!=r?$("#category_"+r+"-"+i):$("#category_"+i);if("process"==$(this).attr("data-typeItem")){var n=$(this).text(),o=t.getWrapper();o.element.hide(),o.element.css("visibility","hidden");var s="",l=this,d=[];if($(this).attr("data-idcategory")>0)for(;"app"!=s||null==s;)s=(l=$(l).closest("div").prev())[0].getAttribute("data-typeItem"),d.push(l.text());o.element.empty(),d=""==(d=d.reverse().join(" > "))?n:d+=" > "+n,$(".ui-bizagi-container-query-process :input[type=text]").val(d)}else{var c=$(this).find("i").first();if("visible"===a.css("visibility"))c.addClass("biz-wp-tree-expand-icon"),c.removeClass("biz-wp-tree-collapse-icon"),a.hide(),a.css("visibility","hidden"),a.empty();else{var u=t.loadData("process");c.removeClass("biz-wp-tree-expand-icon"),c.addClass("biz-wp-tree-collapse-icon"),a.show(),a.css("visibility","visible"),t.renderData(u,a)}}}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.querySearchUser",bizagi.rendering.querySearchUser.prototype),bizagi.rendering.desktop.querySearchUser.extend("bizagi.rendering.desktop.querySearchUser",{},{initializeData:function(e){this._super(e)},postRender:function(){this.input=$(".ui-bizagi-render-text",this.getControl()),this._super()},setDisplayValue:function(e){e="object"===_typeof(e)?"object"===_typeof(e[0])&&void 0!==e[0].label?e[0].label:e.label:"";var t=this.properties;this._super(e),!bizagi.util.isEmpty(e)&&t.editable&&this.input.val(e)},configureHandlers:function(){var e=this.getControl();this.bindSearchUserPlugin(e)},bindSearchUserPlugin:function(e){var t=this,i=t.getFormContainer().properties.id,r={title:t.getResource("render-plugin-search-users-title"),filters:["domain","userName","fullName"],displayNames:[t.getResource("render-plugin-search-users-domain"),t.getResource("render-plugin-search-users-user-name"),t.getResource("render-plugin-search-users-full-name")],searchButtonName:t.getResource("render-plugin-search-users-search-button-name"),clearButtonName:t.getResource("render-plugin-search-users-clear-button-name"),valuesToSelect:["iduser","username"],renderFactoryReference:t.renderFactory,getResourceReference:t.getResource.bind(t),selectItem:function(){var e=$.Deferred();return e.done((function(e){t.onItemSelectedSuccess(e)})).fail((function(e){bizagi.log(e)})),e},searchUsers:function(e){return t.dataService.getUsersListFromQueryForm($.extend(e,{queryFormId:i}))},showError:function(e){bizagi.log(e)},showMessageBox:function(e){bizagi.showMessageBox(bizagi.localization.getResource(e),"Bizagi","warning")}};opt=r,$("#btn-get-user",e).bizagiSearchUser(r)},getOptions:function(){return opt},onItemSelectedSuccess:function(e){var t=this.getControl();$(".ui-bizagi-render-text",t).val(e.username);var i={};i.id=e.iduser,i.label=e.username,i.value=e.username,this.setValue(i)}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.comboSelected",bizagi.rendering.comboSelected.prototype),bizagi.rendering.desktop.comboSelected.extend("bizagi.rendering.desktop.comboSelected",{},{postRender:function(){this._super();var e=this.getControl();this.showInitialData(this.properties.value),this.selectedItemsToUpdate.length>=0&&$.each(this.selectedItemsToUpdate,(function(t,i){$("#listBoxComboData",e).append("<option value='"+i.id+"'>"+i.value+" </option>")})),$(e).closest(".ui-bizagi-render-control").addClass("ui-bizagi-render-comboselected")},orderArrayList:function(){var e=this.properties.value.sort((function(e,t){var i=void 0!==e.value&&null!==e.value?e.value.toLowerCase():"",r=void 0!==t.value&&null!==t.value?t.value.toLowerCase():"";return i<r?-1:i>r?1:0}));this.properties.value=e},configureHandlers:function(){var e=this,t=e.getControl();$("#move_right",t).click((function(i){e.addItem();var r=$("#bz-render-comboSelected-listBoxResults .ui-bizagi-render-text",t);e.filterFunction(r.val(),e.rightValues,$("#bz-render-comboSelected-listBoxResults select",t)),r.focus()})),$("#move_left",t).click((function(i){e.removeItem();var r=$("#bz-render-comboSelected-selectOptions .ui-bizagi-render-text",t);e.filterFunction(r.val(),e.leftValues,$("#bz-render-comboSelected-selectOptions select",t)),r.focus()})),$("#bz-render-comboSelected-selectOptions .ui-bizagi-render-text",t).bind("keyup input",(function(i){e.filterFunction(this.value,e.leftValues,$("#bz-render-comboSelected-selectOptions select",t))})),$("#bz-render-comboSelected-listBoxResults .ui-bizagi-render-text",t).bind("keyup input",(function(i){e.filterFunction(this.value,e.rightValues,$("#bz-render-comboSelected-listBoxResults select",t))}))},filterFunction:function(e,t,i){$(i).empty();var r=t.reduce((function(t,i){return-1!==i.value.toUpperCase().indexOf(e.toUpperCase())&&(t+="<option value='"+i.id+"'>"+i.value+" </option>"),t}),"");i.append(r)},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},setDisplayValue:function(e){this.setValue(e,!1)},addItem:function(){var e=this,t=e.getControl(),i=$("#selectionData option:selected",t);$("#listBoxComboData",t);$.each(i,(function(t,i){var r={id:parseInt(i.value),value:i.text};$.grep(e.selectedItemsToUpdate,(function(e){return e.id==r.id})).length<=0&&(e.selectedItemsToUpdate.push(r),e.rightValues.push(r),e.leftValues=$.grep(e.leftValues,(function(e){return e.id!=r.id})))})),i.remove(),e.setValue(e.selectedItemsToUpdate)},removeItem:function(){var e=this,t=e.getControl(),i=$("#listBoxComboData option:selected",t),r=$("#selectionData",t);$.each(i,(function(t,i){var a={id:parseInt(i.value),value:i.text};$.grep(r,(function(e){return e.id==a.id})).length<=0&&(e.leftValues.push(a),e.rightValues=$.grep(e.rightValues,(function(e){return e.id!=a.id})),e.selectedItemsToUpdate=$.grep(e.selectedItemsToUpdate,(function(e){return e.id!=a.id})))})),i.remove(),e.setValue(e.selectedItemsToUpdate)},showListBoxComboData:function(){var e=this.getControl();$("#move_left",e).show(),$("#bz-render-comboSelected-listBoxResults",e).show()},showInitialData:function(e){var t=this;t.orderArrayList(),t.selectedItemsToUpdate=[],e&&$.each(e,(function(e,i){t.selectedItemsToUpdate.push({id:i.id,value:i.value})}))},renderReadOnly:function(){var e=this.renderFactory.getTemplate("render-comboSelectedReadOnly");return this.showInitialData(this.properties.value),$.fasttmpl(e,{datasource:this.selectedItemsToUpdate})},hasValue:function(){var e="string"==typeof this.value?JSON.parse(this.value).value:this.value;return!bizagi.util.isEmpty(e)},setValue:function(e,t){this.properties.previousValue=this.properties.originalValue=JSON.stringify({value:this.value}),this.value=this.properties.value=JSON.stringify({value:e}),this.properties.required&&"execution"==this.getMode()&&(this.checkRequired([])?this.changeRequiredLabel(!1):this.changeRequiredLabel(!0)),(t=void 0===t||t)&&!this.internalSetInitialValueFlag&&(this.triggerRenderChange(),this.triggerRenderValidate())}}),bizagi.rendering.desktop.form.extend("bizagi.rendering.desktop.usersForm",{},{init:function(e){this.form=this.getFormContainer(),this.observableElement=$({}),this.collectedValues={},this._super(e)},startLoading:function(){var e=this.renderFactory.getTemplate("form-waiting");if(!this.waitingOverlay||!this.waitingMessage){var t=$(this.params.canvas).closest(".ui-dialog"),i=t.offset();this.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo(t),this.waitingMessage=$.tmpl(e).appendTo($("body",$(document))),this.waitingMessage.css({top:i.top+Math.ceil((t.height()-this.waitingMessage.outerHeight())/2)+"px",left:i.left+Math.ceil((t.width()-this.waitingMessage.outerWidth())/2)+"px"})}},processButtons:function(){var e=this,t=e.getButtons();t&&0!==t.length&&("rtl"===e.properties.orientation&&e.buttons.reverse(),t.click((function(){var t=$(this).attr("ordinal"),i=e.buttons[t];e.processButton(i)})))},processButton:function(e){var t=this;t.validationController.clearValidationMessages(),$.when(t.ready()).done((function(){switch(e.action){case"save":var i=t.form.getRender("sendMail"),r=t.form.getRender("password"),a={formAction:"save",sendMail:i&&i.getValue()||!1,password:null===r?"":r.getValue()};i&&r&&a.sendMail&&""===a.password?$.when(t.dataService.getConfiguration()).done((function(e){if(e.redirectErrorPage)window.location.href=e.redirectErrorPage;else{var i=e.passwordMinLength,n=e.passwordMaxLength;t.generateRandomPassword(r,i,n),a.password=r.getValue(),t.processSave(a)}})).fail((function(e){t.generateRandomPassword(r,8,12),a.password=r.getValue(),t.processSave(a);var i=JSON.parse(e.responseText);t.validationController.showValidationMessage(i.message)})):t.processSave(a);break;case"cancel":t.triggerHandler("endUsersForm",{formAction:"cancel",sendMail:!1})}}))},processSave:function(e){var t=this;if(t.validationController.performValidations()){var i;t.startLoading(),$.extend(t.collectedValues,t.collectRenderValuesForSubmit());var r={action:"SAVEUSER",data:{},contexttype:"entity",idPageCache:t.idPageCache};delete t.collectedValues.sendMail,delete t.collectedValues["@Metadata.Stakeholders"],"add"===t.params.action?i=t.createUser(r,e):"edit"===t.params.action&&(i=t.updateUser(r)),$.extend(e,r.data),$.when(i).done((function(){t.triggerHandler("endUsersForm",e)})).fail((function(i){var r=i;i&&i.responseText&&(r=JSON.parse(i.responseText)),t.endLoading(),t.validationController.showValidationMessage(r.message),t.triggerHandler("endUsersForm",$.extend(e,{error:r}))}))}else t.validationController.expandNotificationBox()},generateRandomPassword:function(e,t,i){for(var r=this.getLengthPassword(t,i),a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz",n="",o=0;o<r;o++){var s=Math.floor(Math.random()*a.length);n+=a.substring(s,s+1)}e.saveValue(n)},getLengthPassword:function(e,t){return e=e&&t?e:8,t=t&&e?t:12,Math.floor(Math.random()*(t-(e-1)))+e},createUser:function(e,t){var i=this,r=i.getCollectedData();$.extend(e,{data:{domain:r.domain,fullName:r.fullName,userName:r.userName},prepare:!0});var a=i.dataService.submitData(e);a.tag="submitData",delete r.userName,delete r.domain,$.extend(e,{data:r,surrogatekey:!1,prepare:!0});var n=i.dataService.submitData(e);n.tag="performAction";var o=[];return o.push(a),o.push(n),$.when(i.dataService.multiaction().execute({actions:o})).then((function(e){var r={};e&&bizagi.util.isArray(e)&&e.length>0&&(r=e[0]&&e[0].result||{}),i.params.action="edit",i.params.userId=r.idEntity||void 0,$.extend(t,{userId:r.idEntity||void 0})}))},updateUser:function(e){var t=this.collectedValues;return $.extend(e,{data:t,surrogatekey:this.params.userId}),this.dataService.submitData(e)},getCollectedData:function(){var e=this.collectedValues,t=this.form.getRender("expiredAccount"),i=this.form.getRender("lockedAccount"),r=this.form.getRender("domain");return e.expiredAccount=t?t.getValue():null,e.lockedAccount=i?i.getValue():null,e.domain=r?r.getValue():"",e}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.stakeholder",bizagi.rendering.stakeholder.prototype),bizagi.rendering.desktop.stakeholder.extend("bizagi.rendering.desktop.stakeholder",{},{postRender:function(){this.getControl();var e=$(".ui-bizagi-render-stakeholder-container").closest(".ui-bizagi-control.ui-bizagi-render-align-left ");e.css("width","100%"),e.prev().css("display","none"),this.maxElemShow=10,this.maxPageToShow=5,this.selectedItems=[],this.valueXpath,this.guidEntity,this.currentPage,this._super()},configureHandlers:function(){var e=this,t=e.getControl();$("#ui-bizagi-render-stakeholder-add",t).click($.proxy(e.addInstance,e)),$(".ui-bizagi-render-stakeholder-entity-row",t).click($.proxy(e.addGrid,e)),$(".ui-bizagi-render-stakeholder-back",t).click($.proxy(e.goToBack,e)),$(".ui-bizagi-render-stakeholder-link",t).click($.proxy(e.removeAssociated,e)),$(".ui-bizagi-render-stakeholder-search",t).keyup($.proxy(e.onKeyUpFilter,e)),t.on("click","table .sortColumnsData-stakeholder",(function(t){var i=$(t.currentTarget),r=i.data("orderfield"),a=i.data("ordertype");e.gridDataService(e.currentPage,null,r,"DESC"===a?"ASC":"DESC")}))},goToBack:function(){var e=this.getControl();"step1"===this.status?($("#ui-bizagi-render-stakeholder-entity-list",e).hide(),$("#ui-bizagi-render-stakeholder-add-instance",e).hide(),$("#ui-bizagi-render-stakeholder-associated-list",e).show(),$(".ui-bizagi-render-stakeholder-associated",e).show(),$("#ui-bizagi-render-stakeholder-add",e).show(),$(".ui-bizagi-render-stakeholder-back",e).hide(),this.status=null):"step2"===this.status&&($("#ui-bizagi-render-stakeholder-grid",e).hide(),$("#ui-bizagi-render-stakeholder-add-instance",e).show(),this.status="step1")},addInstance:function(){var e=this.getControl();this.status="step1",$("#ui-bizagi-render-stakeholder-associated-list",e).hide(),$(".ui-bizagi-render-stakeholder-associated",e).hide(),$("#ui-bizagi-render-stakeholder-add",e).hide(),$("#ui-bizagi-render-stakeholder-entity-list",e).show(),$("#ui-bizagi-render-stakeholder-add-instance",e).show(),$(".ui-bizagi-render-stakeholder-back",e).show(),$(".ui-bizagi-render-stakeholder-entity-row").removeClass("ui-bizagi-render-stakeholder-selected")},addGrid:function(e){var t=this.getControl();this.valueXpath=$(e.currentTarget).attr("data-value"),this.guidEntity=$(e.currentTarget).attr("guid-entity"),this.status="step2",$(".ui-bizagi-render-stakeholder-entity-row").removeClass("ui-bizagi-render-stakeholder-selected"),$(e.currentTarget).addClass("ui-bizagi-render-stakeholder-selected"),$("#ui-bizagi-render-stakeholder-add-instance",t).hide(),$("#ui-bizagi-render-stakeholder-grid",t).show(),$(".ui-bizagi-render-stakeholder-search",t).val(""),this.gridDataService(null,"","","DESC")},gridDataService:function(e,t,i,r){var a=this;a.getData(a.valueXpath,e,t,i,r).done((function(e){a.onGetData(e,r)})).fail((function(e){a.onGetDataFail(e)}))},onGetData:function(e,t){var i=this,r=i.getControl(),a=i.renderFactory.getTemplate("stakeholder-grid");if(i.currentPage=e.page,e.rows.length>0){var n=e.rows[0][1],o=n.slice(1,n.length),s=[];for(m=0;m<o.length;m++){var l={name:o[m][0],displayName:o[m][1],orderType:t};s.push(l)}var d=i.selectedItems[i.valueXpath];$.each(e.rows,(function(e,t){var r=t[2][0][0];(!d&&null!=r||d&&r==d.id)&&(i.selectedItems[i.valueXpath]={id:t[0],idInstance:r,nameInstance:t[2][0][1]})})),i.selectedItems[i.valueXpath]&&"null"==i.selectedItems[i.valueXpath].idUser&&delete i.selectedItems[i.valueXpath];for(var c=[],u=0;u<e.rows.length;u++){var p="",g="";e.rows[u][2][0][0]&&e.rows[u][2][0][0]!=i.properties.idUser?(p="associatedWithAnotherUser",g=bizagi.localization.getResource("render-stakeholder-link-tooltip-associate-another-user").replace("{0}",e.rows[u][2][0][1])):e.rows[u][2][0][0]==i.properties.idUser?(p="associateMe",g=bizagi.localization.getResource("render-stakeholder-link-tooltip-associate")):(p="unassociated",g=bizagi.localization.getResource("render-stakeholder-link-tooltip-unassociate"));var h={columns:[]};h.columns.push({stateInstance:p,value:e.rows[u][0],tooltipLink:g});for(var m=0;m<e.rows[u][2].length;m++)m>0&&h.columns.push({value:e.rows[u][2][m]});c.push(h)}var b=$.tmpl(a,{datasource:c,columns:s,tooltipUnassociated:bizagi.localization.getResource("render-stakeholder-link-tooltip-unassociate")});$(".ui-bizagi-render-stakeholder-items-grid-content",r).empty().append(b);var f=i.renderFactory.getTemplate("stakeholder-paginator");i.totalRecords=e.records,i.totalPages=e.total;var v=i.maxPageToShow>i.totalPages?i.totalPages:i.maxPageToShow,y={};y.pagination=i.totalPages>1,y.page=e.page,y.pages={};for(var z=1;z<=v;z++)y.pages[z]={pageNumber:z};paginationHtml=$.tmpl(f,y).html(),$(".ui-bizagi-render-stakeholder-paginator",r).empty().append(paginationHtml);var C=$(".ui-bizagi-render-stakeholder-paginator ul",r);C.bizagiPagination({maxElemShow:i.maxPageToShow,totalPages:i.totalPages,actualPage:i.currentPage,listElement:C,clickCallBack:function(e){i.gridDataService(e.page)}}),i.setRowsEvents()}else $(".ui-bizagi-render-stakeholder-items-grid-content",r).empty(),$(".ui-bizagi-render-stakeholder-paginator",r).empty()},onGetDataFail:function(e){console.log("process property value error: "+e)},setRowsEvents:function(){$(".ui-bizagi-render-stakeholder-table-link").click($.proxy(this.onLinkClick,this))},onLinkClick:function(e){var t,i=this,r=$(e.currentTarget).attr("data-value");function a(e){$(e.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-link-close")?($(".ui-bizagi-render-stakeholder-table-link").removeClass("ui-bizagi-render-stakeholder-table-link-close"),t="null"):($(".ui-bizagi-render-stakeholder-table-link").removeClass("ui-bizagi-render-stakeholder-table-link-close"),$(e.currentTarget).addClass("ui-bizagi-render-stakeholder-table-link-close"),t=i.properties.idUser),i.selectedItems[i.valueXpath]={id:r,idUser:t},i.associatedUser(r,i.guidEntity,t).done((function(){i.refreshStakeholderValue(),$(e.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-stakeholder-associated-other-user")&&($(".ui-bizagi-render-stakeholder-table-link").removeClass("ui-bizagi-render-stakeholder-table-stakeholder-associated-other-user"),$(e.currentTarget).addClass("ui-bizagi-render-stakeholder-table-link-close"),t=i.properties.idUser,i.associatedUser(r,i.guidEntity,t).done((function(){i.refreshStakeholderValue()})).fail((function(e){i.onStakeAssociatedFail(e)})))})).fail((function(e){i.onStakeAssociatedFail(e)}))}if($(e.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-link-close")&&$(e.currentTarget).hasClass("ui-bizagi-render-stakeholder-table-stakeholder-associated-other-user")){var n=bizagi.localization.getResource("render-stakeholder-delete-associate-instance-other-user-confirm-msg");$.when(bizagi.showConfirmationBox(n,"Bizagi","warning")).done((function(){a(e)}))}else a(e)},removeAssociated:function(e){var t=this,i=$(e.currentTarget).attr("data-value");t.guidEntity=$(e.currentTarget).attr("guid-entity");t.selectedItems[t.valueXpath]={id:i,idUser:"null"},t.associatedUser(i,t.guidEntity,"null").done((function(){t.refreshStakeholderValue()})).fail((function(e){t.onStakeAssociatedFail(e)}))},onKeyUpFilter:function(e){if(13==e.keyCode){var t=$(e.target).val();this.gridDataService(null,t)}},refreshStakeholderValue:function(){var e=this,t=e.getControl();e.refreshStakeholderList().done((function(i){e.setValue(i),t.empty().append(e.renderControl()),e.configureHandlers()})).fail((function(t){e.onStakeAssociatedFail(t)}))},onStakeAssociatedFail:function(e){console.log("stakeholder associated error: "+e)},setDisplayValue:function(e){this.setValue(e)},setValue:function(e){this.properties.previousValue=this.properties.originalValue=JSON.stringify({value:this.value}),this.value=this.properties.value=JSON.stringify({value:e})}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.userPassword",bizagi.rendering.userPassword.prototype),bizagi.rendering.desktop.userPassword.extend("bizagi.rendering.desktop.userPassword",{},{postRender:function(){var e=this.getControl();this._super(),this.input=e.find("input#bz-render-userPassword-inputPassword"),this.properties.maxLength>0&&this.input.attr("maxlength",this.properties.maxLength)},configureHandlers:function(){var e=this;e.getControl();e.input.bind("change",(function(){var t=e.input.val();""!==t?e.saveValue(t):e.setValue(t)})).keypress((function(e){var t=(e=window.event||e).charCode||e.keyCode;void 0!==e&&13==t&&$(this).trigger("change")}))},saveValue:function(e){var t=CryptoJS,i=t.enc.Utf8.parse("pc30n84e15lvdD68"),r=CryptoJS.enc.Latin1.parse("1v00628X62bJE2mi"),a=t.algo.AES.createEncryptor(i,{mode:t.mode.CBC,padding:t.pad.Pkcs7,iv:r}).finalize(e),n=t.enc.Base64.stringify(a);this.setValue(n)},postRenderReadOnly:function(){var e=this.getControl(),t=$.tmpl("<label class='readonly-control'></label>",{});e.append(t)}}),bizagi.rendering.render.extend("bizagi.rendering.desktop.gridActions",{},{renderControl:function(){var e=this.renderFactory.getTemplate("gridActions"),t=this.grid&&this.grid.hasActions()||!1;return $.fasttmpl(e,{hasActions:t})}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.numberScientificNotation",bizagi.rendering.numberScientificNotation.prototype),bizagi.rendering.desktop.numberScientificNotation.extend("bizagi.rendering.desktop.numberScientificNotation",{},{postRender:function(){this._super(),this.attachFormatScientificNotation()},setDisplayValue:function(e){null!=(e=bizagi.util.scientificNotationFormat(e.replace(this.properties.decimalSymbol,".")))&&this.properties.editable&&(this.numericInput.val(e.replace(".",this.properties.decimalSymbol)),this.setValue(e)),this._super(e.replace(".",this.properties.decimalSymbol))},attachFormatScientificNotation:function(){var e=this;e.numericInput.blur((function(){var t=e.numericInput.val(),i=bizagi.util.scientificNotationFormat(t,e.properties.decimalSymbol);e.setValue(i),e.numericInput.val(i)}))}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.actionLauncher",bizagi.rendering.actionLauncher.prototype),bizagi.rendering.desktop.actionLauncher.extend("bizagi.rendering.desktop.actionLauncher",{},{postRender:function(){var e,t=this,i=t.properties,r=t.getMode(),a={},n=new $.Deferred;if("design"==r||!t.properties.surrogatedKey)return"";function o(i,r){var a=t.getControl(),o=$(".bz-action-launcher-actions-container",a);e=$.fasttmpl(i,r),o.append(e),r.template&&o.find(".actions-container.actions-container-template").append(r.template),t.configureHandlers(),n.resolve(o)}return t.configureQueueVisibility(),$.when(t.dataService.multiaction().getActions(t.processPropertyValueArgs)).pipe((function(e){return e=t.getPropertiesActionLaucher(e),a.actions=e,"none"!=i.templatetype?t.dataService.multiaction().getPropertyData(t.processPropertyValueDataTmplArgs):null})).done((function(e){var r=a.actions;t.deferredActions.resolve(r),t.totalActions=bizagi.clone(r);var n=bizagi.clone(r),s={},l=t.moreActionsManager(n),d=l.isMoreActions;if(n=l.actions,t.lessActions=bizagi.clone(n),i.isHorizontal)"none"!=i.templatetype?$.when(t.engine.render($.extend(e,{isDefaultTemplate:"default"==i.templatetype}),t.processPropertyValueDataTmplArgs)).done((function(e){s={actions:t.getPropertiesActionLaucher(n),template:e,isMoreActions:d,moreActions:t.moreActions,allowactions:i.allowactions},o(e=t.renderFactory.getTemplate("render-actionLauncher-horizontal"),s)})):(s={actions:t.getPropertiesActionLaucher(n),isMoreActions:d,template:!1,moreActions:t.moreActions,allowactions:i.allowactions},o(t.renderFactory.getTemplate("render-actionLauncher-horizontal"),s));else{var c=d?t.lessActions:t.totalActions;s={actions:t.getPropertiesActionLaucher(c),allowSearch:i.allowSearch,isMoreActions:d,isExpanded:!1,moreButtonTitle:t.getResource("render-action-launcher-more-actions")},o(t.renderFactory.getTemplate("render-actionLauncher-vertical"),s)}})).fail((function(e){n.fail(e)})),t.engine.subscribe("onLoadDataNavigation",(function(e,t){bizagi.loader.start("entity-engine-view").then((function(){$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_DIALOGNAV,data:t,modalParameters:{title:t.data.displayName,refreshInbox:!1},maximizeOnly:!1})}))})),n.promise()},moreActionsManager:function(e){var t=this.properties,i=e.length>t.maxItems||!1;if(i){var r=e.splice(0,t.maxItems);this.moreActions=bizagi.clone(e),e=r}return{isMoreActions:i,actions:e}},configureHandlers:function(){var e=this,t=e.getFormContainer();if(void 0===t.params.printversion||0==t.params.printversion){var i=e.getControl(),r=$(".action-launcher-control",i),a=$(".action-launcher-more-vertical",i),n=e.properties;e.configureMoreActionsHandler(),a.on("click",(function(t){var i=!1,r="",a={};$(this).hasClass("expanded")?(i=!1,a=e.lessActions,r=e.getResource("render-action-launcher-more-actions")):(i=!0,a=e.totalActions,r=e.getResource("render-action-launcher-less-actions"));var o={actions:e.getPropertiesActionLaucher(a),allowSearch:n.allowSearch,isMoreActions:!0,isExpanded:i,moreButtonTitle:r};!function(t,i){var r=e.getControl(),a=$(".bz-action-launcher-actions-container",r);a.empty();var n=$.fasttmpl(t,i);a.append(n),e.configureHandlers()}(e.renderFactory.getTemplate("render-actionLauncher-vertical"),o)})),r.on("click",(function(){var t={guidProcess:$(this).data("guidprocess"),guidAction:$(this).data("guidaction"),displayName:$(this).data("display-name"),actionType:$(this).data("action-type"),xpathContext:$(this).data("xpathcontext"),readOnlyForm:$(this).data("readonlyform")||!1,guidEntity:e.properties.guidEntity,xpathActions:e.properties.xpathActions||""};e.onActionClicked(t)})),$.expr[":"].FilterAction=function(e,t,i){var r=i[3];return!!r&&new RegExp(r,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",i).keyup((function(){var e=$(this).val();$(".ui-bizagi-render-actionLauncher-vertical-item",i).show(0),a.hasClass("expanded")||(a.trigger("click"),$("input#ui-bizagi-render-action-launcher-filter-input").val(e),$("input#ui-bizagi-render-action-launcher-filter-input").focus()),e&&$(".ui-bizagi-render-actionLauncher-vertical-item",i).not(":FilterAction("+e+")").hide(0)}))}},configureMoreActionsHandler:function(){var e=this,t=e.getControl(),i=$(".action-launcher-more",t);bizagi.loader.startAndThen("kendo").then((function(){e.tooltip=i.kendoTooltip({autoHide:!1,content:function(t){var i=e.renderFactory.getTemplate("render-actionLauncher-horizontal-more");return $.fasttmpl(i,{actions:e.getPropertiesActionLaucher(e.moreActions)})},show:function(){$("div[role='tooltip']").addClass("bizagi-custom-tooltip-more-actions"),$(".action-launcher-control-more").off("click").on("click",(function(t){var i={guidProcess:$(this).data("guidprocess"),guidAction:$(this).data("guidaction"),displayName:$(this).data("display-name"),actionType:$(this).data("action-type"),xpathContext:$(this).data("xpathcontext"),readOnlyForm:$(this).data("readonlyform")||!1,xpathActions:e.properties.xpathActions||""};e.onActionClicked(i),e.tooltip.hide()}))},width:185}).data("kendoTooltip")}))},onActionClicked:function(e){var t=this,i=t.getControl(),r=t.properties;void 0===r.multipleSelection||r.multipleSelection?"Form"==e.actionType&&t.countSameActions(e)>=1&&!e.xpathContext?$(".action-to-execute-control[data-guidaction='"+e.guidAction+"'] label",i).click():$.when(t.actionManager(e)).done((function(e){t.executeAction(e)})):t.getValue().length>0?t.showConfirmationDialog(e):$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))},notifyExecution:function(e,t){var i=new bizagi.INotifications;"success"==e.response?i.showSucessMessage(printf(this.getResource("render-action-launcher-success-excecution"),t.displayName),null,{}):i.showErrorMessage(printf(this.getResource("render-action-launcher-failed-excecution"),t.displayName),null,{})},processActionForm:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=t.properties.additionalXpath.join(","),n=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,o=new $.Deferred,s=new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){return t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:s.form.properties.xpathContext,idPageCache:s.form.properties.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe((function(i){e.editMode||0!=t.countSameActions(e)||(e.idStartScope=i.IdScope),o.resolve(i.IdScope)}))},onCancel:function(e){}}),l={idForm:e.guidProcess,contextType:"start",idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=r.properties.typeForm?bizagi.context.idWorkitem:void 0,additionalXpaths:a,xpathContext:n,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath};return"Form"===e.actionType&&(l.contextType="entitytemplate",l.xpathContext=void 0,l.guidEntity=e.guidEntity,l.rewriteContextType=!0),s.render(l),o.promise()},processActionFormCollection:function(e){var t=this,i=t.properties,r=(t.getFormContainer(),t.properties.additionalXpath.join(",")),a=new $.Deferred,n=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,o=""!=n?printf("%s[id=%s]",n,e.idEntity):n,s=""!=n?printf("%s[]",n):n;return new bizagi.rendering.dialog.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(r){return e.editMode?t.dataService.multiaction().submitData({action:"SAVE",data:r,xpathContext:o,idPageCache:r.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe((function(e){a.resolve(e.IdScope)})):t.dataService.addGridRecordData({idRender:i.id,xpathContext:n,contexttype:"start",idPageCache:r.idPageCache,submitData:r}).pipe((function(i){e.idStartScope=i.IdScope,e.idEntity=i.IdEntity,t.addActionToQueue(e),a.resolve(i.IdScope)}))},onCancel:function(e){}}).render({idForm:e.guidProcess,contextType:"start",idCase:bizagi.context.idCase,additionalXpaths:r,xpathContext:e.editMode?o:s,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath}),a.promise()},processStartForm:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=new $.Deferred;return e=e||{},new bizagi.rendering.dialog.startForm(t.dataService,t.renderFactory,{maximized:i.maximized,title:e.title||"",saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==this.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return r.startLoading(),t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe((function(e){r.endLoading(),a.resolve(e.IdScope)}))}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=r.properties.typeForm?bizagi.context.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),a.promise()},executeAction:function(e){var t=this;"GlobalForm"===t.typeForm||"SummaryForm"===t.typeForm?"Form"!==e.actionType?$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation"),null,!1)).done((function(i){t.executeActionImmediately(e)})):t.setValue([]):t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this;t.confirmTemplate=t.renderFactory.getTemplate("render-actionLauncher-confirm");var i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation"),r=$.tmpl(t.confirmTemplate,{confirmationMessage:i}),a={resizable:!1,modal:!0,title:"Bizagi",buttons:[]};a.buttons=[{text:bizagi.localization.getResource("render-boolean-yes"),click:function(){t.setValue([]),$.when(t.actionManager(e)).done((function(e){t.executeAction(e)})),$(this).dialog("close")}},{text:bizagi.localization.getResource("render-boolean-no"),click:function(){$(this).dialog("close")}}],$(r).dialog(a)},setDisplayValue:function(e){var t=this,i=t.getControl(),r=$(".bz-action-launcher-actions-to-execute-container",i),a=t.renderFactory.getTemplate("render-actionLauncher-actions-to-execute");t.configureQueueVisibility(),$.when(t.deferredActions).done((function(i){$.each(e,(function(t,r){var a=function(e){var t=[];return $.each(i,(function(i,r){r[4]==e&&(t=r)})),t}(r.guidAction);e[t].displayName=a[1],e[t].guidProcess=a[0],e[t].actionType=a[3],e[t].xpathContext=a[5],e[t].readOnlyForm=a[6],e[t].params&&e[t].params.idStartScope&&(e[t].idStartScope=e[t].params.idStartScope),e[t].params&&e[t].params.idPageCache&&(e[t].idPageCache=e[t].params.idPageCache),e[t].params&&e[t].params.idEntity&&(e[t].idEntity=e[t].params.idEntity)})),$.when($.fasttmpl(a,{actions:e})).done((function(e){r.empty(),r.append(e);var i=$(".action-to-execute-control i",r),a=$(".action-to-execute-control label",r);i.bind("click",(function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)})),a.bind("click",(function(){var e=$(this).parent(),i=e.data("actiontype"),r=e.data("guidprocess"),a=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("readonlyform")||!1,l=e.data("identity")||"",d=e.data("guidaction"),c=o||t.properties.xpathContext;switch(i){case"Process":a&&t.processStartForm({guidprocess:r,idStartScope:a,title:n,xpathContext:o,recordXpath:c});break;case"Form":var u={guidProcess:r,idStartScope:a,editMode:!0,xpathContext:o,readOnlyForm:s,idEntity:l,recordXpath:c};if(u.xpathContext)t.processActionFormCollection(u);else{var p={},g=t.value.filter((function(e){return e.guidAction==d}));g.length>0&&(p={actionType:"Form",contextType:"entitytemplate",guidEntity:t.properties.guidEntity||g[0].guidEntity}),t.processActionForm($.extend(u,p))}}}))}))}))},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-action-launcher-actions-to-execute-container",e),i=$(".actions-to-execute-title",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.range",bizagi.rendering.range.prototype),bizagi.rendering.desktop.range.extend("bizagi.rendering.desktop.range",{},{postRender:function(){this.properties},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.desktop.range.extend("bizagi.rendering.desktop.rangeDate",bizagi.rendering.rangeDate.prototype),bizagi.rendering.desktop.rangeDate.extend("bizagi.rendering.desktop.rangeDate",{},{postRender:function(){this.defineRangeControl()}}),bizagi.rendering.desktop.range.extend("bizagi.rendering.desktop.rangeMoney",bizagi.rendering.rangeMoney.prototype),bizagi.rendering.desktop.rangeMoney.extend("bizagi.rendering.desktop.rangeMoney",{},{postRender:function(){this.defineRangeControl()},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.desktop.range.extend("bizagi.rendering.desktop.rangeNumber",bizagi.rendering.rangeNumber.prototype),bizagi.rendering.desktop.rangeNumber.extend("bizagi.rendering.desktop.rangeNumber",{},{postRender:function(){this.defineRangeControl()}}),bizagi.rendering.desktop.actionLauncher.extend("bizagi.rendering.desktop.entityTemplate",{},{initializeData:function(e){var t=(e=e||{}).properties||{};this._super(e),this.properties.allowactions=void 0!==t.allowactions&&bizagi.util.parseBoolean(t.allowactions),this.properties.templatetype=void 0!==t.templatetype?t.templatetype:"default"},postRender:function(){var e=this,t=e.properties,i=e.getMode(),r=e.getControl();if("design"==i||!e.properties.surrogatedKey)return"";e.configureQueueVisibility(),$.when(e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs)).done((function(i){void 0!==i.templateGuid&&i.templateGuid&&(i.isDefaultTemplate=!1,i.guidTemplate=i.templateGuid,delete i.templateGuid),$.when(e.engine.render(i,e.processPropertyValueDataTmplArgs)).done((function(i){var a=i,n=$(".bz-action-launcher-actions-container",r);if(i=e.renderFactory.getTemplate("render-actionLauncher-horizontal"),t.allowactions)$.when(e.dataService.multiaction().getActions(e.processPropertyValueArgs)).done((function(r){e.deferredActions.resolve(r);var o=bizagi.clone(r),s=e.moreActionsManager(o),l=s.isMoreActions;o=s.actions;var d=$.fasttmpl(i,{actions:o,template:!0,isMoreActions:l,allowactions:t.allowactions});n.append(d),n.find(".actions-container.actions-container-template").append(a),e.configureHandlers()})).fail((function(e){}));else{var o=$.fasttmpl(i,{template:!0,allowactions:t.allowactions});n.append(o),n.find(".actions-container.actions-container-template").append(a)}}))})).fail((function(e){})),e.engine.subscribe("onLoadDataNavigation",(function(e,t){bizagi.loader.start("entity-engine-view").then((function(){t.skipRefresh=!0,$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_DIALOGNAV,data:t,modalParameters:{refreshInbox:!1,title:t.data.displayName},maximizeOnly:!1})}))}))},configureHandlers:function(){var e=this,t=e.getFormContainer();if(void 0===t.params.printversion||0==t.params.printversion){var i=e.getControl(),r=(e.properties,$(".action-launcher-control",i));e.configureMoreActionsHandler(),r.on("click",(function(){var t={guidProcess:$(this).data("guidprocess"),guidAction:$(this).data("guidaction"),displayName:$(this).data("display-name"),actionType:$(this).data("action-type"),xpathContext:$(this).data("xpathcontext"),xpathActions:e.properties.xpathActions||""};"Form"===t.actionType&&(t.xpathContext=void 0,t.contextType="entitytemplate",t.guidEntity=e.properties.guidEntity),e.onActionClicked(t)}))}}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.checkList",bizagi.rendering.checkList.prototype),bizagi.rendering.desktop.checkList.extend("bizagi.rendering.desktop.checkList",{},{postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-display-block"),this.properties.unique=Math.ceil(1e3*Math.random()),$(".ui-bizagi-render-checkList-label",this.checkListGroup).check()},configureHandlers:function(){var e=this;e._super(),bizagi.util.isIE(),$("input[type=checkbox]",e.checkListGroup).bind("change",(function(t,i){var r=$(this).data("item-guid"),a=$(this).is(":checked");e.updateDisplay($(this),a),e.onCheckListGroupChange(r,a)}))},updateDisplay:function(e,t){var i=e.closest(".ui-bizagi-render-checkList-item");t?i.addClass("checked"):i.removeClass("checked")},onCheckListGroupChange:function(e,t){var i,r=$.grep(this.properties.items,(function(t,i){return t.guid===e}));r&&r.length>0&&(i=r[0]),i.checked=t},clearDisplayValue:function(){bizagi.util.isIE()?$("input[type=checkbox]",this.checkListGroup).removeAttr("checked"):$("input[type=checkbox]",this.checkListGroup).check("uncheckItem")},setDisplayValue:function(e){}}),bizagi.rendering.desktop.checkList.extend("bizagi.rendering.desktop.activityCheckList",{},{postRender:function(){this.getControl();this._super(),this.addButton=$(".ui-bizagi-render-checkList-add-item",this.element),this.newItemName=$(".ui-bizagi-render-checkList-input-name",this.control),this.separator=$(".ui-bizagi-render-checkList-separator",this.element),this.goalActivity=$(".ui-bizagi-render-checkList-goal-activity",this.element),this.additionalElements(),this.notifyLoadItems()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("checkList-disabled");return $.fasttmpl(e,{items:this.value})},additionalElements:function(){this.getControl(),this.getResource("render-activity-check-list-activitywork"),this.properties.activityWork,this.getResource("render-activity-check-list-form");if(!(this.addButton&&this.addButton.length>0)){var e=$("<div/>").addClass("ui-bizagi-render-checkList-add-item");e.append($("<h4 />").text(bizagi.localization.getResource("workportal-project-plan-activity-work-title"))),e.append($("<button class=''/>").text("+ "+bizagi.localization.getResource("workportal-project-plan-activity-action-add"))),this.element.prepend(e)}this.separator&&this.separator.length>0||this.element.append($("<div/>").addClass("ui-bizagi-render-checkList-separator").append($("<span/>"))),this.goalActivity&&this.goalActivity.length>0||this.properties.activityDescription&&""!==this.properties.activityDescription&&this.element.prepend($("<div/>").addClass("ui-bizagi-render-checkList-goal-activity").append("<h3><span class='ui-bizagi-wp-bold'>"+bizagi.localization.getResource("workportal-project-plan-activity-goal")+": </span><span>"+this.properties.activityDescription+"</span></h3>"))},notifyLoadItems:function(){var e=this;setTimeout((function(){e.triggerGlobalHandler("onLoadDataItemsFromFormActivityPlan",{items:e.properties.items,activityWork:e.properties.activityWork})}),100)},configureHandlers:function(){var e=this;e.getControl();this._super(),$(".ui-bizagi-render-checkList-add-item button",e.element).unbind("click").click((function(){var t=$(".ui-bizagi-render-checkList-item.selected",e.control);t.length<=0?e.prepareNewItem():$(".ui-bizagi-render-checkList-input-name",t).focus()})),$(".item-button.delete",e.checkListGroup).bind("click",(function(t,i){var r=$(this).closest(".ui-bizagi-render-checkList-item").data("item-guid");e.deleteItem(r)})),$("label.item-name",e.checkListGroup).bind("click",(function(t,i){var r=$(this).closest(".ui-bizagi-render-checkList-item").data("item-guid");e.selectItem(r)}))},selectItem:function(e){for(var t=0;t<this.properties.items.length;t++)this.properties.items[t].guid===e?this.properties.items[t].selected=!0:this.properties.items[t].selected=!1;this.repaintControl();var i=$(".ui-bizagi-render-checkList-item.selected"),r=$(".ui-bizagi-render-checkList-input-name",i),a=r.val();r.focus(),r[0].setSelectionRange(a.length,a.length),this.configureHandlers(),this.addSelectedHandlers()},deleteItem:function(e){for(var t=0;t<this.properties.items.length;t++)if(this.properties.items[t].guid===e){this.properties.items.splice(t,1);break}this.setValue(this.properties.items),this.repaintControl(),this.configureHandlers(),this.refreshValue(this.properties.items)},prepareNewItem:function(){var e={guid:Math.guid(),resolved:!1,name:"",selected:!0};this.properties.items.push(e),this.repaintControl(),this.configureHandlers(),this.addSelectedHandlers()},addSelectedHandlers:function(){var e=this,t=$(".ui-bizagi-render-checkList-item.selected",e.control),i=$(".ui-bizagi-render-checkList-input-name",t);i.focus(),i.blur((function(){var t=i.val();t&&""!==t?e.addItem():(e.properties.items.splice(e.properties.items.length-1,1),e.setValue(e.properties.items),e.repaintControl(),e.configureHandlers())})),i.keypress((function(t){if(13==t.which){t.preventDefault();var r=i.val();r&&""!==r&&(e.addItem(),e.prepareNewItem())}}))},addItem:function(){this.getControl();var e=$(".ui-bizagi-render-checkList-item.selected",this.control),t=$(".ui-bizagi-render-checkList-input-name",e).val();this.addButton.show(),$.each(this.properties.items,(function(e,i){i.selected&&(i.name=t,i.selected=!1)})),this.updateOriginalValue(),this.setValue(this.properties.items),this.repaintControl(),this.configureHandlers(),this.refreshValue(this.properties.items)},repaintControl:function(){this.getControl();var e=this.renderControl();$(".ui-bizagi-render-checkList",this.control).replaceWith(e),this.postRender()},onCheckListGroupChange:function(e,t){var i,r=$.grep(this.properties.items,(function(t,i){return t.guid===e}));r&&r.length>0&&(i=r[0]),i.resolved=t,this.setValue(this.properties.items),this.refreshValue(this.properties.items)},refreshValue:function(e){this.getControl();for(var t=e.length,i=0,r=0;r<t;r++)e[r].resolved&&(i+=1);this.properties.activityWork=t>0?Math.floor(100*i/t):0;var a=this.getResource("render-activity-check-list-activitywork")+" ("+this.properties.activityWork+"%)";$(".ui-bizagi-render-checkList-activity-work span",this.element).html(a),this.triggerGlobalHandler("onLoadDataItemsFromFormActivityPlan",{items:this.properties.items,activityWork:this.properties.activityWork})},getValue:function(e){return this.value||[]},controlValueIsChanged:function(){return JSON.stringify(this.properties.originalValue)!==JSON.stringify(this.value)},allCheckedItems:function(){var e=!1;return Array.isArray(this.value)&&(e=this.value.every((function(e){return 1==e.resolved}))),e},updateOriginalValue:function(){this.properties.originalValue=bizagi.clone(this.value)},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=this.properties.idActivity,n=!0,o=this.getFormContainer().getLastActionButton();if(o&&"next"==o.action&&(n=this.allCheckedItems()),this.controlValueIsChanged()&&n&&!bizagi.util.isEmpty(i)&&!bizagi.util.isEmpty(a))if(Array.isArray(r)){var s={idActivity:a,items:r};e[t.xpath]=JSON.stringify(s)}else""===r&&(e[t.xpath]="")},isValid:function(e){var t,i=this.properties,r=this.getValue(),a=!0;t=this.getResource("render-activity-check-list-validation");for(var n=0;n<r.length;n+=1){if(!r[n].resolved){e.push({xpath:i.xpath,message:t}),a=!1;break}}return a}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.polymorphicLauncher",bizagi.rendering.polymorphicLauncher.prototype),bizagi.rendering.desktop.polymorphicLauncher.extend("bizagi.rendering.desktop.polymorphicLauncher",{},{postRender:function(){var e,t=this,i=t.properties,r=t.getMode(),a=new $.Deferred;if("design"==r||!t.properties.surrogatedKey)return"";return t.configureQueueVisibility(),$.when(t.dataService.multiaction().getPolymorphicActions(t.processPropertyValueArgs)).done((function(r){r=t.dataService.serializePolymorphicActions(r),t.totalActions=bizagi.clone(r);var n=bizagi.clone(r);t.lessActions=bizagi.clone(n);var o={actions:n,allowSearch:i.allowSearch,treeActionsList:t.getTreeItems(n)};!function(i,r){var n=t.getControl(),o=$(".bz-action-launcher-actions-container",n);e=$.fasttmpl(i,r),o.append(e),!0!==t.properties.readOnly&&t.configureHandlers(),a.resolve(o)}(t.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree"),o)})).fail((function(e){a.fail(e)})),a.promise()},getTreeItems:function(e,t){var i=this,r="<ul>",a=i.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree-item");return e=e||{},t=t||1,$.each(e,(function(e,n){r+=$.fasttmpl(a,n),n.children&&(r+=i.getTreeItems(n.children,t+1))})),r+="</ul>"},configureHandlers:function(){var e=this,t=e.getControl(),i=e.getFormContainer();void 0!==i.params.printversion&&0!=i.params.printversion||($(".ui-bizagi-render-polymorphicLauncher-list li>span",t).on("click",(function(){var t=$(this).parent(),i={guidEntity:t.data("guidentity"),guidObject:t.data("guidobject"),guidConstructor:t.data("guidconstructor"),displayName:t.data("display-name"),actionType:t.data("action-type"),xpathContext:t.data("xpathcontext")};e.onActionClicked(i)})),$.expr[":"].FilterAction=function(e,t,i){var r=i[3];return!!r&&new RegExp(r,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup((function(){var e=$(this).val();e?($("li",t).hide(0),$("li[data-hasconstructor='true']",t).filter(":FilterAction("+e+")").show(0,(function(){var e=$("label",this).html(),t=$(this),i=t.data("parents")+t.data("title");t.data("cachedvalue")||t.data("cachedvalue",e),$("label",this).html(i)}))):$("li",t).show(0,(function(){var e=$(this).data("cachedvalue");$("label",this).html(e)}))})))},onActionClicked:function(e){var t=this;$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))},notifyExecution:function(e,t){var i=new bizagi.INotifications;"success"==e?i.showSucessMessage(printf(this.getResource("render-action-launcher-success-excecution"),t.displayName),null,{}):i.showErrorMessage(printf(this.getResource("render-action-launcher-failed-excecution"),t.displayName),null,{})},processActionForm:function(e){var t,i=this,r=i.properties,a=i.getFormContainer(),n=i.properties.additionalXpath.join(","),o=new $.Deferred;e.xpathContext;"polymorphicLauncher"!==i.properties.type&&(t="object"==_typeof(i.properties.surrogatedKey)&&i.properties.surrogatedKey.length>1?i.properties.surrogatedKey:i.properties.surrogatedKey[0]);var s=i.properties.recordXpath,l=new bizagi.rendering.dialog.form(i.dataService,i.renderFactory,{title:r.detailLabel||bizagi.localization.getResource("render-grid-details-form"),showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(t){var r=t.idPageCache;return t.idPageCache=null,i.dataService.multiaction().submitData({action:"SAVE",data:t,xpathContext:l.form.properties.xpathContext,idPageCache:r,isOfflineForm:!1,isActionStartForm:!0}).pipe((function(t){e.editMode||0!=i.countSameActions(e)||(e.idStartScope=t.IdScope),o.resolve(t.IdScope)}))},onCancel:function(e){}});return l.render({idForm:e.guidObject,contextType:"entity",guidEntity:e.guidEntity,idCase:i.properties.caseId,idWorkitem:"SummaryForm"!=a.properties.typeForm?bizagi.context.idWorkitem:void 0,additionalXpaths:n,idStartScope:e.idStartScope,surrogateKey:t,recordXpath:s}),o.promise()},processStartForm:function(e){var t,i=this,r=i.properties,a=i.getFormContainer(),n=new $.Deferred;return"polymorphicLauncher"!==i.properties.type&&(t="object"==_typeof(i.properties.surrogatedKey)&&i.properties.surrogatedKey.length>1?i.properties.surrogatedKey:i.properties.surrogatedKey[0]),e=e||{},new bizagi.rendering.dialog.startForm(i.dataService,i.renderFactory,{maximized:r.maximized,title:e.title||"",saveButtonLabel:"GlobalForm"==i.typeForm||"SummaryForm"==this.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return a.startLoading(),i.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:i.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).pipe((function(e){a.endLoading(),n.resolve(e.IdScope)}))}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:i.properties.caseId,idWorkitem:"SummaryForm"!=a.properties.typeForm?bizagi.context.idWorkitem:void 0,additionalXpaths:i.properties.additionalXpath.join(","),surrogatedKey:t,recordXpath:e.recordXpath,mappingstakeholders:!0}),n.promise()},executeAction:function(e){var t=this;"GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm?$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation"),null,!1)).done((function(i){t.executeActionImmediately(e)})):t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this;t.confirmTemplate=t.renderFactory.getTemplate("render-polymorphicLauncher-confirm");var i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation"),r=$.tmpl(t.confirmTemplate,{confirmationMessage:i}),a={resizable:!1,modal:!0,title:"Bizagi",buttons:[]};a.buttons=[{text:bizagi.localization.getResource("render-boolean-yes"),click:function(){t.setValue([]),$.when(t.actionManager(e)).done((function(e){t.executeAction(e)})),$(this).dialog("close")}},{text:bizagi.localization.getResource("render-boolean-no"),click:function(){$(this).dialog("close")}}],$(r).dialog(a)},setDisplayValue:function(e){var t=this,i=t.getControl(),r=$(".bz-action-launcher-actions-to-execute-container",i),a=t.renderFactory.getTemplate("render-polymorphicLauncher-actions-to-execute");t.configureQueueVisibility(),$.when($.fasttmpl(a,{actions:e})).done((function(e){r.empty(),r.append(e);var i=$(".action-to-execute-control i",r),a=$(".action-to-execute-control label",r);i.bind("click",(function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)})),a.bind("click",(function(){var e=$(this).parent(),i=e.data("actiontype"),r=e.data("guidprocess"),a=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("identity")||"",l=e.data("guidentity"),d=o||t.properties.xpathContext;switch(i){case"Process":a&&t.processStartForm({guidprocess:r,idStartScope:a,title:n,xpathContext:o,recordXpath:d});break;case"Form":var c={guidProcess:r,idStartScope:a,editMode:!0,xpathContext:o,idEntity:s,guidEntity:l,guidObject:r};t.processActionForm(c)}}))}))},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-action-launcher-actions-to-execute-container",e),i=$(".actions-to-execute-title",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.combo",bizagi.rendering.columns.combo.prototype),bizagi.rendering.desktop.columns.combo.extend("bizagi.rendering.desktop.columns.combo",{},{postRender:function(e,t,i){this._super(e,t,i);var r=this.getMode(),a=$(".ui-selectmenu-status",t);(this.applyColumnStyles(a),this.properties.editable&&i&&i.addClass("ui-bizagi-cell-combo"),"execution"===r)&&(this.getDecorated(e).getControl().parents("tr").data("new-row")?this.isNewRow=!0:this.isNewRow=!1)},postRenderReadOnly:function(e,t,i){this._super(e,t,i);var r=$(".ui-selectmenu-status",t);this.applyColumnStyles(r),i&&i.removeClass("ui-bizagi-cell-combo")},applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath,e.cleanData=function(){this.value=this.properties.value=this.selectedValue={id:0,value:this.getResource("render-combo-empty-value")},this.setValue(this.value);var e=this.getControl().find("input");e&&e.val(this.getValue().value)}}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.document",bizagi.rendering.columns.document.prototype),bizagi.rendering.desktop.columns.document.extend("bizagi.rendering.desktop.columns.document",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),e.getControlHtml=this.getControlHtml,"design"!==t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.getDocumentXpath=this.getDocumentXpath,e.getContextXpath=this.getContextXpath,e.documentTemplateGenerate=this.documentTemplateGenerate,e.preRenderControl=this.preRenderControl,e.deleteDocumentTemplate=this.deleteDocumentTemplate,e.getTemplateItem=this.getTemplateItem,e.properties.xpathContext=this.getContextXpath())},getTemplateItem:function(){return"document-column-item"},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath),t.buttonExecuted=!0;var i=e.parent,r=e.getFormContainer();$.when(r.submitData()).done((function(){$.when(e.dataService.generateDocumentTemplate(t)).done((function(t){$.when(i.refresh()).done((function(){e.autoOpenDocuments()})),e.endLoading()})).fail((function(){e.showErrorMessage(),e.endLoading()}))})).fail((function(t){e.getFormContainer().addErrorMessage(t),e.endLoading()})),t.buttonExecuted=!1},getControlHtml:function(e,t,i,r,a,n){for(var o=!0,s=0;s<this.parent.properties.data.rows.length;s++)if(this.parent.properties.data.rows[s][0]==this.surrogateKey){o=!1;break}return $.fasttmpl(e,{noActivateButton:o,editable:"execution"!==t,downloadalldocuments:i,required:a.required,allowgenerate:r,xpath:this.getXpath(a.xpath),append:!!a.append&&a.append,caption:a.caption,noFiles:n,allowSendInMail:a.allowSendInMail,mode:t}).replace("ui-bizagi-document-upload-item-design","ui-bizagi-document-upload-item-design-column")},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!=i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getDocumentXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!=i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),t},postRenderReadOnly:function(e,t,i){this._super(e,t,i)},getContextXpath:function(){var e=this.getFormContainer();return(e.properties.xpathContext?e.properties.xpathContext+".":"")+this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},preRenderControl:function(){null!=this.value&&null!=this.properties.value&&(this.properties.value=this.value)},deleteDocumentTemplate:function(e){var t=this.parent,i={};i.xpath=this.properties.xpath+"[fileName='"+e+"']",i.idRender=this.properties.id,i.xpathContext=this.getContextXpath(),i.idPageCache=this.properties.idPageCache,$.when(this.dataService.deleteUploadFile(i)).done((function(){t.refresh()}))}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.letter",bizagi.rendering.columns.letter.prototype),bizagi.rendering.desktop.columns.letter.extend("bizagi.rendering.desktop.columns.letter",{},{applyOverrides:function(e){this.properties,this.getMode();this._super(e),e.getContextXpath=this.getContextXpath,e.getXpath=this.getXpath,e.getControl=this.getControl,e.setDisplayValue=this.setDisplayValue,e.postRenderReadOnly=function(t){var i=e.renderReadOnly.apply(e);$(".ui-bizagi-cell",t).append(i)}},getContextXpath:function(){var e=this.getMode(),t=this.properties;return"execution"===e?t.xpathContext&&t.xpathContext.length>0?t.xpathContext+"."+this.grid.properties.xpath+"[id="+this.surrogateKey+"]":this.grid.properties.xpath+"[id="+this.surrogateKey+"]":""},getXpath:function(){var e=this.properties.xpath,t=e.indexOf(this.grid.properties.xpath);return-1!=t&&(e=e.substr(t+this.grid.properties.xpath.length+1)),e},postRender:function(e,t){this._super(e,t);var i=this.getMode();if(this.setSurrogateKey(e),"execution"==i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")&&r.html(bizagi.localization.getResource("render-grid-column-letter-mandatory-key"))}},getControl:function(){return this.properties.editable?$(".ui-bizagi-render-control",this.element):$(".ui-bizagi-cell",this.element)},setDisplayValue:function(e){this.setValue(e,!1)}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.search",bizagi.rendering.columns.search.prototype),bizagi.rendering.desktop.columns.search.extend("bizagi.rendering.desktop.columns.search",{},{postRender:function(e,t){this._super(e,t);var i=this.getDecorated(e),r=$(".ui-selectmenu-status",i.getControl());this.applyColumnStyles(r),this.properties.editable&&i.getControl().addClass("ui-bizagi-cell-search")},postRenderReadOnly:function(e,t,i){this._super(e,t);var r=$(".ui-selectmenu-status",t);this.applyColumnStyles(r)},applyOverrides:function(e){if(this._super(e),e.refreshControl=this.refreshControl,e.properties.advancedSearch){var t=e.internalRenderCellControl;e.internalRenderCellControl=function(e,i,r,a){var n=this,o=r.properties.editable;r.properties.editable=e,$.when(r.render(i,a.getValue(i))).done((function(o){n.element&&n.element.find("[data-bizagi-component=cellContent] > div").replaceWith(o),t.call(n,e,i,r,a)})),r.properties.editable=o}}},refreshControl:function(){this.grid.refreshCell({key:this.surrogateKey,column:this.properties.xpath,xpathContext:this.getFormContainer().properties.xpathContext})}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.date",bizagi.rendering.columns.date.prototype),bizagi.rendering.desktop.columns.date.extend("bizagi.rendering.desktop.columns.date",{},{applyOverrides:function(e){e.originalRenderElement=e.renderElement,e.renderElement=function(){return this.originalRenderElement("render-base")},this._super(e)},resolveValue:function(e,t){var i="";if((bizagi.util.isString(t)||bizagi.util.isNumeric(t))&&(i=t),bizagi.util.isArray(t)){var r=e.grid.getIndexes(),a=e.surrogateKey,n=r.indexOf(a);-1!==n&&(i=t[n])}return i},postRender:function(e,t){this._super(e,t);var i=this.properties;this.getDecorated(e).properties.showTime=!!i.showTime&&i.showTime;var r=$(".bz-input-icon",t);this.applyColumnStyles(r)},postRenderReadOnly:function(e,t){this._super(e,t);var i=this.properties;this.getDecorated(e).properties.showTime=!!i.showTime&&i.showTime}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.text",{},{postRender:function(e,t){this._super(e,t);var i=$("input, textarea",t);this.applyColumnStyles(i)},postRenderReadOnly:function(e,t){if(this.properties.autoExtend){var i=t.find(".ui-bizagi-cell-readonly");i.length>0&&i.css("max-height","none")}this._super(e,t)},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!=i.length&&i.blur((function(){var t=$(this),i=e.previousValue,r=e.value;null!=i&&r!=i&&null!=$(this).data("newValue")&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)}))},applyOverrides:function(e){this._super(e);var t=e.internalRenderCellControl;e.internalRenderCellControl=function(e,i,r,a){var n=this,o=r.properties.editable;r.properties.editable=e,$.when(r.render(i,a.getValue(i))).done((function(o){n.element&&n.element.find("[data-bizagi-component=cellContent] > div").replaceWith(o),t.call(n,e,i,r,a)})),r.properties.editable=o}}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.searchList",{},{init:function(e){this._super(e);this.properties},render:function(e,t,i){var r=this.getDecorated(e),a=this.properties;a.recalculate&&r.resetData();var n=a.xpathContext.length>0?a.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return r.properties.xpathContext=n,this._super(e,t,i)},setValue:function(e,t){var i=this.getDecorated(e);"undefined"!=i&&null!=i&&(i.properties.originalValue=t,i.properties.previousValue=t,null==t&&void 0!==this.properties.defaultvalue&&null!=i.grid&&(t=this.setDefaultValue(e,i)),null==t&&(t=[]),i.properties.value=t,i.setValue(t,!1))}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.number",{},{postRender:function(e,t){this._super(e,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(e,t){return this.renderReadOnly(e,t)},postRenderSummary:function(e,t){return this.postRenderReadOnly(e,t),!0},applyOverrides:function(e){this._super(e);var t=e.internalRenderCellControl;e.internalRenderCellControl=function(e,i,r,a){var n=this,o=r.properties.editable;r.properties.editable=e,$.when(r.render(i,a.getValue(i))).done((function(o){n.element&&n.element.find("[data-bizagi-component=cellContent] > div").replaceWith(o),t.call(n,e,i,r,a)})),r.properties.editable=o}}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.numberScientificNotation",{},{postRender:function(e,t){this._super(e,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(e,t){return this.renderReadOnly(e,t)},postRenderSummary:function(e,t){return this.postRenderReadOnly(e,t),!0}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.upload",{},{applyOverrides:function(e){var t=this.getMode();if(this._super(e),e.getUploadXpath=this.getUploadXpath,"design"!==t&&"layout"!==t){var i=e.applyUploadPlugin;e.getXpathContext=function(){var e=this.grid.properties.xpath+"[id="+this.surrogateKey+"]";return this.properties.xpathContext.length>0?this.properties.xpathContext+"."+e:e},e.getUploadXpathContext=function(){return this.properties.xpathContext.length>0?this.properties.xpathContext:""},e.applyUploadPlugin=function(){var t=this.getControl();i.apply(e,arguments),t.undelegate(".ui-bizagi-render-upload-item","mouseover"),t.undelegate(".ui-bizagi-render-upload-item","mouseout"),$(".ui-bizagi-render-upload-icon",t).css("display","inline-block"),$(".ui-bizagi-render-upload-wrapper object",t).css({position:"relative"}),$(".ui-bizagi-render-upload-queue",t).css({"max-width":"150px"})},e.postRender=function(){var e=this.getControl();this.properties.allowSendInMail&&this.bindEmailDialog(),e.addClass("ui-bizagi-render-display-block"),e.addClass("ui-bizagi-render-upload"),this.checkMaxFiles()},e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getUploadXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})}}e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),r=this.getXpathContext();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:t.xpath,xpathContext:r,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})},e.processUploadFile=function(){var e=this,t=e.dialogBox,i=new $.Deferred,r=$("form",t),a=$("iframe",r),n=e.getXpathContext();$("[name=h_xpathContext]",r).val(n);return function t(){try{var r="";if(a[0].contentWindow)r=(bizagi.util.isIE8()?$(a[0].contentWindow.document.body):$(a[0].contentWindow.eval("document.body"))).text();if(r.length>0)i.resolve(r);else var n=setTimeout((function(){t(),clearTimeout(n)}),50)}catch(t){e.closeUploadDialog(),window.alert(t.toString())}}(),r.submit(),i.promise()}},renderReadOnly:function(e,t){var i,r=this,a=this.getDecorated(e);if(r.setValue(e,t),r.setSurrogateKey(e),r.applyOverrides(a),a.grid=this.grid,a.column=this,a.surrogateKey=e,r.readyDeferred=new $.Deferred,a.files.length>0){var n=this.properties.editable;a.properties.editable=!1,i=a.render("cell.upload"),a.properties.editable=n}return r.bind("rendered",(function(){r.readyDeferred.resolve()})),i},postRenderReadOnly:function(e,t){if(this._super(e,t),0==this.getDecorated(e).files.length){var i=this.getResource("render-upload-no-files");$(".ui-bizagi-cell-readonly",t).html(i),$(".ui-bizagi-cell-icon",t).addClass("ui-bizagi-cell-icon-right")}else t&&t.length>0&&this.applyColumnStyles(t)},postRender:function(e,t){var i=this.getMode();if(this._super(e,t),this.setSurrogateKey(e),"design"!=i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")?(r.html(bizagi.localization.getResource("render-grid-column-upload-mandatory-key")),this.isNewRow=!0):this.isNewRow=!1}},canBeSent:function(){return!1},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath}}),bizagi.rendering.desktop.columns.combo.extend("bizagi.rendering.desktop.columns.radio",{},{applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath,e.cleanData=function(){var e={id:"",label:""};this.element.find(".ui-radio-state-checked").removeClass("ui-radio-state-checked"),this.setDisplayValue(e),this.setValue(e)}}}),bizagi.rendering.desktop.columns.combo.extend("bizagi.rendering.desktop.columns.list",{},{applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath,e.cleanData=function(){var e=this.getControl().find(".ui-state-active"),t=this.getValue();this.value=this.properties.value=this.selectedValue={id:"",value:""},this.selectedValue=t.value,e.removeClass("ui-state-focus ui-selected ui-state-active")}}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.image",{},{applyOverrides:function(e){var t=this,i=t.properties,r=t.getMode();this._super(e),e.getUploadXpath=this.getUploadXpath;var a=e.applyUploadPlugin;e.properties.flashVersion&&(e.applyUploadPlugin=function(){var t=this,i=t.getControl();a.apply(e,arguments),i.undelegate(".ui-bizagi-render-upload-item","mouseover"),i.undelegate(".ui-bizagi-render-upload-item","mouseout"),$(".ui-bizagi-render-upload-icon",i).css("display","inline-block"),$(".ui-bizagi-render-upload-wrapper object",i).css({position:"relative"})});var n=e.renderControl,o=e.internalPostRender;e.renderControl=function(){return""},e.internalPostRender=function(){var i=e.getControl();i.parents("tr").data("new-row")?(i.html(bizagi.localization.getResource("render-grid-column-upload-mandatory-key")),t.isNewRow=!0):(t.isNewRow=!1,$.when(n.apply(e,arguments)).done((function(t){(i.hasClass("ui-bizagi-render-control")||i.hasClass("ui-bizagi-cell-readonly"))&&(i.append(t),o.apply(e,arguments))})))},e.buildAddParams=function(){var e=this.properties,t=this.getFormContainer(),i=[];i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath",value:e.xpath}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender",value:e.id}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext",value:e.xpathContext}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE,value:e.idPageCache}),i.push({key:this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",value:t.properties.sessionId}),i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action",value:"savefile"}),e.contexttype&&i.push({key:this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",value:e.contexttype});try{null!=BIZAGI_SESSION_NAME?i.push({key:BIZAGI_SESSION_NAME,value:t.properties.sessionId}):i.push({key:"JSESSIONID",value:t.properties.sessionId})}catch(e){i.push({key:"JSESSIONID",value:t.properties.sessionId})}return i},e.refreshControl=this.refreshControl,"execution"===r&&(i.xpathContext.length>0?e.properties.xpathContext=i.xpathContext+"."+t.grid.properties.xpath+"[id="+e.surrogateKey+"]":e.properties.xpathContext=t.grid.properties.xpath+"[id="+e.surrogateKey+"]")},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath},refreshControl:function(){this.grid.refreshCell({key:this.surrogateKey,column:this.properties.xpath,xpathContext:this.getFormContainer().properties.xpathContext})},canBeSent:function(){return!1}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.uploadecm",{},{applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath;var t=e.applyUploadPlugin;e.applyUploadPlugin=function(){var i=this,r=i.getControl();t.apply(e,arguments),r.undelegate(".ui-bizagi-render-upload-item","mouseover"),r.undelegate(".ui-bizagi-render-upload-item","mouseout"),$(".ui-bizagi-render-upload-icon",r).css("display","inline-block"),$(".ui-bizagi-render-upload-wrapper object",r).css({position:"relative"})},e.buildAddParams=function(){var e=this.properties,t={},i=this.getUploadXpath(this.surrogateKey);i=i.split(".");var r=this.getXpathContext(this.surrogateKey);return t.url=e.addUrl,t.xpath=e.xpath,t.idAttrib=e.idAttrib,t.xpathContext=r,t.metaValues=[],t.idPageCache=e.idPageCache,t.contexttype="entity",t.validExtensions=e.validExtensions,t.maxSize=e.maxSize,t},e.getXpathContext=function(){var e=this.grid.properties.xpath+"[id="+this.surrogateKey+"]";return this.properties.xpathContext.length>0?this.properties.xpathContext+"."+e:e}},renderReadOnly:function(e,t){var i,r=this,a=this.getDecorated(e);if(a.setValue(t),r.setValue(e,t),r.setSurrogateKey(e),r.applyOverrides(a),a.grid=this.grid,a.column=this,a.surrogateKey=e,r.readyDeferred=new $.Deferred,a.files.length>0){this.properties.editable;a.properties.editable=!1,i=a.render("cell.upload")}return r.bind("rendered",(function(){r.readyDeferred.resolve()})),i},postRenderReadOnly:function(e,t){this._super(e,t);if(0==this.getDecorated(e).files.length){var i=this.getResource("render-upload-no-files");$(".ui-bizagi-cell-readonly",t).html(i),$(".ui-bizagi-cell-icon",t).addClass("ui-bizagi-cell-icon-right")}else t&&t.length>0&&this.applyColumnStyles(t)},postRender:function(e,t){this._super(e,t);var i=this.getMode();if(this.setSurrogateKey(e),"execution"==i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")?(r.html(bizagi.localization.getResource("render-grid-column-upload-mandatory-key")),this.isNewRow=!0):this.isNewRow=!1}},getUploadXpath:function(e){e=this.surrogateKey||e||"";var t=this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath;return this.properties.xpathContext.length>0?this.properties.xpathContext+"."+t:t}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.link",{},{applyOverrides:function(e){var t=this;this._super(e),e.getControl=this.getControl,"columnFormLink"===e.properties.type&&(e.getFormLinkXpath=this.getFormLinkXpath);var i=e.renderControl,r=e.internalPostRender;e.internalPostRender=function(){var a=e.getControl();a.parents("tr").data("new-row")?(a.html('<label style="font-weight: normal;">'+bizagi.localization.getResource("render-grid-column-button-mandatory-key")+"</label>"),t.isNewRow=!0):(t.isNewRow=!1,$.when(i.apply(e,arguments)).done((function(t){(a.hasClass("ui-bizagi-render-control")||a.hasClass("ui-bizagi-cell-readonly"))&&r.apply(e,arguments)})))}},getControl:function(){var e=this.properties,t=this.element||this.observableElement;return e.editable?$(".ui-bizagi-render-control",t):$(".ui-bizagi-cell-readonly",t).length>0?$(".ui-bizagi-cell-readonly",t):$(".ui-bizagi-render-control",t)},render:function(e,t,i,r){var a=this.getDecorated(e);return a.properties.xpathContext=this.grid.properties.xpath+"[id="+e+"]",this.grid.properties.xpathContext&&-1==a.properties.xpathContext.indexOf(this.grid.properties.xpathContext)&&(a.properties.xpathContext=this.grid.properties.xpathContext+"."+a.properties.xpathContext),this._super(e,t,i,r)},renderReadOnly:function(e,t,i){return void 0===this.properties.canBeSaved&&(this.properties.canBeSaved=1==this.properties.editable),this.render(e,t,i,"CALLER_RENDER_READ_ONLY_COLUMNSLINK")},postRenderReadOnly:function(e,t,i){this.postRender(e,t,i)},getFormLinkXpath:function(){if(this.properties.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties(),this.properties.xpath)return this.properties.xpath}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.button",{},{applyOverrides:function(e){this.properties,this.getMode();this._super(e),e.configureHandlers=function(){var t=this,i=e.getControl();$(":button",i).bind("click",(function(i){e.processButton.apply(t)}))}},postRender:function(e,t){this._super(e,t);var i=this.getMode();if(this.setSurrogateKey(e),"execution"==i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")?(r.html(bizagi.localization.getResource("render-grid-column-button-mandatory-key")),this.isNewRow=!0):this.isNewRow=!1}},postRenderReadOnly:function(e,t){this.properties;this._super(e,t)},renderReadOnly:function(e,t){var i,r=this,a=this.getDecorated(e);r.setSurrogateKey(e),r.applyOverrides(a),a.grid=this.grid,a.column=this,a.surrogateKey=e,r.readyDeferred=new $.Deferred;var n=this.properties.editable;return a.properties.editable=!1,i=a.render("cell.button"),a.properties.editable=n,r.bind("rendered",(function(){r.readyDeferred.resolve()})),i}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.actions",{},{postRender:function(e,t){var i=this.getMode();if(this._super(e,t),this.configureHandlersActions(e),$(".ui-bizagi-render",t).css("overflow","auto"),"execution"==i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")&&r.html(this.renderDraftControl())}},configureHandlersActions:function(e){var t=this,i=t.getDecorated(e),r=i.element.find(".gn-bz-grid__more"),a=[];i.element.on("click",".gn-bz-grid__delete",(function(e){$(this).closest("tr[data-new-row='true']").trigger("delete-row")})),t.grid.columnActionParams.allowDetail&&a.push({name:t.parent.properties.detailLabel,icon:"icon-detail",fn:function(){t.grid.showFormDetails(e)}}),t.grid.columnActionParams.allowEdit&&t.grid.columnActionParams.withEditForm&&a.push({name:t.parent.properties.editLabel,icon:"icon-edit",fn:function(){t.grid.editRow(e)}}),t.grid.columnActionParams.allowDelete&&a.push({name:t.parent.properties.deleteLabel,icon:"icon-delete",fn:function(){t.grid.deleteRow(e)}}),r.overflowMenu({items:a})},renderDraftControl:function(){var e=this.renderFactory.getTemplate("gridActions-delete");return $.fasttmpl(e,{})}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.exclusiveCheck",{},{render:function(e,t){var i=this;i.changed=!1;var r=i.properties,a=i.grid.changes,n=i.getDecorated(e);if(n.grid=i.grid,n.column=this,n.surrogateKey=e,"execution"==i.getMode()){i.setValue(e,t||!1);var o=i.grid.enabledChecks[i.properties.xpath].find((function(t){return t.id==e}));void 0===o&&i.grid.enabledChecks[i.properties.xpath].push({id:e,value:t||!1,originalValue:t||!1,changed:!1})}if(null==t){i.changed=!0;var s={};s[i.properties.xpath]=i.getValue(e),bizagi.util.isEmpty(a[e])&&(a[e]={}),a[e]=$.extend({},a[e],s)}if(i.overrideDecoratedRenderProperties(e),!r.editable)return i.renderReadOnly.apply(i,arguments);i.readyDeferred=new $.Deferred;var l=n.render("cell");return n.bind("renderchange",(function(){i.changed=!0,i.grid.enabledChecks[i.properties.xpath].forEach((function(t){if(t.id==e)t.value=n.value,t.changed=!0;else if(n.value&&t.value){i.getDecorated(t.id).setDisplayValue(!1),i.setValue(t.id,!1),t.value=!1,t.changed=!0}}));var t=i.properties.xpath.split(".");i.grid.exclusiveChanges[i.properties.xpath]={xpath:i.properties.xpath,simpleXpath:t[t.length-1],value:i.getValue(e),key:e}})),i.bind("rendered",(function(){i.readyDeferred.resolve()})),l},postRender:function(e,t){this._super(e,t);var i=this.getMode();if(this.setSurrogateKey(e),"execution"==i){var r=this.getDecorated(e).getControl();r.parents("tr").data("new-row")?(r.html('<input type="checkbox" name="exclusiveCheck" title="'+bizagi.localization.getResource("render-grid-column-button-mandatory-key")+'" disabled="disabled" style="width:16.5px;height:16.5px;">'),this.isNewRow=!0):this.isNewRow=!1}},isValueValid:function(e,t,i,r){if(this.grid.enabledChecks=this.grid.enabledChecks||{},(this.grid.enabledChecks[this.properties.xpath]||[]).filter((function(e){return e.value})).length>1){var a=this.getResource("render-exclusive-column-check-error").replaceAll("#label#",this.properties.displayName);return i.push(a),!1}return!0}}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.readonly",bizagi.rendering.columns.readonly.prototype),bizagi.rendering.desktop.columns.readonly.extend("bizagi.rendering.desktop.columns.readonly",{},{}),bizagi.rendering.desktop.columns.column.extend("bizagi.rendering.desktop.columns.hidden",bizagi.rendering.columns.hidden.prototype),bizagi.rendering.desktop.columns.hidden.extend("bizagi.rendering.desktop.columns.hidden",{},{}),bizagi.rendering.desktop.search.extend("bizagi.rendering.desktop.querySuggest",{},{getData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.getFormContainer(),n=a.getContextType()||a.params.contexttype||!1;if(e=e||{},t.properties.contexttype?e.h_contexttype=t.properties.contexttype:n&&(e.h_contexttype=n),e&&e.h_contexttype&&"metadata"===e.h_contexttype&&(i.xpathContext=""),i.term.indexOf("'")>-1){var o=new RegExp("'","g");i.term=i.term.replace(o,"\\'\\'")}if(i.term.indexOf('"')>-1){o=new RegExp('"',"g");i.term=i.term.replace(o,'"')}return t.dataService.multiaction().getSearchData({url:i.dataUrl,contexttype:"metadata",xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.allowFullSearch?"%"+i.term:i.term,extra:e}).done((function(e){i.data=e,r.resolve(i.data)})).fail((function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)})),r.promise(r)},renderClearItem:function(){var e=this,t=e.renderSearchItem({id:e.Class.CLEAR_SEARCH_ID,label:this.getResource("render-search-clear-label")});return t.click((function(){e.setValue({id:""}),e.setDisplayValue("")})),t}}),bizagi.rendering.desktop.extendedText.extend("bizagi.rendering.desktop.queryExtendedText",{},{}),bizagi.rendering.desktop.text.extend("bizagi.rendering.desktop.queryText",{},{}),bizagi.rendering.desktop.check.extend("bizagi.rendering.desktop.queryCheck",{},{getValue:function(){return bizagi.util.parseBoolean(this.value)}}),bizagi.rendering.desktop.yesno.extend("bizagi.rendering.desktop.queryYesNo",{},{getValue:function(){return bizagi.util.parseBoolean(this.value)}}),bizagi.rendering.desktop.search.extend("bizagi.rendering.desktop.querySearch",{},{showSearchDialog:function(){var e,t=this,i=t.properties,r=i.searchForms.length>0&&"searchForm"==i.searchForms[0].type?"metadata":"entity";i.allowNew&&(e=t.showAddRecordDialog()),t.searchDialog=new bizagi.rendering.dialog.search(t.dataService,t.renderFactory,i.searchForms,{allowFullSearch:i.allowFullSearch,maxRecords:i.maxRecords},e),t.searchDialog.render({idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:r}).done((function(e){data={id:e.id,value:e.id},t.setDisplayValue(data),t.setValue(data)}))}}),bizagi.rendering.desktop.form.extend("bizagi.rendering.desktop.queryForm",{},{postRenderContainer:function(e){var t=this.container.find(".ui-bizagi-render-control-included-all");this._super(e),this.container.find(".ui-bizagi-render-control-included").length<=0&&t.parent().hide()},collectRenderValuesForSubmit:function(e){var t=this,i=[];return t.collectRenderValuesQueryForm(i),$.each(i,(function(e,i){var r=t.getRenders(i.xpath),a=function(e,t){return e.filter((function(e){return bizagi.util.tryCatch((function(){return i=e.properties.rangeQuery,r=t.searchType,i.toUpperCase()===r.toUpperCase();var i,r}),!0)}))}(r,i);0===a.length&&(a=r),i.displayHeader=a[0].properties.xpath.indexOf("@")>-1?a[0].properties.xpath:null,$.each(a,(function(e,t){t.updateOriginalValue()}))})),e.parameters=i,e},getSearchParams:function(e){var t=this.getValidationsContainer();return this.validationController=new bizagi.command.controllers.validation(this,this.validations,t),this.validationController.performValidations()?this.collectRenderValuesForSubmit(e):(this.validationController.expandNotificationBox(),null)},configureHandlers:function(){var e=this;e._super();var t=e.container.find(".ui-bizagi-render-control-included-all");t.tooltip({position:{my:"right-20 center",at:"right center"},tooltipClass:"bz-wp-queryForm-check-all"}),t.change((function(){var i=t.is(":checked");!function t(r){$.each(r.children,(function(r,a){a.element?e.isControlVisible(a)&&!0===a.properties.includedInResult&&(a.properties.included=i,a.element.find(".ui-bizagi-render-control-included").prop("checked",i)):a.children&&t(a)}))}(e)}))},isControlVisible:function(e){return e.parent?!!e.properties.visible&&this.isControlVisible(e.parent):e.properties.visible}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.queryTextAdvanced",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.queryTextAdvanced.extend("bizagi.rendering.desktop.queryTextAdvanced",bizagi.rendering.queryAdvanced.prototype),bizagi.rendering.desktop.queryTextAdvanced.extend("bizagi.rendering.desktop.queryTextAdvanced",{DATATYPE:"Text",TOOLTIP_TITLE:"Use the (%) percent to get accurate results related to your keyword. e.g:",TOOLTIP_CONTENT:"<br/>&#9679; %ABC if the keyword ends with ABC.</br>&#9679; AB%C if the keyword starts with AB and ends with C.<br/>&#9679; ABC% if the keyword starts with ABC."},{initializeData:function(e){this.maxLength=e.properties.maxLength,e.properties.maxLength=0,this.defaultFilter="wildcard",this._super(e),this.isNewRenderForm=!0},postRender:function(){var e=this.properties.filterType||"";this._super(),this.setFilter(e)},setValue:function(e,t){t=void 0===t||t,e=Array.isArray(e)?JSON.encode(e):e,this._super(e,t)},prepareForSetValue:function(){var e=this.getCurrentFilter(),t=bizagi.util.isEmpty(e)?this.defaultFilter:e.id;this.setFilter(t)},setDisplayValue:function(e){var t=this.getControl();this.properties.editable&&this.prepareForSetValue();var i=this.getCurrentAction(),r=this.performDataValue(e);if(this.setValue(r,!1),this.isExecutionMode()?this.showHideCleanButton(!0):this.controlInitial&&this.controlInitial.setDisplayValue(e),this.isCurrentTagFilter())this.addSelectedElements();else if(["wildcard","like","starts-with","ends-with"].includes(i)){if(e&&$.trim(e).length>0)if(this.controlInitial&&this.controlInitial.setDisplayValue(r),this.isCurrentWildcardFilter())t.find(".bz-query-advanced").data("mode-wildcard",!0)}},configureHandlers:function(){this._super(),this.configureWildcardHandlers()},configureWildcardHandlers:function(){var e=this,t=e.getControl(),i=e.renderFactory.getTemplate("query.advanced-tooltip"),r=$.tmpl(i,{title:bizagi.localization.getResource("workportal-widget-filter-wildcard-tooltip-title",e.Class.TOOLTIP_TITLE),content:bizagi.localization.getResource("workportal-widget-filter-wildcard-tooltip-content",e.Class.TOOLTIP_CONTENT)});t.on("keyup",".bz-query-advanced__input",(function(){if(!e.filterOptionIsShowed()){var i,a=t.find(".bz-query-advanced"),n=$(".bz-query-advanced__clean",a);$.trim(this.value).length>0?(a.data("mode-wildcard",!0),i=n.hasClass("bz-hidden"),e.setCurrentFilter({id:"wildcard"}),e.closeFloatView()):(a.data("mode-wildcard",!1),n.addClass("bz-hidden"),i=!n.hasClass("bz-hidden"),e.setCurrentFilter({id:""})),i&&e.showHideCleanButton(!0),e.isCurrentWildcardFilter()&&e.showTooltip(a,r.html())}}))},showTooltip:function(e,t){e.attr("title",t),void 0===e.data("tooltip")&&e.tooltip({tooltipClass:"bz-query-advanced__wildcard-tooltip",position:{my:"left bottom",at:"left top"},content:function(){var e=$(this)[0];if(e&&e.title){var t=e.title;return e.title="",t}}}),e.tooltip("open")},renderElement:function(){return this._super("render-base")},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeCellRequired:function(e){this.changeRequired(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},getValue:function(){return this.isCurrentTagFilter()?this.performTagItems():this.isCurrentNullFilter()?null:this.controlInitial?this.controlInitial.getValue():""},getLabel:function(){return $("label",this._super())},cleanDataFilter:function(e){var t=$(".bz-query-advanced",this.getControl());t.data("ui-tooltip")&&(t.tooltip("destroy"),t.removeAttr("title")),t.data("mode-wildcard",!1),this._super(e)},defineLiteControl:function(e){var t=e&&e.typeFilter||"advanced",i=new bizagi.rendering.desktop.textAdvanced(this.getRenderProperties({typeControl:t,isRange:this.isCurrentBetweenFilter()}));this.setLiteControls(i,null)},setLiteControls:function(e,t){var i=this.getControl(),r=this.getCurrentFilter(),a=r&&r.action||"default";this.controlInitial=e||null,this.controlEnd=t||null;var n=this.renderFactory.getTemplate("query.advanced-content"),o=$.tmpl(n,{value:this.getResourceByKey(r.label,r.defaultLabel),id:r.id,filterType:a}),s=$(".bz-query-advanced__filter",i).empty();s.append(o);var l=$(".bz-query-advanced__filter-input",s);this.renderLiteControl(a,l,e)},renderLiteControl:function(e,t,i){var r=this;$.when(i.render(this.getTemplateByType(e))).done((function(e){t.empty().append(e);var a=r.getCurrentAction(),n=$(".bz-query-advanced__input",t);n.attr("data-action",a),r.isCurrentNullFilter()&&n.attr("readonly",!0),i.postRenderElement(t,!0),r.isCurrentTagFilter()||r.configureInternalHandlers(i)}))},getTemplateByType:function(e){return["between","tags"].includes(e)?"query.advanced-text":"query.advanced-input"},configureInternalHandlers:function(e){var t=this;e.getInputControl().bind("updateData",(function(e,i){t.setValue(t.getValue())}))},getRequiredProperties:function(){return{maxLength:this.maxLength}}}),bizagi.rendering.desktop.text.extend("bizagi.rendering.desktop.textAdvanced",{},{getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=$(this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},setValue:function(e){e=e||"",this._super(e);var t=this.getInputControl();t&&t.trigger("updateData",{data:e})},getInputControl:function(){return $("input",this.getControl())||null}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.queryNumberAdvanced",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.queryNumberAdvanced.extend("bizagi.rendering.desktop.queryNumberAdvanced",bizagi.rendering.queryAdvanced.prototype),bizagi.rendering.desktop.queryNumberAdvanced.extend("bizagi.rendering.desktop.queryNumberAdvanced",{DATATYPE:"Number"},{initializeData:function(e){this._super(e),this.isNewRenderForm=!0,this.defaultFilter="default";var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.setGroupDigits(),t.colorize=t.colorizeOnNegative||!1,t.minValue=t.minValue||null,t.maxValue=t.maxValue||null,t.dataType=t.dataType||1},postRender:function(){var e=this.properties.filterType||"";this._super(),this.setFilter(e)},setValue:function(e,t){t=void 0===t||t,e=Array.isArray(e)?JSON.encode(e):e,this._super(e,t)},setDisplayValue:function(e){this.properties.editable&&this.prepareForSetValue();var t=this.getCurrentAction(),i=this.performDataValue(e);if(this.setValue(i,!1),this.isExecutionMode()&&t!==this.defaultFilter?this.showHideCleanButton(!0):this.controlInitial&&this.controlInitial.setDisplayValue(e),this.isCurrentTagFilter())this.addSelectedElements();else if(["to","from"].includes(t))this.controlInitial&&this.controlInitial.setDisplayValue(i);else if(e&&["between"].includes(t)){var r=this.performListValue(e);r&&r.from&&this.controlInitial&&this.controlInitial.setDisplayValue(r.from),r&&r.to&&this.controlEnd&&this.controlEnd.setDisplayValue(r.to)}},renderElement:function(){return this._super("render-base")},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeCellRequired:function(e){this.changeRequired(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},getValue:function(){if(this.isCurrentTagFilter())return this.performTagItems();if(this.isCurrentBetweenFilter()){var e=this.controlInitial?this.formatInputValue(this.controlInitial.getValue()):"null",t=this.controlEnd?this.formatInputValue(this.controlEnd.getValue()):"null",i=[e,t];return"null"===e&&"null"===t?"":JSON.encode(i)}return this.isCurrentNullFilter()?null:this.controlInitial?this.controlInitial.getValue():""},getValidTagValue:function(e){return this.controlInitial&&this.controlInitial.numericInput.asNumber()||$.trim(e)},setGroupDigits:function(){return void 0!==this.properties.thousands?!!this.properties.digitGroupSymbol&&bizagi.util.parseBoolean(this.properties.thousands):!!this.properties.digitGroupSymbol&&this.getDefaultGroupDigits(this.properties.dataType)},getDefaultAllowDecimals:function(e){if(e){if([1,2,3,4,7].includes(e))return!1;if([6,8,10,11].includes(e))return!0}return!1},getDefaultGroupDigits:function(e){if(e){if([1,2,3,4,7].includes(e))return!1;if([6,8,10,11].includes(e))return!0}return!1},getLabel:function(){return $("label",this._super())},defineLiteControl:function(e){var t=e&&e.typeFilter||"advanced",i=null,r=new bizagi.rendering.desktop.numberAdvanced(this.getRenderProperties({typeControl:t,isRange:this.isCurrentBetweenFilter(),isMinimum:!0}));this.isCurrentBetweenFilter()&&(i=new bizagi.rendering.desktop.numberAdvanced(this.getRenderProperties({typeControl:t+"_max",isRange:this.isCurrentBetweenFilter(),isMaximum:!0})),r.subscribe(i),i.subscribe(r)),this.setLiteControls(r,i)},setLiteControls:function(e,t){var i=this.getControl(),r=this.getCurrentFilter(),a=r&&r.action||"default";this.controlInitial=e||null,this.controlEnd=t||null;var n=this.renderFactory.getTemplate("query.advanced-content"),o=$.tmpl(n,{value:this.getResourceByKey(r.label,r.defaultLabel),id:r.id,filterType:a}),s=$(".bz-query-advanced__filter",i).empty();if(this.isCurrentBetweenFilter()){s.append(o);var l=$(".bz-query-advanced__filter-input-from",s),d=$(".bz-query-advanced__filter-input-to",s);this.renderLiteControl(a,l,e),this.renderLiteControl(a,d,t)}else{s.append(o);var c=$(".bz-query-advanced__filter-input",s);this.renderLiteControl(a,c,e)}},renderLiteControl:function(e,t,i){var r=this;$.when(i.render(this.getTemplateByType(e))).done((function(e){t.empty().append(e);var a=r.getCurrentAction(),n=$(".bz-query-advanced__input",t);n.attr("data-action",a),r.isCurrentNullFilter()&&n.attr("readonly",!0),i.postRenderElement(t,!0),r.isCurrentTagFilter()||r.configureInternalHandlers(i)}))},getTemplateByType:function(e){return["between","tags"].includes(e)?"query.advanced-text":"query.advanced-input"},configureInternalHandlers:function(e){var t=this;e.getInputControl().bind("updateData",(function(e,i){t.setValue(t.getValue())}))},getRequiredProperties:function(){var e=this.properties;return{allowDecimals:e.allowDecimals,numDecimals:e.numDecimals,symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,colorize:e.colorize,minValue:e.minValue,maxValue:e.maxValue,dataType:e.dataType,percentage:e.percentage}},addTag:function(e){var t=this.controlInitial;if(t){var i=t.numericInput;if(t.formatNumericInput(i[0]),bizagi.util.isEmpty(t.getValue()))return;e.value=t.getValue()||"",e.displayValue=i.val()||""}this._super(e)},formatTagItem:function(e){var t=this.properties,i={symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize};return bizagi.util.formatDecimal(e,i)},changeMinValue:function(e){if(this.controlInitial){var t=this.controlInitial.performMinValue(e);this.properties.minValue=this.properties.dataTypeMinValue=t,this.controlInitial.changeMinValue(e),this.controlEnd&&this.controlInitial&&this.controlEnd.changeMinValue(e)}},changeMaxValue:function(e){if(this.controlInitial){var t=this.controlInitial.performMaxValue(e);this.properties.maxValue=this.properties.dataTypeMaxValue=t,this.controlEnd&&this.controlInitial?this.controlEnd.changeMaxValue(e):this.controlInitial.changeMaxValue(e)}},changeColor:function(e){var t=this.getControl();return this.controlInitial&&this.controlInitial.changeColor(e,!0),this.controlEnd&&this.controlEnd.changeColor(e,!0),this._super(e).changeFontColor($("label",t),e)},getElementsToStylize:function(e){return this._super(e)}}),bizagi.rendering.desktop.number.extend("bizagi.rendering.desktop.numberAdvanced",{},{getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=$(this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},subscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){if(this.properties.isRange)for(var t=this.observer.length-1;t>=0;t--)this.properties.isMaximumValue?(e=bizagi.util.isNumeric(e)?e:this.properties.maxValue||this.calculateMaxValue(this.properties.dataType),this.observer[t].changeMaxValue(e)):this.properties.isMinimumValue&&(e=bizagi.util.isNumeric(e)?e:this.properties.minValue||this.calculateMinValue(this.properties.dataType),this.observer[t].changeMinValue(e))},setValue:function(e){this._super(e),this.notify(e);var t=this.getInputControl();t&&t.trigger("updateData",{data:e})},getInputControl:function(){return $("input",this.getControl())||null}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.queryMoneyAdvanced",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.queryMoneyAdvanced.extend("bizagi.rendering.desktop.queryMoneyAdvanced",bizagi.rendering.queryAdvanced.prototype),bizagi.rendering.desktop.queryMoneyAdvanced.extend("bizagi.rendering.desktop.queryMoneyAdvanced",{DATATYPE:"Currency"},{initializeData:function(e){this._super(e),this.isNewRenderForm=!0,this.defaultFilter="default";var t=this.properties,i=this.getResource("numericFormat");if(t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.setGroupDigits(),t.colorize=t.colorizeOnNegative||!1,t.minValue=t.minValue||null,t.maxValue=t.maxValue||null,t.dataType=t.dataType||6,t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol){var r="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol;t.symbol=t.currencySymbol?t.currencySymbol:r}else t.symbol="";t.groupDigits=!0},postRender:function(){var e=this.properties.filterType||"";this._super(),this.setFilter(e)},setValue:function(e,t){t=void 0===t||t,e=Array.isArray(e)?JSON.encode(e):e,this._super(e,t)},setDisplayValue:function(e){this.properties.editable&&this.prepareForSetValue();var t=this.getCurrentAction(),i=this.performDataValue(e);if(this.setValue(i,!1),this.isExecutionMode()&&t!==this.defaultFilter?this.showHideCleanButton(!0):this.controlInitial&&this.controlInitial.setDisplayValue(e),this.isCurrentTagFilter())this.addSelectedElements();else if(["to","from"].includes(t))this.controlInitial&&this.controlInitial.setDisplayValue(i);else if(e&&["between"].includes(t)){var r=this.performListValue(e);r&&r.from&&this.controlInitial&&this.controlInitial.setDisplayValue(r.from),r&&r.to&&this.controlEnd&&this.controlEnd.setDisplayValue(r.to)}},renderElement:function(){return this._super("render-base")},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeCellRequired:function(e){this.changeRequired(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},getValue:function(){if(this.isCurrentTagFilter())return this.performTagItems();if(this.isCurrentBetweenFilter()){var e=this.controlInitial?this.formatInputValue(this.controlInitial.getValue()):"null",t=this.controlEnd?this.formatInputValue(this.controlEnd.getValue()):"null",i=[e,t];return"null"===e&&"null"===t?"":JSON.encode(i)}return this.isCurrentNullFilter()?null:this.controlInitial?this.controlInitial.getValue():""},getValidTagValue:function(e){return this.controlInitial&&this.controlInitial.numericInput.asNumber()||$.trim(e)},setGroupDigits:function(){return void 0!==this.properties.thousands?!!this.properties.digitGroupSymbol&&bizagi.util.parseBoolean(this.properties.thousands):!!this.properties.digitGroupSymbol&&this.getDefaultGroupDigits(this.properties.dataType)},getDefaultAllowDecimals:function(e){if(e){if([1,2,3,4,7].includes(e))return!1;if([6,8,10,11].includes(e))return!0}return!1},getDefaultGroupDigits:function(e){if(e){if([1,2,3,4,7].includes(e))return!1;if([6,8,10,11].includes(e))return!0}return!1},getLabel:function(){return $("label",this._super())},defineLiteControl:function(e){var t=e&&e.typeFilter||"advanced",i=null,r=new bizagi.rendering.desktop.moneyAdvanced(this.getRenderProperties({typeControl:t,isRange:this.isCurrentBetweenFilter(),isMinimum:!0}));this.isCurrentBetweenFilter()&&(i=new bizagi.rendering.desktop.moneyAdvanced(this.getRenderProperties({typeControl:t+"_max",isRange:this.isCurrentBetweenFilter(),isMaximum:!0})),r.subscribe(i),i.subscribe(r)),this.setLiteControls(r,i)},setLiteControls:function(e,t){var i=this.getControl(),r=this.getCurrentFilter(),a=r&&r.action||"default";this.controlInitial=e||null,this.controlEnd=t||null;var n=this.renderFactory.getTemplate("query.advanced-content"),o=$.tmpl(n,{value:this.getResourceByKey(r.label,r.defaultLabel),id:r.id,filterType:a}),s=$(".bz-query-advanced__filter",i).empty();if(this.isCurrentBetweenFilter()){s.append(o);var l=$(".bz-query-advanced__filter-input-from",s),d=$(".bz-query-advanced__filter-input-to",s);this.renderLiteControl(a,l,e),this.renderLiteControl(a,d,t)}else{s.append(o);var c=$(".bz-query-advanced__filter-input",s);this.renderLiteControl(a,c,e)}},renderLiteControl:function(e,t,i){var r=this;$.when(i.render(this.getTemplateByType(e))).done((function(e){t.empty().append(e);var a=r.getCurrentAction(),n=$(".bz-query-advanced__input",t);n.attr("data-action",a),r.isCurrentNullFilter()&&n.attr("readonly",!0),i.postRenderElement(t,!0),r.isCurrentTagFilter()||r.configureInternalHandlers(i)}))},getTemplateByType:function(e){return["between","tags"].includes(e)?"query.advanced-text":"query.advanced-input"},configureInternalHandlers:function(e){var t=this;e.getInputControl().bind("updateData",(function(e,i){t.setValue(t.getValue())}))},getRequiredProperties:function(){var e=this.properties;return{allowDecimals:e.allowDecimals,numDecimals:e.numDecimals,symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,colorize:e.colorize,minValue:e.minValue,maxValue:e.maxValue,dataType:e.dataType}},addTag:function(e){var t=this.controlInitial;if(t){var i=t.numericInput;t.formatNumericInput(i[0]),e.value=t.getValue()||"",e.displayValue=i.val()||""}this._super(e)},formatTagItem:function(e){var t=this.properties,i={symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize};return bizagi.util.formatDecimal(e,i)},changeMinValue:function(e){if(this.controlInitial){var t=this.controlInitial.performMinValue(e);this.properties.minValue=this.properties.dataTypeMinValue=t,this.controlInitial.changeMinValue(e),this.controlEnd&&this.controlInitial&&this.controlEnd.changeMinValue(e)}},changeMaxValue:function(e){if(this.controlInitial){var t=this.controlInitial.performMaxValue(e);this.properties.maxValue=this.properties.dataTypeMaxValue=t,this.controlEnd&&this.controlInitial?this.controlEnd.changeMaxValue(e):this.controlInitial.changeMaxValue(e)}},changeColor:function(e){var t=this.getControl();return this.controlInitial&&this.controlInitial.changeColor(e,!0),this.controlEnd&&this.controlEnd.changeColor(e,!0),this._super(e).changeFontColor($("label",t),e)},getElementsToStylize:function(e){return this._super(e)}}),bizagi.rendering.desktop.money.extend("bizagi.rendering.desktop.moneyAdvanced",{},{getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=$(this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},subscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){if(this.properties.isRange)for(var t=this.observer.length-1;t>=0;t--)this.properties.isMaximumValue?(e=bizagi.util.isNumeric(e)?e:this.properties.maxValue||this.calculateMaxValue(this.properties.dataType),this.observer[t].changeMaxValue(e)):this.properties.isMinimumValue&&(e=bizagi.util.isNumeric(e)?e:this.properties.minValue||this.calculateMinValue(this.properties.dataType),this.observer[t].changeMinValue(e))},setValue:function(e){this._super(e),this.notify(e);var t=this.getInputControl();t&&t.trigger("updateData",{data:e})},getInputControl:function(){return $("input",this.getControl())||null}}),bizagi.rendering.desktop.render.extend("bizagi.rendering.desktop.queryDateAdvanced",bizagi.rendering.render.base.prototype),bizagi.rendering.desktop.queryDateAdvanced.extend("bizagi.rendering.desktop.queryDateAdvanced",bizagi.rendering.queryAdvanced.prototype),bizagi.rendering.desktop.queryDateAdvanced.extend("bizagi.rendering.desktop.queryDateAdvanced",{DATATYPE:"DateTime"},{initializeData:function(e){this._super(e),this.isNewRenderForm=!0,this.defaultFilter=this.isExecutionMode()?"equal":"";var t=this.properties,i=this.getResource("dateFormat"),r=this.getResource("timeFormat");t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||i,t.timeFormat=t.timeFormat||r,t.fullFormat=t.dateFormat;var a=parseInt((new Date).getFullYear()+200).toString(),n=parseInt((new Date).getFullYear()-200).toString();void 0===t.maxValue&&(t.maxValue="12/31/"+a+" 00:00:00"),void 0===t.minValue&&(t.minValue="01/01/"+n+" 00:00:00"),t.value&&(this.value=t.value)},postRender:function(){var e=this.properties.filterType||"";this._super(),this.setFilter(e)},setValue:function(e,t){t=void 0===t||t,e=Array.isArray(e)?JSON.encode(e):e,this._super(e,t)},setDisplayValue:function(e){this.properties.editable&&this.prepareForSetValue();var t=this.getCurrentAction();if(this.setValue(e,!1),this.isExecutionMode()?this.showHideCleanButton(!0):this.controlInitial&&this.controlInitial.setDisplayValue(e),e&&["to","from","equal"].includes(t))this.controlInitial&&this.controlInitial.setDisplayValue(e);else if(e&&["between"].includes(t)){var i=this.performListValue(e);i.from&&this.controlInitial&&this.controlInitial.setDisplayValue(i.from),i.to&&this.controlEnd&&this.controlEnd.setDisplayValue(i.to)}},renderElement:function(){return this._super("render-base")},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeCellRequired:function(e){this.changeRequired(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?!0===bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required"):!0===bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("control-required"):t.removeClass("control-required")),this.triggerRenderValidate()},getValue:function(){if(this.isCurrentBetweenFilter()){var e=this.controlInitial?this.formatInputValue(this.controlInitial.getValue()):"null",t=this.controlEnd?this.formatInputValue(this.controlEnd.getValue()):"null",i=[e,t];return"null"===e&&"null"===t?"":JSON.encode(i)}return this.isCurrentNullFilter()?null:this.controlInitial?this.controlInitial.getValue():""},getLabel:function(){return $("label",this._super())},defineLiteControl:function(e){var t=e&&e.typeFilter||"advanced",i=null,r=new bizagi.rendering.desktop.dateAdvanced(this.getRenderProperties({typeControl:t,isRange:this.isCurrentBetweenFilter(),isMinimum:!0}));this.isCurrentBetweenFilter()&&(i=new bizagi.rendering.desktop.dateAdvanced(this.getRenderProperties({typeControl:t+"_to",isRange:this.isCurrentBetweenFilter(),isMaximum:!0})),r.subscribe(i),i.subscribe(r)),this.setLiteControls(r,i)},setLiteControls:function(e,t){var i=this.getControl(),r=this.getCurrentFilter(),a=r&&r.action||"default";this.controlInitial=e||null,this.controlEnd=t||null;var n=this.renderFactory.getTemplate("query.advanced-content"),o=$.tmpl(n,{value:this.getResourceByKey(r.label,r.defaultLabel),id:r.id,filterType:a}),s=$(".bz-query-advanced__filter",i).empty();if(this.isCurrentBetweenFilter()){s.append(o);var l=$(".bz-query-advanced__filter-input-from",s),d=$(".bz-query-advanced__filter-input-to",s);this.renderLiteControl(a,l,this.controlInitial),this.renderLiteControl(a,d,this.controlEnd)}else{s.append(o);var c=$(".bz-query-advanced__filter-input",s);this.renderLiteControl(a,c,e)}},renderLiteControl:function(e,t,i){var r=this;$.when(i.render(this.getTemplateByType(e))).done((function(a){t.empty().append(a);var n=$(".bz-query-advanced__input, .bz-input-icon__input",t);(r.isCurrentNullFilter()||"default"===e)&&n.attr("readonly",!0),i.postRenderElement(t,!0),r.configureInternalHandlers(i),"default"!==e||r.isDesignMode()||i.disablePopup()}))},getTemplateByType:function(e){return"is-null"===e?"query.advanced-input":"query.advanced-date"},configureInternalHandlers:function(e){var t=this;e.getDateControl().bind("change",(function(){t.setValue(t.getValue())}))},getRequiredProperties:function(){var e=this.properties;return{showTime:!1,minValue:e.minValue,maxValue:e.maxValue,dateFormat:e.dateFormat,timeFormat:e.timeFormat,fullFormat:e.fullFormat}},getNormalizeDate:function(e){return 0!=e&&null!=e&&(this.properties.showTime?e.setMilliseconds(0):e.setHours(0,0,0,0)),e},changeMinValue:function(e){var t=this.properties,i=bizagi.util.dateFormatter;"number"==typeof e?e=i.formatInvariant(this.getNormalizeDate(new Date(e)),t.showTime):(e=this.getNormalizeDate("object"===_typeof(e)?e:i.getDateFromInvariant(e,t.showTime)),e=i.formatInvariant(e)),t.minValue=e,this.controlInitial&&this.controlInitial.changeMinValue(e),this.controlEnd&&this.controlEnd.changeMinValue(e)},changeMaxValue:function(e){var t=this.properties,i=bizagi.util.dateFormatter;"number"==typeof e?e=i.formatInvariant(this.getNormalizeDate(new Date(e)),t.showTime):(e=this.getNormalizeDate("object"===_typeof(e)?e:i.getDateFromInvariant(e,t.showTime)),e=i.formatInvariant(e)),t.maxValue=e,this.controlInitial&&this.controlInitial.changeMaxValue(e),this.controlEnd&&this.controlEnd.changeMaxValue(e)},changeColor:function(e){var t=this.getControl();return this.controlInitial&&this.controlInitial.changeColor(e,!0),this.controlEnd&&this.controlEnd.changeColor(e,!0),this._super(e).changeFontColor($("label",t),e)}}),bizagi.rendering.desktop.date.extend("bizagi.rendering.desktop.dateAdvanced",{},{getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=$(this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},subscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){if(this.properties.isRange)for(var t=this.observer.length-1;t>=0;t--)this.properties.isMaximumValue?this.observer[t].changeMaxValue(e):this.properties.isMinimumValue&&this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)},getInputControl:function(){return $("input",this.getControl())||null}}),bizagi.rendering.desktop.form.extend("bizagi.rendering.desktop.formTemplate",bizagi.rendering.formTemplate.prototype),bizagi.rendering.desktop.formTemplate.extend("bizagi.rendering.desktop.formTemplate",{},{}),bizagi.rendering.base.factory.extend("bizagi.rendering.desktop.factory",{},{init:function(e){this._super(e),this.printVersion=!1},loadTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("icons",bizagi.getTemplate("common.bizagi.rendering.icons")),e.loadTemplate("form-error",bizagi.getTemplate("bizagi.rendering.desktop.form-error")),e.loadTemplate("form-waiting",bizagi.getTemplate("bizagi.rendering.desktop.form-waiting")),e.loadTemplate("info-message",bizagi.getTemplate("common.bizagi.desktop.info-message")),e.loadTemplate("form",bizagi.getTemplate("bizagi.rendering.desktop.form")+"#ui-bizagi-render-form"),e.loadTemplate("form-process-path",bizagi.getTemplate("bizagi.rendering.desktop.form")+"#ui-bizagi-render-form-process-path"),e.loadTemplate("panel",bizagi.getTemplate("bizagi.rendering.desktop.panel")),e.loadTemplate("contentPanel",bizagi.getTemplate("bizagi.rendering.desktop.contentPanel")),e.loadTemplate("tab",bizagi.getTemplate("bizagi.rendering.desktop.tab")),e.loadTemplate("tabItem",bizagi.getTemplate("bizagi.rendering.desktop.tabItem")),e.loadTemplate("collectionnavigator",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator"),e.loadTemplate("collectionnavigator-form-button",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-form-button"),e.loadTemplate("collectionnavigator-control",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-control"),e.loadTemplate("collectionnavigator-actions",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-actions"),e.loadTemplate("collectionnavigator-preview",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-preview"),e.loadTemplate("collectionnavigator-execution",bizagi.getTemplate("bizagi.rendering.desktop.collectionnavigator")+"#ui-bizagi-render-collectionnavigator-execution"),e.loadTemplate("horizontal",bizagi.getTemplate("bizagi.rendering.desktop.horizontal")),e.loadTemplate("accordion",bizagi.getTemplate("bizagi.rendering.desktop.accordion")),e.loadTemplate("accordionItem",bizagi.getTemplate("bizagi.rendering.desktop.accordionItem")),e.loadTemplate("group",bizagi.getTemplate("bizagi.rendering.desktop.group")),e.loadTemplate("section-header",bizagi.getTemplate("bizagi.rendering.desktop.section")+"#ui-bizagi-container-section"),e.loadTemplate("section-content",bizagi.getTemplate("bizagi.rendering.desktop.section")+"#ui-bizagi-container-section-content"),e.loadTemplate("searchForm",bizagi.getTemplate("bizagi.rendering.desktop.searchForm")),e.loadTemplate("render",bizagi.getTemplate("bizagi.rendering.desktop.render")),e.loadTemplate("render-base",bizagi.getTemplate("bizagi.rendering.desktop.render.base")),e.loadTemplate("render-layout",bizagi.getTemplate("bizagi.rendering.desktop.render.layout")),e.loadTemplate("render-userPassword",bizagi.getTemplate("bizagi.rendering.desktop.userPassword")+"#bz-rendering-userPassword"),e.loadTemplate("render-getUser",bizagi.getTemplate("bizagi.rendering.desktop.getUser")+"#bz-rendering-getUser"),e.loadTemplate("render-user-email",bizagi.getTemplate("bizagi.rendering.desktop.userEmail")+"#bz-rendering-user-email"),e.loadTemplate("render-comboSelected",bizagi.getTemplate("bizagi.rendering.desktop.comboSelected")+"#bz-rendering-comboSelected"),e.loadTemplate("render-comboSelectedReadOnly",bizagi.getTemplate("bizagi.rendering.desktop.comboSelected")+"#bz-rendering-comboSelected-ReadOnly"),e.loadTemplate("render-querySearchUser",bizagi.getTemplate("bizagi.rendering.desktop.querySearchUser")+"#ui-bizagi-render-querySearchUser"),e.loadTemplate("text",bizagi.getTemplate("bizagi.rendering.desktop.text")+"#ui-bizagi-render-text"),e.loadTemplate("text-read-only",bizagi.getTemplate("bizagi.rendering.desktop.text")+"#ui-bizagi-render-text-read-only"),e.loadTemplate("extendedText",bizagi.getTemplate("bizagi.rendering.desktop.extendedText")),e.loadTemplate("number",bizagi.getTemplate("bizagi.rendering.desktop.number")),e.loadTemplate("numberScientificNotation",bizagi.getTemplate("bizagi.rendering.desktop.numberScientificNotation")+"#bz-rendering-numberScientificNotation"),e.loadTemplate("date",bizagi.getTemplate("bizagi.rendering.desktop.date")),e.loadTemplate("yesno",bizagi.getTemplate("bizagi.rendering.desktop.yesno")),e.loadTemplate("check",bizagi.getTemplate("bizagi.rendering.desktop.check")),e.loadTemplate("combo",bizagi.getTemplate("bizagi.rendering.desktop.combo")),e.loadTemplate("list",bizagi.getTemplate("bizagi.rendering.desktop.list")),e.loadTemplate("geolocation",bizagi.getTemplate("bizagi.rendering.desktop.geolocation")),e.loadTemplate("radio",bizagi.getTemplate("bizagi.rendering.desktop.radio")),e.loadTemplate("image",bizagi.getTemplate("bizagi.rendering.desktop.image")+"#ui-bizagi-render-image"),e.loadTemplate("images",bizagi.getTemplate("bizagi.rendering.desktop.image")+"#ui-bizagi-render-images"),e.loadTemplate("image-dialog",bizagi.getTemplate("bizagi.rendering.desktop.image")+"#ui-bizagi-render-image-dialog"),e.loadTemplate("image-item",bizagi.getTemplate("bizagi.rendering.desktop.image")+"#ui-bizagi-render-image-item"),e.loadTemplate("upload-ecm-view-default",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default"),e.loadTemplate("upload-ecm-view-default-metadata",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default-metadata"),e.loadTemplate("upload-ecm-view-default-yesno",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default-yesno"),e.loadTemplate("upload-ecm-view-default-edit-buttons",bizagi.getTemplate("bizagi.rendering.desktop.ecm")+"#biz-render-ecm-view-default-edit-buttons"),e.loadTemplate("document",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator"),e.loadTemplate("document-item",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-item"),e.loadTemplate("document-column-item",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-column-item"),e.loadTemplate("document-item-preview",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-item-preview"),e.loadTemplate("document-item-preview-object",bizagi.getTemplate("bizagi.rendering.desktop.document")+"#bz-document-generator-item-preview-object"),e.loadTemplate("uploadItem",bizagi.getTemplate("bizagi.rendering.desktop.uploadItem")),e.loadTemplate("upload",bizagi.getTemplate("bizagi.rendering.desktop.upload")),e.loadTemplate("upload.dialog",bizagi.getTemplate("bizagi.rendering.desktop.upload.dialog")),e.loadTemplate("upload.template.dialog",bizagi.getTemplate("bizagi.rendering.desktop.upload.template.dialog")),e.loadTemplate("upload.ecm.dialog",bizagi.getTemplate("bizagi.rendering.desktop.upload.ecm.dialog")),e.loadTemplate("dialog-send-email",bizagi.getTemplate("bizagi.rendering.desktop.dialog-sendEmail")+"#dialog-send-email"),e.loadTemplate("dialog-send-email-rtl",bizagi.getTemplate("bizagi.rendering.desktop.dialog-sendEmail")+"#dialog-send-email-rtl"),e.loadTemplate("grid",bizagi.getTemplate("bizagi.rendering.desktop.grid")),e.loadTemplate("cell",bizagi.getTemplate("bizagi.rendering.desktop.cell")),e.loadTemplate("cell.readonly",bizagi.getTemplate("bizagi.rendering.desktop.cell.readonly")),e.loadTemplate("cell.summary",bizagi.getTemplate("bizagi.rendering.desktop.cell.summary")),e.loadTemplate("cell.upload",bizagi.getTemplate("bizagi.rendering.desktop.cell.upload")),e.loadTemplate("cell.button",bizagi.getTemplate("bizagi.rendering.desktop.cell.button")),e.loadTemplate("search",bizagi.getTemplate("bizagi.rendering.desktop.search")),e.loadTemplate("searchItem",bizagi.getTemplate("bizagi.rendering.desktop.searchItem")),e.loadTemplate("searchList",bizagi.getTemplate("bizagi.rendering.desktop.searchList")+"#bz-searchList"),e.loadTemplate("searchListTag",bizagi.getTemplate("bizagi.rendering.desktop.searchList")+"#bz-searchList-tag"),e.loadTemplate("letter",bizagi.getTemplate("bizagi.rendering.desktop.letter")),e.loadTemplate("letter.readonly",bizagi.getTemplate("bizagi.rendering.desktop.letter.readonly")),e.loadTemplate("letter.dialog",bizagi.getTemplate("bizagi.rendering.desktop.dialog-letter")),e.loadTemplate("button",bizagi.getTemplate("bizagi.rendering.desktop.button")),e.loadTemplate("fileprint",bizagi.getTemplate("bizagi.rendering.desktop.fileprint")+"#ui-bizagi-render-fileprint"),e.loadTemplate("fileprint-object",bizagi.getTemplate("bizagi.rendering.desktop.fileprint")+"#ui-bizagi-render-fileprint-object"),e.loadTemplate("fileprint-iframe",bizagi.getTemplate("bizagi.rendering.desktop.fileprint")+"#ui-bizagi-render-fileprint-iframe"),e.loadTemplate("link",bizagi.getTemplate("bizagi.rendering.desktop.link")),e.loadTemplate("formLink",bizagi.getTemplate("bizagi.rendering.desktop.formLink")),e.loadTemplate("association",bizagi.getTemplate("bizagi.rendering.desktop.association")),e.loadTemplate("stakeholder",bizagi.getTemplate("bizagi.rendering.desktop.stakeholder")+"#bz-rendering-stakeholder"),e.loadTemplate("stakeholder-grid",bizagi.getTemplate("bizagi.rendering.desktop.stakeholder")+"#bz-rendering-stakeholder-grid"),e.loadTemplate("stakeholder-paginator",bizagi.getTemplate("bizagi.rendering.desktop.stakeholder")+"#bz-rendering-stakeholder-paginator"),e.loadTemplate("queryProcess",bizagi.getTemplate("bizagi.rendering.desktop.queryProcess")+"#ui-bizagi-render-query-process"),e.loadTemplate("checkList",bizagi.getTemplate("bizagi.rendering.desktop.checkList")+"#bz-rendering-checkList"),e.loadTemplate("checkList-disabled",bizagi.getTemplate("bizagi.rendering.desktop.checkList")+"#bz-rendering-checkList-disabled"),e.loadTemplate("readonly",bizagi.getTemplate("bizagi.rendering.desktop.readonly")+"#readonly"),e.loadTemplate("readonly-gn",bizagi.getTemplate("bizagi.rendering.desktop.readonly")+"#readonly-gn"),e.loadTemplate("readonly-value",bizagi.getTemplate("bizagi.rendering.desktop.readonly")+"#readonly-value"),e.loadTemplate("hand-signature",bizagi.getTemplate("bizagi.rendering.desktop.handSignature")+"#bz-signature"),e.loadTemplate("hand-signature-readonly",bizagi.getTemplate("bizagi.rendering.desktop.handSignature")+"#bz-signature-readonly"),e.loadTemplate("layout-link",bizagi.getTemplate("bizagi.rendering.desktop.layout.link")),e.loadTemplate("layout-image",bizagi.getTemplate("bizagi.rendering.desktop.layout.image")+"#ui-bizagi-render-layout-image"),e.loadTemplate("layout-image64",bizagi.getTemplate("bizagi.rendering.desktop.layout.image")+"#ui-bizagi-render-layout-image64"),e.loadTemplate("layout-label",bizagi.getTemplate("bizagi.rendering.desktop.layout.label")),e.loadTemplate("layout-text",bizagi.getTemplate("bizagi.rendering.desktop.layout.text")),e.loadTemplate("layout-upload",bizagi.getTemplate("bizagi.rendering.desktop.layout.upload")),e.loadTemplate("layout-uploadItem",bizagi.getTemplate("bizagi.rendering.desktop.layout.uploadItem")),e.loadTemplate("layout-date-time",bizagi.getTemplate("bizagi.rendering.desktop.layout.dateTime")),e.loadTemplate("layout-number",bizagi.getTemplate("bizagi.rendering.desktop.layout.number")),e.loadTemplate("layout-money",bizagi.getTemplate("bizagi.rendering.desktop.layout.money")),e.loadTemplate("layout-placeholder",bizagi.getTemplate("bizagi.rendering.desktop.layout.placeholder")),e.loadTemplate("layout-boolean",bizagi.getTemplate("bizagi.rendering.desktop.layout.yesno")),e.loadTemplate("render-actionLauncher",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher"),e.loadTemplate("render-actionLauncher-horizontal",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-horizontal"),e.loadTemplate("render-actionLauncher-horizontal-more",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-horizontal-more"),e.loadTemplate("render-actionLauncher-vertical",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-vertical"),e.loadTemplate("render-actionLauncher-actions-to-execute",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-actions-to-execute"),e.loadTemplate("render-actionLauncher-design",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-design"),e.loadTemplate("render-actionLauncher-confirm",bizagi.getTemplate("bizagi.rendering.desktop.actionLauncher")+"#bz-rendering-actionLauncher-confirm"),e.loadTemplate("render-polymorphicLauncher",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher"),e.loadTemplate("render-polymorphicLauncher-vertical-tree",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree"),e.loadTemplate("render-polymorphicLauncher-vertical-tree-item",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree-item"),e.loadTemplate("render-polymorphicLauncher-actions-to-execute",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-actions-to-execute"),e.loadTemplate("render-polymorphicLauncher-design",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-design"),e.loadTemplate("render-polymorphicLauncher-confirm",bizagi.getTemplate("bizagi.rendering.desktop.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-confirm"),bizagi.override.enablePrintFromEditForm?e.loadTemplate("print-frame",bizagi.getTemplate("bizagi.workportal.desktop.widget.print")+"#bz-wp-widget-print-frame"):null,bizagi.override.enablePrintFromEditForm?e.loadTemplate("print-frame-header",bizagi.getTemplate("bizagi.workportal.desktop.widget.print")+"#bz-wp-widget-print-frame-header"):null,e.loadTemplate("grid.bizagi",bizagi.getTemplate("bizagi.rendering.desktop.grid.component")),e.loadTemplate("bizagi.grid.grid",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid"),e.loadTemplate("bizagi.grid.grid.rtl",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-rtl"),e.loadTemplate("bizagi.grid.waiting",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-waiting"),e.loadTemplate("bizagi.grid.table",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-table"),e.loadTemplate("bizagi.grid.table.empty",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-table-empty"),e.loadTemplate("bizagi.grid.column",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-column"),e.loadTemplate("bizagi.grid.column.special",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-column-special"),e.loadTemplate("bizagi.grid.row",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-row"),e.loadTemplate("bizagi.grid.row.buttons",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-row-buttons"),e.loadTemplate("bizagi.grid.row.buttons.rtl",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-row-buttons-rtl"),e.loadTemplate("bizagi.grid.cell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-cell"),e.loadTemplate("bizagi.grid.cell.special",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-cell-special"),e.loadTemplate("bizagi.grid.pagination",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-pagination"),e.loadTemplate("bizagi.grid.pager",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-pager"),e.loadTemplate("bizagi.grid.buttons",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-buttons"),e.loadTemplate("bizagi.grid.buttons.rtl",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-buttons-rtl"),e.loadTemplate("bizagi.grid.dynamicpager",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-dynamic-pager"),e.loadTemplate("bizagi.grid.summary",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-summary"),e.loadTemplate("bizagi.grid.summaryCell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-summary-cell"),e.loadTemplate("bizagi.grid.grouped.table",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-table"),e.loadTemplate("bizagi.grid.grouped.column",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-column"),e.loadTemplate("bizagi.grid.grouped.row",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-row"),e.loadTemplate("bizagi.grid.grouped.header.row",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-header-row"),e.loadTemplate("bizagi.grid.grouped.summary",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-summary"),e.loadTemplate("bizagi.grid.grouped.summaryCell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-summary-cell"),e.loadTemplate("bizagi.grid.grouped.emptyCell",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-grouped-empty-cell"),e.loadTemplate("bizagi.plugin.search.user",bizagi.getTemplate("bizagi.plugin.searchuser")+"#ui-bizagi-plugin-search-user"),e.loadTemplate("gridActions",bizagi.getTemplate("bizagi.rendering.desktop.gridActions")+"#ui-bizagi-grid-actions-more"),e.loadTemplate("gridActions-delete",bizagi.getTemplate("bizagi.rendering.desktop.gridActions")+"#ui-bizagi-grid-actions-delete"),e.loadTemplate("list-multiselect",bizagi.getTemplate("bizagi.rendering.desktop.multiSelect")+"#bz-list-multiselect"),e.loadTemplate("list-multiselect-item",bizagi.getTemplate("bizagi.rendering.desktop.multiSelect")+"#bz-list-multiselect-item"),e.loadTemplate("list-multiselect-tag",bizagi.getTemplate("bizagi.rendering.desktop.multiSelect")+"#bz-list-multiselect-tag"),e.loadTemplate("list-multiselect-tags",bizagi.getTemplate("bizagi.rendering.desktop.multiSelect")+"#bz-list-multiselect-tags"),e.loadTemplate("list-multiselect-view-more",bizagi.getTemplate("bizagi.rendering.desktop.multiSelect")+"#bz-list-multiselect-view-more"),e.loadTemplate("render-range",bizagi.getTemplate("bizagi.rendering.desktop.range")+"#bz-rendering-range"),e.loadTemplate("query.advanced",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced"),e.loadTemplate("query.advanced.readonly",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-readonly"),e.loadTemplate("query.advanced-item",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-item"),e.loadTemplate("query.advanced-filter",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-filter"),e.loadTemplate("query.advanced-content",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-content"),e.loadTemplate("query.advanced-input",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-filter_input"),e.loadTemplate("query.advanced-text",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-filter_text"),e.loadTemplate("query.advanced-date",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced-filter_date"),e.loadTemplate("query.advanced-pill",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced__pills"),e.loadTemplate("query.advanced-tooltip",bizagi.getTemplate("bizagi.rendering.desktop.queryAdvanced")+"#bz-query-advanced__wildcard-tooltip"),e.loadTemplate("bizagi.grid.exportOptions",bizagi.getTemplate("bizagi.rendering.desktop.grid.bizagi")+"#ui-bizagi-grid-export-options")).done((function(){var i=$.fasttmpl(e.getTemplate("icons"));0===$("head").find("#genome-forms-icons").length&&$("head").append(i),t.resolve()})),t.promise()},loadOverrides:function(){if(bizagi.enableCustomizations)return bizagi.util.loadFile({src:bizagi.getJavaScript("bizagi.rendering.desktop.overrides"),type:"js"})},getContainer:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==t?new bizagi.rendering.desktop.form(r):"template"==t?new bizagi.rendering.desktop.formTemplate(r):"queryForm"==t?new bizagi.rendering.desktop.queryForm(r):"layout"==t?new bizagi.rendering.desktop.layout(r):"usersForm"==t?new bizagi.rendering.desktop.usersForm(r):"panel"==t?new bizagi.rendering.desktop.panel(r):/^contentpanel$/i.test(t)?new bizagi.rendering.desktop.contentPanel(r):/^nestedform$/i.test(t)?new bizagi.rendering.desktop.nestedForm(r):"tab"==t?new bizagi.rendering.desktop.tab(r):/^tabitem$/i.test(t)?new bizagi.rendering.desktop.tabItem(r):"horizontal"==t?new bizagi.rendering.desktop.horizontal(r):"accordion"==t?new bizagi.rendering.desktop.accordion(r):"accordionItem"==t?new bizagi.rendering.desktop.accordionItem(r):"group"==t?new bizagi.rendering.desktop.group(r):"section"==t?new bizagi.rendering.desktop.section(r):"searchForm"==t?(r.context="search",r.contexttype="metadata",new bizagi.rendering.desktop.searchForm(r)):"mobileform"==t?new bizagi.rendering.mobileform(r):"mobilegroup"==t?new bizagi.rendering.mobilegroup(r):"mobiletext"==t?new bizagi.rendering.mobiletext(renderParams):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,r=i.properties,a=bizagi.util.parseBoolean(r.advancedQuery)||!1,n=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return t||(t="label"),!/^query/i.test(t)&&a?this.getAdvancedQueryRender(n):"text"===t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.desktop.extendedText(n):new bizagi.rendering.desktop.text(n):"association"===t?new bizagi.rendering.desktop.association(n):"label"===t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.label(n)):"hidden"===t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.hidden(n)):"number"===t?r&&29===r.dataType?new bizagi.rendering.desktop.numberScientificNotation(n):new bizagi.rendering.desktop.number(n):"money"===t?new bizagi.rendering.desktop.money(n):"date"===t?new bizagi.rendering.desktop.date(n):"boolean"===t?"check"===(i.properties.display||"option")?new bizagi.rendering.desktop.check(n):new bizagi.rendering.desktop.yesno(n):"combo"===t?new bizagi.rendering.desktop.combo(n):/^cascadingcombo$/i.test(t)?new bizagi.rendering.desktop.cascadingCombo(n):"list"===t?new bizagi.rendering.desktop.list(n):"radio"===t?new bizagi.rendering.desktop.radio(n):"image"===t?new bizagi.rendering.desktop.image(n):"uploadecm"===t?new bizagi.rendering.desktop.ecm(n):"upload"===t?new bizagi.rendering.desktop.upload(n):"grid"===t?new bizagi.rendering.desktop.grid.bizagi(n):"groupedgrid"===t?new bizagi.rendering.desktop.grid.grouped(n):"search"===t?new bizagi.rendering.desktop.search(n):"suggest"===t?(n.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.desktop.search(n)):"searchList"===t?new bizagi.rendering.desktop.searchList(n):"multiSelect"==t?new bizagi.rendering.desktop.multiSelect(n):"letter"===t?new bizagi.rendering.desktop.letter(n):"button"===t?!bizagi.util.isEmpty(i.properties.rpabot)?new bizagi.rendering.desktop.uiPathButton(n):new bizagi.rendering.desktop.button(n):"formLink"===t?new bizagi.rendering.desktop.formLink(n):"link"===t?new bizagi.rendering.desktop.link(n):"actionLauncher"===t?new bizagi.rendering.desktop.actionLauncher(n):"entityTemplate"===t?new bizagi.rendering.desktop.entityTemplate(n):"polymorphicLauncher"===t?new bizagi.rendering.desktop.polymorphicLauncher(n):"userfield"===t?new bizagi.rendering.desktop.userfieldWrapper(n):0===t.indexOf("layout")?this.getLayoutRender(e):0===t.indexOf("search")?this.getSearchRender(e):0===t.indexOf("query")?this.getQueryRender(e):0===t.indexOf("range")?this.getRangeRender(e):"document"===t?new bizagi.rendering.desktop.document(n):"image"===t?new bizagi.rendering.desktop.image(n):"fileprint"===t?new bizagi.rendering.desktop.fileprint(n):"geolocation"===t?new bizagi.rendering.desktop.geolocation(n):"collectionnavigator"===t?new bizagi.rendering.desktop.collectionnavigator(n):"activityCheckList"===t?new bizagi.rendering.desktop.activityCheckList(n):"getUser"===t?new bizagi.rendering.desktop.getUser(n):"userPassword"==t?new bizagi.rendering.desktop.userPassword(n):"comboSelected"==t?new bizagi.rendering.desktop.comboSelected(n):"stakeholder"==t?new bizagi.rendering.desktop.stakeholder(n):/^signature$/i.test(t)?new bizagi.rendering.desktop.handSignature(n):/^readonly$/i.test(t)?new bizagi.rendering.desktop.readonly(n):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,r=i.properties,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnText"===t){var n=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return a.decorated=n?bizagi.rendering.desktop.extendedText:bizagi.rendering.desktop.text,new bizagi.rendering.desktop.columns.text(a)}if("columnSearchList"===t)return a.decorated=bizagi.rendering.desktop.searchList,new bizagi.rendering.desktop.columns.searchList(a);if("columnNumberScientificNotation"===t)return a.decorated=bizagi.rendering.desktop.numberScientificNotation,new bizagi.rendering.desktop.columns.numberScientificNotation(a);if("columnNumber"===t)return r&&29===r.dataType?(a.decorated=bizagi.rendering.desktop.numberScientificNotation,new bizagi.rendering.desktop.columns.numberScientificNotation(a)):(a.decorated=bizagi.rendering.desktop.number,new bizagi.rendering.desktop.columns.number(a));if("columnMoney"===t)return a.decorated=bizagi.rendering.desktop.money,new bizagi.rendering.desktop.columns.number(a);if("columnDate"===t)return a.decorated=bizagi.rendering.desktop.date,new bizagi.rendering.desktop.columns.date(a);if("columnBoolean"===t){if("check"===(i.properties.display||"option")){if(a.decorated=bizagi.rendering.desktop.check,e.data.properties.isExclusive)return new bizagi.rendering.desktop.columns.exclusiveCheck(a)}else a.decorated=bizagi.rendering.desktop.yesno;return new bizagi.rendering.desktop.columns.column(a)}return"columnCombo"===t?(a.decorated=bizagi.rendering.desktop.combo,new bizagi.rendering.desktop.columns.combo(a)):"columnRadio"===t?(a.decorated=bizagi.rendering.desktop.radio,new bizagi.rendering.desktop.columns.radio(a)):"columnList"===t?(a.decorated=bizagi.rendering.desktop.list,new bizagi.rendering.desktop.columns.list(a)):"columnHidden"===t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,a.decorated=bizagi.rendering.desktop.hidden,new bizagi.rendering.desktop.columns.hidden(a)):"columnUpload"===t?(a.decorated=bizagi.rendering.desktop.upload,new bizagi.rendering.desktop.columns.upload(a)):"columnImage"===t?(a.decorated=bizagi.rendering.desktop.image,new bizagi.rendering.desktop.columns.image(a)):"columnUploadEcm"===t?(a.decorated=bizagi.rendering.desktop.ecm,new bizagi.rendering.desktop.columns.uploadecm(a)):"columnLink"===t?(a.decorated=bizagi.rendering.desktop.link,new bizagi.rendering.desktop.columns.link(a)):"columnFormLink"===t?(a.decorated=bizagi.rendering.desktop.formLink,new bizagi.rendering.desktop.columns.link(a)):"columnUserfield"===t?(a.decorated=bizagi.rendering.desktop.userfieldWrapper,new bizagi.rendering.desktop.columns.column(a)):"columnSearch"===t?(a.decorated=bizagi.rendering.desktop.search,new bizagi.rendering.desktop.columns.search(a)):"columnLabel"===t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,a.decorated=bizagi.rendering.desktop.label,new bizagi.rendering.desktop.columns.column(a)):"columnReadonly"===t?(a.decorated=bizagi.rendering.desktop.readonly,new bizagi.rendering.desktop.columns.readonly(a)):"columnDocument"===t?(a.decorated=bizagi.rendering.desktop.document,new bizagi.rendering.desktop.columns.document(a)):"columnLetter"===t?(a.decorated=bizagi.rendering.desktop.letter,new bizagi.rendering.desktop.columns.letter(a)):"columnButton"===t?(a.decorated=bizagi.rendering.desktop.button,new bizagi.rendering.desktop.columns.button(a)):"columnActions"===t?(a.decorated=bizagi.rendering.desktop.gridActions,new bizagi.rendering.desktop.columns.actions(a)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getLayoutRender:function(e){var t=e.type,i=e.data,r=i.properties,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"layoutImage"===t?new bizagi.rendering.desktop.layoutImage(a):"layoutLink"===t?new bizagi.rendering.desktop.layoutLink(a):"layoutLabel"===t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.layoutLabel(a)):"layoutText"===t?new bizagi.rendering.desktop.layoutText(a):"layoutDateTime"===t?new bizagi.rendering.desktop.layoutDateTime(a):"layoutNumber"===t?new bizagi.rendering.desktop.layoutNumber(a):"layoutMoney"===t?new bizagi.rendering.desktop.layoutMoney(a):"layoutPlaceholder"===t?new bizagi.rendering.desktop.layoutPlaceholder(a):"layoutBoolean"===t?new bizagi.rendering.desktop.layoutBoolean(a):"layoutUpload"===t?new bizagi.rendering.desktop.layoutUpload(a):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,r=i.properties,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.desktop.extendedText(a):new bizagi.rendering.desktop.text(a):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.desktop.check(a):new bizagi.rendering.desktop.yesno(a):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.desktop.numberScientificNotation(a):new bizagi.rendering.desktop.number(a):"searchMoney"==t?new bizagi.rendering.desktop.money(a):"searchDate"==t?new bizagi.rendering.desktop.date(a):"searchCombo"==t?new bizagi.rendering.desktop.combo(a):"searchSuggest"==t?new bizagi.rendering.desktop.search(a):"searchLabel"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.label(a)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getQueryRender:function(e){var t=e.type,i=e.data,r=i.properties,a=bizagi.util.parseBoolean(i.properties.advancedQuery)||!1,n=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"queryText"===t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.desktop.queryExtendedText(n):a?new bizagi.rendering.desktop.queryTextAdvanced(n):new bizagi.rendering.desktop.queryText(n):"queryBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.desktop.queryCheck(n):new bizagi.rendering.desktop.queryYesNo(n):"queryNumber"===t?a?new bizagi.rendering.desktop.queryNumberAdvanced(n):new bizagi.rendering.desktop.queryNumber(n):"queryMoney"===t?a?new bizagi.rendering.desktop.queryMoneyAdvanced(n):new bizagi.rendering.desktop.queryMoney(n):"queryDate"===t?a?new bizagi.rendering.desktop.queryDateAdvanced(n):new bizagi.rendering.desktop.queryDate(n):"queryCombo"==t?new bizagi.rendering.desktop.queryCombo(n):"queryCascadingCombo"==t?new bizagi.rendering.desktop.queryCascadingCombo(n):"querySuggest"==t?new bizagi.rendering.desktop.querySuggest(n):"queryLabel"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.queryLabel(n)):"queryList"==t?new bizagi.rendering.desktop.queryList(n):"queryMultiSelect"==t?new bizagi.rendering.desktop.queryMultiSelect(n):"querySearch"==t?new bizagi.rendering.desktop.querySearch(n):"queryRadio"==t?new bizagi.rendering.desktop.queryRadio(n):"queryState"==t?new bizagi.rendering.desktop.queryState(n):"queryCaseState"==t?new bizagi.rendering.desktop.queryCaseState(n):"queryProcess"==t?new bizagi.rendering.desktop.queryProcess(n):"querySearchUser"==t?new bizagi.rendering.desktop.querySearchUser(n):"queryHidden"==t?(bizagi.override.hiddenControlsWithDataType||delete r.dataType,new bizagi.rendering.desktop.hidden(n)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRangeRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"rangeDate"===t?new bizagi.rendering.desktop.rangeDate(r):"rangeMoney"===t?new bizagi.rendering.desktop.rangeMoney(r):"rangeNumber"===t?new bizagi.rendering.desktop.rangeNumber(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getAdvancedQueryRender:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"text"===t?new bizagi.rendering.desktop.queryTextAdvanced(i):"number"===t?new bizagi.rendering.desktop.queryNumberAdvanced(i):"money"===t?new bizagi.rendering.desktop.queryMoneyAdvanced(i):"date"===t?new bizagi.rendering.desktop.queryDateAdvanced(i):void 0}});
//# sourceMappingURL=../../../../Maps/desktop/forms.desktop.production.js.map
