function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}/*! @license DOMPurify | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.0.8/LICENSE */function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){e.fn.bizagiPagination=function(t){t=t||{};var i={limInf:0,totalPages:1,actualPage:1,listElement:e("ul"),first:"&lt;&lt;",firstClass:"first",prev:"&lt;",prevClass:"prev",next:"&gt;",nextClass:"next",last:"&gt;&gt;",lastClass:"last",liClass:"bz-page",arrowClass:"bz-pageArrow",selectedFocus:!0,clickCallBack:function(){}};t.actualPage>t.totalPages&&(t.actualPage=t.totalPages),e.extend(i,i,t);var a={previousPage:Math.max(1,parseInt(i.actualPage)-1),nextPage:parseInt(i.actualPage)+1};function o(t,a){var o;if(t=t||1,(a=a||0)>0)o=t;else{if(!(a<0))return;o=t-2}e.each(e("li."+i.liClass,i.listElement),(function(t,a){o++,e(this).data("page",o),e(this).find("span").html(o),e(this).attr("data-page",o),i.actualPage!=o||e(this).hasClass("active")?e(this).removeClass("active"):e(this).addClass("active")})),1==e(i.listElement).find(".active").length?e(i.listElement).parent().find("#tooltipPagination").css("visibility","hidden"):e(i.listElement).parent().find("#tooltipPagination").css("visibility","visible")}!function(){var t,r;if(i.totalElements=e("li."+i.liClass,i.listElement[0]).length,i.totalPages>i.totalElements&&i.totalElements>1&&(t=a.previousPage==i.actualPage,r=i.actualPage==i.totalPages,i.listElement.prepend("<li/>").find("li:first").addClass(i.prevClass).addClass(t?"pagination-disabled":"").data("page",a.previousPage).html(i.prev),i.listElement.prepend("<li/>").find("li:first").addClass(i.arrowClass+" "+i.firstClass).addClass(t?"pagination-disabled":"").data("page","1").html(i.first),i.listElement.append("<li/>").find("li:last").addClass(i.nextClass).addClass(r?"pagination-disabled":"").data("page",a.nextPage).html(i.next),i.listElement.append("<li/>").find("li:last").addClass(i.arrowClass+" "+i.lastClass).addClass(r?"pagination-disabled":"").data("page",i.totalPages).html(i.last)),function(){var t={};e("li:not(.pagination-disabled)",i.listElement).click((function(){t.page=e(this).hasClass(i.lastClass)?i.totalPages:e.trim(e(this).data("page")+" "),t.parent=e(this).parent(),t.self=e(this),i.clickCallBack(t)}))}(),i.selectedFocus&&i.actualPage>=i.totalElements&&i.totalPages>i.totalElements){var s,n=i.actualPage-Math.round(i.totalElements/2);s=n<1?1:n+i.totalElements>i.totalPages?(s=i.totalPages-i.totalElements)<1?1:s:n,0==i.listElement.find("li.active").length&&o(s,1)}}()}}(jQuery),function(e,t){(e=e||self).DOMPurify=function(){"use strict";var e=Object.hasOwnProperty,t=Object.setPrototypeOf,i=Object.isFrozen,a=Object.keys,o=Object.freeze,r=Object.seal,s="undefined"!=typeof Reflect&&Reflect,n=s.apply,l=s.construct;n||(n=function(e,t,i){return e.apply(t,i)}),o||(o=function(e){return e}),r||(r=function(e){return e}),l||(l=function(e,t){return new(Function.prototype.bind.apply(e,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(t))))});var c=_(Array.prototype.forEach),d=_(Array.prototype.indexOf),p=_(Array.prototype.join),u=_(Array.prototype.pop),m=_(Array.prototype.push),g=_(Array.prototype.slice),f=_(String.prototype.toLowerCase),b=_(String.prototype.match),h=_(String.prototype.replace),w=_(String.prototype.indexOf),k=_(String.prototype.trim),T=_(RegExp.prototype.test),v=S(RegExp),C=S(TypeError);function _(e){return function(t){for(var i=arguments.length,a=Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return n(e,t,a)}}function S(e){return function(){for(var t=arguments.length,i=Array(t),a=0;a<t;a++)i[a]=arguments[a];return l(e,i)}}function y(e,a){t&&t(e,null);for(var o=a.length;o--;){var r=a[o];if("string"==typeof r){var s=f(r);s!==r&&(i(a)||(a[o]=s),r=s)}e[r]=!0}return e}function E(t){var i={},a=void 0;for(a in t)n(e,t,[a])&&(i[a]=t[a]);return i}var x=o(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),I=o(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"]),z=o(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),P=o(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),R=o(["#text"]),A=o(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns"]),O=o(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),$=o(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),N=o(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),F=r(/\{\{[\s\S]*|[\s\S]*\}\}/gm),L=r(/<%[\s\S]*|[\s\S]*%>/gm),D=r(/^data-[\-\w.\u00B7-\uFFFF]/),W=r(/^aria-[\-\w]+$/),B=r(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),U=r(/^(?:\w+script|data):/i),G=r(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g),M="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return _typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof(e)};function q(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var H=function(){return"undefined"==typeof window?null:window},V=function(e,t){if("object"!==(void 0===e?"undefined":M(e))||"function"!=typeof e.createPolicy)return null;var i=null;t.currentScript&&t.currentScript.hasAttribute("data-tt-policy-suffix")&&(i=t.currentScript.getAttribute("data-tt-policy-suffix"));var a="dompurify"+(i?"#"+i:"");try{return e.createPolicy(a,{createHTML:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+a+" could not be created."),null}};return function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H(),i=function(t){return e(t)};if(i.version="2.0.11",i.removed=[],!t||!t.document||9!==t.document.nodeType)return i.isSupported=!1,i;var r=t.document,s=!1,n=t.document,l=t.DocumentFragment,_=t.HTMLTemplateElement,S=t.Node,K=t.NodeFilter,j=t.NamedNodeMap,Q=void 0===j?t.NamedNodeMap||t.MozNamedAttrMap:j,X=t.Text,Y=t.Comment,Z=t.DOMParser,J=t.trustedTypes;if("function"==typeof _){var ee=n.createElement("template");ee.content&&ee.content.ownerDocument&&(n=ee.content.ownerDocument)}var te=V(J,r),ie=te?te.createHTML(""):"",ae=n,oe=ae.implementation,re=ae.createNodeIterator,se=ae.getElementsByTagName,ne=ae.createDocumentFragment,le=r.importNode,ce={};i.isSupported=oe&&void 0!==oe.createHTMLDocument&&9!==n.documentMode;var de=F,pe=L,ue=D,me=W,ge=U,fe=G,be=B,he=null,we=y({},[].concat(q(x),q(I),q(z),q(P),q(R))),ke=null,Te=y({},[].concat(q(A),q(O),q($),q(N))),ve=null,Ce=null,_e=!0,Se=!0,ye=!1,Ee=!1,xe=!1,Ie=!1,ze=!1,Pe=!1,Re=!1,Ae=!1,Oe=!1,$e=!1,Ne=!0,Fe=!0,Le=!1,De={},We=y({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","plaintext","script","style","svg","template","thead","title","video","xmp"]),Be=null,Ue=y({},["audio","video","img","source","image","track"]),Ge=null,Me=y({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),qe=null,He=n.createElement("form"),Ve=function(e){qe&&qe===e||(e&&"object"===(void 0===e?"undefined":M(e))||(e={}),he="ALLOWED_TAGS"in e?y({},e.ALLOWED_TAGS):we,ke="ALLOWED_ATTR"in e?y({},e.ALLOWED_ATTR):Te,Ge="ADD_URI_SAFE_ATTR"in e?y(E(Me),e.ADD_URI_SAFE_ATTR):Me,Be="ADD_DATA_URI_TAGS"in e?y(E(Ue),e.ADD_DATA_URI_TAGS):Ue,ve="FORBID_TAGS"in e?y({},e.FORBID_TAGS):{},Ce="FORBID_ATTR"in e?y({},e.FORBID_ATTR):{},De="USE_PROFILES"in e&&e.USE_PROFILES,_e=!1!==e.ALLOW_ARIA_ATTR,Se=!1!==e.ALLOW_DATA_ATTR,ye=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Ee=e.SAFE_FOR_JQUERY||!1,xe=e.SAFE_FOR_TEMPLATES||!1,Ie=e.WHOLE_DOCUMENT||!1,Re=e.RETURN_DOM||!1,Ae=e.RETURN_DOM_FRAGMENT||!1,Oe=e.RETURN_DOM_IMPORT||!1,$e=e.RETURN_TRUSTED_TYPE||!1,Pe=e.FORCE_BODY||!1,Ne=!1!==e.SANITIZE_DOM,Fe=!1!==e.KEEP_CONTENT,Le=e.IN_PLACE||!1,be=e.ALLOWED_URI_REGEXP||be,xe&&(Se=!1),Ae&&(Re=!0),De&&(he=y({},[].concat(q(R))),ke=[],!0===De.html&&(y(he,x),y(ke,A)),!0===De.svg&&(y(he,I),y(ke,O),y(ke,N)),!0===De.svgFilters&&(y(he,z),y(ke,O),y(ke,N)),!0===De.mathMl&&(y(he,P),y(ke,$),y(ke,N))),e.ADD_TAGS&&(he===we&&(he=E(he)),y(he,e.ADD_TAGS)),e.ADD_ATTR&&(ke===Te&&(ke=E(ke)),y(ke,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&y(Ge,e.ADD_URI_SAFE_ATTR),Fe&&(he["#text"]=!0),Ie&&y(he,["html","head","body"]),he.table&&(y(he,["tbody"]),delete ve.tbody),o&&o(e),qe=e)},Ke=function(e){m(i.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=ie}},je=function(e,t){try{m(i.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){m(i.removed,{attribute:null,from:t})}t.removeAttribute(e)},Qe=function(e){var t=void 0,i=void 0;if(Pe)e="<remove></remove>"+e;else{var a=b(e,/^[\r\n\t ]+/);i=a&&a[0]}var o=te?te.createHTML(e):e;try{t=(new Z).parseFromString(o,"text/html")}catch(e){}if(s&&y(ve,["title"]),!t||!t.documentElement){var r=(t=oe.createHTMLDocument("")).body;r.parentNode.removeChild(r.parentNode.firstElementChild),r.outerHTML=o}return e&&i&&t.body.insertBefore(n.createTextNode(i),t.body.childNodes[0]||null),se.call(t,Ie?"html":"body")[0]};i.isSupported&&function(){try{var e=Qe("<x/><title>&lt;/title&gt;&lt;img&gt;");T(/<\/title/,e.querySelector("title").innerHTML)&&(s=!0)}catch(e){}}();var Xe=function(e){return re.call(e.ownerDocument||e,e,K.SHOW_ELEMENT|K.SHOW_COMMENT|K.SHOW_TEXT,(function(){return K.FILTER_ACCEPT}),!1)},Ye=function(e){return!(e instanceof X||e instanceof Y||"string"==typeof e.nodeName&&"string"==typeof e.textContent&&"function"==typeof e.removeChild&&e.attributes instanceof Q&&"function"==typeof e.removeAttribute&&"function"==typeof e.setAttribute&&"string"==typeof e.namespaceURI)},Ze=function(e){return"object"===(void 0===S?"undefined":M(S))?e instanceof S:e&&"object"===(void 0===e?"undefined":M(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},Je=function(e,t,a){ce[e]&&c(ce[e],(function(e){e.call(i,t,a,qe)}))},et=function(e){var t=void 0;if(Je("beforeSanitizeElements",e,null),Ye(e))return Ke(e),!0;var a=f(e.nodeName);if(Je("uponSanitizeElement",e,{tagName:a,allowedTags:he}),("svg"===a||"math"===a)&&0!==e.querySelectorAll("p, br").length)return Ke(e),!0;if(!he[a]||ve[a]){if(Fe&&!We[a]&&"function"==typeof e.insertAdjacentHTML)try{var o=e.innerHTML;e.insertAdjacentHTML("AfterEnd",te?te.createHTML(o):o)}catch(e){}return Ke(e),!0}return"noscript"===a&&T(/<\/noscript/i,e.innerHTML)||"noembed"===a&&T(/<\/noembed/i,e.innerHTML)?(Ke(e),!0):(!Ee||e.firstElementChild||e.content&&e.content.firstElementChild||!T(/</g,e.textContent)||(m(i.removed,{element:e.cloneNode()}),e.innerHTML?e.innerHTML=h(e.innerHTML,/</g,"&lt;"):e.innerHTML=h(e.textContent,/</g,"&lt;")),xe&&3===e.nodeType&&(t=e.textContent,t=h(t,de," "),t=h(t,pe," "),e.textContent!==t&&(m(i.removed,{element:e.cloneNode()}),e.textContent=t)),Je("afterSanitizeElements",e,null),!1)},tt=function(e,t,i){if(Ne&&("id"===t||"name"===t)&&(i in n||i in He))return!1;if(Se&&T(ue,t));else if(_e&&T(me,t));else{if(!ke[t]||Ce[t])return!1;if(Ge[t]);else if(T(be,h(i,fe,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==w(i,"data:")||!Be[e])if(ye&&!T(ge,h(i,fe,"")));else if(i)return!1}return!0},it=function(e){var t=void 0,o=void 0,r=void 0,s=void 0,n=void 0;Je("beforeSanitizeAttributes",e,null);var l=e.attributes;if(l){var c={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ke};for(n=l.length;n--;){var m=t=l[n],b=m.name,w=m.namespaceURI;if(o=k(t.value),r=f(b),c.attrName=r,c.attrValue=o,c.keepAttr=!0,c.forceKeepAttr=void 0,Je("uponSanitizeAttribute",e,c),o=c.attrValue,!c.forceKeepAttr){if("name"===r&&"IMG"===e.nodeName&&l.id)s=l.id,l=g(l,[]),je("id",e),je(b,e),d(l,s)>n&&e.setAttribute("id",s.value);else{if("INPUT"===e.nodeName&&"type"===r&&"file"===o&&c.keepAttr&&(ke[r]||!Ce[r]))continue;"id"===b&&e.setAttribute(b,""),je(b,e)}if(c.keepAttr)if(Ee&&T(/\/>/i,o))je(b,e);else if(T(/svg|math/i,e.namespaceURI)&&T(v("</("+p(a(We),"|")+")","i"),o))je(b,e);else{xe&&(o=h(o,de," "),o=h(o,pe," "));var C=e.nodeName.toLowerCase();if(tt(C,r,o))try{w?e.setAttributeNS(w,b,o):e.setAttribute(b,o),u(i.removed)}catch(e){}}}}Je("afterSanitizeAttributes",e,null)}},at=function e(t){var i=void 0,a=Xe(t);for(Je("beforeSanitizeShadowDOM",t,null);i=a.nextNode();)Je("uponSanitizeShadowNode",i,null),et(i)||(i.content instanceof l&&e(i.content),it(i));Je("afterSanitizeShadowDOM",t,null)};return i.sanitize=function(e,a){var o=void 0,s=void 0,n=void 0,c=void 0,d=void 0;if(e||(e="\x3c!--\x3e"),"string"!=typeof e&&!Ze(e)){if("function"!=typeof e.toString)throw C("toString is not a function");if("string"!=typeof(e=e.toString()))throw C("dirty is not a string, aborting")}if(!i.isSupported){if("object"===M(t.toStaticHTML)||"function"==typeof t.toStaticHTML){if("string"==typeof e)return t.toStaticHTML(e);if(Ze(e))return t.toStaticHTML(e.outerHTML)}return e}if(ze||Ve(a),i.removed=[],"string"==typeof e&&(Le=!1),Le);else if(e instanceof S)1===(s=(o=Qe("\x3c!--\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===s.nodeName||"HTML"===s.nodeName?o=s:o.appendChild(s);else{if(!Re&&!xe&&!Ie&&$e&&-1===e.indexOf("<"))return te?te.createHTML(e):e;if(!(o=Qe(e)))return Re?null:ie}o&&Pe&&Ke(o.firstChild);for(var p=Xe(Le?e:o);n=p.nextNode();)3===n.nodeType&&n===c||et(n)||(n.content instanceof l&&at(n.content),it(n),c=n);if(c=null,Le)return e;if(Re){if(Ae)for(d=ne.call(o.ownerDocument);o.firstChild;)d.appendChild(o.firstChild);else d=o;return Oe&&(d=le.call(r,d,!0)),d}var u=Ie?o.outerHTML:o.innerHTML;return xe&&(u=h(u,de," "),u=h(u,pe," ")),te&&$e?te.createHTML(u):u},i.setConfig=function(e){Ve(e),ze=!0},i.clearConfig=function(){qe=null,ze=!1},i.isValidAttribute=function(e,t,i){qe||Ve({});var a=f(e),o=f(t);return tt(a,o,i)},i.addHook=function(e,t){"function"==typeof t&&(ce[e]=ce[e]||[],m(ce[e],t))},i.removeHook=function(e){ce[e]&&u(ce[e])},i.removeHooks=function(e){ce[e]&&(ce[e]=[])},i.removeAllHooks=function(){ce={}},i}()}()}(this),function(e){e.fn.bizagiPagination=function(t){t=t||{};var i={limInf:0,totalPages:1,actualPage:1,listElement:e("ul"),first:"&lt;&lt;",firstClass:"first",prev:"&lt;",prevClass:"prev",next:"&gt;",nextClass:"next",last:"&gt;&gt;",lastClass:"last",liClass:"bz-page",arrowClass:"bz-pageArrow",selectedFocus:!0,clickCallBack:function(){}};t.actualPage>t.totalPages&&(t.actualPage=t.totalPages),e.extend(i,i,t);var a={previousPage:Math.max(1,parseInt(i.actualPage)-1),nextPage:parseInt(i.actualPage)+1};function o(t,a){var o;if(t=t||1,(a=a||0)>0)o=t;else{if(!(a<0))return;o=t-2}e.each(e("li."+i.liClass,i.listElement),(function(t,a){o++,e(this).data("page",o),e(this).find("span").html(o),e(this).attr("data-page",o),i.actualPage!=o||e(this).hasClass("active")?e(this).removeClass("active"):e(this).addClass("active")})),1==e(i.listElement).find(".active").length?e(i.listElement).parent().find("#tooltipPagination").css("visibility","hidden"):e(i.listElement).parent().find("#tooltipPagination").css("visibility","visible")}!function(){var t,r;if(i.totalElements=e("li."+i.liClass,i.listElement[0]).length,i.totalPages>i.totalElements&&i.totalElements>1&&(t=a.previousPage==i.actualPage,r=i.actualPage==i.totalPages,i.listElement.prepend("<li/>").find("li:first").addClass(i.prevClass).addClass(t?"pagination-disabled":"").data("page",a.previousPage).html(i.prev),i.listElement.prepend("<li/>").find("li:first").addClass(i.arrowClass+" "+i.firstClass).addClass(t?"pagination-disabled":"").data("page","1").html(i.first),i.listElement.append("<li/>").find("li:last").addClass(i.nextClass).addClass(r?"pagination-disabled":"").data("page",a.nextPage).html(i.next),i.listElement.append("<li/>").find("li:last").addClass(i.arrowClass+" "+i.lastClass).addClass(r?"pagination-disabled":"").data("page",i.totalPages).html(i.last)),function(){var t={};e("li:not(.pagination-disabled)",i.listElement).click((function(){t.page=e(this).hasClass(i.lastClass)?i.totalPages:e.trim(e(this).data("page")+" "),t.parent=e(this).parent(),t.self=e(this),i.clickCallBack(t)}))}(),i.selectedFocus&&i.actualPage>=i.totalElements&&i.totalPages>i.totalElements){var s,n=i.actualPage-Math.round(i.totalElements/2);s=n<1?1:n+i.totalElements>i.totalPages?(s=i.totalPages-i.totalElements)<1?1:s:n,0==i.listElement.find("li.active").length&&o(s,1)}}()}}(jQuery),$.Class.extend("bizagi.workportal.widgets.inboxes.decorator",{},{init:function(e){this._addDecorators(e)},_addDecorators:function(e){for(var t in this.internalService=e,this.Class.prototype)"init"!=t&&"constructor"!=t&&"Class"!=t&&"proxyMethod"!=t&&"_addDecorators"!=t&&(e[t]=this[t])},_showSmartInboxMenu:function(e){e.stopPropagation();var t=this,i=$(e.srcElement).closest("div").data(),a=$.tmpl(t.smartInboxTemplate,{settingName:i.settingname,owner:i.owner,smartInboxId:i.smartinboxid});$(".ui-bizagi-workportal-widget-inbox-common-smartinbox-menucontainer").position({my:"right bottom",at:"right bottom",of:$(e.srcElement)}),$("li",a).bind("click",(function(e){var i=$(e.srcElement).data("action"),a=$(e.srcElement).closest("ul").data(),o={settingName:a.settingname,owner:a.owner,smartInboxId:a.smartinboxid,actionName:i};switch(i){case"edit":t._editSmartInbox(o);break;case"delete":t._deleteSmartInbox(o);break;case"share":t._shareSmartInbox(o)}})),$(document).on("click.overflow",(function(e){$(".ui-bizagi-workportal-widget-inbox-common-smartinbox-menucontainer").empty()})),$(".ui-bizagi-workportal-widget-inbox-common-smartinbox-menucontainer").append(a)},_editSmartInbox:function(e){this.publish("showDialogWidget",{selectedInboxData:e,modalParameters:{title:bizagi.localization.getResource("workportal-widget-myfolders-title-edit","Edit Smart Inbox"),width:"800px",showCloseButton:!1,refreshInbox:!1},showBackButton:!1,closeVisible:!1,widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTINBOX,buttons:{}})},_deleteSmartInbox:function(e){var t=this,i="<div>"+bizagi.localization.getResource("workportal-process-modeler-deleteConfirmationMessage")+"</div>";$(i).dialog({title:bizagi.localization.getResource("confirmation-box-title"),maximize:!1,modal:!0,buttons:[{text:bizagi.localization.getResource("workportal-widget-queries-confirm-delete"),click:function(){$.when(t.dataService.deleteSmartInbox(e)).done((function(){var e,i=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID,a=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_HOMEPORTAL;e=$.isFunction(bizagi.cookie)&&null!==bizagi.cookie("bizagiDefaultWidget")&&bizagi.cookie("bizagiDefaultWidget")!==a?bizagi.cookie("bizagiDefaultWidget"):i,t.publish("changeWidget",{widgetName:e})})),$(this).dialog("destroy")}},{text:bizagi.localization.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("destroy")}}]})},_shareSmartInbox:function(e){this.publish("showDialogWidget",{shareMode:!0,selectedInboxData:e,modalParameters:{title:bizagi.localization.getResource("workportal-widget-smartinbox-title-share","Share Smart Inbox"),width:600,height:400,showCloseButton:!1,refreshInbox:!1},showBackButton:!1,closeVisible:!1,widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTINBOX,buttons:{}})},renderSummary:function(){var e,t=this,i=t.params.taskState,a="";"Favorites"==i&&(i="all",a="true"),t.params.smartfoldersParameters&&t.params.smartfoldersParameters.urlParameters&&(e=t.params.smartfoldersParameters.urlParameters);var o={taskState:i||"all",onlyFavorites:a,smartfoldersParameters:e};$.when(t.dataService.getFullInboxSummary(o)).done((function(e){t.updateSummary(e.summary.inboxSummary),t.resizeLayout(),void 0===t.params.selectedSmartInboxId?t.changeTaskState({taskState:t.params.taskState,processes:e.processes,smartInbox:e.smartInbox,storedQueries:e.storedQueries}):t.changeTaskState({taskState:t.params.taskState,processes:e.processes,smartInbox:e.smartInbox,storedQueries:e.storedQueries,selectedSmartInboxId:t.params.selectedSmartInboxId})}))},configureSmartInbox:function(){var e=this,t=e.getContent();$(".ui-bizagi-wp-app-inbox-smart-inbox-new",t).off().bind("click",(function(t){e.publish("showDialogWidget",{modalParameters:{title:bizagi.localization.getResource("workportal-widget-smartinbox-title-new","New Smart Inbox"),width:"800px",showCloseButton:!1,refreshInbox:!1},showBackButton:!1,closeVisible:!1,widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTINBOX,buttons:{}})}))},configureViewControl:function(){var e=this,t=e.getContent(),i=$("#ui-bizagi-wp-app-inbox-bt-eye",t),a=$("#ui-bizagi-wp-app-inbox-bt-eye",t).parent();i.click((function(){bizagi.workportal.desktop.popup.closePopupInstance(),e.popupOpened=!1,a.addClass("active"),e.currentPopup="eyeDetails";var t=new bizagi.workportal.desktop.popup(e.dataService,e.workportalFacade,{sourceElement:"#ui-bizagi-wp-app-inbox-bt-eye",offset:"0 0",at:"left bottom",height:60,width:129,arrowPosition:{left:"64%"}}),i=e.getTemplate("inbox-common-header-view");t.render($.tmpl(i)),$.when(t.closed()).then((function(){e.popupOpened=!1,a.removeClass("active")}));var o=t.getContent();$("#viewDetailsEvent",o).click((function(){e.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX,restoreStatus:!0}),t.close()})),$("#viewGridEvent",o).click((function(){e.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID,restoreStatus:!0}),t.close()}))}))},updateSummary:function(e){var t=this,i=t.getContent();$(".ui-bizagi-wp-app-inbox-tab#red",i).data("taskState","Red"),$(".ui-bizagi-wp-app-inbox-tab#green",i).data("taskState","Green"),$(".ui-bizagi-wp-app-inbox-tab#yellow",i).data("taskState","Yellow"),$(".ui-bizagi-wp-app-inbox-tab#favourites",i).data("taskState","Favorites"),"all"!=t.params.taskState&&$(".ui-bizagi-wp-app-inbox-tab",i).each((function(e,i){$(i).data("taskState")==t.params.taskState?$(i).addClass("active"):$(i).removeClass("active")})),$(".ui-bizagi-wp-app-inbox-tab#all",i).find(".toolTip").html(e.All),$(".ui-bizagi-wp-app-inbox-tab#red",i).find(".toolTip").html(e.Red),$(".ui-bizagi-wp-app-inbox-tab#green",i).find(".toolTip").html(e.Green),$(".ui-bizagi-wp-app-inbox-tab#yellow",i).find(".toolTip").html(e.Yellow),$("#footer #ui-bizagi-wp-app-inbox-tab-container").data("handlerSet")||!1||($(".ui-bizagi-wp-app-inbox-tab",i).click((function(){$(".ui-bizagi-wp-app-inbox-tab",i).removeClass("active"),$(this).addClass("active");var e=$(this).data("taskState");null!=t.changeTaskStateDebounce&&(t.changeTaskStateDebounce.cancel(),t.changeTaskStateDebounce=null),t.changeTaskStateDebounce=bizagi.util.debounce2((function(){t.changeTaskState({taskState:e,restoreStatus:!0})}),200,!1),t.changeTaskStateDebounce.fire()})),$("#footer #ui-bizagi-wp-app-inbox-tab-container").data("handlerSet","true"))},changeTaskState:function(e){var t=this,i=t.getContent(),a=$("#contentProc",i),o=(e=e||{}).taskState;t._prepareServiceParameters(e),$("#ui-bizagi-wp-app-inbox-tap-selector",i).removeClass().addClass(o),a.empty();var r=bizagi.util.isEmpty(e.processes)?t.dataService.getAllProcesses({taskState:t.taskState||"all",onlyFavorites:t.onlyFavorites,smartfoldersParameters:""}):e.processes,s=bizagi.util.isEmpty(e.smartInbox)?t.dataService.getAllSmartInbox():e.smartInbox;$.when(r,s).then((function(i,o){i.smartinboxes=o,t._sortInboxItems(i),i.hasSmartInboxPermission=bizagi.menuSecurity.SmartInbox||!1,i=t._prepareDataForRendering(i,i.hasSmartInboxPermission);var r=$.tmpl(t.processesTemplate,i);!1===bizagi.util.isEnableFeature("enableDefaultInbox")&&$(".ui-bizagi-wp-app-inbox-processes-pin",r).hide(),r.appendTo(a),t._configureSortableForInboxes(a,i),i&&i.smartinboxes&&0==i.smartinboxes.length&&i.categories&&0==i.categories.length&&a.hide(),t._renderStoredQueries(e),$("li",a).bind("click",(function(e){t._onInboxItemClick(e,a,"",this)})),$(".ui-bizagi-wp-app-inbox-processes-start",a).click((function(e){t._onFavoritesItemClick(e,this)})),$(".ui-bizagi-wp-app-inbox-processes-title",a).click((function(){t._onCategoryItemClick(this)})),$(".ui-bizagi-wp-app-inbox-processes-pin",a).click($.proxy(t._onClickPinOrUnpinProcess,t)),$(".ui-bizagi-wp-app-inbox-processes-smartinbox-settings",a).click($.proxy(t._showSmartInboxMenu,t)),t._restoreDefaultInbox(e,a),$(a).bizagiScrollbar(),void 0!==i.categories&&0!=i.categories.length||t.changeProcess(),t.configureSmartInbox()}))},_prepareDataForRendering:function(e,t){return e=this._addFilteredItems(e,t),e=this._addPinnedItems(e,t),(e=this._addAllCasesItem(e)).smartInboxEnable=bizagi.util.isEnableFeature("enableSmartInbox"),e},_addAllCasesItem:function(e){if(e.allCases){e.allCases.inboxType="process";var t=this.getSmartFiltersFromStorage("process","-1");e.allCases.filtered=!bizagi.util.isEmpty(t)&&t.length>0}return e},_addPinnedItems:function(e,t){e.pinned=[];var i=bizagi.services.preferences().getPreferences();return $.each(e.categories,(function(t,a){$.each(a.workflows,(function(t,a){i.defaultOpenInboxWorkflowId==a.idworkflow?(a.pinned=!0,a.inboxType="process",e.pinned.push(a)):a.pinned=!1}))})),$.each(e.smartinboxes,(function(a,o){i.defaultOpenInboxSmartInboxId==o.id?(o.pinned=!0,o.inboxType="smartinbox",o.hasSmartInboxPermission=t,e.pinned.push(o)):o.pinned=!1})),e},_addFilteredItems:function(e,t){var i=this;return $.each(e.smartinboxes,(function(e,a){var o=i.getSmartFiltersFromStorage("smartinbox",a.id);a.hasSmartInboxPermission=t,a.filtered=!bizagi.util.isEmpty(o)&&o.length>0})),$.each(e.categories,(function(e,t){$.each(t.workflows,(function(e,t){var a=i.getSmartFiltersFromStorage("process",t.idworkflow);t.filtered=!bizagi.util.isEmpty(a)&&a.length>0}))})),e},_prepareServiceParameters:function(e){var t=e.taskState;this.params.smartfoldersParameters&&this.params.smartfoldersParameters.urlParameters&&(smartfoldersParameters=this.params.smartfoldersParameters.urlParameters);var i=this.params.taskState;this.params.taskState=t,"Favorites"==t?(this.taskState="all",this.onlyFavorites="true",i!==t&&(bizagi.referrerParams.page="1")):(this.taskState=t,this.onlyFavorites="")},openLiveFilterDialog:function(e){var t=this;e=e||{},t.params.workflowId=t.idWorkflow,t.params.smartInboxId=t.smartInboxGuid;var i=t._createLiveFilterModel(e),a=new bizagi.workportal.widgets.smartinbox.filter(t.workportalFacade,t.dataService,t.params);a.setCustomizedColumns(t.liveFilterColumns);var o=$("<div>");$.when(a.render()).then((function(e){a.setModel(i),o.append(e)})),bizagi.dialog,o.dialog({maximize:!0,minimize:!1,width:900,height:600,title:bizagi.localization.getResource("workportal-widget-smartinbox-live-filters-title","Filters for"),modal:!0,buttons:[{text:bizagi.localization.getResource("workportal-widget-smartinbox-live-filters-cancel","Cancel"),class:"bz-btn--secondary",click:function(){$(this).dialog("close")}},{text:bizagi.localization.getResource("workportal-widget-smartinbox-live-filters-apply","Apply"),click:function(){t._onLiveFilterDialogApply($(this),a)}}],close:function(){$(this).dialog("destroy").remove()}}),bizagi.localization.isRTL&&o.siblings(".ui-dialog-buttonpane").addClass("bz-smartfilters-rtl")},getSmartFiltersFromStorage:function(e,t){var i=[],a=bizagi.util.getItemLocalStorage("smartfilters"),o=e+"-"+t;try{var r=JSON.parse(a);i=void 0!==r[o]?JSON.parse(r[o]):i}catch(e){i=[]}return $("#contentItemsPaginationInbox .filterColumns").trigger("UPDATEFILTERSCOUNTER",i.count()),i},setSmartFiltersToStorage:function(e,t,i){var a=bizagi.util.getItemLocalStorage("smartfilters")||"[]",o=JSON.parse(a);if(o[e+"-"+t]=JSON.stringify(i),bizagi.util.setItemLocalStorage("smartfilters",JSON.encode(Object.assign({},o))),"smartinbox"==e){var r=$(".ul-processes-list li[data-item-type='smartinbox'][data-guid='"+t+"']");i.length>0?$(".ui-bizagi-wp-inbox-filtered",r).css("display","inline-block"):$(".ui-bizagi-wp-inbox-filtered",r).css("display","none")}else{r=$(".ul-processes-list li[idworkflow='"+(t>0?t:"")+"']");i.length>0?($(".ui-bizagi-wp-inbox-filtered",r).css("display","inline-block"),$(".ui-bizagi-wp-app-inbox-processes-ncase",r).css("display","none")):($(".ui-bizagi-wp-inbox-filtered",r).css("display","none"),$(".ui-bizagi-wp-app-inbox-processes-ncase",r).css("display","inline-block"))}},isValidFilter:function(e,t){return void 0!==e.column&&$.any(t,(function(t){return t.fieldFilterName==e.column}))},_createLiveFilterModel:function(e){var t;return bizagi.util.isEmpty(this.idWorkflow)?bizagi.util.isEmpty(this.smartInboxGuid)?bizagi.util.isEmpty(this.idWorkflow)&&(t=this.getSmartFiltersFromStorage("process",-1)):t=this.getSmartFiltersFromStorage("smartinbox",this.smartInboxGuid):t=this.getSmartFiltersFromStorage("process",this.idWorkflow),e.injectFilter&&($.each(this.liveFilterColumns,(function(t,i){e.injectFilter.column==i.name&&(e.injectFilter.type=i.type)})),t.push(e.injectFilter)),this.smartInboxModel.setModel(t),t},_onLiveFilterDialogApply:function(e,t){var i=this,a=[];t.validateFilterForSave(a)?(bizagi.util.isEmpty(i.idWorkflow)?bizagi.util.isEmpty(i.smartInboxGuid)?i.setSmartFiltersToStorage("process",-1,t.getModel()):i.setSmartFiltersToStorage("smartinbox",i.smartInboxGuid,t.getModel()):i.setSmartFiltersToStorage("process",i.idWorkflow,t.getModel()),i.applyLiveFilters(t.getModel()),e.dialog("close")):$.each(a,(function(e,t){i.notifier.showErrorMessage(t)}))},encodeLiveFilter:function(e){var t="";try{t=JSON.encode(e)}catch(e){t=JSON.encode("[]")}var i=CryptoJS.enc.Utf8.parse(t);return CryptoJS.enc.Base64.stringify(i)},decodeLiveFilter:function(e){var t="",i=CryptoJS.enc.Base64.parse(e),a=CryptoJS.enc.Utf8.stringify(i);try{t=JSON.parse(a)}catch(e){t=JSON.parse("[]")}return t},applyLiveFilters:function(e){bizagi.util.isEmpty(this.smartInboxGuid)?this.changeProcess({type:"process",idWorkflow:this.idWorkflow,liveFilters:this.encodeLiveFilter(e)}):this.changeProcess({type:"smartinbox",smartInboxGuid:this.smartInboxGuid,liveFilters:this.encodeLiveFilter(e)}),$("#contentItemsPaginationInbox .filterColumns").trigger("UPDATEFILTERSCOUNTER",e.count())},processHeaderLiveFilters:function(e){this.liveFilterColumns=$.map(e.columnTitle,(function(e){if("I_idCategory"!==e.fieldName&&"I_CurrentUserFullName"!==e.fieldName&&"I_UserLocation"!==e.fieldName&&"I_CurrentUserName"!==e.fieldName)return{displayName:e.displayName,name:e.fieldFilterName||e.displayName,field:e.fieldName,type:e.fieldFilterDataType,entity:e.entityGuid}}))},_configureSortableForInboxes:function(e,t){var i=this;$(".ul-processes-list[data-sort-container]",e).sortable({cursor:"grabbing",items:"> li",handle:".ui-bizagi-wp-app-inbox-processes-drag",start:function(e,t){$(this).attr("data-previndex",t.item.index())},update:function(e,a){var o=$(e.target).data("sort-container"),r=a.item.index(),s=Number($(this).attr("data-previndex"));$(this).removeAttr("data-previndex"),t=i.changeInboxOrder(t,o,s,r)}})},_sortInboxItems:function(e){var t=bizagi.services.preferences().getPreferences();if(t.inboxItemsOrder){if(e.smartinboxes){var i=t.inboxItemsOrder.smartinbox;if(i){var a=$.grep(e.smartinboxes,(function(e){return-1==i.indexOf(e.id)}));e.smartinboxes=$.map(i,(function(t){return $.first(e.smartinboxes,(function(e){return e.id==t}))})),a&&a.length>0&&Array.prototype.push.apply(e.smartinboxes,a)}}e.categories&&e.categories.map((function(i,a){var o=e.categories[a].guidCategory,r=t.inboxItemsOrder[o],s=e.categories[a].workflows;if(r){var n=$.grep(s,(function(e){return-1==r.indexOf(e.idworkflow)}));e.categories[a].workflows=$.map(r,(function(e){return $.first(s,(function(t){return t.idworkflow==e}))})),n&&n.length>0&&Array.prototype.push.apply(e.categories[a].workflows,n)}}))}},_renderStoredQueries:function(e){var t=this,i=bizagi.util.isEmpty(e.storedQueries)?t.dataService.getStoredQueryFormList():e.storedQueries;$.when(i).then((function(e){e.storedQueryForms.length>0&&$.when(t.workportalFacade.getWidget("queriesShortcut",{})).pipe((function(e){return widget=e,widget.render()})).done((function(){var e=widget.getContent();$("#queryFormShortcut").html(e)}))}))},_onInboxItemClick:function(e,t,i,a){var o=$(a);e.stopPropagation(),$(document).trigger("click.overflow"),$(".selected",t).removeClass("selected"),o.addClass("selected"),e.currentTarget&&e.currentTarget.tagName&&e.originalEvent&&(bizagi.referrerParams.page="1");var r=$("#idWorkflow",o).val(),s=$(".ui-bizagi-wp-app-inbox-processes-name",o).text().trim();"smartinbox"==o.data("item-type")?this.changeProcess({type:o.data("item-type"),smartInboxGuid:o.data("guid"),inboxName:s,page:bizagi.referrerParams?bizagi.referrerParams.page:void 0}):this.changeProcess({idWorkflow:r,smartfoldersParameters:i,page:bizagi.referrerParams?bizagi.referrerParams.page:void 0,inboxName:s})},_onFavoritesItemClick:function(e,t){var i,a=this,o=$("#idWorkflow",$(t).parent()).val();e.stopPropagation(),$(document).trigger("click.overflow"),$(t).removeClass("ui-bizagi-wp-app-inbox-processes-start").addClass("ui-bizagi-wp-app-inbox-processes-start-wait"),"false"==$(t).parent().find("#isFavorite").val()?(i={idObject:$(t).parent().find("#guidWFClass").val(),favoriteType:"WFCLASS"},$.when(a.dataService.addFavorite(i)).then((function(e){$(t).parent().find("#guidFavorite").val(e.idFavorites),$(t).removeClass("bz-icon-star-outline").addClass("bz-icon-star"),$(t).parent().find("#isFavorite").val("true"),$(t).removeClass("ui-bizagi-wp-app-inbox-processes-start-wait").addClass("ui-bizagi-wp-app-inbox-processes-start"),a.updateCountProcess(o,!0)}))):(i={idObject:$(t).parent().find("#guidFavorite").val(),favoriteType:"WFCLASS"},$.when(a.dataService.delFavorite(i)).then((function(e){"true"!=e.deleted&&1!=e.deleted||($(t).parent().find("#guidFavorite").val(""),$(t).removeClass("bz-icon-star").addClass("bz-icon-star-outline"),$(t).parent().find("#isFavorite").val("false"),$(t).removeClass("ui-bizagi-wp-app-inbox-processes-start-wait").addClass("ui-bizagi-wp-app-inbox-processes-start"),a.updateCountProcess(o,!1))}))),"Favorites"==a.params.taskState&&$(t).parent().hasClass("selected")&&$(t).parent().trigger("click")},_onCategoryItemClick:function(e){var t=$(e).next("ul"),i=$(e).find("span");!!t.is(":hidden")?(t.show(),i.removeClass("Right"),i.addClass("Down")):(t.hide(),i.removeClass("Down"),i.addClass("Right"))},_restoreDefaultInbox:function(e,t){if(this.params.restoreStatus=e.restoreStatus||this.params.restoreStatus,""==e.selectedSmartInboxId||void 0===e.selectedSmartInboxId)bizagi.workportal.widgets.inbox.RESTORE_FROM_BACK_BUTTON(this,t);else{var i=$("li[data-guid='"+e.selectedSmartInboxId+"'][data-item-type='smartinbox']",t);if(i.length>0){var a=i.parents(".ul-processes-list");"none"==a.css("display")&&a.removeClass("nodisplay"),i.addClass("selected").trigger("click")}else bizagi.workportal.widgets.inbox.RESTORE_FROM_BACK_BUTTON(this,t)}},_pinProcessByContainerPin:function(){this.renderSummary()},_unpinProcessByContainerPin:function(){this.renderSummary()},_onClickPinOrUnpinProcess:function(e){e.stopPropagation(),$(document).trigger("click.overflow");var t=function(e,t){var i=bizagi.services.preferences().getPreferences();"process"==e?(i.defaultOpenInboxWorkflowId=Number(t),i.defaultOpenInboxSmartInboxId=void 0):(i.defaultOpenInboxSmartInboxId=t,i.defaultOpenInboxWorkflowId=void 0),bizagi.services.preferences().overridePreferences(i)};if($(e.target).closest(".container-bz-icon-svg").hasClass("pinned"))this._unpinProcessByContainerPin(),t(-1);else{this._pinProcessByContainerPin();var i=$(e.target).closest("li").data("guid"),a=$(e.target).closest("li").find("#idWorkflow").val();t(null!=i?"smartinbox":"process",i||a)}},changeInboxOrder:function(e,t,i,a){var o=bizagi.services.preferences().getPreferences();if(o.inboxItemsOrder=o.inboxItemsOrder||{},"smartinbox"==t){var r=e.smartinboxes;ids=$.map(r,(function(e){return e.id}));var s=ids.splice(i,1)[0];ids.splice(a,0,s),o.inboxItemsOrder[t]=ids}else{var n=$.first(e.categories,(function(e){return e.guidCategory==t})).workflows;ids=$.map(n,(function(e){return e.idworkflow}));s=ids.splice(i,1)[0];ids.splice(a,0,s),o.inboxItemsOrder[t]=ids}return bizagi.services.preferences().overridePreferences(o),this._sortInboxItems(e),e}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.inbox",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX},renderContent:function(){var e=this.getTemplate("inbox"),t={};t.enableFolders=!(null==bizagi.override||!bizagi.override.enableFolder),t.enableSmartFolders=!(null==bizagi.override||!bizagi.override.enableSmartFolders);var i=this.content=$.tmpl(e,t);return bizagi.workportal.currentInboxView=this.getWidgetName(),i},renderSummaryForm:function(e){var t=this,i=new $.Deferred,a=void 0!==t.dataService.serviceLocator.proxyPrefix?t.dataService.serviceLocator.proxyPrefix:"";return bizagi.loader.start("rendering").then((function(){var o=new bizagi.rendering.facade({proxyPrefix:a});o.execute({canvas:e,summaryForm:!0,idCase:t.idCase}),t.renderingFacade=o,setTimeout((function(){t.resizeLayout()}),1e3),$.when(o.ready()).done((function(){i.resolve()}))})),i.promise()},routingExecute:function(e){if(null==e)return!1;var t=e.find("#idCase").val(),i=e.find("#idWorkflow").val(),a=e.find("#idWorkItem").val(),o=e.find("#idTask").val(),r=e.find("#eventAsTasks").val()||!1;this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t,idWorkflow:i,idWorkItem:a,idTask:o,eventAsTasks:r})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.listCases",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_LISTCASES},setTableHeadFixed:function(e){e.TableElement.floatThead(e.floatOptions),e.groupByCaseNumber&&bizagi.util.isIE()&&e.TableElement.find("tbody > tr.ui-bizagi-wp-app-inbox-grouped-trtag-hide").hide()},_startQuickActions:function(){var e=void 0!==this.quickActionsInstance,t={getContainerSelector:this.getQuickActionContainerSelector.bind(this),checkAllSelector:this.getQuickActionCheckAllContainerSelector(),refreshShowedResults:this.updateResults.bind(this)};e||(this.quickActionsInstance=new bizagi.workportal.widgets.quickActions(this.workportalFacade,this.dataService,t))},updateResults:function(){var e=bizagi.util.tryCatch((function(){return bizagi.referrerParams.changeProcessOptions}),{});this.changeProcess(e)},_QuickActionsRenderIn:function(e,t,i){var a=e.find("#contentQuickActions");this.quickActionsInstance.setDataToExecute(t,i),this.quickActionsInstance.renderIn(a),this.quickActionsInstance.renderCheckboxGroup(e)},_getWorkItemsInfo:function(e,t){for(var i={},a=this._getIndexFromTableColumn(e,"order","T_IDTASK"),o=this._getIndexFromTableColumn(e,"order","T_RADNUMBER"),r=0;r<t.length&&-1!==a;r++)for(var s=t[r].fields,n=s[a].workitems,l=0;l<n.length&&-1!==o;l++){var c=n[l];c.idCase=t[r].id,c.caseNumber=s[o],i[c.idWorkItem]=c}return i},_getIndexFromTableColumn:function(e,t,i){return e.findIndex((function(e){return e[t].toUpperCase()===i}))},getQuickActionCheckAllContainerSelector:function(){return"#ui-quickActions-all-processes"},getQuickActionContainerSelector:function(e){return"#ui-quickActions-checkbox-"+e},showCase:function(e,t){var a=this,o=a.getContent(),r=$("#contentDesc",o),s={},n="";a.idCase=e,r.empty(),0!=a.idCase&&$.when(a.dataService.summaryCaseDetails({idCase:a.idCase})).done((function(l){var c=null,d=!1;l.isAdhocProcess&&void 0!==l.isAdhocProcess||(l.isAdhocProcess=!1),l.isAdhocProcess&&(c=l.idAdhocProcess,d=!0),l.hasComments="true"==l.hasComments;var p=new bizagi.workportal.command.security(a.dataService);l.graphicQuery=p.checkSecurityPerm("GraphicQuery"),l.enableFeatureShowTimelineButton=bizagi.override.enableFeatureShowTimelineButton,l.enableTimelineByProcessType=a.isAvailableTimelineByProcessType(l.isAdhocProcess),l.currentState&&l.currentState.length>0&&l.currentState.forEach((function(e){e.idTask||(e.idTask=0),e.state||(e.state=e.displayName||" ")})),"undefined"!==l.process&&""!==l.process&&void 0!==l.process||(l.process=!1),"undefined"!==l.processPath&&""!==l.processPath&&void 0!==l.processPath||(l.processPath=!1);var u=$.tmpl(a.caseSummaryTemplate,$.extend(l,{security:bizagi.menuSecurity})).appendTo(r);a.callTaskDescription(l,u),bizagi.util.formatInvariantDate(o,a.getResource("dateFormat")+" "+a.getResource("timeFormat")),$("#details",u).delegate(".summaryLink","click",(function(){a.routingExecute($(this)),m.dialog("close")}));var m=u;$("#ui-bizagi-details-tabs",o).tabs({active:-1,create:function(e,t){$(this).tabs("option","active",0)},activate:function(e,t){switch(null==t?"formSummary":t.newPanel.attr("id")){case"comments":null==s.comments&&($.extend(a,{},bizagi.workportal.comments),l.canvas=$("#comments"),l.readOnly=!0,$.when(a.renderComments(l)).done((function(e){s.comments=e}))),bizagi.util.setContext({commentsFocus:!0});break;case"formSummary":if(null==s.formSummary){var o=$("#formSummary",r);o.bind("oldrenderintegration",(function(e){if(!e.isPropagationStopped()){e.stopPropagation();var t=a.getTemplate("inbox-common-case-summary-oldrender"),r={};bizagi.oldrenderevent=!0;var s=window.addEventListener?"addEventListener":"attachEvent";(0,window[s])("attachEvent"==s?"onmessage":"message",(function(e){e.stopPropagation(),a.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.data})}),!1),$.when(a.dataService.getWorkitems({idCase:a.idCase,onlyUserWorkItems:!0,eventAsTasks:!0})).done((function(e){if("object"==_typeof(e.workItems)&&e.workItems.length>=1){var s=e.workItems[0].idWorkItem,n=e.workItems[0].idTask;for(i=0;i<e.workItems.length;i++)if(e.workItems[i].idCase==a.idCase){s=e.workItems[i].idWorkItem,n=e.workItems[i].idTask;break}r.url=a.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+a.idCase+"&idWorkitem="+s+"&idTask="+n+"&isSummary=1"}else r.url=a.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+a.idCase+"&isSummary=1";o.empty(),$.tmpl(t,r).appendTo(o),a.iframeOldRender($("iframe",o))}))}}));var c={idCase:a.idCase};$.when(a.dataService.getCaseFormsRenderVersion(c)).done((function(e){1==e.formsRenderVersion?o.trigger("oldrenderintegration"):$.when(a.renderSummaryForm($("#formSummary",u))).done((function(){n=$("#formSummary",u).html(),s.formSummary=n}))}))}break;case"subprocess":null==s.subprocess&&$.when(a.dataService.summarySubProcess({idCase:a.idCase})).done((function(e){(n=$.tmpl(a.caseSummaryTemplateSubprocess,e)).appendTo($("#subprocess",u)),s.subprocess=n,n.delegate(".summaryLink","click",(function(){a.routingExecute($(this)),m.dialog("close")}))}));break;case"assignees":null==s.assignees&&$.when(a.dataService.summaryAssigness({idCase:a.idCase,preview:!0})).done((function(e){var t=[];$.each(e.events.split(", "),(function(e,i){-1===$.inArray(i,t)&&t.push(i)})),e.events=t.join(", "),(n=$.tmpl(a.caseSummaryTemplateAssigness,e)).appendTo($("#assignees",u)),s.assignees=n}));break;case"events":null==s.events&&$.when(a.dataService.summaryCaseEvents({idCase:a.idCase})).done((function(e){(n=$.tmpl(a.caseSummaryTemplateEvents,e)).appendTo($("#events",u)),s.events=n,n.delegate(".summaryLink","click",(function(){a.routingExecute($(this)),m.dialog("close")}))}))}}}),$(".workonitRow",u).button(),$(".js-show-timeline",u).click((function(t){var i=$.trim($(this).closest("div.ui-bizagi-wp-app-inbox-processes-title").find("span.js-case-number").text());a.showTimeLine({radNumber:i,idCase:e})})),$("#ui-bizagi-wp-app-inbox-description-container .ui-bizagi-wp-app-inbox-cases-ico-view",o).click((function(){d?a.showGraphicQuery({idCase:e,idWorkflow:t,isAdhoc:!0,idProcess:c}):a.showGraphicQuery({idCase:e,idWorkflow:t})})),$(".workonitRow",u).click((function(){m.dialog("close");var e=$(this).parent().find("#idWorkItem").val();a.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:a._getIdCase(l,e),idWorkflow:t,idTask:$(this).parent().find("#idTask").val(),idWorkItem:e})}));var g={};g[bizagi.localization.getResource("workportal-case-dialog-box-close")]=function(){r.empty(),u.remove(),$("#ui-bizagi-wp-app-inbox-description-container").remove()},m.dialog({modal:!0,title:l.process,width:1e3,height:600,draggable:!0,resizable:!0,buttons:g,close:function(){r.empty(),u.remove(),$("#ui-bizagi-wp-app-inbox-description-container").remove()}})}))},_getIdCase:function(e,t){var i=$.grep(e.currentState,(function(e){return e.idWorkItem==t}))[0];return i&&void 0!==i.idCase?i.idCase:e.idCase},callTaskDescription:function(e,t){var i={classNeedsModal:"task_description_needs_modal",width:720};new bizagi.workportal.widgets.task.description(this.workportalFacade,this.dataService,i).renderManyTasksDescription(e.currentState,t)},renderSummaryForm:function(e){var t=this,i=void 0!==t.dataService.serviceLocator.proxyPrefix?t.dataService.serviceLocator.proxyPrefix:"";bizagi.loader.start("rendering").then((function(){var a=new bizagi.rendering.facade({proxyPrefix:i});a.execute({canvas:e,summaryForm:!0,idCase:t.idCase}),t.renderingFacade=a,setTimeout((function(){t.resizeLayout()}),1e3)}))},isAvailableTimelineByProcessType:function(e){return!e||e&&bizagi.util.isEnableFeature("enableTimelineOnLiveProcesses")}}),bizagi.workportal.widgets.listCases.extend("bizagi.workportal.widgets.inboxGrid",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID},renderContent:function(){var e=this.getTemplate("inbox-grid"),t={};t.enableFolders=!(null==bizagi.override||!bizagi.override.enableFolder),t.enableSmartFolders=!(null==bizagi.override||!bizagi.override.enableSmartFolders),t.liveFiltersEnable=bizagi.util.isEnableFeature("enableLiveFilters");var i=this.content=$.tmpl(e,$.extend(t,{security:bizagi.menuSecurity}));return bizagi.workportal.currentInboxView=this.getWidgetName(),i}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.integration",{},{init:function(e,t,i){this.module=i.module||null,this.selector=i.selector||""},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INTEGRATION},renderContent:function(){var e=document.createElement(this.selector);return this.content=$(e)},postRender:function(){this.module&&bizagi.loader.start(this.module).then((function(){}))},clean:function(){$(this.selector).empty(),this._super()}}),bizagi.workportal.widgets.inbox.extend("bizagi.workportal.widgets.inbox",{SET_CHANGE_PROCESS_REFERRER_PARAMS:function(e){bizagi.referrerParams.changeProcessOptions=e},RESTORE_FROM_BACK_BUTTON:function(e,t){var i,a,o,r,s=function(){var e=function(){$("li:first",t).addClass("selected").trigger("click")},i=bizagi.services.preferences().getPreferences().defaultOpenInboxWorkflowId,a=bizagi.services.preferences().getPreferences().defaultOpenInboxSmartInboxId;i>0||!bizagi.util.isEmpty(a)?n(i,a)||e():e()},n=function(e,i){if(e>0?liElementSelected=$("li[idworkflow='"+e+"']:first",t):(bizagi.util.isEmpty(e)||-1==e)&&bizagi.util.isEmpty(i)?liElementSelected=$("li[idworkflow='']:first",t):liElementSelected=$("li[data-guid='"+i+"']:first",t),liElementSelected.length>0){var a=liElementSelected.closest("ul").prev(".ui-bizagi-wp-app-inbox-processes-title");return"none"==a.siblings("ul").css("display")&&a.siblings("ul").removeClass("nodisplay"),liElementSelected.addClass("selected").trigger("click"),!0}return!1};e.params.restoreStatus?(i=void 0!==bizagi.referrerParams.changeProcessOptions,a=i?bizagi.referrerParams.changeProcessOptions.idWorkflow:"",o=i?bizagi.referrerParams.changeProcessOptions.smartInboxGuid:"",r=i&&n(a,o),e.params.restoreStatus=!1,r||s()):s()}},{init:function(e,t,i){this._super(e,t,i),new bizagi.workportal.widgets.inboxes.decorator(this),this.taskState="all",this.icoTaskState="",this.idWorkflow=0,this.idCase=0,this.adhocCases=[],this.type="",this.smartInboxGuid="",this.smartInboxModel=new smartInboxModel,this.liveFilters,this.loadTemplates({inbox:bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox"),"inbox-cases":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox-cases"),"inbox-cases-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox-cases-list"),"inbox-cases-personalized-list":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox").concat("#ui-bizagi-workportal-widget-inbox-cases-personalized-list"),"inbox-common-processes":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-processes"),"inbox-common-smartinbox":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-smartinbox-menu"),"inbox-common-noresults":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-noresults"),"inbox-common-header-view":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-header-view"),"inbox-common-case-summary":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description"),"inbox-common-case-summary-form":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-form"),"inbox-common-case-summary-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-subprocess"),"inbox-common-case-summary-assignees":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-assignees"),"inbox-common-case-summary-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-events"),"inbox-common-case-summary-oldrender":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-oldrender"),useNewEngine:!1}),bizagi.inboxWidget=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX},postRender:function(){var e=this,t=e.getContent();bizagi.referrerParams=e.params.restoreStatus&&bizagi.referrerParams||{},e.params.taskState=e.params.taskState||bizagi.referrerParams.taskState||"all",e.processesTemplate=e.getTemplate("inbox-common-processes"),e.smartInboxTemplate=e.getTemplate("inbox-common-smartinbox"),e.casesTemplate=e.getTemplate("inbox-cases"),e.casesTemplateList=e.getTemplate("inbox-cases-personalized-list"),e.caseSummaryTemplate=e.getTemplate("inbox-common-case-summary"),e.caseSummaryTemplateForm=e.getTemplate("inbox-common-case-summary-form"),e.caseSummaryTemplateSubprocess=e.getTemplate("inbox-common-case-summary-subprocess"),e.caseSummaryTemplateAssigness=e.getTemplate("inbox-common-case-summary-assignees"),e.caseSummaryTemplateEvents=e.getTemplate("inbox-common-case-summary-events"),e.noResults=e.getTemplate("inbox-common-noresults"),e.paginationTemplate=e.workportalFacade.getTemplate("inbox-common-pagination-inbox"),e.renderSummary(),e.configureViewControl(),bizagi.override.enableSmartFolders&&e.configureSmartFolders(),e.comboRowsPerPage=new bizagi.workportal.results.per.page(bizagiConfig.inboxRowsPerPage),e.renderNumberRowsCombo(e.comboRowsPerPage.initCombo()),$("#contentItemsPaginationInbox .filterColumns",t).bind("click",(function(t){t.stopPropagation(),e.openLiveFilterDialog()})),$("#contentItemsPaginationInbox .filterColumns",t).bind("UPDATEFILTERSCOUNTER",(function(e,t){var i=$(this);""==t||0==t?i.removeClass("active"):i.addClass("active"),this.setAttribute("data-value",t)}))},renderNumberRowsCombo:function(e){var t=this,i=t.getContent();return t.comboRowsPerPage.renderNumberRowsCombo({combo:e,content:i,comboWrapper:$("#select-pagination",i),onChange:function(){t.changeProcess("smartinbox"==t.type?{type:"smartinbox",smartInboxGuid:t.smartInboxGuid}:{})},setRowValue:t.setRowValue,getRowValue:t.getRowValue})},getRowValue:function(){var e=bizagi.services.preferences().getPreferences();return storedValue=e&&e.inboxItemsPerPage?e.inboxItemsPerPage:null,storedValue},setRowValue:function(e){var t=bizagi.services.preferences().getPreferences();t.inboxItemsPerPage=e,bizagi.services.preferences().overridePreferences(t)},configureSmartFolders:function(){var e=this,t=e.getContent();$("#innerContentInbox>h2, #innerContentInbox .smartfolders",t).click((function(){"folders"!=e.currentPopup?(e.popupOpened=!0,e.currentPopup="folders",e.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTFOLDERS,options:{sourceElement:"#innerContentInbox>h2",modalClass:"folders","max-height":"346",height:"auto",width:"110",offset:"88 0",activeScroll:!0,foldersView:"inboxdetails",closed:function(){e.currentPopup=null}}})):bizagi.workportal.desktop.popup.closePopupInstance()}))},setFiltersOnChangeProcess:function(e,t){var i={};return i.page=t.page&&t.page>0?t.page:1,i.taskState=t.taskState||e.taskState,i.idWorkflow=null!=t.idWorkflow?t.idWorkflow:e.idWorkflow||"",i.orderFieldName=t.orderFieldName||(t.idWorkflow==e.idWorkflow||null==t.idWorkflow?e.orderFieldName:""),i.orderType=null!=t.orderType?t.orderType:t.idWorkflow==e.idWorkflow||null==t.idWorkflow?e.orderType:"0",i.order=t.order||(t.idWorkflow==e.idWorkflow||null==t.idWorkflow?e.order:""),e.idWorkflow=null!=t.idWorkflow?t.idWorkflow:void 0,e.orderFieldName=i.orderFieldName,e.orderType=i.orderType,e.order=i.order,e.type=null!=t.type?t.type:void 0,e.smartInboxGuid=null!=t.smartInboxGuid?t.smartInboxGuid:void 0,e.liveFilters=null!=t.liveFilters?t.liveFilters:void 0,i},isAvailableTimelineByProcessType:function(e){return!e||e&&bizagi.util.isEnableFeature("enableTimelineOnLiveProcesses")},changeProcess:function changeProcess(options){var self=this,content=self.getContent(),casesContainer=$("#contentCases",content),pageSelector=$("#footer #casesPagination"),descContainer=$("#contentDesc",content),nElemToShow=14,smartfoldersParameters="";self.Class.SET_CHANGE_PROCESS_REFERRER_PARAMS(options),options=options||{},bizagi.util.isEmpty(options.inboxName)&&(options.inboxName=$("#ui-bizagi-wp-app-inbox-cases-container .ui-bizagi-wp-app-inbox-processes-title").text().trim()),self.params.smartfoldersParameters&&self.params.smartfoldersParameters.urlParameters&&(smartfoldersParameters=self.params.smartfoldersParameters.urlParameters);var res=self.setFiltersOnChangeProcess(self,options),page=res.page,taskState=res.taskState,idWorkflow=res.idWorkflow,orderFieldName=res.orderFieldName,orderType=res.orderType,order=res.order,liveFilters,storedFilter,updateCallBack;bizagi.util.isEmpty(options.smartInboxGuid)?bizagi.util.isEmpty(options.idWorkflow)?bizagi.util.isEmpty(options.idWorkflow)&&(storedFilter=self.getSmartFiltersFromStorage("process",-1),liveFilters=self.encodeLiveFilter(storedFilter),updateCallBack=function(e){self.setSmartFiltersToStorage("process",-1,e)}):(storedFilter=self.getSmartFiltersFromStorage("process",options.idWorkflow),liveFilters=self.encodeLiveFilter(storedFilter),updateCallBack=function(e){self.setSmartFiltersToStorage("process",options.idWorkflow,e)}):(storedFilter=self.getSmartFiltersFromStorage("smartinbox",options.smartInboxGuid),liveFilters=self.encodeLiveFilter(storedFilter),updateCallBack=function(e){self.setSmartFiltersToStorage("smartinbox",options.smartInboxGuid,e)}),bizagi.referrerParams.page=page;var idWorkflow=null!=options.idWorkflow?options.idWorkflow:self.idWorkflow;options.workflowName=options.workflowName||self.workflowName,self.idWorkflow=idWorkflow,self.workflowName=options.workflowName,casesContainer.empty(),descContainer.empty(),pageSelector.empty(),bizagi.showErrorAlertDialog=!1;var customizedColumnsParams="smartinbox"==self.type?_defineProperty({type:self.type,smartInboxGuid:self.smartInboxGuid,order:order,orderFieldName:orderFieldName,orderType:orderType,liveFilters:liveFilters,idWorkflow:self.idWorkflow,taskState:self.taskState,onlyFavorites:eval(self.onlyFavorites),page:page,pageSize:self.getRowValue()||10,smartfoldersParameters:smartfoldersParameters},"taskState",taskState):_defineProperty({idWorkflow:self.idWorkflow,taskState:self.taskState,onlyFavorites:eval(self.onlyFavorites),order:order,orderFieldName:orderFieldName,orderType:orderType,page:page,pageSize:self.getRowValue()||10,smartfoldersParameters:smartfoldersParameters,liveFilters:liveFilters},"taskState",taskState);$.when(self.dataService.getCasesByWorkflow(customizedColumnsParams)).done((function(e){bizagi.showErrorAlertDialog=!0,bizagi.lstIdCases=e.lstIdCases,self.processHeaderLiveFilters(e),$(e.rows).each((function(e,t){t.isAdhocProcess&&void 0!==t.isAdhocProcess?(t.isAdhocProcess=!0,self.adhocCases.push(t)):t.isAdhocProcess=!1,t.enableTimelineByProcessType=self.isAvailableTimelineByProcessType(t.isAdhocProcess)})),e.idWorkflow=idWorkflow,e.hasLiveFilters=$.any(e.columnTitle,(function(e){return"true"==e.isFiltered}));var t=new bizagi.workportal.command.security(self.dataService);if(e.graphicQuery=t.checkSecurityPerm("GraphicQuery"),0==e.rows.length?($(".bz-wp-content-detail-cases").hide(),$("#ui-bizagi-wp-app-inbox-caselist-noresults").show(),e.hasLiveFilters?($("#ui-bizagi-wp-app-inbox-caselist-nocases-when-filtered").show(),self.createLiveFilterButtonSet||($("#ui-bizagi-wp-app-inbox-caselist-nocases-when-filtered #bz-create-live-filter").click((function(){$(".filterColumns ").trigger("click")})),self.createLiveFilterButtonSet=!0)):($("#ui-bizagi-wp-app-inbox-caselist-nocases").show(),t.checkSecurityPerm("NewCase").then((function(e){e?self.createNewCasesButtonSet||($("#ui-bizagi-wp-app-inbox-caselist-nocases #bz-create-new-cases").click((function(){$("#menuListNew").trigger("click")})),self.createNewCasesButtonSet=!0):$("#ui-bizagi-wp-app-inbox-caselist-nocases #bz-create-new-cases").hide()})))):($(".bz-wp-content-detail-cases").show(),$("#ui-bizagi-wp-app-inbox-caselist-noresults").hide()),!e.rows.length)return casesContainer.append("&nbsp;"),void descContainer.append("&nbsp;");e.processName=options.inboxName||"",e.pagination=e.totalPages>1,e.pages={};var i=e.totalPages,a=nElemToShow>e.totalPages?e.totalPages:nElemToShow;i>9&&a--,i>99&&a--;for(var o=1;o<=a;o++)e.pages[o]={pageNumber:o};e.enableFolders=bizagi.override.enableFolder||!1;var r=$.tmpl(self.paginationTemplate,e).html();e.enableFeatureShowTimelineButton=bizagi.override.enableFeatureShowTimelineButton,e.liveFiltersEnable=bizagi.util.isEnableFeature("enableLiveFilters"),$(pageSelector).append(r),$.tmpl(self.casesTemplate,e,{replaceLineBreak:function(e){return"string"==typeof e&&-1!==e.search(/\n/)?e.replaceAll("\n","<br/>"):e},formatMonetaryCell:function(e){return bizagi.util.formatMoney(e,BIZAGI_DEFAULT_CURRENCY_INFO)},formatDecimalCell:function(e){var t,i={decimalSymbol:BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,digitGroupSymbol:BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator,roundToDecimalPlace:BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits};return t=$.extend({colorize:!1,decimalSymbol:".",digitGroupSymbol:",",groupDigits:!0,negativeFormat:"(%s%n)",positiveFormat:"%s%n",roundToDecimalPlace:"2",symbol:""},i),bizagi.util.formatDecimal(e,t)},formatBoolean:function(e){return 1==bizagi.util.parseBoolean(e)?self.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(e)?self.getResource("render-boolean-no"):""}}).appendTo(casesContainer),bizagi.util.formatInvariantDate(content,self.getResource("dateFormat")+" "+self.getResource("timeFormat")),$(".scrollCases").data("totalPage",e.totalPages),$(".scrollCases").data("page",1),$("ul").bizagiPagination({totalPages:e.totalPages,actualPage:e.page,listElement:$("ul",pageSelector),clickCallBack:function(e){self.changeProcess("smartinbox"==self.type?{type:"smartinbox",smartInboxGuid:self.smartInboxGuid,page:e.page,order:e.parent.data("order"),orderFieldName:e.parent.data("orderFieldName"),orderType:e.parent.data("orderType")}:{idWorkflow:idWorkflow,page:e.page})}}),$("li",casesContainer).click((function(){var e=$(this);self.icoTaskState=$(this).children("#caseName").children("#taskState").val(),$(".selected",casesContainer).removeClass("selected"),e.addClass("selected");var t=$("#idCase",e).val(),i=$("#idWorkflowGQ",e).val();self.changeCase(t,i)})),$(".ui-bizagi-inbox-folder",casesContainer).click((function(e){e.stopPropagation();var t=$(this).data("idcase");"folders"!=self.currentPopup?(bizagi.workportal.desktop.popup.closePopupInstance(),self.popupOpened=!1,self.currentPopup="folders",self.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS,options:{sourceElement:$(this),modalClass:"folders","max-height":"146",height:"auto",width:"110",offset:"88 0",activeScroll:!0,onlyFolderMode:!0,idCase:t,closed:function(){self.currentPopup=null}}})):bizagi.workportal.desktop.popup.closePopupInstance()})),$(".ui-bizagi-wp-app-inbox-cases-start",casesContainer).click((function(e){var t;e.stopPropagation();var i=this;$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start").addClass("ui-bizagi-wp-app-inbox-cases-start-wait"),"false"==$(i).parent().find("#isFavorite").val()?(t={idObject:$(i).parent().parent().find("#idCase").val(),favoriteType:"CASES"},$.when(self.dataService.addFavorite(t)).done((function(e){$(i).parent().find("#guidFavorite").val(e.idFavorites),$(i).removeClass("bz-icon-star-outline").addClass("bz-icon-star"),$(i).parent().find("#isFavorite").val("true"),$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start"),self.updateCountProcess(idWorkflow,!0)}))):(t={idObject:$(i).parent().find("#guidFavorite").val(),favoriteType:"CASES"},$.when(self.dataService.delFavorite(t)).done((function(e){"true"!=e.deleted&&1!=e.deleted||($(i).parent().find("#guidFavorite").val(""),$(i).removeClass("bz-icon-star").addClass("bz-icon-star-outline"),$(i).parent().find("#isFavorite").val("false"),$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start"),self.updateCountProcess(idWorkflow,!1))})))})),e.rows.length>0?(self.icoTaskState=$("li:first",casesContainer).children("#taskState").val(),$("li:first",casesContainer).addClass("selected").trigger("click")):self.changeCase(0),$(casesContainer).bizagiScrollbar();var s=bizagi.clone(storedFilter);$.each(storedFilter,(function(t,i){self.isValidFilter(i,e.columnTitle)||(s.splice(t,1),updateCallBack(s),$("#contentItemsPaginationInbox .filterColumns").trigger("UPDATEFILTERSCOUNTER",s.count()))}))})).fail((function(e){var t,i=self.workportalFacade.getTemplate("info-message"),a=$("#contentDesc",content);try{t=(e=JSON.parse(e.responseText)||{}).message||e}catch(e){t=bizagi.localization.getResource("workportal-general-error-message-contact-administrator")}var o=$.tmpl(i,{message:t,css:"ui-bizagi-info-inbox-detail"});a.append("&nbsp;"),o.appendTo(casesContainer),customizedColumnsParams.liveFilters=void 0,$.when(self.dataService.getCasesByWorkflow(customizedColumnsParams)).done((function(e){self.processHeaderLiveFilters(e)}))}))},changeCase:function(e,t){var i=this,a=i.getContent(),o=$("#contentDesc",a),r={},s="",n=!1,l=null;o.empty();for(var c=0;c<this.adhocCases.length;c++)e==this.adhocCases[c].id&&(n=!0,l=this.adhocCases[c].idAdhocProcess);i.idCase=e,0!=i.idCase&&$.when(i.dataService.summaryCaseDetails({idCase:i.idCase})).done((function(c){c.hasComments="true"==c.hasComments;var d=new bizagi.workportal.command.security(i.dataService);c.graphicQuery=d.checkSecurityPerm("GraphicQuery"),c.enableFeatureShowTimelineButton=bizagi.override.enableFeatureShowTimelineButton,c.enableTimelineByProcessType=i.isAvailableTimelineByProcessType(c.isAdhocProcess),void 0===c.contextualized&&(c.contextualized=!0),c.currentState&&c.currentState.length>0&&c.currentState.forEach((function(e){e.idTask||(e.idTask=0),e.state||(e.state=e.displayName||" ")})),"undefined"!==c.process&&""!==c.process&&void 0!==c.process||(c.process=!1),"undefined"!==c.processPath&&""!==c.processPath&&void 0!==c.processPath||(c.processPath=!1);var p=$.tmpl(i.caseSummaryTemplate,$.extend(c,{security:bizagi.menuSecurity})).appendTo(o);i.callTaskDescription(c,p),bizagi.util.formatInvariantDate(a,i.getResource("dateFormat")+" "+i.getResource("timeFormat")),$("#details",p).delegate(".summaryLink","click",(function(){i.routingExecute($(this))})),$("#ui-bizagi-details-tabs",a).tabs({active:-1,create:function(e,t){$(this).tabs("option","active",0)},activate:function(e,t){switch(null==t?"formSummary":t.newPanel.attr("id")){case"comments":null==r.comments&&($.extend(i,{},bizagi.workportal.comments),c.canvas=$("#comments",o),c.readOnly=!0,$.when(i.renderComments(c)).done((function(e){r.comments=e}))),bizagi.util.setContext({commentsFocus:!0});break;case"formSummary":if(null==r.formSummary){var a=$("#formSummary",o);a.bind("oldrenderintegration",(function(e){if(!e.isPropagationStopped()){e.stopPropagation();var t=i.getTemplate("inbox-common-case-summary-oldrender"),o={};bizagi.oldrenderevent=!0;var r=window.addEventListener?"addEventListener":"attachEvent";(0,window[r])("attachEvent"==r?"onmessage":"message",(function(e){e.stopPropagation(),i.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.data})}),!1),$.when(i.dataService.getWorkitems({idCase:i.idCase,onlyUserWorkItems:!0})).done((function(e){if("object"==_typeof(e.workItems)&&e.workItems.length>=1){var r=e.workItems[0].idWorkItem,s=e.workItems[0].idTask;o.url=i.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+i.idCase+"&idWorkitem="+r+"&idTask="+s+"&isSummary=1"}else o.url=i.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase="+i.idCase+"&isSummary=1";a.empty(),$.tmpl(t,o).appendTo(a),i.iframeOldRender($("iframe",a)),i.performResizeLayout()}))}}));var n={idCase:i.idCase};$.when(i.dataService.getCaseFormsRenderVersion(n)).done((function(e){1==e.formsRenderVersion?a.trigger("oldrenderintegration"):$.when(i.renderSummaryForm(a)).done((function(){s=$("#formSummary",o).html(),r.formSummary=s}))}))}break;case"subprocess":null==r.subprocess&&$.when(i.dataService.summarySubProcess({idCase:i.idCase})).done((function(e){(s=$.tmpl(i.caseSummaryTemplateSubprocess,e)).appendTo($("#subprocess",o)),r.subprocess=s,s.delegate(".summaryLink","click",(function(){i.routingExecute($(this))}))}));break;case"assignees":null==r.assignees&&$.when(i.dataService.summaryAssigness({idCase:i.idCase,preview:!0})).done((function(e){var t=[];$.each(e.events.split(", "),(function(e,i){-1===$.inArray(i,t)&&t.push(i)})),e.events=t.join(", ");var a=[];$.each(e.activities.split(", "),(function(e,t){-1===$.inArray(t,a)&&a.push(t)})),e.activities=a.join(", "),(s=$.tmpl(i.caseSummaryTemplateAssigness,e)).appendTo($("#assignees",o)),r.assignees=s}));break;case"events":null==r.events&&$.when(i.dataService.summaryCaseEvents({idCase:i.idCase})).done((function(e){(s=$.tmpl(i.caseSummaryTemplateEvents,e)).appendTo($("#events",o)),r.events=s,s.delegate(".summaryLink","click",(function(){i.routingExecute($(this))}))}))}}}),$.each($("#ui-bizagi-wp-app-inbox-processes-container li:even, #ui-bizagi-wp-app-inbox-cases-container li:even"),(function(){$(this).addClass("ui-bizagi-wp-app-inbox-evenColor")})),$(".js-show-timeline",a).click((function(t){var a=$.trim($(this).closest("div.ui-bizagi-wp-app-inbox-processes-title").find("span.js-case-number").text());i.showTimeLine({radNumber:a,idCase:e})})),$(".ui-bizagi-wp-app-inbox-cases-ico-view",a).click((function(){n?i.showGraphicQuery({idCase:e,idWorkflow:t,isAdhoc:!0,idProcess:l}):i.showGraphicQuery({idCase:e,idWorkflow:t})})),$(".workonitRow",a).button(),$(".workonitRow",a).click((function(){var e=$(this).parent().find("#idWorkItem").val(),a={taskState:i.params.taskState,idWorkItem:e,idCase:i.idCase,idTask:$(this).parent().find("#idTask").val(),onlyFavorites:i.onlyFavorites,idWorkflow:i.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX};$.extend(bizagi.referrerParams,bizagi.referrerParams,a),i.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i.idCase,idTask:$(this).parent().find("#idTask").val(),idWorkItem:e,idWorkflow:t})})),i.resizeLayout(),$(".scrollProcess").bizagiScrollbar(),$(".scrollSummary").bizagiScrollbar({autohide:!1})}))},callTaskDescription:function(e,t){var i={classNeedsModal:"task_description_needs_modal",width:230};new bizagi.workportal.widgets.task.description(this.workportalFacade,this.dataService,i).renderManyTasksDescription(e.currentState,t)},casesPagination:function(e){var t=this,i=t.getContent(),a=$("#contentCases",i),o=$("#contentCases .scrollCases ul",i),r=new $.Deferred;return t.idWorkflow=e.idWorkflow,t.page=e.page||2,bizagi.showErrorAlertDialog=!1,$.when(t.dataService.getCasesByWorkflow({idWorkflow:t.idWorkflow,taskState:t.taskState,page:t.page})).done((function(e){bizagi.showErrorAlertDialog=!0,e.processName="",$.tmpl(t.casesTemplateList,e).appendTo(o),$("li",a).click((function(){var e=$(this);$(".selected",a).removeClass("selected"),e.addClass("selected");var i=$("#idCase",e).val(),o=$("#idWorkflowGQ",e).val();t.changeCase(i,o)})),r.resolve()})).fail((function(e){e=JSON.parse(e.responseText)||{};var i=t.workportalFacade.getTemplate("info-message"),o=e.message||e,s=$.tmpl(i,{message:o});$(".ui-bizagi-error",s).width("50%"),s.appendTo(a),r.resolve()})),r.promise()},performResizeLayout:function(){this._super(),this.renderingFacade&&this.renderingFacade.resize({forceResize:!0})},updateCountProcess:function(e,t){var i=this.getContent(),a=$("#contentProc",i),o=!1;if(t=!!t,"Favorites"!=this.params.taskState||""==e)return!0;$.when(this.dataService.getAllProcesses({taskState:this.taskState,onlyFavorites:this.onlyFavorites})).done((function(i){i.categories=i.categories||{},$.each(i.categories,(function(t,i){$.each(i.workflows,(function(t,i){i.idworkflow==e&&($('li > input[value="'+e+'"][id="idWorkflow"]',a).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(i.count),o=!0)}))})),i.categories[bizagi.localization.getResource("workportal-widget-inbox-all-processes")].key="",o||(t?$('li > input[value="'+e+'"][id="idWorkflow"]',a).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(1):$('li > input[value="'+e+'"][id="idWorkflow"]',a).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(0))}))},iframeOldRender:function(e){this.getContent();var t,i=bizagi.readQueryString();$.each(e,(function(){$(this).is("iframe")&&(t=$(this))})),t.load((function(){var e=$(this).contents(),t=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";$("head",e).append("<script type='text/javascript' src='../../js/renderintegration.js'><\/script>"),t=t.replace("%theme%",i.theme||"bizagiDefault"),$("body",e).append("<link type='text/css' rel='stylesheet' href='"+t+"'>")}))}}),bizagi.workportal.widgets.inboxGrid.extend("bizagi.workportal.widgets.inboxGrid",{SELECTOR_QUICK_ACTIONS_CONTAINER:"#contentQuickActions"},{init:function(e,t,i){this._super(e,t,i),new bizagi.workportal.widgets.inboxes.decorator(this),this.taskState="all",this.icoTaskState="",this.idWorkflow=0,this.isAdhocProcess=!0,this.idCase=0,this.page=0,this.adhocIds=[],this.type="",this.smartInboxGuid="",this.smartInboxModel=new smartInboxModel,this.liveFilters,this.notifier=bizagi.injector.get("notifier"),this.templatesLoaded=this.loadTemplates({"inbox-grid":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.grid").concat("#ui-bizagi-workportal-widget-inbox-grid"),"inbox-grid-rubik":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.grid").concat("#ui-bizagi-workportal-widget-inbox-grid-rubik"),"inbox-grid-cases":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.grid").concat("#ui-bizagi-workportal-widget-inbox-grid-cases"),"inbox-common-processes":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-processes"),"inbox-common-smartinbox":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-smartinbox-menu"),"inbox-common-header-view":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-header-view"),"inbox-common-case-summary":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description"),"inbox-common-case-summary-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-subprocess"),"inbox-common-case-summary-assignees":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-assignees"),"inbox-common-case-summary-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-case-description-events"),"inbox-common-case-summary-oldrender":bizagi.getTemplate("bizagi.workportal.desktop.widget.inbox.common").concat("#ui-bizagi-workportal-widget-inbox-common-oldrender"),useNewEngine:!1}),this._startQuickActions(),bizagi.inboxWidget=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID},postRender:function(){var e=this,t=e.getContent();bizagi.referrerParams=e.params.restoreStatus&&bizagi.referrerParams||{},e.params.taskState=e.params.taskState||bizagi.referrerParams.taskState||"all",e.processesTemplate=e.getTemplate("inbox-common-processes"),e.smartInboxTemplate=e.getTemplate("inbox-common-smartinbox"),e.casesTemplate=e.getTemplate("inbox-grid-cases"),e.caseSummaryTemplate=e.getTemplate("inbox-common-case-summary"),e.caseSummaryTemplateSubprocess=e.getTemplate("inbox-common-case-summary-subprocess"),e.caseSummaryTemplateAssigness=e.getTemplate("inbox-common-case-summary-assignees"),e.caseSummaryTemplateEvents=e.getTemplate("inbox-common-case-summary-events"),e.paginationTemplate=e.workportalFacade.getTemplate("inbox-common-pagination-grid"),new bizagi.workportal.command.security(e.dataService).checkSecurityPerm("Inbox").done((function(t){t?(e.renderSummary(),e.configureViewControl(),bizagi.override.enableSmartFolders&&e.configureSmartFolders()):($("#contentInbox").remove(),$("#contentFramework").remove(),$("#footer").remove(),e.content=$('<div class="wp-empty"></div>')),e.comboRowsPerPage=new bizagi.workportal.results.per.page(bizagiConfig.inboxRowsPerPage),e.renderNumberRowsCombo(e.comboRowsPerPage.initCombo())})),e.params.widget===bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTINBOX&&"create"===e.params.action&&e.publish("showDialogWidget",{selectedInboxData:{smartInboxId:e.params.id,owner:e.params.owner,actionName:e.params.action},modalParameters:{title:bizagi.localization.getResource("workportal-widget-smartinbox-title-new","New Smart Inbox"),width:"800px",showCloseButton:!1,refreshInbox:!1},showBackButton:!1,closeVisible:!1,widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTINBOX,buttons:{}}),$("#contentItemsPaginationInbox .filterColumns",t).bind("click",(function(t){t.stopPropagation(),e.openLiveFilterDialog()})),$("#contentItemsPaginationInbox .filterColumns",t).bind("UPDATEFILTERSCOUNTER",(function(e,t){var i=$(this);""==t||0==t?i.removeClass("active"):i.addClass("active"),this.setAttribute("data-value",t)}))},renderNumberRowsCombo:function(e){var t=this,i=t.getContent();return t.comboRowsPerPage.renderNumberRowsCombo({combo:e,content:i,comboWrapper:$("#select-pagination",i),onChange:function(){t.quickActionsInstance&&t.quickActionsInstance.setPersistCheckboxGroup(!0),t.changeProcess("smartinbox"==t.type?{type:"smartinbox",smartInboxGuid:t.smartInboxGuid}:{})},setRowValue:t.setRowValue,getRowValue:t.getRowValue})},getRowValue:function(){var e=bizagi.services.preferences().getPreferences();return storedValue=e&&e.inboxItemsPerPage?e.inboxItemsPerPage:null,storedValue},setRowValue:function(e){var t=bizagi.services.preferences().getPreferences();t.inboxItemsPerPage=Number(e),bizagi.services.preferences().overridePreferences(t),this.renderNumberRowsCombo&&(this.comboRowsPerPage=new bizagi.workportal.results.per.page(bizagiConfig.inboxRowsPerPage),this.renderNumberRowsCombo(this.comboRowsPerPage.initCombo()))},configureSmartFolders:function(){var e=this,t=e.getContent();$("#innerContentInbox>h2, #innerContentInbox .smartfolders",t).click((function(){"folders"!=e.currentPopup?(e.popupOpened=!0,e.currentPopup="folders",e.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTFOLDERS,options:{sourceElement:"#innerContentInbox>h2",modalClass:"folders","max-height":"346",height:"auto",width:"110",offset:"88 0",activeScroll:!0,foldersView:"inboxgrid",closed:function(){e.currentPopup=null}}})):bizagi.workportal.desktop.popup.closePopupInstance()}))},setFiltersOnChangeProcess:function(e,t){var i={};return i.page=t.page&&t.page>0?t.page:1,i.taskState=t.taskState||e.taskState,i.idWorkflow=null!=t.idWorkflow?t.idWorkflow:e.idWorkflow||"",i.orderFieldName=t.orderFieldName||(t.idWorkflow==e.idWorkflow||null==t.idWorkflow?e.orderFieldName:""),i.orderType=null!=t.orderType?t.orderType:t.idWorkflow==e.idWorkflow||null==t.idWorkflow?e.orderType:"0",i.order=t.order||(t.idWorkflow==e.idWorkflow||null==t.idWorkflow?e.order:""),e.idWorkflow=null!=t.idWorkflow?t.idWorkflow:void 0,e.orderFieldName=i.orderFieldName,e.orderType=i.orderType,e.order=i.order,e.type=null!=t.type?t.type:void 0,e.smartInboxGuid=null!=t.smartInboxGuid?t.smartInboxGuid:void 0,e.liveFilters=null!=t.liveFilters?t.liveFilters:void 0,i},changeProcess:function changeProcess(options){var _ref,self=this,content=self.getContent(),casesContainer=$("#contentCases",content),procContainer=$("#contentProc",content),pageSelector=$("#footer #casesPagination"),nElemToShow=14;options=options||{},bizagi.workportal.widgets.inbox.SET_CHANGE_PROCESS_REFERRER_PARAMS(options),bizagi.util.isEmpty(options.inboxName)&&(options.inboxName=$("#contentInboxName").text());var res=self.setFiltersOnChangeProcess(self,options),page=res.page,taskState=res.taskState,idWorkflow=res.idWorkflow,orderFieldName=res.orderFieldName,orderType=res.orderType,order=res.order,liveFilters,storedFilter,updateCallBack;bizagi.util.isEmpty(options.smartInboxGuid)?bizagi.util.isEmpty(options.idWorkflow)?bizagi.util.isEmpty(options.idWorkflow)&&(storedFilter=self.getSmartFiltersFromStorage("process",-1),liveFilters=self.encodeLiveFilter(storedFilter),updateCallBack=function(e){self.setSmartFiltersToStorage("process",-1,e)}):(storedFilter=self.getSmartFiltersFromStorage("process",options.idWorkflow),liveFilters=self.encodeLiveFilter(storedFilter),updateCallBack=function(e){self.setSmartFiltersToStorage("process",options.idWorkflow,e)}):(storedFilter=self.getSmartFiltersFromStorage("smartinbox",options.smartInboxGuid),liveFilters=self.encodeLiveFilter(storedFilter),updateCallBack=function(e){self.setSmartFiltersToStorage("smartinbox",options.smartInboxGuid,e)}),bizagi.referrerParams.page=page;var smartfoldersParameters="";self.params.smartfoldersParameters&&self.params.smartfoldersParameters.urlParameters&&(smartfoldersParameters=self.params.smartfoldersParameters.urlParameters),casesContainer.empty(),pageSelector.hide().empty(),bizagi.showErrorAlertDialog=!1;var customizedColumnsParams="smartinbox"==self.type?(_ref={type:self.type,smartInboxGuid:self.smartInboxGuid,pageSize:self.getRowValue()||10,order:order,orderFieldName:orderFieldName,orderType:orderType,page:page},_defineProperty(_ref,"pageSize",self.getRowValue()||10),_defineProperty(_ref,"smartfoldersParameters",smartfoldersParameters),_defineProperty(_ref,"liveFilters",liveFilters),_defineProperty(_ref,"taskState",taskState),_ref):{idWorkflow:idWorkflow,taskState:taskState,onlyFavorites:eval(self.onlyFavorites),order:order,orderFieldName:orderFieldName,orderType:orderType,page:page,pageSize:self.getRowValue()||10,smartfoldersParameters:smartfoldersParameters,liveFilters:liveFilters,group:bizagiConfig.groupByCaseNumber?"T_RADNUMBER":null};$.when(self.dataService.getCustomizedColumnsData(customizedColumnsParams)).done((function(e){var t=bizagi.util.tryCatch((function(){return 1!=page&&0===e.cases.rows.length&&0===e.cases.page}),!1),i=bizagi.util.tryCatch((function(){return bizagi.referrerParams.changeProcessOptions}),{});if(self.processHeaderLiveFilters(e.cases),!0===t)return i.page=1,self.changeProcess(i),!1;bizagi.showErrorAlertDialog=!0,$(e.cases.rows).each((function(e,t){t.isAdhocProcess&&void 0!==t.isAdhocProcess||(t.isAdhocProcess=!1),t.isAdhocProcess&&self.adhocIds.push({caseId:t.id,processId:t.idAdhocProcess}),t.enableTimelineByProcessType=self.isAvailableTimelineByProcessType(t.isAdhocProcess)})),bizagi.lstIdCases=e.cases.lstIdCases;var a=0;$(e.cases.columnTitle).each((function(t,i){"T_idTask"==i.order&&$(e.cases.rows).each((function(t,i){self.isArray(i.fields[a])||(e.cases.rows[t].fields[a]={workitems:[{TaskName:i.fields[a],State:e.cases.rows[t].taskState}]})})),a++}));var o={};o.pagination=e.cases.totalPages>1,o.page=bizagi.referrerParams.page||e.cases.page,o.pages={};var r=nElemToShow>e.cases.totalPages?e.cases.totalPages:nElemToShow;for(a=1;a<=r;a++)o.pages[a]={pageNumber:a};if(o.gridPagination="gridCasePagination",o.previousPage=e.cases.page>1?e.cases.page-1:1,o.nextPage=e.cases.page<e.cases.totalPages?e.cases.page+1:e.cases.totalPages,o.totalPages=e.cases.totalPages,$(pageSelector).empty(),o.totalPages>1){var s=$.tmpl(self.paginationTemplate,o).html();0==$(pageSelector).html().length&&$(pageSelector).show().append(s)}e.cases.enableFolders=bizagi.override.enableFolder||!1,e.cases.inboxName=options.inboxName,e.cases=bizagi.util.formatDecimalAndMoneyCell(e.cases,BIZAGI_DEFAULT_CURRENCY_INFO);var n=new bizagi.workportal.command.security(self.dataService);$.when(n.checkSecurityPerm("GraphicQuery"),n.checkSecurityPerm("TimeLine")).done((function(t,i){e.cases.graphicQuery=t,e.cases.timeLine=i&&bizagi.override.enableFeatureShowTimelineButton,e.cases.groupByCaseNumber=bizagiConfig.groupByCaseNumber,e.cases.haveQuickActions=e.cases.quickActions&&e.cases.quickActions.length>0,e.cases.hasLiveFilters=$.any(e.cases.columnTitle,(function(e){return"true"==e.isFiltered})),e.cases.liveFiltersEnable=bizagi.util.isEnableFeature("enableLiveFilters");var a=$.tmpl(self.casesTemplate,e.cases,{enableSmartFilter:self.smartInboxGuid,showMagicButton:function(){return bizagi.override.enableAdhocProcess},setFormat:self.formatValue,isArray:self.isArray,formatCategories:self.formatCategories,isDate:bizagi.util.isDate,isFiltered:!1,replaceLineBreak:function(e){return"string"==typeof e&&-1!==e.search(/\n/)?e.replaceAll("\n","<br/>"):e},getRadNumberColumnIndex:function(){for(var e=this.data,t=-1,i=0,a=e.columnTitle.length;i<a;i++)"I_RadNumber"==e.columnTitle[i].fieldName&&(t=i);return t},showColumn:function(e){var t=this.getRadNumberColumnIndex();return this.data.groupByCaseNumber&&t==e?" style=display:none; ":""},createGroupedHeader:function(e){var t=this.data,i=!1,a=this.getRadNumber(t.rows[e]);t.groupByCaseNumber&&(0==e?i=!0:a!=this.getRadNumber(t.rows[e-1])&&(i=!0));return i},getRadNumber:function(e){var t=this.getRadNumberColumnIndex();return t>=0?e.fields[t]:""},isIEAndFirstRowAndGroupCases:function(e){return 0==e&&this.data.groupByCaseNumber&&bizagi.util.isIE()}}).appendTo(casesContainer);if(e.cases.haveQuickActions){var r=self._getWorkItemsInfo(e.cases.columnTitle,e.cases.rows);self._QuickActionsRenderIn(a,r,e.cases.quickActions)}if(bizagi.util.isIE9()){var s=new RegExp(">[ \t\r\n\v\f]*<","g"),l=$("#ui-bizagi-wp-app-inbox-grid-cases",casesContainer).html();$("#ui-bizagi-wp-app-inbox-grid-cases",casesContainer).html(l.replace(s,"><"))}1==bizagi.override.ShowTimeInInboxDates||null==bizagi.override.ShowTimeInInboxDates?bizagi.util.formatInvariantDate(content,self.getResource("dateFormat")+" "+self.getResource("timeFormat")):bizagi.util.formatInvariantDate(content,self.getResource("dateFormat")),$("li",pageSelector).parent().data("order",order),$("li",pageSelector).parent().data("orderFieldName",orderFieldName),$("li",pageSelector).parent().data("orderType",orderType),$("ul").bizagiPagination({maxElemShow:50,totalPages:o.totalPages,actualPage:o.page,listElement:$("ul",pageSelector),clickCallBack:function(e){self.changeProcess("smartinbox"==self.type?{type:"smartinbox",smartInboxGuid:self.smartInboxGuid,page:e.page,order:e.parent.data("order"),orderFieldName:e.parent.data("orderFieldName"),orderType:e.parent.data("orderType")}:{idWorkflow:idWorkflow,page:e.page,order:e.parent.data("order"),orderFieldName:e.parent.data("orderFieldName"),orderType:e.parent.data("orderType")})}}),$("#btn-show-smartinbox",content).click((function(e){self.publish("showDialogWidget",{modalParameters:{title:bizagi.localization.getResource("workportal-widget-smartinbox-title-new","New Smart Inbox"),width:"800px",showCloseButton:!1,refreshInbox:!1},showBackButton:!1,closeVisible:!1,widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SMARTINBOX,buttons:{}})})),$(".inbox-grid-tooltip-button",content).tooltip(),$("#ui-bizagi-wp-app-inbox-grid-cases tr:nth-child(even)",a).addClass("event"),$(".ui-bizagi-wp-app-inbox-activity-name",a).click((function(){var e={taskState:self.params.taskState,idWorkItem:$(this).find("#idWorkItem").val(),idCase:$(this).find("#idCase").val(),idTask:$(this).find("#idTask").val(),onlyFavorites:self.onlyFavorites,idWorkflow:self.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID};$.extend(bizagi.referrerParams,bizagi.referrerParams,e);var t=$(this).find("#idCase").val(),i=$(this).find("#idTask").val(),a=$(this).find("#idWorkItem").val(),o=$(this).closest("tr").data("idworkflow");self.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t,idWorkItem:a,idTask:i,idWorkflow:o})})),$(".ui-bizagi-wp-app-inbox-grouped",a).bind("click",(function(){$(this).data("radnumber");var e={taskState:self.params.taskState,idWorkItem:$(this).find("#idWorkItem").val(),idCase:$(this).find("#idCase").val(),idTask:$(this).find("#idTask").val(),onlyFavorites:self.onlyFavorites,idWorkflow:self.idWorkflow,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID};$.extend(bizagi.referrerParams,bizagi.referrerParams,e);var t=$(this).find("#idCase").val();self.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t})})),$(a).delegate(".ui-bizagi-wp-app-inbox-cases-start","click",(function(e){var t;e.stopPropagation();var i=this;$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start").addClass("ui-bizagi-wp-app-inbox-cases-start-wait"),"false"==$(i).parent().find("#isFavorite").val()?(t={idObject:$(i).parent().find("#idCase").val(),favoriteType:"CASES"},$.when(self.dataService.addFavorite(t)).done((function(e){$(i).parent().find("#guidFavorite").val(e.idFavorites),$(i).removeClass("bz-icon-star-outline").addClass("bz-icon-star"),$(i).parent().find("#isFavorite").val("true"),$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start"),self.updateCountProcess(idWorkflow,!0)}))):(t={idObject:$(i).parent().find("#guidFavorite").val(),favoriteType:"CASES"},$.when(self.dataService.delFavorite(t)).done((function(e){"true"!=e.deleted&&1!=e.deleted||($(i).parent().find("#guidFavorite").val(""),$(i).removeClass("bz-icon-star").addClass("bz-icon-star-outline"),$(i).parent().find("#isFavorite").val("false"),$(i).removeClass("ui-bizagi-wp-app-inbox-cases-start-wait").addClass("ui-bizagi-wp-app-inbox-cases-start"),self.updateCountProcess(idWorkflow,!1))})))})),$("i.bz-icon-search-outline",a).click((function(){var e=$(this).parents("td").first().find("#idCase").val(),t=$(this).closest("tr").data("idworkflow");self.showCase(e,t)})),$(".ui-bizagi-wp-app-inbox-cases-ico-view",a).click((function(e){var t=$(this).parent().children("#idCase").val(),i=$(this).closest("tr").data("idworkflow"),a=null;if($(this).closest("tr").data("isadhoc")){for(var o=0;o<self.adhocIds.length;o++)if(parseInt(t)==self.adhocIds[o].caseId){a=self.adhocIds[o].processId,self.showGraphicQuery({idCase:t,idWorkflow:i,isAdhoc:!0,idProcess:a});break}}else self.showGraphicQuery({idCase:t,idWorkflow:i});e.preventDefault()})),$(".js-show-timeline",a).click((function(e){var t=$(this).parent().children("#idCase").val(),i=$.trim($(this).closest("tr").find(".I_RadNumber").text());self.showTimeLine({radNumber:i,idCase:t})})),$(".sortColumnsData",casesContainer).click((function(){self.changeProcess("smartinbox"==self.type?{type:self.type,smartInboxGuid:self.smartInboxGuid,orderFieldName:$(this).find("#orderFieldName").val(),orderType:0==$(this).find("#orderType").val()?1:0,order:$(this).find("#order").val()}:{idWorkflow:idWorkflow,orderFieldName:$(this).find("#orderFieldName").val(),orderType:0==$(this).find("#orderType").val()?1:0,order:$(this).find("#order").val()})})),$(".filterColumnsHover",casesContainer).click((function(e){e.stopPropagation();var t=$(e.currentTarget).data();t.isfiltered?self.openLiveFilterDialog():self.openLiveFilterDialog({injectFilter:{column:t.column,operator:"",type:""}})})),$(casesContainer).bizagiScrollbar({autohide:!1}),$(".ui-bizagi-inbox-folder",a).click((function(e){e.stopPropagation();var t=$(this).data("idcase");"folders"!=self.currentPopup?(self.popupOpened=!0,self.currentPopup="folders",self.publish("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS,options:{sourceElement:$(this),modalClass:"folders","max-height":"146",height:"auto",width:"110",offset:"88 0",activeScroll:!0,onlyFolderMode:!0,idCase:t,closed:function(){self.currentPopup=null}}})):bizagi.workportal.desktop.popup.closePopupInstance()})),$(".ui-bizagi-wp-app-magic-button",casesContainer).bind("click",(function(){self.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INTEGRATION,module:"adhocProcess",selector:"app-root"})})),n.checkSecurityPerm("NewCase").then((function(e){e?$("#ui-bizagi-wp-app-inbox-grid-nocases #bz-create-new-cases",casesContainer).click((function(){$("#menuListNew").trigger("click")})):$("#ui-bizagi-wp-app-inbox-grid-nocases #bz-create-new-cases",casesContainer).hide()})),$("#ui-bizagi-wp-app-inbox-grid-nocases #bz-create-live-filter").click((function(){$(".filterColumns ").trigger("click")})),$(procContainer).bizagiScrollbar()}));var l=$("li#contentCases > .ui-bizagi-wp-app-inbox-grid-cases-container-parent-tableHeadFixed > .ui-bizagi-wp-app-inbox-grid-cases-container-tableHeadFixed > table");self.setTableHeadFixed({TableElement:l,groupByCaseNumber:e.cases.groupByCaseNumber,floatOptions:{position:"fixed",zIndex:1,scrollContainer:function(){return $("li#contentCases > .ui-bizagi-wp-app-inbox-grid-cases-container-parent-tableHeadFixed > .ui-bizagi-wp-app-inbox-grid-cases-container-tableHeadFixed")}}}),l.find("thead > tr").height(l.prev().height());var c=bizagi.clone(storedFilter);$.each(storedFilter,(function(t,i){self.isValidFilter(i,e.cases.columnTitle)||(c.splice(t,1),updateCallBack(c),$("#contentItemsPaginationInbox .filterColumns").trigger("UPDATEFILTERSCOUNTER",c.count()))}))})).fail((function(e){var t,i=self.workportalFacade.getTemplate("info-message");try{t=(e=JSON.parse(e.responseText)||{}).message||e}catch(e){t=bizagi.localization.getResource("workportal-general-error-message-contact-administrator")}$.tmpl(i,{message:t}).appendTo(casesContainer),customizedColumnsParams.liveFilters=void 0,$.when(self.dataService.getCustomizedColumnsData(customizedColumnsParams)).done((function(e){self.processHeaderLiveFilters(e.cases)}))}))},formatRequest:function(e){return e},formatCategories:function(e){return e},isArray:function(e){return"object"==_typeof(e)},updateCountProcess:function(e,t){var i=this.getContent(),a=$("#contentProc",i),o=!1;if(t=!!t,"Favorites"!=this.params.taskState||""==e)return!0;$.when(this.dataService.getAllProcesses({taskState:this.taskState,onlyFavorites:this.onlyFavorites})).done((function(i){i.categories=i.categories||{},$.each(i.categories,(function(t,i){$.each(i.workflows,(function(t,i){i.idworkflow==e&&($('li > input[value="'+e+'"][id="idWorkflow"]',a).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(i.count),o=!0)}))})),o||(t?$('li > input[value="'+e+'"][id="idWorkflow"]',a).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(1):$('li > input[value="'+e+'"][id="idWorkflow"]',a).parent().find(".ui-bizagi-wp-app-inbox-processes-ncase").html(0))}))},iframeOldRender:function(e){this.getContent();var t,i=bizagi.readQueryString();$.each(e,(function(){$(this).is("iframe")&&(t=$(this))})),t.load((function(){var e=$(this).contents(),t=$.browser.mozilla||$.browser.webkit?"../../css/render_%theme%.css":"css/render_%theme%.css";t=t.replace("%theme%",i.theme||"bizagiDefault"),$("body",e).append("<link type='text/css' rel='stylesheet' href='"+t+"'>")}))},dispose:function(){this.getContent();this._super()}}),bizagi.workportal.widgets.inboxGrid.extend("bizagi.workportal.widgets.inboxGridRubik",{},{renderContent:function(){var e=this.getTemplate("inbox-grid-rubik"),t=this.content=$.tmpl(e,{enableSmartFilter:this.smartInboxGuid});return bizagi.workportal.currentInboxView=this.getWidgetName(),t},postRender:function(){var e=this;bizagi.referrerParams=e.params.restoreStatus&&bizagi.referrerParams||{},e.changeProcess({idWorkflow:"",workflowName:"All Cases ",smartfoldersParameters:""}),e.getEventListener().on("PROCESS-VIEW-UPDATE",(function(t,i){e.changeProcess(i)}))}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.folders",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS},init:function(e,t,i){this._super(e,t,i),this.loadTemplates({folders:bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders"),"folders-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-elements"),"folders-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-empty-elements"),"folders-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-query-tree"),"folders-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-confirm"),"folders-default":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-default"),"folders-input-new":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-input-new"),"folders-add-case":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-add-case"),"folders-elements-node":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-element-node"),"folders-query-edit":bizagi.getTemplate("bizagi.workportal.desktop.widget.folders").concat("#ui-bizagi-workportal-widget-folders-edit"),useNewEngine:!1})},renderContent:function(){var e=this.getTemplate("folders");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.smartfolders",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_FOLDERS},init:function(e,t,i){this._super(e,t,i),this.loadTemplates({smartfolders:bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders"),"smartfolders-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-elements"),"smartfolders-empty-elements":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-empty-elements"),"smartfolders-query-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-confirm"),"smartfolders-default":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-default"),"smartfolders-add-case":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-add-case"),"smartfolders-elements-node":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-element-node"),"smartfolders-query-tree":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-query-tree"),"smartfolders-query-edit":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-edit"),"smartfolders-input-new":bizagi.getTemplate("bizagi.workportal.desktop.widget.smartfolders").concat("#ui-bizagi-workportal-widget-smartfolders-input-new"),useNewEngine:!1})},renderContent:function(){var e=this.getTemplate("smartfolders");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.folders.extend("bizagi.workportal.widgets.folders",{},{postRender:function(){this.params.options.onlyFolderMode=this.params.options.onlyFolderMode||!1,this.configureTreeNavigation(),this.configureBackButton(),this.renderFolders(this.params.options.onlyFolderMode?"-1":""),this.scrollVertical({autohide:!1})},renderDefaultFolders:function(){var e=this.getContent(),t=this.getTemplate("folders-default"),i=$("#queries",e);i.empty(),$.tmpl(t).appendTo(i)},renderFolders:function(e,t){var i,a,o=this,r=o.getContent(),s=null!=o.params.options.onlyFolderMode&&o.params.options.onlyFolderMode?o.getTemplate("folders-add-case"):o.getTemplate("folders-elements"),n=o.getTemplate("folders-empty-elements"),l=$("#queries",r),c={};e=e||"",$.when(o.dataService.getFolders(e)).done((function(r){l.empty(),r=r||void 0;var d="";try{null!=r.folders&&r.folders.length>0&&(d=r.folders[0].idParent)}catch(e){}null!=r.folders&&""!=r.folders?(a=null!=t?{folders:null!=r?t.concat(r.folders):t}:r,$.each(a.folders,(function(e,t){null!=t&&null!=t.childs.folders?a.folders[e].countChilds=a.folders[e].childs.folders.length:a.folders[e].countChilds=0})),""==e||o.params.options.onlyFolderMode?c=a:c.folders=a.folders.concat({name:o.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:d,childs:[],categoryWithLink:"true",countChilds:0}),i=$.tmpl(s,c)):o.params.options.onlyFolderMode?i=$.tmpl(n):(c.folders=[{name:o.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:d,childs:[],categoryWithLink:"true",countChilds:0}],i=$.tmpl(s,c)),i.appendTo(l),o.configureNavTree(l)}))},configureNavTree:function(e){var t=this,i=t.getTemplate("folders-query-confirm");$("li","#queries").click((function(e){e.stopPropagation();var i=$(this).data("id"),a=$(this).data("childslength"),o=$(this).data("name"),r=$(this).data("urlparameters"),s=$(this).data("idparent"),n=t.getTemplate("folders-query-tree"),l=$("#categoryTree"),c=$(".queriesListDisplay li");0==a&&t.params.options.onlyFolderMode||("-1"==i?($.tmpl(n,{idParentQuery:-1,queryDisplayName:o}).appendTo(l),t.configureTreeNavigation(s),t.renderFolders(i)):"newFolder"==i?t.makeFolder({listElements:c,idParent:s}):a>0?($.tmpl(n,{idParentQuery:i,queryDisplayName:o}).appendTo(l),t.configureTreeNavigation(s),t.renderFolders(i,t.params.options.onlyFolderMode?[]:[{name:o,id:i,idParent:"",childs:[],categoryWithLink:!0,urlParameters:r}])):(bizagi.workportal.desktop.popup.closePopupInstance(),0==a&&r&&$.when(t.dataService.getCasesByFolder(r)).done((function(e){bizagi.lstIdCases=e.lstIdCases,bizagi.referrerParams=bizagi.referrerParams||{},bizagi.referrerParams.radNumber="",bizagi.referrerParams.page="",bizagi.referrerParams.referrer="folders",bizagi.referrerParams.urlParameters=r,bizagi.referrerParams.name=o,bizagi.referrerParams.id=i,e.customized=!0,e.urlParameters=r,e.title=o,e.casesGroupedByFolder=!0,e.idFolder=i,t.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SEARCH,data:e,referrerParams:{}})}))))})),$(".addButton","#queries").click((function(e){e.stopPropagation();var i=$(".queriesListDisplay li"),a=$(this).data("id"),o=$(this).data("idparent");t.makeFolder({listElements:i,idParent:a,beforeElement:$(this).parent(),style:"newSubFolder",idParentDone:o})})),$(".editButton","#queries").click((function(e){e.stopPropagation(),t.editFolder($(this).parent())})),$(".deleteButton","#queries").click((function(e){e.stopPropagation();var a=$.tmpl(i),o=$(this).data("id"),r=$(this).data("idparent");$(a).dialog({resizable:!0,modal:!0,title:t.getResource("workportal-widget-queries-confirm-title"),buttons:[{text:t.getResource("workportal-widget-queries-confirm-delete"),click:function(){t.dataService.deleteFolder({idCustomFolder:o}),$(this).dialog("close"),t.renderFolders(r)}},{text:t.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]})})),$(".addIco","#queries").click((function(e){e.stopPropagation();var i=$(this),a=i.parent(),o=i.data("id");i.addClass("wait"),$.when(t.dataService.associateCaseToFolder({idCustomFolder:o,idCase:t.params.options.idCase})).done((function(e){""==e.message?bizagi.workportal.desktop.popup.closePopupInstance():(i.removeClass("wait"),""==$(".errorMessage",a).text()&&(a.append($("<div class='errorMessage'></div>").html(e.message)),setTimeout((function(){$(".errorMessage",a).hide("blind","slow",(function(){$(this).remove()}))}),5e3)))}))}))},configureBackButton:function(){var e=this,t=e.getContent(),i=$("#bt-back",t),a=$("#categoryTree",t);i.click((function(){if($("li",a).length>1){$("li:last-child",a).remove();var t=$("li:last-child").children("#idParent").val();e.renderFolders(t)}}))},makeFolder:function(e){var t=this,i=e.template||t.getTemplate("folders-input-new");e.beforeElement=null!=e.beforeElement&&e.beforeElement.length>=1?e.beforeElement:e.listElements;var a=$.tmpl(i,{name:"",idParent:e.idParent,style:e.style}).insertAfter(1==e.beforeElement.length?e.beforeElement:e.beforeElement.last().prev());$(".newInput",a).focus(),$(".checkico",a).click((function(){var i=$(".newInput",a).val(),o=$(this).parent();$.when(t.checkRepeatFolderName({parent:o,options:e,folderName:i})).done((function(a){a?$.when(t.dataService.makeFolder({idParentFolder:e.idParent,folderName:i})).done((function(i){t.renderFolders(e.idParentDone||e.idParent)})):(o.append($("<div class='errorMessage'></div>").html(t.getResource("workportal-widget-folders-name-repeated"))),setTimeout((function(){$(".errorMessage",o).hide("blind","slow",(function(){$(".errorMessage",o).remove()}))}),5e3))}))})),$(".newInput",a).bind("keypress",(function(e){13==e.keyCode&&$(".checkico",a).click()}))},checkRepeatFolderName:function(e){var t=new $.Deferred,i=!0;return(e=e||{}).parent.hasClass("newSubFolder")?$.when(this.dataService.getFolders(e.options.idParent)).done((function(a){null!=a.folders&&$.each(a.folders,(function(a,o){null!=o.name&&e.folderName==o.name&&(i=!1,t.resolve(i))})),t.resolve(i)})):($(".queriesListDisplay li").not(":last-child").each((function(){e.folderName==$(this).data("name")&&(i=!1)})),t.resolve(i)),t.promise()},editFolder:function(e){var t=this,i=$(e).data("idparent"),a=$(e).find("h3").html(),o=$(e).data("id"),r=t.getTemplate("folders-input-new"),s=$.tmpl(r,{name:a,idParent:i});e.replaceWith(s),$(".newInput",s).focus(),$(".checkico",s).click((function(){var e=$(".newInput",s).val();$.when(t.dataService.updateFolder({idFolder:o,folderName:e})).done((function(e){t.renderFolders(i)}))})),$(".newInput",s).bind("keypress",(function(e){13==e.keyCode&&$(".checkico",s).click()}))},configureTreeNavigation:function(e){var t=this,i=t.getContent(),a=$("#categoryTree",i);$("li:last-child",a).click((function(){e=e||$(this).children("#idParent").val(),t.params.options.onlyFolderMode&&""==e&&t.renderFolders(-1),$(this).nextAll().remove(),t.renderFolders(e)}))},scrollVertical:function(){var e=this.getContent();$("#queries",e).bizagiScrollbar({autohide:!1})},showQueryFormPopup:function(e){var t=e.idQuery||"",i=e.idStoredQuery||"",a=e.queryFormAction||"",o=e.title||"";"queryform"!=this.currentPopup?(this.currentPopup="queryform",this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,idQueryForm:t,idStoredQuery:i,queryFormAction:a,modalParameters:{title:o}})):bizagi.workportal.desktop.popup.closePopupInstance()}}),bizagi.workportal.widgets.smartfolders.extend("bizagi.workportal.widgets.smartfolders",{},{postRender:function(){this.params.options=this.params.options||{},this.params.options.onlyFolderMode=this.params.options.onlyFolderMode||!1,this.configureTreeNavigation(),this.configureBackButton(),this.renderFolders(this.params.options.onlyFolderMode?"-1":""),this.scrollVertical({autohide:!1})},renderDefaultFolders:function(){var e=this.getContent(),t=this.getTemplate("smartfolders-default"),i=$("#queries",e);i.empty(),$.tmpl(t).appendTo(i)},renderFolders:function(e,t){var i,a,o=this,r=o.getContent(),s=null!=o.params.options.onlyFolderMode&&o.params.options.onlyFolderMode?o.getTemplate("smartfolders-add-case"):o.getTemplate("smartfolders-elements"),n=o.getTemplate("smartfolders-empty-elements"),l=$("#queries",r),c={};e=e||"",$.when(o.dataService.getSmartFolders(e)).done((function(e){l.empty(),e=e||void 0;var r="";try{null!=e.folders&&e.folders.length>0&&(r=e.folders[0].idParent)}catch(e){}null!=e.folders&&""!=e.folders?(a=null!=t?{folders:null!=e?t.concat(e.folders):t}:e,$.each(a.folders,(function(e,t){null!=t&&null!=t.childs.folders?a.folders[e].countChilds=a.folders[e].childs.folders.length:a.folders[e].countChilds=0})),o.params.options.onlyFolderMode?c=a:c.folders=a.folders.concat({name:o.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:r,childs:[],categoryWithLink:"true",countChilds:0}),i=$.tmpl(s,c)):o.params.options.onlyFolderMode?i=$.tmpl(n):(c.folders=[{name:o.getResource("workportal-widget-folders-new"),id:"newFolder",idParent:r,childs:[],categoryWithLink:"true",countChilds:0}],i=$.tmpl(s,c)),i.appendTo(l),o.configureNavTree()}))},configureNavTree:function(){var e=this,t=e.getTemplate("smartfolders-query-confirm");$("li","#queries").click((function(t){t.stopPropagation();var i=$(this).data("id"),a=$(this).data("childslength"),o=$(this).data("name"),r=$(this).data("urlparameters"),s=$(this).data("idparent"),n=$(".queriesListDisplay li");if(0!=a||!e.params.options.onlyFolderMode)if("-1"==i)e.configureTreeNavigation(s),e.renderFolders(i);else if("newFolder"==i)e.makeFolder({listElements:n,idParent:s});else if(a>0)e.configureTreeNavigation(s),e.renderFolders(i,e.params.options.onlyFolderMode?[]:[{name:o,id:i,idParent:"",childs:[],categoryWithLink:!0,urlParameters:r}]);else{var l;if(bizagi.workportal.desktop.popup.closePopupInstance(),0==a&&r)if(bizagi.override.viewSmartFoldersAsSearch)$.when(e.dataService.getCustomizedColumnsData({smartfoldersParameters:r})).done((function(t){bizagi.lstIdCases=t.lstIdCases,bizagi.referrerParams=bizagi.referrerParams||{},bizagi.referrerParams.radNumber="",bizagi.referrerParams.page="",bizagi.referrerParams.referrer="folders",bizagi.referrerParams.urlParameters=r,bizagi.referrerParams.name=o,bizagi.referrerParams.id=i,t.customized=!0,t.urlParameters=r,t.title=o,t.casesGroupedByFolder=!0,t.idFolder=i,e.publish("changeWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_SEARCH,data:t,referrerParams:{}})}));else bizagi.referrerParams=bizagi.referrerParams||{},"inboxgrid"==e.params.options.foldersView?(l=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID,bizagi.referrerParams={urlParameters:r,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID}):(l=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX,bizagi.referrerParams={urlParameters:r,referrer:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX}),e.publish("changeWidget",{widgetName:l,smartfoldersParameters:{urlParameters:r},referrerParams:{}})}})),$(".editButton","#queries").click((function(t){t.stopPropagation(),e.editFolder($(this).parent())})),$(".deleteButton","#queries").click((function(i){i.stopPropagation();var a=$.tmpl(t),o=$(this).data("id"),r=$(this).data("idparent");$(a).dialog({resizable:!0,modal:!0,title:e.getResource("workportal-widget-queries-confirm-title"),buttons:[{text:e.getResource("workportal-widget-queries-confirm-delete"),click:function(){e.dataService.deleteSmartFolder({idSmartFolder:o,idUser:bizagi.currentUser.idUser||0}),$(this).dialog("close"),e.renderFolders(r)}},{text:e.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("close")}}]})}))},configureBackButton:function(){var e=this,t=e.getContent(),i=$("#bt-back",t),a=$("#categoryTree",t);i.click((function(){if($("li",a).length>1){$("li:last-child",a).remove();var t=$("li:last-child").children("#idParent").val();e.renderFolders(t)}}))},makeFolder:function(){var e=this.dataService.getUrl({endPoint:"smartfolders-integration"})+"?ParentQueryId=-1";this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:e,modalParameters:{title:this.getResource("workportal-widget-folders-new"),width:"1020px"}})},editFolder:function(e){var t=$(e).find("h3").html(),i=$(e).data("id"),a=this.dataService.getUrl({endPoint:"smartfolders-integration"})+"?iQueryFormId="+i;this.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,widgetURL:a,modalParameters:{title:t,width:"1020px"}})},configureTreeNavigation:function(e){var t=this,i=t.getContent(),a=$("#categoryTree",i);$("li:last-child",a).click((function(){e=e||$(this).children("#idParent").val(),t.params.options.onlyFolderMode&&""==e&&t.renderFolders(-1),$(this).nextAll().remove(),t.renderFolders(e)}))},scrollVertical:function(){var e=this.getContent();$("#queries",e).bizagiScrollbar({autohide:!1})}}),$.Class.extend("bizagi.workportal.results.per.page",{},{init:function(e){this.bizagiConfigProperty=e},initCombo:function(){var e={combo:[],id:"numberRows"},t=Array(10,20,30,40,50,100);return this.bizagiConfigProperty&&-1==t.indexOf(this.bizagiConfigProperty)&&(t.push(this.bizagiConfigProperty),t.sort((function(e,t){return e-t}))),t.map((function(t){e.combo.push({id:t,name:t})})),e},_findValue:function(e,t){var i=!1;return e.map((function(e){e.id==t&&(i=e)})),i},initialValueCombo:function(e){var t=e.comboDataSource.combo[0],i=e.getRowValue();if(i||this.bizagiConfigProperty){var a=i&&!1!==this._findValue(e.comboDataSource.combo,i)?i:this.bizagiConfigProperty;a&&(t=this._findValue(e.comboDataSource.combo,a))}return t},renderNumberRowsCombo:function(e){var t=$.Deferred();e.comboWrapper.empty();var i=this.initialValueCombo({comboDataSource:e.combo,getRowValue:e.getRowValue}),a=i.id;return e.comboWrapper.uicombo({isEditable:!1,data:e.combo,itemValue:function(e){return e.id},itemText:function(e){return e.name},onComplete:function(){t.resolve()},onChange:function(t){var i=t.ui.data("value");i!=a&&(a=i,e.setRowValue(i),e.onChange())},initValue:i}),t}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.quickActions",{CLASS_ACTIVE_MORE_BUTTON:"active",SELECTOR_NUMBER_SELECTED:"#ui-bizagi-workportal-widget-quick-actions-details > .quick-actions-details-activities-selected",SELECTOR_BUTTONS_CONTAINER:"#ui-bizagi-workportal-widget-quick-actions-buttons",SELECTOR_BUTTON_LAUNCH:"button.quick-actions-details-button-launch",SELECTOR_SUMMARY_EXECUTED_ACTIONS:".summary-quick-actions-executed",SELECTOR_HIDDEN_BUTTON_LAUNCH:"div.quick-actions-details-button-launch-hidden",SELECTOR_MORE_BUTTON:"button#quick-actions-details-more-button",SELECTOR_HIDDEN_BUTTONS_CONTAINER:"div#quick-actions-details-buttons-hidden-container",SELECTOR_INBOX_GRID_TITLE:"div#contentInboxName",DATA_PROPERTIES:{TOTAL_SELECTED:"TOTAL_SELECTED",SHOW:"SHOW",BUTTONS:"BUTTONS",BUTTONS_TO_SHOW:"BUTTONS_TO_SHOW",BUTTONS_HIDDEN:"BUTTONS_HIDDEN",WIDTH_BUTTONS_CONTAINER:"WIDTH_BUTTONS_CONTAINER",SHOW_MORE_BUTTON:"SHOW_MORE_BUTTON",SHOW_HIDDEN_BUTTONS:"SHOW_HIDDEN_BUTTONS"}},{init:function(e,t,i){var a={callback:this.callbackCheckboxGroup.bind(this),getContainerSelector:i.getContainerSelector,checkAllSelector:i.checkAllSelector};this._super(e,t,i),this.checkboxGroup=new bizagi.workportal.widgets.checkboxGroup(this.workportalFacade,this.dataService,a),this.checkboxGroup.render({}),this.params={refreshShowedResults:i.refreshShowedResults},this.loadTemplates({"quick-actions-container":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActions").concat("#ui-bizagi-workportal-widget-quick-actions"),"quick-actions-button":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActions").concat("#ui-bizagi-workportal-widget-quick-actions-button"),"quick-actions-modal-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActions").concat("#ui-bizagi-workportal-widget-quick-actions-modal-confirm"),"quick-actions-more-button":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActions").concat("#ui-bizagi-workportal-widget-quick-actions-more-button"),"quick-actions-button-hidden":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActions").concat("#ui-bizagi-workportal-widget-quick-actions-button-hidden"),useNewEngine:!1}),this._setInitialData(),this.setPersistCheckboxGroup(!1)},renderContent:function(){var e=this.getTemplate("quick-actions-container");(this.content=$.tmpl(e,{})).appendTo(this.container),this._events()},renderIn:function(e){this.container=e,this.render()},postRender:function(){this._updateView()},setPersistCheckboxGroup:function(e){this.persistCheckboxGroup=e},setDataToExecute:function(e,t){this.itemsInfo=e,this.setAvailableButtons(t)},callbackCheckboxGroup:function(){this.itemsSelected=this.checkboxGroup.getChecked(),this._updateButtonsToShow(),this._setItemsSelected(this.itemsSelected.length)},_updateButtonsToShow:function(){var e=this.getButtonsToShow();this._showCurrentButtons(e)},getButtonsToShow:function(){var e=[];_labels=Object.keys(this.quickActionsPerName);for(var t=0;t<_labels.length;t++){var i=_labels[t],a=this.quickActionsPerName[i];this._shouldShowButton(a)&&e.push(i)}return e},_shouldShowButton:function(e){for(var t=this,i=t.itemsSelected.length>0,a=function(e){var i=t.itemsSelected[o].id,a=t.itemsInfo[i].idTask;return e.idTask===a},o=0;o<t.itemsSelected.length&&i;o++)e.some(a)||(i=!1);return i},_showCurrentButtons:function(e){var t=e.map((function(e){return{id:e,text:e}}));this._addButtons(t)},renderCheckboxGroup:function(e){var t=this._filterItemsToShowCheckbox();this.checkboxGroup.renderCheckboxGroup(e,t,this.persistCheckboxGroup),this.setPersistCheckboxGroup(!1)},_filterItemsToShowCheckbox:function(){var e=[];_workItems=Object.keys(this.itemsInfo);for(var t=0;t<_workItems.length;t++){var i=this.itemsInfo[_workItems[t]];-1!==this.idTasksWithQuickActions.indexOf(i.idTask)&&e.push(i.idWorkItem)}return e},setAvailableButtons:function(e){this.quickActionsPerName={},this.idTasksWithQuickActions=[];for(var t=0;e&&t<e.length;t++){var i=e[t].label;this.quickActionsPerName[i]||(this.quickActionsPerName[i]=[]),this.quickActionsPerName[i].push(e[t]),this.addItemToShowCheckbox(e[t].idTask)}},addItemToShowCheckbox:function(e){-1===this.idTasksWithQuickActions.indexOf(e)&&this.idTasksWithQuickActions.push(e)},_renderButton:function(e,t,i){var a=i?"quick-actions-button-hidden":"quick-actions-button",o=this.getTemplate(a),r={text:t,id:e};return $.tmpl(o,r)},_renderMoreButton:function(){var e=this.getTemplate("quick-actions-more-button");return $.tmpl(e,{})},_events:function(e){!0===e?(this.content.off("click",this.Class.SELECTOR_BUTTON_LAUNCH),this.content.off("click",this.Class.SELECTOR_HIDDEN_BUTTON_LAUNCH),this.content.off("click",this.Class.SELECTOR_MORE_BUTTON),this.unsubscribe("resizeLayout")):(this.content.on("click",this.Class.SELECTOR_BUTTON_LAUNCH,this._clickOnAction.bind(this)),this.content.on("click",this.Class.SELECTOR_HIDDEN_BUTTON_LAUNCH,this._clickOnAction.bind(this)),this.content.on("click",this.Class.SELECTOR_MORE_BUTTON,this._clickOnMore.bind(this)),this.subscribe("resizeLayout",this._adjustButtonsWidth.bind(this)))},_clickOnAction:function(e){var t=this,i=t.Class.DATA_PROPERTIES,a=e.currentTarget.textContent,o=t._getNumberOfSelected();_textToShow=bizagi.localization.getResourceByElementsNumber("workportal-quick-actions-confirm-execute-detail",o).replace("{0}",o),_message=$.tmpl(t.getTemplate("quick-actions-modal-confirm"),{numberActivities:_textToShow}).html(),_modalParams=t._buildParamsForModalConfirm(a,_message),_buttonClicked=e.target.id,t._setProperty(i.SHOW_HIDDEN_BUTTONS,!1),$.when(bizagi.showConfirmationBox.apply(t,_modalParams)).done((function(){var e=t.setInitialDataForModal(_buttonClicked);t.showResultDialog(a,e)}))},setInitialDataForModal:function(e){for(var t={activities:[]},i=this.quickActionsPerName[e],a=0;a<this.itemsSelected.length;a++)for(var o=this.itemsSelected[a].id,r=this.itemsInfo[o],s=0;s<i.length;s++){var n=i[s];if(r.idTask===n.idTask){var l={workItemId:r.idWorkItem,taskId:r.idTask,activityName:r.TaskName,caseNumber:r.caseNumber,caseId:r.idCase,icon:"gray",quickActionGuid:n.guid,ruleGuid:n.guidRule,actions:n.actions};t.activities.push(l)}}return t},itemIsChecked:function(e){return this.itemsSelected.some((function(t){return t.id===e}))},_buildParamsForModalConfirm:function(e,t){return[t,e,!1,[{label:bizagi.localization.getResource("workportal-general-word-no"),action:"reject",class:"biz-wp-btn-secondary-real"},{label:bizagi.localization.getResource("workportal-general-word-yes"),action:"resolve",class:"biz-wp-btn-warning"}],{dialogClass:"ui-quick-action-modal-confirm",width:500}]},_clickOnMore:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.SHOW_HIDDEN_BUTTONS);this._setProperty(e.SHOW_HIDDEN_BUTTONS,!t)},_setProperty:function(e,t,i){var a=void 0!==i&&i,o=this.Class.DATA_PROPERTIES[e],r=this.data[o]!==t,s=!a&&r;if(void 0===o)throw"Property does not exist: "+e;this.data[o]=t,s&&this._updateView()},_getProperty:function(e){var t=this.Class.DATA_PROPERTIES[e],i=this.data[t],a=Array.isArray(i)?[]:{};if(void 0===t)throw"Property does not exist: "+e;return"object"===_typeof(i)&&(i=jQuery.extend(a,i)),i},_setInitialData:function(){var e=this.Class.DATA_PROPERTIES;this.data={},this.data[e.TOTAL_SELECTED]=0,this.data[e.SHOW]=!1,this.data[e.BUTTONS]=[],this.data[e.BUTTONS_TO_SHOW]=[],this.data[e.BUTTONS_HIDDEN]=[],this.data[e.WIDTH_BUTTONS_CONTAINER]=0,this.data[e.SHOW_MORE_BUTTON]=!1,this.data[e.SHOW_HIDDEN_BUTTONS]=!1},_updateViewSelected:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.TOTAL_SELECTED),i=this.content.find(this.Class.SELECTOR_NUMBER_SELECTED);_textToShow=bizagi.localization.getResourceByElementsNumber("workportal-quick-actions-selected-activities",t).replace("{0}",t),i.text(_textToShow)},_adjustButtonsWidth:function(){var e=this,t=e.Class.DATA_PROPERTIES,i=e.content.find(e.Class.SELECTOR_BUTTONS_CONTAINER),a=e.content.find(e.Class.SELECTOR_BUTTON_LAUNCH+":first"),o=e._getProperty(t.BUTTONS),r=e._getProperty(t.BUTTONS_TO_SHOW),s=e._getProperty(t.BUTTONS_HIDDEN),n=e._getProperty(t.WIDTH_BUTTONS_CONTAINER),l=i.outerWidth(),c=n!==l,d=1.5*a.outerHeight()<i.outerHeight(),p=r.length>0,u=r.slice(-1),m=r.slice(0,-1),g=c?[]:u.concat(s);c?(e._setProperty(t.SHOW_MORE_BUTTON,!1,!0),e._setProperty(t.SHOW_HIDDEN_BUTTONS,!1,!0),e._setProperty(t.BUTTONS_HIDDEN,g,!0),e._setProperty(t.WIDTH_BUTTONS_CONTAINER,l,!0),e._setProperty(t.BUTTONS_TO_SHOW,o)):d&&p&&(e._setProperty(t.SHOW_MORE_BUTTON,!0,!0),e._setProperty(t.BUTTONS_HIDDEN,g,!0),e._setProperty(t.BUTTONS_TO_SHOW,m))},_updateViewButtons:function(){var e=this,t=e.Class.DATA_PROPERTIES,i=e._getProperty(t.BUTTONS_TO_SHOW),a=e._getProperty(t.BUTTONS_HIDDEN),o=e._renderMoreButton(),r=e.content.find(e.Class.SELECTOR_BUTTONS_CONTAINER),s=o.find(e.Class.SELECTOR_HIDDEN_BUTTONS_CONTAINER),n=function(t,i,a){e._renderButton(a.id,a.text,t).appendTo(i)};r.empty(),i.map(n.bind(null,!1,r)),o.appendTo(r),a.map(n.bind(null,!0,s)),e._adjustButtonsWidth()},_updateViewMoreButton:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.SHOW_MORE_BUTTON),i=this._getProperty(e.SHOW_HIDDEN_BUTTONS),a=this.content.find(this.Class.SELECTOR_MORE_BUTTON);a.toggleClass(this.Class.CLASS_ACTIVE_MORE_BUTTON,i),t?a.show():a.hide()},_updateViewContainer:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.SHOW),i=this.content,a=$(this.Class.SELECTOR_INBOX_GRID_TITLE);t?i.css("display","grid"):i.css("display","none"),t?a.css("display","none"):a.css("display","inline-block")},_updateViewHiddenButtons:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.SHOW_HIDDEN_BUTTONS),i=this.content.find(this.Class.SELECTOR_HIDDEN_BUTTONS_CONTAINER);t?i.show():i.hide()},_updateView:function(){this._updateViewContainer(),this._updateViewSelected(),this._updateViewButtons(),this._updateViewMoreButton(),this._updateViewHiddenButtons()},_setItemsSelected:function(e){var t=this.Class.DATA_PROPERTIES,i="number"==typeof e?e:0,a=this._getProperty(t.BUTTONS),o=e>0&&a.length>0;this._setProperty(t.SHOW,o,!0),this._setProperty(t.TOTAL_SELECTED,i)},_getNumberOfSelected:function(){var e=this.Class.DATA_PROPERTIES;return this._getProperty(e.TOTAL_SELECTED)},_addButtons:function(e){var t=this.Class.DATA_PROPERTIES;this._setProperty(t.SHOW_MORE_BUTTON,!1,!0),this._setProperty(t.BUTTONS_HIDDEN,[],!0),this._setProperty(t.BUTTONS_TO_SHOW,e,!0),this._setProperty(t.BUTTONS,e,!0)},showResultDialog:function(e,t){var i=this;bizagi.loader.start("entity-engine-view").then((function(){var a,o=$(document).triggerHandler("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUICKACTIONS_EXECUTE,data:t,dialogClass:"ui-quick-action-modal-confirm",modalParameters:{title:e,width:"900px"},maximizeOnly:!1,buttons:[{text:bizagi.localization.getResource("workportal-quick-actions-stop-all"),click:function(){a.showStopConfirmModal()},class:"biz-wp-btn-secondary-real btn-stop-all"}],closeOnEscape:!1,closeVisible:!0,onClose:function(){i.params.refreshShowedResults()}});$.when(o.getRenderWidget()).done((function(e){(a=e).registerDialog(o),$(i.Class.SELECTOR_SUMMARY_EXECUTED_ACTIONS).prependTo(".ui-quick-action-modal-confirm .ui-dialog-buttonpane .ui-dialog-buttonset")}))}))},dispose:function(){this._super(),this._events(!0)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.quickActionsExecute",{SELECTOR_BUTTON_STOP_ALL:".ui-dialog.ui-quick-action-modal-confirm button.btn-stop-all",SELECTOR_BUTTON_CLOSE:".ui-dialog.ui-quick-action-modal-confirm button.bz-dialog-btn-close",SELECTOR_SUMMARY_EXECUTED_ACTIONS:".summary-quick-actions-executed",SELECTOR_ONE_RESULT:"div[collapsibleitem][id={0}]",TYPE_ROW_DEFAULT:"TYPE_ROW_DEFAULT",TYPE_ROW_ONLY_DEFAULT_TEXT:"TYPE_ROW_ONLY_DEFAULT_TEXT",TYPE_ROW_ONLY_ERROR_TEXT:"TYPE_ROW_ONLY_ERROR_TEXT",DATA_PROPERTIES:{ACTIVITIES:"ACTIVITIES",END_ALL_REQUESTS:"END_ALL_REQUESTS",STOP_BY_USER:"STOP_BY_USER",NUMBER_EXECUTED_ACTIONS:"NUMBER_EXECUTED_ACTIONS",DIALOG:"DIALOG"},RESULT_SUCCESS:"success",RESULT_EXECUTED:"executed",RESULT_WARNING:"warning",RESULT_ERROR:"error"},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"quickActions-execute":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActionsExecute").concat("#ui-bizagi-workportal-widget-quickActions-execute"),"quick-actions-stop-all-modal-confirm":bizagi.getTemplate("bizagi.workportal.desktop.widget.quickActionsExecute").concat("#ui-bizagi-workportal-widget-quick-actions-stop-all-modal-confirm"),useNewEngine:!1}),this._setInitialData(i.data.activities)},renderContent:function(){var e=this.getTemplate("quickActions-execute");return this.content=$.tmpl(e,{summaryText:this._getSummaryText()}),this.content},postRender:function(){var e=this,t=e.Class.DATA_PROPERTIES;e.requesterService=new bizagi.workportal.services.quickActionsRequester(e.dataService,{callback:function(t){e._processResponseOfExecuteQuickActions(t)}}),e._updateView(),e.requesterService.startAllRequests(e._getProperty(t.ACTIVITIES)),$(window).on("beforeunload",$.proxy(e._showDefaultWarningMessageBrowser,e)),e._configureHandlers()},_setProperty:function(e,t,i){var a=void 0!==i&&i,o=this.Class.DATA_PROPERTIES[e],r=this.data[o]!==t,s=!a&&r;if(void 0===o)throw"Property does not exist: "+e;this.data[o]=t,s&&this._updateView()},_getProperty:function(e){var t=this.Class.DATA_PROPERTIES[e],i=this.data[t],a=Array.isArray(i)?[]:{};if(void 0===t)throw"Property does not exist: "+e;return"object"===_typeof(i)&&(i=bizagi.util.extend(a,i)),i},_setInitialData:function(e){var t=this.Class.DATA_PROPERTIES;this.data={},this.data[t.END_ALL_REQUESTS]=!1,this.data[t.STOP_BY_USER]=!1,this.data[t.ACTIVITIES]=e,this.data[t.NUMBER_EXECUTED_ACTIONS]=0},_updateView:function(){this._updateViewSummaryExecutionActions()},_updateViewSummaryExecutionActions:function(){$(this.Class.SELECTOR_SUMMARY_EXECUTED_ACTIONS+" span").text(this._getSummaryText())},_getSummaryText:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.ACTIVITIES),i=this._getProperty(e.NUMBER_EXECUTED_ACTIONS);return bizagi.localization.getResourceByElementsNumber("workportal-quick-actions-summary-number-actions-executed",t.length).replace("{0}",i).replace("{1}",t.length)},_configureHandlers:function(){$(this.content).find(".filter-button").on("click",$.proxy(this._onClickFilterButton,this))},_onClickFilterButton:function(e){var t=e.target;t.correspondingUseElement&&(t=t.correspondingUseElement);var i=$(t).closest(".filter-button");i.addClass("selected").siblings().removeClass("selected");var a=i.attr("filter-by");this._showFilterResults(a)},_showFilterResults:function(e){var t=bizagi.localization.getResource("workportal-quick-actions-completed-actions"),i=bizagi.localization.getResource("workportal-widget-inboxcommon-no-results-found"),a=$(this.content).find(".filter-row."+e);if("all"===e)$(this.content).find(".filter-row").show(),$(".quickActionsContainer .default-text span").text(t);else{var o=0===a.length?i:t;$(this.content).find(".filter-row").hide(),a.show(),$(".quickActionsContainer .default-text span").text(o)}},_processResponseOfExecuteQuickActions:function(e){var t=this.Class.DATA_PROPERTIES,i=this._getProperty(t.ACTIVITIES);if("all"===e.type){this._setProperty(t.END_ALL_REQUESTS,!0),this._disableBtnStopAll();var a={title:bizagi.localization.getResource("workportal-quick-actions-completed-actions")};this._addRowToResultsWithType(a,this.Class.TYPE_ROW_ONLY_DEFAULT_TEXT)}else if("one-start"===e.type){var o=i.filter((function(t){return t.workItemId===e.response.paramsRequest.workItemId}))[0];a={workItemId:o.workItemId,activityName:o.activityName,caseNumber:o.caseNumber,details:o.details,icon:"gray",status:"inProcess"};this.instance=this._addRowToResultsWithType(a,this.Class.TYPE_ROW_DEFAULT)}else if("one-end"===e.type){this._setProperty(t.NUMBER_EXECUTED_ACTIONS,this._getProperty(t.NUMBER_EXECUTED_ACTIONS)+1);var r=this._getStatusByBackResponse(e.response.backResponse);this._setResultToActionRequest(e.response.paramsRequest.workItemId,r,this.instance)}else if("stop-by-user"===e.type){if(!this._getProperty(t.END_ALL_REQUESTS)){this._setProperty(t.STOP_BY_USER,!0);a={title:bizagi.localization.getResourceByElementsNumber("workportal-quick-actions-confirm-stop-all-message",e.response.numberSkipActions).replace("{0}",e.response.numberSkipActions)};this._addRowToResultsWithType(a,this.Class.TYPE_ROW_ONLY_ERROR_TEXT)}this._disableBtnStopAll()}this._getProperty(t.NUMBER_EXECUTED_ACTIONS)==this._getProperty(t.ACTIVITIES).length&&this._hideBtnStopAllAndShowClose()},_manageExecuteModalCloseButton:function(){var e=this.Class.DATA_PROPERTIES;return!(!this._getProperty(e.END_ALL_REQUESTS)&&!this._getProperty(e.STOP_BY_USER))||(this.showStopConfirmModal(),!1)},_showDefaultWarningMessageBrowser:function(){var e=this.Class.DATA_PROPERTIES;if(!this._getProperty(e.END_ALL_REQUESTS))return""},_buildParamsForModalConfirm:function(e,t,i){return[t,e,!1,[{label:bizagi.localization.getResource("workportal-general-word-no"),action:"reject",class:"biz-wp-btn-secondary-real"},{label:bizagi.localization.getResource("workportal-general-word-yes"),action:"resolve",class:"biz-wp-btn-warning"}],{dialogClass:"ui-quick-action-modal-confirm"}]},_disableBtnStopAll:function(){var e=$(document).find(this.Class.SELECTOR_BUTTON_STOP_ALL);$(e).prop("disabled",!0)},_hideBtnStopAllAndShowClose:function(){$(document).find(this.Class.SELECTOR_BUTTON_STOP_ALL).hide(),$(document).find(this.Class.SELECTOR_BUTTON_CLOSE).show()},showStopConfirmModal:function(){var e=this,t=(e.Class.DATA_PROPERTIES,$.tmpl(e.getTemplate("quick-actions-stop-all-modal-confirm")).html()),i=bizagi.localization.getResource("workportal-general-word-message"),a=e._buildParamsForModalConfirm(i,t);$.when(bizagi.showConfirmationBox.apply(e,a)).done((function(){e.requesterService.stopAllRequests()}))},_addRowToResultsWithType:function(e,t){var i=this,a={item:e,type:t},o=new bizagi.workportal.widgets.collapsible(i.workportalFacade,i.dataService,a);return o.getView().then((function(e){e.prependTo(i.content.find(".quickActionsContainer"))})),o},_changeProperties:function(e,t){e.setStatus(t.status),e.setIcon(t.icon),e.setDescription(t.description)},_getStatusByBackResponse:function(e){for(var t=this.Class.RESULT_SUCCESS,i="",a=0;a<e.length&&t===this.Class.RESULT_SUCCESS;a++)tag=e[a],tag.error?(t=this.Class.RESULT_ERROR,i=tag.error.message):tag.result.type!==this.Class.RESULT_SUCCESS&&(t=this.Class.RESULT_WARNING,i=tag.result.messages[0]);return 0===e.status&&(t=this.Class.RESULT_ERROR,i=e.statusText),this._getFinalDataResponse(t,i)},_getFinalDataResponse:function(e,t){return{status:e=e===this.Class.RESULT_SUCCESS?this.Class.RESULT_EXECUTED:e,icon:this._getIcon(e),description:t}},_getIcon:function(e){var t;switch(e){case"warning":t="yellow";break;case"error":t="red";break;case"executed":t="green";break;default:t="gray"}return t},_setResultToActionRequest:function(e,t,i){var a=t;this._changeProperties(i,a)},registerDialog:function(e){var t=this.Class.DATA_PROPERTIES;this._setProperty(t.DIALOG,e.dialogBox),e.dialogBox.bind("dialogbeforeclose",$.proxy(this._manageExecuteModalCloseButton,this))},dispose:function(){this._super(),$(window).off("beforeunload",$.proxy(this._showDefaultWarningMessageBrowser,this)),$(this.content).find(".filter-button").on("click",$.proxy(this._onClickFilterButton,this))}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.collapsible",{SELECTOR_TITLE:".collapsible-title",SELECTOR_SUBTITLE:".collapsible-subtitle",SELECTOR_STATUS:".collapsible-status",SELECTOR_ICON:"div.collapsible-icon > svg",SELECTOR_DESCRIPTION:".collapsible-description",SELECTOR_ARROW:" div.collapsible-arrow > i",SELECTOR_COLLAPSIBLE_LINK:".collapsible-link",SELECTOR_COLLAPSIBLE_DESCRIPTION:".collapsible-description",SELECTOR_COLLAPSIBLE_ITEM:"div[collapsibleItem]",RESULT_EXECUTED:"executed",RESULT_WARNING:"warning",RESULT_ERROR:"error",RESULT_IN_PROCESS:"inProcess",TYPE_ROW_DEFAULT:"TYPE_ROW_DEFAULT",TYPE_ROW_ONLY_DEFAULT_TEXT:"TYPE_ROW_ONLY_DEFAULT_TEXT",TYPE_ROW_ONLY_ERROR_TEXT:"TYPE_ROW_ONLY_ERROR_TEXT",DATA_PROPERTIES:{TYPE_ROW:"TYPE_ROW",ID:"ID",TITLE:"TITLE",SUBTITLE:"SUBTITLE",STATUS:"STATUS",ICON:"ICON",DESCRIPTION:"DESCRIPTION"}},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"quick-actions-items":bizagi.getTemplate("bizagi.workportal.desktop.widget.collapsible").concat("#ui-bizagi-workportal-widget-collapsible"),"quick-actions-item-only-default-text":bizagi.getTemplate("bizagi.workportal.desktop.widget.collapsible").concat("#ui-bizagi-workportal-widget-collapsible-only-default-text"),"quick-actions-item-only-error-text":bizagi.getTemplate("bizagi.workportal.desktop.widget.collapsible").concat("#ui-bizagi-workportal-widget-collapsible-only-error-text"),useNewEngine:!1}),this.rendered=new $.Deferred,this._setInitialData(i.item,i.type),this.render()},renderContent:function(){var e,t=this.Class.DATA_PROPERTIES;switch(this._getProperty(t.TYPE_ROW)){case this.Class.TYPE_ROW_ONLY_DEFAULT_TEXT:e=this.getTemplate("quick-actions-item-only-default-text");break;case this.Class.TYPE_ROW_ONLY_ERROR_TEXT:e=this.getTemplate("quick-actions-item-only-error-text");break;default:e=this.getTemplate("quick-actions-items")}this.content=$.tmpl(e,{}),this.rendered.resolve()},postRender:function(){this._updateView(),this._events()},_events:function(e){var t=this;!0===e?t.content.off("click",t.Class.SELECTOR_COLLAPSIBLE_LINK):t.content.on("click",t.Class.SELECTOR_COLLAPSIBLE_LINK,(function(){$(this).closest(t.Class.SELECTOR_COLLAPSIBLE_ITEM).find(t.Class.SELECTOR_COLLAPSIBLE_DESCRIPTION).slideToggle("slow");var e=$(this).find(t.Class.SELECTOR_ARROW);$(this).find(t.Class.SELECTOR_ARROW).hasClass("down")?(t._changeArrow(e,"up","down"),t._changeArrow(e.parent(),"up","down")):(t._changeArrow(e,"down","up"),t._changeArrow(e.parent(),"down","up"))}))},_changeArrow:function(e,t,i){e.addClass(t),e.removeClass(i)},_setProperty:function(e,t,i){var a=void 0!==i&&i,o=this.Class.DATA_PROPERTIES[e],r=this.data[o]!==t,s=!a&&r;if(void 0===o)throw"Property does not exist: "+e;this.data[o]=t,s&&this._updateView()},_getProperty:function(e){var t=this.Class.DATA_PROPERTIES[e],i=this.data[t],a=Array.isArray(i)?[]:{};if(void 0===t)throw"Property does not exist: "+e;return"object"===_typeof(i)&&(i=jQuery.extend(a,i)),i},_setInitialData:function(e,t){var i=this.Class.DATA_PROPERTIES;this.data={},this.data[i.ID]=e.workItemId,this.data[i.TITLE]=e.activityName||e.title,this.data[i.SUBTITLE]=e.caseNumber,this.data[i.STATUS]=e.status,this.data[i.DESCRIPTION]=e.details,this.data[i.ICON]=e.icon,this.data[i.TYPE_ROW]=t||this.Class.TYPE_ROW_DEFAULT},_setId:function(){var e=this.Class.DATA_PROPERTIES;$(this.content).prop("id",this._getProperty(e.ID))},setStatus:function(e){var t=e,i="",a=this.content.find(this.Class.SELECTOR_STATUS),o=this.content.find(this.Class.SELECTOR_ARROW);switch(a.show(),t){case this.Class.RESULT_IN_PROCESS:i=bizagi.localization.getResource("workportal-general-word-in-process"),a.text(i+"...");break;case this.Class.RESULT_EXECUTED:a.text(""),$(this.content).addClass("filter-row"),$(this.content).addClass(this.Class.RESULT_EXECUTED);break;case this.Class.RESULT_WARNING:i=bizagi.localization.getResource("workportal-general-word-details"),a.text(i),o.addClass("down"),$(this.content).addClass("filter-row"),$(this.content).addClass(this.Class.RESULT_WARNING);break;case this.Class.RESULT_ERROR:i=bizagi.localization.getResource("workportal-general-word-details"),a.text(i),o.addClass("down"),$(this.content).addClass("filter-row"),$(this.content).addClass(this.Class.RESULT_ERROR);break;default:a.hide()}},setIcon:function(e){var t=this.content.find(this.Class.SELECTOR_ICON);t.hide(),this.content.find(t.selector+"."+e).show()},setDescription:function(e){this.content.find(this.Class.SELECTOR_DESCRIPTION).text(e)},_updateViewAll:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.TITLE),i=this._getProperty(e.SUBTITLE),a=this._getProperty(e.DESCRIPTION),o=this._getProperty(e.STATUS),r=this._getProperty(e.ICON),s=this.content.find(this.Class.SELECTOR_TITLE);_selectorSubtitle=this.content.find(this.Class.SELECTOR_SUBTITLE),_selectorDescription=this.content.find(this.Class.SELECTOR_DESCRIPTION),s.text(t),_selectorSubtitle.text(i),_selectorDescription.hide(),this._setId(),this.setStatus(o),this.setIcon(r),this.setDescription(a)},getView:function(){var e=this,t=new $.Deferred;return e.rendered.then((function(){t.resolve(e.getContent())})),t},_updateView:function(){this._updateViewAll()},dispose:function(){this._events(!0),this._super()}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.checkboxGroup",{CHECKBOX_CLASS:".quick-actions-checkbox",CHECKBOX_CHECKED_CLASS:".quick-actions-checkbox-checked",DATA_PROPERTIES:{CHECK_ALL:"CHECK_ALL"}},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"quick-actions-checkbox":bizagi.getTemplate("bizagi.workportal.desktop.widget.checkboxGroup").concat("#ui-bizagi-quickActions-checkbox"),useNewEngine:!1}),this._CHECK_ALL_CHECKBOX_CONTAINER=i.checkAllSelector,this._CHECK_ALL_CHECKBOX=i.checkAllSelector+" div",this._getContainerSelector=i.getContainerSelector,this._onItemsCheckedChange=i.callback,this.checkedItems=[],this._setInitialData()},postRender:function(){var e=this.getTemplate("quick-actions-checkbox");this.checkboxContent=$.tmpl(e,{})},getChecked:function(){return this.checkedItems},renderCheckboxGroup:function(e,t,i){this._items=t,this._context=e;for(var a=0;a<this._items.length;a++)this._renderCheckbox(this._items[a]);this._configureCheckAllCheckbox(),this.loadStoredItems(i)},loadStoredItems:function(e){if(this.checkedItems.length>0&&e){for(var t=[],i=0;i<this.checkedItems.length;i++){var a=this.checkedItems[i],o=this._getContainerSelector(a.id)+" div",r=$(o,this._context);0!==r.length&&(r.toggleClass(this.Class.CHECKBOX_CHECKED_CLASS.substr(1),!0),t.push(a))}this.checkedItems=t,this._refreshCheckAllCheckbox(!0),this._onItemsCheckedChange(),this._updateView()}else this.clearCheckedItems()},clearCheckedItems:function(){this.checkedItems=[],this._toggleCheckAllCheckbox(!1)},_renderCheckbox:function(e){var t=this,i=t._getContainerSelector(e),a=i+" div",o=t.checkboxContent.clone();$(i,t._context).append(o),$(a,t._context).on("click",(function(){$(this).toggleClass(t.Class.CHECKBOX_CHECKED_CLASS.substr(1)),t._updateCheckedItems($(this)),t._refreshCheckAllCheckbox(!1),t._onItemsCheckedChange()})),t._addDataToCheckbox(e,a)},_updateCheckedItems:function(e){var t=this._getDataFormCheckbox(e);this._itemWasChecked(t)?this._removeItemChecked(t):this._addItemChecked(t)},_addItemChecked:function(e){this.checkedItems.push(e)},_removeItemChecked:function(e){this.checkedItems=this.checkedItems.filter((function(t){return JSON.stringify(t)!==JSON.stringify(e)}))},_addDataToCheckbox:function(e,t){$(t,this._context).data("id",e)},_getDataFormCheckbox:function(e){return e.data()},_itemWasChecked:function(e){return this.checkedItems.some((function(t){return JSON.stringify(t)===JSON.stringify(e)}))},_configureCheckAllCheckbox:function(){var e=this,t=e.checkboxContent.clone();$(e._CHECK_ALL_CHECKBOX_CONTAINER,e._context).append(t),$(e._CHECK_ALL_CHECKBOX,e._context).attr("title",e.getResource("workportal-widget-query-form-check-all")).on("click",(function(t){(t=t||window.event).stopPropagation(),e._toggleCheckAllCheckbox()}))},_refreshCheckAllCheckbox:function(e){var t=this.Class.DATA_PROPERTIES,i=this._getNumberOfItemsChecked()===this._items.length;this._setProperty(t.CHECK_ALL,i,e)},_getNumberOfItemsChecked:function(){return this.checkedItems.length},_toggleCheckAllCheckbox:function(e){var t=this.Class.DATA_PROPERTIES,i=this._getProperty(t.CHECK_ALL),a=void 0!==e?e:!i;this._refreshAllCheckboxes(a),this._setProperty(t.CHECK_ALL,a),this._onItemsCheckedChange()},_refreshAllCheckboxes:function(e){var t=this,i=$(t.Class.CHECKBOX_CLASS,t._context).not(t._CHECK_ALL_CHECKBOX);i.toggleClass(t.Class.CHECKBOX_CHECKED_CLASS.substr(1),e),t.checkedItems=[],e&&i.each((function(){var e=t._getDataFormCheckbox($(this));t._addItemChecked(e)}))},_setProperty:function(e,t,i){var a=void 0!==i&&i,o=this.Class.DATA_PROPERTIES[e],r=this.data[o]!==t,s=!a&&r;if(void 0===o)throw"Property does not exist: "+e;this.data[o]=t,s&&this._updateView()},_getProperty:function(e){var t=this.Class.DATA_PROPERTIES[e],i=this.data[t],a=Array.isArray(i)?[]:{};if(void 0===t)throw"Property does not exist: "+e;return"object"===_typeof(i)&&(i=jQuery.extend(a,i)),i},_setInitialData:function(){var e=this.Class.DATA_PROPERTIES;this.data={},this.data[e.CHECK_ALL]=!1},_updateView:function(){this._updateViewCheckAll()},_updateViewCheckAll:function(){var e=this.Class.DATA_PROPERTIES,t=this._getProperty(e.CHECK_ALL);$(this._CHECK_ALL_CHECKBOX,this._context).toggleClass(this.Class.CHECKBOX_CHECKED_CLASS.substr(1),t)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.desktop.widgets.project.cancelCase",{},{init:function(e,t,i){this._super(e,t,i),this.notifier=bizagi.injector.get("notifier"),i=i||{},this.loadTemplates({"project-cancel-case-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.cancelCase").concat("#project-caseState-cancel-case-wrapper"),"project-cancel-case-wrapper-error":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.cancelCase").concat("#project-caseState-cancel-case-wrapper-error")})},renderContent:function(){var e=this.getTemplate("project-cancel-case-wrapper");return this.content=e.render({}),this.defineButtons(),this.content},defineButtons:function(){var e=this;e.params.buttons=[{text:bizagi.localization.getResource("workportal-general-word-no"),class:"bz-cancel-case__btn biz-wp-button-secondary",click:function(){$(this).dialog("close")}},{text:bizagi.localization.getResource("workportal-general-word-yes"),class:"bz-cancel-case__btn",click:function(){e.cancelCaseRequest()}}]},cancelCaseRequest:function(){var e,t=this,i=$("#bz-wp-cancelcase-wrapperload",t.content);e=$("textarea#cancel-case-reason").val();var a={idWorkitem:t.params.idWorkitem,action:"abort",cases:JSON.stringify({cases:[{idCase:t.params.idCase}]}),reason:e};bizagi.showErrorAlertDialog=!1,""!=e?(i.show(),$.when(t.dataService.cancelCase(a)).done((function(e){e.response[0].deleted?(i.hide(),t.notifier.showSucessMessage(bizagi.localization.getResource("workportal-widget-cancel-case-the-case-was-cancelled-successfully")),$(".ui-dialog-content").dialog("close"),bizagi.injector.get("bizagi.workportal.widgets.navigator",{}).goToBack()):(i.hide(),bizagi.showToastError(bizagiConfig.environment,e.response[0].idCase))})).fail((function(e){var t=e.status+" - "+e.statusText;bizagi.showToastError(bizagiConfig.environment,t),i.hide(),bizagi.log(e)}))):($("textarea#cancel-case-reason").css("border-color","#F50E0E"),$(".bz-cancel-case__help-text").text(bizagi.localization.getResource("workportal-widget-cancel-case-the-cancellation-reason-is-mandatory")).css("color","#F50E0E"),t.showTextIsRequired())},showTextIsRequired:function(){$("textarea#cancel-case-reason").bind("input propertychange",(function(){$("textarea#cancel-case-reason").css("border-color","#F50E0E"),$(".bz-cancel-case__help-text").text(bizagi.localization.getResource("workportal-widget-cancel-case-the-cancellation-reason-is-mandatory")).css("color","#F50E0E"),this.value.length&&($("textarea#cancel-case-reason").css("border-color","#"),$(".bz-cancel-case__help-text").text(bizagi.localization.getResource("workportal-widget-cancel-case-max-characters")).css("color","##757575"))}))}}),bizagi.injector.register("bizagi.workportal.desktop.widgets.project.cancelCase",["workportalFacade","dataService",bizagi.workportal.desktop.widgets.project.cancelCase],!0);
//# sourceMappingURL=../../../../Maps/desktop/inbox.desktop.production.js.map
