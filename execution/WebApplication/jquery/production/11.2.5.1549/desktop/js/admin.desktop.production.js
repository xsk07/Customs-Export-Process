function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _bizagi$workportal$wi;function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.activity.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ACTIVITY_LOG},renderContent:function(){var e=this.getTemplate("activity.log");return this.idCase=this.params.idCase,this.idWorkflow=this.params.idWorkflow,this.content=$.tmpl(e,{idCase:this.idCase})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.authentication.log",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_AUTHENTICATION_LOG},renderContent:function(){var e=this.getTemplate("authentication.log");return this.content=$.tmpl(e,{})}}),bizagi.workportal.widgets.activity.log.extend("bizagi.workportal.widgets.activity.log",{ATTR_VALUE_INDEX_COLUMN:{ActivityLog:2,EntityLog:1,UserLog:2},ATTR_VALUE_MAX_LENGTH:89,SELECTORS:{ATTR_VALUE_VIEW_MORE:".activity-log-attribute-value-container > a",DETAIL_WRAPPER:"#activity-log-data-detail-wrapper"}},{init:function(e,t,i){this.totalPages=0,this.maxRows=10,this.maxPages=10,this.currentPage=1,this._super(e,t,i),this.loadTemplates({"activity.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log"),"activity.log.general.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-general-content"),"activity.log.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-header"),"activity.log.detail.header":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-header"),"activity.log.detail.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.activity.log").concat("#ui-bizagi-workportal-widget-activity-log-detail-content"),useNewEngine:!1})},postRender:function(){var e=this;e.generalContentTmpl=e.getTemplate("activity.log.general.content"),e.generalHeaderContentTmpl=e.getTemplate("activity.log.header"),e.detailHeaderTmpl=e.getTemplate("activity.log.detail.header"),e.detailContentTmpl=e.getTemplate("activity.log.detail.content"),e.logCategories={ACTIVITIES:{id:"ActivityLog",serviceMethod:"getActivityLog",detailServiceMethod:"getActivityDetailLog",selectedDetailId:0},ENTITIES:{id:"EntityLog",serviceMethod:"getEntityLog",detailServiceMethod:"getEntityDetailLog",selectedDetailId:0},USERS:{id:"UserLog",serviceMethod:"getUserLog",detailServiceMethod:"getUserDetailLog",selectedDetailId:0},ADMINISTRATION:{id:"AdminLog",serviceMethod:"getAdminLog"}},e.containtersID={GENERAL:"general",DETAIL:"detail"};var t=null!=_typeof(e.dataService.serviceLocator.proxyPrefix)?e.dataService.serviceLocator.proxyPrefix:"";new bizagi.render.services.service({proxyPrefix:t}).getCaseNumber({idCase:e.idCase}).done((function(t){var i=t.caseNumber;e.caseNumber=i||e.idCase,e.initWidget()}))},initWidget:function(){this.displayNoResults(!1),this.setupHeader()},setupHeader:function(){var e=this;content=e.getContent();var t=$("#activity-log-data-header-wrapper",content);$.when(e.dataService.supportedLogTypes()).done((function(i){$.tmpl(e.generalHeaderContentTmpl,{supportedLogTypes:i.Supported}).appendTo(t);var a=e.getFirstAvailableLogTypes(i.Supported);e.currentPage=1,e.getActivityLogByCategory(e.logCategories[a]),e.bindHeaderElementInteraction($("#LnkActivities",e.content),e.logCategories.ACTIVITIES),e.bindHeaderElementInteraction($("#LnkEntities",e.content),e.logCategories.ENTITIES),e.bindHeaderElementInteraction($("#LnkUsers",e.content),e.logCategories.USERS),e.bindHeaderElementInteraction($("#LnkAdmin",e.content),e.logCategories.ADMINISTRATION)})).fail((function(e){}))},getFirstAvailableLogTypes:function(e){for(var t in this.logCategories)for(var i in e)if(this.logCategories[t].id==i&&("true"==e[i]||1==e[i]))return t;return""},bindHeaderElementInteraction:function(e,t){var i=this;e.click((function(){$(this).hasClass("active")||($(".active",i.content).removeClass("active"),$(this).addClass("active"),i.currentPage=1,i.getActivityLogByCategory(t))}))},getActivityLogByCategory:function(e){var t,i=this;i.selectedCategoryObj=$.isEmptyObject(e)?i.selectedCategoryObj:$.extend({},e),t={idCase:i.idCase,idActualPage:i.currentPage,pageSize:i.maxRows},$("#activity-log-data-general-wrapper",content).addClass("ui-bizagi-component-loading"),$.when(i.dataService[i.selectedCategoryObj.serviceMethod](t)).done((function(e){i.totalPages=e.total,i.generalActivityDataValidator(e)})).fail((function(e){bizagi.showErrorAlertDialog=!1,bizagi.showMessageBox(JSON.parse(e.responseText).message,"Bizagi","Error")}))},generalActivityDataValidator:function(e){var t=this.getContent();$("#activity-log-data-general-wrapper",t);e.rows?this.currentLogData=[].concat(e.rows):this.currentLogData=[],this.renderContentByCategory()},renderContentByCategory:function(){var e=this,t=e.getContent(),i=$("#activity-log-data-general-wrapper",t);$("#activity-log-data-detail-wrapper",t);i.removeClass("ui-bizagi-component-loading"),i.empty(),e.switchContent(e.containtersID.GENERAL);var a=e.getPaginationData();$.tmpl(e.generalContentTmpl,{logCategory:e.selectedCategoryObj.id,idCase:e.caseNumber,logItems:e.currentLogData,pagData:a,getIcon:e.getIcon}).appendTo(i),e.setUpPagination($("#biz-wp-activitylog-category-pager ul",e.content),"getActivityLogByCategory"),e.currentLogData.length>0?(e.displayNoResults(!1),$(".activity-log-table",i).show()):(e.displayNoResults(!0),$(".activity-log-table",i).hide()),$(".detail-item",i).click((function(t){t.preventDefault(),e.selectedLogItemIndex=$($(t.currentTarget).closest("tr")[0]).index()-1,e.currentPage=1,e.preprocessDetailRender($(this))})),$(".listHeaderLinks",i).click((function(e){e.preventDefault()}))},getPaginationData:function(){for(var e=this.totalPages>1,t={page:this.currentPage,pagesArray:[],pagination:e},i=this.maxPages>this.totalPages?this.totalPages:this.maxPages,a=0;a<i;a++)t.pagesArray.push(a+1);return t},setUpPagination:function(e,t){var i=this;e.bizagiPagination({maxElemShow:i.maxRows,totalPages:i.totalPages,actualPage:i.currentPage,listElement:e,clickCallBack:function(a){i.currentPage=parseInt(a.page),i[t]({},e)}})},preprocessDetailRender:function(e){var t=this,i=(t.getContent(),t.getDetailRenderParams(e));t.selectedCategoryObj.detailServiceMethod&&$.when(t.dataService[t.selectedCategoryObj.detailServiceMethod](i)).done((function(e){t.totalPages=e.total,t.switchContent(t.containtersID.DETAIL),e.rows?t.currentDetailLogData=[].concat(e.rows):t.currentDetailLogData=[],t.renderLogDetail(e)})).fail((function(e){}))},getDetailRenderParams:function(e){var t,i;switch(this.selectedCategoryObj.id){case this.logCategories.ACTIVITIES.id:$.isEmptyObject(e)?i=this.logCategories.ACTIVITIES.selectedDetailId:this.logCategories.ACTIVITIES.selectedDetailId=i=e.attr("data-id"),t={idCase:this.idCase,idWorkItemFrom:i};break;case this.logCategories.ENTITIES.id:$.isEmptyObject(e)?i=this.logCategories.ENTITIES.selectedDetailId:this.logCategories.ENTITIES.selectedDetailId=i=e.attr("data-id"),t={idCase:this.idCase,idEntity:i};break;case this.logCategories.USERS.id:$.isEmptyObject(e)?i=this.logCategories.USERS.selectedDetailId:this.logCategories.USERS.selectedDetailId=i=e.attr("data-id"),t={idCase:this.idCase,idUser:i}}return $.extend(t,{idActualPage:this.currentPage,pageSize:this.maxRows}),t},renderLogDetail:function(e){var t=this,i=t.getContent(),a=$("#activity-log-data-detail-wrapper",i);a.empty(),a.removeClass("ui-bizagi-component-loading"),$.when(t.renderDetailContent()).done((function(){var e=$("#log-filter-wrapper",i);t.showDetailResultMessage(),$("#back-general-content",a).click((function(e){e.preventDefault(),t.displayNoResults(!1),t.switchContent(t.containtersID.GENERAL)})),$("#apply-filter",e).click((function(e){e.preventDefault(),t.currentPage=1,t.applyDetailFilter()})),$("#remove-filter",e).click((function(i){i.preventDefault(),$("input",e).val(""),t.currentPage=1,t.applyDetailFilter()})),$(".listHeaderLinks",a).click((function(e){e.preventDefault()})),t._eventsDeclare()}))},showDetailResultMessage:function(){var e=$("#activity-log-data-detail-wrapper",this.getContent());this.currentDetailLogData.length>0?(this.displayNoResults(!1),$(".activity-log-table",e).show()):(this.displayNoResults(!0),$(".activity-log-table",e).hide())},applyDetailFilter:function(){var e=this,t=e.getFilterParams(),i=e.getContent();e.selectedCategoryObj.detailServiceMethod&&$.when(e.dataService[e.selectedCategoryObj.detailServiceMethod](t)).done((function(t){e.totalPages=t.total,t.rows?e.currentDetailLogData=[].concat(t.rows):e.currentDetailLogData=[];var a=e.getPaginationData(),s=e._renderDetailContentTmpl(a);$("#bz-workportal-activitylog-detailcontent-wrapper",i).remove(),$(s).insertAfter("#activity-log-data-detail-header-wrapper",i),e.showDetailResultMessage(),e.setUpPagination($("#biz-wp-activitylog-detail-pager ul",i),"applyDetailFilter"),e._eventsDeclare()}))},getFilterParams:function(){var e,t,i,a=this.getContent(),s=$("#log-filter-wrapper",a),n=this.getDetailRenderParams();return this.selectedCategoryObj.id==this.logCategories.ENTITIES.id?e=$("#filterUser",s).val().toLowerCase():this.selectedCategoryObj.id==this.logCategories.USERS.id&&(i=$("#filterEntity",s).val().toLowerCase()),t=$("#filterAttribute",s).val().toLowerCase(),$.extend(n,{userFullName:e,attribDisplayName:t,entDisplayName:i}),n},_eventsDeclare:function(){var e=this.Class.SELECTORS,t=this.getContent(),i=$(e.DETAIL_WRAPPER,t);$(e.ATTR_VALUE_VIEW_MORE,i).click(this._showCompleteAttributeValue)},_renderDetailContentTmpl:function(e){var t={logCategory:this.selectedCategoryObj.id,title:this.selectedCategoryObj.title,detailItems:this.currentDetailLogData,pagData:e,isAttrValue:this._isAttrValue.bind(this,this.selectedCategoryObj.id),attrValue2show:this._attrValue2show.bind(this),showMoreButton4AttrValue:this._showMoreButton4AttrValue.bind(this)};return $.tmpl(this.detailContentTmpl,t)},_showCompleteAttributeValue:function(e){var t=$(this).find("span").html();e.preventDefault(),bizagi.showSimpleBox(t,bizagi.localization.getResource("workportal-widget-activity-log-table-details-title-attrvalue"))},_isAttrValue:function(e,t){var i=this.Class.ATTR_VALUE_INDEX_COLUMN[e];return void 0===i&&console.error("_isAttrValue: the selectedCategoryObjId "+e+" does not exist"),t==i},_attrValue2show:function(e){return e.substr(0,this.Class.ATTR_VALUE_MAX_LENGTH)},_showMoreButton4AttrValue:function(e){return e.length>this.Class.ATTR_VALUE_MAX_LENGTH},renderDetailContent:function(){var e=this,t=e.getContent(),i=$.Deferred(),a=$("#activity-log-data-detail-wrapper",t),s=e.getPaginationData(),n=$.tmpl(e.detailHeaderTmpl,{logCategory:e.selectedCategoryObj.id,idCase:e.caseNumber,data:e.currentLogData[e.selectedLogItemIndex]}),r=e._renderDetailContentTmpl(s);return $.when(n,r).done((function(t,s){a.append(t),s.insertAfter("#activity-log-data-detail-header-wrapper",a),e.setUpPagination($("#biz-wp-activitylog-detail-pager ul",e.content),"preprocessDetailRender"),i.resolve()})),i.promise()},switchContent:function(e){var t=this.getContent(),i=$("#activity-log-data-general-wrapper",t),a=$("#activity-log-data-detail-wrapper",t);this.containtersID.DETAIL==e?(i.hide(),a.show()):(i.show(),a.hide())},displayNoResults:function(e){var t=this.getContent();e?$("#activity-log-no-results",t).show():$("#activity-log-no-results",t).hide()},getIcon:function(e){var t="bzg-case-allocation",i="bzg-case-allocation-info",a="bzg-case-canceled",s="";switch(e){case 1:case 6:case 7:case 1002:s=t;break;case 3:case 4:s=i;break;case 1001:s=a}return s}}),bizagi.injector.register("bizagi.workportal.widgets.activity.log",["workportalFacade","dataService",bizagi.workportal.widgets.activity.log],!0),bizagi.workportal.widgets.authentication.log.extend("bizagi.workportal.widgets.authentication.log",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"authentication.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log"),"authentication.log.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-fields"),"authentication.log.button":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-button"),"authentication.log.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-result"),"authentication.log.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.authentication.log").concat("#ui-bizagi-workportal-widget-authentication-log-pagination"),useNewEngine:!1})},postRender:function(){this.maxElemShow=10,this.maxPageToShow=5,this.generalContentTmpl=this.getTemplate("authentication.log"),this.fieldsContentTmpl=this.getTemplate("authentication.log.fields"),this.buttonContentTmpl=this.getTemplate("authentication.log.button"),this.resultContentTmpl=this.getTemplate("authentication.log.result"),this.paginationTmpl=this.getTemplate("authentication.log.pagination"),this.setupInitialData()},setupInitialData:function(){var e=this,t=e.getContent(),i=[{dataType:"domains"},{dataType:"events"},{dataType:"subEvents"}];$.when(e.dataService.getAuthenticationLogData(i[0]),e.dataService.getAuthenticationLogData(i[1]),e.dataService.getAuthenticationLogData(i[2])).done((function(i,a,s){e.eventTypeList=a[0].response,e.subEventTypeList=s[0].response;var n=$.tmpl(e.fieldsContentTmpl,{domainList:i[0],eventTypeList:a[0].response,subEvenTypes:s[0].response});t.append(n),e.setupDatePicker(),e.setupFooterButtons()})).fail((function(e){bizagi.log(e)}))},setupDatePicker:function(){var e=this.getContent(),t=this.getDateFormat(),i=bizagi.localization.getResource("timeFormat");$(".biz-wp-form-datepicker",e).datetimepicker({controlType:"select",dateFormat:t,timeFormat:i,currentText:bizagi.localization.getResource("render-timeentry-now"),closeText:bizagi.localization.getResource("workportal-general-button-label-done"),timeText:bizagi.localization.getResource("workportal-project-plan-time-title"),hourText:bizagi.localization.getResource("reports-general-hour").capitalize(),minuteText:bizagi.localization.getResource("reports-general-minute").capitalize()})},getDateFormat:function(){var e=bizagi.localization.getResource("dateFormat");return e.indexOf("MMMM")>=0?e=e.replaceAll("MMMM","MM"):e.indexOf("MMM")>=0?e=e.replaceAll("MMM","M"):e.indexOf("MM")>=0?e=e.replaceAll("MM","mm"):e.indexOf("M")>=0&&(e=e.replaceAll("M","m")),-1!=e.search("yyyy")?e=e.replaceAll("yyyy","yy"):-1!=e.search("yy")&&(e=e.replaceAll("yy","y")),e=e.replaceAll("dddd","DD")},setupFooterButtons:function(){var e=this,t=e.getContent(),i=$.tmpl(e.buttonContentTmpl,{});t.append(i);var a=$("#authentication-log-data-buttonset",t);$("#btn-authentication-search",a).click((function(i){$(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove();var a=e.validateData(),s=$("#sinceDate",t).val(),n=$("#toDate",t).val();if(""!=s&&(s=bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(s,e.getResource("dateFormat")+" "+e.getResource("timeFormat")),"MM/dd/yyyy H:mm")),""!=n&&(n=bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(n,e.getResource("dateFormat")+" "+e.getResource("timeFormat")),"MM/dd/yyyy H:mm")),a.fieldsAreEmpty||""!=a.errorMessage)bizagi.showMessageBox(a.errorMessage,"Bizagi","warning");else{var r={action:"AuthLog",domain:"none"!=$("#domainList",t).val()?$("#domainList",t).val():"",userName:$("#auth-log-user",t).val(),dtFrom:s,dtTo:n,eventSubType:$("#subEventType",t).val()!=e.subEventTypeList[0].displayName?$("#subEventType",t).val():"",eventType:$("#eventType",t).val()!=e.eventTypeList[0].displayName?$("#eventType",t).val():"",pagSize:e.maxElemShow};e.findResults(t,r)}}))},validateData:function(){var e=this.getContent(),t={fieldsAreEmpty:!1,errorMessage:""},i="",a="",s=$("#sinceDate",e).val(),n=$("#toDate",e).val();return"none"==$("#domainList",e).val()&&""==$("#user",e).val()&&$("#eventType",e).val()==this.eventTypeList[0].id&&$("#subEventType",e).val()==this.subEventTypeList[0].id&&""==$("#sinceDate",e).val()&&""==$("#toDate",e).val()?(t.fieldsAreEmpty=!0,t.errorMessage=bizagi.localization.getResource("workportal-widget-authentication-log-emptyfields-message")):""!=s&&""==bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(s,this.getResource("dateFormat")+" "+this.getResource("timeFormat")),"MM/dd/yyyy H:mm")?(a=bizagi.localization.getResource("workportal-widget-authentication-log-datesince"),i=(i=bizagi.localization.getResource("workportal-general-invalid-date")).replace("{0}",a),t.errorMessage=i):""!=n&&""==bizagi.util.dateFormatter.formatInvariant(bizagi.util.dateFormatter.getDateFromFormat(n,this.getResource("dateFormat")+" "+this.getResource("timeFormat")),"MM/dd/yyyy H:mm")&&(a=bizagi.localization.getResource("workportal-widget-authentication-log-dateto"),i=(i=bizagi.localization.getResource("workportal-general-invalid-date")).replace("{0}",a),t.errorMessage=i),t},findResults:function(e,t,i){var a=this;t.pag=i||1,$.when(a.dataService.getAuthenticationLogResult(t)).done((function(i){if($(".biz-wp-table").remove(),$("#biz-wp-table-summary-wrapper").remove(),a.totalRecords=i.records,a.totalPages=i.total,i.rows.length>0){var s=$.tmpl(a.resultContentTmpl,{resultList:i.rows});e.append(s);var n,r=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,o=$("#biz-wp-table-pager-wrapper"),l={};l.pagination=a.totalPages>1,l.page=i.page,l.pages={};for(var d=1;d<=r;d++)l.pages[d]={pageNumber:d};n=$.tmpl(a.paginationTmpl,l).html(),o.append(n),$("ul").bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(i){a.findResults(e,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-authentication-log-none"),"Bizagi","warning")})).fail((function(e){bizagi.log(e)}))}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.encrypt.passwords",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ENCRYPT_PASSWORDS},renderContent:function(){var e=this.getTemplate("encrypt.passwords");return this.content=$.tmpl(e,{})}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.users.requests",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USERS_REQUESTS},renderContent:function(){var e=this.getTemplate("users.requests");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.defaults.assignation.user",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_DEFAULTS_ASSIGNATION_USER},renderContent:function(){var e,t=this.getTemplate("defaults.assignation.user");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.user.profiles",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USER_PROFILES},renderContent:function(){var e=this.getTemplate("user.profiles"),t=this.content=$.tmpl(e,{});return this.loadtemplates(),t},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.dimensions",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USER_DIMENSIONS},renderContent:function(){var e,t=this.getTemplate("dimensions");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.alarms",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ALARMS},renderContent:function(){var e=this.getTemplate("alarms");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.user.licenses",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USER_LICENSES},renderContent:function(){var e,t=this.getTemplate("user.licenses");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.document.templates",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_DOCUMENT_TEMPLATES},renderContent:function(){var e,t=this.getTemplate("admin.document.templates");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.processes",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_PROCESSES},renderContent:function(){var e,t=this.getTemplate("admin.processes.wrapper");return this.comboProcess=this.getTemplate("admin.processes.combo.process"),this.processEditTmpl=this.getTemplate("admin.processes.proc.edit"),this.taskEditTmpl=this.getTemplate("admin.processes.task.edit"),e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES},renderContent:function(){var e,t=this.getTemplate("admin.business.policies.wrapper");return this.generalContentTmpl=this.getTemplate("admin.business.policies.content"),e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.decision.table",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_DECISION_TABLE},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.rules",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_RULES},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.tabs",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_TABS},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.politics",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_POLITICS},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.policies.vocabularies",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_BUSINESS_POLICIES_VOCABULARIES},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.language",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_LANGUAGE},renderContent:function(){var e,t=this.getTemplate("admin.language.wrapper");return this.panelWrapper=$.tmpl(this.getTemplate("admin.language.panel.wrapper")),this.generalTemplateListTmpl=this.getTemplate("admin.language.template.list"),this.fileCultureName=this.getTemplate("admin.language.upload.file.culturename"),this.bizagiObjectsList=this.getTemplate("admin.language.bizagi.objects.list"),this.entitiesListTmpl=this.getTemplate("admin.language.entities.list"),e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.preferences",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_PREFERENCES},renderContent:function(){var e,t=this.getTemplate("admin.preferences.wrapper");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.entities",{},{renderContent:function(){var e=this,t=new $.Deferred;return $.when(e.loadtemplates()).done((function(){var i=e.getTemplate("admin.entity.wrapper");e.content=$.tmpl(i,{}),t.resolve(e.content)})),t.promise()},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ENTITIES},getFormEntity:function(e){var t=this,i=$.Deferred();return t.currentGuidForm=e.guidForm,t.currentIdRow=e.idRow,bizagi.loader.start("rendering").then((function(){t.loadFormEntity(e,i)})),i.promise()},loadFormEntity:function(e,t){var i=this,a=i.getFacade();$.when(i.dataService.getAdminEntitiesForm(e)).done((function(s){s.form.contextType="entity",$.when(a.execute({data:s,contexttype:"entity",canvas:$("#detailEntity",i.panelWrapper),isEntityForm:!0})).done((function(a){"stakeholder"===i._referrer&&(i._associatedUser=bizagi.util.isEmpty(a.getRender("associatedUser").value)?bizagi.util.isEmpty(i._associatedUser)?void 0:i._associatedUser:a.getRender("associatedUser").value,t.resolve(a)),e.idRow&&(a.surrogatekey=e.idRow),i.overrideFormRender(a)}))}))},getFacade:function(){var e=this,t=new bizagi.rendering.facade;return t.configureRefresh=function(t,i){var a=this;t.bind("refresh",(function(s,n){var r=e.getSelectedItem();r.idPageCache=t.idPageCache,r.guidForm=e.currentGuidForm,r.guid=r.guidEntity,r.idRow=e.currentIdRow,r.isStakeholder="stakeholder"===e._referrer,t.dispose(n),i.fastEmpty();var o=i.parent();return o.find(".ui-bizagi-button-container").length>0&&o.find(".ui-bizagi-button-container").remove(),a.executionDeferred&&a.executionDeferred.state&&"resolved"==a.executionDeferred.state()&&(a.executionDeferred=$.Deferred()),e.getFormEntity(r),a.executionDeferred.promise()}))},t},overrideFormRender:function(e){var t=this;e.internalSubmitOnChange=function(i){var a=$.Deferred();return $.when(t.internalSubmitOnChangeEntity(e)).done((function(i){if(i){var s=t.getSelectedItem();s.idPageCache=e.idPageCache,s.guidForm=t.currentGuidForm,s.guid=s.guidEntity,s.idRow=t.currentIdRow,s.isStakeholder="stakeholder"===t._referrer,t.getFormEntity(s),a.resolve()}})).fail((function(){a.reject()})),a.promise()},e.processButton=function(i){if(e.endLoading(),"save"==i.action){if(e.validateForm())return $.when(t.saveFormEntity(e)).done((function(e){e&&t.drawSimpleGrid(t.getSelectedItem())}))}else"cancel"===i.action&&t.drawSimpleGrid(t.getSelectedItem())}},internalSubmitOnChangeEntity:function(e){var t=$.Deferred(),i=(this.getSelectedItem(),new bizagi.render.services.service),a={};return e.collectRenderValues(a),$.when(i.multiactionService.submitData({action:"SUBMITONCHANGE",contexttype:"entity",data:a,surrogatekey:void 0!==e.surrogatekey&&e.surrogatekey,idPageCache:e.idPageCache})).done((function(e){"success"==e.type?t.resolve(!0):t.reject()})).fail((function(e){bizagi.showMessageBox(e.message),t.reject()})),t.promise()}}),bizagi.workportal.widgets.admin.encrypt.passwords.extend("bizagi.workportal.widgets.admin.encrypt.passwords",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"encrypt.passwords":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.encrypt.passwords").concat("#ui-bizagi-workportal-widget-admin-encrypt-passwords"),useNewEngine:!1})},postRender:function(){this.generalContentTmpl=this.getTemplate("encrypt.passwords"),this.setupFooterButtons(),$("#encryp-password-data-text",this.getContent()).on("paste",this.handlePaste),$("#encryp-password-data-text-confirm",this.getContent()).on("paste",this.handlePaste)},setupFooterButtons:function(){var e,t,i=this,a=i.getContent(),s={},n=$("#encryp-password-data-buttonset",a);$("#btn-encrypt",n).click((function(n){s.entry=$("#txtTextToEncrypt").val(),e=i.validateData(),t=i.comparePasswords(),e&&t?$.when(i.dataService.encryptString(s)).done((function(e){$("#txtEncryptedText",a).val(e.encryptedPassword)})).fail((function(e){})):e?t||bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-encrypt-passwords-emptyfields-message-equals"),"Bizagi","warning"):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-encrypt-passwords-emptyfields-message"),"Bizagi","warning")})),$("#btn-clear",n).click((function(e){i.clearData()}))},clearData:function(){var e=this.getContent();$("#txtTextToEncrypt",e).val(""),$("#txtConfirmTextToEncrypt",e).val(""),$("#txtEncryptedText",e).val("")},comparePasswords:function(){var e=this.getContent();return $("#txtTextToEncrypt",e).val()==$("#txtConfirmTextToEncrypt",e).val()},validateData:function(){var e=this.getContent(),t=!1;return""!=$("#txtTextToEncrypt",e).val()?t=!0:""!=$("#txtConfirmTextToEncrypt",e).val()&&(t=!0),t},handlePaste:function(e){e.stopPropagation(),e.preventDefault(),clipboardData=e.originalEvent.clipboardData||window.clipboardData,pastedData=clipboardData.getData("Text");var t=pastedData.replace(/\r?\n|\r/g,"");e.target.value=t}}),bizagi.workportal.widgets.admin.users.requests.extend("bizagi.workportal.widgets.admin.users.requests",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"users.requests":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests"),"users.requests.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-list"),"users.requests.detail":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-detail"),"users.requests.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-pagination"),"users.requests.email":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.users.requests").concat("#ui-bizagi-workportal-widget-admin-users-requests-email"),useNewEngine:!1})},postRender:function(){var e=this.getContent();this.maxElemShow=10,this.maxPageToShow=5,this.currentPage=1,this.userRequest=this.getTemplate("users.requests"),this.userRequestList=this.getTemplate("users.requests.list"),this.userRequestDetail=this.getTemplate("users.requests.detail"),this.userRequestpaginationTmpl=this.getTemplate("users.requests.pagination"),this.userRequestemailTmpl=this.getTemplate("users.requests.email"),this.userRequestListWrapper=$("#users-request-list-wrapper",e),this.userRequestDetailWrapper=$("#users-request-detail-wrapper",e),this.containtersID={LIST:"list",DETAIL:"detail"},this.setupInitialData()},setupInitialData:function(e){var t=this;t.switchContent(t.containtersID.LIST),e&&(t.currentPage=e);var i={pag:t.currentPage,pagSize:t.maxElemShow};$.when(t.dataService.userPendingRequests(i)).done((function(e){t.renderUserRequestList(e)}))},authenticationInfo:function(e){var t=this,i={idUser:e};$.when(t.dataService.userAuthenticationInfo(i)).done((function(e){t.renderUserRequestDetails(e)}))},renderUserRequestList:function(e){var t=this,i=t.getContent();t.userRequestListWrapper.empty();var a=$.tmpl(t.userRequestList,{userData:e.rows});bizagi.util.formatInvariantDate(a,t.getResource("dateFormat")+" "+t.getResource("timeFormat")),t.userRequestListWrapper.append(a);var s=$("#users-requests-pager-wrapper",i);if(t.totalRecords=e.records,t.totalPages=e.total,e.rows.length>0){var n,r=t.maxPageToShow>t.totalPages?t.totalPages:t.maxPageToShow,o={};o.pagination=t.totalPages>1,o.page=e.page,o.pages={},$("#biz-wp-userrequest-norequest").css("display","none"),$("#users-request-list-wrapper .biz-wp-window ").css("display","block"),$("#users-request-list-wrapper .biz-wp-table ").css("display","table");for(var l=1;l<=r;l++)o.pages[l]={pageNumber:l};n=$.tmpl(t.userRequestpaginationTmpl,o).html(),s.append(n),$("ul").bizagiPagination({maxElemShow:t.maxElemShow,totalPages:t.totalPages,actualPage:e.page,listElement:$("#users-requests-pager-wrapper"),clickCallBack:function(e){t.setupInitialData(e.page)}})}else $("#biz-wp-userrequest-norequest").show("500"),$("#users-request-list-wrapper .biz-wp-window ").css("display","none"),$("#users-request-list-wrapper .biz-wp-table ").css("display","none");$(".selectLink",i).click((function(e){t.authenticationInfo(e.currentTarget.id)}))},renderUserRequestDetails:function(e){var t,i=this,a=i.getContent(),s=$.tmpl(i.userRequestDetail,{resultAuthentication:e});i.switchContent(i.containtersID.DETAIL),i.userRequestDetailWrapper.empty(),i.userRequestDetailWrapper.append(s),i.idUser=e.idUser,i.password=e.password,i.enabled=e.Enabled,i.isExpired=e.expired,i.isLocked=e.locked,$("#btn-passwordRandom",a).click((function(){$.when(i.dataService.generateRandomPassword()).done((function(e){$("#txtPasswordRequest",a).val(e.randomPassword)}))})),$("#btn-updateRequest",a).click((function(){var e=$("#txtPasswordRequest").val();t=i.validateKey(),i.password=e,t?i.dataService.generateDataToSendByEmail({idUser:i.idUser}).done((function(e){i.showEmailtPopup(e),i.updateUser()})):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-request-emptyfields-message"),"Bizagi","warning")})),$("#btn-cancelRequest",a).click((function(){i.setupInitialData()}))},switchContent:function(e){this.containtersID.DETAIL==e?(this.userRequestListWrapper.hide(),this.userRequestDetailWrapper.show()):(this.userRequestListWrapper.show(),this.userRequestDetailWrapper.hide())},updateUser:function(){var e=this.getContent(),t=1==$("#chkExpired",e).length?$("#chkExpired",e).is(":checked"):$("label[data-expired]",e).data("expired"),i={idUser:this.idUser,password:this.password,enabled:$("#chkActive").is(":checked"),expired:t,locked:$("#chkBlocked").is(":checked")};$.when(this.dataService.updateUserAuthenticationInfo(i)).done((function(e){})).fail((function(e){bizagi.log(e)}))},setupFooterButtons:function(){var e=this,t=e.getContent(),i=$("#users-request-data-buttonset-Password",t);$("#btn-passwordRandom",i).click((function(){$.when(e.dataService.generateRandomPassword()).done((function(e){$("#txtPasswordRequest",t).val(e.randomPassword)}))}))},showEmailtPopup:function(e){var t=this,i=window.document,a=t.getTemplate("users.requests.email"),s=t.dialogBoxEmail=$("<div class= users-requests-email/>");s.empty(),s.appendTo("body",i);var n={};n[t.getResource("workportal-widget-admin-users-requests-button-label-send")]=function(){var e={eMailTo:$("#txtTextTo",s).val(),subject:$("#txtSubject",s).val(),body:$("#txtBody",s).val(),userSecret:t.getUserSecret(t.password)};$.when(t.dataService.sendUserEmail(e)).done((function(){t.closeUploadDialogEmail()})),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-request-Send-message"),"Bizagi","warning")},n[t.getResource("workportal-widget-admin-users-requests-button-label-notSend")]=function(){t.closeUploadDialogEmail()},e.body=e.body.replace(/\\n/g,"\n").replace(/\\/g,""),$.tmpl(a,{messageResponse:e}).appendTo(s),$(".ui-bizagi-loading-message").remove(),s.dialog({width:500,title:t.getResource("workportal-widget-admin-users-request-subtitle-email"),modal:!0,buttons:n,close:function(){t.closeUploadDialogEmail()},resizeStop:function(e,i){t.form&&t.form.resize(i.size)}})},closeUploadDialogEmail:function(){this.dialogBoxEmail.dialog("destroy"),this.dialogBoxEmail.remove(),this.setupInitialData()},validateKey:function(){var e=this.getContent(),t=!1;return""!==$("#txtPasswordRequest",e).val()&&(t=!0),t},getUserSecret:function(e){var t=CryptoJS,i=t.enc.Utf8.parse("pc30n84e15lvdD68"),a=CryptoJS.enc.Latin1.parse("1v00628X62bJE2mi"),s=t.algo.AES.createEncryptor(i,{mode:t.mode.CBC,padding:t.pad.Pkcs7,iv:a}).finalize(e);return t.enc.Base64.stringify(s)}}),bizagi.workportal.widgets.admin.defaults.assignation.user.extend("bizagi.workportal.widgets.admin.defaults.assignation.user",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"defaults.assignation.user":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.defaults.assignation.user").concat("#ui-bizagi-workportal-widget-admin-defaults-assignation-user"),"defaults.assignation.user.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.defaults.assignation.user").concat("#ui-bizagi-workportal-widget-admin-defaults-assignation-user-fields"),"defaults.assignation.user.search":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.defaults.assignation.user").concat("#ui-bizagi-workportal-widget-admin-defaults-assignation-user-search"),useNewEngine:!1})},loadtemplates:function(){this.generalContent=this.getTemplate("defaults.assignation.user"),this.fieldsContent=this.getTemplate("defaults.assignation.user.fields"),this.searchContent=this.getTemplate("defaults.assignation.user.search")},postRender:function(){this.maxElemShow=10,this.maxPageToShow=5,this.processNavigation=[],this.setupData()},setupData:function(){this.setupInitialData(),this.setupProcessTree()},setupInitialData:function(){var e=this.getContent();this.processTree="";var t=$.tmpl(this.fieldsContent,{});$("#defaults-assignation-user-home",e).append(t),this.setupSearchusersButton()},setupProcessTree:function(){var e=this,t=e.getContent();bizagi.treeRoutSelected=[],$("#treeLinksId").remove(),$("#processTree",t).bind("processSelected",(function(){e.setupAssignationToProcess()})),e.processTree=new bizagi.workportal.widgets.processtree(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#processTree",t),authorizationContext:"DefaultUser"})),e.processTree.render()},setupAssignationToProcess:function(){content=this.getContent();var e={},t=this.processTree.getTreeRouteSelected();t.length>0&&(e.idWfClass=t[0]),$.when(this.dataService.getDefaultAssignationUserToProcess(e)).done((function(e){$("#txtTextUserAssignation",content).val(e.user)}))},setupUsersSearchForm:function(){var e=this,t=e.getContent(),i=$.Deferred();$("#defaults-assignation-user-home").hide(),e.usersTable=new bizagi.workportal.widgets.userstable(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#dinamicContent",t),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-select-link")],parentDef:i,showBackButton:!0})),e.usersTable.render(),$.when(i).done((function(i,a){$("#dinamicContent",t).html(""),$("#defaults-assignation-user-home",t).show(),e.processTree.setParamCanvas($("#processTree",t)),a&&$("#txtTextUserAssignation",t).val(a),i&&(e.selectedUserId=i)}))},saveAssignation:function(){var e=this.getContent(),t=this.processTree.getTreeRouteSelected(),i={idWfClass:t.length>0?t[0]:-1,idUser:""!=$("#txtTextUserAssignation",e).val()?this.selectedUserId:-1};this.startSaveAssignation(i)},startSaveAssignation:function(e){var t=this,i=t.getContent();-1==e.idWfClass?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail-select-process"),"Bizagi","warning"):$.when(t.dataService.setDefaultAssignationUserToProcess(e)).done((function(e){"true"===e.assigned||!0===e.assigned?(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-ok"),"Bizagi","warning"),$("#txtTextUserAssignation",i).val(""),t.setupProcessTree()):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail"),"Bizagi","warning")})).fail((function(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-assign-fail"),"Bizagi","warning"),$("#txtTextUserAssignation",i).val(""),t.setupProcessTree(),bizagi.log(e)}))},setupSearchusersButton:function(){var e=this,t=e.getContent();$("#btn-searchUser",t).click((function(){e.setupUsersSearchForm()})),$("#btn-clearUser",t).click((function(){$("#txtTextUserAssignation",t).val("")})),$("#btn-saveUser",t).click((function(){e.saveAssignation()}))}}),bizagi.workportal.widgets.admin.user.profiles.extend("bizagi.workportal.widgets.admin.user.profiles",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"user.profiles":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles"),"user.profiles.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles-fields"),"user.profiles.table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles-table"),"user.profiles.table.administrator":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.profiles").concat("#ui-bizagi-workportal-widget-admin-user-profiles-table-administrator"),useNewEngine:!1})},loadtemplates:function(){this.userProfilesFields=this.getTemplate("user.profiles.fields"),this.userProfilesTable=this.getTemplate("user.profiles.table"),this.userProfilesTableAdministrator=this.getTemplate("user.profiles.table.administrator")},postRender:function(){this.maxElemShow=10,this.maxPageToShow=5,this.setupData()},setupData:function(){this.setupInitialData()},setupInitialData:function(){var e=this,t=e.getContent();$.when(e.dataService.getProfilesTypes({dataType:"profiles"}),e.dataService.getOrganizationsList()).done((function(i,a){var s=$.tmpl(e.userProfilesFields,{profileList:i[0].response,orgList:a[0].response});e.comboDefaultValue=i[0].response[0].id,$("#general-content",t).html(""),$("#general-content",t).append(s),e.setupMainButtons(),e.setupProfileComboEvent(),$("#dinamicContent",t).html(""),$("#dinamicContent2",t).html(""),$("#general-content",t).show()})).fail((function(e){bizagi.log(e)}))},exportToExcel:function(){var e={filterType:this.profileTypeId,guidValueFilter:this.profileId,orgId:this.organizationId};this.dataService.exportToExcelProfiles(e)},searchProfiles:function(){var e=this,t=e.getContent(),i=$("#txtTextnameProfile",t).val();e.profileTypeId=$("#profileTypeList").val(),e.profileTypeName=$("#profileTypeList option:selected").text(),"8"==e.profileTypeId?e.organizationId=$("#organizationList",t).val():e.organizationId="";var a={action:"searchProfiles",profileName:i,profileType:e.profileTypeId,orgId:e.organizationId};$.when(e.dataService.searchProfiles(a)).done((function(i){var a=$.tmpl(e.userProfilesTable,{profileList:i.response});$("#profilesTableId").remove(),$("#general-content",t).append(a),e.setupManageLink()})).fail((function(e){bizagi.log(e)}))},getUserByProfileId:function(e){var t=this,i=t.getContent();params={action:"getUsersByProfile",idProfile:e,profileType:t.profileTypeId},t.profileId=e,$("#general-content").hide(),$.when(t.dataService.getUsersByProfile(params)).done((function(e){var a=[],s="";e.users.length>1e3?(a=e.users.slice(0,1e3),s=(s=bizagi.localization.getResource("workportal-widget-admin-user-profiles-limit-exceeded")).replace("{0}",1e3).replace("{1}",e.users.length)):a=e.users;var n=$.tmpl(t.userProfilesTableAdministrator,{userList:a,message:s});$("#dinamicContent",i).hide(),$("#dinamicContent2",i).html(""),$("#dinamicContent2",i).append(n),t.setupManageButtons()})).fail((function(e){bizagi.log(e)}))},removeUserFromProfile:function(e){var t=this;t.getContent();params={action:"removeUserFromProfile",idProfile:t.profileId,profileType:t.profileTypeId,idUser:e},$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-user-profiles-invalidate-confirm-msg"),"Bizagi","warning")).done((function(){$.when(t.dataService.removeUserFromProfile(params)).done((function(e){e.removed?t.getUserByProfileId(t.profileId):bizagi.showMessageBox(t.getResource("workportal-widget-admin-user-profiles-message-cant-delete-user-from-organization"),t.getResource("workportal-general-word-message"),"hidden")})).fail((function(e){bizagi.log(e)}))}))},setupUsersSearchForm:function(){var e=this,t=e.getContent(),i=$.Deferred();$("#dinamicContent2").html(""),e.usersTable=new bizagi.workportal.widgets.userstable(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#dinamicContent2",t),userLinkLabel:[bizagi.localization.getResource("workportal-general-select")],parentDef:i})),e.usersTable.render(),$.when(i).done((function(t,i,a){e.addUserToProfile(a)}))},addUserToProfile:function(e){var t=this,i=(t.getContent(),{idProfile:t.profileId,profileType:t.profileTypeId,idUser:e});$.when(t.dataService.addUserToProfile(i)).done((function(e){t.getUserByProfileId(t.profileId)})).fail((function(e){bizagi.log(e)}))},setupMainButtons:function(){var e=this,t=e.getContent();$("#btn-searchUserProfiles",t).click((function(){e.searchProfiles()})),$("#btn-clearUserProfiles",t).click((function(){$("#txtTextnameProfile",t).val(""),$("#profileTypeList").val(e.comboDefaultValue),$("#profilesTableId",t).remove(),e.setupProfileComboEvent()}))},setupManageLink:function(){var e=this,t=e.getContent();$(".manageLink",t).click((function(){var t=this.getAttribute("id");e.profileId=t,e.getUserByProfileId(e.profileId)}))},setupManageButtons:function(){var e=this,t=e.getContent();$("#btn-returnUserProfiles",t).click((function(){e.setupData()})),$("#btn-downloadUserProfiles",t).click((function(){e.exportToExcel()})),$("#btn-newUserProfiles",t).click((function(){e.setupUsersSearchForm()})),$(".deleteLink",t).click((function(){e.removeUserFromProfile($(this)[0].getAttribute("id"))}))},setupProfileComboEvent:function(){var e=this.getContent(),t=$("#profileTypeList",e).find("option:selected").val();"8"==t&&$("#organizationListDiv").show(),$("#profileTypeList",e).change((function(){"8"==(t=$(this).find("option:selected").val())?$("#organizationListDiv").show():$("#organizationListDiv").hide()}))}}),bizagi.workportal.widgets.admin.dimensions.extend("bizagi.workportal.widgets.admin.dimensions",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({dimensions:bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions"),"dimensions.administrable":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-administrable"),"dimensions.properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-properties"),"dimensions.edit.properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.dimensions").concat("#ui-bizagi-workportal-widget-admin-dimensions-edit-properties"),useNewEngine:!1}),this.isInitialLoad=!0,this.deferGetActiveWFClasses=void 0},loadtemplates:function(){this.generalContent=this.getTemplate("dimensions"),this.listContent=this.getTemplate("dimensions.administrable"),this.detailsContent=this.getTemplate("dimensions.properties"),this.detailsEditContent=this.getTemplate("dimensions.edit.properties")},postRender:function(){this.setupData()},setupData:function(){this.setupInitialData()},setupInitialData:function(){var e=this.getContent(),t=$("#column-dimensions-admin-wrapper",e),i=$("#column-dimensions-properties-wrapper",e),a=$.tmpl(this.listContent,{}),s=$.tmpl(this.detailsContent,{});t.html(a),i.html(s),this.setupListProcessPanel1(),this.setupListProcessPanel2(),this.setupMainButtonsleft(),this.setupMainButtonsRight()},setupDimensionsPanel1:function(e){var t=this,i=t.getContent(),a=$.Deferred();return $.when(t.dataService.getDimensions()).done((function(s){t.dimensions=s;var n=$("#DimenListAdmin",i),r=$("#DimenListFixed",i);n.find("dt").hide(),$("dd",n).remove(),$("dd",r).remove(),$.each(s.dimensions,(function(e,i){var a,s=t.isInitialLoad?"ddDimensionsSelect hiddenDimensionsSelect":"ddDimensionsSelect";bizagi.util.parseBoolean(i.administrable)?(a=n.find("dt#admin_"+i.idWfClass)).append('<dd id="'+i.id+'" class="'+s+'"><span>'+i.displayName+"</span></dd>"):(a=r.find("dt#fixed_"+i.guidWfClass.toLowerCase())).append('<dd id="'+i.guid+'" class="'+s+'"><span>'+i.displayName+"</span></dd>");a.show()})),t.isInitialLoad&&setTimeout((function(){n.find("dd").removeClass("hiddenDimensionsSelect"),r.find("dd").removeClass("hiddenDimensionsSelect")}),500),t.isInitialLoad=!1,t.setupManageLink(),e&&t.setupDimensionsPanel2(),a.resolve()})),a.promise()},getProcessEntityPath:function(e){return e.split(".")[0]},getNameEntityPath:function(e){return(e=e.split(".")).shift(),e.join(".")},setupDimensionsPanel2:function(){this.getContent();if(this.dimensions.dimensions.length>0){var e,t=this.dimensions.dimensions[0],i=t.description,a=t.displayName,s=t.id,n=t.guid||"",r=t.idWfClass,o=t.guidWfClass||"",l=t.administrable,d=t.name,c=t.entityPath;this.fullPath=c,e=this.getNameEntityPath(c),$("#lblNameRead").text(d),$("#lblDisplayNameRead").text(a),$("#lblProcessRead").text(this.getProcessEntityPath(c)),$("#lblDescriptionRead").text(i),$("#lblPhatRead").text(e),l?($("#lblId").val(s),$("#lblidWfClass").val(r)):($("#lblId").val(n),$("#lblidWfClass").val(o)),$("#lblIsAdministrable").val(l),bizagi.util.parseBoolean(l)||($("#btn-deleteDimensions").hide(),$("#btn-editDimensions").hide())}else $("#content-table-dimensions-admin").hide()},setupListProcessPanel1:function(){var e=this,t=e.getContent();$.when(e.getActiveWFClasses()).done((function(i){e.processList=i;var a=$("#DimenListAdmin",t),s=$("#DimenListFixed",t);$.each(i.WFClasses,(function(e,t){a.append("<dt id=admin_"+t.id+' class="titleDimensionProcess">'+t.displayName+"</dt>"),s.append("<dt id=fixed_"+t.guid+' class="titleDimensionProcess">'+t.displayName+"</dt>")})),e.setupDimensionsPanel1(!0)}))},setupListProcessPanel2:function(){this.getContent();$.when(this.getActiveWFClasses()).done((function(e){$.each(e,(function(e,t){$.each(t,(function(e,t){var i=t.displayName;$("#lblProcessRead").text(i)}))}))}))},displayDimensionsById:function(e){var t=this;t.getContent();$.each(t.dimensions.dimensions,(function(i,a){return void 0!==a.guid&&a.guid.toLowerCase()===e.toLowerCase()?(t.fillFieldsWithSelectedDimension(a,e),!1):void 0===a.guid&&a.id==e?(t.fillFieldsWithSelectedDimension(a,e),!1):void 0})),$("#content-table-dimensions-edit").remove(),$("#content-table-dimensions-admin").show()},fillFieldsWithSelectedDimension:function(e,t){this.getContent();var i,a=e.description,s=e.displayName,n=e.name,r=e.entityPath,o=e.idWfClass,l=e.administrable;this.fullPath=r,i=this.getNameEntityPath(r),$("#lblNameRead").text(n),$("#lblDisplayNameRead").text(s),$("#lblDescriptionRead").text(a),$("#lblProcessRead").text(this.getProcessEntityPath(r)),$("#lblPhatRead").text(i),$("#lblId").val(t),$("#lblIsAdministrable").val(l),$("#lblidWfClass").val(o),this.displayProcessById(o),bizagi.util.parseBoolean(l)?($("#btn-deleteDimensions").show(),$("#btn-editDimensions").show(),$("#img_select_path").focus()):($("#btn-deleteDimensions").hide(),$("#btn-editDimensions").hide())},displayProcessById:function(e){this.getContent();$.when(this.getActiveWFClasses()).done((function(t){$.each(t,(function(t,i){$.each(i,(function(t,i){var a=i,s=a.Id||a.id;if(e==s){var n=a.displayName;return $("#lblProcessRead").text(n),!1}}))}))}))},getActiveWFClasses:function(){var e=function(e,t){$.when(e.dataService.getActiveWFClasses()).done((function(i){t.resolve(i),e.cleanDeferGetActiveWFClasses()}))};return function(t,i){return void 0===i&&(i=t.newDeferGetActiveWFClasses(),e(t,i)),i}(this,this.deferGetActiveWFClasses)},cleanDeferGetActiveWFClasses:function(){this.deferGetActiveWFClasses=void 0},newDeferGetActiveWFClasses:function(){return this.deferGetActiveWFClasses=new $.Deferred,this.deferGetActiveWFClasses},newDimensionAdmin:function(){var e=$.tmpl(this.detailsEditContent,{processList:this.processList.WFClasses});this.action="create",$("#content-table-dimensions-edit").remove(),$("#content-table-dimensions-admin").hide(),$("#column-dimensions-properties-wrapper").append(e),this.setupManageButtons(),this.processComboOnChange(),$("#btn-newDimensions").unbind("click"),this.setupPathLink()},validateData:function(){var e,t=/[`~!@#$%^&*()|+\-=?;:..'"<>,\{\}\[\]\\\/]+/gi,i=this.getContent();if(""==$.trim($("#txtNameEdit",i).val())?e=bizagi.localization.getResource("workportal-widget-admin-dimensions-text-name"):""==$.trim($("#txtDisplayNameEdit",i).val())?e=bizagi.localization.getResource("workportal-widget-admin-dimensions-text-displayName"):""==$("#txtPhatEdit",i).val()&&(e=bizagi.localization.getResource("workportal-widget-admin-dimensions-text-path")),e)bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-dimensions-comfirm-message")+": "+e,"Bizagi","warning");else if(t.test($("#txtNameEdit",i).val()))bizagi.showMessageBox(bizagi.localization.getResource("bz-rp-sensorsedt-formvalidation-invalidcharts")+": "+bizagi.localization.getResource("workportal-widget-admin-dimensions-text-name"));else{if(!t.test($("#txtDisplayNameEdit",i).val()))return"true";bizagi.showMessageBox(bizagi.localization.getResource("bz-rp-sensorsedt-formvalidation-invalidcharts")+": "+bizagi.localization.getResource("workportal-widget-admin-dimensions-text-displayName"))}},applyDimensionsAdmin:function(){var e=this,t=(e.getContent(),$("#txtDisplayNameEdit").val()),i=$("#txtNameEdit").val(),a=$("#processTypeList").val(),s=$("#txtDescriptionEdit").val(),n={displayName:t,name:i,idWfClass:a,entityPath:e.fullPath,description:s};"true"==e.validateData()&&$.when(e.dataService.createAdministrableDimension(n)).done((function(t){t.id?(e.setupMainButtonsleft(),$("#content-table-dimensions-edit").hide(),$("#content-table-dimensions-admin").show(),$.when(e.setupDimensionsPanel1(!1)).done((function(){e.displayDimensionsById(t.id)}))):bizagi.showMessageBox(t.message,"Bizagi","warning")})).fail((function(e){var t=jQuery.parseJSON(e.responseText);bizagi.showMessageBox(t.message,"Bizagi","warning")}))},cancelDimensionsAdmin:function(){this.getContent();$("#content-table-dimensions-edit").remove(),this.dimensions.dimensions.length>0&&$("#content-table-dimensions-admin").show(),this.setupMainButtonsleft()},deleteDimensionsAdmin:function(e){var t=this,i=(t.getContent(),{id:$("#lblId").val(),administrable:$("#lblIsAdministrable").val()});$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-dimensions-invalidate-confirm-msg"),"Bizagi","warning")).done((function(){$.when(t.dataService.deleteDimension(i)).done((function(e){t.setupData()})).fail((function(e){bizagi.log(e)}))}))},showEditInfo:function(){var e=$.tmpl(this.detailsEditContent,{processList:this.processList.WFClasses});this.action="edit",$("#content-table-dimensions-admin").hide(),$("#column-dimensions-properties-wrapper").append(e),$("#processTypeList").val($("#lblidWfClass").val()),$("#txtNameEdit").val($("#lblNameRead").text()),$("#txtDisplayNameEdit").val($("#lblDisplayNameRead").text()),$("#txtDescriptionEdit").val($("#lblDescriptionRead").text()),$("#txtPhatEdit").val($("#lblPhatRead").text()),this.setupManageButtons(),this.processComboOnChange(),this.setupMainButtonsleft(),this.setupPathLink(),$("#img_select_path.iconSelectPath").focus()},editDimensionsAdmin:function(){var e=this,t=(e.getContent,$("#lblId").val()),i=$("#txtDisplayNameEdit").val(),a=$("#txtNameEdit").val(),s=$("#processTypeList").val(),n=$("#txtDescriptionEdit").val(),r={id:t,displayName:i,name:a,idWfClass:s,entityPath:e.fullPath,description:n},o=e.validateData(),l=e.getNameEntityPath(e.fullPath);"true"==o&&$.when(e.dataService.editDimension(r)).done((function(r){r.id?($("#lblidWfClass").val(s),$("#lblNameRead").text(a),$("#lblDisplayNameRead").text(i),$("#lblDescriptionRead").text(n),$("#lblPhatRead").text(l),$("#lblProcessRead").text($("#processTypeList option[value="+$("#processTypeList").val()+"]").text()),$("#lblId").val(t),$("#content-table-dimensions-edit").remove(),$("#content-table-dimensions-admin").show(),e.setupDimensionsPanel1(!1)):bizagi.showMessageBox(r.message,"Bizagi","warning")})).fail((function(e){var t=jQuery.parseJSON(e.responseText);bizagi.showMessageBox(t.message,"Bizagi","warning")}))},displayPath:function(){var e=this.getContent;$("#entities-tree-wrapper",e).show(),$("#entities-tree-wrapper").draggable(),$("#shadow-panel").css({width:$(".ui-dialog").width(),height:$(".ui-dialog").height(),"background-color":"grey",opacity:.1}),this.setupEntitiesTree(),this.setupEntitiesTreeButtons()},setupEntitiesTree:function(){var e=this.getContent();this.entitiesTree=new bizagi.workportal.widgets.entitiestree(this.workportalFacade,this.dataService,$.extend(this.params,{canvas:$("#tree-content",e),idWfClass:$("#lblidWfClass").val()})),this.entitiesTree.render()},setupMainButtonsleft:function(){var e=this,t=e.getContent();$("#btn-newDimensions",t).click((function(){e.newDimensionAdmin()}))},setupMainButtonsRight:function(){var e=this,t=e.getContent();$("#btn-editDimensions",t).click((function(){e.showEditInfo()})),$("#btn-deleteDimensions",t).click((function(){e.deleteDimensionsAdmin()}))},setupManageButtons:function(){var e=this,t=e.getContent();$("#btn-applyDimensions",t).click((function(){"create"==e.action?e.applyDimensionsAdmin():e.editDimensionsAdmin()})),$("#btn-cancelDimensions",t).click((function(){e.cancelDimensionsAdmin()}))},setupManageLink:function(){var e=this,t=e.getContent();$(".ddDimensionsSelect",t).click((function(){var t=this.getAttribute("id");e.dimensionId=t,e.displayDimensionsById(e.dimensionId),e.setupMainButtonsleft()}))},setupPathLink:function(){var e=this,t=e.getContent();$("#img_select_path").focus(),$("#img_select_path",t).click((function(){e.displayPath()}))},processComboOnChange:function(){this.getContent();$("#processTypeList").click((function(){$("#txtPhatEdit").val("")}))},setupEntitiesTreeButtons:function(){var e=this,t=e.getContent();$("#btn-close-tree",t).unbind("click").bind("click",(function(){$("#entities-tree-wrapper",t).hide(),$("#tree-content",t).html(""),$("#shadow-panel").removeAttr("style")})),$("#btn-cancel-tree",t).unbind("click").bind("click",(function(){$("#entities-tree-wrapper",t).hide(),$("#tree-content",t).html(""),$("#shadow-panel").removeAttr("style")})),$("#btn-save-tree",t).unbind("click").bind("click",(function(){var i=e.entitiesTree.getTreeRouteSelected();e.fullPath=i.path,$("#txtPhatEdit",t).val(i.name),$("#entities-tree-wrapper",t).hide(),$("#tree-content",t).html(""),$("#shadow-panel").removeAttr("style")}))}}),bizagi.workportal.widgets.admin.alarms.extend("bizagi.workportal.widgets.admin.alarms",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({alarms:bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms"),"alarms.task.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-list"),"alarms.task.list.item":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-list-item"),"alarms.task.detail":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail"),"alarms.task.detail.alarm.editor":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-alarm-editor"),"alarms.task.detail.list.table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail-list-table"),"alarms.task.detail.alarm.recipients":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail-alarm-recipients"),"alarms.task.detail.alarm.recipients.table":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.alarms").concat("#ui-bizagi-workportal-widget-admin-alarms-detail-alarm-recipients-table"),useNewEngine:!1})},postRender:function(){this.containtersID={GENERAL:"general",DETAIL:"detail"},this.listID={APPLICATION:{name:"ListBoxApplication",update:"WORKFLOW",serviceMethod:"getApplicationCategoriesList"},WORKFLOW:{name:"ListBoxWFClass",update:"VERSION",serviceMethod:"getApplicationProcesses"},VERSION:{name:"ListBoxWFVersion",update:"TASKS",serviceMethod:"getProcessVersion"},TASKS:{name:"ListBoxWorkFlow",update:"",serviceMethod:"getProcessTasks"}},this.widgetMode={VIEW_MODE:"viewMode",EDIT_MODE:"editMode"},this.alertData={},this.taskListTmpl=this.getTemplate("alarms.task.list"),this.taskListItemTmpl=this.getTemplate("alarms.task.list.item"),this.taskDetailTmpl=this.getTemplate("alarms.task.detail"),this.taskDetailAlarmEditor=this.getTemplate("alarms.task.detail.alarm.editor"),this.taskListTableTmpl=this.getTemplate("alarms.task.detail.list.table"),this.taskDetailAlarmRecipientsTmpl=this.getTemplate("alarms.task.detail.alarm.recipients"),this.taskDetailAlarmRecipientsTableTmpl=this.getTemplate("alarms.task.detail.alarm.recipients.table"),this.initRenderTaskList()},initRenderTaskList:function(){var e=this;e.switchContent(e.containtersID.GENERAL);$.when(e.dataService.getApplicationCategoriesList({action:"Applications"})).done((function(t){e.renderTaskList(t)}))},renderTaskList:function(e){var t=this,i=this.getContent(),a=$("#form-alarm-task-list",i);a.empty(),$.tmpl(t.taskListTmpl).appendTo(a),t.fillTaskListColumnByID("APPLICATION",e),$("#btn-alarms",a).click((function(e){t.alertData&&t.alertData.idTask&&""!=t.alertData.idTask&&$.when(t.dataService.getTaskAlarms({idTask:t.alertData.idTask}),t.dataService.getLapseMode(),t.dataService.getRecurrMode(),t.dataService.getScheduleType(),t.dataService.getBossList()).done((function(e,i,a,s,n,r){t.renderTaskDetail(),t.renderTaskListTable(e[0]),t.renderAlarmEditor(i[0],a[0],s[0]),t.renderAlarmRecipients(n[0],!0),t.switchContent(t.containtersID.DETAIL),t.switchWidgetMode(t.widgetMode.VIEW_MODE)}))}))},renderTaskDetail:function(){var e=this,t=this.getContent(),i=$("#form-alarm-task-detail",t);i.empty();var a=e.alertData.idAppText,s=e.alertData.idWFClassText,n=e.alertData.versionText,r=e.alertData.idTaskText,o=e.getTemplate("alarms.task.detail"),l=$.tmpl(o,{application:a,workflow:s,version:n,task:r});i.append(l).show(),$("#btn-alarm-browser",i).click((function(){e.alertData={},e.initRenderTaskList()})),$("#btn-disable-alarms",i).click((function(){e.callEnableDisableAlarmsService()})),$("#btn-enable-alarms",i).click((function(){e.callEnableDisableAlarmsService()})),$("#btn-save-changes",i).click((function(){var t=e.validateAlarmEditor();""==t?e.sendAlarmEditorData(!0):bizagi.showMessageBox(t,"Bizagi","warning")})),$("#btn-back",i).click((function(){e.switchWidgetMode(e.widgetMode.VIEW_MODE),e.clearSelectedAlarm(),e.resetAlarmEditor(),e.resetAlarmRecipientsTable()})),$("#btn-add-alarm",i).click((function(){var t=e.validateAlarmEditor();""==t?e.sendAlarmEditorData():bizagi.showMessageBox(t,"Bizagi","warning")}))},renderAlarmEditor:function(e,t,i){var a=this,s=this.getContent(),n=$("#form-alarm-task-detail",s),r=$("#alarm-editor-form-wrapper",n);r.empty(),a.alarmEditorData||(a.localizateScheduleType(i.scheduleType),a.alarmEditorData={lapseModeList:e.lapseMode,recurrModeList:t.recurrMode,scheduleTypeList:i.scheduleType}),$.tmpl(a.taskDetailAlarmEditor,{lapseModeList:a.alarmEditorData.lapseModeList,recurrModeList:a.alarmEditorData.recurrModeList,scheduleTypeList:a.alarmEditorData.scheduleTypeList}).appendTo(r),$("input:radio[name=RadioButtonListLapseMode]",n).on("change",(function(e){a.handleRadioButtonFields(e.currentTarget)})),$("input:radio[name=RadioButtonListRecurMode]",n).on("change",(function(e){a.handleRadioButtonFields(e.currentTarget)})),$("#TextBoxAlarmTime",n).on("change",(function(e){a.validateInputFields(e.currentTarget)})),$("#TextBoxRecurTime",n).on("change",(function(e){a.validateInputFields(e.currentTarget)}))},localizateScheduleType:function(e){for(var t=0;t<e.length;t+=1)e[t].displayName=bizagi.localization.getResource("workportal-general-word-time-"+e[t].displayName.toLowerCase())},sendAlarmEditorData:function(e){var t,i=this,a=this.getContent(),s=$("#form-alarm-task-detail",a),n=$("#alarm-editor-form-wrapper",s),r=$("#CheckBoxToCurrentAssignee",n).is(":checked"),o={};o.idTask=i.alertData.idTask,o.idRecurrMode=$("input:radio[name=RadioButtonListRecurMode]:checked").val(),o.idLapseMode=$("input:radio[name=RadioButtonListLapseMode]:checked").val(),o.scheduleType=$("#DropDownListRecurTime",n).val(),o.alarmTime=$("#TextBoxAlarmTime",n).val(),o.alarmRecurrTime=$("#TextBoxRecurTime",n).val(),""==o.alarmTime&&(o.alarmTime=0),""==o.alarmRecurrTime&&(o.alarmRecurrTime=0),!0===r?o.sendToCurrentAssignee=1:!1===r&&(o.sendToCurrentAssignee=0),e?(o.idAlarm=i.selectedAlarm.idAlarm,t="editAlarm"):t="addAlarm",$.when(i.dataService[t](o)).done((function(e){e.response&&i.refreshTaskListTable()}))},refreshTaskListTable:function(){var e=this;e.clearSelectedAlarm(),e.resetAlarmEditor(),e.switchWidgetMode(e.widgetMode.VIEW_MODE),$.when(e.dataService.getTaskAlarms({idTask:e.alertData.idTask})).done((function(t){e.renderTaskListTable(t)}))},refreshAlarmRecipientsTable:function(){var e=this,t={idAlarm:e.selectedAlarm.idAlarm};$.when(e.dataService.getAlarmRecipients(t)).done((function(t){e.renderAlarmRecipientsTable(t)}))},renderTaskListTable:function(e){var t=this,i=this.getContent(),a=$("#form-alarm-task-detail",i),s=$("#alarm-list-table-wrapper",a);s.empty(),$.tmpl(t.taskListTableTmpl,{alarmList:e.alarms}).appendTo(s),t.alarmsList=[].concat(e.alarms),t.alarmsList.length>0&&"true"==t.alarmsList[0].active?t.switchEnableAlarms(!0):t.switchEnableAlarms(!1),t.selectedAlarm=void 0,$(".edit",s).click((function(e){t.switchWidgetMode(t.widgetMode.EDIT_MODE),t.clearSelectedAlarm(),$($(e.currentTarget).closest("tr")[0]).addClass("selected"),t.fillAlarmDetailForm($(e.currentTarget).data("idalarm"));var i={idAlarm:$(e.currentTarget).data().idalarm};$.when(t.dataService.getAlarmRecipients(i)).done((function(e){t.renderAlarmRecipientsTable(e)}))})),$(".delete",s).click((function(e){var i=$(e.currentTarget).data("idalarm");$.when(t.dataService.deleteAlarm({idAlarm:i})).done((function(e){!0===e.response&&(t.switchWidgetMode(t.VIEW_MODE),t.refreshTaskListTable())}))}))},clearSelectedAlarm:function(){var e=this.getContent(),t=$("#alarm-list-table-wrapper",e);$("tr",t).removeClass("selected"),this.selectedAlarm=void 0},resetAlarmEditor:function(){for(var e=this.getContent(),t=$("#alarm-editor-form-wrapper",e),i=$("input[name = RadioButtonListLapseMode]",t).length+1;i-- >1;)$("input[name=RadioButtonListLapseMode][value="+i+"]",t)[0].checked=!1,$("input[name=RadioButtonListRecurMode][value="+i+"]",t)[0].checked=!1;$("#TextBoxAlarmTime",t).val(""),$("#TextBoxRecurTime",t).val(""),$("#DropDownListRecurTime",t).val("1"),$("#CheckBoxToCurrentAssignee",t).attr("checked",!1),this.resetAlarmRecipientsTable()},resetAlarmRecipientsTable:function(){var e=this.getContent();$("#alarm-recipients-table-wrapper",e).empty(),$("#DropDownListRecipients",e).val(0)},renderAlarmRecipients:function(e,t){var i=this,a=this.getContent(),s=$("#form-alarm-task-detail",a),n=$("#alarm-recipients-form-wrapper",s);$.tmpl(i.taskDetailAlarmRecipientsTmpl,{bossList:e.bosses}).appendTo(n),$("#btn-add-recipient",n).click((function(){if(i.currentWidgetMode==i.widgetMode.EDIT_MODE){var e={idRecipient:$("#DropDownListRecipients",n).val(),idAlarm:i.selectedAlarm.idAlarm};e.idRecipient?$.when(i.dataService.addRecipientToAlarm(e)).done((function(e){!0===e.response?i.refreshAlarmRecipientsTable():bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-error"),"Bizagi","warning")})):bizagi.showMessageBox(bizagi.localization.getResource("workportal-general-word-select-one-option"),"Bizagi","warning")}})),$("#btn-delete-recipient",n).click((function(){if(i.currentWidgetMode==i.widgetMode.EDIT_MODE){var e=$("#alarm-recipients-table-wrapper",s),t=$("input:checked",e);if(t.length>0){for(var a=[],n=t.length;n-- >0;)a.push($(t[n]).data("idrecipient"));var r={idRecipients:JSON.stringify({recipients:a})};$.when(i.dataService.deleteRecipientsFromAlarm(r)).done((function(e){e.deletedRecipients.length>0&&i.refreshAlarmRecipientsTable()}))}}}))},renderAlarmRecipientsTable:function(e){var t=this.getContent(),i=$("#form-alarm-task-detail",t),a=$("#alarm-recipients-table-wrapper",i);a.empty(),$.tmpl(this.taskDetailAlarmRecipientsTableTmpl,{recipientsList:e.recipients}).appendTo(a)},fillAlarmDetailForm:function(e){for(var t,i=this.getContent(),a=$("#form-alarm-task-detail",i),s=$("#alarm-editor-form-wrapper",a),n=this.alarmsList.length;n-- >0;)if(this.alarmsList[n].idAlarm==e){t=this.alarmsList[n];break}this.selectedAlarm=t,$("input[name=RadioButtonListLapseMode][value="+t.idLapseMode+"]",s)[0].checked=!0,$("input[name=RadioButtonListRecurMode][value="+t.idRecurrMode+"]",s)[0].checked=!0,$("#TextBoxAlarmTime",s).val(t.alarmTime),$("#TextBoxRecurTime",s).val(t.alarmRecurrTime),$("#DropDownListRecurTime",s).val(t.idScheduleType),$("#CheckBoxToCurrentAssignee",s).prop("checked",t.sendToCurrAssignee)},handleRadioButtonFields:function(e){var t=this.getContent(),i=$("#alarm-editor-form-wrapper",t),a=e.value;"RadioButtonListLapseMode"==e.name?2!=a?$("#TextBoxAlarmTime",i).attr("disabled",!1):($("#TextBoxAlarmTime",i).val(""),$("#TextBoxAlarmTime",i).attr("disabled",!0)):"RadioButtonListRecurMode"==e.name&&(1!=a?($("#TextBoxRecurTime",i).attr("disabled",!0),$("#TextBoxRecurTime",i).val("")):$("#TextBoxRecurTime",i).attr("disabled",!1))},validateInputFields:function(e){var t=this.getContent(),i=($("#alarm-editor-form-wrapper",t),parseInt(e.value));if(isNaN(i))e.value="";else if(i<0)e.value=-1*i;else if(i>2147483647)e.value=2147483647;else if("TextBoxAlarmTime"==e.id){var a=$($("input:radio[name=RadioButtonListLapseMode][checked=checked]")[0]).val(),s=i;2!=a&&i>0||"Unless the selected lapse mode is On Expiration the alarm time cannot be empty"}else if("TextBoxRecurTime"==e.id){$($("input:radio[name=RadioButtonListRecurMode][checked=checked]")[0]).val();1==a&&s>0||"Please review the Alarm Editor fields, the folowing are empty or unselected"}},validateAlarmEditor:function(){var e=this.getContent(),t="",i=$("#alarm-editor-form-wrapper",e),a=$("input:radio[name=RadioButtonListLapseMode]:checked").val(),s=$("#TextBoxAlarmTime",i).val(),n=$("input:radio[name=RadioButtonListRecurMode]:checked").val(),r=$("#TextBoxRecurTime",i).val();return a?2!=a&&s>0||2==a&&(""==s||0==s)||(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-error-message-on-expiration")+"</li>"):(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-field-title-lapse")+"</li>",""==s&&(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-group-title-timing")+" - "+bizagi.localization.getResource("workportal-widget-admin-alarms-field-title-lapse")+"</li>")),n?1!=n&&(""==r||0==r)||1==n&&r>0||(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-error-message-each-recurr")+"</li>"):(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-group-title-alarm-recur")+"</li>",""==r&&(t+="<li>"+bizagi.localization.getResource("workportal-widget-admin-alarms-group-title-timing")+" - "+bizagi.localization.getResource("workportal-widget-admin-alarms-field-title-alarm-recur-time")+"</li>")),""!=t&&(t=bizagi.localization.getResource("workportal-widget-admin-alarms-error-message-review")+"</br></br> <ul>"+t+"</ul>"),t},fillTaskListColumnByID:function(e,t){var i=this,a=this.getContent(),s=i.listID[e],n=$("#form-alarm-task-list",a),r=$("#"+s.name,n);switch(e){case"APPLICATION":$.tmpl(i.taskListItemTmpl,{taskField:e,elementList:t.items}).appendTo(r);break;case"WORKFLOW":$.tmpl(i.taskListItemTmpl,{taskField:e,elementList:t.processes}).appendTo(r);break;case"VERSION":$.tmpl(i.taskListItemTmpl,{taskField:e,elementList:t.versions}).appendTo(r);break;case"TASKS":$.tmpl(i.taskListItemTmpl,{taskField:e,elementList:t.tasks}).appendTo(r)}r.unbind("change"),r.bind("change",(function(e){i.updateListsContent(e.currentTarget)}))},updateListsContent:function(e){var t=this,i=t.getListCategoryByID(e.id);t.captureSelectedData(i,e);var a=t.getElementToUpdate(e.id);if(""!=a){var s;t.processLists(e.id),s=t.setupParametersbyListID(a),$.when(t.dataService[t.listID[a].serviceMethod](s)).done((function(e){t.fillTaskListColumnByID(a,e)}))}},captureSelectedData:function(e,t){switch(e){case"APPLICATION":this.alertData.idApp=$(t.options[t.selectedIndex]).val(),this.alertData.idAppText=t.options[t.selectedIndex].text;break;case"WORKFLOW":this.alertData.idWFClass=$(t.options[t.selectedIndex]).val(),this.alertData.idWFClassText=t.options[t.selectedIndex].text;break;case"VERSION":this.alertData.version=$(t.options[t.selectedIndex]).val(),this.alertData.versionText=t.options[t.selectedIndex].text;break;case"TASKS":this.alertData.idTask=$(t.options[t.selectedIndex]).val(),this.alertData.idTaskText=t.options[t.selectedIndex].text}},setupParametersbyListID:function(e){var t={};switch(e){case"APPLICATION":t={action:"getApplications"};break;case"WORKFLOW":t.idApp=this.alertData.idApp;break;case"VERSION":t.idWFClass=this.alertData.idWFClass;break;case"TASKS":t.idWFClass=this.alertData.idWFClass,t.version=this.alertData.version}return t},resetParametersbyListID:function(e){switch(e){case"APPLICATION":this.alertData.idApp="";break;case"WORKFLOW":this.alertData.idWFClass="";break;case"VERSION":this.alertData.version="";break;case"TASKS":this.alertData.idTask=""}},processLists:function(e){var t=this.getContent(),i=$("#form-alarm-task-list",t),a=this.getElementToUpdate(e);if(""!=a)for($("#"+this.listID[a].name,i).empty(),this.resetParametersbyListID(a);""!=a;)""!=(a=this.getElementToUpdate(this.listID[a].name))&&($("#"+this.listID[a].name,i).empty(),$("#"+this.listID[a].name,i).empty())},getElementToUpdate:function(e){var t=this.getListCategoryByID(e);return this.listID[t].update},getListCategoryByID:function(e){for(var t in this.listID)if(e==this.listID[t].name)return t;return""},callEnableDisableAlarmsService:function(){var e=this,t={idTask:e.alertData.idTask};$.when(e.dataService.enableAlarm(t)).done((function(t){!0===t.response&&(e.switchEnableAlarms(),e.refreshTaskListTable())}))},switchEnableAlarms:function(e){var t=this.getContent(),i=$("#form-alarm-task-detail",t);e?($("#btn-enable-alarms",i).hide(),$("#btn-disable-alarms",i).show()):($("#btn-enable-alarms",i).show(),$("#btn-disable-alarms",i).hide())},switchContent:function(e){var t=this.getContent(),i=$("#form-alarm-task-list",t),a=$("#form-alarm-task-detail",t);this.containtersID.DETAIL==e?(i.hide(),a.show()):(i.show(),a.hide())},switchWidgetMode:function(e){var t=this.getContent(),i=($("#form-alarm-task-list",t),$("#form-alarm-task-detail",t));switch(e){case this.widgetMode.VIEW_MODE:$("#btn-save-changes",i).hide(),$("#btn-back",i).hide(),$("#btn-delete-recipient",i).show(),$("#alarm-recipients-table-content",i).show(),$("#btn-add-recipient",i).show(),$("#btn-add-alarm",i).show();break;case this.widgetMode.EDIT_MODE:$("#btn-save-changes",i).show(),$("#btn-back",i).show(),$("#btn-delete-recipient",i).show(),$("#alarm-recipients-table-content",i).show(),$("#btn-add-recipient",i).show(),$("#btn-add-alarm",i).hide()}this.currentWidgetMode=e}}),bizagi.workportal.widgets.admin.user.licenses.extend("bizagi.workportal.widgets.admin.user.licenses",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"user.licenses":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.user.licenses").concat("#ui-bizagi-workportal-widget-admin-user-licenses"),useNewEngine:!1}),this.serviceLocator=t.serviceLocator},loadtemplates:function(){this.generalContent=this.getTemplate("user.licenses")},postRender:function(){this.setupData()},setupData:function(){this.setupInitialData(),this.setupButton()},setupInitialData:function(){this.getContent();$.when(this.dataService.licenses()).done((function(e){if("none"==e.licenseType)$("#licenseAlert").show(),$("#licenseContent").hide();else{if($("#licenseContent").show(),$("#licenseAlert").hide(),""==e.expirationDate)var t="12/31/9999";else t=e.expirationDate.substring(0,11);"Volume"==e.licenseType?$("#users").text(e.activeUsers+" "+bizagi.localization.getResource("workportal-widget-admin-user-licenses-titles-usersLicenses-text")):$("#users").text(e.activeUsers+"/"+e.licensedUsersAccount+"  "+bizagi.localization.getResource("workportal-widget-admin-user-licenses-titles-usersLicenses-text")),$("#licenses").text(e.customerName),$("#date").text(t),$("#licenseType").text(e.licenseType),$("#licenseCluster").text(e.clustered)}$("#cases-tabs").tabs()}))},setupButton:function(){var e=this,t=e.getContent();$("#btn-buyNowLicenses",t).click((function(e){window.open("http://www.bizagi.com/","name","height=600,width=1000,resizable=yes")})),$("#btn-auditLicenses",t).click((function(t){$.when(e.dataService.getAuditLicense()).done((function(e){})).fail((function(e){}))})),e.downloadBPUs()},downloadBPUs:function(){var e=this,t=e.getContent();$("#btn-download-bpus",t).click((function(t){var i=e.serviceLocator.getUrl("downloadBPUsReport"),a="xsrf="+bizagi.getXSRFToken();i=-1!==i.indexOf("?")?i.concat("&"+a):i.concat("?"+a),bizagi.util.downloadFile(i,!0)}))}}),bizagi.workportal.widgets.admin.document.templates.extend("bizagi.workportal.widgets.admin.document.templates",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.document.templates":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.document.templates").concat("#ui-bizagi-workportal-widget-admin-document-templates"),"admin.document.templates.upload.template":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.document.templates").concat("#ui-bizagi-workportal-widget-admin-document-templates-upload-template"),"admin.document.templates.uploaded.templates.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.document.templates").concat("#ui-bizagi-workportal-widget-admin-document-templates-uploaded-template-list"),useNewEngine:!1})},postRender:function(){this.uploadTemplateTmpl=this.getTemplate("admin.document.templates.upload.template"),this.uploadedTemplatesTmpl=this.getTemplate("admin.document.templates.uploaded.templates.list"),this.lockedInteractions=!1,this.config={maxSize:"31457280",validExtensions:".bdt",xpath:"documentTemplates",uploadDialogTemplateName:"upload.template.dialog"},this.renderUploadForm(),this.initUploadedTemplates()},initUploadedTemplates:function(){var e=this,t=e.getContent();$("#uploaded-template-list-wrapper",t).empty(),$.when(e.dataService.storeDocumentTemplates()).done((function(t){e.renderUploadedTemplates(t)}))},renderUploadForm:function(){var e=this,t=e.getContent(),i=$("#template-upload-form-wrapper",t);$.tmpl(e.uploadTemplateTmpl).appendTo(i);var a=null!=_typeof(e.dataService.serviceLocator.proxyPrefix)?e.dataService.serviceLocator.proxyPrefix:"";bizagi.loader.start("rendering").then((function(){var t=new bizagi.rendering.facade({proxyPrefix:a});e.dialogTemplate=t.deviceFactory.cachedFactory.getTemplate(e.config.uploadDialogTemplateName),e.dialogTemplate?e.addFormInteractions():$.when(t.deviceFactory.getRenderFactory()).done((function(){e.dialogTemplate=t.deviceFactory.cachedFactory.getTemplate(e.config.uploadDialogTemplateName),e.addFormInteractions()}))}))},renderUploadedTemplates:function(e){var t=this,i=t.getContent(),a=$("#uploaded-template-list-wrapper",i);a.empty(),$.tmpl(t.uploadedTemplatesTmpl,{documentTemplates:e.documentTemplate}).appendTo(a),$(".template-to-recover",a).click((function(e){if(e.preventDefault(),!t.lockedInteractions){t.lockedInteractions=!0;var i={Guid:$(e.currentTarget).data("guid")};$.when(t.dataService.restoreDocumentTemplates(i)).done((function(e){t.lockedInteractions=!1,e.DocumentTemplateRestored&&(t.initUploadedTemplates(),t.displayMessage(e))}))}}))},addFormInteractions:function(){var e=this,t=e.getContent(),i={};i.addUrl=e.dataService.serviceLocator.getUrl("admin-document-templates-uploadDocumentTemplate"),i.xpath=e.config.xpath,i.idRender="",i.xpathContext="",i.idPageCache="",i.sessionId="",i.validExtensions=e.config.validExtensions,i.maxSize=e.config.maxSize,i.contexttype="",i.maxfiles="1",i.filesCount="";var a=$("#template-upload-form-wrapper",t);$(".ui-bizagi-render-upload-wrapper",a).bizagiUpload({renderReference:this,dialogTemplate:e.dialogTemplate,properties:{url:i.addUrl,xpath:i.xpath,idRender:i.idRender,xpathContext:i.xpathContext,idPageCache:i.idPageCache,idSession:i.sessionId,validExtensions:i.validExtensions,maxSize:i.maxSize,contexttype:i.contexttype},onUploadFileCompletedCallback:function(t,i){e.displayMessage(JSON.parse(i)),e.initUploadedTemplates()},maxAllowedFiles:i.maxfiles,uploadedFiles:i.filesCount,dialogTitle:e.getResource("render-upload-link-label")})},displayMessage:function(e){var t=this.getContent(),i=$("#message-container",t);i.show(),1==e.DocumentTemplateRestored?($("#template-uploaded",i).hide(),$("#template-recovered",i).show(),$("#template-no-results",i).hide()):1==e.DocumentTemplateUploaded?($("#template-uploaded",i).show(),$("#template-recovered",i).hide(),$("#template-no-results",i).hide()):($("#template-uploaded",i).hide(),$("#template-recovered",i).hide(),$("#template-no-results",i).show())}}),bizagi.workportal.widgets.admin.processes.extend("bizagi.workportal.widgets.admin.processes",{SELECTORS:{PROCESS_DURATION:{NAME_LABEL:"#process-name",DESCRIPTION_LABEL:"#process-description",DURATION_LABEL:"#process-duration",HOURS_FIELD:"#txt-process-duration-edit-hours",MINUTES_FIELD:"#txt-process-duration-edit-minutes"},TASK_DURATION:{NAME_LABEL:"#task-name",DESCRIPTION_LABEL:"#task-description",DURATION_LABEL:"#task-duration",HOURS_FIELD:"#txt-task-duration-edit-hours",MINUTES_FIELD:"#txt-task-duration-edit-minutes"}}},_defineProperty({init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.processes.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-wrapper"),"admin.processes.combo.process":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-combo-process"),"admin.processes.proc.edit":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-process-edit"),"admin.processes.task.edit":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.processes").concat("#ui-bizagi-workportal-widget-admin-processes-task-edit"),useNewEngine:!1})},postRender:function(){var e=this;e.formType={TASK_FORM:"task",PROCESS_FORM:"process"},e.containersMode={VIEW_MODE:"viewMode",EDIT_MODE:"editMode"},$.when(e.dataService.getWorkFlowClasses()).done((function(t){e.processesData=t,e.renderSections()}))},renderSections:function(){var e=this.getContent(),t=$("#processes-header-wrapper",this.content);$.tmpl(this.comboProcess).appendTo(t);var i=$("#admin-processes-map-wrapper",this.content),a=$("#ui-process-name",this.content);this.renderProcessesCombo(a),this.renderProcessesEditWrapper(),this.loadProcessData(this.processesData.processes.length>0?this.processesData.processes[0].id:"1"),this.renderTaskEditWrapper(),this.displayTaskEdit(!1),this.processesData.processes.length>0?this.renderProcessViewer(i):$("#admin-processes-map-wrapper",e).remove()},loadProcessData:function(e){var t=this,i=t.processesData.processes.length;for(t.currentSelectedProcessData={};i-- >0;)if(e==t.processesData.processes[i].id){t.currentSelectedProcessData=t.processesData.processes[i];break}t.bindProcessDetail();var a={idWorkflow:e};$.when(t.dataService.getTaskByWorkFlow(a)).done((function(e){t.processTaskData=e}))},renderProcessViewer:function(e){var t=this,i="processId="+t.currentSelectedProcessData.id;t.viewerPlugin&&t.viewerPlugin.processviewer("destroy");t.dataService;$.when(t.dataService.processDefinition(i),t.dataService.graphicInfo(i)).done((function(i,a){t.processTaskDefinition=i[0].flowElements,t.viewerPlugin=e.processviewer({height:400,width:"100%",jsonBizagi:{processDefinition:i[0],processGraphicsInfo:a[0]},zoomRange:5}),setTimeout((function(){$(".processviewer-hotspot").click((function(e){e.preventDefault(),t.preprocessBindTaskDetail(this.id)}))}),150)}))},renderProcessesCombo:function(e){var t=this,i=(t.getContent(),$.Deferred()),a={combo:[],id:"processName"};return $.each(t.processesData.processes,(function(e,t){a.combo.push({id:t.id,name:t.name})})),e.empty(),e.uicombo({isEditable:!1,data:a,itemValue:function(e){return e.id},itemText:function(e){return e.name},onComplete:function(){i.resolve()},onChange:function(e){t.loadProcessData(e.ui.data("value")),t.loadSelectedTask(e.ui.data("value"),-1)},initValue:a.combo[0]}),i},renderProcessesEditWrapper:function(){var e=this,t=e.getContent(),i=$("#process-edit-wrapper",t),a=e.Class.SELECTORS;$.tmpl(e.processEditTmpl).appendTo(i),e.switchFormState(e.formType.PROCESS_FORM,e.containersMode.VIEW_MODE),$("#btn-process-edit",i).click((function(){e.switchFormState(e.formType.PROCESS_FORM,e.containersMode.EDIT_MODE)})),$("#btn-process-apply",i).click((function(){e.saveProcess(),e.switchFormState(e.formType.PROCESS_FORM,e.containersMode.VIEW_MODE)})),$("#btn-process-cancel",i).click((function(){e.switchFormState(e.formType.PROCESS_FORM,e.containersMode.VIEW_MODE)})),e._eventsForTimeFields(i,a.PROCESS_DURATION)},renderTaskEditWrapper:function(){var e=this,t=e.getContent(),i=$("#task-edit-wrapper",t),a=e.Class.SELECTORS;$.tmpl(e.taskEditTmpl).appendTo(i),e.switchFormState(e.formType.TASK_FORM,e.containersMode.VIEW_MODE),$("#btn-task-edit",i).click((function(){e.switchFormState(e.formType.TASK_FORM,e.containersMode.EDIT_MODE)})),$("#btn-task-apply",i).click((function(){e.saveTask(),e.switchFormState(e.formType.TASK_FORM,e.containersMode.VIEW_MODE)})),$("#btn-task-cancel",i).click((function(){e.switchFormState(e.formType.TASK_FORM,e.containersMode.VIEW_MODE)})),e._eventsForTimeFields(i,a.TASK_DURATION)},_eventsForTimeFields:function(e,t){var i=this;$(t.HOURS_FIELD,e).on("change",(function(e){$(this).val(i.correctIntegerInInput($(this).val(),0,24023,0))})),$(t.MINUTES_FIELD,e).on("change",(function(e){$(this).val(i.correctIntegerInInput($(this).val(),0,59,0))}))},bindProcessDetail:function(){var e=this.getContent(),t=$("#process-edit-wrapper",e),i=this.Class.SELECTORS;this.switchFormState(this.formType.PROCESS_FORM,this.containersMode.VIEW_MODE),this.parseObjectTime(this.currentSelectedProcessData),this._setValuesAndLabelsText(t,i.PROCESS_DURATION,this.currentSelectedProcessData),this.currentSelectedTaskData=void 0,this.displayTaskEdit(!1)},preprocessBindTaskDetail:function(e){var t=this.getTaskByID(e);t?this.bindTaskDetail(t):this.displayTaskEdit(!1)},bindTaskDetail:function(e){var t=this.getContent(),i=$("#task-edit-wrapper",t),a=e,s=this.Class.SELECTORS;this.shouldShowTaskProperties(a)?(this.displayTaskEdit(!0),this.switchFormState(this.formType.PROCESS_FORM,this.containersMode.VIEW_MODE),this.switchFormState(this.formType.TASK_FORM,this.containersMode.VIEW_MODE),this.parseObjectTime(a),this.currentSelectedTaskData=a,this._setValuesAndLabelsText(i,s.TASK_DURATION,this.currentSelectedTaskData)):(this.currentSelectedTaskData=void 0,this.displayTaskEdit(!1))},_setValuesAndLabelsText:function(e,t,i){$(t.NAME_LABEL,e).text(i.name),$(t.DESCRIPTION_LABEL,e).text(i.description),$(t.DURATION_LABEL,e).text(i.durationText),$(t.HOURS_FIELD,e).val(i.durationHours),$(t.MINUTES_FIELD,e).val(i.durationMinutes)},getTaskByID:function(e){for(var t=this.processTaskData.Tasks.length;t-- >0;)if(e==this.processTaskData.Tasks[t].guid)return this.processTaskData.Tasks[t]},shouldShowTaskProperties:function(e){return e.idTaskType&&(2==e.idTaskType||7==e.idTaskType||14==e.idTaskType||21==e.idTaskType||38==e.idTaskType||39==e.idTaskType||41==e.idTaskType)},displayTaskEdit:function(e){var t=this.getContent(),i=$("#task-edit-wrapper",t);e?i.show():i.hide()},switchFormState:function(e,t){var i=this.getContent();switch(t){case this.containersMode.VIEW_MODE:e==this.formType.PROCESS_FORM?($("#process-view-fields-wrapper",i).show(),$("#process-edit-fields-wrapper",i).hide()):e==this.formType.TASK_FORM&&($("#task-view-fields-wrapper",i).show(),$("#task-edit-fields-wrapper",i).hide());break;case this.containersMode.EDIT_MODE:"process"==e?($("#process-view-fields-wrapper",i).hide(),$("#process-edit-fields-wrapper",i).show()):e==this.formType.TASK_FORM&&($("#task-view-fields-wrapper",i).hide(),$("#task-edit-fields-wrapper",i).show())}},loadSelectedTask:function(e,t){this.getContent();var i=$("#admin-processes-map-wrapper",this.content);this.renderProcessViewer(i)},correctIntegerInInput:function(e,t,i,a){var s=this.tryParseInt(e,a);return s<t?t:s>i?i:s},tryParseInt:function(e,t){var i=t;return null!=e&&jQuery.trim(new String(e)).length>0&&(isNaN(e)||(i=parseInt(e))),i},_getMinutesFrom:function(e,t){var i=$(t.HOURS_FIELD,e).val(),a=$(t.MINUTES_FIELD,e).val();return this.getMinutesFromTimeUnits(i,a)},saveProcess:function(){var e=this,t=e.getContent(),i=$("#process-edit-wrapper",t),a=e.Class.SELECTORS,s=e._getMinutesFrom(i,a.PROCESS_DURATION),n={};n.idWorkflow=e.currentSelectedProcessData.id,n.duration=s,NaN!=s&&$.when(e.dataService.modifyProcessDuration(n)).done((function(t){t.workflow&&(e.currentSelectedProcessData.duration=t.workflow.duration,e.bindProcessDetail())}))},saveTask:function(){var e=this,t=e.getContent(),i=$("#task-edit-wrapper",t),a=e.Class.SELECTORS,s=e._getMinutesFrom(i,a.TASK_DURATION),n={};n.idTask=e.currentSelectedTaskData.id,n.duration=s,NaN!=s&&$.when(e.dataService.modifyTaskDuration(n)).done((function(t){t.task&&(e.currentSelectedTaskData.duration=t.task.duration,e.bindTaskDetail(e.currentSelectedTaskData))}))},getMinutesFromTimeUnits:function(e,t){return 60*parseInt(e)+parseInt(t)},parseObjectTime:function(e){var t=this.getTimeArrayFromMinutes(e.duration);e.durationText=this.getDurationStringFromMinutes(e.duration),e.durationHours=t[0],e.durationMinutes=t[1]},getTimeArrayFromMinutes:function(e){var t=this.tryParseInt(e,0);return[parseInt(t/60),t%60]},getDurationStringFromMinutes:function(e){var t=this.getTimeArrayFromMinutes(e),i=t[0]+bizagi.localization.getResource("workportal-widget-processes-field-abreviation-hour")+":";return i+=t[1]+bizagi.localization.getResource("workportal-widget-processes-field-abreviation-minute")}},"displayTaskEdit",(function(e){var t=this.getContent(),i=$("#task-edit-wrapper",t);e?i.show():i.hide()}))),bizagi.workportal.widgets.admin.business.policies.extend("bizagi.workportal.widgets.admin.business.policies",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-wrapper"),"admin.business.policies.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-content"),useNewEngine:!1})},postRender:function(){this.setupData()},setupData:function(){var e=this.getContent(),t=$.tmpl(this.generalContentTmpl,{});e.append(t)},setupPoliciesTree:function(){var e=this.getContent();bizagi.treeRoutSelected=[],$("#treeLinksId").remove(),this.processTree=new bizagi.workportal.widgets.tree(this.workportalFacade,this.dataService,$.extend(this.params,{canvas:$("#processTree",e)})),this.processTree.render()}}),bizagi.workportal.widgets.admin.business.policies.decision.table.extend("bizagi.workportal.widgets.admin.business.policies.decision.table",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.decision.table.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-decision-table-wrapper"),"admin.business.policies.decision.table.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-decision-table-content"),useNewEngine:!1})},renderContent:function(){var e,t=this.getTemplate("admin.business.policies.decision.table.wrapper");return this.decisionTableContent=this.getTemplate("admin.business.policies.decision.table.content"),e=this.content=$.tmpl(t,{}),this.params.canvas&&(e=$(this.params.canvas).append(e)),e},postRender:function(){}}),bizagi.workportal.widgets.admin.business.policies.rules.extend("bizagi.workportal.widgets.admin.business.policies.rules",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.rules.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-rules-wrapper"),"admin.business.policies.rules.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-rules-content"),useNewEngine:!1})},renderContent:function(){var e,t=this.getTemplate("admin.business.policies.rules.wrapper");return this.decisionTableContent=this.getTemplate("admin.business.policies.rules.content"),e=this.content=$.tmpl(t,{}),this.params.canvas&&(e=$(this.params.canvas).append(e)),e},postRender:function(){}}),bizagi.workportal.widgets.admin.business.policies.tabs.extend("bizagi.workportal.widgets.admin.business.policies.tabs",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.tabs.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-tabs-wrapper"),"admin.business.policies.tabs.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-tabs-content"),useNewEngine:!1})},renderContent:function(){var e,t=this.getTemplate("admin.business.policies.tabs.wrapper");return this.decisionTableContent=this.getTemplate("admin.business.policies.tabs.content"),e=this.content=$.tmpl(t,{}),this.params.canvas&&(e=$(this.params.canvas).append(e)),e},postRender:function(){}}),bizagi.workportal.widgets.admin.business.policies.politics.extend("bizagi.workportal.widgets.admin.business.policies.politics",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.politics.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-politics-wrapper"),"admin.business.policies.politics.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-politics-content"),useNewEngine:!1})},renderContent:function(){var e,t=this.getTemplate("admin.business.policies.politics.wrapper");return this.decisionTableContent=this.getTemplate("admin.business.policies.politics.content"),e=this.content=$.tmpl(t,{}),this.params.canvas&&(e=$(this.params.canvas).append(e)),e},postRender:function(){}}),bizagi.workportal.widgets.admin.language.extend("bizagi.workportal.widgets.admin.language",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.language.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-wrapper"),"admin.language.panel.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-panel-wrapper"),"admin.language.template.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-template-list"),"admin.language.upload.file.culturename":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-combo-culturename"),"admin.language.bizagi.objects.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-bizagi-objects-list"),"admin.language.entities.list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.language").concat("#ui-bizagi-workportal-widget-admin-language-entities-list"),useNewEngine:!1})},loadtemplates:function(){this.config={maxSize:"10000000",validExtensions:".xlsx",uploadFormTemplateName:"bizagi.workportal.desktop.fileupload.form",cultureName:"en"},this.generalUploadFile=this.workportalFacade.getTemplate("admin.language.upload.file"),this.formTemplate1=this.workportalFacade.getTemplate(this.config.uploadFormTemplateName),this.formTemplate2=this.workportalFacade.getTemplate(this.config.uploadFormTemplateName),this.formTemplate3=this.workportalFacade.getTemplate(this.config.uploadFormTemplateName),this.formTemplate4=this.workportalFacade.getTemplate(this.config.uploadFormTemplateName)},postRender:function(){var e=this,t=e.getContent();e.startTab="entities",e.loadtemplates(),e.setupData(),$.when(e.initLanguageTemplatesList(e.startTab)).done((function(i){e.renderUploadForm(),e.initBizagiObjectsList(),e.initEntities(),t.html(e.panelWrapper),session.isProduction||$("#tab_reset").parent().addClass("hidden"),$("#admin-language-wrapper").tabs(),$("#entities_internal_tabs").tabs({create:function(e,t){t.tab.parent().removeClass("hidden")}}),$("#entities-accordion").accordion({heightStyle:"content",collapsible:!0}),e.activeTab=e.startTab,e.handleTabEvents(),e.keyEntityValidation(e.panelWrapper)}))},setupData:function(){this.getContent()},renderUploadForm:function(){this.getContent();var e=$("#languages-upload-form-wrapper",this.panelWrapper),t=$("#massive-resources-upload-form-wrapper",this.panelWrapper);e.empty(),t.empty()},initLanguageTemplatesList:function(e){var t=$.Deferred(),i=this,a=(i.getContent(),$("#"+e+"-language-list-wrapper",i.panelWrapper));return a.empty(),$.when(i.dataService.getStoreLanguageTemplates()).done((function(s){var n;s.result.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0})),i.templateList=s,n="all"===e?i.getResource("workportal-widget-admin-language-all-language-list"):i.getResource("workportal-widget-admin-language-current-language-settings"),$.tmpl(i.generalTemplateListTmpl,{languageTemplates:s.result,listTitle:n,source:e}).appendTo(a),i.downloadTemplateEvent(e),t.resolve(),i.addUploadMassiveResources(),"reset"===e&&i.initReset()})),t.promise()},initBizagiObjectsList:function(){var e,t=this;e=$("#bizagi-objects-list-wrapper",t.panelWrapper),$.when(this.dataService.getBizagiObjects()).done((function(i){i.result.sort((function(e,t){return e.value>t.value?1:e.value<t.value?-1:0})),t.bizagiObjects=i.result,$.tmpl(t.bizagiObjectsList,{elementList:t.bizagiObjects}).appendTo(e),t.bizagiObjectsEvents()}))},bizagiObjectsEvents:function(){var e=this;$("table tr",".objects-container").bind("selectstart",(function(e){e.preventDefault()})),$(".ui-bizagi-object").click((function(){$("td",this).hasClass("bizagi-objects-object-selected")?$("td",this).removeClass("bizagi-objects-object-selected"):$("td",this).addClass("bizagi-objects-object-selected")})),$(".objects-buttons").click((function(e){e.preventDefault()})),$("#move-all-objects-right").click((function(){$("#table-objects-selected tbody").append($("#table-bizagi-ojects-list td").closest("tr")),$("#table-objects-selected tbody tr td").removeClass("bizagi-objects-object-selected"),$("#table-objects-selected tbody tr").show(),e.readyToDownload("bizagi_objects")})),$("#move-objects-right").click((function(){$("#table-objects-selected tbody").append($("#table-bizagi-ojects-list .bizagi-objects-object-selected").closest("tr")),$("#table-objects-selected tbody tr td").removeClass("bizagi-objects-object-selected"),e.readyToDownload("bizagi_objects")})),$("#move-objects-left").click((function(){$("#table-bizagi-ojects-list tbody").append($("#table-objects-selected .bizagi-objects-object-selected").closest("tr")),$("#table-bizagi-ojects-list tbody tr td").removeClass("bizagi-objects-object-selected"),e.readyToDownload("bizagi_objects")})),$("#move-all-objscts-left").click((function(){$("#table-bizagi-ojects-list tbody").append($("#table-objects-selected td").closest("tr")),$("#table-bizagi-ojects-list tbody tr td").removeClass("bizagi-objects-object-selected"),e.readyToDownload("bizagi_objects")}))},initEntities:function(){var e,t=this;e=$("#entities-list-wrapper",t.panelWrapper),$.when(this.dataService.getEntitiesList()).done((function(i){i.entities.sort((function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})),t.entitiesList=i.entities,$.tmpl(t.entitiesListTmpl,{elementList:t.entitiesList}).appendTo(e),t.entitiesEvents()}))},entitiesEvents:function(){var e=this;$("table tr",".entities-container").bind("selectstart",(function(e){e.preventDefault()})),$("#ui-entities-filter").keyup((function(){var e=$(this).val();$("#table-entities-list .ui-bizagi-entity").show(),e&&$("#table-entities-list .ui-bizagi-entity").not(":FilterEntity("+e+")").hide()})),$.expr[":"].FilterEntity=function(e,t,i){var a=i[3];return!!a&&new RegExp(a,"i").test($(e).text())},$(".ui-bizagi-entity").click((function(){$("td",this).hasClass("bizagi-entities-entity-selected")?$("td",this).removeClass("bizagi-entities-entity-selected"):$("td",this).addClass("bizagi-entities-entity-selected")})),$(".entities-buttons").click((function(e){e.preventDefault()})),$("#move-all-right").click((function(){$("#table-entities-selected tbody").append($("#table-entities-list td").closest("tr")),$("#table-entities-selected tbody tr td").removeClass("bizagi-entities-entity-selected"),$("#table-entities-selected tbody tr").show(),e.readyToDownload("entities")})),$("#move-right").click((function(){$("#table-entities-selected tbody").append($("#table-entities-list .bizagi-entities-entity-selected").closest("tr")),$("#table-entities-selected tbody tr td").removeClass("bizagi-entities-entity-selected"),e.readyToDownload("entities")})),$("#move-left").click((function(){$("#table-entities-list tbody").append($("#table-entities-selected .bizagi-entities-entity-selected").closest("tr")),$("#table-entities-list tbody tr td").removeClass("bizagi-entities-entity-selected"),e.readyToDownload("entities")})),$("#move-all-left").click((function(){$("#table-entities-list tbody").append($("#table-entities-selected td").closest("tr")),$("#table-entities-list tbody tr td").removeClass("bizagi-entities-entity-selected"),e.readyToDownload("entities")}))},getEntitiesSelected:function(){var e=$("#table-entities-selected tbody tr"),t=[];return $.each(e,(function(e,i){t.push($(i).data("id"))})),t},getObjectsSelected:function(){var e=$("#table-objects-selected tbody tr"),t=[];return $.each(e,(function(e,i){t.push($(i).data("value"))})),t},initAllLangs:function(){this.allLangsEvents()},allLangsEvents:function(){var e=this;$("input.ui-all-languages-filter").keyup((function(){var e=$(this).val();$(".ui-bizagi-grid-table .ui-bizagi-language").show(),e&&$(".ui-bizagi-grid-table .ui-bizagi-language").not(":FilterLanguage("+e+")").hide()})),$.expr[":"].FilterLanguage=function(e,t,i){var a=i[3];return!!a&&new RegExp(a,"i").test($(e).text())},e.modifiedLangs={},$("#all-language-list-wrapper .ui-bizagi-cell-readonly").find("input[type=checkbox]").on("change",(function(){var t,i=$(this);t=i.attr("value"),$.each(e.modifiedLangs,(function(i,a){var s;for(s in a)s===t&&delete e.modifiedLangs[t]})),e.modifiedLangs[t]=!!i.is(":checked")})),$("#all-language-list-wrapper #save-lang-list-btn").on("click",(function(){e.saveLangsList()}))},saveLangsList:function(){var e,t=this;e={languages:this.modifiedLangs},$.when(this.dataService.setLanguages(JSON.stringify(e))).done((function(e){var i;e.result?$("#tab_all_languages").click():((i=$("#all-language-list-wrapper .multilang-error-msg")).removeClass("dp-hidden"),setTimeout((function(){i.addClass("dp-hidden")}),5e3),$.each(t.modifiedLangs,(function(e,t){var i=$("#all-language-list-wrapper .ui-bizagi-cell-readonly").find("input[value="+e+"]");t?i.removeAttr("checked"):i.prop("checked",!0)}))),t.modifiedLangs={}}))},initReset:function(){this.resetEvents(),$("#message-container").hide(),$("#template-reset").hide()},resetEvents:function(){var e=this;$("button#lang-reset-btn").on("click",(function(){e.loadingOption(),$("#message-container").hide(),$("#template-reset").hide();var t=bizagi.localization.getResource("workportal-widget-admin-language-reset-confirmation");$.when(bizagi.showConfirmationBox(t,"Bizagi","warning")).done((function(){$.when(e.dataService.resetPersonalization()).done((function(e){e.result&&($("#message-container").show(),$("#template-reset").show())}))})),e.notLoading()}))},loadingOption:function(){$("div.ui-dialog").append("<div class='loading-language ui-bizagi-loading-icon'><div class='loading-language-icon'></div></div>")},notLoading:function(){$("div.loading-language").remove(),$("body").removeClass("cursor-loading")},addUploadMassiveResources:function(){var e=$("#internals",this.panelWrapper),t=$("#extended",this.panelWrapper),i=$("#bizagi_objects",this.panelWrapper),a=$("#entities_localization ",this.panelWrapper),s=this.dataService.serviceLocator.getUrl("admin-language-entities"),n=this.dataService.serviceLocator.getUrl("admin-language-resource");this.renderUploadPlugin(e,this.formTemplate1,n,"internals"),this.renderCultureCombo(e,this.panelWrapper),this.renderUploadPlugin(t,this.formTemplate2,n,"extended"),this.renderCultureCombo(t,this.panelWrapper),this.renderUploadPlugin(i,this.formTemplate3,n,"objects"),this.renderCultureCombo(i),this.renderUploadPlugin(a,this.formTemplate4,s,"entities"),this.renderCultureCombo(a)},renderUploadPlugin:function(e,t,i,a){var s=this,n={};n.addUrl=i,n.validExtensions=s.config.validExtensions,n.maxSize=s.config.maxSize,n.maxfiles="1",n.filesCount="",$("#massive-resources-upload-form-wrapper",e).bizagiFileUpload({showLoading:!0,alerFailtAfterUpload:s.getResource("workportal-widget-admin-language-alert-fail-after-upload"),formTemplate:t,properties:{cultureName:s.config.cultureName,url:n.addUrl,validExtensions:n.validExtensions,maxSize:n.maxSize,xpath:a},onUploadFileCompletedCallback:function(e,t){var i=s.validateEntitiesModified(t);bizagi.showMessageBox(bizagi.localization.getResource(i.messageKey)+i.entities,"Bizagi","info"),s.handleResponse("alert-upload-massive-resources-template",t),$("div.loading-language").remove(),$("body").removeClass("cursor-loading")},onUploadFileFailCallback:function(e){console.log(e),$("div.loading-language").remove(),$("body").removeClass("cursor-loading")},onUploadFileProcess:function(){$("div.ui-dialog").append("<div class='loading-language ui-bizagi-loading-icon'><div class='loading-language-icon'></div></div>")},maxAllowedFiles:n.maxfiles,uploadedFiles:n.filesCount})},validateEntitiesModified:function(e){var t=JSON.parse(e),i="",a="workportal-widget-admin-language-alert-after-upload";switch(t.message){case"success":if(""!=t.detail){var s=""==t.detail?[]:JSON.parse(t.detail);a="workportal-widget-admin-language-alert-no-access-rights-after-upload",s.length>0&&(i=": "+s.join(", "),a="workportal-widget-admin-language-alert-entities-authorized-after-upload")}break;case"unauthorized":a="workportal-widget-admin-language-alert-no-access-rights-after-upload";break;case"Empty":a="workportal-widget-admin-language-alert-nothing-has-been-update-with-the-selected-file"}return{messageKey:a,entities:i}},renderCultureCombo:function(e){var t=this,i=(t.getContent(),$.Deferred()),a={combo:[],id:"cultureName"};a.combo.push({id:"default",name:""}),$.each(t.templateList.result,(function(e,t){t.enabled&&a.combo.push({id:t.key,name:t.value})}));var s=$(".ui-bizagi-culturecombo",e);return s.empty(),s.uicombo({isEditable:!1,data:a,itemValue:function(e){return e.id},itemText:function(e){return e.name},onComplete:function(){$("[name='cultureName']",e).val(a.combo[0].id),i.resolve()},onChange:function(i){var a=$("button#upload-file","#"+t.activeTab+"_upload_file"),s=i.ui.data("value");"default"!==s?a.prop("disabled",!1):a.prop("disabled",!0),$("[name='cultureName']",e).val(s)},initValue:a.combo[0]}),i},handleResponse:function(e,t){var i,a="Error";0==t.length?this.initLanguageTemplatesList(this.startTab):(response=JSON.parse(t),void 0!==response.detail&&(a=response.detail.length>200?response.detail.substring(0,197)+" ...":response.detail),i=bizagi.localization.getResource(response.message),$("#"+e).html(i+" : "+a),$("#"+e).parent().removeClass("ui-hidden"))},downloadTemplateEvent:function(e){var t=this,i=$("#"+e+"-language-list-wrapper .ui-bizagi-grid-table",t.panelWrapper),a=$(".lang-list-button button#"+e+"-tmpl-download-btn",t.panelWrapper);i.find('input[type="radio"]').click((function(s){t.readyToDownload(e,i,a)})),a.click((function(a){var s,n,r,o;a.preventDefault(),o={cultureName:i.find('input[type="radio"]:checked').data("guid")},"bizagi_objects"===e?(s={elements:t.getObjectsSelected()},o.elements=JSON.stringify(s)):"entities"===e?(n={entities:t.getEntitiesSelected()},o.entities=JSON.stringify(n)):"extended"===e&&(r={elements:["extended"]},o.elements=JSON.stringify(r)),t.dataService.getLanguageTemplate(o)}))},readyToDownload:function(e,t,i){var a=!1,s=!1;t||(t=$("#"+e+"-language-list-wrapper .ui-bizagi-grid-table",this.panelWrapper)),i||(i=$(".lang-list-button button#"+e+"-tmpl-download-btn",this.panelWrapper)),"internals"===e?a=!0:"extended"===e?a=!0:"bizagi_objects"===e?a=this.getObjectsSelected().length>0:"entities"===e&&(a=this.getEntitiesSelected().length>0),t.find('input[type="radio"]:checked').length>0&&(s=!0),a&&s?i.removeAttr("disabled"):i.attr("disabled",!0)},keyEntityValidation:function(e){bizagi.menuSecurity.EntityAdmin&&!bizagi.menuSecurity.Multilanguage&&$("#admin-language-wrapper-tabs > li:not(:has(#tab_entities_localization))",e).hide()},handleTabEvents:function(){var e=this,t=!1,i=$("#admin-language-wrapper");e.getContent(),$(".ui-tabs-anchor","#admin-language-wrapper").click((function(){$("#message-container").hide(),$("#template-reset").hide(),$("input.ui-all-languages-filter").val("")})),$("#tab_internals").click((function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("internals")).done((function(a){$("#internals_internal_tabs").tabs({create:function(e,t){t.tab.parent().removeClass("hidden")}}),e.activeTab="internals",i.tabs("enable"),t=!1})))})),$("#tab_extended").click((function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("extended")).done((function(a){$("#extended_internal_tabs").tabs({create:function(e,t){t.tab.parent().removeClass("hidden")}}),e.activeTab="extended",i.tabs("enable"),t=!1})))})),$("#tab_bizagi_objects").click((function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("bizagi_objects")).done((function(a){$("#bizagi_objects_internal_tabs").tabs({create:function(e,t){t.tab.parent().removeClass("hidden")}}),$("#bizagi-objects-accordion").accordion({heightStyle:"content",collapsible:!0}),e.activeTab="bizagi_objects",i.tabs("enable"),t=!1})))})),$("#tab_entities_localization").click((function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("entities")).done((function(a){$("#entities_internal_tabs").tabs({create:function(e,t){t.tab.parent().removeClass("hidden")}}),$("#entities-accordion").accordion({heightStyle:"content",collapsible:!0}),e.activeTab="entities",i.tabs("enable"),t=!1})))})),$("#tab_all_languages").click((function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("all")).done((function(a){e.initAllLangs(),e.activeTab="all",i.tabs("enable"),t=!1})))})),$("#tab_reset").click((function(a){t?a.preventDefault():(t=!0,i.tabs("disable"),$.when(e.initLanguageTemplatesList("reset")).done((function(a){e.allLangsEvents(),e.activeTab="reset",i.tabs("enable"),t=!1})))})),$(".tab_upload_file").click((function(t){e.addUploadMassiveResources()})),$("#tab_reset").parent().hide(),$("#tab_internals").parent().show()}}),bizagi.workportal.widgets.admin.preferences.extend("bizagi.workportal.widgets.admin.preferences",{},{init:function(e,t,i){this.bizagiUserPreferences=new bizagi.services.preferences,this.bizagiCustomFormats=new bizagi.services.preferences.customFormats,this.guidForm,this.isNewForm,this.notifier=bizagi.injector.get("notifier"),this._super(e,t,i),this.loadTemplates({"admin.preferences.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-admin-preferences-wrapper"),"admin.preferences.container":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preferences-container"),"admin.preferences.buttons":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preference-buttons"),"admin.preferences.iframe":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preference-iframe"),"admin.preferences.error":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preferences-errormessage"),"admin.preferences.properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.preferences").concat("#ui-bizagi-workportal-widget-preferences-properties"),useNewEngine:!1})},loadtemplates:function(){this.container=this.getTemplate("admin.preferences.container"),this.buttons=this.getTemplate("admin.preferences.buttons"),this.iframe=this.getTemplate("admin.preferences.iframe"),this.errorMessage=this.getTemplate("admin.preferences.error"),this.propertiesTmpl=this.getTemplate("admin.preferences.properties")},postRender:function(){var e=this;$.when(e.dataService.getPreferenceFormParams()).done((function(t){e.guidForm="-1"!==t.id?t.id:"",!0===t.errorMessage?e.renderErrorMessage():!0===t.isNewForm?e.renderPreferences():e.renderPreferencesOldForm()}))},renderErrorMessage:function(){var e=this.getResource("workportal-widget-admin-entities-message-migrate");e=e.replace("{build}",bizagi.loader.productBuildToAbout);var t=$.tmpl(this.errorMessage,{errorMessage:e});this.content.html(t)},setupData:function(){this.getContent()},renderPreferencesOldForm:function(){var e=this.getContent(),t=this.dataService.getUrl({endPoint:"PreferenceFormOld"})+"?idForm="+this.guidForm+"&referer=userPreferences",i=$.tmpl(this.iframe,{url:t}),a=$("iframe",i);i.addClass("loading-iframe"),a.hide(),a.load((function(){$(this).fadeIn()})),e.html(i)},renderPreferences:function(){var e=this,t=new $.Deferred,i=e.getContent();e.currentUser=bizagi.currentUser.idUser;var a={h_action:"LOADUSERPREFERENCESFORM",h_contexttype:"entity",h_guidForm:e.guidForm},s=$.tmpl(e.container);return bizagi.loader.start("rendering").then((function(){var n=new bizagi.rendering.facade;e.dataService.getPreferencesForm(a).done((function(a){var r={canvas:s,data:a,context:"userPreferencesForm"};n.execute(r).done((function(a){var r={};$.extend(r,e.bizagiUserPreferences.getFormPreferencesValues(),e.bizagiCustomFormats.getFormatValues()),$("#preferences-tabs").tabs(),$("#properties",i).html($.tmpl(e.propertiesTmpl,r,{formatTime:e.bizagiCustomFormats.formatTime}));var o=!0;1==bizagi.menuSecurity.OpenWindowsMaximized&&($("#displayoptions_OpenWindowsMaximized",i).show(),o=!1),1==bizagi.menuSecurity.AlwaysCollapseActivitySidebars&&($("#displayoptions_collapseSidebars",i).show(),o=!1),1==bizagi.menuSecurity.ReturnToInboxWhenTasksAreFinished&&($("#displayoptions_goToInbox",i).show(),o=!1),o&&$("#noPermission",i).show(),$("#preferences-tabs-ul").show(),e.preferenceForm=n.form,e.preferenceForm&&e.preferenceForm.properties&&(!e.preferenceForm.properties.contexttype&&(e.preferenceForm.properties.contexttype="entity")),$("#preferences",i).html(s),e.handleEvents(),t.resolve()}))}))})),t},handleEvents:function(){var e=this,t=e.getContent();$("#preferences-buttons",t).html($.tmpl(e.buttons)),$("#update-preferences",t).click((function(t){e.updateData()}));var i=t&&t.length?t.closest(".ui-dialog"):[];i.length>0&&e.preferenceForm&&(i.on("dialogmaximize",(function(t){e.preferenceForm.triggerHandler("maximazedForm"),i.trigger("resize")})),i.on("dialogunmaximize",(function(t){e.preferenceForm.triggerHandler("unmaximazedForm"),i.trigger("resize")})))},updatePreferences:function(){var e=this.getResource("workportal-widget-admin-preferences-error-same-value"),t=this.getUserPreferences();t.decimalSeparator&&t.decimalSeparator===t.thousandSeparator?bizagi.showMessageBox(e,"Error"):(this.bizagiUserPreferences.overridePreferences(t),this.notifier.showSucessMessage(bizagi.localization.getResource("workportal-widget-admin-displayoptions-success"),bizagi.localization.getResource("workportal-menu-preferences"),""))},getUserPreferences:function(){var e=this.bizagiUserPreferences.getPreferences();return $(".preferences-properties :checkbox").each((function(){e[this.name]=this.checked})),e},updateData:function(){var e=this;if(e.preferenceForm.validateForm()){var t=new bizagi.render.services.service,i=e.preferenceForm.collectRenderValuesForSubmit(),a=e.getContent();e._startLoading(a,!0),$.when(t.multiactionService.submitData({action:"SAVEUSERPREFERENCES",contexttype:"entity",data:i,surrogatekey:e.currentUser,idPageCache:e.preferenceForm.idPageCache})).done($.proxy((function(t){i.language?$.when(e.dataService.getCurrentUser()).done((function(t){$.when(assignLanguage(t.language)).done((function(){bizagi.util.changeData({language:t.language}),e.executeRender()})).fail((function(){}))})).fail((function(){})):e.executeRender(),e.updatePreferences()}),i)).fail((function(t){var i=bizagi.localization.getResource("workportal-general-word-message");void 0!==t.message&&bizagi.showMessageBox(t.message,i),e.executeRender()}))}else $("#preferences-tabs").tabs({active:0})},executeRender:function(){var e=this.getContent();$.when(this.renderPreferences()).always(this._startLoading.bind(this,e,!1))},_startLoading:function(e,t){var i=!0===t?"none":"block";e.find("#preferences-tabs").css("display",i),e.find("#preferences-buttons").css("display",i),t?e.addClass("loading-iframe"):e.removeClass("loading-iframe")}}),bizagi.workportal.widgets.admin.entities.extend("bizagi.workportal.widgets.admin.entities",{},{init:function(e,t,i){var a="bizagi.workportal.desktop.widgets.admin.entities";this.entitiesState=[],this.actualShowingList=!1,this._super(e,t,i),this._referrer="entity",this.loadTemplates({"admin.entity.wrapper":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-entity-wrapper"),"admin.entity.panel.wrapper":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-entity-panel-wrapper"),"admin.entity.panel.wrapper-buttons":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-entity-panel-wrapper-buttons"),"admin.entity.list":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-entity-list"),"admin.entity.error":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-entity-error"),useNewEngine:!1}),this._state={},this.setInitialState()},loadtemplates:function(){this.panelWrapper=$.tmpl(this.getTemplate("admin.entity.panel.wrapper")),this.panelWrapperButtons=this.getTemplate("admin.entity.panel.wrapper-buttons"),this.entitiesList=this.getTemplate("admin.entity.list"),this.entitiesError=this.getTemplate("admin.entity.error")},postRender:function(){var e=this,t=e.getContent(),i=$.Deferred();return t.empty(),$.when(e.dataService.getAdminEntitiesList()).done((function(a){if(a.length>0){e.entities=a;var s=$("#admin-entity-list-wrapper",e.panelWrapper);t.html(e.panelWrapper),$.tmpl(e.entitiesList,{entitiesList:e.entities}).appendTo(s),$("#entitiesList option:first",s).attr("selected","selected"),e.configureHandlers()}else{var n=e.getResource("workportal-general-first-line-no-records-found");t.html($.tmpl(e.entitiesError,{errorMessage:n}))}i.resolve()})).fail((function(a){e.entities=void 0;var s=e.getResource("workportal-widget-admin-entities-error");t.html($.tmpl(e.entitiesError,{errorMessage:s})),i.reject()})),i.promise()},configureHandlers:function(){var e=this,t=$("#admin-entity-list-wrapper",e.panelWrapper);$("#searchEntity",t).keyup((function(){var i=$(this).val().toLowerCase();$.each(e.entities,(function(){var e=$('#entitiesList option[value="'+this.guid+'"]',t);i.length>1?-1!=this.displayName.toLowerCase().indexOf(i)?$(e).parent("span.toggleOption").length&&$(e).unwrap():0==$(e).parent("span.toggleOption").length&&$(e).wrap('<span class="toggleOption" style="display: none;" />'):$(e).parent("span.toggleOption").length&&$(e).unwrap()}))})),$("#entitiesList",t).change((function(){$("#entitiesList>span>option:selected",e.panelWrapper).prop("selected",!1),e.addButtons(),e.setInitialState(),e.reviewUploadFileState(),e.drawSimpleGrid({page:1})})).trigger("change"),$("#bz-btn-language-settings",t).click((function(){e.openLanguageSettingsWidgetDialog()})),$(".button-toggle-manage-entities",e.panelWrapper).click((function(){$(".buttons-wrapper",e.panelWrapper).toggle(),e.resizeAdminEntityWrapper(),$(".button-toggle-manage-entities",e.panelWrapper).toggleClass("collapse-arrow")}))},addButtons:function(){var e=this;$(".buttons-wrapper",e.panelWrapper).html($.tmpl(e.panelWrapperButtons)),$("#downloadButton",e.panelWrapper).click((function(){e.dataService.getEntityExcel(e.getSelectedItem().guidEntity)})),$("#admin-entity-main-wrapper .admin-entity-last-report-link").click((function(){e.downloadLastReport()})),$("#file-upload",e.panelWrapper).change((function(t){e.uploadFile(t)})),$("#admin-entity-main-wrapper .admin-entity-last-report-link").click((function(){e.downloadLastReport()}))},resizeAdminEntityWrapper:function(){var e=$(".manage-entities-container").height()+12.83;bizagi.util.isEnableFeature("enableUploadBatchEntities")||(e=0,$(".manage-entities-container").hide()),$("#admin-entity-main-wrapper .admin-dialog-rightframe").css("height","calc(100% - "+e+"px)")},toggleButtonsWrapper:function(){$(".buttons-wrapper",this.panelWrapper).toggle()},uploadFile:function(){var e=this,t=e.getSelectedItem().guidEntity,i=e.dataService.serviceLocator.getUrl("admin-entities-upload-excel").replace("{EntityGuid}",t).concat("?xsrf="+bizagi.getXSRFToken());$("#file-upload").kendoUpload({async:{saveUrl:i,saveField:t},validation:{allowedExtensions:[".xlsx"],maxFileSize:bizagi.currentUser?bizagi.currentUser.uploadMaxFileSize:25e3},showFileList:!0,multiple:!1,select:function(t){e.panelWrapper.find(".k-widget").hide()},upload:function(i){var a=function(t){return $.map(t.files,(function(i){var a="";return i.extension!==t.sender.options.validation.allowedExtensions[0]?a=e.getResource("render-upload-error-extensions")+".":i.size>t.sender.options.validation.maxFileSize&&(a=e.getResource("render-upload-iis-maxsize")+"."),""==a||a})).join(", ")}(i);"true"===a?(e.entitiesState[t]="UPLOADING",e.reviewUploadFileState()):(e.showMessage(a,!0),i.preventDefault())},error:function(){e.entitiesState[t]="Error",e.reviewUploadFileState()},success:function(i){t=i.sender.options.async.saveField,e.entitiesState[t]="InProgress",e.reviewUploadFileState()}})},openLanguageSettingsWidgetDialog:function(){var e=$(window).width()-15*$(window).width()/100+"px",t={widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_LANGUAGE,data:{idCase:"LanguageAdmin"},closeVisible:!1,maximize:!0,modalParameters:{title:this.getResource("workportal-menu-submenu-LanguageAdmin"),width:e,id:"LanguageAdmin"}};this.publish("showDialogWidget",t)},showMessage:function(e,t){var i=this,a="";t?(a='<svg  class="bz-icon bz-icon-16 bz-icon-svg"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-clear-circle"></use></svg>',$("#upload-message",i.content).removeClass("success"),$("#upload-message",i.content).addClass("error")):(a='<svg  class="bz-icon bz-icon-16 bz-icon-svg"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#check-mark"></use></svg>',$("#upload-message",i.content).removeClass("error"),$("#upload-message",i.content).addClass("success")),$("#upload-message",i.panelWrapper).html(a+e).css("display","block").fadeIn("slow",i.resizeAdminEntityWrapper),setTimeout((function(){$("#upload-message",i.panelWrapper).fadeOut("slow",i.resizeAdminEntityWrapper)}),1e4)},drawSimpleGrid:function(e){var t=this;t.actualShowingList=!0;var i=$.extend(t.getSelectedItem(),e);if(i.idDisplayForm&&"00000000-0000-0000-0000-000000000000"!=i.idDisplayForm){var a={guid:i.guidEntity,guidForm:i.idDisplayForm,isStakeholder:!1};$.when(t.dataService.getAdminEntitiesForm(a)).done((function(e){t.performSimpleGrid(i,e)}))}else t.performSimpleGrid(i)},resolveEntityForm:function(e){var t,i=this,a=new $.Deferred,s={},n=function e(t){var i=[];return t=t||{},$.each(t,(function(t,a){a.container?i.push.apply(i,e(a.container.elements)):i.push(a.render.properties)})),i};this.getValueByType=function(e){var t=e.value;switch(e.type){case"image":case"upload":t="...";break;case"boolean":t=e.value?"X":"";break;case"combo":case"cascadingCombo":t="object"==_typeof(e.value)&&e.value.length>0?"object"==_typeof(e.value[0].value)?e.value[0].value.join(","):e.value[0].value:""}return t};var r=function(t,i){var a=[];return t=n(t||{}),$.each(t,(function(t,s){var n=s.dataType,r=function(t){var i="";return $.each(e.header,(function(e,a){a.fieldValue==t.xpath&&(a.entity||a.relatedEntity)&&(i=a.entity||a.relatedEntity)})),i}(s),l={};switch(s.type){case"upload":n=1002;break;case"image":n=1003}l=$.extend(s,{guidAttribute:o(i,s.xpath),fieldValue:s.xpath,attributeType:n}),r&&(l.relatedEntity=r),a.push(l)})),a},o=function(e,t){var i=e.filter((function(e){return t==e.fieldValue}));return i.length>0?i[0].guidAttribute:void 0},l=function(e){var t=[];return(e=e||{}).row&&$.each(e.row,(function(e,i){t.push(i[0])})),t}(e);return $.when(function(e){var a=new $.Deferred,s=[],r=[],o=i.getSelectedItem(),l={guid:o.guidEntity,guidForm:o.idDisplayForm,isStakeholder:!1};return 0==(e=e||[]).length?$.when(i.dataService.getAdminEntitiesForm(l)).done((function(e){t||(t=e),a.resolve([])})):($.each(e,(function(e,t){var a=bizagi.clone(l);a.idRow=t,r.push(i.dataService.multiaction().getAdminEntitiesForm(a))})),$.when.apply($,r).done((function(){var r=Array.prototype.slice.call(arguments);$.map(r,(function(r,o){t||(t=r);var l=n(r.form.elements),d=[e[o]];$.each(l,(function(e,t){d.push(i.getValueByType(t))})),s.push(d),s.length==e.length&&a.resolve(s)}))}))),a.promise()}(l)).done((function(i){var n=[e.header[0]];n.push.apply(n,r(t.form.elements,e.header)),s={header:n,entity:e.entity,row:i,total:e.total,page:e.page,records:e.records},a.resolve(s)})),a.promise()},performSimpleGrid:function(e,t){var i=this,a={allowAdd:e.allowAdd,allowEdit:e.allowEdit,displayName:e.displayName,pageSize:10,page:parseInt(e.page)||1,orderField:e.orderField||"",orderType:e.orderType||"asc",filters:e.filters,onDataBinding:function(a){a.pag=a.pag||i.getCurrentPageToSimpleGrid();var s=$.Deferred();return a.pag&&i.setSelectedItem("page",a.pag),$.when(i.dataService.getAdminEntitiesRowData($.extend(a,{guidEntity:e.guidEntity}))).done((function(a){if(e.guidEntity==i.getSelectedItem().guidEntity)if(t){a.relatedEntity=e.guidEntity;i.reshapeEntity(a,t);$.when(i.resolveEntityForm(a)).done((function(e){s.resolve(e)}))}else s.resolve(a)})).fail((function(e){var t=i.getResource("workportal-widget-admin-entities-instances-error");$("#admin-entity-instances-wrapper",i.getContent()).html($.tmpl(i.entitiesError,{errorMessage:t}))})),s.promise()},onLoadFilter:function(e){if("Entity"===e.type)return i.dataService.getAdminEntityData(e)},onFilterChanged:function(){i.setInitialState()},onPageChanging:function(e,t){i.setCurrentPageToSimpleGrid(t)},onAdd:function(e,t){i.validateVersionForm(this,"New")},onEdit:function(e,t){i.validateVersionForm(t,"Edit")},getResource:function(e){i.getResource(e)}};$("#admin-entity-instances-wrapper",i.panelWrapper).simpleGrid(i,a).render()},getSelectedItem:function(){var e=$("#entitiesList option:selected",this.panelWrapper);return{guidEntity:e.val(),displayName:e.text(),allowAdd:"true"===e.attr("data-allowAdd").toLowerCase(),allowEdit:"true"===e.attr("data-allowEdit").toLowerCase(),idDisplayForm:e.attr("data-idDisplayForm"),page:e.attr("data-page"),row:this.currentIdRow,orderField:e.data("orderField"),orderType:e.data("orderType"),filters:e.data("filters")}},setSelectedItem:function(e,t){$("#entitiesList option:selected",this.panelWrapper).attr("data-"+e,t)},validateVersionForm:function(e,t){var i=this;i.actualShowingList=!1;var a=$("#entitiesList option:selected",i.panelWrapper),s=i.entities.find((function(e){return e.guid===a.val()})),n={guid:a.val()};"New"===t?n.guidForm=void 0!==s.idAddForm?s.idAddForm:"00000000-0000-0000-0000-000000000000":"Edit"==t&&(n.idRow=$(e).attr("data-idrowentity"),n.guidForm=void 0!==s.idEditForm?s.idEditForm:"00000000-0000-0000-0000-000000000000"),$("#detailEntity",i.panelWrapper).empty(),"00000000-0000-0000-0000-000000000000"===n.guidForm?i.getFormEntity(n):$.when(i.dataService.getAdminEntityMigrated(n.guidForm)).done((function(e){if(0==e.result||10==e.result)i.getFormEntity(n);else if(-9==e.result){var a=i.getResource("workportal-widget-admin-entities-instances-error");$("#admin-entity-instances-wrapper",i.getContent()).html($.tmpl(i.entitiesError,{errorMessage:a}))}else{"New"==t&&(n.idRow=-1);var s="App/Admin/Entity.aspx?giudEntity="+n.guid+"&idSurrogateKey="+n.idRow+"&referer=entityadmin&Action="+t+"&idForm="+n.idForm;i.loadIframeForm(s,"otherForm")}}))},saveFormEntity:function(e){var t=$.Deferred(),i=new bizagi.render.services.service,a={};return e.collectRenderValues(a),$.when(i.multiactionService.submitData({action:"SAVE",contexttype:"entity",data:a,surrogatekey:void 0!==e.surrogatekey&&e.surrogatekey,idPageCache:e.idPageCache})).done((function(e){"success"==e.type?t.resolve(!0):t.reject()})).fail((function(e){bizagi.showMessageBox(e.message),t.reject()})),t.promise()},_adjustDataTypeForIdColumn:function(e,t){return e?-11:t.dataType},reshapeEntity:function(e,t){var i=this,a={},s="stakeholder"==i._referrer;a.entity=e.entity,a.page=e.page,a.records=e.records,a.total=e.total,a.header=[],a.row=[];var n=[];$.each(t.form.elements,(function(t,s){i.mergeFormAndTable(s,a,n,e)})),s&&(n.push(e.header.length-2),a.header.push(e.header[e.header.length-2])),n.push(e.header.length-1);var r=e.header.slice(-1).pop();if(a.header.push(r),-1==n.indexOf(0)){e.header[0].dataType=i._adjustDataTypeForIdColumn(s,e.header[0]);var o=e.header[0];a.header.unshift(o),n.unshift(0)}var l=0;return $.each(e.row,(function(e,t){for(var i=[],s=0;s<n.length;s++)l=n[s],i[s]=t[l];a.row[e]=i})),a},renderTable:function(e,t,i,a){if(e.container)for(var s=0;s<e.container.elements.length;s++)this.renderTable(e.container.elements[s],t,i,a);else $.each(a.header,(function(a,s){e.render.properties.xpath&&e.render.properties.xpath.toUpperCase()==s.fieldValue.toUpperCase()&&(t.header.push($.extend(s,e.render.properties)),i.push(a))}))},mergeFormAndTable:function(e,t,i,a){if(e.container)for(var s=0;s<e.container.elements.length;s++)this.renderTable(e.container.elements[s],t,i,a);else $.each(a.header,(function(a,s){e.render.properties.xpath&&e.render.properties.xpath.toUpperCase()==s.fieldValue.toUpperCase()&&(t.header.push($.extend(s,e.render.properties)),i.push(a))}))},getCurrentPageToSimpleGrid:function(){return this._state.currentPageGrid},setCurrentPageToSimpleGrid:function(e){this._state.currentPageGrid=e},setInitialState:function(){this.setCurrentPageToSimpleGrid("1")},existsLastReport:function(){var e=$.Deferred(),t=this.getSelectedItem().guidEntity,i=$(".admin-entity-last-report-link",this.content);return i.hide(),$.when(this.dataService.getAdminEntitiesExistsLastReport(t)).done((function(t){t.exists&&i.show(),e.resolve()})),e.promise()},reviewUploadFileState:function(e){var t=this,i=t.getSelectedItem().guidEntity;if(null!=e&&e!=i)return!1;void 0===t.entitiesState[i]&&(t.entitiesState[i]=!0),t.showStateUploadingFile(t.entitiesState[i]),"UPLOADING"!==t.entitiesState[i]&&$.when(t.dataService.getAdminEntityState(i)).done((function(e){"InProgress"==t.entitiesState[i]&&"Finished"==e.state&&(t.reloadEntitiesListAfterUpload(i),t.showMessage(t.getResource("workportal-widget-admin-entities-upload-successful")+".",!1)),t.entitiesState[i]=e.state,t.showStateUploadingFile(e.state)&&setTimeout((function(){t.reviewUploadFileState(i)}),3e3),t.existsLastReport()}))},reloadEntitiesListAfterUpload:function(e){this.getSelectedItem().guidEntity==e&&this.actualShowingList&&this.drawSimpleGrid({page:1})},showStateUploadingFile:function(e){this.initialViewUploadEntities(),this.enableUploadButton();var t=!0;switch(e){case"Error":var i=this.getResource("workportal-widget-admin-entities-upload-error");this.showMessage(i,!0);break;case"InProgress":$("#entities-message-inProgress",this.content).css("display","block"),this.disableUploadButton(),this.resizeAdminEntityWrapper();break;case"UPLOADING":$("#entities-message-uploading",this.content).css("display","block"),this.disableUploadButton(),this.resizeAdminEntityWrapper();break;default:t=!1}return t},initialViewUploadEntities:function(){$("#uploadButton",this.content).attr("disabled",!1),$("#entities-message-inProgress",this.content).hide(),$("#entities-message-error",this.content).hide(),$("#entities-message-uploading",this.content).hide(),this.resizeAdminEntityWrapper()},disableUploadButton:function(){$("#uploadButton",self.content).addClass("disabled"),$("#uploadButton",self.content).attr("for",""),$("#uploadButton",self.content).css("cursor","not-allowed")},enableUploadButton:function(){$("#uploadButton",self.content).removeClass("disabled"),$("#uploadButton",self.content).attr("for","file-upload"),$("#uploadButton",self.content).css("cursor","pointer")},downloadLastReport:function(){var e=this.getSelectedItem().guidEntity;this.dataService.getAdminEntitiesDownloadLastReport(e)}}),bizagi.workportal.widgets.admin.entities.extend("bizagi.workportal.widgets.admin.stakeholders",{},{init:function(e,t,i){var a="bizagi.workportal.desktop.widgets.admin.stakeholders";this._super(e,t,i),this._referrer="stakeholder",this.loadTemplates({"admin.entity.wrapper":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-stakeholder-wrapper"),"admin.stakeholder.panel.wrapper":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-stakeholder-panel-wrapper"),"admin.stakeholder.list":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-stakeholder-list"),"admin.stakeholder.error":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-stakeholder-error"),useNewEngine:!1})},loadtemplates:function(){this.panelWrapper=$.tmpl(this.getTemplate("admin.stakeholder.panel.wrapper")),this.stakeholdersList=this.getTemplate("admin.stakeholder.list"),this.stakeholdersError=this.getTemplate("admin.stakeholder.error")},postRender:function(){var e=this,t=e.getContent();t.empty(),$.when(e.dataService.getAdminStakeholdersList()).done((function(i){if(i.length>0){e.stakeholders=i;var a=$("#admin-stakeholder-list-wrapper",e.panelWrapper);t.html(e.panelWrapper),$.tmpl(e.stakeholdersList,{stakeholdersList:e.stakeholders}).appendTo(a),$("#stakeholdersList option:first",a).attr("selected","selected"),e.configureHandlers()}else{var s=e.getResource("workportal-general-first-line-no-records-found");t.html($.tmpl(e.stakeholdersError,{errorMessage:s}))}})).fail((function(i){e.stakeholders=void 0;var a=e.getResource("workportal-widget-admin-stakeholders-error");t.html($.tmpl(e.stakeholdersError,{errorMessage:a}))}))},configureHandlers:function(){var e=this,t=$("#admin-stakeholder-list-wrapper",e.panelWrapper);$("#searchStakeholder",t).keyup((function(){var i=$(this).val().toLowerCase();$.each(e.stakeholders,(function(){var e=$('#stakeholdersList option[value="'+this.guid+'"]',t);i.length>1?-1!=this.displayName.toLowerCase().indexOf(i)?$(e).parent("span.toggleOption").length&&$(e).unwrap():0==$(e).parent("span.toggleOption").length&&$(e).wrap('<span class="toggleOption" style="display: none;" />'):$(e).parent("span.toggleOption").length&&$(e).unwrap()}))})),$("#stakeholdersList",t).change((function(){$("#stakeholdersList>span>option:selected",e.panelWrapper).prop("selected",!1),e.setInitialState(),e.drawSimpleGrid()})).trigger("change")},drawSimpleGrid:function(){var e=this,t=e.getSelectedItem();if(t.idDisplayForm&&"00000000-0000-0000-0000-000000000000"!=t.idDisplayForm){var i={guid:t.guidEntity,guidForm:t.idDisplayForm,isStakeholder:!1};$.when(e.dataService.getAdminEntitiesForm(i)).done((function(t){e.performSimpleGrid(t)}))}else e.performSimpleGrid()},performSimpleGrid:function(e){var t=this,i=t.getSelectedItem(),a={allowAdd:i.allowAdd,allowEdit:i.allowEdit,displayName:i.displayName,page:t.getCurrentPageToSimpleGrid(),pageSize:7,orderField:i.orderField||"",orderType:i.orderType||"asc",filters:i.filters,onDataBinding:function(a){a.pag=t.getCurrentPageToSimpleGrid();var s=$.Deferred();return $.when(t.dataService.getAdminEntitiesRowData($.extend(a,{guidEntity:i.guidEntity}))).done((function(i){if(e){var a=t.reshapeEntity(i,e);s.resolve(a)}else s.resolve(i)})).fail((function(e){var i=t.getResource("workportal-widget-admin-stakeholders-instances-error");$("#admin-stakeholder-instances-wrapper",t.getContent()).html($.tmpl(t.stakeholdersError,{errorMessage:i}))})),s.promise()},onLoadFilter:function(e){if("Entity"===e.type)return t.dataService.getAdminEntityData(e)},onFilterChanged:function(){t.setInitialState()},onPageChanging:function(e,i){t.setCurrentPageToSimpleGrid(i)},onAdd:function(e,i){t.validateVersionForm(this,"New")},onEdit:function(e,i){t.validateVersionForm(i,"Edit")},getResource:function(e){t.getResource(e)}};$("#admin-stakeholder-instances-wrapper",t.panelWrapper).simpleGrid(t,a).render()},getSelectedItem:function(){var e=$("#stakeholdersList option:selected",this.panelWrapper);return{guidEntity:e.val(),displayName:e.text(),allowAdd:"true"===e.attr("data-allowAdd").toLowerCase(),allowEdit:"true"===e.attr("data-allowEdit").toLowerCase(),idDisplayForm:e.attr("data-idDisplayForm"),row:this.currentIdRow,orderField:e.data("orderField"),orderType:e.data("orderType"),filters:e.data("filters")}},validateVersionForm:function(e,t){var i=this,a=$("#stakeholdersList option:selected",i.panelWrapper),s=i.stakeholders.find((function(e){return e.guid===a.val()})),n={guid:a.val(),isStakeholder:!0};"New"===t?n.guidForm=void 0!==s.idAddForm?s.idAddForm:"00000000-0000-0000-0000-000000000000":"Edit"==t&&(n.idRow=$(e).attr("data-idrowentity"),n.guidForm=void 0!==s.idEditForm?s.idEditForm:"00000000-0000-0000-0000-000000000000"),$("#detailEntity",i.panelWrapper).empty(),"00000000-0000-0000-0000-000000000000"===n.guidForm?i.validateUser(n,t):$.when(i.dataService.getAdminEntityMigrated(n.guidForm)).done((function(e){if(0==e.result||10==e.result)i.validateUser(n,t);else if(-9==e.result){var a=i.getResource("workportal-widget-admin-stakeholders-instances-error");$("#admin-stakeholder-instances-wrapper",i.getContent()).html($.tmpl(i.stakeholdersError,{errorMessage:a}))}else{"New"==t&&(n.idRow=-1);var s="App/Admin/Entity.aspx?giudEntity="+n.guid+"&idSurrogateKey="+n.idRow+"&referer=entityadmin&Action="+t+"&idForm="+n.idForm;i.loadIframeForm(s,"otherForm")}}))},saveFormEntity:function(e){var t=this,i=$.Deferred(),a={},s=t.getSelectedItem();return e.collectRenderValues(a),t.associatedUserHasChange(a)?$.when(t.duplicatedUser(a)).done((function(n){if(n.length>0)if(void 0!==n.find((function(e){return e.idEntity===s.guidEntity}))){var r=bizagi.localization.getResource("workportal-widget-admin-entities-user-asociated-error");bizagi.showMessageBox(r,"Bizagi","warning")}else t.submitFormData(e,a,i);else t.submitFormData(e,a,i)})).fail((function(e){bizagi.showMessageBox(e.message)})):t.submitFormData(e,a,i),i.promise()},submitFormData:function(e,t,i){var a=new bizagi.render.services.service;$.when(a.multiactionService.submitData({action:"SAVE",contexttype:"entity",data:t,surrogatekey:void 0!==e.surrogatekey&&e.surrogatekey,idPageCache:e.idPageCache})).done((function(e){"success"==e.type?i.resolve(!0):i.reject()})).fail((function(e){e.message&&bizagi.showMessageBox(e.message),i.reject()}))},associatedUserHasChange:function(e){var t=!1;return void 0!==this._associatedUser?void 0!==e.associatedUser&&this._associatedUser.id!==e.associatedUser.id&&(t=!0):void 0!==e.associatedUser&&(t=!0),t},validateUser:function(e,t){var i=this,a=i.getSelectedItem();$.when(i.getFormEntity(e)).done((function(e){var s=e.getRender("associatedUser");"Edit"==t&&s&&$(".bz-render-getUser-container").html(s.value.value),s.bind("renderchange",(function(t,s){s.render.getValue();var n={};e.collectRenderValues(n),$.when(i.duplicatedUser(n)).done((function(e){if(e.length>0&&void 0!==e.find((function(e){return e.idEntity===a.guidEntity}))){var t=bizagi.localization.getResource("workportal-widget-admin-entities-user-asociated-error");$.when(bizagi.showMessageBox(t,"Bizagi","warning")).done((function(){s.render.input.val(""),s.render.value=null})).fail((function(){s.render.input.val(""),s.render.value=null}))}}))}))}))},duplicatedUser:function(e){var t=$.Deferred();return $.when(this.dataService.getUserStakeholders({idUser:e.associatedUser.id})).done((function(e){t.resolve(e)})).fail((function(e){t.reject(e)})),t.promise()}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.oauth2Applications",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_OAUTH2APPLICATIONS},init:function(e,t,i){var a="bizagi.workportal.desktop.widgets.admin.oauth2.applications";this._super(e,t,i),this.loadTemplates({"admin.oauth2applications":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-oauth2applications"),"admin.edit.oauth2applications":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-edit-oauth2applications"),"admin.add.oauth2applications":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-add-oauth2applications"),useNewEngine:!1}),this.CurrentClientData={}},renderContent:function(){return this.content=$.tmpl(this.getTemplate("admin.oauth2applications")),this.content},loadtemplates:function(){this.contentOauth=$.tmpl(this.getTemplate("admin.oauth2applications"))},postRender:function(){this.getContent().html(this.contentOauth),this.performSimpleGrid()},performSimpleGrid:function(){var e=this,t={allowAdd:!0,allowEdit:!0,allowDelete:!0,allow:!0,orderEnabled:!1,displayName:"Oauth",pageSize:10,onDataBinding:function(t){var i=$.Deferred();return $.when(e.dataService.getOAuth2Applications().done((function(t,a){var s=["Id","Name","Description","ClientId","ClientSecret","AuthorizationGrantType","AccessTokenLifetimeInMinutes","AllowedScope","DefaultUserDomain","DefaultUserName","RedirectUri","RedirectUriStrategy","Website"];t.data.map((function(e){return s.forEach((function(t){void 0===e[t]&&(e[t]=""),"AuthorizationGrantType"===t&&"any"===e[t]&&(e[t]="all")})),e}));var n={};t.data.length&&(n.header=$.map($(s),(function(e){return{attributeType:1004,dataType:2,displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-applications-"+e.toLowerCase()),fieldValue:"idGuestSH",xpath:"GuestSH"}}))),e.namesApplications=[],n.row=$.map(t.data,(function(i){return e.namesApplications.push(i.Name),[$.map($(s).filter(Object.keys(t.data[0])),(function(e){var t=i[e];return"AllowedScope"==e&&(t=(i[e][0]+" "+i[e][1]).replace("openid","").trim()),t}))]})),i.resolve(n)})).fail((function(e){bizagi.log(e)}))),$.when(e.dataService.getCurrentUser()).done((function(t,i){e.userFullName=t.user})).fail((function(){})),i.promise()},onAdd:function(t,i){e.addApplication(this,"New")},onEdit:function(t,i){e.editApplication($(i).attr("data-idrowentity"))},onDelete:function(t,i){e.deleteApplication($(i).attr("data-idrowentity"))},getResource:function(e){}};$("#admin-oauth2-applications-table",e.getContent()).simpleGrid(e,t).render()},addApplication:function(e,t){$.tmpl(this.getTemplate("admin.add.oauth2applications"),{}).appendTo("#admin-oauth2-add-application"),$("#admin-oauth2-applications-wrapper").hide(),$("#admin-oauth2-add-application").show(),this.setupAddApplicationEvents(),this.setupCombos("add")},setupAddApplicationEvents:function(){var e=this;$("#btn-admin-oauth2-add").click((function(){e.save()})),$("#btn-admin-oauth2-cancel").click((function(){e.cancel("add")})),e.setupUserSuggest()},setupUserSuggest:function(e){var t="";e&&(t="edit-");var i=this,a=null,s=$("#biz-wp-oauth2-"+t+"user-domain-input"),n=$("#biz-wp-oauth2-default-"+t+"user-name-input"),r=$("#biz-wp-oauth2-default-"+t+"user-name-options");$(n).focus((function(e){$(this).length>0&&r[0].children.length>0?$(r).css("display","block"):$(r).css("display","none")})),$(n).keyup((function(e){var o,l,d=this,c=0;switch(e.keyCode){case 13:o=$("#biz-wp-oauth2-default-"+t+"user-name-options .selected:first").attr("data-target0"),l=$("#biz-wp-oauth2-default-"+t+"user-name-options .selected:first").attr("data-target1"),$(d).val(o),$(s).val(l),$(r).html(""),$(r).css("display","none");break;case 38:p("up");break;case 40:p("down");break;default:!function(){$(s).val(""),$(r).fadeIn(),null!==a&&clearTimeout(a);a=setTimeout((function(e){if(""!=e){var t={userName:e};i.dataService.searchUsersOauth(t).done((function(e){e.users&&Array.isArray(e.users)&&e.users.length>0?i.createOptionsArray(e.users.filter((function(e,t){return t<5})),r,[{element:n,value:"userName"},{element:s,value:"domain"}]):$(r).html('<div class="user-no-option">'+bizagi.localization.getResource("workportal-widget-admin-oauth2-user-search-no-results")+" </div>")})).fail((function(){$(r).html("")}))}else $(r).css("display","none")}),400,e.currentTarget.value)}()}function p(e){return $.each($(".user-option"),(function(t){if($(this).hasClass("selected"))switch(e){case"down":c+=t+1;break;case"up":c=t-1}})),c!=$(".user-option").length&&(!(c<0)&&void $.each($(".user-option"),(function(e){$(this).removeClass("selected"),e===c&&$(this).addClass("selected")})))}})).closest(".biz-wp-form-cell").focusout((function(){$(r).fadeOut()})),i.validationAccessTokenInput(e?"#biz-wp-oauth2-edit-access-token-input":"#biz-wp-oauth2-access-token-input",e)()},validationAccessTokenInput:function(e,t){var i=$(e);function a(){0===+$(e).val()?$("#suggest_lifetime").text(bizagi.localization.getResource("workportal-widget-admin-oauth2-applications-access-token-lifetime-never-expires")):$("#suggest_lifetime").text("")}return t||i.val(0),i.change(a),a},createOptionsArray:function(e,t,i){var a=this;$(t).html(""),e.forEach((function(e){$(t).append(a.createOption(e,i,t))}))},createOption:function(e,t,i){var a=t.reduce((function(t,i,a){return t+"data-target"+a+'="'+e[i.value]+'" '}),"");return $('<div class="user-option" '+a+"></div>").click({targets:t},(function(e){var t=this;e.data.targets.forEach((function(e,i){$(e.element).val($(t).data("target"+i))})),$(i).html("")})).html(e.domain+" \\ "+e.userName)},setupCombos:function(e){var t=[{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-authorization-code"),id:"authorization_code"},{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-client-credentials"),id:"client_credentials"},{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-all"),id:"any"},{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-bearer-token"),id:"bearer_token"}],i=[{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-web-application"),id:"WebApplication"},{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-mobile-bar"),id:"MobileTitleBarBrowser"},{displayName:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-mobile-port"),id:"MobileLocalhostPort"}],a=[{displayName:"Absolute",id:"Absolute"},{displayName:"Sliding",id:"Sliding"}];if("add"===e){var s=$("#biz-wp-oauth2-grant-type-input"),n=$("#biz-wp-oauth2-redirect-uri-strategy-input"),r=$("#biz-wp-oauth2-token-lifetime-type-input");this.setupCombo(s,t,"grantType"),this.setupCombo(n,i,"RedirectUri"),this.setupCombo(r,a,"tokenLifetimeType"),this.initializeOauth2Template("authorization_code")}if("edit"===e){var o=$("#biz-wp-oauth2-edit-grant-type-input"),l=$("#biz-wp-oauth2-edit-redirect-uri-strategy-input"),d=$("#biz-wp-oauth2-token-lifetime-type-input");this.setupCombo(o,t,"editGrantType"),this.setupCombo(l,i,"editRedirectUri"),this.setupCombo(d,a,"editTokenLifetimeType")}},initializeOauth2Template:function(e){var t=$("#biz-wp-oauth2-edit-scope-login-input, #biz-wp-oauth2-scope-login-input"),i=$("#biz-wp-oauth2-scope-user-sync-input, #biz-wp-oauth2-edit-scope-user-sync-input"),a=$("#biz-wp-oauth2-scope-odata-query-input, #biz-wp-oauth2-edit-scope-odata-query-input"),s=$("#biz-wp-oauth2-scope-rpa-input, #biz-wp-oauth2-edit-scope-rpa-input"),n=$("#biz-wp-oauth2-scope-odata-rules-input, #biz-wp-oauth2-edit-scope-odata-rules-input");"bearer_token"===e?($(".bz-oauth2-only-authorization-code, .bz-oauth2-only-edit-authorization-code, #bz-oauth2-only-WebApplication, #bz-oauth2-edit-only-WebApplication").hide(),$(".bz-oauth2-only-client-credentials, .bz-oauth2-only-edit-client-credentials").show(),i.removeAttr("disabled").prop("checked",!1),t.attr("disabled",!0).prop("checked",!1),s.attr("disabled",!0).prop("checked",!1)):"client_credentials"===e?t.attr("disabled",!0).prop("checked",!1):"authorization_code"===e&&(i.attr("disabled",!0).prop("checked",!1),a.attr("disabled",!0).prop("checked",!1),s.attr("disabled",!0).prop("checked",!1),n.attr("disabled",!0).prop("checked",!1))},setupCombo:function(e,t,i){var a=this;"grantType"===i?a.grantType=t[0].id:"RedirectUri"===i?a.RedirectUri=t[0].id:"tokenLifetimeType"===i&&(a.tokenLifetimeType=t[0].id),a.pos=0,"editGrantType"===i?(a.editGrantType=a.editGrantType||t[0].id,$.each(t,(function(e){t[e].id===a.editGrantType&&(a.pos=e)}))):"editRedirectUri"===i?(a.editRedirectUri=a.editRedirectUri||t[0].id,$.each(t,(function(e){t[e].id===a.editRedirectUri&&(a.pos=e)}))):"editTokenLifetimeType"===i&&(a.tokenLifetimeType=a.editTokenLifetimeType||t[0].id,$.each(t,(function(e){t[e].id===a.tokenLifetimeType&&(a.pos=e)}))),a.comboElements?a.comboElements.push(e):a.comboElements=[],e.uicombo({data:{combo:t},initValue:t[a.pos],itemValue:function(e){return e.id},itemText:function(e){return e.displayName},onChange:function(e){var t=$("#biz-wp-oauth2-scope-user-sync-input, #biz-wp-oauth2-edit-scope-user-sync-input"),s=$("#biz-wp-oauth2-scope-odata-query-input, #biz-wp-oauth2-edit-scope-odata-query-input"),n=$("#biz-wp-oauth2-scope-rpa-input, #biz-wp-oauth2-edit-scope-rpa-input"),r=$("#biz-wp-oauth2-scope-odata-rules-input, #biz-wp-oauth2-edit-scope-odata-rules-input");$(".bz-oauth2-only-authorization-code, .bz-oauth2-only-edit-authorization-code, #bz-oauth2-only-WebApplication, #bz-oauth2-edit-only-WebApplication").show(),$("#biz-wp-oauth2-edit-scope-login-input, #biz-wp-oauth2-scope-login-input").removeAttr("disabled").prop("checked",!1),"editLifetimeType"===i||"tokenLifetimeType"===i?a.tokenLifetimeType=e.ui.data("value"):"grantType"===i||"editGrantType"===i?("grantType"===i&&(a.grantType=e.ui.data("value")),"editGrantType"===i&&(a.editGrantType=e.ui.data("value")),"client_credentials"===e.ui.data("value")?($(".bz-oauth2-only-edit-authorization-code").hide(),$(".bz-oauth2-only-authorization-code").hide(),$(".bz-oauth2-only-edit-client-credentials").show(),$(".bz-oauth2-only-client-credentials").show(),t.removeAttr("disabled").prop("checked",!1),s.removeAttr("disabled").prop("checked",!1),n.removeAttr("disabled").prop("checked",!1),r.removeAttr("disabled").prop("checked",!1)):"authorization_code"===e.ui.data("value")?($(".bz-oauth2-only-client-credentials").hide(),$(".bz-oauth2-only-authorization-code").show(),$(".bz-oauth2-only-edit-client-credentials").hide(),$(".bz-oauth2-only-edit-authorization-code").show(),t.attr("disabled",!0).prop("checked",!1),s.attr("disabled",!0).prop("checked",!1),n.attr("disabled",!0).prop("checked",!1),r.attr("disabled",!0).prop("checked",!1)):"bearer_token"===e.ui.data("value")||($(".bz-oauth2-only-client-credentials").show(),$(".bz-oauth2-only-authorization-code").show(),$(".bz-oauth2-only-edit-client-credentials").show(),$(".bz-oauth2-only-edit-authorization-code").show(),t.attr("disabled",!0).prop("checked",!1),s.attr("disabled",!0).prop("checked",!1),n.attr("disabled",!0).prop("checked",!1),r.attr("disabled",!0).prop("checked",!1)),a.initializeOauth2Template(e.ui.data("value"))):"RedirectUri"===i||"editRedirectUri"===i?("RedirectUri"===i&&(a.RedirectUri=e.ui.data("value")),"editRedirectUri"===i&&(a.editRedirectUri=e.ui.data("value")),"WebApplication"===e.ui.data("value")?($("#bz-oauth2-only-MobileLocalhostPort").hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort").hide(),$("#bz-oauth2-only-WebApplication").show(),$("#bz-oauth2-edit-only-WebApplication").show()):"MobileTitleBarBrowser"===e.ui.data("value")?($("#bz-oauth2-only-WebApplication").hide(),$("#bz-oauth2-only-MobileLocalhostPort").hide(),$("#bz-oauth2-edit-only-WebApplication").hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort").hide()):($("#bz-oauth2-only-WebApplication").hide(),$("#bz-oauth2-edit-only-WebApplication").hide(),$("#bz-oauth2-only-MobileLocalhostPort").show(),$("#bz-oauth2-edit-only-MobileLocalhostPort").show())):"AllowedScope"===i?a.AllowedScope=e.ui.data("value"):"editAllowedScope"===i&&(a.editAllowedScope=e.ui.data("value"))}})},showErrors:function(e,t){e.show(),e.html(bizagi.localization.getResource(t))},dataValidating:function(e){var t="";"edit"===e&&(t="edit-");var i=$("#bz-oauth2-applications-errors-board");i.hide(),$("#bz-oauth2-applications-"+t+"error-scope-required").hide();var a=$("#biz-wp-oauth2-"+t+"name-input").val();if((a=a.trim()).length<1)return this.showErrors(i,"workportal-widget-admin-oauth2-error-app-name-required"),!1;if(this.namesApplications.findIndex((function(e){return e===a}))>=0&&("edit"!==e||this.CurrentClientData.Name!==a))return this.showErrors(i,"workportal-widget-admin-oauth2-error-name-duplicated"),!1;if(!($("#biz-wp-oauth2-"+t+"scope-api-input").is(":checked")||$("#biz-wp-oauth2-"+t+"scope-login-input").is(":checked")||$("#biz-wp-oauth2-"+t+"scope-user-sync-input").is(":checked")))return this.showErrors(i,"workportal-widget-admin-oauth2-error-atleastone-allowed-scope"),$("#bz-oauth2-applications-"+t+"error-scope-required").show(),!1;var s="save"===e?this.grantType:this.editGrantType,n=$("#biz-wp-oauth2-"+t+"user-domain-input").val().trim(),r=$("#biz-wp-oauth2-default-"+t+"user-name-input").val().trim();if(("client_credentials"===s||"any"===s||"bearer_token"===s)&&(n.length<1||r.length<1))return this.showErrors(i,"workportal-widget-admin-oauth2-user-domain-required"),!1;var o="save"===e?this.RedirectUri:this.editRedirectUri,l=$("#biz-wp-oauth2-"+t+"redirect-uri-input").val().trim(),d=$("#biz-wp-oauth2-"+t+"mobile-host-port").val().trim();if("authorization_code"===s||"any"===s)if("WebApplication"===o){if(l.length<1||!/^(ftp|http|https):\/\/[^ "]+$/.test(l))return this.showErrors(i,"workportal-widget-admin-users-request-url-invalid"),!1}else if("MobileLocalhostPort"===o&&(d.length<1||isNaN(d)||Math.floor(d)!==parseFloat(d)))return this.showErrors(i,"workportal-widget-admin-oauth2-error-port-invalid"),!1;var c=$("#biz-wp-oauth2-"+t+"access-token-input").val().trim();return!(c.length<1||isNaN(c)||Math.floor(c)!==parseFloat(c))||(this.showErrors(i,"workportal-widget-admin-oauth2-error-time-invalid"),!1)},save:function(){var e=this;if(!0===e.dataValidating("save")){var t="";$("#biz-wp-oauth2-scope-api-input").is(":checked")&&(t+="api"),$("#biz-wp-oauth2-scope-login-input").is(":checked")&&(t+=" login"),$("#biz-wp-oauth2-scope-user-sync-input").is(":checked")&&(t+=" usersync"),$("#biz-wp-oauth2-scope-odata-query-input").is(":checked")&&(t+=" odataquery"),$("#biz-wp-oauth2-scope-rpa-input").is(":checked")&&(t+=" rpa"),$("#biz-wp-oauth2-scope-odata-rules-input").is(":checked")&&(t+=" odatarules");var i={};i.authorization_grant_type=e.grantType,i.allowed_scope=t,i.username_creator=e.userFullName,i.redirect_uri_strategy=e.RedirectUri,i.tokenLifetimeType=e.tokenLifetimeType,"client_credentials"!==e.grantType&&"bearer_token"!==e.grantType||(i.redirect_uri="http://localhost--");for(var a=$("#formAddOAuthApp :input").serializeArray(),s=0;s<a.length;s++)a[s].value&&("redirect_uri_port"===a[s].name&&"MobileLocalhostPort"===e.RedirectUri?i.redirect_uri=a[s].value:i[a[s].name]=a[s].value);e.dataService.createOAuth2Application(i).done((function(){e.performSimpleGrid(),e.cancel("add")}))}},getGrantType:function(e){return{authorization_code:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-authorization-code"),client_credentials:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-client-credentials"),any:bizagi.localization.getResource("workportal-widget-admin-oauth2-grandtype-all")}[e]},getRedirectStrategy:function(e){return{WebApplication:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-web-application"),MobileTitleBarBrowser:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-mobile-bar"),MobileLocalhostPort:bizagi.localization.getResource("workportal-widget-admin-oauth2-redirecturi-mobile-port")}[e]},getMobileLocalhostPort:function(e,t){if("MobileLocalhostPort"===t){var i=e.match(/:([0-9]+)/)[1];return parseInt(i)}return""},editApplication:function(e){var t=this,i=t.getContent();i=i[4]?i[4]:i[2],$.when(t.dataService.getOAuth2Application(e)).done((function(e){if(e.success){var a=function(e){return $.grep(t.CurrentClientData.AllowedScope,(function(t){return t===e})).length};t.CurrentClientData=e.data,"WebApplication"!=t.CurrentClientData.RedirectUriStrategy?t.CurrentClientData.uri="":t.CurrentClientData.uri=t.CurrentClientData.RedirectUri,$.tmpl(t.getTemplate("admin.edit.oauth2applications"),{editGrantType:t.CurrentClientData.AuthorizationGrantType,data:t.CurrentClientData},{getGrantType:t.getGrantType,getRedirectStrategy:t.getRedirectStrategy,getMobileLocalhostPort:t.getMobileLocalhostPort}).appendTo(i),t.ActualNameForEdit=t.CurrentClientData.Name,t.DataAllowedScope=t.CurrentClientData.AllowedScope,t.editGrantType=t.CurrentClientData.AuthorizationGrantType,t.editRedirectUri=t.CurrentClientData.RedirectUriStrategy,t.editTokenLifetimeType=t.CurrentClientData.TokenLifetimeType,a("api")>0&&$("#biz-wp-oauth2-edit-scope-api-input",i).prop("checked",!0),a("login")>0&&$("#biz-wp-oauth2-edit-scope-login-input",i).prop("checked",!0),a("usersync")>0&&setTimeout((function(){$("#biz-wp-oauth2-edit-scope-user-sync-input",i).prop("checked",!0)})),a("odataquery")>0&&setTimeout((function(){$("#biz-wp-oauth2-edit-scope-odata-query-input",i).prop("checked",!0)})),a("rpa")>0&&setTimeout((function(){$("#biz-wp-oauth2-edit-scope-rpa-input",i).prop("checked",!0)})),a("odatarules")>0&&setTimeout((function(){$("#biz-wp-oauth2-edit-scope-odata-rules-input",i).prop("checked",!0)})),a("rpa")>0&&setTimeout((function(){$("#biz-wp-oauth2-edit-scope-rpa-input",i).prop("checked",!0)})),t.CurrentClientData.IsNative?($("#biz-wp-oauth2-edit-scope-api-input",i).attr("disabled",!0),$("#biz-wp-oauth2-edit-scope-login-input",i).attr("disabled",!0)):(t.setupCombos("edit"),"client_credentials"===t.editGrantType?($(".bz-oauth2-only-edit-client-credentials",i).show(),$(".bz-oauth2-only-edit-authorization-code",i).hide()):"authorization_code"===t.editGrantType?($(".bz-oauth2-only-edit-client-credentials",i).hide(),$(".bz-oauth2-only-edit-authorization-code",i).show()):"bearer_token"===t.editGrantType||($(".bz-oauth2-only-edit-client-credentials",i).show(),$(".bz-oauth2-only-edit-authorization-code",i).show()),t.initializeOauth2Template(t.editGrantType),"WebApplication"===t.CurrentClientData.RedirectUriStrategy?($("#bz-oauth2-edit-only-WebApplication",i).show(),$("#bz-oauth2-edit-only-MobileLocalhostPort",i).hide()):"MobileTitleBarBrowser"===t.CurrentClientData.RedirectUriStrategy?($("#bz-oauth2-edit-only-WebApplication",i).hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort",i).hide()):($("#bz-oauth2-edit-only-WebApplication",i).hide(),$("#bz-oauth2-edit-only-MobileLocalhostPort",i).show()))}$("#admin-oauth2-applications-wrapper").hide(),$(i).show(),$("#btn-admin-oauth2-update-keys",i).click((function(){t.updateApplicationKeys()})),$("#btn-admin-edit-oauth2-cancel",i).click((function(){t.cancel("edit")})),t.CurrentClientData.IsNative?$("#btn-admin-edit-oauth2-add",i).click((function(){t.updateNaviteApplication()})):$("#btn-admin-edit-oauth2-add",i).click((function(){t.updateApplication()})),t.setupUserSuggest(!0)})).fail((function(){}))},updateNaviteApplication:function(){var e=this,t={accessTokenLifetimeInMinutes:""};t.accessTokenLifetimeInMinutes=parseInt($("#biz-wp-oauth2-edit-access-token-input").val(),10),!isNaN(t.accessTokenLifetimeInMinutes)&&t.accessTokenLifetimeInMinutes>0?e.dataService.updateOAuth2Application(t,e.CurrentClientData.Id).done((function(){e.performSimpleGrid(),e.cancel("edit")})):$("#bz-oauth2-applications-error-time-invalid").show()},updateApplication:function(){var e=this;if(!0===e.dataValidating("edit")){var t=$("#biz-wp-oauth2-edit-id-input").val(),i="";$("#biz-wp-oauth2-edit-scope-api-input").is(":checked")&&(i+="api"),$("#biz-wp-oauth2-edit-scope-login-input").is(":checked")&&(i+=" login"),$("#biz-wp-oauth2-edit-scope-user-sync-input").is(":checked")&&(i+=" usersync"),$("#biz-wp-oauth2-edit-scope-odata-query-input").is(":checked")&&(i+=" odataquery"),$("#biz-wp-oauth2-edit-scope-rpa-input").is(":checked")&&(i+=" rpa"),$("#biz-wp-oauth2-edit-scope-odata-rules-input").is(":checked")&&(i+=" odatarules");var a={};a.authorization_grant_type=e.editGrantType,a.allowed_scope=i,a.username_creator=e.userFullName,a.redirect_uri_strategy=e.editRedirectUri,"client_credentials"===e.editGrantType&&(a.redirect_uri="http://localhost--");for(var s=$("#formEditOAuthApp :input").serializeArray(),n=0;n<s.length;n++)s[n].value&&("redirect_uri_port"===s[n].name&&"MobileLocalhostPort"===e.editRedirectUri?a.redirect_uri="http://localhost:"+s[n].value:a[s[n].name]=s[n].value);e.dataService.updateOAuth2Application(a,t).done((function(t){t&&"user_not_found"===t.error?bizagi.showMessageBox(bizagi.localization.getMessageFromLocalization("workportal-general-error-1150","none",[a.default_username]),null,"warning"):(e.performSimpleGrid(),e.cancel("edit"))})).fail((function(e,t,i){console.warn(arguments)}))}},updateApplicationKeys:function(){var e=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-oauth2-applications-update-keys-confirmation"),"Bizagi","warning")).done((function(){var t=$("#biz-wp-oauth2-edit-id-input").val(),i={client_id:e.CurrentClientData.ClientId,client_secret:e.CurrentClientData.ClientSecret};e.dataService.updateClientSecretKeysOAuth2Application(i,t).done((function(t){t.success?(e.performSimpleGrid(),e.cancel("edit")):$.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-oauth2-error-update-keys"),null,"warning")).done((function(){e.performSimpleGrid(),e.cancel("edit")}))})).fail((function(t){$.when(bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-oauth2-error-update-keys"),null,"warning")).done((function(){e.performSimpleGrid(),e.cancel("edit")}))}))}))},deleteApplication:function(e){var t=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-grid-delete-confirmation"),"Bizagi","warning")).done((function(){t.dataService.deleteOAuth2Application(e).done((function(e){t.performSimpleGrid()}))}))},cancel:function(e){"add"===e&&$("#admin-oauth2-add-application").children().remove(),"edit"===e&&$("#admin-oauth2-edit-application").children().remove(),$("#admin-oauth2-applications-wrapper").show(),this.cleanData()},cleanData:function(){self.AllowedScope=null,self.editAllowedScope=null,self.userFullName=null,self.grantType=null,self.editGrantType=null,self.RedirectUri=null,self.editRedirectUri=null,self.tokenLifetimeType=null,self.editTokenLifetimeType=null,$(".biz-wp-input-text").val(""),$(".biz-wp-oauth2-select-control").children().remove(),self.CurrentClientData={}},destroy:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.error.logs",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ERROR_LOGS},init:function(e,t,i){var a="bizagi.workportal.desktop.widgets.admin.error.logs";this._super(e,t,i),this.loadTemplates({"admin.errorlogs":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-errorlogs"),"admin.errorlogs.detail":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-errorlogs-detail"),"admin.errorlogs.export":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-errorlogs-export"),useNewEngine:!1}),this.dateFormat=bizagi.localization.getResource("dateFormat"),this.timeFormat=bizagi.localization.getResource("timeFormat"),this.CurrentClientData={selectedGuids:[]}},renderContent:function(){return this.content=$.tmpl(this.getTemplate("admin.errorlogs")),this.content},postRender:function(){this.setupSearchFilter(),this.setupDatePicker(),this.setupFilterButtons(),this.setupExportButton(),this.setupJSGrid()},setupSearchFilter:function(){var e=this;$("#admin-errorlogs-filter-search",e.getContent()).on("input",(function(){""!=$(this).val()&&e.changeSearchForm()})),$("#admin-errorlogs-filter-search",e.getContent()).on("keyup",(function(t){"Enter"!==t.key&&13!==t.keyCode||""!=$(this).val()&&e.applyFilter()}))},setupDatePicker:function(){var e=this,t="en";bizagi.util.languages[BIZAGI_LANGUAGE]&&(t=bizagi.util.languages[BIZAGI_LANGUAGE].substring(0,2)),$("#admin-errorlogs-filter-startDate",e.getContent()).mobiscroll().calendar({controls:["calendar","time"],cssClass:"mbsc-bizagi-theme",display:"bubble",focusTrap:!1,lang:t,onBeforeShow:function(e,t){var i=t.getVal();return i||((i=new Date).setHours(0),i.setMinutes(0),i.setSeconds(0),t.setVal(i)),!0},onSet:function(t,i){e.changeSearchForm()}}),$("#admin-errorlog-filter-endDate",e.getContent()).mobiscroll().calendar({controls:["calendar","time"],cssClass:"mbsc-bizagi-theme",display:"bubble",focusTrap:!1,lang:t,onSet:function(t,i){e.changeSearchForm()}})},changeSearchForm:function(){$("#btn-admin-errorlogs-filter-apply>span",this.getContent()).prop("textContent",bizagi.localization.getResource("workportal-widget-admin-errorlogs-filter-apply")),$("#btn-admin-errorlogs-filter-reset").css("visibility","visible")},clearSearchForm:function(){$("#btn-admin-errorlogs-filter-apply>span",this.getContent()).prop("textContent",bizagi.localization.getResource("workportal-widget-admin-errorlogs-filter-refresh")),$("#btn-admin-errorlogs-filter-reset").css("visibility","hidden")},setupFilterButtons:function(){var e=this;$("#btn-admin-errorlogs-filter-apply",e.getContent()).click((function(){e.applyFilter()})),$("#btn-admin-errorlogs-filter-reset",e.getContent()).click((function(){e.resetFilter()}))},applyFilter:function(){var e=$("#admin-errorlogs-filter-search").prop("value"),t=$("#admin-errorlogs-filter-startDate").mobiscroll("getVal"),i=$("#admin-errorlog-filter-endDate").mobiscroll("getVal");e||t&&i&&i.getTime()>t.getTime()?$("#admin-errorlogs-grid").jsGrid("loadData",{startTime:t?this.getTicks(t):"",endTime:i?this.getTicks(i):"",filter:e}):$("#admin-errorlogs-grid").jsGrid("loadData")},resetFilter:function(){$("#admin-errorlogs-filter-search").val(""),$(".biz-wp-form-datepicker").mobiscroll("clear"),$("#btn-admin-errorlogs-filter-reset").css("visibility","hidden"),$("#btn-admin-errorlogs-filter-apply>span",this.getContent()).prop("textContent",bizagi.localization.getResource("workportal-widget-admin-errorlogs-filter-refresh")),$("#admin-errorlogs-grid").jsGrid("loadData")},getTicks:function(e){var t=6e8*e.getTimezoneOffset();return 1e4*e.getTime()-t},setupExportButton:function(){var e=this;$("#btn-admin-errorlogs-export",e.getContent()).click((function(){e.CurrentClientData.selectedGuids.length<=0||e.dataService.getErrorLogsArchive(e.CurrentClientData.selectedGuids).done((function(t){t.ZipContent&&e.showExportDialog($("#admin-errorlogs-table"),t)}))}))},setupJSGrid:function(){var e=this,t=bizagi.localization.getResource("workportal-widget-admin-errorlogs-grid-id"),i=bizagi.localization.getResource("workportal-widget-admin-errorlogs-grid-datetime"),a=bizagi.localization.getResource("workportal-widget-admin-errorlogs-grid-username"),s=bizagi.localization.getResource("workportal-widget-admin-errorlogs-grid-casenumber"),n=bizagi.localization.getResource("workportal-widget-admin-errorlogs-grid-sourcenode"),r=bizagi.localization.getResource("workportal-widget-admin-errorlogs-grid-description"),o=bizagi.localization.getResource("workportal-widget-admin-errorlogs-grid-nodatacontent"),l=e.dateFormat+" "+e.timeFormat;if($("#admin-errorlogs-grid",e.getContent()).jsGrid({autoload:!0,controller:{loadData:function(t){return e.dataService.getErrorLogs(t)}},editing:!1,fields:[{deleteButton:!1,editButton:!1,headerTemplate:function(){return $('<input id="grid-control-header" type="checkbox"></input>').on("click",(function(){$(this).prop("checked")?($(this).prop("checked",!0),$("#btn-admin-errorlogs-export").prop("disabled",!1),$(".grid-control-item",e.getContent()).each((function(){$(this).prop("checked",!0),e.CurrentClientData.selectedGuids.push($(this).prop("value"))}))):e.clearSelection()}))},itemTemplate:function(t,i){return $('<input class="grid-control-item" type="checkbox" value="'+i.Id+'" />').on("click",(function(){if($(this).prop("checked"))e.CurrentClientData.selectedGuids.push($(this).prop("value")),$("#grid-control-header",e.getContent()).prop("checked",!0),$("#btn-admin-errorlogs-export").prop("disabled",!1);else{var t=e.CurrentClientData.selectedGuids.indexOf($(this).prop("value"));e.CurrentClientData.selectedGuids.splice(t,1),0==e.CurrentClientData.selectedGuids.length?($("#btn-admin-errorlogs-export").prop("disabled",!0),$("#grid-control-header",e.getContent()).prop("checked",!1)):($("#btn-admin-errorlogs-export").prop("disabled",!1),$("#grid-control-header",e.getContent()).prop("checked",!0))}}))},type:"control",width:50},{align:"center",css:"admin-errorlogs-grid-cell-truncate",name:"Id",title:t,type:"text"},{align:"center",css:"admin-errorlogs-grid-cell-truncate",itemTemplate:function(e,t){return bizagi.util.dateFormatter.formatDate(new Date(e),l)},name:"DateTime",title:i,width:100,type:"text"},{align:"center",css:"admin-errorlogs-grid-cell-truncate",name:"UserName",title:a,width:120,type:"text"},{align:"center",css:"admin-errorlogs-grid-cell-truncate",name:"CaseNumber",title:s,width:80,type:"text"},{align:"center",css:"admin-errorlogs-grid-cell-truncate",name:"Node",title:n,width:120,type:"text"},{align:"left",css:"admin-errorlogs-grid-cell-truncate",itemTemplate:function(t,i){return $('<span class="admin-errorlogs-grid-cell-detail-link">'+t+"</span>").on("click",(function(){e.dataService.getErrorLogsContents([i.Id]).done((function(t){t&&e.showDetailDialog(t)}))}))},name:"Description",title:r,type:"text"}],paging:!0,pageButtonCount:5,pageSize:20,pageNextText:$('<svg class="bz-icon bz-icon-16 bz-icon-svg"><use xlink:href="#icon-arrow-next" /></svg>'),pagePrevText:$('<svg class="bz-icon bz-icon-16 bz-icon-svg"><use xlink:href="#icon-arrow-prev" /></svg>'),pageFirstText:$('<svg class="bz-icon bz-icon-16 bz-icon-svg""><use xlink:href="#icon-arrow-first" /></svg>'),pageLastText:$('<svg class="bz-icon bz-icon-16 bz-icon-svg"><use xlink:href="#icon-arrow-last" /></svg>'),pagerFormat:"{first} {prev} {pages} {next} {last} &nbsp;&nbsp; {pageIndex} / {pageCount}",noDataContent:o,width:"100%",onPageChanged:function(t){e.clearSelection()},onRefreshed:function(t){e.clearSelection()}}),(d=bizagi.util.languages[BIZAGI_LANGUAGE])&&!d.startsWith("en")){var d=d.substring(0,2);jsGrid.locales[d]&&jsGrid.locale(d)}},clearSelection:function(){$("#grid-control-header").prop("checked",!1),$("#btn-admin-errorlogs-export").prop("disabled",!0),$(".grid-control-item",this.getContent()).prop("checked",!1),this.CurrentClientData.selectedGuids=[]},showDetailDialog:function(e){var t=this.dateFormat+" "+this.timeFormat;e[0].DateTime=bizagi.util.dateFormatter.formatDate(new Date(e[0].DateTime),t),e[0].Content=atob(e[0].Content),$.tmpl(this.getTemplate("admin.errorlogs.detail"),{errorlog:e[0]}).appendTo("#admin-errorlogs-detail-placeholder"),$("#admin-errorlogs-table").hide(),$("#admin-errorlogs-detail-placeholder").show(),this.setupBackButton(),this.setupExportDetailButton()},setupBackButton:function(){$("#btn-admin-errorlogs-detail-back").click((function(){$("#admin-errorlogs-detail").remove(),$("#admin-errorlogs-detail-placeholder").hide(),$("#admin-errorlogs-table").show()}))},setupExportDetailButton:function(){var e=this;$("#btn-admin-errorlogs-detail-export",e.getContent()).click((function(){var t=$("#admin-errorlogs-detail-info-current").text();e.dataService.getErrorLogsArchive([t]).done((function(t){t.ZipContent&&e.showExportDialog($("#admin-errorlogs-detail"),t)}))}))},showExportDialog:function(e,t){$.tmpl(this.getTemplate("admin.errorlogs.export"),{password:t.Password}).appendTo("#admin-errorlogs-export-placeholder"),e.hide(),$("#admin-errorlogs-export-placeholder").show(),this.setupCopypassButton(),this.setupDownloadButton(t.ZipContent),this.setupCancelButton(e)},setupCopypassButton:function(){$("#admin-errorlogs-export-password-field",this.getContent()).tooltip({content:bizagi.localization.getResource("workportal-widget-admin-errorlogs-detail-tooltip"),items:"input[type=text]",position:{my:"left+4 center",at:"right+4 center"},show:!1}).off("mouseover").off("focusin"),$("#admin-errorlogs-export-password-field",this.getContent()).click((function(){$(this).focus(),$(this).select(),document.execCommand("copy"),$(this).tooltip("open")}))},setupDownloadButton:function(e){$("#btn-admin-errorlogs-export-download",this.getContent()).click((function(){for(var t=atob(e),i=new Array(t.length),a=0;a<t.length;a++)i[a]=t.charCodeAt(a);var s=new Uint8Array(i),n=new Blob([s],{type:"application/zip"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,"BizagiErrorLogs.zip");else{var r=window.URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download="BizagiErrorLogs.zip",o.click(),window.URL.revokeObjectURL(r)}}))},setupCancelButton:function(e){$("#btn-admin-errorlogs-export-cancel",this.getContent()).click((function(){$("#admin-errorlogs-export-placeholder").hide(),$("#admin-errorlogs-export").remove(),e.show()}))}}),bizagi.workportal.widgets.admin.business.policies.vocabularies.extend("bizagi.workportal.widgets.admin.business.policies.vocabularies",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.business.policies.vocabularies.wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-vocabularies-wrapper"),"admin.business.policies.vocabularies.content":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.policies").concat("#ui-bizagi-workportal-widget-admin-business-policies-vocabularies-content"),useNewEngine:!1})},renderContent:function(){var e,t=this.getTemplate("admin.business.policies.vocabularies.wrapper");return this.decisionTableContent=this.getTemplate("admin.business.policies.vocabularies.content"),e=this.content=$.tmpl(t,{}),this.params.canvas&&(e=$(this.params.canvas).append(e)),e},postRender:function(){}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.async.activities",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_ASYNC_ACTIVITIES},renderContent:function(){var e,t=this.getTemplate("admin.async.activities");return e=this.content=$.tmpl(t,{}),this.loadtemplates(),e},loadtemplates:function(){}}),bizagi.workportal.widgets.admin.cases.extend("bizagi.workportal.widgets.admin.cases",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.cases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-cases"),useNewEngine:!1})},postRender:function(){var e=this;e.userTableConf={pageSize:10},$.when(e.dataService.getOrganizationInfo("Skill"),e.dataService.getOrganizationInfo("Location"),e.dataService.getOrganizationInfo("Role")).done((function(t,i,a){e.renderSearchCaseForm(a[0],t[0],i[0])}))},renderSearchCaseForm:function(e,t,i){var a=this.getContent(),s=this.getTemplate("admin.search.cases");$.tmpl(s,{skill:t.profiles.length,role:e.profiles.length,location:i.profiles.length}).appendTo($("#form-search-cases",a)),t.profiles.length&&(this.skillInput=$("#skill-wrapper",a),this.skillInput.searchList({list:t.profiles,cases:[]})),e.profiles.length&&(this.roleInput=$("#role-wrapper",a),this.roleInput.searchList({list:e.profiles,cases:[]})),i.profiles.length&&(this.locationInput=$("#location-wrapper",a),this.locationInput.searchList({list:i.profiles,cases:[]})),this.searchCasesForm=$(".admin-form-search-cases",a),this.searchCaseFormEventHandler()},renderSearchUserForm:function(e){var t=this.getContent(),i=this.getTemplate("admin.search.users");$.tmpl(i).appendTo($("#form-search-users",t)),$("#cases-found-message-wrapper .message",t).text(printf(this.resources.getResource("workportal-widget-admincase-casesfound"),e)),this.eventHandlerSearchUserForm()},showSearchCaseForm:function(e){var t=this.getContent();e?($("#form-search-cases",t).show(),this.searchCasesForm.show()):$("#form-search-cases",t).hide()},showSearchUsersForm:function(e){var t=this.getContent();e?this.renderSearchUserForm():$("#form-search-users",t).html("")},eventHandlerSearchUserForm:function(){var e=this,t=e.getContent();$("#search-user",t).bind("click",(function(i){i.preventDefault();var a=$("#admin-form-search-users-wrapper",t);e.showConfirmAssignCasesForm(!1);var s={};s.userName=$("#txtSAMAccount",a).val(),s.fullname=$("#txtFullName",a).val(),s.domain=$("#txtDomain",a).val(),s.skills=$("#skill",t).val(),s.locations=$("#location",t).val(),s.roles=$("#role",t).val(),e.showLoaderAtContainer($("#user-list-wrapper")),$.when(e.dataService.searchUsers(s)).done((function(t){e.closeLoader(),e.updateTotalUsersForm(t)}))})),$("#back-search-case-form",t).bind("click",(function(t){t.preventDefault(),e.showSearchUsersForm(!1),e.showSearchCaseForm(!0)})),$("#confirm-assign-cases",t).bind("click",(function(i){i.preventDefault();for(var a=$("#admin-form-search-users-wrapper",t),s={},n=$("#user-list-wrapper .user-list-item label",a).filter(".ui-radio-state-checked").parent(),r=[],o=n.length;o-- >0;)r.push(Number($("input",n[o]).val()));s.user=r,s.skills=e.getCasesSearchParams().skills,s.locations=e.getCasesSearchParams().locations,s.roles=e.getCasesSearchParams().roles,$.when(e.dataService.reassignCases(s)).done((function(t){e.showConfirmAssignCasesMessage(!0)})).fail((function(e){}))})),$("#cancel-assign-cases",t).bind("click",(function(t){t.preventDefault(),e.showConfirmAssignCasesForm(!1)}))},searchCaseFormEventHandler:function(){var e=this,t=e.getContent();$("li[name=role], li[name=skill], li[name=location]",t).bind("click",(function(){var e=$(this).find("span.ui-icon");"uncheck"==e.attr("data-state")?e.attr("data-state","check"):e.attr("data-state","uncheck")})),$("#search-case",t).bind("click",(function(t){t.preventDefault();var i=e.skillInput?e.skillInput.searchList("option","cases"):[],a=e.roleInput?e.roleInput.searchList("option","cases"):[],s={skills:i,locations:e.locationInput?e.locationInput.searchList("option","cases"):[],roles:a};e.searchCasesForm.hide(),e.showLoaderAtContainer(e.searchCasesForm),$.when(e.dataService.getCasesByOrganization(s)).done((function(t){e.closeLoader(),e.updateTotalCasesFound(s,t)}))}))},showLoaderAtContainer:function(e){self.dialogBox=$("<div class='ui-bizagi-component-loading'/>"),e.after(self.dialogBox)},closeLoader:function(){self.dialogBox.remove()},setCasesSearchParams:function(e){this.caseSearchParams=e},getCasesSearchParams:function(e){return this.caseSearchParams},updateTotalCasesFound:function(e,t){var i=this.getContent(),a=$("#no-cases-found-message-wrapper",i);this.setCasesSearchParams(e),t.totalCases>0?(a.hide(),this.showSearchCaseForm(!1),this.renderSearchUserForm(t.totalCases)):(this.showSearchCaseForm(!0),a.show())},updateTotalUsersForm:function(e){var t=this.getContent(),i=$("#no-users-found-message-wrapper",t);e.users.length>0?(i.hide(),this.userList={data:e.users},this.createPage(1)):i.show()},createPage:function(e){var t,i=this,a=i.getContent(),s=$("#user-list-wrapper",a),n=i.getTemplate("admin.table.users"),r=Math.ceil(i.userList.data.length/i.userTableConf.pageSize),o=new Array(r),l=[],d=i.userTableConf.pageSize*(e-1);t=i.userTableConf.pageSize+d<=i.userList.data.length?i.userTableConf.pageSize:i.userList.data.length-d,$(".user-list-item",s).remove(),t+=d;for(var c=0;c<r;c++)o[c]=c+1;l=(l=[].concat(i.userList.data)).splice(d,t);var p=$.tmpl(n,{users:l,pages:o});s.html(p),i.tableUsersHandlers(),i.updateTableUsersPager(e),$("ul").bizagiPagination({maxElemShow:10,totalPages:r,actualPage:e,listElement:$("#user-list-footer-wrapper",a),clickCallBack:function(e){i.createPage(e.page),i.showConfirmAssignCasesForm(!1)}})},tableUsersHandlers:function(){var e=this,t=e.getContent(),i=$("#user-list-wrapper",t);$(".user-list-item",i).click((function(t){$("label",this).toggleClass("ui-radio-state-checked");var a=$(".ui-radio label",i).filter(".ui-radio-state-checked").length>0;e.showConfirmAssignCasesForm(a),e.showConfirmAssignCasesMessage(!a)})),$(".user-list-item",i).hover((function(){$(this).attr("data-value")||$("label",this).addClass("ui-radio-state-hover")}),(function(){$(this).attr("data-value")||$("label",this).removeClass("ui-radio-state-hover")})),$("tbody tr",i).each((function(){$(this).index()%2<1&&$(this).addClass("biz-ui-even")}))},updateTableUsersPager:function(e){var t=this.getContent(),i=$("#table",t);$("#user-list span[data-value="+e+"]",i).addClass("current-page")},showConfirmAssignCasesForm:function(e){var t=this.getContent();e?$("#assing-cases-confirm-form-wrappper",t).show():$("#assing-cases-confirm-form-wrappper",t).hide()},showConfirmAssignCasesMessage:function(e){var t=this.getContent();e?($("#assing-cases-confirm-form",t).hide(),$("#assign-cases-message-wrapper",t).show()):($("#assing-cases-confirm-form",t).show(),$("#assign-cases-message-wrapper",t).hide()),$("#users-found-message-wrapper",t).hide()}}),bizagi.workportal.widgets.admin.caseSearch.extend("bizagi.workportal.widgets.admin.caseSearch",{CLASSES:{SORT_COL_ASC:"sortColumnsDataUpIcon",SORT_COL_DES:"sortColumnsDataDownIcon",SORT_COL_NOT:"sortColumnsDataIcon"}},{init:function(e,t,i){this.adhocIds=[],this._super(e,t,i),this.selectedCaseAdmin=[],this.selectedWorkItemAdmin=[],this.columnsID={caseNumber:"I_radNumber",process:"I_wfClsDisplayName",task:"I_tskDisplayName",processCreationDate:"I_casCreationDate",taskDueDate:"I_wiEstimatedSolutionDate",processDueDate:"I_casSolutionDate",userName:"I_userName",userfullName:"I_fullName",userLocation:"I_locName"},this.loadTemplates({"admin.case.search":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search"),"admin.case.search.fields":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-fields"),"admin.case.search.button":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-buttons"),"admin.case.search.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-result"),"admin.case.search.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-pagination"),"admin.case.search.invalidate":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-invalidate"),"admin.case.search.reassign":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-reassign"),"admin.case.search.reassign.form":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-reassign-form"),"admin.case.search.action.result":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-action-result"),"admin.case.search.loader":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.caseSearch").concat("#ui-bizagi-workportal-widget-admin-case-search-loader"),useNewEngine:!1})},loadtemplates:function(){this.generalContentTmpl=this.getTemplate("admin.case.search"),this.fieldsContentTmpl=this.getTemplate("admin.case.search.fields"),this.buttonContentTmpl=this.getTemplate("admin.case.search.button"),this.resultContentTmpl=this.getTemplate("admin.case.search.result"),this.paginationTmpl=this.getTemplate("admin.case.search.pagination"),this.invalidateContentTmpl=this.getTemplate("admin.case.search.invalidate"),this.reassignContentTmpl=this.getTemplate("admin.case.search.reassign"),this.reassignFormTmpl=this.getTemplate("admin.case.search.reassign.form"),this.actionResultContentTmpl=this.getTemplate("admin.case.search.action.result"),this.loaderTmpl=this.getTemplate("admin.case.search.loader"),this.loader=$.tmpl(this.loaderTmpl,{})},postRender:function(){this.defaultMaxRows=10,this.maxElemShow=this.defaultMaxRows,this.maxPageToShow=5,this.processNavigation=[],this.setupData()},showNotifier:function(){window.parent.bizagi.injector.get("notifier").showSucessMessage(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidation-message"),"",{svgIcon:!0,closeButton:!0})},showConfirmationMessage:function(){var e=this;$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admincasesearch-action-invalidation-confirmation"),bizagi.localization.getResource("workportal-general-word-information"),"info")).done((function(){e.showLoading(),e.invalidateSelectedCase(e.paramsToInvalidateSelectedCases())}))},initPositionsCombo:function(){var e=this;$.when(e.dataService.getUserPositions()).done((function(t){var i={combo:[],id:"positions"};i.combo.push({id:"",name:"........."}),$.each(t.positions,(function(e,t){i.combo.push({id:t.idPosition,name:t.displayName})})),e.renderPositionsCombo(i)})).fail((function(e){bizagi.log(e)}))},renderPositionsCombo:function(e){var t=this.getContent(),i=$.Deferred(),a=$("#userPositionInput",t);return a.empty(),a.uicombo({isEditable:!1,data:e,itemValue:function(e){return e.id},itemText:function(e){return e.name},onComplete:function(){i.resolve()},onChange:function(e){var i=e.ui.data("value");$("#userPositionInput",t).val(i)},initValue:e.combo[0]}),i},setupData:function(){this.setupInitialData(),this.setupDatePicker(),this.setupProcessTree(),this.setupCaseSecurity(),this.setupMainButtons(),this.initPositionsCombo()},setupInitialData:function(){var e,t=this,i=t.getContent();t.buttonBackAction="backToMainForm",t.selectedUserId="",t.selectedUserName="",t.selectedTasks="",t.selectedTasksToShow="",t.searchParams="",t.processTree="",t.processTreeDelete="",t.caseSecurity="",$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-subtitle")),$("#mainForm",i).remove(),$("#dinamicContent",i).remove(),$("#case-search-log-data-buttonset",i).remove(),e=$.tmpl(t.fieldsContentTmpl,{disableAbortCases:bizagi.override.disableAbortCases}),i.html(e),$("#cases-tabs",i).tabs({activate:function(e,a){"deleteCasesTab"===a.newTab[0].id?(t.isOut=!1,t.showLoading(),t.getProcessRunningInvalidateCases()&&($("#tree",i).hide(),$("#invalidateMessage",i).show())):(clearTimeout(t.timer),t.isOut=!0)}});var a=$("#cases-tabs-ul",i);$("#li-deleteCases",a).click((function(){$("#case-search-log-data-buttonset",i).hide()})),$("#li-case-search",a).click((function(){$("#case-search-log-data-buttonset",i).show()})),bizagiConfig.isProduction&&($("#deleteCases",i).remove(),$("#deleteCasesTab",i).remove())},setupDatePicker:function(){var e=this.getContent(),t=bizagi.localization.getResource("dateFormat").replaceAll("yyyy","yy").replaceAll("MM","mm");$(".biz-wp-form-datepicker",e).datepicker({controlType:"select",dateFormat:t})},setupProcessTree:function(){var e=this,t=e.getContent();bizagi.treeRoutSelected=[],$("#treeLinksId").remove();var i=$.extend({},e.params);i.svgIconsMode=!0,i.canvas=$("#processTree",t),e.processTree=new bizagi.workportal.widgets.processtree(e.workportalFacade,e.dataService,i),e.processTree.render().done((function(){var i=$.extend({},e.params);i.canvas=$("#processTreeDelete",t),i.svgIconsMode=!0,i.searchKeyResource="workportal-widget-admincasesearch-cancel-cases-for",i.newDesign=!0,e.processTreeDelete=new bizagi.workportal.widgets.processtree(e.workportalFacade,e.dataService,i),e.processTreeDelete.render()}))},setupCaseSecurity:function(){var e=this.getContent(),t=$.extend({},this.params);t.content=$("#caseSecurity",e),this.caseSecurity=new bizagi.workportal.widgets.admin.transfer.case.security.permissions(this.workportalFacade,this.dataService,t),this.caseSecurity.render()},setupUsersSearchForm:function(){var e=this,t=e.getContent(),i=$.Deferred();$("#biz-wp-users-table-form").html(""),e.usersTable=new bizagi.workportal.widgets.userstable(e.workportalFacade,e.dataService,$.extend(e.params,{canvas:$("#biz-wp-users-table-form",t),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admincasesearch-reassign")],parentDef:i})),e.usersTable.render(),$.when(i).done((function(t,i){e.assignEventReassignLinks(t,i)}))},_showResultAndSort:function(e,t,i){var a={order:i.order,orderType:i.orderType};this.showCasesSearchResultFrame(e,t,a)},findResults:function(e,t,i){var a=this;t.Page=i||1,$.when(a.dataService.getAdminCasesList(t)).done((function(i){if($(i.rows).each((function(e,t){t.isAdhocProcess||(t.isAdhocProcess=!1),t.isAdhocProcess&&a.adhocIds.push({caseId:t.idCase,processId:t.idAdhocProcess})})),$("#generalTitle").show(),$(".biz-wp-table").remove(),$(".case-search-action-wrapper").remove(),$("#biz-wp-table-summary-wrapper").remove(),a.totalRecords=i.records,a.totalPages=i.total,i.rows.length>0){a._showResultAndSort(e,i,t),a.setupActionsButton(e);var s,n=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,r=$("#biz-wp-table-pager-wrapper"),o={};o.pagination=a.totalPages>1,o.page=i.page,o.pages={};for(var l=1;l<=n;l++)o.pages[l]={pageNumber:l};s=$.tmpl(a.paginationTmpl,o).html(),r.append(s),$("ul").bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$("#biz-wp-table-pager-wrapper"),clickCallBack:function(i){a.findResults(e,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-authentication-log-none"),bizagi.localization.getResource("workportal-general-word-information"),"warning")})).fail((function(e){bizagi.log(e)}))},_forTemplateClassSortedBy:function(e,t){var i=this.Class.CLASSES,a=e.order==t,s=0===e.orderType?i.SORT_COL_ASC:i.SORT_COL_DES;return a?s:i.SORT_COL_NOT},showCasesSearchResultFrame:function(e,t,i){var a=!!bizagi.override.disableAbortCases,s=this.preprocessResultList(t.headers,t),n=$.tmpl(this.resultContentTmpl,{headers:t.headers,rows:s,groupByCaseNumber:bizagiConfig.groupByCaseNumber,securityGraphicQuery:bizagi.menuSecurity.GraphicQuery,resultList:t},{classSortedBy:this._forTemplateClassSortedBy.bind(this,i),getRadNumberColumnIndex:function(){for(var e=this.data,t=-1,i=0,a=e.headers.length;i<a;i++)"I_radNumber"==e.headers[i].fieldName&&(t=i);return t},showColumn:function(e){var t=this.getRadNumberColumnIndex();return this.data.groupByCaseNumber&&t==e?" hidden ":""},createGroupedHeader:function(e){var t=this.data.resultList,i=!1,a=this.getRadNumber(t.rows[e]);this.data.groupByCaseNumber&&(0==e?i=!0:a!=this.getRadNumber(t.rows[e-1])&&(i=!0));return i},getRadNumber:function(e){var t=this.getRadNumberColumnIndex();return t>=0?e.data[t]:""}}),r=$.tmpl(this.invalidateContentTmpl,{}),o=$.tmpl(this.reassignContentTmpl,{});$("#mainForm",e).hide(),$("#dinamicContent",e).html(n),a||$(".case-search-action-wrapper",e).append(r),$(".case-search-action-wrapper",e).append(o),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-table-title")),$("#btn-admin-case-search-clear",e).hide(),$("#btn-admin-case-search",e).hide(),$("#btn-admin-case-back",e).css("display","inline"),this.setupActivitiesLink(e),this.setupGraphicQueryEvent(e),this.selectedItemsPersistence(e);for(var l=0;l<t.rows.length;l++){var d=t.rows[l].idCase;$(".row-case-"+d).on("mouseover",(function(){$(".row-case-"+d).addClass("row-background")})),$(".row-case-"+d).on("mouseout",(function(){$(".row-case-"+d).removeClass("row-background")}))}},selectedItemsPersistence:function(e){var t="";$.each(this.selectedCaseAdmin,(function(i,a){t="input:checkbox[name=CaseAdmin][value="+a+"]",$(t,e).prop("checked",!0)})),$.each(this.selectedWorkItemAdmin,(function(i,a){t="input:checkbox[name=workItemAdmin][value='"+a+"']",$(t,e).prop("checked",!0)}))},preprocessResultList:function(e,t){for(var i=[],a=t.rows.length,s=0;s<a;s++)i.push(this.processResultItem(e,t.rows[s]));return i},processResultItem:function(e,t){var i,a,s,n,r=t.data,o=t.idCase,l=t.idWorkFlow,d=t.radNumber,c=t.idParentCase,p=t.isSubprocess,g=[],u=[],m=[],h=-1,b=0,w=!1;for(u.push({id:"checkCaseAdmin",value:o,radNumber:d,idParentCase:c,isSubProcess:p});h++<e.length-1;)switch(e[h].fieldName){case this.columnsID.caseNumber:u.push({id:"caseNumber",value:{idCase:o,caseNumber:r[b]}}),b++;break;case this.columnsID.process:u.push({id:"idWorkItem",value:r[b]}),b++;break;case this.columnsID.userName:case this.columnsID.userfullName:case this.columnsID.task:case this.columnsID.taskDueDate:if(void 0===i){for(var f=r.length;f-- >0;)if(Array.isArray(r[f])){i=r[f],w=!0;break}b++}else void 0!==i&&JSON.stringify(i)===JSON.stringify(r[b])&&b++;w?(s=i[0],this.columnsID.userName==e[h].fieldName?(u=u.concat(this.processTaskObjectUser(s)),-1==m.indexOf(this.columnsID.userName)&&m.push(this.columnsID.userName)):this.columnsID.userfullName==e[h].fieldName?(u=u.concat(this.processTaskObjectUserFullName(s)),-1==m.indexOf(this.columnsID.userfullName)&&m.push(this.columnsID.userfullName)):this.columnsID.task==e[h].fieldName?(u=u.concat(this.processTaskObject(s,o,t.radNumber)),-1==m.indexOf(this.columnsID.task)&&m.push(this.columnsID.task)):this.columnsID.taskDueDate==e[h].fieldName&&(u=u.concat(this.processTaskObjectDate(s)),-1==m.indexOf(this.columnsID.taskDueDate)&&m.push(this.columnsID.taskDueDate))):e[h].fieldName==this.columnsID.taskDueDate&&(u=u.concat({estimatedSolutionDate:r[h]}),-1==m.indexOf(this.columnsID.taskDueDate)&&m.push(this.columnsID.taskDueDate));break;case this.columnsID.processCreationDate:u.push({id:"processCreationDate",value:r[b]}),b++;break;case this.columnsID.processDueDate:u.push({id:"processDueDate",value:r[b]}),b++;break;default:var v=bizagi.util.formatValueByDataType(r[b],e[h].type);u.push({id:"customField",value:v}),b++}if(u.push({id:"viewProcess",value:{idCase:o,idworkflow:l}}),g.push({attr:"first_row",data:u}),(a=i?i.length:0)>1){n=m.length;for(var z=1;z<a;z++){var $=[];for(f=-1;f++<n-1;)m[f]==this.columnsID.task?$.push(this.processTaskObject(i[z],o,t.radNumber)):m[f]==this.columnsID.taskDueDate?$.push(this.processTaskObjectDate(i[z])):m[f]==this.columnsID.userName?$.push(this.processTaskObjectUser(i[z])):m[f]==this.columnsID.userfullName&&$.push(this.processTaskObjectUserFullName(i[z]));g.push({attr:"next_row",data:$})}}return{data:g,totalTask:a,idCase:o}},processTaskObject:function(e,t,i){var a={taskName:e.taskName,colorState:e.colorState,taskType:e.taskType,idCase:t,idWorkItem:e.idWorkItem,idTask:e.idTask,radNumber:i};return"Wait"===e.taskType&&(a.skip=!0),a},processTaskObjectDate:function(e){var t={};return e.estimatedSolutionDate?t.estimatedSolutionDate=e.estimatedSolutionDate:t.estimatedSolutionDate="","Wait"===e.taskType&&(t.skip=!0),t},processTaskObjectUser:function(e){var t={};return e.assignee?t.userName=e.assignee:t.userName="",t},processTaskObjectUserFullName:function(e){var t={};return e.assigneeFullName?t.userName=e.assigneeFullName:t.userName="",t},invalidateCases:function(e){var t=this,i="",a={cases:[]};if(t.selectedCaseAdmin.forEach((function(e){a.cases.push({idCase:e})})),0==a.cases.length)bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-empty-msg"),bizagi.localization.getResource("workportal-general-word-information"),"warning");else{i=bizagi.util.isEmpty("")?bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-confirm-msg"):bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-subprocess-confirm-msg")+"".substring(0,"".length-1);$.when(bizagi.showConfirmationBox(i,bizagi.localization.getResource("workportal-general-word-information"),"warning",null,{dialogClass:"widget-admincasesearch-invalidate-cases-confirm",width:400,minWidth:400})).done((function(){var i=$("#txtReason",e).val(),s={action:"abort",cases:JSON.stringify(a),reason:i};$.when(t.dataService.abortReassignItems(s)).done((function(i){t.showActionResultFrame(e,i.response,"invalidate")})).fail((function(e){bizagi.log(e)}))}))}},showReassignTasksFrame:function(e){var t={cases:[]},i=[];$.each(this.selectedWorkItemAdmin,(function(e,a){a=a.split("|"),t.cases.push({idCase:a[0],idWorkItem:a[1]}),i.push({taskItem:a[3]+": "+a[2],idWorkItem:a[1]})})),0==i.length?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admincasesearch-reassign-empty-msg"),bizagi.localization.getResource("workportal-general-word-information"),"warning"):(this.selectedTasks=t,this.selectedTasksToShow=i,this.showReassignForm(e,i))},showReassignForm:function(e,t){this.buttonBackAction="backToCases";var i=$.tmpl(this.reassignFormTmpl,{tasks:t});$("#dinamicContent",e).hide(),$("#dinamicContent2",e).html(i),$("#btn-admin-case-search-clear",e).hide(),$("#btn-admin-case-search",e).hide(),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-reassign-title")),this.setupUsersSearchForm()},reassignTasks:function(){var e=this,t=e.getContent(),i={action:"reassignItems",cases:JSON.stringify(e.selectedTasks),idNewUser:e.selectedUserId};$.when(e.dataService.abortReassignItems(i)).done((function(i){e.showActionResultFrame(t,i.response,"reassign")})).fail((function(e){bizagi.log(e)}))},showActionResultFrame:function(e,t,i){var a=t.length>1?"-several":"",s="",n="",r=[];if("invalidate"==(a=i+a))for(var o=0;o<t.length;o++)1==t[o].deleted?(s=t[o].idCase,s+=o+1<t.length?", ":"",r[0]=!0):(n=t[o].idCase,n+=o+1<t.length?", ":"",r[1]=!1);else if("invalidate-several"==a)for(o=0;o<t.length;o++)1==t[o].deleted?(s+=t[o].idCase,s+=o+1<t.length?", ":"",r[0]=!0):(n+=t[o].idCase,n+=o+1<t.length?", ":"",r[1]=!1);else if("reassign"==a)for(o=0;o<t.length;o++)1==t[o].reassigned?(s+=t[o].idCase,s+=o+1<t.length?", ":"",r[0]=!0):(n=t[o].idCase,n+=o+1<t.length?", ":"",r[1]=!1);else if("reassign-several"==a){s+="<br/><br/>",n+="<br/><br/>";for(o=0;o<t.length;o++)1==t[o].reassigned?(s+=t[o].idCase+"<br/>",r[0]=!0):(n+=t[o].idCase+"<br/>",r[1]=!1);s+="<br/>",n+="<br/>"}var l=$.tmpl(this.actionResultContentTmpl,{action:a,resultStatus:r,exceptionMessage:n.substring(n.indexOf("|")+1)});l=l[0].innerHTML.replace("{0}","<strong>"+s+"</strong>");var d=n.substring(0,-1===n.indexOf("|")?void 0:n.indexOf("|"));l=(l=(l=l.replace("{3}","<strong>"+d+"</strong>")).replace("{1}",this.selectedUserName)).replace("{1}",this.selectedUserName),"invalidate"==i&&$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-invalidate-result-title")),$("#mainForm",e).html(""),$("#dinamicContent",e).css("display","inline"),$("#dinamicContent",e).html(l),$("#dinamicContent2",e).remove(),$("#usersTable",e).remove(),$("#btn-admin-case-back",e).css("display","none"),$("#btn-admin-case-search-clear",e).css("display","none"),$("#btn-admin-case-search",e).css("display","none"),$("#btn-admin-case-finish",e).css("display","inline")},setupMainButtons:function(){var e=this,t=e.getContent(),i=$.tmpl(e.buttonContentTmpl,{});t.append(i);var a=$("#case-search-log-data-buttonset",t);$("#btn-admin-case-search-clear",a).click((function(){$(".biz-wp-input-text",t).val(""),$(".biz-wp-form-datepicker",t).val(""),$("#userPositionInput",t).val(""),$("#userPositionInput",t).find(".biz-wp-combo-input").val("........."),e.setupProcessTree()})),$("#btn-admin-case-search",a).click((function(){var i="",a="",s="",n="",r="",o=e.processTree.getTreeRouteSelected();o.length>0&&(2==o.length?(i=o[1],s=o[0],a=""):(i=o[o.length-1],a="",s=o[0]));var l=parseInt($("#resultsNumber").val());bizagi.util.isNumeric(l)?e.maxElemShow=l:e.maxElemShow=e.defaultMaxRows;var d=$("#sinceDate");d=(d=d.datepicker("getDate"))?bizagi.util.dateFormatter.formatInvariant(d,!1):"";var c=$("#toDate");c=(c=c.datepicker("getDate"))?bizagi.util.dateFormatter.formatInvariant(c,!1):"";var p={h_action:"getCases",I_ProcessState:"Running",h_idApp:"",I_Users:"ALL",eventAsTask:!0,orderType:1,order:"",orderField:"",group:bizagiConfig.groupByCaseNumber?"T_RADNUMBER":null,I_radNumber:$.trim($("#caseInput").val()),I_idWFClass:s,I_USERNAME:$("#userNameInput").val(),I_USERFULLNAME:$("#userFullNameInput").val(),I_USERPOSITION:$("#userPositionInput").val(),I_From__CreationDate:d||$("#sinceDate").val(),I_To__CreationDate:c||$("#toDate").val(),h_idWFClassAuth:"",I_idCategory:a,I_idApplication:i,PageSize:e.maxElemShow};""==p.I_From__CreationDate||bizagi.util.isDate(p.I_From__CreationDate)?""==p.I_To__CreationDate||bizagi.util.isDate(p.I_To__CreationDate)?0===p.PageSize?(n=bizagi.localization.getResource("render-date-minimum-validation"),r=bizagi.localization.getResource("workportal-widget-admincasesearch-number-results"),n=(n=n.replace("#label#",r)).replace("#minValue#","1"),bizagi.showMessageBox(n,bizagi.localization.getResource("workportal-general-word-information"),"warning")):(e.searchParams=p,e.selectedCaseAdmin=[],e.selectedWorkItemAdmin=[],e.findResults(t,p)):(n=bizagi.localization.getResource("workportal-general-invalid-date"),r=bizagi.localization.getResource("workportal-widget-admincasesearch-to-date"),n=n.replace("{0}",r),bizagi.showMessageBox(n,bizagi.localization.getResource("workportal-general-word-information"),"warning")):(n=bizagi.localization.getResource("workportal-general-invalid-date"),r=bizagi.localization.getResource("workportal-widget-admincasesearch-date-since"),n=n.replace("{0}",r),bizagi.showMessageBox(n,bizagi.localization.getResource("workportal-general-word-information"),"warning"))})),$("#btn-admin-case-back",a).click((function(){"backToMainForm"==e.buttonBackAction?e.backToMainForm():"backToCases"==e.buttonBackAction&&e.backToCases()})),$("#btn-admin-case-finish",a).click((function(){e.setupData()})),$("#resultsNumber",t).bind("keypress",(function(e){var t=e.charCode?e.charCode:e.keyCode;if(8!=t&&(t<48||t>57))return!1})),$("#btn-admin-cases-invalidate",t).click((function(){!1===$("#allAppsLinkSelected",t).data("allAppSelected")&&0===e.processTreeDelete.getTreeRouteSelected().length?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-processTree-no-selected-process"),bizagi.localization.getResource("workportal-general-word-information"),"warning"):e.showConfirmationMessage(),$(e.loader).remove()}))},getDateInvariantByControlIDSelector:function(e){var t="",i=$(e).datepicker("getDate");if(null!==i)try{t=bizagi.util.dateFormatter.formatInvariant(i,!1)}catch(i){t="",$(e).val("")}return t},backToCases:function(){var e=this.getContent();this.buttonBackAction="backToMainForm",$("#dinamicContent",e).show(),$("#dinamicContent2",e).html(""),$("#usersTable").remove(),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-table-title")),$("#btn-admin-case-search-clear",e).hide(),$("#btn-admin-case-search",e).hide()},backToMainForm:function(){var e=this.getContent();$("#mainForm",e).show(),$("#dinamicContent",e).html(""),$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admincasesearch-subtitle")),$("#btn-admin-case-search-clear",e).show(),$("#btn-admin-case-search",e).show(),$("#btn-admin-case-back",e).css("display","none")},assignEventReassignLinks:function(e,t){this.selectedUserId=e,this.selectedUserName=t,this.reassignTasks()},setupActionsButton:function(e){var t=this;$("input:checkbox[name=CaseAdmin]",e).click((function(){var e=$(this).val();$(this).is(":checked")?t.selectedCaseAdmin.push(e):t.selectedCaseAdmin.splice($.inArray(e,t.selectedCaseAdmin),1)})),$("input:checkbox[name=workItemAdmin]",e).click((function(){var e=$(this).val();$(this).is(":checked")?t.selectedWorkItemAdmin.push(e):t.selectedWorkItemAdmin.splice($.inArray(e,t.selectedWorkItemAdmin),1)})),$("#btn-admin-case-invalidate",e).click((function(){t.invalidateCases(e)})),$("#btn-admin-case-reassign",e).click((function(){t.showReassignTasksFrame(e)}))},setupActivitiesLink:function(e){var t=this;$(".activityClicked",e).click((function(){t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idCase"),idWorkItem:$(this)[0].getAttribute("data-idworkItem"),idTask:$(this)[0].getAttribute("data-idTask")}),t.publish("closeCurrentDialog"),bizagi.referrerParams.referrer=bizagi.util.defaultWidget()})),$(".caseClicked",e).click((function(){t.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:$(this)[0].getAttribute("data-idCase"),idWorkItem:"",idTask:""}),t.publish("closeCurrentDialog"),bizagi.referrerParams.referrer=bizagi.util.defaultWidget()})),$(".cases-column-header:not(.cases-column-no-sortable)",e).click((function(){var i=$(this)[0].getAttribute("data-columnorder"),a=$(this)[0].getAttribute("data-ordertype"),s=$(this)[0].getAttribute("data-columnOrderName");a="1"==a?0:1,t.searchParams.order=i,t.searchParams.orderType=a,t.searchParams.orderField=s,t.findResults(e,t.searchParams,t.searchParams.Page)}))},setupGraphicQueryEvent:function(e){var t=this;$(".biz-wp-diagram-view-icon",e).click((function(){for(var e=$(this).data("idcase"),i=$(this).data("idworkflow"),a=!1,s=null,n=0;n<t.adhocIds.length;n++)parseInt(e)==t.adhocIds[n].caseId&&(a=!0,s=t.adhocIds[n].processId);a?t.showGraphicQuery({idCase:e,idWorkflow:i,isAdhoc:a,idProcess:s}):t.showGraphicQuery({idCase:e,idWorkflow:i})}))},paramsToInvalidateSelectedCases:function(){var e=this.processTreeDelete.getTreeRouteSelected(),t="",i="";return e.length>0&&(2==e.length?(t=e[1],i=e[0]):(t=e[e.length-1],i=e[0])),{idProcess:i,idApplication:t}},invalidateSelectedCase:function(e){var t=this;$.when(t.dataService.postAdminInvalidateCase(e)).done((function(){t.last_showSuccessToastInvalidate=!0,t.getProcessRunningInvalidateCases()})).fail((function(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),bizagi.log(e)}))},getProcessRunningInvalidateCases:function(){var e=this;return e.resp=!1,$.when(e.dataService.getResponseProcessRunningInvalidateCases()).done((function(t){var i=e.getContent();if("InProgress"===t.status){var a=e;a.isOut?e.resp=!1:(e._showInvalidateMessage(i),e.timer=setTimeout((function(){a.getProcessRunningInvalidateCases()}),1e4))}else e._showForm(i),"Finished"===t.status?(e.resp=!1,e.last_showSuccessToastInvalidate&&e.showNotifier()):"Error"===t.status&&e.last_showSuccessToastInvalidate&&bizagi.showToastError(bizagiConfig.environment,t.result);e.isOut?$(e.loader).remove():(e.last_showSuccessToastInvalidate=!1,"InProgress"===t.status&&(e.last_showSuccessToastInvalidate=!0),e.endLoading())})).fail((function(t){var i=e.getContent();bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),e._showForm(i),e.resp=!1,e.endLoading(),bizagi.log(t)})),e.resp},_showForm:function(e){$("#btn-admin-cases-invalidate").fadeIn(10),$("#tree",e).fadeIn(10),$("#invalidateMessage",e).fadeOut(10)},_showInvalidateMessage:function(e){$("#btn-admin-cases-invalidate").fadeOut(10),$("#invalidateMessage",e).fadeIn(10),$("#tree",e).fadeOut(10)},showLoading:function(){var e=this.getContent();$("#deleteCasesWrapper",e).fadeOut(10),$("#case-search-log-data-buttonset",e).fadeOut(10),$("#deleteCases",e).append(this.loader)},endLoading:function(){var e=this.getContent();$("#deleteCasesWrapper",e).fadeIn(10),$("#case-search-log-data-buttonset",e).fadeIn(10),$(this.loader).remove()},dispose:function(){clearTimeout(this.timer)}}),bizagi.workportal.widgets.admin.async.activities.extend("bizagi.workportal.widgets.admin.async.activities",{ASYNC_CHECK_TIMER:3e3},{init:function(e,t,i){this.selectedTab=0,this._super(e,t,i),this.loadTemplates({async:bizagi.getTemplate("bizagi.workportal.desktop.widget.async"),"admin.async.activities":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities"),"admin.async.activities.tabs":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tabs"),"admin.async.activities.tab1":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tab1"),"admin.async.activities.tab2":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tab2"),"admin.async.activities.tab3":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tab3"),"admin.async.activities.tab4":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-tab4"),"admin.async.activities.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-log"),"admin.async.rpaactivities.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-rpa-activities-log"),"admin.async.activities.pagination":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-pagination"),"admin.async.activities.error.page":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-error-page"),"admin.async.activities.processing":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.async.activities").concat("#ui-bizagi-workportal-widget-admin-async-activities-processing"),useNewEngine:!1})},loadtemplates:function(){this.tabsTmpl=this.getTemplate("admin.async.activities.tabs"),this.tab1Tmpl=this.getTemplate("admin.async.activities.tab1"),this.tab2Tmpl=this.getTemplate("admin.async.activities.tab2"),this.tab3Tmpl=this.getTemplate("admin.async.activities.tab3"),this.tab4Tmpl=this.getTemplate("admin.async.activities.tab4"),this.logTmpl=this.getTemplate("admin.async.activities.log"),this.rpalogTmpl=this.getTemplate("admin.async.rpaactivities.log"),this.paginatorTmpl=this.getTemplate("admin.async.activities.pagination"),this.errorPage=this.getTemplate("admin.async.activities.error.page"),this.processingPage=this.getTemplate("admin.async.activities.processing")},postRender:function(){this.maxElemShow=10,this.maxPageToShow=5,this.setupData()},setupData:function(){this.setupInitialData(),this.setupTabs()},setupInitialData:function(){var e=this.getContent(),t=$(".async-act-main-content",e);$("#generalTitle",e).html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-subtitle")),t.html(""),$("#main-screen",e).show(),$("#dinamic-screen",e).html("");var i=$.tmpl(this.tabsTmpl,{});t.append(i),this.loadTabsContent()},loadTabsContent:function(){var e,t,i=this.getContent();e={action:"getActivities",page:1,pageSize:this.maxElemShow},t={action:"getActivitiesByTask",page:1,pageSize:this.maxElemShow},paramsTab3={page:1,pageSize:this.maxElemShow},paramsTab4={action:"getActivitiesByTask",page:1,pageSize:this.maxElemShow},0==this.selectedTab&&this.renderTab1Table(i,e),1==this.selectedTab&&this.renderTab2Table(i,t),2==this.selectedTab&&this.renderTab3Table(i,paramsTab3),3==this.selectedTab&&this.renderTab4Table(i,paramsTab4)},setupTabs:function(){var e=this,t=e.getContent();$("#async-tabs",t).tabs({activate:function(t,i){e.selectedTab=i.newTab.index(),e.loadTabsContent()},active:e.selectedTab||0})},renderTab1Table:function(e,t,i){var a=this,s=$("#main-screen",e);t.page=i||1,$("#async-loading-activities").show(),$.when(a.dataService.asyncActivitiesServices(t)).done((function(i){$("#async-loading-activities").hide(),$("#async-tabs-1").remove(),a.totalRecords=i.records,a.totalPages=i.total,a.asyncActRefresh();var n=$.tmpl(a.tab1Tmpl,{rows:i.rows,selectedTab:a.selectedTab});if($("#async-tabs",e).append(n),i.rows.length){bizagi.util.formatInvariantDate(n,a.getResource("dateFormat")+" "+a.getResource("timeFormat")),a.setupTab1ActivitiesLink(),a.setupActionsButton();var r,o=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,l=$("#async-table-pager-wrapper",n),d={};d.pagination=a.totalPages>1,d.page=i.page,d.pages={},d.additionalparameters=!0,d.totalPages=a.totalPages,d.totalRecords=a.totalRecords;for(var c=1;c<=o;c++)d.pages[c]={pageNumber:c};r=$.tmpl(a.paginatorTmpl,d).html(),l.append(r),$("ul").bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$(".pager-content",s),clickCallBack:function(i){a.renderTab1Table(e,t,i.page)}})}else $("#async-table-pager-wrapper",n).append(bizagi.localization.getResource("workportal-general-no-records-found")),$("#async-table-pager-wrapper",n).addClass("bz-empty-list")})).fail((function(e){bizagi.log(e)}))},renderTab2Table:function(e,t){var i=this;$("#async-loading-activities").show(),$.when(i.dataService.asyncActivitiesServices(t)).done((function(t){if($("#async-loading-activities").hide(),$("#async-tabs-2").remove(),t.rows.length){for(var a=[],s=t.rows,n=[],r=0,o=0;o<s.length;o++){var l=s[o].idWfClass,d=Number(s[o].count);if(n.indexOf(l)<0){n.push(l),a[r]={wfClsDisplayName:s[o].wfClsDisplayName,idWfClass:s[o].idWfClass,childs:[{idTask:s[o].idTask,tskDisplayName:s[o].tskDisplayName,count:s[o].count}]};for(var c=o+1;c<s.length;c++)l==s[c].idWfClass&&(d+=Number(s[c].count),a[r].childs.push({idTask:s[c].idTask,tskDisplayName:s[c].tskDisplayName,count:s[c].count}));a[r].count=d,r+=1}}var p=$.tmpl(i.tab2Tmpl,{rows:a,selectedTab:i.selectedTab});$("#async-tabs",e).append(p),i.setupTab2ActivitiesLink()}else{p=$.tmpl(i.tab2Tmpl,{rows:[],selectedTab:i.selectedTab});$("#async-tabs",e).append(p),$("#async-table-pager-wrapper",p).append(bizagi.localization.getResource("workportal-general-no-records-found")),$("#async-table-pager-wrapper",p).addClass("bz-empty-list")}})).fail((function(e){bizagi.log(e)}))},renderTab3Table:function(e,t,i){var a=this,s=$("#main-screen",e);t.page=i||1,$("#async-loading-activities").show(),$.when(a.dataService.getAsynchronousRpaJobs(t)).done((function(i){$("#async-loading-activities").hide(),$("#async-tabs-3").remove(),a.totalRecords=i.records,a.totalPages=i.total,a.asyncActRefresh();var n=$.tmpl(a.tab3Tmpl,{rows:i.rows,selectedTab:a.selectedTab});if($("#async-tabs",e).append(n),i.rows.length){bizagi.util.formatInvariantDate(n,a.getResource("dateFormat")+" "+a.getResource("timeFormat")),a.setupTab3ActivitiesLink(),a.setupTab3ActionsButton();var r,o=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,l=$("#async-table-pager-wrapper",n),d={};d.pagination=a.totalPages>1,d.page=i.page,d.pages={},d.additionalparameters=!0,d.totalPages=a.totalPages,d.totalRecords=a.totalRecords;for(var c=1;c<=o;c++)d.pages[c]={pageNumber:c};r=$.tmpl(a.paginatorTmpl,d).html(),l.append(r),$("ul").bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$(".pager-content",s),clickCallBack:function(i){a.renderTab3Table(e,t,i.page)}})}else $("#async-table-pager-wrapper",n).append(bizagi.localization.getResource("workportal-general-no-records-found")),$("#async-table-pager-wrapper",n).addClass("bz-empty-list")})).fail((function(e){bizagi.log(e)}))},renderTab4Table:function(e,t){var i=this;$("#async-loading-activities").show(),$.when(i.dataService.getAsynchronousRpaJobsByTask(t)).done((function(t){if($("#async-loading-activities").hide(),$("#async-tabs-4").remove(),t.rows.length){for(var a=[],s=t.rows,n=[],r=0,o=0;o<s.length;o++){var l=s[o].idWfClass,d=Number(s[o].count);if(n.indexOf(l)<0){n.push(l),a[r]={wfClsDisplayName:s[o].wfClsDisplayName,idWfClass:s[o].idWfClass,childs:[{idTask:s[o].idTask,tskDisplayName:s[o].tskDisplayName,count:s[o].count}]};for(var c=o+1;c<s.length;c++)l==s[c].idWfClass&&(d+=Number(s[c].count),a[r].childs.push({idTask:s[c].idTask,tskDisplayName:s[c].tskDisplayName,count:s[c].count}));a[r].count=d,r+=1}}var p=$.tmpl(i.tab4Tmpl,{rows:a,selectedTab:i.selectedTab});$("#async-tabs",e).append(p),i.setupTab4ActivitiesLink()}else{p=$.tmpl(i.tab4Tmpl,{rows:[],selectedTab:i.selectedTab});$("#async-tabs",e).append(p),$("#async-table-pager-wrapper",p).append(bizagi.localization.getResource("workportal-general-no-records-found")),$("#async-table-pager-wrapper",p).addClass("bz-empty-list")}})).fail((function(e){bizagi.log(e)}))},executeActivity:function(e){var t=this,i="";$.when(t.dataService.asyncActivitiesServices(e)).done((function(a){if(a.executed){var s=$.Deferred();$.when(t.checkAsycnExecutionState(1,e.idCase,e.idAsynchWorkitem,s)).done((function(){t.goToCase(e.idCase)})).fail((function(){i=bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-message"),t.showErrorMessage(i)}))}else i=bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-retry"),t.showErrorMessage(i)})).fail((function(e){bizagi.log(e)}))},retryRPAJob:function(e){var t=this,i=(t.getContent(),"");$("#async-loading-activities").show(),$.when(t.dataService.retryRPAJob(e)).done((function(a){$("#async-loading-activities").hide(),a.executed?t.goToCase(e.idCase):(i=a.message?a.message:bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-retry"),t.showErrorMessage(i))})).fail((function(e){$("#async-loading-activities").hide(),bizagi.log(e)}))},getRetryStatus:function(e,t,i){var a=this;return setTimeout((function(){$.when(a.dataService.getAsynchExecutionState({idCase:t,idAsynchWorkitem:idAsynchWorkitem})).done((function(e){"error"!=e.status&&i.resolve()})).fail((function(s){e<=3?(e+=1,a.getRetryStatus(e,t,idAsynchWorkitem,i)):i.reject()}))}),1e3),i.promise()},checkAsycnExecutionState:function(e,t,i,a){var s=this,n=s.getContent(),r=$("#main-screen",n),o=$("#dinamic-screen",n),l="";$("#ui-bizagi-wp-async-box",n);return $.when(s.dataService.getAsynchExecutionState({idCase:t,idAsynchWorkitem:i})).done((function(d){var c=s.getTemplate("async");"Error"==d.state&&void 0===d.errorMessage&&(d.errorMessage=bizagi.localization.getResource("render-async-error")),l=$.tmpl(c,d),r.hide(),o.html(""),o.append(l),$("#ui-bizagi-wp-async-box",n).css({top:0,left:0,"margin-top":0,"margin-left":0,"padding-top":0,"margin-right":0,width:"96%","max-height":"80",height:"80"}),s.setupErrorPageLink($("#link-go-to-inbox").find("a")),$("#link-back").css("display","inline"),s.setupBackToMainPage(),"Processing"==d.state?0==d.errorMessage.length&&setTimeout((function(){e+=1,s.checkAsycnExecutionState(e,t,i,a)}),s.Class.ASYNC_CHECK_TIMER):"Finished"==d.state&&a.resolve(s.content)})),a.promise()},showLog:function(e,t,i){var a=this,s=a.getContent();e.page=i||1,$.when(a.dataService.asyncActivitiesServices(e)).done((function(i){if(a.totalRecords=i.records,a.totalPages=i.total,i.response.length){var n=$.tmpl(a.logTmpl,{rows:i.response,data:t});bizagi.util.formatInvariantDate(n,a.getResource("dateFormat")+" "+a.getResource("timeFormat")),$("#dinamic-screen",s).html(""),$("#dinamic-screen",s).append(n),a.setupLogButtons();var r,o=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,l=$("#log-table-pager-wrapper"),d={};d.pagination=a.totalPages>1,d.page=i.page,d.pages={},d.additionalparameters=!0,d.totalPages=a.totalPages,d.totalRecords=a.totalRecords;for(var c=1;c<=o;c++)d.pages[c]={pageNumber:c};r=$.tmpl(a.paginatorTmpl,d).html(),l.append(r),$("ul",l).bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$(".pager-content",l),clickCallBack:function(i){a.showLog(e,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-general-no-records-found"),"Bizagi","warning").then((function(){$("#generalTitle",s).html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-subtitle")),$("#main-screen",s).show()}))})).fail((function(e){bizagi.log(e),$("#generalTitle",s).html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-subtitle")),$("#main-screen",s).show()}))},showLogRPA:function(e,t,i){var a=this,s=a.getContent();e.page=i||1,$.when(a.dataService.getRPAActivityLog(e)).done((function(i){if(a.totalRecords=i.records,a.totalPages=i.total,i.response.length){var n=$.tmpl(a.rpalogTmpl,{rows:i.response,data:t});bizagi.util.formatInvariantDate(n,a.getResource("dateFormat")+" "+a.getResource("timeFormat")),$("#dinamic-screen",s).html(""),$("#dinamic-screen",s).append(n),a.setupLogButtons();var r,o=a.maxPageToShow>a.totalPages?a.totalPages:a.maxPageToShow,l=$("#log-table-pager-wrapper"),d={};d.pagination=a.totalPages>1,d.page=i.page,d.pages={},d.additionalparameters=!0,d.totalPages=a.totalPages,d.totalRecords=a.totalRecords;for(var c=1;c<=o;c++)d.pages[c]={pageNumber:c};r=$.tmpl(a.paginatorTmpl,d).html(),l.append(r),$("ul",l).bizagiPagination({maxElemShow:a.maxElemShow,totalPages:a.totalPages,actualPage:i.page,listElement:$(".pager-content",l),clickCallBack:function(i){a.showLogRPA(e,t,i.page)}})}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-general-no-records-found"),"Bizagi","warning").then((function(){$("#generalTitle",s).html(bizagi.localization.getResource("workportal-widget-admin-rpaactivities-subtitle")),$("#main-screen",s).show()}))})).fail((function(e){bizagi.log(e),$("#generalTitle",s).html(bizagi.localization.getResource("workportal-widget-admin-rpaactivities-subtitle")),$("#main-screen",s).show()}))},enableActivities:function(e,t){var i=this,a={action:"enableExecution",idTask:t,idWfClass:e};$.when(i.dataService.asyncActivitiesServices(a)).done((function(e){i.setupData()})).fail((function(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")}))},enableMultipleActivities:function(e){var t=this,i={action:"enableMultiple",cases:JSON.stringify(e)};$.when(t.dataService.asyncActivitiesServices(i)).done((function(e){e.executed?t.setupData():bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")})).fail((function(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")}))},enableRPAActivities:function(e,t){var i=this,a={idTask:t,idWfClass:e};$.when(i.dataService.enableRPAJobsByTaskAndProcess(a)).done((function(){i.setupData()})).fail((function(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")}))},enableMultipleRPAActivities:function(e){var t=this,i={jobs:JSON.stringify(e)};$.when(t.dataService.enableMultipleRPAJobs(i)).done((function(e){e.executed?t.setupData():bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")})).fail((function(e){bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-error-enable"),"Bizagi","warning")}))},goToCase:function(e){this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e,idWorkItem:"",idTask:""}),this.publish("closeCurrentDialog")},asyncActRefresh:function(){var e=this,t=e.getContent();$("#async-act-refresh-link",t).unbind(),$("#async-act-refresh-link",t).click((function(t){e.setupData(),e.selectedTab&&$("#async-tabs li:eq("+e.selectedTab+") a").click()}))},setupActionsButton:function(){var e=this,t=e.getContent(),i=$.tmpl(e.buttonContentTmpl,{});t.append(i),e.asyncActRefresh(t),$(".async-act-log-link",t).click((function(i){var a={action:"asyncExecutionLog",idCase:this.getAttribute("data-idCase"),idWorkItem:this.getAttribute("data-idWorkItem"),pageSize:e.maxElemShow,idAsynchWorkitem:this.getAttribute("data-idAsynchWorkitem")},s={idCase:this.getAttribute("data-idCase"),radNumber:this.getAttribute("data-radNumber"),taskName:this.getAttribute("data-taskName"),processName:this.getAttribute("data-processName")};$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-activitieslog")),$("#main-screen",t).hide(),e.showLog(a,s)})),$(".async-act-retry-link",t).click((function(t){var i={action:"retryNow",idCase:this.getAttribute("data-idCase"),idWorkitem:this.getAttribute("data-idWorkItem"),processName:this.getAttribute("data-processName"),idAsynchWorkitem:this.getAttribute("data-idAsynchWorkitem"),taskName:this.getAttribute("data-taskName")};e.executeActivity(i)})),$("#async-act-enable-checks",t).click((function(){for(var t=document.getElementsByName("enableChecks"),i={cases:[]},a=0,s=t.length;a<s;a++)if(t[a].checked){var n=t[a].value,r=t[a].getAttribute("data-idWorkItem"),o=t[a].getAttribute("data-idAsynchWorkitem");o=t[a].getAttribute("data-idAsynchWorkitem");i.cases.push({idCase:n,idWorkItem:r,idAsynchWorkitem:o})}e.enableMultipleActivities(i)}))},setupTab3ActionsButton:function(){var e=this,t=e.getContent(),i=$.tmpl(e.buttonContentTmpl,{});t.append(i),e.asyncActRefresh(t),$(".async-rpa-log-link",t).click((function(i){var a={action:"asyncExecutionLog",idCase:this.getAttribute("data-idCase"),idWorkItem:this.getAttribute("data-idWorkItem"),pageSize:e.maxElemShow,idJob:this.getAttribute("data-idJob")},s={idCase:this.getAttribute("data-idCase"),radNumber:this.getAttribute("data-radNumber"),taskName:this.getAttribute("data-taskName"),processName:this.getAttribute("data-processName")};$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admin-rpaactivities-activitieslog")),$("#main-screen",t).hide(),e.showLogRPA(a,s)})),$(".async-rpa-retry-link",t).click((function(t){var i={idJob:this.getAttribute("data-idJob"),idCase:this.getAttribute("data-idCase")};e.retryRPAJob(i)})),$("#rpaactivity-enable-checks",t).click((function(){for(var t=document.getElementsByName("enableChecks"),i=[],a=0,s=t.length;a<s;a++)if(t[a].checked){var n=t[a].getAttribute("data-idJob");i.push(Number(n))}e.enableMultipleRPAActivities(i)}))},setupLogButtons:function(){var e=this.getContent();$("#async-act-button-back",e).click((function(t){$("#generalTitle").html(bizagi.localization.getResource("workportal-widget-admin-asyncactivities-subtitle")),$("#main-screen",e).show(),$("#dinamic-screen",e).html("")}))},setupTab1ActivitiesLink:function(e){var t=this;$(".async-activity-click",e).click((function(){t.goToCase($(this)[0].getAttribute("data-idCase"))}))},setupTab2ActivitiesLink:function(e){var t=this;$(".async-act-process-tree-link",e).click((function(){$("div",this).hasClass("biz-wp-tree-expand-icon")?($("div",this).removeClass("biz-wp-tree-expand-icon"),$("div",this).addClass("biz-wp-tree-collapse-icon"),$(this).closest("tr").find(".async-act-childs").css("display","block"),$(this).closest("tr").find(".async-act-childs").addClass("clearfix")):($("div",this).removeClass("biz-wp-tree-collapse-icon"),$("div",this).addClass("biz-wp-tree-expand-icon"),$(this).closest("tr").find(".async-act-childs").css("display","none"),$(this).closest("tr").find(".async-act-childs").removeClass("clearfix"))})),$(".async-act-enable-link").click((function(){var e=this.getAttribute("data-idWfClass"),i=this.getAttribute("data-idTask")?this.getAttribute("data-idTask"):0;t.enableActivities(e,i)}))},setupTab3ActivitiesLink:function(e){var t=this;$(".async-rpaactivity-click",e).click((function(){t.goToCase($(this)[0].getAttribute("data-idCase"))}))},setupTab4ActivitiesLink:function(e){var t=this;$(".async-rpa-process-tree-link",e).click((function(){$("div",this).hasClass("biz-wp-tree-expand-icon")?($("div",this).removeClass("biz-wp-tree-expand-icon"),$("div",this).addClass("biz-wp-tree-collapse-icon"),$(this).closest("tr").find(".async-rpa-childs").css("display","block"),$(this).closest("tr").find(".async-rpa-childs").addClass("clearfix")):($("div",this).removeClass("biz-wp-tree-collapse-icon"),$("div",this).addClass("biz-wp-tree-expand-icon"),$(this).closest("tr").find(".async-rpa-childs").css("display","none"),$(this).closest("tr").find(".async-rpa-childs").removeClass("clearfix"))})),$(".async-rpa-enable-link").click((function(){var e=this.getAttribute("data-idWfClass"),i=this.getAttribute("data-idTask")?this.getAttribute("data-idTask"):0;t.enableRPAActivities(e,i)}))},setupErrorPageLink:function(e){var t=this;$(e).click((function(){t.closeErrorMessage();var e,i=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX,a=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID;switch($.isFunction(bizagi.cookie)?bizagi.util.defaultWidget():a){case i:e=i;break;case a:default:e=a}t.publish("changeWidget",{widgetName:e}),t.publish("closeCurrentDialog")}))},setupBackToMainPage:function(){var e=this,t=e.getContent(),i=$("#ui-bizagi-wp-async-box",t);$("#link-back",i).click((function(){e.setupData()}))},showErrorMessage:function(e){var t=this;content=t.getContent(),dinamicScreen=$("#dinamic-screen",content),dinamiccontent=$.tmpl(t.errorPage,{errorMessage:e}),dinamicScreen.html(""),dinamicScreen.append(dinamiccontent),t.setupErrorPageLink("#go-to-pending"),dinamicScreen.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:t.getResource("confirmation-box-title"),maximize:!1,close:function(){t.closeErrorMessage()},buttons:[{text:t.getResource("workportal-general-button-label-ok"),click:function(){t.closeErrorMessage()}}]}),t.errorDialog=dinamicScreen},closeErrorMessage:function(){var e=this.getContent();$("#dinamic-screen",e);this.errorDialog&&(this.errorDialog.dialog("destroy"),$("#dinamic-screen",e).html(""),this.errorDialog=null)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.usersAdministration",{},{init:function(e,t,i){this.maxRows=18,this.maxPages=10,this.currentPage=1,this.orderType="ASC",this.orderField="",this.totalPages=0,this.userData={},this.allowCreation=!0,this.userLinks=[{name:"downloadReport",label:bizagi.localization.getResource("workportal-gdpr-download-report"),icon:"icon-download-report-user",typeSVG:!0},{name:"anonymize",label:bizagi.localization.getResource("workportal-gdpr-anonymize"),icon:"icon-anonymize",typeSVG:!0},{name:"edition",label:bizagi.localization.getResource("bz-rp-components-dimension-edit"),icon:"bz-icon-pencil-outline",typeSVG:!1},{name:"log",label:bizagi.localization.getResource("render-actions-log"),icon:"bz-icon-log-outline",typeSVG:!1}],this._super(e,t,i),this.loadTemplates({"admin.users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users"),"admin.users.formbuttons":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-formbuttons"),"admin.users.log":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-log"),"admin.users.licenses":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-licenses"),"admin.users.email":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-email"),"admin.users.anonymize":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersAdministration").concat("#ui-bizagi-workportal-widget-admin-users-anonymize"),"admin.search.cases":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-search-cases"),"admin.search.users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-search-users"),"admin.table.users":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.cases").concat("#ui-bizagi-workportal-widget-admin-table-users"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USERS_ADMINISTRATION},renderContent:function(){var e=this.getTemplate("admin.users");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.desktop.widgets.admin.userPermissionReport",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"user-permission-report":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.userPermissionReport").concat("#user-permission-report")})},renderContent:function(){var e=this.getTemplate("user-permission-report");return this.content=e.render({}),this.content},postRender:function(){var e=this;$("#downloadButtonActive",e.getContent()).click((function(){e.dataService.getUserPermissionsExcel(!0)})),$("#downloadButtonInactive",e.getContent()).click((function(){e.dataService.getUserPermissionsExcel(!1)}))}}),bizagi.injector.register("bizagi.workportal.desktop.widgets.admin.userPermissionReport",["workportalFacade","dataService",bizagi.workportal.desktop.widgets.admin.userPermissionReport]),bizagi.workportal.widgets.admin.usersAdministration.extend("bizagi.workportal.widgets.admin.usersAdministration",{},{postRender:function(){var e=this;e.dateFormat=e.getResource("dateFormat")+" "+e.getResource("timeFormat"),e.$userTable=$("#bz-wp-widget-adminuser-usertable",e.content),e.$renderForm=$("#bz-wp-widget-adminuser-renderform",e.content),e.$buttonsContainer=$("#bz-wp-widget-adminuser-buttonset",e.content),e.$usersLicenses=$("#bz-wp-widget-adminuser-licenses",e.content),$.when(e.queryUserPermissions()).done((function(){e.renderUsersTable()})),e.addEventsHandler(),e.notifier=bizagi.injector.get("notifier")},renderUsersTable:function(){this.usersTable=new bizagi.workportal.widgets.userstable(this.workportalFacade,this.dataService,$.extend(this.params,{canvas:this.$userTable,userLinkLabel:this.userLinks})),this.usersTable.render()},queryUserPermissions:function(){var e=this,t=$.Deferred();return $.when(e.queryLicenses(),e.dataService.createUserAdministrationForm()).done((function(i,a){e.allowCreation=!(!i||!a[0].createUser||"Ldap"===bizagiConfig.authenticationType&&bizagiConfig.isLdapSyncEnabled),t.resolve()})),t.promise()},queryLicenses:function(){var e=this,t=$.Deferred();return $.when(e.dataService.queryUsersLicenses()).done((function(i){e.showLicensesMessage(i),t.resolve(i.canAddNewUser)})),t.promise()},showLicensesMessage:function(e){if(!e.canAddNewUser||e.areLicensedUsersLimitNear){var t=this.getTemplate("admin.users.licenses");this.$usersLicenses.html($.tmpl(t,{users:e.activeUsers,licenses:e.licensedUsersAccount}))}},addEventsHandler:function(){var e=this;e.$userTable.on("clickUserLink",(function(t,i){switch(e.userData=i,i.type){case"log":e.resetLogValues(),e.getUsersLogData();break;case"edition":e.renderForm();break;case"downloadReport":e.downloadReport();break;case"anonymize":e.anonymize()}})),e.$userTable.on("completeUserForm",(function(){e.renderFormButtons("query")})),e.$userTable.on("click","#bz-wp-widget-adminuser-createbutton-wrapper",(function(){e.userData={},e.renderForm()})),$("#bz-wp-widget-adminuser-buttonset",e.content).on("click","button",(function(){e.returnToUserTable()})),e.$renderForm.on("click","table .sortColumnsData",(function(){var t=$(this).data("orderfield"),i=$(this).data("ordertype");e.getUsersLogData({orderType:i,orderField:t})})),e.$renderForm.on("click","#js-btn-anonymize",(function(){bizagi.showErrorAlertDialog=!1,$.when(e.dataService.anonymizeUser(e.userData.id)).done((function(t){$.when(e.queryUserPermissions()).done((function(){e.showHideNewUser(e.allowCreation),e.notifier.showSucessMessage(printf(bizagi.localization.getResource("workportal-general-word-action-successfully"),"")),e.returnToUserTable(),e.usersTable.getUsersTableData()}))})).fail((function(t,i,a){e.notifier.showErrorMessage(printf(bizagi.util.processFailMessage(t.responseText),""))}))})),e.$renderForm.on("click","#js-btn-anonymize-cancel",(function(){e.returnToUserTable()})),e.$usersLicenses.on("click","button",(function(t){switch($(this).data("type")){case"buy":e.buyLicense();break;case"licenses":e.renderLicensesWidgets()}t.stopPropagation()}))},showHideNewUser:function(e){var t=$("#bz-wp-widget-adminuser-createbutton-wrapper",self.content);e?t.show():t.hide()},resetLogValues:function(){this.currentPage=1,this.orderType="ASC",this.orderField=""},renderLicensesWidgets:function(){this.publish("showDialogWidget",{widgetName:"userlicenses",data:{idCase:"Licenses"},modalParameters:{title:this.getResource("workportal-menu-submenu-Licenses"),width:"907px",showCloseButton:!0,id:"Licenses"}})},buyLicense:function(){window.open("http://www.bizagi.com","_black")},returnToUserTable:function(){this.toggleForm(!0),this.removeButtons(),this.$renderForm.empty()},getUsersLogData:function(e){var t=this;e=e||{};t.orderType=e.orderType||t.orderType,t.orderField=e.orderField||t.orderField,$.when(t.dataService.getUsersAdministrationLog({idUser:t.userData.id,Pag:t.currentPage,pagSize:t.maxRows,orderField:t.orderField,orderType:t.orderType})).done((function(e){t.totalPages=e.total,t.renderUserLogTable(e)}))},removeButtons:function(){this.$buttonsContainer.empty()},renderUserLogTable:function(e){var t=this.getTemplate("admin.users.log"),i=(this.$renderForm,this.totalPages>1),a=this.getPagesArray();this.toggleForm(!1);var s=$.tmpl(t,e,{userName:this.userData.name,page:this.currentPage,pagination:i,pagesArray:a,orderType:this.orderType,orderField:this.orderField});bizagi.util.formatInvariantDate(s,this.dateFormat),this.$renderForm.html(s),this.setUpPagination(),this.renderFormButtons("back")},setUpPagination:function(){var e=this,t=$("#biz-wp-usersadministration-pager ul",e.content);t.bizagiPagination({maxElemShow:e.maxRows,totalPages:e.totalPages,actualPage:e.currentPage,listElement:t,clickCallBack:function(t){e.currentPage=parseInt(t.page),e.getUsersLogData()}})},getPagesArray:function(){for(var e=this.maxPages>this.totalPages?this.totalPages:this.maxPages,t=[],i=0;i<e;i++)t.push(i+1);return t},renderFormButtons:function(e){var t=this.getTemplate("admin.users.formbuttons"),i=$.tmpl(t,{type:e,allowCreation:this.allowCreation});"query"===e?$("#bz-wp-widget-adminuser-usertable #users-table-buttonset",this.content).append(i):this.$buttonsContainer.html(i)},toggleForm:function(e){switch(e){case!0:this.$userTable.show(),this.$renderForm.hide();break;case!1:this.$userTable.hide(),this.$renderForm.show()}},getPages:function(){for(var e=this.maxPages>this.totalPages?this.totalPages:this.maxPages,t=[],i=0;i<e;i++)t.push(i+1);return t},renderForm:function(){var e=this;bizagi.loader.start("rendering").then((function(){var t=e.$renderForm,i=new bizagi.rendering.facade,a=e.userData.id||0,s=e.userData.id?"edit":"add",n=e.getLoadFormParams(a);e.toggleForm(!1),e.removeButtons(),e.dataService.getUsersForm(n).done((function(n){var r={canvas:t,data:n,type:"usersForm",userId:a,action:s};i.execute(r).done((function(){e.userForm=i.form,e.userForm.bind("endUsersForm",(function(t,i){e.performActionsAfterSave(i)}))}))}))}))},getLoadFormParams:function(e){var t={h_action:"LOADUSERADMINFORM",h_contexttype:"entity"};return e?$.extend(t,{h_xpathContext:"@Context.Users[id == "+e+"]",h_optionform:"edit"}):$.extend(t,{h_optionform:"add"}),t},performActionsAfterSave:function(e){var t=this,i=e.userId||t.userData.id;e.sendMail&&void 0!==i&&t.sendMail(i,e.password),"save"===e.formAction||"cancel"===e.formAction?(void 0!==t.usersTable&&(t.usersTable.afterSave=!0),$.when(t.queryUserPermissions()).done((function(){t.usersTable.excecuteQuery(),t.showHideNewUser(t.allowCreation),e.error||(t.userForm.endLoading(),t.returnToUserTable())}))):t.returnToUserTable()},sendMail:function(e,t){var i=this;i.dataService.generateDataToSendByEmail({idUser:e}).done((function(e){i.showEmailPopup(e,t)}))},showEmailPopup:function(e,t){var i,a=this,s=window.document,n=a.getTemplate("admin.users.email"),r=a.dialogBoxEmail=$("<div class= admin-users-email/>");r.empty(),r.appendTo("body",s);var o={};o[a.getResource("workportal-widget-admin-users-button-label-send")]=function(){if(""!==$("#txtTextTo",r).val()){var e={eMailTo:$("#txtTextTo",r).val(),subject:$("#txtSubject",r).val(),body:$("#txtBody",r).val(),userSecret:t};$.when(a.dataService.sendUserEmail(e)).done((function(e){a.closeUploadDialogEmail();var t=bizagi.localization.getResource("workportal-widget-admin-users-Send-message");e.logOff&&"false"==e.logOff&&(t=bizagi.localization.getResource("workportal-widget-admin-users-Not-Send-message")),bizagi.showMessageBox(t,"Bizagi","warning")}))}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-empty-email-to"),"Bizagi","warning")},o[a.getResource("workportal-widget-admin-users-button-label-notSend")]=function(){a.closeUploadDialogEmail()},e.body=e.body.replace(/\\n/g,"\n").replace(/\\/g,""),$.tmpl(n,{messageResponse:e}).appendTo(r),$(".ui-bizagi-loading-message").remove(),r.dialog((i={width:500,title:a.getResource("workportal-widget-admin-users-subtitle-email"),modal:!0,maximize:!1,resizable:!1,draggable:!1,buttons:o,close:function(){a.closeUploadDialogEmail()},resizeStop:function(e,t){a.form&&a.form.resize(t.size)}},_defineProperty(i,"maximize",(function(e){a.userForm&&a.userForm.triggerHandler("maximazedForm")})),_defineProperty(i,"unmaximize",(function(e){a.userForm&&a.userForm.triggerHandler("unmaximazedForm")})),i))},closeUploadDialogEmail:function(){this.dialogBoxEmail.dialog("destroy"),this.dialogBoxEmail.remove()},downloadReport:function(){this.dataService.downloadReportUser(this.userData.id)},anonymize:function(){var e=this.getTemplate("admin.users.anonymize");this.$renderForm;this.toggleForm(!1);var t=bizagi.localization.getResource("workportal-gdpr-anonymize-description-sure").replaceAll("%s",this.userData.fullName),i=$.tmpl(e,{descriptionTranslated:t});this.$renderForm.html(i),this.renderFormButtons("back")}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.usersDelegation",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.userdelegation":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation").concat("#ui-bizagi-workportal-widget-admin-userdelegation"),"admin.userdelegationListTmpl":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation").concat("#bz-wp-widget-userdelegation-configurations-tmpl"),"admin.userdelegationDeleteConfirmationTmpl":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation").concat("#bz-wp-widget-userdelegation-delete-confirmation-tmpl"),"admin.userdelegationFormTmpl":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation").concat("#bz-wp-widget-userdelegation-form-tmpl"),"admin.userdelegationEmptyMessageTmpl":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation").concat("#bz-wp-widget-userdelegation-configurations-message-tmpl"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USERS_DELEGATION},renderContent:function(){var e=this.getTemplate("admin.userdelegation");return this.content=$.tmpl(e)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.usersDelegation.searchUser",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_USERS_DELEGATION_SEARCH_USER},renderContent:function(){},loadtemplates:function(){}}),bizagi.workportal.widgets.admin.usersDelegation.extend("bizagi.workportal.widgets.admin.usersDelegation",{},{postRender:function(){this.maxPages=10,this.maxRows=10,this.currentPage=1,this.showTable=!0,this.orderType="ASC",this.orderField="",this.dateFormat=this.getResource("dateFormat")+" "+this.getResource("timeFormat"),this.$delegationFormWrapper=$("#widget-userdelegation__form-wrapper",this.content),this.$DelegationListWrapper=$("#widget-userdelegation__configurations-wrapper",this.content),this.tableHeaders=[{displayName:this.getResource("workportal-widget-userdelegation-process"),fieldValue:"processName"},{displayName:this.getResource("workportal-widget-userdelegation-username"),fieldValue:"userName"},{displayName:this.getResource("workportal-widget-userdelegation-delegatedname"),fieldValue:"delegatedName"},{displayName:this.getResource("workportal-widget-userdelegation-init-date"),fieldValue:"startDate"},{displayName:this.getResource("workportal-widget-userdelegation-end-date"),fieldValue:"endDate"}],this.renderDelegationForm(),this.initDelegationTable(),this.addEventsHandler()},renderDelegationForm:function(){var e=this.getTemplate("admin.userdelegationFormTmpl");$.tmpl(e,{currentUser:"TestUser"}).appendTo(this.$delegationFormWrapper);var t=$("#widget-userdelegation__start-date",this.content),i=$("#widget-userdelegation__end-date",this.content),a=new Date;t.datepicker({minDate:a}),i.datepicker({minDate:a}),this.configureProcessCombo(),$("#widget-userdelegation__start-date-btn",this.content).click((function(){t.datepicker("show")})),$("#widget-userdelegation__end-date-btn",this.content).click((function(){i.datepicker("show")}))},configureProcessCombo:function(){var e=this,t={idUser:bizagi.currentUser.idUser};$.when(e.dataService.getProcessToDelegate(t)).done((function(t){var i=$(".widget-userdelegation__delegated-process-combo-wrapper",e.content),a={combo:[],id:"widget-userdelegation__process-to-delegate-combo"};a.combo=a.combo.concat(t.process),i.empty(),e.processComponent=e.setupMultiselector(i,t.process)}))},setupMultiselector:function(e,t){var i=this,a={options:t,element:e,values:[]};return e.uicombo({data:{combo:t},isEditable:!0,isSearchable:!0,initValue:"tetetet",itemValue:function(e){return e.id},itemText:function(e){return e.displayName},onComplete:function(){var t=bizagi.localization.getResource("workportal-widget-userdelegation-please-select-your-process");$(".biz-wp-combo-input",e).addClass("widget-user-delegation__multiselector-input"),$(".biz-wp-combo-input").attr("placeholder",t),e.prepend('<div class="widget-user-delegation__multiselector"></div>')},onComboDropDown:function(){i.markChoicesMultiselector(a)},onChange:function(e){var t=e.ui.val()||"",s=e.ui.data("value");i.filterOptionsMultiselector(a,t),i.addChoiceMultiselector(a,s,!0)}}),a},markChoicesMultiselector:function(e){$("li",e.element).removeClass("widget-user-delegation__multiselector__option--selected"),$("li",e.element).prepend('<i class="widget-user-delegation__multiselector__option__icon"></i>'),$.each(e.values,(function(t,i){$('li[data-value="'+i+'"]',e.element).addClass("widget-user-delegation__multiselector__option--selected")}))},filterOptionsMultiselector:function(e,t){var i=e.options.filter((function(e){return 0==e.displayName.toLowerCase().indexOf(t.toLowerCase())}));$("li",e.element).hide(),$.each(i,(function(t,i){$('li[data-value="'+i.id+'"]',e.element).show()}))},addChoiceMultiselector:function(e,t,i){if(t){var a=e.options.find((function(e){return e.id==t})).displayName;if(-1===e.values.indexOf(t+"")){var s='<div class="widget-user-delegation__multiselector__item" data-value ='+t+">"+a+' | <i class="widget-user-delegation__multiselector__item-clear-btn bz-icon bz-icon-close"></i></div>';$(".widget-user-delegation__multiselector",e.element).append(s),$(".biz-wp-combo-input",e.element).css({"box-shadow":"none"}),$(".widget-user-delegation__multiselector-input",e.element).val(""),e.values.push(t+""),i&&$(".widget-user-delegation__multiselector__item-clear-btn",e.element).click((function(){var t=$(this).parent(),i=e.values.indexOf(t.data().value+"");i>=0&&(e.values.splice(i,1),t.remove(),e.values.length&&e.values.length<1&&$(".biz-wp-combo",e.element).show())}))}}},initDelegationTable:function(e){var t=this,i=e||{pag:1,pagSize:t.maxRows};i.idUser=bizagi.currentUser.idUser;var a=t.getTemplate("admin.userdelegationListTmpl");t.$DelegationListWrapper.html(""),$.when(t.dataService.queryDelegations(i)).done((function(e){if(e.delegations.length>0){var i=e.records>1,s=Math.ceil(e.records/t.maxRows),n=t.getPagesArray(s);$.tmpl(a,{headers:t.tableHeaders,orderField:t.orderField,orderType:t.orderType,delegationList:e.delegations,page:e.page,pagination:i,pagesArray:n}).appendTo(t.$DelegationListWrapper),t.setUpPagination(s),t.setUpSortColumnLinks(),$(".widget-userdelegation__separator__btn-icon",t.content).addClass("widget-userdelegation__separator__btn-icon--opened")}else{var r=t.getTemplate("admin.userdelegationEmptyMessageTmpl"),o=bizagi.localization.getResource("workportal-widget-userdelegation-empty-list-message");t.$DelegationListWrapper.html($.tmpl(r,{message:o}))}t.addTableEventsHandler(),t.delegatedAssignment={element:$("#widget-userdelegation__delegated-assignment-user",t.content),value:""}}))},getPagesArray:function(e){for(var t=this.maxPages>e?e:this.maxPages,i=[],a=0;a<t;a++)i.push(a+1);return i},setUpPagination:function(e){var t=this,i=$("#widget-userdelegation__delegation-list__table-pager ul",t.content);i.bizagiPagination({maxElemShow:t.maxRows,totalPages:e,actualPage:t.currentPage,listElement:i,clickCallBack:function(e){var i={pag:t.currentPage=parseInt(e.page),pagSize:t.maxRows,orderField:t.orderField,orderType:t.orderType};t.initDelegationTable(i)}})},setUpSortColumnLinks:function(){var e=this;$(".biz-wp-table-head th",e.content).click((function(){e.orderField=$(this).data("orderfield"),e.orderType=$(this).data("ordertype")||e.orderType;var t={orderType:e.orderType,orderField:e.orderField,pagSize:e.maxRows,pag:e.currentPage};e.initDelegationTable(t)}))},addTableEventsHandler:function(){var e=this,t=e.getContent();$(".widget-userdelegation__delegation-list__edit-btn",e.content).click((function(){e.selectedDelegation=$(this).parent().data(),e.delegatedAssignment.element.val(e.selectedDelegation.delegatedName),e.delegatedAssignment.value=e.selectedDelegation.idDelegate,$(".biz-wp-combo",e.processComponent.element).hide(),e.clearMultiselector(e.processComponent),e.addChoiceMultiselector(e.processComponent,e.selectedDelegation.idProcess,!1),$(".widget-userdelegation__delegated-assignment--edition",e.content).show(),$(".widget-userdelegation__delegated-assignment",e.content).hide(),$(".widget-userdelegation__delegated-assignment--edition__value",e.content).text(e.selectedDelegation.delegatedName),$("#widget-userdelegation__start-date",e.content).datepicker("setDate",new Date(Date.parse(e.selectedDelegation.startDate,"MM/DD/YYYY"))),$("#widget-userdelegation__end-date",e.content).datepicker("setDate",new Date(Date.parse(e.selectedDelegation.endDate,"MM/DD/YYYY"))),$(".widget-user-delegation__multiselector__item-clear-btn",e.content).hide(),$("#widget-userdelegation__delegated-startdate--edition",e.content).show(),$(".widget-userdelegation__delegated-startdate--edition__value",e.content).text(e.selectedDelegation.startDate),$("#widget-userdelegation__form-input_date_startdate",e.content).hide()})),$(".widget-userdelegation__delegation-list__delete-btn",e.content).click((function(){var t=$(this).parent().data();e.openDeleteConfirmation(t)})),$(".widget-userdelegation__separator__btn",t).click((function(){var i=$(".widget-userdelegation__delegation-list",t);e.showTable=!e.showTable,e.showTable?($(".widget-userdelegation__separator__btn-icon",t).addClass("widget-userdelegation__separator__btn-icon--opened"),i.show()):($(".widget-userdelegation__separator__btn-icon",t).removeClass("widget-userdelegation__separator__btn-icon--opened"),i.hide())}))},openDeleteConfirmation:function(e){var t=this,i=$.tmpl(t.getTemplate("admin.userdelegationDeleteConfirmationTmpl"),{delegation:e});i.dialog({resizable:!1,draggable:!1,height:"auto",width:"600px",modal:!0,title:e.processName,maximize:!1,close:function(){i.dialog("destroy"),i.detach()},buttons:[{text:t.getResource("workportal-general-button-label-ok"),click:function(){$(this).dialog("destroy"),t.deleteDelegation(e)}},{text:t.getResource("workportal-widget-queries-confirm-cancel"),click:function(){$(this).dialog("destroy")}}]})},deleteDelegation:function(e){var t=this;$.when(t.dataService.deleteDelegation(e)).done((function(e){t.initDelegationTable()}))},addEventsHandler:function(){var e=this,t=e.getContent();$(".widget-userdelegation__bread-crumbs__link-1",e.content).click((function(){var e=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-1");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(e),$(".widget-userdelegation__wrapper",t).show(),$(".widget-userdelegation__bread-crumbs",t).hide(),$("#widget-userdelegation__getuser-wrapper",t).html(""),$("#widget-userdelegation__getuser-wrapper",t).hide()})),$(".widget-userdelegation__bread-crumbs__link-2",e.content).click((function(){var i=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-2");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(i),$(".widget-userdelegation__wrapper",t).hide(),$(".widget-userdelegation__bread-crumbs",t).show(),$(".widget-userdelegation__bread-crumbs__link-3",e.content).hide(),$("#widget-userdelegation__getuser-wrapper",t).html(""),e.setupUsersSearchForm(e.delegatedAssignment)})),$("#widget-userdelegation__delegated-assignment-user",t).focus((function(){e.setupUsersSearchForm(e.delegatedAssignment)})),$("#widget-userdelegation__delegated-assignment-search-btn",t).click((function(){var t=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-2");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(t),e.setupUsersSearchForm(e.delegatedAssignment)})),$("#widget-userdelegation__delegated-assignment-clear-btn",t).click((function(){$("#widget-userdelegation__delegated-assignment-user",t).val(""),e.delegatedAssignment.value=""})),$("#widget-userdelegation__new-assignment-save-btn",t).click((function(){e.selectedDelegation?e.updateDelegation():e.saveDelegation()})),$("#widget-userdelegation__new-assignment-clear-btn",t).click((function(){e.clearForm()}))},setupUsersSearchForm:function(e){var t=this.getContent(),i=$.Deferred();$(".widget-userdelegation__bread-crumbs",t).show(),$(".widget-userdelegation__wrapper",t).hide(),$("#widget-userdelegation__getuser-wrapper",t).show(),this.usersTable=new bizagi.workportal.widgets.admin.usersDelegation.searchUser(this.workportalFacade,this.dataService,$.extend(this.params,{canvas:$("#widget-userdelegation__getuser-wrapper",t),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-select-link")],parentDef:i})),this.usersTable.render(),$.when(i).done((function(i,a){$("#widget-userdelegation__getuser-wrapper",t).html(""),$("#widget-userdelegation__getuser-wrapper",t).hide(),e.element.val(a),e.value=i,$(".widget-userdelegation__wrapper",t).show(),$(".widget-userdelegation__bread-crumbs",t).hide(),$(".widget-userdelegation__bread-crumbs li:last-child",t).hide()}))},updateDelegation:function(){var e=this,t=$("#widget-userdelegation__start-date",e.content).datepicker("getDate"),i=$("#widget-userdelegation__end-date",e.content).datepicker("getDate"),a={idDelegation:e.selectedDelegation.idDelegation,idUser:bizagi.currentUser.idUser,idDelegate:e.delegatedAssignment.value,idsProcess:JSON.stringify(e.processComponent.values),startDate:bizagi.util.dateFormatter.formatDate(t,"yyyy-MM-dd"),endDate:bizagi.util.dateFormatter.formatDate(i,"yyyy-MM-dd"),enableSub:1};e.validateSaveUpdateParams(a)&&$.when(e.dataService.updateDelegation(a)).done((function(){e.clearForm(),e.initDelegationTable(),e.selectedDelegation=null})).fail((function(t){for(var i=t.responseJSON.messages,a=[],s=0;s<i.length;s++){var n=i[s][s].error,r=i[s][s].message;a.push(bizagi.localization.getResource(n)+" <br /> <b>"+r+"</b> <br /> ")}$("#widget-userdelegation__assignation--error",e.content).show(),$("#widget-userdelegation__assignation--error_value",e.content).html(a.toString())}))},saveDelegation:function(){var e=this,t=$("#widget-userdelegation__start-date",e.content).datepicker("getDate"),i=$("#widget-userdelegation__end-date",e.content).datepicker("getDate"),a={idUser:bizagi.currentUser.idUser,idDelegate:e.delegatedAssignment.value,idsProcess:JSON.stringify(e.processComponent.values),startDate:bizagi.util.dateFormatter.formatDate(t,"yyyy-MM-dd"),endDate:bizagi.util.dateFormatter.formatDate(i,"yyyy-MM-dd"),enableSub:1};e.validateSaveUpdateParams(a)&&$.when(e.dataService.saveDelegation(a)).done((function(){e.clearForm(),e.initDelegationTable(),e.selectedDelegation=null})).fail((function(t){for(var i=t.responseJSON.messages,a=[],s=0;s<i.length;s++){var n=i[s][s].error,r=i[s][s].message;a.push(bizagi.localization.getResource(n)+" <br /> <b>"+r+"</b> <br /> ")}$("#widget-userdelegation__assignation--error",e.content).show(),$("#widget-userdelegation__assignation--error_value",e.content).html(a.toString())}))},validateSaveUpdateParams:function(e){var t=this.getContent(),i=new Date(Date.parse(e.startDate,"MM/DD/YYYY HH:mm:ss")),a=new Date(Date.parse(e.endDate,"MM/DD/YYYY HH:mm:ss"));return $("#widget-userdelegation__delegated-process-combo-alert",t).hide(),$("#widget-userdelegation__delegated-assignment-user-alert",t).hide(),$("#widget-userdelegation__start-date-alert",t).hide(),$("#widget-userdelegation__end-date-alert",t).hide(),$("#widget-userdelegation__delegation-period-alert",t).hide(),"[]"==e.idsProcess&&$("#widget-userdelegation__delegated-process-combo-alert",t).show(),bizagi.util.isEmpty(e.idDelegate)&&$("#widget-userdelegation__delegated-assignment-user-alert",t).show(),e.startDate||$("#widget-userdelegation__start-date-alert",t).show(),e.endDate||$("#widget-userdelegation__end-date-alert",t).show(),a<i&&$("#widget-userdelegation__delegation-period-alert",t).show(),e.idUser&&e.idsProcess&&!bizagi.util.isEmpty(e.idDelegate)&&e.startDate&&e.endDate&&a>=i},clearForm:function(){this.clearMultiselector(this.processComponent),this.delegatedAssignment.element.val(""),$(".biz-wp-combo",this.processComponent.element).show(),$(".workportal-widget-userdelegation__sub-delegation__checkbox").prop("checked",!1),$("#widget-userdelegation__process-to-delegate-combo",this.content).val(""),$("#widget-userdelegation__start-date",this.content).val(""),$("#widget-userdelegation__end-date",this.content).val(""),$("#widget-userdelegation__getuser-wrapper",this.content).html(""),$(".widget-userdelegation__delegated-assignment--edition",this.content).hide(),$(".widget-userdelegation__delegated-assignment",this.content).show(),$("#widget-userdelegation__delegated-startdate--edition",this.content).hide(),$(".widget-user-delegation__multiselector__item-clear-btn",this.content).show(),$("#widget-userdelegation__form-input_date_startdate",this.content).show(),$("#widget-userdelegation__assignation--error",this.content).hide()},clearMultiselector:function(e){e.element.val(""),$(".widget-user-delegation__multiselector",e.element).html(""),e.values=[]}}),bizagi.workportal.widgets.admin.usersDelegation.searchUser.extend("bizagi.workportal.widgets.admin.usersDelegation.searchUser",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.filterData={},a.maxRows=8,a.maxPages=10,a.$canvas=i.canvas,a.users=[],a.totalPages=0,a.currentPage=1,a.orderType="ASC",a.orderField="",a.tableHeaders=[{displayName:a.getResource("workportal-widget-usertable-id"),fieldValue:"idUser"},{displayName:a.getResource("workportal-widget-usertable-user"),fieldValue:"fullName"},{displayName:a.getResource("workportal-widget-usertable-name"),fieldValue:"userName"},{displayName:a.getResource("workportal-widget-usertable-domain"),fieldValue:"domain"},{displayName:a.getResource("workportal-widget-usertable-email"),fieldValue:"contactEmail"},{displayName:a.getResource("workportal-widget-usertable-active-assign"),fieldValue:"enabledForAssignation"},{displayName:a.getResource("workportal-widget-usertable-active"),fieldValue:"enabled"}],a.loadTemplates({searchUser:bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation.searchUser").concat("#ui-bizagi-workportal-widget-search-user-tmpl"),"searchUser.form":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation.searchUser").concat("#ui-bizagi-workportal-widget-search-user-form-tmpl"),"searchUser.message":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation.searchUser").concat("#ui-bizagi-workportal-widget-search-user-message-tmpl"),"searchUser.table.wrapper.final":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation.searchUser").concat("#ui-bizagi-workportal-widget-search-user-table-wrapper-final-tmpl"),useNewEngine:!1}),bizagi.templateService.getTemplateWidget(bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.usersDelegation.searchUser").concat("#ui-bizagi-workportal-widget-search-user-table-final-tmpl")).done((function(e){a.tmpl["searchUser.table.final"]=e.markup}))},renderContent:function(){var e,t=this.getTemplate("searchUser");return e=this.content=$.tmpl(t,{}),this.params.canvas&&(e=$(this.params.canvas).append(e)),e},postRender:function(){this.loadtemplates(),this.setupData()},loadtemplates:function(){this.usersTableFormTmpl=this.getTemplate("searchUser.form"),this.usersTableMessage=this.getTemplate("searchUser.message"),this.usersTableTmpl=this.getTemplate("searchUser.table.wrapper.final"),this.usersTableTmplFinal=this.getTemplate("searchUser.table.final")},setupData:function(){var e=this,t=$.tmpl(e.usersTableFormTmpl,{}),i=[],a=[],s=[],n=[];$.when(e.dataService.getPreferencesCurrentUser()).done((function(e){i=e.sRoles||[],a=e.sSkills||[],s=e.sPositions||[],n=e.sOrganizations||[]})).fail((function(e){bizagi.log(e)}));var r=[$.when(e.getValuesMultiple("LOCATION")),$.when(e.getValuesMultiple("ROLE")),$.when(e.getValuesMultiple("SKILL")),$.when(e.getValuesMultiple("ORGPOSITION")),$.when(e.getValuesMultiple("ORG"))];$.when.apply($,r).then((function(r,o,l,d,c){$("#ui-bizagi-workportal-widget-search-user__form-wrapper",e.content).html(""),$("#ui-bizagi-workportal-widget-search-user__form-wrapper",e.content).html(t),e.locationsComponent=e.configureProcessCombo(r);var p=$("#widget-search-user__roles");e.rolesComponent=e.setupMultiselector(p,o,i);var g=$("#widget-search-user__skills");e.skillsComponent=e.setupMultiselector(g,l,a);var u=$("#widget-search-user__positions");e.positionsComponent=e.setupMultiselector(u,d,s);var m=$("#widget-search-user__organizations");e.organizationsComponent=e.setupMultiselector(m,c,n),e.setupEventsHandler(),e.$canvas.trigger("completeUserForm"),$("#ui-bizagi-workportal-widget-search-user__backfilters-btn",e.content).click((function(){$(".widget-userdelegation__bread-crumbs__link-1").click()}))}))},getValuesMultiple:function(e){var t=this,i=$.Deferred(),a='{"select":[{"type":"Entity","children": [{"type":"EntityValue","data":"*"}],"data":"*","where":{"name":"'+e+'"}}]}';return $.when(t.dataService.getValuesFromCQL(a)).done((function(e){var a=[];if(e&&e[0]){var s=JSON.parse(e[0].content).displayAttribute.baref.ref;$.each(e[0].children,(function(){var e=JSON.parse(this.content).idEntityValue,i=t.allKeysToUpperCase(JSON.parse(this.content).fields)[s.toUpperCase()];a.push({id:e,displayName:i})})),a.sort((function(e,t){return e.displayName>t.displayName?1:t.displayName>e.displayName?-1:0}))}i.resolve(a)})).fail((function(e){bizagi.log(e)})),i.promise()},allKeysToUpperCase:function(e){var t={};for(var i in e)"[object Object]"===Object.prototype.toString.apply(e[i])?t[i.toUpperCase()]=this.allKeysToUpperCase(e[i]):t[i.toUpperCase()]=e[i];return t},configureProcessCombo:function(e){var t=this,i=$("#widget-search-user__locations",t.content),a={combo:[],id:"widget-search-user__locations-to-delegate-combo"};return a.combo=a.combo.concat(e),i.empty(),i.uicombo({isEditable:!1,data:a,itemValue:function(e){return e.id},itemText:function(e){return e.displayName},onComplete:function(){},onChange:function(e){var a=e.ui.data("value");t.idProcess=a,$(".biz-wp-combo-input",i).css({"box-shadow":"none"})}}),i},setupMultiselector:function(e,t,i){var a=this,s={element:e,options:t,values:[]};return e.uicombo({data:{combo:t},itemValue:function(e){return e.id},itemText:function(e){return e.displayName},onComplete:function(){},onChange:function(e){var t=e.ui.data("value");s=a.addChoiceMultiselector(s,t)},onComboDropDown:function(){a.markChoicesMultiselector(s)}}),$(".biz-wp-combo-input",e).addClass("widget-search-user__multiselector-input"),$(e).prepend('<div class="widget-search-user__multiselector"></div>'),$.each(i,(function(){s=a.addChoiceMultiselector(s,this.id)})),s},addChoiceMultiselector:function(e,t){var i=e.options.filter((function(e){return e.id==t}))[0];if(-1===e.values.indexOf(t+"")&&null!=i){var a=i.displayName;$(".widget-search-user__multiselector",e.element).append('<div class="widget-search-user__multiselector__item" data-value ='+t+">"+a+' | <i class="widget-search-user__multiselector__item-clear-btn bz-icon bz-icon-close"></i></div>'),$(".biz-wp-combo-input",e.element).css({"box-shadow":"none",color:"white"}),e.values.push(t+""),$(".widget-search-user__multiselector__item-clear-btn",e.element).click((function(){var t=$(this).parent(),i=e.values.indexOf(t.data().value+"");i>=0&&(e.values.splice(i,1),t.remove(),e.values.length<=0&&$(".biz-wp-combo",e.element).show())}))}return e},markChoicesMultiselector:function(e){$("li",e.element).removeClass("widget-search-user__multiselector__option--selected"),$("li",e.element).prepend('<i class="widget-search-user__multiselector__option__icon"></i>'),$.each(e.values,(function(t,i){$('li[data-value="'+i+'"]',e.element).addClass("widget-search-user__multiselector__option--selected")}))},setupEventsHandler:function(){var e=this,t=e.getContent(),i=$("#ui-bizagi-workportal-widget-search-user__form-wrapper form",t);i.on("submit",(function(t){t.preventDefault(),e.currentPage=1,e.orderType="ASC",e.orderField="";var i=[],a=$(this.elements["widget-search-user__locations-to-delegate-combo"]).data("value");null!=a&&""!=a&&i.push(a),e.filterData={domain:this.elements.domainInput.value,userName:this.elements.userFullName.value,fullName:this.elements.userNameReassignInput.value,locations:JSON.stringify(i),pag:e.currentPage,pagSize:e.maxRows,orderField:e.orderField,orderType:e.orderType},e.getUsersTableData({idUser:bizagi.currentUser.idUser,organization:JSON.stringify(e.organizationsComponent.values),roles:JSON.stringify(e.rolesComponent.values),skills:JSON.stringify(e.skillsComponent.values),locations:JSON.stringify(i),positions:JSON.stringify(e.positionsComponent.values)})})),i.on("keyup keypress",(function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),i.submit(),!1})),i.on("reset",(function(i){i.preventDefault(),$(this.elements["widget-search-user__locations-to-delegate-combo"]).data("value","").val(""),this.elements.domainInput.value="",this.elements.userFullName.value="",this.elements.userNameReassignInput.value="",e.cleanForm(),$("#ui-bizagi-workportal-widget-search-user__list-wrapper",t).empty()}))},cleanForm:function(){$("#widget-search-user__locations",this.content).val(""),this.clearMultiselector(this.organizationsComponent),this.clearMultiselector(this.rolesComponent),this.clearMultiselector(this.skillsComponent),this.clearMultiselector(this.positionsComponent)},clearMultiselector:function(e){e.element.val(""),$(".widget-search-user__multiselector",e.element).html(""),e.values=[]},getUsersTableData:function(e){var t=this;e=e||{},t.orderType=e.orderType||t.orderType,t.orderField=e.orderField||t.orderField,$.when(t.dataService.getUsersForDelegation($.extend(t.filterData,e))).done((function(e){t.showUsersTable(e)})).fail((function(e){bizagi.log(e)}))},showUsersTable:function(e){var t=this;t.users=e.users;var i=$("#ui-bizagi-workportal-widget-search-user__list-wrapper",t.content),a=$("#ui-bizagi-workportal-widget-search-user__form-wrapper",t.content),s=$(".widget-userdelegation__bread-crumbs li:last-child");if(t.users.length>0){var n=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-3");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(n),i.empty(),i.show();var r=$.tmpl(t.usersTableTmpl,{});i.html(r),t.tableFinal=new Vue({el:$("#table",i)[0],template:t.usersTableTmplFinal,data:{users:t.users,headers:t.tableHeaders,orderField:t.orderField,orderType:t.orderType,renderBooleanYes:t.getResource("render-boolean-yes"),renderBooleanNo:t.getResource("render-boolean-no"),selectedUser:""},methods:{selectUser:function(e){this.selectedUser=e}}}),a.hide(),s.show(),$("#ui-bizagi-workportal-widget-search-user__selected-btn",t.content).click((function(){if(""!==t.tableFinal.selectedUser){var e=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-1");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(e),t.params.parentDef.resolve(t.tableFinal.selectedUser.idUser,t.tableFinal.selectedUser.userName),"usersDelegation"==t.params.widgetName&&bizagi.workportal.desktop.dialogStack.length>0&&bizagi.workportal.desktop.dialogStack[bizagi.workportal.desktop.dialogStack.length-1].dialogBox.on("dialogbeforeclose",(function(){!0===t.resultStatus&&t.publish("changeWidget",{widgetName:bizagi.workportal.currentInboxView})})),t.tableFinal.$destroy(),$(this).unbind("click"),$("#ui-bizagi-workportal-widget-search-user__back-btn",t.content).unbind("click")}else t.$canvas.trigger("clickUserLink",{id:this.id,name:this.name,type:$(this).data("linkname")})})),$("#ui-bizagi-workportal-widget-search-user__back-btn",t.content).click((function(){var e=$("#ui-bizagi-workportal-widget-search-user__list-wrapper",t.content),i=$("#ui-bizagi-workportal-widget-search-user__form-wrapper",t.content),a=$(".widget-userdelegation__bread-crumbs li:last-child"),s=bizagi.localization.getResource("workportal-widget-userdelegation-bread-crumb-2");$(".ui-widget-header.ui-corner-all > span.ui-dialog-title").html(s),e.empty(),i.show(),e.hide(),a.hide(),t.tableFinal.$destroy(),$(this).unbind("click"),$("#ui-bizagi-workportal-widget-search-user__selected-btn",t.content).unbind("click")}))}else{n=bizagi.localization.getResource("workportal-widget-usertable-empty");$(".bz-wp-table-centermessage",t.content).find("h3").text(n),setTimeout((function(){$(".bz-wp-table-centermessage",t.content).find("h3").text("")}),3e3)}}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.holidays",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_HOLIDAYS},init:function(e,t,i){this.holidaysObj={calendarSelector:null,activeCalendar:"",schemas:[],schema:{},holidays:{},holidaysInServer:{}},this._super(e,t,i),this.loadTemplates({"admin.holidays":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.holidays").concat("#ui-bizagi-workportal-widget-admin-holidays"),"admin.holidays.calendar.schema":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.holidays").concat("#ui-bizagi-workportal-widget-admin-holidays-calendar-schema"),useNewEngine:!1})},renderContent:function(){var e=this.getTemplate("admin.holidays");return this.content=$.tmpl(e)},postRender:function(){var e=this;$.when(e.dataService.getHolidaysSchemas()).done((function(t){e.holidaysObj.schemas=t,$.each(t,(function(t,i){e.holidaysObj.schema[i.id]={}})),e.renderHolidaysSchema(t)})).fail((function(e){console.log("ERROR",e)}))},_getSchemas:function(e){e=e||[];var t={};return $.each(e,(function(e,i){t[i.id]=i})),t},_getDaysBySchema:function(e,t){return(t=t||{})[e=e||""]||[]},_calendarHasChanges:function(){var e=!1;return""!=this.holidaysObj.activeCalendar&&this.holidaysObj.schema[this.holidaysObj.activeCalendar].modified&&(e=!0),e},_getChanges:function(e){var t=this,i=[],a=[],s=[];if(e){var n=function(e,t){var i=-1;return e=e||new Date,$.each(t,(function(t,a){new Date(a.date).getTime()==e.getTime()&&(i=t)})),i},r=function(e,r,o){var l="add"==o?a:i,d="add"==o?i:a;$.each(e,(function(e,i){var a=n(new Date(i.date),r);a>=0?(-1==n(new Date(i.date),s)&&s.push(i),r[a].description!=i.description&&-1==n(new Date(r[a].date),d)&&(r[a].date=t.formatDateStringToISO8601(r[a].date),i.date=t.formatDateStringToISO8601(i.date),d.push(r[a]),l.push(i))):(i.date=t.formatDateStringToISO8601(i.date),l.push(i),s.push(i))}))};return r(t.holidaysObj.holidays[e],t.holidaysObj.holidaysInServer[e],"add"),r(t.holidaysObj.holidaysInServer[e],t.holidaysObj.holidays[e],"delete"),{delete:i,add:a,actually:s}}},formatDateStringToISO8601:function(e){return bizagi.util.dateFormatter.isFormatISO8601(e)||(e=this._formatDateFromInvariantToISO8601(e)),e},saveSchema:function(e,t){var i=this,a=i.getContent(),s=$(".bz-ui-save-status",a);$.when(i._saveSchema(e,t)).done((function(){i.showSuccess(bizagi.localization.getResource("workportal-general-success"),s)})).fail((function(e){i.showError(bizagi.localization.getResource("workportal-general-error")+" : "+e.toString(),s)}))},_saveSchema:function(e,t){var i=this,a=i._getChanges(e),s=new $.Deferred,n={add:a.add,delete:a.delete};return i.holidaysObj.calendarSelector.startLoading({overlay:!0}),$.when(i.dataService.saveHolidaysBySchema({schema:e,data:JSON.encode(n)})).done((function(a){i._resetSchemaChanges(e),setTimeout((function(){t||i._changeSchema(e),i.holidaysObj.calendarSelector.endLoading(),s.resolve()}),1e3)})).fail((function(e){i.holidaysObj.calendarSelector.endLoading(),s.reject(e.toString())})),s.promise()},showError:function(e,t){var i='<i class="bz-icon bz-icon-error"></i>&nbsp; Error:'+e;t.empty(),t.show(),t.removeClass("status-success"),t.addClass("status-error"),t.html(i)},showSuccess:function(e,t){var i='<i class="bz-icon bz-icon-test"></i>&nbsp;'+e;t.empty(),t.show(),t.removeClass("status-error"),t.addClass("status-success"),t.html(i),window.setTimeout((function(){t.fadeOut(600)}),5e3)},_resetSchemaChanges:function(e){if(e){this.holidaysObj.schema[e].modified=!1,this.holidaysObj.holidays[e]={}}},renderHolidaysSchema:function(e){e=e||[];var t=this,i=t.getTemplate("admin.holidays.calendar.schema"),a=(t.getContent(),t._getSchemas(e)),s=$.tmpl(i,{schemas:a});t.holidaysObj.calendarSelector=$("#biz-wp-admin-holidays-calendar",s),$("#biz-wp-admin-holidays-schemas").append(s),t.holidaysSchemaHandlers(),t.renderHolidaysCalendar(),$("[name='save']",s).on("click",(function(){t._calendarHasChanges()?t.saveSchema(t.holidaysObj.activeCalendar,!1):t.holidaysObj.activeCalendar?(toastr.remove(),bizagi.injector.get("notifier").showWarningMessage(bizagi.localization.getResource("workportal-admin-holidays-no-changes"))):console.log("There is no selected calendar")})),$("[name='cancel']",s).on("click",(function(){t.params.dialogBox.dialog("close")})),$("button",s).button()},_changeSchema:function(e){var t=this;t.holidaysObj.activeCalendar=e,""==e?t.renderHolidaysCalendar():(t.holidaysObj.calendarSelector.startLoading(),$.when(t.dataService.getHolidaysBySchema({schema:e})).done((function(i){t.holidaysObj.holidaysInServer[e]=JSON.parse(JSON.encode(i)),t.holidaysObj.holidays[e]=i,t.renderHolidaysCalendar({dates:t.holidaysObj.holidays[e]||[]})})).always((function(){t.holidaysObj.calendarSelector.endLoading()})))},holidaysSchemaHandlers:function(){var e=this;$("#biz-wp-admin-holidays-schemas select").change((function(t){e.holidays=[];var i=t.currentTarget.value;e._calendarHasChanges()?$.when(bizagi.showSaveBox(e.getResource("confirmation-savebox-message1"),e.getResource("confirmation-box-title"),"warning")).done((function(){$.when(e.saveSchema(e.holidaysObj.activeCalendar,!0)).done((function(t){e._changeSchema(i)}))})).fail((function(t){e._resetSchemaChanges(e.holidaysObj.activeCalendar),e._changeSchema(i)})):e._changeSchema(i)}))},renderHolidaysCalendar:function(e){e=e||{};var t=this,i=t.getContent(),a=e.dates||[],s=($("#biz-wp-admin-holidays-calendar",i),(new Date).getFullYear()),n=e.datePickerOptions||{},r=$.extend({yearRange:"-5:+10",stepMonths:12,numberOfMonths:[3,4],defaultDate:"1/1/"+s,dateFormat:"mm/dd/yy",onSelect:function(e,t){l(e)},beforeShowDay:function(e){if(t.holidaysObj&&""==t.holidaysObj.activeCalendar)return[!1,"ui-datepicker-notselected"];var i=new Date,a=o(e),s=!(i.getTime()>new Date(e).getTime());return a.position>-1?[s,"ui-datepicker-selected",a.description]:[s,"ui-datepicker-notselected",bizagi.localization.getResource("workportal-general-no-selected")]}},n),o=function(e){for(var t=0,i=a.length;t<i;t++){var s=a[t].date.split("T")[0].replace(/-/g,"/");if($.datepicker.formatDate("yy/mm/dd",new Date(e))==$.datepicker.formatDate("yy/mm/dd",new Date(s)))return{position:t,description:a[t].description}}return{position:-1,description:""}},l=function(e){var i,s,n=o(e);n.position>-1?(s=n.position,a.splice(s,1)):((i={date:e,description:""}).date=new Date(i.date),i.date.setHours(0),i.date.setMinutes(0),i.date.setSeconds(0),i.date=bizagi.util.dateFormatter.formatISO8601(i.date,!0),a.push(i)),t.holidaysObj.schema[t.holidaysObj.activeCalendar].modified=!0};t.holidaysObj.calendarSelector.data("datepicker")&&t.holidaysObj.calendarSelector.datepicker("destroy"),t.holidaysObj.calendarSelector.datepicker(r)},_showNotification:function(e,t,i){var a=new NotificationMessage(e,{body:t,iconType:_NOTIFICATION_ICON_TYPE.CSS});a.onClick=function(e){return e.preventDefault(),this.close(),!1},this.publish("notification",{notification:a,type:i})},_formatDateFromInvariantToISO8601:function(e){var t=bizagi.util.dateFormatter.getDateFromInvariant(e,!1);return bizagi.util.dateFormatter.formatISO8601(t,!0)}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.projectName",{},{getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_PROJECTNAME},init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"admin.projectname":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.projectname").concat("#ui-bizagi-workportal-widget-admin-projectname"),useNewEngine:!1})},renderContent:function(){var e=this.getTemplate("admin.projectname"),t=this.content=$.tmpl(e);return $("button",t).button(),t},showError:function(e,t){var i='<i class="bz-icon bz-icon-error"></i>&nbsp; Error:'+e;t.empty(),t.show(),t.removeClass("status-success"),t.addClass("status-error"),t.html(i)},showSuccess:function(e,t){var i='<i class="bz-icon bz-icon-test"></i>&nbsp;'+e;t.empty(),t.show(),t.removeClass("status-error"),t.addClass("status-success"),t.html(i)},postRender:function(){var e=this,t=e.getContent(),i=$(".projectname-message-status",t);$("input",t).on("keyup",(function(){i.empty(),$(this).val().length>=0&&$("input",t).removeClass("status-error")})),$.when(e.dataService.getProjectName()).done((function(e){$("input",t).val(e.projectName)})).fail((function(e){console.log("ERROR",e)})),$("[name='cancel']",t).on("click",(function(){e.params.dialogBox.dialog("close")})),$("[name='save']",t).on("click",(function(){var a=$("input",t).val();if($(t).startLoading({overlay:!0}),0==a.length){$("input",t).addClass("status-error");var s=bizagi.localization.getResource("workportal-general-error-field-required");return s=s.replace("{0}",bizagi.localization.getResource("workportal-menu-submenu-ProjectName")),e.showError(s,i),void $(t).endLoading()}$.when(e.dataService.setProjectName(a)).done((function(a){$(t).endLoading(),e.showSuccess(bizagi.localization.getResource("workportal-widget-admin-projectname-success"),i)})).fail((function(a){a.responseText=a.responseText||{message:bizagi.localization.getResource("workportal-general-error")};var s=JSON.parse(a.responseText);console.log("Error:",a),$(t).endLoading(),e.showError(s.message,i)}))}))}}),bizagi.workportal.widgets.smartinbox.extend("bizagi.workportal.widgets.smartinboxAdminWizard",{},{init:function(e,t,i){this.adminMode=!0,this._super(e,t,i),this.numberOfSteps=4,this.profilesCache={},this.loadTemplates({"smartinbox-access-tap":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.smartinbox").concat("#ui-bizagi-workportal-widget-smartinbox-wizard"),"smartinbox-access-list":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.smartinbox").concat("#ui-bizagi-workportal-widget-smartinbox-wizard-access"),useNewEngine:!1})},postRender:function(){var e=this;$.when(e._super()).done((function(){e.content.addClass("bz-smartinbox-admin-wizard"),e.accessTapTemplate=e.getTemplate("smartinbox-access-tap"),e.accessListTemplate=e.getTemplate("smartinbox-access-list"),$.tmpl(e.accessTapTemplate).appendTo($(".bz-smartinbox-steps",e.content)),$.tmpl(e.accessListTemplate).appendTo($(".bz-smartinbox-forms",e.content)),e.dataModel.set("ownerType","default")}))},renderProfiles:function(){var e=this;$(".bz-access-list",e.content).bizagi_searchMultiSelect({scope:e,asyncList:e.getProfiles,list:{},itemValue:function(e){return e.value},itemText:function(e){return e.label||e.displayName},onChange:function(t){for(var i=[],a=0;a<t.length;a++)i.push({displayName:t[a].raw.label,value:t[a].value,type:t[a].raw.type});e.dataModel.set("access",i)},label:"",iconClass:"bz-icon bz-icon-search-outline bz-icon-16",parentPositionElement:".bz-access-list > ul",parentElementToFitWidth:".bz-access-list",parentElementToBorder:".bz-access-list > ul",classOpenedList:"bz-processes-search-border-open-list",classOpenedParent:"bz-opened",classItem:"theme-navigation-border",SEARCH_MIN_LENGTH:0,openOnFocus:!0,classMenuList:"ui-smart-inbox",customRenderItem:function(e,t){var i="";return"role"==t.type&&(i=bizagi.localization.getResource("workportal-widget-smartinbox-role","Role")),"usergroup"==t.type&&(i=bizagi.localization.getResource("workportal-widget-smartinbox-usergroup","User group")),"stakeholder"==t.type&&(i=bizagi.localization.getResource("workportal-widget-smartinbox-stakeholder","Stakeholder")),$("<li>").append($("<a>").append("<span class='bz-access-name'>"+(t.label||t.displayName)+"</span>").append("<span class='bz-access-category'>"+i+"</span>")).appendTo(e)}}),e.getProfiles({term:""},(function(t){var i=e.dataModel.get("access"),a=[];$.each(i,(function(e,i){$.each(t,(function(e,t){i.value==t.value&&a.push(t)}))})),e.dataModel.set("access",a),$(".bz-access-list",e.content).bizagi_searchMultiSelect("setDataItems",a)}),this)},getProfiles:function(e,t,i){if(e.term in i.profilesCache)t(i.profilesCache[e.term]);else{var a=[];$.when(i.dataService.getProfilesSmartInbox(e.term)).done((function(s){$.grep(s,(function(e){a.push({label:e.displayName,value:e.id,type:e.type})})),i.profilesCache[e.term]=a,t(a)}))}},checkStepOne:function(){this._super(),$("#bz-smartinbox-navigate-label4",this.content).addClass("bz-inactive"),$("#bz-smartinbox-navigate-label4",this.content).removeClass("bz-active"),$("#bz-smartinbox-step4",this.content).css("display","none")},checkStepTwo:function(){this._super(),$("#bz-smartinbox-navigate-label4",this.content).addClass("bz-inactive"),$("#bz-smartinbox-navigate-label4",this.content).removeClass("bz-active"),$("#bz-smartinbox-step4",this.content).css("display","none")},checkStepThree:function(){this._super(),this.editing||($("#bz-btn-smartinbox-back",this.content).css("display",""),$("#bz-btn-smartinbox-next",this.content).css("display",""),$("#bz-btn-smartinbox-create",this.content).css("display","none"),$("#bz-smartinbox-navigate-label3",this.content).removeClass("bz-inactive-done")),$("#bz-smartinbox-navigate-label4",this.content).addClass("bz-inactive"),$("#bz-smartinbox-navigate-label4",this.content).removeClass("bz-active"),$("#bz-smartinbox-navigate-label3 > span",this.content).html("3"),$("#bz-smartinbox-step4",this.content).css("display","none")},checkStepFour:function(){$("#bz-btn-smartinbox-back",this.content).css("display",""),$("#bz-btn-smartinbox-next",this.content).css("display","none"),$("#bz-btn-smartinbox-create",this.content).css("display",""),this.editing||($("#bz-smartinbox-navigate-label1",this.content).addClass("bz-inactive-done"),$("#bz-smartinbox-navigate-label3 > span",this.content).html('<svg style="width:16px;height:16px" xmlns="http://www.w3.org/2000/svg"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#check-mark" /></svg>')),$("#bz-smartinbox-navigate-label1",this.content).addClass("bz-inactive-done"),$("#bz-smartinbox-navigate-label1",this.content).removeClass("bz-active"),$("#bz-smartinbox-navigate-label2",this.content).addClass("bz-inactive-done"),$("#bz-smartinbox-navigate-label2",this.content).removeClass("bz-active"),$("#bz-smartinbox-navigate-label3",this.content).addClass("bz-inactive-done"),$("#bz-smartinbox-navigate-label3",this.content).removeClass("bz-active"),$("#bz-smartinbox-navigate-label4",this.content).addClass("bz-active"),$("#bz-smartinbox-navigate-label4",this.content).removeClass("bz-inactive"),$("#bz-smartinbox-step1",this.content).css("display","none"),$("#bz-smartinbox-step2",this.content).css("display","none"),$("#bz-smartinbox-step3",this.content).css("display","none"),$("#bz-smartinbox-step4",this.content).css("display",""),this.renderProfiles()},checkCurrentStep:function(){$("#bz-smartinbox-current-step-label",this.content).text(this.currentStep),1==this.currentStep?this.checkStepOne():2==this.currentStep?this.checkStepTwo():3==this.currentStep?this.checkStepThree():4==this.currentStep&&this.checkStepFour()},configureHandlers:function(){var e=this;e._super(),e.editing&&$("#bz-smartinbox-navigate-label4",e.content).bind("click",(function(){e.changeStepWizard(4)}))},closeWizard:function(){this.params.masterEditor.renderMasterView()},validateWizardAction:function(e,t){var i=this;if(e>t)return!0;var a=[],s=i._super(e,t);return 4==e&&(bizagi.util.isEmpty(i.dataModel.get("access"))||i.dataModel.get("access")==[])&&a.push(bizagi.localization.getResource("workportal-widget-admin-smartinbox-access-cannot-be-empty","You must select at least one role, user group or stakeholders")),a.length>0?($.each(a,(function(e,t){i.notifier.showErrorMessage(t)})),!1):s}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.smartinboxAdmin",{},(_defineProperty(_bizagi$workportal$wi={getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_SMARTINBOX},init:function(e,t,i){var a="bizagi.workportal.desktop.widgets.admin.smartinbox";i.masterEditor=this,this.wizard=new bizagi.workportal.widgets.smartinboxAdminWizard(e,t,i),this._super(e,t,i),this.loadTemplates({"admin.smartinbox.wrapper":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-smartinbox"),"admin.smartinbox.noinboxes":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-smartinbox-noinboxes"),"admin.smartinbox.manage":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-smartinbox-manage"),"admin.smartinbox.manage.menu":bizagi.getTemplate(a).concat("#ui-bizagi-workportal-widget-admin-smartinbox-manage-menu"),useNewEngine:!1}),this.editing=!1}},"getWidgetName",(function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_SMARTINBOX})),_defineProperty(_bizagi$workportal$wi,"renderContent",(function(){var e=this.getTemplate("admin.smartinbox.wrapper");return this.noFoldersTemplate=this.getTemplate("admin.smartinbox.nofolders"),this.manageTemplate=this.getTemplate("admin.smartinbox.manage"),this.manageMenuTemplate=this.getTemplate("admin.smartinbox.manage.menu"),this.noinboxesTemplate=this.getTemplate("admin.smartinbox.noinboxes"),this.content=$.tmpl(e)})),_defineProperty(_bizagi$workportal$wi,"renderMasterView",(function(){var e=this;e.render().then((function(t){e.params.dialogBox.html(t)}))})),_defineProperty(_bizagi$workportal$wi,"postRender",(function(){var e=this,t=e.getContent(),i=[];e.indexByRole={},$.when(e.dataService.getAdminSmartInbox()).then((function(a){$.grep(a,(function(t,a){var s=[];$.grep(t.access,(function(a,n){-1==i.indexOf(a.displayName)&&(i.push(a.displayName),s.push(a.id)),e.indexByRole[a.displayName]=e.indexByRole[a.displayName]||[],-1==e.indexByRole[a.displayName].indexOf(t.displayName)&&e.indexByRole[a.displayName].push(t.displayName)})),t.auxProfiles=s})),bizagi.localization.isRTL&&e.content.addClass("bz-smartinbox-rtl"),a.length>0?t.append($.tmpl(e.manageTemplate,{smartInboxes:a,roles:i})):t.append($.tmpl(e.noinboxesTemplate)),e.configureHandlers()}))})),_defineProperty(_bizagi$workportal$wi,"onResize",(function(){this.wizard&&this.wizard.onResize()})),_defineProperty(_bizagi$workportal$wi,"configureHandlers",(function(){var e=this,t=e.getContent();$("#bz-new-smartinbox",t).bind("click",(function(){e.wizard=new bizagi.workportal.widgets.smartinboxAdminWizard(e.workportalFacade,e.dataService,e.params),$.when(e.wizard.render()).done((function(e){t.empty(),t.append(e)}))})),$(".bz-smartinbox-admin-wizard select",t).bind("change",(function(i){var a,s=i.srcElement.value;""==s?$(".bz-smartinbox-admin-wizard tbody tr",t).show():($(".bz-smartinbox-admin-wizard tbody tr",t).hide(),a=(a=e.indexByRole[s])||[],$.each(a,(function(e,i){$(".bz-smartinbox-admin-wizard tbody tr[data-inbox='"+i+"']",t).show()})))})),$(".bz-smartinbox-settings",t).bind("click",$.proxy(e._showSmartInboxMenu,e)),e.onResize()})),_defineProperty(_bizagi$workportal$wi,"onResize",(function(){var e=this.params.dialogBox||this.params.masterEditor.params.dialogBox;$(".bz-smartinbox-admin-wizard table tbody",this.content).css("max-height",e.height()-300+"px")})),_defineProperty(_bizagi$workportal$wi,"showSmartInboxEditor",(function(e){var t=this;e.masterEditor=t,t.wizard=new bizagi.workportal.widgets.smartinboxAdminWizard(t.workportalFacade,t.dataService,e),$.when(t.wizard.loadDataDef).done((function(){$.when(t.wizard.render()).done((function(e){t.content.empty(),t.content.append(e)}))}))})),_defineProperty(_bizagi$workportal$wi,"_showSmartInboxMenu",(function(e){e.stopPropagation();var t=this,i=$(e.srcElement).closest("div"),a=i.data(),s=$(".bz-smartinbox-admin-wizard .ui-bizagi-workportal-widget-inbox-common-smartinbox-menucontainer",t.content),n=$.tmpl(t.manageMenuTemplate,{settingName:a.settingname,owner:a.owner,smartInboxId:a.smartinboxid,profiles:a.access});bizagi.localization.isRTL?s.position({my:"left center",at:"left center",of:i.closest("tr"),collision:"flipfit"}):s.position({my:"right center",at:"right center",of:i.closest("tr"),collision:"flipfit"}),$("li",n).bind("click",(function(e){var i=$(e.srcElement).data("action"),a=$(e.srcElement).closest("ul").data(),s={settingName:a.settingname,owner:a.owner,smartInboxId:a.smartinboxid,actionName:i,profiles:a.profiles};switch(i){case"edit":t.showSmartInboxEditor({selectedInboxData:s});break;case"delete":$.when(t.dataService.deleteSmartInbox(s)).done((function(){var e,i=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID,s=bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_HOMEPORTAL;e=$.isFunction(bizagi.cookie)&&null!==bizagi.cookie("bizagiDefaultWidget")&&bizagi.cookie("bizagiDefaultWidget")!==s?bizagi.cookie("bizagiDefaultWidget"):i,t.publish("changeWidget",{widgetName:e}),$(".bz-smartinbox-admin-wizard tbody tr[data-smartinboxid='"+a.smartinboxid+"']",t.content).remove()}))}})),$(document).on("click.overflow",(function(e){s.empty()})),s.append(n)})),_bizagi$workportal$wi)),function(e){e.fn.bizagiSearchUser=function(t){var i=this,a={},s=[],n=1,r=0,o={},l=(t=t||{}).editingUser;if(void 0===t.renderFactoryReference)throw"The renderFactoryReference property is required";if(void 0===t.getResourceReference)throw"The getResourceReference property is required";var d={init:function(){d.bindElements()},bindElements:function(){i.click((function(){d.openUploadDialog()}))},openUploadDialog:function(){window.document;var i=this.dialogBox=e("<div class='ui-bizagi-component-search-user'/>");o=i.dialog({width:950,maximize:!1,resize:!1,draggable:!1,height:650,title:t.title,modal:!0}),d.showFilters(),d.showButtons(),d.addHandlers();var a=d.setDefaultParams();d._loadResultsTemplate(a.usersResults,a.currentPage,a.pagination,a.pagesArray)},setDefaultParams:function(){return{usersResults:[],currentPage:-1,pagination:!1,pagesArray:[]}},showFilters:function(){var i=e("<div id='filtersContainer' class='filters-container clearfix'></div>");e.each(t.filters,(function(a,s){e(i,o).append("<div class='filters-row clearfix'><div class='filters-cell'><span>"+t.displayNames[a]+"</span></div><div class='filters-cell'><input id="+s+" type='text'> </input></div></div>")})),i.appendTo(o)},showButtons:function(){var i=e("<div id='buttonsContainer'class='biz-wp-buttonset'></div>");if(e(i,o).append("<button id='btnSearchUsers' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover' role='button' aria-disabled='false'><span class='ui-button-text'>"+t.searchButtonName+"</span></button>"),e(i,o).append("<button id='btnClear' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover' role='button' aria-disabled='false'><span class='ui-button-text'>"+t.clearButtonName+"</span></button>"),t.allowAddUser){var a="<button id='btnNew' class='ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover' role='button' aria-disabled='false'><span class='ui-button-text'>"+bizagi.localization.getResource("workportal-widget-admin-user-profiles-button-label-newUserProfiles")+"</span></button>";e(i,o).append(a),i.appendTo(o),e("#btnNew",o).bizagiCreateUser(t.dataService,t.renderFactory,{canvas:e(o),onCreate:t.selectItem(),onCancel:function(){e(o).dialog("option","title",t.title),e(o).empty(),d.showFilters(),d.showButtons(),d.addHandlers()}})}else i.appendTo(o)},addHandlers:function(){return e("#btnSearchUsers",o).click((function(){d.getUsersTableData()})),e("#btnClear",o).click((function(){d.clickClearPluginValues()})),this},clickClearPluginValues:function(){e.each(t.filters,(function(t,i){e("#"+i,o).val("")})),e("#searchResults",o).remove()},getUsersTableData:function(){d.updateFiltersInformation();var i=t.searchUsers(a);this._loadingList(i),e.when(i).done((function(e){Array.isArray(e.users)?(s=e.users,r=e.total,d.showUsersTable()):bizagi.showMessageBox(e.message,e.status,"","warning")})).fail((function(e){t.showError(e)}))},updateFiltersInformation:function(){e.each(t.filters,(function(t,i){a[i]=e("#"+i,o).val()})),a.pag=n,a.pagSize=9,void 0!==l&&""!==l&&(a.editingUser=l)},showUsersTable:function(){if(s.length>0){var i=r>1,a=d.getPagesArray();e("#biz-wp-wrapperload",o).remove(),e("#searchResults",o).remove();var l=d._loadResultsTemplate(s,n,i,a);e(o).append(l),d.addTableHandlers(),d.setUpPagination()}else t.showMessageBox("workportal-widget-usertable-empty"),e("#searchResults",o).hide()},_loadResultsTemplate:function(i,a,s,n){var r=t.renderFactoryReference.getTemplate("bizagi.plugin.search.user"),l=e.tmpl(r,{users:i,links:[t.getResourceReference("render-plugin-search-users-select-link")],page:a,pagination:s,pagesArray:this.getPagesArray});return e(o).append(l),0===i.length&&e("#searchResults",o).hide(),l},addTableHandlers:function(){e("table :button",o).click((function(){var i=e(this),a={};e.each(t.valuesToSelect,(function(e,t){a[t]=i.data(t)})),t.selectItem().resolve(a),o.remove()}))},getPagesArray:function(){for(var e=10>r?r:10,t=[],i=0;i<e;i++)t.push(i+1);return t},setUpPagination:function(){var t=this,i=e("#biz-wp-userstable-pager ul",o);i.bizagiPagination({maxElemShow:9,totalPages:r,actualPage:n,listElement:i,clickCallBack:function(e){a.pag=n=parseInt(e.page),t.getUsersTableData()}})},_loadingList:function(t){var i=e("#biz-wp-wrapperload",o),a=e("#searchResults",o);i.show(),a.hide(),t.always((function(){i.hide(),a.show()}))}};return d.init(),d}}(jQuery),function(e){e.fn.bizagiCreateUser=function(t,i,a){var s=this,n=(a=a||{}).canvas;onCreate=a.onCreate||function(){},onCancel=a.onCancel||function(){},displayName=bizagi.localization.getResource("workportal-widget-admin-user-profiles-button-label-newUserProfiles");var r={init:function(){r.addHandlers()},addHandlers:function(){s.on("click",(function(){r.newUser()}))},newUser:function(){var i=this;n.empty(),e.tmpl("<div {{loading}}></div>").appendTo(n),t.getUsersForm({h_action:"LOADUSERADMINFORM",h_contexttype:"entity",h_optionform:"add"}).done((function(e){var t=new bizagi.rendering.facade,s={canvas:n,data:e,type:"usersForm",userId:0,action:"add"};n.dialog("option","title",displayName),t.execute(s).done((function(e){t.form.bind("endUsersForm",(function(t,s){void 0===s.error&&("save"===s.formAction?(s.sendMail&&i.sendEmail(s.userId,s.password),a.onCreate.resolve({iduser:s.userId,user:s.fullName}),n.remove()):"cancel"===s.formAction&&a.onCancel(),e.endLoading())}))}))}))},sendEmail:function(e,i){var a=this;t.generateDataToSendByEmail({idUser:e,password:i}).done((function(e){a.showEmailPopup(e,i)}))},showEmailPopup:function(a,s){var n=this,r=window.document,o=i.getTemplate("render-user-email"),l=n.dialogBoxEmail=e("<div class= admin-users-email/>"),d={};l.empty(),l.appendTo("body",r),d[bizagi.localization.getResource("workportal-widget-admin-users-button-label-send")]=function(){if(""!=e("#txtTextTo",l).val()){var i={eMailTo:e("#txtTextTo",l).val(),subject:e("#txtSubject",l).val(),body:e("#txtBody",l).val(),userSecret:s};e.when(t.sendUserEmail(i)).done((function(e){n.closeUploadDialogEmail(),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-Send-message"),"Bizagi","warning")}))}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-users-empty-email-to"),"Bizagi","warning")},d[bizagi.localization.getResource("workportal-widget-admin-users-button-label-notSend")]=function(){n.closeUploadDialogEmail()},l.dialog({width:500,height:400,title:bizagi.localization.getResource("workportal-widget-admin-users-subtitle-email"),modal:!0,maximize:!1,resizable:!1,draggable:!1,buttons:d,close:function(){n.closeUploadDialogEmail()},resizeStop:function(e,t){n.form&&n.form.resize(t.size)}}),a.body=a.body.replace(/\\n/g,"\n").replace(/\\/g,""),e.tmpl(o,{messageResponse:a}).appendTo(l)},closeUploadDialogEmail:function(){this.dialogBoxEmail.dialog("destroy"),this.dialogBoxEmail.remove()}};return r.init(),r}}(jQuery),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.business.polices",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"widgets-admin-business-polices":bizagi.getTemplate("bizagi.workportal.desktop.widgets.admin.business.polices").concat("#business-polices-wrapper")})},renderContent:function(){var e=this.getTemplate("widgets-admin-business-polices");return this.content=e.render({build:bizagi.loader.build}),console.log("renderizar",this.content),this.content},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.admin.business.polices",["workportalFacade","dataService",bizagi.workportal.widgets.admin.business.polices]),function(e){e.fn.simpleGrid=function(t,i){if(void 0===t)throw"Debe pasar como parametro el widget de bizagi, para la carga del template";var a=this,s=e.extend({allowAdd:!1,allowEdit:!1,allowDelete:!1,displayName:"",dateFormat:bizagi.localization.getResource("dateFormat"),timeFormat:bizagi.localization.getResource("timeFormat"),filters:[],maxPageToShow:5,orderType:"ASC",orderField:"",orderEnabled:!0,page:1,pageSize:10,onDataBinding:function(){},onFilterChanged:function(){},onPageChanging:function(){},onLoadFilter:function(){},onAdd:function(){},onEdit:function(){},getResource:function(){}},i);a.grid={internalData:{}};var n=1,r=2,o=3,l=4,d=5,c=6,p=7,g=8,u=10,m=11,h=12,b=29;function w(e){var t=e.attributeType,i=e.dataType,a=e.xpath||"";return!e.masterEntity&&(!(i<0)&&(!(a.indexOf(".")>-1)&&(1003!=t&&(1002!=t&&(1004!=t&&1005!=t)))))}function f(e){var t=e.attributeType,i=e.dataType,a=e.xpath||"";return!(i<0)&&(!(a.indexOf(".")>-1)&&(1003!=t&&1002!=t))}function v(e,t){var i={decimalDigits:0,decimalSeparator:t.decimalSeparator},a=e.getAttribute("data-allowdecimals")||!1,s=e.getAttribute("data-numdecimals")||0,n=e.getAttribute("data-percentage")||!1,r=e.getAttribute("data-thousands")||!0;return a=bizagi.util.parseBoolean(a),r=bizagi.util.parseBoolean(r),i.allowDecimals=a,i.decimalDigits=s,i.thousands=r,i.groupSeparator=r?t.groupSeparator:"",i.percentage=n,i}return a.initialized=t.loadTemplates({"bizagi.simpleGrid.wrapper":bizagi.getTemplate("bizagi.simpleGrid").concat("#ui-bizagi-widget-simple-grid"),"bizagi.simpleGrid.content":bizagi.getTemplate("bizagi.simpleGrid").concat("#ui-bizagi-widget-simple-grid-content"),"bizagi.simpleGrid.paginator":bizagi.getTemplate("bizagi.simpleGrid").concat("#ui-bizagi-widget-simple-grid-paginator"),"filter-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-wrapper"),"filter-string":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-string"),"filter-number":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-number"),"filter-date":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-date"),"filter-boolean":bizagi.getTemplate("bizagi.workportal.desktop.filter.widgets").concat("#column-filter-control-boolean"),useNewEngine:!1}).then((function(){a.panelWrapper=t.getTemplate("bizagi.simpleGrid.wrapper"),a.panelContent=t.getTemplate("bizagi.simpleGrid.content"),a.panelPaginator=t.getTemplate("bizagi.simpleGrid.paginator")})),a.renderGrid=function(){a.empty(),e.when(a.initialized).done((function(){var i,z,$=[{pag:s.page,pagSize:s.pageSize,orderType:s.orderType,orderField:s.orderField,filters:(i=s.filters,z=Object.keys(i).map((function(e){return i[e]})),z.filter((function(e){if("is-null"===e.key||"is-null"!==e.key&&void 0!==e.value&&null!==e.value)return!0})))}],k=a.data("numRequest");a.data("numRequest",k?k+=1:1),void 0!==a.prev&&void 0!==s&&(e("option:selected",a.prev()).data("orderField",s.orderField),e("option:selected",a.prev()).data("orderType",s.orderType),e("option:selected",a.prev()).data("filters",s.filters)),k=a.data("numRequest"),e.when(s.onDataBinding.apply(a.get(0),$)).done(e.proxy((function(i){k===a.data("numRequest")&&(a.append(e.tmpl(a.panelWrapper)),a.grid.totalRecords=i.records,a.grid.totalPages=i.total,function(i){var z=i.row||[];z=z.map((function(e){return(e=e||[]).map((function(e){if("object"===_typeof(e)&&null!==e){var t=e.label;return e.additionallabel&&(t+=", "+e.additionallabel),t}return null===e?"":e}))}));var $=e(".ui-bizagi-simple-grid-wrapper",a).html(e.tmpl(a.panelContent,{displayName:s.displayName,headers:i.header,rows:z,orderType:s.orderType,orderField:s.orderField,orderEnabled:s.orderEnabled,guidForms:i.entity,allowAdd:s.allowAdd,allowEdit:s.allowEdit,allowDelete:s.allowDelete,filterApplied:s.filters,attributeSupportFilter:w,attributeSupportOrder:f}));(function(t,i){var w=e("a[data-type='"+n+"'][data-isSurrogateKey='false']",t),f=e("a[data-type='"+r+"'][data-attributeType='"+r+"']",t),z=e("a[data-type='"+o+"']",t),$=e("a[data-type='"+l+"']",t),k=e("a[data-type='"+d+"']",t),y=e("a[data-type='"+c+"']",t),T=e("a[data-type='"+p+"']",t),C=e("a[data-type='"+g+"']",t),S=e("a[data-type='"+u+"']",t),D=e("a[data-type='"+m+"']",t),R=e("a[data-type='"+h+"']",t),x=0===R.length?[]:i.filter((function(e){return e.dataType===h})),_=e("a[data-type='"+b+"']",t),A=void 0!==bizagi.currentUser.symbol?bizagi.currentUser:s.getResource("numericFormat"),E=bizagi.clone(A);E.decimalDigits=0;var I=e(".ui-bizagi-grid-table tr",t);e.each(R,(function(t,i){if("none"!=e(i).parent().css("display")){var s=Number(i.getAttribute("data-index")),n=I.find("td:eq("+s+")");I.find("td:eq("+s+")").find("span:contains(':')").addClass("formatDate")}bizagi.util.formatInvariantDate(n,a.getDateFormat(x[t]))})),e.each(C,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")"),r=!a.getAttribute("data-allowdecimals")||bizagi.util.parseBoolean(a.getAttribute("data-allowdecimals"));a.setAttribute("data-allowdecimals",r),n.find("span").addClass("formatMoney");var o=v(a,E),l=bizagi.util.parseBoolean(a.getAttribute("data-showsymbol"));o.symbol=null===l||l?"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:E.symbol:"",bizagi.util.formatInvariantMoney(n,o)}})),e.each(S,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")"),r=!a.getAttribute("data-allowdecimals")||bizagi.util.parseBoolean(a.getAttribute("data-allowdecimals"));a.setAttribute("data-allowdecimals",r),n.find("span").addClass("formatMoney");var o=v(a,E);o.allowDecimals&&0===o.decimalDigits&&(o.decimalDigits="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2),bizagi.util.formatInvariantNumber(n,o)}})),e.each(y,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")");n.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(n,v(a,E))}})),e.each(D,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")");n.find("span").addClass("formatMoney");var r=v(a,E);r.allowDecimals&&0===r.decimalDigits&&(r.decimalDigits="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2),bizagi.util.formatInvariantNumber(n,r)}})),e.each(w,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")");n.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(n,v(a,E))}})),e.each(f,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")");n.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(n,v(a,E))}})),e.each(z,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")");n.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(n,v(a,E))}})),e.each($,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")");n.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(n,v(a,E))}})),e.each(T,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")");n.find("span").addClass("formatMoney"),bizagi.util.formatInvariantNumber(n,v(a,E))}})),e.each(k,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")").find("span");s>0&&e.each(n,(function(t,i){var a=e.trim(e(i).text()).toLowerCase();"true"!==a&&"1"!==a||e(i).text("X"),"false"!==a&&"0"!==a||e(i).text("")}))}})),e.each(_,(function(i,a){if("none"!=e(a).parent().css("display")){var s=Number(a.getAttribute("data-index")),n=e(".ui-bizagi-grid-table tr",t).find("td:eq("+s+")").find("span");e.each(n,(function(t,i){var a=e.trim(e(i).text());e(i).text(bizagi.util.scientificNotationFormat(a))}))}})),e("a[data-type='-11']").length>0&&(e(".admin-entities-rightframe #detailEntity table.ui-bizagi-grid-table td:nth-child(1)").css("display","none"),e(".admin-entities-rightframe #detailEntity table.ui-bizagi-grid-table th:nth-child(1)").css("display","none"));a.configureHandlers(t)})($,i.header),function(i,n){var r=s.filters,o=i.find(".ui-bizagi-grid-header .ui-bizagi-render-icon-filter");e.each(o,(function(i,o){var l=e(o),d=l.parent(),c=l.data("index"),p=n[c];w(p)&&function(i){var n=i.fieldValue;l.bizagi_filters({guidAttribute:i.guidAttribute,type:i.dataType,attributeType:i.attributeType,parent:d,templates:{filterWrapper:t.getTemplate("filter-wrapper"),filterString:t.getTemplate("filter-string"),filterNumber:t.getTemplate("filter-number"),filterDate:t.getTemplate("filter-date"),filterBoolean:t.getTemplate("filter-boolean")},data:r[n],attribute:i.guidAttribute,entity:i.relatedEntity,dataService:{getAdminEntityData:function(t){var i=bizagi.util.tryCatch((function(){return n+t.idEntity+t.idAttribute+t.displayAttribFilter}),n);return e.when(a.grid.internalData[i]||s.onLoadFilter.apply(s,new Array(e.extend(t,{type:"Entity"})))).then((function(e){return a.grid.internalData[i]=bizagi.clone(e),bizagi.clone(e)}))}}}),l.on("bizagi_filterschange",(function(t,o){e.isEmptyObject(o)?delete r[n]:(o.dataType=i.dataType,o.field=n,void 0!==i.relatedEntity&&(o.entity=i.relatedEntity),r[n]=o),s.onFilterChanged.apply(a),a.renderGrid()})),r[n]&&l.addClass("ui-bizagi-column-filter-applied")}(p)}))}($,i.header);var k=e("option:selected",a.prev()).data("idRowSelected");if(void 0!==k){var y=e("tr[data-idrowentity='"+k+"']",$);y.addClass("ui-bizagi-state-selected"),a.elementSelected=y}}(i),i.records>s.pageSize&&(a.grid.page=i.page,function(){for(var t=s.maxPageToShow>a.grid.totalPages?a.grid.totalPages:s.maxPageToShow,i=e(".bz-rn-grid-footer-pagination",a),n={pagination:a.grid.totalPages>1,page:a.grid.page,pages:{}},r=1;r<=t;r++)n.pages[r]={pageNumber:r};i.append(e.tmpl(a.panelPaginator,n)),e("ul#bz-widget-simple-grid-pager-wrapper",a).bizagiPagination({totalPages:a.grid.totalPages,actualPage:a.grid.page,listElement:e("#biz-wp-table-pager-wrapper"),clickCallBack:function(e){s.onPageChanging.apply(a,new Array(s.page,e.page)),s.page=e.page,a.renderGrid()}})}()))}),k))}))},a.getDateFormat=function(e){return e.showTime?s.dateFormat+" "+s.timeFormat:s.dateFormat},a.configureHandlers=function(t){s.orderEnabled&&e(".link-order-entity",t).click((function(){s.orderField=e(this).attr("data-columnOrderField"),s.orderType=e(this).attr("data-orderType"),a.renderGrid()})),e(".ui-bizagi-grid-body tr",t).click((function(){"ui-bizagi-state-selected"===e(this).attr("class")?(e(this).removeClass("ui-bizagi-state-selected"),a.elementSelected=null,e("option:selected",a.prev()).removeData("idRowSelected")):(e(".ui-bizagi-grid-body tr",t).removeClass("ui-bizagi-state-selected"),e(this).addClass("ui-bizagi-state-selected"),e("option:selected",a.prev()).data("idRowSelected",e(this).data("idrowentity")),a.elementSelected=this)})),e("#addRowEntity",t).click((function(e){s.onAdd.apply(this,new Array(e,{context:a.get(0)}))})),e("#editRowEntity",t).click((function(i){null==a.elementSelected?bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row")):(s.onEdit.apply(this,new Array(i,a.elementSelected)),e(".ui-bizagi-grid-body tr",t).removeClass("ui-bizagi-state-selected"),a.elementSelected=null)})),e("#deleteRowEntity",t).click((function(i){null==a.elementSelected?bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row")):(s.onDelete.apply(this,new Array(i,a.elementSelected)),e(".ui-bizagi-grid-body tr",t).removeClass("ui-bizagi-state-selected"),a.elementSelected=null)}))},e.extend(a,{render:a.renderGrid})}}(jQuery),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.admin.transfer.case.security.permissions",{},{init:function(e,t,i){this.selectedUsers=["",""],this.allProcess=!1,this.haveProcess=!1,this._super(e,t,i),this.loadTemplates({"admin-case-security-improvement":bizagi.getTemplate("bizagi.workportal.widgets.admin.transfer.case.security.permissions").concat("#ui-bizagi-workportal-widget-admin-case-security-improvement"),"admin-case-security-improvement-fields":bizagi.getTemplate("bizagi.workportal.widgets.admin.transfer.case.security.permissions").concat("#ui-bizagi-workportal-widget-admin-case-security-improvement-fields"),"security-improvement-loader":bizagi.getTemplate("bizagi.workportal.widgets.admin.transfer.case.security.permissions").concat("#ui-bizagi-workportal-widget-admin-case-security-improvement-loader"),"security-improvement-emptyTree":bizagi.getTemplate("bizagi.workportal.widgets.admin.transfer.case.security.permissions").concat("#ui-bizagi-workportal-widget-admin-case-security-improvement-emptyTree"),useNewEngine:!1})},getWidgetName:function(){return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_ADMIN_TRANSFER_CASE_SECURITY_PERMISSIONS},loadtemplates:function(){this.fieldsContent=this.getTemplate("admin-case-security-improvement-fields"),this.loaderTmpl=this.getTemplate("security-improvement-loader"),this.emptyTreeTmpl=this.getTemplate("security-improvement-emptyTree")},postRender:function(){this.setupData()},setupData:function(){this.setupInitialData()},setupInitialData:function(){var e=$.tmpl(this.fieldsContent,{});$("#defaults-admin-case-security-home",this.content).append(e),this.setupSearchusersButton(),$(".security-message-danger",this.content).hide(),$("#title-process-revoke",this.content).hide();var t=$.tmpl(this.emptyTreeTmpl,{emptyTreeText:bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-select-current-user")});$("#processTreePermissions",this.content).addClass("disableColor").append(t)},renderContent:function(){var e,t=new $.Deferred;return this.generalContent=this.getTemplate("admin-case-security-improvement"),e=this.content=$.tmpl(this.generalContent,{}),this.params.content&&(e=this.params.content.html(e)),$.when(this.loadtemplates()).always((function(){t.resolve(e)})),t.promise()},setupProcessTreePermissions:function(e){var t=this.getContent(),i=$.extend({},this.params);i.canvas=$("#processTreePermissions",t),i.svgIconsMode=!0,i.searchKeyResource=" ",i.byUser=!0,i.userId=e,i.showTitle=!1,i.newDesign=!0,$("#processTreePermissions",t).removeClass("disableColor"),this.processTreePermissions=new bizagi.workportal.widgets.processtree(this.workportalFacade,this.dataService,i),this.processTreePermissions.render()},setupUsersSearchForm:function(e,t){var i=this,a=i.getContent(),s=$.Deferred();$("#defaults-admin-case-security-home").hide(),i.usersTable=new bizagi.workportal.widgets.userstable(i.workportalFacade,i.dataService,$.extend(i.params,{canvas:$("#dinamicContent",a),userLinkLabel:[bizagi.localization.getResource("workportal-widget-admin-defaults-assignation-select-link")],parentDef:s,showBackButton:!0})),i.usersTable.render(),$.when(s).done((function(s,n){var r={action:"Applications",userId:s};0==t&&$.when(i.dataService.getApplicationCategoriesList(r)).done((function(e){if(i.endLoading(),e.items.length>0){i.allProcess=!0,i.haveProcess=!0;var t=$("div.big-input > input[type='radio']:checked").val(),a=bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-transfer-permissions-of");"revoke"==t&&(a=bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-revoke-permissions-of")),i.setupProcessTreePermissions(s,a)}else i.initializeTree(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-user-dont-have-permissions-over-processes")),i.allProcess=!1,i.haveProcess=!1})).fail((function(){i.endLoading(),i.initializeTree(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-user-dont-have-permissions-over-processes"))})),$("#dinamicContent",a).html(""),$("#defaults-admin-case-security-home",a).show(),n&&($(e,a).val(n),i.showHideClearIcon(e,"block")),s&&(i.selectedUsers[t]=s)}))},initializeTree:function(e){var t=$.tmpl(self.emptyTreeTmpl,{emptyTreeText:e});$("#processTreePermissions",self.content).addClass("disableColor").empty(),$("#processTreePermissions",self.content).append(t)},showHideClearIcon:function(e,t){self=this;var i=self.getContent();$(e+" ~ span",i).css("display",t)},transferCaseSecuritypermissions:function(){var e=this;e.loader=$.tmpl(e.loaderTmpl,{});var t={};if(e.haveProcess&&(t=e.paramsToInvalidateSelectedCases()),t.allProcess=e.allProcess,t.idUserSource=""!=e.selectedUsers[0]?e.selectedUsers[0]:-1,t.idUserTarget=""!=e.selectedUsers[1]?e.selectedUsers[1]:-1,-1==t.idUserSource||-1==t.idUserTarget)bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-fail-you-must-select-both-users-to-continue"),bizagi.localization.getResource("workportal-general-word-information"),"warning");else if(t.idUserSource==t.idUserTarget)bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-fail-users-must-be-different"),bizagi.localization.getResource("workportal-general-word-information"),"warning");else if(e.haveProcess){$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-confirmation-message"),bizagi.localization.getResource("workportal-general-word-information"),"warning",[{label:bizagi.localization.getResource("workportal-general-word-no"),action:"reject"},{label:bizagi.localization.getResource("workportal-general-word-yes"),action:"resolve"}],{dialogClass:"widget-admincasesearch-invalidate-cases-confirm",width:400,minWidth:400})).done((function(){e.showLoading(),$.when(e.dataService.transferCaseSecuritypermissions(t)).done((function(t){e.endLoading(),"true"===t.status||!0===t.status?e.showNotifier(printf(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-ok"),t.quantityModifiedCases)):(e.endLoading(),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"))})).fail((function(t){e.endLoading(),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),bizagi.log(t)}))}))}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-user-dont-have-permissions-over-processes"),bizagi.localization.getResource("workportal-general-word-information"),"warning")},revokeCaseSecuritypermissions:function(){var e=this;e.loader=$.tmpl(e.loaderTmpl,{});var t={};if(e.haveProcess&&(t=e.paramsToInvalidateSelectedCases()),t.allProcess=e.allProcess,t.idUserSource=""!=e.selectedUsers[0]?e.selectedUsers[0]:-1,-1==t.idUserSource||-1==t.idUserTarget)bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-fail-you-must-select-the-current-user-to-continue"),bizagi.localization.getResource("workportal-general-word-information"),"warning");else if(e.haveProcess){$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-confirmation-message"),bizagi.localization.getResource("workportal-general-word-information"),"warning",[{label:bizagi.localization.getResource("workportal-general-word-no"),action:"reject"},{label:bizagi.localization.getResource("workportal-general-word-yes"),action:"resolve"}],{dialogClass:"widget-admincasesearch-invalidate-cases-confirm",width:400,minWidth:400})).done((function(){e.showLoading(),$.when(e.dataService.revokeCaseSecuritypermissions(t)).done((function(t){e.endLoading(),"true"===t.status||!0===t.status?e.showNotifier(printf(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-revoke-ok"),t.quantityModifiedCases)):bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning")})).fail((function(t){e.endLoading(),bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-assign-fail"),bizagi.localization.getResource("workportal-general-word-information"),"warning"),bizagi.log(t)}))})).fail((function(e){console.log("error",e)}))}else bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-user-dont-have-permissions-over-processes"),bizagi.localization.getResource("workportal-general-word-information"),"warning")},paramsToInvalidateSelectedCases:function(){var e=this.processTreePermissions.getTreeRouteSelected(),t="",i="";return e.length>0&&(2==e.length?(t=e[1],i=e[0]):(t=e[e.length-1],i=e[0])),this.allProcess=""==i,{idProcess:i,idApplication:t}},showNotifier:function(e){window.parent.bizagi.injector.get("notifier").showSucessMessage(e,"")},showLoading:function(){bizagi.util.isIE()&&$("#defaults-admin-case-security-home").focus(),$("#defaults-admin-case-security-home").append(this.loader)},endLoading:function(){$(this.loader).remove()},clearInput:function(e,t){var i="#txtTextUserSource"==e?0:1;this.showHideClearIcon(e,"none"),$(e,t).val(""),this.selectedUsers[i]=""},setupSearchusersButton:function(){var e=this,t=e.getContent();$("#btn-searchUserSource",t).click((function(){e.showLoading(),e.setupUsersSearchForm("#txtTextUserSource",0)})),$("#btn-searchUserTarget",t).click((function(){e.setupUsersSearchForm("#txtTextUserTarget",1)})),$("#btn-clearUserSource",t).click((function(){e.clearInput("#txtTextUserSource",t);var i=$.tmpl(e.emptyTreeTmpl,{emptyTreeText:bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-select-current-user")});$("#processTreePermissions",e.content).addClass("disableColor").empty(),$("#processTreePermissions",e.content).append(i)})),$("#btn-clearUserTarget",t).click((function(){e.clearInput("#txtTextUserTarget",t)})),$("#btn-copyPermissions",t).click((function(){!1===$("#allAppsLinkSelected",t).data("allAppSelected")&&0===e.processTreePermissions.getTreeRouteSelected().length?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-processTree-no-selected-process"),bizagi.localization.getResource("workportal-general-word-information"),"warning"):e.transferCaseSecuritypermissions()})),$("#btn-revokePermissions",t).click((function(){!1===$("#allAppsLinkSelected",t).data("allAppSelected")&&0===e.processTreePermissions.getTreeRouteSelected().length?bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-processTree-no-selected-process"),bizagi.localization.getResource("workportal-general-word-information"),"warning"):e.revokeCaseSecuritypermissions()})),$("#transferPermissions",t).click((function(){$("input[value='copy']").attr("checked",!0),$(".security-message-information",t).show(),$(".security-message-danger",t).hide(),$("#btn-copyPermissions",t).show(),$("#btn-revokePermissions",t).hide(),$(".user-label:has(#txtTextUserTarget)").show(),$("#title-process-copy",t).show(),$("#title-process-revoke",t).hide(),$("#revokePermissions",t).removeClass("ui-rubik-button-accept").addClass("ui-rubik-button-cancel"),$("#transferPermissions",t).removeClass("ui-rubik-button-cancel").addClass("ui-rubik-button-accept"),e.clearInput("#txtTextUserSource",t),e.clearInput("#txtTextUserTarget",t);var i=$.tmpl(e.emptyTreeTmpl,{emptyTreeText:bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-select-current-user")});$("#processTreePermissions",e.content).addClass("disableColor").empty(),$("#processTreePermissions",e.content).append(i)})),$("#revokePermissions",t).click((function(){$("input[value='revoke']").attr("checked",!0),$(".security-message-information",t).hide(),$(".security-message-danger",t).show(),$("#btn-copyPermissions",t).hide(),$("#btn-revokePermissions",t).show(),$(".user-label:has(#txtTextUserTarget)").hide(),$("#title-process-copy",t).hide(),$("#title-process-revoke",t).show(),$("#transferPermissions",t).removeClass("ui-rubik-button-accept").addClass("ui-rubik-button-cancel"),$("#revokePermissions",t).removeClass("ui-rubik-button-cancel").addClass("ui-rubik-button-accept"),e.clearInput("#txtTextUserSource",t),e.clearInput("#txtTextUserTarget",t);var i=$.tmpl(e.emptyTreeTmpl,{emptyTreeText:bizagi.localization.getResource("workportal-widget-admin-transfers-case-security-permissions-select-current-user")});$("#processTreePermissions",e.content).addClass("disableColor").empty(),$("#processTreePermissions",e.content).append(i)}))}});
//# sourceMappingURL=../../../../Maps/desktop/admin.desktop.production.js.map
