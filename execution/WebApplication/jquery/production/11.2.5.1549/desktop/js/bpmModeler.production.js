$.Class.extend("bizagi.bpmn.modeler.observable",{},{subscribe:function(){this.observableElement().bind.apply(this.observableElement(),arguments)},unsubscribe:function(){this.observableElement().unbind.apply(this.observableElement(),arguments)},publish:function(){return this.observableElement().triggerHandler.apply(this.observableElement(),arguments)},observableElement:function(){return this._observableElement?this._observableElement:this._observableElement=$({})}}),bizagi.bpmn.modeler.observable.extend("bizagi.bpmn.modeler.model",{},{init:function(){this.tasks={},this.canvas={}},setModel:function(t){this.tasks=t.tasks,this.canvas=t.canvas,this.triggerModelRedraw()},getViewModel:function(){var t=[];for(val in this.tasks){if(null!=this.tasks[val].durationInMinutes&&"UserTask"===this.tasks[val].type){var e=this.formatDuration(this.tasks[val].durationInMinutes);this.tasks[val].durationInMinutes=e}t.push(this.tasks[val])}return{tasks:t,canvas:this.canvas,isGateway:this.isGateway,isEvent:this.isEvent,isEmailTask:this.isEmailTask}},getPersistenceModel:function(){var t=this,e={tasks:jQuery.extend({},this.tasks),canvas:jQuery.extend({},this.canvas)};return $.each(e.tasks,(function(e,i){i.durationInMinutes&&(i.durationInMinutes=t.parseDuration(i.durationInMinutes)),delete i.showAura})),e},getTaskById:function(t){return this.tasks[t]},getConnectionRule:function(t,e){var i=this.tasks[t];if(!this.isGateway(i.type))return null;var o=$.grep(i.rules,(function(t){return t.target==e}));return o.length>0?o[0].expression:null},successorConnectionsCanContainRule:function(t){return"ParallelGateway"!==(t=this.tasks[t]).type&&this.isGateway(t.type)},setCanvasBounds:function(t){this.canvas=t,this.triggerModelChange({redraw:!1})},setExtendedProperty:function(t,e,i){this.tasks[t]&&(this.tasks[t].extendedProperties=this.tasks[t].extendedProperties||{},this.tasks[t].extendedProperties[e]=i,this.triggerModelChange({redraw:!1}))},getExtendedProperty:function(t,e){return this.tasks[t]?this.tasks[t].extendedProperties[e]:null},addTask:function(t,e,i){var o={id:this.newGuid(),type:t,displayName:this.getDefaultName(t),durationInMinutes:this.getDuration(t),position:e,showAura:!1,predecessors:[],successors:[],connectors:[],rules:[],extendedProperties:{}};i&&o.predecessors.push(i),this.tasks[o.id]=o,this.tasks[i]&&(this.tasks[i].successors.push(o.id),this.tasks[i].connectors.push({successor:o.id,displayName:"",displayNamePosition:{x:20,y:20}})),this.setAura(o.id,!0),this.triggerModelChange()},addConnection:function(t,e){var i=this.tasks[t],o=this.tasks[e],n=!1;for(var a in i.successors)i.successors[a]===e&&(n=!0);n||(i.successors.push(e),i.connectors.push({successor:e,displayName:"",displayNamePosition:{x:20,y:20}}),o.predecessors.push(t)),this.triggerModelChange()},changeTaskName:function(t,e){if(this.tasks[t]){if(this.tasks[t].displayName==e)return;this.tasks[t].displayName=e,this.triggerModelChange({redraw:!1})}},changeConnectorName:function(t,e,i){if(this.tasks[t]){for(var o=0;o<this.tasks[t].connectors.length;o++)this.tasks[t].connectors[o].successor==e&&(this.tasks[t].connectors[o].displayName=i);this.triggerModelChange({redraw:!1})}},changeConnectorPos:function(t,e,i){if(this.tasks[t]){for(var o=0;o<this.tasks[t].connectors.length;o++)this.tasks[t].connectors[o].successor==e&&(this.tasks[t].connectors[o].displayNamePosition.x=Math.round(i.x),this.tasks[t].connectors[o].displayNamePosition.y=Math.round(i.y));this.triggerModelChange({redraw:!1})}},changeDuration:function(t,e){if(this.tasks[t]){if(this.tasks[t].durationInMinutes==e)return;this.tasks[t].durationInMinutes=e,this.triggerModelChange({redraw:!1})}},changeTaskType:function(t,e){if(this.tasks[t]){if(this.tasks[t].type==e)return;this.tasks[t].type=e,this.triggerModelChange(),this.triggerChangeShape()}},moveTask:function(t,e){this.tasks[t]&&(this.tasks[t].position=e,this.triggerModelChange())},setAura:function(t,e){$.each(this.tasks,(function(t,e){e.showAura=!1})),this.tasks[t]&&(this.tasks[t].showAura=e)},setConnectionRule:function(t,e,i){var o=this.tasks[t],n=$.grep(o.rules,(function(t){return t.target==e})),a=n.length>0?n[0]:{target:e};0==n.length&&o.rules.push(a),a.expression=i,this.triggerModelChange()},removeConnectorsInPredecessors:function(t,e){for(var i=0;i<this.tasks[e].connectors.length;i++)this.tasks[e].connectors[i].successor==t&&this.tasks[e].connectors.splice(i,1)},deleteTask:function(t){var e=this;$.each(this.tasks,(function(i,o){if(o.predecessors&&o.predecessors.length>0){o.predecessors.removeAll(t);for(var n=0;n<o.predecessors.length;n++)e.removeConnectorsInPredecessors(t,o.predecessors[n])}o.successors&&o.successors.length>0&&o.successors.removeAll(t)})),delete this.tasks[t],this.triggerModelChange()},deleteArrow:function(t,e){var i=this.tasks[t],o=this.tasks[e];if(i&&i.successors.removeAll(e),o&&o.predecessors.removeAll(t),this.removeConnectorsInPredecessors(e,t),i.rules.length>0)for(var n=0;n<i.rules.length;n++){var a=i.rules[n].target;-1==i.successors.indexOf(a)&&i.rules.splice(n,1)}this.triggerModelChange()},newGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},getDefaultName:function(t){var e=0,i=[],o=[],n=/\d+/g,a=[],s="Task";if(bizagi.bpmn.modeler.viewer.featureLocalization&&(s=bizagi.bpmn.modeler.viewer.getKeyLocalization("workportal-process-modeler-task")),"UserTask"==t||"EmailTask"==t){for(var r in this.tasks)"UserTask"!==this.tasks[r].type&&"EmailTask"!==this.tasks[r].type||a.push(this.tasks[r]);if(a.length>0){for(var l=0;l<a.length;l++)if(0==a[l].displayName.indexOf(s)){var h=a[l].displayName.match(n);i.push(parseInt(h))}i=i.sort((function(t,e){return t-e}));for(l=0;l<i.length;l++)-1===$.inArray(i[l],o)&&0!=i[l]&&o.push(i[l])}for(l=1;l<=o.length;l++)if(e=l,o[l-1]>l){e-=1;break}return s+" "+(e+1)}return null},getDuration:function(t){return"UserTask"==t?"1h":null},parseDuration:function(t){-1==String(t).indexOf("h")&&-1==String(t).indexOf("m")&&(t=(t+="m").trim());if("string"!=typeof t)return t;if(t=t.trim(),/(?:^\d+h[ ]+\d+m$)|(?:^\d+[hm]?$)/.test(String(t))){var e="",i="",o=0,n=t.indexOf("h");-1!=n&&(e=t.substring(0,n),e=Math.floor(60*e),t=t.split("h").pop(),o=e);var a=t.indexOf("m");return-1!=a&&(i=t.substring(0,a),o+=parseInt(i)),o}return null},formatDuration:function(t){if(0!=t){var e=t%60,i=(t-e)/60,o=(i.toString()+"h "+e.toString()+"m").replace(" 0m","");return 0==i&&(o=o.replace("0h","")),o}return"0m"},triggerModelRedraw:function(){this.publish("model.redraw")},triggerModelChange:function(t){t=t||{redraw:!0},this.publish("model.change"),t.redraw&&this.triggerModelRedraw()},triggerChangeShape:function(t){this.publish("shape.change",t)},activeConfirmationPopup:function(t){return"UserTask"===t||"EmailTask"===t||"IntermediateEvent"===t||this.isGateway(t)},isEditableName:function(t){return!("StartEvent"===t.type||"EndEvent"===t.type||"TerminateEvent"===t.type)},isEmailTask:function(t){return"EmailTask"},isEvent:function(t){return"ExclusiveGateway"==t||"IntermediateEvent"==t},isGateway:function(t){return"ExclusiveGateway"==t||"ParallelGateway"==t||"InclusiveGateway"==t||"ComplexGateway"==t}}),bizagi.bpmn.modeler.observable.extend("bizagi.bpmn.modeler.aura",{externalOptions:{form:"bz-icon bz-icon-template-outline",assignee:"bz-icon bz-icon-cog-outline",notify:"bz-icon bz-icon-cog-outline"},getClassForExternalOption:function(t){return this.externalOptions[t]},getTitleForType:function(t){return this.toolBarTitles[t]}},{init:function(t){$.views.converters("externaloption_class",(function(t){return bizagi.bpmn.modeler.aura.getClassForExternalOption(t)})),$.views.converters("getResourceLocalization",(function(t){var e="",i="";return bizagi.bpmn.modeler.viewer.featureLocalization?(e=bizagi.bpmn.modeler.toolbar.getTitleForType(t),i=bizagi.bpmn.modeler.viewer.getKeyLocalization(e)):i=bizagi.bpmn.modeler.toolbar.getOldLocalization(t),i})),$.templates({bpm_modeler_aura:'                <aura class="bpm-aura-for-{{:type}}">                   <div class="wrapper-options">                        {{if changeTo && changeTo.length > 0}}                             <special-option class="tooltip bpm-option-change bz-icon bz-icon-asynchronous-outline"><span class="tooltiptext tooltip-right"><p>{{title: "changeType"}}</p></span></special-option>                                 <aura-change>                                     {{for changeTo tmpl="bpm_modeler_auraChangeTo"/}}                                 </aura-change>                         {{/if}}                     {{if externalOptions && externalOptions.length > 0}}                         <external-options>                             {{for externalOptions tmpl="bpm_modeler_auraExternalOption"/}}                         </external-options>                     {{/if}}                      <special-options {{if showRuleOption}} class="bpm-show-rule-option" {{/if}}>                         {{if showRuleOption}}                             <special-option class="tooltip bpm-option-expression bpmn-icon-conditional-flow"><span class="tooltiptext tooltip-right"><p>{{title: "addExpression"}}</p></span></special-option>                             <special-option class="tooltip bpm-option-else bpmn-icon-default-flow"><span class="tooltiptext tooltip-right"><p>{{title:"elseExpression"}}</p></span></special-option>                         {{/if}}                         <special-option class="tooltip bpm-option-delete bpmn-icon-trash bpmn-icon-trash-{{:type}}"><span class="tooltiptext tooltip-right"><p>{{title: "deleteShape"}}</p></span></special-option>                         </special-options>                           <aura-confirmation-delete class="popup__confirmationDelete">                                                     <div>                                                        <p>{{getResourceLocalization: "deleteConfirmationMessage"}}</p>                                                        <div class="contentButtons">                                                            <div class="btn btn__confirmation btn__confirmation--yes">{{getResourceLocalization: "confirmDeleteShape"}}</div>                                                            <div class="btn btn__confirmation btn__confirmation--no">{{getResourceLocalization: "cancelDeleteShape"}}</div>                                                        </div>                                                        <span class="downArrow"></span>                                                    </div>                                                </aura-cofirmation-delete>                        </div>                        <div class="wrapper-aura-options">                            {{for options tmpl="bpm_modeler_auraOption"/}}                              {{if showArrow}}                             <aura-option class="tooltip bpm-option-arrow bpmn-icon-connection" data-predecessor="{{:~root.id}}"><span class="tooltiptext tooltip-right"><p>{{title: "flowSecuence"}}</p></span></aura-option>                         {{/if}}                         </div>                  </aura>',bpm_modeler_auraOption:'<aura-option class="{{if ~#data=="IntermediateEvent"}}bpm-aura-intermediate-icon{{/if}} tooltip bpm-{{:#data}} {{tasktype_class: #data}} bpm-cloneable"                                             data-type="{{:#data}}"                                             data-predecessor="{{:~root.id}}">                                            <span class="tooltiptext tooltip-right"><p>{{title: #data}}</p></span>                                        </aura-option>',bpm_modeler_auraChangeTo:'<aura-change-to class="tooltip bpm-{{:#data}} {{tasktype_class: #data}}"                                                  data-type="{{:#data}}"                                                 data-task="{{:~root.id}}">                                                <span class="tooltiptext tooltip-right"><p>{{title: #data}}</p></span>                                        </aura-change-to>',bpm_modeler_auraExternalOption:'{{if (~root.type ==="EmailTask" && #data ==="notify") || ((~root.type === "UserTask" || ~root.type=="IntermediateEvent") && (#data === "form" || #data ==="assignee") )}}                                             <external-option class="tooltip bpm-{{:#data}} {{externaloption_class: #data}}"                                                         data-option="{{:#data}}"                                                         data-task="{{:~root.id}}">                                                        <span class="tooltiptext tooltip-right"><p>{{title: #data}}</p></span>                                                </external-option>{{/if}}'}),this.model=t,this.previousElementId=null,this.aura=null,this.isActiveConfirmDialog=!1},isEndEvent:function(t){return"EndEvent"!==t.data("type")&&"TerminateEvent"!==t.data("type")},showForTask:function(t){var e=this,i=t.attr("id"),o={type:this.model.getTaskById(i).type,options:this.getOptions(t),changeTo:this.getChangeTo(t),externalOptions:this.getExternalOptions(t),showArrow:this.isEndEvent(t),positioning:"right"},n=this.show(t,o);if(n){var a=this.aura.find(".wrapper-options"),s=this.model.getTaskById(t.attr("id"));switch(a.css("display","absolute"),s.type){case"UserTask":a.position({of:t,my:"center-47 top-35",at:"center top",collision:"none"}),this.publish("task.click",{task:i,option:"assignee",type:s.type});break;case"EmailTask":a.position({of:t,my:"center-47 top-35",at:"center top",collision:"none"});break;case"IntermediateEvent":a.position({of:t,my:"center-43 top-42",at:"center top",collision:"none"}),this.publish("task.click",{task:i,option:"assignee",type:s.type});break;case"StartEvent":a.position({of:t,my:"center top-48",at:"center top",collision:"none"});break;case"EndEvent":case"TerminateEvent":case"ParallelGateway":case"ExclusiveGateway":a.position({of:t,my:"center-18 top-48",at:"center top",collision:"none"});break;default:a.position({of:t,my:"center-8 top+25",at:"center bottom",collision:"none"})}this.aura.find("special-option.bpm-option-change").on("click",(function(){e.showChangeToOptions(this,s.type)})),this.aura.find("special-option.bpm-option-delete").on("click",(function(){e.activePopupConfirmationDelete(this,i)})),this.aura.find("aura-confirmation-delete .contentButtons .btn").on("click",(function(){e.actionConfirmDelete(this,i)})),this.aura.find("external-option").on("click",(function(){e.manageExternalOption($(this),i)})),this.aura.find("aura-option.bpm-option-arrow").draggable({helper:"clone",containment:"#bpm-drawing",grid:[20,20],drag:function(t,o){e.dragArrow(o,i)}})}return n},showForArrow:function(t,e){var i=this,o=t.attr("id"),n={type:"arrow",positioning:"center",showRuleOption:e},a=this.show(t,n);a&&(this.aura.find(".wrapper-options").position({of:t,my:"center center",at:"center+20 center-20",collision:"none"}),this.aura.find("special-option.bpm-option-delete").addClass("bpmn-icon-trash--arrow"),this.aura.find("special-option.bpm-option-delete").on("click",(function(){i.deleteArrow(o)})),this.addHandlersForExpressions(o));return a},show:function(t,e){var i=this,o=t.attr("id");if(this.previousElementId){var n=this.previousElementId==o;if(this.hide(this.previousElementId),n)return!1}this.previousElementId=o;var a=$.templates.bpm_modeler_aura.render($.extend(e,{id:o}));if(this.aura=$(a),t.after(this.aura),this.moveTo(t,e.positioning),e.externalOptions)this.aura.find("external-options");return this.aura.find("aura-option").draggable({helper:"clone",containment:"#bpm-drawing",grid:[20,20],drag:function(t,e){i.publish("item.drag",e)}}),!0},hide:function(t){null!=(t=t||this.previousElementId)&&(this.aura&&this.aura.detach(),this.previousElementId=null)},moveTo:function(t,e){t.attr("id")==this.previousElementId?"right"==(e=e||"right")&&this.aura.position({of:t,my:"left+20 center",at:"right center",collision:"none"}):this.hide()},showChangeToOptions:function(t,e){var i=this.aura.find("aura-change");i.toggleClass("visible"),i.position({of:t,my:"center top-60",at:"center top",collision:"none"}),this.aura.position().top<("UserTask"===e?57:120)&&i.css({top:33}),i.find("aura-change-to").click($.proxy(this.changeTo,this))},addHandlersForExpressions:function(t){var e=this;this.aura.find(".bpm-option-else").click((function(){var i=bizagi.bpmn.modeler.connector.getSourceTaskFromId(t),o=bizagi.bpmn.modeler.connector.getTargetTaskFromId(t);e.publish("arrow.setElse",t),e.model.setConnectionRule(i,o,"else")})),this.aura.find(".bpm-option-expression").click((function(){e.publish("arrow.setExpression",t)}))},activePopupConfirmationDelete:function(t,e){var i=this.model.getTaskById(e),o=this.aura.find(".popup__confirmationDelete"),n=$(t).position().left,a=$(t).position().top;this.model.activeConfirmationPopup(i.type)?(this.isActiveConfirmDialog=!0,i.position.y<170?($(o).css({top:a+38,left:n-90}),$(o).find(".downArrow").addClass("rotateArrow")):$(o).css({top:a-115,left:n-90}),$(o).show()):this.deleteTask(e)},actionConfirmDelete:function(t,e){var i=t.className,o=this.aura.find(".popup__confirmationDelete");i.indexOf("--yes")>0?this.deleteTask(e):(this.isActiveConfirmDialog=!1,$(o).hide())},deleteTask:function(t){this.model.deleteTask(t)},deleteArrow:function(t){var e=bizagi.bpmn.modeler.connector.getSourceTaskFromId(t),i=bizagi.bpmn.modeler.connector.getTargetTaskFromId(t);this.model.deleteArrow(e,i)},dragArrow:function(t,e){this.publish("arrow.drag",{source:e,target:t.offset})},changeTo:function(t){var e=$(t.currentTarget),i=e.data("type"),o=e.data("task");this.model.changeTaskType(o,i)},manageExternalOption:function(t,e){var i=t.data("option");this.publish("task.externaloption",{task:e,option:i})},getOptions:function(t){var e=t.data("type");return"EndEvent"==e||"TerminateEvent"==e?[]:["UserTask","IntermediateEvent","ExclusiveGateway","EndEvent"]},getChangeTo:function(t){var e=t.data("type"),i=[];return"ExclusiveGateway"==e||"ParallelGateway"==e||"InclusiveGateway"==e||"ComplexGateway"==e?i=["ParallelGateway","InclusiveGateway","ComplexGateway","ExclusiveGateway"]:"EndEvent"==e||"TerminateEvent"==e?i=["EndEvent","TerminateEvent"]:"UserTask"!==e&&"EmailTask"!==e||(i=["EmailTask","UserTask"]),i.length>0?(i.removeOne(e),i):null},getExternalOptions:function(t){var e=t.data("type");return"UserTask"!=e&&"IntermediateEvent"!=e&&"EmailTask"!=e?[]:["form","assignee","notify"]}}),$.Class.extend("bizagi.bpmn.modeler.path",{},{curve:8,arrowHeight:10,calculateAnchors:function(t,e){var i=Math.min(t.width,e.width),o=Math.min(t.height,e.height),n=t.x+t.width/2,a=e.x+e.width/2,s=t.y+t.height/2,r=e.y+e.height/2;if(t.x+t.width+i<e.x)return{el1:"right",el2:"left"};if(t.x>e.x+e.width+i)return{el1:"left",el2:"right"};if(this.areElementsVeryCloseInXAxis(t,e,i)){if(t.y+t.height<e.y)return{el1:"bottom",el2:"top"};if(t.y>e.y+e.height)return{el1:"top",el2:"bottom"}}if(Math.abs(s-r)<o){if(t.x<e.x)return{el1:"right",el2:"left"};if(t.x>=e.x)return{el1:"left",el2:"right"}}return n<a&&s<r?{el1:"bottom",el2:"left"}:n>a&&s<r?{el1:"bottom",el2:"right"}:n<a&&s>r?{el1:"top",el2:"left"}:n>a&&s>r?{el1:"top",el2:"right"}:void 0},getPath:function(t,e,i,o){Math.min(i.width,o.width),Math.min(i.height,o.height);var n={x:this.arrowHeight,y:this.arrowHeight,w:t.width-this.arrowHeight,h:t.height-this.arrowHeight};if(this.areVerticalAnchors(e)&&Math.abs(i.x-o.x)<10){if(i.y<o.y)return this.getPathTopToBottom(n,i,o);if(i.y>o.y)return this.getPathBottomToTop(n,i,o)}if(this.areHorizontalAnchors(e)&&Math.abs(i.y-o.y)<10){if(i.x<o.x)return this.getPathLeftToRight(n);if(i.x>o.x)return this.getPathRightToLeft(n)}if(this.areHorizontalAnchors(e)){if(i.x<o.x&&i.y<o.y)return this.getPathLeftToRightBottom(n);if(i.x<o.x&&i.y>o.y)return this.getPathLeftToRightTop(n);if(i.x>o.x&&i.y<o.y)return this.getPathRightToLeftBottom(n);if(i.x>o.x&&i.y>o.y)return this.getPathRightToLeftTop(n)}if(this.areVerticalAnchors(e)){if(i.x<o.x&&i.y<o.y)return this.getPathTopToBottomLeft(n);if(i.x<o.x&&i.y>o.y)return this.getPathBottomToTopLeft(n);if(i.x>o.x&&i.y<o.y)return this.getPathTopToBottomRight(n);if(i.x>o.x&&i.y>o.y)return this.getPathBottomToTopRight(n)}return"bottom"==e.el1&&"left"==e.el2?this.getPathBottomToLeft(n):"bottom"==e.el1&&"right"==e.el2?this.getPathBottomToRight(n):"top"==e.el1&&"left"==e.el2?this.getPathTopToLeft(n):"top"==e.el1&&"right"==e.el2?this.getPathTopToRight(n):void 0},getTransform:function(t,e,i){return this.areVerticalAnchors(t)&&Math.abs(e.x-i.x)<this.arrowHeight?"translate(5, 0)":("left"==t.el1||"right"==t.el1)&&Math.abs(e.y-i.y)<this.arrowHeight?"translate(0, 5)":""},areHorizontalAnchors:function(t){return"left"==t.el1&&"right"==t.el2||"right"==t.el1&&"left"==t.el2},areVerticalAnchors:function(t){return"top"==t.el1&&"bottom"==t.el2||"bottom"==t.el1&&"top"==t.el2},areElementsVeryCloseInXAxis:function(t,e,i){var o=t.x+t.width/2,n=e.x+e.width/2;return Math.abs(o-n)<i||(Math.abs(o-e.x)<i||(Math.abs(o-e.x+e.width)<i||(Math.abs(n-t.x)<i||Math.abs(n-t.x+t.width)<i)))},getPathLeftToRight:function(t){var e=t.x,i=t.w,o=t.h/2,n=t.h/2;return"M "+e+","+o+" L "+i+","+n+" "+this.getArrowRight(i,n)},getPathRightToLeft:function(t){var e=t.w,i=t.x,o=t.h/2,n=t.h/2;return"M "+e+","+o+" L "+i+","+n+" "+this.getArrowLeft(i,n)},getPathTopToBottom:function(t,e,i){var o=e.x<i.x?this.arrowHeight:t.w,n=o/2,a=o/2,s=t.y,r=t.h;return"M "+n+","+s+" L "+a+","+r+" "+this.getArrowDown(a,r)},getPathBottomToTop:function(t,e,i){var o=e.x<i.x?this.arrowHeight:t.w,n=o/2,a=o/2,s=t.h,r=t.y;return"M "+n+","+s+" L "+a+","+r+" "+this.getArrowUp(a,r)},getPathLeftToRightBottom:function(t){var e=t.x,i=t.w,o=t.y,n=t.h,a=t.w/2,s=(t.h,this.curve);return"M "+e+","+o+" L "+(a-s)+","+o+" S "+a+","+o+" "+a+","+(o+s)+" L "+a+","+(n-s)+" S "+a+","+n+" "+(a+s)+","+n+" L "+i+","+n+" "+this.getArrowRight(i,n)},getPathLeftToRightTop:function(t){var e=t.x,i=t.w,o=t.h,n=t.y,a=t.w/2,s=(t.h,this.curve);return"M "+e+","+o+" L "+(a-s)+","+o+" S "+a+","+o+" "+a+","+(o-s)+" L "+a+","+(n+s)+" S "+a+","+n+" "+(a+s)+","+n+" L "+i+","+n+" "+this.getArrowRight(i,n)},getPathRightToLeftBottom:function(t){var e=t.w,i=t.x,o=t.y,n=t.h,a=t.w/2,s=(t.h,this.curve);return"M "+e+","+o+" L "+(a+s)+","+o+" S "+a+","+o+" "+a+","+(o+s)+" L "+a+","+(n-s)+" S "+a+","+n+" "+(a-s)+","+n+" L "+i+","+n+" "+this.getArrowLeft(i,n)},getPathRightToLeftTop:function(t){var e=t.w,i=t.x,o=t.h,n=t.y,a=t.w/2,s=(t.h,this.curve);return"M "+e+","+o+" L "+(a+s)+","+o+" S "+a+","+o+" "+a+","+(o-s)+" L "+a+","+(n+s)+" S "+a+","+n+" "+(a-s)+","+n+" L "+i+","+n+" "+this.getArrowLeft(i,n)},getPathTopToBottomLeft:function(t){var e=t.x,i=t.w,o=t.y,n=t.h,a=(t.w,t.h/2),s=this.curve;return"M "+e+","+o+" L "+e+","+(a-s)+" S "+e+","+a+" "+(e+s)+","+a+" L "+(i-s)+","+a+" S "+i+","+a+" "+i+","+(a+s)+" L "+i+","+n+" "+this.getArrowDown(i,n)},getPathTopToBottomRight:function(t){var e=t.w,i=t.x,o=t.y,n=t.h,a=(t.w,t.h/2),s=this.curve;return"M "+e+","+o+" L "+e+","+(a-s)+" S "+e+","+a+" "+(e-s)+","+a+" L "+(i+s)+","+a+" S "+i+","+a+" "+i+","+(a+s)+" L "+i+","+n+" "+this.getArrowDown(i,n)},getPathBottomToTopLeft:function(t){var e=t.x,i=t.w,o=t.h,n=t.y,a=(t.w,t.h/2),s=this.curve;return"M "+e+","+o+" L "+e+","+(a+s)+" S "+e+","+a+" "+(e+s)+","+a+" L "+(i-s)+","+a+" S "+i+","+a+" "+i+","+(a-s)+" L "+i+","+n+" "+this.getArrowUp(i,n)},getPathBottomToTopRight:function(t){var e=t.w,i=t.x,o=t.h,n=t.y,a=(t.w,t.h/2),s=this.curve;return"M "+e+","+o+" L "+e+","+(a+s)+" S "+e+","+a+" "+(e-s)+","+a+" L "+(i+s)+","+a+" S "+i+","+a+" "+i+","+(a-s)+" L "+i+","+n+" "+this.getArrowUp(i,n)},getPathBottomToLeft:function(t){var e=t.x,i=t.w,o=t.y,n=t.h,a=this.curve;return"M "+e+","+o+" L "+e+","+(n-a)+" S "+e+","+n+" "+(e+a)+","+n+" L "+i+","+n+" "+this.getArrowRight(i,n)},getPathBottomToRight:function(t){var e=t.w,i=t.x,o=t.y,n=t.h,a=this.curve;return"M "+e+","+o+" L "+e+","+(n-a)+" S "+e+","+n+" "+(e-a)+","+n+" L "+i+","+n+" "+this.getArrowLeft(i,n)},getPathTopToLeft:function(t){var e=t.x,i=t.w,o=t.h,n=t.y,a=this.curve;return"M "+e+","+o+" L "+e+","+(n+a)+" S "+e+","+n+" "+(e+a)+","+n+" L "+i+","+n+" "+this.getArrowRight(i,n)},getPathTopToRight:function(t){var e=t.w,i=t.x,o=t.h,n=t.y,a=this.curve;return"M "+e+","+o+" L "+e+","+(n+a)+" S "+e+","+n+" "+(e-a)+","+n+" L "+i+","+n+" "+this.getArrowLeft(i,n)},getArrowRight:function(t,e){var i=this.arrowHeight/2;return"m -"+i+",-"+i+" l "+i+","+i+" l -"+i+","+i},getArrowLeft:function(t,e){var i=this.arrowHeight/2;return"m "+i+",-"+i+" l -"+i+","+i+" l "+i+","+i},getArrowUp:function(t,e){var i=this.arrowHeight/2;return"m -"+i+","+i+" l "+i+",-"+i+" l "+i+","+i},getArrowDown:function(t,e){var i=this.arrowHeight/2;return"m -"+i+",-"+i+" l "+i+","+i+" l "+i+",-"+i}}),$.Class.extend("bizagi.bpmn.modeler.connector",{buildConnectorId:function(t,e){return"svgFrom_"+t+"_to_"+e},getSourceTaskFromId:function(t){var e=t.indexOf("svgFrom_"),i=t.indexOf("_to_");return t.substring(e+8,i)},getTargetTaskFromId:function(t){var e=t.indexOf("_to_");return t.substring(e+4)}},{init:function(){$.templates({bpm_modeler_connector:'<connector style="position:absolute;left:{{:left}}px;top:{{:top}}px"                                                 id="{{:id}}"                                                 class="bpm-{{:expression}}"                                                 data-expression="{{:expression}}">                                                 <label class="label_connector_name">{{:displayName}}</label>                                         <svg width="{{:width}}" height="{{:height}}">                                             <path d="{{:path}}" fill="none" stroke="{{:stroke}}" transform="{{:transform}}"/>                                         </svg>                                         {{if expression == "else"}} <connector-label>else</connection-label> {{/if}}                                     </connector>'}),this.path=new bizagi.bpmn.modeler.path,this.stroke="#2C121C"},connect:function(t,e,i,o,n,a){var s=this.getBounds(e),r=this.getBounds(i),l=this.Class.buildConnectorId(e.attr("id"),i.attr("id"));e.attr("id")!=i.attr("id")&&this.drawLine(t,l,s,r,o,n,a)},drawLine:function(t,e,i,o,n,a,s){var r=this.modifyPositions(i,o),l={id:e,top:this.getTop(i,o),left:this.getLeft(i,o),width:this.getWidth(i,o),height:this.getHeight(i,o),transform:this.path.getTransform(r,i,o),expression:n,displayName:a,stroke:this.stroke};l.path=this.path.getPath(l,r,i,o);var h=$.templates.bpm_modeler_connector.render(l);if(connector=$(h),t.append(connector),"else"==n){var c=connector.find("svg");connector.find("connector-label").position({of:c,my:"center center",at:"center center",collision:"none"})}$(".label_connector_name").draggable({containment:"#bpm-drawing",grid:[20,20]});var d=$(connector).find(".label_connector_name");s?$(d).css({top:s.y,left:s.x}):(s={x:Math.round($(connector).find(".label_connector_name").position.left),y:Math.round($(connector).find(".label_connector_name").position.top)},$(d).css({top:s.y,left:s.x}))},refresh:function(t,e,i){var o=this.Class.buildConnectorId(e.attr("id"),i.attr("id")),n=$("#"+o),a=n.data("expression");n.detach(),this.connect(t,e,i,a)},drawTemporalConnector:function(t,e,i){var o="svgTemporalConnector";t.find("#"+o).detach();var n=this.getBounds(e),a={x:i.left,y:i.top,width:0,height:0};this.drawLine(t,o,n,a)},removeTemporalConnector:function(t){t.find("#svgTemporalConnector").detach()},getBounds:function(t){var e=t.position();return{x:e.left,y:e.top,width:t.outerWidth(),height:t.outerHeight()}},getLeft:function(t,e){return Math.min(t.x,e.x)-this.path.arrowHeight},getTop:function(t,e){return Math.min(t.y,e.y)-this.path.arrowHeight},getWidth:function(t,e){return Math.abs(t.x-e.x)+2*this.path.arrowHeight},getHeight:function(t,e){return Math.abs(t.y-e.y)+2*this.path.arrowHeight},modifyPositions:function(t,e){var i=this.path.calculateAnchors(t,e);return this.adjustToAnchor(t,i.el1),this.adjustToAnchor(e,i.el2),i},adjustToAnchor:function(t,e){"top"!=e&&"bottom"!=e||(t.x=t.x+t.width/2),"left"!=e&&"right"!=e||(t.y=t.y+t.height/2),"bottom"==e&&(t.y=t.y+t.height),"right"==e&&(t.x=t.x+t.width)}}),bizagi.bpmn.modeler.observable.extend("bizagi.bpmn.modeler.drawing",{},{init:function(t){this.canvas=null,$.templates({bpm_modeler_drawing:'<drawing>                                     {{for tasks tmpl="bpm_modeler_drawingItem"/}}                                   </drawing>',bpm_modeler_drawingItem:'<item id="{{: id}}" class="bpm-{{:type}} bpm-moveable" title="{{>displayName}}"                                             style="left:{{:position.x}}px; top:{{:position.y}}px"                                             data-type="{{: type}}"                                            data-show-aura="{{:showAura}}">                                             <label class="labelNameTask label-{{:type}}">{{>displayName}}</label>                                            {{if type=="IntermediateEvent"}}<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><style>.cls-1{fill:#fdffe7;}.cls-2{fill:#99a805;}</style></defs><title>event</title><circle class="cls-1" cx="12" cy="12" r="12"/><path class="cls-2" d="M12,1A11,11,0,1,1,1,12,11,11,0,0,1,12,1m0-1A12,12,0,1,0,24,12,12,12,0,0,0,12,0Z"/><path class="cls-2" d="M12,2.85A9.15,9.15,0,1,1,2.85,12,9.15,9.15,0,0,1,12,2.85m0-1.1A10.25,10.25,0,1,0,22.25,12,10.25,10.25,0,0,0,12,1.75Z"/></svg>{{/if}}                                            {{if type ==="EmailTask"}}<i class="ico_mail bpmn-icon-intermediate-event-throw-escalation"></i>{{/if}}                                            {{if ~root.isGateway(type)}}<gateway-helper></gateway-helper>{{/if}}                                             {{if type !="EmailTask" && durationInMinutes }}<duration title="{{:durationInMinutes}}">{{:durationInMinutes}}</duration>{{/if}}                                        </item>'}),this.drawingWidth=0,this.drawingHeight=0,this.model=t,this.model.subscribe("model.redraw",$.proxy(this.refresh,this)),this.previusElement=null,this.isEditionActive=!1,this.reviewMode=!1,this.aura=new bizagi.bpmn.modeler.aura(this.model),this.aura.subscribe("item.drag",$.proxy(this.onElementDragging,this)),this.aura.subscribe("arrow.drag",$.proxy(this.onArrowDragging,this)),this.aura.subscribe("arrow.setExpression",$.proxy(this.editExpressionForArrow,this)),this.aura.subscribe("arrow.setElse",$.proxy(this.triggerElseExpressionForArrow,this)),this.aura.subscribe("task.externaloption",$.proxy(this.manageExternalOption,this)),this.aura.subscribe("task.click",$.proxy(this.clickOnTask,this)),this.connector=new bizagi.bpmn.modeler.connector,this.aux=""},setCanvas:function(t){this.canvas=t},render:function(t,e){var i=this,o=null==this.canvas;this.canvas=t;var n=this.model.getViewModel(),a=$.templates.bpm_modeler_drawing.render(n);t.append(a),this.drawing=t.find("drawing"),this.canvasWidth=t.width(),this.canvasHeight=t.height(),this.scrollTop=n.canvas.top||0,this.scrollLeft=n.canvas.left||0,this.drawingWidth=this.drawingWidth||n.canvas.width||this.canvasWidth,this.drawingHeight=this.drawingHeight||n.canvas.height||this.canvasHeight,this.drawing.width(this.drawingWidth),this.drawing.height(this.drawingHeight),this.canvas.scrollLeft(this.scrollLeft),this.canvas.scrollTop(this.scrollTop),setTimeout((function(){i.addConnectors(n)}),0),!0!==e&&!0!==i.readonlyLoaded?this.addHandlers():i.readonlyLoaded=!0,o&&!0!==e&&this.addGeneralHandlers(),this.drawing.find("item[data-show-aura=true]").click(),this.configureNamesOfItems(),this.setGeneralEvents()},activeReviewMode:function(){$(document).find("#bpm-toolbar").hide(),$(this.drawing).find(".bpm-moveable").draggable("disable"),$(this.drawing).find("aura").hide(),this.reviewMode=!0,$("body").unbind("keyup"),$("body").off()},setGeneralEvents:function(){var t=this;$("body").off(),$("body").on("keyup",(function(e){this.reviewMode||t.keyUpEvent(e)}))},keyUpEvent:function(t){var e=this.returnSelectedItem();if(e)switch(t.which){case 113:"CONNECTOR"==e.nodeName?this.isEditionActive||this.editConnectorName($(e.firstElementChild),"f2"):this.isEditionActive||this.editTaskName($(e.firstElementChild),"f2");break;case 46:if(!this.reviewMode)if(e&&"CONNECTOR"==e.nodeName){var i=e.id.split("_to_")[0].split("svgFrom_")[1],o=e.id.split("_to_")[1];this.model.deleteArrow(i,o)}else{var n=this.model.getTaskById(e.id);if(this.model.activeConfirmationPopup(n.type)){i=$("#"+e.id).parent().find(".bpm-option-delete");this.aura.activePopupConfirmationDelete($(i),e.id)}else this.model.deleteTask(n.id)}}},configureNamesOfItems:function(){var t=this;$("#bpm-drawing").find(".labelNameTask").each((function(e,i){var o=$(i).text();t.setNameTask(o,$(i))?($(i).attr("desc",o),$(i).text(o.substring(0,20)+"...")):$(i).text(o)}))},returnSelectedItem:function(){var t=null;return $("#bpm-drawing").find(".active").each((function(e,i){t=i})),t},refresh:function(){this.isEditionActive=!1,this.canvas.empty(),this.aura.hide(),this.render(this.canvas)},addHandlers:function(){this.reviewMode||(this.drawing.find("item").draggable({containment:"#bpm-drawing",grid:[20,20],drag:$.proxy(this.onTaskDragging,this)}),this.configureDroppable())},addGeneralHandlers:function(){this.canvas.on("click","item",$.proxy(this.showAura,this)),this.canvas.on("dblclick","item",$.proxy(this.editTaskName,this)),this.canvas.on("dblclick","item duration",$.proxy(this.editDuration,this)),this.canvas.on("click","connector",$.proxy(this.showAuraForArrow,this)),this.canvas.on("dblclick","connector",$.proxy(this.editConnectorName,this)),this.canvas.on("click","drawing",$.proxy(this.clickCavnas,this)),this.canvas.on("mouseup","connector label",$.proxy(this.setConnectorPosition,this))},setConnectorPosition:function(t){var e=$(t.currentTarget),i=$(e).parent().attr("id").split("_to_")[0].split("svgFrom_")[1],o=$(e).parent().attr("id").split("_to_")[1],n={x:e.position().left,y:e.position().top};this.model.changeConnectorPos(i,o,n)},clickCavnas:function(t){if("ui-droppable"===t.target.className){if(this.drawing.find("*").removeClass("active"),this.previusElement)if("CONNECTOR"===this.previusElement.context.nodeName)this.aura.showForArrow(this.previusElement,!1);else this.aura.showForTask(this.previusElement);this.previusElement=null}},configureDroppable:function(){var t=this,e=!1,i=null;this.drawing.find("item").droppable({hoverClass:"dragging-arrow",drop:function(t,o){setTimeout((function(){e=!0,i=o}))}}),this.drawing.droppable({drop:function(o,n){setTimeout((function(){e?(t.addArrow(i),e.successor):n.helper.hasClass("bpm-cloneable")?t.addTask(n):n.helper.hasClass("bpm-moveable")?t.moveTask(n):n.helper.hasClass("bpm-option-arrow")&&t.addArrow(n),e=!1}),0)},accept:".bpm-cloneable, .bpm-moveable, .bpm-option-arrow"})},addTask:function(t){var e=t.draggable.data("type"),i=t.draggable.data("predecessor"),o=this.fixPosition(t.offset),n=o.left,a=o.top;this.autoAdjustCanvasOn(n,a),(n-=n%20)<80&&(n=80),(a-=a%20)<60&&(a=60),this.model.addTask(e,{x:n,y:a},i)},autoAdjustCanvasOn:function(t,e){this.canvasWidth+this.scrollLeft-200<t&&$("move-right").click(),this.canvasHeight+this.scrollTop-100<e&&$("move-bottom").click()},moveTask:function(t){t.draggable.data("type");var e=t.draggable.attr("id"),i=t.position.left,o=t.position.top;this.autoAdjustCanvasOn(i,o),(i-=i%20)<80&&(i=80),(o-=o%20)<60&&(o=60),this.model.moveTask(e,{x:i,y:o})},editTaskName:function(t,e){if(this.isEditionActive=!0,e)var i=$(t);else i=$("label",t.currentTarget);var o=i.parent().attr("id"),n=this.model.getTaskById(o);if(this.model.isEditableName(n)&&!this.reviewMode){var a=$("<input class='input_name' type='text' />");i.attr("desc")?a.val(i.attr("desc")):a.val(i.text()),this.isEditionActive&&this.showPopupEditor(i,a,this._setTaskTextAndTitle.bind(this,this,o,i))}else this.isEditionActive=!1},_setTaskTextAndTitle:function(t,e,i,o){t.model.changeTaskName(e,o),""===o&&(o=""),t.setNameTask(o,i)?(t.aux=o,i.attr("desc",o),i.text(o.substring(0,20)+"...")):i.text(o),i.context.title=o},editConnectorName:function(t,e){var i=this;if(e)var o=$(t);else o=$("label",t.currentTarget);var n=$("<input type='text' maxlength='20' class='input--ConnectorName input_name'/>");if(!i.reviewMode){i.isEditionActive=!0,n.val(o.text());var a=o.parent().attr("id"),s=o.parent().attr("id");a=a.split("_to_")[1],s=s.split("_to_")[0].split("svgFrom_")[1],this.showPopupEditor(o,n,(function(t){i.model.changeConnectorName(s,a,t),o.text(t),o.context.title=t}))}},manageExternalOption:function(t,e){var i=this.model.getTaskById(e.task);e.taskName=i.displayName,e.type=i.type,this.publish("drawing.externaloption",e)},clickOnTask:function(t,e){var i=this.model.getTaskById(e.task);e.taskName=i.displayName,this.publish("drawing.clickOnTask",e)},editDuration:function(t,e){if(t.stopPropagation(),!this.reviewMode){var i=this;i.isEditionActive=!0;var o=$(t.currentTarget),n=o.parent().attr("id"),a=$('<input type="text" maxlength="6" class="input__duration"/>');a.bind("paste",(function(t){t.preventDefault()})),a.val(o.text()),this.showPopupEditor(o,a,(function(t){""===t&&(t="1h");var e=i.model.parseDuration(t);null!=e&&(i.model.changeDuration(n,e),o.text(i.model.formatDuration(e)),o.context.title=o.text()),a.unbind("paste")}))}},addArrow:function(t){var e=t.draggable.data("predecessor"),i=this.fixPosition(t.offset),o=this.getTasksAtPosition(i);if(1==o.length){var n=o.attr("id");0!=$(o).attr("class").indexOf("bpm-StartEvent")&&e!==n?this.model.addConnection(e,n):this.connector.removeTemporalConnector(this.canvas)}else this.connector.removeTemporalConnector(this.canvas)},editExpressionForArrow:function(t,e){var i={option:"rule",source:bizagi.bpmn.modeler.connector.getSourceTaskFromId(e),target:bizagi.bpmn.modeler.connector.getTargetTaskFromId(e)};this.publish("drawing.externaloption",i)},triggerElseExpressionForArrow:function(t,e){var i={option:"else",source:bizagi.bpmn.modeler.connector.getSourceTaskFromId(e),target:bizagi.bpmn.modeler.connector.getTargetTaskFromId(e)};this.publish("drawing.externaloption",i)},setExpressionForArrow:function(t,e){this.model.setConnectionRule(t,e,"boolean")},moveCanvas:function(t,e){var i=$(t.target).prop("tagName").toLowerCase();"move-right"==i&&(this.scrollLeft+=100,this.canvasWidth+this.scrollLeft>=this.drawingWidth&&(this.drawingWidth+=100)),"move-left"==i&&(this.scrollLeft-=100),"move-top"==i&&(this.scrollTop-=100),"move-bottom"==i&&(this.scrollTop+=100,this.canvasHeight+this.scrollTop>=this.drawingHeight&&(this.drawingHeight+=100)),this.scrollTop<0&&(this.scrollTop=0),this.scrollLeft<0&&(this.scrollLeft=0),this.drawing.width(this.drawingWidth),this.drawing.height(this.drawingHeight),this.canvas.scrollLeft(this.scrollLeft),this.canvas.scrollTop(this.scrollTop),this.model.setCanvasBounds({top:this.scrollTop,left:this.scrollLeft,width:this.drawingWidth,height:this.drawingHeight})},onTaskDragging:function(t,e){this.redrawConnector(e.helper.attr("id"),e.position),this.aura.moveTo(e.helper),this.onElementDragging(t,e)},onArrowDragging:function(t,e){var i=this.drawing,o=this.fixPosition(e.target);this.connector.drawTemporalConnector(i,i.find("#"+e.source),o);var n=this.getTasksAtPosition(o);i.find("item").removeClass("dragging-arrow"),n.addClass("dragging-arrow")},onElementDragging:function(t,e){},redrawConnector:function(t){var e=this,i=this.model.getTaskById(t),o=this.drawing;$.each(i.predecessors,(function(i,n){n&&e.connector.refresh(o,o.find("#"+n),o.find("#"+t))})),$.each(i.successors,(function(i,n){if(n){var a=e.drawing.find("#"+n);0!=$(a).attr("class").indexOf("bpm-StartEvent")&&e.connector.refresh(o,o.find("#"+t),o.find("#"+n))}}))},addConnectors:function(t){var e=this,i="",o={};$.each(t.tasks,(function(t,n){$.each(n.successors,(function(t,a){for(var s=0;s<n.connectors.length;s++)n.connectors[s].successor==a&&(i=n.connectors[s].displayName,o={x:Math.round(n.connectors[s].displayNamePosition.x),y:Math.round(n.connectors[s].displayNamePosition.y)});e.addConnector(n.id,a,i,o)}))}))},addConnector:function(t,e,i,o){var n=this.model.getConnectionRule(t,e),a=this.drawing.find("#"+e);0!=$(a).attr("class").indexOf("bpm-StartEvent")&&this.connector.connect(this.drawing,this.drawing.find("#"+t),this.drawing.find("#"+e),n,i,o)},showAura:function(t){var e=$(t.currentTarget),i=this.aura.showForTask(e);this.model.setAura(e.id,i),this.previusElement=e;var o=null;o="UserTask"===e.attr("data-type")?$(e[0].innerHTML).text().slice(0,-1):$(e[0].innerHTML).text(),this.drawing.find("*").removeClass("active"),i&&e.addClass("active");var n={task:e[0].id,displayName:o,type:e.attr("data-type"),option:"selecTask"};this.publish("drawing.selectedTask",n),this.reviewMode&&$(e).parent().find("aura .wrapper-aura-options, aura .wrapper-options .bpm-option-change, aura .wrapper-options .bpm-option-delete").hide()},showAuraForArrow:function(t){var e=$(t.currentTarget);this.previusElement=e;var i=e.attr("id"),o=bizagi.bpmn.modeler.connector.getSourceTaskFromId(i),n=this.model.successorConnectionsCanContainRule(o),a=this.aura.showForArrow(e,n);this.drawing.find("*").removeClass("active"),a&&e.addClass("active"),this.reviewMode&&($(e).parent().find(".bpm-aura-for-arrow .wrapper-options").css("width","27px"),$(e).parent().find(".bpm-aura-for-arrow .wrapper-options special-options .bpm-option-else, .bpm-aura-for-arrow .wrapper-options special-options .bpm-option-delete").hide()),this.reviewMode&&$(e).hasClass("bpm-else")&&$(e).parent().find(".bpm-aura-for-arrow .wrapper-options").hide()},getTasksAtPosition:function(t){return this.drawing.find("item").filter((function(){var e=$(this),i=e.position(),o=i.left-25,n=i.top-25,a=e.width()+25,s=e.height()+25;return o<=t.left&&t.left<=o+a&&n<=t.top&&t.top<=n+s}))},showPopupEditor:function(t,e,i){var o=this,n=!1;t.hide(),t.after(e),e.focus(),e.select(),$("#bpm-drawing").find(".ui-droppable").bind("keydown",(function(t){switch(t.which){case 27:n=!0,a()}})),$(t).parent().find(".input_name").each((function(t,e){1===t&&$(e).remove()})),$(t).parent().find(".input_name").focus();var a=function(){if(n)i(t.text()),t.show(),e.detach(),n=!1;else{var a=e.val();i(a),t.show(),e.detach()}o.model.triggerModelChange(!0),o.isEditionActive=!1};e.keypress((function(t){o.isEditionActive&&"Enter"==t.key&&a()})),e.click((function(t){return t.preventDefault(),!1})),$("#canvas").one("click",(function(){o.isEditionActive&&a()}))},fixPosition:function(t){var e=this.drawing.offset();return t.left-=e.left,t.top-=e.top,t},setNameTask:function(t,e){if(t.length>20||e.height()>34)return!0}}),bizagi.bpmn.modeler.observable.extend("bizagi.bpmn.modeler.toolbar",{bpmShapes:{StartEvent:"bpmn-icon-start-event-none",IntermediateEvent:"bpmn-icon-intermediate-event-none",EndEvent:"bpmn-icon-end-event-none",TerminateEvent:"bpmn-icon-end-event-terminate",ExclusiveGateway:"bpmn-icon-gateway-xor",ParallelGateway:"bpmn-icon-gateway-parallel",InclusiveGateway:"bpmn-icon-gateway-or",ComplexGateway:"bpmn-icon-gateway-complex",UserTask:"bpmn-icon-task",EmailTask:"ico_mail bpmn-icon-intermediate-event-throw-escalation"},toolBarTitlesOld:{StartEvent:"Start Event",IntermediateEvent:"Intermediate Event",EndEvent:"End Event",ExclusiveGateway:"Exclusive Gateway",UserTask:"Task",TerminateEvent:"Terminate Event",ParallelGateway:"Parallel Gateway",assignee:"Settings",form:"Form Designer",EmailTask:"Email Task",notify:"Email Settings",changeType:"Change type",deleteShape:"Delete",flowSecuence:"Sequence Flow",deleteConfirmationMessage:"Do you want to DELETE this element? By doing so you will delete all the configurations associated to it.",confirmDeleteShape:"Yes",cancelDeleteShape:"No",addExpression:"Define expressions",elseExpression:"Else"},toolBarTitles:{StartEvent:"workportal-process-modeler-startEvent",IntermediateEvent:"workportal-process-modeler-intermediateEvent",EndEvent:"workportal-process-modeler-endEvent",ExclusiveGateway:"workportal-process-modeler-exclusiveGateway",UserTask:"workportal-process-modeler-userTask",TerminateEvent:"workportal-process-modeler-terminateEvent",ParallelGateway:"workportal-process-modeler-parallelGateway",assignee:"workportal-process-modeler-settings",form:"workportal-process-modeler-formDesigner",EmailTask:"workportal-process-modeler-emailTask",notify:"workportal-process-modeler-emailSettings",changeType:"workportal-process-modeler-changeType",deleteShape:"workportal-process-modeler-deleteShape",flowSecuence:"workportal-process-modeler-flowSecuence",deleteConfirmationMessage:"workportal-process-modeler-deleteConfirmationMessage",confirmDeleteShape:"workportal-process-modeler-confirm-delete",cancelDeleteShape:"workportal-process-modeler-cancel-delete",addExpression:"workportal-process-modeler-rules-addExpression",elseExpression:"workportal-process-modeler-rules-elseExpression"},getClassForType:function(t){return this.bpmShapes[t]},getTitleForType:function(t){return this.toolBarTitles[t]},getOldLocalization:function(t){return this.toolBarTitlesOld[t]}},{init:function(){$.views.converters("tasktype_class",(function(t){return bizagi.bpmn.modeler.toolbar.getClassForType(t)})),$.views.converters("title",(function(t){var e="",i="";return bizagi.bpmn.modeler.viewer.featureLocalization?(i=bizagi.bpmn.modeler.toolbar.getTitleForType(t),e=bizagi.bpmn.modeler.viewer.getKeyLocalization(i)):e=bizagi.bpmn.modeler.toolbar.getOldLocalization(t),e})),$.templates({bpm_modeler_toolbar:'<toolbar> {{for items tmpl="bpm_modeler_toolbarItem"/}}</toolbar>',bpm_modeler_toolbarItem:'<item class="tooltip bpm-{{:#data}} {{tasktype_class: #data}}  bpm-cloneable" data-type="{{:#data}}">{{if #data=="IntermediateEvent"}}<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><style>.cls-11{fill:#fff;}.cls-22{fill:#9ca613;}</style></defs><title>event 2</title><circle class="cls-11" cx="12" cy="12" r="12"/><path class="cls-22" d="M12,1.12A10.88,10.88,0,1,1,1.12,12,10.89,10.89,0,0,1,12,1.12M12,0A12,12,0,1,0,24,12,12,12,0,0,0,12,0Z"/><path class="cls-22" d="M12,3.79A8.21,8.21,0,1,1,3.79,12,8.22,8.22,0,0,1,12,3.79m0-1.12A9.33,9.33,0,1,0,21.33,12,9.33,9.33,0,0,0,12,2.67Z"/></svg>{{/if}}<span class="tooltiptext tooltip-right"><p>{{title: #data}}</p></span></item>'}),this.items=["StartEvent","UserTask","ExclusiveGateway","IntermediateEvent","EndEvent"]},render:function(t){this.canvas=t;var e=$.templates.bpm_modeler_toolbar.render({items:this.items});this.canvas.append(e),t.find("item").draggable({helper:"clone",containment:"#bpm-drawing",grid:[20,20],drag:$.proxy(this.onItemDragging,this)})},onItemDragging:function(t,e){this.publish("item.dragging",e)}}),bizagi.bpmn.modeler.observable.extend("bizagi.bpmn.modeler.viewer",{featureLocalization:!1,getInstaceLocalizationService:function(){return window.parent&&window.parent.bizagi.localization?window.parent.bizagi.localization:window.bizagi.localization},getKeyLocalization:function(t){return this.getInstaceLocalizationService().getResource(t)}},{init:function(t){$.templates({bpm_modeler_viewer_container:'<bpm-modeler>                             <div id="bpm-toolbar"></div>                             <div id="bpm-drawing"></div>                             <move-helper>                                 <move-top class="bpm-move"></move-top>                                 <move-left class="bpm-move"></move-left>                                 <move-bottom class="bpm-move"></move-bottom>                                 <move-right class="bpm-move"></move-right>                             </move-helper>                         </bpm-modeler>'}),this.model=new bizagi.bpmn.modeler.model,this.model.subscribe("model.change",$.proxy(this.changed,this)),this.model.subscribe("shape.change",$.proxy(this.triggerChangeShape,this)),t&&t.model&&this.model.setModel(t.model),this.drawing=new bizagi.bpmn.modeler.drawing(this.model),this.drawing.subscribe("drawing.externaloption",$.proxy(this.manageExternalOption,this)),this.drawing.subscribe("drawing.selectedTask",$.proxy(this.selectedTask,this)),this.drawing.subscribe("drawing.canvasEvent",$.proxy(this.canvasEvent,this)),this.drawing.subscribe("load.finish",$.proxy(this.triggerLoadFinish,this)),this.drawing.subscribe("drawing.clickOnTask",$.proxy(this.clickOnTask,this)),this.toolbar=new bizagi.bpmn.modeler.toolbar,this.toolbar.subscribe("item.dragging",$.proxy(this.onToolbarItemDragging,this)),this.readOnly=!1,this.readOnly=!(!1===t||!t)},render:function(t,e){var i=this;i.canvas=t;var o=$.templates.bpm_modeler_viewer_container.render();i.canvas.html(o),$.when(i.checkCSSLoaded()).then((function(){i.renderToolbar(),i.renderDrawing(i.readOnly),e&&i.load(e),i.readOnly&&($("#bpm-toolbar").css({display:"none"}),$("#bpm-drawing").addClass("bpm-modeler-readOnly"),$("#bpm-drawing").bind("over")),i.canvas.on("click",".bpm-move",$.proxy(i.moveCanvas,i))}))},checkCSSLoaded:function(){var t=this,e=$.Deferred();if(t.cssAppliedOnDrawing())e.resolve();else var i=0,o=setInterval((function(){i++,(t.cssAppliedOnDrawing()>0||10<=i)&&(e.resolve(),clearInterval(o))}),1e3);return e.promise()},cssAppliedOnDrawing:function(){return $("bpm-modeler #bpm-drawing").height()>0},reviewMode:function(t){t&&this.drawing.activeReviewMode()},localizationModeler:function(t){bizagi.bpmn.modeler.viewer.featureLocalization=t},renderToolbar:function(){var t=this.canvas.find("#bpm-toolbar");this.toolbar.render(t)},renderDrawing:function(t){var e=this.canvas.find("#bpm-drawing");this.drawing.render(e,t)},moveCanvas:function(t,e){this.drawing.moveCanvas(t,e)},onToolbarItemDragging:function(t,e){this.drawing.onElementDragging(t,e)},manageExternalOption:function(t,e){this.publish("bpm.modeler.externalOption",e)},selectedTask:function(t,e){this.publish("bpm.modeler.selectedTask",e)},canvasEvent:function(t,e){this.publish("bpm.modeler.canvasEvent",e)},triggerLoadFinish:function(){this.publish("bpm.modeler.loadFinish")},clickOnTask:function(t,e){this.publish("bpm.modeler.clickOnTask",e)},setConnectionExpression:function(t,e){this.drawing.setExpressionForArrow(t,e)},save:function(){return this.model.getPersistenceModel()},load:function(t){this.model.setModel(t)},changed:function(t){this.publish("bpm.modeler.changed")},triggerChangeShape:function(){this.publish("bpm.modeler.changeShape")},setExtendedProperty:function(t,e,i){this.model.setExtendedProperty(t,e,i)},getExtendedProperty:function(t,e){return this.model.getExtendedProperty(t,e)}}),Array.prototype.removeOne||(Array.prototype.removeOne=function(t){for(var e=this.length;e--;)if(this[e]===t)return void this.splice(e,1)}),Array.prototype.removeAll||(Array.prototype.removeAll=function(t){for(var e=this.length;e--;)this[e]===t&&this.splice(e,1)});
//# sourceMappingURL=../../../../Maps/desktop/bpmModeler.production.js.map
