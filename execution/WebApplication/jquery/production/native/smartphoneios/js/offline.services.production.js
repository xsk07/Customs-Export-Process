function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.render=void 0!==bizagi.render?bizagi.render:{},bizagi.render.services=void 0!==bizagi.render.services?bizagi.render.services:{},bizagi.render.services.endPoints=[],bizagi.render.services.getEndPoints=function(e){var t="Rest/Handlers/Render";return"workflow"==e.context?{"form-get-data":e.proxyPrefix+t,"form-submit-data":e.proxyPrefix+t,"form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload","render-property-refresh":e.proxyPrefix+t,"render-multiaction":e.proxyPrefix+"Rest/Handlers/MultiAction","render-upload-cancel-image":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload","render-upload-delete-url":e.proxyPrefix+t,"render-ecm-upload-url":e.proxyPrefix+"Rest/Handlers/Metadata","render-multiaction-metadata":e.proxyPrefix+"Rest/Handlers/MetadataMultiAction","render-grid-edit-url":e.proxyPrefix+t,"render-grid-save-url":e.proxyPrefix+t,"render-grid-add-url":e.proxyPrefix+t,"render-grid-rollback-url":e.proxyPrefix+t,"render-grid-commit-url":e.proxyPrefix+t,"render-grid-checkpoint-url":e.proxyPrefix+t,"render-save-entity":e.proxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":e.proxyPrefix+"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter","render-letter-save-url":e.proxyPrefix+t,"render-letter-content-icons":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.proxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.proxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.proxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}","render-entity-layout-upload-files":e.proxyPrefix+"Api/Entities/{entity}/Files/{surrogateKey}/Array?xpath={xpath}","render-query-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsersForQueryFormsById/{queryFormId}/","case-handler-getCaseSummary":e.proxyPrefix+"Rest/Cases/{idCase}/SummaryGuid","case-handler-getCaseSummaryByGuid":e.proxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/AssigneesGuid","case-handler-getWorkItems":e.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid","admin-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsers","admin-getUsersList-FromPreferences":e.proxyPrefix+"Rest/Users/SearchUsersFromPreferences","admin-getUsersList-ForStakeholders":e.proxyPrefix+"Rest/Users/SearchUsersForStakeholders","admin-getUsersList-ForXpathIdBossUser":e.proxyPrefix+"Rest/Users/SearchUsersForBosses","admin-getUsersList-ForXpathIdDelegate":e.proxyPrefix+"Rest/Users/SearchUsersForDelegates","admin-getUsersForAssignation":e.proxyPrefix+"Rest/Users/UsersForAssignation","admin-users-config":e.proxyPrefix+"Api/Authentication/BizagiConfig","admin-usersform":e.proxyPrefix+"Rest/Handlers/Render","admin-GenerateDataToSendByEmail":e.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendUserEmail":e.proxyPrefix+"Rest/Users/SendUserEmail"}:"sharepoint"==e.context||"portal"==e.context?(void 0===e.sharepointProxyPrefix&&alert("sharepointProxyPrefix param is requiered to build endpoints when context is 'sharepoint'"),{"form-get-data":e.sharepointProxyPrefix+t,"form-submit-data":e.sharepointProxyPrefix+t,"form-submit-data-upload":e.sharepointProxyPrefix+"Rest/Handlers/Render/Upload","render-property-refresh":e.sharepointProxyPrefix+t,"render-multiaction":e.sharepointProxyPrefix+"Rest/Handlers/MultiAction","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.sharepointProxyPrefix+"Rest/Handlers/RenderFile","render-upload-add-url":e.sharepointProxyPrefix+"Rest/Handlers/Render/Upload","render-upload-delete-url":e.sharepointProxyPrefix+t,"render-ecm-upload-url":e.sharepointProxyPrefix+"Rest/Handlers/Metadata","render-grid-edit-url":e.sharepointProxyPrefix+t,"render-grid-save-url":e.sharepointProxyPrefix+t,"render-grid-add-url":e.sharepointProxyPrefix+t,"render-grid-rollback-url":e.sharepointProxyPrefix+t,"render-grid-commit-url":e.sharepointProxyPrefix+t,"render-grid-checkpoint-url":e.sharepointProxyPrefix+t,"render-save-entity":e.sharepointProxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":"jquery/css/bizagi/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.sharepointProxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.sharepointProxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.sharepointProxyPrefix+"Rest/Handlers/Letter","render-letter-content-url":e.sharepointProxyPrefix+"Rest/Handlers/Letter","render-letter-save-url":e.sharepointProxyPrefix+t,"render-letter-content-icons":"jquery/css/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.sharepointProxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.sharepointProxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.sharepointProxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}","case-handler-getCaseSummary":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-getCaseSummaryByGuid":e.sharepointProxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getWorkItems":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid"}):"entitymanagement"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=entity","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=entity","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile?h_contexttype=entity","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=entity","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=entity","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=entity","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=entity","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=entity","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:"search"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=metadata","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=metadata","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile?h_contexttype=metadata","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=metadata","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=metadata","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=metadata","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=metadata","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:{}},$.Class.extend("bizagi.render.services.context",{},{init:function(e){this.context=e.context,this.endPoints=bizagi.render.services.getEndPoints(e),this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix},getUrl:function(e){return null==this.endPoints[e]&&alert("No endpoint defined for: "+e),this.endPoints[e]},setProxyPrefix:function(e){this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.endPoints=bizagi.render.services.getEndPoints(e)}}),$.Class.extend("bizagi.render.services.service",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId",BA_MULTIACTION_WITH_LIMIT_NUMBER:5,BA_MULTIACTION_WITH_LIMIT_QUEUE:"multiaction"},{init:function(e){(e=e||{}).context=e.context||"workflow",e.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.serviceLocator=new bizagi.render.services.context(e),this.multiactionService=new bizagi.render.services.multiactionservice(this),this.multiactionServiceWithLimit=new bizagi.render.services.multiactionservice(this,this.Class.BA_MULTIACTION_WITH_LIMIT_NUMBER,this.Class.BA_MULTIACTION_WITH_LIMIT_QUEUE),this.guid=Math.guid(),bizagi.override.enableECMMetadataMultiaction&&(this.multiactionMetadataService=new bizagi.render.services.metadatamultiactionservice(this)),this.userfieldRequests={},this.deviceType=e.deviceType||(bizagi.util.isSmartphoneDevice()?bizagi.deviceEnum.smartphone:bizagi.util.isTabletDevice()?bizagi.deviceEnum.tablet:bizagi.deviceEnum.desktop),this.deviceCode=bizagi.util.getDeviceCode()},multiaction:function(){return this.multiactionService},multiactionWithLimit:function(){return this.multiactionServiceWithLimit},metadataECMMultiaction:function(){return bizagi.override.enableECMMetadataMultiaction?this.multiactionMetadataService:this},getFormData:function(e){if(e&&e.data)return e.data;e=e||{};var t={};if(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action||"LOADFORM",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,e.idProcess&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idProcess"]=e.idProcess),e.idOrganization&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idOrganization"]=e.idOrganization),e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.idEntity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEntity"]=e.idEntity),e.surrogateKey&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey),e.idRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.requestedForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"requestedForm"]=e.requestedForm),e.recordXPath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordXPath"]=e.recordXPath),e.summaryForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"summaryForm"]=e.summaryForm),e.idCase&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idWorkitem&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.idTask&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idTask"]=e.idTask),e.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.contextType&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contextType),e.guidEntity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),bizagi.util.isEmpty(e.isRefresh)||(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isRefresh"]=e.isRefresh),e.isActionStartForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=e.isActionStartForm),e.additionalXpaths&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),void 0!==e.readOnlyForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"readonlyform"]=e.readOnlyForm),void 0!==e.printversion&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"printForm"]=e.printversion),void 0!==e.recordXpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.guid&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guid"]=e.guid),e.downloadOfflineForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"downloadofflineform"]=1),!1===e.editable&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"DisplayFormAsReadOnly"]=!0),e.printversion){e[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"]&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"]=e[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"])}if(e.prepare)return t;bizagi.chrono.initAndStart("data");var r={url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:e.action||"LOAD"};return e.downloadOfflineForm&&(r.avoidLoader=!0),$.ajax(r).pipe((function(r){if(bizagi.chrono.stopAndLog("data"),e.printversion)try{r.form.properties.editable="False";r=function e(r){return null==r?r:(r.hasOwnProperty("type")&&"grid"==r.type?(r.id=t.id+"-print",r.allowAdd="False",r.allowDelete="False",r.allowEdit="False",r.allowGrouping="False",r.allowMore="False",r.allowSearch="False"):$.each(t,(function(t,i){"object"==_typeof(i)&&(r[t]=e(r[t]))})),r)}(r)}catch(e){}return r}))},getSearchFormData:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHFORM",e.xpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idSearchForm&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm),e.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-search-form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"SEARCHFORM"})},processDataValues:function(e){var t;for(t in e=$.extend(!0,{},e))e.hasOwnProperty(t)&&"object"==$.type(e[t])&&e[t].hasOwnProperty("id")&&(e[t]=e[t].id);return e},submitData:function(e){data=this.resolveData(e.data||{},e.xpathContext),data=this.processDataValues(data),data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action,(e=e||{}).xpath&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idPageCache&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.guidEntity&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),e.contexttype&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.transitions&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"transitions"]=e.transitions),e.surrogatekey&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.forcePlanCompletion&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"forcePlanCompletion"]=e.forcePlanCompletion);var t=e.action.toString().toUpperCase();return bizagi.debug("Data sent",data),e.prepare?data:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:data,type:"POST",dataType:"json",serviceType:t,beforeSend:function(e,t){e.renderingService=!0}})},resolveData:function(e,t){var r,i,a;if(!$.isEmptyObject(e)&&t&&-1!==t.search(/\[id=\d+\]/))for(r in e)-1!==r.search(/\[id=\d+\]/)&&t==r.substr(0,r.search(/\]/)+1)&&(i=r.substr(r.search(/\]/)+2),a=e[r],e[i]=a,delete e[r]);return e},getPropertyData:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,e.sessionId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.guidentity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.surrogatekey&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.pxpath&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpath"]=e.pxpath),e.prows&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.prows),e.ppage&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.ppage),null!=e.pfilter&&null!=e.pfilter&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"filter"]=e.pfilter),null!=e.psort&&null!=e.psort&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.psort),e.porder&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.porder),e.pcaseId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"caseId"]=e.pcaseId),e.pguidEntity&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidEntity"]=e.pguidEntity),e.psurrogatedKey&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.psurrogatedKey),e.pactionXpath&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"actionXpath"]=e.pactionXpath),e.ptemplateGuid&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"templateGuid"]=e.ptemplateGuid),e.pparameters&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"parameters"]=e.pparameters),bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},getData:function(e){return this.getPropertyData($.extend(e,{property:"data"}))},getSearchData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"term"]=e.term,this.getPropertyData($.extend(e,{property:"data"}))},getCollapseData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"collapseState"]=e.collapseState,this.getPropertyData($.extend(e,{property:"collapseState"}))},getGridData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.order,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,this.getPropertyData($.extend(e,{property:"data"}))},getGridDataExclusivesSelected:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathfilter"]=e.xpathfilter,this.getPropertyData($.extend(e,{property:"exclusivesSelected"}))},getUploadCancelImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-upload-cancel-image")},getUploadFileUrl:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"fileContent",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,e.contexttype&&(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)+"&xsrf="+bizagi.getXSRFToken()},downloadFile:function(e){var t=this,r=t.getUploadFileUrl(e);return $.ajax({url:r,type:"GET",queue:e.queue,dataType:"binary",processData:!1}).then((function(e){if("application/json"==e.type)return t.readFileAsJSON(e);if("string"==typeof e){var r=arguments[2],i=r.getResponseHeader("Content-type");e=bizagi.util.media.byteArrayToBlob(t.stringToByteArray(e),i)}return e}))},readFileAsJSON:function(e){var t=new $.Deferred,r=new FileReader;return r.onloadend=function(){t.reject({responseText:r.result})},r.readAsText(e),t.promise()},stringToByteArray:function(e){return bizagi.util.stringToByteArray(e)},getUploadFileEntityUrl:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)},getUploadAddUrl:function(){var e=this.serviceLocator.getUrl("render-upload-add-url"),t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDFILE",this.verifyPathToBase(bizagi.services.ajax.pathToBase,e)+"?"+jQuery.param(t)},getUploadAddFileUrl:function(e){var t=this.serviceLocator.getUrl("form-submit-data-upload"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=!0===e?"SAVEUSERIMAGE":"savefile",this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)},deleteImage:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="DELETEUSERIMAGE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing image '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},deleteUploadFile:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing file in upload '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},getECMMetadata:function(e){var t=e.extra||{};return t.action="getECMMetadata",t.idFileUpload=e.idFileUpload,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,t.xPath=e.xPath,t.idAttrib=e.idAttrib,e.sessionId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),bizagi.debug("Get file metadata '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},checkOutFile:function(e){var t=e.extra||{};return t.action="checkOutFile",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},cancelCheckOut:function(e){var t=e.extra||{};return t.action="cancelCheckOut",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},deleteECMFile:function(e){var t=e.extra||{};return t.action="delete",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("delete file'"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMFileContent:function(e){var t=e.extra||{};return t.action="updateECMFileContent",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file content '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMMetadata:function(e){var t=e.extra||{};return t.action="updateECMMetadata",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file meta data '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getFileProperties:function(e){var t=e.extra||{};return t.action="getFileProperties",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Get file properties '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},getFile:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"fileContent",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.contexttype&&(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?r:$.ajax({url:e.url||t,data:$.param(r),type:"GET",dataType:"binary",processData:!1})},getAllDocuments:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),r={};return r.contextXpath=e.xpathContext,r.xpathAttribute=e.xpath,r.idCase=e.idCase,r.idWorkItem=e.idWorkItem,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?r:$.ajax({url:e.url||t,data:$.param(r),type:"GET",dataType:"binary",processData:!1})},getUploadFileEntity:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.prepare?r:$.ajax({url:e.url||t,data:$.param(r),type:"GET",dataType:"binary",processData:!1})},uploadECMFile:function(e){var t=e.extra||{};return t.action="uploadECMFile",t.fileUpload=e.fileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.fileName=e.fileName,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Upload ECM file '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getECMFileUrl:function(e){var t=e.url||this.serviceLocator.getUrl("render-ecm-upload-url")+"File",r=e.extra||{};return r.action="viewECMFile",r.idFileUpload=e.idFileUpload,r.xPath=e.xPath,r.idAttrib=e.idAttrib,r.fileName=e.fileName,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r.xpathContext=e.xpathContext,e.sessionId&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.p_sessionId&&(r.p_sessionId=e.p_sessionId),bizagi.debug("View uploaded file '"+e.xPath+"'",r),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)+"&xsrf="+bizagi.getXSRFToken()},isFileOnECM:function(e){var t={action:"isFileOnECM"};return t.idUpload=e.idUpload,$.read(this.serviceLocator.getUrl("render-ecm-upload-url"),t)},editGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EDITRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending edit request for relation '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-edit-url"),data:t,type:"POST",dataType:"json",serviceType:"EDITRELATION"})},addGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Sending add request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATION"})},addGridRecordData:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATIONWITHDATA",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype);var r=this.processDataValues(e.submitData||{});for(key in r)t[key]=r[key];return bizagi.debug("Sending add request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATIONWITHDATA"})},saveGridRecord:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disableServerGridValidations"]=e.disableServerGridValidations||!1,e.submitData.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var r=e.submitData||{};for(key in r=this.processDataValues(r))t[key]=r[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVERELATION"})},deleteGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending delete request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"REMOVERELATION"})},getFlipAssociation:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.id,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="flipped",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"flipstate"]=e.flipstate,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending request for flip association control '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:"text"}).pipe((function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}}))},rollbackGridAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ROLLBACK",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-rollback-url"),data:t,type:"POST",dataType:"json",serviceType:"ROLLBACK"})},getSearchDefaultImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-search-default-image")},processDataCriteria:function(e){var t;for(t in e=$.extend(!0,[],e))e.hasOwnProperty(t)&&e[t].hasOwnProperty("value")&&"object"==$.type(e[t].value)&&e[t].value.hasOwnProperty("id")&&e[t].value.hasOwnProperty("label")&&(e[t].value=e[t].value.id);return e},submitSearch:function(e){var t,r=e.extra||{},i=e.sort&&""!==e.sort?e.sort:"";return e.order&&""!==e.order&&""!==i&&(i+=" "+e.order),r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHENTITYFORRENDER",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=i,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"pageSize"]=e.rows,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,t=this.processDataCriteria(e.criteria),r[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchCriteria"]=JSON.encode(t),e.allowFullSearch&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"allowFullSearch"]=e.allowFullSearch),e.maxRecords&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxRowsAllowed"]=e.maxRecords),bizagi.debug("Performing advanced search",r),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-search-advanced-url"),data:r,type:"POST",dataType:"json",serviceType:"SEARCHENTITYFORRENDER"})},associateStakeholder:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey,t.associatedUser=e.associatedUser,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity,bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:e.dataType||"json"})},refreshAssociateStakeholder:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getLetterNotEditableUrl:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache;var r=e.url||this.serviceLocator.getUrl("render-letter-notEditable-url");return this.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(t)},getLetterContent:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-letter-content-url"),data:t,type:"POST",dataType:"html"}).pipe((function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}}))},getCanGenerateLetter:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CANGENERATELETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:this.serviceLocator.getUrl("render-letter-content-url"),data:t,type:"POST",dataType:"json"})},saveLetterContent:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="UPDATELETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache;var r=e.content||"",i=(e.url||this.serviceLocator.getUrl("render-letter-save-url"))+"?"+jQuery.param(t);return bizagi.debug("Save request for letter sent to: "+i,r),e.prepare?t:$.ajax({url:i,data:r,type:"POST",dataType:"html"})},getLetterEditorIconsPath:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-letter-content-icons")},executeButton:function(e){return this.getPropertyData($.extend(e,{property:"buttonRule"}))},getFilePrint:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="data",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?r:$.ajax({url:e.url||t,data:$.param(r),type:"GET",dataType:"binary",processData:!1})},editLinkForm:function(e){return this.editGridRecord(e)},saveLinkForm:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVEFORMLINKRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.submitData.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var r=e.submitData||{};for(key in r=this.processDataValues(r))t[key]=r[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVEFORMLINKRELATION"})},rollbackLinkForm:function(e){return this.rollbackGridAction(e)},commitLinkForm:function(e){return this.commitGridAction(e)},sendCheckpoint:function(e){return this.sendCheckpointAction(e)},getUserfieldDefinition:function(e){return e=e||{},this.userfieldRequests[e.userfield]?this.userfieldRequests[e.userfield]:(this.userfieldRequests[e.userfield]=$.read(this.serviceLocator.getUrl("render-userfield-definition"),{guidUserfield:e.userfield,device:e.device||"desktop"}),this.userfieldRequests[e.userfield])},refreshControl:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESH",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"PARTIALREFRESH"})},refreshGridCell:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESHGRIDCELL",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidcolumn"]=e.column,e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.typeRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"typeRender"]=e.typeRender),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json"})},executeRule:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTERULE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidrule"]=e.rule||"",e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeInterface:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEINTERFACE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidinterface"]=e.interface||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeSAPConnector:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTESAP",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidsap"]=e.guidsap||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeConnector:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTECONNECTOR",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidConnector"]=e.guidConnector||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executePipeline:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEPIPELINE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidpipeline"]=e.pipeline||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},generateDocumentTemplate:function(e){return(e=e||{}).append=!!e.append&&e.append,$.create(this.serviceLocator.getUrl("render-document-generate"),{h_pageCacheId:e.idPageCache,contextXpath:e.xpathcontext,groupMappingId:e.groupMapping,xpathAttribute:e.xpath,append:e.append,controlId:e.id})},getAllDocumentsDownloadUrl:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),r={};return r.h_pageCacheId=e.idPageCache,r.contextXpath=e.xpathContext,r.xpathAttribute=e.xpath,r.idCase=e.idCase,r.idWorkItem=e.idWorkItem,r.p_sessionId=e.sessionId,this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)+"&xsrf="+bizagi.getXSRFToken()},getCaseNumber:function(e){return $.ajax({url:this.serviceLocator.getUrl("case-handler-getCaseSummary").replace("{idCase}",e.idCase)+"?eventAsTasks=false&onlyUserWorkItems=true&mobileDevice="+bizagi.isMobile(),type:"GET",dataType:"json"})},getCaseAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:e.idCase}).pipe((function(e){return e}))},getWorkitems:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getWorkItems"),{idCase:e.idCase,onlyUserWorkItems:e.onlyUserWorkItems||""})},getGridExportFile:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.exportType,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,r[this.Class.BA_ACTION_PARAMETER_PREFIX+"idForm"]=e.idForm,r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?r:$.ajax({url:e.url||t,data:$.param(r),type:"GET",dataType:"binary",processData:!1})},sendEmail:function(e){e=e||{};var t={};if(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"sendEmail",e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_ACTION_PARAMETER_PREFIX+"to"]=e.to,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"subject"]=e.subject,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"message"]=e.message,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"selected"]=JSON.encode(e.selected),e.prepare)return t;var r=e.url||this.serviceLocator.getUrl("form-get-data");return $.create(r,t)},invalidatePageCache:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="INVALIDATEPAGECACHE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:t,type:"POST",dataType:"json",serviceType:"INVALIDATEPAGECACHE"})},getUsersList:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList"),e)},getUsersListFromQueryForm:function(e){return $.read(this.serviceLocator.getUrl("render-query-getUsersList"),e)},getUsersListFromPreferences:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-FromPreferences"),e)},getUsersListForXpathIdBossUser:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForXpathIdBossUser"),e)},getUsersListForXpathIdDelegate:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForXpathIdDelegate"),e)},getUsersListForStakeholders:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForStakeholders"),e)},getUsersForAssignation:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersForAssignation"),e)},getUsersForm:function(e){return $.create(this.serviceLocator.getUrl("admin-usersform"),e)},generateDataToSendByEmail:function(e){return e=e||{},$.ajax({url:this.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:e,type:"POST",dataType:"json"})},sendUserEmail:function(e){(e=e||{}).eMailTo,e.subject,e.body;return $.ajax({url:this.serviceLocator.getUrl("admin-sendUserEmail"),data:e,type:"POST",dataType:"json"})},getConfiguration:function(){var e=this.serviceLocator.getUrl("admin-users-config");return $.read(e)},verifyPathToBase:function(e,t){return-1!=t.indexOf("http")&&""!=e?t:e+t},getTemplate:function(e){var t={};e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADTEMPLATE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]="entity",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guid,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isProcessData"]=e.forcePersonalizedColumns,e.templateType&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"templatetype"]=e.templateType),e.templateGuid&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"templateguid"]=e.templateGuid),null!=e.isDefaultTemplate&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isDefaultTemplate"]=e.isDefaultTemplate);var r=bizagi.util.detectDevice();return bizagi.util.isTabletDevice()?r="tablet":bizagi.util.isSmartphoneDevice()&&(r="mobile"),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=r,e.prepare?t:$.create(this.serviceLocator.getUrl("form-get-data"),t)},hasStartForm:function(e){var t={};return e.guidWFClass&&(t.guidWFClass=e.guidWFClass),$.read(this.serviceLocator.getUrl("render-processes-startform"),t)},getStartForm:function(e){var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADSTARTFORM",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidprocess"]=e.guidprocess,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=!0,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idCase&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idWorkitem&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.additionalXpaths&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.surrogatedKey&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.surrogatedKey),e.recordXpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.mappingstakeholders&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"mappingstakeholders"]=e.mappingstakeholders),$.ajax({url:this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",cache:!0})},editActionForm:function(e){return this.editGridRecord(e)},getActions:function(e){var t=$.extend(e,{prepare:!0}),r=this.getPropertyData(t)||[];return e.ptags&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.pmaxitems&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxitems"]=e.pmaxitems),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},executeActions:function(e){var t=$.extend({},e,{prepare:!0}),r=this.getPropertyData(t)||[];return e.pguidConstructor&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidConstructor"]=e.pguidConstructor),e.pguidAction&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidAction"]=e.pguidAction),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getPolymorphicActions:function(e){var t=$.extend(e,{prepare:!0}),r=this.getPropertyData(t)||[];return e.ptags&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.additionalXpaths&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},serializePolymorphicActions:function(e){var t=[],r=function t(r){r=r||{};var i="";return $.each(e,(function(e,a){a[0]==r[6]&&(i+=t(a)+a[1]+" > ")})),i};return function t(i,a){var s,n=function(t){var r=[];return t=t||"",$.each(e,(function(e,i){i[6]==t&&r.push(i)})),r}(a);return $.each(n,(function(e,a){var n=t([],a[0]);(""!==(s={guidEntity:a[0],displayName:a[1],hasConstructor:!!a[5],type:a[3],guidObject:a[4],guidConstructor:a[5],xpathContext:a[2],children:n,parents:r(a)}).guidConstructor||s.children.length>0)&&i.push(s)})),i}(t,""),t},getEntityImage64:function(e){var t={width:e.data,height:e.height,xpath:e.xpath},r=this.serviceLocator.getUrl("render-entity-layout-image64").replace("{entity}",e.entity).replace("{surrogateKey}",e.surrogateKey);return $.ajax({url:r,data:t})},getFilesDataForLayoutUploadControl:function(e){return $.read(this.serviceLocator.getUrl("render-entity-layout-upload-files"),e)},processUploadFile:function(e){return $.ajax({url:this.verifyMobilePathToBase(bizagi.services.ajax.pathToBase||"",e.url),data:e.formData,type:"POST",contentType:!1,processData:!1})},commitGridAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="COMMIT",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-commit-url"),data:t,type:"POST",dataType:"json",serviceType:"COMMIT"})},sendCheckpointAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CHECKPOINT",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending checkpoint request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-checkpoint-url"),data:t,type:"POST",dataType:"json",serviceType:"CHECKPOINT"})},verifyMobilePathToBase:function(e,t){return bizagi.util.isMashupContext()?(t||"").replaceAll(e,""):t}}),bizagi.render.services.service.extend("bizagi.render.services.service",{},{init:function(e){this._super(e),this.database=e.database,this.gridService=new bizagi.grid.services.service({renderDataService:this,database:e.database}),this.fileService=new bizagi.file.services.service({renderDataService:this,database:e.database}),this.syncService=new bizagi.sync.services.service({renderDataService:this,database:e.database}),this.formService=new bizagi.form.services.service({renderDataService:this,database:e.database})},getFileService:function(){return this.fileService},getSyncService:function(){return this.syncService},getGridService:function(){return this.gridService},getFormService:function(){return this.formService},getFormData:function(e){var t=this;if((e=e||{}).isOfflineForm){if("inactive"==e.workitemstate&&e.online&&!0!==e.alreadyMarkedAsActive&&t._super(e),bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData)return t.getFormDataFromNative(e).then((function(r){return t.database.mergeForm(r[1],r[0].data,{online:e.online})}));if("task"===e.offlineType){if(e.isEdited||!e.isOpen){var r=new $.Deferred;return $.when(t.database.getTaskData(e)).then((function(i){var a=e.syncError||i.syncStatus,s=e.hasSyncError||!bizagi.util.isEmpty(a),n=t.database.getTaskForm(e);$.when(t.database.mergeDataDocument(i.data,n)).done((function(i){var a={data:i,isOpen:e.isOpen};t.database.mergeForm(a,n,{online:e.online,hasSyncError:s}).then((function(e){r.resolve(e)}))}))})),r.promise()}return t.database.getTaskForm(e)}return $.when(t.database.getCase(e.idCase)).then((function(r){var i=$.trim(r.idWfClass.toString());return t.database.mergeForm(r,t.database.getFormData(i),{online:e.online})}))}return t._super(e)},getOfflineImage:function(e,t){return"task"===e.offlineType?this.database.getActivityImage(e,t):this.database.getStartDataImage(e,t)},getOfflineActivityDataImage:function(e,t){return this.database.getActivityDataImage(e,t)},saveOfflineImage:function(e,t){return"synchronization"===e.operationType?this.database.saveActivityFormImage(e,t):"edition"===e.operationType?"task"===e.offlineType?this.database.saveActivityDataImage(e,t):this.database.saveStartDataImage(e,t):null},saveOfflineFile:function(e,t,r){return"synchronization"===e.operationType?this.database.saveActivityFormFile(e,t,r):"edition"===e.operationType?"task"===e.offlineType?this.database.saveActivityDataFile(e,t,r):this.database.saveStartDataFile(e,t,r):null},getOfflineFile:function(e,t,r){return"task"===e.offlineType?this.database.getActivityFile(e,t,r):this.database.getStartDataFile(e,t,r)},getOfflineActivityDataFile:function(e,t,r){return this.database.getActivityDataFile(e,t,r)},getFormDataFromNative:function(e){var t=new $.Deferred;return bizagiapp.getNativeFormData(e,(function(r){bizagiapp.getCase(e.idCase,(function(e){var i=[JSON.parse(r),JSON.parse(e)];t.resolve(i)}),(function(e){t.reject(e)}))}),(function(e){t.reject(e)})),t.promise()},submitData:function(e){if((e=e||{}).isOfflineForm){var t=this.resolveData(e.data||{},e.xpathContext),r=(e.action||"").toLowerCase();return""==r||"save"!=r&&"next"!=r&&"nextwithoutvalidations"!=r&&"submitdata"!=r||(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=r),bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData?this.saveNativeFormInfo(e,t):"task"===e.offlineType?(this.sanityDataForSaveInDB(t),this.database.saveTaskData(e,t)):this.database.saveStartData(e,t)}return this._super(e)},sanityDataForSaveInDB:function(e){delete e.deferreds},saveNativeFormInfo:function(e,t){var r=this,i=new $.Deferred;return r.getFormDataFromNative(e).then((function(a){return r.database.nativesaveStartData(t,a[1],a[0].data).done((function(t){bizagiapp.saveFormData(e,t),i.resolve(t)}))})),i.promise()},removeStartCaseSyncError:function(e){var t,r=this;return r.database.getCase(e.idCase).then((function(i){return i.isOpen=!0,delete i.syncDetails,delete i.syncStatus,t=i,r.database.saveStartCase(e.idCase,i)})).then((function(){return t}))},removeTaskCaseSyncError:function(e){var t,r=this,i=e.idCase+"-"+e.idWorkitem;return r.database.getTask(i).then((function(e){return e.isOpen=!0,e.isEdited=!0,delete e.syncDetails,delete e.syncStatus,t=e,r.database.saveTask(i,e)})).then((function(){return r.database.getTaskData(e)})).then((function(t){return t&&null!=t.data&&(t.data.h_action="",delete t.data.retry_h_actions,delete t.data.actions),r.database.saveTaskData(e,t.data)})).then((function(){return t}))},parseServiceError:function(e){var t,r={};if(null!=e){if(e.responseText)t=e.responseText;else if(1!=e.length||e[0].responseText)if(e.length>0&&e[0]&&e[0].responseText)t=e[0].responseText;else if(3==e.length){for(var i=e[2];null!=i&&i.error;)i=i.error;i.errorType?r=i:(r.type="error",r.errorType=e[1],r.message=e[2])}else try{t=JSON.stringify(e)}catch(e){}else r=e[0];if(null!=t)try{r=JSON.parse(t)}catch(e){r.type="error",r.errorType="parsingError",r.message="Error parsing the server response: "+t}return r}}}),bizagi.file=bizagi.file||{},bizagi.file.services=bizagi.file.services||{},bizagi.file.services.service||$.Class.extend("bizagi.file.services.service",{loaders:{},isLoading:function(e){return this.loaders[e]||!1},setLoading:function(e,t,r,i){var a=this.internalBuildOfflineFileLoadingKey(e,t,r,i);this.loaders[a]=!0},clearLoading:function(e,t,r,i){var a=this.internalBuildOfflineFileLoadingKey(e,t,r,i);this.loaders[a]=!1},internalBuildOfflineFileLoadingKey:function(e,t,r,i){var a="case:"+e;return bizagi.util.isEmpty(t)||(a+="-"+t),a+="::",a+="xpath:",bizagi.util.isEmpty(r)||(a+=r+"."),a+=i}},{EMPTY_IMAGE:"R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",init:function(e){this.renderDataService=e.renderDataService,this.database=e.database},isLoading:function(e){return this.Class.isLoading(this.buildOfflineFileLoadingKey(e))},buildOfflineFileLoadingKey:function(e){var t=e.getFormContainer(),r=t.getParams().idCase,i=t.getParams().idWorkitem;return this.Class.internalBuildOfflineFileLoadingKey(r,i,e.properties.xpathContext,e.properties.xpath)},downloadFormImages:function(e,t){var r=this,i=r.database.filterXpathsByTypeMap(e,{image:!0,columnImage:!0,signature:!0}),a=[];return i.forEach((function(i){var s=r.buildOfflineImageId(i.value,i.xpathContext,i.xpath);t.localFiles[s]||a.push(r.downloadImage(t,e.form,i))})),a},downloadImage:function(e,t,r){var i=t.properties.compatibilityVersion>=2;if(i&&bizagi.util.isEmpty(r.value))return $.Deferred().resolve(null).promise();var a={xpath:r.xpath,idRender:r.renderId,xpathContext:r.xpathContext||"",idPageCache:t.pageCacheId,sessionId:t.sessionId,property:i?"fileBinaryContent":"fileFullContent"};return i?this.downloadImageVersion2(e,a,t,r):this.downloadImageVersion1(e,a,t,r)},downloadImageVersion2:function(e,t,r,i){var a=this;return a.Class.setLoading(e.idCase,e.idWorkitem,i.xpathContext,i.xpath),t.queue=e.bulkDownload?"offlineimages":void 0,a.renderDataService.downloadFile(t).then((function(t){return t.name=i.xpath,e.operationType="synchronization",e.id=a.buildOfflineImageId(i.value,i.xpathContext,i.xpath),a.database.saveActivityFormImage(e,t,t.type)})).then((function(){if(!e.bulkDownload)return a.ensureImageIsPersistedLocally(e)})).always((function(){a.Class.clearLoading(e.idCase,e.idWorkitem,i.xpathContext,i.xpath)}))},ensureImageIsPersistedLocally:function(e,t){var r=this;if(0==(t=t||3))return console.log("downloadImageVersion2::image not found after 3 retries '"+e.id+"'",e),$.Deferred().resolve().promise();var i={idCase:e.idCase,idWorkitem:e.idWorkitem,id:e.id,offlineType:"task",loadImageFromForm:!1},a=!1;return r.renderDataService.getOfflineImage(i,bizagi.util.db.AttachmentType.Blob).then((function(e){if(null==e)return a=!0,bizagi.util.sleepFor(200)})).then((function(){if(a)return r.ensureImageIsPersistedLocally(e,t-1)}))},downloadImageVersion1:function(e,t,r,i){var a=this;return a.Class.setLoading(e.idCase,e.idWorkitem,i.xpathContext,i.xpath),a.renderDataService.multiaction().getPropertyData(t).then((function(t){if(null!=t){var r={id:i.xpathContext?i.xpathContext+"."+i.xpath:i.xpath,idCase:e.idCase,idWorkitem:e.idWorkitem,operationType:"synchronization"};return a.database.saveActivityFormImage(r,t)}})).always((function(){a.Class.clearLoading(e.idCase,e.idWorkitem,i.xpathContext,i.xpath)}))},downloadFormFiles:function(e,t){var r=this,i={},a=[];return r.database.filterXpathsByTypeMap(e,{upload:!0,columnUpload:!0}).forEach((function(s){var n=r.downloadFilesInUploadControl(t,e,s);Array.prototype.push.apply(a,n),"columnUpload"!==s.type&&(i[s.xpath]=r.database.convertUploadOnlineValueInOfflineValue(s.value))})),{data:i,promises:a}},downloadFilesInUploadControl:function(e,t,r){var i=this,a=[];return r.value&&Array.isArray(r.value)&&r.value.forEach((function(s){var n=s[0],o=s[1],l=(r.xpathContext?r.xpathContext+".":"")+r.xpath+"."+n;e.localFiles[l]||a.push(i.downloadSingleFile(e,t,r,n,o,l))})),a},downloadSingleFile:function(e,t,r,i,a,s){var n=this;return n.downloadBinaryFile(e,t,r,i,a).then((function(t){t&&(e.operationType="synchronization",e.id=s,n.renderDataService.saveOfflineFile(e,t,t.type))}))},downloadBinaryFile:function(e,t,r,i,a){var s={xpath:r.xpath,idRender:r.renderId,xpathContext:r.xpathContext||"",idPageCache:t.form.pageCacheId,fileId:i,sessionId:t.form.sessionId,queue:e.bulkDownload?"offlinefiles":void 0};return this.renderDataService.downloadFile(s).then((function(e){return e.name=a,e}))},uploadFormImages:function(e,t){var r=this,i=[];return t.forEach((function(t){var a=t.value;a&&($.extend(e,t),i.push(r.uploadImage(e,a)))})),i},uploadFormGridImages:function(e,t,r){for(var i=Object.keys(t),a=[],s=0;s<i.length;s++)for(var n=t[i[s]],o=Object.keys(n),l=0;l<o.length;l++)if("isNew"!=o[l]){var c=n[o[l]];if(n.isNew){var d=r[i[s]];if(void 0===d)continue;c.xpathContext=c.gridXpath+this.database.buildCellXpathFilter(d)}else c.xpathContext=c.gridXpath+this.database.buildCellXpathFilter(i[s]);if(!c)continue;c.columnXpath&&(e.xpath=c.columnXpath),uploadParams=$.extend({},e,c),a.push(this.uploadImage(uploadParams,c))}return a},uploadImage:function(e,t){var r=this,i=r.buildAddParamsForUpload(e,"savefile"),a=bizagi.util.isEmpty(t.name)?"offlineImage_"+bizagi.util.randomNumber()+".png":t.name,s=e.xpath,n=r.renderDataService.getUploadAddFileUrl(!1),o=new FormData;return $.each(i,(function(e,t){o.append(e,t)})),r.renderDataService.getOfflineImage({idCase:e.idCase,idWorkitem:e.idWorkitem,id:t.offlineId,offlineType:e.offlineType,loadImageFromForm:!1},bizagi.util.db.AttachmentType.Blob).then((function(i){return t.isSignature&&null==i&&(i=bizagi.util.b64toBlob(r.EMPTY_IMAGE,"image/png")),i?(o.append(s,i,a),$.ajax({url:n,type:"POST",contentType:!1,processData:!1,data:o})):(bizagi.util.console.error("UploadImage:: Missing local file",e,t.offlineId),$.Deferred().reject({type:"error",errorType:"offlineUploadFileError",message:"Missing local file "+t.offlineId}).promise())})).then((function(t){return t.type&&"error"===t.type?(bizagi.util.console.error("UploadImage:: Server returned error",e,t),$.Deferred().reject(t).promise()):(bizagi.util.console.log("Image uploaded",t,s,a),t)})).fail((function(e){bizagi.util.console.error("UploadImage:: fail",e)}))},uploadAndDeleteFormFiles:function(e,t,r){var i=this,a=[];return t.forEach((function(t){Array.prototype.push.apply(a,i.uploadAndDeleteFiles(e,t,r))})),a},uploadFormGridFiles:function(e,t,r,i){for(var a=[],s=Object.keys(t),n=0;n<s.length;n++)for(var o=t[s[n]],l=Object.keys(o),c=0;c<l.length;c++)if("isNew"!=l[c]){var d=o[l[c]];if(o.isNew){var u=r[s[n]];if(void 0===u)continue;d.xpathContext=d.gridXpath+this.database.buildCellXpathFilter(u)}else d.xpathContext=d.gridXpath+this.database.buildCellXpathFilter(s[n]);Array.prototype.push.apply(a,this.uploadAndDeleteFiles(e,d,i))}return a},uploadAndDeleteFiles:function(e,t,r){var i=[],a=this,s=t.value;if(s&&0!=s.length)return s.forEach((function(s){var n=s.status;if("new"===n){var o={fileId:s.id,fileName:s.fileName,fileMimeType:s.mimeType};$.extend(o,e),i.push(a.uploadFile(o,t))}else if("deleted"===n){var l={renderId:t.renderId,xpath:t.xpath,fileId:s.id,idPageCache:e.pageCacheId};t.columnXpath&&(l.xpath=t.columnXpath,l.xpathContext=t.xpathContext);var c=a.deleteFile(l);r.push(c)}})),i},uploadFile:function(e,t){var r=this,i=t.xpath;if(t.columnXpath){i=t.columnXpath;var a=(t.xpathContext?t.xpathContext+".":"")+i+"."+e.fileId;t.isNew&&t.fullXpath&&(a=t.fullXpath+"."+e.fileId)}else a=i+"."+e.fileId;return r.getOfflineFile(e,a).then((function(s){if(s){var n={xpath:i,renderId:t.renderId,pageCacheId:e.pageCacheId,sessionId:e.sessionId,fileName:e.fileName,xpathContext:t.xpathContext};return r.uploadBinaryFile(n,s)}return bizagi.util.console.error("UploadFile:: Missing local file",e,a),$.Deferred().reject({type:"error",errorType:"offlineUploadFileError",message:"Missing local file "+a}).promise()}))},uploadBinaryFile:function(e,t){var r=this.buildAddParamsForUpload(e,"addfile"),i=new FormData;return $.each(r,(function(e,t){i.append(e,t)})),i.append(e.xpath,t,e.fileName),this.renderDataService.processUploadFile({url:this.renderDataService.getUploadAddUrl(),formData:i}).then((function(t){return t.type&&"error"===t.type?(bizagi.util.console.error("UploadBinaryFile:: Server returned error",e,t),$.Deferred().reject(t).promise()):(bizagi.util.console.log("File uploaded",t,e.xpath,e.fileName),t)}))},getOfflineFile:function(e,t){var r=e.offlineType,i={id:t,idCase:e.idCase};return r&&"start"===r?(i.offlineType=e.offlineType,this.renderDataService.getOfflineFile(i,bizagi.util.db.AttachmentType.Blob,e.fileMimeType)):(i.idWorkitem=e.idWorkitem,this.renderDataService.getOfflineActivityDataFile(i,bizagi.util.db.AttachmentType.Blob,e.fileMimeType))},deleteFile:function(e){var t=e.fileId,r={xpath:e.xpath+(bizagi.util.isNumeric(t)?"[id="+t+"]":"[id='"+t+"']"),idRender:e.renderId,xpathContext:e.xpathContext||"",idPageCache:e.idPageCache,prepare:!0};return this.renderDataService.deleteUploadFile(r)},buildOfflineImageId:function(e,t,r,i,a){i=i||void 0===i,bizagi.util.isEmptyValue(e)&&(e=null),e=bizagi.util.isArray(e)&&bizagi.util.isArray(e[0])?e[0][1]:e;var s=(t?t+".":"")+r;return!i||bizagi.util.isEmpty(e)||a||(s+="."+e),s},getOfflineImageName:function(e,t){bizagi.util.isEmptyValue(e)&&(e=null);var r=bizagi.util.isArray(e)&&bizagi.util.isArray(e[0])?e[0][1]:null;return t&&(r="offlineImage_"+bizagi.util.randomNumber()+".png"),r},changeOfflineImageName:function(e,t){bizagi.util.isEmptyValue(e)||bizagi.util.isArray(e)&&bizagi.util.isArray(e[0])&&(e[0][1]=t)},resolveBlobFromPath:function(e,t){var r=new $.Deferred;if(bizagi.util.isCordovaSupported()){e=bizagi.util.isAndroidDevice()?bizagi.util.media.getImagePath(e):bizagi.util.media.normalizeIOSFilePath(e);var i=function(e){bizagi.util.console.error("Error converting path to blob",e),r.reject(e)};window.resolveLocalFileSystemURL(e,(function(e){e.file((function(e){var i=new FileReader;i.onloadend=function(){var i=new Blob([this.result],{type:e.type});i.name=t,r.resolve(i)},i.readAsArrayBuffer(e)}),i)}),i)}else r.resolve(e);return r},buildAddParamsForUpload:function(e,t){var r={};r.h_xpath=e.xpath,r.h_idRender=e.renderId,r.h_xpathContext=e.xpathContext||"",r.h_pageCacheId=e.pageCacheId,r.p_sessionId=e.sessionId,r.h_action=t;try{null!=BIZAGI_SESSION_NAME?r[BIZAGI_SESSION_NAME]=e.sessionId:r.JSESSIONID=e.sessionId}catch(t){r.JSESSIONID=e.sessionId}return r.queueID="q_"+bizagi.util.encodeXpath(e.xpath),r}}),bizagi.sync=bizagi.sync||{},bizagi.sync.services=bizagi.sync.services||{},bizagi.sync.services.service=bizagi.sync.services.service||{},$.Class.extend("bizagi.sync.services.service",{logKey:"OFFLINE SYNC TRACES::",syncTraces:{},getCurrentSyncStep:function(e){return this.syncTraces[e]?this.syncTraces[e].currentStep:null},setCurrentSyncStep:function(e,t,r){var i=this.syncTraces[e]||{},a=!bizagi.util.isEmpty(i);i.currentStep=t,i.steps=i.steps||[],i.steps.push({step:t,stepParameters:r}),a||(this.syncTraces[e]=i)},addSyncStepResponse:function(e,t,r){var i=this.syncTraces[e];if(bizagi.util.isEmpty(i))console.error("OFFLINE SYNC TRACES::addCurrentSyncStepResponse:: Sync trace does not exist",e);else{null==i.steps&&(i.steps=[]);var a=i.steps.find((function(e){return e.step==t}));bizagi.util.isEmpty(a)&&(console.warn("OFFLINE SYNC TRACES::addCurrentSyncStepResponse:: step "+t+" does not exist",t),a={step:"not-found-"+bizagi.util.randomNumber()+"-"+t},i.steps.push(a)),a.stepResponse=r}},addCurrentSyncStepResponse:function(e,t){var r=this.syncTraces[e];bizagi.util.isEmpty(r)?console.error("OFFLINE SYNC TRACES::addCurrentSyncStepResponse:: Sync trace does not exist",e):this.addSyncStepResponse(e,r.currentStep,t)},clearTrace:function(e){this.syncTraces[e]&&delete this.syncTraces[e].steps},printTrace:function(e){var t=this.syncTraces[e],r=this.logKey+"TRACE::"+e+"::";bizagi.util.isEmpty(t)||(bizagi.util.console.log(r+" ** TRACE START **",""),bizagi.util.console.log(r+"LAST STEP:: "+t.currentStep,""),(t.steps||[]).forEach((function(e,t){bizagi.util.console.log(r+(t+1)+"::"+e.step+":: params",e.stepParameters),bizagi.util.console.log(r+(t+1)+"::"+e.step+":: response",e.stepResponse)})),bizagi.util.console.log(r+" ** TRACE END **",""))},printAndClearTrace:function(e){var t=this;setTimeout((function(){t.printTrace(e),t.clearTrace(e)}),1e3)}},{init:function(e){this.renderDataService=e.renderDataService,this.database=e.database,this.fileService=this.renderDataService.getFileService(),this.gridService=this.renderDataService.getGridService()},syncOfflineStartCase:function(e){var t,r=this,i=e.id||e.idCase,a={action:"LOADSTARTFORM",idProcess:e.idProcess,downloadOfflineForm:!0};return bizagi.util.console.log("SYNCHRONIZING Start Case",e),r.Class.setCurrentSyncStep(i,"getFormData",e),r.renderDataService.getFormData(a).then((function(a){return t=a,r.Class.addCurrentSyncStepResponse(i,a),a.errorType?$.Deferred().reject(a).promise():a.form?(r.Class.setCurrentSyncStep(i,"separateComplexControls",{data:e.data}),r.database.separateComplexControls({offlineType:"start"},e.data)):$.Deferred().reject("Form not found in server response").promise()})).then((function(a){return r.Class.addCurrentSyncStepResponse(i,a),e.pageCacheId=t.form.pageCacheId,e.sessionId=t.form.sessionId,e.formId=t.form.properties.id,e.offlineType="start",r.performSyncOfflineCase(e,a)})).then((function(e){return r.Class.clearTrace(i),e})).fail((function(e){return r.Class.addCurrentSyncStepResponse(i,e),r.Class.printAndClearTrace(i),bizagi.util.console.error("START case sync failed",e),r.updateSyncStatusError(e,"start",i)}))},syncOfflineTaskCase:function(e){var t,r=this,i=e.data;delete e.data;var a=e.idCase+"-"+e.idWorkitem;return e.downloadOfflineForm=!0,bizagi.util.console.log("SYNCHRONIZING Task Case",e),r.Class.setCurrentSyncStep(a,"getFormData",e),r.renderDataService.getFormData(e).then((function(s){return t=s,r.Class.addCurrentSyncStepResponse(a,s),s.errorType?$.Deferred().reject(s).promise():s.form?(r.Class.setCurrentSyncStep(a,"separateComplexControls",{params:e,data:i}),r.database.separateComplexControls(e,i)):$.Deferred().reject("Form not found in server response").promise()})).then((function(i){return r.Class.addCurrentSyncStepResponse(a,i),e.pageCacheId=t.form.pageCacheId,e.sessionId=t.form.sessionId,e.offlineType="task",e.formId=t.form.properties.id,e.id=a,r.performSyncOfflineCase(e,i)})).then((function(e){return r.Class.clearTrace(a),e})).fail((function(e){return r.Class.addCurrentSyncStepResponse(a,e),r.Class.printAndClearTrace(a),r.updateSyncStatusError(e,"task",a)}))},performSyncOfflineCase:function(e,t){var r,i=this,a=[],s=[];return e.gridPromises=null,i.Class.setCurrentSyncStep(e.id,"checkpoint",e),i.createCheckpoint(e).then((function(r){return i.Class.addCurrentSyncStepResponse(e.id,r),i.processGridRecords(e,t,a,s)})).then((function(n){return r=i.parseGridAdditionsResponse(a,n),i.Class.addCurrentSyncStepResponse(e.id,{gridActionsResponse:n,entityMap:r}),i.processUploads(e,t,r,s)})).then((function(a){return i.Class.addSyncStepResponse(e.id,"uploadPromises",a),i.processMultiAction(e,t.data,r,s)})).then((function(t){return i.Class.addSyncStepResponse(e.id,"multiaction",t),t})).fail((function(t){i.Class.addCurrentSyncStepResponse(e.id,t);var r=i.Class.getCurrentSyncStep(e.id);return i.manageError(e,t,r,arguments)}))},processGridRecords:function(e,t,r,i){var a=t.grids;return a&&(e.gridPromises=gridPromises=this.gridService.uploadGridData(a,e.pageCacheId),gridPromises.bizAdditions&&gridPromises.bizAdditions.length>0&&Array.prototype.push.apply(r,gridPromises.bizAdditions),gridPromises.bizDeletions&&gridPromises.bizDeletions.length>0&&Array.prototype.push.apply(i,gridPromises.bizDeletions)),this.Class.setCurrentSyncStep(e.id,"multiaction grid",{gridVallues:a,gridActions:r}),this.renderDataService.multiaction().execute({actions:r})},parseGridAdditionsResponse:function(e,t){var r={};if(void 0!==e&&e.length>0)for(var i=0;i<e.length;i++)t[i]&&"success"===t[i].result.type&&(r[e[i]["offline-entityId"]]=t[i].result.IdEntity);return r},processUploads:function(e,t,r,i){var a=[],s=t.images,n=t.uploads;this.Class.setCurrentSyncStep(e.id,"uploadPromises",{imageValues:s,uploadValues:n});try{n&&n.length>0&&Array.prototype.push.apply(a,this.fileService.uploadAndDeleteFormFiles(e,n,i)),s&&s.length>0&&Array.prototype.push.apply(a,this.fileService.uploadFormImages(e,s));var o=e.gridPromises;o&&(Object.keys(o.bizImages).length>0&&Array.prototype.push.apply(a,this.fileService.uploadFormGridImages(e,o.bizImages,r,i)),Object.keys(o.bizFiles).length>0&&Array.prototype.push.apply(a,this.fileService.uploadFormGridFiles(e,o.bizFiles,r,i)))}catch(e){return $.Deferred().reject(e).promise()}return $.when.apply($,a)},processMultiAction:function(e,t,r,i){var a,s,n,o,l=this,c=e.offlineType,d=l.getSyncAction(c,t),u=null!=d&&d.length>0&&d.toLowerCase().includes("next"),p=(i=l.prepareMultiActionData(e,t,r,d,i),"multiaction");return l.Class.setCurrentSyncStep(e.id,p,i),l.renderDataService.multiaction().execute({actions:i}).then((function(t){return l.Class.addSyncStepResponse(e.id,"multiaction",t),s=t,o=l.wasMultiActionPerformed(t),a=t[t.length-1].result,o?(p="commit-multiaction",l.Class.setCurrentSyncStep(e.id,"commit-multiaction"),l.performCommit(e,u)):$.Deferred().reject(t).promise()})).then((function(t){return n=t,l.Class.addSyncStepResponse(e.id,"commit-multiaction",t),l.deleteOfflineCase(e,o,u)})).then((function(){return o?(null!=n&&null!=n.DataChangesetVersion&&(a.DataChangesetVersion=n.DataChangesetVersion),a.containsNext=$.grep(i,(function(e){return e.h_action.toLowerCase().includes("next")})).length>0,a):$.Deferred().reject(s).promise()})).fail((function(t){l.Class.addCurrentSyncStepResponse(e.id,t);var r="multiaction"==p&&!e.isRetry;return l.performRollback(e,t,r)}))},prepareMultiActionData:function(e,t,r,i,a){var s=this.convertStartFormDataToStandardFormat(t),n=!1;this.replaceGridChangesWithAddedRows(s,r);var o=this.addButtonActions(e,s);null!==o&&o.length>0&&(Array.prototype.push.apply(a,o),n=!0);var l=this.addTrySaveOrTryNextAction(e,i,s,n);return bizagi.util.isEmpty(l)||a.push(l),a},replaceGridChangesWithAddedRows:function(e,t){bizagi.util.isEmpty(e)||Object.keys(e).forEach((function(r){var i=r.match(/\[id=(\d+)\]/);if(i){var a=i[1],s=t[a];if(void 0!==t[a]){var n=r,o=r.replace(a,s);e[o]=e[n],delete e[n]}}}))},addButtonActions:function(e,t){var r=[];if(bizagi.util.isEmpty(t))return[];var i=e.isRetry&&t.retry_h_actions?t.retry_h_actions:t.h_actions;if(delete t.h_actions,delete t.retry_h_actions,!Array.isArray(i)||i.length<1)return[];var a=this.renderDataService.submitData({action:"SUBMITDATA",data:t,idPageCache:e.pageCacheId,prepare:!0});return a.tag="submitData",r.push(a),i.forEach((function(t){t&&(t.h_pageCacheId=e.pageCacheId,r.push(t))})),r},addTrySaveOrTryNextAction:function(e,t,r,i){if(!bizagi.util.isEmpty(t)){actionParams={action:t,idPageCache:e.pageCacheId,prepare:!0,transitions:""},i||(actionParams.data=r);var a=this.renderDataService.submitData(actionParams);return a.tag="performAction",a}return null},deleteOfflineCase:function(e,t,r){var i=this,a=e.offlineType;return"start"===a?(i.Class.setCurrentSyncStep(e.id,"deleteStartCase",{params:e}),i.database.deleteCase(e).then((function(t){return i.Class.addSyncStepResponse(e.id,"deleteStartCase",t),t}))):(i.Class.setCurrentSyncStep(e.id,"removeSyncStatus",{params:!1}),i.database.updateCaseSyncStatus({type:a,id:e.id,syncStatus:void 0,syncDetails:void 0}).then((function(t){return i.Class.addSyncStepResponse(e.id,"removeSyncStatus",t),i.Class.setCurrentSyncStep(e.id,"updateTaskIsEdited",{params:!1}),i.database.updateTaskIsEdited(e.id,!1)})).then((function(t){i.Class.addSyncStepResponse(e.id,"updateTaskIsEdited",t);var a=r?$.extend({deleteAttachments:!0},e):e;return i.Class.setCurrentSyncStep(e.id,"deleteTaskData",{deleteTaskDataParams:a}),i.database.deleteTaskData(a)})).then((function(s){if(i.Class.addSyncStepResponse(e.id,"deleteTaskData",s),"task"===a&&t&&r)return i.Class.setCurrentSyncStep(e.id,"deleteTaskForm",{params:e}),i.database.deleteTaskForm(e);i.Class.setCurrentSyncStep(e.id,"deleteTaskForm","--skipped--")})).then((function(s){return i.Class.addSyncStepResponse(e.id,"deleteTaskForm",s),"task"===a&&t&&r?(i.Class.setCurrentSyncStep(e.id,"deleteTaskIfNext",{params:e}),i.database.deleteTask(e)):(i.Class.setCurrentSyncStep(e.id,"deleteTaskIfNext","--skipped--"),s)})).then((function(t){return i.Class.addSyncStepResponse(e.id,"deleteTaskIfNext",t),t})).fail((function(t){var r={type:"error",errorType:"offlineSyncError",message:"Local case could not be deleted",details:t};return i.Class.addCurrentSyncStepResponse(e.id,r),$.Deferred().reject(r).promise()})))},convertStartFormDataToStandardFormat:function(e){var t={};return Object.keys(e).forEach((function(r){t[r]=e[r],void 0!==e[r].value&&(t[r]=e[r].value)})),t},getSyncAction:function(e,t){return"start"===e?"createnewcase":"save"===t.h_action?"trysave":"next"===t.h_action?"trynext":t.h_action},wasMultiActionPerformed:function(e){return e.length>0&&e[e.length-1].result&&"success"===e[e.length-1].result.type},createCheckpoint:function(e){return this.renderDataService.sendCheckpoint({idRender:e.formId,xpath:"",xpathContext:"",idPageCache:e.pageCacheId})},performCommit:function(e,t){return t?$.Deferred().resolve(null).promise():this.renderDataService.commitGridAction({idRender:e.formId,xpath:"",xpathContext:"",idPageCache:e.pageCacheId})},manageError:function(e,t,r,i){var a=this;return"checkpoint"!=r?(t=Array.isArray(t)?t.map((function(e){return a.renderDataService.parseServiceError(e)})):a.renderDataService.parseServiceError(i),a.performRollback(e,t)):a.updateSyncStatusError(i,e.offlineType,e.id)},performRollback:function(e,t,r){var i=this;return i.Class.setCurrentSyncStep(e.id,"rollback",{params:e,error:t,cleanTaskDataActions:r}),i.renderDataService.rollbackGridAction({idRender:e.formId,xpath:"",xpathContext:"",idPageCache:e.pageCacheId}).always((function(t){if(i.Class.addCurrentSyncStepResponse(e.id,t),r)return i.Class.setCurrentSyncStep(e.id,"cleanTaskDataActions",{id:e.id}),i.database.cleanTaskDataActions(e.id);i.Class.setCurrentSyncStep(e.id,"cleanTaskDataActions","--skipped--")})).then((function(t){if(i.Class.addSyncStepResponse(e.id,"cleanTaskDataActions",t),"start"!=e.offlineType)return i.Class.setCurrentSyncStep(e.id,"openOfflineTask",{id:e.id}),i.database.openOfflineTask(e.id);i.Class.setCurrentSyncStep(e.id,"openOfflineTask","--skipped--")})).then((function(r){return i.Class.addSyncStepResponse(e.id,"openOfflineTask",r),$.Deferred().reject(t).promise()}))},updateSyncStatusError:function(e,t,r){var i=this.renderDataService.parseServiceError(e)||{},a=this.buildSyncErrorObject(i);return this.database.updateCaseSyncStatus({type:t,id:r,syncStatus:"failed",syncDetails:a}).then((function(){return $.Deferred().reject(i).promise()}))},buildSyncErrorObject:function(e){var t="technical",r=[],i=e;if(Array.isArray(e))e.forEach((function(e){null!=e.result&&((e.result.type||"").toLowerCase().includes("message")&&(t="business",e.result.message&&r.push(e.result.message),Array.isArray(e.result.messages)&&(r=r.concat(e.result.messages))))}));else if(null!=e&&null!=e.result){(e.result.type||"").toLowerCase().includes("message")&&(t="business",e.result.message&&r.push(e.result.message),Array.isArray(e.result.messages)&&(r=r.concat(e.result.messages)))}else e.message&&r.push(e.message);return{type:t,message:1==r.length?r[0]:r,actionResponse:i,timestamp:Date.now()}}}),bizagi.grid=bizagi.grid||{},bizagi.grid.services=bizagi.grid.services||{},bizagi.grid.services.service=bizagi.grid.services.service||{},$.Class.extend("bizagi.grid.services.service",{},{init:function(e){this.renderDataService=e.renderDataService,this.database=e.database},uploadGridData:function(e,t){var r=this,i={bizAdditions:[],bizDeletions:[],bizImages:{},bizFiles:{}};return e.forEach((function(e){Array.prototype.push.apply(i.bizAdditions,r.processNewRecords(e,t)),Array.prototype.push.apply(i.bizDeletions,r.processDeletedRecords(e,t)),$.extend(i.bizImages,r.processImages(e)),$.extend(i.bizFiles,r.processFiles(e))})),i},processNewRecords:function(e,t){var r=[],i=e.value["new-records"];if(i)for(var a=Object.keys(i),s=0;s<a.length;s++){var n=i[a[s]];n.idPageCache=t;var o=this.renderDataService.addGridRecordData(n);o["offline-entityId"]=a[s],r.push({actionParams:o,creationTimestamp:n.creationTimestamp})}return r.sort((function(e,t){return e.creationTimestamp-t.creationTimestamp})).map((function(e){return e.actionParams}))},processImages:function(e){var t={};if(e.value["edited-images"])for(var r=Object.keys(e.value["edited-images"]),i=0;i<r.length;i++){var a=e.value["edited-images"][r[i]];t[r[i]]=a}return t},processFiles:function(e){var t={},r=e.value["offline-files"];if(r)for(var i=Object.keys(r),a=0;a<i.length;a++){var s=r[i[a]];t[i[a]]=s}return t},processDeletedRecords:function(e,t){var r=[],i=e.value["deleted-records"];if(i)for(var a=Object.keys(i),s=0;s<a.length;s++){var n=i[a[s]];n.idPageCache=t,r.push(this.renderDataService.deleteGridRecord(n))}return r}}),bizagi.form=bizagi.form||{},bizagi.form.services=bizagi.form.services||{},bizagi.form.services.service=bizagi.form.services.service||{},$.Class.extend("bizagi.form.services.service",{},{init:function(e){this.renderDataService=e.renderDataService,this.database=e.database,this.fileService=this.renderDataService.getFileService()},getServerTaskForm:function(e){var t,r,i,a=this;return e.downloadOfflineForm=!0,(e.bulkDownload?a.renderDataService.multiactionWithLimit():a.renderDataService).getFormData(e).then((function(t){return a.executeOfflineEntryPipelineAndReloadForm(t,e)})).then((function(s){return t=s.form,r=!0===s.hasEntryPipeline,i=!0===s.wasPipelineExecuted,a.getFileAttachmentsFromLocalTaskForm(e)})).then((function(r){if(t.errorType)return $.Deferred().reject(t).promise();e.deleteNextButton&&(t=a.database.deleteNextButton(t)),t.dataChangeset=e.dataChangeset,e.localFiles=r;var i=a.fileService.downloadFormFiles(t,e),s=i.promises,n=a.fileService.downloadFormImages(t,e),o=Array.prototype.push.apply(s,n);return e.bulkDownload&&o.length>0?$.when.apply($,o).then((function(){return a.mergeForm(t,i.data)})):a.mergeForm(t,i.data)})).then((function(e){return{form:e,hasEntryPipeline:r,wasPipelineExecuted:i}})).fail((function(){bizagi.util.console.error("Error downloading task form",e)}))},executeOfflineEntryPipeline:function(e){var t=e.form?e.form.properties:{};return this.hasFormEntryPipeline(e)?$.when(this.renderDataService.executePipeline({pipeline:t.loadExecution,idPageCache:e.form.pageCacheId})).then((function(){return{hasEntryPipeline:!0,wasPipelineExecuted:!0}}),(function(){return $.Deferred().resolve({hasEntryPipeline:!0,wasPipelineExecuted:!1}).promise()})):$.Deferred().resolve({hasEntryPipeline:!1,wasPipelineExecuted:!1}).promise()},executeOfflineEntryPipelineAndReloadForm:function(e,t){var r=this;return t.executeOfflineEntryPipeline?r.executeOfflineEntryPipeline(e).then((function(i){return hasEntryPipeline=i.hasEntryPipeline,wasPipelineExecuted=i.wasPipelineExecuted,hasEntryPipeline&&wasPipelineExecuted?r.renderDataService.getFormData(t).then((function(e){return{form:e,hasEntryPipeline:hasEntryPipeline,wasPipelineExecuted:wasPipelineExecuted}})):{form:e,hasEntryPipeline:hasEntryPipeline,wasPipelineExecuted:wasPipelineExecuted}})):{form:e,wasPipelineExecuted:!1}},getFileAttachmentsFromLocalTaskForm:function(e){return this.database.getFileAttachmentsFromLocalTaskForm(e).then((function(e){return e}),(function(){return{}}))},mergeForm:function(e,t){var r=this;return r.database.mergeDataDocument(t,e).then((function(i){var a={data:t};return a.data=i,a.isOpen=!0,r.database.mergeForm(a,e,{online:!0})}))},downloadOfflineStartForm:function(e){var t=this;return e.action="LOADSTARTFORM",e.downloadOfflineForm=!0,t.renderDataService.multiactionWithLimit().getFormData(e).then((function(r){return r.errorType?$.Deferred().reject(r).promise():r.form?(r.form.properties.isTaskForm=!1,(void 0===r.form.buttons||Array.isArray(r.form.buttons)&&r.form.buttons.length<2)&&(r.form.buttons=t.addFormDefaultButtons()),r.lastSynchronization=Date.now(),t.database.saveStartForm(e,r)):$.Deferred().reject(r).promise()}))},downloadOfflineTaskForm:function(e){var t,r,i=this;return e.deleteNextButton=!1,i.getServerTaskForm({idCase:e.idCase,idWorkitem:e.idWorkitem,executeOfflineEntryPipeline:!0===e.executeOfflineEntryPipeline,bulkDownload:e.bulkDownload}).then((function(a){var s=a.form;return t=a.hasEntryPipeline,r=a.wasPipelineExecuted,s.form.properties.isTaskForm=!0,(void 0===s.form.buttons||Array.isArray(s.form.buttons)&&0==s.form.buttons.length)&&(s.form.buttons=i.addFormDefaultButtons()),i.database.saveTaskForm(e,s)})).then((function(){if(!e.isSingleSync){var i=$.extend({},e);i.type="download-form-success",$(document).trigger("offline-notify-form-sync-event",i)}return{wasFormDownloaded:!0,hasEntryPipeline:t,wasPipelineExecuted:r}}))},addFormDefaultButtons:function(){return[{button:{properties:{actions:["submitData","refresh"],caption:"render-form-button-save",id:"ec0a5a02-0f81-44a7-8d64-ac090a01d61b"}}},{button:{properties:{actions:["validate","submitData","next","routing"],caption:"render-form-button-next",id:"ba81c7af-0d83-4139-879d-b040f0f81bd7"}}}]},verifyFormEntryPipeline:function(e){var t=this;return t.renderDataService.getFormData(e).then((function(e){return t.hasFormEntryPipeline(e)})).fail((function(e){return bizagi.util.console.error("verifyFormEntryPipeline => getFormData error",e),!1}))},hasFormEntryPipeline:function(e){var t=e.form?e.form.properties:{};return!0===bizagi.util.parseBoolean(t.hasEntryPipeline)&&!bizagi.util.isEmpty(t.loadExecution)}}),$.Class.extend("bizagi.render.services.multiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(e,t,r){this.service=e,this.serviceLocator=e.serviceLocator,this.batch={},this.batchTimer=50,this.maxNumberOfActions=t||0,this.queue=r||null,this.deferredBatchExecuting=$.Deferred(),this.deferredBatchExecuting.resolve(),this.disabledRequests=!1,this.circularDependencies=new bizagi.circularDependencies,this.replicateServiceMethods()},getService:function(){return this.service},replicateServiceMethods:function replicateServiceMethods(){var self=this;for(var key in this.service.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"multiaction"!=key&&(self[key]=eval("var tmp = function(){ return this.proxyMethod(this.getService()."+key+", arguments);};tmp"))},proxyMethod:function(e,t){var r=this.service;if(!t||1!=t.length)return e.apply(r,t);if("object"!=_typeof(t[0]))return e.apply(r,t);var i=t[0];if(1==i.prepare)return e.apply(r,t);var a=i.prepare;i.prepare=!0;var s=e.apply(r,t);return void 0===a||null==a?delete i.prepare:i.prepare=a,this.add(s)},makeCircularDependenciesError:function(e){var t=bizagi.localization.getResource("render-actions-loop-validation");return printf(t,e.dependencyFrom,e.dependencyTo)},add:function(e){var t=this,r=new $.Deferred,i=e.h_action||"unnamed";["PROCESSPROPERTYVALUE","LOADTEMPLATE","ADDRELATIONWITHDATA","GETFILE"].indexOf(i)<0&&bizagi.override.detectCircularDependencies&&t.circularDependencies.addNode(i,e),clearTimeout(t.batchTimeout);var a=e.tag=Math.guid(),s={action:e,deferred:r};t.batch[a]=s;var n=function(){var e=t.circularDependencies.resolve();if(e.error){for(var r in t.batch){var i=e.error.multiactionError;t.batch[r].deferred.reject(i)}t.batch={}}else t.disabledRequests||(t.deferredBatchExecuting=t.fire())};return t.batchTimeout=setTimeout(n,t.batchTimer),0!=t.maxNumberOfActions&&Object.keys(t.batch).length>=t.maxNumberOfActions&&(clearTimeout(t.batchTimeout),n()),r.promise()},fire:function(){var e={},t=[];return $.each(this.batch,(function(r,i){t.push(i.action),e[r]=i})),this.batch={},$.when(this.execute({actions:t,rejectDeferreds:!1})).done((function(t){$.each(t,(function(t,r){var i=r.tag;r.error?e[i].deferred.reject(r.error,r,r.error.message):e[i].deferred.resolve(r.result),delete e[i]})),$.each(e,(function(e,t){t.deferred.reject({type:"not-processed",message:"Operation didn't executed"},"","Operation didn't executed")}))})).fail((function(t,r,i){var a=void 0!==i?i.message:i||"Operation didn't executed";$.each(e,(function(e,t){t.deferred.reject({type:"not-processed",message:a},"","Operation didn't executed")}))}))},execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,(function(e,r){r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=r.tag||e,delete r.tag})),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action",r);var s=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction"),data:r,queue:this.queue,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){e.renderingService=!0,bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done((function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void s.reject(t.error,"servererror",t)}s.resolve(e)})).fail((function(e){var t=e.responseText||e,r={};try{r=JSON.parse(t)}catch(e){}s.reject(e,"servererror",r)})),s.promise()},disableRequests:function(){this.disabledRequests=!0},validateIfBatchIsExecuting:function(){return this.deferredBatchExecuting}}),bizagi.render.services.multiactionservice.extend("bizagi.render.services.metadatamultiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"h_pageCacheId"},{execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,(function(e,i){i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=i.tag||e,i[t.Class.BA_PAGE_CACHE]&&(r[t.Class.BA_PAGE_CACHE]=i[t.Class.BA_PAGE_CACHE]),delete i[t.Class.BA_PAGE_CACHE],delete i.tag})),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action metadata",r);var s=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction-metadata"),data:r,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done((function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void s.reject(this,"servererror",t)}s.resolve(e)})).fail((function(e){var t,r=e.responseText||e;try{t=JSON.parse(r)}catch(e){}s.reject(e,"servererror",t)})),s.promise()}}),$.Class("bizagi.workportal.services.db",{},{init:function init(){var self=this,queryString=bizagi.readQueryString();self.disabledb=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb),self.globalId="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain",self.disabledb||self.createDatabases()},_destroy:function(e){this.deleteDatabases(e)},createDatabases:function(){var e=this.globalId.hashCode();this.dbRecentProcesses=new PouchDB("RecentProcesses"+e,{auto_compaction:!0}),this.dbProcessesHierarchy=new PouchDB("ProcessesHierarchy"+e,{auto_compaction:!0}),this.dbStartForms=new PouchDB("StartForms"+e,{auto_compaction:!0}),this.dbStartData=new PouchDB("StartData"+e,{auto_compaction:!0}),this.dbActivities=new PouchDB("Activities"+e,{auto_compaction:!0}),this.dbActivityForms=new PouchDB("ActivityForms"+e,{auto_compaction:!0}),this.dbActivityData=new PouchDB("ActivityData"+e,{auto_compaction:!0}),this.dbProcessColumns=new PouchDB("ProcessColumns"+e,{auto_compaction:!0})},deleteDatabases:function(e){var t=new $.Deferred,r=[this.dbRecentProcesses,this.dbProcessesHierarchy,this.dbStartForms,this.dbStartData,this.dbActivities,this.dbActivityForms,this.dbActivityData,this.dbProcessColumns],i=0;return void 0===e&&(e=function(e,a){e?t.reject(e):++i==r.length&&t.resolve("All db deleted successfully")}),r.forEach((function(t){t.destroy(e)})),t.promise()},restartDatabases:function(){var e=this,t=new $.Deferred;return $.when(e.deleteDatabases()).done((function(){e.createDatabases(),t.resolve()})).fail((function(){e.createDatabases(),t.resolve()})),t.promise()},getHierarchyObjects:function(e,t,r){var i=[];for(var a in e)e.hasOwnProperty(a)&&("object"==_typeof(e[a])?i=i.concat(this.getHierarchyObjects(e[a],t,r)):a==t&&e[a]==r||a==t&&""==r?i.push(e):e[a]==r&&""==t&&-1==i.lastIndexOf(e)&&i.push(e));return i},getAllOpenCases:function(){var e=new $.Deferred;return this.dbStartData.query({map:function(e){!1===e.closed&&"admon"===e.createdBy.userName&&emit(e,null)}},{reduce:!1},(function(t,r){t||e.resolve(r)})),e.promise()}});var STOREOBJECTNAME="offlineTasks";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.workportal.services.db.extend("bizagi.workportal.services.db",{},{createNewCase:function(e){var t=e.idWfClass,r=(new Date).toISOString(),i={_id:r,idWfClass:t.toString(),idWorkFlow:t.toString(),idCase:r,isFavorite:!1,globalId:this.globalId,createdBy:{Name:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon"},creationDate:new Date,process:e.displayName||"Offline",categoryName:e.process||e.categoryName||"Offline",displayName:e.displayName||"Offline",radNumber:r,isOfflineForm:!0,formsRenderVersion:2,isOpen:!0,workItems:[{idWorkItem:bizagi.util.uniqueID(),idTask:bizagi.util.uniqueID(),idCase:r,colorState:"Green",State:"Green",TaskName:e.displayName||"Offline"}]};return this.saveStartCase(r,i).then((function(){return i}))},deleteCase:function(e){var t=this,r=new $.Deferred;return t.dbStartData.get(e.idCase,(function(e,i){e?(bizagi.log("Error, the case do not exist"),r.reject(e)):t.dbStartData.remove(i,(function(t,i){t?(bizagi.log("Error erasing case"),r.reject(e)):r.resolve(i)}))})),r.promise()},deleteTask:function(e){var t=e.idCase+"-"+e.idWorkitem,r=this.dbActivities;return bizagi.util.db.deleteDocument(r,t)},getWorkitems:function(e){var t=new $.Deferred;if(e.fromWorkItemId){var r={workItems:[e.fromWorkItemId]};t.resolve(r)}else this.dbStartData.get(e.idCase,(function(e,r){e?t.reject(e):t.resolve(r)}));return t.promise()},getCategories:function(e){var t=this,r=new $.Deferred;if(e.enableOfflineForm){var i=t.dbProcessesHierarchy;$.when(bizagi.util.db.getDocument(i,t.globalId)).then((function(i){if(t.categories=i.doc,e.idApp||e.idCategory){var s=a(t.categories,e);r.resolve({category:s,totalApps:e.idApp?s.length:0})}else{for(var n=t.categories;1==n.length&&(n[0].categories||n[0].subCategories);)n=a(n,n[0].appId?{idApp:n[0].appId}:{idCategory:n[0].idCategory});r.resolve({category:n,totalApps:n[0]&&n[0].appId?n.length:0})}})).fail((function(){r.resolve({category:[],totalApps:0})}))}else r.resolve({});return r.promise();function a(e,t){for(var r=0,i=e.length;r<i;r++){if(e[r].appId&&e[r].appId==t.idApp)return e[r].categories;if(e[r].idCategory&&e[r].idCategory==t.idCategory)return e[r].subCategories;var s;if(e[r].categories&&(s=a(e[r].categories,t)))return s;if(e[r].subCategories&&(s=a(e[r].subCategories,t)))return s}}},getAllOpenCases:function(){var e=new $.Deferred;return this.dbStartData.query({map:function(e){!1===e.closed&&"admon"===e.createdBy.userName&&emit(e,null)}},{reduce:!1},(function(t,r){t||e.resolve(r)})),e.promise()},getCase:function(e){var t=this.dbStartData;return bizagi.util.db.getDocument(t,e)},getCustomizedColumnsData:function(e){var t=new $.Deferred,r={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}},i="true"===e.inputtray;return(e.radnumber||e.radNumber)&&(e.radNumber=e.radnumber?e.radnumber:e.radNumber),(e.idcase||e.idCase)&&(e.radNumber=e.idcase?e.idcase:e.idCase),this.dbStartData.allDocs({include_docs:!0},(function(a,s){if(a)bizagi.log("Error loading cases from local data base"),t.reject("Error loading cases from local database");else{for(var n=0,o=s.total_rows;n<o;n++)if(i===s.rows[n].value.isOpen&&(void 0===e.radNumber||""===e.radNumber.toString()||e.radNumber.toString()===s.rows[n].value.radNumber)){var l={id:s.rows[n].id,idWFClass:s.rows[n].idWFClass,idWorkFlow:s.rows[n].id,taskState:"",isFavorite:s.rows[n].value.isFavorite,guidFavorite:"",isOpen:s.rows[n].value.isOpen,isOfflineForm:!0,syncStatus:s.rows[n].syncStatus,fields:[{Value:s.rows[n].value.process,DisplayName:s.rows[n].value.process,DataType:"VarChar",isRadNumber:!1},{Value:s.rows[n].value.creationDate,DisplayName:"Process creation date",DataType:"DateTime",isRadNumber:!1}]};r.cases.rows.push(l),r.cases.lstIdCases.push(s.rows[n].id)}r.cases.totalPages=r.cases.page=r.cases.rows.length>0?1:0,t.resolve(JSON.stringify(r))}})),t.promise()},getAllProcesses:function(e){var t=new $.Deferred,r={workflows:{taskstate:"",workflow:[]}},i={map:function(e){e.idWfClass&&e.isOpen&&emit({idWfClass:e.idWfClass,process:e.process,category:e.categoryName},1)},reduce:"_count"},a=bizagi.util.db.executeQuery(this.dbActivities,i,{include_docs:!1,group:!0});return $.when(a).then((function(e){var i=e.rows;null!=i&&i.length>0&&i.forEach((function(e){var t=e.value;r.workflows.workflow.push({idworkflow:e.key.idWfClass,name:e.key.process,count:t,isFavorite:!1,category:e.key.category})})),t.resolve(JSON.stringify(r))})).fail((function(e){t.reject(e)})),t.promise()},getOutboxCases:function(){return this.dbStartData.allDocs({include_docs:!0,attachments:!0}).toJqueryPromise().then((function(e){return e.rows=$.grep(e.rows,(function(e){return!e.doc.isOpen})),e.rows=$.map(e.rows,(function(e){return{id:e.id,key:e.doc.isOpen,value:e.doc}})),e})).fail((function(e){return bizagi.log("Error loading data before syncronization"),e}))},getOutboxTaskCases:function(){var e=new $.Deferred;return this.dbActivityData.allDocs({include_docs:!0},(function(t,r){t?e.reject(t):e.resolve(r)})),e.promise()},getOutboxTaskCasesFilteredBySyncStatus:function(e,t){var r=new $.Deferred,i={map:function(t,r){if(null!=t.data&&!bizagi.util.isEmpty(t.data.h_action)){var i=t.syncStatus;("any"===e&&null!=i||"none"===e&&null==i)&&(i=e),r(i)}}},a={key:e=e||"none",include_docs:1==t};return this.dbActivityData.query(i,a,(function(e,t){e?r.reject(e):r.resolve(t.rows)})),r.promise()},existantCase:function(e,t){e.idWfClass;var r=e.idCase+"-"+e.idWorkitem;return offlineCase={_id:r,idCase:r,isFavorite:!1,globalId:this.globalId,createdBy:{Name:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon"},creationDate:new Date,process:e.process||"Offline",categoryName:e.process||e.categoryName||"Offline",displayName:e.displayName||"Offline",radNumber:r,isOfflineForm:!0,formsRenderVersion:2,isOpen:!0,workItems:[{idWorkItem:bizagi.util.uniqueID(),idTask:bizagi.util.uniqueID(),idCase:r,colorState:"Green",State:"Green",TaskName:e.process||"Offline"}]}},getCasesList:function(e){var t=new $.Deferred,r={page:1,totalPages:1,elements:[]},i="drafts"===e.inputtray,a={map:function(e){emit(e.isOpen,e)}};return this.dbStartData.query(a,{reduce:!1,key:i},(function(i,a){if(i)bizagi.log("Error loading cases from local database"),t.reject("Error loading cases from local database");else{for(var s=0,n=a.rows.length;s<n;s++)if(void 0===e.radNumber||""===e.radNumber.toString()||-1!=a.rows[s].value.radNumber.toString().indexOf(e.radNumber.toString())){var o=[a.rows[s].value.idCase,a.rows[s].value.workItems[0].idWorkItem[0]||"",a.rows[s].value.workItems[0].idTask[0]||"",a.rows[s].value.creationDate,a.rows[s].value.categoryName,a.rows[s].value.displayName,[["Case No",a.rows[s].value.idCase],["Process",a.rows[s].value.process],["Process creation date",bizagi.util.formatDateTime(a.rows[s].value.creationDate)]],a.rows[s].value.isOfflineForm,a.rows[s].value.isOpen];o.offlineType="start",o.syncStatus=a.rows[s].value.syncStatus,o.taskstate=a.rows[s].value.workItems[0].State.toLowerCase()||"",bizagi.util.isEmpty(o.syncStatus)||(o.hasSyncError=!0,o.syncError=a.rows[s].value.syncDetails),r.elements.push(o)}t.resolve(r)}})),t.promise()},getCustomizedColumnsNewData:function(e){var t=new $.Deferred,r={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}},i="true"===e.inputtray,a={map:function(e){emit(e.isOpen,e)}};return this.dbStartData.query(a,{reduce:!1,key:i},(function(i,a){if(i)bizagi.log("Error loading cases from local database"),t.reject("Error loading cases from local database");else{for(var s=0,n=a.rows.length;s<n;s++)if(void 0===e.radNumber||""===e.radNumber.toString()||e.radNumber.toString()===a.rows[s].value.radNumber){var o={id:a.rows[s].value.idCase,idWFClass:a.rows[s].value.idWfClass,idWorkFlow:a.rows[s].value.idWorkFlow,taskState:"",isFavorite:a.rows[s].value.isFavorite,guidFavorite:"",isOpen:a.rows[s].value.isOpen,isAborted:!1,isOfflineForm:!0,fields:[a.rows[s].value.idCase,a.rows[s].value.process,{workitems:a.rows[s].value.workItems},bizagi.util.formatDateTime(a.rows[s].value.creationDate),"",bizagi.util.formatDateTime(a.rows[s].value.creationDate)]};r.cases.rows.push(o),r.cases.lstIdCases.push(a.rows[s].id)}r.cases.totalPages=r.cases.page=r.cases.rows.length>0?1:0,t.resolve(JSON.stringify(r))}})),t.promise()},getRecentProcesses:function(e){var t=new $.Deferred,r=this.dbRecentProcesses;return $.when(bizagi.util.db.getDocument(r,this.globalId)).then((function(e){t.resolve(e)})).fail((function(e){t.resolve({processes:[]})})),t.promise()},saveOfflineTasks:function(e){var t=new bizagiQueue;for(i in e){var r=e[i],a=r[10],s=r[0]+"-"+r[1],n={_id:s,endDate:r.endDate,group:r.group,icon:r.icon,state:r.state,taskState:r.taskState,shortEndDate:r.shortEndDate,atRiskTime:r[11],type:r.type,idWfClass:a.toString(),idWorkFlow:a.toString(),idCase:r[0],isFavorite:r[9],isEdited:!1,createdBy:{Name:void 0!==r.creatorFullName?r.creatorFullName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:void 0!==r.creatorFullName?r.creatorFullName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon"},creationDate:r[12],process:r[4],categoryName:e.process||e.categoryName||"Offline",displayName:e.displayName||"Offline",radNumber:r.systemColumns&&r.systemColumns.radnumber?r.systemColumns.radnumber:r[0],wfClassDisplayName:"",isOfflineForm:!0,formsRenderVersion:2,isOpen:!0,workItems:[{idWorkItem:r[1],idTask:r[2],idCase:r[0],colorState:r.taskstate,State:r.taskstate,TaskName:r[5]}],systemColumns:r.systemColumns};t.add(this.saveOrUpdateTask(s,n))}return t.execute()},saveStartCase:function(e,t){return bizagi.util.db.saveDocument(this.dbStartData,t)},saveTask:function(e,t){return bizagi.util.db.saveDocument(this.dbActivities,t)},saveOrUpdateTask:function(e,t){var r=new $.Deferred,i=this;return $.when(bizagi.util.db.getDocument(i.dbActivities,e)).then((function(e){return $.extend(!0,e,t),bizagi.util.db.saveDocument(i.dbActivities,e)})).then((function(){r.resolve()})).fail((function(e){$.when(bizagi.util.db.saveDocument(i.dbActivities,t)).then((function(){r.resolve()})).fail((function(e){r.reject(e)}))})),r.promise()},cleanTaskDataActions:function(e){var t=new $.Deferred,r=this;return $.when(bizagi.util.db.getDocument(r.dbActivityData,e)).then((function(e){return null!=e&&null!=e.data&&null!=e.data.h_actions&&(e.data.retry_h_actions=e.data.h_actions,e.data.h_actions=[]),bizagi.util.db.saveDocument(r.dbActivityData,e)})).always((function(){t.resolve()})),t.promise()},getTask:function(e){return bizagi.util.db.getDocument(this.dbActivities,e)},saveProcessCustomColumnsHeaders:function(e,t){var r=this.dbProcessColumns,i={_id:e,headers:t};return bizagi.util.db.saveDocument(r,i)},saveSmartInboxCustomColumnsHeaders:function(e,t){var r=this.dbProcessColumns,i={_id:e,headers:t};return bizagi.util.db.saveDocument(r,i)},getProcessCustomColumnsHeaders:function(e){var t=this.dbProcessColumns,r=new $.Deferred;return $.when(bizagi.util.db.getDocument(t,e.toString())).then((function(t){r.resolve({headers:t.headers,type:-1!=e?"process":"system"})})).fail((function(e){$.when(bizagi.util.db.getDocument(t,"-1")).then((function(e){r.resolve({headers:e.headers,type:"system"})})).fail((function(e){r.reject(e)}))})),r.promise()},getSmartInboxCustomColumnsHeaders:function(e){var t=this.dbProcessColumns,r=new $.Deferred;return $.when(bizagi.util.db.getDocument(t,e.toString())).then((function(e){r.resolve({headers:e.headers,type:"smartinbox"})})).fail((function(){$.when(bizagi.util.db.getDocument(t,"-1")).then((function(e){r.resolve({headers:e.headers,type:"system"})})).fail((function(e){r.reject(e)}))})),r.promise()},generateSortedCasesQuery:function(e){var t=e.idWfClass||-1,r=e.smartInboxId,i=e.isOpen,a=e.queryAcrossCustomColums||!1,s=e.customColumnsType||"system",n="doc != undefined",o="doc._id",l={include_docs:!0};t>0?n=f(n,"(doc.idWfClass != undefined && doc.idWfClass == "+t+")","&&"):bizagi.util.isEmpty(r)||(n=f(n,"(doc.smartInboxColumns != undefined && doc.smartInboxColumns['"+r+"'] !== undefined)","&&")),null!=i&&(n=f(n,"doc.isOpen == "+i,"&&"));var c=e.idCase,d=e.radNumber,u="";null!=c&&(u=f(u,"doc.idCase != undefined && doc.idCase == "+c,"&&")),null!=d&&(u=f(u,'doc.radNumber != undefined && doc.radNumber.toString().trim() == "'+(""+d).trim()+'"',"||")),u.trim().length>0&&(n=f(n,"("+u+")","&&"));var p=e.sortData;p&&p.sortFieldName&&(o=null!=r?"doc."+(a?"smartInboxColumns['"+r+"'].":"")+p.sortFieldName:"doc."+(a?s+"Columns.":"")+p.sortFieldName,0==("asc"==p.sortDirection?0:1)&&(l.descending=!0));return{query:new Function("doc","emit","if("+n+"){   emit("+o+");}"),args:l};function f(e,t,r){return 0!=e.trim().length&&(e+=" "+r+" "),e+=" "+t+" "}},getCustomColumnsData:function getCustomColumnsData(params){var db=this.dbActivities,offlineType="task";"drafts"!=params.inputtray&&"outbox-new"!=params.inputtray||(db=this.dbStartData,offlineType="start");var deferred=new $.Deferred;params.idWfClass=params.idWfClass||-1,params.sortData&&(params.queryAcrossCustomColums=!0,params.customColumnsType=params.customColumnsType||"system");var generatedQuery=this.generateSortedCasesQuery(params),queryExecutionPromise=bizagi.util.db.executeQuery(db,generatedQuery.query,generatedQuery.args);return $.when(queryExecutionPromise).then((function(queryResponse){var queryRows=queryResponse.rows;deferred.resolve(queryRows.map((function(row){var item=row.doc,headers=params.headers||[],responseItem={};headers.forEach((function(headerObject){if(headerObject&&headerObject.eval)try{headerObject.eval=headerObject.eval.replaceAll(headerObject.varSymbol,"item"),responseItem[headerObject.fieldName]=eval(headerObject.eval)}catch(e){bizagi.util.console.error("ERROR in getProcessCustomColumnsData",headerObject.eval+" could not be evaluated in ",item)}else if(headerObject&&headerObject.fieldName){var fieldName=headerObject.fieldName.toLowerCase(),objetKeyForFieldName=Object.keys(item).find((function(e){return e.toLowerCase()==fieldName}));objetKeyForFieldName&&(responseItem[headerObject.fieldName]=item[objetKeyForFieldName])}}));var customColumns={};switch(params.customColumnsType){case"system":customColumns=item.systemColumns||{};break;case"process":customColumns=item.processColumns||{};break;case"smartinbox":customColumns=item.smartInboxColumns[params.smartInboxId]||{};break;case"app":customColumns=item.applicationColumns||{};break;default:customColumns={}}return $.extend(responseItem,customColumns),responseItem.isOfflineForm=!0,responseItem.offlineType=offlineType,responseItem.isDraft="start"==offlineType&&responseItem.isOpen,responseItem})))})).fail((function(e){deferred.reject(e)})),deferred.promise()},updateTaskWorkItemCustomColumnsByType:function(e,t,r,i){var a,s=new $.Deferred,n=this;switch(t){case"process":a="processColumns";break;case"smartinbox":a="smartInboxColumns";break;case"application":a="applicationColumns";break;default:return s.reject(t+"is not a valid type for customColumnsType"),s.promise()}return $.when(bizagi.util.db.getDocument(n.dbActivities,e)).then((function(e){return"smartinbox"!=t?e[a]=r:(bizagi.util.isEmpty(e[a])&&(e[a]={}),e[a][i]=r),bizagi.util.db.saveDocument(n.dbActivities,e)})).then((function(){s.resolve(!0)})).fail((function(e){s.resolve(!1)})),s.promise()},cleanOfflineTasks:function(){var e=this,t=new $.Deferred;return e.dbActivities.get(STOREOBJECTNAME,(function(r,i){r?(bizagi.log("Error, no offline tasks"),t.reject(r)):e.dbStartData.remove(i,(function(e,i){e?(bizagi.log("Error erasing tasks"),t.reject(r)):t.resolve(i)}))})),t.promise()},getOfflineCases:function(e){var t=new $.Deferred;e.sortData&&(e.queryAcrossCustomColums=!0,e.customColumnsType="system");var r=this.generateSortedCasesQuery(e),i=bizagi.util.db.executeQuery(this.dbActivities,r.query,r.args);return $.when(i).then((function(e){var r={page:1,totalPages:1,elements:[]},i=e.rows;(null!=i?i.length:0)>0&&i.forEach((function(e){var t=[e.doc.idCase,e.doc.workItems[0].idWorkItem||"",e.doc.workItems[0].idTask||"",e.doc.creationDate,e.doc.process,e.doc.workItems[0].TaskName,[["Case No",e.doc.idCase],["Process",e.doc.process],["Process creation date",bizagi.util.formatDateTime(e.doc.creationDate)]],e.doc.isOfflineForm,e.doc.isOpen,e.doc.isFavorite,e.doc.idWfClass,e.doc.atRiskTime,e.doc.creationDate];t.isEdited=e.doc.isEdited,t.offlineType="task",t.endDate=e.doc.endDate,t.group=e.doc.group,t.icon=e.doc.icon,t.shortEndDate=e.doc.shortEndDate,t.state=e.doc.state,t.taskState=e.doc.taskState,t.type=e.doc.type,t.wfClassDisplayName=e.doc.wfClassDisplayName,t.syncStatus=e.doc.syncStatus,t.radNumber=e.doc.radNumber,e.doc.systemColumns&&(t.systemColumns=e.doc.systemColumns),e.doc.processColumns&&(t.processColumns=e.doc.processColumns),bizagi.util.isEmpty(e.doc.syncStatus)||(t.hasSyncError=!0,t.syncError=e.doc.syncDetails),r.elements.push(t)})),t.resolve(r)})).fail((function(e){t.reject(e)})),t.promise()},getLocalActivities:function(){var e=new $.Deferred;return this.dbActivities.allDocs({include_docs:!0},(function(t,r){if(t)e.reject();else{for(var i=r.total_rows,a={},s=0;s<i;s++){var n=r.rows[s].doc;a[n._id]=n}e.resolve(a)}})),e.promise()},updateCaseSyncStatus:function(e){var t=this,r=e.id;return"start"===e.type?i(t.dbStartData,r):i(t.dbActivityData,r).then((function(){return i(t.dbActivities,r)}));function i(t,r){return $.when(bizagi.util.db.getDocument(t,r)).then((function(r){return r.syncStatus=e.syncStatus,r.syncDetails=e.syncDetails,$.when(bizagi.util.db.saveDocument(t,r))})).then((function(e){return e}))}},validateLocalDataForTaskExists:function(e){var t=new $.Deferred;return $.when(bizagi.util.db.getDocument(this.dbActivityData,e)).then((function(e){t.resolve(null!=e.data)})).fail((function(e){t.resolve(!1)})),t.promise()},openOfflineTask:function(e){return this.saveOrUpdateTask(e,{isOpen:!0,isEdited:!0})},closeOfflineTask:function(e){var t=e.idCase+"-"+e.idWorkitem;return this.saveOrUpdateTask(t,{isOpen:!1,isEdited:!0})},updateTaskDatachangeset:function(e,t){var r={dataChangeset:t};return this.saveOrUpdateTask(e,r)},updateTaskIsEdited:function(e,t){var r={isEdited:t};return this.saveOrUpdateTask(e,r)},saveAvailableSmartInboxes:function(e){var t={_id:this.globalId+"-smartinboxes",doc:e};return bizagi.util.db.saveDocument(this.dbProcessesHierarchy,t).fail((function(e){return $.Deferred.fail("Could not save available smartinboxes:"+e).promise()}))},saveAvailableOfflineSmartInboxes:function(e){var t={_id:this.globalId+"-smartinboxes-offline",doc:e};return bizagi.util.db.saveDocument(this.dbProcessesHierarchy,t).fail((function(e){return $.Deferred.fail("Could not save available offline smartinboxes:"+e).promise()}))},markSmartInboxAsAvailableOffline:function(e){var t=this;t.getAvailableOfflineSmartInboxes().then((function(r){-1==r.indexOf(e)&&(r.push(e),t.saveAvailableOfflineSmartInboxes(r))}))},getAvailableSmartInboxes:function(){var e=this.globalId+"-smartinboxes";return bizagi.util.db.getDocument(this.dbProcessesHierarchy,e).then((function(e){return e.doc}),(function(){return $.Deferred().resolve([]).promise()}))},getAvailableOfflineSmartInboxes:function(){var e=this.globalId+"-smartinboxes-offline";return bizagi.util.db.getDocument(this.dbProcessesHierarchy,e).then((function(e){return e.doc}),(function(){return $.Deferred().resolve([]).promise()}))}}),bizagi.workportal.services.db.extend("bizagi.workportal.services.db",{},{getTaskSyncError:function(e){var t=e.idCase+"-"+e.idWorkitem;return this.getTask(t).then((function(e){return bizagi.util.isEmpty(e)||bizagi.util.isEmpty(e.syncDetails)?$.Deferred().resolve(void 0).promise():$.Deferred().resolve(e.syncDetails).promise()}),(function(){return $.Deferred().resolve(void 0).promise()})).then((function(t){return e.deferred&&e.deferred.resolve(t),t}))},getInboxSyncErrors:function(){return this.dbActivities.allDocs({include_docs:!0}).toJqueryPromise().then((function(e){var t={};return $.grep(e.rows,(function(e){return!bizagi.util.isEmpty(e.doc.syncStatus)&&!bizagi.util.isEmpty(e.doc.syncDetails)})).forEach((function(e){var r=e.doc;t[e.id]=r.syncDetails})),t})).fail((function(e){return bizagi.util.console.error("Error getting inbox sync errors",e),e}))},getSyncErrorsList:function(){var e=[],t=this;return t.dbStartData.allDocs({include_docs:!0,attachments:!1}).toJqueryPromise().then((function(r){var i=$.grep(r.rows,(function(e){return!bizagi.util.isEmpty(e.doc.syncStatus)&&!bizagi.util.isEmpty(e.doc.syncDetails)}));return e=e.concat(i.map((function(e){return(e=e.doc).offlineType="start",t.serializeError(e)}))),t.dbActivities.allDocs({include_docs:!0,attachments:!1}).toJqueryPromise()})).then((function(r){var i=$.grep(r.rows,(function(e){return!bizagi.util.isEmpty(e.doc.syncStatus)&&!bizagi.util.isEmpty(e.doc.syncDetails)}));return e=e.concat(i.map((function(e){return(e=e.doc).offlineType="task",t.serializeError(e)})))})).fail((function(e){return bizagi.log("Error loading data before syncronization"),e}))},serializeError:function(e){return{radnumber:e.radNumber,idcase:e.idCase,idworkitem:e.workItems[0].idWorkItem,errortype:e.syncDetails.type,synctimestamp:e.syncDetails.timestamp,activity:"task"===e.offlineType?e.workItems[0].TaskName:void 0,activityduedate:"task"===e.offlineType?e.endDate:void 0,process:e.process,offlinetype:"task"===e.offlineType?"task":"start",isdraft:!("task"===e.offlineType),syncerror:e.syncDetails,state:"task"===e.offlineType?e.state:void 0}}}),bizagi.workportal.services.db.extend("bizagi.workportal.services.db",{},{getFormData:function(e){var t=this,r=new $.Deferred;return setTimeout((function(){t.dbStartForms.get(e,(function(e,t){if(e)r.reject(e);else if(void 0!==t.form)r.resolve({form:t.form,type:"form"});else{var i={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};r.reject(JSON.stringify(i))}}))}),300),r.promise()},mergeForm:function(e,t,r){var i=this,a=new $.Deferred;return $.when(t).done((function(t){if(e.data){var s=function t(a,s){if(Array.isArray(a))for(var n=0,o=a.length;n<o;n++)t(a[n],s);else a.container?t(a.container.elements,s):(e.isOpen||(a.render.properties.editable=!1),a.render.properties.xpath==s.key&&("grid"===a.render.properties.type&&i.setRenderGridValues(a.render),i.setRenderValues(a.render.properties,s.value,r)))};for(prop in e.isOpen||(t.form.buttons=[],0===Object.keys(e.data).length&&s(t.form.elements,{key:"read-only-form",value:""})),r.formProperties=t.form.properties,e.data)s(t.form.elements,{key:prop,value:e.data[prop]});a.resolve(t)}else a.resolve(t)})).fail((function(e){if(!e.responseText)var t={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};e.responseText=JSON.stringify(t),a.reject(e)})),a.promise()},setRenderGridValues:function(e){e.properties.data.columns=[];for(var t=0,r=e.elements.length;t<r;t++)e.properties.data.columns.push(e.elements[t].render.properties.xpath)},setDataType:function(e,t){},setRenderValues:function(e,t,r){var i=e.type;i||(i="label");if(-1===["text","label","number","money","date","boolean","geolocation","hidden","upload"].indexOf(i))if(-1===["combo","cascadingCombo","radio","list"].indexOf(i)){if("search"!==i){if(["image","signature"].includes(i))return e.value=[[0,t.value.name]],void(e.binaryValue=t.value);if("grid"===i){e["offline-files"]=t.value["offline-files"]?t.value["offline-files"]:{},e["deleted-records"]=t.value["deleted-records"]?t.value["deleted-records"]:{},e["edited-images"]=t.value["edited-images"]?t.value["edited-images"]:{};var a=r.formProperties?r.formProperties.isTaskForm:void 0,s=!0===r.hasSyncError;if(!0===a&&!0===r.online&&!s)return;var n=t.value.rows||[];e.data.records=n.length,e.data.total=1,e.data.page=1;var o=e.data.columns.length,l=[],c=n.length;e.data.rows=[];for(var d=0;d<c;d++){var u=n[d][n[d].length-1]&&n[d][n[d].length-1].idRow?n[d][n[d].length-1]:void 0,p=u?u.idRow:bizagi.util.randomNumber(),f=[],g=[];f[0]=p;for(var h=0;h<o;h++){n[d][h]&&(n[d][h].xpath?g[e.data.columns.indexOf(n[d][h].xpath)]=n[d][h]:n[d][h].changes||(g[h]=n[d][h])),g[h]=null!=g[h]?g[h]:null,f[f.length]="true"}var m=$.merge([p],g);e.data.rows.push(m),l[l.length]=f}return e.data.editable=l,void(e.data.visible=l)}try{e.value=t.value}catch(e){}return bizagi.log(i+" not supported in render factory",t,"error"),null}for(var y=0,v=e.data.length;y<v;y++)e.data[y].id==t.value.id&&(e.value=t.value)}else for(var C=0,A=e.data.length;C<A;C++)e.data[C].id==t.value&&(e.value=[{id:t.value,value:e.data[C].value}]);else e.value=t.value},getSummary:function(e){var t=new $.Deferred;if(e.offlineType&&"task"===e.offlineType){var r=e.idCase+"-"+e.idWorkitem;this.dbActivities.get(r,(function(e,r){e?t.reject(e):t.resolve($.extend(r,{processPath:"/",currentState:r.workItems,countAssigness:0,countEvents:0,isOpen:r.isOpen.toString(),countSubProcesses:0}))}))}else this.dbStartData.get(e.idCase,(function(e,r){e?t.reject(e):t.resolve($.extend(r,{processPath:"/",currentState:r.workItems,countAssigness:0,countEvents:0,isOpen:r.isOpen.toString(),countSubProcesses:0}))}));return t.promise()},saveActivityFormImage:function(e,t){var r=e.id,i=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.saveAttachment(this.dbActivityForms,i,r,"image/png",t,!0)},saveActivityDataImage:function(e,t,r){var i=e.id,a=e.idCase+"-"+e.idWorkitem,s=r||"image/png";return bizagi.util.db.saveAttachment(this.dbActivityData,a,i,s,t,!0)},getActivityDataImage:function(e,t){var r=e.id,i=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(this.dbActivityData,i,r,t,"image/png")},getActivityImage:function(e,t){var r=this,i=e.id,a=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(r.dbActivityData,a,i,t,"image/png").then((function(e){return void 0!==e&&null!=e?e:bizagi.util.db.getAttachment(r.dbActivityForms,a,i,t,"image/png")}))},saveStartDataImage:function(e,t){var r=e.id,i=e.idCase;return bizagi.util.db.saveAttachment(this.dbStartData,i,r,"image/png",t,!0)},getStartDataImage:function(e,t){var r=e.id,i=e.idCase;return bizagi.util.db.getAttachment(this.dbStartData,i,r,t,"image/png")},saveActivityFormFile:function(e,t,r){var i=e.id,a=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.saveAttachment(this.dbActivityForms,a,i,r,t,!0)},saveActivityDataFile:function(e,t,r){var i=e.id,a=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.saveAttachment(this.dbActivityData,a,i,r,t,!0)},getActivityDataFile:function(e,t,r){var i=e.id,a=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(this.dbActivityData,a,i,t,r)},getActivityFile:function(e,t,r){var i=this,a=e.id,s=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(i.dbActivityData,s,a,t,r).then((function(e){return void 0!==e&&null!=e?e:bizagi.util.db.getAttachment(i.dbActivityForms,s,a,t,r)}))},saveStartDataFile:function(e,t,r){var i=e.id,a=e.idCase;return bizagi.util.db.saveAttachment(this.dbStartData,a,i,r,t,!0)},getStartDataFile:function(e,t,r){var i=e.id,a=e.idCase;return bizagi.util.db.getAttachment(this.dbStartData,a,i,t,r)},convertUploadOnlineValueInOfflineValue:function(e){var t=[];return e&&Array.isArray(e)&&e.forEach((function(e){var r=e[1],i=bizagi.util.media.getFileExtension(r).toLowerCase();t.push({id:e[0],fileName:r,mimeType:bizagi.util.media.getMIMETypeByExtension(i),status:"existent"})})),t},saveTaskForm:function(e,t){var r=this.dbActivityForms,i=e.idCase+"-"+e.idWorkitem,a=t&&t.form&&null!=t.form.DataChangesetVersion?t.form.DataChangesetVersion:e.dataChangeset;t._id=i;var s=new $.Deferred,n=void 0;return null!=a&&(e.dataChangeset=a,t.dataChangeset=a,n=this.updateTaskDatachangeset(i,a)),$.when(n).always((function(){$.when(bizagi.util.db.saveDocument(r,t)).then((function(e){s.resolve(e)})).fail((function(e){s.reject(e)}))})),s.promise()},getTaskForm:function(e){var t=this.dbActivityForms,r=e.idCase+"-"+e.idWorkitem,i=new $.Deferred;return $.when(bizagi.util.db.getDocument(t,r)).then((function(e){if(e&&e.form)i.resolve(e);else{var t={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};i.reject({responseText:JSON.stringify(t)})}})).fail((function(e){var t={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};i.reject({responseText:JSON.stringify(t)})})),i.promise()},deleteTaskForm:function(e){var t=e.idCase+"-"+e.idWorkitem,r=this.dbActivityForms;return bizagi.util.db.deleteDocument(r,t)},updateTaskForm:function(e,t){this.saveTaskForm(e,t)},getFileAttachmentsFromLocalTaskForm:function(e){var t=new $.Deferred;return this.getTaskForm(e).then((function(e){t.resolve(e._attachments||{})}),(function(){t.resolve({})})),t.promise()},getStartForm:function(e){var t=this.dbStartForms,r=e.idProcess.toString();return bizagi.util.db.getDocument(t,r)},saveStartForm:function(e,t){var r=this.dbStartForms;return t._id=e.idProcess,bizagi.util.db.saveDocument(r,t)},mergeTaskAction:function(e,t){var r=this.mergeObject(e,t,{depth:3});return r=this.reduceLocalGridDeletions(r)},mergeObject:function(e,t,r){var i=this;return"object"!==_typeof(t)||bizagi.util.isArray(t)?e=t:null==t?e:(Object.keys(t).forEach((function(a){"object"!=_typeof(t[a])||bizagi.util.isArray(t[a])?e[a]=t[a]:(e[a]=e[a]||{},void 0===r.depth||r.depth<=0?bizagi.util.extend(e[a],t[a]):i.mergeObject(e[a],t[a],{depth:r.depth-1}))})),e)},reduceLocalGridDeletions:function(e){return Object.keys(e).forEach((function(t){var r=e[t]&&e[t].value?e[t].value:e[t];void 0!==r&&r["deleted-records"]&&r["new-records"]&&Object.keys(r["new-records"]).forEach((function(e){r["deleted-records"][e]&&(delete r["new-records"][e],delete r["deleted-records"][e])}))})),e},saveTaskData:function(e,t){var r=this,i=new $.Deferred,a=e.idCase+"-"+e.idWorkitem,s=r.dbActivityData;return $.when(bizagi.util.db.getDocument(s,a)).then((function(n){if(n.data){var o=n.data.h_actions||[];e.actions&&Object.keys(e.actions).forEach((function(t){var i=e.actions[t];null!=i&&r.canAddActionInList(i,o)&&o.push(i)})),n.data.h_actions=o}else t.h_actions=e.actions;var l=n.data?r.mergeTaskAction(n.data,t):t;r.performSaveTaskData(i,l,a,e,s)})).fail((function(){t.h_actions=e.actions,r.performSaveTaskData(i,t,a,e,s)})),i.promise()},performSaveTaskData:function(e,t,r,i,a){var s=this,n={_id:r,data:t,idForm:i.idForm};$.when(bizagi.util.db.saveDocument(a,n)).then((function(t){var r;r="next"===i.action||"nextWithoutValidations"===i.action?s.closeOfflineTask(i):s.markTaskEdited(i),$.when(r).then((function(t){e.resolve(t)})).fail((function(t){e.reject(t)}))})).fail((function(t){e.reject(t)}))},canAddActionInList:function(e,t){var r=!0;return t.forEach((function(t){t.h_action&&e.h_action&&(t.h_idRender&&e.h_idRender?t.h_action==e.h_action&&t.h_idRender==e.h_idRender&&(r=!1):t.h_action==e.h_action&&(r=!1))})),r},separateComplexControls:function(e,t){var r,i=new $.Deferred;return e.offlineType&&"task"!==e.offlineType?(r=new $.Deferred).resolve(t):r=this.mergeDataDocument(t,this.getTaskForm(e)),$.when(r).done((function(e){var r=[],a=[],s=[];Object.keys(e).forEach((function(i){var n=e[i];n&&n.renderId&&n.type&&["image","signature"].includes(n.type)?(n.xpath=i,r.push(n),delete t[i]):n&&n.renderId&&n.type&&"upload"===n.type?(n.xpath=i,a.push(n),delete t[i]):n&&n.renderId&&n.type&&"grid"===n.type&&(n.xpath=i,s.push(n),delete t[i])})),i.resolve({data:t,images:r,uploads:a,grids:s})})).fail((function(e){i.reject(e)})),i.promise()},markTaskEdited:function(e){var t=new $.Deferred,r=this.dbActivities,i=e.idCase+"-"+e.idWorkitem;return $.when(bizagi.util.db.getDocument(r,i)).then((function(e){e.isEdited=!0,$.when(bizagi.util.db.saveDocument(r,e)).then((function(e){t.resolve(e)})).fail((function(e){t.reject(e)}))})).fail((function(e){t.reject(e)})),t.promise()},getTaskData:function(e){var t=new $.Deferred,r=e.idCase+"-"+e.idWorkitem;return this.dbActivityData.get(r,(function(e,r){e?t.reject(e):t.resolve(r)})),t.promise()},deleteTaskData:function(e){var t=this,r=new $.Deferred,i=e.idCase+"-"+e.idWorkitem,a=!0===e.deleteAttachments;return $.when(bizagi.util.db.getDocument(t.dbActivityData,i)).then((function(e){var s;if(a)s=bizagi.util.db.deleteDocument(t.dbActivityData,i);else{var n={_id:i};s=bizagi.util.db.saveDocument(t.dbActivityData,n)}$.when(s).then((function(e){r.resolve()})).fail((function(e){r.reject(e)}))})).fail((function(e){r.resolve()})),r.promise()},saveStartData:function(e,t){var r=this;return $.when(bizagi.util.db.getDocument(r.dbStartData,e.idCase)).then((function(i){return r.mergeDataDocument(t,bizagi.util.db.getDocument(r.dbStartForms,i.idWfClass.toString())).then((function(a){return i=r.mergeData(t,i,a),e.idForm&&(i.idForm=e.idForm),bizagi.util.db.saveDocument(r.dbStartData,i)}))}))},filterXpathsByType:function(e,t){var r=[];function i(e,r){e.xpath&&e.type===t&&r.push({xpath:e.xpath,renderId:e.id,value:e.value})}return function e(t,r){if(t)for(var a=0;a<t.length;a++){t[a].container?e(t[a].container.elements,r):i(t[a].render.properties,r)}}(e.form.elements,r),r},filterXpathsByTypeMap:function(e,t){var r=this,i=[];function a(e,r){e.xpath&&t[e.type]&&r.push({xpath:e.xpath,renderId:e.id,value:e.value,type:e.type})}return function e(i,s){if(i)for(var n=0;n<i.length;n++){if(i[n].container)e(i[n].container.elements,s);else{var o=i[n].render.properties;if("grid"===o.type){if(o.data&&o.data.records>0){for(var l=[],c=0;c<i[n].render.elements.length;c++){var d=i[n].render.elements[c];d.position=c+1,t[d.render.properties.type]&&l.push(d)}if(l.length>0)for(var u=o.data.rows,p=0;p<u.length;p++){var f=u[p];l.forEach((function(e){s.push({xpath:e.render.properties.xpath,renderId:e.render.properties.id,value:f[e.position],xpathContext:o.xpath+r.buildCellXpathFilter(f[0]),gridXpath:o.xpath,columnXpath:e.render.properties.xpath,idRow:f[0],type:e.render.properties.type})}))}}}else a(o,s)}}}(e.form.elements,i),i},buildCellXpathFilter:function(e){return bizagi.util.isNumeric(e)?"[id="+e+"]":"[id='"+e+"']"},mergeDataDocument:function(e,t){var r=new $.Deferred,i={};return $.when(t).done((function(t){for(prop in e)"h_action"!=prop&&"h_actions"!=prop&&(i[prop]={},i[prop].value=e[prop],a(t.form.elements,{key:prop,value:e[prop]}));function a(e,t){if(Array.isArray(e))for(var r=0,s=e.length;r<s;r++)a(e[r],t);else e.container?a(e.container.elements,t):e.render.properties.xpath==t.key&&(i[t.key].DataType=e.render.properties.dataType||"",i[t.key].type=e.render.properties.type||"",i[t.key].renderId=e.render.properties.id)}r.resolve(i)})),r.promise()},mergeData:function(e,t,r){"next"!=e.h_action&&"nextWithoutValidations"!=e.h_action||(t.isOpen=!1),t.data=t.data||{};var i=this.mergeTaskAction(t.data,r);return t.data=i,t},nativeSaveFormInfo:function(e,t,r){var i=this,a=new $.Deferred;return i.mergeDataDocument(e,r).done((function(r){t=i.mergeData(e,t,r),a.resolve(t)})),a.promise()},deleteNextButton:function(e){return e.form&&e.form.buttons&&(e.form.buttons=e.form.buttons.filter((function(e){var t=e.button.properties;return!t||!(t.caption&&"render-form-button-next"===t.caption)}))),e}}),$.Class.extend("bizagi.workportal.services.pullWorker",{},{init:function init(params){var self=this,queryString=bizagi.readQueryString();self.services=params,self.database=params.database;var querydisable=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb);self.disabledb=querydisable,self.globalId="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain"},pull:function(){var e=this;if(e.disabledb)return!1;var t=e.services.callServiceWithNetworkRetries(e.services,e.services.getOfflineTasks,[],5,2e3);return $.when(t).then((function(){return e.syncOfflineCases()}),(function(e){return bizagi.util.console.log("Error in getOfflineTasks before to push cases",e),$.Deferred().resolve(!0).promise()}))},syncOfflineCases:function(e){var t=this;if(void 0!==t.database&&(t.synchronizing=t.synchronizing||!1,!t.synchronizing)){t.synchronizing=!0,t.pushInProgressPromise=new $.Deferred;var r=new bizagiQueue,i=t.syncOfflineStartCases(r),a=t.syncOfflineTaskCases(r);$.when(i,a).then((function(e,t){if(t&&t.count>0){var i={type:"push-tasks-started",tasks:t.tasks||{}};$(document).trigger("offline-notify-form-sync-event",i)}if(e&&e.count>0&&(console.log("[Offline] [Sync] [Start Case] [Success]",e.count),bizagi.util.isNativePluginSupported())){var a={type:"success",description:"[Offline] [Sync] [Start Case] [Success]",cases_number:e.count};void 0!==bizagiapp.sendStartFormSyncEvent&&bizagiapp.sendStartFormSyncEvent(a)}if(t&&t.count>0&&(console.log("[Offline] [Sync] [Task Case] [Success]",t.count),bizagi.util.isNativePluginSupported())){var s={type:"success",description:"[Offline] [Sync] [Task Case] [Success]",cases_number:t.count};void 0!==bizagiapp.sendTaskFormSyncEvent&&bizagiapp.sendTaskFormSyncEvent(s)}return r.execute()})).then((function(){setTimeout((function(){t.synchronizing=!1,t.pushInProgressPromise.resolve(!0)}),1e3)})).fail((function(e){setTimeout((function(){if(e&&(console.log("[Offline] [Sync] [Task Case] [Start Form] [Error]"),bizagi.util.isNativePluginSupported())){var r={type:"error",description:"[Offline] [Sync] [Task Case] [Start Case] [Error]",cases_number:0};void 0!==bizagiapp.sendStartFormSyncEvent&&bizagiapp.sendStartFormSyncEvent(r),void 0!==bizagiapp.sendTaskFormSyncEvent&&bizagiapp.sendTaskFormSyncEvent(r)}console.log("Error pushing cases to server with errors",e),t.synchronizing=!1,$(document).trigger("offline-notify-form-sync-event",{type:"push-tasks-error",message:t.parseSyncError(e)}),t.pushInProgressPromise.reject(e)}),1e3)}))}return t.pushInProgressPromise.promise()},parseSyncError:function(e){return e.message?e.message:e.length&&e.length>0&&e[e.length-1].result&&e[e.length-1].result.messages.length&&e[e.length-1].result.messages.length>0?e[e.length-1].result.messages[0]:"Unknown error"},syncSingleOfflineTaskCase:function(e){var t=this,r=new $.Deferred;return e.isSingleSync=!0,$.when(t.database.getTaskData(e)).then((function(r){var i={idCase:e.idCase,idWorkitem:e.idWorkitem,data:r.data||{},type:"task",id:e.idCase+"-"+e.idWorkitem,syncStatus:"started",isSingleSync:e.isSingleSync,isRetry:!0===e.isRetry};return t.generateSyncCasePromise(i)})).then((function(r){var i=new $.Deferred,a=!1;return r&&!r.containsNext?r&&null!=r.DataChangesetVersion?$.when(t.database.getTaskForm(e)).then((function(e){null!=(e=e.form).DataChangesetVersion&&r.DataChangesetVersion>e.DataChangesetVersion&&(a=!0,r.shouldRefresh=!0)})).fail((function(e){a=!0})).always((function(){i.resolve(a,r)})):(a=!0,i.resolve(a,r)):i.resolve(a,r),i.promise()})).then((function(r,i){return r?$.when(t.services.downloadOfflineTaskForm(e)).then((function(e){return i})):i})).then((function(e){if(console.log("[Online] [Sync] [Task Case] [Success] [Feature flag Force Offline on true]"),bizagi.util.isNativePluginSupported()){void 0!==bizagiapp.sendTaskFormSyncEvent&&bizagiapp.sendTaskFormSyncEvent({type:"success",description:"[Online] [Sync] [Task Case] [Success] [Feature flag Force Offline on true]",cases_number:0})}r.resolve(e)})).fail((function(i){if(console.log("[Online] [Sync] [Task Case] [Error] [Feature flag Force Offline on true]"),bizagi.util.isNativePluginSupported()){var a={type:"error",description:"[Online] [Sync] [Task Case] [Error] [Feature flag Force Offline on true]",cases_number:0};void 0!==bizagiapp.sendTaskFormSyncEvent&&bizagiapp.sendTaskFormSyncEvent(a)}if(!0!==e.isRetry)r.reject(i);else{i=t.services.renderDataService.parseServiceError(arguments);var s=t.services.syncService.buildSyncErrorObject(i),n={_internalSyncError:s,message:null!=s&&s.message?s.message:void 0};$.extend(n,i),r.reject(n)}})),r.promise()},syncSingleOfflineStartCase:function(e){var t=this,r=new $.Deferred;return $.when(t.database.getCase(e.idCase)).then((function(r){var i={idCase:r.idCase,data:r.data||{},idProcess:r.idWorkFlow,type:"start",id:r.idCase,syncStatus:"started",isRetry:!0===e.isRetry};return t.generateSyncCasePromise(i)})).then((function(e){if(console.log("[Online] [Sync] [Start Case] [Success] [Feature flag Force Offline on true]"),bizagi.util.isNativePluginSupported()){void 0!==bizagiapp.sendStartFormSyncEvent&&bizagiapp.sendStartFormSyncEvent({type:"success",description:"[Online] [Sync] [Start Case] [Success] [Feature flag Force Offline on true]",cases_number:1})}r.resolve(e)})).fail((function(e){if(console.log("[Online] [Sync] [Start Case] [Error][Feature flag Force Offline on true]"),bizagi.util.isNativePluginSupported()){var i={type:"error",description:"[Online] [Sync] [Start Case] [Error] [Feature flag Force Offline on true]",cases_number:0};void 0!==bizagiapp.sendStartFormSyncEvent&&bizagiapp.sendStartFormSyncEvent(i)}e=t.services.renderDataService.parseServiceError(arguments);var a=t.services.syncService.buildSyncErrorObject(e),s={_internalSyncError:a,message:null!=a&&a.message?a.message:void 0};$.extend(s,e),r.reject(s)})),r.promise()},syncOfflineStartCases:function(e){var t=this,r=new $.Deferred;return $.when(t.database.getOutboxCases()).done((function(i){for(var a=0;a<i.rows.length;a++){var s=i.rows[a].value;if(!s.syncStatus){var n={idCase:s.idCase,data:s.data||{},idProcess:s.idWorkFlow,type:"start",id:s.idCase,syncStatus:"started"};e.add(t.generateSyncCasePromise(n))}}r.resolve({count:i.rows.length})})).fail((function(e){r.reject(e)})),r.promise()},syncOfflineTaskCases:function(e){var t=new $.Deferred,r=this;return r.database.getOutboxTaskCasesFilteredBySyncStatus("none",!0).done((function(i){for(var a={},s=0;s<i.length;s++){var n=i[s].doc,o=i[s].id,l=o.split("-"),c={idCase:l[0],idWorkitem:l[1],data:n.data||{},type:"task",id:o,syncStatus:"started"};a[o]=!0,e.add(r.generateSyncCasePromise(c))}t.resolve({tasks:a,count:i.length})})).fail((function(e){t.reject(e)})),t.promise()},generateSyncCasePromise:function(e){var t=this;return"start"===e.type||e.data&&(e.data.h_action||e.data.h_actions||e.data.retry_h_actions)?t.database.updateCaseSyncStatus(e).then((function(){return"start"==e.type?t.services.syncOfflineStartCase(e):t.services.syncOfflineTaskCase(e)})):(bizagi.util.console.log("This case will not be synchronized. No actions found",e),$.Deferred().resolve("This case will not be synchronized. No actions found").promise())}}),$.Class.extend("bizagi.workportal.services.fetchWorker",{},{init:function init(params){var self=this;self.services=params,self.db=params.database,self.maxOfflineCases=100,self.secondsBeforeAllowFetchAgain=2,self.tasksSyncDelta=8,self.startSyncDelta=8;var queryString=bizagi.readQueryString();self.disabledb=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb),self.globalId="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain",self.fetchInProgress=!1},triggerOfflineSyncEvent:function(e){bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()?bizagiapp.synchronizeDownloadOfflineState(e):bizagi.webpart.publish("offline.sync",e)},fetch:function(e){var t=this,r=1e3*t.secondsBeforeAllowFetchAgain;function i(){t.triggerOfflineSyncEvent({type:"download-started"}),t.fetchInProgress=!0,t.fetchInProgressPromise=new $.Deferred;var e,r,i=t.services.callServiceWithNetworkRetries(t.services,t.services.getOfflineTasks,[],5,2e3),a=t.services.callServiceWithNetworkRetries(t.services,t.services.getOfflineProcessesHierarchy,[],5,2e3),s=new $.Deferred,n=0;$.when(a,i).then((function(i,a){var o=t.getProcessesListFromHierarchy(i),l=t.serializeActivities(a);n=o.length+Object.keys(l).length,$.when(t.getTasksToDownload(l),t.getStartFormsToDownload(o)).then((function(a,n){r=t.processTasksToFetchForms(l,a.items),e=t.fetchStartForms(i,n),s.resolve(n.length+a.count)})).fail((function(e,t){s.reject({tasks:e,start:t})}))})).fail((function(e,t){console.log("Forms download fails",e,t),s.reject()})),$.when(s).then((function(i){return i>0?t.triggerOfflineSyncEvent({type:"update-total-downloads",argument:i}):n>0&&t.triggerOfflineSyncEvent({type:"up-to-date",argument:n}),$.when.apply($,[e,r])})).then((function(){t.lastFetch=Date.now(),t.fetchInProgressPromise.resolve(!0),t.fetchInProgress=!1,t.triggerOfflineSyncEvent({type:"download-finished"}),$(document).trigger("offline-notify-form-sync-event",{type:"download-finished"})})).fail((function(){$.when(e).always((function(e){$.when(r).always((function(e){t.fetchInProgressPromise.reject("Error executing fetch v2"),t.fetchInProgress=!1,t.triggerOfflineSyncEvent({type:"download-error"}),$(document).trigger("offline-notify-form-sync-event",{type:"download-error"})}))}))})),$.when(t.services.getRecentOfflineProcesses()).then((function(e){t.saveRecentProcesses(e)}))}return t.lastFetch?t.lastFetch+r<Date.now()&&!t.fetchInProgress&&i():t.fetchInProgress||i(),t.fetchInProgressPromise.promise()},fetchStartForms:function(e,t){var r=new $.Deferred,i=this;return $.when(i.saveProcessesHierarchy(e)).then((function(){return i.downloadStartForms(t)})).then((function(){r.resolve()})).fail((function(e){console.log("Sv2: Problem downloading any offline start form",e),r.reject()})),r.promise()},getProcessesListFromHierarchy:function(e){for(var t=[],r=0;r<e.length;r++)for(var i=e[r].categories,a=0;a<i.length;a++)s(i[a]);function s(e){if("true"===e.isProcess&&e.hasOfflineForm)t.push(e.idCategory);else if(e.subCategories)for(var r=0;r<e.subCategories.length;r++){s(e.subCategories[r])}}return t},getStartFormsToDownload:function(e){var t=this,r=new $.Deferred,i=new bizagiQueue,a=[];return e.forEach((function(e){var r=t.checkIfStartFormNeedsSync(e);$.when(r).then((function(t){t&&a.push(e)})),i.add(r)})),$.when(i.execute()).always((function(){r.resolve(a)})),r.promise()},checkIfStartFormNeedsSync:function(e){var t=new $.Deferred,r=this;return $.when(r.services.database.getStartForm({idProcess:e})).then((function(e){var i=!1,a=!1,s=e.lastSynchronization;if(null!=s){var n=Date.now();i=s+60*r.startSyncDelta*60*1e3<n}else i=!0;(new Date).getDate()!=(bizagi.util.getSyncTimeStamp()||new Date).getDate()&&(a=!0),t.resolve(a||i)})).fail((function(){t.resolve(!0)})),t.promise()},downloadStartForms:function(e){for(var t=this,r=new $.Deferred,i=new bizagiQueue,a=0,s=0,n=0;n<e.length;n++){var o=t.services.downloadOfflineStartForm({idProcess:e[n]});$.when(o).then((function(){t.triggerOfflineSyncEvent({type:"form-finished",argument:"success"}),a++,l()})).fail((function(){t.triggerOfflineSyncEvent({type:"form-finished",argument:"error"}),s++,l()})),i.add(o)}function l(){s+a==e.length&&(s>0?r.reject():r.resolve())}return $.when(i.execute()).always((function(){l()})),r.promise()},serializeActivities:function(e){for(var t,r={},i=-1,a=new Date,s=e.advanceSearch?this.services.defineActivityStateByTaskState:this.services.defineActivityStateByDate;t=e.rows[++i];){for(var n,o={},l=["","","","","","",[],"","","","","",""],c={},d=-1;n=e.headers[++d];)o[n.fieldName.toLowerCase()]={displayName:n.displayName.trim(),value:t[d]},this.services.isInboxHeaderASystemColumn(n.fieldName)&&(c[n.fieldName]=t[d]),this.services.serializeActivity(l,n.fieldName.toLowerCase(),o[n.fieldName.toLowerCase()]);var u=l,p={};if(p=s(u[3],u.taskstate),u.length>=10&&parseInt(u[11],10)>0){var f=new Date(u[3]);a.getTime()>f.getTime()?p.state="red":a.getTime()>f.getTime()-6e4*parseInt(u[11],10)?p.state="yellow":p.state="green"}u[7]=!!bizagi.util.isEmpty(o.isoffline)||o.isoffline.value;var g=(u=$.extend({},u,p,{endDate:u[3],idworkitem:u[1],idwfclass:bizagi.util.validateFeatureSupport("advancedSearch")?u[10]:u[7],systemColumns:c}))[0]+"-"+u[1];!0===u[7]&&(r[g]=u)}return r},getTasksToDownload:function(e){var t=this,r=new $.Deferred;return $.when(t.services.database.getLocalActivities()).then((function(i){var a={},s=0;if(Object.keys(e).forEach((function(r){var n=e[r],o=i[r];t.taskFormNeedsRefresh(n,o)&&(a[r]={idCase:n[0],idWorkitem:n[1],syncDelda:t.tasksSyncDelta,dataChangeset:n.dataChangeset},s++)})),r.resolve({items:a,count:s}),s>0){var n={type:"fetch-tasks-started",tasks:a};$(document).trigger("offline-notify-form-sync-event",n)}})).fail((function(){r.reject()})),r.promise()},taskFormNeedsRefresh:function(e,t){var r=36e5*this.tasksSyncDelta,i=!1,a=!1,s=!1;return null==t||null==t.dataChangeset||e.dataChangeset!==t.dataChangeset?i=!0:(null==t.lastFullSync||t.lastFullSync+r<Date.now())&&(a=!0),(new Date).getDate()!=(bizagi.util.getSyncTimeStamp()||new Date).getDate()&&(s=!0),i||a||s},processTasksToFetchForms:function(e,t){var r=this,i=new $.Deferred,a=new $.Deferred,s=new bizagiQueue,n=0,o=0,l=0;function c(){if(o+n==l)if(o>0){if(console.log("Download of tasks forms finished with ERRORS"),o>0&&(console.log("[Online] [Download] [Task Case] [Error] => Formas descargadas :",l," => Formas con error :",o),bizagi.util.isNativePluginSupported())){var e={type:"error",description:"[Online] [Download] [Task Case] [Error]",cases_number:o};void 0!==bizagiapp.sendTaskFormDownloadEvent&&bizagiapp.sendTaskFormDownloadEvent(e)}i.reject()}else{if(l>0&&(console.log("[Online] [Download] [Task Case] [Success] => Formas descargadas :",l),bizagi.util.isNativePluginSupported())){var t={type:"success",description:"[Online] [Download] [Task Case] [Success]",cases_number:l};void 0!==bizagiapp.sendTaskFormDownloadEvent&&bizagiapp.sendTaskFormDownloadEvent(t)}i.resolve()}}return($.when(r.db.getOutboxTaskCasesFilteredBySyncStatus("any",!1)).then((function(r){for(var i=0;i<r.length;i++)delete t[r[i].id],delete e[r[i].id];return!0})).then((function(){var e=new $.Deferred;return r.db.dbActivities.allDocs({include_docs:!1},(function(t,r){t?e.reject():e.resolve(r.rows)})),e.promise()})).then((function(t){for(var i=0;i<t.length;i++){localActivityInternalId=t[i].id,!!e[localActivityInternalId]||s.add(r.deleteLocalDataIfActivityWasNotWorked(localActivityInternalId))}a.resolve()})).fail((function(e){console.log("Diff algorithm error",e),a.resolve()})),$.when(a).then((function(){return r.services.database.saveOfflineTasks(e)})).then((function(e){return r.services.downloadOfflineCustomizedColumns(),Object.keys(t).forEach((function(e){var i=e,a=t[i];l++,$.extend(a,{bulkDownload:!0});var d=r.services.downloadOfflineTaskForm(a);$.when(d).then((function(){return r.updateActivityDatachangesetAndSyncTimestamp(i,a.dataChangeset)})).then((function(){r.triggerOfflineSyncEvent({type:"form-finished",argument:"success"}),n++,c()})).fail((function(){r.triggerOfflineSyncEvent({type:"form-finished",argument:"error"}),o++,c()})),s.add(d)})),s.execute()})).then((function(){c()})).fail((function(e){0==l?(i.reject(e),console.log("Error in tasks download's differential algorithm:",e)):c()})),i.promise())},deleteLocalDataIfActivityWasNotWorked:function(e){var t=this,r=new $.Deferred;return $.when(t.db.validateLocalDataForTaskExists(e)).then((function(i){if(i)r.resolve();else{var a={idCase:e.split("-")[0],idWorkitem:e.split("-")[1],deleteAttachments:!0},s=t.db.deleteTaskData(a),n=t.db.deleteTask(a),o=t.db.deleteTaskForm(a);$.when(n,o,s).then((function(){r.resolve()})).fail((function(e,t,i){if(e&&404==e.status&&(e=void 0),t&&404==t.status&&(e=void 0),i&&404==i.status&&(e=void 0),bizagi.util.isEmpty(e)&&bizagi.util.isEmpty(t)&&bizagi.util.isEmpty(i))r.resolve();else{var a={type:"error",errorType:"offlineDiffAlgorithmError",message:"Problem removing local case and data",technicalNote:"Problem in deleteLocalDataIfActivityWasNotWorked",deleteActivityError:e,deleteFormError:t,deleteFullActivityDataError:i};r.reject(a)}}))}})).fail((function(e){r.reject(e)})),r.promise()},getHierarchyObjects:function(e,t,r){var i=[];for(var a in e)e.hasOwnProperty(a)&&("object"==_typeof(e[a])?i=i.concat(this.getHierarchyObjects(e[a],t,r)):a==t&&e[a]==r||a==t&&""==r?i.push(e):e[a]==r&&""==t&&-1==i.lastIndexOf(e)&&i.push(e));return i},saveProcessesHierarchy:function(e){var t=this.db.dbProcessesHierarchy,r={_id:this.globalId,doc:e,lastSynchronization:Date.now()};return bizagi.util.db.saveDocument(t,r)},saveRecentProcesses:function(e){var t=this.db.dbRecentProcesses;return e._id=this.globalId,bizagi.util.db.saveDocument(t,e)},updateActivityDatachangesetAndSyncTimestamp:function(e,t){var r=new $.Deferred,i=this.db.dbActivities;return $.when(bizagi.util.db.getDocument(i,e)).then((function(e){return(null==e.dataChangeset||t>e.dataChangeset)&&(e.dataChangeset=t),e.lastFullSync=Date.now(),bizagi.util.db.saveDocument(i,e)})).then((function(e){r.resolve()})).fail((function(e){r.reject(e)})),r.promise()}}),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.util=void 0!==bizagi.util?bizagi.util:{},bizagi.context=void 0!==bizagi.context?bizagi.context:{},bizagi.util.smartphone=void 0!==bizagi.util.smartphone?bizagi.util.smartphone:{},bizagi.util.tablet=void 0!==bizagi.util.tablet?bizagi.util.tablet:{},bizagi.util.mobility=void 0!==bizagi.util.mobility?bizagi.util.mobility:{},bizagi.util.smartphone.startLoading=function(){bizagi.loading.start()},bizagi.util.smartphone.stopLoading=function(){bizagi.loading.stop()},bizagi.util.mobility.getResource=function(e,t){return bizagi.localization.getResource(e,t)},bizagi.loader.initWebpartOld=bizagi.loader.initWebpart,bizagi.loader.initWebpart=function(e,t,r){return null!=e&&(e.initialized?steal.then((function(){r&&r()})):e.devices?void 0!==e.devices[t]?bizagi.loader.initWebpartOld($.extend(e,e.devices[t]),t,r):console.log("No existe la definicion del device "+t+" Para el webpart "+e.name):bizagi.loader.initWebpartOld(e,t,r)),this},bizagi.util.initWebpart=function(e,t){var r=new $.Deferred;return t=t||bizagi.detectDevice(),e.initialized?r.resolve():e.initializing?$.when(e.loadingDeferred.promise()).done((function(){r.resolve()})):(e.loadingDeferred=new $.Deferred,e.initializing=!0,bizagi.loader.initWebpart(e,t,(function(){e.loadingDeferred.resolve(),e.initializing=!1,r.resolve()}))),r.promise()},bizagi.util.isDate=function(e){var t=!1,r="string"==typeof(e=e||"")?e.split("/"):"";try{if(3==r.length)new Date(e).getYear()>0&&(t=!0)}catch(e){t=!1}return t},bizagi.util.setContext=function(e,t){e=e||{},(t=t||!1)&&(bizagi.context={}),$.each(e,(function(e,t){bizagi.context[e]=t}))},bizagi.getTimeAgo=function(e){return $.timeago(new Date(e))},bizagi.getGroupedData=function(e){var t={},r=new Date,i=r.getFullYear(),a=r.getMonth(),s=r.getDate();e=bizagi.util.isDate(e)?e:r;var n=new Date(e),o=n.getMonth(),l=n.getFullYear(),c=n.getDate();return new Date(l,o,c,0,0,0)-new Date(i,a,s,0,0,0)<0?(t.date=bizagi.util.dateFormatter.formatDate(new Date(n),"dd MMM"),t.type=bizagi.localization.getResource("workportal-taskfeed-overdue"),t.status="red"):s===c?(t.date=bizagi.util.dateFormatter.formatDate(new Date(n),"hh:mm"),t.type=bizagi.localization.getResource("workportal-taskfeed-today"),t.status="yellow"):s+1===c?(t.date=bizagi.util.dateFormatter.formatDate(new Date(n),"hh:mm"),t.type=bizagi.localization.getResource("workportal-taskfeed-tomorrow"),t.status="yellow"):(t.date=bizagi.util.dateFormatter.formatDate(new Date(n),"dd MMM"),t.type=bizagi.localization.getResource("workportal-taskfeed-upcomming"),t.status="green"),t},bizagi.util.getTaskStatus=function(e){var t=new Date,r=t.getMonth(),i=t.getDate(),a=t.getFullYear(),s=e||"";if(!bizagi.util.isDate(s))return"--";var n=new Date(s),o=n.getDate(),l=n.getMonth(),c=n.getFullYear();return new Date(c,l,o,0,0,0)-new Date(a,r,i,0,0,0)<0?bizagi.util.dateFormatter.formatDate(new Date(s),"dd MMM"):r===l&&i===o?bizagi.util.dateFormatter.formatDate(new Date(s),"hh:mm"):r===l&&i+1===o?bizagi.util.dateFormatter.formatDate(new Date(s),"hh:mm"):bizagi.util.dateFormatter.formatDate(new Date(s),"dd MMM")},bizagi.util.formatDataType=function(e,t){return"NText"===t||"VarChar"===t?"<div>"+bizagi.util.replaceLineBreak(e)+"</div>":"Boolean"===t?bizagi.util.formatBoolean(e):"Int"===t||"BigInt"===t||"SmallInt"===t||"TinyInt"===t?e:"Money"===t?bizagi.util.formatMonetaryCell(e):"Float"===t||"Real"===t?bizagi.util.formatDecimalCell(e):"DateTime"===t?bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" "+bizagi.localization.getResource("timeFormat")):e},bizagi.util.formatDateTime=function(e){if(e="string"!=typeof(e=null==e?"":e)?e.toString():e,Date.parse(e)){var t=new Date(e);return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+t.getFullYear()+" "+((t.getHours()<12&&e.toLowerCase().indexOf("pm")>0?t.getHours()+12:t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()))}return e},bizagi.util.formatMonetaryCell=function(e){return bizagi.util.formatMoney(e,BIZAGI_DEFAULT_CURRENCY_INFO)},bizagi.util.formatDecimal=function(e,t){var r=$("<i/>").text(e);return r.formatCurrency&&r.formatCurrency(t),r.text()},bizagi.util.syntaxHighlight=function(e){return void 0===e||null==e?"":(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),"<span class='"+t+"'>"+e+"</span>"}))},bizagi.util.b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))},$.Class.extend("bizagi.workportal.services.context",{},{init:function(e){this.context=e.context,this.endPoints=bizagi.workportal.services.getEndPoints(e),this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix},getUrl:function(e){return void 0===this.endPoints[e]&&bizagi.log("Url not found","No endpoint defined for: "+e),this.endPoints[e]},setProxyPrefix:function(e){this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.endPoints=bizagi.workportal.services.getEndPoints(e)}}),bizagi.workportal=void 0!==bizagi.workportal?bizagi.workportal:{},bizagi.workportal.services=void 0!==bizagi.workportal.services?bizagi.workportal.services:{},bizagi.workportal.services.endPoints=[],bizagi.workportal.services.getEndPoints=function(e){if("workportal"==e.context){var t,r=(_defineProperty(t={"user-handler":e.proxyPrefix+"RestServices/UserHandler.ashx","process-handler":e.proxyPrefix+"RestServices/ProcessHandler.ashx","query-handler":e.proxyPrefix+"Rest/Handlers/Query","case-handler":e.proxyPrefix+"RestServices/CaseHandler.ashx","query-form":e.proxyPrefix+"App/ListaDetalle/QueryForm.aspx","query-form-edit":e.proxyPrefix+"App/ListaDetalle/SaveQuery.aspx","query-form-delete":e.proxyPrefix+"App/ListaDetalle/QueryForm.aspx","query-form-delete-cube":e.proxyPrefix+"Rest/Queries/Cubes/{idCube}","favorites-handler":e.proxyPrefix+"RestServices/FavoritesHandler.ashx","file-handler":e.proxyPrefix+"RestServices/EntityHandler.ashx","login-handler":e.proxyPrefix+"Rest/Users/UserAuthentication","login-handlerv10":e.proxyPrefix+"RestServices/UserHandler.ashx?action=authenticateUser&userName={0}&password={1}&domain={2}","logoff-handler":e.proxyPrefix+"RestServices/UserHandler.ashx?action=logOff","logoff-handlerv1":e.proxyPrefix+"Rest/Users/LogOff","authorization-handler-getMenuAuthorization":e.proxyPrefix+"Rest/Authorization/MenuAuthorization","authorization-handler-isCaseCreationAuthorized":e.proxyPrefix+"Rest/Authorization/Processes/{0}/IsCaseCreationAuthorized","case-handler-getCaseSummary":e.proxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-releaseActivity":e.proxyPrefix+"Rest/Cases/{idCase}/ReleaseActivity","case-handler-getCasesList":e.proxyPrefix+"Rest/Processes/SearchCases","case-handler-getActivityList":e.proxyPrefix+"Api/Cases/Activities","offline-getProcessTree":e.proxyPrefix+"Rest/Processes/OfflineProcessTree","offline-tasks":e.proxyPrefix+"Api/Cases/GetOfflineTasks","offline-getForms":e.proxyPrefix+"Rest/RenderForm/offlineForms","offline-sendForm":e.proxyPrefix+"Rest/Cases/SaveAsynchWorkItemOffLine","case-handler-getCaseTasks":e.proxyPrefix+"Rest/Cases/{idCase}/Tasks","case-handler-getCaseEvents":e.proxyPrefix+"Rest/Cases/{idCase}/Events","case-handler-getCaseSubprocesses":e.proxyPrefix+"Rest/Cases/{idCase}/Subprocesses","case-handler-getTaskAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/Tasks/{idTask}/Assignees","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/Assignees","case-handler-getWorkItems":e.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getAsynchExecutionState":e.proxyPrefix+"Rest/Cases/{idCase}/AsynchExecutionState","case-handler-addNewCase":e.proxyPrefix+"Rest/Cases","case-handler-startProcess":e.proxyPrefix+"Rest/Processes/StartProcess/{idProcess}","handler-execute-action-start":e.proxyPrefix+"Api/Cases/{processId}/Start","case-handler-supportedLogTypes":e.proxyPrefix+"Rest/Cases/SupportedLogsTypes","case-handler-getActivityLog":e.proxyPrefix+"Rest/Cases/{idCase}/ActivityLog","case-handler-getActivityDetailLog":e.proxyPrefix+"Rest/Cases/{idCase}/{idWorkItemFrom}/ActivityDetailLog","case-handler-getEntityLog":e.proxyPrefix+"Rest/Cases/{idCase}/EntityLog","case-handler-getEntityDetailLog":e.proxyPrefix+"Rest/Cases/{idCase}/EntityDetailLog","case-handler-getUserLog":e.proxyPrefix+"Rest/Cases/{idCase}/UserLog","case-handler-getUserDetailLog":e.proxyPrefix+"Rest/Cases/{idCase}/{idUser}/UserDetailLog","case-handler-getAdminLog":e.proxyPrefix+"Rest/Cases/{idCase}/AdminLog","case-handler-getCaseFormsRenderVersion":e.proxyPrefix+"Rest/Cases/{idCase}/FormsRenderVersion","case-handler-validateHasStartForm":e.proxyPrefix+"Api/Processes/{processId}/StartContext","favorites-handler-saveFavorite":e.proxyPrefix+"Rest/Favorites","favorites-handler-deleteFavorite":e.proxyPrefix+"Rest/Favorites/{guidFavorite}","process-getIcon":e.proxyPrefix+"Api/Processes/{processId}/Icon","collections-getIcon":e.proxyPrefix+"Api/CurrentUser/Collections/{collectionId}/Icon","bamAnalytics-handler-getAnalisysQueries":e.proxyPrefix+"Rest/BAMAnalytics/AnalisysQueries","bamAnalytics-handler-updateQuery":e.proxyPrefix+"Rest/BAMAnalytics/Reports/Ids/{idQuery}","inbox-handler-getInboxSummary":e.proxyPrefix+"Rest/Inbox/Summary","inbox-handler-getFullInboxSummary":e.proxyPrefix+"Rest/Inbox/FullSummary","MessageHandler-NewComment":e.proxyPrefix+"Rest/Cases/Comments","MessageHandler-GetComments":e.proxyPrefix+"Rest/Cases/Comments","MessageHandler-SetCategoryToComment":e.proxyPrefix+"Rest/Cases/Comments/{idComment}","MessageHandler-RemoveComment":e.proxyPrefix+"Rest/Cases/Comments/{idComment}","MessageHandler-ReplyComment":e.proxyPrefix+"Rest/Cases/Comments/{idComment}/Replies","MessageHandler-RemoveReply":e.proxyPrefix+"Rest/Cases/Comments/{idComment}/Replies/{idReply}","MessageHandler-GetCategoryColors":e.proxyPrefix+"Rest/Cases/Comments/CategoryColors","MessageHandler-RenameCategoryColor":e.proxyPrefix+"Rest/Cases/Comments/CategoryColors/{idColorCategory}","MessageHandler-CountNewComments":e.proxyPrefix+"Rest/Cases/Comments/{idComment}/NewComments/Count","process-handler-getAllProcesses":e.proxyPrefix+"Rest/Processes","process-handler-getFavourites":e.proxyPrefix+"Rest/Home/MyFavorites/Count","process-handler-getFavouriteCases":e.proxyPrefix+"Rest/Home/MyFavorites","process-handler-getCustomizedColumnsData":e.proxyPrefix+"Rest/Processes/CustomizedColumnsData","process-handler-getCategory":e.proxyPrefix+"Rest/Processes/Categories","process-handler-getRecentProcesses":e.proxyPrefix+"Rest/Processes/RecentProcesses","process-handler-getCustomizedColumnsDataInfo":e.proxyPrefix+"Rest/Processes/CustomizedColumnsDataInfo","process-handler-getOrganizations":e.proxyPrefix+"Rest/Profile/Organizations","process-handler-getOrganizationsByUser":e.proxyPrefix+"Rest/Profile/OrganizationsByUser","smartinbox-entity-values":e.proxyPrefix+"api/SmartInbox/Detail/EntityValues/{entityGuid}","smartinbox-getAllInbox":e.proxyPrefix+"api/SmartInbox/All","smartinbox-user-tasks":e.proxyPrefix+"api/SmartInbox/Detail/UserTasks/{smartInboxId}","smartinbox-user-tasks-process":e.proxyPrefix+"api/SmartInbox/Detail/UserTasks/ByProcess/{workflowId}","process-handler-getMyStuff":e.proxyPrefix+"Api/CurrentUser/Collections","process-handler-getIdCasesOfProcessEntities":e.proxyPrefix+"Api/Entities/Cases","templates-handler-getCollectionData":e.proxyPrefix+"Api/Collection/{idFact}/Data","data-navigation-handler-collection":e.proxyPrefix+"Api/CurrentUser/Collections/{reference}/Data/{surrogateKey}","data-navigation-handler-entity":e.proxyPrefix+"Api/CurrentUser/Entities/{reference}/Data/{surrogateKey}/{xpath}","data-navigation-handler-entity-filters":e.proxyPrefix+"Api/CurrentUser/Entities/{reference}/Filters/{surrogateKey}/{xpath}","action-handler-getProcessAddAction":e.proxyPrefix+"Api/CurrentUser/Collections/{reference}/{surrogateKey}/Actions","my-search-getSearchLists":e.proxyPrefix+"Api/CurrentUser/Searches","my-search-getFilters":e.proxyPrefix+"Api/CurrentUser/Searches/{guidSearch}/Filters","my-search-getFiltersData":e.proxyPrefix+"Api/CurrentUser/Searches/{guidSearch}/FilterData","my-search-getData":e.proxyPrefix+"Api/CurrentUser/Searches/{guidSearch}/Data","templates-handler-getVirtualCollectionData":e.proxyPrefix+"Api/Collection/{guidVirtualCollection}/VirtualData","templates-handler-getMultipleActions":e.proxyPrefix+"Rest/Entities/multipleInstancesActions","process-handler-getMapping":e.proxyPrefix+"Rest/Entities/Mapping","process-handler-getForm":e.proxyPrefix+"Rest/Handlers/Render","process-handler-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","process-handler-rule":e.proxyPrefix+"Api/Rules/{ruleId}/Execute","process-action-execute":e.proxyPrefix+"Api/Rules/{ruleId}/ExecuteMultiple","process-handler-getActivitiesData":e.proxyPrefix+"Api/Processes/CasesData/MyActivities","process-handler-getPendingsData":e.proxyPrefix+"Api/Processes/CasesData/MyPendings","entities-handler-getActions":e.proxyPrefix+"Api/Entities/{guidEntity}/{surrogateKey}/actions","entities-handler-getUsersAndEvents":e.proxyPrefix+"Rest/Processes/CasesData/UsersAndEvents","entities-handler-getUsers":e.proxyPrefix+"Api/Cases/{caseId}/Users","entities-handler-getEvents":e.proxyPrefix+"Api/Cases/{caseId}/CurrentEvents","entities-handler-getUsersImages":e.proxyPrefix+"Rest/Users/UserPictures","entities-handler-getShotCuts":e.proxyPrefix+"Api/CurrentUser/Shortcuts","query-handler-getqueries":e.proxyPrefix+"Rest/Queries","query-handler-getQueryForm":e.proxyPrefix+"Rest/Handlers/Render","user-handler-getCurrentUser":e.proxyPrefix+"Rest/Users/CurrentUser","old-render":e.proxyPrefix+"App/ListaDetalle/Detalle.aspx",Reports:e.proxyPrefix+"RestServices/BAMAnalyticsHandler.ashx","reports-handler-deleteQueries":e.proxyPrefix+"Rest/BAMAnalytics/Reports/{QueryId}","folders-handler-getUserQueries":e.proxyPrefix+"Rest/SmartFolders","folders-associate-deleteSmartFolder":e.proxyPrefix+"Rest/SmartFolders/{idSmartFolder}","folders-handler":e.proxyPrefix+"RestServices/SmartFoldersHandler.ashx","folders-associate":e.proxyPrefix+"App/Ajax/AJAXGateway.aspx","smartfolders-integration":e.proxyPrefix+"App/WorkPortal/ConfigureFilteredFolder.aspx",AlarmAdmin:e.proxyPrefix+"App/Admin/AlarmsAdmin.aspx",AnalyticsProcess:e.proxyPrefix+"App/Cockpit/AnalyticsProcess.aspx",AnalyticsSensor:e.proxyPrefix+"App/Cockpit/AnalyticsSensor.aspx",AnalyticsTask:e.proxyPrefix+"App/Cockpit/AnalyticsTask.aspx",AsynchronousWorkitemRetries:e.proxyPrefix+"App/Admin/AsynchDisabledWorkitems.aspx",AuthenticationLogQuery:e.proxyPrefix+"App/Admin/AuthLogQuery.aspx",BAMProcess:e.proxyPrefix+"App/Cockpit/BAMProcess.aspx",BAMTask:e.proxyPrefix+"App/Cockpit/BAMTask.aspx",BusinessPolicies:e.proxyPrefix+"App/Admin/BusinessPolicies/BusinessPoliciesSelector.aspx",CaseAdmin:e.proxyPrefix+"App/Admin/CaseSearch.aspx",adminReassignCases:"CaseAdmin",asyncECMUpload:"asyncECMUpload",CasesMonitor:e.proxyPrefix+"App/Admin/CasesMonitor.aspx",Closed:e.proxyPrefix+"App/ListaDetalle/listaitems.aspx?h_Location=Cerrados&I_ProcessState=Completed",CurrentUser:e.proxyPrefix+"App/Admin/CurrentUser.aspx",EncryptionAdmin:e.proxyPrefix+"App/Admin/Encrypt.aspx",MobileUpdatesAdmin:e.proxyPrefix+"App/MobileUpdates/default.aspx",EntityAdmin:e.proxyPrefix+"App/Admin/Entity.aspx",LocationResources:e.proxyPrefix+"App/Admin/AdminLocResources.aspx",NewCase:e.proxyPrefix+"App/Radicar/application.aspx",Pending:e.proxyPrefix+"App/ListaDetalle/listaitems.aspx?h_Location=Pendientes&I_processState=Running",Profiles:e.proxyPrefix+"App/Admin/ProfilesAdminSearch.aspx",Search:e.proxyPrefix+"App/ListaDetalle/Search.aspx",UserAdmin:e.proxyPrefix+"App/Admin/ListUsers.aspx",UserDefaultAssignation:e.proxyPrefix+"App/Admin/DefaultAssignationUser.aspx?h_AdminDefaultAssign=1",UserPendingRequests:e.proxyPrefix+"App/Admin/UserPendingRequests.aspx",ListPreferences:""!==bizagi.UserPreferencesUrl?e.proxyPrefix+bizagi.UserPreferencesUrl:e.proxyPrefix+"App/Admin/CurrentUser.aspx",GRDimensionAdmin:e.proxyPrefix+"App/Cockpit/DimensionEdit.aspx",Licenses:e.proxyPrefix+"App/Admin/Licenses.aspx",AnalysisQueries:e.proxyPrefix+"App/Inicio/WPAnalysisQuery.aspx",DocumentTemplates:e.proxyPrefix+"App/Admin/AdminDocumentTemplates.aspx",ProcessAdmin:e.proxyPrefix+"App/Admin/AdminProcess.aspx",ResourceBAM:e.proxyPrefix+"App/Cockpit/BAMResourceMonitor.aspx",WorkPortalVersion:e.proxyPrefix+"Rest/Util/Version","entities-administration":"RestServices/EntityHandler.ashx","theme-handler-getLogoImagePath":e.proxyPrefix+"Rest/Theme/LogoImage",logout:e.proxyPrefix+"Rest/Authentication/logout",logoutDotNet:e.proxyPrefix+"App/Inicio/LogOff.aspx",authenticationConfig:e.proxyPrefix+"Api/Authentication/BizagiConfig","logout-oauth2":e.proxyPrefix+"Api/Authentication/OAuth2/IdentityProvider/Server/Logout",FederateLogoffUrl:e.proxyPrefix+"Api/Authentication/FederateLogoffUrl",oauth2AuthenticationConfig:e.proxyPrefix+"Api/Authentication/OAuth2/OAuth2AuthenticationConfig","massive-activity-assignments-getOrganizationInfo":e.proxyPrefix+"Rest/Users/OrganizationInfo","massive-activity-assignments-getCasesByOrganization":e.proxyPrefix+"Rest/Queries/GetCasesByOrganization","massive-activity-assignments-reassignCases":e.proxyPrefix+"Rest/Cases/ReassignCases","massive-activity-assignments-searchUsers":e.proxyPrefix+"Rest/Users/","async-ecm-upload-baseService":e.proxyPrefix+"Rest/Handlers/Metadata",domains:e.proxyPrefix+"Rest/Authentication/Domains",getCurrentTheme:e.proxyPrefix+"Api/Theme/Current","admin-getAuthenticationLog":e.proxyPrefix+"Rest/Users/AuthLog","admin-getAuthenticationDomains":e.proxyPrefix+"Rest/Users/Domains","admin-getAuthenticationEventsTypes":e.proxyPrefix+"Rest/Users/EventTypes","admin-getAuthenticationEventSubTypes":e.proxyPrefix+"Rest/Users/EventSubTypes","admin-EncryptString":e.proxyPrefix+"Rest/Util/EncryptString","admin-UserPendingRequests":e.proxyPrefix+"Rest/Users/UserPendingRequests","admin-UserAuthenticationInfo":e.proxyPrefix+"Rest/Users/UserAuthenticationInfo","admin-updateUserAuthenticationInfo":e.proxyPrefix+"Rest/Users/UpdateUserAuthenticationInfo","admin-generateRandomPassword":e.proxyPrefix+"Rest/Util/GenerateRandomPassword","admin-GenerateDataToSendByEmail":e.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendEmail":e.proxyPrefix+"Rest/Util/SendEmail/","admin-getApplicationList":e.proxyPrefix+"Rest/Application","admin-getApplicationProcesses":e.proxyPrefix+"Rest/Application/{idApp}/Process","admin-getProcessVersion":e.proxyPrefix+"Rest/Processes/Version","admin-getProcessTasks":e.proxyPrefix+"Rest/Processes/Version/{version}/Tasks","admin-getTaskAlarms":e.proxyPrefix+"Rest/Alarm/TaskAlarms","admin-getLapseMode":e.proxyPrefix+"Rest/Alarm/LapseMode","admin-getRecurrMode":e.proxyPrefix+"Rest/Alarm/RecurrMode","admin-getScheduleType":e.proxyPrefix+"Rest/Alarm/ScheduleType","admin-getBossList":e.proxyPrefix+"Rest/Alarm/Boss","admin-addAlarm":e.proxyPrefix+"Rest/Alarm","admin-editAlarm":e.proxyPrefix+"Rest/Alarm/{idAlarm}","admin-deleteAlarm":e.proxyPrefix+"Rest/Alarm","admin-alarmRecipients":e.proxyPrefix+"Rest/Alarm/{idAlarm}/Recipient","admin-deleteAlarmRecipients":e.proxyPrefix+"Rest/Alarm/Recipient","admin-recipientToAlarm":e.proxyPrefix+"Rest/Alarm/{idAlarm}/Recipient/{idRecipient}","admin-enableAlarm":e.proxyPrefix+"Rest/Alarm/Task/{idTask}/ToggleAlarm","admin-getCategoriesList":e.proxyPrefix+"Rest/Application/Category","admin-getCasesList":e.proxyPrefix+"Rest/Queries/SearchCases","admin-abortItems":e.proxyPrefix+"Rest/Cases/Abort","admin-reassignItems":e.proxyPrefix+"Rest/Cases/Reassign","admin-getDefaultAssignationUserToAllProcess":e.proxyPrefix+"Rest/Users/{serviceAction}/","admin-getDefaultAssignationUserToProcess":e.proxyPrefix+"Rest/Users/Process/{process}/AssignationUser","admin-setDefaultAssignationUserToProcess":e.proxyPrefix+"Rest/Users/Process/{process}/AssignationUser","admin-getProfilesTypes":e.proxyPrefix+"Rest/Profile/Types","admin-searchProfiles":e.proxyPrefix+"Rest/Profile","admin-getUsersByProfile":e.proxyPrefix+"Rest/Users/Profile/{type}/{id}","admin-removeUserFromProfile":e.proxyPrefix+"Rest/Profile/{type}/{id}/User/{idUser}/","admin-addUserToProfile":e.proxyPrefix+"Rest/Profile/{type}/{id}/User/{idUser}/","admin-async-activities-get-activities":e.proxyPrefix+"Rest/Cases/Asynchronous/Activities","admin-async-activities-get-retry-now":e.proxyPrefix+"Rest/Cases/{idCase}/Workitem/{idworkItem}/RetryNow","admin-async-activities-get-activities-by-task":e.proxyPrefix+"Rest/Cases/Asynchronous/Activities/Task","admin-async-activities-enable-execution":e.proxyPrefix+"Rest/Cases/Asynchronous/Enable","admin-async-activities-enable-multiple":e.proxyPrefix+"Rest/Cases/Asynchronous/EnableMultiple","admin-async-activities-async-execution":e.proxyPrefix+"Rest/Cases/{idCase}/Workitem/{idWorkitem}/AsynchExecution","admin-async-activities-async-execution-log":e.proxyPrefix+"Rest/Cases/{idCase}/Workitem/{idworkItem}/AsynchExecutionLog","admin-Licenses":e.proxyPrefix+"Rest/Licenses","admin-GetDimensions":e.proxyPrefix+"Rest/Dimensions","admin-EditDimension":e.proxyPrefix+"Rest/Dimensions/{id}","admin-CreateAdministrableDimension":e.proxyPrefix+"Rest/Dimensions/Administrable","admin-DeleteDimension":e.proxyPrefix+"Rest/Dimensions/{id}?isAdministrable={administrable}","admin-EntityPathChildNodesAction":e.proxyPrefix+"Rest/Dimensions/EntityChildNodes","admin-GetActiveWFClasses":e.proxyPrefix+"Rest/Dimensions/ActiveProcess","admin-document-templates-storeDocumentTemplates":e.proxyPrefix+"Rest/DocumentTemplates/StoreDocumentTemplates","admin-document-templates-restoreDocumentTemplates":e.proxyPrefix+"Rest/DocumentTemplates/RestoreDocumentTemplate","admin-document-templates-uploadDocumentTemplate":e.proxyPrefix+"Rest/DocumentTemplates/UploadDocumentTemplate","admin-processes-workflowClasses":e.proxyPrefix+"Rest/Processes/WorkflowClasses","admin-processes-tasksByWorkflow":e.proxyPrefix+"Rest/Processes/TasksByWorkflow","admin-processes-modifyProcessDuration":e.proxyPrefix+"Rest/Processes/{idWorkflow}/Duration/","admin-processes-modifyTaskDuration":e.proxyPrefix+"Rest/Processes/Task/{idTask}/Duration/","admin-language-resource":e.proxyPrefix+"Rest/Multilanguage/Resource","admin-language-languages":e.proxyPrefix+"Rest/Multilanguage/Languages","bam-resourcemonitor-myteam":e.proxyPrefix+"Rest/Reports/BAM/Resources/MyTeam","reports-analysisquery":e.proxyPrefix+"Rest/Reports/AnalysisQueries","reports-analysisquery-update":e.proxyPrefix+"Rest/Reports/AnalysisQueries","reports-analysisquery-delete":e.proxyPrefix+"Rest/Reports/AnalysisQueries","processviewer-processdefinition":e.proxyPrefix+"Rest/Reports/Components/ProcessDefinition","processviewer-processgraphicinfo":e.proxyPrefix+"Rest/Reports/Components/ProcessGraphicInfo","mobile-getLastUpdate":e.proxyPrefix+"Rest/Util/mobileUpdates","discussion-case":e.proxyPrefix+"Api/CaseResource/Discussion?globalParent={globalParent}","discussion-case-v1":e.proxyPrefix+"Api/CaseResource/{globalParent}/Discussion","get-users":e.proxyPrefix+"Rest/Users/UserPictures","new-discussion":e.proxyPrefix+"Api/CaseResource/Discussion","count-comments":e.proxyPrefix+"Api/CaseResource/{idParent}/Comment/Count","comment-case":e.proxyPrefix+"Api/CaseResource/{idParent}/Comment","new-comment":e.proxyPrefix+"Api/CaseResource/Comment","new-comment-attach":e.proxyPrefix+"Api/CaseResource/Attachment","get-list-files":e.proxyPrefix+"Api/CaseResource/File?globalParent={globalParent}","get-list-files-v1":e.proxyPrefix+"Api/CaseResource/{globalParent}/File","project-resource-action":e.proxyPrefix+"Api/CaseResource/{typeResource}","thumbnail-file":e.proxyPrefix+"Api/CaseResource/File/Thumbnails?globalParent={globalParent}","get-attachment":e.proxyPrefix+"Api/CaseResource/Attachment/{idAttachment}","get-mobile-attachment":e.proxyPrefix+"Api/CaseResource/Mobile/Attachment/{idAttachment}","project-files-upload":e.proxyPrefix+"Api/CaseResource/File","count-files":e.proxyPrefix+"Api/CaseResource/File/Count?globalParent={globalParent}","count-files-v1":e.proxyPrefix+"Api/CaseResource/{globalParent}/File/Count","remove-comment":e.proxyPrefix+"Api/CaseResource/Comment","time-schemas-effectiveduration":e.proxyPrefix+"Api/WorkingTimeSchema/EffectiveDuration?idUser={idUser}&fromDate={fromDate}&toDate={toDate}"},"case-handler-getCaseAssignees",e.proxyPrefix+"Rest/Cases/{idCase}/Assignees"),_defineProperty(t,"project-users-get",e.proxyPrefix+"Rest/Users/UserPictures"),_defineProperty(t,"case-summary-task-options",e.proxyPrefix+"Rest/Cases/WorkItems/{idWorkitem}/TaskOptions?idCase={idCase}"),_defineProperty(t,"project-plan-get",e.proxyPrefix+"Api/Plans/{idPlan}"),_defineProperty(t,"project-plan-activities",e.proxyPrefix+"Api/Plans/{idPlan}/Activities"),_defineProperty(t,"project-plan-workitems",e.proxyPrefix+"Api/Plans/{idPlan}/WorkItems"),_defineProperty(t,"project-plan-transitions-get",e.proxyPrefix+"Api/Plans/{idPlan}/Activities/Transitions"),_defineProperty(t,"project-plan-activity-edit",e.proxyPrefix+"Api/Plans/{idPlan}/Activities/{id}"),_defineProperty(t,"project-plan-get-by-parent",e.proxyPrefix+"Api/Plans?parentWorkItem={parentWorkItem}"),_defineProperty(t,"project-plan-parent",e.proxyPrefix+"Api/Plans/{idPlan}/ParentCase"),_defineProperty(t,"project-plan-update",e.proxyPrefix+"Api/Plans/{idPlan}"),_defineProperty(t,"project-plan-execute",e.proxyPrefix+"Api/Plans/Execute"),_defineProperty(t,"project-plan-close",e.proxyPrefix+"Api/Plans/Close"),_defineProperty(t,"project-plan-delete",e.proxyPrefix+"Api/Plans/{idPlan}"),_defineProperty(t,"project-plan-first-parent-plan",e.proxyPrefix+"Api/Plans/{idPlan}/FirstParentPlan"),_defineProperty(t,"PreferencesWorkportalCurrentUser",e.proxyPrefix+"Api/Users/Data/WindowPreferences"),_defineProperty(t,"diagnostics-sync-system-error",e.proxyPrefix+"api/ErrorLogs/Import"),t);return bizagi.util.getFeatureObject("userService.v1.enabled")&&(r["user-handler-getCurrentUser"]=e.proxyPrefix+"Rest/Users/CurrentUserGuid",r["get-users"]=e.proxyPrefix+"Rest/Users/UserPicturesGuid",r["entities-handler-getUsersImages"]=e.proxyPrefix+"Rest/Users/UserPicturesGuid",r["project-users-get"]=e.proxyPrefix+"Rest/Users/UserPicturesGuid",r["entities-handler-getUsers"]=e.proxyPrefix+"Api/Cases/{caseId}/UsersGuid",r["case-handler-getCaseSummary"]=e.proxyPrefix+"Rest/Cases/{idCase}/SummaryGuid",r["case-handler-getCaseAssignees"]=e.proxyPrefix+"Rest/Cases/{idCase}/AssigneesGuid",r["discussion-case"]=e.proxyPrefix+"Api/CaseResource/DiscussionGuid?globalParent={globalParent}",r["new-discussion"]=e.proxyPrefix+"Api/CaseResource/DiscussionGuid",r["comment-case"]=e.proxyPrefix+"Api/CaseResource/{idParent}/CommentGuid",r["new-comment"]=e.proxyPrefix+"Api/CaseResource/CommentGuid",r["project-files-upload"]=e.proxyPrefix+"Api/CaseResource/FileGuid",r["get-list-files"]=e.proxyPrefix+"Api/CaseResource/FileGuid?globalParent={globalParent}",r["time-schemas-effectiveduration"]=e.proxyPrefix+"Api/WorkingTimeSchema/EffectiveDurationGuid?idUser={idUser}&fromDate={fromDate}&toDate={toDate}",r["project-plan-get"]=e.proxyPrefix+"Api/Plans/Guid/{idPlan}",r["project-plan-update"]=e.proxyPrefix+"Api/Plans/Guid/{idPlan}",r["project-plan-activities"]=e.proxyPrefix+"Api/Plans/{idPlan}/ActivitiesGuid",r["project-plan-workitems"]=e.proxyPrefix+"Api/Plans/{idPlan}/WorkItemsGuid",r["project-plan-first-parent-plan"]=e.proxyPrefix+"Api/Plans/{idPlan}/FirstParentPlanGuid",r["project-plan-activity-edit"]=e.proxyPrefix+"Api/Plans/{idPlan}/ActivitiesGuid/{id}"),r}return{}},$.Class.extend("bizagi.workportal.services.service",{BA_CONTEXT_PARAMETER_PREFIX:"h_",ENTITIES_QUERY_PAGE_SIZE:10},{init:function(e){(e="object"==_typeof(e)?e:{}).context=bizagi.util.isEmpty(e.context)?"workportal":e.context,e.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,e.proxyPrefix=this.normalizeUrl(e.proxyPrefix),bizagi.RPproxyPrefix=e.proxyPrefix,e.sharepointProxyPrefix=bizagi.util.isEmpty(e.sharepointProxyPrefix)?"":e.sharepointProxyPrefix,e.sharepointProxyPrefix=this.normalizeUrl(e.sharepointProxyPrefix),this.serviceLocator=new bizagi.workportal.services.context(e),this.pageSize=10,this.deviceType=e.deviceType||(bizagi.util.isSmartphoneDevice()?bizagi.deviceEnum.smartphone:bizagi.util.isTabletDevice()?bizagi.deviceEnum.tablet:bizagi.deviceEnum.desktop),this.deviceCode=bizagi.util.getDeviceCode(),"undefined"!=typeof BIZAGI_INBOX_ROWS_PER_PAGE&&(this.pageSize=$.isNumeric(BIZAGI_INBOX_ROWS_PER_PAGE)?BIZAGI_INBOX_ROWS_PER_PAGE:this.pageSize),this.activeForm=void 0,this.configureGlobalHandlers()},getUrl:function(e){return this.serviceLocator.getUrl(e.endPoint)},normalizeUrl:function(e){return""!==e&&("/"!=e[e.length-1]&&(e=e.concat("/")),-1==e.indexOf("http://")&&-1==e.indexOf("https://")&&(e="http://"+e)),e},getOverrides:function(){return $.ajax({url:this.serviceLocator.getUrl("overrides")}).pipe((function(e){return e=e||{},$.each(e,(function(t,r){var i=r.toUpperCase();"TRUE"!=i&&"FALSE"!=i||(e[t]=bizagi.util.parseBoolean(r))})),e}))},getCurrentTheme:function(){var e=this.serviceLocator.getUrl("getCurrentTheme");return $.read(e)},authenticatedUser:function(e){var t=this,r=t.serviceLocator.getUrl("login-handler");return $.read({url:r,data:{userName:BIZAGI_USER,password:BIZAGI_PASSWORD,domain:BIZAGI_DOMAIN}}).pipe((function(e){return e}),(function(e){return r=(r=(r=(r=t.serviceLocator.getUrl("login-handlerv10")).replace("{0}",BIZAGI_USER||"")).replace("{1}",BIZAGI_PASSWORD||"")).replace("{2}",BIZAGI_DOMAIN||""),$.ajax({url:r,type:"GET",dataType:"json"})}))},logoutUser:function(e){var t=this.serviceLocator.getUrl("logoff-handlerv1");return $.read({url:t})},logOffUser:function(e){var t=this.serviceLocator.getUrl("logoff-handler");return $.read({url:t})},getCurrentUser:function(e){return $.read(this.serviceLocator.getUrl("user-handler-getCurrentUser"))},getInboxSummary:function(e){return $.read(this.serviceLocator.getUrl("inbox-handler-getInboxSummary")).pipe((function(e){return e.inboxSummary}))},getAllProcesses:function(e){var t=this;e=e||{};var r={},i=t.serviceLocator.getUrl("process-handler-getAllProcesses");return null!=e.taskState&&(r.taskState=e.taskState),null!=e.onlyFavorites&&""!=e.onlyFavorites&&(r.onlyFavorites=e.onlyFavorites),null!=e.myActivities&&""!=e.myActivities&&(r.myActivities=e.myActivities),null!=e.myPendings&&""!=e.myPendings&&(r.myPendings=e.myPendings),e.smartfoldersParameters&&(i=i+"?"+e.smartfoldersParameters),bizagi.isMobile()&&(r.mobileDevice=!0),$.read(i,r).pipe((function(r){if(e.skipAggrupate)return t.includeAllProcessesItem(r),r;var i={},a={},s=bizagi.localization.getResource("workportal-widget-inbox-all-processes"),n={name:bizagi.localization.getResource("workportal-widget-inbox-all-cases"),path:"",category:s,isFavorite:e.onlyFavorites||!1,guidFavorite:"",idworkflow:"",guidWFClass:"",count:0};for(key in a[s]=[],a[s].workflows=[],a[s].workflows.push(n),r.workflows&&$.each(r.workflows.workflow,(function(e,t){a[t.category]||(a[t.category]=[],a[t.category].workflows=[]),a[t.category].workflows.push(t),n.count+=Number(t.count)})),i.categories=[],a)i.categories.push({name:key,workflows:a[key].workflows});return i}))},getUserWorkportalPreferences:function(){var e=this,t=new $.Deferred;return void 0!==e._userPreferences?t.resolve(e._userPreferences):e.getPreferencesWorkportalCurrentUser().done((function(r){e._userPreferences=bizagi.util.tryCatch((function(){return r.workportal}),{}),bizagi.util.storeMobileFeatures({userPreferences:e._userPreferences}),t.resolve(e._userPreferences)})).fail((function(e){console.error(e),t.resolve({})})),t},getUserPreferences:function(e){var t=bizagi.util.getMobileFeatures(),r=t||{},i=r.userPreferences?r.userPreferences:{},a=this._userPreferences||i;return void 0===e?a:a[e]},getLastProcessInboxWorkflow:function(){var e=new $.Deferred,t=bizagi.util.getLastProcessInboxProcessInfo();return 0==bizagi.util.validateFeatureSupport("defaultInboxEnabled")||0==bizagi.util.isMobileInboxByProcessSupported()?(-1!=t.idWorkflow&&bizagi.util.setLastProcessInbox(t.processInfoName,t.idWorkflow),e.resolve(t)):$.when(this.getUserWorkportalPreferences(),this.getAllProcesses({taskState:"all",onlyFavorites:!1,inputtray:"inbox",skipAggrupate:!0,mobileDevice:!0}),this.getAllSmartInbox()).then((function(r,i,a){var s=t.idWorkflow,n=t.smartInboxId,o=parseInt(r.defaultOpenInboxWorkflowId),l=r.defaultOpenInboxSmartInboxId,c=o>0,d=!bizagi.util.isEmpty(l);if(-1==s&&c&&bizagi.util.isEmpty(n)?(s=o,n=null):bizagi.util.isEmpty(n)&&d&&-1==s&&(n=l,s=-1),i&&i.workflows&&-1!=s){var u=$.first(i.workflows.workflow,(function(e){return e.idworkflow==s}));u?bizagi.util.setLastProcessInbox(u.name,s):bizagi.util.setLastProcessInbox(null,-1)}else if(a&&a.length>0&&!bizagi.util.isEmpty(n)){var p=$.first(a,(function(e){return e.id==n}));p?bizagi.util.setLastProcessInbox(p.name,-1,n):bizagi.util.setLastProcessInbox(null,-1)}e.resolve(bizagi.util.getLastProcessInboxProcessInfo())})).fail((function(){e.reject("Error in bizagi.workportal.services.service.getLastProcessInboxWorkflow")})),e.promise()},getFavourites:function(){var e=this.serviceLocator.getUrl("process-handler-getFavourites");return $.read(e,{}).pipe((function(e){return e}))},getMyStuff:function(e){var t={},r=this.serviceLocator.getUrl("process-handler-getMyStuff");return void 0!==e.icon&&e.icon&&(t.icon=!0),$.read(r,t)},getFavouriteCases:function(e){var t={},r=this.serviceLocator.getUrl("process-handler-getFavouriteCases");return t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,bizagi.isMobile()&&(t.mobileDevice=!0),$.read(r,t).pipe((function(e){return e}))},getCasesList:function(e){var t={},r=this.serviceLocator.getUrl("case-handler-getCasesList");return e=e||{},t.pageSize=e.pageSize||10,t.page=e.page||1,t.numberOfFields=e.numberOfFields||"-1",t.idWfClass=e.idWfClass||"-1",$.read(r,t).pipe((function(e){for(var t={overdue:[],today:[],tomorrow:[],upcoming:[],page:e.page,totalPages:e.totalPages},r=new Date,i=r.getMonth(),a=r.getDate(),s=r.getYear(),n=void 0!==e.elements?e.elements.length:0,o=0;n>o;o++){var l=e.elements[o],c=new Date(l[3]),d=c.getDate(),u=c.getMonth(),p=c.getYear();a>d||i>u||s>p?(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"dd MMM yyyy"),t.overdue.push(l)):a==d?(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"hh:mm"),t.today.push(l)):a+1==d?(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"hh:mm"),t.tomorrow.push(l)):(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"dd MMM yyyy"),t.upcoming.push(l))}return t}))},getCasesListBeta:function(e){var t=this;return t.getMobileCasesList(e).then((function(e){return t.adapterDataOfActivitiesToTemplate(e)}))},getMobileCasesList:function(e){var t=this,r={};if(e=e||{},bizagi.util.validateFeatureSupport("advancedSearch"))return $.when(t.getMobileActivities(e)).then((function(e){for(var r,i={elements:[],rows:[]},a=-1;r=e.rows[++a];){for(var s,n={},o=["","","","","","",[],"","","","","",""],l=-1;s=e.headers[++l];)n[s.fieldName.toLowerCase()]={displayName:s.displayName,value:r[l]},t.serializeActivity(o,s.fieldName.toLowerCase(),n[s.fieldName.toLowerCase()]);e.syncErrors&&(t.appendActivityElementSyncError(o,e.syncErrors),t.appendActivityRowsSyncError(n,e.syncErrors)),i.elements.push(o),i.rows.push(n)}return{page:e.page||e.currentPage,totalPages:e.totalPages,elements:i.elements,rows:i.rows,advanceSearch:!0}}));var i=t.serviceLocator.getUrl("case-handler-getCasesList");return void 0!==e.radNumber&&(r.radNumber=e.radNumber),r.pageSize=e.pageSize||10,r.page=e.page||1,r.numberOfFields=e.numberOfFields||"-1",r.idWfClass=e.idWfClass||"-1",$.read(i,r)},adapterDataOfActivitiesToTemplate:function(e){for(var t={elements:[],page:e.page,totalPages:e.totalPages,advanceSearch:e.advanceSearch||!1,headers:e.headers,rows:e.rows},r=new Date,i=e.advanceSearch?this.defineActivityStateByTaskState:this.defineActivityStateByDate,a=0;e.elements.length>a;a++){var s=e.elements[a],n={};if(n=i(s[3],s.taskstate),s.length>=10&&parseInt(s[11],10)>0){var o=new Date(s[3]);r.getTime()>o.getTime()?n.state="red":r.getTime()>o.getTime()-6e4*parseInt(s[11],10)?n.state="yellow":n.state="green"}t.elements.push($.extend({},s,n,{endDate:s[3],idworkitem:s[1],idwfclass:bizagi.util.validateFeatureSupport("advancedSearch")?s[10]:s[7]}))}return t},adapterServerResponseTemplateBindingObject:function(e){for(var t,r={elements:[],rows:[]},i=-1;t=e.rows[++i];){for(var a,s={},n=["","","","","","",[],"","","","","",""],o=-1;a=e.headers[++o];)s[a.fieldName.toLowerCase()]={displayName:a.displayName,value:t[o]},this.serializeActivity(n,a.fieldName.toLowerCase(),s[a.fieldName.toLowerCase()]);e.syncErrors&&(this.appendActivityElementSyncError(n,e.syncErrors),this.appendActivityRowsSyncError(s,e.syncErrors)),r.elements.push(n),r.rows.push(s)}return{page:e.page||e.currentPage,totalPages:e.totalPages,elements:r.elements,rows:r.rows,advanceSearch:!0,headers:e.headers}},defineActivityStateByDate:function(e){var t={};if(e){var r=new Date(e),i=new Date,a=new Date(i.getFullYear(),i.getMonth(),i.getDate());t=r.getTime()<a.getTime()?{group:"1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),state:"red",type:"overdue",icon:"overdue",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))}:r.getTime()<i.getTime()+6e4?{group:"2|"+bizagi.localization.getResource("workportal-taskfeed-today"),state:"red",type:"today",icon:"overdue",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))}:r.getTime()<a.getTime()+864e5?{group:"2|"+bizagi.localization.getResource("workportal-taskfeed-today"),state:"yellow",type:"today",icon:"ontime",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))}:r.getTime()<a.getTime()+1728e5?{group:"3|"+bizagi.localization.getResource("workportal-taskfeed-tomorrow"),state:"green",type:"tomorrow",icon:"upcoming",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))}:{group:"4|"+bizagi.localization.getResource("workportal-taskfeed-upcomming"),state:"green",type:"upcoming",icon:"upcoming",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))}}else t={group:"1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),state:"red",type:"overdue",shortEndDate:"--",icon:"overdue"};return t},defineActivityStateByTaskState:function(e,t){var r={group:"1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),state:t,type:"overdue",shortEndDate:"--",icon:"overdue"};if(e&&t){var i=new Date(e),a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(r={group:"",state:t,type:"",icon:"",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" | "+bizagi.localization.getResource("timeFormat"))},i.getTime()<s.getTime()?(r.group="1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),r.type="overdue"):i.getTime()<s.getTime()+864e5?(r.group="2|"+bizagi.localization.getResource("workportal-taskfeed-today"),r.type="today"):i.getTime()<s.getTime()+1728e5?(r.group="3|"+bizagi.localization.getResource("workportal-taskfeed-tomorrow"),r.type="tomorrow"):(r.group="4|"+bizagi.localization.getResource("workportal-taskfeed-upcomming"),r.type="upcoming"),t){case"green":r.icon="upcoming";break;case"yellow":r.icon="ontime";break;case"red":default:r.icon="overdue"}}return r},serializeActivity:function(e,t,r){switch(t){case"radnumber":e[6].push([r.displayName,r.value]),e.radNumber=r.value;break;case"wfclsdisplayname":e[4]=null!=r.value?r.value.toString():bizagi.localization.getResource("workportal-project-activity-plan");break;case"currenttask":e[5]=null!=r.value?r.value.toString():bizagi.localization.getResource("workportal-project-casedashboard-activity");break;case"cascreationdate":e[12]=r.value;break;case"wiestimatedsolutiondate":e[3]=r.value;break;case"cassolutiondate":break;case"idcase":e[0]=r.value;break;case"idworkitem":e[1]=r.value.toString();break;case"wientrydate":break;case"taskid":e[2]=r.value;break;case"taskstate":e.taskstate=r.value?(""+r.value).toLowerCase():"";break;case"idwfclass":e[10]=e.idwfclass=r.value;break;case"isfavorite":e[9]=r.value;break;case"atrisktime":e[11]=r.value;break;case"guidfavorite":e[8]=r.value;break;case"isevent":e.isEvent=r.value;break;case"datachangesetversion":e.dataChangeset=r.value;break;case"creatorfullname":e.creatorFullName=r.value}},appendActivityElementSyncError:function(e,t){var r=t[e[0]+"-"+e[1]];r&&(e.syncError=r,e.hasSyncError=!0)},appendActivityRowsSyncError:function(e,t){var r=t[e.idcase.value+"-"+e.idworkitem.value];r&&(e.syncerror={displayName:"syncError",value:r},e.hassyncerror={displayName:"hasSyncError",value:!0})},getCurrentActivities:function(e){var t=this,r={};e=e||{},r.page=e.page||1,r.pageSize=e.pageSize||10,void 0!==e.radNumber&&(r.radNumber=e.radNumber);var i=t.serviceLocator.getUrl("case-handler-getActivityList");return $.read(i,r).then((function(e){return t.processActivitiesResponse(e)}))},processActivitiesResponse:function(e,t,r){var i,a=-1;for(e.elements=[],e.processes=[];i=e.rows[++a];){for(var s,n={},o=-1;s=e.headers[++o];)n["o_"+s.fieldName.toLowerCase()]={displayName:s.displayName,value:i[o]},n[s.fieldName.toLowerCase()]=i[o];$.extend(n,this.defineActivityStateByDate(n.wiestimatedsolutiondate),{highlightedNumber:this.highlightsString(n.radnumber,t)}),e.elements.push(n),void 0===e.processes.find((function(e){return e.processname==n.wfclsdisplayname}))&&e.processes.push({processname:n.wfclsdisplayname,idwfclass:n.idwfclass,active:r?"active":""})}return e},highlightsString:function(e,t){if("string"!=typeof e||"string"!=typeof t)return e;var r=new RegExp(t,"gi");return e.replace(r,(function(e,t){return"<strong>"+e+"</strong>"}))},getDiscussionCase:function(e){var t=t||{};t.globalParent=e.globalParent;var r=bizagi.util.validateFeatureSupport("discussionCase")?this.serviceLocator.getUrl("discussion-case"):this.serviceLocator.getUrl("discussion-case-v1");return $.read({url:r,data:t,contentType:"application/json"}).pipe((function(e){return e}))},editDiscussion:function(e){var t=this.serviceLocator.getUrl("new-discussion");return $.update({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},getUsersDiscussion:function(e){var t=t||{};t.userIds=e,t.width=50,t.height=50;var r=this.serviceLocator.getUrl("get-users");return bizagi.util.getFeatureObject("userService.v1.enabled")?$.ajax({url:r,data:t,type:"POST",dataType:"json"}):$.read(r,t).pipe((function(e){return e}))},getEffectiveDuration:function(e){var t=this.serviceLocator.getUrl("time-schemas-effectiveduration");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getUsersData:function(e){var t=this.serviceLocator.getUrl("project-users-get");return bizagi.util.getFeatureObject("userService.v1.enabled")?$.ajax({url:t,data:e,type:"POST",dataType:"json"}):$.read({url:t,data:e,dataType:"json"})},getSummaryCaseTaskOptions:function(e){var t=this.serviceLocator.getUrl("case-summary-task-options");return e=e||{},$.read(t,{idWorkitem:e.idWorkitem,idCase:e.idCase})},createNewDiscussion:function(e){var t=this.serviceLocator.getUrl("new-discussion");return e=e||{},$.create({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},createNewComment:function(e){var t=(e=e||{}).data||{},r=this.serviceLocator.getUrl("new-comment");return $.create({url:r.replace("{typeResource}","Comment"),data:JSON.stringify(t),dataType:"json",contentType:"application/json"})},updateProjectFile:function(e){var t=this.serviceLocator.getUrl("project-files-upload");return $.update({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},createProjectFile:function(e){var t=this.serviceLocator.getUrl("project-files-upload");return $.create({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},getFilesCount:function(e){e=e||{};var t=bizagi.util.validateFeatureSupport("filesCount")?this.serviceLocator.getUrl("count-files"):this.serviceLocator.getUrl("count-files-v1");return $.read({url:t,data:e,contentType:"application/json"}).pipe((function(e){return e}))},getCommentCase:function(e){e=e||{};var t=this.serviceLocator.getUrl("comment-case");return $.read({url:t,data:e,contentType:"application/json"}).pipe((function(e){return e}))},getCommentsByParent:function(e){e=e||{};var t=this.serviceLocator.getUrl("count-comments");return $.read({url:t,data:e,contentType:"application/json"}).pipe((function(e){return e}))},getFilesList:function(e){var t=bizagi.util.validateFeatureSupport("filesList")?this.serviceLocator.getUrl("get-list-files"):this.serviceLocator.getUrl("get-list-files-v1");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"}).pipe((function(e){return e}))},deleteFile:function(e){var t=this.serviceLocator.getUrl("project-resource-action");return $.destroy({url:t.replace("{typeResource}","Attachment"),data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},getFilesThumbnail:function(e){e=e||{};var t=this.serviceLocator.getUrl("thumbnail-file");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"}).pipe((function(e){return e}))},getAttachment:function(e){var t=this.serviceLocator.getUrl("get-attachment");return t=t.replace("{idAttachment}",e.idAttachment)},getMobileAttachment:function(e){var t=this.serviceLocator.getUrl("get-mobile-attachment");return(t=t.replace("{idAttachment}",e.idAttachment))+"?sessionId="},getAllAdministrableEntities:function(e){e=e||{};var t={action:"entitiesList",kind:"administrable"};return $.ajax({url:this.serviceLocator.getUrl("entities-administration"),data:t,type:"POST",dataType:"json"}).pipe((function(e){var t={entities:[]};return $.each(e,(function(e,r){t.entities.push(r)})),t}))},getEntitiesList:function(e){return(e=e||{}).action="entitiesList",e.kind="entitiesData",$.ajax({url:this.serviceLocator.getUrl("entities-administration"),data:e,type:"POST",dataType:"json"})},getCasesByWorkflow:function(e){e=e||{};var t={},r=this.serviceLocator.getUrl("process-handler-getCustomizedColumnsDataInfo");if(bizagi.util.isEmpty(e.taskState)||(t.taskState=e.taskState),bizagi.util.isEmpty(e.smartInboxId)?bizagi.util.isEmpty(e.idWorkflow)||(t.idWorkflow=e.idWorkflow):t.smartInboxGuid=e.smartInboxId,1==e.onlyFavorites&&(t.onlyFavorites=!0,t.taskState="all"),t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,bizagi.isMobile()&&(t.mobileDevice=!0),e.smartfoldersParameters){var i=e.smartfoldersParameters.split("&");$.each(i,(function(e,r){var i=r.split("=");t[i[0]]=i[1]}))}return(e.radnumber||e.radNumber)&&(t.radNumber=e.radNumber?e.radNumber:e.radnumber),(e.idcase||e.idCase)&&bizagi.util.isNumeric(e.idcase||e.idCase)&&(t.idCase=e.idCase?e.idCase:e.idcase),$.read(r,t).pipe((function(e){return $.each(e.cases.rows,(function(t,r){var i=[];e.cases.rows[t].radnumber=r.id,$.each(r.fields,(function(r,a){if(null!=a)try{null!=a.isRadNumber&&"true"==a.isRadNumber?(e.cases.rows[t].radnumber=a.Value,e.cases.rows[t].casenumberdisplayname=a.DisplayName):null!=a.workitems?e.cases.rows[t].workitems=a.workitems:i.push(a)}catch(e){}})),e.cases.rows[t].fields=i})),e.cases}))},getOrganizationsList:function(){var e=this.serviceLocator.getUrl("process-handler-getOrganizations"),t={type:12,name:""};return $.read(e,t)},getOrganizationsByUserList:function(){var e=this.serviceLocator.getUrl("process-handler-getOrganizationsByUser");return $.read(e,{})},getCustomizedColumnsData:function(e){e=e||{};var t={},r=this.serviceLocator.getUrl("process-handler-getCustomizedColumnsData");if(t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,t.orderFieldName=e.orderFieldName||"",t.orderType=e.orderType||"0",t.order=e.order||"",bizagi.isMobile()&&(t.mobileDevice=!0),e.taskState=e.taskState||"all",""===e.taskState.toString().toLowerCase()&&(e.taskState="all"),"red"===e.taskState.toString().toLowerCase()&&(e.taskState="Red"),"yellow"===e.taskState.toString().toLowerCase()&&(e.taskState="Yellow"),"green"===e.taskState.toString().toLowerCase()&&(e.taskState="Green"),t.taskState=e.taskState,bizagi.util.isEmpty(e.idWorkflow)||(t.idWorkflow=e.idWorkflow),bizagi.util.isEmpty(e.idTask)||(t.idTask=e.idTask),bizagi.util.isEmpty(e.radNumber)||(t.radNumber=e.radNumber),1==e.onlyFavorites&&(t.onlyFavorites=!0,t.taskState="all"),e.smartfoldersParameters){var i=e.smartfoldersParameters.split("&");$.each(i,(function(e,r){var i=r.split("=");t[i[0]]=i[1]}))}return $.read(r,t)},getCustomizedColumnsDataBeta:function(e){e=e||{};var t={},r=this.serviceLocator.getUrl("process-handler-getCustomizedColumnsData");if(t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,t.orderFieldName=e.orderFieldName||"",t.orderType=e.orderType||"0",t.order=e.order||"",t.mobileDevice=!!bizagi.isMobile(),e.taskState=e.taskState||"all",""===e.taskState.toString().toLowerCase()&&(e.taskState="all"),"red"===e.taskState.toString().toLowerCase()&&(e.taskState="Red"),"yellow"===e.taskState.toString().toLowerCase()&&(e.taskState="Yellow"),"green"===e.taskState.toString().toLowerCase()&&(e.taskState="Green"),t.taskState=e.taskState,bizagi.util.isEmpty(e.idWorkflow)||(t.idWorkflow=e.idWorkflow),bizagi.util.isEmpty(e.idTask)||(t.idTask=e.idTask),bizagi.util.isEmpty(e.radNumber)||(t.radNumber=e.radNumber),1==e.onlyFavorites&&(t.onlyFavorites=!0,t.taskState="all"),e.smartfoldersParameters){var i=e.smartfoldersParameters.split("&");$.each(i,(function(e,r){var i=r.split("=");t[i[0]]=i[1]}))}return $.read(r,t).pipe((function(e){var t={columnTitle:[],lstIdCases:[],elements:[],page:e.page,totalPages:e.totalPages},r=new Date,i=r.getMonth(),a=r.getDate(),s=r.getYear();t.columnTitle=e.cases.columnTitle,t.lstIdCases=e.cases.lstIdCases,t.page=e.cases.page,t.totalPages=e.cases.totalPages;for(var n=0,o=e.cases.rows.length;n<o;n++){var l=e.cases.rows[n],c=new Date(l.fields[3]),d=c.getDate(),u=c.getMonth(),p=c.getYear();a>d||i>u||s>p?(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"dd MMM"),t.elements.push($.extend({},l,{group:"overdue"}))):a==d?(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"hh:mm"),t.elements.push($.extend({},l,{group:"today"}))):a+1==d?(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"hh:mm"),t.elements.push($.extend({},l,{group:"tomorrow"}))):(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"dd MMM"),t.elements.push($.extend({},l,{group:"upcoming"})))}return(void 0===t.elements||void 0!==t.elements&&0===t.elements.length)&&t.elements.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")}),t}))},getCategories:function(e){var t={};return(e=e||{}).idCategory&&(t.idCategory=e.idCategory),e.idApp&&(t.idApp=e.idApp),bizagi.isMobile()&&(t.mobileDevice=!0),t.groupByApp=e.groupByApp||!1,$.read(this.serviceLocator.getUrl("process-handler-getCategory"),t)},getRecentProcesses:function(e){return(e=e||{}).mobileDevice=bizagi.isMobile()||"false",$.read(this.serviceLocator.getUrl("process-handler-getRecentProcesses"),e)},getCaseSummary:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("case-handler-getCaseSummary"),data:{idCase:e.idCase,eventAsTasks:e.eventAsTasks||"false",onlyUserWorkItems:e.onlyUserWorkItems||"true",mobileDevice:bizagi.isMobile()||"false"},serviceType:"GETSUMMARY"}).pipe((function(e){return e}))},getCaseAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:e.idCase}).pipe((function(e){return e}))},getCaseTasks:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseTasks"),{idCase:e.idCase})},getCaseEvents:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("case-handler-getCaseEvents"),data:{idCase:e.idCase},serviceType:"GETEVENTS"}).pipe((function(e){return e}))},getCaseSubprocesses:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("case-handler-getCaseSubprocesses"),data:{idCase:e.idCase},serviceType:"GETSUBPROCESSES"}).pipe((function(e){return e}))},getCaseFormsRenderVersion:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseFormsRenderVersion"),{idCase:e.idCase})},getCaseFormsRenderVersionDataContent:function(e){var t=new $.Deferred;return $.when(this.getCaseFormsRenderVersion(e)).done((function(e){t.resolve(e)})),t.promise()},getTaskAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getTaskAssignees"),{idCase:e.idCase,idTask:e.idTask})},getWorkitems:function(e){var t={};return e=e||{},t.idCase=e.idCase,t.fromTask=e.fromTask,t.fromWorkItemId=e.fromWorkItemId,t.mobileDevice=bizagi.isMobile(),e.eventAsTasks&&(t.eventAsTasks=e.eventAsTasks),void 0!==e.onlyUserWorkItems&&(t.onlyUserWorkItems=e.onlyUserWorkItems),$.read({url:this.serviceLocator.getUrl("case-handler-getWorkItems"),data:t,serviceType:"GETWORKITEMS"})},getQueries:function(e){var t=this;if(t.hashQueries&&e.idElement)return t.hashQueries[e.idElement];var r=new $.Deferred;return $.read(t.serviceLocator.getUrl("query-handler-getqueries")).done((function(e){t.hashQueries={},t.hashQueries[0]={},t.processQueries(e.query),r.resolve(t.hashQueries[-1])})),r.promise()},processQueries:function(e){var t=this;$.each(e,(function(e,r){t.hashQueries[r.idParent]||(t.hashQueries[r.idParent]=[]),t.hashQueries[r.idParent].push(r),r.nodes?t.processQueries(r.nodes):r.nodes={}}))},createNewCase:function(e){return e=e||{},$.create({url:this.serviceLocator.getUrl("case-handler-addNewCase"),data:{idWfClass:e.idWfClass,caseData:e.caseData?JSON.stringify(e.caseData):null,idOrganization:e.idOrganization?e.idOrganization:null},serviceType:"NEWCASE"})},validateHasStartForm:function(e){var t={processId:e.processId};return $.read({url:this.serviceLocator.getUrl("case-handler-validateHasStartForm"),data:t,batchRequest:!0})},startProcess:function(e){var t=this,r={idProcess:(e=e||{}).idProcess,entityMapping:e.mapping?JSON.stringify(e.mapping):{}};void 0!==e.idParentCase&&(r.idParentCase=e.idParentCase);var i=$.Deferred();return $.create({url:t.serviceLocator.getUrl("case-handler-startProcess"),data:r,serviceType:"STARTPROCESS"}).fail((function(r){if("error"!==$.parseJSON(r.responseText).status||bizagi.util.isVersionSupported())i.reject(r);else{var a={idWfClass:e.idProcess||e.idWfClass,idOrganization:e.idOrganization||null};t.createNewCase(a).then((function(e){e.oldVersion=!0,i.resolve(e)})).fail((function(e){i.reject(e)}))}})).done((function(e){i.resolve(e)})),i.promise()},actionCreateCase:function(e){var t={processId:void 0!==e.idProcess?e.idProcess:e.guidProcess};return void 0!==e.parentCaseId&&(t.parentCaseId=e.parentCaseId),void 0!==e.mapping&&(t.entityMapping=e.mapping?JSON.stringify(e.mapping):{}),$.create({url:this.serviceLocator.getUrl("handler-execute-action-start"),data:t,serviceType:"STARTPROCESS"})},getFirstParentPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-first-parent-plan"),r=$.Deferred();return $.when($.read({url:t,data:e,dataType:"json"})).done((function(e){r.resolve(e)})).fail((function(){r.resolve(null)})),r.promise()},searchCases:function(e){e=e||{};var t={h_action:"SEARCHCASES",onlyUserCases:!1,active:!1};return t.page=e.page||1,e.radNumber&&(t.radNumber=$.trim(e.radNumber)),t.pageSize=e.pageSize||this.pageSize,$.ajax({url:this.serviceLocator.getUrl("query-handler"),data:t,type:"POST",dataType:"json"})},queryCases:function(e){e=e||{};var t={h_action:"QUERYCASES"};return t.onlyUserCases=e.onlyUserCases||!1,t.active=e.active&&!0,t.page=e.page||1,e.radNumber&&(t.radNumber=$.trim(e.radNumber)),t.pageSize=e.pageSize||this.pageSize,t.filter=e.filter,t.outputxpath=e.outputxpath,t.orderFieldName=e.orderFieldName||"",t.orderType="asc"==e.orderType||1==e.orderType?1:0,t.order=e.order||"",$.ajax({url:this.serviceLocator.getUrl("query-handler"),data:t,type:"POST",dataType:"json"})},queryEntities:function(e){e=e||{};var t={h_action:"QUERYENTITIES"};return t.page=e.page||1,t.pageSize=this.Class.ENTITIES_QUERY_PAGE_SIZE,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEnt"]=e.idEntity,t.filter=e.filter,t.outputxpath=e.outputxpath,t.orderFieldName=e.orderFieldName||"",t.orderType=e.orderType||"",t.order=e.order||"",$.ajax({url:this.serviceLocator.getUrl("query-handler"),data:t,type:"POST",dataType:"json"})},getMenuAuthorization:function(){return $.read(this.serviceLocator.getUrl("authorization-handler-getMenuAuthorization"))},isCaseCreationAuthorized:function(e){var t=this.serviceLocator.getUrl("authorization-handler-isCaseCreationAuthorized");return t=t.replace("{0}",e.idWfClass||""),$.read({url:t})},getAsynchExecutionState:function(e){return(e=e||{}).idCase,$.read({url:this.serviceLocator.getUrl("case-handler-getAsynchExecutionState"),data:{idCase:e.idCase,idAsynchWorkitem:e.idAsynchWorkitem},serviceType:"ASYNCHEXECUTION"})},supportedLogTypes:function(){return $.read(this.serviceLocator.getUrl("case-handler-supportedLogTypes"))},getActivityLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getActivityLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getActivityDetailLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getActivityDetailLog"),{idCase:e.idCase,idWorkItemFrom:e.idWorkItemFrom,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getEntityLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getEntityLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getEntityDetailLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getEntityDetailLog"),{idCase:e.idCase,idEntity:e.idEntity||-1,userFullName:e.userFullName||"",attribDisplayName:e.attribDisplayName||"",idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getUserLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getUserLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getUserDetailLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getUserDetailLog"),{idCase:e.idCase,idUser:e.idUser,entDisplayName:e.entDisplayName||"",attribDisplayName:e.attribDisplayName||"",idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},getAdminLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getAdminLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe((function(e){return e}))},addFavorite:function(e){return e=e||{},$.create(this.serviceLocator.getUrl("favorites-handler-saveFavorite"),{idObject:e.idObject,favoriteType:e.favoriteType}).pipe((function(e){return e}))},delFavorite:function(e){return e=e||{},$.destroy(this.serviceLocator.getUrl("favorites-handler-deleteFavorite"),{guidFavorite:e.idObject}).pipe((function(e){return e}))},summaryAssigness:function(e){var t=new $.Deferred,r=e.idCase||"";return $.when(this.getCaseAssignees({idCase:r})).done((function(e){for(var r=e.assignees||[],i=r.length,a={showAssignees:!!(bizagi.override.showAssignees&&r.length>0),assignees:{},events:"",activities:""},s="",n="",o=[],l=[],c=0;c<i;c++)bizagi.util.parseBoolean(r[c].isEvent)?-1==o.indexOf(r[c].idUser)&&(o.push(r[c].idUser),s+=r[c].Name+", "):-1==l.indexOf(r[c].idUser)&&(l.push(r[c].idUser),n+=r[c].Name+", ");a.events=s.substring(0,s.length-2),a.activities=n.substring(0,n.length-2),t.resolve(a)})),t.promise()},summarySubProcess:function(e){var t=$.Deferred(),r=e.idCase||"";return $.when(this.getCaseSubprocesses({idCase:r})).done((function(e){if(e.showSubProcess=e.subProcesses.length>=1,e.showSubProcesColumns=void 0!==e.CustFields[0]&&e.CustFields[0][0].length>=1,e.showSubProcesColumns){var r;e.subProcPersonalized={};for(var i=0;i<e.CustFields.length;i++){r=0;for(var a=0;a<e.subProcesses.length;a++)e.subProcesses[a].idCustData==i&&(e.subProcPersonalized[i]=e.subProcPersonalized[i]||{},e.subProcPersonalized[i].subProcesses=e.subProcPersonalized[i].subProcesses||{},e.subProcPersonalized[i].subProcesses[r++]=e.subProcesses[a]);-1!=e.subProcesses[i].idCustData&&null!=e.subProcPersonalized[i]&&(e.subProcPersonalized[i].CustFields=e.CustFields[i],e.subProcPersonalized[i].idCase=e.idCase)}}t.resolve(e)})),t.promise()},summaryCaseEvents:function(e){var t=$.Deferred(),r=e.idCase||"";return $.when(this.getCaseEvents({idCase:r})).done((function(e){e.showEvents=e.events.length>=1,t.resolve(e)})).fail((function(e){t.reject()})),t.promise()},summaryCaseDetails:function(e){var t=new $.Deferred,r=e.idWorkitem||0;return $.when(this.getCaseSummaryDataContent(e)).done((function(e){e.currentState=e.currentState||[];var a=e.currentState.length;for(e.showEvents=e.countEvents>=1,e.showParentProcess=e.idParentCase>=1,e.parentProcess={displayName:e.parentDisplayName,idCase:e.idParentCase},e.isClosedForAllUsers=bizagi.util.parseBoolean(e.isClosed),e.isClosed=!bizagi.util.parseBoolean(e.isOpen),e.showAssignees=!!(bizagi.override.showAssignees&&e.countAssigness>0),e.showSubProcess=e.countSubProcesses>0,e.showForm=!!bizagi.util.parseBoolean(e.hasGlobalForm),e.allowsReassign="false",i=0;i<a;i++)e.currentState[i].idWorkItem==r&&(e.allowsReassign=e.currentState[i].allowsReassign);var s=[],n=0;for(i=0;i<a;i++)!bizagi.util.parseBoolean(e.currentState[i].isEvent)&&bizagi.util.parseBoolean(e.currentState[i].assignToCurrentUser)&&e.currentState[i].idWorkItem!=r&&(s[n++]=e.currentState[i]);e.currentStateTypes=s,e.showActivities=s.length>0,t.resolve(e)})),t.promise()},releaseActivity:function(e){var t=this.serviceLocator.getUrl("case-handler-releaseActivity");t=t.replace("{idCase}",e.idCase);var r={};return e&&(r.idCase=e.idCase,r.idWorkItem=e.idWorkItem),$.ajax({url:t,data:r,type:"POST",dataType:"json"})},summaryActivities:function(e){var t={},r=e.data||{},i=i||e.idWorkitem||0;try{t.showActivities=r.currentStateTypes.length>=1,t.currentState=r.currentStateTypes,t.globalIdWorkitem=i,t.creationDate=r.creationDate}catch(e){}return t},getCaseSummaryDataContent:function(e){var t=this,r=new $.Deferred;return $.when(t.getCaseSummary(e)).done((function(e){e.taskState=t.icoTaskState,e.process=e.process?e.process:"",e.createdBy&&(e.createdByName=e.createdBy.Name,e.createdByUserName=e.createdBy.userName,e.caseDescription=""==e.caseDescription?"":e.caseDescription,e.processPath=e.processPath.replace(/\//g," > ")+e.process,e.showWorkOnIt=!0),r.resolve(e)})),r.promise()},getSmartFolders:function(e){var t=this,r={};return r.idFolder=e||"",$.read(t.serviceLocator.getUrl("folders-handler-getUserQueries"),r).pipe((function(r){return-1==e||""==e?r:t.searchFolders(e,r)||[]}))},deleteSmartFolder:function(e){var t={action:"6"};return e=e||{},t.idSmartFolder=e.idSmartFolder||"",t.idUser=e.idUser||"",$.destroy(this.serviceLocator.getUrl("folders-associate-deleteSmartFolder"),t)},getFolders:function(e){var t=this,r={action:"getUserFolder"};return r.idFolder=e||"",$.ajax({url:t.serviceLocator.getUrl("folders-handler"),type:"POST",data:r,dataType:"json"}).pipe((function(r){return""==e?{folders:[{name:bizagi.localization.getResource("workportal-widget-folders"),id:"-1",idParent:0,childs:r}]}:-1==e?r:t.searchFolders(e,r)||[]}))},searchFolders:function(e,t){for(var r=0;r<t.folders.length;r++){if(t.folders[r].id==e)return t.folders[r].childs}},getCasesByFolder:function(e){return e=e||"",$.ajax({cache:!0,url:"RestServices/"+e,type:"GET",dataType:"json"})},makeFolder:function(e){var t={action:"CreateUpdateFolder"};return t.folderName=e.folderName||"No Name",null!=e.idParentFolder&&e.idParentFolder>1&&(t.idParentFolder=e.idParentFolder),$.ajax({url:this.serviceLocator.getUrl("folders-handler"),data:t,type:"POST",dataType:"json"})},updateFolder:function(e){var t={};return e=e||{},t.action="CreateUpdateFolder",t.idFolder=e.idFolder||"",e.folderName&&(t.folderName=e.folderName),e.idParentFolder&&(t.idParentFolder=e.idParentFolder),$.ajax({url:this.serviceLocator.getUrl("folders-handler"),data:t,type:"POST",dataType:"json"})},associateCaseToFolder:function(e){var t={action:"4"};return e=e||{},t.idCase=e.idCase||"",t.idCustomFolder=e.idCustomFolder,$.ajax({url:this.serviceLocator.getUrl("folders-associate"),data:t,type:"POST",dataType:"json"})},dissasociateCaseFromFolder:function(e){var t={action:"DeleteCaseFromFolder"};return e=e||{},t.idFolder=e.idFolder,t.idCase=e.idCase,$.ajax({url:this.serviceLocator.getUrl("folders-handler"),data:t,type:"POST",dataType:"json"})},deleteFolder:function(e){var t={action:"5"};return e=e||{},t.idCustomFolder=e.idCustomFolder||"",$.ajax({url:this.serviceLocator.getUrl("folders-associate"),data:t,type:"POST",dataType:"json"})},getFile:function(e){var t={},r=this.serviceLocator.getUrl("file-handler");return e=e||{},t.action="getFileContent",t.uploadId=e.uploadId||"",t.entityId=e.entityId||"",t.entityKey=e.entityKey||"",bizagi.services.ajax.pathToBase+r+"?"+jQuery.param(t)},getComments:function(e){var t=this;return e=e||{},$.read(encodeURI(t.serviceLocator.getUrl("MessageHandler-GetComments")),{idCase:e.idCase||"",idColorCategory:"number"==typeof e.idColorCategory?e.idColorCategory:"",pag:e.pag||1,pagSize:e.pagSize||10}).pipe((function(e){var r=new $.Deferred,i="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";return e.comments?$.each(e.comments,(function(t,r){e.comments[t].hasOwnProperty("CategoryColor")||(e.comments[t].CategoryColor="")})):e.comments=[],e.users?$.each(e.users,(function(t,r){e.users[t].Picture=""===e.users[t].Picture?i:e.users[t].Picture})):$.when(t.getCurrentUser()).done((function(t){e.users=[],e.users.push({Id:t.idUser,Name:t.user,DisplayName:t.userName,Picture:i})})),r.resolve(e),r.promise()}))},makeNewComment:function(e){return $.create(this.serviceLocator.getUrl("MessageHandler-NewComment"),{idCase:e.idCase||"",comment:e.comment.replace(/\n/g,"<br>")||""}).pipe((function(e){if(e.comments){var t=[e.comments];$.each(t,(function(e,r){t[e].CategoryColor=""})),e.comments=t}if(e.users){var r=[e.users];$.each(r,(function(e,t){r[e].Picture=""==r[e].Picture?"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":r[e].Picture})),e.users=r}return e}))},makeNewReply:function(e){return e=e||{},$.create(this.serviceLocator.getUrl("MessageHandler-ReplyComment"),{idCase:e.idCase||"",idComment:e.idComment||"",comment:e.comment.replace(/\n/g,"<br>")||""}).pipe((function(e){if(e.comments&&(e.Replies=[e.comments]),e.users){var t=[e.users];$.each(t,(function(e,r){t[e].Picture=""==t[e].Picture?"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":t[e].Picture})),e.users=t}return e}))},removeMobileComment:function(e){var t=this.serviceLocator.getUrl("remove-comment");return e=e||{},$.destroy({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"}).pipe((function(e){return e}))},removeComment:function(e){return e=e||{},$.destroy(this.serviceLocator.getUrl("MessageHandler-RemoveComment"),{idCase:e.idCase||"",idComment:e.idComment||""})},removeReply:function(e){return e=e||{},$.destroy(this.serviceLocator.getUrl("MessageHandler-RemoveReply"),{idCase:e.idCase||"",idComment:e.idComment||"",idReply:e.idReply||""})},renameCommentCategory:function(e){return e=e||{},$.update(this.serviceLocator.getUrl("MessageHandler-RenameCategoryColor"),{idColorCategory:e.idColorCategory>=0?e.idColorCategory:"",colorName:e.colorName||""})},setCommentCategory:function(e){return e=e||{},$.update(this.serviceLocator.getUrl("MessageHandler-SetCategoryToComment"),{idCase:e.idCase||"",idComment:e.idComment||"",idColorCategory:"number"==typeof e.idColorCategory?e.idColorCategory:""})},getCommentsCategories:function(){return $.read(this.serviceLocator.getUrl("MessageHandler-GetCategoryColors")).pipe((function(e){return e.length>1&&e[0].categories?e[0]:e}))},getNewComments:function(e){return e=e||{},$.read(encodeURI(this.serviceLocator.getUrl("MessageHandler-CountNewComments")),{idCase:e.idCase||0,idComment:e.idComment||0})},getAnalisysQueries:function(){return $.read(this.serviceLocator.getUrl("bamAnalytics-handler-getAnalisysQueries"))},updateQueries:function(e){return $.update(this.serviceLocator.getUrl("bamAnalytics-handler-updateQuery"),{idQuery:e.idQuery>=0?e.idQuery:"",queryName:e.queryName||"",queryDescription:e.queryDescription||""})},deleteQueries:function(e){var t={action:"1612"};return t.QueryId=e||"",$.destroy(this.serviceLocator.getUrl("reports-handler-deleteQueries"),t)},getConfiguration:function(){var e=this.serviceLocator.getUrl("authenticationConfig");return $.read(e)},logout:function(){sessionStorage.removeItem("bizagiAuthentication");try{var e=$.create(this.serviceLocator.getUrl("logout"));$.when(e).done((function(){location.reload()})).fail((function(){bizagi.log("Error logging out")}))}catch(e){}},logoutMobile:function(){var e=this,t={sourceLogout:"user"};if(sessionStorage.removeItem("bizagiAuthentication"),bizagi.util.removeLastProcessInbox(),bizagi.util.isCordovaSupported()){var r=e.serviceLocator.getUrl("logout");return $.create(r)}try{$.when(e.getConfiguration()).done((function(r){if(r.redirectErrorPage)window.location.href=r.redirectErrorPage;else switch(r.authenticationType){case"Federate":var i=r.logOffURL,a=r.federationLogoutBindingProtocol,s=r.authenticationSubType;if("WSFederated"===s)$.when($.create(e.serviceLocator.getUrl("logout"),t)).done((function(){location.href=i})).fail((function(){bizagi.log("Error logging out")})).always((function(){location.href=r.logOffURL}));else if("Saml"===s){$.when($.read(e.serviceLocator.getUrl("FederateLogoffUrl"),{})).done((function(r){r.federateLogoffUrl&&(i=r.federateLogoffUrl),$.when($.create(e.serviceLocator.getUrl("logout"),t)).done((function(){"POST"===a?(window.document.open("text/html"),window.document.write(i),window.document.close()):window.location.href=i})).fail((function(){bizagi.log("Error logging out")})).always((function(){}))})).fail((function(){bizagi.log("Error logging out")})).always((function(){}))}break;case"SAML":loader.nativeAjax(loader.getPathUrl(e.serviceLocator.getUrl("logout"),t),(function(e){var t=JSON.parse(e.responseText);if(!0===t.logout)if(void 0!==t.samlUrlRedirect){var r=decodeURI(t.samlUrlRedirect),i=document.createElement("iframe");document.getElementsByTagName("body")[0].appendChild(i),$(i).on("load",(function(){(bizagi.util.isIE8()?$(this.contentWindow.document.body):$(this.contentWindow.eval("document.body"))).text();location.reload()})),i.src=r}else location.reload();else bizagi.log("Error logging out")}));break;case"OAuth2":$.when($.create(e.serviceLocator.getUrl("logout"),t)).done((function(){$.when($.read(e.serviceLocator.getUrl("oauth2AuthenticationConfig"))).done((function(e){if(e.logoutUrl&&""!=e.logoutUrl){var t=e.logoutUrl,r=e.homeUrl;t=t.replace(/post_logout_redirect_uri=[^&]*/,"post_logout_redirect_uri="+r),location.href=t}else location.reload()})).fail((function(){bizagi.log("Error logging out")}))})).fail((function(){bizagi.log("Error logging out")}));break;default:$.when($.create(e.serviceLocator.getUrl("logout"),t)).done((function(){window.location=bizagi.services.ajax.loginPage})).fail((function(){bizagi.log("Error logging out")}))}})).fail((function(e){bizagi.log(e)}))}catch(e){bizagi.log(e)}},getOrganizationInfo:function(e){var t={};return t.objectType=e,$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-getOrganizationInfo"),data:t,type:"GET",dataType:"json"})},getCasesByOrganization:function(e){var t={};return t.roles=e.roles?"["+e.roles.toString()+"]":"[]",t.skills=e.skills?"["+e.skills.toString()+"]":"[]",t.locations=e.locations?"["+e.locations.toString()+"]":"[]",$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-getCasesByOrganization"),data:t,type:"GET",dataType:"json"})},reassignCases:function(e){var t={};return t.users=e.user?"["+e.user.toString()+"]":"[]",t.roles=e.roles?"["+e.roles.toString()+"]":"[]",t.skills=e.skills?"["+e.skills.toString()+"]":"[]",t.locations=e.locations?"["+e.locations.toString()+"]":"[]",$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-reassignCases"),data:t,type:"POST",dataType:"json"})},searchUsers:function(e){var t={};return t.userName=e.userName||"",t.fullName=e.fullName||"",t.domain=e.domain||"",$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-searchUsers"),data:t,type:"GET",dataType:"json"})},getDomainList:function(){var e=this.serviceLocator.getUrl("domains");return $.read(e)},getEcmAllScheduledJobs:function(){var e={action:"getEcmAllScheduledJobs"};return $.read(this.serviceLocator.getUrl("async-ecm-upload-baseService"),e)},retryECMPendingScheduledJob:function(e){var t={action:"retryECMPendingScheduledJob"};return t.idJob=e,$.read(this.serviceLocator.getUrl("async-ecm-upload-baseService"),t)},getWorkPortalVersion:function(){return $.ajax({url:this.serviceLocator.getUrl("WorkPortalVersion"),type:"GET",dataType:"json"}).always((function(e){return""==(e=e||{}).version&&(e.version=bizagi.loader.productBuild||""),e}))},getAuthenticationLogData:function(e){var t="";return t="domains"==e.dataType?"admin-getAuthenticationDomains":"events"==e.dataType?"admin-getAuthenticationEventsTypes":"admin-getAuthenticationEventSubTypes",$.ajax({url:this.serviceLocator.getUrl(t),data:{},type:"GET",dataType:"json"})},getAuthenticationLogResult:function(e){var t={};return t.action=e.action,t.domain=e.domain,t.userName=e.userName,t.dtFrom=e.dtFrom,t.dtTo=e.dtTo,t.eventSubType=e.eventSubType,t.eventType=e.eventType,t.pag=e.pag,t.pagSize=e.pagSize,$.ajax({url:this.serviceLocator.getUrl("admin-getAuthenticationLog"),data:t,type:"GET",dataType:"json"})},encryptString:function(e){var t={};return e=e||{},t.entry=e.entry,$.ajax({url:this.serviceLocator.getUrl("admin-EncryptString"),data:t,type:"POST",dataType:"json"})},userPendingRequests:function(e){var t={pag:e.pag,pagSize:e.pagSize};return $.read(this.serviceLocator.getUrl("admin-UserPendingRequests"),t)},userAuthenticationInfo:function(e){return $.read(this.serviceLocator.getUrl("admin-UserAuthenticationInfo"),{idUser:e.idUser})},updateUserAuthenticationInfo:function(e){return $.create(this.serviceLocator.getUrl("admin-updateUserAuthenticationInfo"),{idUser:e.idUser,password:e.password,enable:e.enable,expired:e.expired,locked:e.locked})},generateRandomPassword:function(e){return(e=e||{}).action="generateRandomPassword",$.ajax({url:this.serviceLocator.getUrl("admin-generateRandomPassword"),data:e,type:"POST",dataType:"json"})},generateDataToSendByEmail:function(e){e=e||{};var t={action:"GenerateDataToSendByEmail"};return t.idUser=e.idUser,t.password=e.password,$.ajax({url:this.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:e,type:"POST",dataType:"json"})},sendEmail:function(e){e=e||{};var t={action:"sendEmail"};return t.emailTo=e.emailTo,t.subject=e.subject,t.body=e.body,$.ajax({url:this.serviceLocator.getUrl("admin-sendEmail"),data:e,type:"POST",dataType:"json"})},getApplicationCategoriesList:function(e){var t={},r="";return"Applications"==e.action?(r="admin-getApplicationList",$.ajax({url:this.serviceLocator.getUrl(r),type:"GET",dataType:"json"})):(r="admin-getCategoriesList",t.idApp=e.idApp,t.idCategory=e.idCategory,""==t.idCategory&&(t.idCategory=-1),void 0!==e.filterStartEvent&&(t.filterStartEvent=e.filterStartEvent),$.ajax({url:this.serviceLocator.getUrl(r),data:t,type:"GET",dataType:"json"}))},getAdminCasesList:function(e){var t=e||{};return $.ajax({cache:!0,url:this.serviceLocator.getUrl("admin-getCasesList"),data:t,type:"GET",dataType:"json"})},getApplicationProcesses:function(e){var t=this.serviceLocator.getUrl("admin-getApplicationProcesses"),r={};return r.idApp=e.idApp?e.idApp:-1,$.read(t,r)},getProcessVersion:function(e){var t=this.serviceLocator.getUrl("admin-getProcessVersion"),r={};return r.idWfClass=e.idWFClass,$.read(t,r)},getProcessTasks:function(e){var t=this.serviceLocator.getUrl("admin-getProcessTasks"),r={};return r.idWfClass=e.idWFClass,r.version=e.version?e.version:void 0,$.read(t,r)},getTaskAlarms:function(e){var t=this.serviceLocator.getUrl("admin-getTaskAlarms"),r={};return r.idTask=e.idTask,$.read(t,r)},getLapseMode:function(){var e=this.serviceLocator.getUrl("admin-getLapseMode");return $.read(e)},getRecurrMode:function(){var e=this.serviceLocator.getUrl("admin-getRecurrMode");return $.read(e)},getScheduleType:function(){var e=this.serviceLocator.getUrl("admin-getScheduleType");return $.read(e)},getBossList:function(e){var t=this.serviceLocator.getUrl("admin-getBossList");return $.read(t)},addAlarm:function(e){var t=this.serviceLocator.getUrl("admin-addAlarm"),r={};return r.idTask=e.idTask,r.idRecurrMode=e.idRecurrMode,r.idLapseMode=e.idLapseMode,r.scheduleType=e.scheduleType,r.alarmTime=e.alarmTime,r.alarmRecurrTime=e.alarmRecurrTime,r.sendToCurrentAssignee=e.sendToCurrentAssignee,$.update(t,r)},editAlarm:function(e){var t=this.serviceLocator.getUrl("admin-editAlarm"),r={};return r.idTask=e.idTask,r.idAlarm=e.idAlarm,r.idRecurrMode=e.idRecurrMode,r.idLapseMode=e.idLapseMode,r.scheduleType=e.scheduleType,r.alarmTime=e.alarmTime,r.alarmRecurrTime=e.alarmRecurrTime,r.sendToCurrentAssignee=e.sendToCurrentAssignee,$.update(t,r)},deleteAlarm:function(e){var t=this.serviceLocator.getUrl("admin-deleteAlarm");return e.idAlarm,$.destroy(t,e)},getAlarmRecipients:function(e){var t=this.serviceLocator.getUrl("admin-alarmRecipients"),r={};return r.idAlarm=e.idAlarm,$.read(t,r)},addRecipientToAlarm:function(e){var t=this.serviceLocator.getUrl("admin-recipientToAlarm"),r={};return r.idAlarm=e.idAlarm,r.idRecipient=e.idRecipient,$.update(t,r)},deleteRecipientsFromAlarm:function(e){var t=this.serviceLocator.getUrl("admin-deleteAlarmRecipients"),r={};return r.idRecipients=e.idRecipients,$.destroy(t,r)},enableAlarm:function(e){var t=this.serviceLocator.getUrl("admin-enableAlarm"),r={};return r.idTask=e.idTask,$.create(t,r)},abortReassignItems:function(e){var t=e||{},r="abort"==e.action?"admin-abortItems":"admin-reassignItems";return $.ajax({url:this.serviceLocator.getUrl(r),data:t,type:"POST",dataType:"json"})},asyncActivitiesServices:function(e){var t=e,r="",i="GET";return"getActivities"==e.action?r=this.serviceLocator.getUrl("admin-async-activities-get-activities"):"retryNow"==e.action?(i="POST",r=(r=(r=(r=this.serviceLocator.getUrl("admin-async-activities-get-retry-now")).replace("{idCase}",e.idCase)).replace("{idworkItem}",e.idWorkitem)).replace("{idAsynchWorkitem}",e.idAsynchWorkitem)):"getActivitiesByTask"==e.action?r=this.serviceLocator.getUrl("admin-async-activities-get-activities-by-task"):"enableExecution"==e.action?(i="POST",r=this.serviceLocator.getUrl("admin-async-activities-enable-execution")):"enableMultiple"==e.action?(r=this.serviceLocator.getUrl("admin-async-activities-enable-multiple"),i="POST"):"asyncExecution"==e.action?r=this.serviceLocator.getUrl("admin-async-activities-async-execution"):"asyncExecutionLog"==e.action?r=(r=(r=(r=this.serviceLocator.getUrl("admin-async-activities-async-execution-log")).replace("{idCase}",e.idCase)).replace("{idworkItem}",e.idWorkItem)).replace("{idAsynchWorkitem}",e.idAsynchWorkitem):"getAsyncExecution"==e.action&&(r=this.serviceLocator.getUrl("admin-async-activities-async-get-current-execution-log")),$.ajax({url:r,data:t,type:i,dataType:"json"})},getDefaultAssignationUserToAllProcess:function(e){return $.read(this.serviceLocator.getUrl("admin-getDefaultAssignationUserToAllProcess"),{serviceAction:"getDefaultAssignationUserToAllProcess"})},getDefaultAssignationUserToProcess:function(e){var t;return t=""==e.idWFClass?-1:e.idWfClass,$.read(this.serviceLocator.getUrl("admin-getDefaultAssignationUserToProcess"),{serviceAction:"getDefaultAssignationUserToProcess",process:t})},setDefaultAssignationUserToProcess:function(e){return""==e.idWFClass?process=-1:process=e.idWfClass,$.create(this.serviceLocator.getUrl("admin-setDefaultAssignationUserToProcess"),{serviceAction:"setDefaultAssignationUserToProcess",process:process,idUser:e.idUser})},getProcessIcon:function(e){var t={processId:e.processId};return $.read({url:this.serviceLocator.getUrl("process-getIcon"),data:t,batchRequest:!0})},getCollectionIcon:function(e){var t={collectionId:e.collectionId};return $.read({url:this.serviceLocator.getUrl("collections-getIcon"),data:t,batchRequest:!0})},getProfilesTypes:function(e){return $.read(this.serviceLocator.getUrl("admin-getProfilesTypes"))},searchProfiles:function(e){var t=this.serviceLocator.getUrl("admin-searchProfiles"),r={};return r.type=e.profileType,r.name=e.profileName,r.orgId=e.orgId?e.orgId:null,$.read(t,r)},getUsersByProfile:function(e){var t=this.serviceLocator.getUrl("admin-getUsersByProfile"),r={};return r.type=e.profileType,r.id=e.idProfile,$.read(t,r)},removeUserFromProfile:function(e){var t=this.serviceLocator.getUrl("admin-removeUserFromProfile"),r={};return r.type=e.profileType,r.id=e.idProfile,r.idUser=e.idUser,$.destroy(t,r)},addUserToProfile:function(e){var t=this.serviceLocator.getUrl("admin-addUserToProfile"),r={};return r.type=e.profileType,r.id=e.idProfile,r.idUser=e.idUser,$.update(t,r)},licenses:function(){var e=this.serviceLocator.getUrl("admin-Licenses");return $.read(e)},getDimensions:function(){var e=this.serviceLocator.getUrl("admin-GetDimensions");return $.read(e)},editDimension:function(e){e=e||{};var t={};t.id=e.id,t.displayName=e.displayName,t.name=e.name,t.idWfClass=e.idWfClass,t.entityPath=e.entityPath,t.description=e.description;var r=this.serviceLocator.getUrl("admin-EditDimension");return $.create(r,t)},createAdministrableDimension:function(e){e=e||{};var t={};return t.displayName=e.displayName,t.name=e.name,t.idWfClass=e.idWfClass,t.entityPath=e.entityPath,t.Description=e.description,$.ajax({url:this.serviceLocator.getUrl("admin-CreateAdministrableDimension"),data:e,type:"PUT",dataType:"json"})},deleteDimension:function(e){var t=this.serviceLocator.getUrl("admin-DeleteDimension");e=e||{};var r={};return r.id=e.id,r.idDimension=e.id,r.administrable=e.administrable,$.destroy(t,r)},entityPathChildNodesAction:function(e){e=e||{};var t={};return t.pathNodeType=e.nodeType,t.idNode=e.idNode,t.nodeDisplayPath=e.nodeDisplayPath,t.nodePath=e.nodePath,t.idWfClass=e.idWfClass,$.ajax({url:this.serviceLocator.getUrl("admin-EntityPathChildNodesAction"),data:e,type:"GET",dataType:"json"})},getActiveWFClasses:function(e){var t=e||{};return $.ajax({cache:!0,url:this.serviceLocator.getUrl("admin-GetActiveWFClasses"),data:t,type:"GET",dataType:"json"})},storeDocumentTemplates:function(){var e=this.serviceLocator.getUrl("admin-document-templates-storeDocumentTemplates");return $.read(e)},restoreDocumentTemplates:function(e){var t=this.serviceLocator.getUrl("admin-document-templates-restoreDocumentTemplates");return t+="?Guid="+e.Guid,$.read(t)},getWorkFlowClasses:function(){var e=this.serviceLocator.getUrl("admin-processes-workflowClasses");return $.read(e)},getTaskByWorkFlow:function(e){var t=this.serviceLocator.getUrl("admin-processes-tasksByWorkflow"),r={};return r.idWorkflow=e.idWorkflow,$.read(t,r)},modifyProcessDuration:function(e){var t=this.serviceLocator.getUrl("admin-processes-modifyProcessDuration"),r={};return r.idWorkflow=e.idWorkflow,r.duration=e.duration,$.create(t,r)},modifyTaskDuration:function(e){var t=this.serviceLocator.getUrl("admin-processes-modifyTaskDuration"),r={};return r.idTask=e.idTask,r.duration=e.duration,$.create(t,r)},getDataForMyTeam:function(){return $.ajax({url:this.serviceLocator.getUrl("bam-resourcemonitor-myteam"),type:"GET",dataType:"json"})},getReporstAnalysisQuery:function(){return $.read(this.serviceLocator.getUrl("reports-analysisquery"))},updateReportData:function(e){return $.update(this.serviceLocator.getUrl("reports-analysisquery-update"),e)},deleteReportData:function(e){return $.destroy(this.serviceLocator.getUrl("reports-analysisquery-delete")+"?"+e)},getStoreLanguageTemplates:function(){var e=this.serviceLocator.getUrl("admin-language-languages");return $.read(e,{justActives:!1})},getLanguageTemplate:function(e){var t=$.Deferred(),r=this.serviceLocator.getUrl("admin-language-resource")+"?cultureName="+e.cultureName;return t.resolve("OK"),window.location.href=r,t.promise()},processDefinition:function(e){return $.read(this.serviceLocator.getUrl("processviewer-processdefinition"),e)},graphicInfo:function(e){return $.read(this.serviceLocator.getUrl("processviewer-processgraphicinfo"),e)},getLastUpdateByMobile:function(){return $.read({url:this.serviceLocator.getUrl("mobile-getLastUpdate")})},getCollectionData:function(e){var t={},r=this.serviceLocator.getUrl("templates-handler-getCollectionData");return t.idFact=e.idFact,t.pag=e.page||1,t.pagSize=e.pageSize||10,t.filters=e.filters?Array.isArray(e.filters)?void 0:JSON.stringify(e.filters):void 0,$.read(r,t).pipe((function(e){return e}))},getVirtualCollectionData:function(e){var t={},r=this.serviceLocator.getUrl("templates-handler-getVirtualCollectionData");return t.guidVirtualCollection=e.guidVirtualCollection,t.pag=e.page||1,t.pagSize=e.pageSize||10,t.filters=e.filters?Array.isArray(e.filters)?void 0:JSON.stringify(e.filters):void 0,$.read(r,t).pipe((function(e){return e}))},getSearchData:function(e){var t=this,r=t.serviceLocator.getUrl("my-search-getData");r=r.replace("{guidSearch}",e.guidSearch);var i=e.filters||[],a={filters:JSON.stringify(i),pag:e.page||1,calculateFilters:e.calculateFilters||!1,pagSize:e.pageSize||10};return $.read(r,a).then((function(e){return t.serializeEntityData(e)}))},getCollectionEntityData:function(e){var t,r=this,i={templateType:"VIRTUAL"===(e=e||{}).referenceType||"FACT"===e.referenceType?"List":"Content",surrogateKey:e.surrogateKey,pag:e.page||1,pagSize:e.pageSize||10,defaultFilterApplied:e.defaultFilterApplied,filters:JSON.stringify(e.filters)};return"VIRTUAL"===e.referenceType?(t=r.serviceLocator.getUrl("data-navigation-handler-collection"),i.reference=e.reference):(t=r.serviceLocator.getUrl("data-navigation-handler-entity"),i.reference=e.guidEntityCurrent,i.xpath=e.xpath,i.collectionId=e.reference),$.read(t,i).then((function(e){return r.serializeEntityData(e)}))},getFiltersEntityData:function(e){var t={reference:(e=e||{}).guidEntityCurrent,collectionId:e.reference,surrogateKey:e.surrogateKey,xpath:e.xpath,templateType:"List",defaultFilterApplied:e.defaultFilterApplied,filters:JSON.stringify(e.filters)};return $.read({url:this.serviceLocator.getUrl("data-navigation-handler-entity-filters"),data:t})},getProcessAddAction:function(e){var t=this.serviceLocator.getUrl("action-handler-getProcessAddAction");return $.read(t,e).pipe((function(e){return e}))},getMultipleActions:function(e){var t=this.serviceLocator.getUrl("templates-handler-getMultipleActions");return $.read(t,e).pipe((function(e){return e}))},getMapping:function(e){return $.ajax({url:this.serviceLocator.getUrl("process-handler-getMapping"),data:e,type:"POST",dataType:"json"})},getForm:function(e){return e[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,e[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,$.ajax({url:this.serviceLocator.getUrl("process-handler-getForm"),data:e,type:"POST",dataType:"json"})},hasStartForm:function(e){var t={};return e.guid&&(t.guidWFClass=e.guid),$.read(this.serviceLocator.getUrl("process-handler-startform"),t)},executeAction:function(e){var t={surrogateKey:JSON.stringify(e.surrogatedKey),entityId:e.entityId,ruleId:e.processId};return $.create({url:this.serviceLocator.getUrl("process-action-execute"),data:t})},actionRule:function(e){var t={surrogateKey:e.surrogateKey,entityId:e.entityId,ruleId:e.processId};return $.create({url:this.serviceLocator.getUrl("process-handler-rule"),data:t,batchRequest:!1})},getActivitiesData:function(e){var t=this,r=t.serviceLocator.getUrl("process-handler-getActivitiesData"),i={page:(e=e||{}).page||1,pagsize:e.pageSize||10};return(void 0!==e.idworkflow&&e.idworkflow||void 0!==e.idWorkflow&&e.idWorkflow)&&(i.idWorkflow=e.idworkflow||e.idWorkflow),void 0!==e.idCase&&e.idCase&&(i.idCase=e.idCase),$.read(r,i).then((function(e){return t.serializeEntityData(e)}))},getPendingsData:function(e){var t=this,r=t.serviceLocator.getUrl("process-handler-getPendingsData"),i={page:(e=e||{}).page||1,pagsize:e.pageSize||10};return(void 0!==e.idworkflow&&e.idworkflow||void 0!==e.idWorkflow&&e.idWorkflow)&&(i.idWorkflow=e.idworkflow||e.idWorkflow),void 0!==e.idCase&&e.idCase&&(i.idCase=e.idCase),void 0!==e.taskState&&e.taskState&&(i.taskState=e.taskState),$.read(r,i).then((function(e){return t.serializeEntityData(e)}))},getActionsData:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("entities-handler-getActions"),data:e,batchRequest:!0}).pipe((function(e){return e}))},getUsersAndEvents:function(e){var t={};return e.idCases&&e.idCases.length>0&&(t.idCases=e.idCases.toString()),$.read(this.serviceLocator.getUrl("entities-handler-getUsersAndEvents"),t)},getUsers:function(e){e.caseId;return $.read({url:this.serviceLocator.getUrl("entities-handler-getUsers"),data:e,batchRequest:!0})},getEvents:function(e){e.caseId;return $.read({url:this.serviceLocator.getUrl("entities-handler-getEvents"),data:e,batchRequest:!0})},getUsersImages:function(e,t){var r={},i=this.serviceLocator.getUrl("entities-handler-getUsersImages");return t&&t.length>0&&(r.userIds=t.toString()),r.width=e.width,r.height=e.height,r.square=e.square,bizagi.util.getFeatureObject("userService.v1.enabled")?$.ajax({url:i,data:r,type:"POST",dataType:"json"}):$.read({url:i,data:r,dataType:"json"})},getPreferencesCurrentUser:function(){var e=this.serviceLocator.getUrl("currentUser");return $.ajax({url:e,type:"GET"})},getPreferencesWorkportalCurrentUser:function(){return $.read(this.serviceLocator.getUrl("PreferencesWorkportalCurrentUser"))},getShortCuts:function(e){var t={},r=this.serviceLocator.getUrl("entities-handler-getShotCuts");return void 0!==e.icon&&e.icon&&(t.icon=!0),$.read(r,t)},getSearchLists:function(){return $.read(this.serviceLocator.getUrl("my-search-getSearchLists"),{})},getIdCasesOfProcessEntities:function(e){e=e||{};var t={ids:JSON.stringify(e)};return bizagi.version.server.lessThanOrEqualsTo("11.0.0.2608")?$.read({url:this.serviceLocator.getUrl("process-handler-getIdCasesOfProcessEntities"),data:t}):$.ajax({url:this.serviceLocator.getUrl("process-handler-getIdCasesOfProcessEntities"),data:t,type:"POST"})},getQueryForm:function(e){return e=e||{},$.ajax({url:this.serviceLocator.getUrl("query-handler-getQueryForm"),data:e,type:"POST",dataType:e.dataType||"json"})},defineFilterObject:function(e,t,r){var i=e.properties,a=i.xpath.split("@")[0],s=t.find((function(e){return e.xpath==a}));if(s){if("from"==i.rangeQuery)s.value=s.value||{},s.searchType="range",s.value.min=e.value;else if("to"==i.rangeQuery)s.value=s.value||{},s.searchType="range",s.value.max=e.value;else{e.properties.typeSearch=s.searchType;var n=l(e);$.extend(s,n)}i.orderType&&(s.orderType=i.orderType),r&&r(bizagi.clone(s))}else{var o=i.defaultFilter||!1;s=l(e),i.orderType&&(s.orderType=i.orderType),(void 0!==s.value||s.orderType||o)&&(t.push(s),r&&r(bizagi.clone(s)))}function l(e){var t=e.properties,r=t.typeSearch,i=e.value;if("boolean"==t.type&&("null"===i.toLowerCase()?(i=null,r="Nullable"):(i=bizagi.util.parseBoolean(i),r="exact")),"number"!=t.type&&"money"!=t.type&&"date"!=t.type||(r="exact"),"object"==_typeof(e.value)){if(i=[],Array.isArray(e.value))for(var s=0,n=e.value.length;s<n;s++){var o=parseInt(e.value[s].id);isNaN(o)||i.push(o)}else{o=parseInt(e.value.id);isNaN(o)||i.push(o)}r="exact",i=i.length>0?i:void 0}t.rangeQuery&&"none"!==t.rangeQuery&&(i={min:e.value,max:e.value},r="range");var l={xpath:a,searchType:r=r||"approx"};return void 0!==i&&(l.value=i),l}},getPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-get");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getActivities:function(e){var t=this.serviceLocator.getUrl("project-plan-activities");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},updatePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-update");return $.update({url:t.replace("{idPlan}",e.id),data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},putExecutePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-execute");return $.create({url:t,data:e,contentType:"application/x-www-form-urlencoded"})},deletePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-delete");return $.destroy({url:t.replace("{idPlan}",e.id),data:e,contentType:"application/x-www-form-urlencoded"})},closePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-close");return $.create({url:t,data:e,contentType:"application/x-www-form-urlencoded"})},getWorkitemsPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-workitems");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getTransitionsByPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-transitions-get");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},editActivityPlan:function(e){var t={};e.activity?(t=e.activity).items=e.items:t=e;var r=this.serviceLocator.getUrl("project-plan-activity-edit").replace("{idPlan}",t.idPlan).replace("{id}",t.id);return $.update({url:r,data:JSON.stringify(t),dataType:"json",contentType:"application/json"})},getPlanByParent:function(e){var t=this.serviceLocator.getUrl("project-plan-get-by-parent"),r=$.Deferred();return $.when($.read({url:t,data:e,dataType:"json",contentType:"application/json"})).done((function(e){r.resolve(e)})),r.promise()},getItemsByActivity:function(e){var t=this.serviceLocator.getUrl("project-plan-activity-tasks-get");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getPlanParent:function(e){var t=this.serviceLocator.getUrl("project-plan-parent");return $.read({url:t,data:e,dataType:"json"})},serializeEntityData:function(e){var t=e;function r(e,t){var r={data:{},guid:t.guidEntity,timestamp:e.timestamp},i=e.columns,a=t.row;for(name in t)t.hasOwnProperty(name)&&"row"!==name.toString()&&"id"!==name.toString()&&(r[name]=t[name]);for(var s=0,n=i.length;s<n;s+=1)r.data[i[s]]=a[s];return r}t.entities=[];for(var i,a=-1;i=e.rows[++a];)for(var s,n=-1;s=e.cells[++n];)if(s.id===i.id){var o=r(s,i);t.entities.push(o);break}return t},getCardViewCustomizedColumns:function(e){return(e=e||{}).sortData=bizagi.util.getLastProcessInboxSort(),this.getMobileActivities(e)},getMobileActivities:function(e){var t=this,r=t.serviceLocator.getUrl("case-handler-getActivityList"),i=e||{},a=e.sortData;a&&(bizagi.util.isMobileInboxByProcessSupported()&&a.sortOrder&&a.sortDirection&&a.sortFieldName?(i.orderFieldName=a.sortFieldName,i.orderType="asc"==a.sortDirection?0:1,i.order=a.sortOrder):delete i.sortData),void 0!==e.radNumber&&(i.radNumber=e.radNumber),-1!=e.idWfClass&&(i.idWfClass=e.idWfClass),i.mobileDevice=bizagi.util.isMobileDevice(),i.page=i.page||1,i.pageSize=i.pageSize||10,null!=i.idWfClass&&i.idWfClass<0&&delete i.idWfClass,e.smartInboxId&&(i.smartInboxGuid=e.smartInboxId),e.liveFilterData&&(i.smartInboxFilter=t.encodeLiveFilter(e.liveFilterData),delete e.liveFilterData);var s,n={url:r,data:i,type:"GET",dataType:"json"};return e.avoidLoader&&(n.avoidLoader=!0,delete i.avoidLoader),$.ajax(n).then((function(r){return bizagi.util.setLastProcessInboxProcessColumns(r.headers),s=r,e.includeSyncErrors&&"inbox"==e.inputtray?t.getInboxSyncErrors():void 0})).then((function(e){return null!=e&&(s.syncErrors=e),s}))},encodeLiveFilter:function(e){var t,r,i="",a=a||function(e,t){var r={},i=r.lib={},a=function(){},s=i.Base={extend:function(e){a.prototype=this;var t=new a;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},n=i.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var a=0;a<e;a++)t[i+a>>>2]|=(r[a>>>2]>>>24-a%4*8&255)<<24-(i+a)%4*8;else if(65535<r.length)for(a=0;a<e;a+=4)t[i+a>>>2]=r[a>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],i=0;i<t;i+=4)r.push(4294967296*e.random()|0);return new n.init(r,t)}}),o=r.enc={},l=o.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],i=0;i<e;i++){var a=t[i>>>2]>>>24-i%4*8&255;r.push((a>>>4).toString(16)),r.push((15&a).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new n.init(r,t/2)}},c=o.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],i=0;i<e;i++)r.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new n.init(r,t)}},d=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new n.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,i=r.words,a=r.sigBytes,s=this.blockSize,o=a/(4*s);if(t=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*s,a=e.min(4*t,a),t){for(var l=0;l<t;l+=s)this._doProcessBlock(i,l);l=i.splice(0,t),r.sigBytes-=a}return new n.init(l,a)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=u.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}});var p=r.algo={};return r}(Math);r=(t=a).lib.WordArray,t.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,i=this._map;e.clamp(),e=[];for(var a=0;a<r;a+=3)for(var s=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,n=0;4>n&&a+.75*n<r;n++)e.push(i.charAt(s>>>6*(3-n)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,i=this._map;(a=i.charAt(64))&&-1!=(a=e.indexOf(a))&&(t=a);for(var a=[],s=0,n=0;n<t;n++)if(n%4){var o=i.indexOf(e.charAt(n-1))<<n%4*2,l=i.indexOf(e.charAt(n))>>>6-n%4*2;a[s>>>2]|=(o|l)<<24-s%4*8,s++}return r.create(a,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,r,i,a,s,n){return((e=e+(t&r|~t&i)+a+n)<<s|e>>>32-s)+t}function r(e,t,r,i,a,s,n){return((e=e+(t&i|r&~i)+a+n)<<s|e>>>32-s)+t}function i(e,t,r,i,a,s,n){return((e=e+(t^r^i)+a+n)<<s|e>>>32-s)+t}function s(e,t,r,i,a,s,n){return((e=e+(r^(t|~i))+a+n)<<s|e>>>32-s)+t}for(var n=a,o=(c=n.lib).WordArray,l=c.Hasher,c=n.algo,d=[],u=0;64>u;u++)d[u]=4294967296*e.abs(e.sin(u+1))|0;c=c.MD5=l.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,a){for(var n=0;16>n;n++){var o=e[l=a+n];e[l]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}n=this._hash.words;var l=e[a+0],c=(o=e[a+1],e[a+2]),u=e[a+3],p=e[a+4],f=e[a+5],g=e[a+6],h=e[a+7],m=e[a+8],y=e[a+9],v=e[a+10],C=e[a+11],A=e[a+12],E=e[a+13],P=e[a+14],x=e[a+15],T=t(T=n[0],S=n[1],R=n[2],b=n[3],l,7,d[0]),b=t(b,T,S,R,o,12,d[1]),R=t(R,b,T,S,c,17,d[2]),S=t(S,R,b,T,u,22,d[3]);T=t(T,S,R,b,p,7,d[4]),b=t(b,T,S,R,f,12,d[5]),R=t(R,b,T,S,g,17,d[6]),S=t(S,R,b,T,h,22,d[7]),T=t(T,S,R,b,m,7,d[8]),b=t(b,T,S,R,y,12,d[9]),R=t(R,b,T,S,v,17,d[10]),S=t(S,R,b,T,C,22,d[11]),T=t(T,S,R,b,A,7,d[12]),b=t(b,T,S,R,E,12,d[13]),R=t(R,b,T,S,P,17,d[14]),T=r(T,S=t(S,R,b,T,x,22,d[15]),R,b,o,5,d[16]),b=r(b,T,S,R,g,9,d[17]),R=r(R,b,T,S,C,14,d[18]),S=r(S,R,b,T,l,20,d[19]),T=r(T,S,R,b,f,5,d[20]),b=r(b,T,S,R,v,9,d[21]),R=r(R,b,T,S,x,14,d[22]),S=r(S,R,b,T,p,20,d[23]),T=r(T,S,R,b,y,5,d[24]),b=r(b,T,S,R,P,9,d[25]),R=r(R,b,T,S,u,14,d[26]),S=r(S,R,b,T,m,20,d[27]),T=r(T,S,R,b,E,5,d[28]),b=r(b,T,S,R,c,9,d[29]),R=r(R,b,T,S,h,14,d[30]),T=i(T,S=r(S,R,b,T,A,20,d[31]),R,b,f,4,d[32]),b=i(b,T,S,R,m,11,d[33]),R=i(R,b,T,S,C,16,d[34]),S=i(S,R,b,T,P,23,d[35]),T=i(T,S,R,b,o,4,d[36]),b=i(b,T,S,R,p,11,d[37]),R=i(R,b,T,S,h,16,d[38]),S=i(S,R,b,T,v,23,d[39]),T=i(T,S,R,b,E,4,d[40]),b=i(b,T,S,R,l,11,d[41]),R=i(R,b,T,S,u,16,d[42]),S=i(S,R,b,T,g,23,d[43]),T=i(T,S,R,b,y,4,d[44]),b=i(b,T,S,R,A,11,d[45]),R=i(R,b,T,S,x,16,d[46]),T=s(T,S=i(S,R,b,T,c,23,d[47]),R,b,l,6,d[48]),b=s(b,T,S,R,h,10,d[49]),R=s(R,b,T,S,P,15,d[50]),S=s(S,R,b,T,f,21,d[51]),T=s(T,S,R,b,A,6,d[52]),b=s(b,T,S,R,u,10,d[53]),R=s(R,b,T,S,v,15,d[54]),S=s(S,R,b,T,o,21,d[55]),T=s(T,S,R,b,m,6,d[56]),b=s(b,T,S,R,x,10,d[57]),R=s(R,b,T,S,g,15,d[58]),S=s(S,R,b,T,E,21,d[59]),T=s(T,S,R,b,p,6,d[60]),b=s(b,T,S,R,C,10,d[61]),R=s(R,b,T,S,c,15,d[62]),S=s(S,R,b,T,y,21,d[63]),n[0]=n[0]+T|0,n[1]=n[1]+S|0,n[2]=n[2]+R|0,n[3]=n[3]+b|0},_doFinalize:function(){var t=this._data,r=t.words,i=8*this._nDataBytes,a=8*t.sigBytes;r[a>>>5]|=128<<24-a%32;var s=e.floor(i/4294967296);for(r[15+(a+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r[14+(a+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(r.length+1),this._process(),r=(t=this._hash).words,i=0;4>i;i++)a=r[i],r[i]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),n.MD5=l._createHelper(c),n.HmacMD5=l._createHmacHelper(c)}(Math),function(){var e,t=a,r=(e=t.lib).Base,i=e.WordArray,s=(e=t.algo).EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=(o=this.cfg).hasher.create(),a=i.create(),s=a.words,n=o.keySize,o=o.iterations;s.length<n;){l&&r.update(l);var l=r.update(e).finalize(t);r.reset();for(var c=1;c<o;c++)l=r.finalize(l),r.reset();a.concat(l)}return a.sigBytes=4*n,a}});t.EvpKDF=function(e,t,r){return s.create(r).compute(e,t)}}(),a.lib.Cipher||function(e){var t=(g=a).lib,r=t.Base,i=t.WordArray,s=t.BufferedBlockAlgorithm,n=g.enc.Base64,o=g.algo.EvpKDF,l=t.Cipher=s.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,r,i){return("string"==typeof r?h:f).encrypt(e,t,r,i)},decrypt:function(t,r,i){return("string"==typeof r?h:f).decrypt(e,t,r,i)}}}});t.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=g.mode={},d=function(e,t,r){var i=this._iv;i?this._iv=void 0:i=this._prevBlock;for(var a=0;a<r;a++)e[t+a]^=i[a]},u=(t.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();u.Encryptor=u.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize;d.call(this,e,t,i),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),u.Decryptor=u.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,a=e.slice(t,t+i);r.decryptBlock(e,t),d.call(this,e,t,i),this._prevBlock=a}}),c=c.CBC=u,u=(g.pad={}).Pkcs7={pad:function(e,t){for(var r,a=(r=(r=4*t)-e.sigBytes%r)<<24|r<<16|r<<8|r,s=[],n=0;n<r;n+=4)s.push(a);r=i.create(s,r),e.concat(r)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=l.extend({cfg:l.cfg.extend({mode:c,padding:u}),reset:function(){l.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=t.createEncryptor;else r=t.createDecryptor,this._minBufferSize=1;this._mode=r.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var p=t.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(c=(g.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(n)},parse:function(e){var t=(e=n.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var r=i.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return p.create({ciphertext:e,salt:r})}},t.SerializableCipher=r.extend({cfg:r.extend({format:c}),encrypt:function(e,t,r,i){i=this.cfg.extend(i);var a=e.createEncryptor(r,i);return t=a.finalize(t),a=a.cfg,p.create({ciphertext:t,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,r,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(r,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),g=(g.kdf={}).OpenSSL={execute:function(e,t,r,a){return a||(a=i.random(8)),e=o.create({keySize:t+r}).compute(e,a),r=i.create(e.words.slice(t),4*r),e.sigBytes=4*t,p.create({key:e,iv:r,salt:a})}},h=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:g}),encrypt:function(e,t,r,i){return r=(i=this.cfg.extend(i)).kdf.execute(r,e.keySize,e.ivSize),i.iv=r.iv,(e=f.encrypt.call(this,e,t,r.key,i)).mixIn(r),e},decrypt:function(e,t,r,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),r=i.kdf.execute(r,e.keySize,e.ivSize,t.salt),i.iv=r.iv,f.decrypt.call(this,e,t,r.key,i)}})}(),function(){for(var e=a,t=e.lib.BlockCipher,r=e.algo,i=[],s=[],n=[],o=[],l=[],c=[],d=[],u=[],p=[],f=[],g=[],h=0;256>h;h++)g[h]=128>h?h<<1:h<<1^283;var m=0,y=0;for(h=0;256>h;h++){var v=(v=y^y<<1^y<<2^y<<3^y<<4)>>>8^255&v^99;i[m]=v,s[v]=m;var C=g[m],A=g[C],E=g[A],P=257*g[v]^16843008*v;n[m]=P<<24|P>>>8,o[m]=P<<16|P>>>16,l[m]=P<<8|P>>>24,c[m]=P,P=16843009*E^65537*A^257*C^16843008*m,d[v]=P<<24|P>>>8,u[v]=P<<16|P>>>16,p[v]=P<<8|P>>>24,f[v]=P,m?(m=C^g[g[g[E^C]]],y^=g[g[y]]):m=y=1}var x=[0,1,2,4,8,16,32,64,128,27,54];r=r.AES=t.extend({_doReset:function(){for(var e=(r=this._key).words,t=r.sigBytes/4,r=4*((this._nRounds=t+6)+1),a=this._keySchedule=[],s=0;s<r;s++)if(s<t)a[s]=e[s];else{var n=a[s-1];s%t?6<t&&4==s%t&&(n=i[n>>>24]<<24|i[n>>>16&255]<<16|i[n>>>8&255]<<8|i[255&n]):(n=i[(n=n<<8|n>>>24)>>>24]<<24|i[n>>>16&255]<<16|i[n>>>8&255]<<8|i[255&n],n^=x[s/t|0]<<24),a[s]=a[s-t]^n}for(e=this._invKeySchedule=[],t=0;t<r;t++)s=r-t,n=t%4?a[s]:a[s-4],e[t]=4>t||4>=s?n:d[i[n>>>24]]^u[i[n>>>16&255]]^p[i[n>>>8&255]]^f[i[255&n]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,n,o,l,c,i)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,d,u,p,f,s),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,i,a,s,n,o){for(var l=this._nRounds,c=e[t]^r[0],d=e[t+1]^r[1],u=e[t+2]^r[2],p=e[t+3]^r[3],f=4,g=1;g<l;g++){var h=i[c>>>24]^a[d>>>16&255]^s[u>>>8&255]^n[255&p]^r[f++],m=i[d>>>24]^a[u>>>16&255]^s[p>>>8&255]^n[255&c]^r[f++],y=i[u>>>24]^a[p>>>16&255]^s[c>>>8&255]^n[255&d]^r[f++];p=i[p>>>24]^a[c>>>16&255]^s[d>>>8&255]^n[255&u]^r[f++],c=h,d=m,u=y}h=(o[c>>>24]<<24|o[d>>>16&255]<<16|o[u>>>8&255]<<8|o[255&p])^r[f++],m=(o[d>>>24]<<24|o[u>>>16&255]<<16|o[p>>>8&255]<<8|o[255&c])^r[f++],y=(o[u>>>24]<<24|o[p>>>16&255]<<16|o[c>>>8&255]<<8|o[255&d])^r[f++],p=(o[p>>>24]<<24|o[c>>>16&255]<<16|o[d>>>8&255]<<8|o[255&u])^r[f++],e[t]=h,e[t+1]=m,e[t+2]=y,e[t+3]=p},keySize:8}),e.AES=t._createHelper(r)}();try{i=JSON.encode(e)}catch(r){i=JSON.encode("[]")}var s=a.enc.Utf8.parse(i);return a.enc.Base64.stringify(s)},includeAllProcessesItem:function(e){var t={idworkflow:"-1",guidWFClass:"-1",name:bizagi.localization.getResource("workportal-widget-inbox-all-processes"),path:"App/",count:0,isFavorite:"false",icon:"",category:"Processes",guidFavorite:"",orderValue:String.fromCharCode(0)};e.workflows&&($.each(e.workflows.workflow,(function(r,i){e.workflows.workflow[r].orderValue=e.workflows.workflow[r].name,t.count+=Number(i.count)})),e.workflows.workflow.unshift(t))},isInboxSystemHeaderSortable:function(e,t,r){var i=!1,a={};if("detailView"===r?a={radnumber:!0,wiestimatedsolutiondate:!0,isfavorite:!0,currenttask:!0,wfclsdisplayname:!0}:"cardView"===r&&(a={radnumber:!0,wiestimatedsolutiondate:!0,isfavorite:!0,currenttask:!0,wfclsdisplayname:!0,taskstate:!0}),a.wfclsdisplayname){var s=null!=t.smartInboxId&&null!=t.smartInboxId&&"wfclsdisplayname"==e.fieldName&&!e.isSmartInbox;(-1!=t.idWorkflow||s)&&(a.wfclsdisplayname=!1)}e&&e.fieldName&&(a[e.fieldName.toLowerCase()]&&(e.order||e.fieldFilterName)&&(i=!0));return i},isInboxHeaderASystemColumn:function(e){return{taskstate:!0,taskstateColor:!0,radnumber:!0,wfclsdisplayname:!0,currenttask:!0,cascreationdate:!0,wiestimatedsolutiondate:!0,cassolutiondate:!0,idcase:!0,idworkitem:!0,taskid:!0,atrisktime:!0,currentuser:!0,currentfullname:!0,fieldName:!0,idwfclass:!0,isfavorite:!0,guidfavorite:!0,creatorfullname:!0}[e.toLowerCase()]||!1},validateCustomColumn:function(e,t,r){var i={isValid:!1,selectedColumnsCount:r};return r<t&&(e.isSmartInbox||e.isCustomColumn)&&(i.isValid=!0,i.selectedColumnsCount=r+1),i},configureGlobalHandlers:function(){var e=this;$(document).off("openForm.services"),$(document).on("openForm.services",(function(t,r){e.activeForm=r.form})),$(document).off("disposeForm.services"),$(document).on("disposeForm.services",(function(t,r){e.activeForm=void 0}))},getAllSmartInbox:function(){return $.read({url:this.serviceLocator.getUrl("smartinbox-getAllInbox"),data:{}})},getSpecificSmartInbox:function(e){var t=this.serviceLocator.getUrl("smartinbox-specific-inbox").replace("{settingName}",e.settingName);return t=(t=t.replace("{owner}",e.owner)).replace("{smartInboxId}",e.smartInboxId),$.read({url:t,data:{}})},getAllProcessesSmartInbox:function(e){return $.read({url:this.serviceLocator.getUrl("smartinbox-processes"),data:{}})},getAllCustomizedColumnsSmartInbox:function(e){var t=JSON.stringify(e);return $.ajax({url:this.serviceLocator.getUrl("smartinbox-customized-columns"),data:t,type:"POST",dataType:"json",contentType:"application/json"})},createSmartInbox:function(e){var t=JSON.stringify(e);return $.ajax({url:this.serviceLocator.getUrl("smartinbox-createinbox"),data:t,type:"POST",dataType:"json",contentType:"application/json"})},updateSmartInbox:function(e,t){var r=JSON.stringify(t),i=this.serviceLocator.getUrl("smartinbox-specific-inbox").replace("{settingName}",e.settingName);return i=(i=i.replace("{owner}",e.owner)).replace("{smartInboxId}",e.smartInboxId),$.ajax({url:i,data:r,type:"PUT",dataType:"json",contentType:"application/json"})},deleteSmartInbox:function(e){var t=this.serviceLocator.getUrl("smartinbox-specific-inbox").replace("{settingName}",e.settingName);return t=(t=t.replace("{owner}",e.owner)).replace("{smartInboxId}",e.smartInboxId),$.ajax({url:t,type:"DELETE",dataType:"json",contentType:"application/json"})},shareSmartInbox:function(e,t){var r=JSON.stringify(t),i=this.serviceLocator.getUrl("smartinbox-share").replace("{smartInboxId}",e.smartInboxId);return $.ajax({url:i,data:r,type:"POST",dataType:"json",contentType:"application/json"})},getEntityValuesForInboxFilter:function(e){var t=this.serviceLocator.getUrl("smartinbox-entity-values");return t=t.replace("{entityGuid}",e.entityGuid),$.ajax({url:t,type:"GET",dataType:"json",contentType:"application/json"})},getUserTasksForInboxFilter:function(e){var t="";return t=e.isSmartInbox?(t=this.serviceLocator.getUrl("smartinbox-user-tasks")).replace("{smartInboxId}",e.id):(t=this.serviceLocator.getUrl("smartinbox-user-tasks-process")).replace("{workflowId}",e.id),$.ajax({url:t,type:"GET",dataType:"json",contentType:"application/json"})},callServiceWithNetworkRetries:function(e,t,r,i,a,s,n){var o=this;n=n||$.Deferred();return s=isNaN(s)?0:s,i=isNaN(i)?1:i,a=isNaN(a)?100:a,s>=i?(console.error("Max retries reached"),void n.reject("Max retries reached")):($.when(t.apply(e,r)).then((function(e){n.resolve(e)})).fail((function(l){0===l.status?setTimeout((function(){o.callServiceWithNetworkRetries(e,t,r,i,a,s+1,n)}),a):n.reject(l)})),n.promise())},getAndSaveMobileFeaturesFromBizagiConfig:function(){bizagi.util.validateIfSaveMobileFeaturesIsEnabled()&&$.when(this.getConfiguration()).then((function(e){e&&e.features&&bizagi.util.storeMobileFeatures(e.features)}))}}),bizagi.workportal.services.service.extend("bizagi.workportal.services.service",{},{init:function(e){this.shouldSynchronize=!(bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()&&"offlineServices"!==e.module),this.isOfflineFormsV2Supported=bizagi.util.isOfflineFormsV2Supported(),this._super(e),e.oldOfflineServicesAlreadyEnabled||(this.database=void 0===bizagi.workportal.services.db||bizagi.util.isMashupContext()?null:new bizagi.workportal.services.db,this.configureOfflineEvents()),this.isOfflineFormsV2Supported&&(e.context="workflow",e.database=this.database,this.multiactionService=new bizagi.render.services.multiactionservice(this),this.renderDataService=void 0!==bizagi.render.services.service?new bizagi.render.services.service(e):bizagi.render.services.service,this.formService=this.renderDataService.getFormService(),this.syncService=this.renderDataService.getSyncService(),this.fetchWorker=new bizagi.workportal.services.fetchWorker(this),this.pullWorker=new bizagi.workportal.services.pullWorker(this),this.shouldSynchronize&&this.configureOfflineHandlers(),this.configurePushCaseHandler()),bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()&&"offline"===bizagi.getNativeComponent()&&bizagiapp.offlineModuleReady()},multiaction:function(){return this.multiactionService},configureOfflineHandlers:function(){var e=this;$(document).on("fetch-offline-processes",$.proxy(e.fetchOfflineData,e)),$(document).on("get-offline-categories",$.proxy(e.getOfflineCategoriesHandler,e)),$(document).on("get-offline-recent-processes",$.proxy(e.getRecentProcessesHandler,e)),$(document).on("create-startform-case",$.proxy(e.createStartFormHandler,e)),$(document).on("get-offline-cases",$.proxy(e.getOfflineCasesHandler,e)),$(document).on("get-offline-case-workitems",$.proxy(e.getOfflineWorkitemsHandler,e)),$(document).on("delete-offline-case",$.proxy(e.getOfflineWorkitemsHandler,e)),$(document).off("tryPushData.offline"),$(document).on("tryPushData.offline",$.proxy(e.pushOfflineDataHandler,e)),$(document).off("cleanDatabases.offline"),$(document).on("cleanDatabases.offline",$.proxy(e.cleanDatabasesHandler,e)),$(document).off("retry-download-offline-forms"),$(document).on("retry-download-offline-forms",$.proxy(e.fetchOfflineData,e)),$(document).on("get-sync-errors-list",$.proxy(e.getSyncErrorsListHandler,e)),$(document).off("get-inbox-sync-errors"),$(document).on("get-inbox-sync-errors",$.proxy(e.getInboxSyncErrorsHandler,e)),$(document).off("retry-sync-single-offline-case"),$(document).on("retry-sync-single-offline-case",(function(t,r){e.retrySyncSingleOfflineCaseNative(r)}))},configurePushCaseHandler:function(){var e=this;$(document).off("tryPushCase.offline"),$(document).on("tryPushCase.offline",(function(t,r){var i=r.deferred||new $.Deferred;e.tryPushOfflineCaseHandler(r).then((function(e){i.resolve(e)}),(function(e){i.reject(e)}))})),$(document).off("retrySyncCase.offline"),$(document).on("retrySyncCase.offline",(function(t,r){var i=r.deferred||new $.Deferred;r.isRetry=!0,e.tryPushOfflineCaseHandler(r).then((function(e){i.resolve(e)}),(function(e){i.reject(e)}))})),$(document).off("routing-get-offline-task-sync-error"),$(document).on("routing-get-offline-task-sync-error",(function(t,r){e.getTaskSyncError(r)}))},configureOfflineEvents:function configureOfflineEvents(){var self=this;if(bizagi.isMobileDevice()){if(void 0!==navigator.connection)"undefined"==typeof Connection||navigator.connection.type!=Connection.NONE&&"unknown"!=navigator.connection.type?self.online=!0:self.online=!1;else{var queryString=bizagi.readQueryString(),queryoffline=!queryString||!queryString.online||eval(queryString.online);self.online=queryoffline}$(document).off("online.services"),$(document).on("online.services",$.proxy(self.onlineServicesHandler,self)),$(document).off("offline.services"),$(document).on("offline.services",$.proxy(self.offlineServicesHandler,self)),window.addEventListener("online",(function(){!1===bizagi.util.isCordovaSupported()&&(self.online=!0)})),window.addEventListener("offline",(function(){!1===bizagi.util.isCordovaSupported()&&(self.online=!1)}))}},getOfflineCategoriesHandler:function(e,t){var r=this;(t=t||{}).enableOfflineForm=!0,r.getCategories(t).then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineCategories(e)})).fail((function(e){r.defaultErrorHandler(e,"error getting offline categories")}))},getRecentProcessesHandler:function(){var e=this;e.getRecentProcesses().then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineRecentProcesses(e)})).fail((function(t){e.defaultErrorHandler(t,"error getting recent processes")}))},createStartFormHandler:function(e,t){var r=this;(t=t||{}).categoryName="",t.isOfflineForm=!0,r.createNewCase(t).then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.openCreatedStartForm(e)})).fail((function(e){r.defaultErrorHandler(e,"error creating a new case with start form")}))},getOfflineCasesHandler:function(e,t){var r=this,i={enableOfflineForm:!0};i.inputtray=t,r.getCasesListBeta(i).then((function(e){e.inboxType=t,bizagiapp.setOfflineInboxCases(e)})).fail((function(e){r.defaultErrorHandler(e,"error getting offline cases")}))},getOfflineWorkitemsHandler:function(e,t){var r=this;(t=t||{}).isOfflineForm=t.isOfflineForm||!0,t.idCase=t.idCase||"",r.getWorkitems(t).then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.openCreatedStartForm(e)})).fail((function(e){r.defaultErrorHandler(e,"error getting offline workitems")}))},deleteOfflineCaseHandler:function(e,t){var r=this;(t=t||{}).idCase=t.idCase||"",r.deleteCase(t).then((function(){bizagi.util.isNativePluginSupported()&&bizagiapp.offlineCaseDeleted("success")})).fail((function(e){bizagiapp.offlineCaseDeleted("error"),r.defaultErrorHandler(e,"error deleting an offline case")}))},pushOfflineDataHandler:function(e){this.online&&this.pushOfflineData()},cleanDatabasesHandler:function(){var e=this;e.database.restartDatabases().then((function(){bizagi.util.isiOSSmartphoneDevice()&&bizagi.util.isNativePluginSupported()||(bizagi.webpart.publish("bz-summary-item-clear"),e.showTaskFeed(),e.online||$(document).trigger("offline.inbox"),bizagi.webpart.publish("bz-update-list-sync-errors-cases"))})).fail((function(t){e.defaultErrorHandler(t,"error cleaning database")}))},tryPushOfflineCaseHandler:function(e){var t=this;if(t.online&&e)return t.syncSingleOfflineCase(e).then((function(t){return"task"===e.offlineType&&(t.IdCase=e.idCase),t})).fail((function(e){t.defaultErrorHandler(e,"error trying to push offline case")}));var r=bizagi.localization.getResource("workportal-login-network-error","The internet connection appears to be offline. Please verify and try again"),i=JSON.stringify({error:{errorType:"NetworkError",message:r},message:r,type:"error"});return $.Deferred().reject(i).promise()},syncSingleOfflineCase:function(e){return"task"===e.offlineType?this.pullWorker.syncSingleOfflineTaskCase(e):this.pullWorker.syncSingleOfflineStartCase(e)},onlineServicesHandler:function(){void 0!==this.lastOnlineTimestamp&&Date.now()-this.lastOnlineTimestamp<100||(this.online=!0,this.isOfflineFormsV2Supported&&this.shouldSynchronize&&(this.returnOnlineStatus(),this.lastOnlineTimestamp=Date.now()))},offlineServicesHandler:function(){this.online=!1},getSyncErrorsListHandler:function(){var e=this;e.getSyncErrorsList().then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineSyncErrorList(e)})).fail((function(t){e.defaultErrorHandler(t,"Error getting sync error list"),bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineSyncErrorList([])}))},getInboxSyncErrorsHandler:function(){$.when(this.getInboxSyncErrors()).then((function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineInboxSyncErrors(e)})).fail((function(e){bizagiapp.setOfflineInboxSyncErrors({}),this.defaultErrorHandler(e,"Error getting inbox sync errors")}))},showTaskFeed:function(){var e={updateDataList:!0,page:1},t=bizagi.util.getLastProcessInbox();bizagi.util.isEmpty(t)||bizagi.util.isEmpty(t.processInfo)||(-1!=t.processInfo.idWorkflow?e.idWorkflow=t.processInfo.idWorkflow:bizagi.util.isEmpty(t.processInfo.smartInboxId)||(e.smartInboxId=t.processInfo.smartInboxId)),bizagi.webpart.publish("bz-update-list-cases",e)},getOutboxCasesCount:function(){var e=this,t=new $.Deferred,r=0;return $.when(e.database.getOutboxCases()).then((function(e){r+=e.rows?e.rows.length:0})).always((function(){$.when(e.database.getOutboxTaskCasesFilteredBySyncStatus("none",!0)).done((function(e){r+=e.length})).always((function(){t.resolve(r)}))})),t.promise()},returnOnlineStatus:function(){var e=this;return e.saveWorkInProgress().always((function(){return e.getOutboxCasesCount().then((function(t){if(t>0)return bizagi.util.isNativePluginSupported()&&bizagiapp.openSyncDialog(),e.pushOfflineData()})).always((function(){var t=bizagi.util.getLastProcessInbox().processInfo.smartInboxId;bizagi.util.isiOSSmartphoneDevice()?e.fetchOfflineData():(bizagi.webpart.publish("bz-update-list-cases",{updateDataList:!0,smartInboxId:t||void 0}),bizagi.util.isOfflineErrorsViewSupported()&&bizagi.webpart.publish("bz-update-list-sync-errors-cases"))}))}))},fetchOfflineData:function(){this.isOfflineFormsV2Supported&&bizagi.util.isConnected()&&this.fetchWorker.fetch()},pushOfflineData:function(){var e=this;if(e.isOfflineFormsV2Supported)return e.pullWorker.pull().then((function(t){return e.showSyncMessage(t),t})).fail((function(t){var r=!(!t||!t.type);return e.showSyncMessage(!1,r),t}))},getCurrentUser:function(e){return this.online?this._super(e):$.when({idUser:1,user:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",domain:"undefined"!=typeof BIZAGI_DOMAIN?BIZAGI_DOMAIN:"domain",delegateUserName:"",idDelegateUser:-1,groupSeparator:",",language:"en-US",decimalSeparator:".",decimalDigits:"2",symbol:"$",ShortDateFormat:"M/d/yyyy",TimeFormat:"h:mm tt",LongDateFormat:"dddd, MMMM d, yyyy",twoDigitYearMax:2029,twoDigitYearMaxDelta:13,uploadMaxFileSize:"1048576",isMultiOrganization:"false",associatedStakeholders:[],sUserProperties:[]})},getAllProcesses:function(e){var t=this;return e.inputtray=e.inputtray||"inbox",t.online&&"inbox"==e.inputtray?t._super(e):t.database.getAllProcesses(e).then((function(r){if(r=JSON.parse(r),e.skipAggrupate)return t.includeAllProcessesItem(r),r;var i={},a=t.createDefaultCategories(e,r);for(key in i.categories=[],a)i.categories.push({name:key,workflows:a[key].workflows});return i}))},getAllSmartInbox:function(){var e=this;return bizagi.util.isMobileSmartInboxEnabled()?e.online?e._super().then((function(t){return e.database.saveAvailableSmartInboxes(t),t})):e.database.getAvailableSmartInboxes().then((function(t){return e.availableSmartInboxes=t,e.database.getAvailableOfflineSmartInboxes()})).then((function(t){return $.map(e.availableSmartInboxes,(function(e){return $.extend(e,{offline:-1!=t.indexOf(e.id)})}))})):$.Deferred().resolve([]).promise()},markSmartInboxAsAvailableOffline:function(e){return this.database.markSmartInboxAsAvailableOffline(e)},getLastProcessInboxWorkflow:function(){return this.online?this._super():bizagi.util.getLastProcessInboxProcessInfo()},getCasesByWorkflow:function(e){return e.inputtray=e.inputtray||"inbox","inbox"===e.inputtray?this.online?this._super(e):this.getCasesByWorkflowForInboxOffline(e):this.getCasesByWorkflowForOtherTrays(e)},getCasesByWorkflowForInboxOffline:function(e){return this.getCustomizedColumnsDataTasks(e).then((function(e){return e=JSON.parse(e),$.each(e.cases.rows,(function(t,r){var i=[];e.cases.rows[t].radnumber=r.radNumber,$.each(r.fields,(function(r,a){if(null!=a)try{null!=a.isRadNumber&&"true"==a.isRadNumber?e.cases.rows[t].radnumber=a.Value:null!=a.workitems?e.cases.rows[t].workitems=a.workitems:i.push(a)}catch(e){}})),e.cases.rows[t].fields=i})),e.cases}))},getCasesByWorkflowForOtherTrays:function(e){return this.database.getCustomizedColumnsData(e).then((function(e){return e=JSON.parse(e),$.each(e.cases.rows,(function(t,r){var i=[];e.cases.rows[t].radnumber=r.id,$.each(r.fields,(function(r,a){if(null!=a)try{null!=a.isRadNumber&&"true"==a.isRadNumber?e.cases.rows[t].radnumber=a.Value:null!=a.workitems?e.cases.rows[t].workitems=a.workitems:i.push(a)}catch(e){}})),e.cases.rows[t].fields=i})),e.cases}))},getCustomizedColumnsDataTasks:function(e){var t,r,i=this,a=-1;return e.idWorkflow=e.idWorkflow||e.idWfClass,(e.radnumber||e.radNumber)&&(e.radNumber=e.radnumber?e.radnumber:e.radNumber),(e.idcase||e.idCase)&&(e.radNumber=e.idcase?e.idcase:e.idCase),null!=e.idWorkflow&&bizagi.util.validateFeatureSupport("offlineCustomizedColumns")&&(a=e.idWorkflow),i.database.getProcessCustomColumnsHeaders(a).then((function(a){t=a.headers,r=a.type;var s=$.extend({isOpen:!0},e);return i.database.getOfflineCases(s)})).then((function(a){return i.parseCustomizedColumnDataTaskResponse(e,a,t,r)}))},parseCustomizedColumnDataTaskResponse:function(e,t,r,i){for(var a=t.elements,s={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}},n=0,o=a.length;n<o;n++){var l=a[n];if(this.isValidRadNumber(e.radNumber,l)){var c=this.buildCaseData(l),d=l.systemColumns,u=this.buildDefaultSystemHeaders();"process"==i&&(d=l.processColumns),null!=d&&(c.fields=[],r.forEach((function(e){"radnumber"==e.fieldName?c.casenumberdisplayname=e.displayName:("process"==i?1==e.isCustomColumn:1==u[e.fieldName])&&c.fields.push({Value:d[e.fieldName]||"",DisplayName:e.displayName,DataType:e.type,isRadNumber:"radnumber"==e.fieldName})}))),s.cases.rows.push(c),s.cases.lstIdCases.push(l[0])}}return s.cases.totalPages=s.cases.page=s.cases.rows.length>0?1:0,JSON.stringify(s)},buildCaseData:function(e){return{id:e[0],radNumber:e.radNumber,idWFClass:e[10],idWorkFlow:e[10],taskState:e.taskState,isFavorite:e[9],isEdited:e.isEdited,offlineType:"task",isOpen:!0,isOfflineForm:!0,fields:[{Value:e.wfclsdisplayname,DisplayName:e.wfclsdisplayname,DataType:"VarChar",isRadNumber:!1},{Value:e[12],DisplayName:"Process creation date",DataType:"DateTime",isRadNumber:!1}]}},getMenuAuthorization:function(){return this.online?this._super():$.when({permissions:[{Cases:["NewCase","Pending","Closed","Search"]},{AnalysisReports:["BAMProcess","BAMTask","AnalyticsProcess","AnalyticsTask","AnalyticsSensor","AnalysisQueries","BAMResourceMonitor"]},{Admin:["UserAdmin","Licenses","EntityAdmin","CaseAdmin","AlarmAdmin","EncryptionAdmin","MobileUpdatesAdmin","AsynchronousWorkitemRetries","UserPendingRequests","AuthenticationLogQuery","BusinessPolicies","Profiles","UserDefaultAssignation","GRDimensionAdmin","ThemeBuilder"]},{CurrentUserAdministration:["CurrentUser"]},{LogOut:[]},{Search:[]},{SmartFolders:[]},{CustomFolders:[]},{BizagiQueries:[]},{AnalysisQueries:[]},{StateLog:[]},{PrintableVersion:[]}]})},getInboxSummary:function(e){var t=this.online;return!e||"false"!=e.inputtray&&"true"!=e.inputtray||(t=!1),t?this._super(e):$.when({inboxSummary:{Red:7,Yellow:0,Green:0,Black:0,All:7}})},getCategories:function(e){if(this.online)return this._super(e);var t={};return(e=e||{}).idCategory&&(t.idCategory=e.idCategory),e.idApp&&(t.idApp=e.idApp),t.enableOfflineForm=e.enableOfflineForm||!1,t.groupByApp=e.groupByApp||!1,this.database.getCategories(t)},createNewCase:function(e){return(e=e||{}).isOfflineForm?this.database.createNewCase(e):this._super(e)},getWorkitems:function(e){return(e=e||{}).isOfflineForm?bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getCase?this.getNativeWorkItems(e):this.database.getWorkitems(e):this._super(e)},getNativeWorkItems:function(e){var t=new $.Deferred;return bizagiapp.getCase(e.idCase,(function(e){var r=JSON.parse(e);t.resolve(r)}),(function(e){t.reject(e)})),t.promise()},getCaseSummary:function(e){return(e=e||{}).isOfflineForm?this.database.getSummary(e):this._super(e)},deleteCase:function(e){return e=e||{},this.database.deleteCase(e)},getCaseSubprocesses:function(e){return(e=e||{}).isOfflineForm?$.when({subProcesses:[]}):this._super(e)},getOverrides:function(){return{}},getCasesListBeta:function(e){var t=this;return(e=e||{}).inputtray=e.inputtray||"inbox","inbox"===e.inputtray?t.online?($.when(t.saveWorkInProgress()).then((function(){t.fetchOfflineData()})).fail((function(){console.log("getCasesListBeta => Error in saveWorkInProgress promise")})),t._super(e)):t.getCasesListBetaForInbox(e):"drafts"===e.inputtray||"outbox-new"===e.inputtray?t.getCasesListBetaForDraftsOrOutBox(e):t.getCasesListBetaForOtherTrays(e)},getCasesListBetaForInbox:function(e){var t=this;return e.isOpen=!0,e.idWfClass=null!=e.idWfClass?e.idWfClass:-1,$.when(t.getProcessCustomColumnsHeaders(e),t.database.getOfflineCases(e)).then((function(e,r){var i=t.getTaskFeedData(r);return e&&e.headers&&(i.headers=e.headers),i}))},getCasesListBetaForDraftsOrOutBox:function(e){var t=this;return t.database.getCasesList(e).then((function(e){return t.getTaskFeedData(e)}))},getCasesListBetaForOtherTrays:function(e){var t=this;return e.isOpen=!1,t.database.getOfflineCases(e).then((function(e){return t.getTaskFeedData(e)}))},getLastSelectionCustomColumns:function(){var e=bizagi.util.getLastProcessInbox(),t=e.processInfo.idWorkflow,r=e.processInfo.smartInboxId;if(!bizagi.util.isEmpty(e.processColumnsInfo)&&!bizagi.util.isEmpty(e.processColumnsInfo.processColumns))return $.Deferred().resolve(e.processColumnsInfo.processColumns).promise();$.Deferred().resolve(void 0).promise();return(null!=r?this.getSmartInboxCustomColumnsHeaders({smartInboxId:r}):this.getProcessCustomColumnsHeaders({idWfClass:t})).then((function(e){return bizagi.util.setLastProcessInboxProcessColumns(e.headers),e.headers}))},getProcessCustomColumnsHeaders:function(e){return this.database.getProcessCustomColumnsHeaders(e.idWfClass)},getSmartInboxCustomColumnsHeaders:function(e){return null!=e.smartInboxId?this.database.getSmartInboxCustomColumnsHeaders(e.smartInboxId):void 0},getMobileCasesList:function(e){return"inbox"===e.inputtray?this._super(e):getCasesListBeta(e)},getTaskFeedData:function(e){for(var t=bizagi.localization.getResource("workportal-taskfeed-overdue"),r=bizagi.localization.getResource("workportal-taskfeed-today"),i=bizagi.localization.getResource("workportal-taskfeed-tomorrow"),a=bizagi.localization.getResource("workportal-taskfeed-upcomming"),s={elements:[],page:e.page,totalPages:e.totalPages,advanceSearch:!1},n=new Date,o=n.getMonth(),l=n.getDate(),c=n.getFullYear(),d=0;e.elements.length>d;d++){var u=e.elements[d];void 0!==u.offlineType&&"task"===u.offlineType&&(u[3]=u.endDate);var p={},f=u[3];if(""!==u[3]){var g=new Date(u[3]),h=g.getDate(),m=g.getMonth(),y=g.getFullYear();new Date(y,m,h,0,0,0)-new Date(c,o,l,0,0,0)<0?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"MMMM dd | hh:mm tt"),p=this.getTaskFeedStatus("1|"+t,"red","overdue","overdue")):(o===m&&l===h?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"hh:mm tt"),p=g.getTime()<n.getTime()?this.getTaskFeedStatus("2|"+r+", "+bizagi.util.dateFormatter.formatDate(n,"MMMM dd"),"red","today","overdue"):this.getTaskFeedStatus("2|"+r+", "+bizagi.util.dateFormatter.formatDate(n,"MMMM dd"),"yellow","today","ontime")):o===m&&l+1===h?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"hh:mm tt"),p=this.getTaskFeedStatus("3|"+i,"yellow","tomorrow","ontime")):(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"MMMM dd | hh:mm tt"),p=this.getTaskFeedStatus("4|"+a,"green","upcoming","upcoming")),p&&u.taskstate&&(p.state=u.taskstate))}else u[3]="--",p=this.getTaskFeedStatus("1|"+t,"red","overdue","overdue");s.elements.push($.extend({},u,p,{endDate:f,idworkitem:u[1]}))}return s},getTaskFeedStatus:function(e,t,r,i){return status={group:e,state:t,type:r,icon:i}},summaryCaseDetails:function(e){var t=e||{},r=e.idWorkitem||0;return t.inputtray=t.inputtray||"inbox",t.isOfflineForm?this.getCaseSummaryDataContent(e).done((function(e){e.currentState=e.currentState||[];var t=e.currentState.length;e.showEvents=e.countEvents>=1,e.showParentProcess=e.idParentCase>=1,e.parentProcess={displayName:e.parentDisplayName,idCase:e.idParentCase},e.isClosed="true"!=e.isOpen,e.showAssignees=e.countAssigness>=1,e.showSubProcess=e.countSubProcesses>=1,e.showForm="true"==e.hasGlobalForm,e.allowsReassign="false";for(var i=0;i<t;i++)e.currentState[i].idWorkItem==r&&(e.allowsReassign=e.currentState[i].allowsReassign);for(var a=[],s=0,n=0;n<e.currentState.length;n++)"false"==e.currentState[n].isEvent&&"true"==e.currentState[n].assignToCurrentUser&&e.currentState[n].idWorkItem!=r&&(a[s++]=e.currentState[n]);return e.currentStateTypes=a,e.showActivities=a.length>=1,e})):this._super(t)},getCaseSummaryDataContent:function(e){var t=this;return t.getCaseSummary(e).then((function(e){return e.taskState=t.icoTaskState,e.process=e.process?e.process:"",e.createdBy&&(e.createdByName=e.createdBy.Name,e.createdByUserName=e.createdBy.userName,e.caseDescription=""==e.caseDescription?"":e.caseDescription,e.processPath=e.processPath.replace(/\//g," > ")+e.process,e.showWorkOnIt=!0),e}))},getCustomizedColumnsData:function(e){return e.inputtray=e.inputtray||"inbox","inbox"===e.inputtray?this._super(e):this.database.getCustomizedColumnsNewData(e).then((function(e){return JSON.parse(e)}))},getRecentProcesses:function(e){return e=e||{},this.online?this._super(e):this.database.getRecentProcesses(e)},startProcess:function(e){return e=e||{},this.online?this._super(e):$.when({hasStartForm:!1,idProcess:e.idProcess,displayName:e.displayName,caseInfo:{}})},getShortCuts:function(e){return e=e||{},this.online?this._super(e):$.when([])},getSearchLists:function(){return this.online?this._super():$.when([])},getCollectionIcon:function(e){return e=e||{},this.online?this._super(e):$.when([])},getRecentOfflineProcesses:function(e){return e=e||{},$.ajax({url:this.serviceLocator.getUrl("process-handler-getRecentProcesses"),data:e,dataType:"json",type:"GET",avoidLoader:!0}).then((function(e){var t=e.processes||[],r={processes:[]};if(!bizagi.util.isObjectEmpty(t))for(var i,a=-1;i=t[++a];)i.hasOfflineForm&&r.processes.push(i);return r}))},getOfflineProcessesHierarchy:function(){var e={removeOnlineItems:"true"};return $.ajax({url:this.serviceLocator.getUrl("offline-getProcessTree"),data:e,dataType:"json",type:"GET",avoidLoader:!0})},getOfflineTasks:function(){var e={};return e.pageSize=this.maxOfflineCases,e.page=1,$.ajax({url:this.serviceLocator.getUrl("offline-tasks"),data:e,dataType:"json",type:"GET",avoidLoader:!0})},serializeOfflineCustomizedColumns:function(e,t){var r=[];return t.forEach((function(t){var i={};e.forEach((function(e,r){e.fieldName&&(i[e.fieldName]=t[r])})),r.push(i)})),r},deserializeOfflineCustomizedColumns:function(e,t){var r=[];return t.forEach((function(t,i){var a=r[i];null==a&&(a=[]),e.forEach((function(e,r){a[r]=t[e.fieldName]})),r[i]=a})),r},addEvalPropertyToOfflineHeaders:function(e){var t={taskstate:"*VAR*.workItems[0].State",wfclsdisplayname:"*VAR*.categoryName",currenttask:"*VAR*.workItems[0].TaskName",cascreationdate:"*VAR*.creationDate",wiestimatedsolutiondate:"*VAR*.endDate",idworkitem:"*VAR*.workItems[0].idWorkItem",taskid:"*VAR*.workItems[0].idTask",hassyncerror:"!bizagi.util.isEmpty(*VAR*.syncStatus)",syncerror:"bizagi.util.isEmpty(*VAR*.syncStatus) ? undefined : *VAR*.syncDetails"};return e.map((function(e){return t[e.fieldName]&&(e.eval=t[e.fieldName],e.varSymbol="*VAR*"),e}))},getOfflineSystemHeaders:function(){return["isEdited","isOpen","syncStatus","isDraft","syncDetails","formsRenderVersion","isOfflineForm","offlineType","hassyncerror","syncerror"].map((function(e){return{displayName:e,fieldName:e}}))},getCardViewCustomizedColumns:function(e){var t,r=this,i={headers:[],rows:[],currentPage:1,totalPages:1,totalRecords:0};return e.inputtray=e.inputtray||"inbox",r.online&&"inbox"===e.inputtray?($.when(r.saveWorkInProgress()).then((function(){r.fetchOfflineData()})).fail((function(){console.log("getCardViewCustomizedColumns => Error in saveWorkInProgress promise")})),r._super(e)):("inbox"===e.inputtray?e.isOpen=!0:(e.idWfClass=-1,e.isOpen="drafts"===e.inputtray,delete e.sortData),(null!=e.smartInboxId?r.database.getSmartInboxCustomColumnsHeaders(e.smartInboxId):r.database.getProcessCustomColumnsHeaders(e.idWfClass)).then((function(i){return t=(t=i.headers).concat(r.getOfflineSystemHeaders()),t=r.addEvalPropertyToOfflineHeaders(t),e.headers=t,e.customColumnsType=i.type,r.database.getCustomColumnsData(e)}),(function(e){return r.defaultErrorHandler(e,"OFFLINE: getCardViewCustomizedColumns => Error retrieving headers"),console.warn(),i})).then((function(e){return i.headers=t,i.rows=r.deserializeOfflineCustomizedColumns(t,e),i.pageSize=e.length,i.totalRecords=e.length,i}),(function(e,t){return r.defaultErrorHandler({headersErr:e,rowsErr:t},"OFFLINE: getCardViewCustomizedColumns => Error retrieving rows"),console.warn(),i})))},downloadOfflineCustomizedColumns:function(){var e=this;if(this.online&&this.isOfflineFormsV2Supported){var t=bizagi.util.getLastProcessInboxProcessInfo(),r=-1,i=null;bizagi.util.validateFeatureSupport("offlineCustomizedColumns")&&t&&t.idWorkflow&&(r=t.idWorkflow);var a={pageSize:100,page:1,avoidLoader:!0};return-1!=r&&(a.idWfClass=r),-1!=t.smartInboxId&&(a.smartInboxId=i=t.smartInboxId),this.getCardViewCustomizedColumns(a).then((function(t){var a=t.headers,s=t.rows;if(!a||!s)return $.Deferred().reject("Headers or rows are missing in the custom columns service response").promise();var n=new bizagiQueue;return n.add(e.database.saveProcessCustomColumnsHeaders(-1,e.filterSystemHeaders(a))),-1!=r?n.add(e.database.saveProcessCustomColumnsHeaders(r,a)):null!=i&&n.add(e.database.saveSmartInboxCustomColumnsHeaders(i,a)),e.serializeOfflineCustomizedColumns(a,s).forEach((function(t){var a,s=t.idcase+"-"+t.idworkitem;-1!=r?a=e.database.updateTaskWorkItemCustomColumnsByType(s,"process",t):null!=i&&(a=e.database.updateTaskWorkItemCustomColumnsByType(s,"smartinbox",t,i)),null!=a&&n.add(a)})),n.execute()})).fail((function(t){return e.defaultErrorHandler(t,"Error downloading the customized columns.")}))}},getMobileOfflineActivities:function(e){var t=this;return t.isActivityAlreadyDownloaded(e.idCase,e.idWorkitem).then((function(r){if(r)return null;bizagi.util.console.log("Force offline => Task is NOT already downloaded. Downloading...");var i={radNumber:e.radNumber,idWorkitem:e.idWorkitem||null};return t.getMobileActivities(i)})).then((function(r){if(null==r)return null;var i=t.fetchWorker.serializeActivities(r),a=e.idCase+"-"+e.idWorkitem,s=i[a];if(void 0===s)return $.Deferred().reject({type:"error",message:"Problem retrieving the activity from the server"}).promise();return s.isOnDemand=!0,t.database.saveOfflineTasks(i)})).then((function(r){return null==r?null:t.updateCustomColumns(e,void 0)}))},updateCustomColumns:function(e,t){var r=this;if(!bizagi.util.isEmpty(e.idWfClass)){var i=t.headers,a=t.rows,s=r.serializeOfflineCustomizedColumns(i,a),n=new bizagiQueue;return bizagi.util.isEmpty(e.idWorkflow)||(n.add(r.database.saveProcessCustomColumnsHeaders(-1,r.filterSystemHeaders(i))),n.add(r.database.saveProcessCustomColumnsHeaders(e.idWorkflow,i))),s.forEach((function(e){var t=e.idcase+"-"+e.idworkitem,i=r.database.updateTaskWorkItemCustomColumnsByType(t,"process",e);n.add(i)})),n.execute()}},downloadActivityOnDemand:function(e){var t=this;return bizagi.loading.start(),t.getMobileOfflineActivities(e).then((function(){return t.isTaskFormAlreadyDownloaded(e.idCase,e.idWorkitem)})).then((function(r){return!r||!!e.executeOfflineEntryPipeline&&t.formService.verifyFormEntryPipeline(e)})).then((function(r){return r?$.when(t.formService.downloadOfflineTaskForm({idCase:e.idCase,idWorkitem:e.idWorkitem,executeOfflineEntryPipeline:e.executeOfflineEntryPipeline})):{wasFormDownloaded:!1,hasEntryPipeline:!1,wasPipelineExecuted:!1}})).always((function(){bizagi.loading.stop()}))},downloadStartFormOnDemand:function(e){var t=this;return t.isStartFormAlreadyDownloaded(e).then((function(r){if(!r&&!1!==t.online)return t.formService.downloadOfflineStartForm({idProcess:e})}))},showSyncMessage:function(e,t){var r=bizagi.util.isValidResource("workportal-mobile-offline-sync-successful")?bizagi.localization.getResource("workportal-mobile-offline-sync-successful"):"Synchronization successful",i="success";e||(r=bizagi.util.isValidResource("workportal-mobile-offline-sync-fail")?bizagi.localization.getResource("workportal-mobile-offline-sync-fail"):"Synchronization failed",i=t&&!bizagi.util.isNativePluginSupported()?"":"error"),bizagi.util.isNativePluginSupported()?bizagiapp.synchronizationFinished(i):bizagi.util.showNotification({text:r,type:i})},defaultErrorHandler:function(e,t){return"object"==_typeof(e)?bizagi.util.console.error(t,e):bizagi.util.console.error(t+":"+e),e},createDefaultCategories:function(e,t,r){r={};var i=bizagi.localization.getResource("workportal-widget-inbox-all-processes"),a={name:bizagi.localization.getResource("workportal-widget-inbox-all-cases"),path:"",category:i,isFavorite:e.onlyFavorites||!1,guidFavorite:"",idworkflow:"",guidWFClass:"",count:0};r[i]=[],r[i].workflows=[],r[i].workflows.push(a),t.workflows&&$.each(t.workflows.workflow,(function(e,t){r[t.category]||(r[t.category]=[],r[t.category].workflows=[]),r[t.category].workflows.push(t),a.count+=Number(t.count)}))},isActivityAlreadyDownloaded:function(e,t){return this.database.getTask(e+"-"+t).then((function(){return!0}),(function(){return $.Deferred().resolve(!1).promise()}))},isTaskFormAlreadyDownloaded:function(e,t){return this.database.getTaskForm({idCase:e,idWorkitem:t}).then((function(){return!0}),(function(){return $.Deferred().resolve(!1).promise()}))},isStartFormAlreadyDownloaded:function(e){return this.database.getStartForm({idProcess:e}).then((function(){return!0}),(function(){return $.Deferred().resolve(!1).promise()}))},isValidRadNumber:function(e,t){return void 0===e||""===e.toString()||e.toString()===t[0]||e==t[0]||e.toString()==t.radNumber||e==t.radNumber},buildDefaultSystemHeaders:function(){return{radnumber:!0,wfclsdisplayname:!0,cascreationdate:!0,wiestimatedsolutiondate:!0,cassolutiondate:!0}},filterSystemHeaders:function(e){var t=[],r=this;return e.forEach((function(e){r.isInboxHeaderASystemColumn(e.fieldName)&&t.push(e)})),t},updateSyncErrorsStatus:function(){this.getSyncErrorsList().then((function(e){var t=bizagi.util.isEmpty(e)?0:e.length;$(document).trigger("update-sync-errors-icon",{errors:t})}))},saveWorkInProgress:function(){var e=new $.Deferred;return void 0!==this.activeForm&&this.activeForm.params&&"task"===this.activeForm.params.offlineType&&!0===this.activeForm.params.isOfflineForm?(document.activeElement.blur(),this.activeForm.saveWorkInProgress()):(e.resolve(),e.promise())},retrySyncSingleOfflineCaseNative:function(e){var t=this;e.isSingleSync=e.isSingleSync||!0,e.isRetry=e.isRetry||!0,t.syncSingleOfflineCase(e).then((function(){bizagi.util.showMobileToast({type:"success",message:bizagi.localization.getResource("workportal-offline-sync-success")})})).fail((function(e){bizagi.util.showMobileToast({type:"error",message:bizagi.localization.getResource("workportal-offline-sync-failed")})})).always((function(){setTimeout((function(){t.getSyncErrorsListHandler()}),100)}))},downloadOfflineTaskForm:function(e){return this.formService.downloadOfflineTaskForm(e)},downloadOfflineStartForm:function(e){return this.formService.downloadOfflineStartForm(e)},syncOfflineStartCase:function(e){return this.syncService.syncOfflineStartCase(e)},syncOfflineTaskCase:function(e){return this.syncService.syncOfflineTaskCase(e)},getInboxSyncErrors:function(){return this.database.getInboxSyncErrors()},getSyncErrorsList:function(){return this.database.getSyncErrorsList()},getTaskSyncError:function(e){return this.database.getTaskSyncError(e)}});
//# sourceMappingURL=../../../../Maps/smartphone_ios_native/offline.services.production.js.map
