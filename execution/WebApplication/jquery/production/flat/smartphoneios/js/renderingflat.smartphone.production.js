function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){e.widget("ui.bizagi_grid",{options:{id:"no-id",columns:[],sortBy:"",sortType:"asc",showSummary:!1,collapse:!1,collapseState:!1,data:{},indexedData:{},maxColumns:0,buttonsPst:!1,title:"",tableCssClass:"",headerStyles:"",floatingHeader:!1,hasExclusiveCheck:!1,template:{grid:"",waiting:"",table:"",emptyTable:"",column:"",specialColumn:"",row:"",rowButtons:"",cell:"",specialCell:"",pager:"",buttons:"",dynamicPager:"",summary:"",summaryCell:""},actions:{add:!0,edit:!0,remove:!0,details:!0,allowMore:!1,enableXlsExport:!1,enablePdfExport:!1},mode:"execution"},_init:function(){var t=this,i=t.options,r=t.element;t.page=1,t.changes={},t.totalRows=0,t.totalPages=0,t.data=i.data,t.selectedRow=0,t.components={},t.buttons={},t.asyncCells={},t.scrollableArea=i.scrollableArea||t,t.columnByIndex={},t.columnByName={},t.columnKeyIndex=0,e.each(i.columns,(function(e,i){i.key=void 0!==i.key&&i.key,i.label=void 0!==i.label?i.label:i.name,i.sortType="asc",i.tooltip=void 0!==i.tooltip?i.tooltip:"",t.columnByIndex[i.index]=i,t.columnByName[i.name]=i,i.key&&(t.columnKeyIndex=i.index)})),i.sortBy=i.sortBy||t.columnByIndex[0].name,t.columnByName[i.sortBy]?t.columnByName[i.sortBy].sortType=i.sortType:t.columnByName[i.sortBy.split(".")[0]]&&(t.columnByName[i.sortBy.split(".")[0]].sortType=i.sortType),r.addClass("ui-bizagi-grid-wrapper"),r.attr("data-bizagi-id",i.id),t.calculateKeyIndex(),t.collapseState=i.collapseState,t.startLoading(!1)},startLoading:function(t){var i=this;if(t=void 0===t||t,"execution"===i.options.mode&&void 0!==i.options.sortBy){var r=function(){var t=i.element,r=i.options;i.waitingTimeout=null,t.append(e.fasttmpl(r.template.waiting))};t?i.waitingTimeout=setTimeout(r,250):r()}},endLoading:function(){var e=this.element;this.waitingTimeout&&(clearTimeout(this.waitingTimeout),this.waitingTimeout=null),e.empty()},setData:function(e){this.data=e,this.calculateKeyIndex(),this.refresh()},getData:function(){return this.data},calculateKeyIndex:function(){var t=this.options.columns,i=this.data;indexedData={},i.rows&&e.each(i.rows,(function(i,r){var a;e.each(t,(function(e,t){t.key&&(a=r[e])})),indexedData[a]=r})),this.indexedData=indexedData},getChanges:function(){},refresh:function(){this._cleanComponents(),this._cleanButtons(),this.components={},this.draw()},refreshSummary:function(e){var t=this.options,i=this._getComponent("summary");this.drawing||i&&t.showSummary&&(e?this.refreshSummaryCell(e):(i.empty(),i.append(this.drawSummary()),this.postRenderSummary(i)))},refreshSummaryCell:function(t){this.options;var i=this._getComponent("summary"),r=function(t,i){var r=t.is("[data-bizagi-component=summary-cells]")?t.children():t.find("[data-bizagi-component=summary-cells]").children();return e(r[i])},a=r(i,t),n=this.columnByIndex[t];if(!n.key){var o=this.drawSummaryCell(n);a.replaceWith(o),a=r(i,t),this.onCellReady(n,"summary",a,!1)}},changeCellValue:function(e,t,i){this.indexedData[e]&&(this.indexedData[e][t]=i)},deleteCellExclusiveValues:function(t){var i=this;i.indexedData&&e.each(i.indexedData,(function(e){i.indexedData[e][t]=!1}))},draw:function(){var t=this.options,i=this.element;if(this.drawing=!0,this.endLoading(),"rtl"===t.orientation)var r=e.fasttmpl(t.template.gridRtl,{label:t.title,buttonsPst:t.buttonsPst,collapse:t.collapse,collapseState:this.collapseState,isDesign:"design"===t.mode});else r=e.fasttmpl(t.template.grid,{label:t.title,buttonsPst:t.buttonsPst,collapse:t.collapse,collapseState:this.collapseState,isDesign:"design"===t.mode});if(r=this.drawTable(r),this.grid=e(r).appendTo(i),this.postRender(this.grid),"design"!==t.mode&&(this.attachPaginator(),this.attachHandlers()),"execution"===t.mode&&t.floatingHeader){var a=this._getComponent("table"),n=e("table",a),o=parseInt(e(this.scrollableArea).css("padding-top").replace(/[^\d.]/g,""))||0;n.stickyTableHeaders({fixedOffset:o>0?o-1:o,scrollableArea:this.scrollableArea,zIndex:1e3,cacheHeaderHeight:!0}),a.bind("scroll",(function(){n.trigger("resize.stickyTableHeaders")}))}0===this.data.rows.length?(this._getComponent("table").hide(),this._getComponent("pager").hide(),this._getButton("remove").hide(),this._getButton("edit").hide(),this._getComponent("dynamicPager").hide(),this._getComponent("emptyTable").show()):(this._getComponent("table").show(),this._getButton("remove").show(),this._getButton("edit").show(),this._getComponent("emptyTable").hide(),t.actions.allowMore?(this._getComponent("dynamicPager").show(),this._getComponent("pager").hide()):(this._getComponent("pager").show(),this._getComponent("dynamicPager").hide()),t.actions.edit&&this._getButton("edit").show(),t.actions.enableXlsExport||t.actions.enablePdfExport?this._getButton("show-grid-export-options").show():this._getButton("show-grid-export-options").css("display","none")),this.drawing=!1},attachPaginator:function(){},drawTable:function(t){var i=this.options,r=e.fasttmpl(i.template.table,{showSummary:i.showSummary,tableCssClass:i.tableCssClass,orientation:i.orientation}),a=e.fasttmpl(i.template.emptyTable);return r=this._replaceElement(r,"columns",this.drawHeader()),r=this._replaceElement(r,"rows",this.drawBody()),i.showSummary&&(r=this._replaceElement(r,"summary",this.drawSummary())),t=this._replaceElement(t,"pager",this.drawPager()),t=this._replaceElement(t,"buttons",this.drawButtons()),t=this._replaceElement(t,"gridExportOptions",this.drawGridExportOptions()),t=this._replaceElement(t,"rowButtons",this.drawRowButtons()),t=this._replaceElement(t,"dynamicPager",this.drawDynamicPager()),t=this._replaceElement(t,"table",r),t=this._replaceElement(t,"emptyTable",a)},isExactMatch:function(){for(var e=this.options.columns,t=this.options.sortBy,i=0,r=e.length;i<r;)if(t==e[i++].name)return!0;return!1},drawHeader:function(){var t=this,i=t.options,r="";return t.exactMatch=t.isExactMatch(),e.each(i.columns,(function(e,i){t.options.maxColumns>0?e<=t.options.maxColumns&&(r+=t.drawColumn(i)):r+=t.drawColumn(i)})),t.options.maxColumns>0&&t._canShowButtons()&&(r+=t.drawSpecialColumn()),r},drawColumn:function(t){var i=this.options,r=t.bizAgiProperties||{},a=r.cssclass?r.cssclass:"",n=i.headerStyles?i.headerStyles.header:"";n+=(""!==n?"; text-align:":"text-align:")+(r.columntitlealign?r.columntitlealign:"center");var o=r.columntitlealign?r.columntitlealign:"center",s=i.isSortable&&r.isSortable&&void 0!==r.xpath,l=i.sortBy.split(".")[0],d=!1;s&&(t.name===i.sortBy||t.name===l&&!this.exactMatch)&&(d=!0);var u=bizagi.util.getColumnType(r.type),c="radio"===u&&r.horizontal;return e.fasttmpl(i.template.column,e.extend({},t,{isKey:t.key,sortActive:d,sortType:i.sortOrder,isSortable:s,tooltip:t.tooltip||"",columnCssClass:a,headerLabelStyles:i.headerStyles?i.headerStyles.label:"",headerStyles:n,controlType:u,isHorizontalRadio:c,columnAlign:o,flexAlign:bizagi.util.mapAlignClassName(o)}))},drawSpecialColumn:function(){var t=this.options;return e.fasttmpl(t.template.specialColumn)},drawDynamicPager:function(){var t=this.options;return e.fasttmpl(t.template.dynamicPager)},drawBody:function(){var t=this,i="";return e.each(t.data.rows,(function(e,r){i+=t.drawRow(r)})),i},drawRow:function(t,i){var r=this,a=r.options,n=t[r.columnKeyIndex],o=i||!1,s=Math.floor(1e4*Math.random()),l=e.fasttmpl(a.template.row,{key:s,isNewRow:i,businessKey:n}),d="";return e.each(t,(function(e,t){r.options.maxColumns>0?e<r.options.maxColumns+1&&(d+=r.drawCell(e,n,t,o)):d+=r.drawCell(e,n,t,o)})),r.options.maxColumns>0&&r._canShowRowButtons()&&(d+=r.drawSpecialCell(r.options.maxColumns+1)),l=r._replaceElement(l,"cells",d)},drawSummary:function(){var t=this,i=t.options,r=e.fasttmpl(i.template.summary),a="";return e.each(i.columns,(function(e,i){t.options.maxColumns>0?e<=t.options.maxColumns&&(a+=t.drawSummaryCell(i)):a+=t.drawSummaryCell(i)})),r=t._replaceElement(r,"summary-cells",a)},drawSummaryCell:function(t){var i=this.options,r=t.bizAgiProperties||{},a=r.columnAlign?r.columnAlign:"center",n=e.fasttmpl(i.template.summaryCell,{hidden:t.hidden||!1,summarizeBy:t.summarizeBy,cellAlign:a}),o=this.onDrawCell(t,"summary",this.calculateSummary(t),!1);return(o=null!=o&&"number"!=typeof o?o.replace("summaryValue",this.calculateSummary(t)):o)||(o=""),"object"===_typeof(o)&&o.done?"resolved"===o.state()?n=this._replaceElement(n,"cellContent",this.resolveResult(o)):(n=this._replaceElement(n,"cellContent",""),this.asyncCells[key+"-"+columnIndex]=o):n=this._replaceElement(n,"cellContent",o),n},drawCell:function(t,i,r,a){var n=this.options;a=a||!1;var o="";if(!this.columnByIndex[t])return"";t>0&&(o=this.columnByIndex[t].bizAgiProperties&&this.columnByIndex[t].bizAgiProperties.messageValidation);var s=this.columnByIndex[t].bizAgiProperties||{},l=s.cssclass?s.cssclass:"",d=s.columnAlign?s.columnAlign:"center",u=bizagi.util.getColumnType(s.type),c="radio"===u&&s.horizontal,p=e.fasttmpl(n.template.cell,{isKey:this.columnByIndex[t].key,hidden:n.columns[t].hidden||!1,isDesign:"design"===n.mode,messageValidation:o,columnCssClass:l,id:n.columns[t].bizAgiProperties?n.columns[t].bizAgiProperties.id:void 0,cellAlign:d,flexAlign:bizagi.util.mapAlignClassName(d),controlType:u,isHorizontalRadio:c}),h=this.onDrawCell(this.columnByIndex[t],i,r,a);return h||(h=""),"object"===_typeof(h)&&h.done?"resolved"===h.state()?p=this._replaceElement(p,"cellContent",this.resolveResult(h)):(p=this._replaceElement(p,"cellContent",""),this.asyncCells[i+"-"+t]=h):p=this._replaceElement(p,"cellContent",h),this.columnByIndex[t].cell=e(p),p},resolveResult:function(e){var t;return e.done((function(e){t=e})),t},drawSpecialCell:function(t){var i=this.options;return e.fasttmpl(i.template.specialCell)},drawGroupHeader:function(){},drawFooter:function(){},drawPager:function(){for(var t=this.options,i=[],r=1;r<=this.data.total;r++)i.push({number:r,active:r==this.data.page});return e.fasttmpl(t.template.pager,{page:this.data.page,pages:i,records:this.data.records})},drawButtons:function(){var t=this.options,i=t.tooltips||{},r=e.extend(t.actions,i);return this._canShowButtons()?"rtl"===t.orientation?e.fasttmpl(t.template.buttonsRtl,r):e.fasttmpl(t.template.buttons,r):""},drawGridExportOptions:function(){var t=this.options,i=t.actions,r=t.tooltips||{},a=e.extend({orientation:t.orientation,enableXlsExport:i.enableXlsExport,enablePdfExport:i.enablePdfExport},r);return e.fasttmpl(t.template.exportOptions,a)},drawRowButtons:function(){var t=this.options;return this._canShowRowButtons()?"rtl"===t.orientation?e.fasttmpl(t.template.rowButtons.rtl,t.actions):e.fasttmpl(t.template.rowButtons,t.actions):""},postRender:function(){var t=this,i=t.options,r=t._getComponent("cells");if(r&&e.each(r,(function(i,r){r=e(r),t.postRenderRow(r)})),i.showSummary){var a=t._getComponent("summary");t.postRenderSummary(a)}t._triggerHandler("gridControlReady")},postRenderRow:function(t){var i=this,r=t.attr("data-business-key"),a=t.attr("data-new-row"),n=t.is("[data-bizagi-component=cells]")?t.children():t.find("[data-bizagi-component=cells]").children();e.each(n,(function(t,n){var o=i.columnByIndex[t];if(void 0!==o&&!o.key){var s=i.asyncCells[r+"-"+o.index];s?e.when(s).done((function(t){(n=e(n)).append(t),i.onCellReady(o,r,n,a)})):i.onCellReady(o,r,e(n),a)}}))},postRenderSummary:function(t){var i=this,r=t.is("[data-bizagi-component=summary-cells]")?t.children():t.find("[data-bizagi-component=summary-cells]").children();e.each(r,(function(t,r){var a=i.columnByIndex[t];if(!a.key){var n=i.asyncCells[key+"-"+a.index];n?e.when(n).done((function(t){(r=e(r)).append(t),i.onCellReady(a,"summary",r,!1)})):i.onCellReady(a,"summary",e(r),!1)}}))},attachHandlers:function(){},selectDynamicPager:function(){this.onDynamicPager()},changePage:function(e){var t=Number(this.data.page),i=this.data.total,r=e;if("previous"===e){if(!(t>1))return;r=t-1}if("next"===e){if(!(t<i))return;r=t+1}this._cleanComponents(),this.page=Number(r),this.onPageRequested()},getCurrentPage:function(){return(this.data||{}).page||1},isValid:function(){return this._triggerHandler("isValid")},sortBy:function(e,t){var i=this.options,r=this.columnByIndex[e];if(void 0===i.sortBy)return!0;void 0===r.name&&(r.name=r.label),t=r.name==i.sortBy?t||("asc"==i.sortOrder?"desc":"asc"):r.name==i.sortBy.split(".")[0]?t||("asc"==i.sortType?"desc":"asc"):t||i.sortType,i.sortBy.split(".").length>1?(i.sortBy.split(".")[0],r.name,i.sortBy=r.name):i.sortBy=r.name,void 0!==r.bizAgiProperties.sortAttribute&&-1!==r.bizAgiProperties.type.indexOf("column")&&(i.sortBy=r.name+"."+r.bizAgiProperties.sortAttribute),i.sortColumn=r,i.sortType=t,i.sortOrder=t,this._cleanComponents(),this.onSortRequested()},selectRow:function(e,t){this.selectedRow==e?(this.onRowUnselected(),this.selectedRow=0,this.selectedBusinessKey=0):(0!=this.selectedRow&&this.onRowUnselected(),this.selectedRow=e,this.selectedBusinessKey=t,this.onRowSelected())},unselectRow:function(){0!=this.selectedRow&&(this.onRowUnselected(),this.selectedRow=0,this.selectedBusinessKey=0)},calculateSummary:function(t){var r=this,a=t.summarizeBy;e.each(r.data.rows,(function(e,i){void 0!==r.data.rows[e][t.index]&&null==r.data.rows[e][t.index]&&null!=t.bizAgiProperties.defaultvalue&&(r.data.rows[e][t.index]=t.bizAgiProperties.defaultvalue)}));var n,o=e.map(r.data.rows,(function(e,i){return e[t.index]}));if(0==o.length)return 0;if("sum"===a)n=0,e.each(o,(function(e,t){null!=t&&(n+=Number(t))}));else if("min"===a)n=o[0]||0,e.each(o,(function(e,t){"number"==typeof t&&null!=t&&t<n&&(n=Number(t))})),n===Math.max()&&(n=null);else if("max"===a)n=o[0]||0,e.each(o,(function(e,t){"number"==typeof t&&null!=t&&t>n&&(n=Number(t))})),n===Math.min()&&(n=null);else if("avg"===a)n=0,e.each(o,(function(e,t){null!=t&&(n+=Number(t))})),n/=o.length;else if("count"===a)for(n=0,o=r.data.rows,i=0;i<o.length;i++){var s=o[i][t.index];s instanceof Array&&s.length>0?n+=1:s instanceof Array||null===s||""===s||(n+=1)}return n},processAction:function(e,t){var i=t&&t.key?t.key:this.selectedBusinessKey;"edit"===e&&this.onEditRow(i),"remove"===e&&this.onDeleteRow(i),"more"===e&&this.onShowMore(i),"details"===e&&this.onShowDetails(i),"add"===e&&this.onAddRow(),"show-grid-export-options"===e&&this.onShowExportGridOptions()},onPageRequested:function(){return this.startLoading(),this._triggerHandler("pageRequested",this._buildRefreshParameters())},onSortRequested:function(){return this.startLoading(),this._triggerHandler("sortRequested",this._buildRefreshParameters())},onRowSelected:function(){return this._triggerHandler("rowSelected",{key:this.selectedBusinessKey})},onRowUnselected:function(){return this._triggerHandler("rowUnselected",{key:this.selectedBusinessKey})},onCollapseGrid:function(){return this._triggerHandler("performCollapseGrid")},onDynamicPager:function(){return this._triggerHandler("moreRows",{key:this.selectedBusinessKey})},onDrawCell:function(e,t,i,r){return this._triggerHandler("drawCell",{column:e,key:t,value:i,isNewRow:r})},onCellReady:function(e,t,i,r){return this._triggerHandler("cellReady",{column:e,key:t,cell:i,isNewRow:r})},onDrawControl:function(){},onDrawGroupHeader:function(){},onAddRow:function(){return this._triggerHandler("addRow")},onEditRow:function(e){return this._triggerHandler("editRow",{key:e})},onDeleteRow:function(e){return this._triggerHandler("deleteRow",{key:e})},onShowMore:function(e){return this._triggerHandler("showMore",{key:e})},onShowDetails:function(e){return this._triggerHandler("showFormDetails",{key:e})},onShowExportGridOptions:function(){return this._triggerHandler("showGridExportOptions")},_replaceElement:function(e,t,i){return e.replaceFirstWithoutPatterns("{{element "+t+"}}",i)},_buildRefreshParameters:function(){var e=this.options,t=null!=e.sortColumn?e.sortColumn.index:1;return{page:this.page,sortBy:e.sortBy,sortType:e.sortOrder,sortColumnIndex:t}},_triggerHandler:function(e,t){var i=this.options[e];return i?i.call(this.element[0],t):null},_getComponent:function(t){var i=this.element;if(!this.components[t]){var r=e("[data-bizagi-component="+t+"]",i);null!=r&&r.length>0&&(this.components[t]=r)}return this.components[t]},_getButton:function(t){var i=this.element;return this.buttons[t]||(this.buttons[t]=e("[data-action="+t+"]",i)),this.buttons[t]},_cleanComponents:function(){this.components={}},_cleanButtons:function(){this.buttons={}},_canShowButtons:function(){return!0},_canShowRowButtons:function(){return!0}})}(jQuery),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.util=void 0!==bizagi.util?bizagi.util:{},bizagi.context=void 0!==bizagi.context?bizagi.context:{},bizagi.util.smartphone=void 0!==bizagi.util.smartphone?bizagi.util.smartphone:{},bizagi.util.tablet=void 0!==bizagi.util.tablet?bizagi.util.tablet:{};var DEVICES={};function printf(e){var t,i=Array.prototype.slice.call(arguments,1);return e.replace(/(%[disv])/g,(function(e,r){if(void 0!==(t=i.shift()))switch(r.charCodeAt(1)){case 100:return+t;case 105:return Math.round(+t);case 115:return String(t);case 118:return t}return r}))}function bizagiQueue(){var e,t,i=[];this.length=function(){return i.length},this.add=function(r){if(!t)return t=!0,e=void 0,i.push({callbacks:[r]});i[i.length-1].callbacks.push(r)},this.addParallel=function(r){if(!e)return e=!0,t=void 0,i.push({callbacks:[r]});i[i.length-1].callbacks.push(r)},this.execute=function(){for(var e=new $.Deferred,t=e.promise(),r=i.length,a=0;a<r;a++)t=t.pipe((function(){var e=i.shift();return $.when.apply($,$.map(e.callbacks,(function(e){if("function"==typeof e){var t=$.Deferred();return $.when(e()).done((function(){t.resolve()})).fail((function(){t.reject()})),t.promise()}return e})))}));return e.resolve(),t=t.done((function(){i=[]}))}}DEVICES[DEVICES.desktop=0]="desktop",DEVICES[DEVICES.smartphone=1]="smartphone",DEVICES[DEVICES.tablet=2]="tablet",bizagi.deviceEnum=DEVICES,function(e){e.fn.callInside=function(t,i){if("iframe"!=e(this)[0].tagName.toLowerCase())return null;if(null==e(this)[0].contentWindow)return null;try{e(this)[0].contentWindow.args=i}catch(e){return null}return e.browser.msie?e(this)[0].contentWindow.execScript("args = (this.window.args)?this.window.args:{}; insideFunction = "+t.toString()+"; insideFunction(args)"):e.browser.webkit||e.browser.mozilla?e(this)[0].contentWindow.eval("args = window.args;insideFunction = "+t.toString()+"; insideFunction(args)"):void 0}}(jQuery),function(e){e.fn.callInsidePopup=function(t,i){var r=this;e(document).ready((function(){try{e(r)[0].args=i}catch(e){return null}return e.browser.msie?e(r)[0].execScript("args = (this.window.args)?this.window.args:{}; insideFunction = "+t.toString()+"; insideFunction(args)"):e.browser.webkit||e.browser.mozilla?e(r)[0].eval("args = window.args;insideFunction = "+t.toString()+"; insideFunction(args)"):void 0}))}}(jQuery),jQuery,!!CSSStyleDeclaration.prototype.getPropertyValue||(CSSStyleDeclaration.prototype.getPropertyValue=function(e){return this.getAttribute(e)},CSSStyleDeclaration.prototype.setProperty=function(e,t,i){if(this.setAttribute(e,t),""!=(i=void 0!==i?i:"")){var r=new RegExp(RegExp.escape(e)+"\\s*:\\s*"+RegExp.escape(t)+"(\\s*;)?","gmi");this.cssText=this.cssText.replace(r,e+": "+t+" !"+i+";")}},CSSStyleDeclaration.prototype.removeProperty=function(e){return this.removeAttribute(e)},CSSStyleDeclaration.prototype.getPropertyPriority=function(e){return new RegExp(RegExp.escape(e)+"\\s*:\\s*[^\\s]*\\s*!important(\\s*;)?","gmi").test(this.cssText)?"important":""}),RegExp.escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},jQuery.fn.style=function(e,t,i){if(void 0!==this.get(0)){var r=this.get(0).style;if(void 0===e)return r;if(void 0===t)return r.getPropertyValue(e);i=void 0!==i?i:"",r.setProperty?r.setProperty(e,t,i):r.setAttribute(e,t,i)}},jQuery,jQuery.nl2br=function(e){return e.replace(/(\r\n|\n\r|\r|\n|\\r\\n|\\n\\r|\\r|\\n)/g,"<br>")},jQuery,jQuery.br2nl=function(e){return e.replace(/\r\n|\r|\n/g,"\r")},function(e){jQuery.controlValueIsChanged=function(t){var i=t,r=i.properties,a=i.getValue(),n=r.originalValue,o=!0;return!!e.forceCollectData||("grid"!=t.properties.type||"pending"!=t.ready().state())&&(["combo","queryCombo","list","queryList","radio","queryRadio","queryState"].includes(r.type)||/^cascadingcombo$/i.test(r.type)?(a&&void 0!==a.length&&(a=a[0]),n&&void 0!==n.length&&(n=n[0]),a=a&&a.id?a.id:a,o=(n=n&&n.id?n.id:n)!=a):o="boolean"==r.type||"queryBoolean"==r.type||"queryCheck"==r.type?bizagi.util.parseBoolean(n)!=bizagi.util.parseBoolean(a):"searchNumber"==r.type?!!a:"date"===r.type?new Date(n).getTime()!==new Date(a).getTime():n!==a,o)}}(jQuery),function(e){jQuery.getMaxZindex=function(){var t=e("*"),i=1;return e.each(t,(function(t,r){var a=parseInt(e(r).css("z-index"));a>i&&(i=a+1)})),i}}(jQuery),function(e){jQuery.equalizeHeights=function(t){var i=new Array;e(t).each((function(){e(this).css("min-height","0"),e(this).css("max-height","none"),e(this).css("height","auto"),i.push(e(this).outerHeight())}));var r=Math.max.apply(Math,i);e(t).each((function(){e(this).css("height",r+"px")}))}}(jQuery),bizagi.util.autoSave=function(){var e=$.Deferred();return"desktop"!==bizagi.util.detectDevice()?$(document).data("auto-save")?$(document).trigger("save-form",[e]):e.resolve():$._data($(document)[0],"events")["save-form"]&&$._data($(document)[0],"events")["save-form"].length>0?$(document).trigger("save-form",[e]):e.resolve(),e.promise()},bizagi.util.anonymizedUserInformation={id:"00000000-0000-0000-0000-000000000000",name:"",username:"",email:"",domain:"",picture:"",isAnonymized:!0},bizagi.util.datepickerResource=[],bizagi.util.datepickerResource.en={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bizagi.util.datepickerResource.es={closeText:"Cerrar",prevText:"&#x3C;Ant",nextText:"Sig&#x3E;",currentText:"Hoy",monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],dayNames:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],dayNamesShort:["dom","lun","mar","mié","jue","vie","sáb"],dayNamesMin:["D","L","M","X","J","V","S"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bizagi.util.datepickerResource.ar={closeText:"إغلاق",prevText:"&#x3C;السابق",nextText:"التالي&#x3E;",currentText:"اليوم",monthNames:["يناير","ٝبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوٝمبر","ديسمبر"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],dayNamesShort:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],dayNamesMin:["ح","ن","ث","ر","خ","ج","س"],weekHeader:"أسبوع",dateFormat:"dd/mm/yy",firstDay:0,isRTL:!0,showMonthAfterYear:!1,yearSuffix:""},bizagi.util.datepickerResource.cs={closeText:"Zavřít",prevText:"&#x3C;Dříve",nextText:"Později&#x3E;",currentText:"Nyní",monthNames:["leden","únor","březen","duben","květen","ĝerven","ĝervenec","srpen","září","říjen","listopad","prosinec"],monthNamesShort:["led","úno","bře","dub","kvě","ĝer","ĝvc","srp","zář","říj","lis","pro"],dayNames:["neděle","pondělí","úterý","středa","ĝtvrtek","pátek","sobota"],dayNamesShort:["ne","po","út","st","ĝt","pá","so"],dayNamesMin:["ne","po","út","st","ĝt","pá","so"],weekHeader:"Týd",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bizagi.util.datepickerResource.de={closeText:"Schließen",prevText:"&#x3C;Zurück",nextText:"Vor&#x3E;",currentText:"Heute",monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],weekHeader:"KW",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bizagi.util.datepickerResource.fr={closeText:"Fermer",prevText:"Précédent",nextText:"Suivant",currentText:"Aujourd'hui",monthNames:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],monthNamesShort:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],dayNames:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],dayNamesShort:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],dayNamesMin:["D","L","M","M","J","V","S"],weekHeader:"Sem.",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bizagi.util.datepickerResource.it={closeText:"Chiudi",prevText:"&#x3C;Prec",nextText:"Succ&#x3E;",currentText:"Oggi",monthNames:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],monthNamesShort:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],dayNames:["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"],dayNamesShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],dayNamesMin:["Do","Lu","Ma","Me","Gi","Ve","Sa"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bizagi.util.datepickerResource.ja={closeText:"閉㝘る",prevText:"&#x3C;剝",nextText:"次&#x3E;",currentText:"今日",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayNames:["日曜日","月曜日","睫曜日","水曜日","木曜日","金曜日","土曜日"],dayNamesShort:["日","月","睫","水","木","金","土"],dayNamesMin:["日","月","睫","水","木","金","土"],weekHeader:"週",dateFormat:"yy/mm/dd",firstDay:0,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"年"},bizagi.util.datepickerResource.nl={closeText:"Sluiten",prevText:"←",nextText:"→",currentText:"Vandaag",monthNames:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],monthNamesShort:["jan","feb","mrt","apr","mei","jun","jul","aug","sep","okt","nov","dec"],dayNames:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],dayNamesShort:["zon","maa","din","woe","don","vri","zat"],dayNamesMin:["zo","ma","di","wo","do","vr","za"],weekHeader:"Wk",dateFormat:"dd-mm-yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bizagi.util.datepickerResource.pt={closeText:"Fechar",prevText:"Anterior",nextText:"Seguinte",currentText:"Hoje",monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],dayNamesMin:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],weekHeader:"Sem",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bizagi.util.datepickerResource.ru={closeText:"Закрыть",prevText:"&#x3C;Пред",nextText:"След&#x3E;",currentText:"Сегоднѝ",monthNames:["Январь","Февраль","Март","Нпрель","Май","Июнь","Июль","Нвгуѝт","Сентѝбрь","Октѝбрь","Ноѝбрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Нпр","Май","Июн","Июл","Нвг","Сен","Окт","Ноѝ","Дек"],dayNames:["воѝкреѝенье","понедельник","вторник","ѝреда","четверг","пѝтница","ѝуббота"],dayNamesShort:["вѝк","пнд","втр","ѝрд","чтв","птн","ѝбт"],dayNamesMin:["Вѝ","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Нед",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bizagi.util.datepickerResource.zh={closeText:"关闭",prevText:"&#x3C;上月",nextText:"下月&#x3E;",currentText:"今天",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","坝月","坝一月","坝二月"],monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","坝月","坝一月","坝二月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],weekHeader:"周",dateFormat:"yy-mm-dd",firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"年"},bizagi.util.liveProcessesEvents=bizagi.util.liveProcessesEvents||{},bizagi.util.liveProcessesEvents.newLiveProcess=document.createEvent("Event"),bizagi.util.liveProcessesEvents.newLiveProcess.initEvent("new-live-process",!0,!0),bizagi.util.liveProcessesEvents.routeEvents=document.createEvent("Event"),bizagi.util.liveProcessesEvents.routeEvents.initEvent("parent-route-events",!0,!0),bizagi.util.liveProcessesEvents.routeEvents.route="/",bizagi.util.liveProcessesEvents.saveEvent=document.createEvent("Event"),bizagi.util.liveProcessesEvents.saveEvent.initEvent("save-live",!0,!0),bizagi.util.liveProcessesEvents.saveEvent.lastWidget="",bizagi.util.liveProcessesEvents.saveEvent.nextWidget="",bizagi.util.liveSave=function(e){bizagi.util.liveProcessesEvents.saveEvent.nextWidget=e;var t=$.Deferred(),i=0;try{i=$(document).find("iframe")[0].contentWindow.location.href.indexOf("quickprocess")}catch(e){i=-1}return(e!==bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROFLY||e===bizagi.util.liveProcessesEvents.saveEvent.lastWidget)&&$(document).find("iframe").length>0&&i>0?(bizagi.util.liveProcessesEvents.saveEvent.saveLivePromise=t,document.dispatchEvent(bizagi.util.liveProcessesEvents.saveEvent)):t.resolve(),$.when(t).done((function(){bizagi.util.liveProcessesEvents.saveEvent.lastWidget=e})),t.promise()},bizagi.util.md5=function(e){var t=t||function(e,t){var i={},r=i.lib={},a=function(){},n=r.Base={extend:function(e){a.prototype=this;var t=new a;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var a=0;a<e;a++)t[r+a>>>2]|=(i[a>>>2]>>>24-a%4*8&255)<<24-(r+a)%4*8;else if(65535<i.length)for(a=0;a<e;a+=4)t[r+a>>>2]=i[a>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i=[],r=0;r<t;r+=4)i.push(4294967296*e.random()|0);return new o.init(i,t)}}),s=i.enc={},l=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],r=0;r<e;r++){var a=t[r>>>2]>>>24-r%4*8&255;i.push((a>>>4).toString(16)),i.push((15&a).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r+=2)i[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(i,t/2)}},d=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],r=0;r<e;r++)i.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r++)i[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(i,t)}},u=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,r=i.words,a=i.sigBytes,n=this.blockSize,s=a/(4*n);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*n,a=e.min(4*t,a),t){for(var l=0;l<t;l+=n)this._doProcessBlock(r,l);l=r.splice(0,t),i.sigBytes-=a}return new o.init(l,a)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=c.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new p.HMAC.init(e,i).finalize(t)}}});var p=i.algo={};return i}(Math);return function(e){function i(e,t,i,r,a,n,o){return((e=e+(t&i|~t&r)+a+o)<<n|e>>>32-n)+t}function r(e,t,i,r,a,n,o){return((e=e+(t&r|i&~r)+a+o)<<n|e>>>32-n)+t}function a(e,t,i,r,a,n,o){return((e=e+(t^i^r)+a+o)<<n|e>>>32-n)+t}function n(e,t,i,r,a,n,o){return((e=e+(i^(t|~r))+a+o)<<n|e>>>32-n)+t}for(var o=t,s=(d=o.lib).WordArray,l=d.Hasher,d=o.algo,u=[],c=0;64>c;c++)u[c]=4294967296*e.abs(e.sin(c+1))|0;d=d.MD5=l.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var o=0;16>o;o++){var s=e[l=t+o];e[l]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}o=this._hash.words;var l=e[t+0],d=(s=e[t+1],e[t+2]),c=e[t+3],p=e[t+4],h=e[t+5],g=e[t+6],m=e[t+7],f=e[t+8],b=e[t+9],v=e[t+10],y=e[t+11],C=e[t+12],x=e[t+13],z=e[t+14],E=e[t+15],T=i(T=o[0],A=o[1],w=o[2],R=o[3],l,7,u[0]),R=i(R,T,A,w,s,12,u[1]),w=i(w,R,T,A,d,17,u[2]),A=i(A,w,R,T,c,22,u[3]);T=i(T,A,w,R,p,7,u[4]),R=i(R,T,A,w,h,12,u[5]),w=i(w,R,T,A,g,17,u[6]),A=i(A,w,R,T,m,22,u[7]),T=i(T,A,w,R,f,7,u[8]),R=i(R,T,A,w,b,12,u[9]),w=i(w,R,T,A,v,17,u[10]),A=i(A,w,R,T,y,22,u[11]),T=i(T,A,w,R,C,7,u[12]),R=i(R,T,A,w,x,12,u[13]),w=i(w,R,T,A,z,17,u[14]),T=r(T,A=i(A,w,R,T,E,22,u[15]),w,R,s,5,u[16]),R=r(R,T,A,w,g,9,u[17]),w=r(w,R,T,A,y,14,u[18]),A=r(A,w,R,T,l,20,u[19]),T=r(T,A,w,R,h,5,u[20]),R=r(R,T,A,w,v,9,u[21]),w=r(w,R,T,A,E,14,u[22]),A=r(A,w,R,T,p,20,u[23]),T=r(T,A,w,R,b,5,u[24]),R=r(R,T,A,w,z,9,u[25]),w=r(w,R,T,A,c,14,u[26]),A=r(A,w,R,T,f,20,u[27]),T=r(T,A,w,R,x,5,u[28]),R=r(R,T,A,w,d,9,u[29]),w=r(w,R,T,A,m,14,u[30]),T=a(T,A=r(A,w,R,T,C,20,u[31]),w,R,h,4,u[32]),R=a(R,T,A,w,f,11,u[33]),w=a(w,R,T,A,y,16,u[34]),A=a(A,w,R,T,z,23,u[35]),T=a(T,A,w,R,s,4,u[36]),R=a(R,T,A,w,p,11,u[37]),w=a(w,R,T,A,m,16,u[38]),A=a(A,w,R,T,v,23,u[39]),T=a(T,A,w,R,x,4,u[40]),R=a(R,T,A,w,l,11,u[41]),w=a(w,R,T,A,c,16,u[42]),A=a(A,w,R,T,g,23,u[43]),T=a(T,A,w,R,b,4,u[44]),R=a(R,T,A,w,C,11,u[45]),w=a(w,R,T,A,E,16,u[46]),T=n(T,A=a(A,w,R,T,d,23,u[47]),w,R,l,6,u[48]),R=n(R,T,A,w,m,10,u[49]),w=n(w,R,T,A,z,15,u[50]),A=n(A,w,R,T,h,21,u[51]),T=n(T,A,w,R,C,6,u[52]),R=n(R,T,A,w,c,10,u[53]),w=n(w,R,T,A,v,15,u[54]),A=n(A,w,R,T,s,21,u[55]),T=n(T,A,w,R,f,6,u[56]),R=n(R,T,A,w,E,10,u[57]),w=n(w,R,T,A,g,15,u[58]),A=n(A,w,R,T,x,21,u[59]),T=n(T,A,w,R,p,6,u[60]),R=n(R,T,A,w,y,10,u[61]),w=n(w,R,T,A,d,15,u[62]),A=n(A,w,R,T,b,21,u[63]);o[0]=o[0]+T|0,o[1]=o[1]+A|0,o[2]=o[2]+w|0,o[3]=o[3]+R|0},_doFinalize:function(){var t=this._data,i=t.words,r=8*this._nDataBytes,a=8*t.sigBytes;i[a>>>5]|=128<<24-a%32;var n=e.floor(r/4294967296);for(i[15+(a+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),i[14+(a+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(i.length+1),this._process(),i=(t=this._hash).words,r=0;4>r;r++)a=i[r],i[r]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=l._createHelper(d),o.HmacMD5=l._createHmacHelper(d)}(Math),t.MD5(e).toString()},bizagi.util.multiReplace=function(e,t){for(var i in t=t||{}){var r=new RegExp(i,"g");e=e.replace(r,t[i])}return e},bizagi.util.replaceAll=function(e,t,i){return bizagi.replaceAll(e,t,i)},bizagi.util.replaceAllGlobalRegExp=function(e,t,i){var r=e,a=new RegExp(t,"g");return(r=r.replace(a,i)).toString()},String.prototype.replaceAll=function(e,t){return bizagi.util.replaceAll(this,e,t)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.startsWith=function(e){return this.slice(0,e.length)==e},String.prototype.getInitials=function(){var e="";if(0===this.length)e='<svg  class="bz-icon bz-icon-24 bz-icon-svg"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-user-deactivated"></use></svg>';else{try{for(var t=this.replace(/  +/g," ").split(" "),i=0;i<t.length&&2!=(e+=t[i][0]||"").length;i+=1);}catch(e){}e=e.toUpperCase()}return e},Math.sign=Math.sign||function(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1},bizagi.clone=function(e){if(null!=e)return null==e?null:JSON.parse(JSON.encode(e))},bizagi.measureString=function(e,t){var i=$("<span/>").appendTo("body");i.text(e),t&&i.css("font-size",t);var r=i.width();return i.detach(),r},bizagi.util.trim=function(e){return void 0===e||null==e?e:e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},bizagi.util.isIE7=function(){return bizagi.util.isIE()&&7==document.documentMode},bizagi.util.isIE8=function(){return bizagi.util.isIE()&&8==document.documentMode},bizagi.util.isIE9=function(){return bizagi.util.isIE()&&9==document.documentMode},bizagi.util.isIE10=function(){return bizagi.util.isIE()&&10==document.documentMode},bizagi.util.isIE11=function(){return!!navigator.userAgent.match(/Trident\/7.0/)&&!navigator.userAgent.match(/MSIE/i)},bizagi.util.isIE11OrLower=function(){return bizagi.util.isIE11()||bizagi.util.isIE10()||bizagi.util.isIE9()||bizagi.util.isIE8()||bizagi.util.isIE7()},bizagi.util.isIE10OrLower=function(){return bizagi.util.isIE10()||bizagi.util.isIE9()||bizagi.util.isIE8()||bizagi.util.isIE7()},bizagi.util.isEdge=function(){return!!/Edge\/*./i.test(navigator.userAgent)},bizagi.util.isIE=function(){return navigator.appName.indexOf("Internet Explorer")>0||!!navigator.userAgent.match(/Trident/)},bizagi.util.objectValues=function(e){return bizagi.util.isIE()?Object.keys(e).map((function(t){return e[t]})):Object.values(e)},bizagi.util.getIEVersion=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE"),i=0;return t>0?i=parseInt(e.substring(t+5,e.indexOf(".",t))):(navigator.userAgent.match(/Trident/)||window.navigator.userAgent.indexOf("Edge")>-1)&&(i=11),i},bizagi.util.isChrome=function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},bizagi.util.isFirefox=function(e){return/Firefox/.test(navigator.userAgent)&&(void 0===e||e<=(i=navigator.userAgent,r=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(r[1])?{name:"IE",version:(t=/\brv[ :]+(\d+)/g.exec(i)||[])[1]||""}:"Chrome"===r[1]&&null!=(t=i.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:t[1]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=i.match(/version\/(\d+)/i))&&r.splice(1,1,t[1]),{name:r[0],version:r[1]})).version);var t,i,r},bizagi.util.getBrowser=function(){var e="undetected";return bizagi.util.isChrome()?e="chrome":bizagi.util.isFirefox()?e="firefox":bizagi.util.isEdge()?e="edge":bizagi.util.isIE11()?e="ie11":bizagi.util.isIE10()&&(e="ie10"),e},bizagi.util.emptyNavigatorInfo=function(){bizagi.navigator&&bizagi.navigator.info&&(bizagi.navigator.info={})},$(document).ready((function(){if($("html").addClass("browser-"+bizagi.util.getBrowser()).addClass("device-"+bizagi.detectDevice()),bizagi.language){var e=bizagi.language.split("-");e&&e.length>0&&$("html").addClass("language-"+e[0])}})),bizagi.util.setIphoneXOverrides=function(){bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.isIphoneX&&bizagiapp.isIphoneX((function(e){if("true"===e)$("head").append('<style type="text/css" id="iphoneXStyle"></style>'),$("#iphoneXStyle").text(".bz-menu-home .bz-menu-carousel .bz-menu-carousel-seat{padding:0 16px 16px}.bz-home-header .km-navbar{padding:35px 16px 5px}#menuHome .bz-home-header .km-navbar{padding:30px 3px 0}#menuHome .km-navbar .km-rightitem{font-size:19px;right:.4em;top:32px}#menuHome .km-navbar .km-leftitem{font-size:24px;left:0;top:25px}#taskFeed .km-navbar .km-rightitem{font-size:19px;top:25px;right:0}#taskFeed .km-navbar .km-leftitem{font-size:24px;top:20px;left:0}#homePortal #menuHome .km-view-title .km-buttongroup{margin-left:0;top:2px}.bz-render-header,.search-container{padding-top:25px}#activity-search,.search-container .bz-wp-mu-button-search{padding-top:40px}#content-newCase-drawer{padding-top:25px}#menuHome{background:#EBEDF1!important}.km-flat .km-content{background-color:#fff} .k-loading-mask{top:0!important}");else if(bizagi.util.isiOSDevice()){$("head").append('<style type="text/css" id="iphoneStyle"></style>');$("#iphoneStyle").text("#homePortal .bz-home-header > div{padding-top:.8em}")}}))},bizagi.util.isString=function(e){return"[object String]"===Object.prototype.toString.apply(e)},bizagi.util.isObject=function(e){return"[object Object]"===Object.prototype.toString.apply(e)},bizagi.util.isArray=function(e){return Array.isArray(e)},bizagi.util.isNull=function(e){return"[object Null]"===Object.prototype.toString.apply(e)},bizagi.util.isBoolean=function(e){return"[object Boolean]"===Object.prototype.toString.apply(e)},bizagi.util.getInternetExplorerVersion=function(){return bizagi.util.isIE()?Number(document.documentMode):-1},bizagi.util.detectDevice=function(){return bizagi.detectDevice()},bizagi.util.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},bizagi.util.isGUID=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},bizagi.util.mustImplement=function(e){try{console.log("Not implemented exception: "+e)}catch(e){}},bizagi.util.encodeXpath=function(e){return bizagi.util.isEmpty(e)||void 0===e.replaceAll?"":e.replaceAll(".","_").replaceAll("=","_").replaceAll("[","_").replaceAll("]","_")},bizagi.util.parseBoolean=function(e){return void 0===e?null:null===e?null:""===e?null:!0===e||1===e||"true"===e.toString()||"1"===e||("true"===e.toString().toLowerCase()||(null===e||!1!==e)&&0!==e&&"false"!==e.toString()&&"0"!==e&&("false"!==e.toString().toLowerCase()&&null))},bizagi.util.isEmpty=function(e){return 0!==e&&(null==e||""===e||("Array"==typeof e?0==e.length:"[object Array]"===Object.prototype.toString.apply(e)?0===e.length:"[object Object]"===Object.prototype.toString.apply(e)&&(!!$.isEmptyObject(e)||bizagi.util.isEmptyCombo(e))))},bizagi.util.isEmptyCombo=function(e){if("[object Object]"===Object.prototype.toString.apply(e)){var t,i=!1,r=!1;for(t in e)if(e.hasOwnProperty(t)&&("id"===t?i=!0:"value"===t?!0:r=!0,r))return!1;if(i)return""===e.id}},bizagi.util.decodeURI=function(e){for(var t,i=!1,r=e=e||"";!i;)try{if(t=decodeURI(r),bizagi.util.hasNonVisibleChars(t)){r=e;break}t==r?i=!0:r=t}catch(e){i=!0}return r},bizagi.util.hasNonVisibleChars=function(e){for(var t,i=(e=e||"").length,r=0,a=!1;r<i;)if((t=e.charCodeAt(r++))<32||t>126){a=!0;break}return a},bizagi.util.percent2Number=function(e){return Number(String(e).replace("%",""))},bizagi.util.isObjectEmpty=function(e){return!(e.length>0)},bizagi.util.isMapEmpty=function(e){if(1==e.length&&0==e[0].length)return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},bizagi.util.replaceSelector=function(e,t,i){var r=$(t,e);r.length>0&&(r.append(i),r.children().unwrap())},bizagi.util.hasScroll=function(e,t){e.length&&(e=e[0]);var i=!!e[t="vertical"===t?"scrollTop":"scrollLeft"];return i||(e[t]=1,i=!!e[t],e[t]=0),i},bizagi.util.identicalObjects=function(e,t){if(_typeof(e)!==_typeof(t))return!1;if("function"==typeof e)return e.toString()===t.toString();if(e instanceof Object&&t instanceof Object){if(bizagi.util.countProps(e)!==bizagi.util.countProps(t))return!1;for(k in e)if(!bizagi.util.identicalObjects(e[k],t[k]))return!1;return!0}return e===t},bizagi.util.countProps=function(e){var t=0;for(k in e)e.hasOwnProperty(k)&&t++;return t},bizagi.util.isScrolledIntoView=function(e,t){if(null==e)return!1;var i=(t=t||$(window)).scrollTop(),r=$(e).offset().top;return r+$(e).height()<=i+$(t).height()&&r>=i},bizagi.util.centerElementIntoScroll=function(e,t){if(null==e)return!1;var i=(t=t||$(window)).scrollTop(),r=$(e).offset().top,a=$(e).height(),n=i+(r>0?r+a:r-a);t.scrollTop(n)},bizagi.util.encodeHtml=function(e){return null==e?"":"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},bizagi.util.decodeHtmlEntities=function(e){return null==e?"":"string"==typeof e?e.replace(/&apos;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"'"):e},bizagi.util.getHashParams=function(){return window.location.hash.substring(1).split("#")},bizagi.util.loadFile=function(e){var t=new $.Deferred,i=e&&e.src?e.src:e,r=e&&e.type?e.type:null;return bizagi.loader.loadFile({src:i,type:r}).then((function(){t.resolve()})),t.promise()},bizagi.util.initWebpart=function(e,t){var i=new $.Deferred;return t=t||bizagi.detectDevice(),e.initialized?i.resolve():e.initializing?$.when(e.loadingDeferred.promise()).done((function(){i.resolve()})):(e.loadingDeferred=new $.Deferred,e.initializing=!0,bizagi.loader.initWebpart(e,t,(function(){e.loadingDeferred.resolve(),e.initializing=!1,i.resolve()}))),i.promise()},bizagi.util.getQueryString=function(e){for(var t={},i=((e=e||window.location.href).indexOf("?")>0?e.substring(e.indexOf("?")+1):"").split("&"),r=i.length-1;r>=0;r--){var a=i[r].indexOf("=");if(-1!=a){var n=i[r].substring(0,a),o=i[r].substring(a+1);t[n]=unescape(o)}}return t},bizagi.util.extendQueryString=function(e,t){var i=e.indexOf("?")>0?e.substring(0,e.indexOf("?")):e,r=bizagi.util.getQueryString(e),a=$.extend({},r,t);return i+"?"+$.param(a)},bizagi.util.getStackTrace=function(){var e=[],t=!1;try{i.dont.exist+=0}catch(o){if(o.stack){for(var i=0,r=(a=o.stack.split("\n")).length;i<r;i++)a[i].match(/^\s*[A-Za-z0-9\-_\$]+\(/)&&e.push(a[i]);e.shift(),t=!0}else if(window.opera&&o.message){var a;for(i=0,r=(a=o.message.split("\n")).length;i<r;i++)if(a[i].match(/^\s*[A-Za-z0-9\-_\$]+\(/)){var n=a[i];a[i+1]&&(n+=" at "+a[i+1],i++),e.push(n)}e.shift(),t=!0}}if(!t)for(var o=arguments.callee.caller;o;){var s=o.toString(),l=s.substring(s.indexOf("function")+8,s.indexOf(""))||"anonymous";e.push(l),o=o.caller}return e},bizagi.util.highLightElement=function(e){e.addClass("ui-highlight-control"),$.when(setTimeout((function(){e.addClass("ui-highlight-off-control")}),450)).done(setTimeout((function(){e.removeClass("ui-highlight-control ui-highlight-off-control")}),800))},bizagi.util.autoScrollBottom=function(e){try{var t;t=e[0].scrollHeight,e.scrollTop(t)}catch(e){}},bizagi.util.autoScrollInterval={init:!1},bizagi.util.autoScroll=function(e,t,i,r){var a=!1;clearInterval(bizagi.util.autoScrollInterval[r]),bizagi.util.autoScrollInterval[r]=0,bizagi.util.autoScrollInterval.init=!0,$("body").addClass("autoscroll"),$("body.autoscroll").mousemove((function(n){n.pageY<t?a||(a=!0,bizagi.util.autoScrollTopInterval(e,"autoscroll",r)):n.pageY>i?a||(a=!0,bizagi.util.autoScrollBottomInterval(e,"autoscroll",r)):(clearInterval(bizagi.util.autoScrollInterval[r]),a=!1)}))},bizagi.util.autoScrollTopInterval=function(e,t,i){clearInterval(bizagi.util.autoScrollInterval[i]),t&&$("body").addClass(t),0==e.scrollTop()?clearInterval(bizagi.util.autoScrollInterval[i]):(clearInterval(bizagi.util.autoScrollInterval[i]),bizagi.util.autoScrollInterval[i]=setInterval((function(){e.scrollTop()>0?e.scrollTop(e.scrollTop()-40):clearInterval(bizagi.util.autoScrollInterval[i])}),100))},bizagi.util.autoScrollBottomInterval=function(e,t,i){clearInterval(bizagi.util.autoScrollInterval[i]),t&&$("body").addClass(t);var r=$(e)[0].scrollHeight-$(e).innerHeight();e.scrollTop()>=r?clearInterval(bizagi.util.autoScrollInterval[i]):(clearInterval(bizagi.util.autoScrollInterval[i]),bizagi.util.autoScrollInterval[i]=setInterval((function(){bizagi.util.autoScrollBottom($("html")),e.scrollTop()<r?e.scrollTop(e.scrollTop()+40):clearInterval(bizagi.util.autoScrollInterval[i])}),100))},bizagi.util.removeAutoScroll=function(e,t){$("body."+e).unbind("mousemove").removeClass(e),clearInterval(bizagi.util.autoScrollInterval[t]),bizagi.util.autoScrollInterval.init=!1},bizagi.util.getMaxZIndex=function(e){return e=e||$("div,span"),Math.max.apply(null,$(e).map((function(){var e;return isNaN(e=parseInt($(this).css("z-index"),10))?0:e})))},bizagi.showPopup=function(e,t,i){var r=t.width||1024,a=t.height||768,n=$(window).height()/2-a/2,o=$(window).width()/2-r/2,s=window.open(e,"","width="+r+",height="+a+", top="+n+", left="+o+", Menubar=NO, Location=NO, Status=NO, scrollbars=YES");window.BAPopupWindow=s,window.BAPopupCallback=i,window.BACloseWindow=function(e,t){window.BAPopupWindow.close(),window.BAPopupCallback(e,t)}},bizagi.showQuirksModePopup=function(e,t){var i=window.BIZAGI_PATH_TO_BASE+"quirks.html",r=t.width||1024,a=t.height||768,n=$(window).height()/2-a/2,o=$(window).width()/2-r/2,s=window.open(i,"bizagiPopup","width="+r+",height="+a+", top="+n+", left="+o+", Menubar=NO, Location=NO, Status=NO, scrollbars=YES");window.BAQuirksPopupWindow=s,setTimeout((function(){try{s.document.title=t.title}catch(e){}}),50),$(s).callInsidePopup((function(e){var t=e.jQuery,i=e.popupWindow;i.quirksOnLoad=function(){var r=t("body",i.document),a=t("iframe",r);r.removeClass("ui-bizagi-loading-message"),a.show();var n=e.userParams.afterLoad;if(n&&null!=n){var o=t.extend(e.userParams,{popupWindow:i});a.callInside(n,o)}};!function r(){var a=t("body",i.document);a.length>0?a.append("<iframe scrolling='yes' id='innerFrameContent' src='"+e.url+"' style='width: 100%; height: 100%; display:none' frameborder='0' onload='quirksOnLoad();'></iframe>"):setTimeout((function(){r()}),50)}()}),{jQuery:$,userParams:t,popupWindow:s,url:e})},bizagi.resolveResult=function(e){var t;return e.done((function(e){t=e})),t},bizagi.createPopup=function(e){var t=e.name,i=e.onClose,r=e.title?e.title:"",a="boolean"!=typeof e.handleClose||e.handleClose,n=$('<div class="ui-widget-overlay '+t+'-overlay" />'),o=$('<div class="'+t+'-popup  ui-popup-modal"/>').appendTo(n),s=$('<div class="'+t+'-btn-close biz-btn-close"><i class="biz-icon ui-close-btn bz-studio bz-black bz-false_16x16_black"></i></div>').appendTo(o);e.title&&$('<div class="'+t+'-popup-header ui-popup-header" ><h3>'+r+"</h3></div>").appendTo(o);var l=$('<div class="'+t+'-popup-content" />').appendTo(o);o.hide(),e.additionalClass&&o.addClass(e.additionalClass);var d=e.container||"body";n.appendTo($(d,document)),e.center&&(o.css("top",(n.height()-o.height())/2),o.css("left",(n.width()-o.width())/2)),o.show();var u=function(e){n.detach(),i&&i(e)};return a&&s.click(u),{fullPopup:o,overlay:n,content:l,close:function(e){u(e)}}},bizagi.createOkCancelPopup=function(e){e.name="popup-ok-cancel";var t=e.onOk,i=e.onCancel,r=bizagi.createPopup(e),a=$("<div></div>").addClass("container-okcancel-popup"),n=$("<div></div>").addClass("message-okcancel-popup ui-light-bevel-border biz-gradient-v"),o=$("<div></div>").addClass("buttonsContainer-okcancel-popup biz-actions-bar");n.text(e.message),n.appendTo(a);var s=$("<span></span>").addClass("ok-button-okcancel-popup editor-ui-button-actions biz-action-btn biz-btn"),l=$("<span></span>").addClass("cancel-button-okcancel-popup editor-ui-button-actions biz-action-btn biz-btn");s.text(bizagi.localization.getResource("bizagi-editor-okcancel-ok")),l.text(bizagi.localization.getResource("bizagi-editor-okcancel-cancel")),s.appendTo(o),l.appendTo(o),o.appendTo(a),a.appendTo(r.content);var d=function(){r.close(),"function"==typeof t&&t()};s.click(d);var u=function(){r.close(),"function"==typeof i&&i()};return l.click(u),{close:function(){r.close()},ok:function(){d()},cancel:function(){u()}}},bizagi.dialog=function(e){var t=$("<div></div>").addClass("biz-dialog"),i=$("<p></p>");i.text(e.message||""),i.appendTo(t),t.appendTo($("body",document)),t.dialog({title:e.title,modal:!0,buttons:e.buttons,close:function(){t.dialog("destroy")}})},bizagi.closeQuirksModePopup=function(){var e=window.BAQuirksPopupWindow;window.BAQuirksPopupWindow=null;try{e&&e.close()}catch(e){}},bizagi.getStyle=function(e){var t,i=location.href.replace("/default.aspx",""),r=!!e.match(/@/),a=!!e.match(/\*/),n=new RegExp(e.replace("*",""),"g"),o="";if(""==e)return"";var s=function(e){for(var i=0;i<document.styleSheets.length;i++)if(null!=(t=document.styleSheets[i].rules||document.styleSheets[i].cssRules))for(var s=0;s<t.length;s++)if(null!=document.styleSheets[i].href&&(null==document.styleSheets[i].href.match(/less.css/g)||"release"==BIZAGI_ENVIRONMENT)){var l=t[s].cssText?t[s].cssText:"";a?null!=t[s].selectorText&&null!=t[s].selectorText.match(n)&&($.browser.webkit?o+=t[s].cssText.replace(/\(path\)/g,""):$.browser.msie&&"8.0"==$.browser.version?o+=t[s].style.cssText:o+=t[s].cssText.replace(/\(path\)/g,"../../jquery/workportal/css/desktop")):null!=t[s].selectorText&&t[s].selectorText==e&&(o+=t[s].cssText),r&&null!=t[s]&&null!=l&&-1!=l.indexOf("@font-face")&&($.browser.webkit?o+=l.replace(/jquery\/workportal\/css\/desktop\//g,"").replace(/\(path\)/g,""):o+=l.replace(/\(path\)/g,"../../"))}return o};return $.browser.msie?function(e){if("8.0"==$.browser.version)return s(e);for(var r,l=0;l<document.styleSheets.length;l++)if(null!=(t=document.styleSheets[l].cssRules||document.styleSheets[l].rules))for(var d=0;d<t.length;d++)if("release"==BIZAGI_ENVIRONMENT)a&&(null!=t[d].selectorText&&null!=t[d].selectorText.match(n)?o+=t[d].cssText.replace(/\(path\)/g,i+"/jquery/workportal/css/desktop"):null!=t[d].selectorText&&t[d].selectorText==e&&(o+=t[d].cssText.replace(/\(path\)/g,i+"/jquery/workportal/css/desktop")));else if(null!=t[d].href&&null!=t[d].href&&null==t[d].href.match(/less.css/g)){r=t[d].styleSheet.cssRules||[];for(var u=0;u<r.length;u++)a?null==r[u].selectorText&&null==r[u].selectorText||null==r[u].selectorText.match(n)||(o+=r[u].cssText.replace(/\(path\)/g,i+"/jquery/workportal/css/desktop")):null!=r[u].selectorText&&r[u].selectorText==e&&(o+=r[u].cssText.replace(/\(path\)/g,i+"/jquery/workportal/css/desktop"))}return o}(e):s(e)},bizagi.cookie=function(e,t,i){if(arguments.length>1&&"[object Object]"!==String(t)){if(i=$.extend({},i),null==t&&(i.expires=-1),"number"==typeof i.expires){var r=i.expires,a=i.expires=new Date;a.setDate(a.getDate()+r)}return t=String(t),document.cookie=[encodeURIComponent(e),"=",i.raw?t:encodeURIComponent(t),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}var n,o=(i=t||{}).raw?function(e){return e}:decodeURIComponent;return(n=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?o(n[1]):null},bizagi.util.randomNumber=function(e,t){return e=e||1,t=t||1e7,Math.floor(Math.random()*(t-e+1))+e},bizagi.util.setContext=function(e,t){e=e||{},(t=t||!1)&&(bizagi.context={}),$.each(e,(function(e,t){bizagi.context[e]=t})),bizagi.context.idWorkItem=bizagi.context.idWorkitem},bizagi.util.reloadCSS=function(){var e="?reload="+(new Date).getTime();$('link[rel="stylesheet"]').each((function(){this.href=this.href.replace(/\?.*|$/,e)}))},bizagi.util.setInterval=function(params){var _name=params.name||"default",_call=params.call||function(){},_params=params.params||{},_singleton=params.singleton||!1,_timeOut=params.timeout||5e3,_maxIterations=params.iterations||1e3,_context=params.context||"true;",_killWhenExitContext=!params.hasOwnProperty("killWhenExitContext")||params.killWhenExitContext;bizagi.timeOut=bizagi.timeOut||{},null==bizagi.timeOut[_name]&&(bizagi.timeOut[_name]=[]),_singleton&&null!=bizagi.timeOut[_name]&&(bizagi.timeOut[_name]=[]),bizagi.timeOut[_name].push({name:_name,params:_params,call:_call,singleton:_singleton,timeOut:_timeOut,iterations:0,maxIterations:_maxIterations,context:_context,killWhenExitContext:_killWhenExitContext,itsRunning:!1,timeInit:Math.round((new Date).getTime())});var executeTimeOut=function executeTimeOut(){$.each(bizagi.timeOut,(function(k,v){$.each(v,(function(key,value){var now=Math.round((new Date).getTime()),actualIterations=Math.round((now-value.timeInit)/value.timeOut);if(bizagi.timeOut[value.name][key].iterations=actualIterations,actualIterations<value.maxIterations)if(eval(value.context)){if(!value.itsRunning){if(value.params&&$.browser.msie)var ieFunction=function(){return value.call(value.params)};bizagi.timeOut[value.name][key].pointer=$.browser.msie?setInterval(ieFunction,value.timeOut,"JavaScript"):setInterval(value.call,value.timeOut,value.params),bizagi.timeOut[value.name][key].itsRunning=!0}}else value.killWhenExitContext?(bizagi.timeOut[value.name].splice(key,1),clearTimeout(value.pointer)):(bizagi.timeOut[value.name][key].itsRunning=!1,clearTimeout(value.pointer));else clearTimeout(value.pointer),bizagi.timeOut[value.name].splice(key,1)}))}))};bizagi.timeOutRunning||(bizagi.timeOutRunning=!0,setInterval(executeTimeOut,1e3))},bizagi.util.isDate=function(e){var t,i,r=!1,a=!1,n=!1,o=(e=e||"").toString().split(" ");return t=o[0],(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(t)||/^\d{4}\/\d{1,2}\/\d{1,2}$/.test(t)||/^\d{1,2}\/\d{1,2}\/\d{1,2}$/.test(t))&&(r=!0),o.length>1&&(i=o[1],a=!0,3==o.length&&(i=i+" "+o[2]),/^\d{1,2}:\d{2}(:\d{2})?(\s[aApP][mM])?$/.test(i)&&(n=!0)),a?r&&n:r},bizagi.util.unicode2htmlencode=function(e){var t,i=(e=e.replace(/\r\n/g,"\n")).length,r="";for(t=0;t<i;t++)r+="&#x"+e.charCodeAt(t).toString(16)+";";return r},bizagi.util.getHeadElement=function(){var e=document.getElementsByTagName("head")[0],t=document&&document.documentElement;return e||(e=document.createElement("head"),t.insertBefore(e,t.firstChild)),bizagi.util.getHeadElement=function(){return e},e},bizagi.util.loadStyle=function(e,t){var i,r=document.getElementById(t);if(e&&!r){var a=document.createElement("style");a.type="text/css",a.id=t,a.styleSheet?a.styleSheet.cssText=e:(i=document.createTextNode(e),a.childNodes.length?a.firstChild.nodeValue!==i.nodeValue&&a.replaceChild(i,a.firstChild):a.appendChild(i)),bizagi.util.getHeadElement().appendChild(a)}},bizagi.util.loadIconStyle=function(e,t){bizagi.log("bizagi.util.loadIconStyle");var i=document.createElement("style");i.type="text/css";var r=".mtool-item-image-"+t+" { background:url(data:image/png;base64,"+e+"); }";i.innerHTML=r,bizagi.util.getHeadElement().appendChild(i)},bizagi.util.formatDecimalAndMoneyCell=function(e,t){var i,r,a,n,o={decimalSymbol:t.decimalSeparator,digitGroupSymbol:t.groupSeparator,roundToDecimalPlace:t.decimalDigits};for(i=$.extend({symbol:"€",decimalSeparator:",",groupSeparator:".",decimalDigits:"2"},t),r=$.extend({colorize:!1,decimalSymbol:".",digitGroupSymbol:",",groupDigits:!0,negativeFormat:"(%s%n)",positiveFormat:"%s%n",roundToDecimalPlace:"2",symbol:""},o),a=0;a<e.columnTitle.length;a++){if("MONEY"==e.columnTitle[a].type.toUpperCase())for(n=0;n<e.rows.length;n++)e.rows[n].fields[a]=bizagi.util.formatMoney(e.rows[n].fields[a],i);if("FLOAT"==e.columnTitle[a].type.toUpperCase()||"REAL"==e.columnTitle[a].type.toUpperCase())for(n=0;n<e.rows.length;n++){var s=bizagi.util.formatDecimal(e.rows[n].fields[a],r);if(!0===bizagi.override.removeTrailingZeros){var l=!0;-1!=s.toString().indexOf(")")&&(l=!1,s=s.replace("(","").replace(")",""));var d=new RegExp("("+BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator+"\\d*?[1-9])0+$","g");s=s.replace(d,"$1"),d=new RegExp("\\"+BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator+"0+$","g"),s=s.replace(d,""),l||(s="("+s+")")}e.rows[n].fields[a]=s}}return e},bizagi.util.formatBoolean=function(e){return 1==bizagi.util.parseBoolean(e)?bizagi.localization.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(e)?bizagi.localization.getResource("render-boolean-no"):""},bizagi.util.formatInvariantBoolean=function(e){e=e||"",$(".formatBoolean",e).not(".formatted").each((function(e,t){var i=$(t),r=i.html();i.addClass("formatted");try{var a=bizagi.util.formatBoolean(r);i.html(a)}catch(e){i.html(r)}}))},bizagi.util.formatDecimal=function(e,t){var i=$("<i/>").text(e);return i.formatCurrency&&i.formatCurrency(t),i.text()},bizagi.util.formatMonetaryCells=function(e,t){t=t||{symbol:"€",decimalSeparator:",",groupSeparator:".",decimalDigits:"2"};for(var i=0;i<e.columnTitle.length;i++)if("MONEY"==e.columnTitle[i].type.toUpperCase())for(var r=0;r<e.rows.length;r++)e.rows[r].fields[i]=bizagi.util.formatMoney(e.rows[r].fields[i],t);return e},bizagi.util.formatMoney=function(e,t){var i="",r="",a="",n="",o="",s=e<0;if(null==e&&(e=""),(e=e.toString()).length>=1){var l=e.indexOf(".");if(l>0)a=(e=bizagi.util.fixDecimalDigits(e,t.decimalDigits)).substring(0,l).replace(/\D/g,"");else{for(var d=0;d<t.decimalDigits;d++)o+="0";a=e.replace(/\D/g,"")}if(e=e.replace(/\D/g,""),n=t.decimalDigits>0?l>0?t.decimalSeparator+e.substring(e.length-t.decimalDigits,e.length):t.decimalSeparator+o:"",a.length>3){var u=0;for(d=a.length-1;d>=0;d--)3==u&&(r+=".",u=0),r+=a[d],u+=1;for(d=r.length-1;d>=0;d--)i+=r[d]}else i=a;if(i=i.replaceAll(".",t.groupSeparator),s)i=bizagi.localization.getResource("numericFormat").negativeFormat.replace("%s",t.symbol).replace("%n",i+n);else i=t.symbol+i+n;return i}return e},bizagi.util.getOnlyNumbersByString=function(e){return e.replace(/\D/g,"")},bizagi.util.fixDecimalDigits=function(e,t){var i,r;if(i=e.indexOf("."),e.substring(0,i),t>(r=e.substring(i+1,e.length)).length)for(var a=r.length;a<t;a++)e+="0";else e=parseFloat(e).toFixed(t);return e},bizagi.util.numberToFixedString=function(e){var t;e&&(Math.abs(e)<1?(t=parseInt(e.toString().split("e-")[1]))&&(e>=0?(e*=Math.pow(10,t-1),e="0."+new Array(t).join("0")+e.toString().substring(2)):(e=Math.abs(e)*Math.pow(10,t-1),e="-"+(e="0."+new Array(t).join("0")+e.toString().substring(2)))):(t=parseInt(e.toString().split("+")[1]))>20&&(t-=20,e/=Math.pow(10,t),e+=new Array(t+1).join("0")));return e},bizagi.util.formatInvariantMoney=function(e,t){e=e||"";var i={symbol:t.symbol,decimalSeparator:t.decimalSeparator||",",groupSeparator:t.groupSeparator||".",decimalDigits:t.decimalDigits||"2"};!1===t.allowDecimals&&(i.decimalDigits="0"),$(".formatMoney",e).not(".formated").each((function(e,t){var r=$(t).html();$(t).addClass("formated");try{var a=parseFloat(r);if(!isNaN(a)){var n=bizagi.util.formatMoney(a,i);$(t).html(n)}}catch(e){$(t).html(r)}}))},bizagi.util.formatInvariantNumber=function(e,t){e=e||"";var i="2";i="0"==t.decimalDigits?"0":t.decimalDigits||"2";var r=bizagi.util.isString(t.groupSeparator)&&t.groupSeparator?t.groupSeparator:".",a={symbol:"",decimalSeparator:t.decimalSeparator||",",groupSeparator:t.groupSeparator||t.thousands?r:"",decimalDigits:i};$(".formatMoney",e).not(".formated").each((function(e,i){var r=$(i).html();$(i).addClass("formated");try{var n=r.match(/[a-zA-Z]/),o=null!=n&&n.length>0?NaN:parseFloat(r);if(!isNaN(o)){var s=bizagi.util.formatMoney(o,a);t.percentage&&(s=s.toString()+"%"),$(i).html(s)}}catch(e){$(i).html(r)}}))},bizagi.util.formatInvariantDate=function(e,t){e=e||"",t=t||"MM/dd/yyyy hh:mm:ss",$(".formatDate",e).not(".formated").each((function(e,i){var r=$(i).html();$(i).addClass("formated");try{var a=new Date(r),n=t;bizagi.util.isValidDate(a)&&(n=bizagi.util.getFormatDate(a,n));var o=bizagi.util.dateFormatter.formatDate(a,n);$(i).html(o)}catch(e){$(i).html(r)}}))},bizagi.util.formatDateFromInvariantStringDate=function(e){if(bizagi.util.isValidDate(e)){var t=bizagi.localization.getResource("dateFormat")+" "+bizagi.localization.getResource("timeFormat"),i=new Date(e);return t=bizagi.util.getFormatDate(i,t),bizagi.util.dateFormatter.formatDate(i,t)}return e||""},bizagi.util.getFormatDate=function(e,t){var i=t,r=e.getHours(),a=e.getMinutes(),n=e.getSeconds(),o=e.getMilliseconds(),s=bizagi.override.hideTimeWhenHourMinutesSecondsAreZero;return 0===r&&0===a&&0===n&&0===o&&s&&(i=bizagi.localization.getResource("dateFormat")),i},bizagi.util.formatValueByDataType=function(e,t){var i=e;switch(t){case"NText":case 23:case"Char":case 14:case"VarChar":case 15:case"Text":case 16:e&&e.length>30&&(i=bizagi.util.replaceLineBreak(e));break;case"Boolean":case 5:case"Binary":case 17:i=bizagi.util.formatBoolean(e);break;case"Int":case 2:case"BigInt":case 1:case"SmallInt":case 3:case"TinyInt":case 4:case"Numeric":case 7:i=null==e?"":e;break;case"Money":case 8:i=bizagi.util.formatMonetaryCell(e);break;case"Float":case 10:case"Real":case 11:case"Decimal":case 6:i=bizagi.util.formatDecimalCell(e);break;case"DateTime":case 12:case"SmallDateTime":case 13:i=bizagi.util.formatDateFromInvariantStringDate(e)}return null==i&&(i=""),i},bizagi.util.isValidDate=function(e){if(void 0!==e&&null!=e){var t=new Date(e);return!isNaN(t.valueOf())}return!1},bizagi.util.monthNames=new Array("January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),bizagi.util.dayNames=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sun","Mon","Tue","Wed","Thu","Fri","Sat"),bizagi.util.dateFormatter=new function(){this.LZ=function(e){return(e<0||e>9?"":"0")+e},this.isDate=function(e,t){return 0!=this.getDateFromFormat(e,t)},this.getRelativeTime=function(e,t,i,r){var a=r?new Date(bizagi.moment().tz(bizagi.currentUser.timeZoneName).format()):new Date,n=e instanceof Date?e:kendo.parseDate(e,t),o=a.getTime()-n.getTime(),s=l(o,"year",31536e6,i);return s||(s=l(o,"month",2628e6,i))||(s=l(o,"week",6048e5,i))||(s=l(o,"day",864e5,i))||(s=l(o,"hour",36e5,i))||(s=l(o,"minute",6e4,i))||(i?s=l(0===o?o+1:o,"minute",1,i):(s=l(o,"second",2e3,i))||(s=bizagi.localization.getResource("workportal-relativetime-momentago"))),s;function l(e,t,i,r){var a=(e/i).toFixed(0);if(a>0){if(r)return 1==a?bizagi.localization.getResource("workportal-relativetime-"+t).replace("%s",a):bizagi.localization.getResource("workportal-relativetime-"+t+"s").replace("%s",a);var n=bizagi.localization.getResource("workportal-relativetime-ago");return 1==a?n.replace("%s",bizagi.localization.getResource("workportal-relativetime-"+t).replace("%s",a)):n.replace("%s",bizagi.localization.getResource("workportal-relativetime-"+t+"s").replace("%s",a))}return null}},this.compareDates=function(e,t,i,r){var a=getDateFromFormat(e,t),n=getDateFromFormat(i,r);return 0==a||0==n?-1:a>n?1:0},this.getDifferenceBetweenDates=function(e,t,i){if(!(e instanceof Date&&e instanceof Date))return"one param not is Date";switch(i){case"seconds":return(t.getTime()-e.getTime())/1e3;case"milliseconds":return t.getTime()-e.getTime();default:return"unit is not Defined"}},this.formatDate=function(e,t,i){if(!bizagi.util.isValidDate(e)||0==e)return"";var r=bizagi.util.monthNames,a=bizagi.util.dayNames;t+="";var n,o,s="",l=0,d=e.getFullYear()+"",u=e.getMonth()+1,c=e.getDate(),p=e.getDay(),h=e.getHours(),g=e.getMinutes(),m=e.getSeconds(),f=e.getMilliseconds(),b=new Object;if(bizagi.util.isValidResource("datePickerRegional")&&(i=bizagi.localization.getResource("datePickerRegional")),i){var v=i.monthNames.concat(i.monthNamesShort),y=i.dayNames.concat(i.dayNamesShort);r=r.toString()===v.toString()?r:v,a=a.toString()===y.toString()?a:y}for((d.length<4||"-"===d.charAt(0)&&d.length<5)&&(d=""+(d-0+1900)),b.y=""+d,b.yyyy=d,b.yy=d.substring(2,4),b.M=u,b.MM=this.LZ(u),b.MMM=r[u+11],b.MMMM=r[u-1],b.NNN=r[u+11],b.d=c,b.dd=this.LZ(c),b.ddd=a[p+7],b.dddd=a[p],b.E=a[p+7],b.EE=a[p],b.H=h,b.HH=this.LZ(h),b.tt=h<12?"am":"pm",b.TT=h<12?"AM":"PM",b.h=0==h?12:h>12?h-12:h,b.hh=this.LZ(b.h),b.K=h>11?h-12:h,b.k=h+1,b.KK=this.LZ(b.K),b.kk=this.LZ(b.k),b.a=h>11?"PM":"AM",b.m=g,b.mm=this.LZ(g),b.s=m,b.ss=this.LZ(m),b.FFF=f;l<t.length;){for(n=t.charAt(l),o="";t.charAt(l)==n&&l<t.length;)o+=t.charAt(l++);null!=b[o]?s+=b[o]:s+=o}return s},this.getDateFromFormat=function(e,t,i){var r=bizagi.util.monthNames,a=bizagi.util.dayNames;e+="",t+="";var n,o,s=0,l=0,d=0,u=0,c=new Date,p=c.getYear(),h=c.getMonth()+1,g=1,m=c.getHours(),f=c.getMinutes(),b=c.getSeconds(),v=(c.getMilliseconds(),"");if(bizagi.util.isValidResource("datePickerRegional")&&(i=bizagi.localization.getResource("datePickerRegional")),i){var y=i.monthNames.concat(i.monthNamesShort),C=i.dayNames.concat(i.dayNamesShort);r=r.toString()===y.toString()?r:y,a=a.toString()===C.toString()?a:C}for(;l<t.length;){for(n=t.charAt(l),o="";t.charAt(l)==n&&l<t.length;)o+=t.charAt(l++);if("yyyy"==o||"yy"==o||"y"==o){if("yyyy"==o&&(d=4,u=4),"yy"==o&&(d=2,u=2),"y"==o&&(d=2,u=4),null==(p=w(e,s,d,u)))return 0;s+=p.length,2==p.length&&(p=p>70?p-0+1900:p-0+2e3)}else if("MMMM"==o||"MMM"==o||"NNN"==o){h=0;for(var x=0;x<r.length;x++){var z=r[x];if(e.substring(s,s+z.length).toLowerCase()==z.toLowerCase()&&("MMMM"==o||"MMM"==o||"NNN"==o&&x>11)){(h=x+1)>12&&(h-=12),s+=z.length;break}}if(0==h){if(null==(h=w(e,s,1,2))||h<1||h>12)return 0;s+=h.length}if(h<1||h>12)return 0}else if("dddd"==o||"EE"==o||"E"==o)for(var E=0;E<a.length;E++){var T=a[E];if(e.substring(s,s+T.length).toLowerCase()==T.toLowerCase()){s+=T.length;break}}else if("MM"==o||"M"==o){if(null==(h=w(e,s,1,2))||h<1||h>12)return 0;s+=h.length}else if("dd"==o||"d"==o){if(null==(g=w(e,s,1,2))||g<1||g>31)return 0;s+=g.length}else if("hh"==o||"h"==o){if(null==(m=w(e,s,o.length,2))||m<1||m>12)return 0;s+=m.length}else if("HH"==o||"H"==o){if(null==(m=w(e,s,o.length,2))||m<0||m>23)return 0;s+=m.length}else if("KK"==o||"K"==o){if(null==(m=w(e,s,o.length,2))||m<0||m>11)return 0;s+=m.length}else if("kk"==o||"k"==o){if(null==(m=w(e,s,o.length,2))||m<1||m>24)return 0;s+=m.length,m--}else if("mm"==o||"m"==o){if(null==(f=w(e,s,o.length,2))||f<0||f>59)return 0;s+=f.length}else if("ss"==o||"s"==o){if(null==(b=w(e,s,o.length,2))||b<0||b>59)return 0;s+=b.length}else if("FFF"==o){if(ff=w(e,s,o.length,3),null==ff||ff<0||ff>999)return 0;s+=ff.length}else if("a"==o||"tt"==o){if("am"==e.substring(s,s+2).toLowerCase())v="AM";else{if("pm"!=e.substring(s,s+2).toLowerCase())return 0;v="PM"}s+=2}else{if(e.substring(s,s+o.length)!=o)return 0;s+=o.length}}if(2==h)if(p%4==0&&p%100!=0||p%400==0){if(g>29)return 0}else if(g>28)return 0;return(4==h||6==h||9==h||11==h)&&g>30?0:(m<12&&"PM"==v?m=m-0+12:m>11&&"AM"==v&&(m-=12),new Date(p,h-1,g,m,f,b));function R(e){for(var t=0;t<e.length;t++)if(-1=="1234567890".indexOf(e.charAt(t)))return!1;return!0}function w(e,t,i,r){for(var a=r;a>=i;a--){var n=e.substring(t,t+a);if(n.length<i)return null;if(R(n))return n}return null}},this.parseDate=function(e){for(var t,i=2==arguments.length&&arguments[1],r=new Array("y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d"),a=new Array("M/d/y","M-d-y","M.d.y","MMM-d","M/d","M-d"),n=new Array("d/M/y","d-M-y","d.M.y","d-MMM","d/M","d-M"),o=new Array(r,i?n:a,i?a:n),s=0;s<o.length;s++)for(var l=window[o[s]],d=0;d<l.length;d++)if(0!=(t=getDateFromFormat(e,l[d])))return new Date(t);return null},this.analyzeTimeFormat=function(e){for(var t,i,r=0,a={show24Hours:!1,showSeconds:!1,separator:":"},n="";r<e.length;){for(t=e.charAt(r),i="";e.charAt(r)==t&&r<e.length;)i+=e.charAt(r++);"hh"==i||"h"==i?(n=i,a.show24Hours=!1):"HH"==i||"H"==i?(n=i,a.show24Hours=!0):"mm"==i||"m"==i?n=i:"ss"==i||"s"==i?(n=i,a.showSeconds=!0):"a"==i?n=i:"H"!=n.toUpperCase()&&"HH"!=n.toUpperCase()||(a.separator=i)}return a},this.getDateFromInvariant=function(e,t){e="string"!=typeof(e=null==e?"":e)?e.toString():e;var i="MM/dd/yyyy"+(t?" H:mm:ss":"");t&&e&&(e.toLowerCase().indexOf("am")>0||e.toLowerCase().indexOf("pm")>0)&&(i="MM/dd/yyyy h:mm:ss a");var r=bizagi.util.dateFormatter.getDateFromFormat(e,i);return 0!=r||t?0==r&&t&&null!=e&&""!=e&&(i="MM/dd/yyyy",(r=bizagi.util.dateFormatter.getDateFromFormat(e,i)).setHours(0,0,0,0)):(i="MM/dd/yyyy H:mm:ss",r=bizagi.util.dateFormatter.getDateFromFormat(e,i)),r},this.formatInvariant=function(e,t){var i="MM/dd/yyyy"+(t?" HH:mm:ss":"");return bizagi.util.dateFormatter.formatDate(e,i)},this.getDateFromISO=function(e,t){var i="yyyy-MM-dd"+(t?" HH:mm":""),r=bizagi.util.dateFormatter.getDateFromFormat(e,i);return 0==r&&t&&(i="yyyy-MM-dd"+(t?" HH:mm:ss":""),r=bizagi.util.dateFormatter.getDateFromFormat(e,i)),0!=r||t||(i="yyyy-MM-dd HH:mm",0==(r=bizagi.util.dateFormatter.getDateFromFormat(e,i))&&(i="yyyy-MM-dd HH:mm:ss",r=bizagi.util.dateFormatter.getDateFromFormat(e,i))),r},this.formatISO=function(e,t){var i="yyyy-MM-dd"+(t?" HH:mm":"");return bizagi.util.dateFormatter.formatDate(e,i)},this.formatISO8601=function(e,t){return(t=t||!1)&&e.setHours(0,0,0,0),bizagi.util.dateFormatter.formatDate(e,"yyyy-MM-ddTHH:mm:ss")},this.isFormatISO8601=function(e){return/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(([+-]\d\d:\d\d)|Z)?$/i.test(e)},this.sleep=function(e){for(var t=(new Date).getTime();(new Date).getTime()<t+e;);},this.getDateFormatByDatePickerJqueryUI=function(){return bizagi.localization.getResource("dateFormat").replace("yyyy","yy")}},bizagi.util.sleepUntil=function(e,t){t=t||200;var i=new $.Deferred;return function r(){var a=setTimeout((function(){if("pending"===i.state()){if(!!e())return i.resolve(),void clearTimeout(a);r(name)}}),t)}(),i.promise()},bizagi.util.sleepFor=function(e){e=e||200;var t,i=new $.Deferred;return t=setTimeout((function(){"pending"===i.state()&&(i.resolve(),clearTimeout(t))}),e),i.promise()},bizagi.util.browserSupportLocalStorage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},bizagi.util.setItemLocalStorage=function(e,t){return!!bizagi.util.browserSupportLocalStorage()&&(localStorage.setItem(e,t),!0)},bizagi.util.getItemLocalStorage=function(e){return localStorage.getItem(e)},bizagi.util.removeItemLocalStorage=function(e){localStorage.removeItem(e)},bizagi.util.clearLocalStorage=function(){bizagi.util.browserSupportLocalStorage()&&localStorage.clear()},"debug"==("undefined"!=typeof BIZAGI_ENVIRONMENT?BIZAGI_ENVIRONMENT:"release")?"object"!=_typeof(window.console)&&(window.console={log:function(e){}}):"object"!=("undefined"==typeof console?"undefined":_typeof(console))?window.console={log:function(e){}}:bizagiConfig&&!bizagiConfig.showConsoleLog&&(console.log=function(e){}),bizagi.util.startLoading=function(e){(e||$("body")).append('<div class="ui-widget-overlay ui-front" style="z-index: 1001;"><div class="ui-bizagi-loading-message-center" style="position: absolute; top: 48%; left: 48%; display: ;"><div class="ui-bizagi-loading-icon"></div></div></div>')},bizagi.util.stopLoading=function(e){var t=e||$("body");$(".ui-widget-overlay:first",t).remove()},bizagi.util.smartphone.startLoading=function(e){(e||$("body")).append('<div class="bz-util-loading-container"> <div class="ui-bizagi-loading-icon bz-util-loading"></div>  </div>')},bizagi.util.smartphone.stopLoading=function(e){var t=e||$("body");$(".bz-util-loading-container",t).remove()},bizagi.util.isEventSupported=function(e,t){var i,r=!("onblur"in document.documentElement);return!!e&&(t&&"string"!=typeof t||(t=document.createElement(t||"div")),!(i=(e="on"+e)in t)&&r&&(t.setAttribute||(t=document.createElement("div")),t.setAttribute&&t.removeAttribute&&(t.setAttribute(e,""),i="function"==typeof t[e],void 0!==t[e]&&(t[e]=void 0),t.removeAttribute(e))),i)},bizagi.circularDependencies=function(){var e=(new Function).prototype;e.list=[],e.lastNodeAdded,e.addNode=function(t,i){var n=JSON.encode(i),o=r(t,n);if(!o){var s=new a(t,n);return e.list.push({name:t,obj:n,nodeObj:s,timeStamp:(new Date).getTime()}),s}(e.lastNodeAdded||e.list[e.list.length-1]).nodeObj.addChild(o.nodeObj),e.lastNodeAdded=o},e.resolve=function(t,r,a){return t=t||i()||e.list[0].nodeObj,new n(t,r,a)};var t=function(){e.list=[]},i=function(){for(var t=0;t<e.list.length;t++)if(e.list[t].nodeObj.childs.length>0)return e.list[t].nodeObj;return e.list.length>0?e.list[0].nodeObj:{}},r=function(t,i){for(var r=0;r<e.list.length;r++)if(e.list[r].name==t){var a=(new Date).getTime();if(e.list[r].timeStamp+1e3<a)e.list.splice(r,1);else if(e.list[r].obj==i)return e.list[r]}return!1},a=function(e,t){e=e||"",t=t||{};var i=function(e,t){this.name=e,this.obj=t,this.childs=[]};return i.prototype.addChild=function(e){this.childs.push(e)},i}(),n=function(e,i,r){var a=function e(i,r,a){this.node=i||{},this.node.childs=this.node.childs||[],this.resolved=r||[],this.seen=a||[],this.seen.push(this.node);for(var o=0;o<this.node.childs.length;o++)if(!n.hasObject(this.node.childs[o],this.resolved)){if(n.hasObject(this.node.childs[o],this.seen)){t();var s={dependencyFrom:this.node.name,dependencyFromObj:this.node.obj,dependencyTo:this.node.childs[o].name,dependencyToObj:this.node.childs[o].obj,path:this.seen};return{error:$.extend({standardError:{status:"error",responseText:JSON.encode({message:n.makeErrorMessage(s),type:"alert"})},multiactionError:{message:n.makeErrorMessage(s),type:"alert"}},s)}}return e(this.node.childs[o],this.resolved,this.seen)}this.resolved&&this.resolved.push(this.node)},n=a.prototype;return n.hasObject=function(e,t){for(var i=0;i<t.length;i++)if(t[i].name==e.name)return!0;return!1},n.makeErrorMessage=function(e){var t=bizagi.localization.getResource("render-actions-loop-validation");return printf(t,e.dependencyFrom,e.dependencyTo)},a}();return e},bizagi.util.cssExtended=function(e,t){var r=t.split(";");for(i=0;i<r.length;i++)""!=r[i]&&bizagi.util.cssExtendedApplyChanges(e,r[i])},bizagi.util.cssExtendedApplyChanges=function(e,t){for(var i=0;i<e.length;i++){var r=$(e[i]),a=t.split(":")[0];if(r.attr("style")){var n=r.attr("style").split(";"),o=[],s="";for(j=0;j<n.length;j++){var l=n[j].split(":");$.trim(l[0])!=a&&""!=$.trim(l[0])&&o.push(l[0]+":"+l[1]+";"),s=JSON.stringify(o).replace(/\","/g," ").replace(/\["/g," ").replace(/\"]/g," ")}s="[]"==s?"":s,r.attr("style",s+t+";")}else if(r.css(a)){n=r.css(a),s="";(o=[]).push(t+";"),s="[]"==s?"":s,r.attr("style",s+t+";")}}},bizagi.util.scrollTop=function(e){if(e&&e[0])for(;"HTML"!==e[0].tagName&&"scroll"!=e.css("overflow-y")&&"auto"!=e.css("overflow-y")&&e.parent().length>0;)e=e.parent();return e},bizagi.util.sortJSON=function(e,t,i){return e.sort((function(e,r){var a=e[t],n=r[t];return"asc"===i?a<n?-1:a>n?1:0:"desc"===i?a>n?-1:a<n?1:0:void 0}))},bizagi.util.shortNumber=function(e){var t=e.toString(),i=t.length;return i>=4&&i<7?t="+"+t.charAt(0)+"K":i>=7&&i<10?t="+"+t.charAt(0)+"M":i>=10&&(t="+"+t.charAt(0)+"B"),"&nbsp;&nbsp;&nbsp;"+t},bizagi.util.replaceLineBreak=function(e){return"string"==typeof e?e.replace(/\r\n|\r|\n|<br>|<br\/>/g,"<br/>"):e},bizagi.util.escapeHtml=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},bizagi.util.formatMonetaryCell=function(e){return bizagi.util.formatMonetaryValue(e)},bizagi.util.formatDecimalCell=function(e){return bizagi.util.formatDecimalValue(e)},bizagi.util.formatDateValue=function(e){return bizagi.util.formatDateFromInvariantStringDate(e)},bizagi.util.formatMonetaryValue=function(e){return bizagi.util.formatMoney(e,BIZAGI_DEFAULT_CURRENCY_INFO)},bizagi.util.formatDecimalValue=function(e){var t,i={decimalSymbol:BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,digitGroupSymbol:BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator,roundToDecimalPlace:BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits};t=$.extend({colorize:!1,decimalSymbol:".",digitGroupSymbol:",",groupDigits:!0,negativeFormat:"(%s%n)",positiveFormat:"%s%n",roundToDecimalPlace:"2",symbol:""},i);var r=bizagi.util.formatDecimal(e,t);if(!0===bizagi.override.removeTrailingZeros){var a=!0;-1!=r.toString().indexOf(")")&&(a=!1,r=r.replace("(","").replace(")",""));var n=new RegExp("("+BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator+"\\d*?[1-9])0+$","g");r=r.replace(n,"$1"),n=new RegExp("\\"+BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator+"0+$","g"),r=r.replace(n,""),a||(r="("+r+")")}return r},bizagi.util.showNotification=function(e){e=e||{};var t=$('<div id="sync-notification" class="bz-cm-icon"></div>').text(e.text||"");t.appendTo($("body")),t.fadeIn(1500,(function(){t.stop()})),t.fadeOut(2e3,(function(){t.remove()}))},bizagi.util.isModeOnline=function(){return void 0!==bizagi.context.isOfflineForm&&!bizagi.context.isOfflineForm},bizagi.util.dispose=function(e){for(key in e)"object"==_typeof(e[key])&&delete e[key],"function"==typeof e[key]&&(e[key]=null,delete e[key])},bizagi.util.arrayEach=function(e,t){var i;if(e)if("[object Array]"===Object.prototype.toString.apply(e)&&"[object Function]"===Object.prototype.toString.apply(t)){for(i in e)if(e.hasOwnProperty(i)&&!1===t.call(e[i],i,e[i]))return}else $.each(e,t)},bizagi.util.getStandardNotation=function(e,t){t=t||".";var i="",r=!1,a=!1;e=(e.length>0?e.toString().toLowerCase():"").replace(/ /g,"");for(var n=0;n<e.length;n++)("+"!==e[n]&&"-"!==e[n]||0!==n&&"e"!=e[n-1])&&isNaN(Number(e[n]))?e[n]!==t||r?"e"!==e[n]||a||(i+=e[n],a=!0):(i+=e[n],r=!0):i+=e[n];return i},bizagi.util.scientificNotationFormat=function(e,t,i,r,a){t=t||".",e=bizagi.util.getStandardNotation(e,t),i=i>0?i:38,r=r>0?r:-125,a=a>0?a:125;var n=new RegExp("[0-9]+("+t+"[0-9]+)?(e[+-]?[0-9]+)?"),o=e.match(n),s=0,l="-"===e[0]?e[0]:"",d=0;if(e=e.replace(l,""),o&&o[0]&&o[2]){var u=o[0]?o[0].replace(o[2],"").split(t):"",c="",p="";return u[0]=u[0].replace(/^0+/g,""),u[0].length>1?(d=(c=u[0].slice(1)).length,p=u[0][0]||"",c=c.concat(o[1]||"")):1===u[0].length?(p=u[0][0]||"",c=c.concat(u[1]||"")):(d=u[1].length,u[1]=u[1].replace(/^0+/g,""),d=u[1].length-1-d,p=u[1][0],c=u[1].slice(1)),(c=c.replace(t,"").replace(/0+$/g,"")).length>=i&&(c=c.slice(0,i-1)),l+p+(c?t+c:"")+"e"+((s=(s=Number(o[2].replace("e",""))+d)>a?a:s<r?r:s)>0?"+"+s:s)}if(e){d=e.indexOf(t);var h=0,g=e.length-1;e=e.replace(t,"");for(var m=h;!f;)"0"!==e[m]&&e[m]!==t?(f=!0,h=m):m++;for(var f=!1,b=g;!f;)"0"!==e[b]&&e[b]!==t?(f=!0,g=b+1):b--;if(g=g>i+h?i+h:g,-1!==d){f=!1;return s=d-(h+1),(c=e.slice(h,g)).length>0&&!isNaN(Number(c[0]))?l+c[0]+(c.length>1?t+c.slice(1):"")+"e"+(s>0?"+"+s:s):"0"}var v=e.slice(h,h+1),y=e.slice(h+1,e.length);return s=y.length,(y=y.replace(/0+$/g,"")).length>i&&(y=e.slice(h+1,i+h)),Number(v)?l+v+(y.length>0?t+y:"")+"e"+(s>0?"+"+s:s):"0"}return""},bizagi.util.stripslashes=function(e){return e.replace(/\\'/g,"'").replace(/\"/g,'"').replace(/\\\\/g,"\\").replace(/\\0/g,"\0")},bizagi.util.isHTMLValidText=function(e){return new RegExp(/<(.|\n)*?>/g).test(e)},bizagi.util.resetData=function(){var e=JSON.parse(sessionStorage.getItem("bizagiAuthentication"));sessionStorage.removeItem("bizagiAuthentication"),$.extend(e,{isAuthenticate:"false"}),sessionStorage.setItem("bizagiAuthentication",JSON.encode(e))},bizagi.util.changeData=function(e){var t=JSON.parse(sessionStorage.getItem("bizagiAuthentication"));sessionStorage.removeItem("bizagiAuthentication"),$.extend(t,e),sessionStorage.setItem("bizagiAuthentication",JSON.encode(t))},bizagi.util.isMobileDevice=function(e){return e=e||bizagi.detectDevice(),["smartphone_ios","smartphone_ios_native","smartphone_android","smartphone_android_native","tablet","tablet_ios","tablet_ios_native","tablet_android","tablet_android_native"].indexOf(e)>-1},bizagi.util.isNativeMobileDevice=function(e){return bizagi.util.isMobileDevice(e)&&bizagi.util.isNativePluginSupported()},bizagi.util.isTabletDevice=function(e){return e=e||bizagi.util.detectDevice(),["tablet","tablet_ios","tablet_ios_native","tablet_android","tablet_android_native"].indexOf(e)>-1},bizagi.util.isAndroidTabletDevice=function(e){return e=e||bizagi.util.detectDevice(),bizagi.util.isTabletDevice()&&-1!==e.indexOf("android")},bizagi.util.isiOSTabletDevice=function(e){return e=e||bizagi.util.detectDevice(),bizagi.util.isTabletDevice()&&!(-1===e.indexOf("android"))},bizagi.util.isSmartphoneDevice=function(e){return e=e||bizagi.util.detectDevice(),["smartphone_ios","smartphone_ios_native","smartphone_android","smartphone_android_native"].indexOf(e)>-1},bizagi.util.isAndroidSmartphoneDevice=function(e){return e=e||bizagi.util.detectDevice(),bizagi.util.isSmartphoneDevice()&&-1!==e.indexOf("android")},bizagi.util.isiOSSmartphoneDevice=function(e){return e=e||bizagi.util.detectDevice(),bizagi.util.isSmartphoneDevice()&&-1!==e.indexOf("ios")},bizagi.util.isOfflineForm=function(e){if(!bizagi.util.isMobileDevice()||void 0===e)return!1;var t=e.context||null,i=e.container||null,r=null!==i?i:null!==t?t.getFormContainer():null;if(null===r)return!1;var a=r.getParams()||{};return void 0!==a.isOfflineForm&&bizagi.util.parseBoolean(a.isOfflineForm)},bizagi.util.detectAndroidVersion=function(){var e=navigator.userAgent.toLowerCase().indexOf("android"),t=navigator.userAgent.toLowerCase().substring(e+8,e+13);return t=t.replaceAll(".",""),Number(t)},bizagi.util.getPathUrl=function(e){var t="",i=location.pathname.split("/"),r=location.protocol+"//"+location.host;if("/"==BIZAGI_PATH_TO_BASE[0])t=r+BIZAGI_PATH_TO_BASE+e;else{for(var a=BIZAGI_PATH_TO_BASE.split("../").length,n=0,o=i.length;n<o-a;n++)r+=i[n]+"/";t=(r="/"===r[r.length-1]?r:r+"/")+e}return t},bizagi.util.getAndroidVersion=function(){var e=navigator.userAgent.toLowerCase().match(/android\s([0-9\.]*)/);return!!e&&parseFloat(e[1])},bizagi.util.mobileImagePath=function(e){var t=e,i=bizagi.util.getAndroidVersion();if(!i)return t;if("content://com.android"===t.substring(0,21)&&i<=4.4){var r=t.split("%3A");r.length>1?t="content://media/external/images/media/"+r[1]:(r=t.split("/"),t="content://media/external/images/media/"+r[r.length-1])}return t},bizagi.util.isValidResource=function(e){return!!bizagi.localization&&bizagi.localization.getResource(e)!==e},bizagi.util.b64toBlob=function(e,t,i){t=t||"",i=i||512;for(var r=atob(e),a=[],n=0;n<r.length;n+=i){for(var o=r.slice(n,n+i),s=new Array(o.length),l=0;l<o.length;l++)s[l]=o.charCodeAt(l);var d=new Uint8Array(s);a.push(d)}return new Blob(a,{type:t})},bizagi.util.stringToByteArray=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t},bizagi.util.hasOfflineFormsEnabled=function(){return"undefined"!=typeof BIZAGI_ENABLE_OFFLINE_FORMS&&!0===bizagi.util.parseBoolean(BIZAGI_ENABLE_OFFLINE_FORMS)},bizagi.util.isFlatDesignEnabled=function(){return"undefined"!=typeof BIZAGI_ENABLE_FLAT&&!0===bizagi.util.parseBoolean(BIZAGI_ENABLE_FLAT)},bizagi.util.isMobileGridEnabled=function(){return"undefined"!=typeof BIZAGI_ENABLE_MOBILE_GRID&&!0===bizagi.util.parseBoolean(BIZAGI_ENABLE_MOBILE_GRID)},bizagi.util.isNativeHeaderEnabled=function(){return"undefined"!=typeof NATIVE_HEADER_ENABLE&&!0===bizagi.util.parseBoolean(NATIVE_HEADER_ENABLE)},bizagi.util.isQuickSearchEnabled=function(){return"undefined"!=typeof BIZAGI_ENABLE_QUICK_SEARCH&&!0===bizagi.util.parseBoolean(BIZAGI_ENABLE_QUICK_SEARCH)},bizagi.util.isOAuth2Enabled=function(){return"undefined"!=typeof BIZAGI_AUTH_TYPE&&"OAuth"===BIZAGI_AUTH_TYPE},bizagi.util.getNativeComponent=function(){return"undefined"!=typeof BIZAGI_NATIVE_COMPONENT?BIZAGI_NATIVE_COMPONENT:""},bizagi.util.isVersionSupported=function(){var e=!0;if("undefined"!=typeof BIZAGI_SERVER_VERSION&&!bizagi.util.isEmpty(BIZAGI_SERVER_VERSION)){var t=BIZAGI_SERVER_VERSION.match(/\d+\.\d+/);e=!t||parseFloat(t.shift())>=11}return e},bizagi.util.isCordovaSupported=function(){return"undefined"!=typeof cordova},bizagi.util.isNativePluginSupported=function(){return"undefined"!=typeof bizagiapp},bizagi.util.isTabletNativeSupported=function(){return"undefined"!=typeof bizagiapp&&bizagi.util.isTabletDevice()},bizagi.util.isSmartphoneNativeSupported=function(){return"undefined"!=typeof bizagiapp&&bizagi.util.isSmartphoneDevice()},bizagi.util.isNativePluginSupported()&&window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),bizagi.util.detectRealDevice=function(){var e="undefined"==typeof BIZAGI_DEFAULT_DEVICE||bizagi.util.isEmpty(BIZAGI_DEFAULT_DEVICE)?null:BIZAGI_DEFAULT_DEVICE;BIZAGI_DEFAULT_DEVICE="";var t=bizagi.detectDevice();return BIZAGI_DEFAULT_DEVICE=e,t},bizagi.util.isAndroid=function(){return navigator.userAgent.toLowerCase().indexOf("android")>-1},bizagi.util.isAndroidDevice=function(){return bizagi.util.detectDevice().indexOf("android")>-1},bizagi.util.isiOSDevice=function(){return-1===bizagi.util.detectDevice().indexOf("android")},bizagi.util.getChannelType=function(){return"undefined"==typeof BIZAGI_SERVER_CHANNEL||bizagi.util.isEmpty(BIZAGI_SERVER_CHANNEL)?bizagi.loader.channel||"":BIZAGI_SERVER_CHANNEL},bizagi.util.isDataUrl=function(e){try{return!!e.toString().match(/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*)\s*$/i)}catch(e){}return!1},bizagi.util.getDataUrl=function(e){var t;try{if(void 0===e.value||bizagi.util.isEmpty(e.value))t=e.url||"";else{var i=e.value,r=i.value||i;if(Array.isArray(r)){var a=r.shift();t=Array.isArray(a)?a.join(""):a}else t=r}(t=bizagi.util.isEmpty(t)?"":"data:image/png;base64,"+t.replace(/^data:.*;base64,/,""))&&-1!==t.indexOf("Invalid case id")&&(t="")}catch(e){t=""}return t},bizagi.util.processFailMessage=function(e){var t=e||{};try{t=(t="string"==typeof t?JSON.parse(t):t).responseText||t.message||t}catch(i){t=e}return t},bizagi.util.getErrorFormatted=function(e){var t=e;if(!t)return e;if("string"==typeof t)try{t=JSON.parse(t)}catch(i){t={type:"error",code:"code",message:e}}return"object"==_typeof(t)&&(t.message||t.statusText)?{type:t.type||"error",code:t.code||t.errorCode||t.errorType||t.statusText||"code",message:t.message}:(t&&t.length&&t.length>=1&&(t=t[0]),t.responseText&&(t=t.responseText),t.error&&(t=t.error),bizagi.util.getErrorFormatted(t))};var tmp_block_header="<div class='blockHeaderByLiveProcess'></div>";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bizagiQueue(){var e=this,t=[];e.add=function(e){t.push({callbacks:[e]})},e.addParallel=function(i){if(0==t.length)return e.add(i);t[t.length-1].callbacks.push(i)},e.execute=function(){for(var e=new $.Deferred,i=e.promise(),r=t.length,a=0;a<r;a++)i=i.pipe((function(){var e=t.shift();return $.when.apply($,$.map(e.callbacks,(function(e){return"function"==typeof e?e():e})))}));return e.resolve(),i=i.done((function(){t=[]}))}}bizagi.util.disableWorkPortalMenu=function(){var e=$("body").find("#ui-bizagi-wp-menu").height();$(tmp_block_header).prependTo("body"),$("body").find(".blockHeaderByLiveProcess").css({position:"absolute",width:"100%",height:e+"px",background:"gray",opacity:"0.9","z-index":"101"})},bizagi.util.enableWorkPortalMenu=function(){$("body").find(".blockHeaderByLiveProcess").detach()},bizagi.util.enableMenuSection=function(e){(new bizagi.workportal.controllers.menu).setActiveSection.apply($("#main_menu li#"+e)[0])},bizagi.util.getURLWithASlashAtTheEnd=function(e){var t;return"/"===(t=e).substr(t.length-1)?e:e+"/"},bizagi.util.downloadFile=function(e,t,i){var r,a=new $.Deferred,n=void 0===i||i,o=(t?"":bizagi.util.getURLWithASlashAtTheEnd(bizagiConfig.applicationUrl))+e,s=0!==$("#iframe-download").length,l=function(){var e=$(this)[0],t=bizagi.localization.getResource("workportal-general-error-message-contact-administrator"),i=bizagi.util.tryCatch((function(){return $(e.contentDocument).text()}),t),r=-1!==i.indexOf("HTTP Error 503"),o=bizagi.util.tryCatch((function(){return JSON.parse(i)}),{code:"error",status:"error",message:""===i?t:i}),s=n&&!r;r&&bizagiConfig.maintenanceWindows.start(),function(e,t){t&&bizagi.modalError.show(e.message,void 0,!1),a.reject(e)}(o,s)};return s||((r=$("<iframe/>")).attr({style:"visibility:hidden;display:none",id:"iframe-download"}).appendTo("body"),r[0].onload=l),$("#iframe-download").attr("src",o),a},bizagi.util.downloadFileByPOST=function(e,t){0!==$("#iframe-download").length&&$("#iframe-download").remove(),$("<iframe/>").attr({style:"visibility:hidden;display:none",id:"iframe-download"}).appendTo("body");for(var i="",r=0;r<t.length;r++)i=i+"<input type='text' name='"+t[r].name+"' value='"+t[r].value+"'>";var a="<form id='formPOST' action='"+e+"' method='POST'>"+i+"</form>";$("#iframe-download").contents().find("body").append(a),bizagi.util.isIE11()?(bizagi.showErrorAlertDialog=!1,$.ajax({type:"POST",url:e,data:t,dataType:"text"}).then((function(){$("#formPOST",$("#iframe-download").contents()).submit()}))):$("#formPOST",$("#iframe-download").contents()).submit()},bizagi.util.executeActionRoutingFromWorkportal=function(e,t){bizagi.workportal.controllers.menu.prototype.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e,idWorkItem:t})},bizagi.util.getMessageFromNetworkState=function(e){return e?bizagi.localization.getResource("render-without-globalform-offline-userOnline","The case has been created successfully, please wait until the server synchronizes"):bizagi.localization.getResource("render-without-globalform-offline","Your offline case has been created successfully. It will synchronized as soon as you go online.")},bizagi.util.sanitizeHTML=function(e){var t=null!=e?e.toString():e,i=DOMPurify.sanitize(t),r=document.createElement("div");return r.innerHTML=i,0===r.childNodes.length?"":String(r.childNodes[0].nodeValue)},bizagi.util.arrayUnique=function(e){for(var t=e.concat(),i=0,r=t.length;i<r;++i)for(var a=i+1;a<r;++a)t[i]===t[a]&&t.splice(a-=1,1);return t},bizagi.util.debounce=function(e,t,i){var r;return function(){var a=this,n=arguments,o=function(){if(r=null,!i)return e.apply(a,n)},s=i&&!r;if(clearTimeout(r),r=setTimeout(o,t||200),s)return e.apply(a,n)}},bizagi.util.debounce2=function(e,t,i){var r,a=this,n=function(){var a=this,n=arguments,o=function(){if(r=null,!i)return e.apply(a,n)},s=i&&!r;if(clearTimeout(r),r=setTimeout(o,t||200),s)return e.apply(a,n)};return{timeout:r,cancel:function(){clearTimeout(r)},fire:function(){n.call(a,arguments)}}},bizagi.util.isNativeImageEditorSupported=function(){return bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSDevice()&&bizagi.override.enableImageEditor},bizagi.util.errorMessage=function(e){return'<div class="admin-stakeholder-message"> <i class="bz-wp-empty__img"></i> <p class="bz-wp-empty__info bz-wp-empty__info--first"> '+e+"</p></div>"},bizagi.util.validateUrlWellFormed=function(e){var t=/^((http|https|ftp):\/\/)/.test(e)?e:"http://"+e,i=document.createElement("a");i.setAttribute("href",t);var r=DOMPurify.sanitize(i,{IN_PLACE:!0}),a=e?e.replace(/ /g,""):"";return bizagi.util.isEmpty(a)?null:r.href},bizagi.util.encodeHtmlText=function(e){var t=e||"",i="";if("string"==typeof t){var r=bizagi.util.decodeURI(t);i=bizagi.util.encodeString(r)}return i},bizagi.util.encodeString=function(e){var t=e||"";return t=(t=(t=(t=(t=t.replaceAll("&","&amp;")).replaceAll("$","&#36;")).replaceAll("<","&lt;").replaceAll(">","&gt;")).replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;")).replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},bizagi.util.setCaretPosition=function(e,t){if(t.setSelectionRange)t.focus(),t.setSelectionRange(e,e);else if(t.createTextRange){var i=t.createTextRange();i.collapse(!0),i.moveEnd("character",e),i.moveStart("character",e),i.select()}},bizagi.util.getCaretPosition=function(e){var t=0;if(document.selection){e.focus();var i=document.selection.createRange();i.moveStart("character",-e.value.length),t=i.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t},bizagi.util.escapeRegex=function(e){return(e=e||"").replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")},bizagi.util.getFeatureObject=function(e){var t=e.split(".");return this.featureObjectCache=this.featureObjectCache||{},e in this.featureObjectCache?this.featureObjectCache[e]:this.featureObjectCache[e]=function(t){var i=bizagi.util.getConfigFeatures();if("string"==typeof e&&void 0!==i){for(var r=i,a=0,n=t.length;a<n;a++)if(void 0===(r=r[t[a]]))return;return r}}(t)},bizagi.util.getConfigFeatures=function(){var e=window.bizagiConfig||bizagiConfig||{};return bizagi.util.isMobileDevice()&&"undefined"!=typeof BIZAGI_MOBILE_FEATURES&&!bizagi.util.isEmpty(BIZAGI_MOBILE_FEATURES)&&(e.features=JSON.parse(BIZAGI_MOBILE_FEATURES||"{}")),e.features},bizagi.util.resetConfigFeatures=function(){bizagi.util.featureObjectCache=void 0},bizagi.util.isFailResponse=function(e){return e&&(e.type&&"error"===e.type||e.status&&"error"===e.status||e.code&&"UNKNOWN_ERROR"===e.code)},bizagi.util.formatItem=function(e){if(null!=e){if($.isArray(e)){for(var t=0,i=e.length;t<i;t++)null!=e[t]&&"boolean"==typeof e[t]&&(!0===bizagi.util.parseBoolean(e[t])?e[t]=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e[t])&&(e[t]=bizagi.localization.getResource("render-boolean-no"))),e[t]=bizagi.util.sanitizeHTML(e[t]);return e.join(" - ")}return bizagi.util.sanitizeHTML(e)}return""},bizagi.util.performTermMatches=function(e,t,i){return"object"===_typeof(e)?bizagi.util.formatItem(e):"string"==typeof e?i?bizagi.util.sanitizeHTML(e):bizagi.util.highlightMatches(e,t):e},bizagi.util.highlightMatches=function(e,t){var i=bizagi.util.escapeRegex(t).replaceAll("%",""),r=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+i+")(?![^<>]*>)(?![^&;]+;)","gi");return bizagi.util.sanitizeHTML(e).replace(r,"<strong>$1</strong>")},bizagi.util.getDesktopResolution=function(){var e="",t=1,i=window.screen.width,r=window.screen.height;return"deviceXDPI"in screen?t=screen.deviceXDPI/screen.logicalXDPI:"devicePixelRatio"in window&&(t=window.devicePixelRatio),t=Number(t.toFixed(3)),i&&i>0&&r&&r>0&&(e=i*t+"x"+r*t),e},bizagi.util.getDeviceCode=function(){return bizagi.util.isMobileDevice()?"undefined"==typeof BIZAGI_DEVICE_MARKET_NAME||bizagi.util.isEmpty(BIZAGI_DEVICE_MARKET_NAME)?"":BIZAGI_DEVICE_MARKET_NAME:bizagi.util.getDesktopResolution()},bizagi.util.normalizeType=function(e){return void 0===e?e:e.replace(/smartphone/,"").replace(/tablet/,"").replace(/offline/,"")},bizagi.util.normalizeQueryType=function(e){return void 0===e?e:e.replace(/query/,"").toLowerCase()},bizagi.util.hideOrShowXToCloseDialog=function(e,t){var i=".ui-dialog-titlebar-close";t?$(i,e).show():$(i,e).hide()},bizagi.util.isEnableFeature=function(e){return void 0===bizagi.features&&(bizagi.features=[]),!1!==bizagi.features[e]},bizagi.util.isHtml=function(e){return/<[a-z][\s\S]*>/i.test(e)},bizagi.util.tryCatch=function(e,t){try{return e()}catch(e){return"function"==typeof t?t():t}},bizagi.util.pipe=function(e,t){var i=void 0===t?[]:t;return i.push(e),{next:function(e){return bizagi.util.pipe(e,i)},end:function(e){return i.reduce((function(e,t){return t(e)}),e)}}},function(e){var t=function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},i=function(e){return/(auto|scroll)/.test(function(e){return t(e,"overflow")+t(e,"overflow-y")+t(e,"overflow-x")}(e))};e.scrollerParent=function(e){if(e instanceof HTMLElement||e instanceof SVGElement){for(var t=function e(t,i){return null===t.parentNode?i:e(t.parentNode,i.concat([t]))}(e.parentNode,[]),r=0;r<t.length;r+=1)if(i(t[r]))return t[r];return document.scrollingElement||document.documentElement}}}(jQuery),bizagi.util.startkendo=function(e){void 0===bizagi.kendoMobileApplication?(bizagi.kendoMobileApplication=new kendo.mobile.Application($("body"),{skin:"flat",browserHistory:!1,init:function(t){kendo.ui.progress($(".km-flat"),!0),e.started&&e.started()}}),bizagi.kendoMobileApplication.bizagiNavigate=function(e,t){this.navigate(e,t)}):e.started&&e.started()},bizagi.util.isMashupContext=function(){return"undefined"!=typeof BIZAGI_MASHUP_CONTEXT&&!0===bizagi.util.parseBoolean(BIZAGI_MASHUP_CONTEXT)},bizagi.util.isSharepointContext=function(){return"undefined"!=typeof BIZAGI_SHAREPOINT_CONTEXT&&!0===bizagi.util.parseBoolean(BIZAGI_SHAREPOINT_CONTEXT)},bizagi.util.isWebpartContext=function(){return"undefined"!=typeof isWebpart&&!0===bizagi.util.parseBoolean(isWebpart)},bizagi.util.startTimeline=function(e){(new bizagi.workportal.widgets.widget).showTimeLine(e)},bizagi.util.startGraphicquery=function(e){(new bizagi.workportal.widgets.widget).showGraphicQuery(e)},bizagi.util.startSelectUser=function(){return function(e,t){var i=$.Deferred();(new bizagi.workportal.widgets.widget).showSelectUser(i),i.done((function(t,i,r){e({userId:t,userName:i,guid:r})})).fail((function(){e({})}))}},bizagi.util.isEmptyValue=function(e){if(0===e)return!1;if(null==e||""===e)return!0;if("Array"==typeof e)return 0===e.length;if("[object Array]"===Object.prototype.toString.apply(e))return 0===e.length;if("[object Object]"===Object.prototype.toString.apply(e)){for(var t in e)if(e.hasOwnProperty(t)&&!bizagi.util.isEmptyValue(e[t]))return!1;return!0}return!1},bizagi.util.initializeReferrerParams=function(){bizagi.referrerParams||(bizagi.referrerParams={})},bizagi.util.getLPQueriesParameters=function(){return bizagi.util.initializeReferrerParams(),bizagi.referrerParams.sidebarData},bizagi.util.getLPQueriesSelectedItemFromTree=function(){return bizagi.util.initializeReferrerParams(),bizagi.referrerParams.selectedTreeItem},bizagi.util.setLPQueriesParameters=function(e,t){bizagi.util.initializeReferrerParams(),bizagi.referrerParams.sidebarData=e,bizagi.referrerParams.selectedTreeItem=t},bizagi.util.cleanLPQueriesParameters=function(){bizagi.referrerParams&&(bizagi.referrerParams.sidebarData=null,bizagi.referrerParams.selectedTreeItem=null)},bizagi.util.setLPQueriesReferrer=function(){bizagi.referrerParams.referrer="LPQueries"},bizagi.util.isConnected=function(){return bizagi.util.isNativeMobileDevice()?!navigator||void 0===navigator.connection||"undefined"==typeof Connection||!(navigator.connection.type==Connection.NONE||"unknown"==navigator.connection.type):!bizagi.util.isMobileDevice()||"debug"!==(""+BIZAGI_ENVIRONMENT).toLowerCase()||(!window.navigator||window.navigator.onLine)},bizagi.util.isRenderingUrlAllowed=function(e){for(var t,i=["Rest/(Handlers|Userfields|DocumentTemplates|(Processes(?!/(RecentProcesses|OfflineProcessTree)))|Cases|Authentication|Users)","Api/(Authentication|Entities|Users)"],r=(e||"").replaceAll("../","").replaceAll("./","");t=i.shift();){var a=new RegExp(t,"i");if(null!==r.match(a))return!0}return!1},bizagi.util.applyEyeFunction=function(e){function t(t){$(t,e).parent().find("svg").remove(),$(t,e).after('<svg  class=\'eye_show_icon\'  xmlns="http://www.w3.org/2000/svg" width="16" height="16">\n<path d="M15 7.8C14.9 7.6 12.7 3 8 3S1.1 7.6 1 7.8v.4c.1.2 2.3 4.8 7 4.8s6.9-4.6 7-4.8v-.4zM8 12c-3.5 0-5.5-3.1-5.9-4 .4-.9 2.4-4 5.9-4 3.5 0 5.5 3.1 5.9 4-.4.9-2.4 4-5.9 4z"/>\n<path d="M8 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 3c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/></svg>'),$(t,e).parent().find("input[type='text']").attr("type","password"),$(t,e).parent().find("svg").click(r(!0))}function i(t){$(t,e).parent().find("svg").remove(),$(t,e).after('<svg class=\'eye_hide_icon\' xmlns="http://www.w3.org/2000/svg" width="16" height="16">\n<path d="M3.6 10.5l.7-.7a12.1 12.1 0 0 1-2-1.6C3.1 7.3 5.4 5 8 5h1l.8-.8A6 6 0 0 0 8 4C4.3 4 1.4 7.8 1.2 7.9l-.2.3.3.3a12.3 12.3 0 0 0 2.3 2zm8.7-4.9l-.7.7a12.4 12.4 0 0 1 2.1 1.9C12.9 9 10.6 11 8 11H7l-.8.8L8 12c3.7 0 6.6-3.3 6.7-3.5l.3-.3-.2-.3a12.8 12.8 0 0 0-2.5-2.3zM1.5 15h-.4a.5.5 0 0 1 0-.7l13-13a.5.5 0 1 1 .7.7l-13 13h-.3z"/><path d="M6.3 7.8a1.7 1.7 0 0 1 1.5-1.5l.9-.9H8A2.7 2.7 0 0 0 5.3 8a2.7 2.7 0 0 0 .1.7l.9-.9zm3.4.4a1.7 1.7 0 0 1-1.5 1.5l-.9.9H8A2.7 2.7 0 0 0 10.7 8a2.7 2.7 0 0 0-.1-.7l-.9.9z"/></svg>'),$(t,e).parent().find("input[type='password']").attr("type","text"),$(t,e).parent().find("svg").click(r(!0))}function r(r){return function(a){if(r){var n=$(this).attr("class")||"",o=$(this).parent().find("input");"eye_show_icon"===n?i(o):t(o)}else $($(a,e).parent().find("svg")[0]).click((function(e){var r=$(this).attr("class")||"",a=$(this).parent().find("input");"eye_show_icon"===r?i(a):t(a)}))}}$(e).find("input[type='password']").map((function(e,i){e>0&&(t(i),r(!1)(i))}))},bizagi.util.accessibilityEnter=function(e,t,i){if("function"!=typeof t)throw new Error('Error in "accessibilityEnter" function: You must provide a valid callback');-1!==(i=$.isArray(i)?i:[]).indexOf("click")||i.push("click"),e.bind("keypress",(function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),13!==e.which&&32!==e.which||t(e)})),e.bind(i.join(", "),(function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),t(e)}))},bizagi.util.recreateNativeButtons=function(e){var t=e.getFormContainer().getParams();if(bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()){var i=t.navigation;void 0!==i&&i.setNavigationButtons(e)}},bizagi.util.isOverrideFeatureEnabled=function(e){var t=bizagi.override&&bizagi.override[e]||null;return!0===bizagi.util.parseBoolean(t)},bizagi.util.createDynamicClass=function(nameClass,renderParams){if(nameClass)try{var dynamicFunction="var dynamicFn = function(renderParams){ \r\n";return dynamicFunction+="return new "+nameClass+"(renderParams);\r\n",dynamicFunction+="}\r\n",dynamicFunction+="dynamicFn",dynamicFunction=eval(dynamicFunction),dynamicFunction(renderParams)}catch(e){console.log(e)}return null},bizagi.util.languages={es:"es","es-ES":"es","es-AR":"es","es-BO":"es","es-Cl":"es","es-CO":"es","es-CR":"es","es-DO":"es","es-EC":"es","es-SV":"es","es-GT":"es","es-HN":"es","es-MX":"es","es-NI":"es","es-PA":"es","es-PY":"es","es-PR":"es","es-PE":"es","es-US":"es","es-UY":"es","es-VE":"es",en:"en-US","en-AU":"en-US","en-BZ":"en-US","en-CA":"en-US","en-029":"en-US","en-IN":"en-US","en-IE":"en-US","en-JM":"en-US","en-MY":"en-US","en-NZ":"en-US","en-PH":"en-US","en-SG":"en-US","en-ZA":"en-US","en-TT":"en-US","en-GB":"en-US","en-US":"en-US","en-ZW":"en-US",de:"de","de-AT":"de","de-DE":"de","de-LI":"de","de-LU":"de","de-CH":"de",fr:"fr","fr-BE":"fr","fr-CA":"fr","fr-LU":"fr","fr-MC":"fr","fr-CH":"fr","fr-FR":"fr",it:"it","it-IT":"it","it-CH":"it",ja:"ja","ja-JA":"ja","ja-JP":"ja",nl:"nl","nl-NL":"nl","nl-BE":"nl",pt:"pt-PT","pt-BR":"pt-PT","pt-PT":"pt-PT",ru:"ru","ru-RU":"ru",cs:"cs","cs-CZ":"cs",ar:"ar","ar-DZ":"ar","ar-BH":"ar","ar-EG":"ar","ar-IQ":"ar","ar-JO":"ar","ar-KW":"ar","ar-LB":"ar","ar-LY":"ar","ar-MA":"ar","ar-OM":"ar","ar-QA":"ar","ar-SA":"ar","ar-SY":"ar","ar-TN":"ar","ar-AE":"ar","ar-YE":"ar",zh:"zh","zh-HK":"zh","zh-MO":"zh","zh-CN":"zh","zh-Hans":"zh","zh-SG":"zh","zh-TW":"zh","zh-Hant":"zh"},bizagi.util.getNormalizedDate=function(e,t,i){var r=e;try{e&&"string"==typeof e&&(r=bizagi.util.dateFormatter.getDateFromInvariant(e,i)),r&&0!==r&&null!=r&&(i?r.setMilliseconds(0):r.setHours(0,0,0,0),r=bizagi.util.dateFormatter.formatDate(r,t))}catch(e){}return r},bizagi.util.isFeatureEnabled=function(e){var t=bizagi.override&&bizagi.override[e];return bizagi.util.parseBoolean(t)},bizagi.util.getLastProcessInboxKey=function(){var e="lastProcessInbox";return e=e.concat("_",bizagi.util.getUserHash())},bizagi.util.lastProcessInboxInit=function(){bizagi.util.setItemLocalStorage(bizagi.util.getLastProcessInboxKey(),JSON.stringify(bizagi.util.getLastProcessInboxCreate()))},bizagi.util.getLastProcessInboxCreate=function(){return{processInfo:bizagi.util.createLastProcessInboxProcess(),sortInfo:bizagi.util.createLastProcessInboxSort(),filterInfo:bizagi.util.createLastProcessInboxFilter(),processColumnsInfo:bizagi.util.createLastProcessInboxColumns(),inputTrayInfo:bizagi.util.createLastProcessInboxInputTray()}},bizagi.util.createLastProcessInboxProcess=function(){return{processInfoName:null,idWorkflow:-1}},bizagi.util.createLastProcessInboxSort=function(){return{sortDirection:"asc",sortFieldName:null,sortOrder:null}},bizagi.util.createLastProcessInboxFilter=function(){return{filterValue:null,filterFieldName:null,filterType:"equal"}},bizagi.util.createLastProcessInboxColumns=function(){return{processColumns:[]}},bizagi.util.createLastProcessInboxInputTray=function(){return"inbox"},bizagi.util.getLastProcessInbox=function(){var e=bizagi.util.getItemLocalStorage(bizagi.util.getLastProcessInboxKey());return e||(bizagi.util.lastProcessInboxInit(),e=bizagi.util.getItemLocalStorage(bizagi.util.getLastProcessInboxKey())),JSON.parse(e)},bizagi.util.setLastProcessInbox=function(e,t,i){var r=bizagi.util.getLastProcessInbox();r.processInfo&&(r.processInfo.idWorkflow!=t?r.processColumnsInfo=null:bizagi.util.isEmpty(i)||r.processInfo.smartInboxId==i||(r.processColumnsInfo=null)),r.processInfo.processInfoName=e,r.processInfo.idWorkflow=parseInt(t||-1),r.processInfo.smartInboxId=void 0!==i?i:null,r.filterInfo&&(r.filterInfo=bizagi.util.createLastProcessInboxFilter()),bizagi.util.setItemLocalStorage(bizagi.util.getLastProcessInboxKey(),JSON.stringify(r))},bizagi.util.setLastProcessInboxProcessColumns=function(e){var t=bizagi.util.getLastProcessInbox();t.processColumnsInfo=t.processColumnsInfo||{},t.processColumnsInfo.processColumns=e||[],bizagi.util.setItemLocalStorage(bizagi.util.getLastProcessInboxKey(),JSON.stringify(t))},bizagi.util.getLiveFiltersFromStorage=function(e){var t=[],i=bizagi.util.getItemLocalStorage("livefilters");try{var r=JSON.parse(i);t=void 0!==r[e]?JSON.parse(r[e]):t}catch(e){t=[]}return t},bizagi.util.setLiveFiltersToStorage=function(e,t){var i=bizagi.util.getItemLocalStorage("livefilters")||"[]",r=JSON.parse(i);r[e]=JSON.stringify(t),bizagi.util.setItemLocalStorage("livefilters",JSON.encode(Object.assign({},r)))},bizagi.util.setLastProcessInboxLiveFilter=function(e){var t=bizagi.util.getLastProcessInbox();t.liveFilters=e||[],bizagi.util.setItemLocalStorage(bizagi.util.getLastProcessInboxKey(),JSON.stringify(t))},bizagi.util.setLastProcessInboxSort=function(e,t,i){var r=bizagi.util.getLastProcessInbox();r.sortInfo.sortFieldName=e||null,r.sortInfo.sortDirection=t||"asc",r.sortInfo.sortOrder=i||null,bizagi.util.setItemLocalStorage(bizagi.util.getLastProcessInboxKey(),JSON.stringify(r))},bizagi.util.setLastProcessInboxFilter=function(e,t,i){var r=bizagi.util.getLastProcessInbox();r.filterInfo.filterValue=e||null,r.filterInfo.filterFieldName=t||null,r.filterInfo.filterType=i||"equal",bizagi.util.setItemLocalStorage(bizagi.util.getLastProcessInboxKey(),JSON.stringify(r))},bizagi.util.setLastProcessInboxInputTray=function(e){var t=bizagi.util.getLastProcessInbox();t.inputTrayInfo=e||"",bizagi.util.setItemLocalStorage(bizagi.util.getLastProcessInboxKey(),JSON.stringify(t))},bizagi.util.getLastProcessInboxProcessInfo=function(){var e=bizagi.util.getLastProcessInbox();return bizagi.localization&&null==e.processInfo.processInfoName&&(e.processInfo.processInfoName=bizagi.localization.getResource("workportal-widget-inbox-all-processes")),e.processInfo.allProcesses=-1===e.processInfo.idWorkflow,e.processInfo},bizagi.util.getLastProcessInboxSmartInboxId=function(){return bizagi.util.getLastProcessInbox().processInfo.smartInboxId},bizagi.util.getLastProcessInboxSort=function(){return bizagi.util.getLastProcessInbox().sortInfo},bizagi.util.getLastProcessInboxFilter=function(){return bizagi.util.getLastProcessInbox().filterInfo},bizagi.util.getLastProcessInboxLiveFilter=function(){return bizagi.util.getLastProcessInbox().liveFilters},bizagi.util.getLastProcessInboxProcessColumns=function(){return bizagi.util.getLastProcessInbox().processColumnsInfo},bizagi.util.getLastProcessInboxInputTray=function(){return bizagi.util.getLastProcessInbox().inputTrayInfo},bizagi.util.removeLastProcessInbox=function(){bizagi.util.removeItemLocalStorage(bizagi.util.getLastProcessInboxKey())},bizagi.util.removeLastProcessInboxSort=function(){var e=bizagi.util.getLastProcessInbox();e&&e.sortInfo&&(e.sortInfo=bizagi.util.createLastProcessInboxSort(),bizagi.util.setItemLocalStorage(bizagi.util.getLastProcessInboxKey(),JSON.stringify(e)))},bizagi.util.removeLastProcessLiveFilters=function(){var e=bizagi.util.getLastProcessInbox();e&&e.liveFilters&&(e.liveFilters=[],bizagi.util.setItemLocalStorage(bizagi.util.getLastProcessInboxKey(),JSON.stringify(e)))},bizagi.util.getSyncTimeStampKey=function(){var e="syncTimeStamp";return e=e.concat("_",bizagi.util.getUserHash())},bizagi.util.storeSyncTimeStamp=function(e){bizagi.util.setItemLocalStorage(bizagi.util.getSyncTimeStampKey(),e.toString())},bizagi.util.getSyncTimeStamp=function(){var e=bizagi.util.getItemLocalStorage(bizagi.util.getSyncTimeStampKey());return e?new Date(e):void 0},bizagi.util.getUserHash=function(){return("undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain").hashCode()},bizagi.util.defaultWidget=function(e){var t=bizagi.services.preferences(),i=bizagi.workportal.widgets.widget,r={set:function(e){bizagi.cookie("bizagiDefaultWidget",e,{expires:30})},get:function(){return bizagi.cookie("bizagiDefaultWidget")}},a={set:function(e){var i="inbox"===e?"DETAIL":"TABLE";t.changePreference(t.name.INBOX_VIEW_TYPE,i)},get:function(){var e=t.getPreference(t.name.INBOX_VIEW_TYPE);return"DETAIL"===e?i.BIZAGI_WORKPORTAL_WIDGET_INBOX:i.BIZAGI_WORKPORTAL_WIDGET_INBOX_GRID}},n=bizagi.util.isMobile?r:a;return void 0!==e&&n.set(e),n.get()},bizagi.util.getMobileFeaturesKey=function(){var e="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain",t="mobileFeatures";return t=t.concat("_",e)},bizagi.util.getMobileFeatures=function(){var e=bizagi.util.getItemLocalStorage(bizagi.util.getMobileFeaturesKey());return $.extend(bizagi.util.isEmpty(e)?{}:JSON.parse(e),bizagiConfig.features)},bizagi.util.storeMobileFeatures=function(e){var t=bizagi.util.getMobileFeatures(),i=$.extend(t,e);bizagi.util.setItemLocalStorage(bizagi.util.getMobileFeaturesKey(),JSON.stringify(i))},bizagi.util.getCardviewMaxColumsAllowed=function(){var e=100,t=bizagi.util.getMobileFeatures();return t&&t.maxColumnsEnabled&&!0===t.maxColumnsEnabled.enabled&&(e=t.maxColumnsEnabled.value),e},bizagi.util.blobTob64=function(e,t){var i=new $.Deferred,r=new FileReader;return r.readAsDataURL(e),r.onloadend=function(){base64data=r.result,t&&(base64data=base64data.split(",")[1]),i.resolve(base64data)},i},bizagi.util.blobToText=function(e){var t=new $.Deferred,i=new FileReader;return i.readAsText(e),i.onloadend=function(){t.resolve(i.result)},t.promise()},bizagi.util.getDataUrl=function(e){var t;try{if(void 0===e.value||bizagi.util.isEmpty(e.value))t=e.url||"";else{var i=e.value,r=i.value||i;if(Array.isArray(r)){var a=r.shift();t=Array.isArray(a)?a.join(""):a}else t=r}(t=bizagi.util.isEmpty(t)?"":"data:image/png;base64,"+t.replace(/^data:.*;base64,/,""))&&-1!==t.indexOf("Invalid case id")&&(t="")}catch(e){t=""}return t},bizagi.util.getDataUrl=function(e,t){var i;try{if(void 0===e||bizagi.util.isEmpty(e))i=t||"";else{var r=e,a=r.value||r;if(Array.isArray(a)){var n=a.shift();i=Array.isArray(n)?n.join(""):n}else i=a}(i=bizagi.util.isEmpty(i)?"":"data:image/png;base64,"+i.replace(/^data:.*;base64,/,""))&&-1!==i.indexOf("Invalid case id")&&(i="")}catch(e){i=""}return i},bizagi.util.console={},bizagi.util.console.log=function(){if("Bugsee"in window||bizagi.util.isCordovaSupported()){var e=Array.prototype.slice.call(arguments),t=e[0],i=e.length>1?e.slice(1):null;if(i)try{return void console.log("BUGSEE: "+t+" \r\n"+JSON.encode(i))}catch(e){}}console.log.apply(this,arguments)},bizagi.util.console.error=function(){if("Bugsee"in window||bizagi.util.isCordovaSupported()){var e=Array.prototype.slice.call(arguments),t=e[0],i=e.length>1?e.slice(1):null;if(i)try{return void console.error("BUGSEE: "+t+" \r\n"+JSON.encode(i))}catch(e){}}console.error.apply(this,arguments)},bizagi.util.deepExtend=function(e){e=e||{};for(var t=1;t<arguments.length;t++){var i=arguments[t];if(i)for(var r in i)i.hasOwnProperty(r)&&("object"===_typeof(i[r])?i[r]instanceof Array==1?e[r]=i[r].slice(0):e[r]=deepExtend(e[r],i[r]):e[r]=i[r])}return e},bizagi.util.extend=function(e){e=e||{};for(var t=1;t<arguments.length;t++)if(arguments[t])for(var i in arguments[t])arguments[t].hasOwnProperty(i)&&(e[i]=arguments[t][i]);return e},bizagi.util.getColumnType=function(e){if(void 0===e)return"default";var t=e.replace("column","").toLowerCase();return bizagi.util.normalizeType(t)},bizagi.util.mapAlignClassName=function(e){return{rigth:"flex-end",left:"flex-start",justify:"flex-start",default:"center",center:"center"}[e]||"center"},bizagi.util.isMobileErrorTracesEnabled=function(){var e=!1,t=bizagi.util.getMobileFeatures();return t&&t.mobileErrorTraces&&!0===t.mobileErrorTraces.enabled&&(e=!0),e&&bizagi.util.isTabletDevice()},bizagi.util.isMobileSmartInboxEnabled=function(){var e=!1,t=bizagi.util.getMobileFeatures();return t&&t.mobileSmartInbox&&!0===t.mobileSmartInbox.enabled&&(e=!0),e&&bizagi.util.isTabletDevice()},bizagi.util.isMobileLiveFiltersEnabled=function(){var e=!1,t=bizagi.util.getMobileFeatures();return t&&t.mobileLiveFilters&&!0===t.mobileLiveFilters.enabled&&(e=!0),e&&bizagi.util.isTabletDevice()},bizagi.util.getColumnType=function(e){if(void 0===e)return"default";var t=e.replace("column","").toLowerCase();return bizagi.util.normalizeType(t)},$.any=function(e,t){if(void 0===e||null==e||0==e.length)return!1;var i=$.grep(e,t);return null!=i&&void 0!==i&&i.length>0},$.first=function(e,t){if(void 0===e||null==e||0==e.length)return null;var i=$.grep(e,t);return null==i||void 0===i||0==i.length?null:i[0]},$.groupBy=function(e,t){if(void 0===e||null==e||0==e.length)return{};var i={};return $.each(e,(function(e,r){void 0!==r&&(void 0===i[r[t]]&&(i[r[t]]=[]),i[r[t]].push(r))})),i},bizagi.util.downloadBlobFile=function(e,t){if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e,t);else{var i=window.URL.createObjectURL(e),r=document.createElement("a");r.style="display: none",document.body.appendChild(r),r.href=i,r.download=t,r.click(),window.URL.revokeObjectURL(i),r.parentNode.removeChild(r)}},bizagi.util.handleJSONResponse=function(e){var t=new $.Deferred;return e&&/application\/json/i.test(e.type)?bizagi.util.blobToText(e).then((function(i){"error"===JSON.parse(i).type?t.reject(i):t.resolve(e)})).fail((function(e){t.reject(e)})):t.resolve(e),t.promise()},bizagi.util.bzValidator=function(e){var t=[],i=[];return{add:function(e,i){return"function"==typeof e?t.push({callback:e,message:i}):console.warn("Callback is not a function"),this},validate:function(r){i=[];try{t&&t.length>0?t.forEach((function(t){var r=t.callback(e);bizagi.util.isBoolean(r)?r||i.push(t.message||"Validation error"):i.push("Callback evaluation is not a function: "+t.message)})):i.push("There are not validators added")}catch(e){console.warn(e)}return r({errors:i}),t=[],this},isValid:function(){return i&&!i.length}}},function(e){function t(t){var i=e.formatCurrency.regions[t];if(i)return i;if(/(\w+)-(\w+)/g.test(t)){var r=t.replace(/(\w+)-(\w+)/g,"$1");return e.formatCurrency.regions[r]}return null}function i(e){if(""===e.symbol)return new RegExp("[^\\d"+e.decimalSymbol+"-]","g");var t=e.symbol.replace("$","\\$").replace(".","\\.");return new RegExp(t+"|[^\\d"+e.decimalSymbol+"-]","g")}e.formatCurrency={},e.formatCurrency.regions=[],e.formatCurrency.regions[""]={symbol:"$",positiveFormat:"%s%n",negativeFormat:"(%s%n)",decimalSymbol:".",digitGroupSymbol:",",groupDigits:!0},e.fn.formatCurrency=function(r,a){1==arguments.length&&"string"!=typeof r&&(a=r,r=!1);var n={name:"formatCurrency",colorize:!1,region:"",global:!0,roundToDecimalPlace:2,eventOnDecimalsEntered:!1};return n=e.extend(n,e.formatCurrency.regions[""]),(a=e.extend(n,a)).region.length>0&&(a=e.extend(a,t(a.region))),a.regex=i(a),this.each((function(){var t=e(this),i="0",n=new RegExp("^(0+|-0+)","g");if((i=t[t.is("input, select, textarea")?"val":"html"]()).search("\\(")>=0&&(i="-"+i),i.match(/[1-9]/g)||(i=i.replace(n,0)),""!==i&&("-"!==i||-1!==a.roundToDecimalPlace)){if(isNaN(i)){if(""===(i=i.replace(a.regex,""))||"-"===i&&-1===a.roundToDecimalPlace)return;"."!=a.decimalSymbol&&(i=i.replace(a.decimalSymbol,".")),isNaN(i)&&(i="0")}var o=String(i).split("."),s=i==Math.abs(i),l=o.length>1,d=l?o[1].toString():"0",u=d;if(i=Math.abs(o[0]),i=isNaN(i)?0:i,a.roundToDecimalPlace>=0&&("2"==(d=(d=parseFloat("1."+d)).toFixed(a.roundToDecimalPlace)).substring(0,1)&&(i=Number(i)+1),d=d.substring(2)),i=String(i),a.groupDigits)for(var c=0;c<Math.floor((i.length-(1+c))/3);c++)i=i.substring(0,i.length-(4*c+3))+a.digitGroupSymbol+i.substring(i.length-(4*c+3));(l&&-1==a.roundToDecimalPlace||a.roundToDecimalPlace>0)&&(i+=a.decimalSymbol+d);var p=(s?a.positiveFormat:a.negativeFormat).replace(/%s/g,a.symbol);p=p.replace(/%n/g,i);var h=e([]);(h=r?e(r):t)[h.is("input, select, textarea")?"val":"html"](p),l&&a.eventOnDecimalsEntered&&u.length>a.roundToDecimalPlace&&h.trigger("decimalsEntered",u),a.colorize&&h.css("color",s?"black":"red")}}))},e.fn.toNumber=function(r){var a=e.extend({name:"toNumber",region:"",global:!0},e.formatCurrency.regions[""]);return(r=jQuery.extend(a,r)).region.length>0&&(r=e.extend(r,t(r.region))),r.regex=i(r),this.each((function(){var t=e(this).is("input, select, textarea")?"val":"html";e(this)[t](e(this)[t]().replace("(","(-").replace(r.regex,""))}))},e.fn.asNumber=function(r){var a=e.extend({name:"asNumber",region:"",parse:!0,parseType:"Float",global:!0},e.formatCurrency.regions[""]);(r=jQuery.extend(a,r)).region.length>0&&(r=e.extend(r,t(r.region))),r.regex=i(r),r.parseType=function(e){switch(e.toLowerCase()){case"int":return"Int";case"float":return"Float";default:throw"invalid parseType"}}(r.parseType);var n=e(this).is("input, select, textarea")?"val":"html",o=e(this)[n]();return o=(o=(o=o||"").replace("(","(-")).replace(r.regex,""),r.parse?(0==o.length&&(o="0"),"."!=r.decimalSymbol&&(o=o.replace(r.decimalSymbol,".")),window["parse"+r.parseType](o)):o}}(jQuery),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.util=void 0!==bizagi.util?bizagi.util:{},bizagi.context=void 0!==bizagi.context?bizagi.context:{},bizagi.util.randomNumber=function(e,t){return e=e||1,t=t||1e7,Math.floor(Math.random()*(t-e+1))+e},bizagi.resolveResult=function(e){var t;return e.done((function(e){t=e})),t},bizagi.util.identicalObjects=function(e,t){if(_typeof(e)!==_typeof(t))return!1;if("function"==typeof e)return e.toString()===t.toString();if(e instanceof Object&&t instanceof Object){if(bizagi.util.countProps(e)!==bizagi.util.countProps(t))return!1;for(k in e)if(!bizagi.util.identicalObjects(e[k],t[k]))return!1;return!0}return e===t},bizagi.util.countProps=function(e){var t=0;for(k in e)e.hasOwnProperty(k)&&t++;return t},bizagi.util.encodeHtml=function(e){return null==e?"":"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},bizagi.util.encodeXpath=function(e){return bizagi.util.isEmpty(e)?"":e.replaceAll(".","_").replaceAll("=","_").replaceAll("[","_").replaceAll("]","_")},bizagi.clone=function(e){return JSON.parse(JSON.encode(e))},Math.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},bizagi.util.isMapEmpty=function(e){if(1==e.length&&0==e[0].length)return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},bizagi.util.scrollTop=function(e){if(e&&e[0])for(;"HTML"!==e[0].tagName&&"scroll"!=e.css("overflow-y")&&"auto"!=e.css("overflow-y")&&e.parent().length>0;)e=e.parent();return e},bizagi.util.getQueryString=function(e){for(var t={},i=((e=e||window.location.href).indexOf("?")>0?e.substring(e.indexOf("?")+1):"").split("&"),r=0;r<i.length;r++){var a=i[r].indexOf("=");if(-1!=a){var n=i[r].substring(0,a),o=i[r].substring(a+1);t[n]=unescape(o)}}return t};var scenarioInfo=function(e){return this.getFileScenario=function(e){var t=((e=e||{}).scenario.split(".")||[])[0];return BIZAGI_SMARTPHONE_PATH+"scenarios/"+t+"/"+e.scenario+".js"},{getFileScenario:this.getFileScenario}};function printf(e){var t,i=Array.prototype.slice.call(arguments,1);return e.replace(/(%[disv])/g,(function(e,r){if(void 0!==(t=i.shift()))switch(r.charCodeAt(1)){case 100:return+t;case 105:return Math.round(+t);case 115:return String(t);case 118:return t}return r}))}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}bizagi.util.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},bizagi.util.isScrolledIntoView=function(e,t){if(null==e)return!1;var i=(t=t||$(window)).scrollTop(),r=$(e).offset().top;return r+$(e).height()<=i+$(t).height()&&r>=i},bizagi.util.isEventSupported=function(e,t){var i,r=!("onblur"in document.documentElement);return!!e&&(t&&"string"!=typeof t||(t=document.createElement(t||"div")),!(i=(e="on"+e)in t)&&r&&(t.setAttribute||(t=document.createElement("div")),t.setAttribute&&t.removeAttribute&&(t.setAttribute(e,""),i="function"==typeof t[e],void 0!==t[e]&&(t[e]=void 0),t.removeAttribute(e))),i)},bizagi.util.isAndroid=function(){return navigator.userAgent.toLowerCase().indexOf("android")>-1},function(e){e.fn.startLoading=function(e){bizagi.util.smartphone.startLoading()},e.fn.endLoading=function(){bizagi.util.smartphone.stopLoading()}}(jQuery),bizagi.util.dispose=function(e){for(key in e)"object"==_typeof(e[key])&&delete e[key],"function"==typeof e[key]&&(e[key]=null,delete e[key])},bizagi.util.stripslashes=function(e){return e.replace(/\\'/g,"'").replace(/\"/g,'"').replace(/\\\\/g,"\\").replace(/\\0/g,"\0")},bizagi.util.md5=function(e){var t=t||function(e,t){var i={},r=i.lib={},a=function(){},n=r.Base={extend:function(e){a.prototype=this;var t=new a;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var a=0;a<e;a++)t[r+a>>>2]|=(i[a>>>2]>>>24-a%4*8&255)<<24-(r+a)%4*8;else if(65535<i.length)for(a=0;a<e;a+=4)t[r+a>>>2]=i[a>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i=[],r=0;r<t;r+=4)i.push(4294967296*e.random()|0);return new o.init(i,t)}}),s=i.enc={},l=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],r=0;r<e;r++){var a=t[r>>>2]>>>24-r%4*8&255;i.push((a>>>4).toString(16)),i.push((15&a).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r+=2)i[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(i,t/2)}},d=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],r=0;r<e;r++)i.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r++)i[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(i,t)}},u=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,r=i.words,a=i.sigBytes,n=this.blockSize,s=a/(4*n);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*n,a=e.min(4*t,a),t){for(var l=0;l<t;l+=n)this._doProcessBlock(r,l);l=r.splice(0,t),i.sigBytes-=a}return new o.init(l,a)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=c.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new p.HMAC.init(e,i).finalize(t)}}});var p=i.algo={};return i}(Math);return function(e){function i(e,t,i,r,a,n,o){return((e=e+(t&i|~t&r)+a+o)<<n|e>>>32-n)+t}function r(e,t,i,r,a,n,o){return((e=e+(t&r|i&~r)+a+o)<<n|e>>>32-n)+t}function a(e,t,i,r,a,n,o){return((e=e+(t^i^r)+a+o)<<n|e>>>32-n)+t}function n(e,t,i,r,a,n,o){return((e=e+(i^(t|~r))+a+o)<<n|e>>>32-n)+t}for(var o=t,s=(d=o.lib).WordArray,l=d.Hasher,d=o.algo,u=[],c=0;64>c;c++)u[c]=4294967296*e.abs(e.sin(c+1))|0;d=d.MD5=l.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var o=0;16>o;o++){var s=e[l=t+o];e[l]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}o=this._hash.words;var l=e[t+0],d=(s=e[t+1],e[t+2]),c=e[t+3],p=e[t+4],h=e[t+5],g=e[t+6],m=e[t+7],f=e[t+8],b=e[t+9],v=e[t+10],y=e[t+11],C=e[t+12],x=e[t+13],z=e[t+14],E=e[t+15],T=i(T=o[0],A=o[1],w=o[2],R=o[3],l,7,u[0]),R=i(R,T,A,w,s,12,u[1]),w=i(w,R,T,A,d,17,u[2]),A=i(A,w,R,T,c,22,u[3]);T=i(T,A,w,R,p,7,u[4]),R=i(R,T,A,w,h,12,u[5]),w=i(w,R,T,A,g,17,u[6]),A=i(A,w,R,T,m,22,u[7]),T=i(T,A,w,R,f,7,u[8]),R=i(R,T,A,w,b,12,u[9]),w=i(w,R,T,A,v,17,u[10]),A=i(A,w,R,T,y,22,u[11]),T=i(T,A,w,R,C,7,u[12]),R=i(R,T,A,w,x,12,u[13]),w=i(w,R,T,A,z,17,u[14]),T=r(T,A=i(A,w,R,T,E,22,u[15]),w,R,s,5,u[16]),R=r(R,T,A,w,g,9,u[17]),w=r(w,R,T,A,y,14,u[18]),A=r(A,w,R,T,l,20,u[19]),T=r(T,A,w,R,h,5,u[20]),R=r(R,T,A,w,v,9,u[21]),w=r(w,R,T,A,E,14,u[22]),A=r(A,w,R,T,p,20,u[23]),T=r(T,A,w,R,b,5,u[24]),R=r(R,T,A,w,z,9,u[25]),w=r(w,R,T,A,c,14,u[26]),A=r(A,w,R,T,f,20,u[27]),T=r(T,A,w,R,x,5,u[28]),R=r(R,T,A,w,d,9,u[29]),w=r(w,R,T,A,m,14,u[30]),T=a(T,A=r(A,w,R,T,C,20,u[31]),w,R,h,4,u[32]),R=a(R,T,A,w,f,11,u[33]),w=a(w,R,T,A,y,16,u[34]),A=a(A,w,R,T,z,23,u[35]),T=a(T,A,w,R,s,4,u[36]),R=a(R,T,A,w,p,11,u[37]),w=a(w,R,T,A,m,16,u[38]),A=a(A,w,R,T,v,23,u[39]),T=a(T,A,w,R,x,4,u[40]),R=a(R,T,A,w,l,11,u[41]),w=a(w,R,T,A,c,16,u[42]),A=a(A,w,R,T,g,23,u[43]),T=a(T,A,w,R,b,4,u[44]),R=a(R,T,A,w,C,11,u[45]),w=a(w,R,T,A,E,16,u[46]),T=n(T,A=a(A,w,R,T,d,23,u[47]),w,R,l,6,u[48]),R=n(R,T,A,w,m,10,u[49]),w=n(w,R,T,A,z,15,u[50]),A=n(A,w,R,T,h,21,u[51]),T=n(T,A,w,R,C,6,u[52]),R=n(R,T,A,w,c,10,u[53]),w=n(w,R,T,A,v,15,u[54]),A=n(A,w,R,T,s,21,u[55]),T=n(T,A,w,R,f,6,u[56]),R=n(R,T,A,w,E,10,u[57]),w=n(w,R,T,A,g,15,u[58]),A=n(A,w,R,T,x,21,u[59]),T=n(T,A,w,R,p,6,u[60]),R=n(R,T,A,w,y,10,u[61]),w=n(w,R,T,A,d,15,u[62]),A=n(A,w,R,T,b,21,u[63]);o[0]=o[0]+T|0,o[1]=o[1]+A|0,o[2]=o[2]+w|0,o[3]=o[3]+R|0},_doFinalize:function(){var t=this._data,i=t.words,r=8*this._nDataBytes,a=8*t.sigBytes;i[a>>>5]|=128<<24-a%32;var n=e.floor(r/4294967296);for(i[15+(a+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),i[14+(a+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(i.length+1),this._process(),i=(t=this._hash).words,r=0;4>r;r++)a=i[r],i[r]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8);return t},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=l._createHelper(d),o.HmacMD5=l._createHmacHelper(d)}(Math),t.MD5(e).toString()},bizagi.util.b64toBlob=function(e,t,i){t=t||"",i=i||512;for(var r=atob(e),a=[],n=0;n<r.length;n+=i){for(var o=r.slice(n,n+i),s=new Array(o.length),l=0;l<o.length;l++)s[l]=o.charCodeAt(l);var d=new Uint8Array(s);a.push(d)}return new Blob(a,{type:t})},bizagi.util.arrayEach=function(e,t){var i;if(e)if("[object Array]"===Object.prototype.toString.apply(e)&&"[object Function]"===Object.prototype.toString.apply(t)){for(i in e)if(e.hasOwnProperty(i)&&!1===t.call(e[i],i,e[i]))return}else $.each(e,t)},bizagi.util.isHTMLValidText=function(e){return new RegExp(/<(.|\n)*?>/g).test(e)},bizagi.util.hasScroll=function(e,t){e.length&&(e=e[0]);var i=!!e[t="vertical"===t?"scrollTop":"scrollLeft"];return i||(e[t]=1,i=!!e[t],e[t]=0),i},bizagi.util.b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))},bizagi.util.getStandardNotation=function(e,t){t=t||".";var i="",r=!1,a=!1;e=(e.length>0?e.toString().toLowerCase():"").replace(/ /g,"");for(var n=0;n<e.length;n++)("+"!==e[n]&&"-"!==e[n]||0!==n&&"e"!=e[n-1])&&isNaN(Number(e[n]))?e[n]!==t||r?"e"!==e[n]||a||(i+=e[n],a=!0):(i+=e[n],r=!0):i+=e[n];return i},bizagi.util.scientificNotationFormat=function(e,t,i,r,a){t=t||".",e=bizagi.util.getStandardNotation(e,t),i=i>0?i:38,r=r>0?r:-125,a=a>0?a:125;var n=new RegExp("[0-9]+("+t+"[0-9]+)?(e[+-]?[0-9]+)?"),o=e.match(n),s=0,l="-"===e[0]?e[0]:"",d=0;if(e=e.replace(l,""),o&&o[0]&&o[2]){var u=o[0]?o[0].replace(o[2],"").split(t):"",c="",p="";return u[0]=u[0].replace(/^0+/g,""),u[0].length>1?(d=(c=u[0].slice(1)).length,p=u[0][0]||"",c=c.concat(o[1]||"")):1===u[0].length?(p=u[0][0]||"",c=c.concat(u[1]||"")):(d=u[1].length,u[1]=u[1].replace(/^0+/g,""),d=u[1].length-1-d,p=u[1][0],c=u[1].slice(1)),(c=c.replace(t,"").replace(/0+$/g,"")).length>=i&&(c=c.slice(0,i-1)),l+p+(c?t+c:"")+"e"+((s=(s=Number(o[2].replace("e",""))+d)>a?a:s<r?r:s)>0?"+"+s:s)}if(e){d=e.indexOf(t);var h=0,g=e.length-1;e=e.replace(t,"");for(var m=h;!f;)"0"!==e[m]&&e[m]!==t?(f=!0,h=m):m++;for(var f=!1,b=g;!f;)"0"!==e[b]&&e[b]!==t?(f=!0,g=b+1):b--;if(g=g>i+h?i+h:g,-1!==d){f=!1;return s=d-(h+1),(c=e.slice(h,g)).length>0&&!isNaN(Number(c[0]))?l+c[0]+(c.length>1?t+c.slice(1):"")+"e"+(s>0?"+"+s:s):"0"}var v=e.slice(h,h+1),y=e.slice(h+1,e.length);return s=y.length,(y=y.replace(/0+$/g,"")).length>i&&(y=e.slice(h+1,i+h)),Number(v)?l+v+(y.length>0?t+y:"")+"e"+(s>0?"+"+s:s):"0"}return""},bizagi.util.isString=function(e){return"[object String]"===Object.prototype.toString.apply(e)},bizagi.util.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)},function(e){var t=(bizagi.util.isEventSupported("paste")?"paste":"input")+".mask";e.widget("ui.mask",{_init:function(){var t=this.options,i=this;e.extend(this,{caret:function(t,r){return e.ui.mask.caret(i.element,t,r)}}),t.mask&&t.mask.length&&(t.placeholder&&t.placeholder.length||(t.placeholder="_"),this._prepareBuffer(),this._bindEvents(),this._checkVal(this.element.val().length&&t.allowPartials))},destroy:function(){this.element.unbind(".mask").removeData("mask")},value:function(){this.element;var t=this,i=e.map(t.buffer,(function(e,i){return t.tests[i]?e:null})).join(""),r=new RegExp("\\"+this.options.placeholder,"gi");return i.replace(r,"")},formatted:function(){var e=new RegExp("\\"+this.options.placeholder,"gi");return this.element.val().replace(e,"")},apply:function(){this.element.trigger("apply.mask")},_setData:function(t,i){e.widget.prototype._setData.apply(this,arguments);var r=this.options;switch(t){case"mask":if(!r.mask||!r.mask.length){this.element.unbind(".mask");break}case"placeholder":r.placeholder&&r.placeholder.length||(r.placeholder="_"),this.element.val(""),this._prepareBuffer(),!this.eventsBound&&this._bindEvents()}},_prepareBuffer:function(){this._escapeMask();var t=this,i=this.element,r=this.options,a=r.mask,n=e.ui.mask.definitions,o=[],s=a.length,l=null;a.length;i.is(":input")||(i.val=i.html),e.each(a.split(""),(function(e,t){"?"==t?(s=e):n[t]?(o.push(new RegExp(n[t])),null==l&&(l=o.length-1)):o.push(null)})),e.extend(this,{buffer:e.map(a.split(""),(function(e,t){if("?"!=e)return n[e]?r.placeholder:e})),tests:o,firstNonMaskPos:l,partialPosition:s}),this.buffer=e.map(this.buffer,(function(e,i){return"\t"==e?t.maskEscaped[i]:e})),this.options.mask=a=this.maskEscaped},_bindEvents:function(){var i=this,r=this.element,a=!1,n=r.val();r.attr("readonly")||(r.bind("focus.mask",(function(){n=r.val();var e=i._checkVal();i._writeBuffer(),setTimeout((function(){e==i.options.mask.length?i.caret(0,e):i.caret(e)}),0)})).bind("blur.mask",(function(){i._checkVal(),r.val()!=n&&r.change()})).bind("apply.mask",(function(){n=r.val();i._checkVal();i._writeBuffer()})).bind("keydown.mask",(function(t){t=t||window.event;var o=i.caret(),s=t.keyCode,l=e.ui.keyCode;return a=s<l.SHIFT||s>l.SHIFT&&s<l.SPACE||s>l.SPACE&&s<41,o.begin-o.end==0||a&&s!=l.BACKSPACE&&s!=l.DELETE||i._clearBuffer(o.begin,o.end),s==l.BACKSPACE||s==l.DELETE?(i._shiftL(o.begin+(s==l.DELETE||s==l.BACKSPACE&&o.begin!=o.end?0:-1),Math.abs(o.begin-o.end)),!1):s==l.ESCAPE?(r.val(n),i.caret(0,i._checkVal()),!1):void 0})).bind("keypress.mask",(function(t){var n=(t=t||window.event).charCode||t.keyCode||t.which,o=e.ui.keyCode,s=i.options.mask.length;if(a)return a=!1,t.keyCode!=o.BACKSPACE&&null;var l=i.caret();if(t.ctrlKey||t.altKey||t.metaKey)return!0;if(n>=o.SPACE&&n<=125||n>186){var d=i._seekNext(l.begin-1);if(d<s){var u=String.fromCharCode(n);if(i.tests[d]&&i.tests[d].test(u)){i._shiftR(d),i.buffer[d]=u,i._writeBuffer();var c=i._seekNext(d);i.caret(c),i.options.completed&&c==s&&i.options.completed.call(r)}}}return!1})).bind(t,(function(){setTimeout((function(){i.caret(i._checkVal(!0))}),0)})),this.eventsBound=!0)},_writeBuffer:function(){return this.element.val(this.buffer.join("")).val()},_clearBuffer:function(e,t){for(var i=this.options.mask.length,r=e;r<t&&r<i;r++)this.tests[r]&&(this.buffer[r]=this.options.placeholder)},_seekNext:function(e){for(var t=this.options.mask.length;++e<=t&&!this.tests[e];);return e},_shiftR:function(e){for(var t=this.options.mask.length,i=e,r=this.options.placeholder;i<t;i++)if(this.tests[i]){var a=this._seekNext(i),n=this.buffer[i];if(this.buffer[i]=r,!(a<t&&this.tests[a].test(n)))break;r=n}},_shiftL:function(e,t){for(;!this.tests[e]&&--e>=0;);for(var i=e,r=this.options.mask.length,a=this.options.placeholder,n=e;n<r&&(n>=0||t>1);n++)if(this.tests[n]){this.buffer[n]=a;var o=this._seekNext(n);if(o<r&&this.tests[n].test(this.buffer[o]))for(this.buffer[e]=this.buffer[o],this.buffer[o]=a,e++;!this.tests[e];)e++}this._writeBuffer(),this.caret(Math.max(this.firstNonMaskPos,i))},_checkVal:function(e){for(var t=this.element,i=t.val(),r=this.options.mask.length,a=-1,n=0,o=0;n<r;n++)if(this.tests[n]){for(this.buffer[n]=this.options.placeholder;o++<i.length;){var s=i.charAt(o-1);if(this.tests[n].test(s)){this.buffer[n]=s,a=n;break}}if(o>i.length)break}else this.buffer[n]==i[o]&&n!=this.partialPosition&&(o++,a=n);return!e&&a+1<this.partialPosition?this.options.allowPartials&&this.value().length?t.is(":input")||this._writeBuffer():(t.val(""),this._clearBuffer(0,r)):(e||a+1>=this.partialPosition)&&(this._writeBuffer(),e||t.val(t.val().substring(0,a+1))),this.partialPosition?n:this.firstNonMaskPos},_escapeMask:function(){for(var e=this.options.mask,t=[],i=[],r=0;r<e.length;r++){var a,n=e[r]||e.charAt(r);"\\"==n&&"\\"!=e[r-1]||("\\"==e[r-1]?(a="\t",i[t.length]=n):a=n,t[t.length]=a)}this.options.mask=t.join("");for(r=0;r<t.length;r++)void 0!==i[r]&&(t[r]=i[r]);this.maskEscaped=t.join("")}}),e.extend(e.ui.mask,{version:"@VERSION",getter:"value formatted",defaults:{mask:"",placeholder:"_",completed:null,allowPartials:!1},definitions:{"#":"[\\d]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},caret:function(e,t,i){var r=e[0];if("number"==typeof t){if(i="number"==typeof i?i:t,r.setSelectionRange)r.focus(),r.setSelectionRange(t,i);else if(r.createTextRange){(a=r.createTextRange()).collapse(!0),a.moveEnd("character",i),a.moveStart("character",t),a.select()}return e}if(r.setSelectionRange)t=r.selectionStart,i=r.selectionEnd;else if(document.selection&&document.selection.createRange){var a;i=(t=0-(a=document.selection.createRange()).duplicate().moveStart("character",-1e5))+a.text.length}return{begin:t,end:i}}})}(jQuery),jQuery.fn.numeric=function(e,t){return e=e||".",t="function"==typeof t?t:function(){},this.keypress((function(t){var i=t.charCode?t.charCode:t.keyCode?t.keyCode:0;if(13==i&&"input"==this.nodeName.toLowerCase())return!0;if(13==i)return!1;var r=!1;if(t.ctrlKey&&97==i||t.ctrlKey&&65==i)return!0;if(t.ctrlKey&&120==i||t.ctrlKey&&88==i)return!0;if(t.ctrlKey&&99==i||t.ctrlKey&&67==i)return!0;if(t.ctrlKey&&122==i||t.ctrlKey&&90==i)return!0;if(t.ctrlKey&&118==i||t.ctrlKey&&86==i||t.shiftKey&&45==i)return!0;if(i<48||i>57){if(45==i&&0==this.value.length)return!0;i==e.charCodeAt(0)&&-1!=this.value.indexOf(e)&&(r=!1),8!=i&&9!=i&&13!=i&&35!=i&&36!=i&&37!=i&&39!=i&&46!=i?r=!1:void 0!==t.charCode&&(t.keyCode==t.which&&0!=t.which?r=!0:0!=t.keyCode&&0==t.charCode&&0==t.which&&(r=!0)),i==e.charCodeAt(0)&&-1==this.value.indexOf(e)&&(r=!0)}else r=!0;return r})).blur((function(){var i=jQuery(this).val();""!=i&&(new RegExp("^\\d+$|\\d*"+e+"\\d+").exec(i)||t.apply(this))})),this},jQuery.fn.numericSN=function(e,t){e=e||".",t=t||"e";return callback="function"==typeof callback?callback:function(){},this.keypress((function(i){var r=i.charCode?i.charCode:i.keyCode?i.keyCode:0;if(13==r&&"input"==this.nodeName.toLowerCase())return!0;if(13==r)return!1;var a=!1;return!!(i.ctrlKey&&97==r||i.ctrlKey&&65==r)||(!!(i.ctrlKey&&120==r||i.ctrlKey&&88==r)||(!!(i.ctrlKey&&99==r||i.ctrlKey&&67==r)||(!!(i.ctrlKey&&122==r||i.ctrlKey&&90==r)||(!!(i.ctrlKey&&118==r||i.ctrlKey&&86==r||i.shiftKey&&45==r)||(r<48||r>57?(r==e.charCodeAt(0)&&-1!=this.value.indexOf(e)&&(a=!1),r==t.charCodeAt(0)&&-1!=this.value.indexOf(t)&&(a=!1),8!=r&&9!=r&&13!=r&&35!=r&&36!=r&&37!=r&&39!=r?a=!1:void 0!==i.charCode&&(i.keyCode==i.which&&0!=i.which?a=!0:0!=i.keyCode&&0==i.charCode&&0==i.which&&(a=!0)),r==t.charCodeAt(0)&&-1==this.value.indexOf(t)&&(a=!0),r==e.charCodeAt(0)&&-1==this.value.indexOf(e)&&(a=!0),r!="-".charCodeAt(0)&&r!="+".charCodeAt(0)||(a=!0)):a=!0,a)))))})).blur((function(){var t=jQuery(this).val();""!=t&&(new RegExp("^\\d+$|\\d*"+e+"\\d+").exec(t)||callback.apply(this))})),this},function(e){function t(t,i){function m(t){l=e("li.dw-v",t).eq(0).index(),d=e("li.dw-v",t).eq(-1).index(),s=$.height,u=I}function b(){I.temp=k&&null!==I.val&&I.val!=t.val()||null===I.values?$.parseValue(t.val()?t.val():"",I):I.values.slice(0),I.setValue(!0)}function C(t,i,r,a,n){$.validate.call(D,_,r),e(".dww ul",_).each((function(a){var o=e(this),s=(o=(l=e('li[data-val="'+I.temp[a]+'"]',o)).index(),l),l=o;if(!s.hasClass("dw-v")){for(var d=s,u=0,c=0;d.prev().length&&!d.hasClass("dw-v");)d=d.prev(),u++;for(;s.next().length&&!s.hasClass("dw-v");)s=s.next(),c++;c<u&&c&&1==!n||!u||!d.hasClass("dw-v")||1==n?l+=c:(s=d,l-=u),I.temp[a]=s.data("val")}o==l&&a!=r&&void 0!==r||I.scroll(e(this),l,a==r?t:0,i,a)})),I.change(a)}function E(){var t,i,r=0,a=0,n=e(window).width(),o=e(window).height(),s=e(window).scrollTop(),l=e(".dwo",_),d=e(".dw",_);e(".dwc",_).each((function(){t=e(this).outerWidth(!0),r+=t,a=t>a?t:a})),t=r>n?a:r,d.width(t),t=d.outerWidth(),i=d.outerHeight(),d.css({left:(n-t)/2,top:s+(o-i)/2}),l.height(0).height(function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}())}function R(e){var t=+e.data("pos")+1;n(e,t>d?l:t,1)}function F(e){var t=+e.data("pos")-1;n(e,t<l?d:t,2)}var S,P,_,I=this,D=t,$=(t=e(D),e.extend({},w)),O={},N={},k=t.is("input"),M=!1;I.enable=function(){$.disabled=!1,k&&t.prop("disabled",!1)},I.disable=function(){$.disabled=!0,k&&t.prop("disabled",!0)},I.scroll=function(e,t,i,r,a){var n=(P-t)*$.height;if(e.attr("style",(i?z+"-transition:all "+i.toFixed(1)+"s ease-out;":"")+(x?z+"-transform:translate3d(0,"+n+"px,0);":"top:"+n+"px;")),i){var o=0;clearInterval(O[a]),O[a]=setInterval((function(){o+=.1,e.data("pos",Math.round((t-r)*Math.sin(o/i*(Math.PI/2))+r)),o>=i&&(clearInterval(O[a]),e.data("pos",t))}),100),clearTimeout(N[a]),N[a]=setTimeout((function(){"mixed"==$.mode&&!e.hasClass("dwa")&&e.closest(".dwwl").find(".dwwb").fadeIn("fast")}),1e3*i)}else e.data("pos",t)},I.setValue=function(e,i,r){var a=$.formatResult(I.temp);I.val=a,I.values=I.temp.slice(0),M&&e&&C(r),i&&k&&t.val(a).trigger("change")},I.validate=function(e,t,i,r){C(e,t,i,!0,r)},I.change=function(t){var i=$.formatResult(I.temp);"inline"==$.display?I.setValue(!1,t):e(".dwv",_).html(function(e){var t=$.headerText;return t?"function"==typeof t?t.call(D,e):t.replace(/{value}/i,e):""}(i)),t&&$.onChange.call(D,i,I)},I.hide=function(){if(!1===$.onClose.call(D,I.val,I))return!1;e(".dwtd").prop("disabled",!1).removeClass("dwtd"),t.blur(),_&&_.remove(),M=!1,e(window).unbind(".dw")},I.show=function(){if($.disabled||M)return!1;var i=$.height,a=$.rows*i;b();for(var s='<div class="'+$.theme+'">'+("inline"==$.display?'<div class="dw dwbg dwi"><div class="dwwr">':'<div class="dwo"></div><div class="dw dwbg"><div class="dwwr">'+($.headerText?'<div class="dwv"></div>':"")),l=0;l<$.wheels.length;l++){var d;s=s+'<div class="dwc'+("scroller"!=$.mode?" dwpm":" dwsc")+($.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>';for(d in $.wheels[l]){var u;s=s+'<td><div class="dwwl dwrc">'+("scroller"!=$.mode?'<div class="dwwb dwwbp" style="height:'+i+"px;line-height:"+i+'px;"><span>+</span></div><div class="dwwb dwwbm" style="height:'+i+"px;line-height:"+i+'px;"><span>&ndash;</span></div>':"")+'<div class="dwl">'+d+'</div><div class="dww dwrc" style="height:'+a+"px;min-width:"+$.width+'px;"><ul>';for(u in $.wheels[l][d])s+='<li class="dw-v" data-val="'+u+'" style="height:'+i+"px;line-height:"+i+'px;">'+$.wheels[l][d][u]+"</li>";s+='</ul><div class="dwwo"></div></div><div class="dwwol"></div></div></td>'}s+="</tr></table></div></div>"}s+=("inline"!=$.display?'<div class="dwbc"><span class="dwbw dwb-s"><a href="#" class="dwb">'+$.setText+'</a></span><span class="dwbw dwb-c"><a href="#" class="dwb">'+$.cancelText+"</a></span></div>":'<div class="dwcc"></div>')+"</div></div></div>",_=e(s),C(),"inline"!=$.display?_.appendTo("body"):t.is("div")?t.html(_):_.insertAfter(t),M=!0,S.init(_,I),"inline"!=$.display&&(e(".dwb-s a",_).click((function(){return I.setValue(!1,!0),I.hide(),$.onSelect.call(D,I.val,I),!1})),e(".dwb-c a",_).click((function(){return I.hide(),$.onCancel.call(D,I.val,I),!1})),e("input,select").each((function(){e(this).prop("disabled")||e(this).addClass("dwtd")})),e("input,select").prop("disabled",!0),E(),e(window).bind("resize.dw",E)),_.delegate(".dwwl","DOMMouseScroll mousewheel",(function(t){if(!$.readonly){t.preventDefault();t=(t=t.originalEvent).wheelDelta?t.wheelDelta/120:t.detail?-t.detail/3:0;var i=e("ul",this),r=+i.data("pos");r=Math.round(r-t);m(i),n(i,r,t<0?1:2)}})).delegate(".dwb, .dwwb",T,(function(){e(this).addClass("dwb-a")})).delegate(".dwwb",T,(function(t){if(!$.readonly){t.preventDefault(),t.stopPropagation();var i=e(this).closest(".dwwl").find("ul");func=e(this).hasClass("dwwbp")?R:F,m(i),clearInterval(o),o=setInterval((function(){func(i)}),$.delay),func(i)}})).delegate(".dwwl",T,(function(t){v||"clickpick"==$.mode||$.readonly||(t.preventDefault(),v=!0,y=e("ul",this).addClass("dwa"),"mixed"==$.mode&&e(".dwwb",this).fadeOut("fast"),g=+y.data("pos"),m(y),c=r(t),h=new Date,p=c,I.scroll(y,g))})),$.onShow.call(D,_,I)},I.init=function(i){S=e.extend({defaults:{},init:f},e.scroller.themes[i.theme?i.theme:$.theme]),e.extend($,S.defaults,i),I.settings=$,P=Math.floor($.rows/2);var r=e.scroller.presets[$.preset];t.unbind(".dw"),r&&(r=r.call(D,I),e.extend($,r,i),e.extend(A,r.methods)),void 0!==t.data("dwro")&&(D.readOnly=a(t.data("dwro"))),M&&I.hide(),"inline"==$.display?I.show():(b(),k&&$.showOnFocus&&(t.data("dwro",D.readOnly),D.readOnly=!0,t.bind("focus.dw",I.show)))},I.values=null,I.val=null,I.temp=null,I.init(i)}function i(e){for(var t in e)if(void 0!==C[e[t]])return!0;return!1}function r(e){return E?e.originalEvent?e.originalEvent.changedTouches[0].pageY:e.changedTouches[0].pageY:e.pageY}function a(e){return!0===e||"true"==e}function n(t,i,r,a,n){var o=t.closest(".dwwr").find("ul").index(t);i=(i=i>d?d:i)<l?l:i,t=e("li",t).eq(i);u.temp[o]=t.data("val"),u.validate(a?i==n?.1:Math.abs(.1*(i-n)):0,n,o,r)}var o,s,l,d,u,c,p,h,g,m={},f=function(){},b=(new Date).getTime(),v=!1,y=null,C=document.createElement(C).style,x=i(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"])&&"webkitPerspective"in document.documentElement.style,z=function(){var e,t=["Webkit","Moz","O","ms"];for(e in t)if(i([t[e]+"Transform"]))return"-"+t[e].toLowerCase();return""}(),E="ontouchstart"in window,T=E?"touchstart":"mousedown",R=E?"touchend":"mouseup",w={width:70,height:40,rows:3,delay:300,disabled:!1,readonly:!1,showOnFocus:!0,showLabel:!0,wheels:[],theme:"",headerText:"{value}",display:"modal",mode:"scroller",preset:"",setText:"Set",cancelText:"Cancel",onShow:f,onClose:f,onSelect:f,onCancel:f,onChange:f,formatResult:function(e){for(var t="",i=0;i<e.length;i++)t+=(0<i?" ":"")+e[i];return t},parseValue:function(e,t){for(var i=t.settings.wheels,r=(e=e.split(" "),[]),a=0,n=0;n<i.length;n++)for(var o in i[n]){if(void 0!==i[n][o][e[a]])r.push(e[a]);else for(var s in i[n][o]){r.push(s);break}a++}return r},validate:f},A={init:function(e){return void 0===e&&(e={}),this.each((function(){this.id||(b+=1,this.id="scoller"+b),m[this.id]=new t(this,e)}))},enable:function(){return this.each((function(){var e=m[this.id];e&&e.enable()}))},disable:function(){return this.each((function(){var e=m[this.id];e&&e.disable()}))},isDisabled:function(){var e=m[this[0].id];if(e)return e.settings.disabled},option:function(e,t){return this.each((function(){var i=m[this.id];if(i){var r={};"object"===_typeof(e)?r=e:r[e]=t,i.init(r)}}))},setValue:function(e,t,i){return this.each((function(){var r=m[this.id];r&&(r.temp=e,r.setValue(!0,t,i))}))},getInst:function(){return m[this[0].id]},getValue:function(){var e=m[this[0].id];if(e)return e.values},show:function(){var e=m[this[0].id];if(e)return e.show()},hide:function(){return this.each((function(){var e=m[this.id];e&&e.hide()}))},destroy:function(){return this.each((function(){var t=m[this.id];t&&(t.hide(),e(this).unbind(".dw"),delete m[this.id],e(this).is("input")&&(this.readOnly=a(e(this).data("dwro"))))}))}};e(document).bind(E?"touchmove":"mousemove",(function(e){v&&(e.preventDefault(),p=r(e),e=(e=(e=g+(c-p)/s)>d+1?d+1:e)<l-1?l-1:e,u.scroll(y,e))})),e(document).bind(R,(function(t){if(v){t.preventDefault(),y.removeClass("dwa");var i=new Date-h;t=(t=(t=g+(c-p)/s)>d+1?d+1:t)<l-1?l-1:t;300>i?(i=(i=(p-c)/i)*i/.0012,0>p-c&&(i=-i)):i=p-c,n(y,Math.round(g-i/s),0,!0,Math.round(t)),v=!1,y=null}clearInterval(o),e(".dwb-a").removeClass("dwb-a")})),e.fn.scroller=function(t){return A[t]?A[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==_typeof(t)&&t?void e.error("Unknown method"):A.init.apply(this,arguments)},e.scroller={setDefaults:function(t){e.extend(w,t)},presets:{},themes:{}}}(jQuery),function(e){var t={dateFormat:"mm/dd/yy",dateOrder:"mmddy",timeWheels:"hhiiA",timeFormat:"hh:ii A",startYear:(i=new Date).getFullYear()-100,endYear:i.getFullYear()+1,monthNames:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),monthNamesShort:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),dayNames:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),dayNamesShort:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",stepHour:1,stepMinute:1,stepSecond:1,separator:" "},i=function(i){function r(e,t,i){return void 0!==p[t]?+e[p[t]]:void 0!==i?i:x[h[t]]?x[h[t]]():h[t](x)}function a(e,t){return Math.floor(e/t)*t}function n(e){var t=r(e,"h",0);return new Date(r(e,"y"),r(e,"m"),r(e,"d"),r(e,"ap")?t+12:t,r(e,"i",0),r(e,"s",0))}var o;if((l=e(this)).is("input")){switch(l.attr("type")){case"date":o="yy-mm-dd";break;case"datetime":o="yy-mm-ddTHH:ii:ssZ";break;case"datetime-local":o="yy-mm-ddTHH:ii:ss";break;case"month":o="yy-mm",t.dateOrder="mmyy";break;case"time":o="HH:ii:ss"}var s=l.attr("min"),l=l.attr("max");s&&(t.minDate=e.scroller.parseDate(o,s)),l&&(t.maxDate=e.scroller.parseDate(o,l))}var d=e.extend({},t,i.settings),u=0,c=(s=[],[]),p={},h={y:"getFullYear",m:"getMonth",d:"getDate",h:function(e){return e=e.getHours(),a(e=y&&12<=e?e-12:e,z)},i:function(e){return a(e.getMinutes(),E)},s:function(e){return a(e.getSeconds(),T)},ap:function(e){return v&&11<e.getHours()?1:0}},g=d.preset,m=d.dateOrder,f=d.timeWheels,b=m.match(/D/),v=f.match(/a/i),y=f.match(/h/),C="datetime"==g?d.dateFormat+d.separator+d.timeFormat:"time"==g?d.timeFormat:d.dateFormat,x=new Date,z=d.stepHour,E=d.stepMinute,T=d.stepSecond,R=d.minDate,w=d.maxDate;if(o=o||C,g.match(/date/i)){e.each(["y","m","d"],(function(e,t){-1<(e=m.search(RegExp(t,"i")))&&c.push({o:e,v:t})})),c.sort((function(e,t){return e.o>t.o?1:-1})),e.each(c,(function(e,t){p[t.v]=e}));l={};for(var A=0;3>A;A++)if(A==p.y){u++,l[d.yearText]={};for(var F=R?R.getFullYear():d.startYear,S=w?w.getFullYear():d.endYear;F<=S;F++)l[d.yearText][F]=m.match(/yy/i)?F:(F+"").substr(2,2)}else if(A==p.m)for(u++,l[d.monthText]={},F=0;12>F;F++)l[d.monthText][F]=m.match(/MM/)?d.monthNames[F]:m.match(/M/)?d.monthNamesShort[F]:m.match(/mm/)&&9>F?"0"+(F+1):F+1;else if(A==p.d)for(u++,l[d.dayText]={},F=1;32>F;F++)l[d.dayText][F]=m.match(/dd/i)&&10>F?"0"+F:F;s.push(l)}if(g.match(/time/i)){if(l={},f.match(/h/i))for(p.h=u++,l[d.hourText]={},F=0;F<(y?12:24);F+=z)l[d.hourText][F]=y&&0==F?12:f.match(/hh/i)&&10>F?"0"+F:F;if(f.match(/i/))for(p.i=u++,l[d.minuteText]={},F=0;60>F;F+=E)l[d.minuteText][F]=f.match(/ii/)&&10>F?"0"+F:F;if(f.match(/s/))for(p.s=u++,l[d.secText]={},F=0;60>F;F+=T)l[d.secText][F]=f.match(/ss/)&&10>F?"0"+F:F;v&&(p.ap=u++,u=f.match(/A/),l[d.ampmText]={0:u?"AM":"am",1:u?"PM":"pm"}),s.push(l)}return{wheels:s,headerText:function(){return e.scroller.formatDate(C,n(i.temp),d)},formatResult:function(t){return e.scroller.formatDate(o,n(t),d)},parseValue:function(t){var i=new Date,r=[];try{i=e.scroller.parseDate(o,t,d)}catch(e){}for(var a in p)r[p[a]]=i[h[a]]?i[h[a]]():h[a](i);return r},validate:function(t,n){var o=i.temp,s={m:0,d:1,h:0,i:0,s:0,ap:0},l={m:11,d:31,h:a(y?11:23,z),i:a(59,E),s:a(59,T),ap:1},u=!0,c=!0;e.each(R||w?"y,m,d,ap,h,i,s".split(","):n==p.y||n==p.m||void 0===n?["d"]:[],(function(i,a){if(void 0!==p[a]){var n,g,f=s[a],v=l[a],y=31,C=r(o,a),x=e("ul",t).eq(p[a]);if("d"==a&&(n=r(o,"y"),g=r(o,"m"),v=y=32-new Date(n,g,32).getDate(),b&&e("li",x).each((function(){var t=e(this),i=t.data("val"),r=new Date(n,g,i).getDay();t.html(m.replace(/[my]/gi,"").replace(/dd/,10>i?"0"+i:i).replace(/d/,i).replace(/DD/,d.dayNames[r]).replace(/D/,d.dayNamesShort[r]))}))),u&&R&&(f=R[h[a]]?R[h[a]]():h[a](R)),c&&w&&(v=w[h[a]]?w[h[a]]():h[a](w)),"y"!=a){var z=e('li[data-val="'+f+'"]',x).index(),E=e('li[data-val="'+v+'"]',x).index();e("li",x).removeClass("dw-v").slice(z,E+1).addClass("dw-v"),"d"==a&&e("li",x).removeClass("dw-h").slice(y).addClass("dw-h"),C<f&&(C=f),C>v&&(C=v)}if(u&&(u=C==f),c&&(c=C==v),d.invalid&&"d"==a){var T=[];if(d.invalid.dates&&e.each(d.invalid.dates,(function(e,t){t.getFullYear()==n&&t.getMonth()==g&&T.push(t.getDate()-1)})),d.invalid.daysOfWeek){var A=new Date(n,g,1).getDay();e.each(d.invalid.daysOfWeek,(function(e,t){for(var i=t-A;i<y;i+=7)i>=0&&T.push(i)}))}d.invalid.daysOfMonth&&e.each(d.invalid.daysOfMonth,(function(e,t){(t=(t+"").split("/"))[1]?t[0]-1==g&&T.push(t[1]-1):T.push(t[0]-1)})),e.each(T,(function(t,i){e("li",x).eq(i).removeClass("dw-v")}))}}}))},methods:{getDate:function(t){var i=e(this).scroller("getInst");if(i)return n(t?i.temp:i.values)},setDate:function(t,i,r){return null==i&&(i=!1),this.each((function(){var a=e(this).scroller("getInst");if(a){for(var n in p)a.temp[p[n]]=t[h[n]]?t[h[n]]():h[n](t);a.setValue(!0,i,r)}}))}}}};e.scroller.presets.date=i,e.scroller.presets.datetime=i,e.scroller.presets.time=i,e.scroller.formatDate=function(i,r,a){if(!r)return null;a=e.extend({},t,a);for(var n=function(e){for(var t=0;u+1<i.length&&i.charAt(u+1)==e;)t++,u++;return t},o=function(e,t,i){if(t=""+t,n(e))for(;t.length<i;)t="0"+t;return t},s=function(e,t,i,r){return n(e)?r[t]:i[t]},l="",d=!1,u=0;u<i.length;u++)if(d)"'"!=i.charAt(u)||n("'")?l+=i.charAt(u):d=!1;else switch(i.charAt(u)){case"d":l+=o("d",r.getDate(),2);break;case"D":l+=s("D",r.getDay(),a.dayNamesShort,a.dayNames);break;case"o":l+=o("o",(r.getTime()-new Date(r.getFullYear(),0,0).getTime())/864e5,3);break;case"m":l+=o("m",r.getMonth()+1,2);break;case"M":l+=s("M",r.getMonth(),a.monthNamesShort,a.monthNames);break;case"y":l+=n("y")?r.getFullYear():(10>r.getYear()%100?"0":"")+r.getYear()%100;break;case"h":var c=r.getHours();l=l+o("h",12<c?c-12:0==c?12:c,2);break;case"H":l+=o("H",r.getHours(),2);break;case"i":l+=o("i",r.getMinutes(),2);break;case"s":l+=o("s",r.getSeconds(),2);break;case"a":l+=11<r.getHours()?"pm":"am";break;case"A":l+=11<r.getHours()?"PM":"AM";break;case"'":n("'")?l+="'":d=!0;break;default:l+=i.charAt(u)}return l},e.scroller.parseDate=function(i,r,a){var n=new Date;if(!i||!r)return n;r="object"==_typeof(r)?r.toString():r+"";for(var o=e.extend({},t,a),s=(a=n.getFullYear(),n.getMonth()+1),l=n.getDate(),d=-1,u=n.getHours(),c=(n=n.getMinutes(),0),p=-1,h=!1,g=function(e){return(e=v+1<i.length&&i.charAt(v+1)==e)&&v++,e},m=function(e){return g(e),(e=r.substr(b).match(RegExp("^\\d{1,"+("@"==e?14:"!"==e?20:"y"==e?4:"o"==e?3:2)+"}")))?(b+=e[0].length,parseInt(e[0],10)):0},f=function(e,t,i){for(e=g(e)?i:t,t=0;t<e.length;t++)if(r.substr(b,e[t].length).toLowerCase()==e[t].toLowerCase())return b+=e[t].length,t+1;return 0},b=0,v=0;v<i.length;v++)if(h)"'"!=i.charAt(v)||g("'")?b++:h=!1;else switch(i.charAt(v)){case"d":l=m("d");break;case"D":f("D",o.dayNamesShort,o.dayNames);break;case"o":d=m("o");break;case"m":s=m("m");break;case"M":s=f("M",o.monthNamesShort,o.monthNames);break;case"y":a=m("y");break;case"H":u=m("H");break;case"h":u=m("h");break;case"i":n=m("i");break;case"s":c=m("s");break;case"a":p=f("a",["am","pm"],["am","pm"])-1;break;case"A":p=f("A",["am","pm"],["am","pm"])-1;break;case"'":g("'")?b++:h=!0;break;default:b++}if(100>a&&(a+=(new Date).getFullYear()-(new Date).getFullYear()%100+(a<=o.shortYearCutoff?0:-100)),-1<d)for(s=1,l=d;;){if(l<=(o=32-new Date(a,s-1,32).getDate()))break;s++,l-=o}if((u=new Date(a,s-1,l,-1==p?u:p&&12>u?u+12:p||12!=u?u:0,n,c)).getFullYear()!=a||u.getMonth()+1!=s||u.getDate()!=l)throw"Invalid date";return u}}(jQuery),function(e){var t={inputClass:""};e.scroller.presets.select=function(i){var r=e.extend({},t,i.settings),a=e(this),n=this.id+"_dummy";e('label[for="'+this.id+'"]').attr("for",n);var o=(o=e('label[for="'+n+'"]')).length?o.text():a.attr("name"),s=[],l=[{}];l[0][o]={};var d=l[0][o];e("option",a).each((function(){var t=e(this).attr("value");d[t]=e(this).text(),e(this).prop("disabled")&&s.push(t)})),e("#"+n).remove();var u=e('<input type="text" id="'+n+'" value="'+d[a.val()]+'" class="'+r.inputClass+'" readonly />').insertBefore(a);return r.showOnFocus&&u.focus((function(){i.show()})),a.hide().closest(".ui-field-contain").trigger("create"),{width:200,wheels:l,headerText:!1,formatResult:function(e){return d[e[0]]},parseValue:function(){return[a.val()]},validate:function(t){e.each(s,(function(i,r){e('li[data-val="'+r+'"]',t).removeClass("dw-v")}))},onSelect:function(e,t){u.val(e),a.val(t.values[0]).trigger("change")},onChange:function(e,t){"inline"==r.display&&(u.val(e),a.val(t.temp[0]).trigger("change"))},onClose:function(){u.blur()}}}}(jQuery),jQuery.scroller.themes.android={defaults:{dateOrder:"Mddyy",mode:"clickpick",height:50}},function(e){var t={defaults:{dateOrder:"Mddyy",mode:"mixed",rows:5,width:70,showLabel:!1}};e.scroller.themes["android-ics"]=t,e.scroller.themes["android-ics light"]=t}(jQuery),jQuery.scroller.themes.ios={defaults:{dateOrder:"MMdyy",rows:5,height:30,width:55,headerText:!1,showLabel:!1}},function(e){e.scroller.themes.jqm={defaults:{jqmBody:"c",jqmHeader:"b",jqmWheel:"d",jqmClickPick:"c",jqmSet:"b",jqmCancel:"c"},init:function(t,i){var r=i.settings;e(".dw",t).removeClass("dwbg").addClass("ui-overlay-shadow ui-corner-all ui-body-a"),e(".dwb-s a",t).attr("data-role","button").attr("data-theme",r.jqmSet),e(".dwb-c a",t).attr("data-role","button").attr("data-theme",r.jqmCancel),e(".dwwb",t).attr("data-role","button").attr("data-theme",r.jqmClickPick),e(".dwv",t).addClass("ui-header ui-bar-"+r.jqmHeader),e(".dwwr",t).addClass("ui-body-"+r.jqmBody),e(".dwpm .dww",t).addClass("ui-body-"+r.jqmWheel),"inline"!=r.display&&e(".dw",t).addClass("pop in"),t.trigger("create"),e(".dwo",t).click((function(){i.hide()}))}}}(jQuery),function(e){e.fn.mobilePagination=function(t){t=t||{};var i={firstPage:1,totalPages:1,actualPage:1,pages:[],listElement:e("ul"),first:'<spaz class="bz-mo-icon bz-grid-backwards-fast"></span>',firstClass:"first",previous:'<spaz class="bz-mo-icon bz-grid-backwards"></span>',previousClass:"previous",next:'<spaz class="bz-mo-icon bz-grid-forward"></span>',nextClass:"next",last:'<spaz class="bz-mo-icon bz-grid-forward-fast"></span>',lastClass:"last",liClass:"bz-page",arrowClass:"bz-page-arrow",clickCallBack:function(){}};t.actualPage>t.totalPages&&(t.actualPage=t.totalPages),e.extend(i,i,t);var r={previousPage:i.actualPage>1?i.actualPage-1:1,nextPage:i.actualPage<i.totalPages?i.actualPage+1:i.totalPages};function a(t){var i=t.container,r=t.list;if(t.query!==this.lastProcessedValue||t.force){this.lastProcessedValue=t.query,""!==t.query?"none"===i.find(".bz-rn-modal-pagination-header-filter-cancel").css("display")&&i.find(".bz-rn-modal-pagination-header-filter-cancel").show(500):i.find(".bz-rn-modal-pagination-header-filter-cancel").hide(500);var a=new RegExp(t.query,"i");r.filter((function(){if(a.test(e(this).text()))return e(this);e(this).hide()})).show()}}!function(){if(i.totalPages&&i.totalPages>1){i.pages=[];for(var t=1;t<=i.totalPages;t++)i.pages.push({id:t,value:t,active:t===i.actualPage});i.listElement.prepend("<li/>").find("li:first").addClass(i.arrowClass+" "+i.previousClass).data("page",r.previousPage).html(i.previous),i.listElement.prepend("<li/>").find("li:first").addClass(i.arrowClass+" "+i.firstClass).data("page",i.firstPage).html(i.first),i.listElement.append("<li/>").find("li:last").addClass(i.arrowClass+" "+i.nextClass).data("page",r.nextPage).html(i.next),i.listElement.append("<li/>").find("li:last").addClass(i.arrowClass+" "+i.lastClass).data("page",i.totalPages).html(i.last),e("li."+i.arrowClass,i.listElement).click((function(){var t=e(this).hasClass(i.lastClass)?i.totalPages:Number(e(this).data("page"));i.clickCallBack({page:t})})),e("li.active .bz-page-index",i.listElement).click((function(){var t,r,n,o,s;t=kendo.template("<div data-role='modalview' class='bz-rn-modal-pagination' style='width: 50%; height: 65%;'>\t<div data-role='header' class='bz-rn-modal-pagination-header'>\t\t<div class='bz-rn-modal-pagination-header-navigation' data-role='navbar'>\t\t\t<div class='bz-rn-modal-pagination-header-title'>\t\t\t\t<span class='bz-rn-modal-pagination-header-title-text'>#=data.title#</span>\t\t\t\t<span class='bz-rn-modal-pagination-header-title-cancel bz-mo-icon bz-cancel'></span>\t\t\t</div>\t\t\t<div class='bz-rn-modal-pagination-header-search'>\t\t\t\t<input class='bz-rn-modal-pagination-header-filter' type='text' placeholder='Type page...' />\t\t\t\t<span class='bz-rn-modal-pagination-header-filter-search bz-mo-icon bz-search'></span>\t\t\t\t<span class='bz-rn-modal-pagination-header-filter-cancel bz-mo-icon bz-circle-cross-full'></span>\t\t\t</div>\t\t</div>\t</div>\t<div class='bz-rn-modal-pagination-content'>\t\t<ul class='bz-rn-modal-pagination-content-list'>\t\t\t# $.each (data.list, function (i, item) { #\t\t\t<li class='bz-rn-modal-pagination-content-list-item' data-page='#= item.id #'>#= item.value #</li>\t\t\t# }) #\t\t</ul>\t</div>\t<div data-role='footer' class='bz-rn-modal-pagination-footer'>\t\t<div class='bz-rn-modal-pagination-footer-navigation' data-role='navbar'>\t\t\t<a class='bz-rn-modal-pagination-footer-action' data-align='right' data-role='button'>#=data.action#</a>\t\t</div>\t</div></div>",{useWithBlock:!1}),(r=e(t({list:i.pages,title:"Go to page",placeholder:"Type page...",action:"GO"}).trim())).kendoMobileModalView({close:function(){this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),o=(n=r).find(".bz-rn-modal-pagination-content-list li"),s=n.find(".bz-rn-modal-pagination-content-list"),n.on("click",".bz-rn-modal-pagination-header-title-cancel",(function(){n.kendoMobileModalView("close")})),n.on("click",".bz-rn-modal-pagination-footer-action",(function(){var e=s.find(".bz-rn-modal-pagination-content-list-item-selected");if(e&&e.length>0){var t=Number(e.data("page"));n.kendoMobileModalView("close"),i.clickCallBack({page:t})}})),n.find(".bz-rn-modal-pagination-header-filter").keyup((function(e){var t=this;13===e.which?a({container:n,list:o,query:t.value,force:!0}):(t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout((function(){a({container:n,list:o,query:t.value})}),300))})),n.find(".bz-rn-modal-pagination-header-filter-cancel").on("click",(function(){a({container:n,list:o,query:"",force:!0}),n.find(".bz-rn-modal-pagination-header-filter").val("")})),s.on("click","li",(function(){s.find(".bz-rn-modal-pagination-content-list-item-selected").removeClass("bz-rn-modal-pagination-content-list-item-selected"),e(this).addClass("bz-rn-modal-pagination-content-list-item-selected")})),r.closest(".km-modalview-wrapper").addClass("bz-rn-modal-pagination-position").addClass("bz-rn-modal-pagination-container"),r.kendoMobileModalView("open")}))}}()}}(jQuery),function(e){e.fn.mobileGrid=function(t){var i=this;return i.element=this,i.options=e.extend({id:"no-id",columns:[],sortBy:"",sortType:"asc",showSummary:!1,collapse:!1,collapseState:!1,data:{},indexedData:{},maxColumns:0,buttonsPst:!1,title:"",tableCssClass:"",headerStyles:"",columnKeyStyle:"bz-rn-grid-column-key",columnHiddenStyle:"bz-rn-grid-column-hidden",template:{grid:"",waiting:"",table:"",emptyTable:"",column:"",specialColumn:"",row:"",rowButtons:"",cell:"",specialCell:"",pager:"",buttons:"",dynamicPager:"",summary:"",summaryCell:""},actions:{add:!0,edit:!0,remove:!0,details:!0},mode:"execution"},t||{}),function(){var t=i.options,a=i.element;i.page=1,i.changes={},i.totalRows=0,i.totalPages=0,i.data=t.data,i.selectedRow=0,i.components={},i.buttons={},i.asyncCells={},i.columnByIndex={},i.columnByName={},i.columnKeyIndex=0,e.each(t.columns,(function(e,t){t.key=void 0!==t.key&&t.key,t.label=void 0!==t.label?t.label:t.name,t.sortType="asc",i.columnByIndex[t.index]=t,i.columnByName[t.name]=t,t.key&&(i.columnKeyIndex=t.index)})),t.sortBy=t.sortBy||i.columnByIndex[0].name,i.columnByName[t.sortBy]?i.columnByName[t.sortBy].sortType=t.sortType:i.columnByName[t.sortBy.split(".")[0]]&&(i.columnByName[t.sortBy.split(".")[0]].sortType=t.sortType);a.attr("data-bizagi-id",t.id),r(),i.collapseState=t.collapseState}(),{setData:function(t){i.data=t,r(),p(),i.components={},function(){var t=i.options,r=i.element;i.drawing=!0,function(){var e=i.element;i.waitingTimeout&&(clearTimeout(i.waitingTimeout),i.waitingTimeout=null),e.empty()}();var f,b=e.kendoTmpl(t.template.grid,{label:t.title,buttonsPst:t.buttonsPst,collapse:t.collapse,collapseState:i.collapseState,isDesign:"design"===t.mode});b=function(t){var r,o=i.options,s=e.kendoTmpl(o.template.table,{showSummary:o.showSummary,tableCssClass:o.tableCssClass}),l=e.kendoTmpl(o.template.emptyTable);return s=g(s,"columns",function(){var t=i.options,r="",n=!1;return i.exactMatch=function(){for(var e=i.options,t=e.columns,r=e.sortBy,a=0,n=t.length;a<n;)if(r===t[a++].name)return!0;return!1}(),e.each(t.columns,(function(e,o){n||(t.maxColumns>0?e<=i.options.maxColumns?r+=a(o):(r+=drawSpecialColumn(o),n=!0):r+=a(o))})),r}()),s=g(s,"rows",(r="",e.each(i.data.rows,(function(t,a){r+=function(t,r){var a=i.options,o=t[i.columnKeyIndex],s=r||!1,l=Math.floor(1e4*Math.random()),d=e.kendoTmpl(a.template.row,{key:l,isNewRow:r,businessKey:o}),u="",c=!1;return e.each(t,(function(e,t){c||(a.maxColumns>0?e<a.maxColumns+1?u+=n(e,o,t,s):(u+=drawSpecialCell(e,o,t),c=!0):u+=n(e,o,t,s))})),d=g(d,"cells",u)}(a)})),r)),t=g(t,"pager",function(){var t=i.options,r={};r.hasPagination=i.data.total>1,r.page=Number(i.data.page),r.pages=[];for(var a=1;a<=i.data.total;a++)r.pages.push({number:a,active:a===r.page});return r.previousPage=i.data.page>1?i.data.page-1:1,r.nextPage=i.data.page<i.data.total?i.data.page+1:i.data.total,r.totalPages=i.data.total,e.kendoTmpl(t.template.pager,r)}()),t=g(t,"table",s),t=g(t,"emptyTable",l)}(b),i.grid=e(b).appendTo(r),i.grid,(f=h("cells"))&&e.each(f,(function(t,r){!function(t){var r=t.attr("data-business-key"),a=t.attr("data-new-row"),n=t.is("[data-bizagi-component=cells]")?t.children():t.find("[data-bizagi-component=cells]").children();e.each(n,(function(t,n){var o=i.columnByIndex[t];if(!o.key){var s=i.asyncCells[r+"-"+o.index];s?e.when(s).done((function(t){(n=e(n)).append(t),d(o,r,n,a)})):d(o,r,e(n),a)}}))}(r=e(r))})),function(){if(i.data.total>1){var e=h("pager").find("ul"),t={totalPages:i.data.total,actualPage:Number(i.data.page),listElement:e,clickCallBack:function(e){var t,r,a,n;t=e.page,r=Number(i.data.page),a=i.data.total,(n=t)===r||n<1||n>a||(p(),i.page=Number(n),c("pageRequested",m()))}};e.mobilePagination(t)}}(),h("rows").find("tr").on("click",(function(){!function(e,t){i.selectedRow===e?(u(),i.selectedRow=0,i.selectedBusinessKey=0):(0!==i.selectedRow&&u(),i.selectedRow=e,i.selectedBusinessKey=t,c("rowSelected",{key:i.selectedRow}))}(e(this).attr("data-key"),e(this).attr("data-business-key"))})),h("columns").find(".bz-rn-grid-column").on("click",(function(){!function(e,t){var r=i.options,a=i.columnByIndex[e];void 0!==r.sortBy&&(void 0===a.name&&(a.name=a.label),t=a.name===r.sortBy?t||("asc"===r.sortOrder?"desc":"asc"):a.name===r.sortBy.split(".")[0]?t||("asc"===r.sortType?"desc":"asc"):t||r.sortType,r.sortBy.split(".").length>1?(r.sortBy.split(".")[0],a.name,r.sortBy=a.name):r.sortBy=a.name,r.sortColumn=a,r.sortType=t,r.sortOrder=t,p(),c("sortRequested",m()))}(e(this).attr("data-column-index"))})),h("rows").find("tr").actionSheet({actions:o(),titleLabel:"Selected Row",setDataToShow:function(t){var i=e(t.target).closest("tr").attr("data-key"),r=e(t.target).closest("tr").attr("data-business-key");this.params={key:i,businessKey:r}},actionClicked:function(e){s(e.guid,this.params),l()},cancelClicked:function(e){l()}}),0===i.data.rows.length?(h("table").hide(),h("pager").hide(),h("emptyTable").show()):(h("table").show(),h("pager").show(),h("emptyTable").hide()),i.drawing=!1}()},getData:function(){return i.data},getNewRowKeys:function(){var t=h("rows").find("[data-new-row]");return e.map(t,(function(t,i){return e(t).data("business-key")}))},changeCellValue:function(e,t,r){i.indexedData[e]&&(i.indexedData[e][t]=r)},refreshSummary:function(e){var t=i.options,r=h("summary");if(i.drawing)return;if(!r)return;t.showSummary&&(e?refreshSummaryCell(e):(r.empty(),r.append(drawSummary()),postRenderSummary(r)))},getContainer:function(){return e(i.element)},processAction:s};function r(){var t=i.options.columns,r=i.data,a={};r.rows&&e.each(r.rows,(function(i,r){var n;e.each(t,(function(e,t){t.key&&(n=r[e])})),a[n]=r})),i.indexedData=a}function a(t){var r,a=i.options;r=t.key?a.columnKeyStyle:t.hidden?a.columnHiddenStyle:void 0!==t.bizAgiProperties&&t.bizAgiProperties.cssclass?t.bizAgiProperties.cssclass:"";var n=t.name===a.sortBy?t.name===a.sortBy:t.name===a.sortBy.split(".")[0]&&!i.exactMatch&&t.name===a.sortBy.split(".")[0];return e.kendoTmpl(a.template.column,e.extend({},t,{sortActive:n,sortType:a.sortOrder,headerLabelStyles:a.headerStyles?a.headerStyles.label:"",headerStyles:a.headerStyles?a.headerStyles.header:"",columnCssClass:r}))}function n(t,r,a,n){var o=i.options,s="";if(n=n||!1,!i.columnByIndex[t])return"";t>0&&(s=i.columnByIndex[t].bizAgiProperties&&i.columnByIndex[t].bizAgiProperties.messageValidation);var l,d=i.columnByIndex[t].key,u=o.columns[t].hidden||!1;l=d?o.columnKeyStyle:u?o.columnHiddenStyle:void 0!==i.columnByIndex[t].bizAgiProperties&&i.columnByIndex[t].bizAgiProperties.cssclass?i.columnByIndex[t].bizAgiProperties.cssclass:"";var p=e.kendoTmpl(o.template.cell,{isKey:d,hidden:u,isDesign:"design"===o.mode,messageValidation:s,columnCssClass:l}),h=function(e,t,i,r){return c("drawCell",{column:e,key:t,value:i,isNewRow:r})}(i.columnByIndex[t],r,a,n);return h||(h=""),"object"===_typeof(h)&&h.done?"resolved"===h.state()?p=g(p,"cellContent",function(e){var t;return e.done((function(e){t=e})),t}(h)):(p=g(p,"cellContent",""),i.asyncCells[r+"-"+t]=h):p=g(p,"cellContent",h),i.columnByIndex[t].cell=e(p),p}function o(){var t=[],r=i.options,a=r.tooltips||{},n=e.extend(r.actions,a);return n.edit&&t.push({guid:"edit",displayName:n.editLabel}),n.remove&&t.push({guid:"remove",displayName:n.deleteLabel}),n.details&&t.push({guid:"details",displayName:n.detailLabel}),t}function s(e,t){"edit"===e&&c("editRow",{key:i.selectedBusinessKey}),"remove"===e&&c("deleteRow",{key:i.selectedBusinessKey}),"details"===e&&c("showFormDetails",{key:i.selectedBusinessKey})}function l(){0!==i.selectedRow&&(u(),i.selectedRow=0,i.selectedBusinessKey=0)}function d(e,t,i,r){return c("cellReady",{column:e,key:t,cell:i,isNewRow:r})}function u(){return c("rowUnselected",{key:i.selectedRow})}function c(e,r){var a=t[e];return a?a.call(i.element,r):null}function p(){i.components={}}function h(t){var r=i.element;if(!i.components[t]){var a=e("[data-bizagi-component="+t+"]",r);null!=a&&a.length>0&&(i.components[t]=a)}return i.components[t]}function g(e,t,i){return e.replace("{{element "+t+"}}",i)}function m(){var e=i.options,t=null!=e.sortColumn?e.sortColumn.index:1;return{page:i.page,sortBy:e.sortBy,sortType:e.sortOrder,sortColumnIndex:t}}}}(jQuery),
/**
* Timeago is a jQuery plugin that makes it easy to support automatically
* updating fuzzy timestamps (e.g. "4 minutes ago" or "about 1 day ago").
*
* @name timeago
* @version 1.3.1
* @requires jQuery v1.2.3+
* @author Ryan McGeary
* @license MIT License - http://www.opensource.org/licenses/mit-license.php
*
* For usage and examples, visit:
* http://timeago.yarp.com/
*
* Copyright (c) 2008-2013, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
*/
function(e){e.timeago=function(r){return t.settings={refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:bizagi.localization.getResource("bizagi-editor-form-timeago-ago"),suffixFromNow:bizagi.localization.getResource("bizagi-editor-form-timeago-from-now"),seconds:bizagi.localization.getResource("bizagi-editor-form-timeago-seconds"),minute:bizagi.localization.getResource("bizagi-editor-form-timeago-minute"),minutes:bizagi.localization.getResource("bizagi-editor-form-timeago-minutes"),hour:bizagi.localization.getResource("bizagi-editor-form-timeago-hour"),hours:bizagi.localization.getResource("bizagi-editor-form-timeago-hours"),day:bizagi.localization.getResource("bizagi-editor-form-timeago-day"),days:bizagi.localization.getResource("bizagi-editor-form-timeago-days"),month:bizagi.localization.getResource("bizagi-editor-form-timeago-month"),months:bizagi.localization.getResource("bizagi-editor-form-timeago-months"),year:bizagi.localization.getResource("bizagi-editor-form-timeago-year"),years:bizagi.localization.getResource("bizagi-editor-form-timeago-years"),wordSeparator:" ",numbers:[]}},r instanceof Date?i(r):"string"==typeof r?(r=r.replace(".","-"),i(e.timeago.parse(r))):i("number"==typeof r?new Date(r):e.timeago.datetime(r))};var t=e.timeago;function i(e){return t.inWords(function(e){return(new Date).getTime()-e.getTime()}(e))}e.extend(e.timeago,{inWords:function(t){var i=this.settings.strings,r=i.prefixAgo,a=i.suffixAgo;this.settings.allowFuture&&t<0&&(r=i.prefixFromNow,a=i.suffixFromNow);var n=Math.abs(t)/1e3,o=n/60,s=o/60,l=s/24,d=l/365;function u(r,a){var n=e.isFunction(r)?r(a,t):r,o=i.numbers&&i.numbers[a]||a;return n.replace(/%d/i,o)}var c=n<45&&u(i.seconds,Math.round(n))||n<90&&u(i.minute,1)||o<45&&u(i.minutes,Math.round(o))||o<90&&u(i.hour,1)||s<24&&u(i.hours,Math.round(s))||s<42&&u(i.day,1)||l<30&&u(i.days,Math.round(l))||l<45&&u(i.month,1)||l<365&&u(i.months,Math.round(l/30))||d<1.5&&u(i.year,1)||u(i.years,Math.round(d)),p=i.wordSeparator||"";return void 0===i.wordSeparator&&(p=" "),e.trim([r,c,a].join(p))},parse:function(t){var i=e.trim(t);return i=(i=(i=(i=(i=i.replace(/\.\d+/,"")).replace(/-/,"/").replace(/-/,"/")).replace(/T/," ").replace(/Z/," UTC")).replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2")).replace(/([\+\-]\d\d)$/," $100"),new Date(i)},datetime:function(i){var r=t.isTime(i)?e(i).attr("datetime"):e(i).attr("title");return t.parse(r)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}})}(jQuery),function(e){e.fn.bztabs=function(t){var i=e(this);(t=t||{}).activeTab=t.activeTab||0,t.tabNumber=t.tabNumber||1;var r=t.activate&&"function"==typeof t.activate?t.activate:function(){},a=(t.beforeActivate&&"function"==typeof t.beforeActivate&&t.beforeActivate,i.find(">div.bz-bizagi-container-tap-popup").hide()),n=a.children().length,o=e("<div class='bz-header_select'></div>"),s=t.tabNumber>n?n:t.tabNumber,l=Math.floor(100/Number(s));a.children().each((function(e,t){o.append("<div class='bz-wp-tabs-ui bz-wp-tabs-item' data-index='"+e+"' data-reference-tab='"+t.getAttribute("data-reference-tab")+"'><span>"+t.textContent+"</span></div>")})),o.find("> .bz-wp-tabs-ui").css("width",l+"%"),o.append("<div class='bz-wp-tabs-arrow-container'><div class='bz-cm-icon bz-mo-icon bz-plus'></div></div>"),i.prepend(o);var d=i.find("> .bz-bizagi-container-tap-popup > .bz-container-items-tabs").eq(t.activeTab);e(e(d).data("reference-tab"),i).addClass("childrenActive"),d.addClass("tabSelected");var u=e(".bz-wp-tabs-ui:nth-child("+(t.activeTab+1)+")",o).addClass("tabSelected"),c=l+(100-l*s);function p(){t.tabNumber<n?(e(".bz-wp-tabs-arrow-container",i).first().addClass("show-pluss"),o.addClass("show-pluss"),u.trigger("click",{origin:"popUp"})):(e(".bz-wp-tabs-arrow-container",i).removeClass("show-pluss"),o.removeClass("show-pluss"),o.find("> .bz-wp-tabs-ui:last").addClass("bz-wp-no-border"))}function h(t,n){if((n=n||{}).origin=n.origin||"header",t.stopPropagation(),t.preventDefault(),!e(this).hasClass("tabSelected")||"popUp"===n.origin){var s=t.currentTarget.getAttribute("data-reference-tab"),d=e(s,i);u=e(t.currentTarget),i.find(">div.childrenActive").removeClass("childrenActive"),d.addClass("childrenActive"),o.find(">div.tabSelected").removeClass("tabSelected").css("width",l+"%"),"block"===a.css("display")&&a.toggle(),n.origin&&"popUp"===n.origin&&(u=e("[data-reference-tab='"+s+"']",o),function(e){var t=o.find(".bz-wp-tabs-ui"),i=!0;t.each((function(t,r){e!==r.getAttribute("data-reference-tab")&&i?(o.remove("[data-reference-tab='"+e+"']"),o.append(r)):i=!1}))}(s)),u.addClass("tabSelected").css("width",c+"%"),r(t,n)}}u.css("width",c+"%"),void 0!==t.domIncluded?e.when(t.domIncluded).done((function(){p()})):p(),i.find(".bz-wp-tabs-arrow-container").first().bind("click",(function(t){var i=o.innerWidth()-29,r=0;e(".bz-container-items-tabs",a).removeClass("show"),o.find(".bz-wp-tabs-ui").each((function(t,n){(r+=e(":first-child",n).outerWidth())>i&&a.children().each((function(t,i){if(i.textContent===n.textContent)return e(i).addClass("show"),e(".cell.bz-container-items-tabs").css("border-bottom",""),void e(".cell.bz-container-items-tabs.show").last().css("border-bottom","none")}))})),t.stopPropagation(),t.preventDefault(),a.toggle()})),e(">div.cell",a).bind("click",(function(e){h(e,{origin:"popUp"})})),e(".bz-wp-tabs-ui",o).bind("click",h),o.bind("resizeHeader",(function(){p()}))}}(jQuery),function(e){e.fn.helpText=function(t){(t=t||{}).helpText=t.helpText||"",t.dir=void 0!==t.dir&&""!==t.dir?t.dir:"inherit";var i=kendo.template('<div class="bz-container-rn-helptext-overlay">   <div class="bz-rn-helptext" dir="#: data.dir #">       <div class="bz-cancel-container">           <a href="\\#" style="opacity: 0; width: 0; height: 0"></a>           <span class="bz-mo-icon bz-cancel"></span>       </div>       <span class="bz-rn-helptext-text">#= data.helpText #</span>   </div></div>',{useWithBlock:!1}),r=e(i(t));e(this).bind("click",(function(){e("body").append(r),e("body").css("position","fixed"),e("a",r).get(0).focus(),e(".bz-cancel",r).bind("click",(function(){r.remove(),e("body").css("position","")})),e("a",r).bind("blur",(function(){e(".bz-cancel",r).click()})),r.addClass("active")}))}}(jQuery),bizagi.render=void 0!==bizagi.render?bizagi.render:{},bizagi.render.services=void 0!==bizagi.render.services?bizagi.render.services:{},bizagi.render.services.endPoints=[],bizagi.render.services.getEndPoints=function(e){var t="Rest/Handlers/Render";return"workflow"==e.context?{"form-get-data":e.proxyPrefix+t,"form-submit-data":e.proxyPrefix+t,"form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload","render-property-refresh":e.proxyPrefix+t,"render-multiaction":e.proxyPrefix+"Rest/Handlers/MultiAction","render-upload-cancel-image":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload","render-upload-delete-url":e.proxyPrefix+t,"render-ecm-upload-url":e.proxyPrefix+"Rest/Handlers/Metadata","render-multiaction-metadata":e.proxyPrefix+"Rest/Handlers/MetadataMultiAction","render-grid-edit-url":e.proxyPrefix+t,"render-grid-save-url":e.proxyPrefix+t,"render-grid-add-url":e.proxyPrefix+t,"render-grid-rollback-url":e.proxyPrefix+t,"render-grid-commit-url":e.proxyPrefix+t,"render-grid-checkpoint-url":e.proxyPrefix+t,"render-save-entity":e.proxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":e.proxyPrefix+"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter","render-letter-save-url":e.proxyPrefix+t,"render-letter-content-icons":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.proxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.proxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.proxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}","render-entity-layout-upload-files":e.proxyPrefix+"Api/Entities/{entity}/Files/{surrogateKey}/Array?xpath={xpath}","render-query-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsersForQueryFormsById/{queryFormId}/","case-handler-getCaseSummary":e.proxyPrefix+"Rest/Cases/{idCase}/SummaryGuid","case-handler-getCaseSummaryByGuid":e.proxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/AssigneesGuid","case-handler-getWorkItems":e.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid","admin-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsers","admin-getUsersList-FromPreferences":e.proxyPrefix+"Rest/Users/SearchUsersFromPreferences","admin-getUsersList-ForStakeholders":e.proxyPrefix+"Rest/Users/SearchUsersForStakeholders","admin-getUsersList-ForXpathIdBossUser":e.proxyPrefix+"Rest/Users/SearchUsersForBosses","admin-getUsersList-ForXpathIdDelegate":e.proxyPrefix+"Rest/Users/SearchUsersForDelegates","admin-getUsersForAssignation":e.proxyPrefix+"Rest/Users/UsersForAssignation","admin-users-config":e.proxyPrefix+"Api/Authentication/BizagiConfig","admin-usersform":e.proxyPrefix+"Rest/Handlers/Render","admin-GenerateDataToSendByEmail":e.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendUserEmail":e.proxyPrefix+"Rest/Users/SendUserEmail"}:"sharepoint"==e.context||"portal"==e.context?(void 0===e.sharepointProxyPrefix&&alert("sharepointProxyPrefix param is requiered to build endpoints when context is 'sharepoint'"),{"form-get-data":e.sharepointProxyPrefix+t,"form-submit-data":e.sharepointProxyPrefix+t,"form-submit-data-upload":e.sharepointProxyPrefix+"Rest/Handlers/Render/Upload","render-property-refresh":e.sharepointProxyPrefix+t,"render-multiaction":e.sharepointProxyPrefix+"Rest/Handlers/MultiAction","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.sharepointProxyPrefix+"Rest/Handlers/RenderFile","render-upload-add-url":e.sharepointProxyPrefix+"Rest/Handlers/Render/Upload","render-upload-delete-url":e.sharepointProxyPrefix+t,"render-ecm-upload-url":e.sharepointProxyPrefix+"Rest/Handlers/Metadata","render-grid-edit-url":e.sharepointProxyPrefix+t,"render-grid-save-url":e.sharepointProxyPrefix+t,"render-grid-add-url":e.sharepointProxyPrefix+t,"render-grid-rollback-url":e.sharepointProxyPrefix+t,"render-grid-commit-url":e.sharepointProxyPrefix+t,"render-grid-checkpoint-url":e.sharepointProxyPrefix+t,"render-save-entity":e.sharepointProxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":"jquery/css/bizagi/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.sharepointProxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.sharepointProxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.sharepointProxyPrefix+"Rest/Handlers/Letter","render-letter-content-url":e.sharepointProxyPrefix+"Rest/Handlers/Letter","render-letter-save-url":e.sharepointProxyPrefix+t,"render-letter-content-icons":"jquery/css/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.sharepointProxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.sharepointProxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.sharepointProxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}","case-handler-getCaseSummary":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-getCaseSummaryByGuid":e.sharepointProxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getWorkItems":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid"}):"entitymanagement"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=entity","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=entity","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile?h_contexttype=entity","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=entity","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=entity","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=entity","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=entity","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=entity","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:"search"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data-upload":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=metadata","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=metadata","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+"Rest/Handlers/RenderFile?h_contexttype=metadata","render-upload-add-url":e.proxyPrefix+"Rest/Handlers/Render/Upload?h_contexttype=metadata","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=metadata","render-letter-notEditable-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=metadata","render-letter-content-url":e.proxyPrefix+"Rest/Handlers/Letter?h_contexttype=metadata","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:{}},$.Class.extend("bizagi.render.services.context",{},{init:function(e){this.context=e.context,this.endPoints=bizagi.render.services.getEndPoints(e),this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix},getUrl:function(e){return null==this.endPoints[e]&&alert("No endpoint defined for: "+e),this.endPoints[e]},setProxyPrefix:function(e){this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.endPoints=bizagi.render.services.getEndPoints(e)}}),$.Class.extend("bizagi.render.services.service",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId",BA_MULTIACTION_WITH_LIMIT_NUMBER:5,BA_MULTIACTION_WITH_LIMIT_QUEUE:"multiaction"},{init:function(e){(e=e||{}).context=e.context||"workflow",e.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.serviceLocator=new bizagi.render.services.context(e),this.multiactionService=new bizagi.render.services.multiactionservice(this),this.multiactionServiceWithLimit=new bizagi.render.services.multiactionservice(this,this.Class.BA_MULTIACTION_WITH_LIMIT_NUMBER,this.Class.BA_MULTIACTION_WITH_LIMIT_QUEUE),this.guid=Math.guid(),bizagi.override.enableECMMetadataMultiaction&&(this.multiactionMetadataService=new bizagi.render.services.metadatamultiactionservice(this)),this.userfieldRequests={},this.deviceType=e.deviceType||(bizagi.util.isSmartphoneDevice()?bizagi.deviceEnum.smartphone:bizagi.util.isTabletDevice()?bizagi.deviceEnum.tablet:bizagi.deviceEnum.desktop),this.deviceCode=bizagi.util.getDeviceCode()},multiaction:function(){return this.multiactionService},multiactionWithLimit:function(){return this.multiactionServiceWithLimit},metadataECMMultiaction:function(){return bizagi.override.enableECMMetadataMultiaction?this.multiactionMetadataService:this},getFormData:function(e){if(e&&e.data)return e.data;e=e||{};var t={};if(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action||"LOADFORM",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,e.idProcess&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idProcess"]=e.idProcess),e.idOrganization&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idOrganization"]=e.idOrganization),e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.idEntity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEntity"]=e.idEntity),e.surrogateKey&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey),e.idRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.requestedForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"requestedForm"]=e.requestedForm),e.recordXPath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordXPath"]=e.recordXPath),e.summaryForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"summaryForm"]=e.summaryForm),e.idCase&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idWorkitem&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.idTask&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idTask"]=e.idTask),e.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.contextType&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contextType),e.guidEntity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),bizagi.util.isEmpty(e.isRefresh)||(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isRefresh"]=e.isRefresh),e.isActionStartForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=e.isActionStartForm),e.additionalXpaths&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),void 0!==e.readOnlyForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"readonlyform"]=e.readOnlyForm),void 0!==e.printversion&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"printForm"]=e.printversion),void 0!==e.recordXpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.guid&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guid"]=e.guid),e.downloadOfflineForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"downloadofflineform"]=1),!1===e.editable&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"DisplayFormAsReadOnly"]=!0),e.printversion){e[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"]&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"]=e[this.Class.BA_ACTION_PARAMETER_PREFIX+"all_rows"])}if(e.prepare)return t;bizagi.chrono.initAndStart("data");var i={url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:e.action||"LOAD"};return e.downloadOfflineForm&&(i.avoidLoader=!0),$.ajax(i).pipe((function(i){if(bizagi.chrono.stopAndLog("data"),e.printversion)try{i.form.properties.editable="False";i=function e(i){return null==i?i:(i.hasOwnProperty("type")&&"grid"==i.type?(i.id=t.id+"-print",i.allowAdd="False",i.allowDelete="False",i.allowEdit="False",i.allowGrouping="False",i.allowMore="False",i.allowSearch="False"):$.each(t,(function(t,r){"object"==_typeof(r)&&(i[t]=e(i[t]))})),i)}(i)}catch(e){}return i}))},getSearchFormData:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHFORM",e.xpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idSearchForm&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm),e.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-search-form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"SEARCHFORM"})},processDataValues:function(e){var t;for(t in e=$.extend(!0,{},e))e.hasOwnProperty(t)&&"object"==$.type(e[t])&&e[t].hasOwnProperty("id")&&(e[t]=e[t].id);return e},submitData:function(e){data=this.resolveData(e.data||{},e.xpathContext),data=this.processDataValues(data),data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action,(e=e||{}).xpath&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idPageCache&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache),e.guidEntity&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),e.contexttype&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.transitions&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"transitions"]=e.transitions),e.surrogatekey&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.forcePlanCompletion&&(data[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"forcePlanCompletion"]=e.forcePlanCompletion);var t=e.action.toString().toUpperCase();return bizagi.debug("Data sent",data),e.prepare?data:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:data,type:"POST",dataType:"json",serviceType:t,beforeSend:function(e,t){e.renderingService=!0}})},resolveData:function(e,t){var i,r,a;if(!$.isEmptyObject(e)&&t&&-1!==t.search(/\[id=\d+\]/))for(i in e)-1!==i.search(/\[id=\d+\]/)&&t==i.substr(0,i.search(/\]/)+1)&&(r=i.substr(i.search(/\]/)+2),a=e[i],e[r]=a,delete e[i]);return e},getPropertyData:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,e.sessionId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.guidentity&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.surrogatekey&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.pxpath&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpath"]=e.pxpath),e.prows&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.prows),e.ppage&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.ppage),null!=e.pfilter&&null!=e.pfilter&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"filter"]=e.pfilter),null!=e.psort&&null!=e.psort&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.psort),e.porder&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.porder),e.pcaseId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"caseId"]=e.pcaseId),e.pguidEntity&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidEntity"]=e.pguidEntity),e.psurrogatedKey&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.psurrogatedKey),e.pactionXpath&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"actionXpath"]=e.pactionXpath),e.ptemplateGuid&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"templateGuid"]=e.ptemplateGuid),e.pparameters&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"parameters"]=e.pparameters),bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},getData:function(e){return this.getPropertyData($.extend(e,{property:"data"}))},getSearchData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"term"]=e.term,this.getPropertyData($.extend(e,{property:"data"}))},getCollapseData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"collapseState"]=e.collapseState,this.getPropertyData($.extend(e,{property:"collapseState"}))},getGridData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.order,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,this.getPropertyData($.extend(e,{property:"data"}))},getGridDataExclusivesSelected:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathfilter"]=e.xpathfilter,this.getPropertyData($.extend(e,{property:"exclusivesSelected"}))},getUploadCancelImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-upload-cancel-image")},getUploadFileUrl:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)+"&xsrf="+bizagi.getXSRFToken()},downloadFile:function(e){var t=this,i=t.getUploadFileUrl(e);return $.ajax({url:i,type:"GET",queue:e.queue,dataType:"binary",processData:!1}).then((function(e){if("application/json"==e.type)return t.readFileAsJSON(e);if("string"==typeof e){var i=arguments[2],r=i.getResponseHeader("Content-type");e=bizagi.util.media.byteArrayToBlob(t.stringToByteArray(e),r)}return e}))},readFileAsJSON:function(e){var t=new $.Deferred,i=new FileReader;return i.onloadend=function(){t.reject({responseText:i.result})},i.readAsText(e),t.promise()},stringToByteArray:function(e){return bizagi.util.stringToByteArray(e)},getUploadFileEntityUrl:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)},getUploadAddUrl:function(){var e=this.serviceLocator.getUrl("render-upload-add-url"),t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDFILE",this.verifyPathToBase(bizagi.services.ajax.pathToBase,e)+"?"+jQuery.param(t)},getUploadAddFileUrl:function(e){var t=this.serviceLocator.getUrl("form-submit-data-upload"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=!0===e?"SAVEUSERIMAGE":"savefile",this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)},deleteImage:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="DELETEUSERIMAGE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing image '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},deleteUploadFile:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing file in upload '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-upload-delete-url"),data:t,type:"POST",dataType:"json"})},getECMMetadata:function(e){var t=e.extra||{};return t.action="getECMMetadata",t.idFileUpload=e.idFileUpload,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,t.xPath=e.xPath,t.idAttrib=e.idAttrib,e.sessionId&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),bizagi.debug("Get file metadata '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},checkOutFile:function(e){var t=e.extra||{};return t.action="checkOutFile",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},cancelCheckOut:function(e){var t=e.extra||{};return t.action="cancelCheckOut",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},deleteECMFile:function(e){var t=e.extra||{};return t.action="delete",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("delete file'"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMFileContent:function(e){var t=e.extra||{};return t.action="updateECMFileContent",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file content '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMMetadata:function(e){var t=e.extra||{};return t.action="updateECMMetadata",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file meta data '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getFileProperties:function(e){var t=e.extra||{};return t.action="getFileProperties",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Get file properties '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},getFile:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},getAllDocuments:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),i={};return i.contextXpath=e.xpathContext,i.xpathAttribute=e.xpath,i.idCase=e.idCase,i.idWorkItem=e.idWorkItem,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},getUploadFileEntity:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},uploadECMFile:function(e){var t=e.extra||{};return t.action="uploadECMFile",t.fileUpload=e.fileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.fileName=e.fileName,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Upload ECM file '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getECMFileUrl:function(e){var t=e.url||this.serviceLocator.getUrl("render-ecm-upload-url")+"File",i=e.extra||{};return i.action="viewECMFile",i.idFileUpload=e.idFileUpload,i.xPath=e.xPath,i.idAttrib=e.idAttrib,i.fileName=e.fileName,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i.xpathContext=e.xpathContext,e.sessionId&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.p_sessionId&&(i.p_sessionId=e.p_sessionId),bizagi.debug("View uploaded file '"+e.xPath+"'",i),this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)+"&xsrf="+bizagi.getXSRFToken()},isFileOnECM:function(e){var t={action:"isFileOnECM"};return t.idUpload=e.idUpload,$.read(this.serviceLocator.getUrl("render-ecm-upload-url"),t)},editGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EDITRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending edit request for relation '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-edit-url"),data:t,type:"POST",dataType:"json",serviceType:"EDITRELATION"})},addGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Sending add request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATION"})},addGridRecordData:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATIONWITHDATA",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype);var i=this.processDataValues(e.submitData||{});for(key in i)t[key]=i[key];return bizagi.debug("Sending add request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-add-url"),data:t,type:"POST",dataType:"json",serviceType:"ADDRELATIONWITHDATA"})},saveGridRecord:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disableServerGridValidations"]=e.disableServerGridValidations||!1,e.submitData.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var i=e.submitData||{};for(key in i=this.processDataValues(i))t[key]=i[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVERELATION"})},deleteGridRecord:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending delete request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"REMOVERELATION"})},getFlipAssociation:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.id,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="flipped",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"flipstate"]=e.flipstate,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending request for flip association control '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:t,type:"POST",dataType:"text"}).pipe((function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}}))},rollbackGridAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ROLLBACK",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-rollback-url"),data:t,type:"POST",dataType:"json",serviceType:"ROLLBACK"})},getSearchDefaultImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-search-default-image")},processDataCriteria:function(e){var t;for(t in e=$.extend(!0,[],e))e.hasOwnProperty(t)&&e[t].hasOwnProperty("value")&&"object"==$.type(e[t].value)&&e[t].value.hasOwnProperty("id")&&e[t].value.hasOwnProperty("label")&&(e[t].value=e[t].value.id);return e},submitSearch:function(e){var t,i=e.extra||{},r=e.sort&&""!==e.sort?e.sort:"";return e.order&&""!==e.order&&""!==r&&(r+=" "+e.order),i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHENTITYFORRENDER",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=r,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"pageSize"]=e.rows,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,t=this.processDataCriteria(e.criteria),i[this.Class.BA_ACTION_PARAMETER_PREFIX+"searchCriteria"]=JSON.encode(t),e.allowFullSearch&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"allowFullSearch"]=e.allowFullSearch),e.maxRecords&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxRowsAllowed"]=e.maxRecords),bizagi.debug("Performing advanced search",i),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-search-advanced-url"),data:i,type:"POST",dataType:"json",serviceType:"SEARCHENTITYFORRENDER"})},associateStakeholder:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey,t.associatedUser=e.associatedUser,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity,bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:e.dataType||"json"})},refreshAssociateStakeholder:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Property refresh for '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-stakeholder-associated"),data:t,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getLetterNotEditableUrl:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache;var i=e.url||this.serviceLocator.getUrl("render-letter-notEditable-url");return this.verifyPathToBase(bizagi.services.ajax.pathToBase,i)+"?"+jQuery.param(t)},getLetterContent:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-letter-content-url"),data:t,type:"POST",dataType:"html"}).pipe((function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}}))},getCanGenerateLetter:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CANGENERATELETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:this.serviceLocator.getUrl("render-letter-content-url"),data:t,type:"POST",dataType:"json"})},saveLetterContent:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="UPDATELETTER",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache;var i=e.content||"",r=(e.url||this.serviceLocator.getUrl("render-letter-save-url"))+"?"+jQuery.param(t);return bizagi.debug("Save request for letter sent to: "+r,i),e.prepare?t:$.ajax({url:r,data:i,type:"POST",dataType:"html"})},getLetterEditorIconsPath:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-letter-content-icons")},executeButton:function(e){return this.getPropertyData($.extend(e,{property:"buttonRule"}))},getFilePrint:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="data",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},editLinkForm:function(e){return this.editGridRecord(e)},saveLinkForm:function(e){var t=e.extra||{};t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVEFORMLINKRELATION",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.submitData.idPageCache&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var i=e.submitData||{};for(key in i=this.processDataValues(i))t[key]=i[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-save-url"),data:t,type:"POST",dataType:"json",serviceType:"SAVEFORMLINKRELATION"})},rollbackLinkForm:function(e){return this.rollbackGridAction(e)},commitLinkForm:function(e){return this.commitGridAction(e)},sendCheckpoint:function(e){return this.sendCheckpointAction(e)},getUserfieldDefinition:function(e){return e=e||{},this.userfieldRequests[e.userfield]?this.userfieldRequests[e.userfield]:(this.userfieldRequests[e.userfield]=$.read(this.serviceLocator.getUrl("render-userfield-definition"),{guidUserfield:e.userfield,device:e.device||"desktop"}),this.userfieldRequests[e.userfield])},refreshControl:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESH",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",serviceType:"PARTIALREFRESH"})},refreshGridCell:function(e){e=e||{};var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESHGRIDCELL",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidcolumn"]=e.column,e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.idForm&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.typeRender&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"typeRender"]=e.typeRender),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json"})},executeRule:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTERULE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidrule"]=e.rule||"",e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeInterface:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEINTERFACE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidinterface"]=e.interface||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeSAPConnector:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTESAP",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidsap"]=e.guidsap||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executeConnector:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTECONNECTOR",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidConnector"]=e.guidConnector||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},executePipeline:function(e){var t={};return e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEPIPELINE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidpipeline"]=e.pipeline||"",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?t:$.create(this.serviceLocator.getUrl("form-submit-data"),t)},generateDocumentTemplate:function(e){return(e=e||{}).append=!!e.append&&e.append,$.create(this.serviceLocator.getUrl("render-document-generate"),{h_pageCacheId:e.idPageCache,contextXpath:e.xpathcontext,groupMappingId:e.groupMapping,xpathAttribute:e.xpath,append:e.append,controlId:e.id})},getAllDocumentsDownloadUrl:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),i={};return i.h_pageCacheId=e.idPageCache,i.contextXpath=e.xpathContext,i.xpathAttribute=e.xpath,i.idCase=e.idCase,i.idWorkItem=e.idWorkItem,i.p_sessionId=e.sessionId,this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(i)+"&xsrf="+bizagi.getXSRFToken()},getCaseNumber:function(e){return $.ajax({url:this.serviceLocator.getUrl("case-handler-getCaseSummary").replace("{idCase}",e.idCase)+"?eventAsTasks=false&onlyUserWorkItems=true&mobileDevice="+bizagi.isMobile(),type:"GET",dataType:"json"})},getCaseAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:e.idCase}).pipe((function(e){return e}))},getWorkitems:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getWorkItems"),{idCase:e.idCase,onlyUserWorkItems:e.onlyUserWorkItems||""})},getGridExportFile:function(e){var t=this.serviceLocator.getUrl("render-upload-data-url"),i={};return i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.exportType,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"idForm"]=e.idForm,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?i:$.ajax({url:e.url||t,data:$.param(i),type:"GET",dataType:"binary",processData:!1})},sendEmail:function(e){e=e||{};var t={};if(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"sendEmail",e.xpathContext&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),t[this.Class.BA_ACTION_PARAMETER_PREFIX+"to"]=e.to,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"subject"]=e.subject,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"message"]=e.message,t[this.Class.BA_ACTION_PARAMETER_PREFIX+"selected"]=JSON.encode(e.selected),e.prepare)return t;var i=e.url||this.serviceLocator.getUrl("form-get-data");return $.create(i,t)},invalidatePageCache:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="INVALIDATEPAGECACHE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:t,type:"POST",dataType:"json",serviceType:"INVALIDATEPAGECACHE"})},getUsersList:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList"),e)},getUsersListFromQueryForm:function(e){return $.read(this.serviceLocator.getUrl("render-query-getUsersList"),e)},getUsersListFromPreferences:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-FromPreferences"),e)},getUsersListForXpathIdBossUser:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForXpathIdBossUser"),e)},getUsersListForXpathIdDelegate:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForXpathIdDelegate"),e)},getUsersListForStakeholders:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForStakeholders"),e)},getUsersForAssignation:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersForAssignation"),e)},getUsersForm:function(e){return $.create(this.serviceLocator.getUrl("admin-usersform"),e)},generateDataToSendByEmail:function(e){return e=e||{},$.ajax({url:this.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:e,type:"POST",dataType:"json"})},sendUserEmail:function(e){(e=e||{}).eMailTo,e.subject,e.body;return $.ajax({url:this.serviceLocator.getUrl("admin-sendUserEmail"),data:e,type:"POST",dataType:"json"})},getConfiguration:function(){var e=this.serviceLocator.getUrl("admin-users-config");return $.read(e)},verifyPathToBase:function(e,t){return-1!=t.indexOf("http")&&""!=e?t:e+t},getTemplate:function(e){var t={};e=e||{},t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADTEMPLATE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]="entity",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guid,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isProcessData"]=e.forcePersonalizedColumns,e.templateType&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"templatetype"]=e.templateType),e.templateGuid&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"templateguid"]=e.templateGuid),null!=e.isDefaultTemplate&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isDefaultTemplate"]=e.isDefaultTemplate);var i=bizagi.util.detectDevice();return bizagi.util.isTabletDevice()?i="tablet":bizagi.util.isSmartphoneDevice()&&(i="mobile"),t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=i,e.prepare?t:$.create(this.serviceLocator.getUrl("form-get-data"),t)},hasStartForm:function(e){var t={};return e.guidWFClass&&(t.guidWFClass=e.guidWFClass),$.read(this.serviceLocator.getUrl("render-processes-startform"),t)},getStartForm:function(e){var t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADSTARTFORM",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidprocess"]=e.guidprocess,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=!0,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=this.deviceType,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=this.deviceCode,e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idCase&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idStartScope&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idWorkitem&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.additionalXpaths&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.surrogatedKey&&(t[this.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.surrogatedKey),e.recordXpath&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.mappingstakeholders&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"mappingstakeholders"]=e.mappingstakeholders),$.ajax({url:this.serviceLocator.getUrl("form-get-data"),data:t,type:"POST",dataType:"json",cache:!0})},editActionForm:function(e){return this.editGridRecord(e)},getActions:function(e){var t=$.extend(e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.ptags&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.pmaxitems&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxitems"]=e.pmaxitems),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},executeActions:function(e){var t=$.extend({},e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.pguidConstructor&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidConstructor"]=e.pguidConstructor),e.pguidAction&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidAction"]=e.pguidAction),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getPolymorphicActions:function(e){var t=$.extend(e,{prepare:!0}),i=this.getPropertyData(t)||[];return e.ptags&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.additionalXpaths&&(i[this.Class.BA_ACTION_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.prepare?i:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:i,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},serializePolymorphicActions:function(e){var t=[],i=function t(i){i=i||{};var r="";return $.each(e,(function(e,a){a[0]==i[6]&&(r+=t(a)+a[1]+" > ")})),r};return function t(r,a){var n,o=function(t){var i=[];return t=t||"",$.each(e,(function(e,r){r[6]==t&&i.push(r)})),i}(a);return $.each(o,(function(e,a){var o=t([],a[0]);(""!==(n={guidEntity:a[0],displayName:a[1],hasConstructor:!!a[5],type:a[3],guidObject:a[4],guidConstructor:a[5],xpathContext:a[2],children:o,parents:i(a)}).guidConstructor||n.children.length>0)&&r.push(n)})),r}(t,""),t},getEntityImage64:function(e){var t={width:e.data,height:e.height,xpath:e.xpath},i=this.serviceLocator.getUrl("render-entity-layout-image64").replace("{entity}",e.entity).replace("{surrogateKey}",e.surrogateKey);return $.ajax({url:i,data:t})},getFilesDataForLayoutUploadControl:function(e){return $.read(this.serviceLocator.getUrl("render-entity-layout-upload-files"),e)},processUploadFile:function(e){return $.ajax({url:this.verifyMobilePathToBase(bizagi.services.ajax.pathToBase||"",e.url),data:e.formData,type:"POST",contentType:!1,processData:!1})},commitGridAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="COMMIT",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-commit-url"),data:t,type:"POST",dataType:"json",serviceType:"COMMIT"})},sendCheckpointAction:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CHECKPOINT",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending checkpoint request for grid '"+e.xpath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-grid-checkpoint-url"),data:t,type:"POST",dataType:"json",serviceType:"CHECKPOINT"})},verifyMobilePathToBase:function(e,t){return bizagi.util.isMashupContext()?(t||"").replaceAll(e,""):t}}),$.Class.extend("bizagi.render.services.multiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(e,t,i){this.service=e,this.serviceLocator=e.serviceLocator,this.batch={},this.batchTimer=50,this.maxNumberOfActions=t||0,this.queue=i||null,this.deferredBatchExecuting=$.Deferred(),this.deferredBatchExecuting.resolve(),this.disabledRequests=!1,this.circularDependencies=new bizagi.circularDependencies,this.replicateServiceMethods()},getService:function(){return this.service},replicateServiceMethods:function replicateServiceMethods(){var self=this;for(var key in this.service.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"multiaction"!=key&&(self[key]=eval("var tmp = function(){ return this.proxyMethod(this.getService()."+key+", arguments);};tmp"))},proxyMethod:function(e,t){var i=this.service;if(!t||1!=t.length)return e.apply(i,t);if("object"!=_typeof(t[0]))return e.apply(i,t);var r=t[0];if(1==r.prepare)return e.apply(i,t);var a=r.prepare;r.prepare=!0;var n=e.apply(i,t);return void 0===a||null==a?delete r.prepare:r.prepare=a,this.add(n)},makeCircularDependenciesError:function(e){var t=bizagi.localization.getResource("render-actions-loop-validation");return printf(t,e.dependencyFrom,e.dependencyTo)},add:function(e){var t=this,i=new $.Deferred,r=e.h_action||"unnamed";["PROCESSPROPERTYVALUE","LOADTEMPLATE","ADDRELATIONWITHDATA","GETFILE"].indexOf(r)<0&&bizagi.override.detectCircularDependencies&&t.circularDependencies.addNode(r,e),clearTimeout(t.batchTimeout);var a=e.tag=Math.guid(),n={action:e,deferred:i};t.batch[a]=n;var o=function(){var e=t.circularDependencies.resolve();if(e.error){for(var i in t.batch){var r=e.error.multiactionError;t.batch[i].deferred.reject(r)}t.batch={}}else t.disabledRequests||(t.deferredBatchExecuting=t.fire())};return t.batchTimeout=setTimeout(o,t.batchTimer),0!=t.maxNumberOfActions&&Object.keys(t.batch).length>=t.maxNumberOfActions&&(clearTimeout(t.batchTimeout),o()),i.promise()},fire:function(){var e={},t=[];return $.each(this.batch,(function(i,r){t.push(r.action),e[i]=r})),this.batch={},$.when(this.execute({actions:t,rejectDeferreds:!1})).done((function(t){$.each(t,(function(t,i){var r=i.tag;i.error?e[r].deferred.reject(i.error,i,i.error.message):e[r].deferred.resolve(i.result),delete e[r]})),$.each(e,(function(e,t){t.deferred.reject({type:"not-processed",message:"Operation didn't executed"},"","Operation didn't executed")}))})).fail((function(t,i,r){var a=void 0!==r?r.message:r||"Operation didn't executed";$.each(e,(function(e,t){t.deferred.reject({type:"not-processed",message:a},"","Operation didn't executed")}))}))},execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,(function(e,i){i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=i.tag||e,delete i.tag})),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action",r);var n=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction"),data:r,queue:this.queue,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){e.renderingService=!0,bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done((function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void n.reject(t.error,"servererror",t)}n.resolve(e)})).fail((function(e){var t=e.responseText||e,i={};try{i=JSON.parse(t)}catch(e){}n.reject(e,"servererror",i)})),n.promise()},disableRequests:function(){this.disabledRequests=!0},validateIfBatchIsExecuting:function(){return this.deferredBatchExecuting}}),bizagi.render.services.multiactionservice.extend("bizagi.render.services.metadatamultiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"h_pageCacheId"},{execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,(function(e,i){i[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=i.tag||e,i[t.Class.BA_PAGE_CACHE]&&(r[t.Class.BA_PAGE_CACHE]=i[t.Class.BA_PAGE_CACHE]),delete i[t.Class.BA_PAGE_CACHE],delete i.tag})),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action metadata",r);var n=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction-metadata"),data:r,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done((function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void n.reject(this,"servererror",t)}n.resolve(e)})).fail((function(e){var t,i=e.responseText||e;try{t=JSON.parse(i)}catch(e){}n.reject(e,"servererror",t)})),n.promise()}}),$.Class.extend("bizagi.command.controllers.controller",{THROW_ERROR:!0},{init:function(e){this.form=e,this.dateFormat=e.getResource("dateFormat")},buildConditions:function(e,t,i,r){var a=e.expressions&&e.expressions.length>1?this.buildConditionOperator(e.operator):e.operator;if(r=r||[],t=t||!1,i=i||!1,"true"==a)return"true";if("false"==a)return"false";for(var n="",o=0;o<e.expressions.length;o++){var s=e.expressions[o];if(s.simple){var l=this.searchGridReferenceInCondition(s.simple);n+=this.buildSimpleCondition(s.simple,l,i,r)}else s.complex&&(n+="("+this.buildConditions(s.complex,t,i,r)+") ");n+=o<e.expressions.length-1?a:""}return n},buildConditionOperator:function(e){return"and"==e?" && ":"or"==e?" || ":e},buildSimpleCondition:function(e,t,i,r){var a,n,o="",s=e.operator,l="",d="";t=t||!1,i=i||!1;var u=e.xpath&&e.renderId?e.xpath+"."+e.renderId:e.xpath||e.renderId||e.containerId;if(t&&e.containerId){var c=this.processGridXpath(e.xpath);u=c.gridXpath+"."+e.containerId+"[]."+c.remainingXpath+"."+e.renderId}r.includes(u)||r.push(u);var p=this.detectConditionArgumentType(u,e.argumentType);if(a=this.buildXpath(u,p,t),"boolean"!=p&&(l+="!bizagi.util.isEmpty("+a+") && "),i&&u&&u.length>0&&!{boolean:""}.hasOwnProperty(p)&&(d="self.isVisible('"+u+"') && self.isEditable('"+u+"') && "),bizagi.util.isEmpty(e.argument)?""===e.argument&&(o='""'):(o=this.buildArgument(e.argument,p,t),"xpath"==p&&(l+="!bizagi.util.isEmpty("+o+") && ")),"includes"==s)return d+l+"self.includes("+a+","+o+") ";if("changes"==s)return bizagi.override&&!bizagi.override.enableActionIsChangedSupport?"self.isChanged("+a+", params.changed)":t?"self.isGridColumnChanged("+a+", params,'"+u+"')":"self.isControlChanged("+a+", params,'"+u+"')";if("equals"==s)return d+l+a+" == "+o;if("not-equals"==s)return d+a+" != "+o;if("less-than"==s)return d+l+a+" < "+o;if("less-equals-than"==s)return d+l+a+" <= "+o;if("greater-than"==s)return d+l+a+" > "+o;if("greater-equals-than"==s)return d+l+a+" >= "+o;if("like"==s)return d+l+a+".toString().indexOf("+o+") >= 0 ";if("is-empty"==s)return"entity"!=p?d+"bizagi.util.isEmpty("+a+")":d+"("+a+" == 0 || bizagi.util.isEmpty("+a+"))";if("is-not-empty"==s)return"entity"!=p?d+"!bizagi.util.isEmpty("+a+")":d+"("+a+" != 0 && !bizagi.util.isEmpty("+a+"))";if("is-true"==s)return d+"( "+a+" == true || "+a+" == 'true' )";if("is-false"==s)return d+"( "+a+" == false || "+a+" == 'false' || "+a+" == 'False' )";if("does-not-contain"==s)return d+"(bizagi.util.isEmpty("+a+") || "+a+".toString().indexOf("+o+") < 0 )";if("contains"==s)return d+l+a+".toString().indexOf("+o+") >= 0 ";if("begins-with"==s)return d+l+a+".toString().startsWith("+o+") == true ";if("does-not-begins-with"==s)return d+l+a+".toString().startsWith("+o+") == false ";if("file-uploaded"==s)return n=u,t&&n&&(n=n.replaceAll("[]","[' + i + ']")),d+"self.isFileUploaded('"+n+"') ";if("file-not-uploaded"==s)return n=u,t&&n&&(n=n.replaceAll("[]","[' + i + ']")),d+"!self.isFileUploaded('"+n+"') ";if("is-invalid-email"==s)return d+"!self.isValidEmail("+a+") ";if("letter-edited"==s)return"false";if("letter-not-edited"==s)return"false";if("cell-change"==s)return"column == "+o;if("on-press"==s)return t?"self.isGridButtonPressed("+this.buildXpath(u,"id",t)+", params.pressed)":"self.isButtonPressed('"+u+"', params.pressed)";if("on-load"==s)return"true";if("on-deleted-row"==s)return"self.onDeletedGridRow('"+(n=u||"")+"', params.rowDeleted)";throw new"There is no implementation for operator code "+s},detectConditionArgumentType:function(e,t){if(void 0===t||"const"==t){var i=this.form,r=i.getRender(e)||i.getRenderById(e);if(null==r){if(bizagi.override&&bizagi.override.breakActionWithUnavailableRenders)throw new Error("RenderNotFoundException in method detectConditionArgumentType of bizagi.command.controllers.controller");return"text"}if("grid"==r.properties.type){var a=this.processGridXpath(e);if(""===a.remainingXpath)return"xpath";if(null==(r=r.getColumn(a.remainingXpath)))throw new Error("RenderNotFoundException in method detectConditionArgumentType of bizagi.command.controllers.controller")}var n=r.properties.dataType,o=bizagi.util.normalizeType(r.properties.type);return this.isRelatedEntityRender(o)?"entity":1==n||2==n||3==n||4==n||6==n||7==n||10==n||11==n?"number":8==n?"money":12==n||13==n?1==r.properties.showTime?"datetime":"date":5==n?"boolean":"button"==o?"button":"form"===o||/queryForm/i.test(o)?"form":"text"}return"xpath"==t||"function"==t||"entity"==t?t:"text"},isRelatedEntityRender:function(e){return["combo","list","radio","search","searchCombo","columnCombo","columnSearch","queryMultiSelect"].includes(e)||/^cascadingcombo$/i.test(e)},buildXpath:function(e,t,i){return(i=i||!1)&&(e=e.replaceAll("[]","[' + i + ']")),"xpath"!=t||i?"id"==t?"'"+e+"'":"function"==t?"self.evalXpath('"+e+"', '"+this.detectConditionArgumentType(e,"const")+"')":i?"self.evalGridXpath(params, '"+e+"', '"+t+"')":"self.evalXpath('"+e+"', '"+t+"')":"self.evalXpath('"+e+"', '"+this.detectConditionArgumentType(e,"const")+"')"},buildArgument:function buildArgument(argument,argumentType,bGridDetected,xpathContext){var self=this,number;if(bGridDetected=bGridDetected||!1,"text"==argumentType)return argument=null==argument?"":argument,argument="string"!=typeof argument?argument.toString():argument,-1!=argument.indexOf("'")&&(argument=argument.replaceAll("'","\\'")),-1!=argument.indexOf("\n")&&(argument=argument.replaceAll("\n","")),"'"+argument.toString()+"'";if("boolean"==argumentType)return"string"==typeof argument?"Default"==argument?argument:1==eval(argument.toLowerCase())?"true":"false":1==eval(argument)?"true":"false";if("number"==argumentType)return number=new Number(argument),NaN==number?"-99999999":number.toString();if("money"==argumentType)return number=new Number(argument),NaN==number?"-99999999":number.toString();if("date"==argumentType){var date=bizagi.util.dateFormatter.getDateFromInvariant(argument);return date&&0!=date||(date=new Date(0)),date.setHours(0,0,0,0),"bizagi.util.dateFormatter.getDateFromInvariant('"+bizagi.util.dateFormatter.formatInvariant(date)+"').setHours(0,0,0,0)"}if("datetime"==argumentType){var date=bizagi.util.dateFormatter.getDateFromInvariant(argument,!0);return date&&0!=date||(date=new Date(0)),date.setMilliseconds(0),"bizagi.util.dateFormatter.getDateFromInvariant('"+bizagi.util.dateFormatter.formatInvariant(date,!0)+"', true).getTime()"}if("color"==argumentType)return"'"+argument.toString()+"'";if("entity"==argumentType){if(bizagi.util.isEmpty(argument))return null;try{argument="object"!=_typeof(argument)?JSON.parse(argument):argument}catch(e){argument=argument||{}}if(argument&&argument.id)result=argument.id;else if(argument&&Array.isArray(argument.value))var result=argument.value.map((function(e){return e.id}));else result=argument.id||argument;return JSON.stringify(result)}if("xpath"==argumentType){var xpath=argument.toString();return bGridDetected=self.searchGridReferenceInXpath(xpath),bGridDetected&&(xpath=xpath.replaceAll("[]","[' + i + ']")),xpathContext&&(xpath=xpathContext+"."+xpath),self.buildXpath(xpath,argumentType,bGridDetected)}if("json"==argumentType)return JSON.encode(argument);if("function"==argumentType){if("BAToday"==argument)return"self.getCurrentDate()";if("BANow"==argument)return"self.getCurrentDate(true)";throw"There is no implementation for function "+argument}if(null==argumentType)return null;throw"There is no implementation for argument type "+argumentType},isEditable:function(e){var t=this.getRender(e);if(null!=t)return t.properties.editable;this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},isVisible:function(e){var t=this.getRender(e);if(null!=t){if(t.properties.visible)return this.isParentVisible(t.parent);var i=bizagi.util.normalizeType(t.properties.type);return!!/^hidden$/i.test(i)}this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},isParentVisible:function(e){return e.parent?!!e.properties.visible&&this.isParentVisible(e.parent):e.properties.visible},evalGridXpath:function evalGridXpath(params,xpath,argumentType){var self=this;if(void 0===params)return this.evalXpath(xpath,argumentType);var grid=params.grid;if(null==grid)return self.Class.THROW_ERROR&&self.showRenderNotFoundError(xpath),null;var gridXpath=self.processGridXpath(xpath),gridColumn=grid.getColumn(gridXpath.remainingXpath);if(!gridColumn)return!1;var cellValue=grid.getCellCurrentValue(gridXpath.index,gridXpath.remainingXpath);return"columnRadio"==gridColumn.properties.type&&(cellValue&&!bizagi.util.isString(cellValue)?cellValue=cellValue.length>0&&cellValue[0].length>0?cellValue[0][0]:cellValue.id:bizagi.util.isString(cellValue)||(cellValue=0)),"columnCombo"==gridColumn.properties.type&&(cellValue=cellValue&&cellValue.id?cellValue.id:0),"columnSearch"==gridColumn.properties.type&&(cellValue=cellValue&&cellValue.id?cellValue.id:0),"columnDate"==gridColumn.properties.type&&cellValue&&(cellValue=gridColumn.properties.showTime?bizagi.util.dateFormatter.getDateFromInvariant(cellValue):bizagi.util.dateFormatter.getDateFromInvariant(cellValue).setHours(0,0,0,0)),bizagi.util.isEmpty(cellValue)&&"boolean"==argumentType?"check"!=gridColumn.properties.display&&null:"boolean"==argumentType?eval(self.buildArgument(cellValue,argumentType)):cellValue},evalXpath:function evalXpath(xpath,argumentType){var self=this,i,renderToEval,renders=self.getRenders(xpath);if(null==renders)return self.Class.THROW_ERROR&&self.showRenderNotFoundError(xpath),null;var rendersToEval=[];for($.each(renders,(function(e,t){t.properties.editable&&rendersToEval.push(t)})),0===rendersToEval.length&&$.each(renders,(function(e,t){rendersToEval.push(t)})),i=0;i<rendersToEval.length;){renderToEval=rendersToEval[i++];var bIsGrid="grid"==renderToEval.properties.type;if(bIsGrid){var gridXpath=self.processGridXpath(xpath),gridColumn=renderToEval.getColumn(gridXpath.remainingXpath);if(!gridColumn)continue;var cellValue=renderToEval.getCellCurrentValue(gridXpath.index,gridXpath.remainingXpath);return"columnRadio"==gridColumn.properties.type&&(cellValue&&!bizagi.util.isString(cellValue)?cellValue=cellValue.length>0&&cellValue[0].length>0?cellValue[0][0]:cellValue.id:bizagi.util.isString(cellValue)||(cellValue=0)),"columnCombo"!=gridColumn.properties.type&&"columnSearch"!=gridColumn.properties.type&&"columnList"!=gridColumn.properties.type||(cellValue&&cellValue.id?cellValue=cellValue.id:"number"!=typeof cellValue&&"string"!=typeof cellValue&&(cellValue=0)),bizagi.util.isEmpty(cellValue)&&"boolean"==argumentType?"check"!=gridColumn.properties.display&&null:"boolean"==argumentType||"date"==argumentType&&!bizagi.util.isEmpty(cellValue)?eval(self.buildArgument(cellValue,argumentType)):(void 0!==gridColumn&&void 0!==gridColumn.properties&&void 0!==gridColumn.properties.type&&"columnDate"==gridColumn.properties.type&&(cellValue=self.getColumnDateCorrectFunction(cellValue,gridColumn.properties.showTime)(cellValue)),cellValue)}var value=renderToEval.getValue(),renderType=bizagi.util.normalizeType(renderToEval.properties.type||"");return void 0===argumentType||"undefined"===argumentType?value:((["combo","list","search","radio"].includes(renderType)||/^cascadingcombo$/i.test(renderType))&&(bizagi.util.isEmpty(value)||""==value.id)&&(value=0),/^queryMultiSelect$/i.test(renderType)?renderToEval&&renderToEval.mapValue(value):"comboSelected"===renderType?"string"==typeof value?JSON.parse(value).value:value:bizagi.util.isEmpty(value)?("boolean"!==renderType||"check"!==renderToEval.properties.display)&&value:"xpath"===argumentType?eval(self.buildArgument(xpath,argumentType)):eval(self.buildArgument(value,argumentType)))}},isFileUploaded:function(e){var t=this.evalXpath(e);return!!(t&&t.length&&t.length>0)},isValidEmail:function(e){return!(!e||!e.match(new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/gi)))},isButtonPressed:function(e,t){var i=this.getRenderById(e);return!(null==i||!/^button$/i.test(bizagi.util.normalizeType(i.properties.type)))&&t},isGridButtonPressed:function(e,t){var i=this.processGridXpath(e),r=i.gridXpath,a=this.getRender(r),n=i.remainingXpath||"";return t&&a&&a.columns&&$.each(a.columns,(function(e,i){i.properties.xpath!==n&&i.properties.id!==n||"columnButton"!==i.properties.type||(t=!0)})),t},isChanged:function(e,t){return null!=e&&t},isControlChanged:function(e,t,i){if(null==e)return!1;if(t.changed){var r=this.getRender(i),a=t.render;return null!=r&&null!=a&&(a.properties.id===r.properties.id&&a.properties.xpath===r.properties.xpath)}return!1},isGridColumnChanged:function(e,t,i){if(null==e)return!1;if(t.changed){var r=this.processGridXpath(i),a=r.gridXpath,n=this.getRender(a);if(null==n)return!1;var o=r.remainingXpath||"",s=t.id?t.render.getColumnById(t.id):t.render.getColumn(t.column),l=n.getColumn(o);return!(!l||!s)&&(l.properties.xpath===s.properties.xpath&&l.properties.id===s.properties.id)}},includes:function(e,t){return null!=e&&(null!=t&&$.grep(e,(function(e){return e.id==t})).length>0)},onDeletedGridRow:function(e,t){return!(!(this.getRender(e)||{})||!t)},getRenders:function(e){var t=this.form,i=null,r=/id=([\w-]+)/gi.exec(e);if(r&&r.length>1){var a=this.getRenderById(r[1]);return a?0==a.length?null:((i=[]).push(a),i):null}return 0==(i=t.getRenders(e)).length?null:i},getRender:function(e){return this.form.getRender(e)},getRenderById:function(e){return this.form.getRenderById(e)},showRenderNotFoundError:function(e){bizagi.debug("Cannot find render in DOM: "+e)},showContainerNotFoundError:function(e){bizagi.debug("Cannot find container in DOM: "+e)},getCurrentDate:function(e){var t=new Date,i=bizagi.util.dateFormatter.getDateFromInvariant(bizagi.util.dateFormatter.formatInvariant(t));return e||!i||isNaN(Date.parse(i))||$.isNumeric(i)||i.setHours(0,0,0,0),i.getTime()},processGridXpath:function(e){var t,i,r,a=new RegExp(/([\w\.-]*)\[(\d*)\]\.([\w\.|\w-\.]*)/g).exec(e);return a?(r=a[1],t=a[2],i=a[3]):(t="",i=""),{xpath:e,index:t,remainingXpath:i,gridXpath:r}},searchForGridReference:function(e,t){var i;if(e)return this.searchGridReferenceInCondition(e);if(t)for(i in t){var r=t[i];return this.searchForGridReferenceInCommand(r)}return null},searchForGridReferenceInCommand:function(e){return e.xpath&&e.xpath.indexOf("[]")>0?e.xpath.substring(0,e.xpath.indexOf("[]")):e.renderId&&e.renderId.indexOf("[]")>0?e.renderId.substring(0,e.renderId.indexOf("[]")):"xpath"==e.argumentType&&e.argument.indexOf("[]")>0?e.argument.substring(0,e.argument.indexOf("[]")):void 0},searchGridReferenceInCondition:function(e){var t;if("string"==typeof e||"boolean"==typeof e)return null;if(e.expressions){for(i in e.expressions)if(e.expressions.hasOwnProperty(i)&&(t=this.searchGridReferenceInCondition(e.expressions[i])))return t}else{if(e.simple)return this.searchGridReferenceInCondition(e.simple);if(e.complex)return this.searchGridReferenceInCondition(e.complex);if(e.xpath||e.renderId){if(t=this.searchGridReferenceInXpath(e.xpath)||this.searchGridReferenceInXpath(e.renderId))return t;if("xpath"==e.argumentType&&(t=this.searchGridReferenceInXpath(e.argument)))return t}}return null},searchGridReferenceInXpath:function(e){return e&&e.indexOf("[]")>0?e.substring(0,e.indexOf("[]")):null},getGridControl:function(e,t){var i=this.processGridXpath(e).remainingXpath;return this.getRender(e).getControlCell(t,i)},getColumnDateCorrectFunction:function(e,t){return e?e&&t?this.getColumnDateValueDateAndTime:e&&!t?this.getColumnDateValueOnlyDate:e:this.getColumnDateValueForNoValue},getColumnDateValueForNoValue:function(e){return bizagi.util.dateFormatter.getDateFromInvariant(e)},getColumnDateValueOnlyDate:function(e){return bizagi.util.dateFormatter.getDateFromInvariant(e).setHours(0,0,0,0)},getColumnDateValueDateAndTime:function(e){return bizagi.util.dateFormatter.getDateFromInvariant(e,!0).getTime()}}),bizagi.command.controllers.controller.extend("bizagi.command.controllers.validation",{},{init:function(e,t,i){this.enableDebug=!1,this._super(e),this.initializeValidations(i,t)},initializeValidations:function(e,t){var i=this,r=$("<div />").appendTo(e);$.widget("ui.bizagi_notifications",$.ui.bizagi_notifications,{expand:function(){this._super(),i.form.triggerGlobalHandler("modalViewDidAppear",{})},collapse:function(){this._super(),i.form.triggerGlobalHandler("modalViewDidDisappear",{})},hide:function(){this._super(),i.form.triggerGlobalHandler("modalViewDidDisappear",{})}}),r.bizagi_notifications({itemIcon:"ui-icon-circle-close",minimized:!1,clearEnabled:!1,title:bizagi.localization.getResource("render-form-validations-header-text"),device:bizagi.util.detectDevice(),orientation:i.form.properties.orientation}),r.bind("itemClick",(function(e,t){i.onNotificationClick(t.data)})),t&&i.buildValidations(t),i.validationBox=r,i.validations=t||[]},buildValidations:function(e){var t=this,i=t.buildAllValidations(e);t.form.bind("rendervalidate",(function(){return i(t)}))},showErrorMessage:function(e){bizagi.showErrorAlertDialog=!1,this.showValidationMessage(e,null,"ui-icon-circle-close","ui-state-error")},showAlertMessage:function(e){this.showValidationMessage(e,null,"ui-icon-alert","ui-state-highlight")},showInfoMessage:function(e){this.showValidationMessage(e,null,"ui-icon-info","ui-state-highlight")},showValidationMessage:function(e,t,i,r,a,n){var o=this,s=o.form,l=null;l=n?s.getRenderById(n)||null:t?s.getRender(t):null,bizagi.showErrorAlertDialog=!1;var d=function(){o.clearValidationMessages();var e=s?s.getLastActionButton():{};e&&"nextWithoutValidations"===e.action||(o.validating=!0,o.performValidations(),o.validating=!1),0==o.countValidationMessages()?(o.hideValidationMessages(),o.form.triggerGlobalHandler("modalViewDidDisappear",{})):o.form.triggerGlobalHandler("modalViewDidAppear",{})};o.form.triggerGlobalHandler("modalViewDidAppear",{}),o.validationBox.bizagi_notifications("addNotification",e,t,i,r,d,a,n),l&&(l.setValidationMessage(e),bizagi.util.isIE8()||o.validating||l.bind("rendervalidate",(function(){d(),"double"!=l.properties.retype&&l.unbind("rendervalidate")})))},countValidationMessages:function(){return this.validationBox.bizagi_notifications("count")},clearValidationMessages:function(e){return $(".ui-bizagi-notifications-container","body").not(".ui-bizagi-log-container").bizagi_notifications("clearAll",void 0,e)},hideValidationMessages:function(){return this.validationBox.bizagi_notifications("hide")},showValidationMessages:function(){return this.validationBox.bizagi_notifications("show")},expandNotificationBox:function(e){return!1!==e&&this.validationBox.bizagi_notifications("autoFocusFirstError"),this.validationBox.bizagi_notifications("expand")},isExpandedNotificationBox:function(){return this.validationBox.bizagi_notifications("isExpanded")&&this.validationBox.bizagi_notifications("isContentVisible")},performValidations:function(e){this.clearValidationMessages(),this.validationBox.bizagi_notifications("initBatch");var t=this.validateRenders(e),i=!(this.validations.length>0)||this.form.triggerHandler("rendervalidate");return this.validationBox.bizagi_notifications("endBatch"),!(!i||!t)||(this.validationBox.bizagi_notifications("show"),!1)},buildAllValidations:function(e){for(var t="",i=0;i<e.length;i++){if(null==e[i].enabled||e[i].enabled)try{t+=this.buildValidation(e[i].conditions,e[i].validationCommand)}catch(t){"RenderNotFoundException"!=t.message&&bizagi.logError("Validation cannot be parsed: "+t.message,e[i])}}var r="var baTmpFn = function(self, params){\r\n var bValid = true;\r\n "+t+"\r\n return bValid;}; baTmpFn";return this.evalValidation(r)},buildValidation:function(e,t){var i="",r="",a=this.searchForGridReference(e),n=null!=a,o=void 0===bizagi.override.validateEditabilityOnValidations||bizagi.override.validateEditabilityOnValidations;i+="( "+this.buildConditions(e,n,o)+" )",t.message=t.message.replace(/'/g,"\\'"),t.message=t.message.replace(/\n/g," ");var s=t.focus||"";if(n&&(s=a),t.tokens?r+="self.showValidationMessage(' "+t.message+"', '"+s+"', JSON.parse('"+JSON.encode(t.tokens)+"')); bValid = false;\r\n":r+="self.showValidationMessage(' "+t.message+"', '"+s+"'); bValid = false;\r\n",n){var l="var grid = self.form.getRender('"+a+"');\r\n";return l+="if(grid === null) return true;\r\n",l+="var data = grid.getIndexes();\r\n",l+="var bGridValid = true;\r\n",l+="$.each(data, function(_, i) {\r\n",l+="if ("+i+"){\r\n bGridValid = false; \r\n}",l+="});\r\n",l+="if (bGridValid == false){\r\n "+r+"\r\n}"}return"if ("+i+"){\r\n "+r+" \r\n}"},onNotificationClick:function(e){var t=this.form,i=e.focus,r=e.id;if(i){var a=r?t.getRenderById(r):t.getRender(i);a&&a.focus()}},validateRenders:function(e){var t=this;e=e||[];var i=t.form.isValid(e);return i||e.forEach((function(e){e.id?t.showValidationMessageById(e.message,e.xpath,e.id):(e.message||e.xpath)&&t.showValidationMessage(e.message,e.xpath)})),i},evalValidation:function evalValidation(command){var self=this;return self.enableDebug&&null!=console&&console.log(command),eval(command)},showValidationMessageById:function(e,t,i){this.showValidationMessage(e,t,void 0,!1,void 0,i)}}),bizagi.command.controllers.controller.extend("bizagi.command.controllers.action",{overridesInitiated:!1},{init:function(e,t){this.configureOverrides(),this._super(e),this.globalDependencies={},this.initialCallFunctions={},this.funtionsToExecuteARefreshCommand=[],this.initialCallFunctionsDeferred=new $.Deferred,t&&this.buildActions(t),this.actions=t,this.internalSubmitActions={},this.initialCallTimeout=25,this.initialCallIncrements=25,this.actionsHistory={},this.period=50},processInternalSubmitAction:function(e,t){this.internalSubmitActions[e]||(this.internalSubmitActions[e]=t,this.buildAction(t,!0))},isSummaryOrGlobalForm:function(){var e=!1;return"SummaryForm"!==this.form.properties.typeForm&&"GlobalForm"!==this.form.properties.typeForm||(e=!0),e},evalClientAction:function(e){for(var t,i=0,r=!1,a=[].concat(e.commands,e.elseCommands),n=a.length;i<n;i++)if(t=a[i],!this.isClientAction(t)){r=!0;break}r&&(e.enabled=!1)},buildActions:function(e,t){var i,r,a={};this.funtionsToExecuteARefreshCommand=[];var n=this.isSummaryOrGlobalForm();for(i=0,r=e.length;i<r;i++)try{var o=e[i],s=bizagi.util.md5(JSON.stringify(o.conditions)),l=bizagi.util.md5(JSON.stringify(o.commands));a[s]?-1===a[s].indexOf(l)&&(n&&this.evalClientAction(o),this.buildAction(o,t),a[s].push(l)):(n&&this.evalClientAction(o),this.buildAction(o,t),a[s]=[l])}catch(t){"RenderNotFoundException"!==t.message&&bizagi.logError("Action cannot be parsed: "+t.message,e[i])}},unbindActions:function(){$.each(this.globalDependencies,(function(e,t){t.unbind("renderchange.action")})),this.globalDependencies={},$.each(this.initialCallFunctions,(function(e,t){clearTimeout(t)})),this.initialCallFunctions={}},refreshActions:function(e){var t=this;t.initialCallTimeout=25,t.initialCallFunctions={},e=e||[],t.actions=t.actions.concat(e),t.buildActions(t.actions,!0),$.each(t.internalSubmitActions,(function(e,i){try{t.buildAction(i,!1)}catch(e){"RenderNotFoundException"!==e.message&&bizagi.logError("Action cannot be parsed: "+e.message,i)}}))},buildAction:function(e,t){var i=this,r=i.form,a=[],n=[],o=[];if(e.commands=e.commands||[],e.elseCommands=e.elseCommands||[],null==e.enabled||e.enabled){e.conditions&&"true"==e.conditions.operator&&$.each(e.commands,(function(e,t){var r=i.searchGridReferenceInXpath(t.xpath);r&&(o.includes(r)||o.push(r))}));var s=i.buildFunction(e.conditions,e.commands,e.elseCommands,o);if(o)for(var l=0;l<o.length;l++)if(void 0!==o[l]){var d=r.getRenders(o[l]);if(0===d.length){var u=r.getRenderById(o[l]);d=u?[u]:null}d&&($.each(d,(function(e,t){$.inArray(t.properties.id,n)<0&&t.properties.editable&&h(t)})),0===a.length&&h(d[0]))}var c=function(t){this.commandDependencies=e.commands.concat(e.elseCommands).map((function(e){return e.xpath||e.container||e.renderId})),this.commandNames=e.commands.concat(e.elseCommands).map((function(e){return e.command})),this.fn=t};c.prototype={hasDependency:function(e){return null!=e&&this.commandDependencies.indexOf(e)>=0},hasRefreshCommand:function(){return this.commandNames.indexOf("refresh")>=0},execute:function(e){return s(i,e)}},i.funtionsToExecuteARefreshCommand=i.funtionsToExecuteARefreshCommand||[];var p=new c(s);if(p.hasRefreshCommand()||i.funtionsToExecuteARefreshCommand.push(p),$.each(a,(function(r,a){a.bind("renderchange.action",(function(t,r){if((r=r||{}).changed=void 0===r.changed||r.changed,r.column){for(var a=0;a<e.gridColumns.length;a++)if(r.column==e.gridColumns[a])return void s(i,r)}else s(i,r)})),i.globalDependencies[a.properties.id]=a,"grid"===a.properties.type&&(t=!0,e.gridColumns=[],i.searchGridColumns(e.conditions,e.gridColumns))})),!t){!function(e){var t=Math.guid(),i=setTimeout((function(){try{s(e),delete e.initialCallFunctions[t]}catch(e){}finally{clearTimeout(i)}}),e.initialCallTimeout);e.initialCallFunctions[t]=i,e.initialCallTimeout+=e.initialCallIncrements}(i)}}function h(e){var t;t=e.properties.type,-1===["groupedgrid","collectionnavigator"].indexOf(t)&&(n.push(e.properties.id),a.push(e))}},tryToExecuteFunction:function(e){if(bizagi.override&&!0===bizagi.override.enableExecuteRefreshAction)for(var t=0;t<this.funtionsToExecuteARefreshCommand.length;t++){var i=this.funtionsToExecuteARefreshCommand[t];i.hasDependency(e)&&i.execute()}},buildFunction:function buildFunction(conditions,commands,elseCommands,innerDependencies){var self=this,gridReference=self.searchForGridReference(conditions,commands),bGridDetected=null!=gridReference&&gridReference,sJsCondition="",sJsAction="",sStatement,sJsElseAction="",bAutomaticRestore=!elseCommands,bCondition=!!conditions,i;for(bCondition&&(sJsCondition+=self.buildConditions(conditions,bGridDetected,!1,innerDependencies)),i=0;i<commands.length;i++){var queueAction=self.isServerCommand(commands[i])?"addParallel":"add",command=self.buildCommand(commands[i],bGridDetected);command=command.indexOf(";")>=1?command.replace(";",""):command,sJsAction+="actionQueue."+queueAction+"(function(){return "+command+" ;}); \r\n",bAutomaticRestore&&(sJsElseAction+=self.buildRestoreCommand(commands[i],bGridDetected))}if(!bAutomaticRestore){for(sJsElseAction+="var actionQueue = new bizagiQueue(); \r\n",sJsElseAction+="if (params.render){params.render.startActionExecution();} \r\n",i=0;i<elseCommands.length;i++){var queueAction=self.isServerCommand(elseCommands[i])?"addParallel":"add",elseCommand=self.buildCommand(elseCommands[i],bGridDetected);elseCommand=elseCommand.indexOf(";")>=1?elseCommand.replace(";",""):elseCommand,sJsElseAction+="actionQueue."+queueAction+"(function(){return "+elseCommand+" ;}); \r\n"}sJsElseAction+="var execute = actionQueue.execute().always(function(){ \r\n",sJsElseAction+="if (params.render){ params.render.endActionExecution();} \r\n });\r\n",sJsElseAction+="self.form.appendWaitForLoader({ promise: execute, create: true });\r\n"}if(sStatement="var baTmpFn = function(self, params){ \r\n",sStatement+="params = params || {};\r\n",bGridDetected&&(sStatement+="var i = params.key;\r\n",sStatement+="var column = params.column;\r\n"),bCondition&&(sStatement+="if ("+sJsCondition+"){ \r\n"),sStatement+="var actionQueue = new bizagiQueue(); \r\n",sStatement+="if (params.render){params.render.startActionExecution();} \r\n",sStatement+=sJsAction,sStatement+="var execute = actionQueue.execute().always(function(){ \r\n",sStatement+="if (params.render){ params.render.endActionExecution();} \r\n });\r\n",sStatement+="self.form.appendWaitForLoader({ promise: execute, create: true });\r\n",bCondition&&(sStatement+="\r\n } ",sJsElseAction.length>0&&(sStatement+="else { \r\n"+sJsElseAction+" }\r\n")),sStatement+="};\r\n",bGridDetected){var sGridStatement="var baGridTmpFn = function(self, args){ \r\n";sGridStatement+="args = args || {};\r\n",sGridStatement+="\t var grid = args.render || self.form.getRender('"+gridReference+"') || []; \r\n",sGridStatement+="\t grid = grid.grid ? grid : (self.form.getRender('"+gridReference+"') || []); \r\n",sGridStatement+="\t args.grid = grid; \r\n",sGridStatement+="if(args.surrogateKey === undefined){\r\n",sGridStatement+="\t var data = grid.getIndexes();\r\n",sGridStatement+="\t $.each(data, function(i, index) {\r\n",sGridStatement+="\t\t args.key = index; \r\n",sGridStatement+="\t\t baTmpFn(self, args);\r\n",sGridStatement+="\t });\r\n",sGridStatement+="} else {\r\n",sGridStatement+="\t args.key = args.surrogateKey; \r\n",sGridStatement+="\t\t baTmpFn(self, args ); \r\n",sGridStatement+="}\r\n",sGridStatement+="};\r\n",sStatement+=sGridStatement,sStatement+="baGridTmpFn"}else sStatement+="baTmpFn";return eval(sStatement)},isServerCommand:function(e){var t=e.command;return["refresh","submit-data","execute-rule","execute-interface","execute-sap","execute-connector","execute-excel-bot","execute-pipeline"].includes(t)},isClientAction:function(e){var t=e.command;return["background-color","forecolor","visible","required","collapse","set-active"].includes(t)},isRecentAction:function(e,t){var i=this,r=e+"@"+t;return null!=i.actionsHistory[r]||($.when(i.runAction(e,t)).done((function(){delete i.actionsHistory[r],bizagi.log("resolve "+r)})),!1)},runAction:function(e,t){var i=e+"@"+t;this.actionsHistory[i]=new $.Deferred;var r=setTimeout(this.actionsHistory[i].resolve,this.period);return this.actionsHistory[i].done(clearTimeout.bind(null,r)),this.actionsHistory[i].promise()},buildCommand:function(e,t){var i=t=t||!1,r=e.command,a=this.detectCommandArgumentType(e.argumentType,r),n=this.buildArgument(e.argument,a,t,e.xpathContext),o=e.xpath,s=this.searchForGridReferenceInCommand(e);if(s&&e.containerId){var l=this.processGridXpath(o);o=l.gridXpath+"."+e.containerId+"[]."+l.remainingXpath+"."+e.renderId}else o&&e.renderId?o=o+"."+e.renderId:t&&e.renderId?o=e.renderId:e.renderId&&(o="id="+e.renderId);if(t&&o&&(o=o.replaceAll("[]","[' + i + ']")),e.xpath&&e.xpath.length>0||e.renderId&&e.renderId.length>0)switch(r){case"background-color":return"activityFlowButton"===e.controlType?"self.changeButtonBackground('"+o+"', "+n+");":"self.changeRenderBackground('"+o+"', "+n+");";case"forecolor":return"activityFlowButton"===e.controlType?"self.changeButtonForeground('"+o+"', "+n+");":"self.changeRenderForeground('"+o+"', "+n+");";case"visible":return"activityFlowButton"===e.controlType?"self.changeButtonVisibility('"+o+"', "+n+");":"self.changeRenderVisibility('"+o+"', "+n+");";case"readonly":return"activityFlowButton"===e.controlType?"self.changeButtonEditability('"+o+"', "+n+");":"self.changeRenderEditability('"+o+"', '"+n+"');";case"required":return"self.changeRenderRequired('"+o+"', "+n+");";case"set-value":return t&&"xpath"===e.argumentType&&e.xpathContext&&(void 0!==e.xpathContext&&(e.argument=e.xpathContext+"."+e.argument),n=this.buildArgument(e.argument,a,t)),"self.changeRenderValue('"+o+"', "+n+");";case"set-min":return"self.changeRenderMinValue('"+o+"', "+n+");";case"set-max":return"self.changeRenderMaxValue('"+o+"', "+n+");";case"calculate":return"self.executeCalculatedField('"+o+"');";case"submit-value":return"self.submitRender('"+o+"', '"+n+"');";case"clean-data":return"self.cleanRenderData('"+o+"');";case"refresh":return(s=this.searchForGridReferenceInCommand(e))?"self.refreshGridCell('"+o+"', '"+(e.xpathContext||"")+"');":"self.refreshControl('"+o+"', '"+(e.xpathContext||"")+"','"+r+"');";case"trigger-click":return"self.triggerClick('"+o+"');"}else switch(r){case"background-color":return"self.changeContainerBackground('"+e.container+"', "+n+");";case"visible":return"self.changeContainerVisibility('"+e.container+"', "+n+");";case"collapse":return"self.toogleContainer('"+e.container+"', "+!bizagi.util.parseBoolean(n)+");";case"set-active":return"self.changeActiveItem('"+e.container+"');";case"readonly":return"self.changeContainerEditability('"+e.container+"', '"+n+"');";case"refresh":return"self.refreshContainer('"+e.container+"', '"+(e.xpathContext||"")+"');"}if("submit-data"===r)return"self.submitFormData();";if("execute-rule"===r){var d=e.argument||{},u="";try{u=JSON.parse(d).guid}catch(e){}var c=e.xpathContext||"";if(t){var p=i+"[id=%s]";return"self.executeRule('"+u+"', printf('"+p+"',i) ,'"+r+"');"}return"self.executeRule('"+u+"','"+c+"','"+r+"');"}if("execute-interface"===r){var h=e.argument||{},g="";try{g=JSON.parse(h).guid}catch(e){}return c=e.xpathContext||"",t?"self.executeInterface('"+g+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executeInterface('"+g+"','"+c+"');"}if("execute-sap"===r){var m=e.argument||{},f="";try{f=JSON.parse(m).guid}catch(e){}return c=e.xpathContext||"",t?"self.executeSAPConnector('"+f+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executeSAPConnector('"+f+"','"+c+"');"}if("execute-connector"===r||"execute-excel-bot"===r){m=e.argument||{};var b="";try{b=JSON.parse(m).guid}catch(e){}return c=e.xpathContext||"",t?"self.executeConnector('"+b+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executeConnector('"+b+"','"+c+"');"}if("execute-pipeline"===r){var v=e.argument||{},y="";try{y=JSON.parse(v).guid}catch(e){}return c=e.xpathContext||"",t?"self.executePipeline('"+y+"', printf('"+(p=i+"[id=%s]")+"',i));":"self.executePipeline('"+y+"','"+c+"');"}return bizagi.log("There is no definition for commandType: "+r),""},buildRestoreCommand:function(e,t){var i=e.xpath,r=e.command;return t=t||!1,e.renderId&&(i="id="+e.renderId),t&&(i=i.replaceAll("[]","[' + i + ']")),i&&i.length>0?"self.restoreRender('"+i+"', '"+r+"');":"self.restoreContainer('"+e.container+"', '"+r+"');"},detectCommandArgumentType:function(e,t){if(void 0===e)return e;if("const"==e){if("background-color"==t)return"color";if("forecolor"==t)return"color";if("visible"==t)return"boolean";if("readonly"==t)return"boolean";if("required"==t)return"boolean";if("set-value"==t)return"text";if("collapse"==t)return"boolean";if("set-active"==t)return"number";if("set-min"==t)return"text";if("set-max"==t)return"text";if("calculate"==t)return;if("refresh"==t)return;if("submit-value"==t)return"json"}else if("xpath"===e||"entity"===e||"function"===e)return e;return bizagi.log("There is no definition for commandType: "+t),null},restoreRender:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){var n=a.originalProperties,o=n.textFormat||{};"background-color"==t&&i.changeRenderBackground(e,o.background||""),"forecolor"==t&&i.changeRenderForeground(e,o.color||"none"),"visible"==t&&i.changeRenderVisibility(e,null==n.visible||n.visible),"readonly"==t&&i.changeRenderEditability(e,null==n.editable||n.editable),"required"==t&&i.changeRenderRequired(e,null!=n.required&&n.required)})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},restoreContainer:function(e,t){var i=this.form.getContainer(e);if(null!=i){var r=i.originalProperties;"background-color"==t&&this.changeContainerBackground(e,r.backgroundColor||"none"),"visible"==t&&this.changeContainerVisibility(e,null==r.visible||r.visible),"collapse"==t&&this.toogleContainer(e,!0),"readonly"==t&&this.changeContainerEditability(e,null==r.editable||r.editable)}else this.Class.THROW_ERROR&&this.showContainerNotFoundError(xpath)},changeRenderBackground:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"backgroundColor",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellBackgroundColor(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellBackgroundColor(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){a.changeBackgroundColor(t),i.logVisualChange(n)}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonBackground:function(e,t){var i=e.substring(3),r=this.form.getButton(i);r.css("background-image","none"),r.addClass("ui-fast-transition"),void 0!==r[0]&&r[0].style.setProperty("background-color",t,"important")},changeRenderForeground:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"color",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellColor(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellColor(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){a.changeColor(t),i.logVisualChange(n)}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonForeground:function(e,t){var i=e.substring(3);this.form.getButton(i).css("color",t,"!important")},changeRenderVisibility:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"visibility",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){a.changeColumnVisibility(o.remainingXpath,t);var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellVisibility(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellVisibility(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){$.when(a.renderingDeferred).done((function(){a.changeVisibility(t),i.logVisualChange(n)}))}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeButtonVisibility:function(e,t){var i=e.substring(3),r=1==bizagi.util.parseBoolean(t);if(bizagi.util.isMobileDevice())this.changeFormButtonVisibility(i,r);else{var a=this.form.getButton(i);r?(a.show(),a.css("display","")):a.hide()}},changeRenderEditability:function(e,t){var i=this;if(bizagi.override.changeEditabilityOnReadOnlyForms||!i.form.properties.displayAsReadOnly){var r=i.getRenders(e);null!=r?$.each(r,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"editability",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){a.changeColumnEditability(o.remainingXpath,t);var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellEditability(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellEditability(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){$.when(a.renderingDeferred).done((function(){a.changeEditability(t),i.logVisualChange(n)}))}))}})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)}},changeButtonEditability:function(e,t){var i=e.substring(3),r=this.form.getButton(i);1==bizagi.util.parseBoolean(t)?r.removeAttr("disabled"):r.attr("disabled","disabled")},triggerClick:function(e){var t=e.substring(3),i=this.form.buttons.find((function(e){return e.id==t}));i?this.form.buttonExecutionHandler(i):console.warn("Button properties were not found")},changeRenderRequired:function(e,t){var i=this,r=i.getRenders(e),a=[];null!=r?($.each(r,(function(e,t){bizagi.util.parseBoolean(t.properties.editable)&&a.push(t)})),0===a.length&&(a=r),$.each(a,(function(r,a){if(i.isValidRender(a)){var n=i.getVisualChange(a,"required",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){a.changeColumnRequired(o.remainingXpath,t);var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellRequired(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellRequired(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){$.when(a.renderingDeferred).done((function(){a.changeRequired(t),i.logVisualChange(n)}))}))}}))):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderValue:function(e,t){var i=this;null!=t&&"object"===_typeof(t)&&(t=$.extend(t,{fromAction:!0}));var r=i.getRenders(e);if(null!=r){var a=[];$.each(r,(function(e,t){t.properties.editable&&a.push(t)})),0==a.length&&$.each(r,(function(e,t){a.push(t)})),$.each(a,(function(r,a){if(i.isGridComponent(a,e)){var n=i.processGridXpath(e);$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(n.index)){var e,i,r=a.getIndexes();for(e=0,i=r.length;e<i;e++)a.changeCellValue(r[e],n.remainingXpath,t)}else a.changeCellValue(n.index,n.remainingXpath,t)}))}else $.when(a.ready()).done((function(){a.asyncRenderDeferred?$.when(a.asyncRenderDeferred).done((function(){a.setDisplayValue(t)})):a.setDisplayValue(t)}))}))}else i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderMinValue:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){var n=i.getVisualChange(a,"minValue",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);n.xpath=o.remainingXpath,$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellMinValue(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellMinValue(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){var e=bizagi.util.normalizeQueryType(a.properties.type);["number","date","money"].includes(e)&&(a.changeMinValue(t),i.logVisualChange(n))}))})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},changeRenderMaxValue:function(e,t){var i=this,r=i.getRenders(e);null!=r?$.each(r,(function(r,a){var n=i.getVisualChange(a,"maxValue",t);if(i.isGridComponent(a,e)){var o=i.processGridXpath(e);$.when(a.ready()).done((function(){if(bizagi.util.isEmpty(o.index)){var e,r,s=a.getIndexes();for(e=0,r=s.length;e<r;e++)a.changeCellMaxValue(s[e],o.remainingXpath,t),n.indexes.push(s[e])}else a.changeCellMaxValue(o.index,o.remainingXpath,t),n.indexes.push(o.index);i.logVisualChange(n)}))}else $.when(a.ready()).done((function(){a.changeMaxValue(t),i.logVisualChange(n)}))})):i.Class.THROW_ERROR&&i.showRenderNotFoundError(e)},executeCalculatedField:function(e){var t=this.getRenders(e);null!=t?$.each(t,(function(e,t){$.when(t.ready()).done((function(){t.runFormula()}))})):this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshControl:function(e,t,i){var r=this.getRenders(e)||this.form.getContainer(e),a=new bizagiQueue;if(null!=r)return $.each(r,(function(i,r){a.add(r.ready().pipe((function(){return r.refreshControl({xpath:e,xpathContext:t})})))})),a.execute();this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshContainer:function(e,t){var i=this.form.getContainer(e);if(null!=i)return $.when(i.ready()).pipe((function(){return i.refreshContainer({xpathContext:t})}));this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},refreshGridCell:function(e,t){var i=this,r=new bizagiQueue,a=new $.Deferred,n=i.getRenders(e)||i.form.getContainer(e);if(null==n)return i.Class.THROW_ERROR&&i.showRenderNotFoundError(e),null;var o=[];return $.each(n,(function(e,t){if(t.properties.editable)return o.push(t),!1})),0==o.length&&$.each(n,(function(e,t){return o.push(t),!1})),0!==o.length?(i.form&&""!==i.form.properties.xpathContext&&(t=""!==t?i.form.properties.xpathContext+"."+t:i.form.properties.xpathContext),r.add(a.promise()),$.when.apply($,$.map(o,(function(e){e.ready()}))).done((function(){for(var r=o.length,n=new bizagiQueue,s=0;s<r;s++){var l=o[s],d=i.processGridXpath(e);if(bizagi.util.isEmpty(d.index))for(var u=l.getIndexes(),c=u.length,p=0;p<c;p++)n.addParallel(l.refreshCell({key:u[p],column:d.remainingXpath,xpathContext:t}));else n.add(l.refreshCell({key:d.index,column:d.remainingXpath,xpathContext:t}))}$.when(n.execute()).done((function(){a.resolve()}))})),r.execute()):void 0},submitFormData:function(e){var t=this.form;return $.when(t.ready()).pipe((function(){return t.submitData(e)}))},executeRule:function(e,t,i){var r=this.form,a=e+"."+t;return this.isRecentAction(a,i)?void 0:$.when(r.ready()).pipe((function(){return r.executeRule({rule:e,xpathContext:t})}))},executeInterface:function(e,t){var i=this.form;return $.when(i.ready()).pipe((function(){return i.executeInterface({interface:e,xpathContext:t})}))},executeSAPConnector:function(e,t){var i=this.form;return $.when(i.ready).pipe((function(){return i.executeSAPConnector({guidsap:e,xpathContext:t})}))},executeConnector:function(e,t){var i=this.form;return $.when(i.ready).pipe((function(){return i.executeConnector({guidConnector:e,xpathContext:t})}))},executePipeline:function(e,t){var i=this.form;return $.when(i.ready()).pipe((function(){return i.executePipeline({pipeline:e,xpathContext:t})}))},submitRender:function(e,t){var i=this.getRender(e);if(null!=i)return $.when(i.ready()).pipe((function(){return i.submitOnChange()}));this.Class.THROW_ERROR&&this.showRenderNotFoundError(e)},cleanRenderData:function(e){var t=this,i=t.getRenders(e),r=[];if(null!=i)return $.each(i,(function(i,a){if(t.isGridComponent(a,e)){var n=t.processGridXpath(e);r.push($.when(a.ready()).then((function(){var e=[];if(bizagi.util.isEmpty(n.index)){var t,i,r=a.getIndexes();for(t=0,i=r.length;t<i;t++)e.push($.when(a.cleanCellData(r[t],n.remainingXpath)))}else e.push($.when(a.cleanCellData(n.index,n.remainingXpath)));return $.when.apply($,e)})))}else r.push($.when(a.ready()).then((function(){return $.when(a.renderingDeferred).then((function(){return $.when(a.cleanData()).then((function(){return t.changeRenderRequired(e,null!=a.properties.required&&a.properties.required)}))}))})))})),$.when.apply($,r);t.Class.THROW_ERROR&&t.showRenderNotFoundError(e)},changeContainerBackground:function(e,t){var i=this.form.getContainer(e);null!=i?$.when(i.ready()).done((function(){i.changeBackgroundColor(t),i.visualChanges.backgroundColor=t})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeContainerVisibility:function(e,t){var i=this.form.getContainer(e);null!=i?$.when(i.ready(!0)).done((function(){$.when(i.renderingDeferred).done((function(){i.changeVisibility(t),i.visualChanges.visibility=t}))})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},toogleContainer:function(e,t){var i=this.form.getContainer(e);null!=i?/group/i.test(i.properties.type)&&$.when(i.ready()).done((function(){i.toogleContainer(t)})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeActiveItem:function(e){var t=this.form.getContainer(e);null!=t?("tabItem"===t.properties.type&&t.loadingDeferred&&t.loadingDeferred.resolve(),$.when(t.ready()).done((function(){t.setAsActiveContainer()}))):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)},changeContainerEditability:function(e,t){if(bizagi.override.changeEditabilityOnReadOnlyForms||!this.form.properties.displayAsReadOnly){var i=this.form.getContainer(e);null!=i?$.when(i.ready()).done((function(){i.changeEditability(t),i.visualChanges.editability=t})):this.Class.THROW_ERROR&&this.showContainerNotFoundError(e)}},searchGridColumns:function(e,t){var i;if("string"==typeof e||"boolean"==typeof e)return null;if(e.expressions){var r,a;for(r=0,a=e.expressions.length;r<a;r++)this.searchGridColumns(e.expressions[r],t)}else{if(e.simple)return this.searchGridColumns(e.simple,t);if(e.complex)return this.searchGridColumns(e.complex,t);var n=e.xpath||e.renderId;n&&(n&&n.indexOf("[]")>0&&(i=n.substring(n.indexOf("[]")+3),t.push(i)),"xpath"===e.argumentType&&e.argument.indexOf("[]")>0&&(i=e.argument.substring(e.argument.indexOf("[]")+3),t.push(i)))}return null},isGridComponent:function(e,t){var i=bizagi.util.normalizeType(e.properties.type);return/grid$/i.test(i)&&t.indexOf("[")>=0},isValidRender:function(e){return-1===["collectionnavigator"].indexOf(e.properties.type)},changeFormButtonVisibility:function(e,t){var i=this.form,r=i.buttons&&i.buttons.length?i.buttons:i.properties.buttons||[],a=r.findIndex((function(t){return t.id===e})),n=i.getNavigation();-1!==a&&(r[a].visible=t),i.buttons=r||[],n.setNavigationButtons(i)},getVisualChange:function(e,t,i){return new Object({element:e,command:t,argument:i,indexes:[],xpath:""})},logVisualChange:function(e){if(e.indexes.length>0)for(var t=0;t<e.indexes.length;t++){var i=e.element.getControlCell(e.indexes[t],e.xpath);i&&(i.visualChanges[e.command]=e.argument)}else e.element.visualChanges[e.command]=e.argument},configureOverrides:function(){if(!this.Class.overridesInitiated){switch(bizagi.override.enableExecuteRefreshAction||void 0!==bizagi.override.refreshActionBehavior||(bizagi.override.refreshActionBehavior="DEPRECATED-11.2.3"),bizagi.override.refreshActionBehavior=bizagi.override.refreshActionBehavior||"11.2.5"){case"DEPRECATED-11.2.3":bizagi.override.enableExecuteRefreshAction=!1,bizagi.override.restoreAppearanceAfterRefresh=!1;break;case"DEPRECATED-11.2.4":bizagi.override.enableExecuteRefreshAction=!0,bizagi.override.restoreAppearanceAfterRefresh=!1;break;case"11.2.5":default:bizagi.override.enableExecuteRefreshAction=!1,bizagi.override.restoreAppearanceAfterRefresh=!0}this.Class.overridesInitiated=!0}}}),bizagi.command.controllers.action.extend("bizagi.command.controllers.action",{},{changeButtonBackground:function(e,t){this.form&&!this.form.isFloatingButtonsEnabled()&&this._super(e,t)},changeButtonForeground:function(e,t){this.form&&!this.form.isFloatingButtonsEnabled()&&this._super(e,t)},changeButtonVisibility:function(e,t){this.form&&!this.form.isFloatingButtonsEnabled()?this._super(e,t):this.changeFloatingButtonVisibility(e,t)},changeButtonEditability:function(e,t){this.form&&!this.form.isFloatingButtonsEnabled()?this._super(e,t):this.changeFloatingButtonVisibility(e,t)},changeFloatingButtonVisibility:function(e,t){var i=this.form,r=e.substring(3),a=i.getNavigation(),n=i.buttons&&i.buttons.length?i.buttons:i.properties.buttons||[],o=!1!==bizagi.util.parseBoolean(t),s=n.findIndex((function(e){return e.id===r}));-1!==s&&(n[s].visible=o),i.buttons=n||[],a.setNavigationButtons(i)}}),$.Class.extend("bizagi.rendering.element",{ELEMENT_TYPE_CONTAINER:1,ELEMENT_TYPE_RENDER:2,ELEMENT_TYPE_COLUMN:3},{init:function(e){this.renderFactory=e.renderFactory,this.dataService=e.dataService,this.parent=e.parent,this.resources=bizagi.localization,this.observableElement=$("<div />"),this.disposed=!1,this.initializeData(e.data),this.subscribers=[]},initializeData:function(e){this.properties={},e&&e.properties&&(this.properties=e.properties),this.properties.xpathContext=this.getXpathContext(),this.properties.idPageCache=this.getPageCache(),this.visualChanges=this.visualChanges||{}},getXpathContext:function(){return null!=this.parent&&"function"==typeof this.parent.getXpathContext?this.parent.getXpathContext():""},getXpath:function(){return this.properties.xpath},getPageCache:function(){return null!=this.parent&&"function"==typeof this.parent.getPageCache?this.parent.getPageCache():""},getFormContainer:function(){if(void 0!==this.parent)return this.parent.getFormContainer()},getResource:function(e){return this.resources.getResource(e)},getElementType:function(){},resize:function(e){},focus:function(){if(this.properties.required){var e=$("#ui-bizagi-wp-app-render-form-content");bizagi.util.isScrolledIntoView(this.element,e)||$(this.element).attr("tabindex",-1).focus(),this.element&&this.element.effect("highlight",2e3)}this.parent&&"function"==typeof this.parent.focus&&this.parent.focus()},triggerGlobalHandler:function(e,t){return this.disposed?null:this.parent?this.parent.triggerGlobalHandler(e,t):null},trigger:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.trigger(e,t):null},triggerHandler:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.triggerHandler(e,t):null},bind:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.bind(e,t):(this.subscribers.push({event:e}),null)},unbind:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.unbind(e,t):null},one:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.one(e,t):(this.subscribers.push({event:e}),null)},getRenderedElement:function(){},getMode:function(){if(this.parent)return this.parent.getMode()},getParams:function(){if(this.parent)return this.parent.getParams()},getFormType:function(){return this.getFormContainer().properties.type||"form"},ready:function(){},isReadyToSave:function(){},getCustomHandlers:function(){return null},dispose:function(){var e=this;e.disposed=!0;var t=setTimeout((function(){null!=e.subscribers&&$.each(e.subscribers,(function(t,i){e.unbind(i.event)})),delete e.subscribers,e.observableElement&&e.observableElement.off(),bizagi.util.dispose(e),clearTimeout(t)}),bizagi.override.disposeTime||50)},isDisposed:function(){return this.disposed},processFailMessage:function(e){var t=this.getFormContainer(),i=bizagi.util.isOfflineForm({context:this});if("CustomMessageException"===e.errorType){t.validationController.clearValidationMessages();var r=bizagi.localization.getResource(e.message);t.validationController.showErrorMessage(r)}else if("InvalidCaseStateException"===e.errorType){var a=t.getParams();t.validationController.clearValidationMessages(),t.container.trigger("routing",{idCase:a.idCase||bizagi.context.idCase})}else{var n=(e="string"==typeof(e=e||{})?JSON.parse(e):e).type||"error",o=e.code||"code";if(e=e.responseText||e.message||e,"not-processed"===n)return;if("not-shown"===n)return;if(i&&"AUTH_ERROR"===o)return;t.validationController.clearValidationMessages(),"alert"==n?t.validationController.showAlertMessage(e):t.validationController.showErrorMessage(e)}return e},startLoading:function(){},endLoading:function(){},beforeToRefresh:function(){},afterToRefresh:function(){bizagi.override&&!0===bizagi.override.enableExecuteRefreshAction&&this.getFormContainer().tryToExecuteFunction(this.properties.xpath||this.properties.id)},getResourceByKey:function(e,t){return t=t||e,bizagi.localization.getResource(e,t)},restoreAppearance:function(){for(var e in this.visualChanges)switch(e){case"color":this.changeColor(this.visualChanges[e]);break;case"backgroundColor":this.changeBackgroundColor(this.visualChanges[e]);break;case"required":this.changeRequired(this.visualChanges[e]);break;case"editability":this.changeEditability(this.visualChanges[e]);break;case"visibility":this.changeVisibility(this.visualChanges[e]);break;case"minValue":this.changeMinValue(this.visualChanges[e]);break;case"maxValue":this.changeMaxValue(this.visualChanges[e])}},getOrientation:function(){for(var e=this;e;){if(properties=e.properties||{},"auto"!==properties.orientation)return properties.orientation;e=e.parent}return"auto"}}),bizagi.rendering.element.extend("bizagi.rendering.container",{TYPE_QUERY_FORM:"queryForm"},{initializeData:function(e){var t=this;t._super(e);var i=t.properties;i.uniqueId=Math.ceil(1e6*Math.random()),i.editable=void 0===i.editable||bizagi.util.parseBoolean(i.editable),i.visible=void 0===i.visible||bizagi.util.parseBoolean(i.visible),i.orientation=i.orientation||"auto",this.originalProperties=JSON.parse(JSON.encode(i)),this.children=[],this.childrenHash={},e.elements&&$.each(e.elements,(function(e,i){i.render?t.createRenderElement(i):i.container?t.createContainerElement(i):i.form&&t.createFormElement(i)}))},createRenderElement:function(e){var t,i=this.properties;0==i.editable&&(e.render.properties.editable=i.editable),!1===i.required&&(e.render.properties.required=i.required),"duplicate"==e.render.properties.retype&&(t=bizagi.clone(e));var r=this.renderFactory.getRender({type:e.render.properties.type,data:e.render,dataService:this.dataService,parent:this,mode:this.getMode()});this.children.push(r),"duplicate"==e.render.properties.retype&&this.processDuplicateRender(r,t),this.getFormContainer().registerRender(r)},createContainerElement:function(e){var t=this.properties;0==t.editable&&(e.container.properties.editable=t.editable),!1===t.required&&(e.container.properties.required=t.required);var i=this.renderFactory.getContainer({type:e.container.properties.type,data:e.container,parent:this,dataService:this.dataService,mode:this.getMode(),isDesign:"design"===this.getMode()});this.children.push(i),this.getFormContainer().registerRender(i)},createFormElement:function(e){var t=this.properties;0==t.editable&&(e.container.properties.editable=t.editable);var i=this.renderFactory.getContainer({type:e.form.properties.type||"form",data:e.form,parent:this,dataService:this.dataService,mode:this.getMode()});this.children.push(i)},getElement:function(){return this.container},getElementsByType:function(e,t){t=t||[];return $.each(this.children,(function(i,r){r.properties.type==e&&t.push(r),r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&r.getElementsByType(e,t)})),t},processDuplicateRender:function(e,t){var i=JSON.parse(JSON.encode(t.render));i.properties.displayName=i.properties.displayName+" "+this.getResource("render-text-duplicate-label-sufix"),i.properties.xpath=i.properties.xpath+".clone",i.properties.isClone=!0;var r=this.renderFactory.getRender({type:i.properties.type,data:i,parent:this,mode:this.getMode()});e.cloneRender=r,this.children.push(r)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_CONTAINER},render:function(){var e;this.getMode();return e=this.internalRender(),this.applyContainerDefaults(),e.attr("data-container-id",this.properties.id),this.properties.tag&&e.attr("data-tag",this.properties.tag),this.params&&this.params.requestedForm&&e.addClass(this.params.requestedForm),e},internalRender:function(){var e=this.renderContainerHtml(),t=this.container=$(e);return this.postRenderContainer(t),this.container},renderContainerHtml:function(){return this.renderingDeferred=this.renderingDeferred||new $.Deferred,this.renderContainer()},isRendered:function(){return!!this.renderingDeferred&&this.renderingDeferred.promise()},getRenderedElement:function(){return bizagi.util.isEmpty(this.container)&&alert("container hasn't been rendered!"),this.container},applyContainerDefaults:function(){var e=this.properties;e.backgroundColor&&this.changeBackgroundColor(e.backgroundColor),e.visible||this.changeVisibility(e.visible)},changeBackgroundColor:function(e){this.properties.backgroundColor=e,$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.changeBackgroundColor(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeBackgroundColor(e)}))},changeVisibility:function(e){var t=this.properties;t.visible=bizagi.util.parseBoolean(e),t.visible?this.container.show():this.container.hide()},changeEditability:function(e){this.properties.editable="Default"==e?this.originalProperties.editable:bizagi.util.parseBoolean(e),$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?$.when(i.ready()).done((function(){i.changeEditability(e)})):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeEditability(e)}))},replaceTag:function(e,t,i){bizagi.util.replaceSelector(e,t,i)},replaceChildrenTag:function(e,t){this.replaceTag(e,".children",t)},replaceChildrenHtml:function(e,t){return e.replaceFirstWithoutPatterns("{{children}}",t)},renderContainer:function(){},postRenderContainer:function(e){var t=this.getMode();this.renderingDeferred&&this.renderingDeferred.resolve(),this.container=e,this.executeChildrenPostRender(e),"execution"==t&&(this.configureHandlers(),this.applyPlaceHolderPolyfill()),"design"==t&&this.configureDesignView(),"layout"==t&&(this.configureDesignView(),this.configureLayoutView())},applyPlaceHolderPolyfill:function(){var e=window.placeHolderConfig||{};("placeholder"in $("<input>")[0]||"placeHolder"in $("<input>")[0])&&!e.forceApply||Placeholders.enable()},executeChildrenPostRender:function(e){var t=this,i=e.children();$.each(i,(function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var a=t.childrenHash[r];if(a){var n=a.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&a.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&a.postRenderContainer(i)}}else t.executeChildrenPostRender(i)}))},configureHandlers:function(){},configureDesignView:function(){},configureLayoutView:function(){},renderChildrenHtml:function(){var e=this,t="";return $.each(e.children,(function(i,r){var a=r.getElementType();a==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(t+=r.renderElement()),a==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(t+=r.renderContainerHtml()),e.childrenHash[r.properties.uniqueId]=r})),t},collectRenderValues:function(e){this.children&&$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValues(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSent()&&i.collectData(e)}))},hasChanged:function(e){if((e=e||[]).length)return e;this.children&&$.each(this.children,(function(t,i){if(e.length||i.hasChanged(e))return!1}))},collectRenderValuesQueryForm:function(e){$.each(this.children,(function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValuesQueryForm(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSentQueryForm()&&i.collectDataQueryForm(e)}))},firstChild:function(){return this.children[0]},getRenders:function(e,t){return t=t||[],e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),$.each(this.children,(function(i,r){r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.getRenders(e,t):r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&e==r.properties.xpath&&t.push(r)})),t},getRender:function(e){var t=this.getRenders(e),i=null;return $.each(t,(function(e,t){t.properties.editable&&null==i&&(i=t)})),null==i&&$.each(t,(function(e,t){i=t})),i},getRendersByXpath:function(e){return this.getRenders(e)},getContainer:function(e){var t;return this.properties.id==e?this:($.each(this.children,(function(i,r){if(r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var a=r.getContainer(e);if(null!=a)return t=a,!1}})),t)},isValid:function(e){return this.children&&$.each(this.children,(function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.isValid(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.isValid(e))})),0==e.length},hasValidGrids:function(e){return $.each(this.children,(function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.hasValidGrids(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&void 0!==i.grid&&i.isValid(e))})),0==e.length},ready:function(){return $.when(this.parent.ready(),this.isRendered())},isReadyToSave:function(){var e=$.map(this.children,(function(e){return e.isReadyToSave()}));return $.when.apply($,e)},getFocus:function(){var e;return $.each(this.children,(function(t,i){if(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var r=i.getFocus();bizagi.util.isEmpty(r)||(e=r)}})),e},getCustomHandlers:function(){var e=this.getFormContainer();if(e)return e.getCustomHandlers()},getCustomHandler:function(e){var t=this.getCustomHandlers();if(t)return t[e]},dispose:function(){var e=this,t=setTimeout((function(){e.children&&$.each(e.children,(function(e,t){t.dispose()})),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()},refreshContainer:function(e){var t=this,i=t.properties,r=t.getFormContainer();return t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||e.xpathContext,contexttype:t.properties.contexttype||"",idForm:r&&r.properties&&r.properties.id?r.properties.id:""})).done((function(e){if(!t.isDisposed()){bizagi.override.restoreAppearanceAfterRefresh&&t.saveChildrenVisualChanges(t),t.unregisterChildren(),delete t.children,delete t.childrenHash,t.getFormContainer().removeActions(),!1===t.properties.editable&&e.container&&e.container.properties&&(e.container.properties.editable=!1),t.initializeData(e.container);var i=t.container,r=t.render();"tabItem"==t.properties.type&&$(r).addClass("childrenActive"),i.replaceWith(r);var a=e.container&&e.container.actions?e.container.actions:[];t.getFormContainer().refreshActions(a),t.triggerChildrenActions(),bizagi.override.restoreAppearanceAfterRefresh&&(t.restoreChildrenVisualChanges(t),delete t.childrenVisualChanges,t.restoreAppearance(e.container)),t.afterToRefresh()}})).fail((function(e){e=t.processFailMessage(e)})).always((function(){t.endLoading()}))},refreshDesignContainer:function(e){var t=this.properties;if(this.beforeToRefresh(e),$.extend(e.properties,{editable:t.editable,contexttype:t.contexttype||"",idPageCache:t.idPageCache,idRender:t.id,messageValidation:t.messageValidation,uniqueId:t.uniqueId,visible:t.visible,xpath:t.xpath,mode:"design",xpathContext:t.xpathContext||""}),!this.isDisposed()){this.unregisterChildren(),delete this.children,delete this.childrenHash,!1===this.properties.editable&&e.container&&e.container.properties&&(e.container.properties.editable=!1),this.initializeData(e.container);var i=this.container,r=this.render();"tabItem"==this.properties.type&&$(r).addClass("childrenActive"),i&&i.replaceWith(r),this.afterToRefresh()}},beforeToRefresh:function(){for(var e=0;e<this.children.length;e++)this.children[e].beforeToRefresh()},afterToRefresh:function(){bizagi.override&&!0===bizagi.override.enableExecuteRefreshAction&&this.getFormContainer().tryToExecuteFunction(this.properties.id);for(var e=0;e<this.children.length;e++)this.children[e].afterToRefresh()},triggerChildrenActions:function(){for(var e=this.children,t=0,i=e.length;t<i;t++){var r=e[t],a=r.getElementType();a===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.triggerChildrenActions():a===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&r.triggerRenderChange({changed:!1})}},registerActions:function(e){var t=this.getFormContainer();e&&t.actionController.buildActions(e)},unregisterChildren:function(){for(var e=this.getFormContainer(),t=this.children,i=0,r=t.length;i<r;i++){var a=t[i],n=a.getElementType();n===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?a.unregisterChildren():n===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&e.unregisterRender(a)}},replaceChild:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){if(t[i].properties.uniqueId==e.properties.uniqueId){t.splice(i,1),t.splice(i,0,e);break}}},getChildById:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){var a=t[i];if(a.properties.id==e)return a}return null},restoreAppearance:function(e){var t=this;t._super(),(e.elements||[]).forEach((function(e){t.restoreElementAppearance(e.container||e.render)}))},restoreElementAppearance:function(e){var t=this.getChildById(e.properties.id);t&&t.restoreAppearance(e)},saveChildrenVisualChanges:function(e){var t=this;t.childrenVisualChanges=t.childrenVisualChanges||{},(e.children||[]).forEach((function(e){var i=e.getElementType();i===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?(t.childrenVisualChanges[e.properties.id]=e.visualChanges,t.saveChildrenVisualChanges(e)):i===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(t.childrenVisualChanges[e.properties.id]=e.visualChanges)}))},restoreChildrenVisualChanges:function(e){var t=this;(e.children||[]).forEach((function(e){var i=e.getElementType(),r=t.childrenVisualChanges&&t.childrenVisualChanges[e.properties.id]||{};i===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?(e.visualChanges=r,t.restoreChildrenVisualChanges(e)):i===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(e.visualChanges=r)}))}}),bizagi.rendering.container.extend("bizagi.rendering.container",{},{getMenu:function(){return this.getFormContainer().getParams().menu},startLoading:function(){var e=this.container;e&&e.startLoading({delay:250,overlay:!0})},endLoading:function(){var e=this.container;e&&e.endLoading()}}),bizagi.rendering.element.extend("bizagi.rendering.render",{postRenderTimeout:0,maxRendersPerScreen:50,rendersExecuted:0,renderOptimization:!1,TYPE_QUERY_FORM:"queryForm",startOptimization:function(){bizagi.rendering.render.postRenderTimeout=500,bizagi.rendering.render.rendersExecuted=0,bizagi.rendering.render.renderOptimization=!1},stopOptimization:function(){bizagi.rendering.render.postRenderTimeout=0,bizagi.rendering.render.rendersExecuted=0,bizagi.rendering.render.renderOptimization=!1}},{initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;i.included=void 0!==i.included&&bizagi.util.parseBoolean(i.included),i.uniqueId=Math.ceil(1e6*Math.random()),i.displayName=i.displayName||"",i.editable=void 0===i.editable||bizagi.util.parseBoolean(i.editable),i.visible=void 0===i.visible||bizagi.util.parseBoolean(i.visible),i.includedInResult=void 0!==i.includedInResult&&bizagi.util.parseBoolean(i.includedInResult);var r=bizagi.util.normalizeType(i.type);(/^hidden$/i.test(r)||/^queryHidden$/i.test(r))&&(i.visible=!1),i.required=void 0!==i.required&&bizagi.util.parseBoolean(i.required),i.submitOnChange=void 0!==i.submitOnChange&&bizagi.util.parseBoolean(i.submitOnChange),i.maxLength=i.maxLength||0,i.helpText=bizagi.util.trim(i.helpText)||"",i.textFormat=i.textFormat||{},i.valueFormat=i.valueFormat||{},i.isHidden=void 0!==i.isHidden&&bizagi.util.parseBoolean(i.isHidden),i.visible=!i.isHidden&&i.visible,i.editabilityEnabled=!1,i.color&&(i.textFormat.color=i.color),i.backgroundColor&&(i.textFormat.backgroundColor=i.backgroundColor),i.required=!!i.editable&&i.required,i.orientation=i.orientation||"auto",i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",this.originalProperties={textFormat:{color:i.textFormat.color,backgroundColor:i.textFormat.backgroundColor},valueFormat:{color:i.textFormat.color,backgroundColor:i.textFormat.backgroundColor},visible:i.visible,editable:i.editable,required:i.required,labelAlign:i.labelAlign,valueAlign:i.valueAlign},this.value=void 0!==i.value?i.value:null,this.properties.originalValue=this.value,this.properties.previousValue=this.value,this.calculateInitialLayoutProperties()},calculateInitialLayoutProperties:function(){var e=this.properties;e.displayType=e.displayType||"normal",e.labelAlign=e.labelAlign||this.getDefaultLabelAlign(e.displayType),e.valueAlign=e.valueAlign||this.getDefaultValueAlign(e.displayType),"rtl"===e.orientation&&(e.labelAlign=this.getRTLAlign(e.labelAlign),e.valueAlign=this.getRTLAlign(e.valueAlign));var t=this.calculateRenderWidth(e.labelWidth,e.valueWidth,e.displayType);e.labelWidth=t.label,e.valueWidth=t.control,"percentage"===e.layoutType&&(e.valueWidth=t.control),0==e.labelWidth&&(e.displayType="value",e.valueWidth=t.control),0==e.valueWidth&&(e.displayType="label"),"userfield"===e.type&&(["both","normal","reversed"].includes(e.displayType)?(e.valueWidth=e.valueWidth||50,e.labelWidth=e.labelWidth||50):"vertical"===e.displayType?(e.valueWidth=100,e.labelWidth=100):"label"===e.displayType?(e.valueWidth=0,e.labelWidth=100):(e.valueWidth=100,e.labelWidth=0))},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_RENDER},render:function(e){return this.renderElement(e)},renderElement:function(e){var t=this.properties,i=this.getFormContainer();this.renderingDeferred=new $.Deferred,e=e||"render";var r=this.renderFactory.getTemplate(e),a=t.displayName;"string"==typeof a&&(a=bizagi.util.encodeString(a));var n="desktop"!==bizagi.util.detectDevice()&&("association"===t.type||"uploadecm"===t.type||("actionLauncher"===t.type||"polymorphicLauncher"===t.type)&&bizagi.util.isTabletDevice()||"grid"===t.type&&!bizagi.util.isTabletDevice()),o=parseFloat(t.labelWidth),s=$.fasttmpl(r,{label:a,helpText:t.helpText,editable:t.editable,isExtendedText:"text"==t.type&&t.isExtended,orientation:t.orientation,uniqueId:t.uniqueId,id:t.id,xpath:t.xpath,tag:t.tag,displayType:t.displayType,displayOptionClass:this.getDisplayOptionClass(t.displayType),labelAlignClass:this.getAlignClass(t.labelAlign),valueAlignClass:this.getAlignClass(t.valueAlign),flexAlignClass:bizagi.util.mapAlignClassName(t.columnAlign),labelWidth:o,stringLabelWidth:o+("pixels"==t.layoutType?"px":"%"),valueWidth:parseFloat(t.valueWidth),stringValueWidth:parseFloat(t.valueWidth)+("pixels"==t.layoutType?"px":"%"),layoutType:t.layoutType,isDesign:"design"===this.getMode(),messageValidation:t.messageValidation,printVersion:i.params.printversion,cssClass:t.cssclass||"",includedInResult:t.includedInResult,included:t.included,type:t.type,showFullRender:n,required:t.required}),l=this.internalRenderControl();return l||(l=""),"object"===_typeof(l)&&l.done?"resolved"===l.state()?(s=this.replaceControlHtml(s,this.resolveResult(l)),this.asyncRenderDeferred=null):(this.asyncRenderDeferred=l,s=this.replaceControlHtml(s,"")):s=this.replaceControlHtml(s,l),s},resolveResult:function(e){return bizagi.resolveResult(e)},isRendered:function(){return!!this.renderingDeferred&&this.renderingDeferred.promise()},internalRenderControl:function(){var e=this.properties;return this.control=null,this.renderFactory.printVersion?(e.editable=!1,this.renderControl()):e.editable?this.renderControl():this.renderReadOnly()},postRenderElement:function(e){var t=this,i=t.properties;t.element=e,i.submitOnChange&&t.configureSubmitOnChange(),isLabelFormat=!0;var r=function(e){if(bizagi.rendering.render.renderOptimization&&bizagi.rendering.render.rendersExecuted>bizagi.rendering.render.maxRendersPerScreen)var i=setTimeout((function(){t.internalPostRender(e),bizagi.rendering.render.postRenderTimeout+=50,clearTimeout(i)}),bizagi.rendering.render.postRenderTimeout);else t.internalPostRender(e);bizagi.rendering.render.rendersExecuted++};t.asyncRenderDeferred?$.when(t.asyncRenderDeferred).done((function(i){var a=t.getControl();"function"==typeof t.emptyControlByAsyncRenderDeferred&&t.emptyControlByAsyncRenderDeferred(),a.append(i),r(e),t.processLayout(!isLabelFormat,t.properties.valueFormat||{})})):r(e)},internalPostRender:function(e){var t=this.properties,i=this.getMode();this.control=this.getControl(),this.renderingDeferred&&this.renderingDeferred.resolve(),t.editable?this.renderFactory.printVersion&&this.postRenderPrintVersion?this.postRenderPrintVersion():this.postRender():this.postRenderReadOnly(e),"execution"==i?this.performExecutionModeMethods():this.performDesignModeMethods(),this.processLayout(isLabelFormat,this.properties.textFormat||{}),this.processLayout(!isLabelFormat,this.properties.valueFormat||{})},performExecutionModeMethods:function(){var e=this.properties;this.getFormType()==this.Class.TYPE_QUERY_FORM&&this.configureHandlersQueryForm(),e.editable?this.configureHandlers():this.configureHandlersReadOnly(),this.internalSetInitialValue()},performDesignModeMethods:function(){this.configureDesignView(),this.internalSetInitialValue()},replaceControlHtml:function(e,t){return t=t||"",(e=e||"").replaceFirstWithoutPatterns("{{control}}",t)},getRenderedElement:function(){return bizagi.util.isEmpty(this.element)&&bizagi.log(" render hasn't been rendered!",this,"error"),this.element},internalSetInitialValue:function(){var e=this.properties;this.internalSetInitialValueFlag=!0,e.editable,bizagi.util.isEmpty(this.value)||this.setDisplayValue(this.value),this.internalSetInitialValueFlag=!1},isValid:function(e){var t,i=this.properties,r=this.grid&&this.grid.properties&&this.grid.properties.inlineAdd;if(!1===bizagi.util.parseBoolean(i.visible))return!0;if(!1===bizagi.util.parseBoolean(i.editable)&&!r)return!0;if(this.setValidationMessage(""),bizagi.util.parseBoolean(i.required)){var a=this.getFormContainer(),n=!1,o=this.grid?[this]:a.getRenders(i.xpath),s=/^query/i.test(i.type);if(o.filter((function(e){return e.properties.id==i.id})).forEach((function(e){if(e.hasValue()&&(e.properties.editable||r))return n=!0,!1})),!n&&!this.properties.isClone){t=this.getResource("render-required-text").replaceAll("#label#",i.displayName);var l={xpath:i.xpath,message:t,id:i.id};return s&&(l=$.extend({},l,{id:i.id,isQuery:s})),e.push(l),!1}}if("duplicate"==i.retype){if(this.cloneRender&&this.cloneRender.getValue()!=this.getValue())return t=this.getResource("render-text-retype-error"),e.push({xpath:i.xpath,message:t}),!1}else if("double"==i.retype){var d=$("input",this.element);if(d&&d.data("oldValue")){if(""===d.val())return t=this.getResource("render-text-retype-error"),e.push({xpath:i.xpath,message:t}),!1;if(d.val()!=d.data("oldValue"))return t=this.getResource("render-text-retype-error"),e.push({xpath:i.xpath,message:t}),!1}}var u=!this.grid||!this.grid.getColumn||this.grid.getColumn(this.properties.xpath).properties.editable;if("userPassword"!==i.type&&void 0!==i.maxLength&&i.maxLength>0&&bizagi.util.isNumeric(i.maxLength)&&(u||!u&&this.controlValueIsChanged())){var c=new Number(i.maxLength),p=this.getValue();if(p&&p.toString().length>c)return t=this.getResource("render-text-maxLength-error").replaceAll("#maxLength#",c),e.push({xpath:i.xpath,message:t}),!1}return!0},hasValue:function(){var e=this.getValue();return e&&"text"===this.properties.type&&(e="string"==typeof e?e.trim():e),!bizagi.util.isEmpty(e)},postRender:function(){},postRenderReadOnly:function(){},configureHandlers:function(){},configureHandlersReadOnly:function(){},configureDesignView:function(){},processLayout:function(e,t){var i=this.properties;if(null!=this.getControl()){(t=t||{}).color&&this.changeColor(t.color,e),t.background&&this.changeBackgroundColor(t.background),!t.bold&&t.bold&&e||this.changeFontBold(t.bold,e),t.italic&&this.changeFontItalic(t.italic,e),t.underline&&this.changeFontUnderline(t.underline,e),t.strikethru&&this.changeFontStrikethru(t.strikethru,e),t.size&&this.changeFontSize(t.size,e),i.required=null!=i.required&&bizagi.util.parseBoolean(i.required);var r=null==i.visible||bizagi.util.parseBoolean(i.visible);i.required&&this.changeRequired(i.required),r||(this.grid?this.changeCellVisibility(r):this.changeVisibility(r))}},setValue:function(e,t){t=void 0===t||t,bizagi.util.identicalObjects(e,this.value)||(this.properties.previousValue=this.properties.originalValue=this.value,this.value=this.properties.value=e,this.properties.required&&"execution"==this.getMode()&&(this.checkRequired([])?this.changeRequiredLabel(!1):this.changeRequiredLabel(!0)),t&&!this.internalSetInitialValueFlag&&(this.triggerRenderChange(),this.triggerRenderValidate()))},checkRequired:function(e){var t=this.properties;return!(bizagi.util.parseBoolean(t.required)&&!this.hasValue())||(message=this.getResource("render-required-text").replaceAll("#label#",t.displayName),e.push({xpath:t.xpath,message:message}),!1)},validateInputRetype:function(){return!this.properties.retype||!this.cloneRender||this.getValue()==this.cloneRender.getValue()},triggerRenderChange:function(e){(e=e||{}).changed=void 0===e.changed||e.changed,this.triggerHandler("renderchange",{render:this,changed:e.changed})},triggerRenderValidate:function(){this.triggerHandler("rendervalidate",{render:this})},setDisplayValue:function(e){var t=this.getControl();if(this.setValue(e,!1),!this.properties.editable&&("check"!==this.properties.display||"check"===this.properties.display&&!0===bizagi.override.enableCheck)){var i=this.getDisplayValue(e);"string"!=typeof i&&"number"!=typeof i||(i=bizagi.util.sanitizeHTML(i),$(t).html("<label class='readonly-control'>"+i+"</label>"))}},getValue:function(){return this.value},getDisplayValue:function(){return this.getValue()},getLabel:function(){bizagi.util.mustImplement("getLabel")},getControl:function(){bizagi.util.mustImplement("getControl")},getControlFiller:function(){bizagi.util.mustImplement("getControlFiller")},renderControl:function(){},setValidationMessage:function(e){this.validationMessage=e},renderReadOnly:function(){var e=this.getValue(),t="";return bizagi.util.isObject(e)&&void 0!==e.value?t=bizagi.util.sanitizeHTML(e.value):bizagi.util.isEmpty(e)||(t=bizagi.util.isString(e)?bizagi.util.encodeHtmlText(e):e),t},postRenderPrintVersion:function(){},changeDisplayOption:function(e){this.properties.displayType=e},getDisplayOptionClass:function(e){return""},changeLabelAlign:function(e){this.properties.labelAlign=e},changeValueAlign:function(e){this.properties.valueAlign=e},getAlignClass:function(e){return""},customizeRenderWidth:function(){},changeColor:function(e,t){var i=this,r=i.getControl(),a=i.getLabel();t=void 0===t&&null==t||t;r&&a&&("none"!=e?"value"!==i.properties.displayType&&t?(i.element.each((function(){this.style.setProperty("color",e,"important")})),"grid"==i.properties.type&&i.getControl().find(".bz-mobile-grid__header-title").each((function(){this.style.setProperty("color",e,"important")})),i.getLabel().find("label").css("color",e,"!important"),!1===i.properties.editable&&(i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getElementsToStylize($("label",i.getControl()).css("color",e,"!important")))):(i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getControl().find("*").each((function(t,r){i.getElementsToStylize(r).css("color",e,"!important")}))):(i.element.css("color",""),i.getLabel().find("label").css("color",""),i.getControl().css("color",""),i.getControl().find("input, textarea").each((function(e,t){var r=$(t).data("originalColor")||"";i.getElementsToStylize(t).css("color",r)}))))},changeBackgroundColor:function(e){var t=this.getControl(),i=this.getLabel();if(t&&i)if("none"!=e){this.element.each((function(){this.style.setProperty("background-color",e,"important")})),void 0!==i.find("label").style?this.getLabel().find("label").style("background-color",e,"important"):this.getLabel().find("label").css("background-color",e,"!important");var r=this.getLabel().attr("style");r+="; background-color:"+e+"!important",this.getLabel().attr("style",r)}else this.element.css("background-color",""),this.getLabel().find("label").css("background-color",""),this.getControl().css("background-color",""),this.getControl().find("input, textarea").each((function(e,t){var i=$(t).data("originalColor")||"";$(t).css("background-color",i)}))},getFormattingLabel:function(){return this.getLabel().find("label")},changeFontBold:function(e,t){t=void 0===t&&null==t||t;0!=bizagi.util.parseBoolean(e)&&t?(this.getFormattingLabel().css("font-weight","bold","!important"),this.getControl().find("*").each((function(e,t){$(t).css("font-weight","bold","!important")}))):t&&this.getFormattingLabel().css("font-weight","normal","!important"),t||(1==bizagi.util.parseBoolean(e)?this.getControl().find("*").each((function(e,t){$(t).css("font-weight","bold","!important")})):this.surrogateKey&&"summary"==this.surrogateKey||(this.getControl().find("*").each((function(e,t){$(t).css("font-weight","normal","!important")})),this.getControl().css("font-weight","normal","!important")))},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue,a=!0,n=bizagi.util.normalizeType(e.type),o=this.getFormContainer();if("duplicate"===e.retype&&this.cloneRender&&o.isStartForm())return!0;if($.forceCollectData)return!0;if("grid"===n&&"pending"===this.ready().state())return!1;if(["combo","queryCombo","list","queryList","radio","queryRadio"].includes(n)||/^cascadingcombo$/i.test(n))t&&void 0!==t.length&&(t=t[0]),i&&void 0!==i.length&&(i=i[0]),r&&void 0!==r.length&&(r=r[0]),t=t&&t.id?t.id:t,i=i&&i.id?i.id:i,a=void 0!==(r=r&&r.id?r.id:r)&&null!=r?i!=t||i==r:i!=t;else if("boolean"===n||"queryBoolean"===n||"queryCheck"===n)a=bizagi.util.parseBoolean(i)!=bizagi.util.parseBoolean(t);else if("searchNumber"===n)a=!!t;else if("number"===n)a=(null!==t&&""!==t||null!==i&&""!==i)&&i!==t;else if("text"===n)a=(null!==t&&""!==t||null!==i&&""!==i)&&i!==t;else if("date"===n)i||t?(e.showTime||(t=bizagi.util.getNormalizedDate(t,e.fullFormat),i=bizagi.util.getNormalizedDate(i,e.fullFormat)),a=i!=t):a=!1;else if("actionLauncher"===n){a=!1;var s=[];try{s="string"==typeof i?JSON.parse(i):i}catch(e){}var l=function(e,t){e=e||"";for(var i=!1,r=0,a=(t=t||[]).length;r<a;r++)if(t[r].guidAction==e){i=!0;break}return i};if(s.length==t.length)for(var d=0,u=s.length;d<u;d++)l(s[d].guidAction,t)||(a=!0);else a=!0}else if("polymorphicLauncher"===n||"entityTemplate"===n)a=i.length!=t.length||JSON.encode(t)!=JSON.encode(i);else if("searchList"===n){var c={};try{c=JSON.parse(t)}catch(e){console.log("Error when detect change value on searchList control")}a=JSON.encode(i)!=JSON.encode(c.value)}else a=!["signature","image"].includes(n)&&i!==t;return a},changeFontItalic:function(e,t){var i=this;t=void 0===t&&null==t||t;"value"!=i.properties.displayType&&t?1==bizagi.util.parseBoolean(e)?i.getFormattingLabel().css("font-style","italic","!important"):i.getFormattingLabel().css("font-style","normal","!important"):1==bizagi.util.parseBoolean(e)?(t&&i.getFormattingLabel().css("font-style","italic","!important"),i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("font-style","italic","!important")})):i.getElementsToStylize(i.getControl()).css("font-style","italic","!important")):(t&&i.getFormattingLabel().css("font-style","normal","!important"),i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("font-style","normal","!important")})):i.getElementsToStylize(i.getControl()).css("font-style","normal","!important"))},changeFontUnderline:function(e,t){var i=this,r=i.properties.textFormat||{},a=i.properties.valueFormat||{},n=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(a.strikethru)?"line-through ":"";t=void 0===t&&null==t||t;1==bizagi.util.parseBoolean(e)&&t?(i.getFormattingLabel().css("text-decoration",n+"underline","!important"),i.getControl().each((function(e,t){i.getElementsToStylize(t).css("text-decoration",n+"underline")}))):t&&i.getFormattingLabel().css("text-decoration",n,"!important"),"value"!=i.properties.displayType&&t||(1==bizagi.util.parseBoolean(e)?i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o+"underline","!important")})):i.getElementsToStylize(i.getControl()).css("text-decoration",o+"underline","!important"):i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o,"!important")})))},changeFontStrikethru:function(e,t){var i=this,r=i.properties.textFormat||{},a=i.properties.valueFormat||{},n=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(a.underline)?"underline ":"";t=void 0===t&&null==t||t;1==bizagi.util.parseBoolean(e)&&t?i.getFormattingLabel().css("text-decoration",n+"line-through","!important"):t&&i.getFormattingLabel().css("text-decoration",n,"!important"),"value"!=i.properties.displayType&&t||(1==bizagi.util.parseBoolean(e)?i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o+"line-through","!important")})):i.getElementsToStylize(i.getControl()).css("text-decoration",o+"line-through","!important"):i.properties.editable?i.getControl().find("*").each((function(e,t){i.getElementsToStylize(t).css("text-decoration",o,"!important")})):i.getElementsToStylize(i.getControl()).css("text-decoration",o,"!important"))},changeFontSize:function(e,t){t=void 0===t&&null==t||t;if("0"!=e){var i=this.getFormattingLabel(),r=100+10*Number(e)+"%";if(t&&i.css("font-size",r,"!important"),"value"==this.properties.displayType||!t){var a=this.getControl();"object"==_typeof(a.children())&&a.children().length>0?this.getElementsToStylize(a.children()).css("font-size",r,"!important"):(this.getElementsToStylize(a).css("font-size",r,"!important"),-1!=this.properties.type.indexOf("ombo")&&e>4&&a.children(0).height(2*e+20)),this.getElementsToStylize(a.find(".ui-bizagi-render-date")).css("line-height","normal")}}},getElementsToStylize:function(e){return $(e)},changeVisibility:function(e){var t=this.properties;1==bizagi.util.parseBoolean(e)?"hidden"!==t.type&&(this.element.show(),this.element.css("display",""),t.required&&(this.hasValue()||this.changeRequiredLabel(!0))):this.element&&this.element.hide(),t.visible=e},changeEditability:function(e){var t=this,i=t.properties,r=t.getControl();i.editable="Default"==e?t.originalProperties.editable:bizagi.util.parseBoolean(e),i.editabilityEnabled=i.editabilityEnabled||i.editable,r.empty(),"function"==typeof t.internalRenderControl&&$.when(t.internalRenderControl()).done((function(e){"function"==typeof t.emptyControlByChangeEditability&&t.emptyControlByChangeEditability(),t.asyncRenderDeferred||r.append(e),t.postRenderElement(t.element)}))},changeEditabilityCellControl:function(e,t,i){var r=this.properties,a=this.grid.getColumn(i),n=a.getDecorated(t);r.editable="Default"===e?this.originalProperties.editable:bizagi.util.parseBoolean(e),r.editabilityEnabled=r.editabilityEnabled||r.editable,this.internalRenderCellControl(r.editable,t,a,n)},internalRenderCellControl:function(e,t,i,r){var a=this,n=a.getControl();n.empty(),"function"==typeof a.internalRenderControl&&$.when(a.internalRenderControl()).done((function(o){a.asyncRenderDeferred||n.append(o),a.postRenderElement(a.element),e&&(i.bind("rendered",(function(){i.readyDeferred.resolve()})),r.unbind("renderchange"),r.bind("renderchange",(function(e,r){i.changed=!0,a.grid.onCellChange(i,null,t,r)})))}))},changeRequired:function(e){var t=this.properties,i=t.displayName||"",r=$("label",this.getLabel()),a=this.getControl();t.required=e,"execution"==this.getMode()&&this.checkRequired([])?this.changeRequiredLabel(!1):1==bizagi.util.parseBoolean(e)&&t.editable?"rtl"==this.properties.orientation?a.prepend('<div class="ui-bizagi-render-control-required-rtl"></div>'):(a.addClass("control-required"),a.prepend('<div class="ui-bizagi-render-control-required"></div>')):"rtl"==this.properties.orientation?$(".ui-bizagi-render-control-required-rtl",a).remove():(a.removeClass("control-required"),$(".ui-bizagi-render-control-required",a).remove()),r.html(i),this.triggerRenderValidate()},changeRequiredLabel:function(e){var t=this.properties,i=t.displayName||"",r=$("label",this.getLabel()),a=this.getControl();1==bizagi.util.parseBoolean(e)&&t.editable?"rtl"==this.properties.orientation?a.prepend('<div class="ui-bizagi-render-control-required-rtl"></div>'):(a.addClass("control-required"),a.append('<div class="ui-bizagi-render-control-required"></div>')):"rtl"==this.properties.orientation?$(".ui-bizagi-render-control-required-rtl",a).remove():(a.removeClass("control-required"),$(".ui-bizagi-render-control-required",a).remove()),r.html(i),this.triggerRenderValidate()},refreshControl:function(e){var t=this,i=t.properties,r=(t.value,t.getFormContainer().properties.id||"");return e=e||{},t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||e.xpathContext,idForm:r})).pipe((function(e){t.grid&&bizagi.override.restoreAppearanceAfterRefresh&&t.saveGridChildrenVisualChanges(),t.control=t.controlFiller=t.label=null;var i=t.element;return t.initializeData(e.render),$.when(t.render()).pipe((function(e){var i=$(e);t.postRenderElement(i);return t.properties.originalValue=t.value,i})).pipe((function(e){i.replaceWith(e),t.grid||t.triggerRenderChange({changed:!1}),bizagi.override.restoreAppearanceAfterRefresh&&(t.grid?(t.restoreGridChildrenVisualChanges(),t.restoreGridAppearance()):t.restoreAppearance()),t.afterToRefresh()}))})).fail((function(e){e=t.processFailMessage(e)})).always((function(){t.endLoading()}))},refreshDesignControl:function(e){var t=this,i=t.properties;t.beforeToRefresh(),t.control=t.controlFiller=t.label=null,$.extend(e.render.properties,{xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext||"form",idPageCache:i.idPageCache});var r=t.element;return t.initializeData(e.render),$.when(t.render()).pipe((function(e){var i=$(e);t.postRenderElement(i);return t.properties.originalValue=t.value,i})).pipe((function(e){r.replaceWith(e),t.triggerRenderChange(),t.beforeToRefresh()}))},cleanData:function(){this.setValue(""),this.clearDisplayValue()},clearDisplayValue:function(){var e=this.getControl(),t=e.find("input");t.length>0?t.val(this.getValue()):!1===this.properties.editable&&$(e).html("<label class='readonly-control'></label>")},updateOriginalValue:function(){this.properties.originalValue=this.value},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();this.controlValueIsChanged()&&(bizagi.util.isEmpty(i)||(bizagi.util.isEmpty(r)?""!==r&&null!==r||(e[t.xpath]=""):e[t.xpath]=r)),this.validateInputRetype()||(e[t.xpath]="")},hasChanged:function(e){return!!this.controlValueIsChanged()&&(e.push(!0),!0)},configureHandlersQueryForm:function(){var e=this;e.element.find(".ui-bizagi-render-control-included").change((function(){e.properties.included=$(this).is(":checked")}))},getRenderId:function(){var e=this;return bizagi.util.tryCatch((function(){return e.properties.id}),null)},collectDataQueryForm:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=null;if(!bizagi.util.isEmpty(i)){if(null!=r)a=void 0!==r.id?bizagi.util.isEmpty(r.id)?null:[r]:""!==r?r:null;if(null!==a||t.included){var n=(this.properties.typeSearch||this.properties.rangeQuery||"NONE").toUpperCase(),o={value:a,included:this.properties.included,xpath:t.xpath,searchType:n,orderType:"NONE",renderId:this.getRenderId()};void 0!==t.displayXpath&&""!==t.displayXpath&&(o.displayXpath=t.displayXpath),e.push(o)}}},canBeSent:function(){var e,t=this.properties,i=bizagi.util.parseBoolean(t.displayOnly)||!1,r=bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editabilityEnabled);if(t.isClone)return!1;if(!i&&r)return!0;if(t.xpath&&1==this.getFormContainer().getRenders(t.xpath).length){if(e=!!$.forceCollectData&&$.forceCollectData.toString(),$.forceCollectData=e?void 0:$.forceCollectData,this.controlValueIsChanged())return $.forceCollectData=e?bizagi.util.parseBoolean(e):$.forceCollectData,!0;$.forceCollectData=e?bizagi.util.parseBoolean(e):$.forceCollectData}return!1},canBeSentQueryForm:function(){return!this.properties.isClone},focus:function(e){var t=this;if(t.properties.visible){this._super();var i=$("#ui-bizagi-wp-app-render-form-content"),r=function(){var e=t.getControl(),r="grid"!=t.properties.type?$("input, select, option, textarea",e):$("input, select, option, textarea",e).first();r.length>0&&$.each(r,(function(e){var t=r[e];if("hidden"!=$(t).attr("type")&&"none"!=$(t).css("display")&&"hidden"!=$(t).css("visibility"))try{bizagi.util.isIE()||bizagi.util.autoScrollBottom(i),t.focus()}catch(e){}}))};$.when(t.ready()).done((function(){if(e>0)var t=setTimeout((function(){r(),clearTimeout(t)}),e);else r()}))}},getDefaultLabelAlign:function(e){return"default"},getDefaultValueAlign:function(e){return"default"},getRTLAlign:function(e){return e},configureSubmitOnChange:function(){var e=this,t=e.properties,i="",r=t.id;if(t.editable){t.dependencies=t.dependencies||"all";var a={conditions:{expressions:[{simple:{xpath:i=t.xpath?t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.xpath:t.xpath:t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.id:t.id,renderId:t.id,operator:"changes",argumentType:"const"}}]},commands:[{xpath:i,command:"submit-value",argument:t.dependencies}],dependencies:[i],elseCommands:[]};t.submitOnChangexpathContext&&e.grid&&(a.conditions.expressions[0].simple.containerId=e.grid.properties.id),$.when(e.ready()).done((function(){e.getFormContainer().addSubmitAction(i+"."+r,a)}))}},submitOnChange:function(e,t,i){var r=this,a=$.Deferred();return""!=r.properties.contexttype&&e&&(e[r.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=r.properties.contexttype),$.when(r.isReadyToSave()).done((function(){r.internalSubmitOnChange(e,t,i).done((function(){a.resolve()})).fail((function(){a.reject()}))})),a.promise()},getCacheIdCase:function(){var e=this.getParams().idCase;return void 0===bizagi.cache?(bizagi.cache={},bizagi.cache.idCaseObject={idCase:void 0!==e?e:void 0!==bizagi.cache.idCase?bizagi.cache.idCase:void 0}):void 0!==e&&void 0!==bizagi.cache.idCaseObject?bizagi.cache.idCaseObject.idCase=e:void 0!==e&&void 0===bizagi.cache.idCaseObject&&(bizagi.cache.idCaseObject={},bizagi.cache.idCaseObject.idCase=e),e=void 0===e?void 0===bizagi.cache.idCaseObject?void 0:bizagi.cache.idCaseObject.idCase:e},internalSubmitOnChange:function(e,t,i){var r=this.getFormContainer(),a=this.properties,n={data:e,bRefreshForm:t,notCollect:i,properties:{idCase:this.getCacheIdCase(),id:a.id,xpath:a.xpath,idPageCache:a.idPageCache,contexttype:a.contexttype}};return r.internalSubmitOnChange(n)},ready:function(){return $.when(this.parent.ready(),this.isRendered())},getCustomHandlers:function(){var e=this.getFormContainer();return e?e.getCustomHandlers():null},getCustomHandler:function(e){var t=this.getCustomHandlers();return t?t[e]:null},calculateRenderWidth:function(e,t,i){if(e="100"==t&&void 0===e?"0":e?"0"!=e?e:"50":"50%",t=t?"0"!=t?t:"50":"50%","normal"==i||"both"==i||"reversed"==i){if(e&&bizagi.util.percent2Number(e)<5&&t&&bizagi.util.percent2Number(t)<5)return{label:0,control:100};e&&!t?t=100-(e=bizagi.util.percent2Number(e)):!e&&t?e=100-(t=bizagi.util.percent2Number(t)):(e=bizagi.util.percent2Number(e))+(t=bizagi.util.percent2Number(t))!=100&&void 0!==this.properties&&"pixels"!=this.properties.layoutType&&(t=100-e)}else e=100,t=100;return{label:e,control:t}},getIdCase:function(){return this.getFormContainer().params.idCase||bizagi.context.idCase},getIdWorkitem:function(){return this.getFormContainer().params.idWorkitem||bizagi.context.idWorkitem},getidTask:function(){return this.getFormContainer().params.idTask||bizagi.context.idTask},getSessionId:function(){return this.getFormContainer().properties.sessionId},changeCellColor:function(e){var t=this.getControl();t&&("none"!=e?(t.css("color",e),t.find("input, textarea, label").each((function(t,i){$(i).css("color",e)}))):(t.css("color",""),t.find("input, textarea, label").each((function(e,t){$(t).css("color","")}))))},changeCellBackgroundColor:function(e){var t=this.getControl(),i="",r="";if(t)if("none"!=e&&(i=e,r="none"),this.properties.editable){var a=!1;t.find("input, textarea, .ui-selectmenu").each((function(e,t){"text"!=t.type&&"textarea"!=t.type||$(t).hasClass("ui-select-data")||(a=!0),$(t).css({"background-color":i,"background-image":r})})),a||t.closest("td").each((function(e,t){$(t).css({"background-color":i,"background-image":r})}))}else t.each((function(e,a){($(a).hasClass("ui-bizagi-cell-readonly")?t.closest("td"):$(a)).css({"background-color":i,"background-image":r})}))},changeCellVisibility:function(e){var t=this.properties,i=this.getControl();i&&(1==bizagi.util.parseBoolean(e)?(i.css("visibility","visible"),i.css("display",""),this.element&&this.element.show()):i.css("visibility","hidden")),t.visible=e},changeCellRequired:function(e){var t=this.properties,i=this.getControl();i&&(1==bizagi.util.parseBoolean(e)&&bizagi.util.isEmpty(this.value)?(i.addClass("control-required"),i.append('<div class="ui-bizagi-render-control-required"></div>')):(i.removeClass("control-required"),$(".ui-bizagi-render-control-required",i).remove()),t.required=e)},startActionExecution:function(){this.startLoading(),this.actionExecutionDeferred=new $.Deferred},endActionExecution:function(){this.endLoading(),this.actionExecutionDeferred&&this.actionExecutionDeferred.resolve(),delete this.actionExecutionDeferred},readyActionExecution:function(){return this.actionExecutionDeferred?this.actionExecutionDeferred.promise():$.when(!0)},isFromCreatedRow:function(){if(this.grid)for(var e=this.grid.columns.length;e-- >0;)if(this.grid.columns[e].properties.xpath==this.properties.xpath&&1==this.grid.columns[e].isNewRow)return!0;return!1},submitInvalidatePageCacheRequest:function(e){var t=this.properties,i=e?e.idPageCache:t.idPageCache;this.dataService.invalidatePageCache({idPageCache:i})},isDesignMode:function(){return"design"===this.getMode()},isExecutionMode:function(){return"execution"===this.getMode()},preventDefaultForAnchorTag:function(){(bizagi.util.isSharepointContext()||bizagi.util.isWebpartContext())&&$("a[href='#']",this.getControl()).click((function(e){e.preventDefault()}))},getMainForm:function(e){var t=e.params.fromRender;if(void 0===t)return e;this.getMainForm(t.getFormContainer())},setInterceptionObserver:function(e,t){var i=this,r=new IntersectionObserver((function(){i.pluginInitialized||0===e.width()||("function"==typeof t&&t(),r.disconnect())}));r.POLL_INTERVAL=100,r.observe(e.get(0))},setResizeObserver:function(e,t){var i=this,r=new ResizeObserver((function(){i.pluginInitialized||0===e.width()||("function"==typeof t&&t(),r.disconnect())}));r.observe(e.get(0))},restoreGridAppearance:function(){var e=this.getIndexes();this.restoreAppearance(),this.columns.length>0&&$.each(this.columns,(function(t,i){for(var r=0;r<e.length;r++)i.decorateRenders[e[r]].restoreCellAppearance()}))},saveGridChildrenVisualChanges:function(){var e=this,t=e.getIndexes();e.gridChildrenVisualChanges=[],e.columns.length>0&&$.each(e.columns,(function(i,r){if(r.properties.xpath)for(var a=0;a<t.length;a++){var n=r.decorateRenders[t[a]];n&&n.properties&&(e.gridChildrenVisualChanges[n.properties.id+t[a]]=n.visualChanges)}}))},restoreGridChildrenVisualChanges:function(){var e=this,t=e.getIndexes();e.columns.length>0&&$.each(e.columns,(function(i,r){if(r.properties.xpath)for(var a=0;a<t.length;a++){var n=r.decorateRenders[t[a]];n&&n.properties&&(n.visualChanges=e.gridChildrenVisualChanges[n.properties.id+t[a]]||{})}})),delete e.gridChildrenVisualChanges},restoreCellAppearance:function(){for(var e in this.visualChanges)switch(e){case"color":this.changeCellColor(this.visualChanges[e]);break;case"backgroundColor":this.changeCellBackgroundColor(this.visualChanges[e]);break;case"required":this.changeCellRequired(this.visualChanges[e]);break;case"editability":this.changeEditabilityCellControl(this.visualChanges[e],this.surrogateKey,this.properties.xpath);break;case"visibility":this.changeCellVisibility(this.visualChanges[e]);break;case"minValue":this.changeMinValue(this.visualChanges[e]);break;case"maxValue":this.changeMaxValue(this.visualChanges[e])}},formatValue:function(e){return e}}),$.Class.extend("bizagi.rendering.render.base",{},{processLayout:function(e,t){var i=this.properties;if("boolean"==typeof e)if(e)this.processLabelLayout(t);else{this.processControlLayout(t),i.required=void 0!==i.required&&bizagi.util.parseBoolean(i.required);var r=void 0===i.visible||bizagi.util.parseBoolean(i.visible);i.required&&this.changeRequired(i.required),r||this.changeVisibility(r)}else console.warm("error calling processLayout, 'isLabelFormat' is not boolean")},processLabelLayout:function(e){var t=this.getLabel();null!=t&&(void 0===(e=e||{}).bold&&(e.bold=!0),this.changeBackgroundColor(e.background).changeFontColor(t,e.color).changeFontBold(t,e.bold).changeFontSize(t,e.size).changeFontItalic(t,e.italic).changeTextDecoration(t,(e.underline?"underline":"")+(e.strikethru?" line-through":"")))},processControlLayout:function(e){var t=this.getControl(),i=this.getElementsToStylize(t);e=e||{},this.changeFontColor(i,e.color).changeFontBold(i,e.bold).changeFontItalic(i,e.italic).changeFontSize(i,e.size).changeTextDecoration(i,(e.underline?"underline":"")+(e.strikethru?" line-through":""))},changeColor:function(e){var t=this.getLabel(),i=this.getControl(),r=this.getElementsToStylize(i);return this.changeFontColor(t,e).changeFontColor(r,e)},changeFontColor:function(e,t){if(void 0===e)return this;if(void 0===t)return this;var i="none"!==t?t:"";return e.css("color",i),this},changeFontSize:function(e,t){if(void 0===t)return this;if(void 0===e)return this;if("0"!==t){var i=100+10*Number(t)+"%";e.css("font-size",i)}return this},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)},changeFontItalic:function(e,t){var i=bizagi.util.parseBoolean(t)?"italic":"normal";return e.css("font-style",i),this},changeFontBold:function(e,t){var i=bizagi.util.parseBoolean(t)?"bold":"normal";return e.css("font-weight",i),this},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.element.css("background-color",e):this.element.css("background-color",""),this)},changeCellBackgroundColor:function(e){return this.getCellBackgroundFunction(this.properties.editable.toString(),this.properties.type)(e)},getCellBackgroundFunction:function(e,t){var i={true:{columnDate:this.changeInputBackgroundColor.bind(this)},false:{default:this.changeBackgroundColor.bind(this)},default:this.changeBackgroundColor.bind(this)};return i[e][t]||i.default},changeInputBackgroundColor:function(e){return void 0===e?this:("none"!==e?$(".bz-input-icon",this.element).css("background-color",e):$(".bz-input-icon",this.element).css("background-color",""),this)},changeRequiredLabel:function(){},changeCellRequired:function(e){this.changeRequired(e)},getRTLAlign:function(e){return void 0===e||""==e?"default":e},getDefaultLabelAlign:function(){return"default"},getDefaultValueAlign:function(){return"default"}}),bizagi.rendering.render.extend("bizagi.rendering.render",{},{getMenu:function(){return this.getFormContainer().getParams().menu},postRender:function(){bizagi.log(" post render smartphone  edit",this,"error")},postRenderSingle:function(){var e=this,t=e.properties,i=e.getControl();if(e.configureHelpText(),e.checkListGroup=$(".ui-bizagi-render-checkList .ui-bizagi-render-checkList-item",i),void 0!==t.textFormat&&void 0!==t.textFormat.background&&e.changeBackgroundColor(t.textFormat.background),void 0!==t.textFormat&&void 0!==t.textFormat.color&&(e.getControl().parent().css("color",t.textFormat.color),e.element.find("input").css("color",t.textFormat.color),"radio"!==t.type&&e.element.find(".ui-bizagi-render-control > span").css("color",t.textFormat.color)),void 0!==t.valueFormat&&void 0!==t.valueFormat.color&&(e.element.find(".ui-bizagi-render-control > span").css("color",t.valueFormat.color),"radio"!==t.type&&e.element.find("input").css("color",t.valueFormat.color)),$(e.element).hasClass("bz-command-edit-inline")||$(e.element).hasClass("bz-command-not-edit")||$(e.element).hasClass("bz-rn-non-editable"))return!0;var r=e.element;("image"!==e.properties.type&&"columnImage"!==e.properties.type||0!==(r=$(e.element).find("img")).length)&&$(r).bind("click",(function(){$.when(e.renderEdition()).then((function(){e.endLoading(),e.postRenderEdit(),bizagi.util.isEmpty(e.value)||(e.value,e.setDisplayValueEdit(e.value))}))}))},postRenderEdit:function(){var e=this,t=e.getFormContainer().container,i=e.properties,r=$("body").scrollTop();if(e.getParams()&&e.getParams().postRenderEdit)return e.getParams().postRenderEdit(e);$("#container-items-edit",t).find(".ui-bizagi-container-inputs").remove();$(".ui-bizagi-container-children-form",t).hide(),$("#container-items-edit",t).empty(),$("#container-items-edit",t).show(),$(".ui-bizagi-button-container",t).hide(),$("#container-items-edit",t).append($.kendoTmpls(e.renderFactory.getTemplate("editRender"),{label:i.displayName})),$("#container-items-edit",t).find(".ui-bizagi-container-inputs").html(e.inputEdition);var a=e.contextEdit=$(t).find("#container-items-edit"),n=function(){$(".ui-bizagi-container-children-form",t).show(),$("#container-items-edit",t).hide(),$(".ui-bizagi-button-container",t).show(),setTimeout((function(){window.scrollTo(0,r)}),10)};$(".ui-bizagi-container-button-edit .ui-bizagi-save-btn",a).bind("click",(function(){n(),$.when(e.actionSave()).done((function(){e.properties.submitOnChange&&e.submitOnChange()}))})),$(".ui-bizagi-container-button-edit .ui-bizagi-cancel-btn",a).bind("click",(function(){n()}))},getLabel:function(){if(!this.label){var e=$(".ui-bizagi-label",this.element||this.observableElement);return e.length>0&&(this.label=e),e}return this.label},getContainerRender:function(){return $(this.element)},getArrowContainer:function(){return this.arrow||(this.arrow=$(".bz-container-render-cell1 >.ui-bizagi-render-edition-arrow ",this.element||this.observableElement)),this.arrow},getAlignClass:function(e){return e},getArrow:function(){return this.arrow=$(".bz-container-render-cell1 >.ui-bizagi-render-edition-arrow > .bz-cm-icon  ",this.element||this.observableElement),this.arrow},getControl:function(){return this.control&&0!==this.control.length||(this.control=$(".ui-bizagi-render-control",this.element||this.observableElement)),this.control},getContainerHelpText:function(){return this.containerHelpText||(this.containerHelpText=$(".bz-container-rn-helptext",this.element||this.observableElement)),this.containerHelpText&&0!==this.containerHelpText.length?this.containerHelpText:null},getControlFiller:function(){return this.controlFiller||(this.controlFiller=$(".ui-bizagi-render-control",this.element||this.observableElement)),this.controlFiller},getContainerMessage:function(){return this.containerMessage||(this.containerMessage=$(".bz-rn-messages",this.element||this.observableElement)),this.containerMessage},getContextEdit:function(){return this.contextEdit},changeDisplayOption:function(e){var t=this.properties,i=e||t.displayType||"normal",r=t.orientation||"",a=this.getControl(),n=["image","columnImage","activityCheckList","userfield","date","columnDate","searchDate","list","columnList","link","columnLink","fileprint","searchList","geolocation","money","multiSelect"];bizagi.util.isMobileGridEnabled()&&n.push("columnUpload","columnImage"),$(this.element).hasClass("bz-command-edit-inline")||-1===n.indexOf(t.type)||$(this.element).addClass("bz-command-edit-inline"),"value"==i&&(a&&a.addClass("bz-rn-display-value"),this.getLabel().hide()),"reversed"!==i&&"rtl"!==r||(a.addClass("bz-control-reversed"),a.find("input").addClass("bz-render-reversed"),a.children().hasClass("bz-render-reversed")||a.children().addClass("bz-render-reversed"),this.getLabel().addClass("bz-label-reversed")),"label"==i&&"layoutLabel"!==t.type&&(a.hide(),this.getLabel().show())},changeLabelAlign:function(e){},changeValueAlign:function(e){},customizeRenderWidth:function(){},submitOnChange:function(e,t){var i=this,r=new $.Deferred;return bizagi.util.smartphone.startLoading(),$.when(i.isReadyToSave()).done((function(){$.when(i.internalSubmitOnChange(e,t)).done((function(){r.resolve()})).fail((function(){r.reject()})).always((function(){bizagi.util.smartphone.stopLoading()}))})),r.promise()},setValidationMessage:function(e){var t;(this._super(e),e&&e.length>0)?(e=e.replace(/<\w+>([^<]*)<\/\w+>/g,"$1"),this.getContainerMessage().html(t=$('<span class="bz-rn-err"></span>')),t.attr("data-error",e)):this.getContainerMessage().html("")},renderSingle:function(){},renderEdition:function(){},internalPostRender:function(){var e=this;$.when(e.renderSingle()).then((function(){e.endLoading(),e.changeDisplayOption(),e.postRenderSingle(),e.renderingDeferred&&e.renderingDeferred.resolve(),bizagi.util.isEmpty(e.value)||(e.value,e.setDisplayValue(e.value)),e.processLayout(isLabelFormat,e.properties.textFormat||{}),e.processLayout(!isLabelFormat,e.properties.valueFormat||{})}))},setDisplayValue:function(e){var t=this.getControl();this.setValue(e,!1);var i=this.getDisplayValue(e);"string"==typeof i&&t.html(i)},setPlaceHolder:function(){var e=this.properties,t=this.getControl();e.editable&&t.find(".bz-rn-text").attr("placeholder",e.required?"Required":"Optional")},changeEditability:function(e){var t,i=bizagi.util.parseBoolean(e);this._super(e),(t=this.getRenderedElement())&&t.toggleClass("bz-rn-non-editable",!i).toggleClass("bz-rn-read-only",!i)},setDisplayValueEdit:function(e){},actionSave:function(){this.setValue(this.inputEdition.val(),!1)},changeRequiredLabel:function(){"value"!=this.properties.displayType?this.properties.required&&(this.checkRequired([])?$("div.bz-rn-required",this.getLabel()).hide():$("div.bz-rn-required",this.getLabel()).show()):this.changeRequiredLabelByVal()},changeRequiredLabelByVal:function(){this.properties.required&&(this.checkRequired([])?$("div.bz-rn-required",this.getControl()).hide():$("div.bz-rn-required",this.getControl()).show())},changeRequired:function(e){if("value"!=this.properties.displayType){var t=$("label",this.getLabel());this.getLabel().find(".bz-rn-required").remove();var i=this.properties;i.required=e,bizagi.util.parseBoolean(e)?(t.text((i.displayName||"")+" "),this.hasValue()?t.before("<div class='bz-rn-required' style='display: none'></div>"):t.before("<div class='bz-rn-required'></div>"),this.setPlaceHolder()):t.text(i.displayName||""),this.triggerRenderValidate()}else this.changeRequiredControl(e)},changeRequiredControl:function(e){var t=this.getControl();t.find(".bz-rn-required").remove(),this.properties.required=e,bizagi.util.parseBoolean(e)&&(this.hasValue()?t.prepend("<div class='bz-rn-required' style='display: none'></div>"):t.prepend("<div class='bz-rn-required'></div>"),this.setPlaceHolder()),this.triggerRenderValidate()},configureLabel:function(){return this.properties.displayName},configureHelpText:function(){var e=this.properties;if(e&&e.helpText&&""!==e.helpText){var t=this.getContainerHelpText();t&&$(t).helpText({helpText:e.helpText,dir:e.orientation})}},startLoading:function(){},getElementsToStylize:function(e){return e=$("*:not(.bz-mo-icon):not(.bz-rn-container-control-icon):not(.bz-rn-upload-show-menu):not(.bz-rn-yesno)",$(e))},endLoading:function(){},changeBackgroundColor:function(e){e&&"none"!==e&&this.getControl().closest(".ui-bizagi-render").css("background-color",e)},clearDisplayValue:function(){var e=this.getControl().find("input").filter((function(e,t){return"file"!==t.type&&"radio"!==t.type&&"checkbox"!==t.type}));e.length>0?e.val(this.getValue()):this.setDisplayValue("")}}),$.Class.extend("bizagi.rendering.form",{},{init:function(e){var t=e.data,i=bizagi.util.detectDevice();this.rendersById={},this.rendersByXpath={},this.rendersByXpathId={},this.rendersByType={},this.idPageCache=t.pageCacheId,this.compatibilityVersion=t.properties.compatibilityVersion||0,this.mode=e.mode||"execution",this.focus=e.focus,this.params=e,this._super(e);var r="";r="desktop"!==i?this.getResource("render-form-user-confirmation-message").replace(/<br(\/| \/)>/g,"\n"):this.getResource("render-form-user-confirmation-message");var a=this.properties;a.sessionId=t.sessionId,a.displayAsReadOnly=bizagi.util.parseBoolean(t.displayAsReadOnly)||!1,a.userConfirmationMessage=a.userConfirmationMessage||r,a.orientation=a.orientation||"ltr",a.hasRule=bizagi.util.parseBoolean(a.hasRule)||!1,a.contexttype=e.contexttype||"",a.paramsRender=e.paramsRender||{},a.processPath=e.data.processPath?e.data.processPath.replaceAll("|/|","  &rsaquo;  "):"",a.breadCrumb=e.data.processPath?e.data.processPath.split("|/|"):[],a.type=a.type||"form",this.validations=t.validations,this.actions=t.actions,this.allowValidateAndSaveAction=bizagi.override&&!0===bizagi.override.enableActionValidateAndSave;var n=bizagi.util.isFeatureEnabled("enableExecuteQuickActions"),o=null===n||n;if(this.useQuickActions=o&&this.hasQuickActions(t,o),this.initializeButtons(t),t.transitions&&(this.transitions=t.transitions),this.originalProcessButton=this.processButton,this.isRoutingDisabled=!1,e.applicationParent)switch(e.applicationParent){case"NEWWORKPORTAL":this.isRoutingDisabled=!0}this.isOfflineFormsV2Supported=bizagi.util.isMobileDevice()&&bizagi.util.isOfflineFormsV2Supported(),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.rendersById[a.id]=this},initializeButtons:function(e){var t=this;t.buttons=[],e.buttons&&$.each(e.buttons,(function(e,i){var r=i.button.properties;r.caption=bizagi.util.isEmpty(r.caption)||t.getResource(r.caption)===r.caption?r.caption:t.getResource(r.caption),r.actions&&$.each(r.actions,(function(e,t){r[t]=!0})),r.ordinal=e,r.action=r.next?"next":r.nextWithoutValidations?"nextWithoutValidations":r.submitData?"save":r.cancel?"cancel":r.back?"back":r.createnewcase?"createnewcase":r.validate?"validate":"",r.save="save"===r.action,r.quickAction="quickactions"===r.type,(r.next||r.back||r.nextWithoutValidations)&&(r.routing=!0),r.hasRule&&(r.executeRule=!0),t.allowValidateAndSaveAction&&r.validate&&(r.submitData=!0,r.refresh=!0,r.save=!0,"next"!==r.action&&"createnewcase"!==r.action||(r.refresh=!1)),r.style=t.buildButtonStyle(r),t.buttons.push(r)}))},getParams:function(){return this.params},setParam:function(e,t){this.params&&(this.params[e]=t)},getMode:function(){return this.mode},getCustomHandlers:function(){if(this.params)return this.params.customHandlers},registerRender:function(e){var t=e.properties.xpath,i=e.properties.id,r=e.properties.type,a=t?t+"."+i:void 0;this.rendersById[i]=e,t&&(this.rendersByXpath[t]||(this.rendersByXpath[t]=[]),this.rendersByXpath[t].push(e)),a&&(this.rendersByXpathId[a]||(this.rendersByXpathId[a]=[]),this.rendersByXpathId[a].push(e)),this.rendersByType[r]||(this.rendersByType[r]=[]),this.rendersByType[r].push(e)},unregisterRender:function(e){if(this.rendersById[e.properties.id]&&delete this.rendersById[e.properties.id],e.properties.xpath){var t;if($.isArray(this.rendersByXpath[e.properties.xpath])&&this.rendersByXpath[e.properties.xpath].length>1)-1!==(t=this.rendersByXpath[e.properties.xpath].findIndex((function(t){return bizagi.util.md5(JSON.stringify(t.properties))===bizagi.util.md5(JSON.stringify(e.properties))})))&&this.rendersByXpath[e.properties.xpath].splice(t,1);else delete this.rendersByXpath[e.properties.xpath];if(e.properties.id)if($.isArray(this.rendersByXpathId[e.properties.xpath+"."+e.properties.id])&&this.rendersByXpathId[e.properties.xpath+"."+e.properties.id].length>1)-1!==(t=this.rendersByXpathId[e.properties.xpath+"."+e.properties.id].findIndex((function(t){return bizagi.util.md5(JSON.stringify(t.properties))===bizagi.util.md5(JSON.stringify(e.properties))})))&&this.rendersByXpathId[e.properties.xpath+"."+e.properties.id].splice(t,1);else delete this.rendersByXpathId[e.properties.xpath+"."+e.properties.id]}if(e.properties.type)for(var i=this.getRenderByType(e.properties.type),r=i.length,a=e.properties.id||e.properties.xpath,n=0;n<r;n++){var o=i[n];if(void 0!==o.properties.id&&o.properties.id==a||void 0!==o.properties.xpath&&o.properties.xpath==a){this.rendersByType[e.properties.type].splice(n,1);break}}},getRenderById:function(e){return this.rendersById[e]},getGridByColumn:function(e){for(var t=this.getRenderByType("grid"),i=0;i<t.length;i++)if(-1!=t[i].columnsIds.indexOf(e))return t[i];return null},getRenders:function(e){return e&&e.indexOf&&e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),this.rendersByXpathId[e]?this.rendersByXpathId[e]:this.rendersByXpath[e]?this.rendersByXpath[e]:[]},getRenderByType:function(e){return"string"==typeof e&&e.length>0&&this.rendersByType[e]?this.rendersByType[e]:[]},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("form"),i=$.fasttmpl(t,{buttons:this.buttons,transitions:this.transitions,uniqueId:e.uniqueId,helptext:e.helpText,mode:this.getMode(),queryForm:"queryForm"===this.getFormType(),summaryForm:this.params.summaryForm||!1,globalForm:this.properties.displayAsReadOnly||!1,idCase:"",displayName:this.params.displayName||"",processPath:e.processPath,breadCrumb:e.breadCrumb,orientation:e.orientation,isEmpty:bizagi.util.isEmpty(this.children)&&bizagi.util.isEmpty(this.transitions),allowQuickActions:this.useQuickActions});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){var t=this.getMode();e.addClass("ui-bizagi-rendering-mode-"+t),this._super(e)},configureHandlers:function(){var e,t=this,i=t.container;i.length>1?$(i).each((function(){$(this).hasClass("ui-bizagi-container-complexgateway")&&(e=this)})):e=$(".ui-bizagi-container-complexgateway",i),t.activeTransitions={},t.processButtons(i),t.bind("ondomincluded",(function(e,i){var r=t.getValidationsContainer(i);t.validationController=new bizagi.command.controllers.validation(t,t.validations,r),t.actionController=new bizagi.command.controllers.action(t,t.actions),t.readyDeferred.resolve()})),$(e).find(".ui-checkbox").bind("click",(function(){var e=$("label",this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),bizagi.util.parseBoolean(e.data("checked"))?(e.removeClass("ui-checkbox-state-checked"),e.removeClass("bz-check").addClass("bz-full-ball"),e.data("checked",!1),t.activeTransitions[i]=!1):(e.addClass("ui-checkbox-state-checked"),e.addClass("bz-mo-icon").addClass("bz-check").removeClass("bz-full-ball"),e.data("checked",!0),t.activeTransitions[i]=!0)}))},configureDesignView:function(){var e=this;e.bind("ondomincluded",(function(){e.readyDeferred.resolve()}))},buildButtonStyle:function(e){var t={};if(e.format){if(e.format.size&&"0"!=e.format.size){var i=100+10*Number(e.format.size)+"%";t["font-size"]=i+" !important"}if(e.format.bold&&(t["font-weight"]="bold !important",bizagi.util.isIE()&&(t["font-family"]="'Open Sans', 'Helvetica Neue', Arial, Helvetica, sans-serif !important")),e.format.italic&&(t["font-style"]="italic !important"),e.format.underline||e.format.strikethru){var r=bizagi.util.parseBoolean(e.format.strikethru)?"line-through ":"",a=bizagi.util.parseBoolean(e.format.underline)?"underline ":"";t["text-decoration"]=r+a+" !important"}e.format.background&&(t["background-color"]=e.format.background+" !important",t["background-image"]="none !important"),e.format.color&&(t.color=e.format.color+" !important")}var n="";for(key in t)n+=key+":"+t[key]+";";return n},render:function(){return this.readyDeferred||(this.readyDeferred=new $.Deferred),this._super()},ready:function(){return this.readyDeferred.promise()},getXpathContext:function(){return this.properties.xpathContext||""},getContextType:function(){return this.properties.contexttype||""},getEndPointAction:function(){if("startform"==this.properties.formtype)return"LOADSTARTFORM"},getPageCache:function(){return this.idPageCache},getFormContainer:function(){return this},processButtons:function(){var e=this,t=e.getButtons();t&&0!==t.length&&t.on("click",(function(t){t.preventDefault(),t.stopImmediatePropagation();var i=$(this),r=i.attr("ordinal"),a=e.buttons.find((function(e){return e.ordinal==r}));i.prop("disabled",!0),i.hasOwnProperty("disabled")&&i.button("disable"),e.propagateExternalEvents(t);var n=setTimeout((function(){$.when(e.buttonExecutionHandler(a)).always((function(){$.contains(document.documentElement,i.get(0))&&(i.prop("disabled",!1),i.hasOwnProperty("enable")&&i.button("enable"))})),clearTimeout(n)}),100)}))},buttonExecutionHandler:function(e){var t=this;return t.startLoading(),t.lastActionButton=e,"next"===e.action&&(e.routingDisabled=t.isRoutingDisabled),$.when(t.processButton(e)).always((function(){t.processDefer=void 0,t.endLoading()}))},preProcessButton:function(e){return!0},postProcessButton:function(e,t){return!0},setLoaderDeferred:function(){this.loaderDeferred=$.Deferred().resolve()},deleteLoaderDeferred:function(){var e=this;e.isLoaderDeferredSet()&&$.when(e.loaderDeferred.promise()).done((function(){delete e.loaderDeferred})).fail((function(){delete e.loaderDeferred}))},useOrSetLoaderDeferred:function(){this.isLoaderDeferredSet()||this.setLoaderDeferred()},getLoaderPromise:function(){return this.isLoaderDeferredSet()?this.loaderDeferred.promise():void 0},isLoaderDeferredSet:function(){return!!this.loaderDeferred},appendWaitForLoader:function(e){var t=e.promise,i=e.create||!1;if(!this.isLoaderDeferredSet()){if(!i)return;this.setLoaderDeferred()}this.loaderDeferred=this.loaderDeferred.then((function(){return t}))},getResolveOrReject:function(){var e=$.Deferred();return this.isLoaderDeferredSet()?$.when(this.loaderDeferred.promise()).done((function(){e.resolve()})).fail((function(){e.resolve()})):e.resolve(),e.promise()},processButton:function(e){var t=this,i=$.Deferred(),r=t.properties;e.routing||bizagi.chrono.initAndStart("submitForm"),bizagi.chrono.init("waiting"),t.validationController.clearValidationMessages();var a=t.getFormContainer(),n=a.getRenderByType("tabItem"),o=n.length;a.innerTabsLoading=!0,t.useOrSetLoaderDeferred();for(var s=0;s<o;s++){var l=n[s];l.loadingDeferred&&l.parent.container&&l.loadingDeferred.resolve()}return delete a.innerTabsLoading,$.when(t.ready(),t.getResolveOrReject()).done((function(){if(t.deleteLoaderDeferred(),!bizagi.util.parseBoolean(e.validate)||t.validationController.performValidations()){["save","next","back","createnewcase","nextWithoutValidations"].includes(e.action)&&!t.isOfflineForm&&$(document).data("auto-save","");var a=t.getConfirmationStatus(r,e);a.hasConfirmation?(t.endLoading(),$.when(bizagi.showConfirmationBox(a.message,null,!1)).done((function(){t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done((function(){i.resolve()})).fail((function(){i.reject(arguments)})))})).fail((function(){i.reject()}))):t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done((function(){$(document).trigger("FORMACTION",e),i.resolve()})).fail((function(){i.reject(arguments)})))}else t.endLoading(),e.submitData?$.when(t.submitData()).done((function(){i.reject()})):i.reject(),t.validationController.expandNotificationBox();var n=t.getCustomHandler("afterFormButtonClick");n&&n(e)})),i.promise()},validateForm:function(){return this.validationController.clearValidationMessages(),this.validationController.performValidations()},saveForm:function(){var e=this;if(bizagi.util.isNativeMobileDevice()&&!this.allowOnlineActions())return $.when((function(){return null}));var t=e.collectRenderValuesForSubmit(),i=null;return t.deferreds&&(i=$.when.apply($,t.deferreds),delete t.deferreds),$.when(i).pipe((function(){e.startLoading();var i={action:"SAVE",data:t,idCase:e.params.idCase,idWorkitem:e.params.idWorkitem,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,isOfflineForm:e.isOfflineForm||!1};return e.isOfflineForm&&(i.offlineType=e.params.offlineType),$.when(e.dataService.submitData(i)).always((function(){e.endLoading()}))}))},removeCaseSyncError:function(){if(this.removeSyncErrorOnSubmit)return this.removeSyncErrorOnSubmit=!1,"start"==("task"==this.params.offlineType?"task":"start")?this.dataService.removeStartCaseSyncError(this.params):this.dataService.removeTaskCaseSyncError(this.params)},submitForm:function(e){var t=this,i=$.Deferred();return $.when(t.isReadyToSave()).then((function(){t.isOfflineForm?$.when(t.removeCaseSyncError()).then((function(){return t.internalSubmitFormOffline(e)}),(function(){return t.internalSubmitFormOffline(e)})).then((function(){i.resolve()})).fail((function(){i.reject(arguments)})):$.when(t.internalSubmitForm(e)).done((function(){i.resolve()})).fail((function(){i.reject(arguments)}))})).fail((function(){t.endLoading(),bizagi.log("The form is not saved, no changes were found"),i.reject()})),i.promise()},checkWidgetsData:function(){},isComplexGatewayPainted:function(){return!1},getLastActionButton:function(){return this.lastActionButton},internalSubmitFormOffline:function(e){var t,i=this,r=$.Deferred();if(i.isOfflineForm&&i.properties&&!i.properties.idPageCache&&(i.properties.idPageCache=""),e.submitData||e.executeRule||e.save){t=i.collectRenderValuesForSubmit();var a=null;if(bizagi.loading.start(),e.executeRule&&(null==t&&(t={}),(a=i.dataService.executeButton({idRender:e.id,xpathContext:i.properties.xpathContext||"",idPageCache:i.properties.idPageCache,prepare:!0})).tag="executeRule_"+e.id),i.transitions){var n=[];if($.each(this.activeTransitions,(function(e,t){t&&n.push(e)})),0==bizagi.util.countProps(n))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),""}var o=[],s=null;t&&t.deferreds&&(s=$.when.apply($,t.deferreds),o.push(s),delete t.deferreds);var l=[];a&&l.push(a),$.when.apply($,o).done((function(){$.when(i.dataService.submitData({action:e.action,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,idForm:i.properties.id,prepare:!0,transitions:n||"",idCase:i.params.idCase,idWorkitem:i.params.idWorkitem,isOfflineForm:i.isOfflineForm||!1,offlineType:i.params.offlineType||"",actions:l})).then((function(t){if(i.postProcessButton(t,e)){var a="task"!==i.params.offlineType&&"save"===e.action;if(i.online&&i.isOfflineFormsV2Supported&&!a){var n=new $.Deferred,o=$.extend({deferred:n},i.params);$(document).trigger("tryPushCase.offline",o)}i.isOfflineFormsV2Supported||$(document).trigger("tryPushData.offline"),$.when(n).then((function(t){if(bizagi.loading.stop(),e.routing)!i.online&&i.isOfflineFormsV2Supported?i.triggerHandler("routing",{offlineAction:e.action,idCase:i.params.idCase,idWorkitem:i.params.idWorkitem,buttonPropertiesAction:e.action,radNumber:i.params.radNumber}):(i.showToastOnSuccessSync&&(i.showToastOnSuccessSync=!1,bizagi.util.showMobileToast({type:"success",message:bizagi.localization.getResource("workportal-offline-sync-success")})),i.triggerHandler("routing",{idCase:t.IdCase,caseNumber:t.CaseNumber,buttonPropertiesAction:e.action}));else if(i.online||null!=t||(i.isOfflineRefreshWithEdition=!0),(e.refresh||t&&t.shouldRefresh)&&i.refreshForm(),i.showToastOnSuccessSync&&i.online)i.showToastOnSuccessSync=!1,bizagi.util.showMobileToast({type:"success",message:bizagi.localization.getResource("workportal-offline-save-and-sync-success")});else{var a=bizagi.localization.getResource("workportal-mobile-offline-form-successful","Saved");bizagi.util.showNotification({text:a,stop:!1,type:"success"})}r.resolve()})).fail((function(e){bizagi.loading.stop(),bizagi.util.recreateNativeButtons(i);var t=bizagi.localization.getResource("workportal-mobile-offline-sync-fail","Synchronization failed");if(bizagi.util.showNotification({text:t,stop:!1,type:"error"}),$.isArray(e)){var a,n=e,o="";$.each(n,(function(e,t){var r=i.validationToDisplayMessages(a,t.result.type,t.result.messages,o);a=r.bHasValidations,o=r.alertMessage})),a&&""!==o&&bizagi.modalError.show(o,"workportal-general-word-information",!1)}i.failHandler(e),r.reject(e)}))}})).fail((function(e){var t=bizagi.localization.getResource("workportal-mobile-offline-sync-fail","Synchronization failed");bizagi.util.showNotification({text:t,stop:!1,type:"error"}),r.reject(e)}))}))}},partialSubmitFormOffline:function(e){var t=$.Deferred();return $.when(this.dataService.submitData({action:"save",data:e,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,idForm:this.properties.id,prepare:!0,transitions:"",idCase:this.params.idCase,idWorkitem:this.params.idWorkitem,isOfflineForm:this.isOfflineForm||!1,offlineType:this.params.offlineType||"",actions:[]})).fail((function(e){var i=bizagi.localization.getResource("workportal-mobile-offline-form-fail","Not saved");bizagi.util.showNotification({text:i,stop:!1,type:"error"}),t.reject(e)})),t.promise()},internalSubmitForm:function(e){var t=this,i=$.Deferred(),r={};(e.submitData||e.executeRule||e.createnewcase||e.back)&&(r=t.collectRenderValuesForSubmit()),$.when(t.startLoading()).done((function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")}));var a=null,n=null,o=null,s=null,l=null,d=[],u=null;if(e.executeRule&&(r.deferreds&&(u=$.when.apply($,r.deferreds),d.push(u),delete r.deferreds),(a=t.dataService.submitData({action:"SUBMITDATA",data:r,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0})).tag="submitData",s=t.prepareCheckpointAction(e.id),r={},(n=t.dataService.executeButton({idRender:e.id,xpathContext:t.properties.xpathContext||"",idPageCache:t.properties.idPageCache,prepare:!0})).tag="executeRule",l=t.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase||e.nextWithoutValidations){if(t.transitions){var c=[];if($.each(this.activeTransitions,(function(e,t){t&&c.push(e)})),0==bizagi.util.countProps(c))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),t.endLoading(),i.reject(),i.promise()}r&&r.deferreds&&(u=$.when.apply($,r.deferreds),d.push(u),delete r.deferreds),(o=t.dataService.submitData({action:t.getButtonAction(e.action),forcePlanCompletion:e.forcePlanCompletion,data:r,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,prepare:!0,transitions:c||"",contexttype:t.properties.contextType,surrogatekey:t.properties.surrogateKey})).tag="performAction"}var p=[];n&&(p.push(a),p.push(s),p.push(n),p.push(l)),o&&p.push(o),bizagi.chrono.initAndStart("submitForm-ajax");var h=new $.Deferred;return r&&r.deferreds?$.when.apply(this,r.deferreds).done((function(e){h.resolve(e)})).fail((function(){h.reject(),console.log("Error: It was not possible resolve async actions on form ")})):h.resolve(),d.push(h),$.when.apply($,d).done((function(){$.when(t.dataService.multiaction().execute({actions:p})).done((function(r){var a;bizagi.chrono.stop("submitForm-ajax"),t.endLoading();var n="";if($.each(r,(function(e,i){var r=t.validationToDisplayMessages(a,i.result.type,i.result.messages,n);a=r.bHasValidations,n=r.alertMessage})),a)""!==n&&bizagi.modalError.show(n,"workportal-general-word-information",!1),e.executeRule&&t.sendRollbackAction(e.id);else{if(!t.postProcessButton(r,e))return;e.refresh&&t.refreshForm(),e.routing&&(bizagi.jqxhrList.abortAll("rendering_"+t.dataService.guid),t.triggerHandler("routing",{idCase:t.params.idCase,routingDisabled:e.routingDisabled})),e.createnewcase&&r.length>0&&(bizagi.jqxhrList.abortAll("rendering_"+t.dataService.guid),t.triggerHandler("routing",{idCase:r[0].result.IdCase,caseNumber:r[0].result.CaseNumber}))}i.resolve()})).fail((function(r,a,n){e.executeRule&&t.sendRollbackAction(e.id),n&&n.error&&("WaitForCompletionPlanException"===n.error.errorType||"InvalidPlanStateException"===n.error.errorType||"CustomMessageException"===n.error.errorType)?(t.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(n.error.message),null,!1)).then((function(){return $.when(t.internalSubmitForm($.extend({},e,{forcePlanCompletion:!0})))})).done((function(){i.resolve()})).fail((function(){i.reject()}))):(t.failHandler(n),i.reject(n))}))})),i.promise()},validationToDisplayMessages:function(e,t,i,r){return"validationMessages"==t&&(this.addValidationMessage(i),e=!0),"alertMessages"==t&&(r=""===r?i:r+"\n\n"+i,e=!0),{bHasValidations:e,alertMessage:r}},addValidationMessage:function(e,t,i,r,a,n){var o=this;if(bizagi.util.isNativeMobileDevice()&&!this.allowOnlineActions()&&this.clearValidationMessages(),!o.validationController){var s=o.getValidationsContainer();o.validationController=new bizagi.command.controllers.validation(o,void 0,s)}"string"==typeof e?o.validationController.showValidationMessage(e,t,i,r,n):$.each(e,(function(e,a){o.validationController.showValidationMessage(a,t,i,r,n)})),o.validationController.expandNotificationBox(a)},clearValidationMessages:function(e){this.validationController&&this.validationController.clearValidationMessages(e)},addErrorMessage:function(e){bizagi.util.isNativeMobileDevice()&&!this.allowOnlineActions()&&this.clearValidationMessages(),this.validationController&&(this.validationController.showErrorMessage(e),this.validationController.expandNotificationBox())},refreshForm:function(e){var t=this,i=t.properties,r=$.Deferred();(e=e||t.getFocus())&&!e.id&&(e={id:e});var a={idCase:t.params.idCase||"",idWorkitem:t.params.idWorkitem||"",idTask:t.params.idTask||"",focus:e,selectedTabs:t.getSelectedTabs(),selectedSection:t.getSelectedSection(),xpathContext:i.xpathContext,idPageCache:i.idPageCache,isRefresh:!0,contextType:t.getContextType()||"",action:t.getEndPointAction(),idStartScope:t.properties.idStartScope||""};return t.isOfflineRefreshWithEdition&&(a.isEdited=!0,t.isOfflineRefreshWithEdition=!1),t.startLoading(),$.when(t.triggerHandler("refresh",a)).done((function(){r.resolve()})).fail((function(){r.reject()})).always((function(){t.endLoading()})),r.promise()},getSelectedTabs:function(){for(var e=this.getElementsByType("tab"),t=$.map(e,(function(e){return{tab:e.properties.id,selected:e.activeTab}})),i={},r=0,a=t.length;r<a;r++)i[t[r].tab]=t[r].selected;return i},getSelectedSection:function(){return(this.getParams()||{}).selectedSection},getButtons:function(){},addSubmitAction:function(e,t){this.actionController.processInternalSubmitAction(e,t)},startLoading:function(){var e=this.renderFactory.getTemplate("form-waiting");if(!this.waitingOverlay||!this.waitingMessage)if(bizagi.util.isTabletDevice())this.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo("body",$(document)),this.waitingMessage=$.tmpl(e).appendTo("body",$(document));else{var t="sharepoint"===this.params.context,i=this.params.canvas;t&&(i=bizagi.util.scrollTop(i)).context||(i=$("body",$(document)));var r=this.getSize(),a=this.getOffset();r.height==$(window).height()&&(a.top=0),this.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo(i),this.waitingMessage=$.tmpl(e).appendTo(i),this.waitingOverlay.css({height:"100%",width:"100%","min-height":r.height,"min-width":r.width}),this.waitingMessage.css({top:a.top+Math.ceil((r.height-this.waitingMessage.outerHeight())/2)+"px",left:Math.ceil((r.width-this.waitingMessage.outerWidth())/2)+"px"}),i.css("position","relative")}},endLoading:function(){if(this.waitingOverlay&&this.waitingMessage){this.waitingOverlay.remove(),this.waitingMessage.remove(),this.waitingOverlay=null,this.waitingMessage=null;var e=this.params.canvas;null!=e&&e.css("position","")}},getFocusedElement:function(){return this.focus},setFocusedElement:function(e){this.focus=e},triggerGlobalHandler:function(e,t){return this.triggerHandler("globalHandler",{eventType:e,data:t})},failHandler:function(e){try{e=JSON.parse(e)}catch(e){}if(e&&e.length&&e.length>1&&(e=e[0]),e.error&&(e=e.error),e.error&&(e=e.error),"object"==_typeof(e)&&e.message)e="WaitForCompletionPlanException"===e.errorType||"InvalidPlanStateException"===e.errorType||"CustomMessageException"===e.errorType?bizagi.localization.getResource(e.message):e.message;else if("string"==typeof e)try{var t=JSON.parse(e);"WaitForCompletionPlanException"!==t.errorType&&"InvalidPlanStateException"!==t.errorType&&"CustomMessageException"!==e.errorType||(t.message=bizagi.localization.getResource(t.message)),e=t.message}catch(e){}this.addErrorMessage(e),this.endLoading()},resize:function(e){this.setSize(e)},setSize:function(e){this.size=e},getSize:function(){if(this.size)return this.size;var e=this.params.canvas?this.params.canvas:this.getFormContainer().container;return{width:e.width(),height:e.height()}},getOffset:function(){return this.getFormContainer().container.offset()},submitData:function(e){var t=this;if(!bizagi.util.isNativeMobileDevice()||this.allowOnlineActions()){var i=t.collectRenderValuesForSubmit(),r=bizagi.util.isOfflineForm({context:t});if(r&&t.properties&&!t.properties.idPageCache&&(t.properties.idPageCache=""),$.each(i,(function(e,i){var r=t.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))})),!$.isEmptyObject(i)){var a=[],n=null,o=null;return i&&i.deferreds&&(n=$.when.apply($,i.deferreds),a.push(n),delete i.deferreds),o=r?t.dataService.submitData({action:t.isRefreshingAfterSync?"submitdata":"save",data:i,xpathContext:t.properties.xpathContext,contexttype:t.properties.contexttype||"",isOfflineForm:r,offlineType:t.params.offlineType,idCase:t.params.idCase,idWorkitem:t.params.idWorkitem}):t.dataService.multiaction().submitData({action:"SUBMITDATA",data:i,idPageCache:t.properties.idPageCache,xpathContext:t.properties.xpathContext,contexttype:t.properties.contexttype||""}),$.when.apply($,a).then((function(){return $.when(o).fail((function(e){e=t.processFailMessage(e)}))}))}t.isOfflineRefreshWithEdition=!1}},executeRule:function(e){var t=this,i=t.properties,r=e.xpathContext,a=$.Deferred();return""!==i.xpathContext&&(r=""!==r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeRule({idPageCache:i.idPageCache,rule:e.rule,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){var i=e&&e.type?e.type:"",r=t.getFormContainer();t.getFormContainer().clearValidationMessages({clearOnlyServer:!0}),["validationMessages","alertMessages"].includes(i)?("alertMessages"===i?bizagi.modalError&&bizagi.modalError.show(e.messages.join("\n\n"),"workportal-general-word-information",!1):r.addValidationMessage.apply(t,[e.messages,void 0,void 0,void 0,!1,"serverMessage"]),a.reject(e)):a.resolve(e)})).fail((function(e){e=t.processFailMessage(e),a.reject(e)})),a.promise()},executeInterface:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeInterface({idPageCache:i.idPageCache,interface:e.interface,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executeSAPConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeSAPConnector({idPageCache:i.idPageCache,guidsap:e.guidsap,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executeConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeConnector({idPageCache:i.idPageCache,guidConnector:e.guidConnector,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},executePipeline:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executePipeline({idPageCache:i.idPageCache,pipeline:e.pipeline,xpathContext:r,contexttype:t.properties.contexttype||""})).done((function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)})).fail((function(e){e=t.processFailMessage(e)}))},refreshActions:function(e){this.actionController.refreshActions(e)},tryToExecuteFunction:function(e){"execution"==this.getMode()&&this.actionController&&this.actionController.tryToExecuteFunction(e)},removeActions:function(){this.actionController.unbindActions()},collectRenderValuesForSubmit:function(e){var t=this;return e=e||{},t.collectRenderValues(e),$.each(e,(function(e,i){var r=t.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))})),e},internalSubmitOnChange:function(e){var t=this,i=(e=e||{}).properties,r=new $.Deferred,a=e.data||{},n=void 0===e.bRefreshForm||e.bRefreshForm;(e.notCollect?e.notCollect:void 0)&&!$.isEmptyObject(a)||t.collectRenderValuesForSubmit(a),t.startLoading();var o=null;return a.deferreds&&(o=$.when.apply($,a.deferreds),delete a.deferreds),$.when(o).then((function(){t.dataService.multiaction().submitData({action:"SUBMITONCHANGE",data:a,idRender:i.id,xpath:i.xpath,xpathContext:t.properties.xpathContext,idPageCache:i.idPageCache,contexttype:i.contexttype}).done((function(e){if(t.cancelPreviousRequest(),t.endLoading(),e&&"validationMessages"==e.type)"function"==typeof t.clearValidationMessages&&t.clearValidationMessages(),t.addValidationMessage(e.messages),r.resolve();else if(n){var a={id:i.id,xpath:i.xpath};void 0!==i.idCase&&$.extend(a,{idCaseObject:bizagi.cache.idCaseObject}),e.IdScope&&(t.properties.idStartScope=e.IdScope),$.when(t.refreshForm(a)).done((function(){r.resolve()})).fail((function(){r.resolve()}))}else r.resolve()})).fail((function(e){t.endLoading();var i="object"==_typeof(e)?e.responseText?JSON.parse(e.responseText):e:{},a=i.message||e,n=i.type||"error";["not-processed","not-shown"].includes(n)||(t.validationController.clearValidationMessages(),"alert"===i.type?t.validationController.showAlertMessage(a):t.validationController.showErrorMessage(a)),r.resolve()}))})),r.promise()},cancelPreviousRequest:function(){if(bizagi.multiactionConnection&&bizagi.multiactionConnection.length)for(var e,t=bizagi.multiactionConnection.length,i=0;i<t;i++)(e=bizagi.multiactionConnection.pop())&&e.abort&&(bizagi.showErrorAlertDialog=!1,e.abort())},prepareCheckpointAction:function(e){var t=this.dataService.sendCheckpoint({url:this.properties.checkpointUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0});return t.tag="checkpoint",t},prepareCommitAction:function(e){var t=this.dataService.commitLinkForm({url:this.properties.commitUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0});return t.tag="commit",t},sendRollbackAction:function(e){this.dataService.rollbackLinkForm({url:this.properties.rollbackUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache})},dispose:function(){var e=this;e.endLoading();var t=setTimeout((function(){e.params&&delete e.params.canvas,delete e.params,delete e.control,e.validationController&&(e.unbind("rendervalidate"),delete e.validationController),e.actionController&&(e.actionController.unbindActions(),delete e.actionController),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()},getButton:function(e){return $(".ui-bizagi-button[data-id='"+e+"']",this.container)},getFloatingButton:function(e){return $("li[data-id='"+e+"']",this.container)},propagateExternalEvents:function(e){$(".bz-overflow-menu")&&$(document).trigger("click.overflow"),$(".jquery-image-zoom")&&"block"==$(".jquery-image-zoom").css("display")&&$("div.jquery-image-zoom a").click()},getButtonAction:function(e){return this.allowValidateAndSaveAction&&"validate"===e?"save":e},isConnected:function(){return!0},configureNetworkHandlers:function(){this.online=bizagi.util.isConnected(),this.isOfflineForm&&bizagi.util.isMobileDevice()&&"debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase()&&(this.online=this.getParams().online,console.log("CONNECTED: ",this.online)),(bizagi.util.isNativeMobileDevice()||bizagi.util.isMobileDevice()&&"debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase())&&($(document).off("online.form"),$(document).on("online.form",this.handleConnectionChange.bind(this)),$(document).off("offline.form"),$(document).on("offline.form",this.handleConnectionChange.bind(this)),$(document).off("offline-notify-form-sync-event"),$(document).on("offline-notify-form-sync-event",this.handleOfflineSyncEvent.bind(this)))},handleConnectionChange:function(e){var t=this.getFormContainer();bizagi.util.isMobileDevice()&&"debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase()?this.online="online"===e.type:this.online=bizagi.util.isConnected(),"offline"===e.type&&t.triggerHandler("offlineForm"),"online"===e.type&&t.triggerHandler("onlineForm")},handleOfflineSyncEvent:function(e,t){var i=this,r=i.params||{};if(!r.hasSyncError){var a=r.idCase+"-"+r.idWorkitem;switch(t.type){case"download-form-success":var n=t.idCase+"-"+t.idWorkitem;a===n&&(console.log("Form downloaded successfully. It will be refreshed",t),$.when(i.dataService.database.validateLocalDataForTaskExists(n).then((function(e){!0===e&&(i.isOfflineRefreshWithEdition=!0),$.when(i.refreshForm(null,!1)).then((function(){o(!1)}))}))));break;case"push-tasks-started":null!=t.tasks&&t.tasks[a]&&o(!0);break;case"push-tasks-error":o(!1),null!=i.validationController&&(i.validationController.clearValidationMessages(),i.validationController.showErrorMessage(t.message));break;case"fetch-tasks-started":null!=t.tasks&&t.tasks[a]&&o(!0);break;case"download-finished":case"download-error":o(!1);break;default:console.warn("Event hast not implementation in bizagi.rendering.form - handleOfflineSyncEvent",t.type,t)}}function o(e){if(e?!(!0===i.isSyncLoaderRunning):!0===i.isSyncLoaderRunning){i.isSyncLoaderRunning=e;for(var t=0;t<3;t++)e?bizagi.loading.start():bizagi.loading.stop()}}},allowOnlineActions:function(){return void 0===this.online||(this.online||!this.online&&this.isOfflineForm)},processQuickButton:function(e){var t=this,i=t.buttons.find((function(t){return t.ordinal==e}));i&&(t.startLoading(),t.lastActionButton=i,"next"===i.action&&(i.routingDisabled=t.isRoutingDisabled),setTimeout((function(){$.when(t.processButton(i)).always((function(){t.processDefer=void 0,t.endLoading()}))}),100))},hasQuickActions:function(e,t){return!!t&&(e.buttons||[]).some((function(e){var t=e.button.properties;return t&&"quickactions"===t.type}))},getValidationsContainer:function(e){return(void 0!==e?e:this).container},getConfirmationStatus:function(e,t){var i=bizagi.util.parseBoolean(t.needsUserConfirmation)||!1,r=t.userConfirmationMessage||"",a=bizagi.util.parseBoolean(e.needsUserConfirmation)&&bizagi.util.parseBoolean(t.routing),n=e.userConfirmationMessage||"";return{hasConfirmation:i||a,message:i?r:n}},saveWorkInProgress:function(){var e=this.collectRenderValuesForSubmit();return bizagi.util.isEmpty(e)?$.Deferred().resolve(void 0).promise():this.dataService.submitData({action:"submitdata",data:e,xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,idForm:this.properties.id,prepare:!0,idCase:this.params.idCase,idWorkitem:this.params.idWorkitem,isOfflineForm:this.isOfflineForm||!1,offlineType:this.params.offlineType||"",actions:[]})},isStartForm:function(){var e=this.getFormContainer(),t=e&&e.properties&&e.properties.formtype||"";return/startform/i.test(t)}}),$.Class.extend("bizagi.rendering.formTemplate",{init:function(e){this._super(e),e.paramsRender&&e.paramsRender.contextEvent&&(self.contextEvent=e.paramsRender.contextEvent)},processTemplate:function(e,t){var i=e.replace(/\{\{(((repeater)\s*(\{["':,-\[\]\w\s]*\}))|([\/repeater]+:item)|(\/repeater)|(repeater)|(separator))\}\}/g,"");return i=(i=i.replace(/\{\{([\w:]*)\s*(\{["':,-\[\]\w\s]*\})\}\}/g,(function(e,i,r,a,n){var o=JSON.parse(r);return t[o.id]||""}))).replace(/{{([\w:]*)\s*}}/g,(function(){return""}))},renderContainer:function(){var e=this,t=e.getRenderByType("layout"),i=t.length>0?t[0]:{},r="function"==typeof i.getTemplate?i.getTemplate():"",a="function"==typeof i.getCss?i.getCss():"",n=e.getMode(),o=e.properties.layoutguid||Math.guid(),s={};return i.children&&$.each(i.children,(function(t,i){if("execution"!=n||"layoutPlaceholder"!=i.properties.type){var r=i.getElementType();r==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(s[i.properties.id]=i.renderElement()),r==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(s[i.properties.id]=i.renderContainerHtml()),e.childrenHash[i.properties.uniqueId]=i}})),bizagi.util.loadStyle(a,o),e.processTemplate(r,s)},getContextEvent:function(){return self.contextEvent}}),$.Class.extend("bizagi.rendering.layout",{},{getTemplate:function(){var e=this.getMode(),t=this.properties.html||"";return"design"==e&&t&&(t="<div class='bz-design-template'>"+t+"</div>"),bizagi.util.stripslashes(t)},getCss:function(){var e=this.properties.css||"";return"design"==this.getMode()&&(e=e&&e.desktop),bizagi.util.stripslashes(e)},postRenderContainer:function(e){var t=this.getMode();this.renderingDeferred&&this.renderingDeferred.resolve(),this.container=e,this.executeChildrenPostRender(e),"execution"==t&&this.configureHandlers(),"design"==t&&this.configureDesignView(),"layout"==t&&(this.configureDesignView(),this.configureLayoutView())}}),$.Class.extend("bizagi.rendering.accordion",{},{initializeData:function(e){this._super(e),$.each(this.children,(function(e,t){t.properties.ordinal=e}))},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("accordion"),i=$.fasttmpl(t,{uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),$.Class.extend("bizagi.rendering.accordionItem",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("accordionItem"),i=$.fasttmpl(t,{id:e.id,ordinal:e.ordinal,displayName:e.displayName,orientation:e.orientation,uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},activate:function(){this.active=!0},getFocus:function(){var e=this._super();return bizagi.util.isEmpty(e)&&this.active&&(e=this.properties.id),e}}),$.Class.extend("bizagi.rendering.collectionnavigator",{},{initializeData:function(e){this._super(e);var t=this.properties;t.allowAdd=void 0===t.allowAdd||bizagi.util.parseBoolean(t.allowAdd),t.withAddForm=t.withAddForm&&t.allowAdd,t.allowEdit=void 0===t.allowEdit||bizagi.util.parseBoolean(t.allowEdit),t.withEditForm=t.withEditForm&&t.allowEdit,t.allowDetail=void 0!==t.allowDetail&&bizagi.util.parseBoolean(t.allowDetail),t.inlineAdd=void 0===t.inlineAdd||bizagi.util.parseBoolean(t.inlineAdd),t.inlineAdd=t.inlineAdd&&t.allowAdd,t.inlineEdit=void 0===t.inlineEdit||bizagi.util.parseBoolean(t.inlineEdit),t.inlineEdit=t.inlineEdit&&t.allowEdit,t.allowDelete=void 0===t.allowDelete||bizagi.util.parseBoolean(t.allowDelete),this.orientation=this.properties.orientation||"ltr",this.data=this.properties.data,this.keys=this.data?this.getKeys(this.data.rows):[],this.pointer=0,this.totalRows=0,this.inlineAddRecords=[],this.data&&(this.totalRows=this.data.rows.length)},getKeys:function(e){for(var t=[],i=0,r=(e=e||[]).length;i<r;i++){var a=e[i];t.push(a[0])}return t},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("collectionnavigator"),i=this.getMode(),r=$.fasttmpl(t,{uniqueId:e.uniqueId,displayName:e.displayName?e.displayName:"",id:e.id,guid:e.guid,showPreview:this.showPreview(),mode:i,orientation:this.getFormContainer().properties.orientation});return r=this.drawControls(r)},renderReadOnly:function(){return this.renderControl()},drawControls:function(e){},drawActions:function(e){},drawControl:function(e){},drawForms:function(e){},drawPreview:function(){var e="execution"===this.getMode()?"collectionnavigator-execution":"collectionnavigator-preview",t=this.renderFactory.getTemplate(e),i=$.tmpl(t);this.canvas.append(i)},hasData:function(){return this.getTotalRows()>0},getRow:function(){return this.keys[this.pointer]},getNextRow:function(){return this.getTotalRows()>this.pointer+1&&(this.pointer+=1),this.getRow()},getPreviousRow:function(){return this.pointer>0&&(this.pointer-=1),this.getRow()},getFirstRow:function(){return this.pointer=0,this.getRow()},getLastRow:function(){return this.pointer=this.keys.length-1,this.getRow()},getTotalRows:function(){return this.keys.length},getIndexes:function(){return this.properties.data.rows},setPointer:function(e){this.pointer=e-1},isTherePendingInlineRow:function(){return this.inlineAddRecords.length>0},addKey:function(e){this.keys.push(e)},removeKey:function(){var e=this.pointer;if(e>=0){this.keys.splice(e,1);var t=this.getTotalRows();t>0&&e>=t&&this.setPointer(t)}},showPreview:function(){var e=this.getMode(),t=this.properties;return"execution"==e?!this.hasData():!bizagi.util.parseBoolean(t.navigationform)},getParameters:function(e){var t={},i=this.properties,r=i.xpath+"[id="+e.id+"]";return t.idRender=i.id,t.recordXPath=r,t.xpathContext=i.xpathContext,t.idPageCache=i.idPageCache,t.requestedForm=e.requestedForm,t.contextType=i.contextType||i.contexttype,t.url=e.url,t.editable=e.editable,i.orientation,t},submitAddRequest:function(){var e=this,t=e.properties;return e.dataService.addGridRecord({url:t.addUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,contexttype:t.contextType||t.contexttype,idPageCache:t.idPageCache,orientation:t.orientation||"ltr"}).pipe((function(t){return e.properties.temporalRecord=!0,t.idEntity})).promise()},submitEditRequest:function(e){var t=this.properties,i=t.xpath+"[id="+e+"]";return this.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType||t.contexttype||"",orientation:t.orientation||"ltr"})},submitDeleteRequest:function(e){var t=this,i=t.properties,r=i.xpath+"[id="+e+"]";return t.dataService.deleteGridRecord({url:i.deleteUrl,idRender:i.id,xpath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType||i.contexttype}).pipe((function(e){if("validationMessages"==e.type){var i=t.getFormContainer(),r=e.messages.join(" ");i.failHandler({message:r})}return e}))},submitSaveRequest:function(e,t){var i=this,r=i.properties,a=$.Deferred(),n=r.xpathContext.length>0?r.xpathContext+"."+r.xpath+"[id="+e+"]":r.xpath+"[id="+e+"]",o=null;return t.deferreds&&(o=$.when.apply($,t.deferreds),delete t.deferreds),$.when(o).then((function(){!bizagi.util.isEmpty(t)||i.properties.temporalRecord?(t.idPageCache=t.idPageCache||i.form.getPageCache(),i.dataService.saveGridRecord({url:r.saveUrl,idRender:r.id,xpath:r.xpath,xpathContext:n,contexttype:r.contextType||r.contexttype||"",submitData:t}).done((function(e){delete i.properties.temporalRecord,a.resolve(e)})).fail((function(e){var t=i.getFormContainer(),r=e.responseText?e.responseText:"string"==typeof e?e:e.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=e);t.validateForm(),t.clearValidationMessages(),t.addValidationMessage(r)}))):a.resolve()})),a.promise()},submitRollbackRequest:function(e){var t=this.properties;return this.dataService.rollbackGridAction({url:t.rollbackUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:e.idPageCache,contexttype:this.properties.contexttype||""})},getRemoteData:function(e){var t=this.properties;return e=e||{},$.extend(e,{url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,contexttype:t.contextType||t.contexttype,idPageCache:t.idPageCache}),this.dataService.getData(e)},isValid:function(e){var t=this.form;return void 0!==t&&this.totalRows>0&&(t.children||[]).forEach((function(t){if(t.properties.visible)if(t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER)t.isValid(e);else if(t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&!t.isValid(e)){var i=e[e.length-1];e[e.length-1]=$.extend(i,{id:t.properties.id})}})),0===e.length},validateControls:function(e){return!!this.form&&this.form.validationController.performValidations(e)}}),$.Class.extend("bizagi.rendering.group",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||"cssClassContainer",t.collapse=!(void 0===t.collapse||!bizagi.util.parseBoolean(t.collapse))},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("group");this.expandedIcon=this.getExpandedIcon(),this.collapsedIcon=this.getCollapsedIcon();var i=$.fasttmpl(t,{expandedClassIcon:this.expandedIcon,displayName:e.displayName,editable:e.editable,orientation:e.orientation,uniqueId:e.uniqueId,collapse:e.collapse,isDesign:"execution"!==this.getMode(),messageValidation:e.messageValidation,cssclass:e.cssclass,guid:e.guid});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},getExpandedIcon:function(){},getCollapsedIcon:function(){},toogleContainer:function(e,t){}}),$.Class.extend("bizagi.rendering.horizontal",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("horizontal"),i=$.fasttmpl(t,{uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),$.Class.extend("bizagi.rendering.panel",{},{initializeData:function(e){this._super(e);var t=this.properties;(t.displayName=t.displayName||"","nestedForm"==t.type)&&(this.getFormContainer().rendersById[t.idForm]=this)},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("panel"),i=$.fasttmpl(t,{displayName:e.displayName,loading:e.loading,message:e.message,orientation:e.orientation,uniqueId:e.uniqueId,cssClass:e.cssclass});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){var t=this.properties;t.height&&e.height(t.height),this._super(e)}}),$.Class.extend("bizagi.rendering.contentPanel",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayName=t.displayName||""},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("contentPanel"),i=$.fasttmpl(t,{displayName:e.displayName,mode:this.getMode(),uniqueId:e.uniqueId,isDesign:"design"===this.getMode(),messageValidation:e.messageValidation,cssClass:e.cssclass,guid:e.guid});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){this._super(e)}}),$.Class.extend("bizagi.rendering.searchForm",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("searchForm");"entity"!==e.contexttype&&this.parent&&(e.contexttype="function"==typeof this.parent.getContextType?this.parent.getContextType():"");var i=$.fasttmpl(t,{displayName:e.displayName,uniqueId:e.uniqueId});return i=(i=this.replaceChildrenHtml(i,this.renderChildrenHtml())).replaceFirstWithoutPatterns("{{result}}",this.renderResult())},performSearch:function(e){this.properties.searchParams=e,this.submitSearch()},submitSearch:function(){this.refreshResults()},ready:function(){return this.parent.ready()},getRemoteData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.collectSearchValues();return bizagi.util.isMapEmpty(a)?(bizagi.showMessageBox(this.getResource("render-search-advanced-no-filters"),this.getResource("render-form-dialog-box-search"),"error"),null):(e.rows=i.searchParams&&i.searchParams.maxRecords&&i.searchParams.maxRecords>0?i.searchParams.maxRecords:e.rows,i.searchParams&&void 0!==i.searchParams.maxRows&&(e.rows=i.searchParams.maxRows||e.rows),t.dataService.submitSearch($.extend(e,{url:i.dataUrl,idRender:i.idRender,idPageCache:i.idPageCache,idSearchForm:i.id,allowFullSearch:i.searchParams.allowFullSearch?i.searchParams.allowFullSearch:null,maxRecords:i.searchParams.maxRecords>0?i.searchParams.maxRecords:null,criteria:a})).done((function(e){i.page=e.page,i.records=e.records,i.totalPages=e.totalPages||0,e.records>1e4?(i.deviceMaxRecordsExceeded=!0,e.deviceMaxRecordsExceeded=!0):delete i.deviceMaxRecordsExceeded,r.resolve(e),t.onSearchFinished()})).fail((function(e){if(bizagi.showErrorAlertDialog=!1,e.responseText)try{var t=JSON.parse(e.responseText).message;bizagi.showMessageBox(t,"","error")}catch(e){}r.reject()})),r.promise())},collectSearchValues:function(){var e={};this.collectRenderValues(e);var t=[];for(key in e){var i=key,r=e[key],a=this.getCriteriaOperation(this.getRender(i)),n={};bizagi.util.isEmpty(r)||(n.xpath=i,n.value=r,n.operation=a,t.push(n))}return t},getCriteriaOperation:function(e){var t=this.properties,i="EQUALS";return"15"==e.properties.dataType&&(void 0!==e.properties.typeSearch&&"approx"!==e.properties.typeSearch||(i=t.allowFullSearch?"FULLLIKE":"LIKE")),i},renderResult:function(){},refreshResults:function(){},parseAdditionalProperties:function(e){return 1==e||2==e||3==e||4==e||6==e||7==e||10==e||11==e?{type:"columnNumber"}:29==e?{type:"columnNumberScientificNotation"}:8==e?{type:"columnMoney"}:12==e||13==e?{type:"columnDate"}:5==e?{type:"columnBoolean"}:{type:"columnText"}},onSearchFinished:function(){}}),$.Class.extend("bizagi.rendering.tab",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||""},renderContainer:function(){for(var e=this.properties,t=$.map(this.children,(function(e,t){return e.properties.counter=t,e.properties.tooltip=e.properties.tooltip||e.properties.displayName||"",e.properties})),i=this.renderFactory.getTemplate("tab"),r=this.getMode(),a=$.fasttmpl(i,{id:e.id,tabs:t,mode:r,isDesign:"execution"!==this.getMode(),editable:e.editable,tabOrientation:e.orientation,uniqueId:e.uniqueId,cssclass:e.cssclass}),n=this.activeTab=this.getActiveTab(),o=0,s=this.children.length;o<s;o++)this.children[o].properties.loadOnDemand=o!=n;return a=this.replaceChildrenHtml(a,this.renderChildrenHtml())},getActiveTab:function(){var e=this.properties,t=this.getFormContainer().getParams();"execution"===this.getMode()&&!t.isRefresh&&e.activeTab&&this.getFormContainer().setFocusedElement(e.activeTab);var i=t&&t.selectedTabs?t.selectedTabs:{};if(i[this.properties.id]>=0)return i[this.properties.id];for(var r=0,a=this.children.length;r<a;r++)if(this.children[r].containsFocusedElement())return r;return 0},setActiveTab:function(e){if(this.triggerHandler("selected",{index:e,tab:this.children[e]}),this.children[e]){var t=this.getFormContainer();this.children[e].activate(),this.activeTab=e;var i={};i[this.children[e].parent.properties.id]=e,t.setParam("selectedTabs",i)}}}),$.Class.extend("bizagi.rendering.tabItem",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("tabItem"),i=$.fasttmpl(t,{id:e.id,uniqueId:e.uniqueId,counter:e.counter,tabOrientation:e.orientation,isDesign:"execution"!==this.getMode()});return i=this.renderTabContent(i)},renderTabContent:function(e){return this.replaceChildrenHtml(e,this.renderChildrenHtml())},activate:function(){this.active=!0},getFocus:function(){var e=this._super();return bizagi.util.isEmpty(e)&&this.active&&(e=this.properties.id),e},containsFocusedElement:function(){var e=this.getFormContainer().getFocusedElement();if(e){if(e.xpath){var t=this.getFormContainer().getRenders(e.xpath);$.each(t,(function(t,r){r.properties.id==e.id&&r.properties.editable&&(i=r)}))}else var i=this.getFormContainer().getContainer(e)||this.getFormContainer().getRenderById(e);if(i)for(;i.parent;){if(i.properties.id==this.properties.id||i.parent.properties.id==this.properties.id)return!0;i=i.parent}}return!1}}),$.Class.extend("bizagi.rendering.nestedForm",{},{}),$.Class.extend("bizagi.rendering.actionLauncher",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer();this.typeForm=t.properties.typeForm||"";var i=this.getMode(),r=this.properties;this.deferredActions=new $.Deferred,this.deferredActions.promise(),"execution"==i&&(this.engine=new bizagi.templateEngine({renderFactory:this.renderFactory,cache:!0,autoGenerateData:!1,templateGuid:r.selecttemplate})),this.processPropertyValueArgs={pcaseId:this.getIdCase(),pguidEntity:this.properties.guidEntity,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,property:"data",psurrogatedKey:this.properties.surrogatedKey,ptags:this.properties.tagslist||[],pmaxitems:this.properties.maxItems,pactionXpath:this.properties.xpathActions},this.processPropertyValueDataTmplArgs={pactionXpath:this.properties.xpathActions,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,ptemplateGuid:r.selecttemplate,property:"dataTemplate",xpathActions:this.properties.xpathActions},this.properties.valueWidth=100,this.properties.displayType="value";var a="entityTemplate"!==e.properties.type;this.properties.allowactions=void 0===e.properties.allowactions?a:e.properties.allowactions,this.properties.isHorizontal=void 0===e.properties.isHorizontal||e.properties.isHorizontal,this.properties.allowSearch=void 0!==e.properties.allowSearch&&e.properties.allowSearch,this.properties.selecttemplate=void 0===e.properties.selecttemplate?"":e.properties.selecttemplate,this.properties.templatetype=void 0!==r.templatetype?r.templatetype:"none",this.properties.sessionId=t.params.data.sessionId,this.properties.value?"string"==typeof this.properties.value&&(this.properties.value=this.value=JSON.parse(this.properties.value)):(this.properties.value=this.value=[],this.properties.originalValue=[])},executeActionImmediately:function(e){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeAction",psurrogatedKey:t.properties.surrogatedKey,pguidAction:e.guidAction,pparameters:JSON.encode({idStartScope:e.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:e.idPageCache})};t.dataService.executeActions(r).done((function(i){t.notifyExecution(i,e)})).fail((function(i){t.notifyExecution("Error",e)}))},notifyExecution:function(e,t){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0,this.postRender()},renderControl:function(){var e,t=this.properties,i="";if("design"==this.getMode()){e=this.renderFactory.getTemplate("render-actionLauncher-design");var r={type:t.type,isHorizontal:t.isHorizontal,allowSearch:t.allowSearch,templateDefined:"none"!=t.templatetype,allowactions:t.allowactions};i=$.fasttmpl(e,r)}else t.surrogatedKey&&(e=this.renderFactory.getTemplate("render-actionLauncher"),i=$.fasttmpl(e,{allowactions:this.properties.allowactions}));return i},isValid:function(e){var t=this.properties;this.getValue();return 0==bizagi.util.parseBoolean(t.visible)||(0==bizagi.util.parseBoolean(t.editable)||!(!t.required||!this.value)&&(this.value.length>0||(message=this.getResource("render-required-register-action"),e.push({xpath:t.xpath,message:message}),!1)))},setDisplayValue:function(e){this.getControl();this.setValue(e,!1)},actionManager:function(e){var t=this,i=e.guidProcess||"",r=new $.Deferred;switch(e.recordXpath=t.getFormContainer().properties.recordXpath,e.actionType){case"Process":var a={guidWFClass:i};$.when(t.dataService.hasStartForm(a)).done((function(a){a.hasStartForm?$.when(t.processStartForm({guidprocess:i,title:e.displayName,recordXpath:e.recordXpath})).done((function(t){e.idStartScope=t,r.resolve(e)})):r.resolve(e)}));break;case"Rule":r.resolve(e);break;case"Form":e.xpathContext?$.when(t.processActionFormCollection(e)).done((function(t){e.idStartScope=t,r.resolve(e)})):("Form"===e.actionType&&(e.xpathContext=void 0,e.contextType="entitytemplate",e.guidEntity=e.guidEntity||t.properties.guidEntity),$.when(t.processActionForm(e)).done((function(t){e.idStartScope=t,r.resolve(e)})))}return r.promise()},addActionToQueue:function(e){var t=this.getValue(),i=this.getFormContainer().getParams();e.params=e.params||{};var r=this.properties.xpathContext;switch(e.actionType){case"Process":e.params={idStartScope:e.idStartScope,additionalXpaths:this.properties.additionalXpath.join(","),idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,recordXpath:r};break;case"Form":e.params={idStartScope:e.idStartScope,additionalXpaths:this.properties.additionalXpath.join(","),entityXpath:this.properties.xpathActions,idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,idEntity:e.idEntity};break;case"Rule":e.params={xpathActions:e.xpathActions||"",recordXpath:r}}var a=bizagi.clone(t);a.push(e),this.setValue(a),this.setDisplayValue(a)},removeActionToQueue:function(e){var t=bizagi.clone(this.getValue());t.splice(e,1),this.setValue(t),this.setDisplayValue(t)},collectData:function(e){if(this.controlValueIsChanged()){var t=this.properties.xpath,i=this.getValue(),r=[];$.each(i,(function(e,t){var i={};i.params=t.params||{},i.guidAction=t.guidAction,r.push(i)})),e[t]=0==r.length?"":JSON.encode(r)}},countSameActions:function(e){var t=this.getValue(),i=0;return $.each(t,(function(t,r){r.guidAction==e.guidAction&&i++})),i},getPropertiesActionLaucher:function(e){for(var t=this.getFormContainer(),i=0,r=e.length;i<r;i+=1)6===e[i].length&&(e[i].splice(5,0,""),"Process"==e[i][3]&&t.properties.xpathContext&&(e[i][5]=t.properties.xpathContext));return e}}),$.Class.extend("bizagi.rendering.entityTemplate",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.getFormContainer();this.deferredActions=new $.Deferred,this.deferredActions.promise(),this.processPropertyValueArgs={pcaseId:this.getIdCase(),pguidEntity:this.properties.guidEntity,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,property:"data",psurrogatedKey:this.properties.surrogatedKey},this.properties.valueWidth=100,this.properties.displayType="value",this.properties.allowactions=void 0===e.properties.allowactions||e.properties.allowactions,this.properties.value?"string"==typeof this.properties.value&&(this.properties.value=this.value=JSON.parse(this.properties.value)):this.properties.value=this.value=[]},renderControl:function(){var e,t="";return"design"==this.getMode()?(e=this.renderFactory.getTemplate("render-entityTemplate-design"),t=$.fasttmpl(e,{})):this.properties.surrogatedKey&&(e=this.renderFactory.getTemplate("render-entityTemplate"),t=$.fasttmpl(e,{allowactions:this.properties.allowactions})),t},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t},setDisplayValue:function(e){this.getControl();this.setValue(e,!1)}}),$.Class.extend("bizagi.rendering.polymorphicLauncher",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.getFormContainer();this.typeForm=t.properties.typeForm||"";this.getMode();this.deferredActions=new $.Deferred,this.deferredActions.promise(),this.properties.valueWidth=100,this.properties.displayType="value",this.properties.allowSearch=void 0!==e.properties.allowSearch&&e.properties.allowSearch,this.properties.additionalXpath=this.properties.additionalXpath||[],this.properties.value?"string"==typeof this.properties.value&&(this.properties.value=this.value=JSON.parse(this.properties.value)):(this.properties.value=this.value=[],this.properties.originalValue=[]),this.processPropertyValueArgs={pcaseId:this.getIdCase(),pguidEntity:this.properties.guidEntity,idRender:this.properties.id,xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,property:"data",ptags:this.getTagList(this.properties.tagslist),additionalXpaths:this.properties.additionalXpath}},executeActionImmediately:function(e){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeConstructor",psurrogatedKey:t.properties.surrogatedKey,pguidConstructor:e.guidConstructor,pparameters:JSON.encode({idStartScope:e.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:e.idPageCache})};t.dataService.executeActions(r).done((function(i){t.notifyExecution(i.response,e)})).fail((function(i){t.notifyExecution("Error",e)}))},notifyExecution:function(e,t){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0,this.postRender()},renderControl:function(){var e,t=this.properties,i="";if("design"==this.getMode()){e=this.renderFactory.getTemplate("render-polymorphicLauncher-design");var r={type:t.type,allowSearch:t.allowSearch};i=$.fasttmpl(e,r)}else t.surrogatedKey&&(e=this.renderFactory.getTemplate("render-polymorphicLauncher"),i=$.fasttmpl(e));return i},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t},setDisplayValue:function(e){this.setValue(e,!1)},actionManager:function(e){var t=this,i=e.guidObject||"",r=new $.Deferred;switch(e.recordXpath=t.getFormContainer().properties.recordXpath,e.actionType){case"Process":var a={guidWFClass:i};$.when(t.dataService.hasStartForm(a)).done((function(a){a.hasStartForm?$.when(t.processStartForm({guidprocess:i,title:e.displayNamee,recordXpath:e.recordXpath})).done((function(t){e.idStartScope=t,r.resolve(e)})):r.resolve(e)}));break;case"Rule":r.resolve(e);break;case"Form":$.when(t.processActionForm(e)).done((function(t){e.idStartScope=t,r.resolve(e)}))}return r.promise()},addActionToQueue:function(e){var t=this.getValue(),i=this.getFormContainer().getParams();e.params=e.params||{};var r=this.properties.xpathContext;switch(e.actionType){case"Process":e.params={additionalXpaths:this.properties.additionalXpath.join(","),idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,recordXpath:r},void 0!==e.idStartScope&&(e.params.idStartScope=e.idStartScope);break;case"Form":e.params={idStartScope:e.idStartScope,additionalXpaths:this.properties.additionalXpath.join(","),entityXpath:this.properties.xpathActions,idParentWorkitem:i.idWorkitem||bizagi.context.idWorkItem,idEntity:e.idEntity,guidEntity:e.guidEntity}}t.push(e),this.setValue(t),this.setDisplayValue(t)},removeActionToQueue:function(e){var t=this.getValue();t.splice(e,1),this.setValue(t),this.setDisplayValue(t)},collectData:function(e){if(this.controlValueIsChanged()){var t=this.properties.xpath,i=this.getValue(),r=[];$.each(i,(function(e,t){var i={};i.params=t.params||{},i.guidAction=t.guidObject||t.guidAction,i.displayName=t.displayName,i.guidConstructor=t.guidConstructor,i.actionType=t.actionType,i.xpathContext=t.xpathContext,i.guidEntity=t.guidEntity,r.push(i)})),e[t]=0==r.length?"":JSON.encode(r)}},countSameActions:function(e){var t=this.getValue(),i=0;return $.each(t,(function(t,r){r.guidAction==e.guidAction&&i++})),i},getTagList:function(e){for(var t=[],i=(e=e||[]).length;i>0;i--)t.push(e[i-1].value);return t.length>0?t:""}}),$.Class.extend("bizagi.rendering.combo",{},{initializeData:function(e){this._super(e);var t=this.properties;t.hasLocalData=t.data||!1,t.value=t.value&&t.value.length>0?t.value[0]:t.defaultValue&&t.defaultValue.length>0?t.defaultValue[0]:null,void 0===t.enableTyping&&(t.enableTyping=!0),t.value&&void 0===t.value.id&&(t.value=null),this.value=t.value,t.hasLocalData&&(t.data=this.complementData(t.data)),t.loadOnDemand=!1},renderControl:function(){var e={},t=bizagi.util.normalizeType(this.properties.type);if(this.isDependant&&this.properties&&/^cascadingcombo$/i.test(t)&&this.getParentCombo){var i=this.getParentCombo().getValue();i&&i.id&&(e[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=i.id)}return this.renderCombo(e)},renderCombo:function(e){var t=this;if(t.properties.loadOnDemand)return t.renderComboTemplate();var i=new $.Deferred,r=t.getData(e);return $.when(r).done((function(e){var r=t.renderComboTemplate(e);t.properties.data=e,i.resolve(r)})).fail((function(e){var r=t.renderComboTemplate({});i.resolve(r)})),i.promise()},renderComboTemplate:function(e){var t=this.properties,i=this.renderFactory.getTemplate(this.getTemplateName()),r=bizagi.override.emptyLabelForCombo||this.getResource("render-combo-empty-selection"),a=t.value?"":r;return e=e||this.properties.data||{},"columnCombo"!==this.properties.type||""!==a||"object"!==_typeof(t.value)||""!==t.value.id||""!==t.value.value&&t.value.value!==this.getResource("render-combo-empty-value")||(a=this.getResource("render-combo-empty-selection")),$.fasttmpl(i,$.extend(this.getTemplateParams(),{id:t.id,xpath:t.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:t.idPageCache,items:e,align:t.valueAlign,value:a,editable:t.editable}))},postRenderReadOnly:function(){this._super();var e=this.getValue(),t=this.getControl();this.control&&this.control.parent()&&this.control.parent().addClass("ui-bizagi-noneditable-"+this.properties.displayType),e?(null!=e.value&&"boolean"==typeof e.value&&(!0===bizagi.util.parseBoolean(e.value)?e.value=this.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(e.value)&&(e.value=this.getResource("render-boolean-no"))),this.getResource("render-combo-empty-value")===e.value||this.getResource("render-combo-empty-selection")===e.value?t.text(""):t.html("<label class='readonly-control'>"+this.formatItem(e.value)+"</label>")):t.text("")},getTemplateName:function(){return"combo"},showEmpty:function(){return!0},showCurrentData:function(){return!0},getData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.getMode(),n=bizagi.util.isOfflineForm({context:t});if("execution"!==a)return t.getDummyData();if(i.hasLocalData||n)r.resolve(i.data);else{var o=bizagi.util.normalizeType(i.type);i.remoteDataLoaded&&!/^cascadingcombo$/i.test(o)?r.resolve(i.data):t.dataService.multiaction().getData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,extra:e,contexttype:t.properties.contexttype||null}).done((function(e){i.recalculate||(i.remoteDataLoaded=!0),i.data=t.complementData(e),r.resolve(i.data)})).fail((function(e){var i=!0,a=t.getFormContainer();if(bizagi.util.isNativeMobileDevice()&&void 0!==a&&(i=a.allowOnlineActions()),"not-processed"!==e.type||!i){var n=t.properties.displayName+": ";if("string"==typeof e)var o=JSON&&JSON.parse(e)||$.parseJSON(e);else o=e;n+=o.message,a.addValidationMessage(n),r.reject(e)}}))}return r.promise()},getDummyData:function(){var e=this.properties;return e.data?e.data:(e.data=[],e.data=this.complementData(e.data),e.data.push({id:"",value:"Item 1"}),e.data.push({id:"",value:"Item 2"}),e.data)},resetData:function(){var e=this.properties;e.hasLocalData=!1,e.data=null,e.remoteDataLoaded=!1},getDisplayValue:function(){if(this.combo&&this.combo.length>0)return this.getSelectedValue();var e="",t=this.getValue();return t&&(e=this.formatItem(t.value)),e},getSelectedValue:function(){},getTemplateParams:function(){return{}},formatItem:function(e){if(null!=e){if($.isArray(e)){for(var t=0,i=e.length;t<i;t++)null!=e[t]&&"boolean"==typeof e[t]&&(!0===bizagi.util.parseBoolean(e[t])?e[t]=this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e[t])&&(e[t]=this.getResource("render-boolean-no")));return e.join(" - ")}return e}return""},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();this.controlValueIsChanged()&&(bizagi.util.isEmpty(i)||null==r||("object"!==_typeof(r)||void 0!==r.id&&""!==r.id?e[t.xpath]=void 0!==r.id?r.id:"":e[t.xpath]=""))},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue,a=!0;return $.forceCollectData?a:(t=t&&void 0!==t.length?t[0]:t,i=i&&void 0!==i.length?i[0]:i,r=r&&void 0!==r.length?r[0]:r,t=t&&void 0!==t.id?t.id:t,i=i&&void 0!==i.id?i.id:i,a=void 0!==(r=r&&void 0!==r.id?r.id:r)?r!=i||r!=t:t!=i)},parseAdditionalValues:function(e){var t=this;return $.map(e,(function(e){var i=e.value?t.formatItem(e.value):e,r={id:e.id,value:i};return e.hidden&&(r.hidden=!0),e}))},complementData:function(e){var t=this,i=t.properties,r=!1;if($.each(e,(function(e,a){void 0!==a.value&&null!==a.value?(a.value=t.formatItem(a.value),i.value&&a.id==i.value.id&&(r=!0)):a.value=""})),t.showEmpty()){for(var a=!1,n=0,o=e.length;n<o;n++)if(""===e[n].id){a=!0;break}if(!a){var s=bizagi.override.emptyLabelForCombo||bizagi.localization.getResource("render-combo-empty-value");e.unshift({id:"",value:s})}}return i.value&&!r&&t.showCurrentData()&&e.unshift({id:i.value.id,value:i.value.value,hidden:!0}),t.parseAdditionalValues(e)},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmpty(e)&&("[object Object]"!==Object.prototype.toString.apply(e)||!bizagi.util.isEmpty(e.id)&&0!=e.id)},cleanData:function(){var e={id:"",label:""};this.setDisplayValue(e),this.setValue(e,!1)},beforeToRefresh:function(){this.column&&!this.column.comboData&&this.getData()},isExtraItem:function(){var e=(this.value||{}).value||"";return""===e||e===this.getResource("render-combo-empty-selection")||e===this.getResource("render-combo-empty-value")},escapeValue:function(e){return bizagi.util.isString(e)?e.replaceAll("<","&lt;").replaceAll(">","&gt;"):e},mapValue:function(e){return e&&e.fromAction?{id:e.value,value:e.label,label:e.label}:e},preprocessValue:function(e){var t=this;if(null==e)return e;var i={id:"",value:void 0};if(e.fromAction&&(e={id:e.value,value:e.label}),"number"==typeof e||"string"==typeof e){i.id="string"==typeof e?Number(e):e;var r=t.findDataValueById(i.id);i.value=r?r.value:""}else if("object"===_typeof(e)){if(void 0!==e.id&&null!==e.id&&("string"==typeof e.id&&""!==e.id?(i.id=Number(e.id),isNaN(i.id)&&(i.id=e.id)):i.id=e.id,""!==i.id&&(void 0===e.value||null===e.value||""===e.value))){r=t.findDataValueById(i.id);i.value=r?r.value:e.value}void 0!==e.value&&null!==e.value&&""!==e.value&&("boolean"==typeof e.value?i.value=e.value?t.getResource("render-boolean-yes"):t.getResource("render-boolean-no"):Array.isArray(e.value)?i.value=e.value.map((function(e){return"boolean"==typeof e?e?t.getResource("render-boolean-yes"):t.getResource("render-boolean-no"):e})).join(" - "):i.value=e.value)}return i},validateValue:function(e){if(null!=e.id&&("number"==typeof e.id&&null!==e.id||"string"==typeof e.id&&e.id.length>0))if(null!==e.value&&"boolean"==typeof e.value)translated=!0,!0===bizagi.util.parseBoolean(e.value)?e.value=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value)&&(e.value=bizagi.localization.getResource("render-boolean-no"));else if(null!=e.value&&"object"===_typeof(e.value))for(var t=0,i=e.value.length;t<i;t++)null!=e.value[t]&&"boolean"==typeof e.value[t]&&(!0===bizagi.util.parseBoolean(e.value[t])?e.value[t]=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value[t])&&(e.value[t]=bizagi.localization.getResource("render-boolean-no")));return e},findDataValueById:function(e){return(this.properties.data||[]).find((function(t){return t.id==e}))}}),$.Class.extend("bizagi.rendering.check",{},{initializeData:function(e){this._super(e);var t=this.properties;t.value=void 0!==t.value?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var e=this.renderFactory.getTemplate("check"),t=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(e,{id:t,editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()},postRender:function(){this._super()},getDisplayValue:function(){var e=this.getValue();return!0===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-no"):""},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmpty(e)&&!(!1===bizagi.util.parseBoolean(e)&&this.properties.required)}}),$.Class.extend("bizagi.rendering.number",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.setGroupDigits(),t.colorize=t.colorizeOnNegative||!1,t.dataTypeMinValue=this.calculateMinValue(t.dataType),t.dataTypeMaxValue=this.calculateMaxValue(t.dataType)},renderControl:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{id:this.properties.id,editable:this.properties.editable,value:bizagi.isMobile()?this.getDisplayValue():"",type:bizagi.util.isAndroidDevice()?"tel":"text",isDesign:"execution"!==this.getMode()})},postRender:function(){this._super();var e=this.getControl(),t=this.properties;this.numericInput=e.find("input"),this.numericInput.numeric(this.properties.decimalSymbol),"double"===t.retype&&this.attachRetypeDouble()},configureHandlers:function(){this.attachFormatCurrency()},removeValidations:function(){(this.getFormContainer().parent||this.getFormContainer()).clearValidationMessages()},attachRetypeDouble:function(){},formatNumericInput:function(e){var t=this.properties,i=bizagi.localization.getResource("render-number-retype-fail"),r=this.getFormContainer();if(void 0===r.validationController){var a=r.getValidationsContainer();r.validationController=new bizagi.command.controllers.validation(r,this.validations,a)}var n=r.validationController||r.parent.validationController,o=".",s=",";"undefined"==typeof BIZAGI_DEFAULT_CURRENCY_INFO?(o=this.getResource("numericFormat").decimalSymbol||".",s=this.getResource("numericFormat").digitGroupSymbol||","):(o=BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,s=BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator);var l=this.getMinValue(),d=this.getMaxValue();t.percentage&&this.numericInput.val(this.numericInput.val().replace("%",""));var u=this.numericInput.val();u=(u=","==o?u.replace(/\,0+$/,""):u.replace(/\.0+$/,"")).replace(t.symbol,""),-1!=(u=bizagi.util.replaceAll(u,s,"")).toString().indexOf(o)&&(","==o&&(u=u.replace(/([0-9]+(\,[0-9]+[1-9])?)(\,?0+$)/,"$1")),"."==o&&(u=u.replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1"))),null!=u&&u.length>0&&this.numericInput.val(u),/(.+)-$/.test(u)&&(u=u.replace(/(.+)-$/,"-$1"),this.numericInput.val(u));var c=u.replace(/[^0-9]+/g,"").length,p=this.properties.xpath,h=this.numericInput.val();if(null!=this.isInvalidFormat&&1==this.isInvalidFormat||""!=u&&-1!=["$","£","€","¥",t.symbol].indexOf(u))return this.setValue(""),this.getControl().find("input").val(""),void this.numericInput.val("");if(""!=bizagi.util.trim(u)){var g=parseFloat(u.replace(",","."));if(isNaN(g)&&(g=this.numericInput.asNumber()),i=void 0!==l&&null!=l&&g<l?bizagi.localization.getResource("render-numeric-minimum-validation").replaceAll("#label#",t.displayName+" ("+h+")").replaceAll("#minValue#",l.toString()):null!=d&&g>d?bizagi.localization.getResource("render-numeric-maximum-validation").replaceAll("#label#",t.displayName+" ("+h+")").replaceAll("#maxValue#",d.toString()):i+" "+h,null!=l&&g<l||null!=d&&g>d||10==this.properties.dataType&&c>15||1==this.properties.dataType&&c>19||11==this.properties.dataType&&c>7||11==this.properties.dataType&&c>7||h.match(/[^$£€¥,-.()\d]/)){if(void 0!==n&&null!=n){this.removeValidations();var m=i;-1===m.indexOf(h)&&(m=i+" "+h),n.showValidationMessage(m,p),this.isValidRender=!1,this.isValidRenderMessage=m}i=i.replace(h,"")}else this.isValidRender=!0,this.isValidRenderMessage="",e.value.toString().length>0&&!t.allowDecimals&&!t.groupDigits?(e.value=e.value.toString().replace(/^0+/,""),t.symbol.length>0&&(e.value=e.value.toString().replace(t.symbol+"0",t.symbol)),e.value=e.value.toString().replace(/^0+/,""),0==e.value.replaceAll("0","").length?e.value=t.symbol+"0":e.value.toString()==parseInt(e.value)&&(e.value=t.symbol+e.value)):"money"!==this.properties.type&&"number"!==this.properties.type&&"columnMoney"!==this.properties.type&&"columnNumber"!==this.properties.type||(e.value=e.value.toString().replace(/^0+/,""),""===e.value&&(e.value=0)),this.executeFormatCurrencyPlugin(),this.setValue(this.numericInput.asNumber({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits})),t.percentage&&this.numericInput&&-1==this.numericInput.val().indexOf("%")&&this.numericInput.val(this.numericInput.val()+"%"),i=i.replace(h,"")}else this.setValue("")},attachFormatCurrency:function attachFormatCurrency(){var self=this,properties=self.properties;self.isValidRender=self.isValidRender||!0,null==$.formatCurrency.regions[bizagi.language]&&($.formatCurrency.regions[bizagi.language]=this.getResource("numericFormat")),self.numericInput.blur((function(){self.formatNumericInput(this)})).bind("paste",(function(e){try{var tmpData=bizagi.util.isIE()||bizagi.util.isIE11()?window.clipboardData.getData("text"):e.originalEvent.clipboardData.getData("Text"),totalVal="/[^0-9";properties.decimalSymbol.length>0&&(totalVal+=properties.decimalSymbol),8==properties.dataType&&(properties.symbol.length>0&&(totalVal+=properties.symbol),properties.digitGroupSymbol.length>0&&(totalVal+=properties.digitGroupSymbol)),totalVal+="\\-\\s]/gi";try{tmpData.replace(eval(totalVal),"").length!=tmpData.length&&e.preventDefault()}catch(e){}}catch(e){bizagi.log("Error to pasting content"),self.isInvalidFormat=!0}})).keydown((function(e){self.previousValue=this.value;var t=(e=window.event&&window.event.preventDefault?window.event:e).charCode||e.keyCode;if("undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO&&0==BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits&&(properties.allowDecimals=!1),(properties.dataType<5||8==properties.dataType&&0==properties.allowDecimals)&&(188!=t&&190!=t&&110!=t||e.preventDefault()),this.value&&void 0!==e&&this.value.length>0&&(8==properties.dataType||10==properties.dataType))if(t>47&&t<58){self.formatTimeout&&clearTimeout(self.formatTimeout);var i=this.value+"";properties.digitGroupSymbol&&properties.digitGroupSymbol.length>0&&(i=i.replaceAll(properties.digitGroupSymbol,"")),properties.symbol.length>0&&(i=i.replaceAll(properties.symbol,"")),i=$.trim(i),properties.decimalSymbol&&properties.decimalSymbol.length>0&&(i=i.replaceAll(properties.decimalSymbol,".")),10*i>properties.dataTypeMaxValue&&e.preventDefault()}else if(109==t||189==t)if(0!=this.selectionStart||this.selectionEnd!=this.value.length){var r=this.selectionEnd;this.value=properties.symbol+"-"+this.value.replace(properties.symbol,""),this.selectionStart=this.selectionEnd=r+1}else 0==this.selectionStart&&this.selectionEnd==this.value.length&&(this.value="-",this.selectionStart=this.selectionEnd=this.value.length)})).keyup((function(e){var t=(e=window.event||e).charCode||e.keyCode;if(void 0!==e)switch(t){case 16:case 17:case 13:case 18:break;case 27:this.value=""}})).keypress((function(e){var t=(e=window.event&&window.event.preventDefault?window.event:e).charCode||e.keyCode;if(void 0!==e){35==t||37==t||39==t?e.preventDefault():8!=properties.dataType&&36==t&&e.preventDefault();var i=String.fromCharCode(t);!1===properties.allowDecimals&&0===properties.numDecimals&&i===properties.decimalSymbol&&e.preventDefault()}}))},executeFormatCurrencyPlugin:function(){var e=this.properties;if(this.numericInput&&this.numericInput.formatCurrency({symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,roundToDecimalPlace:e.numDecimals,colorize:e.colorize}),8!==e.dataType&&!0===bizagi.override.removeTrailingZeros){var t=this.numericInput.val(),i=!0;-1!==t.indexOf(")")&&(i=!1,t=t.replace("(","").replace(")",""));var r=new RegExp("("+e.decimalSymbol+"\\d*?[1-9])0+$","g");t=t.replace(r,"$1"),r=new RegExp("\\"+e.decimalSymbol+"0+$","g"),t=t.replace(r,""),this.numericInput.val(t),i||this.numericInput.val("("+t+")")}e.percentage&&this.numericInput.val(this.numericInput.val()+"%")},getDisplayValue:function(){var e=this.properties,t=this.getControl(),i=void 0!==this.getValue()&&null!==this.getValue()?this.getValue():e.defaultValue||e.defaultvalue||$("input",t).val()||"",r=$("<label/>").html(bizagi.util.numberToFixedString(i));if(r.formatCurrency({symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,roundToDecimalPlace:e.numDecimals,colorize:e.colorize}),e.percentage&&(r=$("<label/>").html(r.text()+"%")),!e.editable&&8!==e.dataType&&!0===bizagi.override.removeTrailingZeros){var a=!0;-1!==(i=r.text()).toString().indexOf(")")&&(a=!1,i=i.replace("(","").replace(")",""));var n=new RegExp("("+e.decimalSymbol+"\\d*?[1-9])0+$","g");return i=i.replace(n,"$1"),n=new RegExp("\\"+e.decimalSymbol+"0+$","g"),i=i.replace(n,""),a||(i="("+i+")"),i}return r.text()},isValid:function(e){var t,i=this.properties,r=this._super(e),a=this.getValue(),n=this.getMinValue(),o=this.getMaxValue();if("string"==typeof a&&""!=a&&(a=Number(a)),this.hasValue()&&(bizagi.util.isEmpty(n)||a<n&&(t=this.getResource("render-numeric-minimum-validation").replaceAll("#label#",i.displayName.toString()+" ("+a+")").replaceAll("#minValue#",n.toString()),e.push({xpath:i.xpath,message:t}),r=!1),bizagi.util.isEmpty(o)||a>o&&(t=this.getResource("render-numeric-maximum-validation").replaceAll("#label#",i.displayName.toString()+" ("+a+")").replaceAll("#maxValue#",o.toString()),e.push({xpath:i.xpath,message:t}),r=!1)),!(!1!==this.isValidRender||r&&bizagi.util.isMobileDevice())){r=!1;var s=this.isValidRenderMessage?this.isValidRenderMessage:"error";e.push({xpath:i.xpath,message:s})}return r},getMinValue:function(){var e=this.properties.minValue;return null!=e?e:this.properties.dataTypeMinValue},getMaxValue:function(){var e=this.properties.maxValue;return null!=e?e:this.properties.dataTypeMaxValue},getDefaultAllowDecimals:function(e){if(e){if(1===e||2===e||3===e||4===e||7===e)return!1;if(6===e||8===e||10===e||11===e)return!0}return!1},getDefaultGroupDigits:function(e){if(e){if(1===e||2===e||3===e||4===e||7===e)return!1;if(6===e||8===e||10===e||11===e)return!0}return!1},setGroupDigits:function(){return void 0!==this.properties.thousands?!!this.properties.digitGroupSymbol&&bizagi.util.parseBoolean(this.properties.thousands):!!this.properties.digitGroupSymbol&&this.getDefaultGroupDigits(this.properties.dataType)},calculateMinValue:function(e){return 8===e||10===e?-922337203685477:4===e?0:3===e?-32768:2===e?-2147483648:1===e?-999999999999999:null},calculateMaxValue:function(e){return 8===e||10===e?922337203685477:4===e?255:3===e?32767:2===e?2147483647:1===e?999999999999999:null},performMinValue:function(e){var t=Number(e);return isNaN(t)&&(t=this.calculateMinValue(this.properties.dataType)),t},performMaxValue:function(e){var t=Number(e);return isNaN(t)&&(t=this.calculateMaxValue(this.properties.dataType)),t},changeMinValue:function(e){var t=this.performMinValue(e);this.properties.minValue=this.properties.dataTypeMinValue=t},changeMaxValue:function(e){var t=this.performMaxValue(e);this.properties.maxValue=this.properties.dataTypeMaxValue=t},createTooltip:function(e,t,i){e.data("oldValue",t),e.val("");try{e.tooltip("destroy")}catch(e){}e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",(function(e,t){t.tooltip.zIndex(r)})),e.tooltip("open");var a=setTimeout((function(){e.focus(),clearTimeout(a)}),100)}}),$.Class.extend("bizagi.rendering.numberScientificNotation",{initializeData:function(e){this._super(e),this.properties.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:format.decimalSymbol},renderControl:function(){var e=this.renderFactory.getTemplate("numberScientificNotation");return $.fasttmpl(e,{})},postRender:function(){var e=this.getControl();this.numericInput=e.find("input"),this.numericInput.numericSN(this.properties.decimalSymbol)},getDisplayValue:function(){return this.getValue().replace(".",this.properties.decimalSymbol)},setValue:function(e){e=(e||"").toString().replace(this.properties.decimalSymbol,"."),this._super(e)},controlValueIsChanged:function(){var e=this.properties,t=this.getValue()||"",i=e.originalValue||"";return!!$.forceCollectData||i.toLowerCase()!=t.toLowerCase()}}),$.Class.extend("bizagi.rendering.date",{},{initializeData:function(e){var t=bizagi.util.dateFormatter;this._super(e);var i=this.properties,r=this.getResource("dateFormat"),a=this.getResource("timeFormat");if(i.displayValue="",i.showTime=void 0!==i.showTime&&bizagi.util.parseBoolean(i.showTime),i.dateFormat=i.dateFormat||r,i.timeFormat=i.timeFormat||a,i.fullFormat=i.dateFormat,i.showTime&&-1===i.fullFormat.search(/[h|H]+/gi)&&(i.fullFormat=i.fullFormat+" "+i.timeFormat),i.value){var n=t.getDateFromInvariant(i.value,i.showTime);if(0!=n){this.value=i.value;var o=bizagi.localization.getResource("datePickerRegional");i.displayValue=bizagi.util.dateFormatter.formatDate(n,i.fullFormat,o)}else this.value=null}r=this.getDateFormat(i.fullFormat);var s=i.fullFormat.substring(0,i.fullFormat.indexOf(":")).lastIndexOf(" ");i.showTime||(i.fullFormat=s>0?i.fullFormat.substring(0,s):i.fullFormat),i.datePickerFormat=r.datePickerFormat,i.timePickerFormat=r.timePickerFormat,this.i18n=bizagi.localization.getResource("datePickerRegional")},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("date"),i=e.fullFormat;return $.fasttmpl(t,{id:e.id,showTime:e.showTime,value:e.value,editable:e.editable,dateFormat:bizagi.override&&!0===bizagi.override.uppercaseDatePlaceholder?i.toUpperCase():i,rtl:"rtl"==e.orientation})},configureHandlers:function(e,t){var i=this,r=i.properties,a=i.getDateControl(),n=i.getTimeControl();a.bind("change",(function(){i.onChangeHandler()})),r.showTime&&n.bind("change",(function(e,t){i.updatingTime?delete i.updatingTime:i.onChangeHandler(t)}))},onChangeHandler:function(){},getDisplayValue:function(e){var t,i=this.properties;if(!i.displayValue&&e){var r=bizagi.util.dateFormatter.getDateFromInvariant(e,i.showTime),a=bizagi.localization.getResource("datePickerRegional");t=bizagi.util.dateFormatter.formatDate(r,i.fullFormat,a)}else t="";return i.displayValue||t||""},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();if(this.controlValueIsChanged()&&!bizagi.util.isEmpty(i))if(bizagi.util.isEmpty(r))""===r&&(e[t.xpath]="");else{var a=bizagi.util.dateFormatter.getDateFromInvariant(r,t.showTime);void 0!==a&&0!==a&&(t.showTime||a.setHours(0,0,0,0),e[t.xpath]=bizagi.util.dateFormatter.formatInvariant(a,!0))}},getDateControl:function(){},getTimeControl:function(){},isValid:function(e){var t,i=this.properties,r=this._super(e),a=this.getValue();if(a&&(!0===bizagi.util.parseBoolean(i.editable)&&0!=(a=this.getNormalizeDate(bizagi.util.dateFormatter.getDateFromInvariant(a,i.showTime))))){if(i.minValue&&("string"==typeof i.minValue||"number"==typeof i.minValue)){var n=this.getNormalizeDate("string"==typeof i.minValue?bizagi.util.dateFormatter.getDateFromInvariant(i.minValue,i.showTime):new Date(i.minValue));a<n&&(t=this.getResource("render-date-minimum-validation").replaceAll("#label#",i.displayName).replaceAll("#minValue#",bizagi.util.dateFormatter.formatDate(n,i.fullFormat)),e.push({xpath:i.xpath,message:t}),r=!1)}if(i.maxValue&&("string"==typeof i.maxValue||"number"==typeof i.maxValue)){var o=this.getNormalizeDate("string"==typeof i.maxValue?bizagi.util.dateFormatter.getDateFromInvariant(i.maxValue,i.showTime):new Date(i.maxValue));a>o&&(t=this.getResource("render-date-maximum-validation").replaceAll("#label#",i.displayName).replaceAll("#maxValue#",bizagi.util.dateFormatter.formatDate(o,i.fullFormat)),e.push({xpath:i.xpath,message:t}),r=!1)}}return r},getDateFormat:function(e){var t,i=e,r=void 0;return-1==e.search("h")&&-1==e.search("H")||(t=-1!=e.search("h")?e.search("h"):e.search("H"),i=e.substring(0,t-1),r=e.substr(t)),i.indexOf("MMMM")>=0?i=i.replaceAll("MMMM","MM"):i.indexOf("MMM")>=0?i=i.replaceAll("MMM","M"):i.indexOf("MM")>=0?i=i.replaceAll("MM","mm"):i.indexOf("M")>=0&&(i=i.replaceAll("M","m")),-1!=i.search("yyyy")?i=i.replaceAll("yyyy","yy"):-1!=i.search("yy")&&(i=i.replaceAll("yy","y")),{datePickerFormat:i=i.replaceAll("dddd","DD"),timePickerFormat:r}},postRender:function(){var e=this.properties;this._super(),void 0===e.maxValue&&(e.maxValue="12/31/"+parseInt((new Date).getFullYear()+200).toString()+" 00:00:00"),void 0===e.minValue&&(e.minValue="01/01/"+parseInt((new Date).getFullYear()-200).toString()+" 00:00:00")},getNormalizeDate:function(e){return 0!=e&&null!=e&&(this.properties.showTime?e.setMilliseconds(0):e.setHours(0,0,0,0)),e},getTimeFormat:function(e){return e.replaceAll("m","i").replaceAll("tt","A")},setValueFromCalendarButtons:function(e){e?e=this.getNormalizeDate(e):(value=null,this.setValue(""),this.setDisplayValue(""))},changeMinValue:function(e){var t=this.properties,i=bizagi.util.dateFormatter;e&&t.editable&&("number"==typeof e?e=i.formatInvariant(this.getNormalizeDate(new Date(e)),t.showTime):(e=this.getNormalizeDate("object"===_typeof(e)?e:i.getDateFromInvariant(e,t.showTime)),e=i.formatInvariant(e)),t.minValue=e)},changeMaxValue:function(e){var t=this.properties,i=bizagi.util.dateFormatter;e&&t.editable&&("number"==typeof e?e=i.formatInvariant(this.getNormalizeDate(new Date(e)),t.showTime):(e=this.getNormalizeDate("object"===_typeof(e)?e:i.getDateFromInvariant(e,t.showTime)),e=i.formatInvariant(e)),t.maxValue=e)}}),$.Class.extend("bizagi.rendering.extendedText",{},{initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.hasMaxLines=!!this.properties.maxLines;var t=this.properties;if(t.maxLines=this.properties.maxLines||6,t.regularExpressionExpression){var i=t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message");t.regularExpression={expression:t.regularExpressionExpression,message:i}}},renderControl:function(){var e=this.renderFactory.getTemplate("extendedText");return $.fasttmpl(e,{id:this.properties.id,isEmptyField:void 0===this.properties.value,editable:this.properties.editable})},postRender:function(){this._super();var e=this.getControl();this.textarea=e.find("textarea"),this.textarea?this.textarea.css({resize:"both"}):this.textarea.css({resize:"none"}),"double"===this.properties.retype&&this.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var e=this,t=e.properties;t.maxLength&&e.textarea.prop("maxlength",t.maxLength),t.maxLines?e.textarea.prop("rows",t.maxLines):e.textarea.prop("rows",6),e.textarea.bind("change",(function(){e.setValue(e.textarea.val());var i=[];if("duplicate"!==t.retype)if(e.isValid(i)||void 0===t.regularExpression)e.setValue(e.textarea.val(),!0);else{var r=i[0].message;bizagi.showMessageBox(r,"Bizagi","error")}})),e.textarea.bind("blur",(function(){e.setValue(e.textarea.val())}))},isValid:function(e){var t,i=this.properties,r=this._super(e),a=this.getValue(),n=new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g");return this.isOfflineForm&&bizagi.util.isMobileDevice()&&(a=a&&"object"===_typeof(a)&&a.value?a.value:a),i.regularExpression?i.editable&&(a&&(a.match(n)||!a.match(new RegExp(i.regularExpression.expression))&&this.properties&&"userName"===this.properties.xpath)?(t=i.regularExpression.message,e.push({xpath:i.xpath,message:t}),r=!1):!a||!a.match(n)&&a.match(new RegExp(i.regularExpression.expression))||(t=i.regularExpression.message,e.push({xpath:i.xpath,message:t}),r=!1)):a&&a.match(new RegExp(".*?eval\\(","g"))&&a.match(new RegExp(".*?eval\\u0028","g"))&&i.editable&&(t=this.getResource("render-text-regular-expression-default-message"),e.push({xpath:i.xpath,message:t}),r=!1),r},setDisplayValue:function(e){var t=this.getControl();if(0==this.properties.editable&&"string"==typeof e){var i=bizagi.util.encodeHtmlText(this.getDisplayValue());t.html(i)}this.setValue(e,!1)},collectData:function(e){this._super(e)},createTooltip:function(e,t,i){e.data("oldValue",t),e.val(""),e.data("ui-tooltip")&&e.tooltip("destroy"),e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",(function(e,t){t.tooltip.zIndex(r)})),e.tooltip("open");var a=setTimeout((function(){e.focus(),clearTimeout(a)}),100)},validateValue:function(e,t){return t<1||e.length<=t?e:e.substr(0,t)}}),$.Class.extend("bizagi.rendering.grid",{},{initializeData:function(e){var t=this;this._super(e),t.originalProperties=bizagi.clone(e.properties);var i,r,a=this.properties;t.initProperties(),t.columns=[],t.columnsIds=[],t.enabledChecks={},t.exclusiveChanges={},t.originalEnabledChecks=[],$.each(e.elements,(function(e,n){var o=n.render.properties;o.groupBy&&(a.groupBy=o.xpath||"",a.allowGrouping=!bizagi.util.isEmpty(a.groupBy)),/columnBoolean/i.test(o.type)&&o.isExclusive&&(a.hasExclusiveCheck=!0,n.render.properties.required=!1,t.enabledChecks[o.xpath]=[]),t.properties.inlineEdit||(n.render.properties.editable=!1);var s=t.renderFactory.getColumn({type:o.type,data:n.render,parent:t,singleInstance:a.singleInstance});t.columns.push(s),t.columnsIds.push(n.render.properties.id),o.editable&&(i=!0),o.totalize&&o.totalize.operation&&(r=!0,o.totalize.format=o.totalize.format||{},o.totalize.format.bold=void 0===o.totalize.format.bold||o.totalize.format.bold)})),"rtl"===a.orientation&&(t.columns=t.columns.reverse()),a.inlineEdit&&!i&&(a.inlineEdit=!1,a.allowEdit=!1),r&&(a.showSummary=!0,a.rowsPerPage=0)},initProperties:function(){var e=this.getFormContainer(),t=this.properties;$.extend(t,this.initEditabilityProperties(t.editable,t.allowEdit,t.inlineEdit,t.withEditForm),this.initAddAndDeleteProperties(t.editable,t.allowAdd,t.inlineAdd,t.allowDelete)),t.allowDetail=null!=bizagi.util.parseBoolean(t.allowDetail)&&bizagi.util.parseBoolean(t.allowDetail),t.isSortable=null==bizagi.util.parseBoolean(t.isSortable)||bizagi.util.parseBoolean(t.isSortable),t.keyColumn="",t.data=t.data||null,t.displayType="value",t.skipInitialLoad=t.skipInitialLoad||!1,t.allowMore=bizagi.util.parseBoolean(t.allowMore)||!1,t.allowFilter=bizagi.util.parseBoolean(t.allowFilter)||!1,t.allowGrouping=!1,t.groupBy="",t.groupSummary=t.groupSummary||null,t.groupText=this.getResource("render-grid-group-text"),t.groupCollapsed=bizagi.util.parseBoolean(t.groupCollapsed)||!1,t.groupOrder=t.groupOrder||"asc",t.formShowMode=bizagi.util.parseBoolean(t.formShowMode)||"popup",t.floatingHeader=bizagi.util.parseBoolean(t.floatingHeader)||!1,t.sortBy=t.sortBy?t.sortBy:t.data&&t.data.sort?t.data.sort:t.keyColumn,t.sortOrder=void 0!==t.sortOrder&&null!==t.sortOrder?"True"===t.sortOrder?"asc":"desc":t.data&&t.data.order?t.data.order:"asc",t.sort=t.sortBy+" "+t.sortOrder,t.rowsPerPage=t.allowGrouping?1e3:t.rowsPerPage||20,t.page=1,t.records=0,t.totalPages=0,t.addLabel=t.addLabel||$.trim(this.getResource("render-grid-add-label"))+" "+t.displayName,t.editLabel=t.editLabel||$.trim(this.getResource("render-grid-edit-label"))+" "+t.displayName,t.deleteLabel=t.deleteLabel||this.getResource("render-ecm-confirm-bt-delete")+" "+t.displayName,t.exportOptionsLabel=t.exportOptionsLabel||this.getResource("render-grid-export-options-label")+t.displayName,t.detailLabel=t.detailLabel||this.getResource("render-collection-navigator-details-form"),t.tableCssClass=t.cssClass||"",t.alreadySaved=!1,"entity"!=t.contexttype&&(t.contexttype="function"==typeof this.parent.getContextType?this.parent.getContextType():"");try{(this.parent&&"boolean"==typeof this.parent.properties.editable&&!this.parent.properties.editable||!t.editable)&&(t.editable=!1,t.allowEdit=!1,t.inlineEdit=!1,t.allowAdd=!1,t.inlineAdd=!1,t.allowDelete=!1)}catch(e){}t.allowEdit&&(t.inlineEdit||t.withEditForm)||(t.editable=!1),t.labelWidth=0,t.valueWidth="100%",t.overrideGetRemoteData=t.overrideGetRemoteData||void 0,t.singleInstance=!!bizagi.util.isEmpty(t.singleInstance)||t.singleInstance,t.contextType=e.params&&e.params.data&&e.params.data.contextType?e.params.data.contextType:null,this.changes={},this.cellOverrides={},this.isRTL()&&null!=t.data&&(t.data.rows=this.changeOrderData(t.data.rows))},initEditabilityProperties:function(e,t,i,r){return e=null===bizagi.util.parseBoolean(e)||bizagi.util.parseBoolean(e),t=null===bizagi.util.parseBoolean(t)||bizagi.util.parseBoolean(t),i=null===bizagi.util.parseBoolean(i)||bizagi.util.parseBoolean(i),r=null!==bizagi.util.parseBoolean(r)&&bizagi.util.parseBoolean(r),e||(t=i=r=!1),{editable:e,allowEdit:t,inlineEdit:i,withEditForm:r}},initAddAndDeleteProperties:function(e,t,i,r){return e=null===bizagi.util.parseBoolean(e)||bizagi.util.parseBoolean(e),t=null==bizagi.util.parseBoolean(t)||bizagi.util.parseBoolean(t),i=null==bizagi.util.parseBoolean(i)||bizagi.util.parseBoolean(i),r=null==bizagi.util.parseBoolean(r)||bizagi.util.parseBoolean(r),t||(i=!1),e||(t=i=r=!1),{allowAdd:t,inlineAdd:i,allowDelete:r}},hasValue:function(){return this.properties.data&&this.properties.data.rows.length>0},isRTL:function(){var e=this.properties;return!e||"string"==typeof e.orientation&&"RTL"==e.orientation.toUpperCase()},changeOrderData:function(e){var t,i=[],r=e||[];return $.each(r,(function(e,a){t=a.shift(),(i=a.reverse()).unshift(t),r[e]=i})),r},removeRemainingColumns:function(e,t){var i=e||[],r=0;return i.length>0&&(r=i[0].length-t-1),r>0&&$.each(i,(function(e,t){for(var i=0;i<r;i++)t.pop()})),i},getColumn:function(e){var t=null;return $.each(this.columns,(function(i,r){r.properties.xpath!=e&&r.properties.id!=e&&r.properties.xpath+"."+r.properties.id!=e||(t=r)})),t},getColumnType:function(e){var t=this.columnsIds.indexOf(e);return-1!=t?this.columns[t].properties.type:null},getColumnById:function(e){var t=this.columnsIds.indexOf(e);return-1!==t?this.columns[t]:null},renderControl:function(){var e=this.properties,t=new $.Deferred;"execution"!==this.getMode()&&(e.data=this.getDummyData());var i=this.getGridTemplate(),r=this.applyTemplate(i),a=[];return $.each(this.columns,(function(e,t){var i=t.initialize();i&&a.push(i)})),$.when.apply($,a).done((function(){t.resolve(r)})),t.promise()},postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-grid-container").addClass("ui-bizagi-render-display-block")},getGridTemplate:function(){return this.renderFactory.getTemplate("grid")},applyTemplate:function(e){var t=this.properties;return orientation=this.properties.orientation,$.fasttmpl(e,{id:bizagi.util.encodeXpath(t.xpath),displayName:bizagi.util.encodeXpath(t.displayName),allowAdd:t.allowAdd,addLabel:t.addLabel})},renderReadOnly:function(){return this.renderControl()},getRemoteData:function(e){var t=this,i=t.properties;return e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,sort:i.sortBy,order:i.sortType,page:i.page,rows:i.rowsPerPage,searchFilter:i.searchFilter,orientation:i.orientation||"ltr"}),i.overrideGetRemoteData?i.overrideGetRemoteData(e):t.dataService.multiaction().getGridData(e).then((function(e){return t.originalProperties=t.originalProperties||{},t.originalProperties.data=bizagi.clone(e),i.page=e.page,i.records=e.records,i.totalPages=e.totalPages,e})).fail((function(e){console.error(e.message||"Error")}))},spliceRowData:function(e,t){"execution"===this.getMode()&&e&&e.rows&&$.each(e.rows,(function(i,r){var a=t||e.rows[i].length;e.rows[i].splice(a,0,"")}))},spliceRowDataVisible:function(e,t){"execution"===this.getMode()&&e&&e.visible&&$.each(e.visible,(function(i,r){var a=t||e.visible[i].length;e.visible[i].splice(a,0,!0)}))},spliceRowDataEditable:function(e,t){"execution"===this.getMode()&&e&&e.editable&&$.each(e.editable,(function(i,r){var a=t||e.editable[i].length;e.editable[i].splice(a,0,!0)}))},getDummyData:function(){var e=this.properties;if(e.data)return e.data;for(var t=["1"],i=0;i<this.columns.length;i++)t.push("");return{page:1,total:1,records:1,rows:[t]}},submitEditRequest:function(e){var t=this.properties,i=t.xpath+this.buildCellXpathFilter(e);return this.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType})},submitSaveRequest:function(e,t){var i=this,r=i.properties,a=null;t.deferreds&&(a=$.when.apply($,t.deferreds),delete t.deferreds);var n=r.xpathContext.length>0?r.xpathContext+"."+r.xpath+i.buildCellXpathFilter(e):r.xpath+i.buildCellXpathFilter(e);return $.when(a).pipe((function(){return i.startLoading(),i.dataService.saveGridRecord({url:r.saveUrl,idRender:r.id,xpath:r.xpath,xpathContext:n,submitData:t,contexttype:r.contextType,disableServerGridValidations:t.disableServerGridValidations||!1}).pipe((function(e){return i.endLoading(),e})).fail((function(e){var t=i.getFormContainer(),r=e.responseText?e.responseText:"string"==typeof e?e:e.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=e);t.validateForm(),t.clearValidationMessages(),t.addValidationMessage(r)}))}))},submitDeleteRequest:function(e){var t=this,i=t.properties,r=i.xpath+t.buildCellXpathFilter(e);return t.dataService.deleteGridRecord({url:i.deleteUrl,idRender:i.id,xpath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType}).pipe((function(e){if("validationMessages"==e.type){var i=t.getFormContainer(),r=e.messages.join(" ");i.failHandler({message:r})}return e}))},submitAddRequest:function(){var e=this.properties;return this.dataService.addGridRecord({url:e.addUrl,idRender:e.id,xpath:e.xpath,xpathContext:e.xpathContext,contexttype:e.contextType,idPageCache:e.idPageCache}).pipe((function(e){return e.idEntity})).promise()},submitRollbackRequest:function(e){var t=this.properties;return this.dataService.rollbackGridAction({url:t.rollbackUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:e?e.idPageCache:t.idPageCache,contexttype:this.properties.contexttype||""})},collectGridChange:function(e){var t=(e=e||{}).id,i=e.dataType,r=e.xpath,a=e.value,n=void 0===e.trigger||e.trigger,o=e.pressed||!1,s=i&&bizagi.util.normalizeType(i),l=e.renderId||"";this.changes[t]=this.changes[t]||{},/^columnsearch$/i.test(s)&&a&&void 0!==a.id?this.changes[t][r]=a.id:this.changes[t][r]=a,n&&this.triggerRenderChange({key:t,column:r,pressed:o,id:l})},configureColumnSubmitOnChange:function(e){var t=this,i=t.properties,r=i.id,a={commands:[{xpath:i.xpath,command:"submit-value",argument:"all"}],conditions:{operator:"and",expressions:[{simple:{operator:"cell-change",xpath:i.xpath+"[]."+e,argumentType:"text",argument:e}}]},dependencies:[i.xpath]};$.when(t.ready()).done((function(){t.getFormContainer().addSubmitAction(e+"."+r,a)}))},collectData:function(e){var t=this,i=t.properties,r=[];if(t.exclusiveChanges)for(var a in t.exclusiveChanges){var n=t.exclusiveChanges[a],o=t.enabledChecks[a];if(n&&o)e[i.xpath+"["+a+"=true]."+a]=!1}for(var s in t.changes){if("summary"!=s)for(var l in t.changes[s])if(t.canColumnBeSent(s,l)){a=i.xpath+t.buildCellXpathFilter(s)+"."+l;var d=t.changes[s][l];e[a]=d}r.push(s)}if(t.exclusiveChanges)for(var a in t.exclusiveChanges){n=t.exclusiveChanges[a],o=t.enabledChecks[a];if(n&&o){var u=t.exclusiveChanges[a];if(u&&u.value)e[i.xpath+t.buildCellXpathFilter(u.key)+"."+a]=u.value}}$.each(r,(function(e,i){delete t.changes[i]}))},hasChanged:function(e){return $.isEmptyObject(this.changes)?!$.isEmptyObject(this.exclusiveChanges)&&(e.push(!0),!0):(e.push(!0),!0)},canColumnBeSent:function(e,t){var i,r;for(i in this.columns)if(this.columns.hasOwnProperty(i)){var a=this.columns[i];if("columnUserfield"!==a.properties.type){if(a.properties.xpath==t){var n=this.getCellOverride(e,a.columnIndex-1);return a.canBeSent(e,n)}}else for(r in a.properties)if(a.properties.hasOwnProperty(r)&&"[object String]"===Object.prototype.toString.apply(a.properties[r])&&a.properties[r].substr(a.properties[r].lastIndexOf(".")+1)===t)return!0}return!1},canBeSent:function(){var e=this.properties;return!(bizagi.util.parseBoolean(e.displayOnly)||!1||!e.inlineEdit&&!e.inlineAdd&&$.isEmptyObject(this.changes))},getCellValue:function(e,t){for(var i=this.properties.data.rows,r=0;r<i.length;r++)if(i[r][0]==e)for(var a=0;a<this.columns.length;a++){if(this.columns[a].properties.xpath==t)return i[r][a+1]}return null},getCellCurrentValue:function(e,t){var i=this.getControlCell(e,t);return i&&"function"==typeof i.getValue?i.getValue():null},getControlCell:function(e,t){var i=null;if(void 0!==this.columns)for(var r=0;r<this.columns.length;r++)if(this.columns[r].properties.xpath==t||this.columns[r].properties.id==t||this.columns[r].properties.xpath+"."+this.columns[r].properties.id==t){i=this.columns[r].getDecorated(e);break}return i},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("grid-control-required"):t.removeClass("grid-control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("grid-control-required"):t.removeClass("grid-control-required")),this.triggerRenderValidate()},refresh:function(){},setError:function(e,t){},changeCellBackgroundColor:function(e,t,i){},changeCellColor:function(e,t,i){},changeCellVisibility:function(e,t,i){},changeCellRequired:function(e,t,i){},changeCellEditability:function(e,t,i){},changeCellProperties:function(e,t,i){},changeCellMaxValue:function(e,t,i){},changeCellMinValue:function(e,t,i){},changeColumnEditability:function(e,t){},changeColumnVisibility:function(e,t){},changeColumnRequired:function(e,t){},cleanCellData:function(e,t){},changeEditability:function(e){var t=this,i=t.getControl();t.saveGrid().done((function(){var r="Default"==e?t.originalProperties.editable:bizagi.util.parseBoolean(e);i.empty();var a=t.originalProperties;$.extend(t.properties,t.initEditabilityProperties(r,a.allowEdit,a.inlineEdit,a.withEditForm),t.initAddAndDeleteProperties(r,a.allowAdd,a.inlineAdd,a.allowDelete)),t.properties.editabilityEnabled=t.properties.editabilityEnabled||t.properties.editable,r?t.properties.allowEdit&&t.properties.inlineEdit&&t.changeColumnsEditability(e):t.changeColumnsEditability(!1),"function"==typeof t.internalRenderControl&&$.when(t.internalRenderControl()).done((function(e){i.append(e),t.postRenderElement(t.element)}))}))},saveGrid:function(){var e=this,t=$.Deferred(),i=$("[data-bizagi-component=rows]",e.element).find("[data-new-row=true]");if(i.length>0){var r=$.map(i,(function(e,t){return $(e).data("business-key")}));e.saveInlineAddedRows(r).done((function(){$.when(e.saveRows()).done((function(){e.refresh(),t.resolve()}))}))}else t.resolve();return t.promise()},changeColumnsEditability:function(e){var t=this.columns||[];$.each(t,(function(t,i){i.properties.editable="Default"==e?i.originalProperties.editable:bizagi.util.parseBoolean(e)}))},refreshCell:function(e){var t=this,i=t.properties,r=e.key,a=e.column,n=""!==e.xpathContext?e.xpathContext+"."+t.properties.xpath+t.buildCellXpathFilter(r):t.properties.xpath+t.buildCellXpathFilter(r),o=t.getControlCell(r,e.column),s=t.getFormContainer().properties.id;if(o)return o.beforeToRefresh(),$.when(t.dataService.multiaction().refreshGridCell({idRender:i.id,column:o.properties.id,idPageCache:i.idPageCache,xpathContext:n,idForm:s,typeRender:bizagi.util.normalizeType(o.properties.type)})).done((function(e){var i=function(e){return e&&"object"==_typeof(e)&&e.length>=1?e[0].length>=1?e[0][0]:e[0]:""},n=i(e.rows),s=i(e.editable);bizagi.util.isBoolean(s)||(s=s||!0);var l=i(e.visible);bizagi.util.isBoolean(l)||(l=l||!0),t.changeCellVisibility(r,a,l),t.changeCellEditability(r,a,s);var d=o.formatValue(n);o.setValue(d),o.setDisplayValue(d),t.triggerRenderChange({key:r,column:a,changed:!1}),bizagi.override.restoreAppearanceAfterRefresh&&o.restoreCellAppearance(),null!=o.column&&"desktop"==bizagi.util.detectDevice()&&t.updateAffectedCellManually(r,d,o.column.columnIndex),t.afterToRefresh({action:"refreshCell"})}))},triggerRenderChange:function(e){e=e||{},bizagi.util.isEmpty(e)||0==e.changed||(this.properties.canBeExported=!1),this.triggerHandler("renderchange",{render:this,surrogateKey:e.key,column:e.column,changed:e.changed,rowDeleted:e.rowDeleted,pressed:e.pressed,id:e.id||""})},validate:function(){this.isValid([])},isValid:function(e){var t=!0;if(this.hasErrors=!1,this.setValidationMessage(""),this.properties.data&&this.properties.data.rows){var i=this.getDataNewRows();0==i.length&&bizagi.util.parseBoolean(this.properties.required)&&(this.hasValue()||(message=this.getResource("render-required-text").replaceAll("#label#",this.properties.displayName),e.push({xpath:this.properties.xpath,message:message}),t=!1));for(var r=$.merge($.merge([],this.properties.data.rows),i),a=0;a<this.columns.length;a++){for(var n=[],o={},s=0;s<r.length;s++){var l=r[s][a+1],d=r[s][0];this.columns[a].properties.xpath;void 0!==this.changes[d]&&void 0!==this.changes[d][this.columns[a].properties.xpath]&&(l=this.changes[d][this.columns[a].properties.xpath]),this.columns[a].isValueValid(d,l,n,this.getCellOverride(d,a))||(t=!1,this.hasErrors=!0,this.setError(d,this.columns[a].properties.xpath))}for(var u=0,c=n.length;u<c;u++)null==o[n[u]]&&(o[n[u]]=n[u]);if(n.length>0){var p=this.getResource("render-grid-validation").replaceAll("#grid#",this.properties.displayName);for(d in o)e.push({xpath:this.properties.xpath,message:p+" "+d})}}}return t},configureSubmitOnChange:function(){},getCellOverride:function(e,t){t=Number(t);var i=this.columns[t].properties;return this.cellOverrides[e]||(this.cellOverrides[e]={}),this.cellOverrides[e][t]||(this.cellOverrides[e][t]={visible:i.columnVisible&&i.visible,editable:i.editable,required:i.required}),this.cellOverrides[e][t]},setCellOverrides:function(e,t){var i;if(e.visible)for(var r=0,a=e.visible.length;r<a;r++){i=e.visible[r][0];for(var n=0,o=e.visible[r].length;n<o;n++)if(n>0){var s=this.getCellOverride(i,n-1).visible;this.cellOverrides[i][n-1].visible=!!s&&bizagi.util.parseBoolean(e.visible[r][n])}}if(e.editable)for(r=0,a=e.editable.length;r<a;r++){i=e.editable[r][0];for(n=0,o=e.editable[r].length;n<o;n++)if(n>0){var l=!t||bizagi.util.parseBoolean(t[n-1].properties.editable);this.getCellOverride(i,n-1).editable=!!l&&bizagi.util.parseBoolean(e.editable[r][n])}}if(e.required)for(r=0,a=e.required.length;r<a;r++){i=e.required[r][0];for(n=0,o=e.required[r].length;n<o;n++)n>0&&(this.getCellOverride(i,n-1).required=bizagi.util.parseBoolean(e.required[r][n]))}},getIndexes:function(){var e=$.merge(this.properties.data.rows,this.getDataNewRows());return $.map(e,(function(e,t){return e[0]}))},getDataNewRows:function(){var e=this,t=[];return"object"!=_typeof(e.newRecords)||$.isEmptyObject(e.newRecords)||$.each(e.newRecords,(function(i){var r=[];r.push(i);for(var a=0,n=e.columns.length;a<n;a++)r.push(e.getCellCurrentValue(i,e.columns[a].properties.xpath));t.push(r)})),t},getGridExportFile:function(e){var t=this.properties;return this.dataService.getGridExportFile({idRender:t.id,xpathContext:t.xpathContext||"",idPageCache:t.idPageCache,disposition:e.disposition,exportType:e.exportType,sort:t.sort,idForm:this.getFormContainer().properties.id}).then((function(e){return bizagi.util.handleJSONResponse(e)}))},submitForGridChange:function(){return this.submitOnChange(null,!1)},dispose:function(){var e=this,t=setTimeout((function(){e.columns&&$.each(e.columns,(function(e,t){t.dispose()})),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()},getEnabledChecks:function(e){var t=this,i=t.properties;e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,rows:i.rowsPerPage,xpathfilter:e.xpath});var r=new $.Deferred;return t.dataService.multiaction().getGridDataExclusivesSelected(e).done((function(e){i.page=e.page,i.records=e.records,i.totalPages=e.totalPages,t.isRTL()&&(e.rows=t.changeOrderData(e.rows)),r.resolve(e)})),r.promise()},buildCellXpathFilter:function(e){return bizagi.util.isNumeric(e)?"[id="+e+"]":"[id='"+e+"']"},cleanNewRecords:function(){this.newRecords={}},setRowAsSaved:function(e){var t=this.getControl();$("[data-bizagi-component=rows]",t).find("tr[data-business-key="+e+"]").attr("data-new-row","false")},changeBackgroundColor:function(e){this._super(e);var t=this.getControl();return t.find(".bz-rn-grid-header-title, .bz-rn-grid-header-title-rtl").css("background-color",e,"!important"),t.find(".bz-rn-grid-container-foother, .bz-rn-grid-container-foother-rtl").css("background-color",e,"!important"),this},hasColorHeader:function(){var e=this.properties.headerFormat||{};return!!e&&!bizagi.util.isEmpty(e.color)},isRTLOrientation:function(e,t){return t&&"auto"!==t||!e?/^rtl$/i.test(t):this.isRTLOrientation(e.parent,e.properties.orientation)},canBeExport:function(){for(var e in this.changes)if("summary"!==e)for(var t in this.changes[e])if(this.canColumnBeSent(e,t))return!1;if(this.exclusiveChanges)for(var i in this.exclusiveChanges)if(this.exclusiveChanges[i]&&this.enabledChecks[i])return!1;return!0},getExclusiveChangeByRow:function(e){var t={};for(var i in this.enabledChecks)if(this.enabledChecks.hasOwnProperty(i)){var r=(this.enabledChecks[i]||[]).find((function(t){return t.id==e&&t.changed}));r&&(t[i]=r.value)}return t},isCurrentGridCell:function(e,t,i){return e===i||t===i||e+"."+t===i},getIndexForCurrentCell:function(e){var t=this;return(t.columns||[]).findIndex((function(i){return t.isCurrentGridCell(i.properties.xpath,i.properties.id,e)}))||0},isSummaryOrGlobalForm:function(){var e=this.getFormContainer(),t=e&&e.properties||{};return e&&["SummaryForm","GlobalForm"].includes(t.typeForm)}}),$.Class.extend("bizagi.rendering.hidden",{},{renderControl:function(){return"design"===this.getMode()?"<div>"+bizagi.localization.getResource("render-hidden-displayName")+"</div>":"<div />"},postRender:function(){var e=this.properties;this._super(),void 0!==e.value&&this.setDisplayValue(e.value)}}),$.Class.extend("bizagi.rendering.label",{},{initializeData:function(e){this._super(e),this.properties.required=!1,this.properties.displayType="label",this.properties.displayName=e.properties.displayName||"",bizagi.util.parseBoolean(this.properties.allowDinamiclabel)&&(this.properties.displayName=e.properties.displayName||bizagi.localization.getResource("render-label-default-display-name")),this.bindingValue(),this.calculateInitialLayoutProperties()},postRender:function(){this._super(),this.changeDisplayOption("label"),"function"==typeof this.configureHelpText&&this.configureHelpText()},postRenderReadOnly:function(){this._super(),this.changeDisplayOption("label"),this.changeLabelAlign(this.properties.labelAlign||"left")},isValid:function(e){},canBeSent:function(){return!1},bindingValue:function(){this.properties.allowDinamiclabel&&this.properties.value&&("object"===_typeof(this.properties.value)&&this.properties.value[0]?this.properties.displayName=this.properties.value[0].value:"string"==typeof this.properties.value&&""!==this.properties.value&&(this.properties.displayName=this.performLabelLineBreak(this.properties.value)))},controlValueIsChanged:function(){return!1},performLabelLineBreak:function(e){return(e||"").replace(/\\n/gm,"\n")}}),$.Class.extend("bizagi.rendering.search",{},{initializeData:function(e){var t=e.properties.submitOnChange;"execution"===this.getMode()&&e.properties.advancedSearch&&(t=void 0!==t?t:!((e.properties.submitVersion||1)>1)),this._super(e);var i=this.properties;i.submitOnChange=bizagi.util.parseBoolean(t)||!1,i.searchForms=i.searchForms||[],i.maxRecords=Number(i.maxRecords)||20,i.advancedSearch=null!==bizagi.util.parseBoolean(i.advancedSearch)&&bizagi.util.parseBoolean(i.advancedSearch),i.allowSuggest=null!==bizagi.util.parseBoolean(i.allowSuggest)&&bizagi.util.parseBoolean(i.allowSuggest),i.allowFullSearch=i.allowFullSearch||!1,i.allowAdd=bizagi.util.parseBoolean(i.allowAdd)||!1,i.allowTyping=null!==bizagi.util.parseBoolean(i.allowTyping)&&bizagi.util.parseBoolean(i.allowTyping),i.allowTyping=!!bizagi.util.parseBoolean(i.allowSuggest)||i.allowTyping,i.allowClear=null!==bizagi.util.parseBoolean(i.allowClear)&&bizagi.util.parseBoolean(i.allowClear),i.editable=null===bizagi.util.parseBoolean(i.editable)||bizagi.util.parseBoolean(i.editable),i.searchLength=i.searchLength||2,i.enableLocalStorage=!1,i.expireCache=9e5},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("search");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,allowTyping:e.allowTyping,advancedSearch:e.advancedSearch,allowSuggest:e.allowSuggest,editable:e.editable,allowClear:e.allowClear,hasValue:this.hasValue()})},getData:function(e){var t=this,i=t.properties,r=new $.Deferred,a=t.getFormContainer(),n=a.getContextType()||a.params.contexttype||!1;if(e=e||{},t.properties.contexttype?e.h_contexttype=t.properties.contexttype:n&&(e.h_contexttype=n),e.h_contexttype=t.properties.enableQuerySuggestBehavior?"metadata":e.h_contexttype,e&&e.h_contexttype&&"metadata"===e.h_contexttype&&(i.xpathContext=""),i.term.indexOf("'")>-1){var o=new RegExp("'","g");i.term=i.term.replace(o,"\\'\\'")}if(i.term.indexOf('"')>-1){o=new RegExp('"',"g");i.term=i.term.replace(o,'"')}return t.dataService.multiaction().getSearchData({url:i.dataUrl,contexttype:e.h_contexttype,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.allowFullSearch?"%"+i.term:i.term,extra:e}).done((function(e){i.data=e,r.resolve(i.data)})).fail((function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)})),r.promise(r)},setValue:function(e,t){t=void 0===t||t,this._super(e,t),null!=e?(this.value=e,this.selectedValue=e.label):(this.value=null,this.selectedValue=null)},mapValue:function(e){return e&&e.fromAction?{id:e.value,value:e.label,label:e.label}:e},collectData:function(e){var t=this.properties.xpath,i=this.getValue();if(this.controlValueIsChanged()&&!bizagi.util.isEmpty(t)&&null!=i){if("object"==_typeof(i)&&void 0===i.id)return;e[t]=i}},submitData:function(){var e={};this.grid||(e[this.properties.xpath]=this.getValue()),this.submitOnChange(e,void 0,!1)},isValid:function(e){return this._super(e)},hasValue:function(){var e=this.getValue();return void 0!==e&&null!=e&&("object"===_typeof(e)&&""!==e.id&&void 0!==e.id||!bizagi.util.isEmpty(e))},formatItem:function(e){return bizagi.util.formatItem(e)}}),$.Class.extend("bizagi.rendering.text",{},{initializeData:function(e){this._super(e);var t=this.properties;if(t.regularExpressionExpression){var i=t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message");t.regularExpression={expression:t.regularExpressionExpression,message:i}}},renderControl:function(){var e=this.renderFactory.getTemplate("text");return $.fasttmpl(e,{id:this.properties.id,value:this.properties.value,isEmptyField:void 0===this.properties.value,helpText:this.properties.helpText,editable:this.properties.editable})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("text-read-only"),t=this.getValue();return bizagi.util.isString(t)&&(t=t.replaceAll("`","&#96;")),$.fasttmpl(e,{value:t,editable:this.properties.editable})},postRender:function(){this._super(),this.input=this.getControl().find("input"),"double"===this.properties.retype&&this.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var e=this,t=e.properties;t.mask&&e.input.mask({mask:t.mask}),e.input.bind("change",(function(){e.setValue(e.input.val(),!1);"duplicate"!==t.retype&&(e.isValid([])||void 0===t.regularExpression)&&e.setValue(e.input.val(),!0)})).keypress((function(e){var t=(e=window.event||e).charCode||e.keyCode;void 0!==e&&13==t&&$(this).trigger("change")})),bizagi.util.isAndroidDevice()&&t.maxLength>0&&e.input.bind("keyup",(function(e){($(this).val()&&$(this).val().length)>=t.maxLength&&(e.preventDefault(),e.target.value=e.target.value.substring(0,t.maxLength))}))},isValid:function(e){var t=this.properties,i=this._super(e),r=this.getValue();if("string"==typeof r)if(t.regularExpression){if(t.editable){var a=new RegExp("");try{a=new RegExp(t.regularExpression.expression)}catch(r){bizagi.override.showDesignValidations&&(bizagi.log(r),e.push({xpath:t.xpath,message:r.message}),i=!1)}if(r&&(r.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!r.match(a)&&this.properties&&"userName"===this.properties.xpath)){var n=t.regularExpression.message;e.push({xpath:t.xpath,message:n}),i=!1}else if(r&&(r.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!r.match(a))){n=t.regularExpression.message;e.push({xpath:t.xpath,message:n}),i=!1}}}else if(r&&r.match(new RegExp(".*?eval\\(","g"))&&r.match(new RegExp(".*?eval\\u0028","g"))&&t.editable){n=this.getResource("render-text-regular-expression-default-message");e.push({xpath:t.xpath,message:n}),i=!1}return i},setDisplayValue:function(e){var t=this.getControl(),i=bizagi.util.decodeURI(e);if(!bizagi.util.parseBoolean(this.properties.editable))if("string"==typeof e){var r=bizagi.util.encodeHtmlText(this.getDisplayValue());t.html("<label class='readonly-control'>"+r+"</label>")}else bizagi.util.isNull(e)&&t.html("");this.setValue(i,!1)},setValue:function(e){this._super(e)},createTooltip:function(e,t,i){e.data("oldValue",t),e.val(""),e.data("ui-tooltip")&&e.tooltip("destroy"),e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",(function(e,t){t.tooltip.zIndex(r)})),e.tooltip("open");var a=setTimeout((function(){e.focus(),clearTimeout(a)}),100)},validateValue:function(e,t){return"string"!=typeof e||t<1||e.length<=t?e:e.substr(0,t)}}),$.Class.extend("bizagi.rendering.readonly",{},{initializeData:function(e){this._super(e)},renderControl:function(){var e=this.renderFactory.getTemplate("readonly-value"),t="execution"==this.getMode()?this.getFormattedValue(this.properties.value,this.properties.dataType):this.getDesignModeValue(this.properties.renderType);return $.fasttmpl(e,{id:this.properties.id,value:t})},renderReadOnly:function(){return this.renderControl()},setDisplayValue:function(e){},setValue:function(e,t){},getFormattedValue:function(e,t){return bizagi.util.isEmpty(e)?"":[1,2,3,4,7].includes(t)?e:[5,17].includes(t)?bizagi.util.formatBoolean(e):[8].includes(t)?bizagi.util.formatMonetaryValue(e):[6,10,11].includes(t)?bizagi.util.formatDecimalValue(e):[12,13].includes(t)?bizagi.util.formatDateValue(e):bizagi.util.sanitizeHTML(e)||""},getDesignModeValue:function(e){return"number"==e?"123":"string"==e?"abc":"date"==e?"1/1/1900":"boolean"==e?"false":"currency"==e?"$123":""},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.element.style("background",e,"important"):this.element.css("background",""),this)},getElementsToStylize:function(e){return $(".bz-input--readonly",e)}}),$.Class.extend("bizagi.rendering.button",{},{initializeData:function(e){this._super(e);var t=this.properties;t.caption=t.caption||"",t.displayType="value",t.required=!1,t.preventDefault=t.preventDefault||!1},renderControl:function(){var e=this.renderFactory.getTemplate("button");return $.fasttmpl(e,{caption:this.properties.caption,cssClass:this.properties.cssclass||"",editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},saveForm:function(){return this.getFormContainer().saveForm()},executeButton:function(){var e=this,t=e.properties,i=t.xpathContext||"";return t.submitOnChangexpathContextRow&&(i=i?i+"."+t.submitOnChangexpathContextRow:t.submitOnChangexpathContextRow),e.getFormContainer().startLoading(),e.dataService.multiaction().executeButton({idRender:t.id,xpath:t.xpath||"",xpathContext:i||"",idPageCache:t.idPageCache}).always((function(){return e.getFormContainer().endLoading(),arguments?arguments[0]:void 0}))},refreshForm:function(){this.getFormContainer().refreshForm(this.properties.id)},processButton:function(){this.properties.editable&&this.runButtonAction()},triggerRenderChange:function(e){var t=(e=e||{}).pressed||!1;this.triggerHandler("renderchange",{render:this,pressed:t})},runButtonAction:function(){var e=this;e.getFormContainer().clearValidationMessages(),e.saveForm().pipe((function(){return e.executeButton()})).done((function(t){var i=t&&t.type?t.type:"";if(null==t||1==t||"success"===t.result||"success"===t.type)return e.refreshForm();if(["validationMessages","alertMessages"].includes(i))try{"alertMessages"===i?bizagi.modalError&&bizagi.modalError.show(t.messages.join("\n\n"),"workportal-general-word-information",!1):e.getFormContainer().addValidationMessage(t.messages)}catch(e){}})).fail((function(t){try{var i=bizagi.util.getErrorFormatted(t),r=void 0===i?{message:bizagi.localization.getResource("workportal-general-error")}:i;e.getFormContainer().failHandler(r)}catch(e){}}))},processLayout:function(e,t){e&&(this.changeBackgroundColor(t.background),this._super(!e,t))},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.getElementsToStylize(this.getControl()).style("background",e,"important"):this.getElementsToStylize(this.getControl()).css("background",""),this)},getElementsToStylize:function(e){return $("input",e)},canBeSent:function(){return!1},configureSubmitOnChange:function(){var e=this,t=e.properties,i="";if(t.editable){t.dependencies=t.dependencies||"all";var r={conditions:{expressions:[{simple:{renderId:i=t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.id:t.id,operator:"changes",argumentType:"const"}}]},commands:[{xpath:i,command:"submit-value",argument:t.dependencies}],dependencies:[i],elseCommands:[]};$.when(e.ready()).done((function(){e.getFormContainer().addSubmitAction(i,r)}))}}}),$.Class.extend("bizagi.rendering.fileprint",{},{initializeData:function(e){this._super(e);var t=this.properties,i=$.trim(t.caption);t.caption=bizagi.util.isEmpty(i)?"render-fileprint-property-caption":i,t.filesCount=t.filesCount?t.filesCount:0,t.displayType="value",this.calculateInitialLayoutProperties(),t.required=!1},renderControl:function(){var e=this.renderFactory.getTemplate("fileprint");return $.fasttmpl(e,{caption:this.properties.caption})},renderReadOnly:function(){return this.renderControl()},downloadFile:function(){return this.dataService.getFilePrint({idRender:this.properties.id,xpathContext:this.properties.xpathContext||"",idPageCache:this.properties.idPageCache,contexttype:this.properties.contexttype,disposition:"download"}).then((function(e){return bizagi.util.handleJSONResponse(e)}))}}),$.Class.extend("bizagi.rendering.link",{},{initializeData:function(e){this._super(e);var t=this.properties;t.required=!1,t.displayType="value",this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.renderFactory.getTemplate("link");return $.fasttmpl(e,{displayName:this.properties.displayName,align:this.properties.valueAlign,editable:this.properties.editable})},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},isValid:function(e){},setDisplayValue:function(e){},canBeSent:function(){return!1}}),$.Class.extend("bizagi.rendering.checkList",{},{initializeData:function(e){this._super(e);var t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1,this.setValue(t.items),this.updateOriginalValue()},postRender:function(){var e=this.getControl();this._super(),this.checkListGroup=$(".ui-bizagi-render-checkList .ui-bizagi-render-checkList-item",e)},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate(this.getTemplateName()),i=this.properties.items||[];return $.fasttmpl(t,$.extend(this.getTemplateParams(),{id:e.id,xpath:e.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:e.idPageCache,items:i}))},getTemplateName:function(){return"checkList"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){return{vertical:!this.properties.horizontal}},cleanData:function(){},setValue:function(e){this.value=bizagi.clone(e)},getValue:function(e){return this.value||[]}}),$.Class.extend("bizagi.rendering.layoutRender",{},{renderElement:function(e){var t=this.properties,i=this.getFormContainer();this.renderingDeferred=new $.Deferred,e=e||"render-layout";var r=this.renderFactory.getTemplate(e),a=t.displayName;"string"==typeof a&&(a=bizagi.util.encodeString(a));var n=$.fasttmpl(r,{label:a,isExtendedText:"text"==t.type&&t.isExtended,orientation:t.orientation,uniqueId:t.uniqueId,id:t.id,isDesign:"design"===this.getMode(),messageValidation:t.messageValidation,printVersion:i.params.printversion,cssClass:t.cssclass||"",hide:t.hide}),o=this.internalRenderControl();return o||(o=""),"object"===_typeof(o)&&o.done?"resolved"===o.state()?(n=this.replaceControlHtml(n,this.resolveResult(o)),this.asyncRenderDeferred=null):(this.asyncRenderDeferred=o,n=this.replaceControlHtml(n,"")):n=this.replaceControlHtml(n,o),n},getControl:function(){return(!this.control||this.control instanceof jQuery&&0===this.control.length)&&(this.control=this.element),this.control&&0!=this.control.length?this.control:null},changeFontItalic:function(e){return bizagi.util.parseBoolean(e)?this.getControl().css("font-style","italic","!important"):this.getControl().css("font-style","normal","!important"),this},changeFontUnderline:function(e){var t=this.properties.valueFormat||{},i=bizagi.util.parseBoolean(t.strikethru)?"line-through ":"";return bizagi.util.parseBoolean(e)?this.getControl().css("text-decoration",i+"underline","!important"):this.getControl().find("*").each((function(e,t){$(t).css("text-decoration",i,"!important")})),this}}),$.Class.extend("bizagi.rendering.layoutImage",{},{init:function(e){this._super(e)},renderControl:function(){this.getMode(),this.properties.value;var e=this.renderFactory.getTemplate("layout-image");return $.fasttmpl(e,{useDefaultImage:!0})},getImage64:function(){var e={xpath:this.properties.xpath,entity:this.value.guid,surrogateKey:this.value.surrogateKey,width:96,height:96};return this.dataService.getEntityImage64(e)},getImageUri:function(){var e={entity:this.value.guid,surrogateKey:this.value.surrogateKey,xpath:this.properties.xpath,width:96,height:96,hash:this.value.value};return this.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(e)}}),$.Class.extend("bizagi.rendering.layoutLink",{},{init:function(e){this._super(e)},renderControl:function(){var e=this.renderFactory.getTemplate("layout-link");return $.fasttmpl(e,{displayName:this.properties.displayName})}}),$.Class.extend("bizagi.rendering.layoutLabel",{},{init:function(e){this._super(e),this.properties.required=!1,this.properties.displayType="label",this.properties.labelAlign=this.originalProperties.labelAlign||"left",this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.renderFactory.getTemplate("layout-label"),t=this.properties.displayName||this.properties.value||"";return $.fasttmpl(e,{value:t})}}),$.Class.extend("bizagi.rendering.layoutText",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);this.properties},renderControl:function(){var e=this.renderFactory.getTemplate("layout-text");return $.fasttmpl(e,{value:this.properties.value,editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()}}),$.Class.extend("bizagi.rendering.layoutUpload",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties;i.editable=!0,i.allowDelete=!0,i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",i.allowSendInMail=i.allowSendInMail||!1},getValueFilesByData:function(e){var t,i,r=$.Deferred();t=e.value.value?e.value.value:e.value;try{this.isContextContainerWidgetRender()?(i=JSON.parse('{ "files": '+t+"}"),r.resolve(e,i)):$.when(this.getDataFilesWithoutScope()).done((function(t){i=JSON.parse('{ "files": '+t+"}"),r.resolve(e,i)}))}catch(t){i=JSON.parse('{ "files": []}'),r.resolve(e,i),console.warn("Exception converting data files. Error: ",t)}return r.promise()},isContextContainerWidgetRender:function(){var e=this.getFormContainer();return e.params.paramsRender&&e.params.paramsRender.idRender},getDataFilesWithoutScope:function(){var e={xpath:this.properties.xpath,entity:this.value.guid,surrogateKey:this.value.surrogateKey};return this.dataService.getFilesDataForLayoutUploadControl(e)},getValue:function(){return this.files},getUploadXpath:function(){return this.properties.xpath}}),$.Class.extend("bizagi.rendering.layoutBoolean",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e),this.properties.editable=!1},renderControl:function(){var e=this.renderFactory.getTemplate("layout-boolean");return $.fasttmpl(e,{value:this.properties.value})},renderReadOnly:function(){return this.renderControl()},setValue:function(e,t){null===e||""===e?this.properties.value="":"true"!==e.toString().toLowerCase()&&"false"!==e.toString().toLowerCase()||(this.properties.value=bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):this.getResource("render-boolean-no")),this._super(this.properties.value,t)}}),$.Class.extend("bizagi.rendering.layoutDateTime",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("dateFormat"),r=this.getResource("timeFormat");if(t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||i,t.timeFormat=t.timeFormat||r,t.fullFormat=t.dateFormat,t.showTime)-1===t.fullFormat.search(/[h|H]+/gi)&&(t.fullFormat=t.fullFormat+" "+t.timeFormat);else{var a=t.fullFormat.search(/[h|H]+/gi);-1!==a&&(t.fullFormat=t.fullFormat.substring(0,a-1))}if(t.value){var n=bizagi.util.dateFormatter.getDateFromInvariant(t.value,t.showTime);if(0!=n){var o=bizagi.localization.getResource("datePickerRegional");this.value=t.value,t.displayValue=bizagi.util.dateFormatter.formatDate(n,t.fullFormat,o)}else this.value=null}else this.value=null,t.value="",t.displayValue=""},renderControl:function(){var e=this.renderFactory.getTemplate("layout-date-time"),t=null===this.properties.value||""===this.properties.value?"":this.properties.value;return $.fasttmpl(e,{value:t})},setDisplayValue:function(e){var t,i=this.properties,r=this.getDateControl();if(this.i18n=bizagi.localization.getResource("datePickerRegional"),e.length=="MM/dd/yyyy H:mm:ss".length||e.length=="MM/dd/yyyy H:mm:ss".length+1?t=bizagi.util.dateFormatter.getDateFromInvariant(e,!0):!(t=bizagi.util.dateFormatter.getDateFromInvariant(e))||isNaN(Date.parse(t))||$.isNumeric(t)||t.setHours(0,0,0,0),e&&!isNaN(Date.parse(e))){var a=bizagi.util.dateFormatter.formatDate(t,i.fullFormat,this.i18n);r.text(a)}},getDateControl:function(){return this.dateControl=$(".ui-bizagi-render-date-time",this.getControl()),this.dateControl}}),$.Class.extend("bizagi.rendering.layoutNumber",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.getDefaultGroupDigits(t.dataType),t.colorize=t.colorizeOnNegative||!1},renderControl:function(){var e=this.renderFactory.getTemplate("layout-number");return $.fasttmpl(e,{value:this.properties.value})},renderReadOnly:function(){return this.renderControl()},getDisplayValue:function(e){var t=this.properties,i=(this.getControl(),$("<label/>").html(e));return e.toString().match(/[\u20AC \u0024\u00A3]/)||i.formatCurrency({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize}),i.text()},getDefaultAllowDecimals:function(e){if(e){if(1==e||2==e||3==e||4==e||7==e)return!1;if(6==e||8==e||10==e||11==e)return!0}return!1},getDefaultGroupDigits:function(e){if(e){if(1==e||2==e||3==e||4==e||7==e)return!1;if(6==e||8==e||10==e||11==e)return!0}return!1}}),$.Class.extend("bizagi.rendering.layoutMoney",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol?t.symbol=t.currencySymbol?t.currencySymbol:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol:t.symbol="",t.groupDigits=!0}}),$.Class.extend("bizagi.rendering.layoutPlaceholder",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e);this.properties},renderControl:function(){var e=this.renderFactory.getTemplate("layout-placeholder"),t=this.properties.value||this.properties.displayName||"";return $.fasttmpl(e,{value:t})}}),$.Class.extend("bizagi.rendering.geolocation",{},{init:function(e){this._super(e),this.geolocation=window.navigator.geolocation;var t=this.properties;t.allowUpdate=!0===bizagi.util.parseBoolean(t.allowUpdate)},renderControl:function(){var e=this.renderFactory.getTemplate("geolocation");return $.fasttmpl(e,this.properties)},isValid:function(e){return this._super(e)},setDisplayValue:function(e){this.setValue(e,!1)},configureHandlers:function(){},getCurrentPosition:function(e,t){var i=this;if(void 0!==i.geolocation){return i.geolocation.getCurrentPosition((function(t){e&&e(t)}),(function(e){var r=i.getErrorMessage(e);t&&t(r)}))}t&&t(bizagi.localization.getResource("render-control-unsuported-by-browser").replace("{0}",i.properties.type))},getErrorMessage:function(e){var t="";switch(e.code){case e.PERMISSION_DENIED:case 1:t=bizagi.localization.getResource("render-geolocation-permission-denied");break;case e.POSITION_UNAVAILABLE:case 2:t=bizagi.localization.getResource("render-geolocation-position-unavailable");break;case e.TIMEOUT:case 3:t=bizagi.localization.getResource("render-geolocation-timeout");break;default:t="WD: "+bizagi.localization.getResource("render-geolocation-permission-denied")}return t},performPrecision:function(e){var t=e.split(" ")||"";if(!t)return e;try{var i=parseFloat(t[0].trim()),r=parseFloat(t[1].trim());return i.toPrecision(10)+" "+r.toPrecision(10)}catch(t){return e}}}),$.Class.extend("bizagi.rendering.association",{},{initializeData:function(e){this._super(e);var t=this.properties;t.property="flipped",t.idRender=this.properties.id,t.allowFlip=void 0===t.allowFlip||bizagi.util.parseBoolean(t.allowFlip),t.flipped=void 0!==t.flipped&&bizagi.util.parseBoolean(t.flipped),t.flipstate=t.flipped,t.leftData=t.leftData||[],t.rightData=t.rightData||[],t.value&&this.processPropertyValue()},renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done((function(r){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(r)||!1;var a=$.fasttmpl(t,e.properties,{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(a)})),i.promise()},getFlipAssociation:function(){return"execution"==this.getMode()&&this.dataService.getFlipAssociation(this.properties)},getDisplayValue:function(){return this.getValue()},getTemplateName:function(){return"association"},getColumnData:function(){var e=this.data,t=[],i=e.flipped?e.rightData:e.leftData;return $.each(i,(function(e,i){t.push({id:i.id,value:i.value})})),t},getRightAssociation:function(e){var t=this.data,i=[],r=function(e,i){var r=!1;return $.each(t.formatJson.value,(function(t,a){!r&&a.id==e&&a.value.indexOf(i)>=0&&(r=!0)})),r};return t.flipped?$.each(t.leftData,(function(t,a){i.push({id:a.id,name:a.value,checked:r(a.id,e)})})):$.each(t.rightData,(function(t,a){i.push({id:a.id,name:a.value,checked:r(e,a.id)})})),i},removeElement:function(e,t){var i=this;$.each(i.properties.formatJson.value,(function(r,a){i.properties.flipped?a.id==t&&$.each(i.properties.formatJson.value[r].value,(function(t,a){e==a&&i.properties.formatJson.value[r].value.splice(t,1)})):a.id==e&&$.each(i.properties.formatJson.value[r].value,(function(e,a){t==a&&i.properties.formatJson.value[r].value.splice(e,1)}))})),i.setValue(JSON.encode(i.properties.formatJson))},addElement:function(e,t){var i=this;$.each(i.properties.formatJson.value,(function(r,a){i.properties.flipped?a.id==t&&i.properties.formatJson.value[r].value.push(e):a.id==e&&i.properties.formatJson.value[r].value.push(t)})),i.setValue(JSON.encode(i.properties.formatJson))},makeJsonBase:function(){this.properties.formatJson=this.properties.formatJson||{leftXpath:this.properties.leftXpath,rightXpath:this.properties.rightXpath,leftFactName:this.properties.leftFactName,rightFactName:this.properties.rightFactName,value:this.properties.value}},hasValue:function(){if(this.properties.formatJson)var e=this.properties.formatJson.value;else e=this.properties.value;for(var t=0,i=e.length;t<i;t++){var r=e[t];if(r&&r.value.length>0)return!0}return!1},processPropertyValue:function(){for(var e=this.properties,t=e.value,i=[],r=0,a=t.length;r<a;r++){var n=t[r];i.push({id:n[0],value:n[1]})}e.value=i}}),$.Class.extend("bizagi.rendering.upload",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer(),i=this.properties,r=Number(i.maxSize)||0,a="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):4091904;if(i.maxSize=r||a,i.maxfiles=Number(i.maxfiles)||999,i.validExtensions=i.validExtensions||"",i.validExtensions.length>0&&i.validExtensions.indexOf(".")<0){for(var n=i.validExtensions.replace(/\ /gi,"").split(";"),o=[],s=0;s<n.length;s++)if(n[s].length>0)o.push("*."+n[s]);else{n.indexOf(n[s]);n.splice(s,1)}i.validExtensions=o.join(";")}i.addUrl=i.addUrl||this.dataService.getUploadAddUrl(),i.deleteUrl=i.deleteUrl||void 0,i.editable=bizagi.util.parseBoolean(i.editable)||!1,i.allowDelete=!(null===bizagi.util.parseBoolean(i.allowDelete)||!i.editable)&&bizagi.util.parseBoolean(i.allowDelete),i.contexttype=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:"",i.allowSendInMail=i.allowSendInMail||!1,this.files=i.value||[],this.filesCount=this.files.length},renderControl:function(){for(var e=this.properties,t=this.renderFactory.getTemplate("upload"),i=$.fasttmpl(t,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),editable:e.editable,haveFiles:0!==this.filesCount,noFiles:0===this.filesCount,allowSendInMail:e.allowSendInMail}),r="",a=0;a<this.filesCount;a++){var n={id:this.files[a][0],fileName:this.files[a][1]};r+=this.renderUploadItem(n)}return i=this.replaceFilesHtml(i,r)},renderReadOnly:function(){return this.renderControl()},renderUploadItem:function(e){var t=this.getMode(),i=this.getTemplateItemName(),r=this.renderFactory.getTemplate(i),a=this.getFormContainer(),n=a.params&&a.params.printversion,o=this.isExecutionMode()?this.buildItemUrl(e):"";return $.fasttmpl(r,{id:e.id,mode:t,url:o,allowDelete:this.properties.allowDelete,filename:bizagi.util.decodeURI(e.fileName),editable:this.properties.editable,printVersion:n||!1})},buildItemUrl:function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getUploadXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},deleteUploadItem:function(e,t){var i=this,r=i.properties,a=i.getUploadXpath()+(bizagi.util.isNumeric(t)?"[id="+t+"]":"[id='"+t+"']");return i.dataService.deleteUploadFile({url:r.deleteUrl,idRender:r.id,xpath:a,xpathContext:r.xpathContext,idPageCache:r.idPageCache,contexttype:r.contexttype}).pipe((function(){i.filesCount=i.filesCount-1,i.files=$.grep(i.files,(function(e){return e[0]!=t}))}))},canBeSent:function(){return!1},setValue:function(e,t){this.files=e||[],this.filesCount=this.files.length,this._super(e,t)},getValue:function(){return this.files},isValid:function(e){var t,i=this.properties,r=!0;if(this.setValidationMessage(""),i.required&&i.editable){var a=this.grid&&this.grid.isFromCreatedRow.apply(this);if(this.filesCount<=0&&!a)(!this.grid||this.grid.properties.inlineEdit)&&(t=this.getResource("render-required-upload").replaceAll("#label#",i.displayName),e.push({xpath:i.xpath,message:t}),r=!1)}return r},buildAddParams:function(){var e=this.properties,t=this.getFormContainer(),i={},r=this.Class.BA_CONTEXT_PARAMETER_PREFIX;i[r+"xpath"]=this.getUploadXpath(),i[r+"idRender"]=e.id,i[r+"xpathContext"]=e.xpathContext,i[r+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=t.properties.sessionId,i[r+"contexttype"]=e.contexttype;try{"undefined"!=typeof BIZAGI_SESSION_NAME?i[BIZAGI_SESSION_NAME]=t.properties.sessionId:i.JSESSIONID=t.properties.sessionId}catch(e){i.JSESSIONID=t.properties.sessionId}return i},getUploadXpath:function(){return this.properties.xpath},getUploadXpathContext:function(){return this.getXpathContext()||this.properties.xpathContext},checkRequired:function(e){var t=this.properties;if(bizagi.util.parseBoolean(t.required))if(this.grid&&!0===this.grid.properties.inlineAdd){if(!this.hasValue()&&!this.getControl().parents("tr").data("new-row"))return this.setRenderRequired(e,t),!1}else if(!this.hasValue())return this.setRenderRequired(e,t),!1;return!0},setRenderRequired:function(e,t){var i=this.getResource("render-required-text").replaceAll("#label#",t.displayName);e.push({xpath:t.xpath,message:i})},getTemplateItemName:function(){return"uploadItem"},formatValue:function(e){var t=function(e){return!(!e.uploadId||!e.fileName)},i=function(e){return!(!e[0]||!e[1])};return(e||[]).reduce((function(e,r){var a=!1,n=bizagi.util.bzValidator(r).add(t).validate((function(t){(a=t.errors&&!t.errors.length)&&e.push([r.uploadId,r.fileName])}));return a||n.add(i,"The value is not in a valid format").validate((function(t){t.errors&&t.errors.length>0?console.warn(t.errors):e.push([r])})),e}),[])}}),$.Class.extend("bizagi.rendering.ecm",{},{initializeData:function(e){this._super(e);var t=this.properties;if(t.maxSize=Number(t.maxSize)||("undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):t.maxSize=Number(t.maxSize)||4091904),t.maxFiles=Number(t.maxfiles)||999,t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var i=t.validExtensions.split(";"),r=0;r<i.length;r++)i[r]="*."+i[r];t.validExtensions=i.join(";")}t.addUrl=this.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=uploadECMFile",t.editUrl=this.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=updateECMFileContent",t.deleteUrl=t.deleteUrl||void 0,t.allowDelete=null===bizagi.util.parseBoolean(t.allowDelete)||bizagi.util.parseBoolean(t.allowDelete),t.q_xpath=bizagi.util.encodeXpath(t.xpath),t.showMetadata=void 0===t.showMetadata||null===t.showMetadata||bizagi.util.parseBoolean(t.showMetadata);var a=this.getResource("dateFormat"),n=this.getResource("timeFormat");t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||a,t.timeFormat=t.timeFormat||n,t.fullFormat=t.dateFormat,this.files=t.value||[],this.filesCount=this.files.length,t.xpathContext=this.parent.properties.xpathContext||t.xpathContext||""},renderControl:function(e,t){var i=this,r=i.properties,a=i.renderFactory.getTemplate("ecm"),n=i.getMode(),o=new $.Deferred;r.value=t?[[t.idFileUpload,t.fileName]]:i.value;var s=$.fasttmpl(a,r,{getFileExtension:i.getFileExtension,isImage:i.isImage});if(null!=i.properties.value){var l=i.properties.value.length;0===l&&o.resolve(s),$.each(i.properties.value,(function(e,r){var a={};a.idFileUpload=r[0],a.fileName=r[1],a.idPageCache=i.properties.idPageCache,a.xpathContext=i.getXpathContext(),a.xPath=i.properties.xpath,a.editable=i.properties.editable,a.idAttrib=i.properties.idAttrib;var d=i.getFormContainer();d&&d.properties&&d.properties.sessionId&&(a.sessionId=d.properties.sessionId),"execution"===n&&$.when(i.renderFileLayout(a,t)).done((function(e){l--,bizagi.loader.productBuildToAbout&&0===bizagi.loader.productBuildToAbout.indexOf("10.4")&&(e=e.replaceAll("Handlers/MetadataFile","Handlers/Metadata")),s=i.replaceItemHtml(s,i.properties.id+"-"+a.idFileUpload,e),0===l&&o.resolve(s)}))}))}else o.resolve(s);return o.promise()},replaceItemHtml:function(e,t,i){return e.replace("{{"+t+"}}",i)},renderFileLayout:function(e,t){var i=this,r=i.getFormContainer(),a=i.renderFactory.getTemplate("ecm-metadata"),n=$.Deferred();return $.when(i.dataService.getECMMetadata(e),t?[t]:i.dataService.getFileProperties(e)).done((function(t,o){o[0].data=e,o[0].xpathContext=o[0].xpathContext||r.properties.xpathContext||"",o[0].xpath=i.properties.xpath,t[0].filename=e.fileName,t[0].url=i.buildItemUrl(o[0]),t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].ecm_isVisible=o[0].isVisible,t[0].ecm_allowUpdateMetadata=o[0].allowUpdateMetadata,t[0].ecm_allowDelete=o[0].allowDelete,t[0].ecm_allowUpdateContent=o[0].allowUpdateContent,t[0].ecm_allowView=o[0].allowView,t[0].ecm_allowCheckOut=o[0].allowCheckOut,t[0].ecm_allowCancelCheckOut=o[0].allowCancelCheckOut,t[0].ecm_allowEdit=e.editable&&o[0].allowEdit,t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].idFileUploads=o[0].idFileUpload,t[0].xpath=o[0].xpath,t[0].value=bizagi.util.parseBoolean(o[0].value),t[0].deviceType=bizagi.detectDevice();var s=$.fasttmpl(a,t[0]);n.resolve(s)})),n.promise()},isImage:function(e){var t=this.getFileExtension(e);return["JPG","JPEG","GIF","PNG","BMP"].indexOf(t.toUpperCase())>-1},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},renderReadOnly:function(){return this.renderControl()},canBeSent:function(){return!1},buildItemUrl:function(e){var t=bizagi.cookie("JSESSIONID");return e.data||(e.data={fileName:e.fileName,idAttrib:e.idAttrib}),this.dataService.getECMFileUrl({idFileUpload:e.idFileUpload,xPath:e.xpath||e.xPath,xpathContext:e.xpathContext,idAttrib:e.data.idAttrib,idPageCache:this.properties.idPageCache,fileName:e.data.fileName.replace(/ /g,"_"),p_sessionId:t,sessionId:e.data.sessionId||""})},buildAddParams:function(){var e=this.properties,t={};return t.xPath=e.xpath,t.idAttrib=e.idAttrib,t.xpathContext=e.xpathContext,t.metaValues=[],t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t},getFileExtension:function(e){return(e=e||"").split(".").pop()},setValue:function(e,t){var i=this.properties;this._super(e,t),this.files=i.value||[],this.filesCount=this.files.length?this.files.length:i.value},getXpathContext:function(){return this.properties.xpathContext||""},getUploadXpath:function(){return this.properties.xpath},deleteUploadItem:function(e,t){var i=this,r=i.properties,a={idFileUpload:t,xPath:r.xpath,idAttrib:r.idAttrib,idPageCache:r.idPageCache,xpathContext:i.getXpathContext()};return i.dataService.deleteECMFile(a).pipe((function(){i.filesCount=i.filesCount-1,i.files=$.grep(i.files,(function(e){return e[0]!=t}))}))},lockUploadItem:function(e){var t=this.properties,i={idFileUpload:e,xPath:t.xpath,idAttrib:t.idAttrib,idPageCache:t.idPageCache,xpathContext:this.getXpathContext()};return this.dataService.checkOutFile(i)},unlockUploadItem:function(e){var t=this.properties,i={idFileUpload:e,xPath:t.xpath,idAttrib:t.idAttrib,idPageCache:t.idPageCache,xpathContext:this.getXpathContext()};return this.dataService.cancelCheckOut(i)}}),$.Class.extend("bizagi.rendering.yesno",{},{initializeData:function(e){this._super(e);var t=this.properties;t.value=void 0!==t.value?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var e=this.renderFactory.getTemplate("yesno"),t=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(e,{id:t,editable:this.properties.editable})},getDisplayValue:function(){var e=this.getValue();return!0===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-no"):""},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmptyValue(e)&&null!==bizagi.util.parseBoolean(e)}}),$.Class.extend("bizagi.rendering.letter",{},{initializeData:function(e){this._super(e),this.letterOpened=!1},renderControl:function(){var e=this.renderFactory.getTemplate("letter");return $.fasttmpl(e)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("letter.readonly");return $.fasttmpl(e)},getLetterContent:function(){return this.letterOpened=!0,this.dataService.getLetterContent({url:this.properties.getUrl,idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache})},saveLetterContent:function(e){return this.dataService.saveLetterContent({url:this.properties.saveUrl,idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache,content:e})},getCanGenerateLetter:function(){return this.dataService.getCanGenerateLetter({idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache})},saveForm:function(){return this.getFormContainer().saveForm()},isValid:function(e){var t,i=this.properties;return 0==bizagi.util.parseBoolean(i.visible)||(0==bizagi.util.parseBoolean(i.editable)||(this.setValidationMessage(""),!i.required||0!=this.letterOpened||(t=this.getResource("render-letter-required-text").replaceAll("#label#",i.displayName),e.push({xpath:i.xpath,message:t}),!1)))},getXpath:function(){return this.properties.xpath},getContextXpath:function(){return this.properties.xpathContext}}),$.Class.extend("bizagi.rendering.formLink",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayType="value",t.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("formLink");return $.fasttmpl(t,{id:e.id,align:e.valueAlign,displayName:e.displayName,value:e.value,editable:e.editable,likeButton:bizagi.util.parseBoolean(e.likeButton)||!1})},renderReadOnly:function(){return this.renderControl()},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},submitEditRequest:function(){var e=this.properties;return e.editable||e.value?this.dataService.editLinkForm({url:e.editUrl,idRender:e.id,xpath:this.getFormLinkXpath(),xpathContext:e.xpathContext,idPageCache:e.idPageCache}):null},submitSaveRequest:function(e){var t=this,i=t.properties;if(!i.editable&&!i.value)return null;var r=t.getFormLinkXpath(),a=r;return void 0!==i.xpathContext&&""!==i.xpathContext&&(a=r?i.xpathContext+"."+r:i.xpathContext),t.dataService.saveLinkForm({url:i.saveUrl,idRender:i.id,xpathContext:a,submitData:e}).done((function(e){var i=!0;e&&"validationMessages"===e.type&&(i=!1),i&&t.submitOnChange({})}))},saveFormLinkData:function(e){var t=this.properties,i=this.getFormLinkXpath(),r=i;void 0!==t.xpathContext&&""!==t.xpathContext&&(r=i?t.xpathContext+"."+i:t.xpathContext);var a=$.extend({},e);return delete a.idPageCache,$.when(bizagi.util.isEmpty(a)?void 0:this.dataService.multiaction().submitData({action:"SAVE",data:a,idPageCache:e.idPageCache,xpathContext:r}))},submitRollbackRequest:function(e){var t=this,i=t.properties;return $.when(i.editable||i.value?t.dataService.rollbackLinkForm({url:i.rollbackUrl,idRender:i.id,xpath:t.getFormLinkXpath(),xpathContext:i.xpathContext,idPageCache:e?e.idPageCache:i.idPageCache}):null)},submitCommitRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.commitLinkForm({url:t.commitUrl,idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},submitCheckpointRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.sendCheckpoint({url:t.checkpointUrl,idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},submitDataRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.submitData({url:t.checkpointUrl,action:"SUBMITDATA",idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},isValid:function(e){},getFormLinkXpath:function(){return this.properties.xpath},canBeSent:function(){return!1},setDisplayValue:function(e){},cleanData:function(){}}),$.Class.extend("bizagi.rendering.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{init:function(e){this._super(e),this.dependants=[],this.isDependant=!1},initializeData:function(e){this._super(e);var t=this.properties;t.hasLocalData=!!bizagi.util.isEmpty(t.parentCombo)&&t.hasLocalData,t.value&&void 0===t.value.id&&(t.value=null),this.value=t.value,t.hasLocalData&&(t.data=this.complementData(t.data))},renderControl:function(){var e=this.getMode(),t=this.parentCombo=this.getParentCombo();if(null!=t){var i=bizagi.util.normalizeType(t.properties.type);/^cascadingcombo$/i.test(i)&&(this.isDependant=!0)}this.initializingCascadingCombo=!0;var r=this._super();return"execution"!==e&&(this.initializingCascadingCombo=!1),r},configureHandlers:function(){this.initializingCascadingCombo=!1,this.isDependant&&this.parentCombo.bindDependantCombo(this)},configureHandlersReadOnly:function(){this.initializingCascadingCombo=!1,this.isDependant&&this.parentCombo.bindDependantCombo(this)},refresh:function(e,t){var i=this;$.when(i.isRendered()).done((function(){var r=i.getControl(),a=i.getMode();r.empty(),$.when(i.renderCombo(e)).then((function(e){r.html(e),i.postRender(),"execution"==a&&i.configureHandlers(),void 0!==i.getValue()&&i.setDisplayValue(i.getValue()),i.deferredVisible&&i.deferredVisible.resolve(),i.trigger("select",[i.value,t])}))}))},getData:function(e){if("execution"!=this.getMode())return this.getDummyData();if(this.isDependant){this.parentCombo&&e&&(this.properties.remoteDataLoaded=!1);var t=this.parentCombo.selectedValue?this.parentCombo.selectedValue.id:"";return""!=t?((e=e||{})[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]||(e[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t),this._super(e)):[]}return this._super(e)},bindDependantCombo:function(e){var t=this,i=bizagi.util.normalizeType(e.properties.type);/^cascadingcombo$/i.test(i)&&(t.dependants.push(e),e.onChangeFunction=function(i,r,a){t.refreshDependantCombo(e,r.id,t.focusDependant,a),a||e.cleanInput()},t.isEventBinded("select")||t.bind("select",e.onChangeFunction),bizagi.util.isEmpty(t.getValue())||t.properties.hasLocalData&&t.refreshDependantCombo(e,t.getValue().id))},isEventBinded:function(e){return void 0!==$._data(this.observableElement.get(0),"events")&&void 0!==$._data(this.observableElement.get(0),"events")[e]},unbindDependantCombo:function(e){this.unbind("select",e.onChangeFunction)},refreshDependantCombo:function(e,t,i,r){var a={};a[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t,e.deferredVisible=$.Deferred(),r||e.setValue("",!1),e.refresh(a,r),i&&$.when(e.deferredVisible.promise()).done((function(){e.inputCombo.trigger("click")}))},emptyControlByChangeEditability:function(){this.getControl().empty()},cleanInput:function(){this.triggerHandler("select",{id:0})},getParentCombo:function(){var e=this.properties;if(void 0===e.parentCombo)return null;for(var t=this.getFormContainer(),i=bizagi.util.normalizeType(this.properties.type),r=/^cascadingcombo$/i.test(i)?t.getRenderByType(e.type):[],a=0,n=0,o=[],s=null;a<r.length;a++)e.parentCombo===r[a].properties.id&&o.push({control:r[a],index:a});if(o.length>1){for(var l,d;n<o.length;n++)if(l=(d=o[n].control.properties.xpath.split(".")).length,d.slice(0,l-1).join(".")===e.xpath){s=r[o[n].index];break}}else s=t.getRenderById(e.parentCombo);return s},canBeSent:function(){return this._super()&&bizagi.util.isMapEmpty(this.dependants)},showCurrentData:function(){return"execution"!=this.getMode()},configureSubmitOnChange:function(){this.configured||(this._super(),this.configured=!0)},internalSubmitOnChange:function(e,t){var i=new $.Deferred;return this.isDependant&&this.canBeSent()&&void 0!==this.itemSelected?this._super(e,t):i.resolve()},internalSetInitialValue:function(){this._super(),this.value&&0==this.isDependant&&(this.internalSetInitialValueFlag=!0,this.trigger("select",[this.value,!0])),this.internalSetInitialValueFlag=!1}}),$.Class.extend("bizagi.rendering.list",{},{initializeData:function(e){this._super(e);var t=this.properties;t.listSize=t.listSize||0},getTemplateName:function(){return"list"},showCurrentData:function(){return!1}}),$.Class.extend("bizagi.rendering.multiSelect",{},{initializeData:function(e){this._super(e),Array.isArray(this.value)&&(this.value=this.properties.value=JSON.encode({value:this.value}),this.properties.originalValue=this.properties.previousValue=this.value);var t=this.properties;t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),t.enableTyping=null===bizagi.util.parseBoolean(t.enableTyping)||bizagi.util.parseBoolean(t.enableTyping),t.maxRecords=Number(t.maxRecords)||20},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("list-multiselect");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,align:e.valueAlign},{formatItem:this.formatItem})},renderReadOnly:function(){var e=this.properties,t=this.renderFactory.getTemplate("list-multiselect");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,align:e.valueAlign},{formatItem:this.formatItem})},getData:function(){var e=this,t=new $.Deferred,i=this.properties;return e.dataService.multiaction().getData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contexttype||null,idPageCache:i.idPageCache}).done((function(r){i.data=e.normalizeData(r),t.resolve(i.data)})).fail((function(i){var r=!0,a=e.getFormContainer();bizagi.util.isNativeMobileDevice()&&void 0!==a&&(r=a.allowOnlineActions()),"not-processed"===i.type&&r||t.reject(i)})),t.promise()},setValue:function(e,t){t=void 0===t||t,Array.isArray(e)&&(e=JSON.encode({value:e})),this._super(e,t)},setDisplayValue:function(e){this.setValue(e,!1)},canBeSent:function(){return!0},getValue:function(){return this.value||[]},getDataValue:function(){try{return JSON.parse(this.value).value||[]}catch(e){return[]}},hasValue:function(){var e=this.getDataValue();return e&&e.length>0},getElementsToStylize:function(e){return $(".bz-multiselect .bz-multiselect__tag:not(.bz-multiselect__plus)",e)},addElement:function(e){var t=this.getDataValue();t.push(e),this.setValue(t)},removeElement:function(e){var t=e.id,i=this.getDataValue().filter((function(e){return e.id!==t}));this.setValue(i)},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.submitOnChange(e)},markAsChecked:function(e){var t=this;return t.selected.some((function(i,r){var a=i.id===e;return a&&t.selected.splice(r,1),a}))},isChecked:function(e,t){return e.some((function(e){return e.id==t}))},canAddMoreItems:function(e){var t=this;return parseInt(e.css("width"))>e.children().toArray().reduce((function(e,i){return e+=t.getElementWidth(i)}),0)+t.Class.MORE_OPTION_WIDTH},getElementWidth:function(e){var t=window.getComputedStyle(e);return $(e).outerWidth()+["padding-left","padding-right","margin-left","margin-right"].reduce((function(e,i){return e+=parseInt(t[i])}),0)},filterList:function(e,t){t.filter((function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()})).show()},addSelectedElements:function(){},findItemById:function(e){return(this.properties.data||[]).find((function(t){return t.id==e}))},formatItem:function(e){return bizagi.util.formatItem(e)},normalizeData:function(e){return(e||[]).forEach((function(e){e.value=void 0!==e.value&&null!==e.value?e.value:""})),e}}),$.Class.extend("bizagi.rendering.searchList",{},{initializeData:function(e){this._super(e);var t=this.properties;t.maxRecords=Number(t.maxRecords)||20,t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),this.setValue(t.value)},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("searchList");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,value:e.value,allowTyping:e.allowTyping,items:e.value,hasSearchForm:!!e.searchForms,editable:e.editable},{formatItem:this.formatItem})},renderReadOnly:function(){return this.renderControl()},setValue:function(e){this.value=JSON.encode({value:e}),this.triggerRenderChange()},addElement:function(e){var t=JSON.parse(this.value);t.value.push(e),this.setValue(t.value)},removeElement:function(e){var t=JSON.parse(this.value),i=[];$.each(t.value,(function(t,r){r.id!=e.id&&i.push({id:r.id,value:r.value})})),this.setValue(i)},removeLastElement:function(){var e=JSON.parse(this.value);e.value.length>0&&(e.value.pop(),this.setValue(e.value))},getData:function(e){var t=this,i=t.properties,r=new $.Deferred;return t.dataService.getSearchData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.term,extra:e}).done((function(e){i.data=e,r.resolve(i.data)})).fail((function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)})),r.promise()},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.submitOnChange(e)},canBeSent:function(){return!0},hasValue:function(){return this.getListItems().length>0},getListItems:function(){var e=this.getValue();return("string"==typeof e?JSON.parse(e).value:e.value)||[]},formatItem:function(e){return bizagi.util.formatItem(e)}}),$.Class.extend("bizagi.rendering.money",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");if(t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol){var r="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol;t.symbol=t.currencySymbol?t.currencySymbol:r}else t.symbol="";t.groupDigits=!0}}),$.Class.extend("bizagi.rendering.radio",{},{initializeData:function(e){this._super(e);var t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1,t.unique=bizagi.util.randomNumber(1e3,1e6)},getTemplateName:function(){return"radio"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){var e=this.properties;return{vertical:!e.horizontal,horizontal:e.horizontal}},cleanData:function(){var e={id:"",label:""};this.element.find(".ui-radio-state-checked").removeClass("ui-radio-state-checked"),this.setDisplayValue(e),this.setValue(e,!1),this.clearDisplayValue()},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue;return t&&void 0!==t.length&&(t=t[0]),i&&void 0!==i.length&&(i=i[0]),r&&void 0!==r.length&&(r=r[0]),t=t&&void 0!==t.id?t.id:t,i=i&&void 0!==i.id?i.id:i,void 0!==(r=r&&void 0!==r.id?r.id:r)?(r!=t||t!=i)&&((null!==t&&""!==t||null!==i&&""!==i)&&i!=t):(null!==t&&""!==t||null!==i&&""!==i)&&i!=t},emptyControlByAsyncRenderDeferred:function(){this.getControl().empty()}}),$.Class.extend("bizagi.rendering.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{BASE_IMAGE:"data:image/png;base64,",initializeData:function(e){this._super(e);var t=this.properties,i=4091904;if(t.maxSize?i=Number(t.maxSize):"undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize&&(i=Number(BIZAGI_SETTINGS.UploadMaxFileSize)),t.maxSize=i,t.editable=!0===bizagi.util.parseBoolean(t.editable),t.validExtensions=t.validExtensions||"",t.isChanged=!1,t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var r=t.validExtensions.replace(/\ /gi,"").split(";"),a=0;a<r.length;a++)if(0!=r[a].length)r[a]="*."+r[a].replaceAll(" ","");else{r.indexOf(r[a]);r.splice(a,1)}t.validExtensions=r.join(";")}t.addUrl=t.addUrl||this.dataService.getUploadAddFileUrl(t.isUserPreference),t.allowDelete=null!==bizagi.util.parseBoolean(t.allowDelete),this.formCompatibilityVersion=this.getFormContainer().compatibilityVersion,this.initializeWidthAndHeight()},initializeWidthAndHeight:function(){var e=this.properties;e.isAutoWidth=!1,e.isAutoHeight=!1,-1===e.width?(e.width="100%",e.isAutoWidth=!0):e.width=e.width+"px",-1===e.height?(e.height="auto",e.isAutoHeight=!0):e.height=e.height+"px"},setData:function(e){var t=this.getData();if(bizagi.util.isEmpty(e)?this.properties.binaryValue=null:this.properties.binaryValue=e instanceof Blob?e:bizagi.util.b64toBlob(e,"image/png"),t!=this.properties.binaryValue){if(this.properties.required&&this.isExecutionMode()){var i=!this.checkRequired([]);this.changeRequiredLabel(i)}this.properties.isChanged&&(this.triggerRenderChange(),this.triggerRenderValidate())}},getData:function(){return this.properties.binaryValue||[]},renderControl:function(){var e=this,t=e.renderFactory.getTemplate("image");return e.buildItemUrl().then((function(i){if(!e.isDisposed())return e.properties.url=""!==i?i:"",bizagi.util.isEmpty(e.properties.url)?e.properties.value=[]:e.formCompatibilityVersion<2&&(e.properties.value=[[0,"uploaded"]]),e.setValue(e.properties.value),$.fasttmpl(t,{url:e.properties.url})}))},renderReadOnly:function(){var e=this.renderFactory.getTemplate("image-readonly");return $.fasttmpl(e)},getTemplateItem:function(){return this.renderFactory.getTemplate("image-item")},renderUploadItem:function(){var e=this,t=e.getMode(),i=e.getTemplateItem();return e.buildItemUrl().then((function(r){var a=r||"",n=$.fasttmpl(i,{url:a,allowDelete:e.properties.allowDelete,editable:e.properties.editable,mode:t});return e.properties.url=a,n}))},buildItemUrl:function(e){var t=this,i=t.getFormContainer(),r=t.properties,a=i.properties.compatibilityVersion>=2,n="";if(!this.isExecutionMode())return $.Deferred().resolve("").promise();var o={url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,contexttype:r.contexttype,property:e&&e.property?e.property:"fileContent",dataType:"text"};if(r.isUserPreference&&(t.currentUser=bizagi.currentUser.idUser,o.xpathContext="@Context.Users[id == "+t.currentUser+"]",o.contexttype="entity",o.surrogatekey=t.currentUser),a){if(bizagi.util.isEmpty(t.properties.value)&&!t.hasValue())return $.Deferred().resolve("").promise();if(!t.properties.forceBase64)return o.sessionId=i.properties.sessionId,o.property="fileBinaryContent",t.dataService.downloadFile(o).then((function(e){return t.setData(e),null==e||window.Blob&&e instanceof Blob&&0===e.size?null:bizagi.util.blobTob64(e,!1)})).then((function(e){return bizagi.util.getDataUrl(e,r.url)}))}return t.dataService.multiaction().getPropertyData(o,"text").then((function(e){return'"'===e.charAt(0)&&(e=e.slice(1,-1)),""!==e&&(n=t.BASE_IMAGE+e),t.setData(bizagi.util.b64toBlob(e)),n}))},buildItemUrlOffline:function(){var e=this,t=e.properties,i=e.getFormParams(),r=!t.isChanged,a=e.buildOfflineImageId(),n={idCase:i.idCase,idWorkitem:i.idWorkitem,id:a,offlineType:i.offlineType,loadImageFromForm:r};return $.when(e.dataService.getOfflineImage(n,bizagi.util.db.AttachmentType.Blob)).then((function(t){return e.setData(t),null==t||window.Blob&&t instanceof Blob&&0===t.size?null:bizagi.util.blobTob64(t,!1)})).then((function(e){return bizagi.util.getDataUrl(e,t.url)}))},saveImageOffline:function(e){var t=this,i=t.buildOfflineImageId(),r=void 0!==t.fileProperties?t.fileProperties.name:e.name;return t.dataService.getFileService().resolveBlobFromPath(e,r).then((function(e){var r=t.getFormParams(),a={idCase:r.idCase,idWorkitem:r.idWorkitem,id:i,operationType:"edition",offlineType:r.offlineType};return t.dataService.saveOfflineImage(a,e)}))},buildFullItemUrl:function(){return this.buildItemUrl({property:"fileFullContent"})},canBeSent:function(){return this.properties.isChanged},getValue:function(){return this.properties.value||[]},isValid:function(e){if(!1===bizagi.util.parseBoolean(this.properties.visible))return!0;if(!1===bizagi.util.parseBoolean(this.properties.editable))return!0;if((this.setValidationMessage(""),this.properties.required)&&(!(this.grid&&this.grid.isFromCreatedRow.apply(this))&&!this.hasValue())){var t=this.getResource("render-required-text").replaceAll("#label#",this.properties.displayName);return e.push({xpath:this.properties.xpath,message:t}),!1}return!0},buildAddParams:function(){var e=this.properties,t=this.getFormContainer(),i={};i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=this.getUploadXpath(),i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.id,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,i[this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=t.properties.sessionId,i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="savefile",e.contexttype&&(i[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?i[BIZAGI_SESSION_NAME]=t.properties.sessionId:i.JSESSIONID=t.properties.sessionId}catch(e){i.JSESSIONID=t.properties.sessionId}return i},getUploadXpath:function(){return this.properties.xpath},emptyControlByAsyncRenderDeferred:function(){this.getControl().empty()},buildOfflineImageId:function(){var e=this.getFormContainer().properties.compatibilityVersion>=2;return this.dataService.fileService.buildOfflineImageId(this.properties.value,this.properties.xpathContext,this.properties.xpath,e)}}),$.Class.extend("bizagi.rendering.userfieldDefinition",{},{getFileDependencies:function(){return null},postRender:function(){var e=this;e._super();var t=$.Deferred(),i=e.getFileDependencies();return i&&i.length>0?bizagi.loader.loadFile(i).then((function(){e.internalRenderControl(),t.resolve()})):$.when(e.renderUserfieldControl()).done((function(){t.resolve()})),t.promise()},renderUserfieldControl:function(){var e=this,t=e.getControl(),i=e.properties,r=new $.Deferred;i.extendedData&&i.extendedData.length>0?e.extendedData=bizagi.services.ajax.parseJSON(i.extendedData):e.extendedData={};var a;return(a=e.getEditableControl())&&(e.input=t.html(a)),e.renderComplex(),r.resolve(),r.promise()},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.properties;i.extendedData&&i.extendedData.length>0?e.extendedData=bizagi.services.ajax.parseJSON(i.extendedData):e.extendedData={};var r=function(){try{var i=e.getReadonlyControl();i&&(e.input=t.html(i)),e.renderComplex()}catch(i){var r=e.properties.displayName||"Widget";t.html("<h6>"+r+"</h6>")}};e.ready?e.ready().done((function(){r()})):r()},getDisplayValue:function(){return this.getReadonlyValue()},setDisplayValue:function(e){this.setValue(e),this.setEditableValue(e)},getValue:function(){return this.getEditableValue()},getPropertyValue:function(e,t){var i=this,r=i.properties,a=new $.Deferred,n=i.getFormContainer();return n.useOrSetLoaderDeferred(),n.appendWaitForLoader({promise:a.promise()}),i.dataService.multiaction().getPropertyData({url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done((function(e){"error"==e.type?(i.getFormContainer().addErrorMessage(e.message),a.reject(e)):a.resolve(e)})).fail((function(e,t,i){a.reject(e,t,i)})),a.promise()},saveForm:function(){return this.getFormContainer().saveForm()},getRenderElements:function(e){var t=$(),i=this.getFormContainer().getRenders(e);return $.each(i,(function(e,i){t=t.add($(i.element))})),t},getServerResourceURL:function(e){var t="Rest/Userfields/{0}/resource/{1}/{2}";t=t.replace("{0}",this.properties.userfieldGuid),e=e.replace("\\","__").replace("/","__");var i=bizagi.util.detectDevice();return t=(t=t.replace("{1}",i)).replace("{2}",e)},getRenderValue:function(e){var t,i=this.getFormContainer().getRenders(e);return $.each(i,(function(e,i){t&&!i.properties.editable||(t=i)})),t?t.getValue():null},refreshForm:function(){var e=this.properties;this.getFormContainer().refreshForm(e.id)},showDialog:function(e,t){bizagi.util.mustImplement("Must implement the showDialog method")},showPopup:function(e,t){bizagi.util.mustImplement("Must implement the showPopup method")},updateOriginalValue:function(){this.properties.originalValue=this.value=this.properties.value}}),$.Class.extend("bizagi.rendering.basicUserField",{},{getEditableControl:function(){},renderComplex:function(){},getEditableValue:function(){return bizagi.rendering.render.prototype.getValue.apply(this,arguments)},setEditableValue:function(e){return bizagi.rendering.render.prototype.setValue.apply(this,arguments)},getReadonlyControl:function(){},getReadonlyValue:function(){return bizagi.rendering.render.prototype.getDisplayValue.apply(this,arguments)},dispose:function(){this._super()}}),$.Class.extend("bizagi.rendering.userfieldWrapper",{},{init:function(e){this._super(e),this.initialParams=e,this.userfieldGuid=this.properties.userfieldGuid,this.userfieldName=this.properties.control},startUserfieldLoading:function(){},endUserfieldLoading:function(){},internalPostRender:function(){var e=this;e.startUserfieldLoading(),$.when(e.getUserfieldControl()).done((function(t){return t.element=e.element,e.column&&(t.isColumn=!0,t.grid=e.grid,t.surrogateKey=e.surrogateKey,t.properties.xpathContext=e.getControlXpathContext(t),t.getControl=e.column.getControl),t.internalPostRender()})).always((function(){e.endUserfieldLoading()}))},getControlXpathContext:function(e){var t=e.properties;return e.isColumn?t.xpathContext.length>0?t.xpathContext+"."+e.grid.properties.xpath+"[id="+e.surrogateKey+"]":e.grid.properties.xpath+"[id="+e.surrogateKey+"]":t.xpathContext},getUserFieldInstance:function(e){console.log("not implemented")},replicateUserfieldMethods:function replicateUserfieldMethods(control){var self=this;for(var key in control.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"subscribe"!=key&&"unsubscribe"!=key&&"publish"!=key&&"render"!=key&&"triggerHandler"!=key&&"dispose"!=key&&(self[key]=eval("var tmp = function(){ if (this.userfieldInstance) return this.userfieldInstance."+key+".apply(this.userfieldInstance, arguments); return null;};tmp"));control.properties=self.properties,control.value=self.value},dispose:function(){var e=this,t=setTimeout((function(){e.userfieldInstance&&(e.userfieldInstance.unbind("renderchange"),e.userfieldInstance.dispose()),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()}}),bizagi.rendering.element.extend("bizagi.rendering.columns.column",{},{init:function(e){this._super(e),this.originalProperties=JSON.parse(JSON.encode(this.properties)),this.decoratedClass=e.decorated,this.data=e.data,e.singleInstance?(this.decorated=new this.decoratedClass({data:this.data,parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService}),this.decorated.getControl=this.getControl,e.decorated=this.decorated,this.decorated.properties.isColumn=!0):this.decorateRenders=[],this.grid=e.parent;var t=this.properties;t.columnVisible=null==bizagi.util.parseBoolean(t.columnVisible)||bizagi.util.parseBoolean(t.columnVisible),t.align=t.align||"center",t.textFormat=t.textFormat||{},t.submitOnChange=void 0!==t.submitOnChange&&bizagi.util.parseBoolean(t.submitOnChange),t.singleInstance=e.singleInstance,t.editable=void 0===t.editable||bizagi.util.parseBoolean(t.editable),t.visible=void 0===t.visible||bizagi.util.parseBoolean(t.visible),t.required=void 0!==t.required&&bizagi.util.parseBoolean(t.required),t.showColumn=void 0===t.showColumn||bizagi.util.parseBoolean(t.showColumn),t.isSortable=void 0===t.isSortable||bizagi.util.parseBoolean(t.isSortable);try{e.parent&&"boolean"==typeof e.parent.properties.editable&&!e.parent.properties.editable&&(t.editable=!1)}catch(e){}this.readonly=void 0!==t.readonly&&t.readonly,this.readonly&&(t.editable=required=!1)},isReadonly:function(){return!1},getControl:function(){return $(".ui-bizagi-render-control",this.element||this.observableElement)},getDecorated:function(e){if(this.properties.singleInstance)return this.decorated;var t=this.decorateRenders[e];if(null==t){"object"!=_typeof(this.decorateRenders)&&(this.decorateRenders=[]);var i=new this.decoratedClass({data:bizagi.clone(this.data),parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService});t=i,this.decorateRenders[e]=i,t.surrogateKey=e,this.applyOverrides(t);var r=bizagi.util.normalizeType(t.properties.type);"summary"!==e||/columnMoney/i.test(r)||/columnNumber/i.test(r)||(t.setDisplayValue=function(e){this.getControl().html(e)})}return t},ready:function(){return this.readyDeferred.promise()},initialize:function(){},canBeSent:function(e,t){var i=this.getDecorated(e);return t&&(i.properties.visible=t.visible,i.properties.editable=t.editable),i.canBeSent()||!this.properties.editable&&this.hasChanged()||!i.properties.editable&&this.hasChanged()},isValueValid:function(e,t,i,r){var a=this.getDecorated(e),n=[];return r.visible&&(this.setValue(e,t),a.properties=$.extend(a.properties,r),this.grid&&void 0===a.grid&&(a.grid=this.grid),a.isValid(n)),!(n.length>0)||($.each(n,(function(e,t){i.push(t.message)})),!1)},applyOverrides:function(e){},render:function(e,t){try{var i=this,r=i.properties,a=i.getDecorated(e);if(a.grid=i.grid,a.column=this,a.surrogateKey=e,i.setValue(e,t),i.overrideDecoratedRenderProperties(e),i.changed=!1,!r.editable&&"CALLER_RENDER_READ_ONLY_COLUMNSLINK"!==arguments[3])return i.renderReadOnly.apply(i,arguments);i.readyDeferred=new $.Deferred;var n=a.render("cell");return a.bind("renderchange",(function(){i.changed=!0})),i.bind("rendered",(function(){i.readyDeferred.resolve()})),n}catch(e){return console.log(e),""}},postRender:function(e,t){this.getDecorated(e).postRenderElement(t)},renderReadOnly:function(e,t){var i=this,r=i.getDecorated(e);r.grid=i.grid,r.column=this,r.surrogateKey=e,i.setValue(e,t),i.overrideDecoratedRenderProperties(e),r.properties.editable=!1,i.readyDeferred=new $.Deferred;var a=r.render("cell.readonly");return i.bind("rendered",(function(){i.readyDeferred.resolve()})),a},renderSummary:function(e,t){var i=this.renderFactory.getTemplate("cell.summary");return $.tmpl(i).html()},postRenderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties.editable;i.properties.editable=!1,this.properties.singleInstance&&(i.element=t),i.postRenderElement(t),i.properties.editable=r},postRenderSummary:function(){return!1},getCell:function(){return this.decorated.getDisplayValue()},setSurrogateKey:function(e){this.surrogateKey=e},setValue:function(e,t){var i=this.getDecorated(e);"undefined"!=i&&null!=i&&(i.properties.originalValue=t,i.properties.previousValue=t,"summary"==e||null!=t||void 0===this.properties.defaultvalue&&void 0===this.properties.defaultValue||null==i.grid||(t=this.setDefaultValue(e,i)),i.properties.value=t,i.setValue(t,!1))},setDefaultValue:function(e,t){var i=void 0;return null!==this.properties.defaultvalue&&void 0!==this.properties.defaultvalue?i=this.properties.defaultvalue:null!==this.properties.defaultValue&&void 0!==this.properties.defaultValue&&(i=this.properties.defaultValue),t.grid.changes[e]=t.grid.changes[e]||{},t.grid.changes[e][this.properties.xpath]=i,i},getValue:function(e){return this.getDecorated(e).getValue()},getCompositeValue:function(e){return this.getValue(e)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_COLUMN},hasChanged:function(){return this.changed},trigger:function(e,t){this.decorated&&this.decorated.trigger(e,t)},triggerHandler:function(e,t){this.decorated&&this.decorated.triggerHandler(e,t)},bind:function(e,t){this.decorated&&this.decorated.bind(e,t)},unbind:function(e,t){this.decorated&&this.decorated.unbind(e,t)},overrideDecoratedRenderProperties:function(e){var t=this.getDecorated(e);t.properties.editable=this.properties.editable,t.properties.visible=this.properties.visible,t.properties.required=this.properties.required},overrideProperties:function(e){this.properties.editable=e.editable||this.properties.editable,this.properties.visible=e.visible||this.properties.visible,this.properties.required=e.required||this.properties.required},getSortName:function(){var e=this.getAnyDecoratedInstance();return e&&e.getSortColumn?e.getSortColumn():this.properties.xpath},getAnyDecoratedInstance:function(){var e;for(e in this.decorateRenders)break;return e?this.decorateRenders[e]:null},dispose:function(){var e=this,t=setTimeout((function(){e.decorated&&(e.decorated.unbind("renderchange"),e.decorated.dispose()),e.decorateRenders&&bizagi.util.arrayEach(e.decorateRenders,(function(e,t){t&&(t.unbind("renderchange"),t.dispose())})),clearTimeout(t)}),bizagi.override.disposeTime||50);e._super()}}),$.Class.extend("bizagi.rendering.columns.readonly",{},{init:function(e){this._super(e),this.properties.editable=required=!1},isReadonly:function(){return!0},isValueValid:function(){return!0}}),$.Class.extend("bizagi.rendering.columns.combo",{},{init:function(e){this._super(e);var t=this.properties;t.recalculate=bizagi.util.parseBoolean(t.recalculate)||!1,bizagi.util.isOfflineForm({context:this})&&(t.recalculate=!1)},applyOverrides:function(e){var t=this.properties;this._super(e),t.recalculate||(e.originalGetData=e.getData,e.getData=this.getDataForAllCells,e.findDataById=this.findDataById)},findDataById:function(e){var t={};return this.column&&this.column.comboData&&$.each(this.column.comboData,(function(i,r){r.id==e&&(t=r)})),t},getDataForAllCells:function(e){var t=this.column;return t.comboData?t.comboData:t.fetchingData?t.dataPromise:(t.fetchingData=!0,t.dataPromise=$.when(this.originalGetData(e)).pipe((function(e){return t.comboData=e,t.fetchingData=!1,e})),t.dataPromise)},setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if("summary"==e)return this._super(e,t);if(t&&bizagi.util.isString(t))this._super(e,t);else if(t&&t.length>0){var r={id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!=t})):t[0][1]};this._super(e,r),i.selectedValue=r.value}else t&&t.id&&t.value?(this._super(e,t),i.selectedValue=t.value):"columnRadio"==this.properties.type?(this._super(e,null),i.selectedValue=t):t&&"number"==typeof t?this._super(e,t):(this._super(e,null),i.selectedValue="")}},setDefaultValue:function(e,t){var i=this.properties.defaultValue[0];return t.grid.changes[e]=t.grid.changes[e]||{},t.grid.changes[e][this.properties.xpath]=i.id,i},getCompositeValue:function(e){var t=this.getDecorated(e),i=t.getValue(),r=t.getSelectedValue(),a=[];return i&&(i.id>0||bizagi.util.isString(i.id))?(a.push([]),a[0].push(i.id),a[0].push(r)):a.push([]),a},getValue:function(e){var t=this.getDecorated(e).getValue();return t?t.id:t},render:function(e,t,i){var r=this.getDecorated(e),a=this.properties;a.recalculate&&r.resetData();var n=a.xpathContext.length>0?a.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return r.properties.xpathContext=n,this._super(e,t,i)},renderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties,a=r.xpathContext.length>0?r.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return i.properties.xpathContext=a,this._super(e,t)}}),$.Class.extend("bizagi.rendering.columns.date",{},{setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if(this._super(e,t),null==t&&void 0!==this.properties.defaultvalue&&(t=this.setDefaultValue(e,i)),"summary"===e)return this._super(e,t);null==t&&(i.setValue(t,!1),i.properties.displayValue="");var r=bizagi.util.dateFormatter.getDateFromInvariant(t,i.properties.showTime);if(0===r&&(r=bizagi.util.dateFormatter.getDateFromInvariant(t,!i.properties.showTime)),0!==r){var a=bizagi.localization.getResource("datePickerRegional"),n=bizagi.util.dateFormatter.formatDate(r,i.properties.fullFormat,a);i.properties.displayValue=n,i.setValue(t,!1)}}},setDefaultValue:function(e,t){var i=this.properties.defaultvalue;return t.grid.changes[e]=t.grid.changes[e]||{},i=bizagi.util.dateFormatter.getDateFromInvariant(i,t.properties.showTime||!1),i=bizagi.util.dateFormatter.formatInvariant(i,!0),t.grid.changes[e][this.properties.xpath]=i,i}}),$.Class.extend("bizagi.rendering.columns.search",{},{init:function(e){this._super(e)},applyOverrides:function(e){var t;this._super(e),t=this.properties.xpathContext.length>0?this.properties.xpathContext+"."+this.grid.properties.xpath+"[id="+e.surrogateKey+"]":this.grid.properties.xpath+"[id="+e.surrogateKey+"]",e.properties.xpathContext=t},render:function(e,t,i){var r=this.getDecorated(e);return this.properties.recalculate&&r.resetData(),this._super(e,t,i)},getValue:function(e){return this.getDecorated(e).getValue()},setValue:function(e,t){var i=this.getDecorated(e);if(null!==i){if("summary"==e)return this._super(e,t);var r=this.getCompositeValue(e);if(r&&void 0!==r.id&&r.id==t&&(t=r),t&&t.length>0){var a={id:t[0][0],value:t[0].length>2?$.grep(t[0],(function(e,t){return 0!=t})):t[0][1]};this._super(e,a),i.selectedValue=a.value}else t&&t.id&&t.value?(this._super(e,t),i.selectedValue=t.value):t&&t.id&&t.label?(this._super(e,t),i.selectedValue=t.label):(this._super(e,t),i.selectedValue="")}}}),$.Class.extend("bizagi.rendering.columns.hidden",{},{canBeSent:function(){return!0}}),$.Class.extend("bizagi.rendering.document",{},{initializeData:function(e){this._super(e);var t=this.properties;t.validate=null!=bizagi.util.parseBoolean(t.validate)&&bizagi.util.parseBoolean(t.validate),t.downloadalldocuments=!!t.downloadalldocuments&&t.downloadalldocuments,t.allowGenerate=void 0===t.allowGenerate||t.allowGenerate,t.append=!!t.append&&t.append,t.caption?(t.caption=$.trim(t.caption),0===t.caption.length&&(t.caption=this.getResource("render-documentgenerator-button-label"))):t.caption=this.getResource("render-documentgenerator-button-label")},renderControl:function(){this.preRenderControl();var e=this.properties,t=this.getMode(),i=e.downloadalldocuments,r=e.allowGenerate,a=this.renderFactory.getTemplate(this.getTemplate()),n=e.value||[],o=!n||0===n.length,s=this.getControlHtml(a,t,i,r,e,o),l=this.renderDocumentsHtml(n);return l+=this.renderActionsHtml(n,o,i),s=this.replaceFilesHtml(s,l)},getControlHtml:function(e,t,i,r,a,n){return $.fasttmpl(e,{noActivateButton:!1,editable:"execution"!==t,mode:t,downloadalldocuments:i,required:a.required,allowgenerate:r,xpath:this.getXpath(a.xpath),append:a.append,caption:a.caption,noFiles:n,allowSendInMail:a.allowSendInMail})},getXpath:function(e){return e},preRenderControl:function(){},activateButton:function(){return!0},getDocumentXpath:function(e){return e},getContextXpath:function(){return this.properties.xpathContext},renderDocumentItem:function(e){var t=this.getMode(),i=this.renderFactory.getTemplate(this.getTemplateItem()),r=this.buildItemUrl(e);return"execution"!==t&&(r="javascript:void(0);"),$.fasttmpl(i,{url:r,allowDelete:this.properties.allowDelete,filename:e.fileName,id:e.id,mode:t,editable:this.properties.editable,joined:!1})},buildItemUrl:function(e){var t=this.properties;return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getDocumentXpath(t.xpath),xpathContext:this.getContextXpath(),idPageCache:t.idPageCache,fileId:e.id,sessionId:this.getSessionId()})},buildAllDocumentsUrl:function(){var e=this.properties;return this.dataService.getAllDocumentsDownloadUrl({xpath:this.getDocumentXpath(e.xpath),xpathContext:this.getContextXpath(),idPageCache:e.idPageCache,idCase:e.caseId,idWorkItem:e.workitemId,sessionId:this.getSessionId()})},postRender:function(){return this._super(),"<div></div>"},postRenderReadOnly:function(){if("design"!==this.getMode()){var e=this.getControl(),t=this.renderControl();e.append(t),this.updateControlForPrintMode(e),this.postRender()}},validateContainer:function(){return this.getFormContainer().validateForm()},save:function(){return this.getFormContainer().saveForm()},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},replaceActionsHtml:function(e,t){return e.replace("{{actions}}",t)},canBeSent:function(){return!1},isValid:function(e){var t,i=this.properties;return!1===bizagi.util.parseBoolean(i.visible)||(!1===bizagi.util.parseBoolean(i.editable)||(this.setValidationMessage(""),!(i.required&&!i.buttonExecuted&&this.value)||(this.value.length>0||(t=this.getResource("render-document-required-text"),e.push({xpath:i.xpath,message:t}),!1))))},configureHandlers:function(){var e=this;e._super();var t=$(".ui-bizagi-button-documentgenerator",e.getControl());e.isExecutionMode()&&(t.click((function(t){if(!t.isPropagationStopped()){if(t.stopPropagation(),e.properties.buttonExecuted=!0,e.properties.validate)e.validateContainer()&&e.documentTemplateGenerate();else e.documentTemplateGenerate();e.properties.buttonExecuted=!1}})),e.attachEvents())},configureHandlersReadOnly:function(){this.isExecutionMode()&&this.attachEvents()},attachEvents:function(){var e=this,t=e.getControl();$(".ui-bizagi-document-upload-item a > span",t).click((function(t){if(!t.isPropagationStopped()){t.stopPropagation();var i=$(this).closest(".ui-bizagi-document-upload-item").data();i.joined?e.downloadAllFiles({filename:"TemplatesConcatFilesToPDF.pdf"}):e.downloadFile(i)}})),$(".ui-bizagi-container-documents-item-delete",t).click((function(t){t.isPropagationStopped()||(t.stopPropagation(),e.deleteDocumentTemplate($(this).data("filename")))}))},deleteDocumentTemplate:function(e){var t=this,i={xpath:t.properties.xpath+"[fileName='"+e+"']",idRender:t.properties.id,xpathContext:t.getContextXpath(),idPageCache:t.properties.idPageCache};t.startLoading(),$.when(t.dataService.deleteUploadFile(i)).done((function(){$.when(t.dataService.multiaction().getPropertyData({xpath:t.properties.xpath,idRender:t.properties.id,xpathContext:t.getContextXpath(),idPageCache:t.properties.idPageCache,property:"value"})).done((function(e){t.resolveDeleteDocumentTemplate(e,!1,t.properties.downloadalldocuments),t.endLoading()}))}))},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath),e.save().done((function(){bizagi.showErrorAlertDialog=!1,$.when(e.dataService.generateDocumentTemplate(t)).done((function(){$.when(e.dataService.multiaction().getPropertyData({xpath:t.xpath,idRender:t.id,xpathContext:e.getContextXpath(),idPageCache:t.idPageCache,property:"value"})).done((function(i){e.resolveDocumentTemplateGenerate(i,!1,t.downloadalldocuments),e.endLoading()}))})).fail((function(t){e.endLoading(),e.showErrorMessage(t)}))})).fail((function(t){e.endLoading(),e.showErrorMessage(t)}))},showErrorMessage:function(e){var t=this.getFormContainer(),i=this.resources.getResource("render-upload-alert-maxsize").replace("{0}",BIZAGI_SETTINGS.UploadMaxFileSize);try{i=e&&void 0!==e.responseText?JSON.parse(e.responseText.replace(/(\r\n|\n|\r)/gm,"")).message:e}catch(e){}t.addErrorMessage(i),t.endLoading()},autoOpenDocuments:function(){},showDocumentPreview:function(e,t){},returnCssTypeFile:function(e){if(null==e||0===e.lenght)return"ui-bizagi-document-upload-item-generic-file";switch(e.substr(e.lastIndexOf(".")+1)){case"docx":return"ui-bizagi-document-upload-item-doc";case"pdf":return"ui-bizagi-document-upload-item-pdf";case"xlsx":return"ui-bizagi-document-upload-item-xls";default:return"ui-bizagi-document-upload-item-generic-file"}},redrawDocuments:function(e,t,i){var r=this.getControl(),a="",n=$("[data-component='files']",r);n.empty(),a+=this.renderDocumentsHtml(e),a+=this.renderActionsHtml(e,t,i),n.append(a),this.setValue(e)},renderAllDocumentDownload:function(e){var t=this.properties,i=this.getMode(),r=this.renderFactory.getTemplate(this.getTemplateItem()),a=this.buildAllDocumentsUrl();"execution"!==i&&(a="javascript:void(0);");var n=$.fasttmpl(r,{url:a,allowDelete:t.allowDelete,filename:e.fileName,mode:i,joined:!0});return this.removeDeleteButton(n)},removeDeleteButton:function(e){var t=e.indexOf('<span class="ui-bizagi-container-documents-item-delete');if(t>0){var i=e.substring(t),r=i.indexOf("</span>")+7;return e.substring(0,t)+i.substring(r)}return e},resolveDocumentTemplateGenerate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e,this.autoOpenDocuments(),this.configureHandlers()},resolveDeleteDocumentTemplate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e,this.configureHandlers()},renderDocumentsHtml:function(e){for(var t="",i=0;i<e.length;i++){var r={id:e[i][0],fileName:e[i][1]};t+=this.renderDocumentItem(r)}return t},renderActionsHtml:function(e,t,i){var r="";if(i&&!t&&e.length>0){var a={fileName:this.getResource("render-document-downloadalldocuments")};r+=this.renderAllDocumentDownload(a)}return r},getTemplate:function(){return"document"},getTemplateItem:function(){return"document-item"},getErrorTemplate:function(){return"form-error"},getTemplateDownload:function(){return"document-download"},getTemplateReadonly:function(){return"document-readonly"},getDocumentFile:function(e){var t=this.properties;return this.dataService.getFile({idRender:t.id,xpath:this.getDocumentXpath(t.xpath),xpathContext:this.getContextXpath(),idPageCache:t.idPageCache,fileId:e.id,contexttype:t.contexttype}).then((function(e){return bizagi.util.handleJSONResponse(e)}))},getAllDocumentFiles:function(){return this.dataService.getAllDocuments({xpath:this.getDocumentXpath(this.properties.xpath),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache,idCase:this.properties.caseId,idWorkItem:this.properties.workitemId}).then((function(e){return bizagi.util.handleJSONResponse(e)}))},downloadFile:function(e){var t=this;this.getDocumentFile(e).then((function(t){bizagi.util.downloadBlobFile(t,e.filename)})).fail((function(e){var i=t.getFormContainer();i&&i.failHandler(e)}))},downloadAllFiles:function(e){var t=this;this.getAllDocumentFiles().then((function(t){bizagi.util.downloadBlobFile(t,e.filename)})).fail((function(e){var i=t.getFormContainer();i&&i.failHandler(e)}))}}),$.Class.extend("bizagi.rendering.range",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e)},renderControl:function(){var e;this.properties;return e=this.renderFactory.getTemplate("render-range"),$.fasttmpl(e,{})},setRanageControls:function(e,t){this.minControl=e||null,this.maxControl=t||null;var i=this.getControl(),r=$(".bz-range-maximum",i),a=$(".bz-range-minimum",i);this.renderRangeControl(a,e),this.renderRangeControl(r,t)},getValue:function(){return{min:this.minControl.getValue(),max:this.maxControl.getValue()}},renderRangeControl:function(e,t){$.when(t.render("render")).done((function(i){e.empty().append(i),t.postRenderElement(e)}))}}),$.Class.extend("bizagi.rendering.rangeDate",{},{defineRangeControl:function(e){var t=bizagi.rendering.date.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=bizagi.rendering.date.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),r=new t(this.getRenderProperties("min")),a=new i(this.getRenderProperties("max"));r.suscribe(a),a.suscribe(r),this.setRanageControls(r,a)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,r={data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return r.data.properties.displayName="min"===e?"From":"To",r}}),$.Class.extend("bizagi.rendering.rangeMoney",{},{defineRangeControl:function(){var e=bizagi.rendering.money.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),t=bizagi.rendering.money.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=new e(this.getRenderProperties("min")),r=new t(this.getRenderProperties("max"));i.suscribe(r),r.suscribe(i),this.setRanageControls(i,r)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService}}}),$.Class.extend("bizagi.rendering.rangeNumber",{},{defineRangeControl:function(){var e=bizagi.rendering.number.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),t=bizagi.rendering.number.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=new e(this.getRenderProperties("min")),r=new t(this.getRenderProperties("max"));i.suscribe(r),r.suscribe(i),this.setRanageControls(i,r)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService}}}),bizagi.rendering.form.extend("bizagi.rendering.form",{init:function(e){this._super(e)},postRenderContainer:function(e){var t=this;t._super(e);var i=t.getButtons();(i?i.length:0)&&($(document).data("auto-save","auto-save"),$(document).unbind("save-form").bind("save-form",(function(e,i){t.autoSaveEvents(i)})),$(window).unbind("beforeunload").bind("beforeunload",(function(e){var i={};if(t.collectRenderValues(i),!$.isEmptyObject(i)&&$(document).data("auto-save"))return bizagi.localization.getResource("confirmation-savebox-message2")})))},configureHandlers:function(){var e,t=this,i=t.container;$(i.children()).each((function(){$(this).hasClass("ui-bizagi-container-complexgateway")&&(e=this)})),t.activeTransitions={},t.processButtons(i),t.bind("ondomincluded",(function(){t.validationController=new bizagi.command.controllers.validation(t,t.validations),t.actionController=new bizagi.command.controllers.action(t,t.actions),t.readyDeferred.resolve()})),t.bind("modalViewDidAppear",(function(){t.params.navigation.modalViewDidAppear()})),t.bind("modalViewDidDisappear",(function(){t.params.navigation.modalViewDidDisappear()})),$(".bz-rn-cg-checkbox",e).bind("click",(function(){var e=$(this).find("label"),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),bizagi.util.parseBoolean(e.data("checked"))?(e.removeClass("ui-checkbox-state-checked"),e.removeClass("bz-check").addClass("bz-full-ball"),e.data("checked",!1),t.activeTransitions[i]=!1):(e.addClass("ui-checkbox-state-checked"),e.addClass("bz-mo-icon").addClass("bz-check").removeClass("bz-full-ball"),e.data("checked",!0),t.activeTransitions[i]=!0)}))},autoSaveEvents:function(e,t){var i=this,r={};if(i.collectRenderValues(r),$.isEmptyObject(r))e.resolve();else{var a="startform"===i.properties.formtype,n=a?bizagi.localization.getResource("confirmation-savebox-message4"):bizagi.localization.getResource("confirmation-savebox-message1");$.when(bizagi.showConfirmationBox(n,"Bizagi","warning")).done((function(){a||i.saveForm(),e.resolve()})).fail((function(){a?e.reject():e.resolve()}))}},internalSubmitForm:function(e){var t,i=this,r=[],a=$.Deferred(),n=null,o=null,s=null,l=null,d=null;if((e.submitData||e.executeRule||e.createnewcase)&&(t=i.collectRenderValuesForSubmit()),$.when(i.startLoading()).done((function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")})),e.executeRule&&((n=i.dataService.submitData({action:"SUBMITDATA",data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0})).tag="submitData",l=i.prepareCheckpointAction(e.id),t={},(o=i.dataService.executeButton({idRender:e.id,xpathContext:i.properties.xpathContext||"",idPageCache:i.properties.idPageCache,prepare:!0})).tag="executeRule",d=i.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase){if(i.transitions){var u=[];if($.each(this.activeTransitions,(function(e,t){t&&u.push(e)})),0==bizagi.util.countProps(u)){var c=bizagi.localization.getResource("render-widget-complexgateway-path"),p=bizagi.localization.getResource("render-widget-complexgateway-error");return bizagi.showMessageBox(c,p,"info",!1),i.endLoading(),a.reject(),a.promise()}}(s=i.dataService.submitData({action:e.action,forcePlanCompletion:e.forcePlanCompletion,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0,transitions:u||"",contexttype:i.properties.contextType,surrogatekey:i.properties.surrogateKey})).tag="performAction"}o&&(r.push(n),l&&r.push(l),r.push(o),d&&r.push(d),r.push(o)),s&&r.push(s);var h=new $.Deferred;return t&&t.deferreds?$.when.apply(this,t.deferreds).done((function(e){h.resolve(e)})).fail((function(){console.log("Error: It was not possible resolve async actions on form "),h.reject()})):h.resolve(),$.when(h).done((function(){bizagi.util.smartphone.startLoading(),$.when(i.dataService.multiaction().execute({actions:r})).done((function(t){var r;if(i.endLoading(),$.each(t,(function(e,t){"validationMessages"==t.result.type&&(i.addValidationMessage(t.result.messages),r=!0)})),r)e.executeRule&&i.sendRollbackAction(e.id);else{if(!i.postProcessButton(t,e))return;e.refresh&&i.refreshForm(),e.routing&&i.triggerHandler("routing",{idCase:i.params.idCase}),e.createnewcase&&t.length>0&&i.triggerHandler("routing",{idCase:t[0].result.IdCase,caseNumber:t[0].result.CaseNumber})}delete i.nonSupportedMethods,a.resolve()})).fail((function(t,r,n){var o="";e.executeRule&&i.sendRollbackAction(e.id),n&&n.error&&-1!==["WaitForCompletionPlanException","InvalidPlanStateException","CustomMessageException"].indexOf(n.error.errorType)?(o=bizagi.localization.getResource(n.error.message),i.endLoading(),$.when(bizagi.showConfirmationBox(o,null,!1)).then((function(){var t=$.extend({},e,{forcePlanCompletion:!0});return $.when(i.internalSubmitForm(t))})).done((function(){a.resolve()})).fail((function(){a.reject()}))):(o=void 0===n?bizagi.localization.getResource("workportal-general-error"):n,i.failHandler({error:o}),a.reject(n))})).always((function(){bizagi.util.smartphone.stopLoading()}))})).always((function(){bizagi.util.smartphone.stopLoading()})),a.promise()},prepareCheckpointAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},prepareCommitAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},getButtons:function(){return this.getParams()&&(handler=this.getParams().getButtons)&&handler(this),$(".ui-bizagi-button-container .action-button",this.container)},processButtons:function(){var e=this.getParams();e&&e.processButtons&&(0,e.processButtons)(this);var t=this.properties;t.buttons=this.buttons,this.saveButton=null,this.nextButton=null;for(var i=0,r=t.buttons.length;i<r;i++)"save"===t.buttons[i].action?this.saveButton=t.buttons[i]:"next"===t.buttons[i].action&&(this.nextButton=t.buttons[i]);var a=this.getNavigation();if(void 0!==a){var n=this.getViewContainer();void 0!==n?n.setNavigationButtons(this):a.setNavigationButtons(this)}this.bindTouchEvents(this.getButtons())},bindTouchEvents:function(e){var t=this,i=0;e&&0!==e.length&&(e.bind("touchstart",(function(e){e.preventDefault();var t=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0]:e;i=t.pageY})),e.bind("touchend , click",(function(e){e.preventDefault(),$(":focus",t.container).blur();var r=(e.originalEvent&&e.originalEvent.changedTouches?e.originalEvent.changedTouches[0]:e).pageY;if(t.startLoading(),"click"!==e.type&&r>i+40||r<i-40)t.endLoading();else{var a=$(this).attr("ordinal"),n=t.buttons[a];$.when(t.processButton(n)).always((function(){t.endLoading()}))}})))},refreshForm:function(e,t){var i=this,r=i.getParams(),a=new $.Deferred;e=e||i.getFocus(),t=0!=t||t;var n={idCase:i.params.idCase||"",idWorkitem:i.params.idWorkitem||"",idTask:i.params.idTask||"",focus:e,selectedTabs:i.getSelectedTabs(),xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,isRefresh:!0,action:i.getEndPointAction(),idStartScope:i.properties.idStartScope||"",navigation:r.navigation,view_container:r.view_container};return(r.postRenderEdit||r.processButtons)&&(n.postRenderEdit=r.postRenderEdit,n.processButtons=r.processButtons,n.originalParams=r.originalParams||{},n.getButtons=r.getButtons),$(".km-native-scroller").css("-webkit-overflow-scrolling","inherit"),t&&i.startLoading(),$.when(i.triggerHandler("refresh",n)).done((function(){a.resolve(),setTimeout((function(){$(".km-native-scroller").css("-webkit-overflow-scrolling","touch")}),1e3)})).fail((function(){a.reject()})).always((function(){t&&i.endLoading()})),a.promise()},getSelectedTabs:function(){for(var e=this.getElementsByType("tab"),t=$.map(e,(function(e){return{tab:e.properties.id,selected:e.activeTab}})),i={},r=t.length;r-- >0;)i[t[r].tab]=t[r].selected;return i},getNavigation:function(){return this.getFormContainer().getParams().navigation},getViewContainer:function(){return this.getFormContainer().getParams().view_container},isFloatingButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFloatingButtonsEnabled()},isFormButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFormButtonsEnabled()},addValidationMessage:function(e){var t=this;"string"==typeof e?t.validationController.showValidationMessage(e):$.each(e,(function(e,i){t.validationController.showValidationMessage(i)})),t.validationController.expandNotificationBox();var i=t.getNavigation();i&&i.hasOwnProperty("undoRemoveLastSuscriber")&&t.getNavigation().undoRemoveLastSuscriber()},startLoading:function(e){bizagi.util.smartphone.startLoading()},endLoading:function(){bizagi.util.smartphone.stopLoading()},dispose:function(e){void 0!==e&&void 0!==e.isRefresh&&0!=e.isRefresh||this._super()},triggerGlobalHandler:function(e,t){return this._super(e,t),this.parent?this.parent.triggerGlobalHandler(e,t):this.observableElement?this.observableElement.trigger(e,t):null},failHandler:function(e){var t=this;t._super(e);var i={};try{i=JSON.parse(e)||{}}catch(t){i=e.length&&e.length>1?e[0]:e}finally{i.error&&(i=i.error),i.error&&(i=i.error),void 0!==i.code&&"AUTH_ERROR"==i.code&&($.notifier.add({class_name:"error",title:"Error",text:bizagi.localization.getResource("render-idle-expired-error","Idle timer expired. For safety reasons this view will be refreshed automatically in 5 seconds. Note that any unsaved data is lost.").replace("%s","5"),sticky:!1,time:5e3}),setTimeout((function(){t.triggerHandler("routing",{idCase:t.params.idCase,idWorkitem:t.params.idWorkitem})}),5e3))}},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("form"),i=$.kendoTmpl(t,{buttons:this.buttons,transitions:this.transitions,uniqueId:e.uniqueId,helptext:e.helpText,mode:this.getMode(),queryForm:"queryForm"==this.getFormType(),summaryForm:this.params.summaryForm||!1,globalForm:this.properties.displayAsReadOnly||!1,idCase:"",displayName:this.params.displayName||"",processPath:e.processPath,breadCrumb:e.breadCrumb,orientation:e.orientation});return this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),bizagi.rendering.panel.extend("bizagi.rendering.panel",{},{}),bizagi.rendering.contentPanel.extend("bizagi.rendering.contentPanel",{},{}),bizagi.rendering.tab.extend("bizagi.rendering.tab",{VISIBLE_TABS:2},{postRenderContainer:function(e){this._super(e),this.suscribeMethods()},suscribeMethods:function(){var e=this,t=e.container;$(t).bztabs({activeTab:void 0!==e.activeTab&&null!==e.activeTab?e.activeTab:0,tabNumber:e.Class.VISIBLE_TABS,domIncluded:e.ready(),activate:function(t,i){e.activeTab=$(t.currentTarget)?$(t.currentTarget).data("index"):0;var r=e.activeTab,a=e.getFormContainer(),n={};n[e.children[r].parent.properties.id]=r,a.setParam("selectedTabs",n)}})},checkPlusVisibility:function(){$(".bz-header_select > .bz-wp-tabs-ui:not(:hidden)",this.container).length<=this.Class.VISIBLE_TABS?$(".bz-header_select",this.container).removeClass("show-pluss"):$(".bz-header_select",this.container).addClass("show-pluss")}}),bizagi.rendering.tabItem.extend("bizagi.rendering.tabItem",{},{init:function(e){this._super(e),this.tabReadyDeferred=new $.Deferred,this.loadingDeferred=new $.Deferred,this.tabActiveDeferred=new $.Deferred},setAsActiveContainer:function(e){var t=this;$.when(t.ready()).done((function(){var e=t.parent;e&&e.container.tabs.hasOwnProperty("option")&&e.container.tabs("option","active",t.container.data("tab-counter"))}))},focus:function(){this.setAsActiveContainer(),this._super()},changeVisibility:function(e){var t=this,i=t.properties,r=t.parent.container,a=t.parent.getActiveTab(),n="ui-bizagi-tab-"+i.id,o=$(".bz-wp-tabs-item[data-reference-tab='#"+n+"']",r);i.visible=bizagi.util.parseBoolean(e),$.when(t.ready()).done((function(){if(i.visible){if(t.container.css("display",""),t.setAsActiveContainer(),o&&o.css("display","none")){var e=$("div[data-reference-tab='#"+n+"']",r);e&&e.css("display","")}}else if(t.container.hide(),o&&o.css("display","block")){var a=$("div[data-reference-tab='#"+n+"']",r);a&&a.hide()}})).always((function(){r&&r.tabs.hasOwnProperty("option")&&r.tabs("option","active",a),t.parent.checkPlusVisibility()}))}}),bizagi.rendering.horizontal.extend("bizagi.rendering.horizontal",{},{}),bizagi.rendering.group.extend("bizagi.rendering.group",{},{postRenderContainer:function(e){this._super(e),this.subscribeOnTouch()},expand:function(){this.container},collapse:function(){this.container},toogleContainer:function(e){e?this.expand():this.collapse()},subscribeOnTouch:function(){var e=this.container;$(e).find(">div.headertitle").bind("click",(function(){$(e).toggleClass("collapsed")}))}}),bizagi.rendering.searchForm.extend("bizagi.rendering.searchForm",{},{renderResult:function(){var e=this,t=e.properties,i={};i.properties={displayName:e.getResource("render-search-advanced-results-label"),type:"grid",xpath:"searchForm"+t.id,id:t.id,skipInitialLoad:!0,rowsPerPage:10,sortBy:t.sortBy,sortOrder:t.sortOrder,overrideGetRemoteData:function(t){return e.getRemoteData(t)}},i.elements=[];var r=t.columns;$.each(r,(function(t){var a={render:{}};a.render.properties={displayName:r[t].caption,xpath:r[t].xpath,editable:!1},$.extend(a.render.properties,e.parseAdditionalProperties(r[t].dataType)),0==r[t].dataType&&(a.render.properties.columnVisible=!1),7!=r[t].dataType&&8!=r[t].dataType||(a.render.properties.allowDecimals=r[t].allowDecimals),10!=r[t].dataType&&11!=r[t].dataType||(a.render.properties.allowDecimals=!0),12==r[t].dataType&&(a.render.properties.showTime=r[t].showTime),i.elements.push(a)}));var a=e.renderFactory.getRender({type:"grid",data:i,parent:e,mode:e.getMode()});return a.properties.allowAdd=!1,a.properties.allowEdit=!1,a.properties.allowDelete=!1,e.resultsGrid=a,a.render()},postRenderContainer:function(e){this._super(e);var t=e.find(".ui-bizagi-container-search-results"),i=this.getMode();this.container=e;var r=$(t.children()[0]);this.resultsGrid.postRenderElement(r),"execution"==i&&this.configureHandlers(),"design"==i&&this.configureDesignView(),"layout"==i&&(this.configureDesignView(),this.configureLayoutView())},configureHandlers:function(){var e=this;e.criteriaContainer=$(".ui-bizagi-container-search-criteria",e.container),e.resultsContainer=$(".ui-bizagi-container-search-results",e.container),e.resultsGrid.bind("rowSelected",(function(t,i){e.properties.searchParams.hasOwnProperty("multiSelect")?e.trigger("multiSelect",i):e.trigger("instanceSelected",i)}))},refreshResults:function(){var e=this;return e.trigger("instancerefresh"),$.when(e.resultsGrid.refresh()).done((function(){e.trigger("instancerefreshdone"),e.resultsGrid.properties.data&&0==e.resultsGrid.properties.data.records&&0==e.resultsGrid.properties.data.rows.length&&bizagi.showMessageBox(bizagi.localization.getResource("workportal-general-no-records-found"),bizagi.localization.getResource("render-dialog-sendemail-message"))}))},triggerGlobalHandler:function(e,t){return this._super(e,t),this.parent?this.parent.triggerGlobalHandler(e,t):this.observableElement?this.observableElement.trigger(e,t):null}}),$.Class.extend("bizagi.rendering.smartphone.helpers.searchForm",{},{init:function(e,t,i,r,a){this.dataService=e,this.renderFactory=t,this.searchForms=i,this.searchParams=r,this.searchFormParams=a,this.searchFormDeferred=new $.Deferred},renderEdition:function(e){return this.properties=e,this.renderSearchForm(e),this.searchFormDeferred.promise()},renderSearchForm:function(e){var t=this,i=t.searchFormParams.navigation.createRenderContainer({title:e.displayName});$.when(t.getSearchContainerData(e)).then((function(r){!1===e.editable&&(r.form.properties.editable=!1),r.form.properties&&(r.form.properties.orientation=t.searchParams.orientation||"ltr");var a=t.renderFactory.getContainer($.extend({},t.searchFormParams,{type:"form",data:r.form,navigation:t.searchFormParams.navigation,view_container:i}));return t.form=a,Object.keys(a.children).map((function(e){a.children[e].params=$.extend({},a.children[e].params,t.searchFormParams)})),a.render()}),(function(e){var i=t.renderFactory.getCommonTemplate("form-error");$.kendoTmpls(i,{message:e}).appendTo(slideForm.find(".scroll-content"))})).done((function(r){var a="tab"===t.form.firstChild().properties.type?t.form.firstChild():null;a?(a.bind("selected",(function(i,r){var a=t.searchForms[r.index];$.when(t.loadSearchTab(e,r.tab,a)).done((function(){t.currentSearchForm=r.tab.firstChild(),t.currentSearchForm.triggerHandler("ondomincluded")}))})),a.container.tabs("select",0),t.currentSearchForm=a.firstChild().firstChild(),t.currentSearchForm.readyDeferred||(t.currentSearchForm.readyDeferred=new $.Deferred),t.currentSearchForm.triggerHandler("ondomincluded")):(t.currentSearchForm=t.form.firstChild(),t.currentSearchForm.readyDeferred||(t.currentSearchForm.readyDeferred=new $.Deferred),t.currentSearchForm.triggerHandler("ondomincluded")),i.element.html(r),t.searchFormParams.navigation.navigate(i.id),t.containerGridResults=t.currentSearchForm.container.find(".ui-bizagi-container-search-results"),t.containerSearchCriteria=t.currentSearchForm.container.find(".ui-bizagi-container-search-criteria"),t.applyButtons(i)}))},renderAddForm:function(e){var t=this;e=e||{};var i=t.properties;if(void 0===t.addContainer){var r=bizagi.localization.getResource("render-dialog-entity");t.addContainer=t.searchFormParams.navigation.createRenderContainer({title:r}),t.addContainer.element.bind("close",(function(){delete t.addContainer}))}var a=e.isRefresh||!1,n={idPageCache:e.idPageCache,guidEntity:i.entity,contextType:"entity"};a?(n.isRefresh=!0,n.idStartScope=e.idStartScope):(n.idRender=i.idRender,n.requestedForm="addForm"),$.when(t.dataService.getFormData(n)).then((function(i){!1===e.editable&&(i.form.properties.editable=!1),void 0!==i.form.properties&&(i.form.properties.orientation=t.searchParams.orientation||"ltr"),i.form.contextType="entity";var r=t.renderFactory.getContainer($.extend({},t.addFormParams,{type:"form",data:i.form,focus:e.focus||!1,selectedTabs:e.selectedTabs,isRefresh:a,requestedForm:e.requestedForm,navigation:t.searchFormParams.navigation,view_container:t.addContainer}));for(var n in r.buttons=[$.extend(r.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""},{callback:function(){return t.saveDataAddForm(r).done((function(){t.addContainer.destroy(),delete t.addContainer,t.searchParams.maxRows=1,t.currentSearchForm.performSearch(t.searchParams)}))}}),$.extend(r.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:""},{callback:function(){t.addContainer.destroy(),delete t.addContainer}})],$.extend(r,{processButtons:function(){$.each(r.buttons,(function(e,i){switch(i.ordinal){case 1:$(r.getButtons()[e]).click((function(){t.addContainer.destroy(),delete t.addContainer})),r.getButtons()[e].innerHTML=bizagi.localization.getResource("render-form-dialog-box-close"),r.buttons[e].caption=bizagi.localization.getResource("render-form-dialog-box-close"),r.buttons[e].action="back";break;default:$(r.getButtons()[e]).click((function(){t.saveDataAddForm(r),t.addContainer.destroy(),delete t.addContainer}))}}))}}),r.children)r.children[n].params=$.extend({},r.children[n].params,t.addFormParams);return $.when(r.render()).done((function(e){t.currentAddForm=r.firstChild(),t.addContainer.element.html(e),a||t.searchFormParams.navigation.navigate(t.addContainer.id),t.addContainer.setNavigationButtons(r),r.triggerHandler("ondomincluded"),t.handleSearchFormZindex("show"),r.bind("refresh",(function(e,i){return i.scrollTop=t.form.container.parent().scrollTop(),i=$.extend({focus:focus,selectedTabs:t.form.getSelectedTabs(),isRefresh:!0,contextType:t.properties.contextType||"",navigation:t.searchFormParams.navigation,view_container:t.addContainer},i),t.renderAddForm(i)}))}))})).fail((function(){t.addContainer.destroy(),delete t.addContainer,console.log("there was an error :(")}))},saveDataAddForm:function(e){var t=this,i=(t.properties,$.Deferred());if(e.validateForm()){var r={};$.forceCollectData=!0,e.collectRenderValues(r),r.idPageCache=e.idPageCache;var a={action:"SAVE",data:r,idPageCache:r.idPageCache,guidEntity:e.properties.entity,contexttype:"entity"},n={};e.collectRenderValuesForSubmit(n),$.forceCollectData=!1,bizagi.util.isMapEmpty(n)?(bizagi.showMessageBox(bizagi.localization.getResource("render-search-advanced-no-filters")),i.reject()):$.when(t.dataService.submitData(a)).done((function(r){function a(e){var i=t.currentSearchForm.getRender(e);return"object"===_typeof(i)&&null!==i?{found:!0,obj:i}:{found:!1,obj:{}}}for(var o in n){var s=a(o);s.found&&(s.obj.setValue(n[o]),t.setDisplayValueToControl(s.obj,e,o,n))}i.resolve()})).fail((function(t,r,a){e.addValidationMessage(a.message),i.reject()}))}else i.reject();return i},setDisplayValueToControl:function(e,t,i,r){"searchSuggest"===e.properties.type?e.setDisplayValue(t.getRender(i).getDisplayValue()):e.setDisplayValue(r[i])},applyButtons:function(e){var t=this;t.displayBottomButtons(e),e.element.bind("close",(function(){t.searchFormDeferred.reject()}))},loadSearchTab:function(e,t,i){var r=this,a=new $.Deferred;return t.children.length>0?null:($.when(r.getSearchFormData(e,i)).pipe((function(e){var i=r.renderFactory.getContainer({type:"searchForm",data:e.form});return t.children.push(i),i.render()})).done((function(e){$(".ui-bizagi-button-container",e).detach(),t.container.append(e),a.resolve()})),a.promise())},getSearchContainerData:function(e){var t=this,i=new $.Deferred,r={form:{properties:{},elements:[]}},a=r.form,n=t.searchForms[0];if(t.searchForms.length>1){var o={properties:{type:"tab"},elements:[]},s=[];$.each(t.searchForms,(function(e,i){var r=i.default||!1,l={};l.properties={id:e,type:"tabItem",displayName:i.caption},l.elements=[],r?(o.elements.push({container:l}),a=l,n=t.searchForms[0]):s.push({container:l})})),$.each(s,(function(e,t){o.elements.push(t)})),r.form.elements.push({container:o})}return $.when(t.getSearchFormData(e,n)).done((function(e){a.elements.push(e),a.properties.id=Math.guid(),i.resolve(r)})),i.promise()},getSearchFormData:function(e,t){return this.dataService.getSearchFormData($.extend(e,{idSearchForm:t.id,url:t.url})).pipe((function(t){return t.form.properties.idRender=e.idRender,t}))},displayBottomButtons:function(e){var t=this,i=t.currentSearchForm.container.find(".ui-bizagi-container-button-edit").empty().show(),r="<button class='ui-bizagi-form-button #= data.name #'> #= data.text # </button>",a=$.kendoTmpls(r,{name:"bz-btn-search",text:bizagi.localization.getResource("render-form-dialog-box-search")}).appendTo(i),n=$.kendoTmpls(r,{name:"bz-btn-select",text:bizagi.localization.getResource("render-search-advanced-results-button")}).appendTo(i),o=$.kendoTmpls(r,{name:"bz-btn-add",text:bizagi.localization.getResource("render-form-dialog-box-add")}).appendTo(i),s=$.kendoTmpls(r,{name:"bz-btn-cancel",text:bizagi.localization.getResource("render-form-dialog-box-cancel")}).appendTo(i);e.element.bind("close",(function(e){"none"===t.containerSearchCriteria.css("display")&&(e.preventDefault(),l())}));var l=function(){var i=[{ordinal:1,action:"search",caption:bizagi.localization.getResource("render-form-dialog-box-search"),callback:function(){return t.searchParams.maxRows=1,t.currentSearchForm.performSearch(t.searchParams)}},{ordinal:2,action:"cancel",caption:"cancel",callback:function(){t.searchFormDeferred.reject(),e.destroy()}},{ordinal:3,action:"add",caption:bizagi.localization.getResource("render-form-dialog-box-add"),callback:function(){var e={idCase:t.searchFormParams.idCase,idRender:t.properties.idRender,displayName:t.properties.displayName,idPageCache:t.properties.idPageCache};t.renderAddForm(e)}}];t.containerSearchCriteria.show(),t.containerGridResults.hide(),$(o).toggle(t.searchParams.allowNew),a.show(),n.hide(),t.searchParams.allowNew||i.pop(),t.form.buttons=i,delete t.form.properties.virtual,e.setNavigationButtons(t.form)};a.bind("click",(function(){t.searchParams.maxRows=1,t.currentSearchForm.performSearch(t.searchParams)})),o.bind("click",(function(){var e={idCase:t.searchFormParams.idCase,idRender:t.properties.idRender,displayName:t.properties.displayName,idPageCache:t.properties.idPageCache};t.renderAddForm(e)})),s.bind("click",(function(){t.searchFormDeferred.reject(),e.destroy()})),n.bind("click",(function(){t.searchFormDeferred.resolve(e.element.find(".ui-bizagi-container-search-results [data-key]").data("business-key")),e.destroy()})),t.currentSearchForm.bind("instancerefreshdone",(function(){var i;null!==t.currentSearchForm.resultsGrid.properties.data&&!jQuery.isEmptyObject(t.currentSearchForm.resultsGrid.properties.data.rows)&&t.currentSearchForm.resultsGrid.properties.data.rows.length>0?(i=[{ordinal:4,action:"select",caption:bizagi.localization.getResource("render-search-advanced-results-button"),callback:function(){t.searchFormDeferred.resolve(e.element.find(".ui-bizagi-container-search-results [data-key]").data("business-key")),e.destroy()}},{ordinal:5,action:"cancel",caption:"cancel",callback:function(){l()}},{ordinal:3,action:"add",caption:bizagi.localization.getResource("render-form-dialog-box-add"),callback:function(){var e={idCase:t.searchFormParams.idCase,idRender:t.properties.idRender,displayName:t.properties.displayName,idPageCache:t.properties.idPageCache};t.renderAddForm(e)}}],t.containerSearchCriteria.hide(),t.containerGridResults.show(),$(o).toggle(t.searchParams.allowNew),a.hide(),n.show(),t.searchParams.allowNew||i.pop(),t.form.buttons=i,t.form.properties.virtual=!0,e.setNavigationButtons(t.form)):l()})),l()},renderEditionAddForm:function(e){var t=this,i=t.properties,r=$(e.id+" .inputEditionContent"),a=$(e.id+" .inputEditionContent"),n=$(e.id,"body");t.viewContainer=e.viewContainer,t.addFormParams={container:r,canvas:a,kendoView:n,allowFullSearch:i.allowFullSearch,maxRecords:i.maxRecords,allowNew:!1},t.renderEdition({idRender:i.idRender,requestedForm:"addForm",xpathContext:i.xpathContext,idPageCache:i.idPageCache,isAddForm:!0,contextType:"entity"}).done((function(){if(t.form.validateForm()){var e={};$.forceCollectData=!0,t.form.collectRenderValues(e),e.idPageCache=t.form.idPageCache;var i=$.Deferred(),r={action:"SAVE",data:e,idPageCache:e.idPageCache,guidEntity:t.form.properties.entity,contexttype:"entity"},a={};t.form.collectRenderValuesForSubmit(a),$.forceCollectData=!1,bizagi.util.isMapEmpty(a)?bizagi.showMessageBox(bizagi.localization.getResource("render-search-advanced-no-filters")):(t.pane.navigate("#:back"),$.when(t.dataService.submitData(r)).done((function(i){function r(e){var i=t.currentSearchForm.getRender(e);return"object"==_typeof(i)&&null!==i?{found:!0,obj:i}:{found:!1,obj:{}}}for(var n in a){var o=r(n);if(o.found){var s=e[n];o.obj.setValue(s),o.obj.setDisplayValue(s),null!==t.currentSearchForm.resultsGrid.properties.data&&!jQuery.isEmptyObject(t.currentSearchForm.resultsGrid.properties.data.rows)&&t.currentSearchForm.resultsGrid.properties.data.rows.length>0&&(t.containerSearchCriteria.show(),t.currentSearchForm.container.find(".bz-btn-search").show(),t.currentSearchForm.container.find(".bz-btn-select").hide(),t.containerGridResults.hide())}}})).fail((function(e,t,r){"parsererror"===t?i.resolve({type:"error",message:r.message}):i.reject(arguments)})))}})).fail((function(){t.pane.navigate("#:back")})),t.pane.navigate(e.id)},handleSearchFormZindex:function(e){var t=jQuery.grep($(".km-modalview-root"),(function(e,t){return"block"==$(e).css("display")}));t.length>0&&("show"==e?$(t).css("z-index",0):$(t).css("z-index",10001))}}),$.Class.extend("bizagi.rendering.smartphone.startForm",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideContainer=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title}),this.configureViewHandlers()},configureViewHandlers:function(){},goBack:function(){this.slideContainer.destroy()},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getStartForm(e)).then((function(r){!1===e.editable&&(r.form.properties.editable=!1);var a=bizagi.rendering.form.extend({submitForm:function(){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done((function(r){null===r||!0===r||"success"===r.type?(i.resolve(),t.goBack()):"validationMessages"===r.type?(t.form.addValidationMessage(r.messages),$.each(e,(function(e){var i=t.form.getRenders(e);$.each(i,(function(e,t){t.updateOriginalValue()}))}))):"error"===r.type&&t.form.addErrorMessage(r.message)})):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:r.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form=new a(n),t.form.bind("refresh",(function(i,r){r=$.extend({selectedTabs:t.form.getSelectedTabs(),isRefresh:!0},e,r,{idStartScope:t.form.properties.idStartScope}),t.renderSlideForm(r)})),t.form.buttons=[$.extend(t.form.buttons[0]||{},{caption:t.slideFormParams.saveButtonLabel,actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""},{callback:function(){t.form.submitForm()}}),$.extend(t.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:""},{callback:function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()}})],t.form.render()})).done((function(i){var r=t.slideFormParams.saveButtonLabel?t.slideFormParams.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"),a=bizagi.localization.getResource("render-form-dialog-box-cancel");t.slideContainer.element.html(i),e.isRefresh||t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append("<div ordinal='0' id='formButton0' class='action-button ui-bizagi-form-button'>"+r+"</div>").delegate("div[ordinal='0']","click",(function(){t.form.submitForm()})),$(".ui-bizagi-button-container",t.form.container).append("<div ordinal='1' id='formButton1' class='action-button ui-bizagi-form-button'>"+a+"</div>").delegate("div[ordinal='1']","click",(function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()})),t.form.triggerHandler("ondomincluded")})).fail((function(e,i,r){var a=t.renderFactory.getCommonTemplate("form-error"),n=r.message||"Error";$.kendoTmpls(a,{message:n}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)})),i.promise()}}),$.Class.extend("bizagi.rendering.smartphone.slide.form",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormParams=i||{},this.slideContainer=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title}),this.configureViewHandlers()},goBack:function(){this.slideContainer.destroy()},configureViewHandlers:function(){},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getFormData(e)).pipe((function(r){!1===e.editable&&(r.form.properties.editable=!1);var a=bizagi.rendering.form.extend({submitForm:function(e){if(t.form&&(this.endLoading(),t.form.validateForm())){var r={};t.form.collectRenderValues(r),r.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(r)).done((function(e){null===e||!0===e||"success"===e.type?(i.resolve(),t.goBack()):"validationMessages"===e.type?(t.form.addValidationMessage(e.messages),$.each(r,(function(e,i){var r=t.form.getRenders(e);$.each(r,(function(e,t){t.updateOriginalValue()}))}))):"error"===e.type&&t.form.addErrorMessage(e.message)})):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:r.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form=new a(n),t.form.buttons=[$.extend(t.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""},{callback:function(){t.form.submitForm()}}),$.extend(t.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:""},{callback:function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()}})],t.form.render()})).done((function(i){var r=t.slideFormParams.saveButtonLabel?t.slideFormParams.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"),a=bizagi.localization.getResource("render-form-dialog-box-cancel");t.slideContainer.element.html(i),t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">'+r+"</div>").delegate('div[ordinal="0"]',"click",(function(){t.form.submitForm()})),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="1" id="formButton1" class="action-button ui-bizagi-form-button">'+a+"</div>").delegate('div[ordinal="1"]',"click",(function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()})),t.form.triggerHandler("ondomincluded"),t.form.bind("refresh",(function(){t.renderSlideForm(e)}))})).fail((function(e){var i=t.renderFactory.getCommonTemplate("form-error"),r=e.message||"Error";$.kendoTmpls(i,{message:r}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)})),i.promise()}}),bizagi.rendering.actionLauncher.extend("bizagi.rendering.actionLauncher",{},{postRenderSingle:function(){var e,t=this,i=t.properties,r=new $.Deferred;return t.actions=[],t.configureQueueVisibility(),t.startLoading(),$.when(t.dataService.multiaction().getActions(t.processPropertyValueArgs)).then((function(r){return r=t.getPropertiesActionLaucher(r),t.actions=r,t.deferredActions.resolve(r),i.isHorizontal?"none"!=i.templatetype?t.dataService.multiaction().getPropertyData(t.processPropertyValueDataTmplArgs).then((function(e){return t.engine.render($.extend(e,{isDefaultTemplate:"default"===i.templatetype,sessionId:t.properties.sessionId}),$.extend({},t.processPropertyValueDataTmplArgs,{formParams:t.getFormParams(t.getFormContainer())}))})).then((function(i){e=t.renderFactory.getTemplate("render-actionLauncher-horizontal");var r=$($.kendoTmpl(e,{actions:t.actions,template:!0}));return $(".template-container",r.wrap("<div>").parent()).append(i),r})):(e=t.renderFactory.getTemplate("render-actionLauncher-horizontal"),$.kendoTmpl(e,{actions:t.actions})):(e=t.renderFactory.getTemplate("render-actionLauncher-vertical"),$.kendoTmpl(e,{actions:t.actions,allowSearch:i.allowSearch,maxItems:i.maxItems}))})).done((function(e){var i=t.getControl(),a=$(".bz-action-launcher-actions-container",i);t.endLoading(),a.append(e),t.configureHandlers(),t.configureTemplateHandlers(),r.resolve(a)})).fail((function(e){t.endLoading(),r.fail(e)})),r.promise()},getFormParams:function(e){return e.parent?this.getFormParams(e.parent.getFormContainer()):e.getParams()},hasValue:function(){var e=this.getValue();return null!=e&&e.length>0},configureHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",(function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],readOnlyForm:t[6]||!1,guidEntity:e.properties.guidEntity,xpathActions:e.properties.xpathActions||""};e.processAction(i)}));for(var i=[],r=0,a=e.actions.length;r<a;r++)i.push({guid:e.actions[r][0],displayName:e.actions[r][1]});$(".wp-action-more",t).actionSheet({actions:i,actionClicked:function(t){var i=e.actions.find((function(e){return e[0]==t.guid}));e.processAction({guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5],readOnlyForm:i[6]||!1,xpathActions:e.properties.xpathActions||""})}}),$.expr[":"].FilterAction=function(e,t,i){var r=i[3];return!!r&&new RegExp(r,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup((function(){var e=$(this).val();$(".action-launcher-control",t).show(),e&&$(".action-launcher-control",t).not(":FilterAction("+e+")").hide()}))},configureTemplateHandlers:function(){var e=this;e.engine.subscribe("onLoadDataNavigation",(function(t,i){i.filters=[],e.triggerGlobalHandler("dataNavigation",i)}))},processAction:function(e){var t=this,i=t.getControl(),r=t.properties;void 0===r.multipleSelection||r.multipleSelection?"Form"==e.actionType&&t.countSameActions(e)>=1&&!e.xpathContext?$(".action-to-execute-control[data-guidaction='"+e.guidAction+"'] label",i).click():$.when(t.actionManager(e)).done((function(e){t.executeAction(e)})):t.getValue().length>0?t.showConfirmationDialog(e):$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))},notifyExecution:function(e,t){"success"==e.response?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,r=t.getParams(),a=t.properties.additionalXpath.join(","),n=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,o=new $.Deferred,s=new bizagi.rendering.smartphone.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:r.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){return t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:s.form.properties.xpathContext,idPageCache:i.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(i){e.editMode||0!==t.countSameActions(e)||(e.idStartScope=i.IdScope),o.resolve(i.IdScope)}))},onCancel:function(e){}}),l={idForm:e.guidProcess,contextType:"start",idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?r.idWorkitem:void 0,additionalXpaths:a,xpathContext:n,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath};return"Form"===e.actionType&&(l.contextType="entitytemplate",l.xpathContext=void 0,l.guidEntity=e.guidEntity,l.rewriteContextType=!0),s.render(l),o.promise()},processActionFormCollection:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=t.properties.additionalXpath.join(","),n=new $.Deferred,o=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,s=""!==o?printf("%s[id=%s]",o,e.idEntity):o,l=""!==o?printf("%s[]",o):o,d=r.getParams();return new bizagi.rendering.smartphone.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:d.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(r){return e.editMode?t.dataService.multiaction().submitData({action:"SAVE",data:r,xpathContext:s,idPageCache:r.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(e){n.resolve(e.IdScope)})):t.dataService.addGridRecordData({idRender:i.id,xpathContext:o,contexttype:"start",idPageCache:r.idPageCache,submitData:r}).done((function(i){e.idStartScope=i.IdScope,e.idEntity=i.IdEntity,t.addActionToQueue(e),n.resolve(i.IdScope)}))},onCancel:function(e){}}).render({idForm:e.guidProcess,contextType:"start",idCase:d.idCase,additionalXpaths:a,xpathContext:e.editMode?s:l,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath}),n.promise()},processStartForm:function(e){var t=this,i=new $.Deferred;e=e||{};var r=t.getFormContainer().getParams();return new bizagi.rendering.smartphone.startForm(t.dataService,t.renderFactory,{title:e.title||"",navigation:r.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(e){i.resolve(e.IdScope)}))}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?r.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),i.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.executeActionImmediately(e)}))}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.setValue([]),$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))}))},setDisplayValue:function(e){var t=this,i=t.getControl(),r=$(".bz-action-launcher-actions-to-execute-container",i),a=t.renderFactory.getTemplate("render-actionLauncher-actions-to-execute");t.configureQueueVisibility(),$.when(t.deferredActions).done((function(i){$.each(e,(function(t,r){var a=function(e){var t=[];return $.each(i,(function(i,r){r[4]==e&&(t=r)})),t}(r.guidAction);e[t].displayName=a[1],e[t].guidProcess=a[0],e[t].actionType=a[3],e[t].xpathContext=a[5],e[t].readOnlyForm=a[6],e[t].params&&e[t].params.idStartScope&&(e[t].idStartScope=e[t].params.idStartScope),e[t].params&&e[t].params.idPageCache&&(e[t].idPageCache=e[t].params.idPageCache),e[t].params&&e[t].params.idEntity&&(e[t].idEntity=e[t].params.idEntity)})),$.when($.kendoTmpl(a,{actions:e})).done((function(e){r.empty(),r.append(e);var i=$(".action-to-execute-control .delete-action",r),a=$(".action-to-execute-control label",r);i.on("click",(function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)})),a.on("click",(function(){var e=$(this).parent(),i=e.data("actiontype"),r=e.data("guidprocess"),a=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("readonlyform")||!1,l=e.data("identity")||"",d=e.data("guidaction"),u=o||t.properties.xpathContext;switch(i){case"Process":a&&t.processStartForm({guidprocess:r,idStartScope:a,title:n,xpathContext:o,recordXpath:u});break;case"Form":var c={guidProcess:r,idStartScope:a,editMode:!0,xpathContext:o,readOnlyForm:s,idEntity:l,recordXpath:u};if(c.xpathContext)t.processActionFormCollection(c);else{c.xpathContext=void 0;var p={},h=t.value.filter((function(e){return e.guidAction==d}));h.length>0&&(p={actionType:"Form",contextType:"entitytemplate",guidEntity:t.properties.guidEntity||h[0].guidEntity}),t.processActionForm($.extend(c,p))}}}))}))}))},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-action-launcher-actions-to-execute-container",e),i=$(".action-to-execute-label",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.actionLauncher.extend("bizagi.rendering.entityTemplate",{},{postRenderSingle:function(){var e=this,t=e.properties,i=new $.Deferred;return e.actions=[],e.getArrowContainer().hide(),e.configureQueueVisibility(),e.startLoading(),e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs).then((function(i){return e.engine.render(i,e.processPropertyValueDataTmplArgs).then((function(i){var r=e.renderFactory.getTemplate("render-actionLauncher-horizontal");if(t.allowactions)return e.dataService.multiaction().getActions(e.processPropertyValueArgs).then((function(t){e.deferredActions.resolve(t),e.actions=t;var a=$($.kendoTmpl(r,{actions:e.actions,template:!0}));return $(".template-container",a.wrap("<div>").parent()).append(i),a}));var a=$($.kendoTmpl(r,{template:!0}));return $(".template-container",a.wrap("<div>").parent()).append(i),a}))})).done((function(t){var r=e.getControl(),a=$(".bz-action-launcher-actions-container",r);e.endLoading(),a.append(t),e.configureHandlers(),e.configureTemplateHandlers(),i.resolve(a)})).fail((function(t){e.endLoading(),i.fail(t)})),i.promise()},configureHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",(function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],xpathActions:e.properties.xpathActions||""};"Form"===i.actionType&&(i.xpathContext=void 0,i.contextType="entitytemplate",i.guidEntity=e.properties.guidEntity),e.processAction(i)}));for(var i=[],r=0,a=e.actions.length;r<a;r++)i.push({guid:e.actions[r][0],displayName:e.actions[r][1]});$(".wp-action-more",t).actionSheet({actions:i,actionClicked:function(t){var i=e.actions.find((function(e){return e[0]==t.guid}));e.processAction({guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5]})}})},configureTemplateHandlers:function(){var e=this;e.engine.subscribe("onLoadDataNavigation",(function(t,i){i.filters=[],i.calculateFilters=i.calculateFilters||!0,e.triggerGlobalHandler("dataNavigation",i)}))}}),bizagi.rendering.polymorphicLauncher.extend("bizagi.rendering.polymorphicLauncher",{},{postRenderSingle:function(){var e,t=this,i=t.properties;return"design"!=t.getMode()&&t.properties.surrogatedKey?(t.configureQueueVisibility(),$.when(t.dataService.multiaction().getPolymorphicActions(t.processPropertyValueArgs)).done((function(r){r=t.dataService.serializePolymorphicActions(r),t.totalActions=bizagi.clone(r);var a=bizagi.clone(r);t.lessActions=bizagi.clone(a);var n={actions:a,allowSearch:i.allowSearch,treeActionsList:t.getTreeItems(a)};e=t.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree");var o=t.getControl();$(".bz-polymorphic-launcher-constructors-container",o).append($.kendoTmpl(e,n)),t.bindHandlers()}))):""},getTreeItems:function(e,t){var i=this,r="<ul>",a=i.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree-item");return e=e||{},t=t||1,$.each(e,(function(e,n){r+=$.kendoTmpl(a,n),n.children&&(r+=i.getTreeItems(n.children,t+1))})),r+="</ul>"},bindHandlers:function(){var e=this,t=e.getControl();$(".bz-polymorphic-launcher-constructors-container li span",t).on("click",(function(){var t=$(this).parent(),i={guidEntity:t.data("guidentity"),guidObject:t.data("guidobject"),guidConstructor:t.data("guidconstructor"),displayName:t.data("display-name"),actionType:t.data("action-type"),xpathContext:t.data("xpathcontext")};e.onActionClicked(i)})),$.expr[":"].FilterAction=function(e,t,i){var r=i[3];return!!r&&new RegExp(r,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup((function(){var e=$(this).val();$(".bz-polymorphic-launcher-constructors-container li",t).show(),e&&$(".bz-polymorphic-launcher-constructors-container li",t).not(":FilterAction("+e+")").hide()}))},onActionClicked:function(e){var t=this;$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))},notifyExecution:function(e,t){"success"==e?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=t.properties.additionalXpath.join(","),n=new $.Deferred,o=(e.xpathContext,r.getParams()),s=t.properties.recordXpath,l=new bizagi.rendering.smartphone.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:o.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){var r=i.idPageCache;return i.idPageCache=null,t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:l.form.properties.xpathContext,idPageCache:r,isOfflineForm:!1,isActionStartForm:!0}).done((function(i){e.editMode||0!=t.countSameActions(e)||(e.idStartScope=i.IdScope),n.resolve(i.IdScope)}))},onCancel:function(e){}});return l.render({idForm:e.guidObject,contextType:"entity",guidEntity:e.guidEntity,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?o.idWorkitem:void 0,additionalXpaths:a,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,recordXpath:s}),n.promise()},processStartForm:function(e){var t=this,i=t.properties,r=t.getFormContainer(),a=new $.Deferred,n=r.getParams();return e=e||{},new bizagi.rendering.smartphone.startForm(t.dataService,t.renderFactory,{maximized:i.maximized,title:e.title||"",navigation:n.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==this.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return r.startLoading(),t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done((function(e){r.endLoading(),a.resolve(e.IdScope)}))}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?n.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),a.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.executeActionImmediately(e)}))}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){t.setValue([]),$.when(t.actionManager(e)).done((function(e){t.executeAction(e)}))}))},setDisplayValue:function(e){var t=this,i=t.getControl(),r=$(".bz-polymorphic-launcher-constructors-to-execute-container",i),a=t.renderFactory.getTemplate("render-polymorphicLauncher-actions-to-execute");t.configureQueueVisibility(),$.when($.kendoTmpl(a,{actions:e})).done((function(e){r.empty(),r.append(e);var i=$(".action-to-execute-control .delete-action",r),a=$(".action-to-execute-control label",r);i.on("click",(function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)})),a.bind("click",(function(){var e=$(this).parent(),i=e.data("actiontype"),r=e.data("guidprocess"),a=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("identity")||"",l=e.data("guidentity"),d=o||t.properties.xpathContext;switch(i){case"Process":a&&t.processStartForm({guidprocess:r,idStartScope:a,title:n,xpathContext:o,recordXpath:d});break;case"Form":var u={guidProcess:r,idStartScope:a,editMode:!0,xpathContext:o,idEntity:s,guidEntity:l,guidObject:r};t.processActionForm(u)}}))}))},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-polymorphic-launcher-constructors-to-execute-container",e),i=$(".actions-to-execute-title",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.text.extend("bizagi.rendering.text",{},{renderSingle:function(){var e=this.properties,t=this.getContainerRender(),i=this.getControl();this.input=0!=i.find("input").length?i.find("input"):i.find(".bz-rn-non-editable"),e.maxLength>0&&this.input.attr("maxlength",e.maxLength),e.editable?(t.addClass("bz-command-edit-inline"),this.input.removeAttr("readonly"),this.configureHandlers()):(t.addClass("bz-rn-non-editable"),this.input.attr("readonly","readonly"))},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.kendoTmpl(e,{})},postRenderSingle:function(){var e=this.properties;this._super(),"double"==e.retype&&this.attachRetypeDouble();var t=this.element,i=$("input",t);i&&i.length},setDisplayValue:function(e){this.setValue(e,!1),"object"!=_typeof(e)&&"string"==typeof(e="boolean"==typeof e?e.toString():e)&&(e=(e=e.replaceAll("\\n"," ").replaceAll("\n"," ")).replaceAll("&amp;","&"),this.properties.editable?(this.input.first().html(e),this.input.first().val(e)):this.input.text(e))},setDisplayValueEdit:function(e){this.inputEdition.val(e)},actionSave:function(){var e=this.inputEdition.val();this.setValue(e,!1),this.input.html(e),this.input.val(e)},getTemplateName:function(){return"text"},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur((function(){var t=$(this);if("hidden"!==$(t).attr("type")&&"none"!==$(t).css("display")&&"hidden"!==$(t).css("visibility"))if(t.data("oldValue")&&""!==$(this).data("oldValue"))t.val()!==t.data("oldValue")?(e.setValue(""),t.val(""),t.data("oldValue",""),t.tooltip("destroy"),t.attr("title",e.getResource("render-text-retype-error")),t.tooltip(),t.tooltip("open"),setTimeout((function(){t.focus()}),100)):(t.data("newValue",t.val()),t.data("oldValue",""),t.tooltip("destroy"));else{if(""===t.val()||t.val()===t.attr("newValue"))return;t.data("oldValue",t.val()),t.val("");try{t.tooltip("destroy")}catch(e){}t.attr("title",e.getResource("render-number-retype")),t.tooltip(),t.tooltip("open"),setTimeout((function(){t.focus(),i.focus()}),100)}}))}}),bizagi.rendering.extendedText.extend("bizagi.rendering.extendedText",{TEXTAREA_LINE_HEIGHT:14},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonlyExtendedText");return $.kendoTmpl(e)},renderSingle:function(){var e=this,t=e.properties,i=e.getContainerRender();e.element=i,t.editable?(e.input=i.find(".bz-rn-text-extended"),i.addClass("bz-command-edit-inline"),$(e.input).bind("keyup",(function(){e.calculateHeight(this),e.setValue(e.input.val(),!1)}))):(e.input=i.find(".bz-rn-text-extended pre"),i.addClass("bz-rn-non-editable"))},postRenderSingle:function(){var e=this.properties,t=this.getControl();this.textarea=t.find("textarea"),e.maxLength>0&&this.textarea.prop("maxlength",e.maxLength),e.maxLines?(this.hasMaxLines=!0,this.textarea.prop("rows",e.maxLines)):(this.hasMaxLines=!1,this.textarea.prop("rows",6)),this._super()},setDisplayValue:function(e){var t=this.properties,i=bizagi.util.decodeURI(e);if(e="string"==typeof i?i:"",this._super(e),e&&t.editable){var r=$.br2nl(e);if(this.textarea.val(r),!this.hasMaxLines){var a=this.input.val().split("\n");this.input.prop("rows",a.length+1)}}},renderEdition:function(){},setDisplayValueEdit:function(e){},actionSave:function(){},calculateHeight:function(e){var t=e,i=t.scrollHeight;i>t.clientHeight&&!this.hasMaxLines&&$(t).css("height",i+2*this.Class.TEXTAREA_LINE_HEIGHT+"px")}}),bizagi.rendering.label.extend("bizagi.rendering.label",{},{renderSingle:function(){var e=this.properties,t=this.getContainerRender();e.editable=!1,this.getArrowContainer().hide(),this.properties.editable||this.getContainerRender().addClass("bz-rn-non-editable"),t.addClass("ui-bz-rn-label-only"),this._super()}}),bizagi.rendering.number.extend("bizagi.rendering.number",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonlyNumber");return $.kendoTmpl(e,{})},renderSingle:function(){var e=this.properties,t=this.getContainerRender(),i=this.getControl();e.editable?(this.numericInput=this.input=i.find("input"),t.addClass("bz-command-edit-inline"),this.input.removeAttr("readonly"),","==e.decimalSymbol&&this.input.attr("lang","en-150"),this.configureHandlers()):(this.numericInput=this.input=i.find(".ui-bizagi-render-numeric"),t.addClass("bz-rn-non-editable"),t.find("i").addClass("bz-rn-icon-readonly").addClass("bz-mo-icon").addClass("bz-number-icon"))},postRenderSingle:function(){this._super(),"double"===this.properties.retype&&this.attachRetypeDouble()},executeFormatCurrencyPlugin:function(){var e=this.properties;this._super(),!e.editable&&e.percentage&&this.numericInput.text(this.input.text()+"%")},setDisplayValue:function(e){this.setValue(e,!1),this.properties.editable?(this.input.html(e),this.input.val(e),this.executeFormatCurrencyPlugin()):this.input.text(this.getDisplayValue())},configureHandlers:function(){var e=this,t=e.input;e.properties;e.numericInput=t,e.attachFormatCurrency(),e.input.numeric(e.properties.decimalSymbol),e.input.blur((function(){var t=e.input.val();(""===t||!bizagi.util.isNumeric(t)&&0===e.properties.value)&&(e.setValue("",!1),e.input.html(""),e.input.val(""))}))},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur((function(){var t=$(this);e.retypeDouble(t)}))},retypeDouble:function(e){if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===e.val())return;if(e.val()!==e.data("oldValue")){this.setValue(""),e.val(""),e.data("oldValue","");try{e.tooltip("destroy")}catch(e){}e.attr("title",this.getResource("render-number-retype-fail")),e.tooltip(),e.tooltip("open"),setTimeout((function(){e.focus()}),100)}else{e.data("newValue",e.val()),e.data("oldValue","");try{e.tooltip("destroy")}catch(e){}}}else{if(""===e.val()||e.val()===e.attr("newValue"))return;e.data("oldValue",e.val()),e.val("");try{e.tooltip("destroy")}catch(e){}e.attr("title",this.getResource("render-number-retype")),e.tooltip(),e.tooltip("open"),setTimeout((function(){e.focus()}),100)}}}),bizagi.rendering.numberScientificNotation.extend("bizagi.rendering.numberScientificNotation",{},{renderSingle:function(){var e=this.getControl(),t=this.properties,i=this.getContainerRender();this.inputDisplay=$("input",e).first(),this.numericInput=this.input=e.find("input").length>1?$("input",e).last():e.append('<span class="bz-rn-non-editable bz-rn-align-class bz-rn-text"></span>').find("span"),this.numericInput.numericSN(this.properties.decimalSymbol),this.attachFormatSientificNotation(),t.editable?(i.addClass("bz-command-edit-inline"),this.numericInput.removeAttr("readonly"),this.inputDisplay.removeAttr("readonly")):(i.addClass("bz-rn-non-editable"),this.numericInput.addClass("bz-rn-icon-readonly").addClass("bz-mo-icon").addClass("bz-specialnumbers-input"),this.numericInput.attr("readonly","readonly"),this.inputDisplay.attr("readonly","readonly"))},setDisplayValue:function(e){var t=this.properties,i=(e=bizagi.util.scientificNotationFormat(e,t.decimalSymbol,38),bizagi.util.scientificNotationFormat(e,t.decimalSymbol,15));this.numericInput.val(e),this.inputDisplay.val(i),this.numericInput.html(i),this.value=this.properties.value=e},attachFormatSientificNotation:function(){var e=this;e.inputDisplay.focus((function(){$(this).val(e.getDisplayValue())})),e.inputDisplay.blur((function(){void 0===e.getFormContainer().validationController&&(e.getFormContainer().validationController=new bizagi.command.controllers.validation(e.getFormContainer(),e.validations));var t=bizagi.util.scientificNotationFormat(e.inputDisplay.val(),e.properties.decimalSymbol,38),i=bizagi.util.scientificNotationFormat(e.inputDisplay.val(),e.properties.decimalSymbol,15);e.numericInput.val(t),e.inputDisplay.val(i),e.setValue(t)}))}}),bizagi.rendering.money.extend("bizagi.rendering.money",{},{renderReadOnly:function(){var e=this._super(),t=this.renderFactory.getTemplate("readonlyNumber"),i=$($.kendoTmpl(t,{value:e}));return $(".bz-rn-icon",i).removeClass("bz-rn-icon-number").removeClass("bz-number-icon").addClass("bz-coin-input").addClass("bz-rn-icon-coin"),i.get(0).outerHTML},renderSingle:function(){var e=this.properties,t=this.getContainerRender(),i=this.getControl();e.editable?(this.numericIcon=$("span",i),this.numericIcon.removeClass("bz-number-icon").addClass("bz-coin-input"),this.numericInput=this.input=i.find("input"),t.addClass("bz-command-edit-inline"),this.input.removeAttr("readonly"),","==e.decimalSymbol&&this.input.attr("lang","en-150"),this.configureHandlers()):(this.numericInput=this.input=i.find(".ui-bizagi-render-numeric"),t.addClass("bz-rn-non-editable"))},postRenderSingle:function(){this._super()},setDisplayValue:function(e){var t=this.properties;this.setValue(e,!1),t.editable?(this.input.html(e),this.input.val(e)):this.input.text(e),this.executeFormatCurrencyPlugin()},executeFormatCurrencyPlugin:function(){var e=this.properties;this.input.formatCurrency({symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,roundToDecimalPlace:e.numDecimals,colorize:e.colorize})},configureHandlers:function(){var e=this,t=e.input;e.properties;e.numericInput=t,e.attachFormatCurrency(),e.executeFormatCurrencyPlugin(),e.input.numeric(e.properties.decimalSymbol),e.input.blur((function(){var t=e.input.val();(""===t||!bizagi.util.isNumeric(t)&&0===e.properties.value)&&(e.setValue(0,!1),e.input.html(0),e.input.val(0),e.executeFormatCurrencyPlugin())}))},getTemplateName:function(){return"text"}}),bizagi.rendering.date.extend("bizagi.rendering.date",{DEFAULT_PROPERTIES:{maxYearsToDisplay:100}},_defineProperty({renderSingle:function(){var e=this.properties,t=this.getContainerRender(),i=this.getControl();e.editable?this.input=this.getDateControl():(t.addClass("bz-rn-non-editable"),this.input=i.find("span").addClass("bz-rn-date-control"))},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.kendoTmpl(e,{})},postRenderSingle:function(){var e=this;e._super();var t=e.getDateControl(),i=e.properties.showTime?["calendar","time"]:["calendar"],r=e.getFormattedDate(e.properties.value,e.properties.showTime,!0),a=e.getFormattedDate(e.properties.minValue,e.properties.showTime,!1),n=e.getFormattedDate(e.properties.maxValue,e.properties.showTime,!1),o=e.properties.showTime?e.getTimeFormat():"";if(isNaN(Date.parse(a))&&((a=new Date).setFullYear(a.getFullYear()-e.Class.DEFAULT_PROPERTIES.maxYearsToDisplay),a.setHours(0,0,0,0)),isNaN(Date.parse(n))&&((n=new Date).setFullYear(n.getFullYear()+e.Class.DEFAULT_PROPERTIES.maxYearsToDisplay),n.setHours(23,59,59)),$(".bz-calendar-input",e.control).click((function(){t.click()})),e.isValidMinMaxValue()||(e.setValue(""),e.input.prop("value",""),e.properties.displayValue=""),t.mobiscroll().calendar({mode:"mixed",display:"bottom",controls:i,min:a,max:n,defaultValue:r,timeFormat:o,showScrollArrows:!0,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||"en",buttons:["set",{text:this.getResource("render-plugin-search-users-clear-button-name"),handler:function(t,i){e.date=void 0,e.time=void 0,e.timeS=void 0,e.onChangeHandler(!0),i.clear()}},"cancel"],onSet:function(t,i){var r=i.getVal();e.date={day:r.getDate(),month:r.getMonth(),year:r.getFullYear()},e.properties.showTime&&(e.time={hours:r.getHours(),minutes:r.getMinutes()},e.is24h||(e.timeS=r.getHours()<12?"am":"pm")),e.onChangeHandler()},onBeforeShow:function(t,i){e.triggerGlobalHandler("modalViewDidAppear",{}),e.changeMinValue(e.properties.minValue),e.changeMaxValue(e.properties.maxValue),bizagi.util.isiOSDevice()&&$(".ui-bizagi-notifications-container").css("display","none")},onClose:function(t,i){e.triggerGlobalHandler("modalViewDidDisappear",{}),$(".mbsc-fr-scroll").css("overflow-y","auto")},onShow:function(e,t){$(".mbsc-fr-scroll").css("overflow-y","hidden")}}),t.on("focus",(function(e){e.preventDefault(),e.stopPropagation(),bizagi.util.isCordovaSupported()&&bizagi.util.isAndroidDevice()&&(cordova.plugins.Keyboard.disableScroll(!0),cordova.plugins.Keyboard.close())})),""===e.properties.displayValue&&e.properties.value){var s=e.getFormattedDate(e.properties.value,e.properties.showTime,!0,!1),l=bizagi.util.dateFormatter.formatDate(s,e.properties.fullFormat);e.input.prop("value",l)}t.attr("keyboard","disable")},getTimeFormat:function(){return-1!==this.properties.timeFormat.indexOf("H")||-1!==this.properties.timeFormat.indexOf("HH")?(this.is24h=!0,"HH:ii"):(this.is24h=!1,"hh:ii A")},getFormattedDate:function(e,t,i){if(e&&!bizagi.util.isObjectEmpty(e)){var r=t&&("0:0"===this.getTime()||i)?" "+e.substr(e.length-8,e.length):"";e=bizagi.util.dateFormatter.getDateFromInvariant(i&&t&&r.split("/").length>1||1===e.split(":").length?e+=" 00:00:00":e,t);var a=this.setHour(this.getFullFormatedDate(e,t?""!==r?r:" "+this.getTime():" 00:00"));return a=bizagi.util.dateFormatter.getDateFromISO(a,!0)}},changeMinValue:function(e){var t=this.properties,i=this.getDateControl();e&&this.properties.editable&&("number"==typeof e?(e=new Date(e),i.mobiscroll("option",{min:e}),e=bizagi.util.dateFormatter.formatInvariant(e,t.showTime)):i.mobiscroll("option",{min:bizagi.util.dateFormatter.getDateFromInvariant(e,!0)}),t.minValue=e)},changeMaxValue:function(e){var t=this.properties,i=this.getDateControl();e&&this.properties.editable&&("number"==typeof e?(e=new Date(e),i.mobiscroll("option",{max:e}),e=bizagi.util.dateFormatter.formatInvariant(e,t.showTime)):i.mobiscroll("option",{max:bizagi.util.dateFormatter.getDateFromInvariant(e,!0)}),t.maxValue=e)},setDisplayValue:function(e){var t=this.properties,i=this.getFormattedDate(e,t.showTime,!1),r=this.preprocessDateValue(i);t.editable?(this.input.html(r),this.input.prop("value",r)):this.input.text(r)},clearDisplayValue:function(){this.date=void 0,this.time=void 0,this.timeS=void 0,this.onChangeHandler(!0),this.setDisplayValue("")},getDateControl:function(){return $("input.bz-rn-date-control",this.getControl())},getTime:function(){if(this.properties.showTime&&this.time&&""!==this.time.minutes){var e=this.time.hours+":"+this.time.minutes;return-1!=(e+=this.timeS).indexOf("am")&&12==this.time.hours&&(e=e.replace("12","0")),-1!=e.indexOf("pm")&&this.time.hours<12&&(e=e.replace(this.time.hours,parseInt(this.time.hours)+12)),e.replace(/(am|pm)/,"")}return""},getDate:function(){return this.date&&""!==this.date.month?this.date.year+"-"+(parseInt(this.date.month)+1)+"-"+this.date.day:""},onChangeHandler:function(e){var t=this.properties,i=this.getDate(),r=t.showTime?" "+this.getTime():" 0:00";if(""===i&&!t.showTime||""===i&&""===r||e)this.setValue(""),this.input.prop("value",""),t.displayValue="";else{var a,n=this.setHour(this.getFullFormatedDate(i,r)),o=bizagi.util.dateFormatter.getDateFromISO(n,!0);if(!o||0===o)return;this.setNewDateValue(o,t.showTime),a=this.preprocessDateValue(o),t.displayValue=a,this.input.prop("value",this.properties.displayValue)}},getFullFormatedDate:function(e,t){var i="";i=e.length>0?e:void 0!==e?bizagi.util.dateFormatter.formatISO(e,!1):bizagi.util.dateFormatter.formatISO(new Date,!1),i+=t;var r=bizagi.util.dateFormatter.getDateFromFormat(i,"yyyy-MM-dd H:m");return bizagi.util.dateFormatter.formatDate(0!==r?r:e,"yyyy-MM-dd H:mm:ss")},setNewDateValue:function(e,t){var i=""!=e?bizagi.util.dateFormatter.formatInvariant(e,t):"";this.setValue(i)},applyDateFormat:function(e,t){if(!t){var i=null,r=(i=-1!=e.indexOf("00:00")?e.indexOf("00:00"):-1!=e.indexOf("0:00")?e.indexOf("0:00"):-1!=e.indexOf("12:00")?e.indexOf("12:00"):"-1")+8;e=-1===i?e:e.replace(e.substring(i,r),"").replace(" am","").replace(" pm","")}return e},preprocessDateValue:function(e){var t=this.properties;return bizagi.util.dateFormatter.formatDate(e,t.fullFormat)},isValid:function(e){var t=this.properties,i=!0,r=this.getValue();if(r&&bizagi.util.parseBoolean(t.editable)&&0!=(r=bizagi.util.dateFormatter.getDateFromInvariant(r))&&(r.setHours(0,0,0,0),t.minValue&&"string"==typeof t.minValue&&(i=!this.validateMinAndMaxValue(r,!0,t,e)&&i),t.maxValue&&"string"==typeof t.maxValue&&(i=!this.validateMinAndMaxValue(r,!1,t,e)&&i)),bizagi.util.parseBoolean(t.editable))if(t.required&&this.hasValue()){var a=this.getDateControl();a.length>0&&a.val().length<=0&&(i=this.showMandatoryMessage(t,e))}else t.required&&!this.hasValue()&&this.showMandatoryMessage(t,e);return i&&this.setValidationMessage(""),i},validateMinAndMaxValue:function(e,t,i,r){var a=bizagi.util.dateFormatter.getDateFromInvariant(t?i.minValue:i.maxValue);if(a.setHours(0,0,0,0),t&&e<a||!t&&e>a){var n=t?this.getResource("render-date-minimum-validation").replaceAll("#label#",i.displayName).replaceAll("#minValue#",bizagi.util.dateFormatter.formatDate(a,i.fullFormat)):this.getResource("render-date-maximum-validation").replaceAll("#label#",i.displayName).replaceAll("#maxValue#",bizagi.util.dateFormatter.formatDate(a,i.fullFormat));return r.push({xpath:i.xpath,message:n}),!0}return!1},showMandatoryMessage:function(e,t){var i=this.getResource("render-required-text").replaceAll("#label#",e.displayName);return t.push({xpath:e.xpath,message:i}),!1},setHour:function(e){return e.replace(" 0:"," 00:").replace(" 1:"," 01:").replace(" 2:"," 02:").replace(" 3:"," 03:").replace(" 4:"," 04:").replace(" 5:"," 05:").replace(" 6:"," 06:").replace(" 7:"," 07:").replace(" 8:"," 08:").replace(" 9:"," 09:")},isValidMinMaxValue:function(){var e=!0,t=this.getValue();return t&&0!==(t=bizagi.util.dateFormatter.getDateFromInvariant(t))&&(t.setHours(0,0,0,0),this.properties.minValue&&"string"==typeof this.properties.minValue&&(e=this.validateMinAndMaxValue(t,!0)),this.properties.maxValue&&"string"==typeof this.properties.maxValue&&(e=this.validateMinAndMaxValue(t,!1))),e}},"validateMinAndMaxValue",(function(e,t){var i=t?this.properties.minValue:this.properties.maxValue,r=bizagi.util.dateFormatter.getDateFromInvariant(i);return r.setHours(0,0,0,0),!(t&&e<r||!t&&e>r)}))),bizagi.rendering.yesno.extend("bizagi.rendering.yesno",{},{renderSingle:function(){var e=this,t=e.getControl(),i=e.properties,r=e.getContainerRender();i.editable?(null!=e.value&&void 0!==e.value||null==e.properties.value||(e.value=i.value),e.input=e.getControl().find("> div"),r.addClass("bz-command-edit-inline"),e.input.change((function(){var t=e.input.find("input:radio:checked").prop("value");e.value!==t&&(e.setValue(t),e.setDisplayValue(t),e.properties.submitOnChange&&e.submitOnChange())}))):(r.addClass("bz-rn-non-editable"),e.input=t.append('<span class="bz-rn-non-editable bz-rn-align-class bz-rn-text"></span>').find("span"))},getElementsToStylize:function(e){return this.properties.editable?$(".bz-rn-yesno",e):$(e)},setDisplayValue:function(e){var t=this.properties;if(this.setValue(e.toString().toLowerCase(),!1),t.editable){var i=bizagi.util.parseBoolean(e);this.input.find(".bz-radio-true").prop("checked",!0===i).toggleClass("bz-unchecked",!0!==i).toggleClass("bz-check",!0===i),this.input.find(".bz-radio-false").prop("checked",!1===i).toggleClass("bz-unchecked",!1!==i).toggleClass("bz-check",!1===i)}else this._super(e)}}),bizagi.rendering.check.extend("bizagi.rendering.check",{},{postRenderSingle:function(){var e=this,t=(e.getControl(),e.properties),i=e.getContainerRender();e.configureHelpText(),e.element.find(".bz-container-render-cell > .ui-bizagi-render-control").addClass("bz-check-control"),e.element.find(".bz-container-render-cell > .ui-bizagi-label").addClass("bz-check-label"),e.element.find(".bz-container-render-cell > .ui-bizagi-render-control").insertBefore(e.element.find(".bz-container-render-cell > .ui-bizagi-label")),e.input=e.getControl().find("input"),t.editable?(i.addClass("bz-command-edit-inline"),e.input.bind("click",(function(){var t=e.input.is(":checked");if(e.setValue(t,!0),t?e.input.removeClass("bz-unchecked").addClass("bz-check"):e.input.addClass("bz-unchecked").removeClass("bz-check"),e.properties.submitOnChange&&e.submitOnChange(),e.properties.required&&!t){var i=e.element.find(".ui-bizagi-label .bz-rn-required");i.length>0?i.show():e.element.find(".ui-bizagi-label").prepend('<div class="bz-rn-required"></div>')}}))):i.addClass("bz-rn-non-editable")},setDisplayValue:function(e){var t=this.properties;this.setValue(e,!1);var i="";i=t.editable?bizagi.util.parseBoolean(e):bizagi.util.parseBoolean(this.properties.value),this.input.prop("checked",!0===i),this.input.toggleClass("bz-check",!0===i).toggleClass("bz-unchecked",!0!==i)}}),bizagi.rendering.list.extend("bizagi.rendering.list",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly"),t=this.properties.value&&this.hasValue()?this.properties.value.value:"- -";return $.kendoTmpl(e,{value:t})},renderSingle:function(){var e=this.getControl(),t=this.getContainerRender();this._super(),this.properties.editable?this.list=$(".ui-bizagi-render-list",e):(t.addClass("bz-rn-non-editable"),this.list=e.find("span"),this.list.attr("readonly","readonly")),this.configureListHandlers()},postRenderSingle:function(){var e=this;e._super(),$.when(e.ready()).done((function(){e.hasValue()?e.getControl().find(".bz-wp-list-clear-icon-list").show(500):(e.getControl().find(".bz-rn-input-selected").html("-------------"),e.getControl().find(".bz-wp-list-clear-icon-list").hide(500))}))},configureListHandlers:function(){var e=this,t=e.getControl();e.list.find(".see-more-icon").bind("click",(function(){var t=e.renderFactory.getTemplate("listModalView"),i=kendo.template(t,{useWithBlock:!1}),r={items:e.properties.data,displayName:e.properties.displayName||"",orientation:e.properties.orientation},a=$($.trim(i(r)));a.kendoMobileModalView({close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),e.configureModalViewHandlers(a),e.triggerGlobalHandler("modalViewDidAppear",{}),a.kendoMobileModalView("open")})),e.list.on("click",".bz-rn-regular-element",(function(){var t={id:$(this).data("value"),value:$(this).text()};e.selectedValue=t.value,e.setValue(t),e.setDisplayValue(t)})),t.find(".bz-rn-first-element-container").on("click",".bz-wp-list-clear-icon-list",(function(){var t={id:"",value:"-------------"};e.setValue(t),e.selectedValue=t.value,e.setDisplayValue(t)}))},configureModalViewHandlers:function(e){var t=this,i=new $.Deferred,r=e.find(".ui-bizagi-render-list-elements li");e.find(".bz-wp-modalview-header-cancel-search").hide(500),e.delegate("#ui-bizagi-cancel-button","click",(function(){i.reject(),e.data("kendoMobileModalView").close()})),e.find(".bz-wp-modalview-header-input-search").bind("change keypress keyup change",(function(){t.filterList(this.value,r,e)})),e.find(".bz-wp-modalview-header-cancel-search").bind("click",(function(){t.filterList("",r,e),e.find(".bz-wp-modalview-header-input-search").val(""),$(this).hide(500)})),t.modalViewList=$(".ui-bizagi-render-list-elements",e),t.setModalViewDisplayValue(),t.modalViewList.on("click","li",(function(){t.modalViewList.find("li").filter((function(){if($(this).hasClass("ui-selected"))return $(this)})).removeClass("ui-selected"),$(this).addClass("ui-selected"),$(".bz-wp-modalview-header-input-search",e).blur()})),e.delegate(".ui-bizagi-apply-button","click",(function(){i.resolve(),e.data("kendoMobileModalView").close()})),e.find(".bz-wp-modalview-close").bind("click",(function(){i.reject(),e.data("kendoMobileModalView").close()})),$.when(i).done((function(){var e=$("li.ui-selected",t.modalViewList),i=$(e).data("value"),r=$(e).text();if(void 0!==i){var a={id:i,value:r};t.setValue(a),t.selectedValue=a.value,t.setDisplayValue(a)}})).fail((function(){}))},filterList:function(e,t,i){""!==e?i.find(".bz-wp-modalview-header-cancel-search").show(500):i.find(".bz-wp-modalview-header-cancel-search").hide(500),t.filter((function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()})).show()},setDisplayValue:function(e){var t=this.getControl();this.properties.editable?void 0!==e&&(t.find(".bz-rn-input-selected").html(e.value),"-------------"===e.value||""===e.value?t.find(".bz-wp-list-clear-icon-list").hide(500):t.find(".bz-wp-list-clear-icon-list").show(500)):this.list.text(e.value)},cleanData:function(){var e={id:"",value:""};this.getControl();this.setValue(e),this.setDisplayValue(e)},setModalViewDisplayValue:function(){var e=this.properties;this.list&&e.editable&&this.properties.value&&void 0!==this.properties.value&&""!==this.properties.value.id&&$("#ui-bizagi-list-"+this.properties.value.id,this.modalViewList).addClass("ui-selected")},configureHandlers:function(){this._super()},getSelectedValue:function(){return this.selectedValue}}),bizagi.rendering.multiSelect.extend("bizagi.rendering.multiSelect",bizagi.rendering.render.base.prototype),bizagi.rendering.multiSelect.extend("bizagi.rendering.multiSelect",{MORE_OPTION_WIDTH:40,SEARCH_MIN_LENGTH:1,temporalElements:{}},{renderSingle:function(){this._super()},postRenderSingle:function(){this.properties.editable?this.configureHandlers():this.configureHandlersReadOnly()},configureHandlers:function(){var e=this.getControl();$(".bz-multiselect__arrow",e).on("click",this.openModalView.bind(this)),$("ul.bz-multiselect__tags",e).on("click","li div.bz-btn-icn",this.onUnselectElement.bind(this)).on("click","li.bz-multiselect__plus",this.onShowSelectedElements.bind(this))},configureHandlersReadOnly:function(){var e=this.getControl();$("ul.bz-multiselect__tags",e).on("click","li.bz-multiselect__plus",this.onShowSelectedElements.bind(this))},onUnselectElement:function(e){var t=$(e.target).data("id");this.removeElement({id:t}),this.addSelectedElements()},onShowSelectedElements:function(e){var t=this,i=$(e.currentTarget).data("index"),r=(t.getDataValue()||[]).slice(i),a=this.renderFactory.getTemplate("list-multiselect-tags"),n=this.showFloatListView(a,{datasource:r,editable:t.properties.editable}),o=$("ul.bz-multiselect__tags",n);o.on("click, mousedown","li div.bz-btn-icn",(function(e){t.onUnselectElement(e),n.remove()})),n.on("closeView",(function(){o.off("click","li div.bz-btn-icn",t.onUnselectElement.bind(t)),n.remove()}))},openModalView:function(){var e=this;e.Class.temporalElements={};var t=e.renderFactory.getTemplate("multiselectModalView"),i=e.getDataValue(),r={selected:i,isChecked:function(t){return e.markAsChecked.call(this,t)}};this.getData().done((function(a){var n={displayName:e.properties.displayName||"",orientation:e.properties.orientation,datasource:a,options:r};try{for(var o=kendo.template(t,{useWithBlock:!1}),s=0,l=i.length;s<l;s++)e.Class.temporalElements[i[s].id]=i[s];var d=$($.trim(o(n)));e.modalListHandlers(d),d.kendoMobileModalView({close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),e.configureModalViewHandlers(d),e.triggerGlobalHandler("modalViewDidAppear",{}),d.kendoMobileModalView("open")}catch(e){bizagi.log(e.message)}}))},configureModalViewHandlers:function(e){var t=this,i=e.find(".bz-multiselect__list li"),r=new $.Deferred;e.find(".bz-wp-modalview-header-cancel-search").hide(500),e.delegate("#ui-bizagi-cancel-button","click",(function(){r.reject(),e.data("kendoMobileModalView").close()})),e.find(".bz-wp-modalview-header-input-search").bind("keypress keyup",(function(){""!==this.value?e.find(".bz-wp-modalview-header-cancel-search").show(500):(e.find(".bz-wp-modalview-header-cancel-search").hide(500),$("#ui-bizagi-wp-filter-results-multiselect-wrapper ul li",e).show()),t.filterList(this.value,i)})).focus((function(){e.find(".filter-searchlist-modal-view-tags").addClass("searching")})).blur((function(){e.find(".filter-searchlist-modal-view-tags").removeClass("searching")})),e.find(".bz-wp-modalview-header-cancel-search").bind("click",(function(){$("#ui-bizagi-wp-filter-results-multiselect-wrapper ul li",e).show(),e.find(".bz-wp-modalview-header-input-search").val(""),$(this).hide(500)})),e.delegate(".ui-bizagi-apply-button","click",(function(){r.resolve(),e.data("kendoMobileModalView").close()})),e.find(".bz-wp-modalview-close").bind("click",(function(){r.reject(),e.data("kendoMobileModalView").close()})),e.find(".filter-searchlist-modal-view-tags").on("click",".bz-rn-remove-tag-on-search-list",(function(){t.removeItem($(this),!0);var r=e.find(".bz-wp-modalview-header-input-search").val();t.filterList(r,i)})),$.when(r).done((function(){t.addNewValuesToInput(),t.Class.temporalElements={}})).fail((function(){t.Class.temporalElements={}}))},addNewValuesToInput:function(){var e=[];$.each(this.Class.temporalElements,(function(t,i){e.push(i)})),this.setValue(e),this.addSelectedElements()},postRenderReadOnly:function(){this._super()},addSelectedElements:function(){var e=this.getControl(),t=this.getDataValue(),i=t.length,r=$("ul.bz-multiselect__tags",e),a=this.properties.editable;if(r.empty(),i>0)for(var n=this.renderFactory.getTemplate("list-multiselect-tag"),o=0;o<i;o++){var s=t[o],l={id:s.id,value:s.value,editable:a},d=kendo.template(n,{useWithBlock:!1}),u=$($.trim(d(l)));if(r.append(u),this.processControlLayout(this.properties.valueFormat||{}),!this.canAddMoreItems(r)){r.children().last().remove();l={value:i-o,index:o};var c=kendo.template(this.renderFactory.getTemplate("list-multiselect-view-more"),{useWithBlock:!1}),p=$($.trim(c(l)));r.append(p);break}}},modalListHandlers:function(e){var t=this,i=e.find(".bz-multiselect__list li"),r=i.find("input[type=checkbox]");e.find(".bz-multiselect__search_input").bind("change keypress keyup mousedown",(function(e){e.stopPropagation(),t.filterList(this.value,i)})),r.change((function(){var e=$(this),i=e.is(":checked"),r={id:e.data("id"),value:e.data("value")};i?t.addTemporalElement(r,!1):t.addTemporalElement(r,!0)})),e.on("closeView",(function(){t.closeFloatView(),$(document).unbind("mousedown.multiselect")}))},addTemporalElement:function(e,t){t?delete this.Class.temporalElements[e.id]:this.Class.temporalElements[e.id]=e},showFloatListView:function(e,t){var i=this.getControl(),r=$(".bz-multiselect",i),a=i.closest(".ui-bizagi-render-control"),n=kendo.template(e,{useWithBlock:!1}),o=$($.trim(n(t))),s=r.width();return a.append(o),o.width(s),o.position({my:"left top",at:"left bottom",of:r,collision:"fit"}).hide(),o.show(),o.on("mousedown",(function(e){return e.preventDefault(),!1})),$(document).one("mousedown.multiselect",(function(e){o.trigger("closeView")})),o}}),bizagi.rendering.radio.extend("bizagi.rendering.radio",{},{renderSingle:function(){var e=this,t=e.properties,i=e.getContainerRender(),r=$.Deferred();return e.getArrowContainer().hide(),$.when(e.renderControl()).done((function(){e.input=e.combo=$(".ui-bz-render-radio",e.getControl()),e.value&&e.setValue(e.value,!1),t.editable?(i.addClass("bz-command-edit-inline"),e.input.change((function(){var t=e.input.find("input:radio:checked");e.input.find(".checked").removeClass("checked"),e.input.find(".bz-check").addClass("bz-unchecked").removeClass("bz-check"),t.closest("div").addClass("checked"),t.addClass("bz-check"),t.removeClass("bz-unchecked");var i={id:t.prop("value"),value:t.parent().text()};e.setValue(i)}))):(i.addClass("bz-rn-non-editable"),e.input=e.combo=e.getControl().html('<span class="bz-rn-non-editable bz-rn-align-class bz-rn-text"></span>').find("span")),r.resolve()})),r.promise()},setDisplayValue:function(e){var t=this.properties;if(void 0!==e&&null!=e.id)if(t.editable){var i=this.input.find("input[type='radio'][value='"+e.id+"']");i.prop("checked","checked"),i.closest("div").addClass("checked"),i.addClass("bz-check").removeClass("bz-unchecked")}else this.input.html(e.value?e.value.toString():""),this.input.attr("id",e.id)},cleanData:function(){var e={id:"",label:""};this.element.find(".checked").removeClass("checked").find(".bz-rn-radio-item").prop("checked",!1).removeClass("bz-check").addClass("bz-unchecked"),this.setValue(e,!1),this.setDisplayValue(e)}}),bizagi.rendering.cascadingCombo.extend("bizagi.rendering.cascadingCombo",{},{init:function(e){var t=this;t._super(e),this.properties.data=this.properties.data||[],t.bind("select",(function(e,i){t.onComboChange(i)}))},renderReadOnly:function(){return bizagi.rendering.combo.prototype.renderReadOnly.apply(this,arguments)},renderSingle:function(){var e=this;e._super();var t=e.getParentCombo();null!==t&&"cascadingCombo"==t.properties.type&&(e.isDependant=!0,t.dependants.push(e),null!=e.getValue()?e.properties.parentComboValue=e.getValue().id:e.initializingCascadingCombo=!0),e.initialValueSet=!0,$.when(bizagi.rendering.combo.prototype.renderSingle.apply(e,arguments)).done((function(){e.value&&0==e.isDependant&&e.triggerHandler("select",e.value),e.initialValueSet=!1}))},postRenderSingle:function(){bizagi.rendering.combo.prototype.postRenderSingle.apply(this,arguments)},renderEdition:function(){bizagi.rendering.combo.prototype.renderEdition.apply(this,arguments)},configureCombo:function(){bizagi.rendering.combo.prototype.configureCombo.apply(this,arguments)},configureModalViewHandlers:function(){bizagi.rendering.combo.prototype.configureModalViewHandlers.apply(this,arguments)},filterList:function(){bizagi.rendering.combo.prototype.filterList.apply(this,arguments)},setModalViewDisplayValue:function(){bizagi.rendering.combo.prototype.setModalViewDisplayValue.apply(this,arguments)},setDisplayValue:function(){bizagi.rendering.combo.prototype.setDisplayValue.apply(this,arguments)},setValue:function(e,t){t=void 0===t||t,""===e&&(e={id:"",value:""}),e&&(null!==this.value&&this.value.id===e.id||this.triggerHandler("select",e),this._super(e,t))},findDataValueById:function(e){return(this.properties.data||[]).find((function(t){return t.id==e}))},cleanData:function(){bizagi.rendering.combo.prototype.cleanData.apply(this,arguments)},resetData:function(){bizagi.rendering.combo.prototype.resetData.apply(this,arguments)},processComboData:function(e){bizagi.rendering.combo.prototype.processComboData.apply(this,arguments)},validateValue:function(e){bizagi.rendering.combo.prototype.validateValue.apply(this,arguments)},getSelectedValue:function(){return bizagi.rendering.combo.prototype.getSelectedValue.call(this,arguments)},onComboChange:function(e){var t=this;t.selectedValue=e.value;var i={};i[t.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=e.id,$.each(this.dependants,(function(r,a){a.properties.params=i,a.properties.parentComboValue=e.id,""==e.id?(a.resetData(),a.setDisplayValue({id:"",value:""})):$.when(a.getData(i)).done((function(e){if(a.properties.data=e,null!==a.value){var i=a.findDataValueById(a.value.id);i?""==i.id&&t.value&&""==t.value.value?(a.resetData(),a.setDisplayValue({id:"",value:""})):a.triggerHandler("select",i):(a.setDisplayValue({id:"",value:""}),a.triggerHandler("select",{id:"",value:""}))}else a.triggerHandler("select",{id:"",value:""})}))}))},getTemplateName:function(){return"combo"}}),bizagi.rendering.combo.extend("bizagi.rendering.combo",{},{renderReadOnly:function(){this._super();var e=this.renderFactory.getTemplate("readonlyCombo");return $.kendoTmpl(e,{})},renderSingle:function(){var e=this;e._super();var t=e.properties,i=e.getContainerRender(),r=e.getControl(),a={};e.showDisplayValue=!1,e.input=$(".bz-rn-combo-control",r),t.parentComboValue&&null!=t.parentComboValue&&(a[e.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t.parentComboValue,e.showDisplayValue=e.parentCombo&&e.parentCombo.value&&""!==e.parentCombo.value.value&&e.properties.value&&e.properties.value.value),t.editable?void 0===e.initialValueSet||e.initialValueSet?e.configureCombo():$.when(e.renderCombo(a)).done((function(t){e.getControl().html(t),e.input=e.combo=e.getControl(),e.configureCombo(),e.processLayout(!1,e.properties.valueFormat||{})})):(e.inputSpan=$(".bz-rn-text",r),i.addClass("bz-rn-non-editable bz-command-edit-inline"),null!=e.value&&e.inputSpan.text(e.value.value||e.value.id))},postRenderSingle:function(){var e=this.properties,t=this.getContainerRender();e.editable&&t.addClass("bz-command-edit-inline"),this._super()},renderEdition:function(){},configureCombo:function(){var e=this;e.inputSpan=e.input.find(".bz-rn-cm-text-label"),e.inputSpan.html($("option:selected",e.input).text()),e.inputSpan.val($("option:selected",e.input).text()),$(".bz-rn-container-combo",e.getControl()).unbind().bind("click",(function(){e.input.find(".bz-rn-combo-control").blur(),$(e.input).blur(),e.input.attr("keyboard","disable"),e.processComboData(e.properties.data);var t=e.renderFactory.getTemplate("comboModalView"),i=kendo.template(t,{useWithBlock:!1}),r={items:e.properties.data,displayName:e.properties.displayName||"",orientation:e.properties.orientation},a=$($.trim(i(r)));a.kendoMobileModalView({close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),e.configureModalViewHandlers(a),e.triggerGlobalHandler("modalViewDidAppear",{}),a.kendoMobileModalView("open")}))},processComboData:function(e){var t=this;e.forEach((function(e){t.validateValue(e)}))},validateValue:function(e){if(null!=e.id&&("number"==typeof e.id&&null!==e.id||"string"==typeof e.id&&e.id.length>0)){if(null!==e.value&&"boolean"==typeof e.value)!0,!0===bizagi.util.parseBoolean(e.value)?e.value=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value)&&(e.value=bizagi.localization.getResource("render-boolean-no"));else if(null!=e.value&&"object"===_typeof(e.value))for(var t=0,i=e.value.length;t<i;t++)null!=e.value[t]&&"boolean"==typeof e.value[t]&&(!0===bizagi.util.parseBoolean(e.value[t])?e.value[t]=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value[t])&&(e.value[t]=bizagi.localization.getResource("render-boolean-no")))}},configureModalViewHandlers:function(e){var t=this,i=new $.Deferred,r=e.find(".bz-wp-modalview-results-list li");e.find(".bz-wp-modalview-header-cancel-search").hide(500),e.delegate("#ui-bizagi-cancel-button","click",(function(){i.reject(),e.data("kendoMobileModalView").close()})),e.find(".bz-wp-modalview-header-input-search").bind("change keypress  keyup change",(function(){t.filterList(this.value,r,e)})),e.find(".bz-wp-modalview-header-cancel-search").bind("click",(function(){t.filterList("",r,e),e.find(".bz-wp-modalview-header-input-search").val(""),$(this).hide(500)})),t.list=$(".bz-wp-modalview-results-list",e),t.setModalViewDisplayValue(t.properties.value||!1),t.inputSpan=e.find(".bz-rn-cm-text-label"),t.inputSpan.html($("li.ui-selected",t.list).text()),t.inputSpan.val($("li.ui-selected",t.list).text()),t.list.find("li").bind("click",(function(){t.list.find("li").filter((function(){if($(this).hasClass("ui-selected"))return $(this)})).removeClass("ui-selected"),$(this).addClass("ui-selected"),t.input.blur(),$(".bz-wp-modalview-header-input-search",e).blur()})),e.delegate(".ui-bizagi-apply-button","click",(function(){i.resolve(),e.data("kendoMobileModalView").close()})),e.find(".bz-wp-modalview-close").bind("click",(function(){i.reject(),e.data("kendoMobileModalView").close()})),$.when(i).done((function(){var e=$("li.ui-selected",t.list),i={id:$(e).data("value"),value:$(e).text()};t.selectedValue=i.value,t.setDisplayValue(i)})).fail((function(){}))},filterList:function(e,t,i){""!==e?i.find(".bz-wp-modalview-header-cancel-search").show(500):i.find(".bz-wp-modalview-header-cancel-search").hide(500),t.filter((function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()})).show()},setModalViewDisplayValue:function(e){this.properties.editable&&e&&null!=e&&""!==e.id&&this.list.find("#ui-bizagi-list-"+e.id).addClass("ui-selected")},setDisplayValue:function(e){if(e&&"object"===_typeof(e)&&void 0!==e.label){var t=""==e.label||bizagi.util.isNumeric(e.label)?this.findDataValueById(e.value).value||"":e.label;$.isArray(t)&&(t=t.join(" - ")),e={id:e.value,value:t}}var i=this.getControl();$("input",i).val(this.formatItem(e.value)),this.setValue(e)},resetData:function(){var e=this.properties;e.hasLocalData=!1,e.data=[],e.remoteDataLoaded=!1},cleanData:function(){this.setDisplayValue({id:"",value:""})},getTemplateName:function(){return"combo"}}),bizagi.rendering.collectionnavigator.extend("bizagi.rendering.collectionnavigator",{},{renderSingle:function(){this.getContainerRender().addClass("bz-command-not-edit")}}),bizagi.rendering.hidden.extend("bizagi.rendering.hidden",{},{render:function(){return this.renderSingle()},renderSingle:function(){return"design"===this.getMode()?"<div>"+bizagi.localization.getResource("render-hidden-displayName")+"</div>":"<div />"},postRenderSingle:function(){var e=this.properties;this._super(),void 0!==e.value&&this.setDisplayValue(e.value)},setDisplayValue:function(e){this.setValue(e,!1)}}),bizagi.rendering.upload.extend("bizagi.rendering.upload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{renderControl:function(){var e=this.renderFactory.getTemplate("upload"),t=!0;this.checkExtensions(),bizagi.util.isCordovaSupported()&&(t=this.validOptions&&(this.validOptions.image||this.validOptions.video));for(var i=$.kendoTmpl(e,{xpath:bizagi.util.encodeXpath(this.getUploadXpath()),editable:this.properties.editable&&t,noFiles:0===this.filesCount,allow_upload:t,nonSupportedExtension:this.nonSupportedExtension,uploadOptions:this.upload_options,allowSendInMail:this.properties.allowSendInMail}),r="",a=0,n=this.filesCount;a<n;a++){var o={id:this.files[a][0],fileName:this.files[a][1]};r+=this.renderUploadItem(o)}return i=this.replaceFilesHtml(i,r)},renderUploadItem:function(e){var t=this.getMode(),i=this.checkImageFile(e.fileName),r=this.renderFactory.getTemplate("uploadItem"),a="execution"!==t?"javascript:void(0);":this.buildItemUrl(e);return $.kendoTmpl(r,{url:a,image:i,allowDelete:this.properties.allowDelete,editable:this.properties.editable,filename:e.fileName,id:e.id,mode:t,isCordovaSupported:bizagi.util.isCordovaSupported()})},postRenderSingle:function(){var e=this.getContainerRender();this.configureHelpText(),this.itemAddfile=$(".bz-rn-upload-show-menu",this.getControl()),this.properties.editable&&!this.itIsMaxNumberFilesReached()&&(bizagi.util.isCordovaSupported()||bizagi.util.media.fileAPISupported())||this.itemAddfile.hide(),this.properties.editable&&(bizagi.util.isCordovaSupported()||bizagi.util.media.fileAPISupported())?(e.addClass("bz-command-edit-inline"),this.buildUploadControl()):e.addClass("bz-rn-non-editable"),this.addInteractions()},buildUploadControl:function(){var e=this,t=e.getControl(),i=$(".bz-rn-upload-web",t);bizagi.util.isCordovaSupported()?($(e.itemAddfile).actionSheet({actions:e.upload_options,actionClicked:function(t){5===t.guid?i.click():e.handlerUploadImage(t.guid)},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-rn-upload-resolution-container",t).actionSheet({actions:bizagi.util.media.getImageResolutionItems(),actionClicked:function(t){bizagi.loading.start(),$.when(e.handlerResolutionUpload(t.guid)).always((function(){bizagi.loading.stop()}))},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})):$(e.itemAddfile).click((function(){i.click()})),i.on("click",(function(e){e.stopPropagation()})),i.on("change",(function(){var t=this.files[0],i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSFILE,e.Class.EXTENSIONSAUDIO,e.Class.EXTENSIONSVIDEO);t.fullPath=this.value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.processUploadFile(t)).then((function(t){e.onUploadFileCompleted(e,JSON.parse(decodeURIComponent(t)))})).fail((function(t){"Unauthorized"===t.statusText&&"ok"===t.statusText.toLowerCase()||bizagi.showMessageBox(e.getResource("workportal-widget-admin-language-error"))})).always((function(){bizagi.loading.stop()})):bizagi.loading.stop(),$(this).val("")})),e.checkMaxFiles(),e.attachDeleteHandler()},addInteractions:function(){var e=this;$("ul.files",e.getControl()).on("click",".ui-bizagi-render-link.button",(function(){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile($(this).attr("data-url"),this.title)).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.loading.stop()}))}))},attachDeleteHandler:function(){var e=this;$(".bz-rn-upload-delete-icon",e.getControl()).on("click",(function(){var t=$(this).parent(".ui-bizagi-render-upload-item"),i=t.data();$.when(e.deleteUploadItem(t,i.id)).done((function(){t.hide(),t.remove(),e.setValue(e.files,!1),e.checkMaxFiles(),e.triggerRenderChange()}))}))},handlerUploadImage:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture((function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then((function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i)){if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then((function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.handlerResolutionUpload(e)}));$(".bz-rn-upload-resolution-container",t.getContainerRender()).click()}}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY});break;case 1:navigator.camera.getPicture((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then((function(i){return t.fileProperties=i,t.saveImage(t,e)}))})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;case 3:navigator.device.capture.captureVideo((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).then((function(){return t.saveVideo(t,e)})).always((function(){bizagi.loading.stop()}))}),t.onFail.bind(t),{limit:t.Class.LIMIT})}},handlerResolutionUpload:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.saveImage(t,t.dataImage);var r=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,r)).then((function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.saveImage(t,t.dataImage)}))},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},checkImageFile:function(e){var t=this.Class.EXTENSIONSIMG;if(!e||bizagi.util.isObjectEmpty(e))return!1;for(var i=0,r=t.length;i<r;i++){if(e.indexOf("."+t[i])>=0)return!0}return!1},getTemplateName:function(){return"upload"},getTemplateItemName:function(){return"uploadItem"},saveImage:function(e,t){var i=e,r={},a=i.buildAddParams(),n=i.fileProperties.name;return i.editedImageURL?r.dataFile=i.editedImageURL:i.fileProperties&&(r.dataFile=i.fileProperties.url),a.queueID="q_"+bizagi.util.encodeXpath(i.getUploadXpath()),r.data=a,r.options=new FileUploadOptions,r.options.fileKey="file",r.options.fileName=n,r.options.mimeType="image/jpeg",r.options.uploadKey={key:a.h_xpath},r.options.addUrl=i.properties.addUrl,i.editedImageURL=null,i.fileProperties=null,r.dataFile=bizagi.util.media.getImagePath(r.dataFile),$.when(bizagi.util.media.uploadFile(r)).then((function(t){var r=JSON.parse(decodeURIComponent(t.response));"error"===r.type?bizagi.showMessageBox(r.message,r.errorType):i.onUploadFileCompleted(e,r)})).fail((function(e){i.executeFormFailHandler(e)}))},saveVideo:function(e,t){var i=e,r={},a=i.buildAddParams();return a.queueID="q_"+bizagi.util.encodeXpath(i.getUploadXpath()),r.data=a,r.options=new FileUploadOptions,r.options.fileName=t[0].name,r.options.mimeType="video/quicktime",r.options.uploadKey={key:a.h_xpath},r.options.addUrl=i.properties.addUrl,r.dataFile=t[0].fullPath,$.when(bizagi.util.media.uploadFile(r)).then((function(t){var r=JSON.parse(decodeURIComponent(t.response));"error"===r.type?bizagi.showMessageBox(r.message,r.errorType):i.onUploadFileCompleted(e,r)})).fail((function(e){i.executeFormFailHandler(e)}))},onFail:function(e){var t=bizagi.util.processFailMessage(e);if(bizagi.loading.stop(),"string"==typeof t&&-1!==t.indexOf("No Activity found to handle Intent")){var i=bizagi.util.isValidResource("render-upload-error-media-app")?bizagi.localization.getResource("render-upload-error-media-app"):"Your device does not have an app to execute this action.";bizagi.showMessageBox(i)}},onUploadFileCompleted:function(e,t){var i=e,r=i.getControl(),a=$(".ui-bizagi-render-upload-container .files",r);if(t.id&&t.fileName){var n=i.renderUploadItem(t);a.append(n),i.filesCount=i.filesCount+1;var o=i.files.slice();o.push([t.id,t.fileName]),i.setValue(o,!0),i.checkMaxFiles(),i.properties.allowDelete&&i.properties.editable&&i.attachDeleteHandler(),i.editedImageURL=null}else bizagi.showMessageBox(t.message,"Error")},isValid:function(e){var t=this._super(e);return t&&this.setValidationMessage(""),t},checkMaxFiles:function(){var e=this.properties,t=this.getControl(),i=e.maxfiles,r=e.value?e.value.length:0;e.editable?0!==i&&this.filesCount>=i&&r>=i?this.itemAddfile.hide():this.itemAddfile.show():0==this.filesCount&&$("#no-files",t).show()},checkExtensions:function(){var e=this.properties.validExtensions||"";this.validOptions={audio:!1,video:!1,image:!1,file:!1},e=e.replace(/\s+/g,"").toLowerCase();var t=[];if(this.nonSupportedExtension="",void 0===e||""===e)this.validOptions={video:!0,image:!0,file:!0};else if(1===(e=e.split(";")).length&&-1!==e[0].indexOf("*.*"))this.validOptions.video=!0,this.validOptions.image=!0;else for(var i=0,r=e.length;i<r;i++)e[i]=e[i].replace("*.",""),this.Class.EXTENSIONSFILE.toString().indexOf(e[i])>=0?this.validOptions.file=!0:this.Class.EXTENSIONSIMG.toString().indexOf(e[i])>=0?this.validOptions.image=!0:this.Class.EXTENSIONSVIDEO.toString().indexOf(e[i])>=0?this.validOptions.video=!0:t.push(e[i]);this.validOptions.file||this.validOptions.image||this.validOptions.video||void 0!==this.itemAddfile&&this.itemAddfile.hide(),this.getUploadChoices(),this.nonSupportedExtension=t.join(", ")||""},itIsMaxNumberFilesReached:function(){var e=this.properties.maxfiles,t=this.properties.value?this.properties.value.length:0;return 0!==e&&t>=e},buildAddFileParams:function(e){var t=this.Class.BA_CONTEXT_PARAMETER_PREFIX,i=new FormData,r=this.getFormContainer();i.append(t+"xpath",this.getUploadXpath()),i.append(t+"idRender",this.properties.id),i.append(t+"xpathContext",this.properties.xpathContext||this.getXpathContext()),i.append(t+this.Class.BA_PAGE_CACHE,this.properties.idPageCache),i.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId),i.append(this.properties.xpath,e),this.properties.contexttype&&i.append(t+"contexttype",this.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?i.append(BIZAGI_SESSION_NAME,r.properties.sessionId):i.append("JSESSIONID",r.properties.sessionId)}catch(e){i.append("JSESSIONID",r.properties.sessionId)}return i},getXpathContext:function(){if((e=this).grid){var e;this.surrogateKey;return(e=this).grid.properties.xpath+"[id="+e.surrogateKey+"]"}return""},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},clearDisplayValue:function(){var e=this;$(".ui-bizagi-render-upload-item",e.getControl()).each((function(t,i){var r=(i=$(i)).data();$.when(e.deleteUploadItem(i,r.id)).done((function(){i.hide(),i.remove(),e.setValue(e.files,!1),e.checkMaxFiles(),e.triggerRenderChange()}))}))},getUploadChoices:function(){var e=[];this.validOptions.file&&bizagi.util.media.fileAPISupported()&&bizagi.util.isAndroidDevice()&&!bizagi.util.isCordovaSupported()&&e.push({guid:5,displayName:bizagi.localization.getResource("render-upload-link-label")}),bizagi.util.isCordovaSupported()&&(this.validOptions.image&&(e.push({guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}),e.push({guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")})),this.validOptions.video&&e.push({guid:3,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-video")})),this.upload_options=[].concat(e)}}),bizagi.rendering.ecm.extend("bizagi.rendering.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav"]},{renderControl:function(e,t){var i=this;return $.when(i._super(e,t)).done((function(e){return e})).fail((function(){return"Error"})).always((function(e){return i.stopLoading(),e}))},changeRequired:function(e){var t=this.getControl();t.find(".bz-rn-ecm-required").remove(),this.properties.required=e,bizagi.util.parseBoolean(e)&&(this.hasValue()?t.prepend('<div class="bz-rn-ecm-required" style="display: none"></div>'):t.prepend('<div class="bz-rn-ecm-required"></div>'),this.setPlaceHolder()),this.triggerRenderValidate()},changeRequiredLabel:function(){var e=this.getControl();e.find(".bz-rn-ecm-required").remove(),this.properties.required&&(this.checkRequired([])?e.prepend('<div class="bz-rn-ecm-required" style="display: none"></div>'):e.prepend('<div class="bz-rn-ecm-required"></div>'))},replaceControlHtml:function(e,t){e=e||"",t=t||"";var i=$(e.replace("{{control}}",t));return""===t&&this.startLoading(i),i.get(0).outerHTML},startLoading:function(e){e=e||this.getRenderedElement(),$(".ui-bizagi-render-control",e).prepend('<div class="innerLoader"></div>').addClass("bz-rn-ecm-control")},stopLoading:function(){$(".innerLoader",this.getControl()).remove()},startWaiting:function(e){var t=e.closest(".bz-rn-ecm-metadata");e.addClass("loading"),t.find("input, a").css("opacity",.6),t.find(".ui-bizagi-render-button, button, input").prop("disabled","disabled"),t.find("input").prop("readonly","readonly")},stopWaiting:function(e){var t=e.closest(".bz-rn-ecm-metadata");t.find("input, a").css("opacity",1),t.find(".ui-bizagi-render-button, button, input").prop("disabled",!1),t.find("input").prop("readonly",!1),t.find(".loading").removeClass("loading")},postRenderSingle:function(){var e=this,t=e.properties,i=e.getControl(),r=e.getContainerRender(),a=e.getControl();if(e.itemAddfile=$(".bz-rn-ecm-upload",i),e.$inputFile=$(".bz-rn-upload-files-web",a),i.addClass("bz-command-edit-inline"),setTimeout((function(){a.parent().find(".ui-bizagi-label").hide()}),100),a.find(".bz-rn-ecm-url a").length>0){var n=a.find(".bz-rn-ecm-url a").attr("onclick").replace("../../","");a.find(".bz-rn-ecm-url a").attr("onclick",n)}if(bizagi.util.isNativePluginSupported()){var o=a.find(".bz-rn-ecm-url a");o.removeAttr("onclick"),o.on("click",(function(){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile($(this).attr("data-url"),this.title)).fail((function(t){t.responseText&&e.getFormContainer().failHandler(t.responseText)})).always((function(){bizagi.loading.start()}))}))}if(e.configureHelpText(),e.closeAccordionSection(),t.editable?r.addClass("bz-command-edit-inline"):r.addClass("bz-rn-non-editable"),$(".bz-rn-ecm-activate-menu",a).bind("click",(function(){var t=$(this),i=t.parents(".bz-rn-ecm-metadata"),r=$(".bz-rn-ecm-menu-container",i);$(this).is(".active")||$(".bz-rn-ecm-metadata-container",i).is(".active")?$(".bz-rn-ecm-metadata-container",i).is(".active")||($(this).removeClass("active"),e.closeAccordionSection()):(e.closeAccordionSection(),$(this).addClass("active"),r.addClass("showMenu"));var a=t.parent().data("idfileupload")||"";e.elementsEvent={menu:r,lock:$(".bz-ecm-lock",r),unlock:$(".bz-ecm-unlock",r),del:$(".bz-ecm-delete",r),edit:$(".bz-ecm-edit",r),element:{id:a,filename:t.parent().attr("title")||"",elementReference:this},params:{idFileUpload:a,xPath:e.properties.xpath,idAttrib:e.properties.idAttrib,idPageCache:e.properties.idPageCache,xpathContext:e.getXpathContext()},panelMetadata:$(".bz-rn-ecm-metadata-container",i),btnCancel:$(".ecm-btn-cancel",i),btnSave:$(".ecm-btn-save",i)},r.is(":visible")?e.addEventsEcm():e.removeEventsEcm()})),t.editable)if(bizagi.util.isCordovaSupported()){var s=e.checkExtensions();$(e.itemAddfile).actionSheet({actions:s,actionClicked:function(t){e.handlerUploadImage(t.guid)}}),e.checkMaxFiles()}else bizagi.util.media.fileAPISupported()?$(e.itemAddfile).off("click").click((function(){e.$inputFile.click()})):e.itemAddfile.hide(),e.$inputFile.off("click").on("click",(function(e){e.stopPropagation()})),e.$inputFile.off("click").on("change",(function(){var t=e.$inputFile[0].files[0];t.fullPath=e.$inputFile[0].value;var i=[].concat(e.Class.EXTENSIONSIMG,e.Class.EXTENSIONSVIDEO,e.Class.EXTENSIONSAUDIO);e.startLoading(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.uploadFile(t)).done((function(t){"object"!==_typeof(t)&&(t={response:t}),e.onUploadFileCompleted(e,t)})).fail((function(t){e.stopLoading(),"Unauthorized"!==t.statusText&&bizagi.showMessageBox(e.getResource("workportal-widget-admin-language-error")),3===t.code?bizagi.showMessageBox(e.getResource("render-ecm-service-not-available"),"Error"):bizagi.showMessageBox(e.getResource("render-ecm-service-general-error"),"Error"),bizagi.log("An error has occurred: Code = "+t.code)})):e.stopLoading()}));else e.itemAddfile.hide()},closeAccordionSection:function(){var e=this.getControl(),t=$(".bz-rn-ecm-activate-menu",e),i=$(".bz-rn-ecm-menu-container",e),r=$(".bz-rn-ecm-metadata-container",e);t.removeClass("active"),i.removeClass("showMenu"),r.removeClass("active"),r.slideUp(300).removeClass("open")},addEventsEcm:function(){var e=this;e.removeEventsEcm(),e.getControl().find('.bz-rn-ecm-header .bz-mo-icon.bz-plus[data-action="add"]').click((function(e){e.preventDefault()})),e.elementsEvent.lock.click((function(){$.when(e.dataService.checkOutFile(e.elementsEvent.params)).done((function(){e.elementsEvent.lock.removeClass("bz-ecm-item-menu-enable"),e.elementsEvent.unlock.addClass("bz-ecm-item-menu-enable")}))})),e.elementsEvent.unlock.click((function(){$.when(e.dataService.cancelCheckOut(e.elementsEvent.params)).done((function(){e.elementsEvent.unlock.removeClass("bz-ecm-item-menu-enable"),e.elementsEvent.lock.addClass("bz-ecm-item-menu-enable")}))}));var t=null;e.elementsEvent.del.bind("click",(function(){clearTimeout(t),e.closeAccordionSection(),e.startLoading(),$(e.elementsEvent.element.elementReference).closest(".bz-rn-ecm-metadata").css("opacity",.5),$.when(e.dataService.deleteECMFile(e.elementsEvent.params)).done((function(){e.removeEventsEcm(),$(e.elementsEvent.element.elementReference).parents(".bz-rn-ecm-metadata").remove();for(var t=[].concat(e.files),i=0;i<t.length;i++)t[i][0]===e.elementsEvent.params.idFileUpload&&t.splice(i,1);e.setValue(t),e.checkMaxFiles()})).always((function(){$(e.elementsEvent.element.elementReference).closest(".bz-rn-ecm-metadata").css("opacity",1),e.stopLoading()}))})),e.setMobiscroll(),e.elementsEvent.edit.click((function(){clearTimeout(t),e.closeAccordionSection(),e.elementsEvent.panelMetadata.is(".active")||(e.elementsEvent.panelMetadata.addClass("active"),t=setTimeout((function(){e.elementsEvent.panelMetadata.stop().slideDown(300).addClass("open")}),200))})),e.elementsEvent.btnSave.click((function(){var i=e.properties,r=$(".bz-rn-ecm-metadata-value",e.elementsEvent.panelMetadata),a=[],n=!1,o=$(this);clearTimeout(t),e.startWaiting(o);for(var s=0;s<r.length;s++){var l=r[s],d=$(l).data("value"),u=$(l).data("metadatatype"),c=$(l).data("required"),p=$(l).data("readonly"),h=$(l).data("description"),g=$(l).data("idmetadata"),m=null;if(p)return e.stopLoading(),e.stopWaiting(o),!0;if("STRING"===u||"DECIMAL"===u)m=$("input",l).val();else if("BOOL"===u)m=$("input[name=ecm-radio]:checked",l).val();else if("DATETIME"===u){var f=e.properties.fullFormat?e.properties.fullFormat:"fullFormat"!=e.getResource("fullFormat")?e.getResource("fullFormat"):"yyyy-MM-dd HH:mm:ss";m=bizagi.util.dateFormatter.formatDate(bizagi.util.dateFormatter.getDateFromISO($("input",l).attr("value"),!1),f)}!c||""!==m&&null!==m||(bizagi.showMessageBox(h+": "+e.getResource("render-ecm-tooltip-mandatory"),"Error"),n=!0),n||m==d||a.push({idMetadata:g,value:m})}if(n)e.stopLoading(),e.stopWaiting(o);else{var b=e.buildAddParams();b.fileName=e.elementsEvent.element.filename,b.idFileUpload=e.elementsEvent.element.id,b.idPageCache=i.idPageCache,b.metaValues=JSON.encode({metadataValues:a}),$.when(e.dataService.updateECMMetadata(b)).done((function(){e.stopLoading(),e.stopWaiting(o)}))}})),e.elementsEvent.btnCancel.click((function(){e.closeAccordionSection(),e.removeEventsEcm()}))},setMobiscroll:function(){this.elementsEvent.panelMetadata.find(".bz-ecm-metadata-date").each((function(e,t){var i=$(t),r=i.attr("value"),a=new Date,n=r?new Date(r):a,o=a.getTime()<n.getTime()?a:n;o.setFullYear(o.getFullYear()-2),i.mobiscroll().calendar({mode:"mixed",display:"bottom",controls:["calendar"],min:o,defaultValue:n,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||"en",onSet:function(e){i.attr("value",e),i.closest(".bz-rn-ecm-metadata-item").find(".bz-rn-ecm-meta-required").removeClass("bz-rn-ecm-meta-required")}})}))},removeEventsEcm:function(){this.elementsEvent.lock.unbind("click"),this.elementsEvent.unlock.unbind("click"),this.elementsEvent.del.unbind("click"),this.elementsEvent.edit.unbind("click"),this.elementsEvent.btnSave.unbind("click"),this.elementsEvent.btnCancel.unbind("click")},handlerUploadImage:function(e){var t=this,i=e||0;bizagi.loading.start(),2===i?navigator.camera.getPicture((function(e){$.when(bizagi.util.media.checkMaxSize(e,t.properties)).done((function(){$.when(bizagi.util.media.getFileDataInfo(e)).then((function(i){t.fileProperties=i,t.saveImage(t,e)}))})).always((function(){bizagi.loading.stop()}))}),t.onFail,{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY}):1===i?navigator.camera.getPicture((function(e){$.when(bizagi.util.media.checkMaxSize(e,t.properties)).done((function(){$.when(bizagi.util.media.getFileDataInfo(e)).then((function(i){t.fileProperties=i,t.saveImage(t,e)}))})).always((function(){bizagi.loading.stop()}))}),t.onFail,{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0}):3===i?navigator.device.capture.captureVideo((function(e){$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).done((function(){t.saveVideo(t,e)})).always((function(){bizagi.loading.stop()}))}),t.onFail,{limit:t.Class.LIMIT}):4===i&&navigator.device.capture.captureAudio((function(e){var i=e[0].localURL;$.when(bizagi.util.media.checkMaxSize(i,t.properties)).done((function(){t.saveAudio(t,e)})).always((function(){bizagi.loading.stop()}))}),t.onFail,{limit:t.Class.LIMIT})},renderUploadItem:function(e){return this._super(e)},uploadFile:function(e){var t=new $.Deferred;if(bizagi.util.media.checkMaxSizeFile(e,this.properties)&&bizagi.util.media.checkFileTypes(e,this.properties,[].concat(this.Class.EXTENSIONSIMG,this.Class.EXTENSIONSVIDEO,this.Class.EXTENSIONSAUDIO))){var i=new FormData,r=this.getFormContainer(),a=this.buildAddParams();Object.keys(a).map((function(e){i.append(e,a[e])})),i.append("Filedata",e),i.append("Filename",e.name.substr(e.name.replace(/([\\\/]+)/g,"/").lastIndexOf("/")+1)),this.properties.contexttype&&i.append(this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",this.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?i.append(BIZAGI_SESSION_NAME,r.properties.sessionId):i.append("JSESSIONID",r.properties.sessionId)}catch(e){i.append("JSESSIONID",r.properties.sessionId)}this.dataService.processUploadFile({url:this.properties.addUrl,formData:i}).done((function(e){t.resolve(e)})).fail((function(e){t.reject(e)}))}else bizagi.loading.stop();return t.promise()},saveImage:function(e,t){var i=e,r={},a=i.buildAddParams(),n=i.fileProperties.name;i.editedImageURL?r.dataFile=i.editedImageURL:i.fileProperties&&(r.dataFile=i.fileProperties.url),a.queueID="q_"+bizagi.util.encodeXpath(i.getUploadXpath()),a.xPath=a.xPath,a.Filename=n,r.data=a,r.options=new FileUploadOptions,r.options.fileKey="file",r.options.fileName=n,r.options.mimeType="image/jpeg",r.options.uploadKey={key:a.xPath},r.options.addUrl=i.properties.addUrl,i.editedImageURL=null,i.fileProperties=null,r.dataFile=bizagi.util.media.getImagePath(r.dataFile),bizagi.loading.start(),$.when(bizagi.util.media.uploadFile(r)).done((function(t){i.onUploadFileCompleted(e,t)})).fail((function(e){3===e.code?bizagi.showMessageBox(i.getResource("render-ecm-service-not-available"),"Error"):bizagi.showMessageBox(i.getResource("render-ecm-service-general-error"),"Error"),bizagi.log("An error has occurred: Code = "+e.code)})).always((function(){bizagi.loading.stop({})}))},saveAudio:function(e,t){var i=e,r={},a=t[0].name,n=i.buildAddParams();n.queueID="q_"+bizagi.util.encodeXpath(i.getUploadXpath()),n.xPath=n.xPath,n.Filename=a,r.data=n,r.options=new FileUploadOptions,r.options.fileKey="file",r.options.fileName=a,r.options.uploadKey={key:n.xPath},r.options.addUrl=i.properties.addUrl,r.dataFile=t[0].fullPath,bizagi.loading.start(),$.when(bizagi.util.media.uploadFile(r)).done((function(t){i.onUploadFileCompleted(e,t)})).fail((function(e){3===e.code?bizagi.showMessageBox(i.getResource("render-ecm-service-not-available"),"Error"):bizagi.showMessageBox(i.getResource("render-ecm-service-general-error"),"Error"),bizagi.log("An error has occurred: Code = "+e.code)})).always((function(){bizagi.loading.stop({})}))},saveVideo:function(e,t){var i=e,r={},a=t[0].name,n=i.buildAddParams();n.queueID="q_"+bizagi.util.encodeXpath(i.getUploadXpath()),n.xPath=n.xPath,n.Filename=a,r.data=n,r.options=new FileUploadOptions,r.options.fileKey="file",r.options.fileName=a,r.options.uploadKey={key:n.xPath},r.options.addUrl=i.properties.addUrl,r.dataFile=t[0].fullPath,bizagi.loading.start(),$.when(bizagi.util.media.uploadFile(r)).done((function(t){i.onUploadFileCompleted(e,t)})).fail((function(e){3===e.code?bizagi.showMessageBox(i.getResource("render-ecm-service-not-available"),"Error"):bizagi.showMessageBox(i.getResource("render-ecm-service-general-error"),"Error"),bizagi.log("An error has occurred: Code = "+e.code)})).always((function(){bizagi.loading.stop({})}))},onFail:function(e){bizagi.log("Error code: "+e.code)},onUploadFileCompleted:function(e,t){var i=this;try{if("undefined"==(t=JSON.parse(decodeURI(t.response))).idFileUpload||null===t.idFileUpload)throw"not present idFileUpload";var r=i.getControl();i.filesCount=i.filesCount+1;var a=[].concat(i.files);a.push([t.idFileUpload,t.fileName]),i.setValue(a,!1),$.when(i.renderControl(null,null)).done((function(e){r.html(e),i.postRenderSingle()}))}catch(e){bizagi.showMessageBox(i.getResource("render-ecm-service-not-available"),"Error"),bizagi.log("Error ECM:"),bizagi.log(e)}},checkMaxFiles:function(){var e=this.properties,t=e.maxfiles,i=e.value.length;0!==t&&i>=t&&this.itemAddfile.hide()},checkExtensions:function(){var e=this.properties.validExtensions,t=!1,i=!1,r=!1,a=[];if(void 0===e||""===e)t=i=r=!0;else if(1===(e=e.split(";")).length&&-1!==e[0].indexOf("*.*"))t=i=r=!0;else for(var n=0,o=e.length;n<o;n++)e[n]=e[n].replace("*.",""),this.Class.EXTENSIONSIMG.toString().indexOf(e[n])>=0&&(r=!0),this.Class.EXTENSIONSAUDIO.toString().indexOf(e[n])>=0&&(i=!0),this.Class.EXTENSIONSVIDEO.toString().indexOf(e[n])>=0&&(t=!0);return i||r||t||this.itemAddfile.hide(),r&&(a.push({guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}),a.push({guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")})),a},validateFileExtensions:function(e){return/(.jpg|.gif|.png|.bmp|.jpeg|.mov|.avi|.mpg|.mpeg|.3gp|.asf|.wmv|.flv|.mp4)$/i.test(e)},renderFileLayout:function(e,t){var i=this,r=i.getFormContainer(),a=i.renderFactory.getTemplate("ecm-metadata"),n=$.Deferred();return $.when(i.dataService.getECMMetadata(e),t?[t]:i.dataService.getFileProperties(e)).done((function(t,o){o[0].data=e,o[0].xpathContext=o[0].xpathContext||r.properties.xpathContext||"",o[0].xpath=i.properties.xpath,t[0].filename=e.fileName,t[0].url=i.buildItemUrl(o[0]),t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].ecm_isVisible=o[0].isVisible,t[0].ecm_allowUpdateMetadata=o[0].allowUpdateMetadata,t[0].ecm_allowDelete=o[0].allowDelete,t[0].ecm_allowUpdateContent=o[0].allowUpdateContent,t[0].ecm_allowView=o[0].allowView,t[0].ecm_allowCheckOut=o[0].allowCheckOut,t[0].ecm_allowCancelCheckOut=o[0].allowCancelCheckOut,t[0].ecm_allowEdit=e.editable&&o[0].allowEdit,t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].idFileUploads=o[0].idFileUpload,t[0].xpath=o[0].xpath,t[0].value=bizagi.util.parseBoolean(o[0].value),t[0].deviceType=bizagi.detectDevice(),t[0].metadata&&t[0].metadata.length&&t[0].metadata.map((function(e){"DATETIME"===e.metadataType&&(e.dateFormat="fullFormat"!==i.getResource("fullFormat")?i.getResource("fullFormat"):i.properties.fullFormat?i.properties.fullFormat:"yyyy-MM-dd HH:mm:ss",e.value=e.value?bizagi.util.dateFormatter.formatDate(bizagi.util.dateFormatter.getDateFromFormat(e.value,e.dateFormat),"yyyy-MM-dd"):"")}));var s=$.kendoTmpl(a,t[0]);n.resolve(s)})),n.promise()},isValid:function(e){var t=this.getControl(),i=[],r=!1,a=this.properties,n=!0;a.required&&(n=!!(this.grid&&this.grid.isFromCreatedRow.apply(this))||this._super(e),0===this.filesCount&&n&&(e.push({xPath:a.xpath,message:this.getResource("render-required-text").replaceAll("#label#",a.displayName)}),n=!1));if(a.editable){var o=$(".bz-rn-ecm-container:visible",t).find(".bz-rn-ecm-metadata-value[data-required='true']");$.each(o,(function(e,t){""===$("input",t).val()&&(i.push($(t).data("description")),r=!0)}))}if(r){var s=this.getResource("render-required-text").replaceAll("#label#",i.join(", "));e.push({xPath:a.xpath,message:s})}return n},cleanData:function(){this.setValue(null),this.clearDisplayValue()},clearDisplayValue:function(){var e=this,t=e.getControl().find(".bz-rn-ecm-file-container");t.length;$.each(t,(function(t,i){var r=$(i),a=r.data();a&&$.when(e.deleteUploadItem(r,a.idfileupload)).done((function(){r.remove()}))})),e.filesCount=0}}),bizagi.rendering.searchList.extend("bizagi.rendering.searchList",{SEARCH_MIN_LENGTH:2,temporalElements:{}},{renderSingle:function(){this._super();var e=this.getControl();this.getArrow().remove(),this.modalViewTemplates=kendo.template(this.renderFactory.getTemplate("searchListModalViewAuxTemplates"),{useWithBlock:!1}),this.inputTemplates=kendo.template(this.renderFactory.getTemplate("searchListInputAuxTemplates"),{useWithBlock:!1}),this.input=$(".bz-rn-container-searchlist",e),this.configureListHandlers()},postRenderSingle:function(){var e=this;this._super(),e.properties.editable||e.configureReadOnly(),e.input.on("click",".bz-rn-remove-tag-on-search-list",(function(){e.removeItem($(this))}))},configureListHandlers:function(){this.properties.editable&&(this.properties.value.length>0?this.configureModalView(".bz-rn-last-child"):(this.configureModalView("ul"),this.configureModalView(".bz-rn-last-child")))},configureModalView:function(e){var t=this;(""===e?t.input:$(e,t.input)).unbind().bind("click",(function(){var e=$("ul li.bz-rn-regular-element",t.input),i=[];t.Class.temporalElements={};for(var r=0,a=e.length;r<a;r++){var n=$(e[r]).data("id"),o=$("label",$(e[r])).text(),s={id:n,value:o};i.push(s),t.addTemporalElement(n,o,!1)}var l=t.renderFactory.getTemplate("searchListModalView"),d=kendo.template(l,{useWithBlock:!1}),u={items:i,displayName:t.properties.displayName||"",orientation:t.properties.orientation},c=$($.trim(d(u)));c.kendoMobileModalView({close:function(){t.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),t.configureModalViewHandlers(c),t.triggerGlobalHandler("modalViewDidAppear",{}),c.kendoMobileModalView("open")}))},configureModalViewHandlers:function(e){var t=this,i=new $.Deferred;e.find(".bz-wp-modalview-header-cancel-search").hide(500),e.find(".bz-wp-modalview-header-input-search").bind("keypress keyup",(function(){""!==this.value?e.find(".bz-wp-modalview-header-cancel-search").show(500):e.find(".bz-wp-modalview-header-cancel-search").hide(500),bizagi.loading.start({selector:".bz-rn-new-modalview-content-styles"}),$.when(t.showResults(this.value,e)).always((function(){bizagi.loading.stop({selector:".bz-rn-new-modalview-content-styles"})}))})).focus((function(){e.find(".filter-searchlist-modal-view-tags").addClass("searching")})).blur((function(){e.find(".filter-searchlist-modal-view-tags").removeClass("searching")})),e.find(".bz-wp-modalview-header-cancel-search").bind("click",(function(){t.showNoResultsMessage(t.getResource("workportal-widget-inboxcommon-no-results-found"),e),e.find(".bz-wp-modalview-header-input-search").val(""),$(this).hide(500)})),e.delegate(".ui-bizagi-apply-button-searchlist","click",(function(){i.resolve(),e.data("kendoMobileModalView").close()})),e.find(".bz-wp-modalview-close").bind("click",(function(){i.reject(),e.data("kendoMobileModalView").close()})),e.find(".filter-searchlist-modal-view-tags").on("click",".bz-rn-remove-tag-on-search-list",(function(){t.removeItem($(this),!0);var i=e.find(".bz-wp-modalview-header-input-search").val();bizagi.loading.start({selector:".bz-rn-new-modalview-content-styles"}),$.when(t.showResults(i,e)).always((function(){bizagi.loading.start({selector:".bz-rn-new-modalview-content-styles"})}))})),$.when(i).done((function(){t.addNewValuesToInput(),t.Class.temporalElements={}})).fail((function(){t.Class.temporalElements={}}))},showResults:function(e,t){var i=this;return $.when(i.processRequest({term:e})).done((function(e){0===e.length?i.showNoResultsMessage(i.getResource("workportal-widget-inboxcommon-no-results-found"),t):($("#ui-bizagi-wp-filter-results-searchlist-wrapper ul li",t).remove(),$("li",$(bizagi.util.trim(i.modalViewTemplates({template:"sugestions",items:e})))).appendTo($("#ui-bizagi-wp-filter-results-searchlist-wrapper ul",t)),i.modalViewList=$(".ui-bizagi-render-list-elements",t),i.modalViewList.find("li").unbind().bind("click",(function(){i.appendFoundItem(this,$(".filter-searchlist-modal-view-tags",t)),0===$(this).siblings().length&&i.showNoResultsMessage(i.getResource("workportal-widget-inboxcommon-no-results-found"),t),$(this).remove()})))})).fail((function(e){i.showNoResultsMessage(e,t)}))},addNewValuesToInput:function(){var e=[];$.each(this.Class.temporalElements,(function(t,i){e.push(i.obj)})),this.setValue(e),$("ul li",this.input).remove(),$("li",$(bizagi.util.trim(this.inputTemplates({template:"inputContainer",value:e})))).appendTo($("ul",this.input)),$("ul",this.input).unbind(),$(".bz-rn-last-child",this.input).unbind(),e.length>0?this.configureModalView(".bz-rn-last-child"):(this.configureModalView("ul"),this.configureModalView(".bz-rn-last-child"))},hasValue:function(){return JSON.parse(this.getValue()).value.length>0},setValue:function(e,t){t=void 0===t||t,this.value=JSON.encode({value:e}),this.changeRequiredLabel(),t&&!this.internalSetInitialValueFlag&&this.triggerRenderChange()},showNoResultsMessage:function(e,t){$("#ui-bizagi-wp-filter-results-searchlist-wrapper ul li",t).remove(),$("li",$(bizagi.util.trim(this.modalViewTemplates({template:"modalViewDefaultMessage",message:e})))).appendTo($("#ui-bizagi-wp-filter-results-searchlist-wrapper ul",t))},appendFoundItem:function(e,t){if(-1==$.map($("li",t),(function(e){return $(e).data("id")})).indexOf($(e).data("id"))){var i=$(e).data("id"),r=$("label",e).text(),a=$("li",$(bizagi.util.trim(this.modalViewTemplates({template:"fullElement",id:i,value:r})))),n=$("li:last",t);n.hasClass("bz-rn-any-element")?(n.remove(),$("ul",t).prepend(a)):$("ul",t).prepend(a),this.addTemporalElement($(e).data("id"),$("label",e).text(),!1)}},removeItem:function(e,t){var i=e.parent(),r=e.closest(".bz-rn-container-searchlist");if(0===r.length&&(r=e.closest(".filter-searchlist-modal-view-tags")),t?delete this.Class.temporalElements[i.data("id")]:this.removeElement({id:i.data("id")}),i.remove(),r.find("li").length<=1&&!t)$(".bz-rn-click-to-add-span",r).removeClass("hidden"),this.configureModalView("ul"),this.configureModalView(".bz-rn-last-child");else if(0===r.find("li").length&&t){var a=$(bizagi.util.trim(this.modalViewTemplates({template:"modalViewDefaultValue"})));$("li",a).appendTo($("ul",r))}},processRequest:function(e){var t=this,i=t.properties,r=[],a=new $.Deferred;return e.term.length>=this.Class.SEARCH_MIN_LENGTH?(i.term=e.term,this.getData().done((function(i){$.each(i,(function(i,a){var n;switch(_typeof(a.value)){case"number":n=a.value;break;case"object":n=a.value.toString();break;case"string":n=a.value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.term+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");break;default:n=a.value}void 0===t.Class.temporalElements[a.id]&&r.push({id:a.id,label:n,value:a.value})})),a.resolve(r)}))):a.reject(t.getResource("workportal-widget-inboxcommon-no-results-found")),a},setDisplayValue:function(e){var t=this.properties,i="string"==typeof e?JSON.parse(e).value:e.value;this.setValue(i),void 0!==e&&t.editable&&this.input.val(e.label)},renderReadOnly:function(){var e=this.properties,t=this.renderFactory.getTemplate("searchList");return $.kendoTmpl(t,{id:e.id,xpath:e.xpath,value:e.value,editable:!1})},configureReadOnly:function(){var e=this.getControl();$(".bz-rn-last-child",e).unbind("click"),$(".bz-rn-searchlist-search-icon",e).unbind("click"),$(".bz-rn-click-to-add-span",e).remove(),$(".bz-rn-remove-tag-on-search-list",e).remove(),this.input.addClass("searchListNonEditable")},addTemporalElement:function(e,t,i){this.Class.temporalElements[e]&&delete this.Class.temporalElements[e],this.Class.temporalElements[e]={obj:{id:e,value:t},remove:i}}}),bizagi.rendering.render.extend("bizagi.rendering.grid.beta",{},{init:function(e){this.params=e,this._super(e)},getGridTemplate:function(){return this.renderFactory.getTemplate("grid-control")},applyTemplate:function(e){var t=this.properties,i=this.properties.orientation;return $.kendoTmpl(e,{id:bizagi.util.encodeXpath(t.xpath),displayName:bizagi.util.encodeXpath(t.displayName),orientation:i})},renderControl:function(){var e=new $.Deferred,t=this.getGridTemplate(),i=this.applyTemplate(t);return e.resolve(i),e.promise()},postRenderSingle:function(){var e=this,t=e.getContainerRender();t.addClass("bz-command-edit-inline"),t.find(".ui-bizagi-label").hide(),e.getArrowContainer().hide(),e._super(),$(e.element).on("click",(function(t){bizagi.loading.start(),setTimeout((function(){$.when(e.renderEdition()).then((function(e){e.postRenderSingle()}))}),1)}))},renderEdition:function(){var e=this.getControl(),t=$.Deferred();this.params.pane=e.closest('div[data-role="pane"]');var i=new bizagi.rendering.smartphone.helpers.grid(this.params);return t.resolve(i),t.promise()}}),bizagi.rendering.grid.extend("bizagi.rendering.smartphone.helpers.grid",{GRID_PAGE_SIZE:10},{init:function(e){var t=this,i=e.data;void 0!==e.pane?t.pane=e.pane:console.warn("Es necesario asignar un pane a la forma {pane: $pane} para evitar problemas de navegación entre vistas de Kendo"),i.properties.singleInstance=!1,t._super(e),t.cellMetadata={};var r=t.properties;r.displayType="vertical",r.labelAlign="left",$.each(t.columns,(function(){t.properties&&t.properties.editable&&(t.properties.editable=!0===r.allowEdit)}));var a=t.getViewTemplate();t.gridView=$(t.applyTemplate(a)),t.pane.append(t.gridView),t.view=new kendo.mobile.ui.View(t.gridView,{useNativeScrolling:!1,stretch:!0,init:function(){t.attachHandlers()}}),t.scrollContent=$("#"+bizagi.util.encodeXpath(r.xpath),t.view.contentElement())},initializeData:function(e){e.properties.singleInstance=!1,this._super(e)},getViewTemplate:function(){return this.renderFactory.getTemplate("grid-view")},applyTemplate:function(e){var t=this.properties,i=this.columns.length>2;return bizagi.util.removeItemLocalStorage("grid.filter."+t.id),bizagi.util.setItemLocalStorage("grid.filter."+t.id,null),$.kendoTmpl(e,{id:bizagi.util.encodeXpath(t.xpath),title:t.displayName,allowAdd:t.allowAdd,allowFilter:i})},attachHandlers:function(){var e=this;$(".bz-rn-view-options",e.gridView).on("click",(function(t){t.stopPropagation(),e.processAction($(this).attr("data-action"))}))},processAction:function(e,t){"close"===e&&this.onClose(),"add"===e&&this.addRow(),"filter"===e&&this.onFilterRow()},onClose:function(){var e=this.properties;bizagi.util.removeItemLocalStorage("grid.filter."+e.id),this.pane.data("kendoMobilePane").navigate("#:back"),this.view.destroy(),this.view.element.remove()},onFilterRow:function(){var e=this,t=e.renderFactory.getTemplate("grid-modal-filter"),i=e.buildColumnFilter(),r=kendo.template(t,{useWithBlock:!1}),a=$(r({list:i,title:"Column settings",action:"FILTER"}).trim());a.kendoMobileModalView({close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},useNativeScrolling:!0,modal:!1}),e.attachModalFilterHandlers(a),e.triggerGlobalHandler("modalViewDidAppear",{}),a.kendoMobileModalView("open")},buildColumnFilter:function(){var e=this.properties,t=[],i=bizagi.util.getItemLocalStorage("grid.filter."+e.id)?JSON.parse(bizagi.util.getItemLocalStorage("grid.filter."+e.id)):null,r=i||this.buildColumns;return $.each(r,(function(e,i){i.key||i.hidden||(i.active=void 0===i.active||i.active,t.push(i))})),bizagi.util.setItemLocalStorage("grid.filter."+e.id,JSON.stringify(t)),t},attachModalFilterHandlers:function(e){var t=this.properties,i=e.find(".bz-rn-modal-filter-content-list");e.on("click",".bz-rn-modal-filter-header-title-cancel",(function(){e.kendoMobileModalView("close")})),e.on("click",".bz-rn-modal-filter-footer-action",(function(){var r=bizagi.util.getItemLocalStorage("grid.filter."+t.id)?JSON.parse(bizagi.util.getItemLocalStorage("grid.filter."+t.id)):null,a=i.find("input").map((function(){return{index:$(this).data("index"),active:this.checked}}));$.each(a,(function(e,t){var i=t.index+1;r[e].active=t.active;var a=$(".bz-rn-grid-table th:nth-child("+i+"), .bz-rn-grid-table td:nth-child("+i+")");t.active?a.show():a.hide()})),bizagi.util.setItemLocalStorage("grid.filter."+t.id,JSON.stringify(r)),e.kendoMobileModalView("close")})),i.on("click","input",(function(){i.find("input:checkbox:checked").length>0?$(this).is(":checked")?$(this).removeClass("bz-full-ball").addClass("bz-check"):$(this).addClass("bz-full-ball").removeClass("bz-check"):$(this).prop("checked",!0)}))},postRenderSingle:function(){var e=this,t=e.properties,i=e.getContainerRender(),r=e.getControl();i.addClass("bz-command-edit-inline"),""!==e.properties.helpText&&r.addClass("bz-rn-grid-contains-help-text"),e.getContainerRender().find(".ui-bizagi-label").hide(),e.getArrowContainer().hide(),e._super(),e.applyGridPlugin(),t.skipInitialLoad=t.skipInitialLoad||!1,t.skipInitialLoad||(t.data?""===t.data||0===t.data.rows.length&&t.data.page>1?e.fetchData(void 0,e.sortBy,e.sortType):(e.updateData(t.data),$.when(e.ready()).done((function(){e.triggerRenderChange({changed:!1}),e.pane.data("kendoMobilePane").navigate(e.view.id),e.configureHeaderAndFooterFixed(),e.attachScrollHandler(),e.endLoading()}))):e.fetchData(t.page,t.sortBy,t.sortOrder))},attachScrollHandler:function(){var e=this.properties,t=0,i=0;if(!e.data||0!==e.data.records){var r=this.view.content.find(".bz-rn-grid-scroll-content").data("kendoMobileScroller");r&&r.reset();var a=this.view.content.find(".left-table").get(0),n=this.view.content.find(".bz-rn-grid-scroll-header").get(0);r.bind("scroll",(function(e){var r=e.scrollLeft,o=e.scrollTop;if(r!==t){var s="translateX("+-1*r+"px)";n.style.transform=s,n.style.webkitTransform=s,n.style.OTransform=s,t=r}if(o!==i){var l="translateY("+-1*o+"px)";a.style.transform=l,a.style.webkitTransform=l,a.style.OTransform=l,i=o}}))}},configureHeaderAndFooterFixed:function(){var e,t=-1,i=this.properties;if(!i.data||0!==i.data.records){for(var r=this.scrollContent.find(".bz-rn-grid-body"),a=$("tr:first-child td",r),n=$("<colgroup></colgroup>");e=a[++t];){var o=document.createElement("col");o.style.width=e.offsetWidth+"px",n.append(o)}for(var s=$("tr",r)?$("tr",r).length:0,l=$("<table class='left-table'>"),d=0;d<s;d++){var u=$("<tr><td>"+(d+1)+"</td></tr>");l.append(u)}this.view.content.find(".bz-rn-grid-counter-column").empty(),this.view.content.find(".bz-rn-grid-scroll-header").empty(),this.view.content.find(".bz-rn-grid-counter-column").append(l),this.view.content.find(".bz-rn-grid-table").prepend(n.clone());var c=this.scrollContent.find(".bz-rn-grid-header");this.view.content.find(".bz-rn-grid-scroll-header").append($("<table class='bz-rn-grid-table'></table>").append(n).append(c)),this.view.footer.empty();var p=this.scrollContent.find(".bz-rn-grid-container-pager");this.view.footer.append(p)}},applyGridPlugin:function(){var e=this,t=e.properties,i=e.view.content.find(".bz-rn-grid-scroll-content").data("kendoMobileScroller");e.buildColumns=e.buildColumnModel(),e.currentGrid=$(i.scrollElement).mobileGrid({columns:e.buildColumns,title:t.displayName,mode:e.getMode(),sortBy:t.sortBy||"",sortOrder:t.sortOrder||"",sortType:bizagi.override.gridDefaultSortBy||"asc",template:{grid:e.renderFactory.getTemplate("grid"),table:e.renderFactory.getTemplate("grid-table"),emptyTable:e.renderFactory.getTemplate("grid-table-empty"),column:e.renderFactory.getTemplate("grid-table-column"),specialColumn:e.renderFactory.getTemplate("grid-table-column-special"),row:e.renderFactory.getTemplate("grid-table-row"),cell:e.renderFactory.getTemplate("grid-table-cell"),specialCell:e.renderFactory.getTemplate("grid-table-cell-special"),pager:e.renderFactory.getTemplate("grid-table-pager"),waiting:""},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm,remove:t.allowDelete,details:t.allowDetail},tooltips:{addLabel:$.trim(bizagi.localization.getResource("render-grid-add-label")),editLabel:$.trim(bizagi.localization.getResource("render-grid-edit-label")),deleteLabel:$.trim(bizagi.localization.getResource("render-ecm-confirm-bt-delete")),detailLabel:$.trim(bizagi.localization.getResource("render-collection-navigator-details-form"))},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){e.rowSelected(t.key)},rowUnselected:function(t){e.rowUnselected(t.key)},editRow:function(t){e.editRow(t.key)},deleteRow:function(t){e.deleteRow(t.key)},showFormDetails:function(t){e.showFormDetails(t.key)},pageRequested:function(t){e.pageRequested(t)},sortRequested:function(t){e.fetchData(t.page,t.sortBy,t.sortType)}})},triggerGridPluginHandler:function(){Array.prototype.slice.call(arguments,0)},rowSelected:function(e){this.currentGrid.getContainer().find("[data-bizagi-component=rows] tr[data-key="+e+"]").addClass("bz-rn-grid-state-selected")},rowUnselected:function(e){this.currentGrid.getContainer().find("[data-bizagi-component=rows] tr[data-key="+e+"]").removeClass("bz-rn-grid-state-selected")},setDisplayValue:function(e){},setDisplayValueEdit:function(e){},actionSave:function(){},updateAffectedCellManually:function(){},getRowIndexByKey:function(){},showMore:function(e){},getHeaderStyles:function(){},buildColumnModel:function(){var e=this.columns,t=[];return t.push({name:"id",index:0,label:"id",hidden:!0,align:"center",key:!0}),$.each(e,(function(e,i){i.columnIndex=e+1;var r=bizagi.util.isEmpty(i.properties.displayName)?" ":i.properties.displayName,a={name:i.properties.xpath,index:e+1,label:r,key:!1,hidden:!i.properties.visible||"columnHidden"==i.properties.type||!1===i.properties.columnVisible,summarizeBy:i.properties.totalize&&i.properties.totalize.operation?i.properties.totalize.operation:void 0,bizAgiProperties:i.properties};t.push(a)})),t},refresh:function(){var e=$.Deferred();return $.when(this.fetchData()).done((function(){e.resolve()})),e.promise()},dataReady:function(){return null!=this.dataReadyDeferred?this.dataReadyDeferred.promise():null},updateData:function(e){var t=this.currentGrid;!e.records||e.records&&0===e.records?(this.view.content.find(".bz-rn-grid-top-content, .bz-rn-grid-counter-column").hide(),this.view.content.find(".bz-rn-grid-scroll-content").css("width","100%")):"none"===this.view.content.find(".bz-rn-grid-top-content").css("display")&&this.view.content.find(".bz-rn-grid-top-content, .bz-rn-grid-counter-column").show(),e&&this.properties&&(this.properties.data=e,this.setCellOverrides(e),t.setData(e))},fetchData:function(e,t,i){var r=this,a=r.properties;return r.dataReadyDeferred=$.Deferred(),r.sortBy=t,r.sortType=i,e=e||1,t=t||a.sortBy||"id",i=i||a.sortOrder||"asc",a.page=e,a.sortBy=t,a.sortType=i,a.sort=t+" "+i,r.startLoading(),$.when(r.getRemoteData()).then((function(e){r.endLoading(),e&&(e.deviceMaxRecordsExceeded?(bizagi.showMessageBox(bizagi.localization.getResource("render-search-maximum-records-allowed")),r.dataReadyDeferred.resolve()):$.when(r.updateData(e)).done((function(){r.configureHeaderAndFooterFixed(),r.attachScrollHandler(),r.triggerRenderChange({changed:!1}),r.dataReadyDeferred.resolve()})))})),r.dataReadyDeferred.promise()},fetchTotalData:function(e){},collectData:function(e){},pageRequested:function(e){var t=this.properties,i={};jQuery.isEmptyObject(i)||this.dataService.submitData({action:"SUBMITDATA",data:i,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:t.idPageCache}),this.fetchData(e.page,e.sortBy,e.sortType)},onTotalData:function(e){},showTotals:function(e){},drawCell:function(e,t,i,r){var a=this;if(e.key)return i;a.newRecords=a.newRecords||{};var n=e.index-1,o=a.columns[n];a.cellMetadata[t]||(a.cellMetadata[t]={}),a.cellMetadata[t][n]||(a.cellMetadata[t][n]={});var s=a.cellMetadata[t][n].properties||o.originalProperties,l=void 0===s.visible||s.visible;void 0===s.editable||s.editable;if(s.editable=!1,o.properties.displayType="value",o.setValue(t,i),o.setSurrogateKey(t),l){var d=new $.Deferred;return o.properties=s,$.when(o.renderReadOnly(t,i)).done((function(e){for(var i=0;i<a.columns.length;i++)a.cellOverrides[t]=a.cellOverrides[t]||{},a.getCellOverride(t,i).visible=!0;d.resolve(e)})),d.promise()}return""},onCellReady:function(e,t,i,r){var a,n=e.index-1,o=this.columns[n],s=(null!=this.cellMetadata[t][n]?this.cellMetadata[t][n].properties:void 0)||o.originalProperties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;if(d=!!r,l)if(d){var u=o.properties.editable;o.properties.editable=d,o.properties.submitOnChange&&(a=o.getDecorated(t))&&(a.properties.submitOnChangexpathContext=this.properties.xpath+"[]"),o.postRender(t,i),o.properties.editable=u}else o.postRenderReadOnly(t,i)},ready:function(){var e=this._super();return $.when(e)},addRow:function(){var e=this,t=e.properties,i=e.getFormContainer().container,r=e.dataService,a=e.renderFactory;e.startLoading(),$.when(e.submitAddRequest()).done((function(n){var o=t.xpath+"[id="+n+"]",s={idRender:t.id,recordXPath:o,url:t.addPage,xpathContext:t.xpathContext,idPageCache:t.idPageCache,xpath:o,editable:!0,requestedForm:"addForm",displayName:t.addLabel,idAsigned:n,enableEditSubmitRequest:!1,hideLabel:!0,withAddForm:!0},l={renderFactory:a,dataService:r,parent:e,data:{properties:s}},d=new bizagi.rendering.formLink(l);$.extend(d,{contextEdit:$(i).find("#container-items-edit"),element:e.element,actionSave:e.actionSaveNewRow,actionCancel:e.actionCancelRow,_sendRelation:function(){return!0},_getData:e.dataService.getFormData,_params:s}),e._InternalRenderLinkForm(d),e.endLoading()})).fail((function(t){e.endLoading(),bizagi.showMessageBox(bizagi.localization.getResource("render-grid-no-records"),"Error")}))},editRow:function(e){this.getFormContainer().saveForm();var t=this.properties,i=this.getFormContainer().container,r=this.dataService,a=this.renderFactory,n=t.xpath+"[id="+e+"]",o={idRender:t.id,id:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,recordXPath:n,xpath:n,editable:!0,url:t.editPage,requestedForm:"editForm",displayName:t.editLabel,idAsigned:e},s={renderFactory:a,dataService:r,parent:this,data:{properties:o}},l=new bizagi.rendering.formLink(s);$.extend(l,{contextEdit:$(i).find("#container-items-edit"),element:this.element,actionSave:this.actionSaveNewRow,actionCancel:this.actionCancelRow,_sendRelation:l.submitEditRequest,_getData:this.dataService.getFormData,_params:o}),this._InternalRenderLinkForm(l)},deleteRow:function(e){var t=this;0!==e?bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){$.when(t.submitDeleteRequest(e)).done((function(i){t.fetchData(),"success"===i.type&&t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e})}))})):bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},showFormDetails:function(e){if(0!==e&&null!=e){var t=this.properties,i=this.getFormContainer().container,r=this.dataService,a=this.renderFactory,n=t.xpath+"[id="+e+"]",o={idRender:t.id,id:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,recordXPath:n,xpath:n,editable:!1,url:t.editPage,requestedForm:"detailForm",displayName:t.detailLabel,idAsigned:e,hideSaveButton:!0},s={renderFactory:a,dataService:r,parent:this,data:{properties:o}},l=new bizagi.rendering.formLink(s);$.extend(l,{contextEdit:$(i).find("#container-items-edit"),element:this.element,_sendRelation:l.submitEditRequest,_getData:this.dataService.getFormData,_params:o}),this._InternalRenderLinkForm(l)}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},actionCancelRow:function(){var e=$.Deferred();return $.when(this.submitRollbackRequest()).done((function(){e.resolve()})),e.promise()},actionSaveNewRow:function(){var e=this,t=e.properties,i=$.Deferred(),r={};return!0===e.form.validateForm()?$.when(e.form.collectRenderValues(r),r.idPageCache=e.form.getPageCache()).then((function(){$.when(e.parent.submitSaveRequest(t.idAsigned,r)).done((function(r){"validationMessages"==r.type?(e.form.addValidationMessage(r.messages),t.submitOnChange=!1,i.reject(r.messages)):(e.parent.fetchData(),t.submitOnChange||(t.submitOnChange=!0),e.submitOnChange({},!0),i.resolve())}))})):i.reject({noAction:!0}),i.promise()},_InternalRenderLinkForm:function(e){var t=this;$.when(e.renderEdition()).done((function(){e.endLoading(),e.postRenderEdit(),e.form.one("refresh",(function(i,r){if(e.kendoView){var a=function(){t=this,bizagi.kendoMobileApplication.navigate("#:back"),e.kendoView.data("kendoMobileView").destroy(),t._InternalRenderLinkForm(e)},n=e.kendoView.data("kendoMobileView").id;n.substring(1,n.length)===kendo.history.current?a.apply(t):e.kendoView.data("kendoMobileView").bind("afterShow",a.bind(t))}}))}))},applyActionUpdateGrid:function(e,t){},collectRenderValues:function(e){},setError:function(e,t){},changeCellValue:function(e,t,i){},changeCellBackgroundColor:function(e,t,i){},changeCellColor:function(e,t,i){},changeCellVisibility:function(e,t,i){},changeCellEditability:function(e,t,i){},cleanCellData:function(e,t){},startLoading:function(){bizagi.loading.start()},endLoading:function(){bizagi.loading.stop()}}),bizagi.rendering.grid.extend("bizagi.rendering.grid",{},{init:function(e){var t=e.data;t.properties.singleInstance=!1,t.properties.rowsPerPage=1,t.properties.labelAlign="left",t.properties.displayType="vertical",this._super(e),this.cellMetadata={};var i=this.properties;i.displayType="vertical",i.labelAlign="left",i.rowsPerPage=1,i.data&&i.data.rows&&(this.allRows=[].concat(i.data.rows)),$.each(this.columns,(function(e,t){this.properties&&this.properties.editable&&(this.properties.editable=!0===i.allowEdit)})),i.data&&i.data.rows&&i.data.rows.length>1&&(i.data.rows=[].concat([i.data.rows[0]]))},setDisplayValue:function(e){},setDisplayValueEdit:function(e){},actionSave:function(){},updateAffectedCellManually:function(){},getRowIndexByKey:function(){},showMore:function(e){},getIndexes:function(){return $.merge(this.allRows,this.getDataNewRows()).reduce((function(e,t){return void 0===e.find((function(e){return e[0]==t[0]}))&&e.push(t),e}),[]).map((function(e){return e[0]}))},postRenderSingle:function(){var e=this,t=e.properties,i=e.getContainerRender(),r=e.getControl();t.rowsPerPage=1,i.addClass("bz-command-edit-inline"),""!==e.properties.helpText&&r.addClass("bz-rn-grid-contains-help-text"),e.getContainerRender().find(".ui-bizagi-label").hide(),e.getArrowContainer().hide(),this._super();var a=e.inputEdition=e.input=e.grid=r.find("#"+bizagi.util.encodeXpath(t.xpath)).addClass("bz-cn-grid"),n=e.getMode(),o=e.buildColumnModel(),s=jQuery.grep(o,(function(e){return e.summarizeBy}));a.bizagi_grid_smartphone({columns:o,title:t.displayName,mode:e.getMode(),template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),buttons:e.renderFactory.getTemplate("bizagi.grid.buttons"),totalizer:e.renderFactory.getTemplate("bizagi.grid.totalizer")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm,remove:t.allowDelete,details:t.allowDetail,inlineAdd:t.inlineAdd,allowMore:!1,totalizer:t.showSummary,hasTotalizer:s.length>0&&t.data.rows.length>0},pageRequested:function(t){"execution"==n&&e.onPageRequested(t)},totalData:function(t){"execution"==n&&e.onTotalData()},sortRequested:function(t){"execution"==n&&e.fetchData(t.page,t.sortBy,t.sortType)},isValid:function(t){return e.isValidGrid(t)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(e){},gridControlReady:function(){e.processLayout(isLabelFormat,e.properties.textFormat||{}),e.processLayout(!isLabelFormat,e.properties.valueFormat||{})},addRow:function(t){"execution"==n&&e.addRow()},editRow:function(t){"execution"==n&&e.editRow(t.key)},deleteRow:function(t){"execution"==n&&e.deleteRow(t.key)},showMore:function(t){e.showMore(t.key)},showFormDetails:function(t){"execution"==n&&e.showDetail(t.key)}}),t.data&&t.data.rows&&t.data.rows.length>1&&(t.data.rows=[].concat([t.data.rows[0]])),t.skipInitialLoad=t.skipInitialLoad||!1,t.skipInitialLoad||(t.data?(e.updateData(t.data),$.when(e.ready()).done((function(){e.triggerRenderChange({changed:!1})}))):e.fetchData(t.page,t.sortBy,t.sortOrder))},getHeaderStyles:function(){var e="",t="",i=this.properties;if(i.headerFormat){var r=i.headerFormat;if(r.color&&(e+="color: "+r.color+";"),r.background&&(t+="background-color: "+r.background+";"),r.bold&&(e+="font-weight: bold; "),r.italic&&(e+="font-style: italic; "),r.underline||r.strikethru)e+="text-decoration: "+(bizagi.util.parseBoolean(r.strikethru)?"line-through ":"")+(bizagi.util.parseBoolean(r.underline)?"underline ":"")+";";if(r.size&&"0"!=r.size)e+="font-size: "+(100+10*Number(r.size)+"%")+";"}return{label:e,header:t}},buildColumnModel:function(){this.properties;var e=this.columns,t=[];return t.push({name:"id",index:0,label:"id",hidden:!0,align:"center",key:!0}),$.each(e,(function(e,i){i.columnIndex=e+1;var r=bizagi.util.isEmpty(i.properties.displayName)?" ":i.properties.displayName,a={name:i.properties.xpath,index:e+1,label:r,key:!1,hidden:!i.properties.visible||"columnHidden"===i.properties.type||!1===i.properties.columnVisible,summarizeBy:i.properties.totalize&&i.properties.totalize.operation?i.properties.totalize.operation:void 0,bizAgiProperties:i.properties};t.push(a)})),t},refresh:function(){return $.when(this.fetchData())},dataReady:function(){return null!=this.dataReadyDeferred?this.dataReadyDeferred.promise():null},updateData:function(e){var t=this.columns;e&&this.properties&&(this.properties.data=e,this.setCellOverrides(e,t),this.triggerGridPluginHandler("setData",e))},fetchData:function(e,t,i){var r=this,a=r.properties;return e=e||1,t=t||"",i=i||"asc",a.page=e,a.sort=t+" "+i,bizagi.util.smartphone.startLoading(),$.when(r.getRemoteData()).then((function(e){if(e)return $.when(r.updateData(e)).done((function(){r.triggerRenderChange({changed:!1})}))})).always((function(){bizagi.util.smartphone.stopLoading()}))},fetchTotalData:function(e){var t=this,i=t.properties;if(e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,sort:i.sort,page:1,rows:t.properties.data.records,searchFilter:i.searchFilter}),i.overrideGetRemoteData){var r=i.overrideGetRemoteData(e);return null!=r?r.promise():null}var a=new $.Deferred;return t.dataService.multiaction().getGridData(e).done((function(e){t.isRTL()&&(e.rows=t.changeOrderData(e.rows)),a.resolve(e)})).fail((function(e){a.reject(e)})),a.promise()},collectData:function(e){var t=this.grid;if(this.properties.inlineAdd)for(var i=t.bizagi_grid_smartphone.hasOwnProperty("getNewRowKeys")?t.bizagi_grid_smartphone("getNewRowKeys"):[],r=0,a=i.length;r<a;r++)this.changes[i[r]]&&delete this.changes[i[r]];this._super(e)},onPageRequested:function(e){var t=this.properties,i={};jQuery.isEmptyObject(i)||this.dataService.submitData({action:"SUBMITDATA",data:i,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:t.idPageCache}),this.fetchData(e.page,e.sortBy,e.sortType)},onTotalData:function(e){var t=this;t.getFormContainer().saveForm(),bizagi.util.smartphone.startLoading(),$.when(t.fetchTotalData()).done((function(e){var i,r,a=e.rows,n=(a.length,[]);t.buildColumnModel().forEach((function(e,o){if(e.bizAgiProperties){switch(r=e.bizAgiProperties.totalize.operation){case"sum":i=a.sum((function(t){var i=null!==t[o]?t[o]:e.bizAgiProperties.defaultvalue;return Number(i)}),o);break;case"count":i=a.count((function(t){var i=null!==t[o]?t[o]:e.bizAgiProperties.defaultvalue;return bizagi.util.isArray(i)?bizagi.util.isArray(i)&&i.length>0?i:void 0:i}),e,o);break;case"max":i=a.max((function(t){var i=null!==t[o]?t[o]:e.bizAgiProperties.defaultvalue;return Number(i)}),o);break;case"min":i=a.min((function(t){var i=null!==t[o]?t[o]:e.bizAgiProperties.defaultvalue;return Number(i)}),o);break;case"avg":i=(i=a.avg((function(t){var i=null!==t[o]?t[o]:e.bizAgiProperties.defaultvalue;return Number(i)}),o)).toFixed(2)}r&&(i=t.formatTotalizedResult(r,e.bizAgiProperties.type,i),n.push({label:e.label,total:i}))}})),t.showTotals(n)})).fail((function(e){bizagi.showMessageBox(bizagi.localization.getResource("render-grid-no-records"),"Error")})).always((function(){bizagi.util.smartphone.stopLoading()}))},formatTotalizedResult:function(e,t,i){switch(e){case"sum":case"avg":case"min":case"max":if("columnMoney"==t||"money"==t)return bizagi.util.formatMonetaryCell(i)}return i||0},showTotals:function(e){var t=this,i=kendo.template(t.renderFactory.getTemplate("bizagi.grid.totalizer"),{useWithBlock:!1}),r=$.extend(e,{orientation:t.properties.orientation}),a=$($.trim(i(r)));$(".bz-rn-grid-totalize-container").remove(),a.kendoMobileModalView({close:function(){t.triggerGlobalHandler("modalViewDidDisappear",{}),this.destroy(),this.element.remove()},useNativeScrolling:!0}),a.delegate(".bz-rn-grid-totalize-close-btn","click",(function(){a.data("kendoMobileModalView").close()})),t.triggerGlobalHandler("modalViewDidAppear",{}),a.kendoMobileModalView("open")},drawCell:function(e,t,i,r){var a=this;if(a.newRecords={},e.key)return i;var n=e.index-1,o=a.columns[n];a.cellMetadata[t]||(a.cellMetadata[t]={}),a.cellMetadata[t][n]||(a.cellMetadata[t][n]={});var s=a.cellMetadata[t][n].properties||o.originalProperties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;o.properties.displayType="normal",r&&(d=!0);var u=a.getCellOverride(t,e.index-1);if(u&&(l=u.visible,d=!!s.editable&&u.editable),l){if(d){var c=new $.Deferred;return $.when(o.render(t,i)).done((function(e){if(e&&"none"!==$(e).css("display")){var i=a.getHeaderStyles();e=(e=e.replace("headerStyles",i.header)).replace("headerLabelStyles",i.label)}r&&!a.newRecords[t]&&(a.newRecords[t]={});for(var n=0,s=a.columns.length;n<s;n++)a.cellOverrides[t]=a.cellOverrides[t]||{},a.getCellOverride(t,n).visible=!0;a.bindRenderChange(o,t,!0),c.resolve(e)})),c.promise()}return $.when(o.renderReadOnly(t,i)).then((function(e){if(e&&"none"!==$(e).css("display")){var t=a.getHeaderStyles(),i=$(e);if($(".ui-bizagi-label",i).attr("style",t.header),$("label",i).attr("style",t.label),void 0!==a.properties.textFormat&&(void 0!==a.properties.textFormat.color&&$("label",i).css("color",a.properties.textFormat.color),void 0!==a.properties.textFormat.size&&a.properties.textFormat.size>0)){var r=100+10*Number(a.properties.textFormat.size)+"%";$("label",i).css("font-size",r)}e=i[0].outerHTML}return e}))}return""},onCellReady:function(e,t,i,r){var a=e.index-1,n=this.columns[a],o=(null!=this.cellMetadata[t][a]?this.cellMetadata[t][a].properties:void 0)||n.originalProperties,s=void 0===o.visible||o.visible,l=void 0===o.editable||o.editable;if($(".bz-rn-messages",i).toggleClass("bz-rn-messages","bz-rn-messages-grid"),"summary"==t&&(l=!1),r&&(l=!0),s)if(l){var d=n.properties.editable;if(n.properties.editable=l,n.properties.submitOnChange)(u=n.getDecorated(t))&&(u.properties.submitOnChangexpathContext=this.properties.xpath+"[]");n.postRender(t,i),n.properties.editable=d}else{var u;if(n.properties.submitOnChange)(u=n.getDecorated(t))&&(u.properties.submitOnChangexpathContext=this.properties.xpath+"[]");n.postRender(t,i)}},bindRenderChange:function(e,t,i){if(i){var r=this;e.getDecorated(t).bind("renderchange",(function(t,i){var a=e.getValue(i.render.surrogateKey),n=e.getCompositeValue(i.render.surrogateKey);if("columnDate"==e.properties.type)if(bizagi.util.isEmpty(a))""===a&&(a="");else{var o=bizagi.util.dateFormatter.getDateFromInvariant(a,i.render.properties.showTime||!1);a=bizagi.util.dateFormatter.formatInvariant(o,!0)}r.collectGridChange($.extend(i,{id:i.render.surrogateKey,xpath:e.properties.xpath||e.properties.id,value:a,compositeValue:n,columnIndex:e.columnIndex})),r.grid.bizagi_grid_smartphone("changeCellValue",i.render.surrogateKey,e.columnIndex,a),e.properties.totalize&&e.properties.totalize.operation&&r.grid.bizagi_grid_smartphone("refreshSummary",e.columnIndex)}))}else e.getDecorated(t).unbind("renderchange")},addRow:function(){var e=this,t=e.properties,i=e.getFormContainer().container,r=e.dataService;bizagi.util.smartphone.startLoading(),$.when(e.submitAddRequest()).done((function(a){var n=t.xpath+"[id="+a+"]",o={idRender:t.id,recordXPath:n,url:t.addPage,xpathContext:t.xpathContext,idPageCache:t.idPageCache,xpath:n,editable:!0,requestedForm:"addForm",displayName:t.addLabel,idAsigned:a,enableEditSubmitRequest:!1,hideLabel:!0,disableProcessButons:!0},s={renderFactory:e.renderFactory,dataService:r,parent:e,data:{properties:o}},l=new bizagi.rendering.formLink(s);jQuery.extend(l,{contextEdit:$(i).find("#container-items-edit"),element:e.element,actionSave:e.actionSaveNewRow,actionCancel:e.actionCancelRow,_sendRelation:function(){return!0},_getData:e.dataService.getFormData,_params:o}),e._InternalRenderLinkForm(l),bizagi.util.smartphone.stopLoading()})).fail((function(t){e.executeFormFailHandler(t)})).always((function(){bizagi.util.smartphone.stopLoading()}))},editRow:function(e){var t=this,i=t.getFormContainer();i.saveForm();var r=t.properties,a=t.getFormContainer().container,n=t.dataService,o=r.xpath+"[id="+e+"]";bizagi.util.smartphone.startLoading(),$.when(i.saveForm()).done((function(){var i={idRender:r.id,id:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,recordXPath:o,xpath:o,editable:!0,url:r.editPage,requestedForm:"editForm",displayName:r.editLabel,idAsigned:e,disableProcessButons:!0},s={renderFactory:t.renderFactory,dataService:n,parent:t,data:{properties:i}},l=new bizagi.rendering.formLink(s);jQuery.extend(l,{contextEdit:$(a).find("#container-items-edit"),element:t.element,actionSave:t.actionSaveNewRow,actionCancel:t.actionCancelRow,_sendRelation:l.submitEditRequest,_getData:t.dataService.getFormData,_params:i}),t._InternalRenderLinkForm(l)})).fail((function(e){t.executeFormFailHandler(e)})).always((function(){bizagi.util.smartphone.stopLoading()}))},_InternalRenderLinkForm:function(e){$.when(e.renderEdition()).done((function(){e.endLoading()}))},deleteRow:function(e){var t=this;bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){$.when(t.submitDeleteRequest(e)).done((function(i){t.fetchData(),"success"==i.type&&t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e})})).fail((function(e){t.executeFormFailHandler(e)}))}))},showDetail:function(e){this.executeSubmitShowDetailRequest(e)},executeSubmitShowDetailRequest:function(e){var t=this.properties,i=t.xpath+"[id="+e+"]";this.dataService,this.renderFactory;new bizagi.rendering.smartphone.slide.form(this.dataService,this.renderFactory,{title:t.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:this.getParams().navigation,container:this.getFormContainer().container,showSaveButton:!1}).render({idRender:t.id,recordXPath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,requestedForm:"detailForm",editable:!1})},actionCancelRow:function(){var e=$.Deferred();return $.when(this.submitRollbackRequest()).done((function(){e.resolve()})),e.promise()},actionSaveNewRow:function(e){var t=this,i=$.Deferred();if(!0===t.form.validateForm()){var r=t.properties;e||t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),$.when(t.parent.submitSaveRequest(r.idAsigned,e)).done((function(e){"validationMessages"==e.type?(t.form.addValidationMessage(e.messages),r.submitOnChange=!1,i.reject(e.messages)):(t.parent.fetchData(),r.submitOnChange||(r.submitOnChange=!0),t.submitOnChange({},!0),i.resolve())}))}else i.reject();return i.promise()},applyActionUpdateGrid:function(e,t){var i=t,r=e.decorated.actionSave;jQuery.extend(e.decorated,{actionSave:function(){var e=this;$.when(r.apply(e,arguments)).done((function(){var t={};i.collectRenderValues(t),$.when(i.submitSaveRequest(e.surrogateKey,t)).done((function(){i.fetchData()}))}))}})},collectRenderValues:function(e){$.each(this.columns,(function(t,i){(i=i.decorated).getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValues(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSent()&&i.collectData(e)}))},ready:function(){var e=this._super(),t=this.inlineAddDeferred?this.inlineAddDeferred.promise():null;return $.when(e,t)},setError:function(e,t){},changeCellValue:function(e,t,i){var r=this.getControlCell(e,t);if(r){null!=i&&r.setDisplayValue(i);var a=r.column.getValue(e),n=r.column.getCompositeValue(e);null!=i&&r.setDisplayValue(i);this.collectGridChange({id:e,xpath:t,value:a,compositeValue:n,columnIndex:r.column,trigger:!1})}},changeCellBackgroundColor:function(e,t,i){var r=this.getControlCell(e,t);r&&(r.changeCellBackgroundColor(i),r.element&&r.element.find(".bz-container-render-cell1, .ui-bizagi-render-control").css({"background-color":i,"background-image":i}))},changeCellColor:function(e,t,i){var r=this.getControlCell(e,t);r&&r.changeCellColor(i)},changeCellVisibility:function(e,t,i){var r=this.getControlCell(e,t);if(r){r.changeCellVisibility(i);for(var a=0,n=this.columns.length;a<n&&this.columns[a].properties.xpath!=t;a++);this.cellOverrides[e]=this.cellOverrides[e]||{},this.getCellOverride(e,a).visible=i,r.properties.editable&&i?this.bindRenderChange(this.getColumn(t),e,!0):this.bindRenderChange(this.getColumn(t),e,!1)}},changeCellEditability:function(e,t,i){var r=this.getControlCell(e,t);if(r){r.changeEditability(i);for(var a=0,n=this.columns.length;a<n&&this.columns[a].properties.xpath!=t;a++);this.cellOverrides[e]=this.cellOverrides[e]||{},this.getCellOverride(e,a).editable=i,r.properties.visible&&i?this.bindRenderChange(this.getColumn(t),e,!0):this.bindRenderChange(this.getColumn(t),e,!1)}},changeCellMinValue:function(e,t,i){var r=this.getControlCell(e,t);if(r){r.changeMinValue(i);for(var a=0,n=this.columns.length;a<n&&this.columns[a].properties.xpath!=t;a++);this.cellOverrides[e]=this.cellOverrides[e]||{},this.getCellOverride(e,a).minValue=i}},changeCellMaxValue:function(e,t,i){var r=this.getControlCell(e,t);if(r){r.changeMaxValue(i);for(var a=0,n=this.columns.length;a<n&&this.columns[a].properties.xpath!=t;a++);this.cellOverrides[e]=this.cellOverrides[e]||{},this.getCellOverride(e,a).maxValue=i}},cleanCellData:function(e,t){var i=this.getControlCell(e,t);if(i){i.cleanData();for(var r=0;r<this.columns.length&&this.columns[r].properties.xpath!=t;r++);for(var a=this.properties.data.rows,n=0,o=a.length;n<o;n++)if(Number(e)===a[n][0]){a[n][r+1]=[["",""]];break}this.cellOverrides[e]=this.cellOverrides[e]||{},this.getCellOverride(e,r).value=null}},triggerGridPluginHandler:function(){var e=this,t=Array.prototype.slice.call(arguments,0);return e.grid.bizagi_grid_smartphone.apply(e.grid,t)},isValidGrid:function(e){var t=[],i=this.getFormContainer();if(void 0!==i.validationController&&i.validationController.clearValidationMessages(),this.isValid(t),t.length>0){if(void 0!==i.validationController)for(var r=0,a=t.length;r<a;r++)i.validationController.showValidationMessage(t[r].message,t[r].xpath);return!1}return!0},getLabel:function(){return $(".ui-bizagi-label",this.element||this.observableElement)},changeBackgroundColor:function(e){this._super(e),this.getControl().find(".bz-rn-grid-cn-header").css("background-color",e,"!important")},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},startLoading:function(){bizagi.loading.start()},endLoading:function(){bizagi.loading.stop()}}),bizagi.rendering.search.extend("bizagi.rendering.search",{ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,SEARCH_MIN_LENGTH:3,SEARCH_DELAY:750},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonlySearch"),t=this.properties.value&&this.hasValue()?this.properties.value.label:"";return $.kendoTmpl(e,{value:t})},renderSingle:function(){var e=this.properties,t=this.getContainerRender(),i=this.getControl();this.input=$(".bz-rn-container-search",i),this.inputText=this.input.find(".bz-rn-input-search-text"),e.editable||(t.addClass("bz-rn-non-editable"),this.inputText=$(".bz-rn-text",i)),e.allowSuggest&&(t.addClass("bz-command-edit-inline"),e.editable&&this._simplySearch()),this.configureHandlers()},configureHandlers:function(){var e=this,t=e.properties,i=e.getContainerRender();e.properties.advancedSearch&&t.editable&&(i.addClass("bz-command-edit-inline"),e.input.bind("click",(function(){e.renderSearchForm()}))),t.editable&&e.input.on("click",".bz-rn-search-control-icons-clear",(function(t){t.stopPropagation(),e.setValue({id:""}),e.inputText.prop("value",""),$(this).addClass("hidden"),e.inputText.removeClass("hasValue")}))},hasValue:function(){return null!=this.getValue()&&""!==this.getValue().id&&void 0!==this.getValue().id},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("search"),i={allowSuggest:e.allowSuggest,editable:e.editable,allowClear:e.allowClear,id:e.id,xpath:e.xpath,hasValue:this.hasValue(),allowTyping:e.allowTyping,advancedSearch:e.advancedSearch,hasMozillaHelpText:!(!$.browser||!$.browser.mozilla||null===e.helpText||""==e.helpText)};return $.kendoTmpl(t,i)},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=t.originalValue;if((!a||a.id!==r.id||$.forceCollectData)&&!bizagi.util.isEmpty(i)&&null!=r){if("object"==_typeof(r)&&void 0===r.id)return;e[t.xpath]=r}},setDisplayValue:function(e){var t="";null!=(e=this.mapValue(e))&&void 0!==e.id&&(t=e.additionallabel&&e.label?e.label+", "+e.additionallabel:e.label?e.label:"",this.properties.editable?(this.setValue(e,!0),this.inputText.val(t),this.inputText.attr("id",e.id),this.inputText.html(t),void 0!==e?this.inputText.addClass("hasValue"):this.inputText.removeClass("hasValue")):this.inputText.text(t))},cleanData:function(){var e={id:"",value:""};this.setValue(e),this.setDisplayValue(e)},_simplySearch:function(){var e=this,t=e.getControl();e.inputText.on("click keyup",(function(){e.autoCompleteSearchResults()})),t.on("click mousedown","li",(function(){var t=$.data(this).itemautocomplete,i=Array.isArray(t.value)?t.value.join(","):t.value;e.setDisplayValue({id:t.id,label:i}),$(this).parent().hide(),e.input.find(".bz-rn-search-control-icons-clear").removeClass("hidden"),e.inputText.addClass("hasValue")})),t.on("focusout","input",(function(){t.find("ul").hide(),e.inputText.parent().find(".bz-rn-autocomplete-wrapper").addClass("hidden")}))},autoCompleteSearchResults:function(){var e=this,t=e.inputText.val();""===t&&e.input.find(".bz-rn-search-control-icons-clear").addClass("hidden"),$.when(e.processRequest({term:t},(function(){}))).done((function(t){var i=e.inputText.parent().find(".bz-rn-autocomplete-wrapper");t.length>0?i.removeClass("hidden"):i.hasClass("hidden")||i.addClass("hidden");var r=e.inputText.parent().find("ul");r.find("li").remove(),r.css({display:"inline-block",left:e.inputText.position().left,top:e.inputText.position().top+15,width:e.inputText.css("width")});for(var a=0,n=t.length;a<n;a++){var o=e.renderSearchItem(t[a]);$(o).addClass("bz-rn-autocomplete-item"),o.appendTo(r)}}))},renderSearchForm:function(){var e=this,t=e.properties,i=$.extend({},e.getParams(),{navigation:e.getFormContainer().getNavigation()});new bizagi.rendering.smartphone.helpers.searchForm(e.dataService,e.renderFactory,t.searchForms,{allowFullSearch:t.allowFullSearch,maxRecords:t.maxRecords,allowNew:t.allowNew||!1,orientation:t.orientation||"ltr"},i).renderEdition({idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,displayName:t.displayName,idPageCache:t.idPageCache}).done((function(i){e.setValue({id:i}),t.submitOnChange=!0,e.submitData()}))},renderSearchItem:function(e){var t=$.kendoTmpls(this.renderFactory.getTemplate("edition.search.item"),{id:e.id,label:e.label,value:e.value});return t.data("itemautocomplete",e),t},processRequest:function(e,t){var i=this,r=i.properties,a=new $.Deferred,n=[];function o(e){r.advancedSearch&&e.push({id:i.Class.ADVANCED_SEARCH_ID,label:"",value:""}),r.allowAdd&&e.push({id:i.Class.ADVANCED_ADDITION_ID,label:"",value:""}),a.resolve(e)}return e.term.length>=this.Class.SEARCH_MIN_LENGTH?(r.term=e.term,this.getData().done((function(t){for(var i=-1;t[++i]&&r.maxRecords>i&&i<10;)n.push({id:t[i].id,label:t[i].value.toString().replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(e.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"),value:t[i].value});o(n)})).fail((function(){a.reject()}))):o(n),a.promise()},setDisplayValueEdit:function(e){this.inputEdition.find(".ui-bizagi-render-search").val(this.selectedValue)},submitData:function(){var e=this.properties,t={};t[e.xpath]=this.getValue(),e.submitOnChange&&null!=t[e.xpath].id&&this.submitOnChange(t,!0)},actionSave:function(){this.inputText.html(this.value.value||this.value.label),this.inputText.val(this.value.value||this.value.label),this.inputText.attr("id",this.value.id)}}),bizagi.rendering.letter.extend("bizagi.rendering.letter",{},{renderSingle:function(){this.properties.editable=!1}}),bizagi.rendering.button.extend("bizagi.rendering.button",{},{renderSingle:function(){var e=this,t=e.properties,i=e.getContainerRender(),r=e.getControl();$.when(e.renderControl()).done((function(){e.input=$(":button",r).click((function(){e.processButton()}))})).always((function(){t.editable?i.addClass("bz-command-edit-inline"):(i.addClass("bz-rn-non-editable"),e.input.prop("disabled",!0))}))},processButton:function(){var e=this,t=e.properties;t.editable&&(t.needsUserConfirmation?$.when(bizagi.showConfirmationBox(t.userConfirmationMessage,"Bizagi","warning")).done((function(){e.triggerRenderChange({pressed:!0})})):(t.preventDefault||e.runButtonAction(),e.triggerRenderChange({pressed:!0})))},runButtonAction:function(){var e=this;e.getFormContainer().clearValidationMessages(),e.saveForm().pipe((function(){return e.executeButton()})).done((function(t){if(null==t||1==t||"success"==t.result||"success"==t.type)return e.refreshForm();if("validationMessages"==t.type)try{e.getFormContainer().addValidationMessage(t.messages)}catch(e){bizagi.showMessageBox(t.messages,"Error")}})).fail((function(t,i,r){try{e.getFormContainer().addErrorMessage(r)}catch(e){bizagi.showMessageBox(r,"Error")}}))},processLayout:function(){var e=this.properties,t=null==e.visible||bizagi.util.parseBoolean(e.visible);e.required=null!=e.required&&bizagi.util.parseBoolean(e.required),e.required&&this.changeRequired(e.required),t||this.changeVisibility(t)}}),bizagi.rendering.fileprint.extend("bizagi.rendering.fileprint",{},{renderSingle:function(){this.getControl().parent().hide()}}),bizagi.rendering.link.extend("bizagi.rendering.link",{},{renderSingle:function(){var e=this.getControl(),t=this.getContainerRender(),i=$(".ui-bizagi-render-link",e);this.input=e.find("a"),this.getArrowContainer().hide(),this.properties.value?this.configureHandlers():(i.addClass("ui-state-disabled"),t.addClass("bz-rn-non-editable"))},setDisplayValue:function(e){this.isValidValue(e)&&(e=getFullyDecodedURI($.trim(e)),this.input.attr("href",e))},configureHandlers:function(){var e=this,t=e.properties;e.input.on("click",(function(i){if(i.preventDefault(),i.stopPropagation(),e.isValidValue(t.value)){var r=encodeURI(this.getAttribute("href"));"newwindow"===t.linktarget||bizagi.util.isCordovaSupported()?window.open(r,"_system","location=yes"):window.open(r,"_system")}}))},isValidValue:function(e){return e&&null!==$.trim(e+"").toLowerCase().match(/^(http|https):\/\//)||!1}}),bizagi.rendering.checkList.extend("bizagi.rendering.checkList",{},{postRenderSingle:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-display-block"),this.properties.unique=Math.ceil(1e3*Math.random())},configureHandlers:function(){var e=this;e._super(),$("input[type=checkbox]",e.checkListGroup).bind("change",(function(t,i){var r=$(this).data("item-guid"),a=!1;$(this).hasClass("bz-check")?($(this).removeClass("bz-check").addClass("bz-full-ball"),a=!1):($(this).removeClass("bz-full-ball").addClass("bz-check"),a=!0),e.onCheckListGroupChange(r,a)}))},onCheckListGroupChange:function(e,t){var i,r=$.grep(this.properties.items,(function(t,i){return t.guid===e}));r&&r.length>0&&(i=r[0]),i.checked=t},clearDisplayValue:function(){$("input[type=checkbox]",this.checkListGroup).removeAttr("checked")},setDisplayValue:function(e){}}),bizagi.rendering.checkList.extend("bizagi.rendering.activityCheckList",{},{postRenderSingle:function(){this.getControl();this._super(),this.header=$(".ui-bizagi-render-checkList-activity-work",this.element),this.addButton=$(".ui-bizagi-render-checkList-add-item",this.control),this.newItemName=$(".ui-bizagi-render-checkList-input-name",this.control),this.separator=$(".ui-bizagi-render-checkList-separator",this.element),this.goalActivity=$(".ui-bizagi-render-checkList-goal-activity",this.element),this.addEditButton=$(".add-edit-item-button-checklist",this.control),this.cancelEditButton=$(".cancel-edit-item-button-checklist",this.control),this.additionalElements(),this.configureHandlers(),$(".ui-bizagi-render-edition-arrow",this.getControl().parent()).hide(),this.notifyLoadItems()},notifyLoadItems:function(){var e=this;setTimeout((function(){var t=e.properties.items.filter((function(e){return e.resolved})).length;bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!0,idActivity:e.properties.idActivity,itemsResolved:t,items:e.properties.items,progress:e.properties.activityWork})),bizagi.webpart.publish("onLoadDataItemsFromFormActivityPlan",{items:e.properties.items,activityWork:e.properties.activityWork})}),100)},additionalElements:function(){var e=this.getControl(),t=(this.getResource("render-activity-check-list-activitywork"),this.properties.activityWork,this.getResource("render-activity-check-list-form"));this.header&&this.header.length>0||this.element.prepend($("<div/>").addClass("ui-bizagi-render-checkList-activity-work").append($("<span/>").text(bizagi.localization.getResource("workportal-project-plan-activity-work-title")))),this.goalActivity&&this.goalActivity.length>0||this.properties.activityDescription&&""!==this.properties.activityDescription&&this.element.prepend($("<div/>").addClass("ui-bizagi-render-checkList-goal-activity").append("<h4><span class='ui-bizagi-wp-bold'>"+bizagi.localization.getResource("workportal-project-plan-activity-goal")+": </span><span>"+this.properties.activityDescription+"</span></h4>")),this.addButton&&this.addButton.length>0||this.control.append($("<div/>").addClass("ui-bizagi-render-checkList-add-item").append($("<button/>").text("+"))),this.separator&&this.separator.length>0||this.element.append($("<div/>").addClass("ui-bizagi-render-checkList-separator").append($("<span/>").text(t))),this.addEditButton&&this.addEditButton.length>0&&this.addEditButton.hide(),this.cancelEditButton&&this.cancelEditButton.length>0&&this.cancelEditButton.hide(),e.parent().addClass("render-activity-check")},configureHandlers:function(){var e=this,t=e.getControl();this._super(),$(".ui-bizagi-render-checkList-add-item button",t).unbind("click").click((function(){var t=$(".ui-bizagi-render-checkList-item.selected",e.control);t.length<=0?e.prepareNewItem():$(".ui-bizagi-render-checkList-input-name",t).focus()})),$(".delete-item-from-activity",e.control).bind("click",(function(){var t=this,i=bizagi.localization.getResource("workportal-widget-reports-confirm"),r=$(this).closest(".ui-bizagi-render-checkList-item");r.addClass("ui-bizagi-to-remove"),$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done((function(){var i=$(t).closest(".ui-bizagi-render-checkList-item").data("item-guid");e.deleteItem(i),e.addButton.show()})).fail((function(){r.removeClass("ui-bizagi-to-remove")}))})),$(".activity-work-items",e.control).bind("click",(function(){var t=$(this).closest(".ui-bizagi-render-checkList-item"),i=t.data("item-guid"),r=t.data("item-position");e.selectItem(i,r)}))},selectItem:function(e){for(var t=0,i=this.properties.items.length;t<i;t++)this.properties.items[t].guid===e?this.properties.items[t].selected=!0:this.properties.items[t].selected=!1;this.repaintControl();var r=$(".ui-bizagi-render-checkList-item.selected"),a=$(".ui-bizagi-render-checkList-input-name",r),n=a.val();a.focus(),a[0].setSelectionRange(n.length,n.length),this.addButton.hide(),this.addSelectedHandlers()},deleteItem:function(e){for(var t=0,i=this.properties.items.length;t<i;t++)if(this.properties.items[t].guid===e){this.properties.items.splice(t,1);break}this.setValue(this.properties.items),this.repaintControl(),this.addSelectedHandlers()},prepareNewItem:function(){var e=this,t={guid:Math.guid(),resolved:!1,name:"",selected:!0};e.properties.items.push(t),e.repaintControl(),e.addButton.hide(),e.newItemName.focus(),e.newItemName.blur((function(){var t=$(".ui-bizagi-render-checkList-item.selected",e.control);""===$(".ui-bizagi-render-checkList-input-name",t).val()&&e.properties.items&&e.properties.items.length>=1&&""===e.properties.items.slice(-1)[0].name&&e.properties.items.pop()})),e.addSelectedHandlers(),e.newItemName.keypress((function(t){13==t.which&&(t.preventDefault(),e.addItem(),e.prepareNewItem())}))},addSelectedHandlers:function(){var e=this,t=$(".ui-bizagi-render-checkList-item.selected",e.control),i=$(".ui-bizagi-render-checkList-input-name",t);i.focus(),$(".add-item-button-checklist",t).bind("click",(function(){var t=i.val();t&&""!==t&&e.addItem()})),$(".cancel-item-button-checklist",t).bind("click",(function(t){var r=i.val(),a=$(this).closest(".ui-bizagi-render-checkList-item"),n=a.data("item-position"),o=a.data("item-guid");r&&""!==r&&""!==e.properties.items[n].name&&(e.properties.items[n].selected=!1),""!==r&&""!==e.properties.items[n].name||e.deleteItem(o),e.addButton.show(),e.repaintControl()}))},addItem:function(){this.getControl();var e=$(".ui-bizagi-render-checkList-item.selected",this.control),t=$(".ui-bizagi-render-checkList-input-name",e).val();$.each(this.properties.items,(function(e,i){i.selected&&(i.name=t,i.selected=!1)})),this.updateOriginalValue(),this.setValue(this.properties.items),this.repaintControl(),this.addButton.show()},repaintControl:function(){this.getControl();var e=this.renderControl();$(".ui-bizagi-render-checkList",this.control).replaceWith(e),this.postRenderSingle()},onCheckListGroupChange:function(e,t){var i,r=$.grep(this.properties.items,(function(t,i){return t.guid===e}));r&&r.length>0&&(i=r[0]),i.resolved=t,this.setValue(this.properties.items),this.refreshValue(this.properties.items)},refreshValue:function(e){this.getControl();for(var t=e.length,i=0,r=0;r<t;r++)e[r].resolved&&(i+=1);this.properties.activityWork=t>0?Math.floor(100*i/t):100,this.notifyLoadItems()},getValue:function(e){return this.value||[]},controlValueIsChanged:function(){return JSON.stringify(this.properties.originalValue)!==JSON.stringify(this.value)},updateOriginalValue:function(){this.properties.originalValue=bizagi.clone(this.value)},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue(),a=this.properties.idActivity;this.controlValueIsChanged()?bizagi.util.isEmpty(i)||bizagi.util.isEmpty(a)||(Array.isArray(r)?e[t.xpath]={idActivity:a,items:r}:""===r&&(e[t.xpath]="")):bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!1}))},isValid:function(e){var t,i=this.properties,r=this.getValue();t=this.getResource("render-activity-check-list-validation");for(var a=0;a<r.length;a+=1){if(!r[a].resolved){e.push({xpath:i.xpath,message:t});break}}}}),bizagi.rendering.layoutImage.extend("bizagi.rendering.layoutImage",{},{renderControl:function(){var e=this.renderFactory.getTemplate("layout-image");return this.control=this.getControl(),$.kendoTmpl(e,{})},postRenderSingle:function(){var e=this.getControl();if(this.value&&void 0!==this.value.value&&""!==this.value.value&&null!==this.value.value){var t=this.getImageUri();$.ajax({url:t,type:"GET",dataType:"binary",processData:!1,success:function(t){if("string"==typeof t){var i=arguments[2],r=i.getResponseHeader("Content-type");t=bizagi.util.media.byteArrayToBlob(bizagi.util.media.stringToByteArray(t),r)}var a=window.URL||window.webkitURL,n=a.createObjectURL(t);$(e).find("img").attr("src",n)}})}},getImageUri:function(){var e=this.parent.parent.properties.paramsRender||{},t={entity:this.value.guid,surrogateKey:this.value.surrogateKey,xpath:this.properties.xpath,width:96,height:96,hash:this.value.value,idcase:e.idRender?e.formParams.idCase:"_",idworkitem:e.idRender?e.formParams.idWorkitem:"_",contextxpath:e.idRender?e.xpathActions:"_"};return this.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(t)},getDisplayValue:function(){return[this.value]}}),bizagi.rendering.layoutLink.extend("bizagi.rendering.layoutLink",{},{renderSingle:function(){this.getContainerRender().addClass("bz-command-not-edit"),this.value=void 0},postRenderSingle:function(){var e=this.element;e&&e.on("click",$.proxy(this.onClickElement,this))},onClickElement:function(){var e={displayName:this.properties.displayName,navigateFromRender:!1,reference:this.properties.reference,referenceType:this.properties.referenceType,xpath:this.properties.xpath};bizagi.kendoMobileApplication&&"#renderSplitView"==bizagi.kendoMobileApplication.view().id&&(e.navigateFromRender=!0),this.triggerGlobalHandler("DATA-NAVIGATION",e)}}),bizagi.rendering.layoutLabel.extend("bizagi.rendering.layoutLabel",{},{setValue:function(e,t){this.properties.displayName=e,this._super(e,t);var i=this.getControl();i&&$(".ui-bizagi-render-label",i).text(e)}}),bizagi.rendering.layoutText.extend("bizagi.rendering.layoutText",{},{setDisplayValue:function(e){}}),bizagi.rendering.layoutDateTime.extend("bizagi.rendering.layoutDateTime",{},{}),bizagi.rendering.layoutNumber.extend("bizagi.rendering.layoutNumber",{},{setValue:function(e,t){var i=this.getControl();e=null==e?"":this.getDisplayValue(e),this.properties.displayName=e,this._super(e,t),i&&$(".ui-bizagi-render-number",i).text(e)},getDisplayValue:function(e){var t=this.properties,i=$("<label/>").html(e);return i.formatCurrency({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize}),[i.text()]}}),bizagi.rendering.layoutMoney.extend("bizagi.rendering.layoutMoney",{},{setValue:function(e,t){var i=this.getControl();e=null==e?"":this.getDisplayValue(e),this.properties.displayName=e,this._super(e,t),i&&$(".ui-bizagi-render-number",i).text(e)}}),bizagi.rendering.layoutUpload.extend("bizagi.rendering.layoutUpload",{},{renderControl:function(){var e=this,t=e.properties,i=$.Deferred();return $.when(e.getValueFilesByData(bizagi.clone(t))).done((function(t,r){e.properties=t,e.files=r.files,i.resolve(e.getHTMLFiles())})),i.promise()},postRenderSingle:function(){var e=this;e.getControl().find(".ui-bizagi-render-upload-item a").on("click",(function(){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile($(this).attr("data-url"),this.title)).fail((function(t){t.responseText&&e.getFormContainer().failHandler(t.responseText)})).always((function(){bizagi.loading.stop()}))}))},getHTMLFiles:function(){var e=this,t=$.map(e.files,(function(t){var i={id:t[0],filename:t[1]};return i.url=e.buildItemUrl(i),i})),i=e.renderFactory.getTemplate("layout-upload");return $.kendoTmpl(i,{files:t})},buildItemUrl:function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileEntityUrl({isContextContainerWidgetRender:this.isContextContainerWidgetRender(),xpath:this.getUploadXpath(),fileId:e.id,idRender:i.properties.paramsRender.idRender||"undefined",xpathContext:t.xpathContext,idPageCache:i.properties.paramsRender.idPageCache||"undefined",xpathActions:i.properties.paramsRender.xpathActions||"undefined",sessionId:i.properties.sessionId,surrogatekey:this.properties.value.surrogateKey,guidentity:this.properties.value.guid})}}),bizagi.rendering.image.extend("bizagi.rendering.image",{QUALITY_PICTURE:50,EXTENSIONSIMG:["jpeg","jpg","png"]},{$addImage:null,$deleteImage:null,$inputFile:null,isNative:!1,isOfflineForm:!1,renderControl:function(){var e=this.properties;this.isOfflineForm=!1,this.isNative=bizagi.util.isCordovaSupported();var t=this.renderFactory.getTemplate("image"),i=!this.isOfflineForm&&(e.allowDelete&&e.editable);return $.kendoTmpl(t,{url:"",allowDelete:i,editable:e.editable})},getElementsToStylize:function(e){return $({})},renderReadOnly:function(){return this.renderControl()},postRender:function(){},postRenderReadOnly:function(){this.element.addClass("bz-rn-read-only bz-rn-non-editable")},configureHandlers:function(){var e=this,t=bizagi.util.getAndroidVersion(),i=[];this.$addImage=$(".bz-rn-image-actions-add",this.getControl()),this.$deleteImage=$(".bz-rn-image-actions-delete",this.getControl()),this.$inputFile=$(".bz-rn-upload-image-web",this.getControl()),this._super(),this.isNative?this.$addImage.off("click").actionSheet({actions:[{guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")},{guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}],actionClicked:function(t){switch(t.guid){case 1:e.imageAdd();break;case 2:e.imageAdd(!0)}},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}):bizagi.util.media.fileAPISupported()?this.$addImage.off("click").click((function(){e.$inputFile.click()})):(this.element.addClass("bz-rn-read-only bz-rn-non-editable"),this.$addImage.removeClass("bz-plus").addClass("bz-rn-read-only")),this.$deleteImage.off("click").click((function(){e.imageDelete()})),this.$inputFile.off("change").on("change",(function(){e.imageAdd(),this.value=""})),this.$inputFile.off("click").on("click",(function(e){e.stopPropagation()})),i=t&&t<=4.4?[{guid:4,displayName:bizagi.localization.getResource("workportal-size-original")}]:bizagi.util.media.getImageResolutionItems(),$(".bz-resolution-container",e.getControl()).off("click").actionSheet({actions:i,actionClicked:function(t){bizagi.loading.start(),$.when(e.resolutionButtonHandler(t.guid)).always((function(){bizagi.loading.stop()}))},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})},clearDisplayValue:function(){this.$deleteImage.click()},imageAdd:function(e){var t=this;if(this.isNative){var i={quality:t.Class.QUALITY_PICTURE,targetWidth:1280,targetHeight:960,correctOrientation:!0};if(!e){var r=t.getControl()[0].getBoundingClientRect();i={quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,popoverOptions:new CameraPopoverOptions(r.left,r.top-20,200,100,4),destinationType:navigator.camera.DestinationType.FILE_URI,correctOrientation:!0}}navigator.camera.getPicture((function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then((function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then((function(i){if(bizagi.util.media.checkFileTypes(i,t.properties,t.Class.EXTENSIONSIMG)){t.dataImage=e,t.fileProperties=i;var r=bizagi.util.getAndroidVersion();if(r&&r<=4.2||t.isOfflineForm)return $.when(t.uploadFile(t.dataImage)).done((function(e){t.uploadFileCompleted(t)})).fail((function(e){t.executeFormFailHandler(e)})).always((function(){bizagi.loading.stop()}));if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then((function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.resolutionButtonHandler(e)}));$(".bz-resolution-container",t.getControl()).click()}}))})).always((function(){bizagi.loading.stop()}))}),t.onFail,i)}else{var a=this.$inputFile[0].files[0];a.fullPath=this.$inputFile[0].value;var n=this.Class.EXTENSIONSIMG;bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(a,t.properties)&&bizagi.util.media.checkFileTypes(a,t.properties,n)?$.when(t.uploadFile(a)).done((function(e){t.uploadFileCompleted(t)})).fail((function(e){t.executeFormFailHandler(e)})).always((function(){bizagi.loading.stop()})):bizagi.loading.stop()}},onFail:function(e){bizagi.util.smartphone.stopLoading()},imageDelete:function(){var e=this;bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done((function(){bizagi.loading.start(),$.when(e.dataService.deleteImage({url:e.properties.deleteUrl,idRender:e.properties.id,xpath:e.properties.xpath,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,contexttype:e.properties.contexttype})).done((function(){e.uploadFileCompleted(e)})).fail((function(e){var t,i=e.responseText;try{t=(t=JSON.parse(i)).message||i}catch(e){t=i}bizagi.showMessageBox(t,"Error")})).always((function(){bizagi.loading.stop()}))}))},uploadFile:function(e){var t=this,i=new $.Deferred;if(this.isOfflineForm)t.saveImageOffline(t,e,(function(e){t.setValue(e),i.resolve()})),t.canBeSent=function(){return!0};else if(this.isNative){var r={},a=t.buildAddParams(),n=t.fileProperties.name;t.editedImageURL?r.dataFile=t.editedImageURL:t.fileProperties&&(r.dataFile=t.fileProperties.url),a.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),r.data=a,r.options=new FileUploadOptions,r.options.fileKey="file",r.options.fileName=n,r.options.mimeType="image/jpeg",r.options.uploadKey={key:a.h_xpath},r.options.addUrl=t.properties.addUrl,t.editedImageURL=null,t.fileProperties=null,r.dataFile=bizagi.util.media.getImagePath(r.dataFile),$.when(bizagi.util.media.uploadFile(r)).done((function(e){var t=JSON.parse(decodeURIComponent(e.response));"error"===t.type?i.reject(t):i.resolve(t)})).fail((function(e){i.reject(e)}))}else bizagi.util.media.checkMaxSizeFile(e,t.properties)&&bizagi.util.media.checkFileTypes(e,t.properties,t.Class.EXTENSIONSIMG)?t.dataService.processUploadFile({url:t.properties.addUrl,formData:t.buildAddFileParams(e)}).done((function(e){i.resolve(e)})).fail((function(e){i.reject(e)})):i.reject();return i.promise()},uploadFileCompleted:function(e){var t=e;try{t.showAsyncImage(),t.editedImageURL=null}catch(e){t.getFormContainer().refreshForm()}},showAsyncImage:function(){var e=this,t=e.getControl();$.when(e.buildItemUrl()).done((function(i){e.isDisposed()||(e.properties.url=""!==i?i:"",e.properties.value=e.properties.url.length>0?[e.properties.url]:null,e.setValue(e.properties.value),e.isOfflineForm&&-1!==i.indexOf("Invalid case id")&&(e.properties.url=""),t.find(".bz-rn-image-container").off("click").toggleClass("bz-rn-image-actions-add",e.properties.editable&&""===e.properties.url),""!==e.properties.url?(t.find(".bz-rn-image-container img").css("display","inherit").attr("src",e.properties.url),t.find(".bz-rn-image-container img").off("click").click((function(){e.renderEdition()})),t.find(".bz-rn-image-actions-add").toggle(e.properties.editable),t.find(".bz-rn-image-actions-delete").toggle(e.properties.allowDelete&&e.properties.editable)):(t.find(".bz-rn-image-container img").css("display","none"),t.find(".bz-rn-image-actions-add.bz-upload").hide(),t.find(".bz-rn-image-actions-delete").hide()),e.configureHandlers())}))},saveImageOffline:function(e,t,i){var r=this.getControl(),a=new Image;a.onload=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height,e.getContext("2d").drawImage(this,0,0);var t=e.toDataURL("image/png");i(t.replace(/^data:image\/(png|jpg|jpeg);base64,/,""))},a.src=t,r.find("img").replaceWith(a),r.find(".bz-cm-icon.image-file").replaceWith(a)},resolutionButtonHandler:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return $.when(t.uploadFile(t.dataImage)).done((function(e){t.uploadFileCompleted(t)})).fail((function(e){t.executeFormFailHandler(e)}));var r=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,r)).then((function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,$.when(t.uploadFile(t.dataImage)).done((function(e){t.uploadFileCompleted(t)})).fail((function(e){t.executeFormFailHandler(e)}))}))},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},postRenderSingle:function(){this._super(),this.configureHandlers(),this.configureHelpText(),this.properties.editable||this.postRenderReadOnly(),this.showAsyncImage()},renderEdition:function(){var e=this,t=e.properties,i=e.getParams(),r=i.navigation.createRenderContainer({title:t.displayName,view:{zoom:!0,useNativeScrolling:!1}}),a=$.kendoTmpls(e.renderFactory.getTemplate("image-preview"),{url:e.value&&""!==e.value[0]?e.value[0]:""});r.element.css("display","none"),e.inputEdition=r.element.html(a),i.navigation.navigate(r.id),bizagi.loading.start(),$.when(e.buildFullItemUrl()).done((function(t){if(r.element.css("display","block"),t.indexOf("error")<0){var i=$(".bz-rn-image-render-preview:first",r.element).attr("src",t),a=i.css("width");a=Number(a.substring(0,a.length-2)),-1!==e.properties.width&&e.properties.width<a&&i.css("width","100%")}})).always((function(){bizagi.loading.stop()}))},buildAddFileParams:function(e){var t=this.properties,i=new FormData,r=this.getFormContainer();i.append(this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath",t.xpath),i.append(this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender",t.id),i.append(this.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext",t.xpathContext),i.append(this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE,t.idPageCache),i.append(this.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId),i.append(this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action","savefile"),i.append(this.properties.xpath,e),t.contexttype&&i.append(this.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype",t.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?i.append(BIZAGI_SESSION_NAME,r.properties.sessionId):i.append("JSESSIONID",r.properties.sessionId)}catch(e){i.append("JSESSIONID",r.properties.sessionId)}return i},postRenderEdit:function(){}}),bizagi.rendering.image.extend("bizagi.rendering.image",{QUALITY_PICTURE:50,EXTENSIONSIMG:["jpeg","jpg","png"]},{imageAdd:function(e){var t=this,i=bizagi.override&&bizagi.override.mobileImageEditorParams?bizagi.override.mobileImageEditorParams:{},r=e?"camera":"library";!bizagi.util.isNativeImageEditorSupported()||bizagi.util.isNativeImageEditorSupported()&&void 0!==i.enableImageEditor&&!i.enableImageEditor?t._super(e):$.when(t.openImageEditor(r,i)).done((function(e){$.when(bizagi.util.media.checkMaxSize(e,t.properties)).done((function(){bizagi.util.media.getFileDataInfo(e).then((function(i){bizagi.util.media.checkFileTypes(i,t.properties,t.Class.EXTENSIONSIMG)&&(t.dataImage=e,t.fileProperties=i,$.when(t.uploadFile(t.dataImage)).done((function(e){t.uploadFileCompleted(t,e)})).fail((function(e){t.executeFormFailHandler(e)})).always((function(){bizagi.loading.stop()})))}))}))})).fail((function(e){bizagi.showMessageBox(e)}))},openImageEditor:function(e,t){var i=new $.Deferred;return t.source=e,t.imageMaxSize=this.properties.maxSize,bizagiapp.openImageEditor(t,(function(e){i.resolve(JSON.parse(e).imageURL)}),(function(e){i.reject("Something went wrong loading the image.")})),i.promise()}}),bizagi.rendering.formLink.extend("bizagi.rendering.formLink",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(e){this._super(e),e.context=e.context||"workflow";var t=$.extend({},this._params,{proxyPrefix:this.dataService.serviceLocator.proxyPrefix,context:this.dataService.serviceLocator.context});this.serviceLocator=new bizagi.render.services.context(t)},renderSingle:function(){var e=this.properties,t=this.getContainerRender(),i=this.getControl();this.getArrowContainer().hide(),"value"===e.displayType&&this.changeDisplayOption(e.displayType),this.originalElement=this.element,e.orgiginalDisplayType=e.displayType,e.displayType="normal",this.input=this.element=i.find("a"),this._sendRelation=this.submitEditRequest,this._getData=this.dataService.getFormData,this._isRefreshForm=!1,this._params={idRender:e.id,xpathContext:this.getFormLinkXpathContext(),idPageCache:e.idPageCache,recordXPath:this.getFormLinkXpath(),requestedForm:"linkform",editable:e.editable,url:e.editPage},e.editable?t.addClass("bz-command-edit-inline"):t.addClass("bz-rn-non-editable")},renderEdition:function(){var e=this,t=e.properties;if(e.container=e.getParams().navigation.createRenderContainer({title:t.displayName}),e.inputEdition=e.container.element,!e.properties.hasentryrule)return e.openLink();var i=e.getFormContainer();$.when(i.saveForm()).done((function(){e.resolveCheckpointRequest().done((function(){return e.openLinkRule("entryrule")})).fail((function(e){bizagi.log("Error: "+err.code)}))}))},openLink:function(){var e=this;return $.when(e._sendRelation.apply(e)).done((function(){bizagi.util.smartphone.startLoading(),$.when(e.paintFormLink()).done((function(){bizagi.util.smartphone.stopLoading()})).fail((function(){bizagi.util.smartphone.startLoading(),e.rollbackForm()})).always((function(){bizagi.util.smartphone.stopLoading()}))})).always((function(){bizagi.util.smartphone.stopLoading()}))},openLinkRule:function(e){var t=this,i=new $.Deferred;return bizagi.util.smartphone.startLoading(),t.getPropertyValue(e,{}).done((function(r){if(r.messages){var a=r.messages[0];t.getFormContainer().validationController.showErrorMessage(a),i.reject()}else"entryrule"===e&&t.openLink();i.resolve()})).fail((function(){i.reject()})).always((function(){bizagi.util.smartphone.stopLoading()})),i.promise()},getPropertyValue:function(e,t){var i=this,r=i.properties,a=new $.Deferred;return i.dataService.multiaction().getPropertyData({url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done((function(e){"error"===e.type?(i.getFormContainer().validationController.showErrorMessage(e.message),a.reject(e)):a.resolve(e)})).fail((function(e,t,r){i.getFormContainer().validationController.showErrorMessage(e.message),a.reject(e,t,r)})),a.promise()},postRenderEdit:function(){},paintFormLink:function(){var e=this,t=$.Deferred();return $.extend(e._params,{proxyPrefix:e.serviceLocator.proxyPrefix}),$.when(e._getData.call(e,e._params)).pipe((function(i){return e._params.recordXPath&&(i.form.properties.recordXpath=e._params.recordXPath),!1===e._params.editable&&(i.form.properties.editable=!1),e._params.hasOwnProperty("withAddForm")&&e._params.withAddForm&&(!i.form.elements||i.form.elements&&0===i.form.elements.length)&&(e._params.hideSaveButton=!0),e.form=e.renderFactory.getContainer({type:"form",data:i.form,navigation:e.getParams().navigation,wiew_container:e.container}),e.form.params=e.getFormContainer().getParams(),e.form.buttons=[$.extend(e.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){return e.saveRecord().then((function(){e.container.destroy()})).fail((function(t){t&&t.error_code&&1==t.error_code?$.when(e.actionSave(t.data)).then((function(){e.container.destroy()})):t&&"validationMessages"==t.type?e.form.addValidationMessage(t.messages):t&&t.responseText&&bizagi.showMessageBox(t.responseText||"Error","Error")}))}}),$.extend(e.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){e.container.destroy(),t.reject()}})],$.extend(e.form,{processButtons:function(){$.each(e.form.buttons,(function(i,r){switch(r.ordinal){case 1:$(e.form.getButtons()[i]).click((function(){e.container.destroy(),t.reject()})),e.form.getButtons()[i].innerHTML=bizagi.localization.getResource("render-form-dialog-box-close"),e.form.buttons[i].caption=bizagi.localization.getResource("render-form-dialog-box-close"),e.form.buttons[i].action="back";break;default:$(e.form.getButtons()[i]).click((function(){return e._params.hideSaveButton&&$(e.form.getButtons()[i]).hide(),e.saveRecord().then((function(){e.container.destroy()})).fail((function(t){t&&t.error_code&&1==t.error_code?$.when(e.actionSave(t.data)).then((function(){e.container.destroy()})):bizagi.showMessageBox(t.responseText||"Error","Error")}))}))}}))}}),e.form.render()}),(function(i){var r=e.renderFactory.getCommonTemplate("form-error");$.kendoTmpls(r,{message:i}).appendTo(e.inputEdition),t.reject()})).done((function(t){e.inputEdition.html(t),e._isRefreshForm||e.getParams().navigation.navigate(e.container.id),e.container.setNavigationButtons(e.form),e.form.triggerHandler("ondomincluded"),e.form.bind("refresh",(function(){e.inputEdition.empty(),e._isRefreshForm=!0,$.when(e.paintFormLink()).done((function(){})).fail((function(){e.submitRollbackRequest()}))})),e.container.element.bind("close",(function(){e.rollbackForm()}))})).always((function(){bizagi.util.smartphone.stopLoading()})),t.promise()},hideHeadersButtonEdit:function(){var e=this.getContextEdit();this.properties.hideLabel&&e.find(".bz-cn-label").hide()},setDisplayValueEdit:function(){},rollbackForm:function(){var e=this;$.when(e.submitRollbackRequest()).done((function(){e.properties.hasentryrule&&e.submitRollbackRequest()}))},saveRecord:function(){var e=this,t=$.Deferred(),i=e.properties;if(e.form.validateForm()){var r={};e.form.collectRenderValues(r),r.idPageCache=e.form.getPageCache(),$.when(e.submitSaveRequest(r)).done((function(r){try{var a=!0;r&&"validationMessages"==r.type&&(a=!1,t.reject(r)),i.hasexitrule?e.closeExitRule().done((function(){a?e.resolveSubmitCommitRequest().then((function(){e.submitOnChange({}).then((function(){t.resolve(r),i.hasentryrule&&e.resolveSubmitCommitRequest()}))})):t.reject()})).fail((function(){t.reject()})):a?e.resolveSubmitCommitRequest().then((function(){i.hasentryrule?e.resolveSubmitCommitRequest().done((function(){e.submitOnChange({}).then((function(){t.resolve(r)}))})):e.submitOnChange({}).then((function(){t.resolve(r)}))})):t.reject()}catch(e){t.reject()}})).fail((function(e){var i=JSON.parse(e.responseText||"{message:'', code: ''}");"UNKNOWN_ERROR"==i.code&&-1!==i.message.indexOf("Requested value")&&-1!==i.message.indexOf("was not found")?t.reject({error_code:1,data:r}):t.reject(e)}))}else t.reject();return t.promise()},submitSaveRequest:function(e){var t=this.properties;if(!1===t.editable&&!t.value)return null;var i=this.getFormLinkXpath();return this.dataService.saveGridRecord({url:t.saveUrl,idRender:t.id,xpathContext:void 0===t.xpathContext||""===t.xpathContext?i:i?t.xpathContext+"."+i:t.xpathContext,submitData:e})},resolveSubmitCommitRequest:function(){var e=new $.Deferred;return this.submitCommitRequest().done((function(){e.resolve()})).fail((function(t){"UNKNOWN_ERROR"==JSON.parse(t.responseText||"{message:'', code: ''}").code?e.resolve():e.reject()})),e.promise()},resolveCheckpointRequest:function(){var e=new $.Deferred;return this.submitCheckpointRequest().done((function(){e.resolve()})).fail((function(t){var i=JSON.parse(t.responseText||"{message:'', code: ''}");"UNKNOWN_ERROR"==i.code&&-1!==i.message.indexOf("Requested value")&&-1!==i.message.indexOf("was not found")?e.resolve():e.reject()})),e.promise()},closeExitRule:function(){var e=this.properties,t=new $.Deferred;return e.hasexitrule?$.when(this.openLinkRule("exitrule")).done((function(e){t.resolve(e)})).fail((function(){t.reject()})):t.resolve(),t.promise()},getFormLinkXpathContext:function(){var e=this.properties.xpathContext,t=this.getXpathContext();return t&&e?0===e.indexOf(t)?e:t+"."+e:e}}),bizagi.rendering.geolocation.extend("bizagi.rendering.geolocation",{},{renderSingle:function(){var e=this.getControl();this.getContainerRender().addClass("bz-rn-non-editable"),this.cordinate=$(".bz-rn-geolocation-coordinate",e)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("geolocation");return $.kendoTmpl(e,this.properties)},postRenderSingle:function(){this._super(),this.configureHandlers()},configureHandlers:function(){var e=this;"execution"===e.getMode()&&e.properties.editable&&(null==e.value&&e.updateDisplayValue(),$(".bz-rn-geolocation-selector",e.getControl()).on("click",(function(){e.cordinate.empty(),e.updateDisplayValue()})))},setDisplayValue:function(e){var t=this,i=new $.Deferred;if(null!=e&&""!==e)t.cordinate||(t.cordinate=t.getControl()),t.cordinate.html(e),t.setValue(e,!1),i.resolve();else{var r=function(e){var r=e.coords.latitude.toString()+" "+e.coords.longitude.toString();t.cordinate.html(r),t.setValue(r,!1),i.resolve()},a=function(e){var r=e;bizagi.util.isCordovaSupported()&&bizagi.util.isiOSDevice()&&(r=t.getErrorMessage(e)),i.reject(r)};bizagi.util.isCordovaSupported()&&bizagi.util.isiOSDevice()?navigator.geolocation.getCurrentPosition(r,a):t.getCurrentPosition(r,a)}return i.promise()},updateDisplayValue:function(){var e=this;e.setDisplayValue().then((function(){})).fail((function(t){e.cordinate.val(""),e.cordinate.html("<span style='color: red'>"+t+"</span>")}))}}),bizagi.rendering.association.extend("bizagi.rendering.association",{},{renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done((function(r){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(r)||!1;var a=e.getColumnData(),n=$.kendoTmpl(t,$.extend(e.properties,{columnData:a}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(n)})),i.promise()},getColumnData:function(){var e=this,t=e.properties,i=[];e.data=t;var r=t.flipped?t.rightData:t.leftData;return $.each(r,(function(t,r){i.push({id:r.id,value:r.value,association:e.getRightAssociation(r.id)})})),i},postRenderSingle:function(){var e=this.getControl();this.association=$(".bz-rn-association-control",e),this.getArrowContainer().css("visibility","hidden"),this.getArrowContainer().hide(),this.addEventControl(),this.properties.editable||(this.association.find("input:checkbox").hide(),this.association.find(".ui-bz-rn-check-item label").addClass("bz-rn-association-non-editable")),this.showDefaultContainer()},showDefaultContainer:function(){var e=this.getControl();if($(".bz-rn-association-group-container .bz-rn-association-header",e).length>0){var t=$($(".bz-rn-association-group-container .bz-rn-association-header",e)[0]),i=$($(".bz-rn-association-group-container .bz-rn-association-items",e)[0]);this.closeAccordionSection(!0),t.addClass("active"),i.slideDown(300).addClass("open")}},addEventControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=e.getControl();e.association.delegate("input:checkbox","change",(function(){var t=$(this);t.prop("checked")?(t.addClass("bz-check"),e.associateElement(t)):(t.removeClass("bz-check"),e.dissociateElement(t))})),e.association.delegate(".bz-rn-association-flip-button","click",(function(){$(i).empty(),e.properties.flipped=!e.properties.flipped,e.properties.flipstate=e.properties.flipped,e.dataService.getFlipAssociation(e.properties);var r=e.getColumnData();$.kendoTmpls(t,$.extend(e.properties,{columnData:r}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation}).appendTo(i),e.postRenderSingle()})),e.association.delegate(".bz-rn-association-container .bz-rn-association-header","click",(function(){$(this).is(".active")||(e.closeAccordionSection(),$(this).addClass("active"),$(this).siblings().slideDown(300).addClass("open"))}))},closeAccordionSection:function(e){var t=this.getControl(),i=$(".bz-rn-association-group-container .bz-rn-association-header",t),r=$(".bz-rn-association-group-container .bz-rn-association-items",t);e&&(i=i.not(":first").removeClass("active"),r=r.not(":first").slideUp(300).removeClass("open")),i.removeClass("active"),r.slideUp(300).removeClass("open")},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.renderFactory.getTemplate("association"),r=e.getColumnData();$.kendoTmpls(i,$.extend(e.properties,{columnData:r}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation}).appendTo(t),e.association=$(".bz-rn-association-control",t),e.getArrowContainer().css("visibility","hidden"),e.association.delegate(".bz-rn-association-flip-button","click",(function(){$(t).empty(),e.properties.flipped=!e.properties.flipped,e.postRenderReadOnly()}))},associateElement:function(e){var t=this.getControl(),i=$(e.parents("ul"),t).data("parent-id"),r=e.data("id");this.addElement(i,r)},dissociateElement:function(e){var t=this.getControl(),i=$(e.parents("ul"),t).data("parent-id"),r=e.data("id");this.removeElement(i,r)},setDisplayValue:function(e){this.setValue(e,!1)}}),bizagi.rendering.basicUserField.extend("bizagi.rendering.basicUserField",{},{renderSingle:function(){return $(".ui-bizagi-render-edition-arrow",this.getControl().parent()).hide(),this.postRender()},renderEdition:function(){var e=this,t=$.Deferred();return $.when(e.postRender()).done((function(){$.when(e.renderUserfieldControl()).done((function(){e.inputEdition=e.input,t.resolve()}))})),t.promise()},getEditableControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getEditableControl.apply(this,arguments)},getReadonlyControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getReadonlyControl.apply(this,arguments)},isSupported:function(){return!0}}),bizagi.rendering.basicUserField.extend("bizagi.rendering.defaultUserField",{},{getEditableControl:function(){var e=this.getControl(),t=this.getContainerRender(),i=this.properties.control.replace(/column/g,"");return this.input=$("<label>Userfield: "+i+" not found</label>").appendTo(e),this.input.addClass("ui-bizagi-render-userfield-notSupported"),t.addClass("bz-rn-non-editable"),this.input},collectData:function(e){},getDisplayValue:function(){return"Userfield: "+this.properties.control+" not found"},getReadonlyControl:function(){var e=this.getControl(),t=this.properties.control;return $("<label>Userfield: "+t+" not found</label>").appendTo(e)}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.column",{},{applyOverrides:function(e){e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl,e.properties.displayType="normal")},getControl:function(){var e=this._super();if(!e||0===e.length){var t=bizagi.util.isMobileGridEnabled()?".bz-rn-grid-cell-readonly":".ui-bizagi-cell-readonly";e=$(t,this.element||this.observableElement)}return e},applyColumnStyles:function(e){var t=this.properties;(e=$(e)).css("-webkit-box-pack",t.align),t.textFormat.background&&(e.css("background-color",t.textFormat.background),e.css("background-image","none"))},postRenderReadOnly:function(e,t){var i,r=this.properties;(this._super(e,t),t&&t.length>0)&&(bizagi.util.isMobileGridEnabled()?(i=$(".bz-mo-icon",t),$(this.element).hasClass("bz-command-edit-inline")&&$(this.element).toggleClass("bz-command-edit-inline"),r.editable||(i.removeClass("bz-mo-icon"),i.removeClass("bz-coin-input bz-number-icon bz-calendar-input"))):(i=$(".ui-bizagi-cell-icon",t),"left"==r.align&&i.addClass("ui-bizagi-cell-icon-right"),r.editable||i.detach()),this.applyColumnStyles(t))}}),bizagi.rendering.columns.combo.extend("bizagi.rendering.columns.combo",{},{applyOverrides:function(e){this._super(e),e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl,e.properties.displayType="normal")},getControl:function(){var e=this._super();return e&&0!=e.length||(e=$(".ui-bizagi-cell-readonly",this.element||this.observableElement)),e}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.document",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),e.getControlHtml=this.getControlHtml,"design"!=t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.getDocumentXpath=this.getDocumentXpath,e.getContextXpath=this.getContextXpath,e.documentTemplateGenerate=this.documentTemplateGenerate,e.properties.xpathContext=this.getContextXpath())},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath);var i=e.parent;$.when(i.submitOnChange("",!1)).done((function(){$.when(e.dataService.generateDocumentTemplate(t)).done((function(t){$.when(i.refresh()).done((function(){e.autoOpenDocuments()})),e.endLoading()})).fail((function(){e.showErrorMessage(),e.endLoading()}))})).fail((function(t){e.getFormContainer().addErrorMessage(t),e.endLoading()}))},getControlHtml:function(e,t,i,r,a,n){for(var o=!0,s=0;s<this.parent.properties.data.rows.length;s++)if(this.parent.properties.data.rows[s][0]==this.surrogateKey){o=!1;break}return $.kendoTmpl(e,{noActivateButton:o,editable:"execution"!=t,downloadalldocuments:i,required:a.required,allowgenerate:r,xpath:this.getXpath(a.xpath),append:!!a.append&&a.append,caption:a.caption,noFiles:n}).replace("ui-bizagi-document-upload-item-design","ui-bizagi-document-upload-item-design-column")},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!=i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getDocumentXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!=i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),t},postRenderReadOnly:function(e,t,i){this._super(e,t,i)},getContextXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]"}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.date",{},{applyOverrides:function(e){var t=this,i=t.getMode();t._super(e),e&&(e.showTime=!1,"execution"===i&&(e.changeMinValue=function(i){var r=this.properties,a=this.getDateControl(),n=t.resolveValue(this,i);i&&r.editable&&("number"==typeof n?(n=new Date(n),a.mobiscroll("option",{min:n}),n=bizagi.util.dateFormatter.formatInvariant(n,r.showTime)):a.datepicker("option","minDate",bizagi.util.dateFormatter.getDateFromInvariant(n)),r.minValue=i,e.properties.minValue=n)},e.changeMaxValue=function(i){var r=this.properties,a=this.getDateControl(),n=t.resolveValue(this,i);i&&r.editable&&("number"==typeof n?(n=new Date(n),a.mobiscroll("option",{max:n}),n=bizagi.util.dateFormatter.formatInvariant(n,r.showTime)):a.datepicker("option","maxDate",bizagi.util.dateFormatter.getDateFromInvariant(n)),r.maxValue=i,e.properties.maxValue=n)}))},resolveValue:function(e,t){var i="";if((bizagi.util.isString(t)||bizagi.util.isNumeric(t))&&(i=t),bizagi.util.isArray(t)){var r=e.grid.getIndexes(),a=e.surrogateKey,n=r.indexOf(a);-1!==n&&(i=t[n])}return i}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.text",{},{applyOverrides:function(e){this._super(e)}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.number",{},{applyOverrides:function(e){this._super(e)}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.image",{},{applyOverrides:function(e){var t=this.properties;this._super(e),e.getXpathContext=this.getImageXpathContext,e.setDisplayValue=function(){return!0},"execution"===this.getMode()&&(e.properties.xpathContext=(t.xpathContext?t.xpathContext+".":"")+this.grid.properties.xpath+"[id="+e.surrogateKey+"]")},getImageXpathContext:function(){return(this.column.properties.xpathContext?this.column.properties.xpathContext+".":"")+this.column.grid.properties.xpath+"[id="+this.surrogateKey+"]"}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.upload",{},{applyOverrides:function(e){this._super(e);var t=this,i=t.getMode();"design"!=i&&"layout"!=i&&(e.getUploadXpath=this.getUploadXpath,e.getXpathContext=function(){var i=this.surrogateKey||"",r=t.properties,a=t.getUploadXpath(e).split("."),n=a[a.length-1];return{xpathContext:r.xpathContext.length>0?r.xpathContext+"."+t.grid.properties.xpath+"[id="+i+"]":t.grid.properties.xpath+"[id="+i+"]",nameFile:n}},e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),r=this.getXpathContext();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:r.nameFile,xpathContext:r.xpathContext,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})})},getUploadXpath:function(e){return(e||this).grid.properties.xpath+"[id="+(e||this).surrogateKey+"]."+(e||this).properties.xpath}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.link",{},{applyOverrides:function(e){this._super(e);var t=this.getMode();"design"!=t&&"layout"!=t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.properties.xpathContext=this.grid.properties.xpath+"[id="+this.surrogateKey+"]",this.grid.properties.xpathContext&&-1==e.properties.xpathContext.indexOf(this.grid.properties.xpathContext)&&(e.properties.xpathContext=this.grid.properties.xpathContext+"."+e.properties.xpathContext)),"columnFormLink"==e.properties.type&&(e.getFormLinkXpath=this.getFormLinkXpath)},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!=i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getFormLinkXpath:function(){if(this.properties.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties(),this.properties.xpath)return this.properties.xpath}}),bizagi.rendering.columns.search.extend("bizagi.rendering.columns.search",{},{applyOverrides:function(e){this._super(e)},render:function(e,t){return t.length>0?(t=[].concat(t[0]),this._super(e,{id:t[0],label:t[1],additionallabel:t[2]||void 0})):this._super(e,t)}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.uploadecm",{},{applyOverrides:function(e){this._super(e),e.getXpathContext=this.getECMXpathContext,e.getUploadXpath=this.getUploadXpath,e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),r=this.getUploadXpath(this.surrogateKey),a=(r=r.split("."))[r.length-1],n=this.getXpathContext(this.surrogateKey);return this.dataService.getUploadFileUrl({idRender:t.id,xpath:a,xpathContext:n,idPageCache:t.idPageCache,fileId:e.idFileUpload,sessionId:i.properties.sessionId,contexttype:t.contexttype})},e.buildAddParams=function(){var e=this.properties,t=this.getFormContainer();return{url:e.addUrl,h_xpath:e.xpath,idAttrib:e.idAttrib,xpathContext:this.getXpathContext(this.surrogateKey),xPath:e.xpath,p_sessionId:t.properties.sessionId,h_contexttype:"entity",h_pageCacheId:e.idPageCache}}},getUploadXpath:function(e){return e=this.surrogateKey||e||"",this.grid.properties.xpath+"[id="+e+"]."+this.properties.xpath},getECMXpathContext:function(){return(this.column.properties.xpathContext?this.column.properties.xpathContext+".":"")+this.column.grid.properties.xpath+"[id="+this.surrogateKey+"]"}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.button",{},{applyOverrides:function(e){this._super(e)}}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.numberScientificNotation",{},{postRender:function(e,t){this._super(e,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(e,t){return this.renderReadOnly(e,t)},postRenderSummary:function(e,t){return this.postRenderReadOnly(e,t),!0}}),bizagi.rendering.columns.combo.extend("bizagi.rendering.columns.radio",{},{}),bizagi.rendering.columns.combo.extend("bizagi.rendering.columns.list",{},{}),bizagi.rendering.columns.column.extend("bizagi.rendering.columns.exclusiveCheck",{},{render:function(e,t){var i=this;i.changed=!1;var r=i.properties,a=i.getDecorated(e);a.grid=i.grid,a.column=this,a.surrogateKey=e;i.getMode();if(i.grid.exclusiveChanges[i.properties.xpath])i.grid.exclusiveChanges[i.properties.xpath].key===e?i.setValue(e,i.grid.exclusiveChanges[i.properties.xpath].value):i.setValue(e,!1);else{i.grid.enabledChecks[i.properties.xpath];i.setValue(e,t)}if(i.overrideDecoratedRenderProperties(e),!r.editable)return i.renderReadOnly.apply(i,arguments);i.readyDeferred=new $.Deferred;var n=a.render("cell");return a.bind("renderchange",(function(){if(i.changed=!0,(i.grid.exclusiveChanges[i.properties.xpath]?i.grid.exclusiveChanges[i.properties.xpath].key:-1)!==e){var r=i.properties.xpath.split(".");i.grid.exclusiveChanges[i.properties.xpath]={xpath:i.properties.xpath,simpleXpath:r[r.length-1],value:i.getValue(e),key:e},i.clearOtherRows(e,t)}})),i.bind("rendered",(function(){i.readyDeferred.resolve()})),n},postRender:function(e,t){this._super(e,t)},clearOtherRows:function(e,t){for(var i=0,r=this.grid.properties.data.rows.length;i<r;i++){var a=this.grid.properties.data.rows[i][0];if(a!==e)this.getDecorated(a).setDisplayValue(!1),this.setValue(a,!1)}}}),bizagi.rendering.document.extend("bizagi.rendering.document",{},{applyDocumentTemplatesFormat:function(){var e=this,t=e.getControl();e.getArrowContainer().hide(),t.addClass("ui-bizagi-render-display-block");var i=$(".ui-bizagi-document-upload-item",t);$.each(i,(function(t,i){$(".ui-bizagi-document-type",i).addClass("ui-bizagi-document-extension");var r=$(".ui-bizagi-document-preview",i);r.attr("title",e.resources.getResource("render-document-preview-tooltip")),r.tooltip();var a=e.returnCssTypeFile($("span > span",i).html());$(".ui-bizagi-document-type",i).addClass(a),$(".ui-bizagi-button",i).remove(),$(".ui-bizagi-document-preview",i).attr("display","none")}))},returnCssTypeFile:function(e){if(null==e||0===e.lenght)return"ui-bizagi-document-upload-item-generic-file bz-file-text";switch(e.substr(e.lastIndexOf(".")+1)){case"docx":return"ui-bizagi-document-upload-item-doc bz-file-word";case"pdf":return"ui-bizagi-document-upload-item-pdf bz-file-pdf";case"xlsx":return"ui-bizagi-document-upload-item-xls bz-file-excel";default:return"ui-bizagi-document-upload-item-generic-file bz-file-text"}},postRenderSingle:function(){var e=this.properties,t=this.getContainerRender();this.configureHelpText(),this.applyDocumentTemplatesFormat(),this.configureHandlers(),e.editable?t.addClass("bz-command-edit-inline"):t.addClass("bz-rn-non-editable")},configureHandlers:function(){var e=this,t=e.getControl(),i=e.getMode(),r=$(".ui-bizagi-button-documentgenerator",t);"execution"==i&&r.click((function(t){if(!t.isPropagationStopped()){if(t.stopPropagation(),e.properties.buttonExecuted=!0,e.properties.validate)e.validateContainer()&&e.documentTemplateGenerate();else e.documentTemplateGenerate();e.properties.buttonExecuted=!1}})),$(".ui-bizagi-document-upload-item > .ui-bizagi-document-upload-element",t).click((function(t){e.showDocumentPreview($(this).data("url"),$(this).attr("title"))})),$(".bz-rn-document-delete-icon",t).click((function(t){t.isPropagationStopped()||(t.stopPropagation(),e.deleteDocumentTemplate($(this).parent().data("filename")))}))},redrawDocuments:function(e,t,i){this._super(e,t,i),this.applyDocumentTemplatesFormat()},autoOpenDocuments:function(){},updateControlForPrintMode:function(){},showDocumentPreview:function(e,t){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(e,t)).fail((function(e){e.responseText&&self.getFormContainer().failHandler(e.responseText)})).always((function(){bizagi.loading.stop()}))}}),bizagi.rendering.rangeDate.extend("bizagi.rendering.rangeDate",{},{postRenderSingle:function(){this.getArrow().hide(),this.defineRangeControl()}}),bizagi.rendering.rangeMoney.extend("bizagi.rendering.rangeMoney",{},{postRenderSingle:function(){this.getArrow().hide(),this.defineRangeControl()}}),bizagi.rendering.rangeNumber.extend("bizagi.rendering.rangeNumber",{},{postRenderSingle:function(){this.getArrow().hide(),this.defineRangeControl()}}),$.Class.extend("bizagi.rendering.base.factory",{},{init:function(e){this.templates={},this.dataService=e},loadOverrides:function(){},initAsyncStuff:function(){return $.when.apply($,[this.loadOverrides(),this.loadTemplates()])},loadTemplates:function(){},loadTemplate:function(e,t){var i=this;return bizagi.templateService.getTemplate(t,e).done((function(t){i.templates[e]=t}))},getCommonTemplate:function(e){return this.templates[e]},getContainer:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==t?new bizagi.rendering.form(r):"mobileform"==t?new bizagi.rendering.mobileform(r):"template"==t?new bizagi.rendering.formTemplate(r):"queryForm"==t?new bizagi.rendering.queryForm(r):"layout"==t?new bizagi.rendering.layout(r):"usersForm"==t?new bizagi.rendering.usersForm(r):"panel"==t?new bizagi.rendering.panel(r):"section"==t?new bizagi.rendering.section(r):"contentPanel"==t||"contentpanel"==t?new bizagi.rendering.contentPanel(r):"nestedform"==t.toLowerCase()?new bizagi.rendering.nestedForm(r):"tab"==t?new bizagi.rendering.tab(r):"tabItem"==t||"tabitem"==t?new bizagi.rendering.tabItem(r):"horizontal"==t?new bizagi.rendering.horizontal(r):"accordion"==t?new bizagi.rendering.accordion(r):"accordionItem"==t?new bizagi.rendering.accordionItem(r):"group"==t?new bizagi.rendering.group(r):"mobilegroup"==t?new bizagi.rendering.mobilegroup(r):"searchForm"==t?(r.context="search",r.contexttype="metadata",new bizagi.rendering.searchForm(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return t||(t="label"),"text"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.extendedText(r):new bizagi.rendering.text(r):"mobiletext"==t?new bizagi.rendering.mobiletext(r):"association"==t?new bizagi.rendering.association(r):"label"==t?new bizagi.rendering.label(r):"hidden"==t?new bizagi.rendering.hidden(r):"number"==t?new bizagi.rendering.number(r):"money"==t?new bizagi.rendering.money(r):"date"==t?new bizagi.rendering.date(r):"boolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.check(r):new bizagi.rendering.yesno(r):"combo"==t?new bizagi.rendering.combo(r):/^cascadingcombo$/i.test(t)?new bizagi.rendering.cascadingCombo(r):"list"==t?new bizagi.rendering.list(r):"multiSelect"==t?new bizagi.rendering.multiSelect(r):"radio"==t?new bizagi.rendering.radio(r):"image"==t?new bizagi.rendering.image(r):"uploadecm"==t?new bizagi.rendering.ecm(r):"upload"==t?new bizagi.rendering.upload(r):"grid"==t?new bizagi.rendering.grid(r):"groupedgrid"==t?new bizagi.rendering.grid(r):"search"==t?new bizagi.rendering.search(r):"suggest"==t?(r.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.search(r)):"searchList"==t?new bizagi.rendering.searchList(r):"letter"==t?new bizagi.rendering.letter(r):"button"==t?new bizagi.rendering.button(r):"formLink"==t?new bizagi.rendering.formLink(r):"link"==t?new bizagi.rendering.link(r):"layoutImage"==t?new bizagi.rendering.layoutImage(r):"layoutLink"==t?new bizagi.rendering.layoutLink(r):"layoutLabel"==t?new bizagi.rendering.layoutLabel(r):"layoutText"==t?new bizagi.rendering.layoutText(r):"layoutDateTime"==t?new bizagi.rendering.layoutDateTime(r):"layoutNumber"==t?new bizagi.rendering.layoutNumber(r):"layoutMoney"==t?new bizagi.rendering.layoutMoney(r):"layoutPlaceholder"==t?new bizagi.rendering.layoutPlaceholder(r):"actionLauncher"==t?new bizagi.rendering.actionLauncher(r):"layoutBoolean"==t?new bizagi.rendering.layoutBoolean(r):"layoutUpload"==t?new bizagi.rendering.layoutUpload(r):"entityTemplate"==t?new bizagi.rendering.entityTemplate(r):"polymorphicLauncher"==t?new bizagi.rendering.polymorphicLauncher(r):"userfield"==t?new bizagi.rendering.userfieldWrapper(r):0==t.indexOf("search")?this.getSearchRender(e):0==t.indexOf("query")?this.getQueryRender(e):"document"==t?new bizagi.rendering.document(r):"image"==t?new bizagi.rendering.image(r):"fileprint"==t?new bizagi.rendering.fileprint(r):"geolocation"==t?new bizagi.rendering.geolocation(r):"collectionnavigator"==t?new bizagi.rendering.collectionnavigator(r):"getUser"==t?new bizagi.rendering.getUser(r):"rangeDate"==t?new bizagi.rendering.rangeDate(r):"rangeMoney"==t?new bizagi.rendering.rangeMoney(r):"rangeNumber"==t?new bizagi.rendering.rangeNumber(r):"activityCheckList"==t?new bizagi.rendering.activityCheckList(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnText"==t){var a=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return r.decorated=a?bizagi.rendering.extendedText:bizagi.rendering.text,new bizagi.rendering.columns.text(r)}if("columnSearchList"==t)return r.decorated=bizagi.rendering.searchList,new bizagi.rendering.columns.searchList(r);if("columnNumber"==t)return r.decorated=bizagi.rendering.number,new bizagi.rendering.columns.number(r);if("columnMoney"==t)return r.decorated=bizagi.rendering.money,new bizagi.rendering.columns.number(r);if("columnDate"==t)return r.decorated=bizagi.rendering.date,new bizagi.rendering.columns.date(r);if("columnBoolean"==t){if("check"==(i.properties.display||"option")){if(r.decorated=bizagi.rendering.check,e.data.properties.isExclusive)return new bizagi.rendering.columns.exclusiveCheck(r)}else r.decorated=bizagi.rendering.yesno;return new bizagi.rendering.columns.column(r)}return"columnCombo"==t?(r.decorated=bizagi.rendering.combo,new bizagi.rendering.columns.combo(r)):"columnRadio"==t?(r.decorated=bizagi.rendering.radio,new bizagi.rendering.columns.radio(r)):"columnList"==t?(r.decorated=bizagi.rendering.list,new bizagi.rendering.columns.list(r)):"columnHidden"==t?(r.decorated=bizagi.rendering.hidden,new bizagi.rendering.columns.column(r)):"columnUpload"==t?(r.decorated=bizagi.rendering.upload,new bizagi.rendering.columns.upload(r)):"columnImage"==t?(r.decorated=bizagi.rendering.image,new bizagi.rendering.columns.image(r)):"columnUploadEcm"==t?(r.decorated=bizagi.rendering.ecm,new bizagi.rendering.columns.uploadecm(r)):"columnLink"==t?(r.decorated=bizagi.rendering.link,new bizagi.rendering.columns.link(r)):"columnFormLink"==t?(r.decorated=bizagi.rendering.formLink,new bizagi.rendering.columns.link(r)):"columnUserfield"==t?(r.decorated=bizagi.rendering.userfieldWrapper,new bizagi.rendering.columns.column(r)):"columnSearch"==t?(r.decorated=bizagi.rendering.search,new bizagi.rendering.columns.search(r)):"columnLabel"==t?(r.decorated=bizagi.rendering.label,new bizagi.rendering.columns.column(r)):"columnReadonly"==t?(r.decorated=bizagi.rendering.label,new bizagi.rendering.columns.readonly(r)):"columnDocument"==t?(r.decorated=bizagi.rendering.document,new bizagi.rendering.columns.document(r)):"columnLetter"==t?(r.decorated=bizagi.rendering.letter,new bizagi.rendering.columns.letter(r)):"columnButton"==t?(r.decorated=bizagi.rendering.button,new bizagi.rendering.columns.button(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.extendedText(r):new bizagi.rendering.text(r):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.check(r):new bizagi.rendering.yesno(r):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.numberScientificNotation(r):new bizagi.rendering.number(r):"searchMoney"==t?new bizagi.rendering.money(r):"searchDate"==t?new bizagi.rendering.date(r):"searchCombo"==t?new bizagi.rendering.combo(r):"searchSuggest"==t?new bizagi.rendering.search(r):"searchLabel"==t?new bizagi.rendering.label(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getQueryRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"queryText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.queryExtendedText(r):new bizagi.rendering.queryText(r):"queryBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.queryCheck(r):new bizagi.rendering.queryYesNo(r):"queryNumber"==t?new bizagi.rendering.queryNumber(r):"queryMoney"==t?new bizagi.rendering.queryMoney(r):"queryDate"==t?new bizagi.rendering.queryDate(r):"queryCombo"==t?new bizagi.rendering.queryCombo(r):"queryCascadingCombo"==t?new bizagi.rendering.queryCascadingCombo(r):"querySuggest"==t?new bizagi.rendering.querySuggest(r):"queryLabel"==t?new bizagi.rendering.queryLabel(r):"queryList"==t?new bizagi.rendering.queryList(r):"queryMultiSelect"==t?new bizagi.rendering.queryMultiSelect(r):"querySearch"==t?new bizagi.rendering.querySearch(r):"queryRadio"==t?new bizagi.rendering.queryRadio(r):"queryState"==t?new bizagi.rendering.queryState(r):"queryCaseState"==t?new bizagi.rendering.queryCaseState(r):"queryProcess"==t?new bizagi.rendering.queryProcess(r):"querySearchUser"==t?new bizagi.rendering.querySearchUser(r):"queryHidden"==t?new bizagi.rendering.hidden(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getTemplate:function(e){return this.templates[e]}}),bizagi.rendering.base.factory.extend("bizagi.rendering.smartphone.factory",{},{init:function(e){this._super(e),bizagi.override.enableMSF?bizagi.hasOwnProperty("kendo")?this.templateService=new bizagi.kendo.templates.services.service(bizagi.localization):this.templateService=new bizagi.templates.services.service(bizagi.localization):this.templateService=new bizagi.kendo.templates.services.service(bizagi.localization)},loadTemplate:function(e,t){var i=this;return i.templateService.getTemplate(t,e).done((function(t){i.templates[e]=t}))},loadTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("icons",bizagi.getTemplate("common.bizagi.rendering.icons")),e.loadTemplate("form",bizagi.getTemplate("bizagi.renderingflat.smartphone.form")+"#ui-bizagi-render-form"),e.loadTemplate("complexgateway",bizagi.getTemplate("bizagi.renderingflat.smartphone.form")+"#ui-bizagi-render-complexGateway"),e.loadTemplate("panel",bizagi.getTemplate("bizagi.renderingflat.smartphone.panel")),e.loadTemplate("tab",bizagi.getTemplate("bizagi.renderingflat.smartphone.tab")),e.loadTemplate("tabItem",bizagi.getTemplate("bizagi.renderingflat.smartphone.tabItem")),e.loadTemplate("horizontal",bizagi.getTemplate("bizagi.renderingflat.smartphone.horizontal")),e.loadTemplate("group",bizagi.getTemplate("bizagi.renderingflat.smartphone.group")),e.loadTemplate("editRender",bizagi.getTemplate("bizagi.renderingflat.smartphone.edit")),e.loadTemplate("searchForm",bizagi.getTemplate("bizagi.renderingflat.smartphone.searchForm")),e.loadTemplate("accordion",bizagi.getTemplate("bizagi.renderingflat.smartphone.accordion")),e.loadTemplate("accordionItem",bizagi.getTemplate("bizagi.renderingflat.smartphone.accordionItem")),e.loadTemplate("contentPanel",bizagi.getTemplate("bizagi.renderingflat.smartphone.contentPanel")),e.loadTemplate("render",bizagi.getTemplate("bizagi.renderingflat.smartphone.render")),e.loadTemplate("render-layout",bizagi.getTemplate("bizagi.renderingflat.smartphone.render.layout")),e.loadTemplate("combo",bizagi.getTemplate("bizagi.renderingflat.smartphone.combo")+"#ui-bz-mobile-combo-control"),e.loadTemplate("readonlyCombo",bizagi.getTemplate("bizagi.renderingflat.smartphone.combo")+"#ui-bz-mobile-readonly-combo-control"),e.loadTemplate("comboModalView",bizagi.getTemplate("bizagi.renderingflat.smartphone.combo")+"#ui-bz-wp-popup-combo-control"),e.loadTemplate("date",bizagi.getTemplate("bizagi.renderingflat.smartphone.date")+"#bz-rn-date"),e.loadTemplate("text",bizagi.getTemplate("bizagi.renderingflat.smartphone.text")),e.loadTemplate("number",bizagi.getTemplate("bizagi.renderingflat.smartphone.number")+"#ui-bz-mobile-number-control"),e.loadTemplate("readonlyNumber",bizagi.getTemplate("bizagi.renderingflat.smartphone.number")+"#ui-bz-mobile-readonly-number-control"),e.loadTemplate("numberScientificNotation",bizagi.getTemplate("bizagi.renderingflat.smartphone.numberScientificNotation")),e.loadTemplate("extendedText",bizagi.getTemplate("bizagi.renderingflat.smartphone.extendedText")+"#ui-bz-mobile-extended-text-control"),e.loadTemplate("readonlyExtendedText",bizagi.getTemplate("bizagi.renderingflat.smartphone.extendedText")+"#ui-bz-mobile-readonly-extended-text-control"),e.loadTemplate("yesno",bizagi.getTemplate("bizagi.renderingflat.smartphone.yesno")),e.loadTemplate("check",bizagi.getTemplate("bizagi.renderingflat.smartphone.check")),e.loadTemplate("button",bizagi.getTemplate("bizagi.renderingflat.smartphone.button")),e.loadTemplate("link",bizagi.getTemplate("bizagi.renderingflat.smartphone.link")),e.loadTemplate("list",bizagi.getTemplate("bizagi.renderingflat.smartphone.edition.list")+"#ui-bz-mobile-list-control"),e.loadTemplate("listModalView",bizagi.getTemplate("bizagi.renderingflat.smartphone.edition.list")+"#ui-bz-wp-popup-list-control"),e.loadTemplate("geolocation",bizagi.getTemplate("bizagi.renderingflat.smartphone.geolocation")),e.loadTemplate("radio",bizagi.getTemplate("bizagi.renderingflat.smartphone.radio")),e.loadTemplate("search",bizagi.getTemplate("bizagi.renderingflat.smartphone.search")+"#ui-bz-mobile-search-control"),e.loadTemplate("readonlySearch",bizagi.getTemplate("bizagi.renderingflat.smartphone.search")+"#ui-bz-mobile-readonly-search-control"),e.loadTemplate("searchList",bizagi.getTemplate("bizagi.renderingflat.smartphone.searchList")+"#ui-bz-mobile-searchlist-control"),e.loadTemplate("searchListModalView",bizagi.getTemplate("bizagi.renderingflat.smartphone.searchList")+"#ui-bz-wp-popup-searchlist-control"),e.loadTemplate("searchListModalViewAuxTemplates",bizagi.getTemplate("bizagi.renderingflat.smartphone.searchList")+"#ui-bz-wp-searchlist-control-modalview-auxiliary-templates"),e.loadTemplate("searchListInputAuxTemplates",bizagi.getTemplate("bizagi.renderingflat.smartphone.searchList")+"#ui-bz-wp-searchlist-control-input-auxiliary-templates"),e.loadTemplate("upload",bizagi.getTemplate("bizagi.renderingflat.smartphone.upload")+"#bz-rn-upload-container"),e.loadTemplate("uploadItem",bizagi.getTemplate("bizagi.renderingflat.smartphone.upload")+"#bz-rn-upload-item"),e.loadTemplate("association",bizagi.getTemplate("bizagi.renderingflat.smartphone.association")),e.loadTemplate("ecm",bizagi.getTemplate("bizagi.renderingflat.smartphone.ecm")+"#bz-rn-ecm-view-default-item"),e.loadTemplate("ecm-metadata",bizagi.getTemplate("bizagi.renderingflat.smartphone.ecm")+"#bz-rn-ecm-metadata"),e.loadTemplate("checkList",bizagi.getTemplate("bizagi.renderingflat.smartphone.checkList")),e.loadTemplate("image",bizagi.getTemplate("bizagi.renderingflat.smartphone.image")+"#ui-bizagi-render-image"),e.loadTemplate("image-item",bizagi.getTemplate("bizagi.renderingflat.smartphone.image")+"#ui-bizagi-render-image-item"),e.loadTemplate("image-preview",bizagi.getTemplate("bizagi.renderingflat.smartphone.image")+"#bz-rd-upload-render-edition"),e.loadTemplate("document",bizagi.getTemplate("bizagi.renderingflat.smartphone.document")+"#bz-document-generator"),e.loadTemplate("document-item",bizagi.getTemplate("bizagi.renderingflat.smartphone.document")+"#bz-document-generator-item"),e.loadTemplate("render-range",bizagi.getTemplate("bizagi.renderingflat.smartphone.range")),e.loadTemplate("readonly",bizagi.getTemplate("bizagi.renderingflat.smartphone.readonly")),e.loadTemplate("list-multiselect",bizagi.getTemplate("bizagi.renderingflat.smartphone.multiSelect")+"#ui-bz-mobile-multiselect-control"),e.loadTemplate("list-multiselect-tag",bizagi.getTemplate("bizagi.renderingflat.smartphone.multiSelect")+"#ui-bz-mobile-multiselect-tag"),e.loadTemplate("list-multiselect-tags",bizagi.getTemplate("bizagi.renderingflat.smartphone.multiSelect")+"#bz-list-multiselect-tags"),e.loadTemplate("list-multiselect-view-more",bizagi.getTemplate("bizagi.renderingflat.smartphone.multiSelect")+"#ui-bz-mobile-multiselect-view-more"),e.loadTemplate("multiselectModalView",bizagi.getTemplate("bizagi.renderingflat.smartphone.multiSelect")+"#ui-bz-wp-popup-multiselect-control"),e.loadTemplate("render-slide-view",bizagi.getTemplate("bizagi.renderingflat.smartphone.slide.view")),e.loadTemplate("render-actionLauncher",bizagi.getTemplate("bizagi.renderingflat.smartphone.actionLauncher")+"#bz-rendering-actionLauncher"),e.loadTemplate("render-actionLauncher-horizontal",bizagi.getTemplate("bizagi.renderingflat.smartphone.actionLauncher")+"#bz-rendering-actionLauncher-horizontal"),e.loadTemplate("render-actionLauncher-vertical",bizagi.getTemplate("bizagi.renderingflat.smartphone.actionLauncher")+"#bz-rendering-actionLauncher-vertical"),e.loadTemplate("render-actionLauncher-actions-to-execute",bizagi.getTemplate("bizagi.renderingflat.smartphone.actionLauncher")+"#bz-rendering-actionLauncher-actions-to-execute"),e.loadTemplate("render-polymorphicLauncher",bizagi.getTemplate("bizagi.renderingflat.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher"),e.loadTemplate("render-polymorphicLauncher-vertical-tree",bizagi.getTemplate("bizagi.renderingflat.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree"),e.loadTemplate("render-polymorphicLauncher-vertical-tree-item",bizagi.getTemplate("bizagi.renderingflat.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree-item"),e.loadTemplate("render-polymorphicLauncher-actions-to-execute",bizagi.getTemplate("bizagi.renderingflat.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-actions-to-execute"),e.loadTemplate("render-polymorphicLauncher-confirm",bizagi.getTemplate("bizagi.renderingflat.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-confirm"),e.loadTemplate("edition.number",bizagi.getTemplate("bizagi.renderingflat.smartphone.edition.number")),e.loadTemplate("edition.search.add",bizagi.getTemplate("bizagi.renderingflat.smartphone.edition.search")+"#bz-rn-search-add"),e.loadTemplate("edition.search.item",bizagi.getTemplate("bizagi.renderingflat.smartphone.edition.search")+"#bz-rn-search-item"),e.loadTemplate("edition.link",bizagi.getTemplate("bizagi.renderingflat.smartphone.edition.link")),e.loadTemplate("edition.letter",bizagi.getTemplate("bizagi.renderingflat.smartphone.edition.letter")),e.loadTemplate("layout-image",bizagi.getTemplate("bizagi.renderingflat.smartphone.layout.image")+"#ui-bizagi-render-layout-image"),e.loadTemplate("layout-image64",bizagi.getTemplate("bizagi.renderingflat.smartphone.layout.image")+"#ui-bizagi-render-layout-image64"),e.loadTemplate("layout-label",bizagi.getTemplate("bizagi.renderingflat.smartphone.layout.label")),e.loadTemplate("layout-link",bizagi.getTemplate("bizagi.renderingflat.smartphone.layout.link")),e.loadTemplate("layout-text",bizagi.getTemplate("bizagi.renderingflat.smartphone.layout.text")),e.loadTemplate("layout-date-time",bizagi.getTemplate("bizagi.renderingflat.smartphone.layout.dateTime")),e.loadTemplate("layout-money",bizagi.getTemplate("bizagi.renderingflat.smartphone.layout.money")),e.loadTemplate("layout-number",bizagi.getTemplate("bizagi.renderingflat.smartphone.layout.number")),e.loadTemplate("layout-upload",bizagi.getTemplate("bizagi.renderingflat.smartphone.layout.upload")),e.loadTemplate("form-error",bizagi.getTemplate("bizagi.renderingflat.smartphone.form-error")),e.loadTemplate("form-waiting",bizagi.getTemplate("bizagi.renderingflat.smartphone.form-waiting")),e.getGridTemplates()).done((function(){var i=e.getTemplate("icons");0===$("head").find("#genome-forms-icons").length&&$("head").append(i),t.resolve()})),t.promise()},loadOverrides:function(){if(bizagi.enableCustomizations)return bizagi.util.loadFile({src:bizagi.getJavaScript("bizagi.workportal.smartphone.overrides"),type:"js"})},getRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});if("number"===t){var a=i.properties;if(a&&29===a.dataType)return new bizagi.rendering.numberScientificNotation(r)}return bizagi.util.isMobileGridEnabled()&&"grid"===t?new bizagi.rendering.grid.beta(r):this._super(e)},getColumn:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnNumber"===t){var r=e.data.properties;if(r&&29===r.dataType)return i.decorated=bizagi.rendering.numberScientificNotation,new bizagi.rendering.columns.numberScientificNotation(i)}return this._super(e)},getGridTemplates:function(){var e=new $.Deferred;return bizagi.util.isMobileGridEnabled()?$.when(this.loadTemplate("grid-view",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.helpers")),this.loadTemplate("grid",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid"),this.loadTemplate("cell",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-cell"),this.loadTemplate("cell.readonly",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-cell-readonly"),this.loadTemplate("grid-control",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-control"),this.loadTemplate("grid-table",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-table"),this.loadTemplate("grid-table-empty",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-table-empty"),this.loadTemplate("grid-table-column",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-table-column"),this.loadTemplate("grid-table-column-special",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-table-column-special"),this.loadTemplate("grid-table-row",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-table-row"),this.loadTemplate("grid-table-cell",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-table-cell"),this.loadTemplate("grid-table-cell-special",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-table-cell-special"),this.loadTemplate("grid-table-pager",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-table-pager"),this.loadTemplate("grid-modal-filter",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid.control")+"#bz-rn-grid-filter")).done((function(){e.resolve()})):$.when(this.loadTemplate("grid",bizagi.getTemplate("bizagi.renderingflat.smartphone.grid")),this.loadTemplate("cell",bizagi.getTemplate("bizagi.renderingflat.smartphone.cell")),this.loadTemplate("cell.readonly",bizagi.getTemplate("bizagi.renderingflat.smartphone.cell.readonly")),this.loadTemplate("bizagi.grid.grid",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid"),this.loadTemplate("bizagi.grid.waiting",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-waiting"),this.loadTemplate("bizagi.grid.table",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-table"),this.loadTemplate("bizagi.grid.table.empty",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-table-empty"),this.loadTemplate("bizagi.grid.column",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-column"),this.loadTemplate("bizagi.grid.column.special",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-column-special"),this.loadTemplate("bizagi.grid.row",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-row"),this.loadTemplate("bizagi.grid.row.buttons",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-row-buttons"),this.loadTemplate("bizagi.grid.cell",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-cell"),this.loadTemplate("bizagi.grid.cell.special",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-cell-special"),this.loadTemplate("bizagi.grid.pager",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-pager"),this.loadTemplate("bizagi.grid.buttons",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-buttons"),this.loadTemplate("bizagi.grid.totalizer",bizagi.getTemplate("bizagi.renderingflat.smartphone.bizagi.grid")+"#ui-bizagi-grid-totalizer")).done((function(){e.resolve()})),e.promise()}}),$.Class.extend("bizagi.rendering.device.factory",{},{init:function(e){this.execution_device=bizagi.util.detectDevice(),this.cachedFactory={}},getRenderFactory:function(e,t){var i=this;t=t||"desktop";var r=new $.Deferred;return void 0!==i.cachedFactory[t]?(i.cachedFactory[t].printVersion=!1,r.resolve(i.cachedFactory[t])):"print"===t?(i.cachedFactory[t]=new bizagi.rendering.print.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):"desktop"===t?(i.cachedFactory[t]=new bizagi.rendering.desktop.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):bizagi.util.isTabletDevice(t)?(i.cachedFactory[t]=new bizagi.rendering.tablet.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):bizagi.util.isSmartphoneDevice(t)?(i.cachedFactory[t]=new bizagi.rendering.smartphone.factory(e),i.cachedFactory[t].initAsyncStuff().done((function(){r.resolve(i.cachedFactory[t])}))):(bizagi.showMessageBox("Not supported device: "+t),r.reject("Not supported device: "+t)),r.promise()},getDataService:function(){return this.dataService}}),bizagi.rendering=bizagi.rendering||{},$.Class.extend("bizagi.rendering.facade",{form:void 0,executionDeferred:new $.Deferred},{init:function(e){e=e||{},this.observableElement=$({});var t=e.device||"";this.deviceFactory=new bizagi.rendering.device.factory,this.dataService=new bizagi.render.services.service(e),this.renderFactory=this.deviceFactory.getRenderFactory(this.dataService,t)},getFactory:function(){return{deviceFactory:this.deviceFactory,dataService:this.dataService,renderFactory:this.renderFactory}},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){return this.observableElement.triggerHandler.apply(this.observableElement,arguments)},update:function(e){return e.mode&&(this.mode=e.mode),this.execute($.extend({canvas:this.canvas,mode:this.mode},e))},execute:function(e){var t=this,i=this.ownerDocument,r=$("body",i);if(e=e||{},t.executionDeferred&&t.executionDeferred.state?"resolved"==t.executionDeferred.state()&&(t.executionDeferred=$.Deferred()):t.executionDeferred=$.Deferred(),bizagi.chrono.initAndStart("rendering+data",!0),bizagi.rendering.render.startOptimization(),void 0===e.mode&&!bizagi.util.isEmpty(window.location.search)){var a=bizagi.util.getQueryString();e.mode=a.mode}var n=t.canvas=e.canvas=e.canvas||$("<div />").appendTo(r);return t.mode=e.mode,t.sendExecutingPostMessageWebparts(),t.process(e).done((function(i){e.refreshing||n.empty(),n.append(i.container),$(i.pathProcess).insertBefore(i.container),t.form=i,t.form.setSize({width:t.lastWidth,height:t.lastHeight});var r=setTimeout((function(){t.lastWidth=$(window).width(),t.lastHeight=$(window).height(),window.self!==window.top&&t.resizeInPopUpHTML(),clearTimeout(r)}),2e3);i.triggerHandler("ondomincluded"),t.publish("rendering-formRendered",{form:i}),t.configureOpenForm(i),t.configureRefresh(i,n),t.configureRouting(i,n),t.configureRenderError(i,n),t.configureResize(i),t.configureGlobalHandlers(i),e.summaryForm&&i.container.addClass("ui-bizagi-summary-form"),bizagi.chrono.stopAndLog("rendering"),bizagi.chrono.stopAndLog("rendering+data"),bizagi.chrono.stopAndLog("submitForm"),bizagi.chrono.stopAndLog("submitForm-ajax"),bizagi.chrono.stopAndLog("waiting"),bizagi.rendering.render.stopOptimization(),bizagi.override.enableE2EInterface&&(t.Class.form=t.form,t.Class.executionDeferred.resolve(t.form)),t.executionDeferred.resolve(t.form)})).fail((function(e,i){$.when(t.renderFactory).done((function(i){void 0!==e&&""!==e||(e=bizagi.localization.getResource("render-error-unknown"));var r=i.getCommonTemplate("form-error");n.empty(),n.append($.tmpl(r,{message:e})),t.publish("rendering-formRenderedError",e),t.canvas.triggerHandler("errorform",e),bizagi.chrono.stopAndLog("rendering"),bizagi.chrono.stopAndLog("rendering+data"),t.executionDeferred.reject()}))})),t.executionDeferred.promise()},ready:function(){return this.executionDeferred.promise()},process:function(e){var t=this,i=new $.Deferred,r=t.dataService.getFormData(e),a=t.canvas||e.canvas;return bizagi.showErrorAlertDialog=!1,$.when(r,t.renderFactory).done((function(r,n){if(bizagi.showErrorAlertDialog=!0,bizagi.util.isEmpty(r))return t.publish("no-data-found"),void i.fail();if(r&&"reload"==r.type)(l=t.form)&&(l.endLoading(),l.dispose()),a.triggerHandler("routing",r);else if(r&&"suspended"==r.type){var o=n.getTemplate("info-message"),s=bizagi.localization.getResource("render-case-suspended");$.tmpl(o,{message:s}).appendTo(a),i.fail()}else if(r&&"error"!=r.type){e.hasOwnProperty("printversion")&&((r=t.transformGridControl(r)).form.properties.editable="False"),bizagi.chrono.initAndStart("rendering"),e.type=r.form&&r.form.properties.type||e.type;var l=t.processForm(r.form,n,e);i.resolve(l)}else t.getFailDeferred(r,i)})).fail((function(e){t.getFailDeferred(e,i)})),i.promise()},transformGridControl:function(e){var t=this;return null==e?e:(e.hasOwnProperty("type")&&"grid"==e.type?(e.id=e.id+"-print",e.allowAdd="False",e.allowDelete="False",e.allowEdit="False",e.allowGrouping="False",e.allowMore="False",e.allowSearch="False"):$.each(e,(function(i,r){"object"==_typeof(r)&&(e[i]=t.transformGridControl(e[i]))})),e)},getFailDeferred:function(e,t){var i="",r={};try{r=JSON.parse(e.responseText)}catch(t){r={message:e.responseText,errorType:"ERRORUNKNOWN"}}r.message?(i+="<br>Error Type: "+r.errorType,i+="<br>Error Message: "+r.message):"JSharpNotSupportedException"==r.errorType&&(i+="<br>Error Message: "+bizagi.localization.getResource("jsharp-required")),"ERRORUNKNOWN"==r.errorType?t.reject(i,r.errorType):t.reject(i)},processForm:function(e,t,i){var r=t.getContainer($.extend(i,{type:i.type||"form",data:e}));return r.render(),r},resize:function(e){this.form&&this.form.trigger("renderresize",e)},configureRefresh:function(e,t){var i=this;e.bind("refresh",(function(r,a){var n=e.container.parent(),o=(n=bizagi.util.scrollTop(n)).scrollTop();$(i.form).trigger("onRefreshStarted"),e.dispose(a),t.fastEmpty();var s=t.parent();s.find(".ui-bizagi-button-container").length>0&&s.find(".ui-bizagi-button-container").remove(),i.executionDeferred&&i.executionDeferred.state&&"resolved"==i.executionDeferred.state()&&(i.executionDeferred=$.Deferred());var l=i.form.getParams();return bizagi.util.isMobileDevice()&&!0===l.isOfflineForm&&($.extend(a,{isOfflineForm:!0,offlineType:l.offlineType,isOpen:l.isOpen}),a.online="debug"===(""+BIZAGI_ENVIRONMENT).toLowerCase()?e.online:bizagi.util.isConnected()),$.when(i.execute($.extend(a,{canvas:t,refreshing:!0,idCase:l.idCase,displayName:l.displayName}))).done((function(){var e=setTimeout((function(){n.scrollTop(o),$(i.form).trigger("onRefreshFinished"),clearTimeout(e)}),100)})),i.executionDeferred.promise()}))},configureResize:function(e){var t=this;e.bind("renderresize",(function(i,r){if(r=r||{},!t.resizeTimeout){t.resizeTimeout=setTimeout((function(){var i=$(window).width(),a=$(window).height();(r.forceResize||i!=t.lastWidth)&&(bizagi.chrono.initAndStart("resize"),e.resize({width:i,height:a}),t.lastWidth=i,t.lastHeight=a,bizagi.chrono.stopAndLog("resize"),bizagi.chrono.log("resize")),t.resizeTimeout=null,clearTimeout(t.resizeTimeout)}),0)}})),t.resize()},configureRouting:function(e,t){e.bind("routing",(function(i,r){e.dispose(),t.triggerHandler("routing",r)}))},configureGlobalHandlers:function(e){var t=this;e.bind("globalHandler",(function(e,i){return t.publish(i.eventType,i.data)}))},configureOpenForm:function(e){$(document).trigger("openForm",{form:e})},configureRenderError:function(e,t){var i=this;e.bind("formRenderingError",(function(e,r){$.when(i.renderFactory).done((function(e){var a="<br>Error: ";r=r.replace(/(\r\n|\n|\r)/gm,"");var n=JSON.parse(r);n.message&&(a+=n.message,a+="<br>Error Type: "+n.errorType);var o=e.getCommonTemplate("form-error");t.empty(),t.append($.tmpl(o,{message:a})),i.canvas.triggerHandler("errorform","renderItemError"),bizagi.chrono.stopAndLog("rendering+data"),bizagi.chrono.stopAndLog("rendering")}))}))},dispose:function(){this.form&&this.form.dispose(),bizagi.util.dispose(this)},resizeInPopUpHTML:function(){if($(".activitiFormContainer").length>0&&"cases"!=bizagi.util.getQueryString().type){var e=$(".activitiFormContainer").height()||0,t=$(".activitiFormContainer #ui-bizagi-webpart-render-container"),i=$(".ui-bizagi-button-container",".activitiFormContainer"),r=i.outerHeight()||0,a=bizagi.util.getQueryString().renderBehavior||"";if("PopUp"==(a=a.replace("#",""))){if(void 0===self.postMessageSocket){var n=$(".activitiFormContainer").height()-50||396;$("#render-canvas").height(n),$("#render-canvas").css("overflowY","scroll")}else $(".activitiFormContainer").height($(".activitiFormContainer").height()+$(".ui-bizagi-button-container").height()+30);$(".ui-bizagi-button-container").css("position","absolute"),$(".ui-bizagi-button-container").appendTo(".activitiFormContainer"),$(".ui-bizagi-button-container").length>1&&($(".ui-bizagi-button-container:first").hide(),t.css("marginTop","-17px"))}i.length>0&&t.height(e-97-r),0==$(".ui-bizagi-button-container").children().length?$("#render-canvas").height($("#render-canvas").height()+r):(i.width("100%"),i.css("marginLeft",0),i.css("bottom",0))}else"render"==bizagi.util.getQueryString().type&&($("html").css("overflowX","hidden"),$("#render").height()<=window.innerHeight+5?$("html").css("overflowY","hidden"):$("html").css("overflowY","scroll"),$(".ui-widget-overlay").height(650))},sendExecutingPostMessageWebparts:function(){bizagi&&bizagi.iframeCommunicator&&bizagi.iframeCommunicator.trigger("executing-rendering",{})}});
//# sourceMappingURL=../../../../Maps/smartphone_ios/renderingflat.smartphone.production.js.map
