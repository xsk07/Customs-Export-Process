{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu/bizagi.workportal.desktop.widgets.project.dashboard.menu.js","jquery/workportal/desktop/widget/project.dashboard.menu.activity/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.files/bizagi.workportal.desktop.widgets.project.files.js","jquery/workportal/desktop/widget/project.filesPreview/bizagi.workportal.desktop.widgets.project.filesPreview.js","jquery/workportal/desktop/widget/project.file.sidebar/bizagi.workportal.desktop.widgets.project.file.sidebar.js"],"names":["bizagi","workportal","widgets","widget","extend","onDiscussionsMenuStatusChange","ev","params","this","updateDiscussionsIcons","hasDiscussionsOrComment","sub","$","proxy","toggle","clean","unsub","injector","register","project","dashboard","menu","init","workportalFacade","dataService","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","postRender","self","contextsLeftSidebarCaseDashboard","forEach","context","updateView","event","args","plan","idActivitySelected","undefined","$content","getContent","empty","type","showContextByMenuDashboard","argsTemplate","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isAdhocProcess","util","isEnableFeature","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","render","appendTo","toUpperCase","addClass","siblings","removeClass","handlerEvents","loadContentById","preventDefault","$item","target","closest","hasClass","data","getLevelNavigator","pub","currentLevelNavigator","parseInt","nameItemNavigator","newLevelNavigator","localization","getResource","refreshLastItemBreadcrumb","histName","level","subMenuHandler","$comments","$files","$timeline","on","options","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","idCase","idTask","idWorkflow","idWorkItem","idWorkitem","referrer","publish","off","activity","project-content-dashboard","template","setTimeout","window","trigger","ui","kendo","Widget","ProjectAttachments","element","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","name","wrapper","multiple","dropZone","maxFilesSize","currentUser","uploadMaxFileSize","enabled","that","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","select","_filterMaxFilesSize","complete","interval","setInterval","find","length","_showNotificationCompleteUpload","clearInterval","progress","_onProgressFile","success","push","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","title","notifierTitle","animation","open","duration","close","visible","resizable","draggable","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","replace","_getSize","cancel","retry","Math","round","$file","_getFileItemByUID","uid","percent","percentComplete","css","width","text","hide","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$target","$fileWrapper","$uploadWrapper","guid","remove","_onRemoveFile","_onRetryFile","file","grep","i","validation","_isValidFile","message","setStatus","valid","size","inArray","extension","total","_notifySizeExceeded","show","_switchEvents","currentTarget","cancelFilesUpload","destroy","status","prop","errorUploadiis","plugin","jQuery","base","plugins","prefixBase64","usersData","currentFilesList","fileDateInterval","project-files","project-files-uploaditem","project-files-list","project-attachments","templateHomeFiles","isOpen","parseBoolean","isClosedForAllUsers","when","renderFilesList","done","initializeUploadFiles","eventsHandler","restrictedEventsHandler","defer","Deferred","filesLength","globalParent","radNumber","dateTime","date","getDateServer","count","flowContext","id","getFilesListByRadNumber","renderFiles","resolve","promise","$showMoreWrapper","displayFileList","updateRelativeTime","setAdditionalData","notifyFilesNumber","renderNoFiles","noFilesTmpl","resources","$noFiles","tmpl","html","kendoProjectAttachments","serviceLocator","getUrl","onSuccessFile","addFileData","onSaveFileData","supportFileExt","uploadMaxFilesSize","thumbnails","users","guidsUsers","user","attachment","setUserData","join","setThumbnails","usersGuids","height","getUsersData","picture","getFileInfoByGuid","guids","getFilesThumbnails","thumbnail","$wrapper","$img","each","src","toLowerCase","setFilePreview","guidAttch","guidFile","img","userId","fileData","userData","XMLHttpRequest","response","JSON","parse","saveFileData","fail","onRetryFile","toString","description","idUser","attachmentsToCreate","unshift","createProjectFile","always","userName","Date","getTime","photo","reject","$filesList","equalizeHeights","deleteFile","filter","updateFileData","changeRelativeTime","item","relativeTime","dateFormatter","getRelativeTime","onSelectFiles","bannedFiles","isValidFile","bannedFile","splice","showFilesError","resetWidget","switchFilesEvents","stopPropagation","fileName","getDownloadAttachment","parent","mandatory","filesNumber","notifier","datePickerRegional","dialogBox","project-filespreview-wrapper","project-filespreview-preview","project-filespreview-popup","project-filespreview-thenumber","generalTmpl","setFilesNumber","fileEdition","initPluginPopupEdition","form","image","edit","parameters","isEmptyObject","currentFile","$filesNumber","formContent","showPreview","idCurrentUser","applyMenu","setEditionData","val","onResetFileForm","onSaveEdition","onSelectMenu","onOpenEdition","onDeleteFile","onDownloadFile","dialog","modal","maximize","focus","showConfirmationBox","attachmentsToDelete","validateAddFileDescriptionForm","updateProjectFile","showSucessMessage","printf","showErrorMessage","$description","result","$textAreadescription","trim","descriptionValidation","next","detach","filesPreview","supportNav","project-file-sidebar","getWidgetName","BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR","sidebar"],"mappings":"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","sourcesContent":["/**\r\n * Name: BizAgi Desktop Widget Dashboard menu (left sidebar) * \r\n * @author Valeria Vanegas\r\n */\n\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu\", {}, {\n\n  /**\r\n                                                                                                   * Handler when discussions menu status change\r\n                                                                                                   * @param {*} ev \r\n                                                                                                   * @param {*} params \r\n                                                                                                   */\n  onDiscussionsMenuStatusChange: function onDiscussionsMenuStatusChange(ev, params) {\n    var self = this;\n    self.updateDiscussionsIcons(params.hasDiscussionsOrComment);\n  },\n\n  /**\r\n      * Update discussions icon on sidebar menu\r\n      * The icon is different when there is other discussion or there are comments\r\n      * @param {*} hasDiscussionsOrComment \r\n      */\n  updateDiscussionsIcons: function updateDiscussionsIcons(hasDiscussionsOrComment) {\n    var self = this;\n\n    self.sub(\"UPDATE_DISCUSSIONS_MENU_STATUS\", $.proxy(self.onDiscussionsMenuStatusChange, self));\n\n    $(\".bz-icon-discussion-comment\").toggle(hasDiscussionsOrComment);\n    $(\".bz-icon-discussion-no-comment\").toggle(!hasDiscussionsOrComment);\n    self.params.hasDiscussionsOrComment = hasDiscussionsOrComment;\n  },\n\n  /**\r\n      * Detach events\r\n      */\n  clean: function clean() {\n    var self = this;\n    self.unsub(\"UPDATE_DISCUSSIONS_MENU_STATUS\", $.proxy(self.onDiscussionsMenuStatusChange, self));\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu], true);","/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.dashboard.menu.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", {}, {\n\n  /**\r\n                                                                                                                            *   Constructor\r\n                                                                                                                            */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n    self.params = params || {};\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity\").concat(\"#project-dashboard-menu1\") });\n\n  },\n\n  /**\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  /**\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    self._super();\n    //Handlers\n    self.params.contextsLeftSidebarCaseDashboard.forEach(function (context) {\n      self.sub(context, $.proxy(self.updateView, self));\n    });\n  },\n\n  /**\r\n      * Update view\r\n      * @param event\r\n      * @param params\r\n      */\n  updateView: function updateView(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n    self.params.plan.idActivitySelected = undefined;\n    self.clean();\n    var $content = self.getContent().empty();\n\n    if (typeof event.type !== \"undefined\") {\n      self.params.showContextByMenuDashboard = event.type;\n    }\n\n    var argsTemplate = {\n      showFormOverview: self.params.menuDashboard.showFormOverview,\n      showFormActivity: self.params.menuDashboard.showFormActivity,\n      showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\n      showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\n      showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu && (\n      !self.params.isAdhocProcess ||\n      self.params.isAdhocProcess && bizagi.util.isEnableFeature(\"enableTimelineOnLiveProcesses\")),\n      showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\n      contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\n      contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu };\n\n\n    //Update widget\n    var template = self.getTemplate(\"project-dashboard-menu\");\n    template.render(argsTemplate).appendTo($content);\n\n\n    if (self.params.showContextByMenuDashboard) {\n      $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\n    }\n\n    self.updateDiscussionsIcons(self.params.hasDiscussionsOrComment);\n    self.handlerEvents();\n  },\n\n  /**\r\n      *   Load Content By Id\r\n      */\n  loadContentById: function loadContentById(event) {\n    var self = this;\n    event.preventDefault();\n    var $item = $(event.target).closest(\"li\");\n\n    if (!$item.hasClass(\"active\")) {\n\n      var showContextByMenuDashboard = $item.data(\"context\");\n\n      if (showContextByMenuDashboard) {\n        var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\n        var currentLevelNavigator = parseInt(getLevelNavigator[0], 10);\n        var nameItemNavigator = \"\";\n        var newLevelNavigator = currentLevelNavigator;\n\n        if (showContextByMenuDashboard == \"PLANACTIVITIES\") {\n          newLevelNavigator = currentLevelNavigator + 1;\n          nameItemNavigator = bizagi.localization.getResource(\"workportal-project-casedashboard-plan\");\n        }\n\n        self.params.refreshLastItemBreadcrumb = false;\n        self.pub(\"notify\", {\n          type: showContextByMenuDashboard.toUpperCase(),\n          args: $.extend(self.params, { showContextByMenuDashboard: showContextByMenuDashboard,\n            histName: nameItemNavigator,\n            level: newLevelNavigator }) });\n\n        $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\n      }\n    }\n  },\n\n  subMenuHandler: function subMenuHandler() {\n    var self = this;\n    var content = self.getContent();\n    var $comments = $(\"[data-context='COMMENTS']\", content);\n    var $files = $(\"[data-context='FILES']\", content);\n    var $timeline = $(\"[data-context='TIMELINE']\", content);\n\n    $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\n      $comments.toggle();\n      $files.toggle();\n      $timeline.toggle();\n    });\n  },\n\n  /**\r\n      * Handler events\r\n      */\n  handlerEvents: function handlerEvents() {\n    var self = this;\n    var content = self.getContent();\n\n    self.subMenuHandler();\n\n    $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\", $.proxy(self.loadContentById, self));\n\n    // Bind for click event on refresh botton\n    $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).on(\"click\", function () {\n      var options = {\n        action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\n        idCase: self.params.idCase,\n        idTask: self.params.idTask,\n        idWorkflow: self.params.idWorkflow,\n        idWorkItem: self.params.idWorkitem,\n        referrer: self.params.referrer || \"inboxGrid\" };\n\n      self.publish(\"executeAction\", options);\n    });\n  },\n\n  /**\r\n      * Clean widgets and events\r\n      */\n  clean: function clean() {\n    var self = this;\n    var content = self.getContent();\n\n    self._super();\n\n    if (self.params && self.params.contextsLeftSidebarCaseDashboard) {\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function (context) {\n        self.unsub(context, $.proxy(self.updateView, self));\n      });\n    }\n\n    $(\".ui-bizagi-wp-project-tab-links a\", content).off();\n    $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).off();\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\n\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\") });\n\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-content-dashboard\");\n    self.content = template.render({});\n\n    return self.content;\n  },\n  postRender: function postRender() {\n    var self = this;\n\n    setTimeout(function () {\n      $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\n    }, 1000);\n\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\n\n(function ($) {\n\n  // shorten references to variables. this is better for uglification \n  var kendo = window.kendo,\n  ui = kendo.ui,\n  Widget = ui.Widget;\n\n  var ProjectAttachments = Widget.extend({\n\n    init: function init(element, options) {\n\n      var that = this;\n\n      // base call to initialize widget\n      Widget.fn.init.call(that, element, options);\n\n      that._maxFilesSize = options.maxSize;\n      that._fileList = [];\n      that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\n      that._supportFileExt = options.extensions;\n      that._uploadMaxFilesSize = options.maxSize;\n      that.upload = that._initUpload();\n      that.loadNotifier = that._initLoadNotifier();\n      that.notification = that._initNotification();\n\n      that._eventsHandler();\n\n      that._initLocalization(that.options.localization);\n    },\n\n    options: {\n      name: \"ProjectAttachments\",\n      wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\n      multiple: true,\n      dropZone: true,\n      maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\n      enabled: true,\n      localization: {} },\n\n\n    _initUpload: function _initUpload() {\n\n      var that = this,\n      options = that.options,\n      localization = options.localization || {},\n      auxNumberFilesSuccess = 0;\n\n      that._initLocalization(localization);\n\n      return this.element.kendoUpload({\n        async: {\n          saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\n          autoUpload: true },\n\n        select: function select(event) {\n          that._filterMaxFilesSize(event);\n          auxNumberFilesSuccess = 0;\n        },\n        complete: function complete() {\n          var interval = setInterval(function () {\n            if (that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0) {\n              that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\n              clearInterval(interval);\n            }\n          }, 300);\n        },\n        upload: options.upload,\n        progress: function progress(event) {\n          that._onProgressFile(event);\n        },\n        success: function success(event) {\n          that._fileList.push(event.files[0]);\n          auxNumberFilesSuccess += 1;\n          options.success(event);\n        },\n        error: function error(event) {\n          that.onErrorFile(event);\n        },\n        localization: {\n          select: localization.selectFiles,\n          dropFilesHere: localization.dropFilesHere },\n\n        multiple: options.multiple,\n        enabled: options.enabled,\n        dropZone: options.dropZone,\n        showFileList: false }).\n      data(\"kendoUpload\");\n\n    },\n\n    _initNotification: function _initNotification() {\n      return $(\"<div></div>\").kendoNotification({\n        position: {\n          pinned: true } }).\n\n      data(\"kendoNotification\");\n    },\n\n    _initLoadNotifier: function _initLoadNotifier() {\n\n      var that = this,\n      localization = that.options.localization,\n      $wrapper = that.options.wrapper;\n\n      return $wrapper.kendoWindow({\n        title: localization.notifierTitle,\n        actions: [\"Close\"],\n        animation: {\n          open: {\n            duration: 100 },\n\n          close: {\n            duration: 100 } },\n\n\n        open: function open() {\n          this.wrapper.addClass(\"project-attachments-wrapper-window\");\n        },\n        visible: false,\n        resizable: false,\n        draggable: false,\n        maxHeight: \"300px\",\n        minWidth: \"430px\" }).\n      data(\"kendoWindow\");\n\n    },\n\n    _initLocalization: function _initLocalization(objectOptionsLocalization) {\n      var that = this;\n      var optionsLocalizationByDefault = {\n        selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\n        notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\n        errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error\"),\n        errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\n        errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\n        errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", that._getSize(that._maxFilesSize)),\n        dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\n        cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\n        retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\n        close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\") };\n\n\n      $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\n    },\n\n    /**\r\n        * return maxSize in MB\r\n        * @param {*} maxSize \r\n        */\n    _getSize: function _getSize(maxSize) {\n      return Math.round(maxSize / (1024 * 1024), -1);\n    },\n\n    _onProgressFile: function _onProgressFile(event) {\n\n      var that = this;\n      var $file = that._getFileItemByUID(event.files[0].uid);\n      var percent = event.percentComplete;\n\n      $(\".k-progress\", $file).css({\n        width: percent + \"%\" });\n\n\n      $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\n\n      if (percent === 100) {$(\".k-upload-action .k-icon\", $file).hide();}\n    },\n\n    _onShowUploadNotifier: function _onShowUploadNotifier(event) {\n\n      var that = this,\n      files = event.files,\n      template = that.options.template;\n\n      that.loadNotifier.content(template.render({ files: files }));\n      that.loadNotifier.wrapper.css({\n        top: \"auto\",\n        left: \"auto\",\n        bottom: \"1em\",\n        right: \"1em\" });\n\n\n      that.loadNotifier.open();\n    },\n\n    _showNotificationCompleteUpload: function _showNotificationCompleteUpload(wrapperMessage, auxNumberFilesSuccess) {\n      var that = this;\n      if (wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\n      {\n        that._autoHideMessage(wrapperMessage);\n      }\n    },\n\n    _autoHideMessage: function _autoHideMessage(wrapperMessage) {\n      var that = this;\n      setTimeout(function () {\n        wrapperMessage.fadeOut(function () {\n          that.loadNotifier.close();\n        });\n      }, 2000);\n    },\n\n    _onCancelFile: function _onCancelFile($target) {\n      var that = this,\n      $fileWrapper = $target.closest(\"li\"),\n      $uploadWrapper = that.upload.wrapper,\n      guid = $fileWrapper.data(\"guid\");\n\n      $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\n      $fileWrapper.remove();\n    },\n\n    _onRemoveFile: function _onRemoveFile($target) {\n      var $fileWrapper = $target.closest(\"li\");\n      $fileWrapper.remove();\n    },\n\n    _onRetryFile: function _onRetryFile($target) {\n      var that = this;\n      var $file = $target.closest(\"li\");\n      var guid = $file.data(\"guid\");\n      var file = $.grep(that._fileList, function (i) {\n        return i.uid === guid;\n      });\n\n      that.options.retry(file[0]);\n    },\n\n    onErrorFile: function onErrorFile(event) {\n\n      var that = this,\n      localization = that.options.localization,\n      file = event.files[0],\n      validation = that._isValidFile(file);\n      var message = validation.message !== \"\" ? validation.message : localization.errorUpload;\n\n      that.setStatus(\"ERROR\", file.uid, message);\n    },\n\n    _isValidFile: function _isValidFile(file) {\n\n      var that = this,\n      localization = that.options.localization,\n      valid = true,\n      message = \"\";\n\n      if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0) {\n        message = localization.errorSize;\n        valid = false;\n      }\n\n      if (!that._onlyValidateServerFileExtension) {\n        if ($.inArray(file.extension, that._supportFileExt) === -1) {\n          message = localization.errorSecurity;\n          valid = false;\n        }\n      }\n\n      return {\n        valid: valid,\n        message: message };\n\n    },\n\n    _filterMaxFilesSize: function _filterMaxFilesSize(event) {\n\n      var that = this;\n      var total = 0;\n\n      for (var i = 0, length = event.files.length; i < length; i++) {\n        total += event.files[i].size;\n      }\n      if (total > that._maxFilesSize) {\n        that._notifySizeExceeded();\n        event.preventDefault();\n      } else {\n        that._onShowUploadNotifier(event);\n      }\n    },\n\n    _notifySizeExceeded: function _notifySizeExceeded() {\n\n      var that = this;\n\n      that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\n    },\n\n    _getFileItemByUID: function _getFileItemByUID(uid) {\n      var that = this;\n      return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\n    },\n\n    _switchEvents: function _switchEvents(event) {\n      var that = this;\n      var $target = $(\".k-icon\", event.currentTarget);\n      if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\n        that._onRemoveFile($target);\n      } else if ($target.hasClass(\"k-retry\")) {\n        that._onRetryFile($target);\n      } else if ($target.hasClass(\"k-cancel\")) {\n        that._onCancelFile($target);\n      }\n    },\n\n    _eventsHandler: function _eventsHandler() {\n      var that = this;\n\n      that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\n        that._switchEvents(event);\n      });\n    },\n\n    cancelFilesUpload: function cancelFilesUpload() {\n      var that = this;\n      var $uploadWrapper = that.upload.wrapper;\n\n      $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\n      that.close();\n    },\n\n    close: function close() {\n      this.loadNotifier.close();\n    },\n\n    destroy: function destroy() {\n      this.loadNotifier.destroy();\n      this.upload.destroy();\n    },\n\n    setStatus: function setStatus(status, uid, message) {\n\n      var $file = this._getFileItemByUID(uid),\n      localization = this.options.localization;\n\n      switch (status) {\n        case \"SUCCESS\":\n          $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\n          $(\".k-errormsg\", $file).text(\"\");\n          break;\n        case \"ERROR\":\n          $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\n          $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\n          $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\n          break;\n        case \"RETRY\":\n          $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\n          $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\n          $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\n          break;}\n\n    } });\n\n\n\n  ui.plugin(ProjectAttachments);\n})(jQuery);","/*\r\n *   Name: Bizagi Workportal Desktop Project Files Controller\r\n *   Author: David Romero Estrada\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.files\", {}, {\n  /**\r\n                                                                                               *   Constructor\r\n                                                                                               */\n  init: function init(workportalFacade, dataService, params) {\n\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.plugins = {};\n    self.prefixBase64 = \"data:image/png;base64,\";\n    self.usersData = {};\n    self.currentFilesList = [];\n    self.fileDateInterval;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-files\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-wrapper\"),\n      \"project-files-uploaditem\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-uploaditem\"),\n      \"project-files-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-list\"),\n      \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\") });\n\n  },\n\n  /**\r\n     * Renders the template defined in the widget\r\n     */\n  renderContent: function renderContent() {\n    var self = this;\n    var templateHomeFiles = self.getTemplate(\"project-files\");\n    self.content = templateHomeFiles.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) });\n    return self.content;\n  },\n\n  /**\r\n     * Post render and links events with handlers\r\n     */\n  postRender: function postRender() {\n    var self = this;\n    $.when(self.renderFilesList()).done(function () {\n      self.plugins[\"uploadFiles\"] = self.initializeUploadFiles();\n      self.eventsHandler();\n      self.restrictedEventsHandler();\n    });\n  },\n\n  /**\r\n     *   Render Files List\r\n     */\n  renderFilesList: function renderFilesList() {\n    var self = this;\n    var defer = $.Deferred();\n    var filesLength = self.currentFilesList.length;\n    var params = {\n      globalParent: self.radNumber,\n      dateTime: !filesLength ? self.getDateServer() : self.currentFilesList[filesLength - 1].date,\n      count: 12 };\n\n    if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\n      params.globalParent = self.params.plan.id;\n    }\n    $.when(self.dataService.getFilesListByRadNumber(params)).done(function (files) {\n      self.currentFilesList = self.currentFilesList.concat(files);\n\n      self.renderFiles(files);\n\n      defer.resolve();\n    });\n\n    return defer.promise();\n  },\n\n  /**\r\n     * Render Files\r\n     */\n  renderFiles: function renderFiles(files) {\n\n    var self = this;\n\n    var $content = self.getContent();\n    var $showMoreWrapper = $(\"#project-files-showmore\", $content);\n    self.displayFileList(files, \"append\");\n    self.updateRelativeTime();\n\n    if (files.length) {\n      self.setAdditionalData(files);\n    }\n\n    if (self.currentFilesList.length >= 12) {\n      $showMoreWrapper.show();\n\n      if (files.length < 12) {\n        $(\"button\", $showMoreWrapper).remove();\n        $(\"#project-files-nomore\", $showMoreWrapper).show();\n      }\n    }\n\n    self.notifyFilesNumber(false);\n  },\n\n  /**\r\n     * Render no files\r\n     */\n  renderNoFiles: function renderNoFiles() {\n\n    var self = this;\n    var noFilesTmpl = self.workportalFacade.getTemplate(\"info-message\");\n    var message = self.resources.getResource(\"workportal-project-files-noavailable\");\n\n    /* self.disableSideBar();*/\n\n    var $noFiles = $.tmpl(noFilesTmpl, {\n      message: message });\n\n\n    self.content.html($noFiles);\n  },\n\n  /**\r\n     * Initialize upload files\r\n     */\n  initializeUploadFiles: function initializeUploadFiles() {\n    var self = this;\n    var content = self.getContent();\n\n    return $(\"#project-files-upload\", content).kendoProjectAttachments({\n      saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\n      template: self.getTemplate(\"project-attachments\"),\n      success: $.proxy(self.onSuccessFile, self),\n      upload: $.proxy(self.addFileData, self),\n      retry: $.proxy(self.onSaveFileData, self),\n      enabled: true,\n      extensions: self.supportFileExt,\n      maxSize: self.uploadMaxFilesSize }).\n    data(\"kendoProjectAttachments\");\n  },\n\n  /**\r\n     * Set Additional Data For Files\r\n     */\n  setAdditionalData: function setAdditionalData(files) {\n\n    var self = this;\n    var thumbnails = [],users = [],guidsUsers = [];\n\n    for (var i = 0, length = files.length - 1; i <= length; i++) {\n      users.push(files[i].user);\n      guidsUsers.push(files[i].user);\n      thumbnails.push(files[i].attachment.guid);\n    }\n\n    self.setUserData(guidsUsers.join());\n    self.setThumbnails(thumbnails.join());\n  },\n\n  /**\r\n     * Set User Data\r\n     */\n  setUserData: function setUserData(users) {\n    var self = this;\n    var $content = self.getContent();\n\n    var params = {\n      usersGuids: users,\n      width: 50,\n      height: 50 };\n\n\n    $.when(self.dataService.getUsersData(params)).done(function (users) {\n      for (var i = 0, length = users.length - 1; i <= length; i++) {\n        if (users[i].picture) {\n          users[i].picture = self.prefixBase64 + users[i].picture;\n        }\n        self.usersData[\"id\" + users[i].id] = users[i];\n        $(\"#project-files-list .ui-bizagi-wp-project-files-user[data-userId=\" + users[i].id + \"]\", $content).text(users[i].name);\n      }\n    });\n  },\n\n  /**\r\n     * Get file list \r\n     */\n  getFileInfoByGuid: function getFileInfoByGuid(guid) {\n    var self = this;\n    var file;\n    for (var i = 0, length = self.currentFilesList.length; i < length; i++) {\n\n      if (guid === self.currentFilesList[i].guid) {\n        file = self.currentFilesList[i];\n        i = length;\n      }\n    }\n    return file;\n  },\n\n  /**\r\n     * Set Thumbnails\r\n     */\n  setThumbnails: function setThumbnails(thumbnails) {\n    var self = this;\n    var $content = self.getContent();\n\n    var params = {\n      guids: thumbnails,\n      width: 480,\n      height: 150,\n      globalParent: self.params.radNumber };\n\n\n    $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\n      var thumbnail, $wrapper, $img;\n\n      $.each(files, function (guid, src) {\n        guid = guid.toLowerCase();\n        thumbnail = self.prefixBase64 + src;\n        $wrapper = $(\"#project-files-list .ui-bizagi-wp-project-files-wrapitem[data-attchGuid=\" + guid + \"]\", $content);\n        $img = $(\".ui-bizagi-wp-project-files-thumbnail\", $wrapper);\n\n        $img.prop(\"src\", thumbnail);\n        $(\".ui-bizagi-wp-project-files-icon\", $wrapper).remove();\n        $img.css(\"display\", \"block\");\n      });\n    });\n  },\n\n  /**\r\n     * Set Preview\r\n     */\n  setFilePreview: function setFilePreview($target, guidAttch, guidFile) {\n\n    var self = this;\n    var img = \"\";\n    var params = {\n      guids: [guidAttch].join(),\n      width: 500,\n      height: 500,\n      globalParent: self.params.radNumber };\n\n\n    $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\n      var $userTag = $target.find(\".ui-bizagi-wp-project-files-user\");\n      var userId = $userTag.data(\"userid\");\n\n      $.each(files, function (guid, src) {\n        img = self.prefixBase64 + src;\n      });\n\n      self.pub(\"notify\", {\n        type: \"FILEPREVIEW\",\n        args: {\n          radNumber: self.radNumber,\n          fileData: self.getFileInfoByGuid(guidFile),\n          userData: self.usersData[\"id\" + userId],\n          isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\n          img: img } });\n\n\n\n      self.pub(\"notify\", {\n        type: \"OPEN_RIGHT_SIDEBAR\" });\n\n    });\n  },\n\n  /**\r\n     *  On Success File\r\n     */\n  onSuccessFile: function onSuccessFile(event) {\n\n    var self = this;\n    var status = event.XMLHttpRequest.response ? JSON.parse(event.XMLHttpRequest.response) : {};\n\n    if (!status.error) {\n      self.onSaveFileData(event.files[0]);\n    } else {\n      self.plugins[\"uploadFiles\"].onErrorFile(event);\n    }\n  },\n\n  /**\r\n     * On Save File Data\r\n     */\n  onSaveFileData: function onSaveFileData(file) {\n\n    var self = this;\n\n    $.when(self.saveFileData(file)).done(function () {\n      self.notifyFilesNumber();\n      self.plugins[\"uploadFiles\"].setStatus(\"SUCCESS\", file.uid);\n    }).fail(function () {\n      self.plugins[\"uploadFiles\"].setStatus(\"RETRY\", file.uid);\n    });\n  },\n\n  /**\r\n      * Retry file\r\n      * @param $target\r\n      */\n  onRetryFile: function onRetryFile($target) {\n    var self = this;\n    var $file = $target.closest(\"li\");\n    var guid = $file.data(\"guid\");\n\n    var file = $.grep(self.currentFilesList, function (i) {\n      return i.uid === guid;\n    });\n\n    self.onSaveFileData($file, file[0]);\n  },\n\n  /**\r\n      * Add Guid to Files Data\r\n      * @param event\r\n      */\n  addFileData: function addFileData(event) {\n    var self = this;\n\n    //add guid to send\n    event.data = {\n      guid: event.files[0].uid };\n\n  },\n\n  /**\r\n      * Save Files\r\n      * @param file\r\n      * @return {*}\r\n      */\n  saveFileData: function saveFileData(file) {\n\n    var self = this;\n    var defer = $.Deferred();\n\n    var guid = Math.guid();\n    var globalParent = self.radNumber ? self.radNumber.toString() : \"\";\n    if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\n      globalParent = self.params.plan.id;\n    }\n\n    var params = {\n      \"content\": {\n        \"guid\": guid,\n        \"description\": \"\",\n        \"name\": file.name,\n        \"attachment\": {\n          \"guid\": file.uid,\n          \"name\": file.name },\n\n        \"date\": self.getDateServer(),\n        \"user\": bizagi.currentUser.idUser,\n        \"globalParent\": globalParent },\n\n      \"attachmentsToCreate\": [\n      file.uid] };\n\n\n\n    self.currentFilesList.unshift(file);\n\n    $.when(self.dataService.createProjectFile(params)).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n\n        //extend file data\n        $.extend(file, {\n          user: bizagi.currentUser.idUser,\n          userName: bizagi.currentUser.userName,\n          date: new Date().getTime(),\n          attachment: params.content.attachment,\n          guid: params.content.guid,\n          description: params.content.description });\n\n\n        self.usersData[\"id\" + bizagi.currentUser.idUser] = {\n          picture: bizagi.currentUser.photo,\n          name: bizagi.currentUser.userName,\n          id: bizagi.currentUser.idUser };\n\n\n        self.displayFileList(file, \"prepend\");\n\n        self.updateRelativeTime();\n        self.setThumbnails(file.uid);\n\n        defer.resolve();\n      } else {\n\n        defer.reject();\n      }\n    });\n\n    return defer;\n  },\n\n  /**\r\n      * Display File List\r\n      * @param files\r\n      * @param action\r\n      */\n  displayFileList: function displayFileList(files, action) {\n    var self = this;\n    var tmpl = self.getTemplate(\"project-files-list\");\n    var files = files || self.currentFilesList;\n    var content = self.getContent();\n    var $filesList = tmpl.render({\n      files: files });\n\n\n    $(\"#project-files-list\", content)[action]($filesList);\n    $.equalizeHeights(\".bz-card\");\n  },\n\n  /**\r\n      * Delete file\r\n      * @param event\r\n      * @param params\r\n      */\n  deleteFile: function deleteFile(event, params) {\n    var self = this;\n\n    var content = self.getContent();\n    $(\"div[data-fileguid='\" + params.args.guid + \"']\", content).remove();\n\n    self.currentFilesList = self.currentFilesList.filter(function (file) {\n      return file.guid !== params.args.guid;\n    });\n\n    self.notifyFilesNumber(true);\n  },\n\n  /**\r\n      * Update File Data\r\n      * @param event\r\n      * @param params\r\n      */\n  updateFileData: function updateFileData(event, params) {\n\n    var self = this;\n    var file = self.getFileInfoByGuid(params.args.guid);\n\n    file.description = params.args.description;\n  },\n\n  /**\r\n     * Update relative time\r\n     */\n  updateRelativeTime: function updateRelativeTime() {\n\n    var self = this;\n\n    if (self.fileDateInterval) clearInterval(self.fileDateInterval);\n\n    self.fileDateInterval = setInterval($.proxy(self.changeRelativeTime, self), \"7000\");\n  },\n\n  /**\r\n     * Change Relative Time\r\n     */\n  changeRelativeTime: function changeRelativeTime() {\n\n    var self = this;\n    var $content = self.getContent();\n\n    $(\"#project-files-list .ui-bizagi-wp-project-files-date\", $content).each(function (i, item) {\n      var dateTime = $(item).data(\"date\");\n      var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(dateTime), null, false);\n\n      $(item).text(relativeTime);\n    });\n  },\n\n  /**\r\n      * Filter files by some criteria\r\n      * @param event\r\n      */\n  onSelectFiles: function onSelectFiles(event) {\n\n    var self = this,\n    bannedFiles = [],\n    files = event.files;\n\n    for (var i = files.length - 1; i >= 0; i--) {\n\n      if (!self.isValidFile(files[i]).valid) {\n        var bannedFile = files.splice(i, i + 1);\n        bannedFiles.unshift(bannedFile[0]);\n      }\n    }\n\n    if (bannedFiles.length > 0) {\n      self.showFilesError(bannedFiles);\n    }\n  },\n\n  /**\r\n      * Reset widget\r\n      */\n  resetWidget: function resetWidget() {\n\n    var self = this;\n    if (self.plugins[\"uploadFiles\"]) {\n      self.plugins[\"uploadFiles\"].close();\n    }\n    self.currentFilesList = [];\n    clearInterval(self.fileDateInterval);\n  },\n\n  /**\r\n     * Switch Events\r\n     */\n  switchFilesEvents: function switchFilesEvents(event) {\n\n    event.stopPropagation();\n\n    var self = this;\n\n    var $target = $(event.target),\n    $item = $target.closest(\".ui-bizagi-wp-project-files-wrapitem\");\n\n    if ($item.length) {\n\n      var guidAttch = $item.data(\"attchguid\"),\n      guidFile = $item.data(\"fileguid\");\n\n      if ($target.hasClass(\"ui-bizagi-wp-project-files-file\")) {\n        var fileName = $target.text();\n\n        self.dataService.getDownloadAttachment(guidAttch, fileName);\n      } else {\n        self.setFilePreview($item, guidAttch, guidFile);\n      }\n\n    } else if ($target.parent().prop(\"id\") === \"project-files-showmore\") {\n      self.renderFilesList();\n    } else if ($target.prop(\"id\") !== \"project-files-upload\") {\n      self.notifyFilesNumber(true);\n    }\n\n  },\n\n  /**\r\n      * Show number files to right sidebar\r\n      * @param mandatory\r\n      */\n  notifyFilesNumber: function notifyFilesNumber(mandatory) {\n    var self = this;\n\n    self.pub(\"notify\", {\n      type: \"SETFILESNUMBER\",\n      args: {\n        filesNumber: self.currentFilesList.length,\n        mandatory: mandatory } });\n\n\n  },\n\n  /**\r\n      * Restricted Event Handler\r\n      */\n  restrictedEventsHandler: function restrictedEventsHandler() {\n    var self = this;\n    self.content.on(\"click\", $.proxy(self.switchFilesEvents, self));\n  },\n\n  /**\r\n     *  Events Handler\r\n     */\n  eventsHandler: function eventsHandler() {\n\n    var self = this;\n    var $content = self.getContent();\n\n    self.sub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\n    self.sub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\n    self.sub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\n\n    $content.on(\"click\", $.proxy(self.switchFilesEvents, self));\n  },\n\n  /**\r\n     * Clean\r\n     */\n  clean: function clean() {\n    var self = this;\n    self.resetWidget();\n\n    self.unsub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\n    self.unsub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\n    self.unsub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\n\n    for (var i in self.plugins) {\n      if (self.plugins[i])\n      self.plugins[i].destroy();\n    }\n\n    clearInterval(self.fileDateInterval);\n    self._super();\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.files\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.files], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project File Preview\r\n *   Author: David Romero Estrada\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.filesPreview\", {}, {\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, notifier, params) {\n    var self = this;\n\n    //Regional\n    self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\n\n    self.dialogBox = {};\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n    self.notifier = notifier;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-filespreview-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-wrapper\"),\n      \"project-filespreview-preview\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-preview\"),\n      \"project-filespreview-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-popup\"),\n      \"project-filespreview-thenumber\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-thenumber\") });\n\n  },\n\n  /**\r\n     * Renders the template defined in the widget\r\n     */\n  renderContent: function renderContent() {\n    var self = this;\n    var generalTmpl = self.getTemplate(\"project-filespreview-wrapper\");\n\n    self.content = generalTmpl.render();\n\n    self.sub(\"SETFILESNUMBER\", $.proxy(self.setFilesNumber, self));\n\n    return self.content;\n  },\n\n  /**\r\n     * links events with handlers\r\n     */\n  postRender: function postRender() {\n    var self = this;\n\n    self.plugins.fileEdition = self.initPluginPopupEdition();\n\n    self.form = {\n      description: $(\"#ui-bizagi-wp-project-filespreview-popup-description\", self.plugins.fileEdition),\n      image: $(\".ui-bizagi-wp-project-popupform-user-image\", self.plugins.fileEdition),\n      cancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.fileEdition),\n      edit: $(\"#ui-bizagi-wp-project-popupform-action-editfile\", self.plugins.fileEdition) };\n\n\n    self.eventsHandler();\n  },\n\n  setFilesNumber: function setFilesNumber(event, params) {\n    var self = this;\n    var parameters = params.args;\n\n    if ($.isEmptyObject(self.currentFile) || parameters.mandatory) {\n      var tmpl = self.getTemplate(\"project-filespreview-thenumber\");\n      var $filesNumber = tmpl.render({ filesNumber: parameters.filesNumber });\n      self.currentFile = {};\n      $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html($filesNumber);\n    }\n  },\n\n  initPluginPopupEdition: function initPluginPopupEdition() {\n    var self = this;\n    var tmpl = self.getTemplate(\"project-filespreview-popup\");\n\n    self.dialogBox.formContent = tmpl.render();\n\n    return self.dialogBox.formContent;\n  },\n\n  showPreview: function showPreview(event, params) {\n    var self = this;\n    var template = self.getTemplate(\"project-filespreview-preview\");\n    self.currentFile = params.args;\n\n    var content = template.render($.extend(params.args, { idCurrentUser: bizagi.currentUser.idUser }));\n\n    $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html(content);\n    self.applyMenu();\n  },\n\n  setEditionData: function setEditionData() {\n    var self = this;\n    self.form.description.val(self.currentFile.fileData.description);\n    if (self.currentFile.userData.picture) {\n      self.form.image.prop(\"src\", self.currentFile.userData.picture);\n    }\n  },\n\n  eventsHandler: function eventsHandler() {\n    var self = this;\n    self.form.cancel.on(\"click\", $.proxy(self.onResetFileForm, self));\n    self.form.edit.on(\"click\", $.proxy(self.onSaveEdition, self));\n    self.sub(\"FILEPREVIEW\", $.proxy(self.showPreview, self));\n  },\n\n  onSelectMenu: function onSelectMenu(event, ui) {\n    var self = this;\n    if ($(event.currentTarget).find(\"i\").length === 0) {\n      var item = $(ui.item).data(\"item\");\n      switch (item) {\n        case \"edit\":\n          self.onOpenEdition();\n          break;\n        case \"delete\":\n          self.onDeleteFile();\n          break;\n        case \"download\":\n          self.onDownloadFile();\n          break;}\n\n    }\n  },\n\n  onDownloadFile: function onDownloadFile() {\n    var self = this;\n    self.dataService.getDownloadAttachment(self.currentFile.fileData.attachment.guid, self.currentFile.fileData.name);\n  },\n\n  onOpenEdition: function onOpenEdition() {\n    var self = this;\n\n    self.dialogBox.formContent.dialog({\n      resizable: false,\n      draggable: false,\n      height: \"auto\",\n      width: \"650px\",\n      modal: true,\n      title: bizagi.localization.getResource(\"workportal-project-files-editfile\"),\n      maximize: true,\n      close: function close() {\n        self.onResetFileForm();\n      } });\n\n\n    self.setEditionData();\n    self.form.description.focus();\n  },\n\n  onDeleteFile: function onDeleteFile() {\n    var self = this;\n    $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-file-querydelete\"), \"\", \"info\")).done(function () {\n      var params = {\n        content: {\n          guid: self.currentFile.fileData.guid },\n\n        attachmentsToDelete: [self.currentFile.fileData.attachment.guid] };\n\n\n      $.when(self.dataService.deleteFile(params)).always(function (response) {\n        if (response.status === 200 || response.status === 201 || response.status === undefined) {\n          self.pub(\"notify\", {\n            type: \"DELETEFILE\",\n            args: {\n              guid: params.content.guid } });\n\n\n        }\n      });\n    });\n  },\n\n  onSaveEdition: function onSaveEdition() {\n    var self = this;\n    if (self.validateAddFileDescriptionForm(self.form.description)) {\n      self.currentFile.fileData.description = self.form.description.val();\n\n      var params = {\n        \"content\": {\n          \"guid\": self.currentFile.fileData.guid,\n          \"description\": self.currentFile.fileData.description,\n          \"attachment\": self.currentFile.fileData.attachment,\n          \"name\": self.currentFile.fileData.name,\n          \"date\": self.currentFile.fileData.date,\n          \"user\": bizagi.currentUser.idUser,\n          \"globalParent\": self.currentFile.radNumber } };\n\n\n\n      $.when(self.dataService.updateProjectFile(params)).always(function (response) {\n        if (response.status === 200 || response.status === 201 || response.status === undefined) {\n          $(\"#ui-bizagi-wp-project-filespreview-description\", self.content).text(params.content.description);\n\n          self.onResetFileForm();\n          self.notifier.showSucessMessage(\n          printf(bizagi.localization.getResource(\"workportal-project-files-editionsuccess\"), \"\"));\n\n          self.pub(\"notify\", {\n            type: \"UPDATEFILE\",\n            args: {\n              description: params.content.description,\n              guid: params.content.guid } });\n\n\n        } else {\n          self.onResetFileForm();\n          self.notifier.showErrorMessage(\n          printf(bizagi.localization.getResource(\"workportal-general-error-generic\"), \"\"));\n        }\n      });\n    }\n  },\n\n  validateAddFileDescriptionForm: function validateAddFileDescriptionForm($description) {\n    var result = false,\n    $textAreadescription = $description;\n    if ($textAreadescription.val().trim() === \"\") {\n      var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\n      $textAreadescription.parent().next().find(\"span\").html(descriptionValidation);\n    } else\n    {\n      $textAreadescription.parent().next().find(\"span\").empty();\n      result = true;\n    }\n    return result;\n  },\n\n  onResetFileForm: function onResetFileForm() {\n    var self = this;\n    self.form.description.parent().next().find(\"span\").empty();\n    self.dialogBox.formContent.dialog(\"destroy\");\n    self.dialogBox.formContent.detach();\n  },\n\n  applyMenu: function applyMenu() {\n    var self = this;\n\n    $(\".ui-bizagi-wp-project-filespreview-edit\", self.content).menu({\n      select: $.proxy(self.onSelectMenu, self) }).\n    removeClass(\"ui-widget-content\");\n  },\n\n  clean: function clean() {\n    var self = this;\n\n    self.plugins = {};\n    self.form = {};\n    self.currentFile = {};\n    self.filesNumber = 0;\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.filesPreview\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.filesPreview]);","/*\r\n *   Name: Bizagi Workportal project File Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.file.sidebar\", {}, {\n\n  /*\r\n                                                                                                *   Constructor\r\n                                                                                                */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    params = params || {};\n    params.supportNav = false;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-file-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.file.sidebar\").concat(\"#project-file-sidebar\") });\n\n\n  },\n\n  /*\r\n     *   Returns the widget name\r\n     */\n  getWidgetName: function getWidgetName() {\n    return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR;\n  },\n\n  /*\r\n     * Renders the template defined in the widget\r\n     */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-file-sidebar\");\n    self.content = template.render({});\n\n    return self.content;\n  } });\n\n\nbizagi.injector.register('bizagi.workportal.widgets.project.file.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.file.sidebar], true);"]}