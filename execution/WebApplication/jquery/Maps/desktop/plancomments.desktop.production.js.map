{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu/bizagi.workportal.desktop.widgets.project.dashboard.menu.js","jquery/workportal/desktop/widget/project.dashboard.menu.plan/bizagi.workportal.desktop.widgets.project.dashboard.menu.plan.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.discussions/bizagi.workportal.desktop.widgets.project.discussions.js","jquery/workportal/desktop/widget/project.plan.sidebar/bizagi.workportal.desktop.widgets.project.plan.sidebar.js","jquery/workportal/desktop/widget/project.discussion.sidebar/bizagi.workportal.desktop.widgets.project.discussion.sidebar.js","jquery/workportal/desktop/widget/project.plan.action/bizagi.workportal.desktop.widgets.project.plan.action.js","jquery/workportal/desktop/widget/project.plan.state/bizagi.workportal.desktop.widgets.project.plan.state.js","jquery/workportal/desktop/widget/project.plan.progress/bizagi.workportal.desktop.widgets.project.plan.progress.js","jquery/workportal/desktop/widget/project.plan.time/bizagi.workportal.desktop.widgets.project.plan.time.js","jquery/workportal/desktop/widget/project.plan.parent/bizagi.workportal.desktop.widgets.project.plan.parent.js","jquery/workportal/desktop/widget/project.plan.users/bizagi.workportal.desktop.widgets.project.plan.users.js"],"names":["bizagi","workportal","widgets","widget","extend","onDiscussionsMenuStatusChange","ev","params","this","updateDiscussionsIcons","hasDiscussionsOrComment","sub","$","proxy","toggle","clean","unsub","injector","register","project","dashboard","menu","init","workportalFacade","dataService","projectDashboard","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","postRender","self","contextsLeftSidebarCaseDashboard","forEach","context","updateView","event","args","$content","getContent","empty","template","menuPlanDashboard","menuDashboard","planState","getPlanState","plan","planChild","argsTemplate","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isVisibleShowTimeLine","render","appendTo","showContextByMenuDashboard","toUpperCase","addClass","siblings","removeClass","handlerEvents","currentState","extraValidationShowTimeLine","loadContentById","preventDefault","$item","target","closest","data","backParentPlan","hasClass","pub","type","subMenuHandler","$comments","$files","$timeline","on","getLevelNavigator","currentLevelNavigator","parseInt","getParamsByBackFromPlan","typeContext","paramsNotify","off","project-content-dashboard","setTimeout","window","trigger","ui","kendo","Widget","ProjectAttachments","element","options","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","localization","name","wrapper","multiple","dropZone","maxFilesSize","currentUser","uploadMaxFileSize","enabled","that","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","select","_filterMaxFilesSize","complete","interval","setInterval","find","length","_showNotificationCompleteUpload","clearInterval","progress","_onProgressFile","success","push","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","title","notifierTitle","actions","animation","open","duration","close","visible","resizable","draggable","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","getResource","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","replace","_getSize","cancel","retry","Math","round","$file","_getFileItemByUID","uid","percent","percentComplete","css","width","text","hide","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$target","$fileWrapper","$uploadWrapper","guid","remove","_onRemoveFile","_onRetryFile","file","grep","i","validation","_isValidFile","message","setStatus","valid","size","undefined","inArray","extension","total","_notifySizeExceeded","show","_switchEvents","currentTarget","cancelFilesUpload","destroy","status","prop","errorUploadiis","plugin","jQuery","base","notifier","typeResource","plugins","dialogBoxDiscussion","attchComments","attchDiscussions","addition","listDataDiscussion","userPictures","commentsList","globalTags","tempTagsBeforeDelete","tempTagsToDelete","keySentenceAddTag","project-discussions","project-discussions-popup","project-discussions-list","project-discussions-comments","project-discussions-attachments","project-attachments","templateHomeDiscussions","$contentWidget","popupDiscussion","initPluginPopupDiscussion","form","buttonShowFormNewDiscussion","subject","description","buttonShowPopupDiscussionToAdd","buttonAddDiscussion","buttonCancel","formDiscussion","attachments","edition","tagsFilter","initPluginTagsFilter","tagsMultiSelect","initPluginTagsMultiSelect","getDiscussions","eventsHandler","restrictedEventsHandler","getDataDiscussions","done","idUsersCreatedDiscussions","map","user","idUsersCreatedComments","property","comments","csvGuidUsers","a","seen","out","len","j","item","removeDuplicateItemsFromArray","idUser","join","getDataUsers","then","renderUserProfilesAndImages","setClassesTagsByDiscussion","onNotifyOpenPopup","showFormAddDiscussion","renderUserProfile","templatePopupDiscussion","formContent","newitemtext","categoriesMultiSelect","isDelete","createNewTag","kendoMultiSelect","change","valuesSelected","value","slice","dataitems","dataSource","tag","indexOf","filter","Boolean","pos","newtag","dataItemAddNew","at","refresh","list","itemData","add","dataBound","_prev","isfound","insert","createEmptyTag","search","dataTextField","dataValueField","hideOrShowDiscussionsByFilter","autoClose","tagMode","valueClass","validateAddCommentForm","$wrapperForm","result","$textAreaComment","val","trim","commentValidation","parent","next","html","validateAddDiscussionForm","$subjectDiscussion","$descriptionDiscussion","subjectValidation","descriptionValidation","applyFileAttachments","kendoProjectAttachments","serviceLocator","getUrl","onSuccessFile","addFileData","supportFileExt","uploadMaxFilesSize","defer","Deferred","paramsGetDiscussions","globalParent","radNumber","flowContext","id","getDiscussionsData","pipe","response","callForListComments","sortDiscussions","updateTemplateListDiscussion","resolve","promise","usersGuids","height","getUsersData","always","array","splice","arrayUnique","discussions","generalDefer","commentsDefer","addGlobalTags","tags","idParent","dateTime","getDateServer","count","when","getCommentsData","apply","sortedDiscussion","sort","b","dateA","date","positionDiscussion","iDis","arr","old_index","new_index","k","array_move","resetDiscussionAttachments","sendDataUpdateDiscussion","filesObj","prepareFilesToSave","tagsDiscussion","getTagsDiscussionBySave","guidsTagsDiscussionToDelete","getGuidsTagsDiscussionToDelete","toString","general","attachmentsToCreate","attachmentsToDelete","editDiscussion","discussion","getDiscussionDataByGUID","onClosePopupDiscussion","removeGlobalTags","showSucessMessage","printf","showErrorMessage","validateStringIsGuid","test","sendDataInsertDiscussion","postDiscussion","newDiscussion","updateDiscussionsMenu","tagsTextSelected","dataSourceTags","tagTextSelected","tagFound","isGuidTextSelected","tagSource","isGuid","differenceArrays","guidsTagsCurrentDiscussion","setStateUIShowMoreComments","$commentsContainer","state","$containerButtonMoreComments","$buttonShowMoreComments","$messageNoMoreComments","$messageLoadingComments","getCurrentUserInfo","userName","picture","createTagsOnServer","iTagAdd","tagGlobal","postTag","guidTagsToDelete","allGuidsMoreGuidsDelete","itemTag","secureGuidsForDelete","guidDelete","guidSecureDelete","idTag","deleteTag","iTagGlobal","iDiscussion","tagsBySpace","templateListDiscussions","contentRenderListDiscussions","listDataDiscussions","isOpen","util","parseBoolean","isClosedForAllUsers","returnServedCommentByParentId","parentId","mapTempComments","append","resourceTitlePopup","dialog","modal","zIndex","maximize","onOpenPopupDiscussion","resetFormDiscussion","userPicture","$parent","$img","$text","attr","getInitials","iUser","switchCommentsEvents","is","onShowButtonsPanel","onCancelComment","$container","onCreateComment","onViewComment","onViewMoreComments","onRemoveFiles","onEditDiscussion","showConfirmationBox","onDeleteComment","onDownloadAttachment","stopPropagation","setDiscussionsDataByGUID","guidTagsDiscussion","renderAttachments","$commentWrapper","toggleClass","getMoreComments","getCommentsCountByParent","dateLastComment","responseMoreComments","Array","prototype","renderCommentByDiscussion","idUsersLoaded","idUsersNewComments","csvIdUsersMissingLoad","not","get","fail","guidParent","moreComments","$commentsDOM","tmplComment","renderObject","getCommentByGuid","parentGuid","commentGuid","x","lengthx","index","currentFiles","removeFiles","tmpSplice","fileGuid","comment","deleteComment","keys","Object","haveDiscussions","haveComments","XMLHttpRequest","JSON","parse","$wrapper","sender","$liTarget","guidAttachment","nameFile","getDownloadAttachment","$commentContainer","$buttonsWrp","$textarea","$uploadForm","$vlTooltip","$fileList","reset","$rplWrp","$addCommentContainer","$uploadList","postComment","newComment","unshift","isIE","fileList","onClickCancel","detach","focus","onSubmitFormDiscussion","resetWidget","hasOwnProperty","$source","$textareaSource","$textareaTarget","$uploadListSource","first","$uploadListTarget","serviceloadDataPlan","supportNav","project-plan-sidebar","areTemplatedLoaded","idPlan","loadData","subscribe","loadedWithDataActivities","loadedWithDataFirstParent","unsubscribe","sidebar","project-discussion-sidebar","onShowPopupDiscussion","planTemplateCreate","planPopupEdit","PENDING_PLAN","EXECUTING_PLAN","CLOSED_PLAN","CONTEXT_ACTIVITYPLAN","CONTEXT_ACTIVITYPLANOVERVIEW","CONTEXT_PLANCREATE","CONTEXT_ACTIVITYPLANCREATE","showActionsPlan","plan-action-main","tmpl","stateClosedPlan","currentStatePlan","contextualized","initilizeActionMenu","onClosePlan","onNotifyLoadInfoSummaryPlan","clearAlertsOnFocus","setNamePlan","onNotifyExpandedRightSidebar","setStatePlan","statePlan","namePlan","decodeHtmlEntities","onSelectMenu","onClickMenuOpenEdition","onClickMenuDeletePlan","onClickMenuSaveAsTemplate","planSelected","showPopup","showPopupAddTemplatePlan","callDeletePlan","onSubmitFormPlan","focusout","deletePlan","action","plan-state-main","renderWidget","plan-progress-main","valuePercentBarComplete","calculateProgress","colorBar","$barRemainingDate","widthNumberDays","completedActivities","totalActivities","activities","percentProgress","activity","workItemState","datePickerRegional","plan-time-main","dueDate","updateWidget","planDatesToStamp","estimatedFinishDate","Date","getTime","startDate","finishDate","creationDate","closedDate","getClosedDatePlan","getIntervalOnMinutes","relativeTime","dateFormatter","getRelativeTime","now","minutesToShowTime","messageUnitTimeCalculated","keywordResourceDescriptionDifference","getKeywordDifferenceDates","messageDescripionDifference","valueOfTimeCalculated","auxToDate","getSecondDate","auxPercentBar","getWidthBar","auxColorBar","getColorBarByPercent","fromDate","getFormattedDate","getFirstDate","toDate","percentBar","getLastActivity","stringify","activityA","activityB","getDifferenceBetweenDates","firstDate","secondDate","callGetEffectiveDuration","difference","minutes","minutesNowToDueDate","minutesCreateToNow","minutesDueDateToCreate","minutesCreateToDueDate","minutesStartToNow","minutesDueDateToNow","minutesStartToDueDate","milliseconds","intervalMinutes","differenceStartDateToCurrentDate","totalInterval","valuePercentInterval","ceil","differenceStartDateToClosedDate","d","getEffectiveDuration","dateObj","monthNames","getMonth","formatDate","time","plan-parent-main","parentWorkItem","getPlanParent","planParent","nameParent","displayName","idCase","idWorkflow","idWorkItem","idTask","processName","process","planName","isEmpty","guidActivity","goToParentCase","paramsDetailActivity","idActivity","getActivity","allowEdition","msg","onClickGoToParentCase","routingExecute","usersMap","usersInformation","globalHandlersService","usersAssignees","plan-users-main","auxNoRepeatTypesUser","hashTypesUser","assigned","owner","cvsGuidUsers","activitiesUsers","ownerUserGuid","idUserCreator","ownerUserId","userGuid","userType","each","userId","userAssigned","userAssignedGuid","isRunning","guidUser","assignee","justAssignees","label","initilizeTooltip","addEventHandlersModal","callGetDataUsers","showCreatorInformation","allUsers","usersAssignee","isOwner","isAssignee","usersAdapter","createJsonUserInfo","userCreator","userInfo","username","email","userinformation","obj","$li","console","log","csvguidUsers","getUsersAssignees","activityRunning","res_user","getUserAssignee","tasks","types","actUser","id_userSelected","task","userParam","usertooltip","click","publish","widgetName","BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL","closeVisible","modalParameters","refreshInbox","users"],"mappings":"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","sourcesContent":["/**\r\n * Name: BizAgi Desktop Widget Dashboard menu (left sidebar) * \r\n * @author Valeria Vanegas\r\n */\n\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu\", {}, {\n\n  /**\r\n                                                                                                   * Handler when discussions menu status change\r\n                                                                                                   * @param {*} ev \r\n                                                                                                   * @param {*} params \r\n                                                                                                   */\n  onDiscussionsMenuStatusChange: function onDiscussionsMenuStatusChange(ev, params) {\n    var self = this;\n    self.updateDiscussionsIcons(params.hasDiscussionsOrComment);\n  },\n\n  /**\r\n      * Update discussions icon on sidebar menu\r\n      * The icon is different when there is other discussion or there are comments\r\n      * @param {*} hasDiscussionsOrComment \r\n      */\n  updateDiscussionsIcons: function updateDiscussionsIcons(hasDiscussionsOrComment) {\n    var self = this;\n\n    self.sub(\"UPDATE_DISCUSSIONS_MENU_STATUS\", $.proxy(self.onDiscussionsMenuStatusChange, self));\n\n    $(\".bz-icon-discussion-comment\").toggle(hasDiscussionsOrComment);\n    $(\".bz-icon-discussion-no-comment\").toggle(!hasDiscussionsOrComment);\n    self.params.hasDiscussionsOrComment = hasDiscussionsOrComment;\n  },\n\n  /**\r\n      * Detach events\r\n      */\n  clean: function clean() {\n    var self = this;\n    self.unsub(\"UPDATE_DISCUSSIONS_MENU_STATUS\", $.proxy(self.onDiscussionsMenuStatusChange, self));\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu], true);","/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Plan\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.dashboard.menu.extend(\"bizagi.workportal.widgets.project.dashboard.menu.plan\", {}, {\n\n  /*\r\n                                                                                                                        *   Constructor\r\n                                                                                                                        */\n  init: function init(workportalFacade, dataService, projectDashboard, params) {\n    var self = this;\n    self.params = params || {};\n    self.projectDashboard = projectDashboard;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.plan\").concat(\"#project-dashboard-menu\") });\n\n  },\n\n  /**\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n\n  },\n\n  /**\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    self._super();\n    //Handlers\n    if (self.params && self.params.contextsLeftSidebarCaseDashboard) {\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function (context) {\n        self.sub(context, $.proxy(self.updateView, self));\n      });\n    }\n  },\n\n\n  updateView: function updateView(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n    self.clean();\n    var $content = self.getContent().empty();\n\n    var template = self.getTemplate(\"project-dashboard-menu\");\n    self.params.menuPlanDashboard = self.params.menuPlanDashboard || {};\n    $.extend(self.params.menuPlanDashboard, self.params.menuDashboard);\n\n    self.planState = self.getPlanState(self.params.plan, self.params.planChild);\n    var argsTemplate = {\n      planState: self.planState,\n      showCommentsOptionMenu: self.params.menuPlanDashboard.showCommentsOptionMenu,\n      showFilesOptionMenu: self.params.menuPlanDashboard.showFilesOptionMenu,\n      showTimeLineOptionMenu: self.params.menuPlanDashboard.showTimeLineOptionMenu && self.isVisibleShowTimeLine(self.planState) };\n\n    template.render(argsTemplate).appendTo($content);\n\n    $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\n\n    self.updateDiscussionsIcons(self.params.hasDiscussionsOrComment);\n    self.handlerEvents();\n  },\n\n  /**\r\n      * Return planState by plan or planChild\r\n      * @param plan\r\n      * @param planChild\r\n      * @returns {*}\r\n      */\n  getPlanState: function getPlanState(plan, planChild) {\n    var currentState;\n    if (planChild && planChild.currentState) {\n      currentState = planChild.currentState;\n    } else\n    if (plan && plan.currentState) {\n      currentState = plan.currentState;\n    }\n    return currentState;\n  },\n\n  /**\r\n      * Behavior visible timeline option\r\n      */\n  isVisibleShowTimeLine: function isVisibleShowTimeLine(planState) {\n    var self = this;\n    var extraValidationShowTimeLine = true;\n    if (planState === \"PENDING\") {\n      extraValidationShowTimeLine = false;\n    }\n    return extraValidationShowTimeLine;\n  },\n\n  /*\r\n      *   Load Content By Id\r\n      */\n  loadContentById: function loadContentById(event) {\n    var self = this;\n    event.preventDefault();\n    var $item = $(event.target).closest(\"li\");\n\n    if ($item.data(\"context\") === \"PLANBACK\") {\n      self.backParentPlan();\n    } else\n    {\n      if (!$item.hasClass(\"active\")) {\n        var showContextByMenuDashboard = $item.data(\"context\");\n        if (showContextByMenuDashboard) {\n\n          self.pub(\"notify\", {\n            type: showContextByMenuDashboard.toUpperCase(),\n            args: $.extend(self.params, { showContextByMenuDashboard: showContextByMenuDashboard }) });\n\n          $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\n        }\n      }\n    }\n  },\n\n  subMenuHandler: function subMenuHandler() {\n    var self = this;\n    var content = self.getContent();\n    var $comments = $(\"[data-context='PLANCOMMENTS']\", content);\n    var $files = $(\"[data-context='PLANFILES']\", content);\n    var $timeline = $(\"[data-context='PLANTIMELINE']\", content);\n\n    $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\n      $comments.toggle();\n      $files.toggle();\n      if (self.isVisibleShowTimeLine(self.planState)) {\n        $timeline.toggle();\n      }\n    });\n  },\n\n  backParentPlan: function backParentPlan() {\n    var self = this;\n    //when a plan created from an activity is deleted, not created from a case\n    var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\n    var currentLevelNavigator = parseInt(getLevelNavigator[0]);\n    var params = self.projectDashboard.getParamsByBackFromPlan(self.params, currentLevelNavigator);\n\n    self.pub(\"notify\", {\n      type: params.typeContext,\n      args: $.extend(self.params, params.paramsNotify) });\n\n\n  },\n\n  handlerEvents: function handlerEvents() {\n    var self = this;\n    var content = self.getContent();\n\n    self.subMenuHandler();\n\n    $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\", $.proxy(self.loadContentById, self));\n  },\n\n  clean: function clean() {\n    var self = this;\n    var content = self.getContent();\n\n    self._super();\n\n    $(\".ui-bizagi-wp-project-tab-links a\", content).off();\n\n    if (self.params && self.params.contextsLeftSidebarCaseDashboard) {\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function (context) {\n        self.unsub(context, $.proxy(self.updateView, self));\n      });\n    }\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.plan\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.projectDashboard\", bizagi.workportal.widgets.project.dashboard.menu.plan], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\n\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\") });\n\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-content-dashboard\");\n    self.content = template.render({});\n\n    return self.content;\n  },\n  postRender: function postRender() {\n    var self = this;\n\n    setTimeout(function () {\n      $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\n    }, 1000);\n\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\n\n(function ($) {\n\n  // shorten references to variables. this is better for uglification \n  var kendo = window.kendo,\n  ui = kendo.ui,\n  Widget = ui.Widget;\n\n  var ProjectAttachments = Widget.extend({\n\n    init: function init(element, options) {\n\n      var that = this;\n\n      // base call to initialize widget\n      Widget.fn.init.call(that, element, options);\n\n      that._maxFilesSize = options.maxSize;\n      that._fileList = [];\n      that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\n      that._supportFileExt = options.extensions;\n      that._uploadMaxFilesSize = options.maxSize;\n      that.upload = that._initUpload();\n      that.loadNotifier = that._initLoadNotifier();\n      that.notification = that._initNotification();\n\n      that._eventsHandler();\n\n      that._initLocalization(that.options.localization);\n    },\n\n    options: {\n      name: \"ProjectAttachments\",\n      wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\n      multiple: true,\n      dropZone: true,\n      maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\n      enabled: true,\n      localization: {} },\n\n\n    _initUpload: function _initUpload() {\n\n      var that = this,\n      options = that.options,\n      localization = options.localization || {},\n      auxNumberFilesSuccess = 0;\n\n      that._initLocalization(localization);\n\n      return this.element.kendoUpload({\n        async: {\n          saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\n          autoUpload: true },\n\n        select: function select(event) {\n          that._filterMaxFilesSize(event);\n          auxNumberFilesSuccess = 0;\n        },\n        complete: function complete() {\n          var interval = setInterval(function () {\n            if (that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0) {\n              that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\n              clearInterval(interval);\n            }\n          }, 300);\n        },\n        upload: options.upload,\n        progress: function progress(event) {\n          that._onProgressFile(event);\n        },\n        success: function success(event) {\n          that._fileList.push(event.files[0]);\n          auxNumberFilesSuccess += 1;\n          options.success(event);\n        },\n        error: function error(event) {\n          that.onErrorFile(event);\n        },\n        localization: {\n          select: localization.selectFiles,\n          dropFilesHere: localization.dropFilesHere },\n\n        multiple: options.multiple,\n        enabled: options.enabled,\n        dropZone: options.dropZone,\n        showFileList: false }).\n      data(\"kendoUpload\");\n\n    },\n\n    _initNotification: function _initNotification() {\n      return $(\"<div></div>\").kendoNotification({\n        position: {\n          pinned: true } }).\n\n      data(\"kendoNotification\");\n    },\n\n    _initLoadNotifier: function _initLoadNotifier() {\n\n      var that = this,\n      localization = that.options.localization,\n      $wrapper = that.options.wrapper;\n\n      return $wrapper.kendoWindow({\n        title: localization.notifierTitle,\n        actions: [\"Close\"],\n        animation: {\n          open: {\n            duration: 100 },\n\n          close: {\n            duration: 100 } },\n\n\n        open: function open() {\n          this.wrapper.addClass(\"project-attachments-wrapper-window\");\n        },\n        visible: false,\n        resizable: false,\n        draggable: false,\n        maxHeight: \"300px\",\n        minWidth: \"430px\" }).\n      data(\"kendoWindow\");\n\n    },\n\n    _initLocalization: function _initLocalization(objectOptionsLocalization) {\n      var that = this;\n      var optionsLocalizationByDefault = {\n        selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\n        notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\n        errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error\"),\n        errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\n        errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\n        errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", that._getSize(that._maxFilesSize)),\n        dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\n        cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\n        retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\n        close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\") };\n\n\n      $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\n    },\n\n    /**\r\n        * return maxSize in MB\r\n        * @param {*} maxSize \r\n        */\n    _getSize: function _getSize(maxSize) {\n      return Math.round(maxSize / (1024 * 1024), -1);\n    },\n\n    _onProgressFile: function _onProgressFile(event) {\n\n      var that = this;\n      var $file = that._getFileItemByUID(event.files[0].uid);\n      var percent = event.percentComplete;\n\n      $(\".k-progress\", $file).css({\n        width: percent + \"%\" });\n\n\n      $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\n\n      if (percent === 100) {$(\".k-upload-action .k-icon\", $file).hide();}\n    },\n\n    _onShowUploadNotifier: function _onShowUploadNotifier(event) {\n\n      var that = this,\n      files = event.files,\n      template = that.options.template;\n\n      that.loadNotifier.content(template.render({ files: files }));\n      that.loadNotifier.wrapper.css({\n        top: \"auto\",\n        left: \"auto\",\n        bottom: \"1em\",\n        right: \"1em\" });\n\n\n      that.loadNotifier.open();\n    },\n\n    _showNotificationCompleteUpload: function _showNotificationCompleteUpload(wrapperMessage, auxNumberFilesSuccess) {\n      var that = this;\n      if (wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\n      {\n        that._autoHideMessage(wrapperMessage);\n      }\n    },\n\n    _autoHideMessage: function _autoHideMessage(wrapperMessage) {\n      var that = this;\n      setTimeout(function () {\n        wrapperMessage.fadeOut(function () {\n          that.loadNotifier.close();\n        });\n      }, 2000);\n    },\n\n    _onCancelFile: function _onCancelFile($target) {\n      var that = this,\n      $fileWrapper = $target.closest(\"li\"),\n      $uploadWrapper = that.upload.wrapper,\n      guid = $fileWrapper.data(\"guid\");\n\n      $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\n      $fileWrapper.remove();\n    },\n\n    _onRemoveFile: function _onRemoveFile($target) {\n      var $fileWrapper = $target.closest(\"li\");\n      $fileWrapper.remove();\n    },\n\n    _onRetryFile: function _onRetryFile($target) {\n      var that = this;\n      var $file = $target.closest(\"li\");\n      var guid = $file.data(\"guid\");\n      var file = $.grep(that._fileList, function (i) {\n        return i.uid === guid;\n      });\n\n      that.options.retry(file[0]);\n    },\n\n    onErrorFile: function onErrorFile(event) {\n\n      var that = this,\n      localization = that.options.localization,\n      file = event.files[0],\n      validation = that._isValidFile(file);\n      var message = validation.message !== \"\" ? validation.message : localization.errorUpload;\n\n      that.setStatus(\"ERROR\", file.uid, message);\n    },\n\n    _isValidFile: function _isValidFile(file) {\n\n      var that = this,\n      localization = that.options.localization,\n      valid = true,\n      message = \"\";\n\n      if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0) {\n        message = localization.errorSize;\n        valid = false;\n      }\n\n      if (!that._onlyValidateServerFileExtension) {\n        if ($.inArray(file.extension, that._supportFileExt) === -1) {\n          message = localization.errorSecurity;\n          valid = false;\n        }\n      }\n\n      return {\n        valid: valid,\n        message: message };\n\n    },\n\n    _filterMaxFilesSize: function _filterMaxFilesSize(event) {\n\n      var that = this;\n      var total = 0;\n\n      for (var i = 0, length = event.files.length; i < length; i++) {\n        total += event.files[i].size;\n      }\n      if (total > that._maxFilesSize) {\n        that._notifySizeExceeded();\n        event.preventDefault();\n      } else {\n        that._onShowUploadNotifier(event);\n      }\n    },\n\n    _notifySizeExceeded: function _notifySizeExceeded() {\n\n      var that = this;\n\n      that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\n    },\n\n    _getFileItemByUID: function _getFileItemByUID(uid) {\n      var that = this;\n      return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\n    },\n\n    _switchEvents: function _switchEvents(event) {\n      var that = this;\n      var $target = $(\".k-icon\", event.currentTarget);\n      if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\n        that._onRemoveFile($target);\n      } else if ($target.hasClass(\"k-retry\")) {\n        that._onRetryFile($target);\n      } else if ($target.hasClass(\"k-cancel\")) {\n        that._onCancelFile($target);\n      }\n    },\n\n    _eventsHandler: function _eventsHandler() {\n      var that = this;\n\n      that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\n        that._switchEvents(event);\n      });\n    },\n\n    cancelFilesUpload: function cancelFilesUpload() {\n      var that = this;\n      var $uploadWrapper = that.upload.wrapper;\n\n      $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\n      that.close();\n    },\n\n    close: function close() {\n      this.loadNotifier.close();\n    },\n\n    destroy: function destroy() {\n      this.loadNotifier.destroy();\n      this.upload.destroy();\n    },\n\n    setStatus: function setStatus(status, uid, message) {\n\n      var $file = this._getFileItemByUID(uid),\n      localization = this.options.localization;\n\n      switch (status) {\n        case \"SUCCESS\":\n          $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\n          $(\".k-errormsg\", $file).text(\"\");\n          break;\n        case \"ERROR\":\n          $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\n          $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\n          $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\n          break;\n        case \"RETRY\":\n          $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\n          $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\n          $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\n          break;}\n\n    } });\n\n\n\n  ui.plugin(ProjectAttachments);\n})(jQuery);","/*\r\n *   Name: Bizagi Workportal Desktop Project Discussions Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.discussions\", {}, {\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, notifier, params) {\n\n    var self = this;\n\n    self.typeResource = \"DiscussionGuid\";\n    self.plugins = {};\n    self.dialogBoxDiscussion = {};\n    self.attchComments = {};\n    self.attchDiscussions = {\n      remove: [],\n      addition: [] };\n\n    self.listDataDiscussion = [];\n    self.userPictures = [];\n    self.commentsList = {};\n\n    self.globalTags = [];\n\n    self.tempTagsBeforeDelete = [];\n    self.tempTagsToDelete = [];\n    self.keySentenceAddTag = bizagi.localization.getResource(\"workportal-project-discussion-add-new-tag\") + \": \";\n    self.notifier = notifier;\n\n\n    //Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-discussions\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-wrapper\"),\n      \"project-discussions-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-popup-wrapper\"),\n      \"project-discussions-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-list-wrapper\"),\n      \"project-discussions-comments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-comments-list\"),\n      \"project-discussions-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-attachments-list\"),\n      \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\") });\n\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    var templateHomeDiscussions = self.getTemplate(\"project-discussions\");\n\n    self.content = templateHomeDiscussions.render({});\n    return self.content;\n  },\n\n  /*\r\n      * Post render and links events with handlers\r\n      */\n  postRender: function postRender() {\n\n    var self = this;\n    var $contentWidget = self.getContent();\n\n    self.plugins.popupDiscussion = self.initPluginPopupDiscussion();\n    var popupDiscussion = self.plugins.popupDiscussion;\n\n    //reference for html elements\n    self.form = {\n      buttonShowFormNewDiscussion: $(\".ui-bizagi-wp-action-new\", $contentWidget),\n      title: $(\".ui-bizagi-wp-project-popupform-h4\", popupDiscussion),\n      subject: $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", popupDiscussion),\n      description: $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", popupDiscussion),\n      buttonShowPopupDiscussionToAdd: $(\"#ui-bizagi-wp-project-discussions-button-action-show-popup-to-add\", $contentWidget),\n      buttonAddDiscussion: $(\"#ui-bizagi-wp-project-discussions-popup-action-add-discussion\", popupDiscussion),\n      buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", popupDiscussion),\n      formDiscussion: $(\".ui-bizagi-wp-project-discussions-popup\", popupDiscussion),\n      attachments: $(\".ui-bizagi-wp-project-discussions-attachments-cmnwrapper\", popupDiscussion),\n      edition: false };\n\n\n    self.plugins.tagsFilter = self.initPluginTagsFilter();\n\n    self.plugins.tagsMultiSelect = self.initPluginTagsMultiSelect(popupDiscussion);\n\n    //Load discussions\n    self.getDiscussions();\n    self.eventsHandler();\n    self.restrictedEventsHandler();\n  },\n\n  getDiscussions: function getDiscussions() {\n    var self = this;\n\n    self.getDataDiscussions().done(function () {\n\n      var idUsersCreatedDiscussions = $.map(self.listDataDiscussion, function (element) {\n        return element.user;\n      });\n\n      var idUsersCreatedComments = $.map(self.commentsList, function (property) {\n        return $.map(property.comments, function (property) {\n          return property.user;\n        });\n      });\n\n      function removeDuplicateItemsFromArray(a) {\n        var seen = {};\n        var out = [];\n        var len = a.length;\n        var j = 0;\n        for (var i = 0; i < len; i++) {\n          var item = a[i];\n          if (seen[item] !== 1) {\n            seen[item] = 1;\n            out[j++] = item;\n          }\n        }\n        return out;\n      }\n\n      var csvGuidUsers = removeDuplicateItemsFromArray(idUsersCreatedDiscussions.concat(idUsersCreatedComments).concat(bizagi.currentUser.idUser)).join(\",\");\n\n      self.getDataUsers(csvGuidUsers).then(function () {\n        self.renderUserProfilesAndImages();\n      });\n\n      self.setClassesTagsByDiscussion();\n\n    });\n\n  },\n\n  /*\r\n      * Notifies when an event is raised\r\n      */\n  onNotifyOpenPopup: function onNotifyOpenPopup() {\n    var self = this;\n\n    self.form.edition = false;\n    self.showFormAddDiscussion(\"workportal-project-discussion-adddiscussion\");\n    self.renderUserProfile();\n  },\n\n  /*\r\n      * Init plugins\r\n      */\n  initPluginPopupDiscussion: function initPluginPopupDiscussion() {\n    var self = this;\n    var templatePopupDiscussion = self.getTemplate(\"project-discussions-popup\");\n    self.dialogBoxDiscussion.formContent = templatePopupDiscussion.render({ attachments: [] });\n    return self.dialogBoxDiscussion.formContent;\n  },\n\n\n  initPluginTagsMultiSelect: function initPluginTagsMultiSelect(popupDiscussion) {\n    var self = this;\n    var tags = [];\n    var categoriesMultiSelect = popupDiscussion.find(\"#ui-bizagi-wp-project-discussions-options-multiselect-tags\");\n    var newitemtext;\n    var isDelete = false;\n    var createNewTag = false;\n    return categoriesMultiSelect.kendoMultiSelect({\n      change: function change() {\n        var valuesSelected = this.value().slice(0);\n\n        var dataitems = this.dataSource.data();\n        if (valuesSelected.length > 0) {\n          if (dataitems[0].tag.replace(self.keySentenceAddTag, \"\").indexOf(valuesSelected[valuesSelected.length - 1]) !== -1) {\n            //fix because the value dont complete by millisecond\n            valuesSelected[valuesSelected.length - 1] = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\n          }\n        }\n\n\n        valuesSelected = valuesSelected.filter(Boolean); //Remove empty items\n\n        //remove duplicate items\n        valuesSelected = valuesSelected.filter(function (value, pos, self) {\n          return self.indexOf(value) === pos;\n        });\n\n        var newtag = \"\";\n\n        if (dataitems.length > 0) {\n          if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\n            newtag = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\n\n            var dataItemAddNew = {};\n            if (valuesSelected.indexOf(newtag) !== -1) {\n              dataItemAddNew = this.dataSource.at(0);\n              isDelete = true;\n              this.dataSource.remove(dataItemAddNew);\n              isDelete = false;\n              this.refresh();\n              createNewTag = true;\n            } else\n            {\n              if (newtag) {\n                if ($(\"li:first\", this.list).hasClass(\"k-state-focused\")) {\n                  createNewTag = true;\n                  valuesSelected.push(newtag);\n                }\n                dataItemAddNew = this.dataSource.at(0);\n                isDelete = true;\n                this.dataSource.remove(dataItemAddNew);\n                isDelete = false;\n              }\n            }\n          }\n        }\n        if (newtag) {\n          if (createNewTag) {\n            var existInDatasource = this.dataSource.data().filter(function (itemData) {\n              return itemData.tag === newtag;\n            });\n            if (existInDatasource.length === 0) {\n              this.dataSource.add({ guid: newtag, tag: newtag });\n            }\n            createNewTag = false;\n          }\n        }\n        this.dataSource.filter({});\n        this.value(valuesSelected);\n\n      },\n      dataBound: function dataBound() {\n        if ((newitemtext || this._prev) && newitemtext !== this._prev && !isDelete) {\n          newitemtext = this._prev;\n\n          var dataitems = this.dataSource.data();\n\n          var isfound = false;\n          if (dataitems.length > 0) {\n            if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\n              dataitems[0].tag = self.keySentenceAddTag + newitemtext;\n              this.refresh();\n              isfound = true;\n              $(\"li\", this.list).removeClass(\"k-state-focused\");\n              $(\"li:first\", this.list).addClass(\"k-state-focused\");\n            }\n          }\n\n          if (!isfound) //Is found item with text \"Add new tag:\" ?\n            {\n              this.dataSource.insert(0, self.createEmptyTag(self.keySentenceAddTag, newitemtext));\n            }\n\n          if (this.dataSource.total() == 0) {\n            this.search();\n            this.open();\n            this.refresh();\n            $(\"li\", this.list).removeClass(\"k-state-focused\");\n            $(\"li:first\", this.list).addClass(\"k-state-focused\");\n          }\n        }\n      },\n      dataSource: tags,\n      dataTextField: \"tag\",\n      dataValueField: \"guid\",\n      filter: \"contains\",\n      animation: false }).\n    data(\"kendoMultiSelect\");\n  },\n\n  /**\r\n      * return a json with \"Add new tag\" message\r\n      * @param {*} keySentenceAddTag \r\n      * @param {*} newitemtext \r\n      * @returns \r\n      */\n  createEmptyTag: function createEmptyTag(keySentenceAddTag, newitemtext) {\n    return { tag: keySentenceAddTag + newitemtext, guid: \"\" };\n  },\n\n  initPluginTagsFilter: function initPluginTagsFilter() {\n    var self = this;\n    var $contentWidget = self.getContent();\n    return $(\"#ui-bizagi-wp-project-discussions-options-tags-filter\", $contentWidget).kendoMultiSelect({\n      change: function change() {\n        self.hideOrShowDiscussionsByFilter();\n      },\n      autoClose: false,\n      tagMode: \"single\",\n      dataTextField: \"tag\",\n      dataValueField: \"guid\" }).\n    data(\"kendoMultiSelect\");\n  },\n\n  hideOrShowDiscussionsByFilter: function hideOrShowDiscussionsByFilter() {\n    var self = this;\n    var valuesSelected = self.plugins.tagsFilter.value();\n    if (valuesSelected.length > 0) {\n      $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).hide();\n      valuesSelected.forEach(function (valueClass) {\n        $(\".ui-bizagi-wp-project-discussions-item.\" + valueClass, self.getContent()).show();\n      });\n    } else\n    {\n      $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).show();\n    }\n  },\n\n  validateAddCommentForm: function validateAddCommentForm($wrapperForm) {\n    var result = false;\n    var $textAreaComment = $(\"textarea\", $wrapperForm);\n    if ($textAreaComment.val().trim() === \"\") {\n      var commentValidation = bizagi.localization.getResource(\"workportal-project-discussion-requiredcomment\");\n      $textAreaComment.parent().next().find('span').html(commentValidation);\n    } else\n    {\n      $textAreaComment.parent().next().find('span').empty();\n      result = true;\n    }\n    return result;\n  },\n\n  validateAddDiscussionForm: function validateAddDiscussionForm($wrapperForm) {\n    var result = false;\n    var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", $wrapperForm);\n    var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", $wrapperForm);\n    if ($subjectDiscussion.val().trim() !== \"\" && $descriptionDiscussion.val().trim() !== \"\") {\n      result = true;\n    }\n    if ($subjectDiscussion.val().trim() === \"\") {\n      var subjectValidation = bizagi.localization.getResource(\"workportal-project-discussion-subjectrequired\");\n      $subjectDiscussion.parent().find(\"span\").html(subjectValidation);\n    } else\n    {\n      $subjectDiscussion.parent().find(\"span\").empty();\n    }\n    if ($descriptionDiscussion.val().trim() === \"\") {\n      var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\n      $descriptionDiscussion.parent().next().find(\"span\").html(descriptionValidation);\n    } else\n    {\n      $descriptionDiscussion.parent().next().find(\"span\").empty();\n    }\n\n    return result;\n  },\n\n  applyFileAttachments: function applyFileAttachments(type) {\n\n    var self = this;\n    var content = type === \"DISCUSSIONS\" ? self.plugins.popupDiscussion : self.getContent();\n\n    return $(\".ui-bizagi-wp-project-discussions-attachment-upload\", content).kendoProjectAttachments({\n      saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\n      template: self.getTemplate(\"project-attachments\"),\n      success: function success(event) {\n        self.onSuccessFile(event, type);\n      },\n      upload: $.proxy(self.addFileData, self),\n      dropZone: false,\n      extensions: self.supportFileExt,\n      maxSize: self.uploadMaxFilesSize }).\n    data(\"kendoProjectAttachments\");\n  },\n\n  addFileData: function addFileData(event) {\n\n    var uid = event.files[0].uid;\n\n    event.files[0].guid = uid;\n    event.data = {\n      guid: uid };\n\n  },\n\n\n  /*\r\n      *  Get data for discussions\r\n      */\n  getDataDiscussions: function getDataDiscussions() {\n\n    var self = this,\n    defer = $.Deferred();\n\n    var paramsGetDiscussions = {\n      globalParent: self.radNumber,\n      typeResource: self.typeResource };\n\n\n    if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\n      paramsGetDiscussions.globalParent = self.params.plan.id;\n    }\n\n    self.dataService.getDiscussionsData(paramsGetDiscussions).pipe(function (response) {\n      return self.callForListComments(response);\n    }).done(function (response) {\n      self.listDataDiscussion = self.sortDiscussions(response);\n      self.updateTemplateListDiscussion();\n      defer.resolve();\n    });\n    return defer.promise();\n  },\n\n  /*\r\n      *  Get data for users\r\n      */\n  getDataUsers: function getDataUsers(usersGuids) {\n    var self = this,\n    defer = $.Deferred();\n\n    var params = {\n      usersGuids: usersGuids,\n      width: 50,\n      height: 50 };\n\n\n    if (params.usersGuids) {\n      self.dataService.getUsersData(params).always(function (response) {\n\n        function arrayUnique(array) {\n          var a = array.concat();\n          for (var i = 0; i < a.length; ++i) {\n            for (var j = i + 1; j < a.length; ++j) {\n              if (a[i] === a[j]) {\n                a.splice(j--, 1);\n              }\n            }\n          }\n          return a;\n        }\n\n        self.userPictures = arrayUnique(self.userPictures.concat(response));\n        defer.resolve();\n      });\n    } else\n    {\n      defer.resolve();\n    }\n\n\n    return defer.promise();\n  },\n\n  /*\r\n      * Call list of comments by discussion\r\n      */\n  callForListComments: function callForListComments(discussions) {\n\n    var self = this,\n    generalDefer = $.Deferred(),\n    commentsDefer = [];\n\n    for (var i = 0, length = discussions.length - 1; i <= length; i++) {\n\n      self.addGlobalTags(discussions[i].tags, false);\n\n      var params = {\n        idParent: discussions[i].guid,\n        dateTime: self.getDateServer(),\n        count: 6 };\n\n\n      self.commentsList[params.idParent] = {\n        comments: [],\n        count: 0,\n        total: 0 };\n\n\n      var defer = $.when(self.dataService.getCommentsData(params)).done(function (response) {\n        if (response.length > 0) {\n          self.commentsList[response[0].parent] = {\n            comments: response,\n            count: response.length,\n            total: 0 };\n\n        }\n      });\n\n      commentsDefer.push(defer);\n    }\n\n    $.when.apply($, commentsDefer).done(function () {\n      generalDefer.resolve(discussions);\n    });\n\n    return generalDefer.promise();\n  },\n\n  sortDiscussions: function sortDiscussions(discussions) {\n    var sortedDiscussion = [];\n    if (discussions.length) {\n      sortedDiscussion = discussions.sort(function (a, b) {\n        var dateA = a.date;\n        var dateB = b.date;\n\n        return dateB - dateA;\n      });\n\n      if (sortedDiscussion.length > 0) {var\n        array_move = function array_move(arr, old_index, new_index) {\n          if (new_index >= arr.length) {\n            var k = new_index - arr.length + 1;\n            while (k--) {\n              arr.push(undefined);\n            }\n          }\n          arr.splice(new_index, 0, arr.splice(old_index, 1)[0]);\n          return arr;\n        };;\n        var positionDiscussion = -1;\n        for (var iDis = 0; iDis < sortedDiscussion.length; iDis++) {\n          if (sortedDiscussion[iDis].name === \"workportal-project-discussion-generaldiscussion\") {\n            positionDiscussion = iDis;\n            break;\n          }\n        }\n\n        if (positionDiscussion > 0) {\n          array_move(sortedDiscussion, positionDiscussion, 0);\n        }\n      }\n    }\n    return sortedDiscussion;\n  },\n\n  resetDiscussionAttachments: function resetDiscussionAttachments() {\n\n    var self = this;\n    var popupDiscussion = self.plugins.popupDiscussion;\n    $(\".ui-bizagi-wp-project-attachments-list\", popupDiscussion).empty();\n\n    self.plugins.tagsMultiSelect.value([]);\n\n    self.attchDiscussions.addition = [];\n    self.attchDiscussions.remove = [];\n    self.getDiscussions();\n  },\n\n  sendDataUpdateDiscussion: function sendDataUpdateDiscussion(guid) {\n\n    var self = this;\n    var filesObj = self.prepareFilesToSave();\n    self.form.buttonAddDiscussion.prop(\"disabled\", true);\n\n    var tagsDiscussion = self.getTagsDiscussionBySave();\n    var guidsTagsDiscussionToDelete = self.getGuidsTagsDiscussionToDelete();\n\n    var params = {\n      content: {\n        name: self.form.subject.val(),\n        description: self.form.description.val(),\n        globalParent: self.radNumber.toString(),\n        user: bizagi.currentUser.idUser,\n        attachments: filesObj.attachments,\n        guid: guid,\n        tags: tagsDiscussion,\n        typeResource: \"DiscussionGuid\",\n        general: false,\n        date: self.getDateServer() },\n\n      attachmentsToCreate: filesObj.attachmentsToCreate,\n      attachmentsToDelete: filesObj.attachmentsToDelete };\n\n\n    self.plugins.attchDiscussions.close();\n\n    self.dataService.editDiscussion(params).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n        self.addGlobalTags(tagsDiscussion, true);\n\n        var discussion = self.getDiscussionDataByGUID(guid);\n        discussion.name = params.content.name;\n        discussion.description = params.content.description;\n        discussion.attachments = params.content.attachments;\n        discussion.tags = params.content.tags;\n\n        self.onClosePopupDiscussion();\n\n        self.resetDiscussionAttachments();\n        self.updateTemplateListDiscussion();\n\n        self.removeGlobalTags(guidsTagsDiscussionToDelete);\n\n        self.notifier.showSucessMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-edited\"), \"\"));\n      } else {\n\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\n\n        self.onClosePopupDiscussion();\n        self.notifier.showErrorMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-error-edition\"), \"\"));\n      }\n\n\n      self.renderUserProfilesAndImages();\n\n      self.setClassesTagsByDiscussion();\n      self.hideOrShowDiscussionsByFilter();\n    });\n\n  },\n  validateStringIsGuid: function validateStringIsGuid(value) {\n    var validGuid = /^({|()?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}(}|))?$/;\n    var emptyGuid = /^({|()?0{8}-(0{4}-){3}0{12}(}|))?$/;\n    return validGuid.test(value) && !emptyGuid.test(value);\n  },\n\n  sendDataInsertDiscussion: function sendDataInsertDiscussion(guid) {\n\n    var self = this;\n    var filesObj = self.prepareFilesToSave();\n\n    self.form.buttonAddDiscussion.prop(\"disabled\", true);\n\n    var tagsDiscussion = self.getTagsDiscussionBySave();\n\n    var params = {\n      content: {\n        name: self.form.subject.val(),\n        description: self.form.description.val(),\n        globalParent: self.radNumber.toString(),\n        user: bizagi.currentUser.idUser,\n        attachments: filesObj.attachments,\n        guid: guid,\n        tags: tagsDiscussion,\n        typeResource: \"DiscussionGuid\",\n        general: false,\n        date: self.getDateServer() },\n\n      attachmentsToCreate: filesObj.attachmentsToCreate,\n      attachmentsToDelete: filesObj.attachmentsToDelete };\n\n\n    self.plugins.attchDiscussions.close();\n\n    self.dataService.postDiscussion(params).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n\n        self.addGlobalTags(tagsDiscussion, true);\n\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\n\n        var newDiscussion = {\n          \"name\": params.content.name,\n          \"description\": params.content.description,\n          \"date\": params.content.date,\n          \"user\": params.content.user,\n          \"attachments\": params.content.attachments,\n          \"radNumber\": params.content.globalParent,\n          \"general\": params.content.general,\n          \"guid\": params.content.guid,\n          \"tags\": params.content.tags,\n          \"typeResource\": params.content.typeResource };\n\n\n        self.commentsList[params.content.guid] = {\n          comments: [],\n          count: 0,\n          total: 0 };\n\n\n        if (self.listDataDiscussion.length === 0) {//Add first discussion\n          self.listDataDiscussion.push(newDiscussion);\n        } else\n        {//Add discussion in position 1\n          self.listDataDiscussion.splice(1, 0, newDiscussion);\n        }\n\n        self.resetDiscussionAttachments();\n        self.onClosePopupDiscussion();\n        self.notifier.showSucessMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-created\"), \"\"));\n        self.updateTemplateListDiscussion();\n        self.updateDiscussionsMenu(true);\n      } else\n      {\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\n        self.onClosePopupDiscussion();\n        self.notifier.showErrorMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-error-creation\"), \"\"));\n      }\n\n      self.renderUserProfilesAndImages();\n\n      self.setClassesTagsByDiscussion();\n      self.hideOrShowDiscussionsByFilter();\n    });\n  },\n\n  /**\r\n      * Notify that discussions Icon shoul be updated\r\n      * @param {*} hasDiscussionsOrComment \r\n      */\n  updateDiscussionsMenu: function updateDiscussionsMenu(hasDiscussionsOrComment) {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"UPDATE_DISCUSSIONS_MENU_STATUS\",\n      hasDiscussionsOrComment: hasDiscussionsOrComment });\n\n  },\n  getTagsDiscussionBySave: function getTagsDiscussionBySave() {\n    var self = this;\n    var tagsTextSelected = self.plugins.tagsMultiSelect.value();\n    var dataSourceTags = self.plugins.tagsMultiSelect.dataSource.data();\n\n    var tagsDiscussion = [];\n    tagsTextSelected.forEach(function (tagTextSelected) {\n      var isGuidTextSelected = self.validateStringIsGuid(tagTextSelected);\n\n      var tagFound;\n      if (isGuidTextSelected) {\n        tagFound = dataSourceTags.filter(function (tagSource) {\n          return tagSource.guid === tagTextSelected;\n        });\n      } else\n      {\n        tagFound = dataSourceTags.filter(function (tagSource) {\n          var isGuid = self.validateStringIsGuid(tagSource.guid);\n          return tagSource.tag === tagTextSelected && !isGuid;\n        });\n      }\n\n      if (tagFound.length === 1) {\n        tagsDiscussion.push({\n          guid: isGuidTextSelected ? tagFound[0].guid : tagFound[0].uid,\n          tag: tagFound[0].tag });\n\n      }\n\n    });\n\n    return tagsDiscussion;\n  },\n\n  //b: minuendo, a: sustraendo\n  differenceArrays: function differenceArrays(b, a) {\n    return b.filter(function (i) {\n      return a.indexOf(i) < 0;\n    });\n  },\n\n  getGuidsTagsDiscussionToDelete: function getGuidsTagsDiscussionToDelete() {\n    var self = this;\n    var guidsTagsCurrentDiscussion = self.plugins.tagsMultiSelect.value();\n    return self.differenceArrays(self.tempTagsBeforeDelete, guidsTagsCurrentDiscussion);\n  },\n\n  /*\r\n      *   UI Functions\r\n      */\n  setStateUIShowMoreComments: function setStateUIShowMoreComments($commentsContainer, state) {\n    var $containerButtonMoreComments = $commentsContainer.siblings(\".ui-bizagi-wp-project-discussion-showmore-comments\");\n    var $buttonShowMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-comments-button\");\n    var $messageNoMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-no-more-comments\");\n    var $messageLoadingComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-loading-comments\");\n\n    if (state === \"ALLOW_MORE_COMMENTS\") {\n      $buttonShowMoreComments.show();\n      $messageNoMoreComments.hide();\n      $messageLoadingComments.hide();\n    }\n\n    if (state === \"LOADING_MORE_COMMENTS\") {\n      $buttonShowMoreComments.hide();\n      $messageNoMoreComments.hide();\n      $messageLoadingComments.show();\n    }\n\n    if (state === \"NO_MORE_COMMENTS\") {\n      $buttonShowMoreComments.hide();\n      $messageNoMoreComments.show();\n      $messageLoadingComments.hide();\n    }\n  },\n\n  getCurrentUserInfo: function getCurrentUserInfo() {\n    return {\n      name: bizagi.currentUser.userName,\n      id: bizagi.currentUser.idUser,\n      picture: \"\" };\n\n  },\n\n  /*Functions about tags*/\n\n  addGlobalTags: function addGlobalTags(tagsDiscussion, createTagsOnServer) {\n    var self = this;\n\n    for (var iTagAdd = 0; iTagAdd < tagsDiscussion.length; iTagAdd += 1) {\n      var existTag = self.globalTags.filter(function (tagGlobal) {\n        return tagGlobal.tag === tagsDiscussion[iTagAdd].tag;\n      });\n      if (existTag.length === 0) {\n        tagsDiscussion[iTagAdd].globalParent = self.radNumber;\n        self.globalTags.push(tagsDiscussion[iTagAdd]);\n        if (createTagsOnServer) {\n          self.dataService.postTag(tagsDiscussion[iTagAdd]);\n        }\n      }\n    }\n\n    //Sync tags\n    self.plugins.tagsFilter.dataSource.data(self.globalTags);\n    self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\n  },\n\n  removeGlobalTags: function removeGlobalTags(guidTagsToDelete) {\n    var self = this;\n    var allGuidsTagsAllDiscussions = $.map(self.listDataDiscussion, function (discussion) {\n      return $.map(discussion.tags, function (itemTag) {\n        return itemTag.guid;\n      });\n    });\n\n    var allGuidsMoreGuidsDelete = allGuidsTagsAllDiscussions.concat(guidTagsToDelete);\n\n    var secureGuidsForDelete = [];\n    guidTagsToDelete.forEach(function (guidDelete) {\n      var existGuidOnlyTimeThenDelete = allGuidsMoreGuidsDelete.filter(function (guid) {\n        return guid === guidDelete;\n      });\n      if (existGuidOnlyTimeThenDelete.length === 1) {\n        secureGuidsForDelete.push(guidDelete);\n      }\n    });\n\n\n    secureGuidsForDelete.forEach(function (guidSecureDelete) {\n      //delete with service\n      var params = { idTag: guidSecureDelete };\n      self.dataService.deleteTag(params);\n\n      //delete globalTags\n      for (var iTagGlobal = self.globalTags.length - 1; iTagGlobal >= 0; iTagGlobal -= 1) {\n        if (self.globalTags[iTagGlobal].guid === guidSecureDelete) {\n          self.globalTags.splice(iTagGlobal, 1);\n        }\n      }\n    });\n\n    //Sync tags\n    self.plugins.tagsFilter.dataSource.data(self.globalTags);\n    self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\n  },\n\n  setClassesTagsByDiscussion: function setClassesTagsByDiscussion() {\n    var self = this;\n    for (var iDiscussion = 0; iDiscussion < self.listDataDiscussion.length; iDiscussion += 1) {\n      var textTagsDiscussion = $.map(self.listDataDiscussion[iDiscussion].tags, function (itemTag) {\n        return itemTag.guid;\n      });\n      var tagsBySpace = textTagsDiscussion.join(\" \");\n\n      $(\".ui-bizagi-wp-project-discussions-item[data-guid='\" + self.listDataDiscussion[iDiscussion].guid + \"']\", self.getContent()).addClass(tagsBySpace);\n    }\n  },\n\n  updateTemplateListDiscussion: function updateTemplateListDiscussion() {\n\n    var self = this;\n    var $contentWidget = self.getContent();\n    var templateListDiscussions = self.getTemplate(\"project-discussions-list\");\n    var user = self.getCurrentUserInfo();\n    var contentRenderListDiscussions = templateListDiscussions.render({\n      listDataDiscussions: self.listDataDiscussion,\n      user: user,\n      isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\n      returnServedCommentByParentId: function returnServedCommentByParentId(parentId) {\n        return self.returnServedCommentByParentId(parentId);\n      } });\n\n    for (var i = 0; i < this.listDataDiscussion.length; i++) {\n      this.mapTempComments($(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"),\n      contentRenderListDiscussions.find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"));\n    }\n    $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).empty().append(contentRenderListDiscussions);\n\n    self.plugins.attchComments = self.applyFileAttachments(\"COMMENTS\");\n  },\n\n  showFormAddDiscussion: function showFormAddDiscussion(resourceTitlePopup) {\n    var self = this;\n\n    if (self.plugins.attchComments) {\n      self.plugins.attchComments.close();\n    }\n    self.dialogBoxDiscussion.formContent.dialog({\n      resizable: false,\n      draggable: false,\n      height: \"auto\",\n      width: \"650px\",\n      modal: true,\n      zIndex: 1,\n      title: bizagi.localization.getResource(resourceTitlePopup),\n      maximize: true,\n      open: $.proxy(self.onOpenPopupDiscussion, self),\n      close: function close() {\n        self.resetDiscussionAttachments();\n        self.onClosePopupDiscussion();\n      } });\n\n  },\n\n  resetFormDiscussion: function resetFormDiscussion() {\n    var self = this;\n\n    self.form.buttonAddDiscussion.prop(\"disabled\", false);\n    self.form.subject.val(\"\");\n    self.form.description.val(\"\");\n\n    var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", self.dialogBoxDiscussion.formContent);\n    var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", self.dialogBoxDiscussion.formContent);\n    $subjectDiscussion.parent().find(\"span\").empty();\n    $descriptionDiscussion.parent().next().find(\"span\").empty();\n  },\n\n  renderUserProfile: function renderUserProfile() {\n    var self = this;\n\n    var userPicture = $.grep(self.userPictures, function (userPicture) {\n      return userPicture.id === bizagi.currentUser.idUser;\n    })[0];\n\n    var base64Prefix = \"data:image/png;base64,\";\n    var $parent = $(\".ui-bizagi-wp-project-popupform-user\");\n    var $img = $parent.find(\".bz-wp-avatar-img\");\n    var $text = $parent.find(\".bz-wp-avatar-label\");\n\n    if (userPicture) {\n      if (userPicture.picture) {\n        $img.attr(\"src\", base64Prefix + userPicture.picture);\n      } else {\n        $img.hide();\n        $text.html(userPicture.name.getInitials()).show();\n      }\n    }\n  },\n\n  renderUserProfilesAndImages: function renderUserProfilesAndImages() {\n    var self = this;\n\n    var userPicture = $.grep(self.userPictures, function (userPicture) {\n      return userPicture.id === bizagi.currentUser.idUser;\n    })[0];\n\n    var base64Prefix = \"data:image/png;base64,\";\n\n    if (userPicture) {\n      $(\".ui-bizagi-wp-project-discussions-create-comment .bz-wp-discussion-username\").html(userPicture.name);\n      if (userPicture.picture) {\n        $(\".ui-bizagi-wp-project-discussions-item-user img\").attr(\"src\", base64Prefix + userPicture.picture);\n        $(\".ui-bizagi-wp-project-popupform-image-current-user\").attr(\"src\", base64Prefix + userPicture.picture);\n      } else {\n        $(\".ui-bizagi-wp-project-discussions-item-user label.bz-wp-avatar-label\").html(userPicture.name.getInitials()).show();\n        $(\".ui-bizagi-wp-project-discussions-item-user img\").hide();\n      }\n    }\n\n    for (var iUser = 0; iUser < self.userPictures.length; iUser++) {\n      $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-discussion-username\").html(self.userPictures[iUser].name);\n      if (self.userPictures[iUser].picture) {\n        $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").attr(\"src\", base64Prefix + self.userPictures[iUser].picture);\n      } else {\n        $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").hide();\n        $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] label.bz-wp-avatar-label\").html(self.userPictures[iUser].name.getInitials());\n      }\n    }\n  },\n\n  /*EVENTS*/\n  switchCommentsEvents: function switchCommentsEvents(event) {\n\n    var self = this;\n    var $target = $(event.target);\n    var $parent = $target.parent();\n\n    if ($target.is(\"textarea\")) {\n      self.onShowButtonsPanel($target);\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-cancel\")) {\n\n      self.onCancelComment($target);\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-share\")) {\n\n      var $container = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\n      if (self.validateAddCommentForm($container)) {\n        var guid = Math.guid();\n        self.onCreateComment($target, guid);\n      }\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-view\")) {\n      self.onViewComment($target);\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussion-showmore-comments-button\")) {\n      self.onViewMoreComments($target);\n    } else if ($target.hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\n      self.onRemoveFiles($target);\n    } else if ($parent.hasClass(\"biz-wp-user-icon-admin\") && $parent.hasClass(\"biz-wp-action-edit-discussion\")) {\n      self.onEditDiscussion($target);\n    } else if ($parent.hasClass(\"ui-bizagi-wp-project-discussion-delete\")) {\n\n      $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-discussion-querydelete\"), \"\", \"info\")).done(function () {\n        self.onDeleteComment($parent);\n      });\n\n    } else if ($parent.hasClass(\"bz-bizagi-wp-project-discussions-attachment-itemwrapper\")) {\n      self.onDownloadAttachment($target.closest(\"li\"));\n    }\n\n    event.stopPropagation();\n  },\n\n  onEditDiscussion: function onEditDiscussion($target) {\n\n    var self = this;\n    var $discussionCnt = $target.closest(\".ui-bizagi-wp-project-discussions-item\");\n    var guid = $discussionCnt.data(\"guid\");\n\n    self.setDiscussionsDataByGUID(guid);\n    self.showFormAddDiscussion(\"workportal-project-discussion-edit\");\n  },\n\n  setDiscussionsDataByGUID: function setDiscussionsDataByGUID(guid) {\n\n    var self = this;\n\n    var discussion = self.getDiscussionDataByGUID(guid);\n    var $container = $(\".ui-bizagi-wp-project-attachments-list\", self.form.attachments);\n\n    self.form.edition = {\n      guid: guid };\n\n\n    self.attchDiscussions = {\n      addition: discussion.attachments,\n      remove: [] };\n\n\n    self.form.title.text(bizagi.localization.getResource(\"workportal-project-discussion-edit\"));\n    self.form.subject.val(discussion.name);\n    self.form.description.val(discussion.description);\n\n    var guidTagsDiscussion = $.map(discussion.tags, function (itemTag) {\n      return itemTag.guid;\n    });\n    self.plugins.tagsMultiSelect.value(guidTagsDiscussion);\n    self.tempTagsBeforeDelete = [];\n    self.tempTagsBeforeDelete = self.tempTagsBeforeDelete.concat(self.plugins.tagsMultiSelect.value());\n\n    self.renderAttachments(discussion.attachments, \"DISCUSSIONS\", $container);\n\n  },\n\n  getDiscussionDataByGUID: function getDiscussionDataByGUID(guid) {\n\n    var self = this;\n    var discussion;\n\n    for (var i = self.listDataDiscussion.length - 1; i >= 0; i--) {\n      if (self.listDataDiscussion[i].guid === guid) {\n        discussion = self.listDataDiscussion[i];\n        i = 0;\n      }\n    }\n\n    return discussion;\n  },\n\n  onViewComment: function onViewComment($target) {\n    var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-comment-truncatewrapper\");\n    $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-shortcomment\");\n    $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-longcomment\");\n  },\n\n  onViewMoreComments: function onViewMoreComments($target) {\n    var self = this;\n    var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussion-showmore-comments\");\n    var $commentsContainer = $commentWrapper.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\n    var idParent = $commentsContainer.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\n\n    if (!self.commentsList[idParent].total) {\n      //only one time call service if total is null\n      self.dataService.getCommentsCountByParent(idParent).done(function (response) {\n        self.commentsList[idParent].total = response.count;\n        self.getMoreComments(idParent, $commentsContainer);\n      });\n    } else\n    {\n      self.getMoreComments(idParent, $commentsContainer);\n    }\n  },\n\n  getMoreComments: function getMoreComments(idParent, $commentsContainer) {\n    var self = this;\n\n    //validate total comments vs count comments\n    if (self.commentsList[idParent].total > self.commentsList[idParent].comments.length) {\n\n      self.setStateUIShowMoreComments($commentsContainer, \"LOADING_MORE_COMMENTS\");\n\n      var dateLastComment;\n      if (self.commentsList[idParent].comments.length === 0) {\n        dateLastComment = self.getDateServer();\n      } else\n      {\n        dateLastComment = self.commentsList[idParent].comments[self.commentsList[idParent].comments.length - 1].date;\n      }\n\n      //substract one millisecond\n      dateLastComment -= 1;\n\n      self.dataService.getCommentsData(\n      {\n        dateTime: dateLastComment,\n        idParent: idParent,\n        count: 6 }).\n\n      done(function (responseMoreComments) {\n\n        if (responseMoreComments.length) {\n          Array.prototype.push.apply(self.commentsList[idParent].comments, responseMoreComments);\n          self.commentsList[idParent].count += responseMoreComments.length;\n\n          self.renderCommentByDiscussion($commentsContainer, idParent, responseMoreComments);\n          self.renderUserProfilesAndImages();\n\n          if (responseMoreComments.length > 5) {\n            self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\n          } else {\n            self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\n          }\n\n          //Get profiles of idUsers not download in this moment\n          var idUsersLoaded = $.map(self.userPictures, function (element) {\n            return element.id;\n          });\n\n          var idUsersNewComments = $.map(self.commentsList, function (property) {\n            return $.map(property.comments, function (property) {\n              return property.user;\n            });\n          });\n\n          var arrayIdUsersMissingLoad = $(idUsersNewComments).not(idUsersLoaded).get();\n          var csvIdUsersMissingLoad = arrayIdUsersMissingLoad.join(\",\");\n\n          self.getDataUsers(csvIdUsersMissingLoad).then(function () {\n            self.renderUserProfilesAndImages();\n          });\n\n        } else\n        {\n          self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\n        }\n      }).fail(function () {\n        self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\n      });\n    } else\n    {\n      self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\n    }\n\n  },\n\n  renderCommentByDiscussion: function renderCommentByDiscussion($container, guidParent, moreComments) {\n\n    var self = this,\n    tmplComment = self.getTemplate(\"project-discussions-comments\"),\n    $commentsDOM,\n    renderObject = {\n      comments: [],\n      user: self.getCurrentUserInfo(),\n      isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) };\n\n\n    if (!moreComments.length) {\n      renderObject.comments = self.commentsList[guidParent].comments;\n      $commentsDOM = tmplComment.render(renderObject);\n      $container.html($commentsDOM);\n    } else {\n      renderObject.comments = moreComments;\n      $commentsDOM = tmplComment.render(renderObject);\n      $container.append($commentsDOM);\n    }\n  },\n\n  getCommentByGuid: function getCommentByGuid(parentGuid, commentGuid) {\n\n    var self = this;\n    var commentsList = self.commentsList[parentGuid].comments;\n\n    for (var i = 0, length = commentsList.length; i < length; i++) {\n\n      if (commentsList[i].guid === commentGuid) {\n        var attachments = [];\n\n        for (var x = 0, lengthx = commentsList[i].attachments.length; x < lengthx; x++) {\n          attachments.push(commentsList[i].attachments[x].guid);\n        }\n\n        return {\n          attachments: attachments,\n          index: i };\n\n      }\n    }\n\n    return {};\n  },\n\n  returnServedCommentByParentId: function returnServedCommentByParentId(parentId) {\n    var self = this;\n\n    if (typeof self.commentsList[parentId] !== \"undefined\") {\n      return self.commentsList[parentId];\n    }\n  },\n\n  /*\r\n      *   Events\r\n      */\n  onShowButtonsPanel: function onShowButtonsPanel($target) {\n    var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\").find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\n    $buttonsWrp.show();\n  },\n\n  onRemoveFiles: function onRemoveFiles($target) {\n    var self = this;\n    var $container = $target.closest(\"li\"),\n    type = $container.closest(\".ui-bizagi-wp-project-attachments-list\").data(\"type\"),\n    fileGuid = $container.data(\"fileguid\");\n    var currentFiles, removeFiles, tmpSplice;\n\n    if (type === \"COMMENT\") {\n      var guid = $container.closest(\".ui-bizagi-wp-project-discussions-add-comment\").data(\"guid\");\n      currentFiles = self.attchComments[guid].addition;\n      removeFiles = self.attchComments[guid].remove;\n\n    } else {\n      currentFiles = self.attchDiscussions.addition;\n      removeFiles = self.attchDiscussions.remove;\n    }\n\n    for (var i = 0, length = currentFiles.length - 1; i <= length; i++) {\n\n      if (currentFiles[i].guid === fileGuid) {\n        tmpSplice = currentFiles.splice(i, 1);\n        removeFiles.push(tmpSplice[0].guid);\n        i = length;\n      }\n    }\n\n    $container.remove();\n  },\n\n  onDeleteComment: function onDeleteComment($target) {\n    var self = this;\n    var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\n    var commentGuid = $commentWrapper.data(\"cmmtguid\");\n    var parentGuid = $commentWrapper.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\n    var comment = self.getCommentByGuid(parentGuid, commentGuid);\n\n    var params = {\n      content: {\n        guid: commentGuid },\n\n      attachmentsToDelete: comment.attachments };\n\n\n    $.when(self.dataService.deleteComment(params)).always(function (response) {\n      if (response.status === 200 || typeof response.status === \"undefined\") {\n        self.commentsList[parentGuid].comments.splice(comment.index, 1);\n        $commentWrapper.remove();\n\n        var hasDiscussionsOrComment = self.hasDiscussionsOrComment(self.commentsList);\n        self.updateDiscussionsMenu(hasDiscussionsOrComment);\n      } else {\n        self.notifier.showErrorMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-errordelete\"), \"\"));\n      }\n    });\n  },\n\n  hasDiscussionsOrComment: function hasDiscussionsOrComment(comments) {\n    var keys = Object.keys(comments);\n    var haveDiscussions = keys.length > 1;\n    var haveComments = false;\n    for (var i = 0; i < keys.length; i++) {\n      if (comments[keys[i]].comments.length > 0) {\n        haveComments = true;\n        break;\n      }\n    }\n    return haveDiscussions || haveComments;\n  },\n\n  onSuccessFile: function onSuccessFile(event, type) {\n    var self = this;\n    var files = event.files;\n    var status = event.XMLHttpRequest.response ? JSON.parse(event.XMLHttpRequest.response) : {};\n\n    if (!status.error) {\n      var $wrapper = $(event.sender.element).closest(\".ui-bizagi-wp-project-discussion-textwrapper\");\n      var $container = $wrapper.find(\".ui-bizagi-wp-project-attachments-list\");\n\n      if (type === \"DISCUSSIONS\") {\n        self.plugins.attchDiscussions.setStatus(\"SUCCESS\", files[0].guid);\n        Array.prototype.push.apply(self.attchDiscussions.addition, files);\n      } else {\n        self.plugins.attchComments.setStatus(\"SUCCESS\", files[0].guid);\n        var guid = $wrapper.data(\"guid\");\n\n        if (self.attchComments[guid]) {\n          Array.prototype.push.apply(self.attchComments[guid].addition, files);\n        } else {\n          self.attchComments[guid] = {\n            addition: files,\n            remove: [] };\n\n        }\n\n        self.onShowButtonsPanel($container.parent());\n      }\n\n      self.renderAttachments(files, type, $container);\n    } else {\n\n      if (type === \"DISCUSSIONS\") {\n        self.plugins.attchDiscussions.onErrorFile(event);\n      } else {\n        self.plugins.attchComments.onErrorFile(event);\n      }\n    }\n  },\n\n  onDownloadAttachment: function onDownloadAttachment($liTarget) {\n    var self = this;\n    var guidAttachment = $liTarget.data(\"fileguid\");\n\n    if (guidAttachment !== \"\") {\n      var nameFile = $liTarget.find(\".bz-bizagi-wp-project-discussions-attachment-filename\").text();\n      self.dataService.getDownloadAttachment(guidAttachment, nameFile);\n    }\n  },\n\n  onCancelComment: function onCancelComment($target) {\n    var self = this;\n    var $commentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\n    var $buttonsWrp = $commentContainer.find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\n    var $textarea = $commentContainer.find(\"textarea\");\n    var $uploadForm = $commentContainer.find(\".ui-bizagi-wp-project-discussions-add-attachments form\");\n    var $vlTooltip = $commentContainer.find(\".k-tooltip-validation\");\n    var $fileList = $commentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\n    var guid = $commentContainer.data(\"guid\");\n\n    self.attchComments[guid] = {\n      addition: [],\n      remove: [] };\n\n\n    self.plugins.attchComments.cancelFilesUpload();\n\n    $uploadForm[0].reset();\n    $fileList.empty();\n    $textarea.val(\"\");\n    $vlTooltip.hide();\n    $buttonsWrp.hide();\n  },\n\n  onCreateComment: function onCreateComment($target, guid) {\n    var self = this;\n    var $rplWrp = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\n    var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\n    var $addCommentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\n    var $textarea = $addCommentContainer.find(\"textarea\");\n    var $uploadList = $addCommentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\n    var idParent = $addCommentContainer.data(\"guid\");\n    var filesObj = self.prepareFilesToSave(\"COMMENTS\", idParent);\n\n    var params = {\n      content: {\n        guid: guid,\n        attachments: filesObj.attachments,\n        text: $textarea.val(),\n        parent: idParent,\n        date: self.getDateServer(),\n        user: bizagi.currentUser.idUser },\n\n      attachmentsToCreate: filesObj.attachmentsToCreate,\n      attachmentsToDelete: filesObj.attachmentsToDelete };\n\n\n    $.when(self.dataService.postComment(params)).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n        var $commentContainer = $rplWrp.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\n        var newComment = {\n          user: params.content.user,\n          attachments: params.content.attachments,\n          text: params.content.text,\n          guid: params.content.guid,\n          parent: params.content.parent,\n          date: params.content.date };\n\n\n        //reset for a new comment\n        self.attchComments[params.content.parent] = {\n          addition: [],\n          remove: [] };\n\n\n        $textarea.val(\"\");\n        $uploadList.empty();\n        $buttonsWrp.hide();\n\n        //Add new comment to the list\n        self.commentsList[newComment.parent].comments.unshift(newComment);\n        self.renderCommentByDiscussion($commentContainer, newComment.parent, []);\n\n        self.plugins.attchComments.close();\n        self.renderUserProfilesAndImages();\n        self.updateDiscussionsMenu(true);\n      }\n    });\n  },\n\n  renderAttachments: function renderAttachments(files, type, $container) {\n    var self = this;\n    var attachTemplate = self.getTemplate(\"project-discussions-attachments\");\n\n    var $fileList = attachTemplate.render({ attachments: files, type: type });\n    $container.append($fileList);\n    if (bizagi.util.isIE()) {//\"shake\" files container for IE error\n      $(\".ui-bizagi-wp-project-attachments-list li\").hide(10, function () {\n        $(this).show();\n      });\n    }\n  },\n\n  prepareFilesToSave: function prepareFilesToSave(type, guid) {\n\n    var self = this;\n    var files = [],\n    fileList = type === \"COMMENTS\" ? self.attchComments[guid] : self.attchDiscussions,\n    attachmentsToCreate = [];\n\n    fileList = fileList || { addition: [], remove: [] };\n\n    for (var i = 0, length = fileList.addition.length - 1; i <= length; i++) {\n      files.push({\n        guid: fileList.addition[i].guid,\n        name: fileList.addition[i].name });\n\n\n      attachmentsToCreate.push(fileList.addition[i].guid);\n    }\n\n    return {\n      attachments: files,\n      attachmentsToCreate: attachmentsToCreate,\n      attachmentsToDelete: fileList.remove };\n\n  },\n\n  onClickCancel: function onClickCancel(event) {\n    event.preventDefault();\n    var self = this;\n\n    self.resetDiscussionAttachments();\n    self.onClosePopupDiscussion();\n\n    self.plugins.attchDiscussions.cancelFilesUpload();\n  },\n\n  onClosePopupDiscussion: function onClosePopupDiscussion() {\n    var self = this;\n    self.resetFormDiscussion();\n    self.plugins.attchDiscussions.destroy();\n    self.dialogBoxDiscussion.formContent.dialog(\"destroy\");\n    self.dialogBoxDiscussion.formContent.detach();\n  },\n\n  onOpenPopupDiscussion: function onOpenPopupDiscussion() {\n    var self = this;\n\n    self.plugins.attchDiscussions = self.applyFileAttachments(\"DISCUSSIONS\");\n\n    //popup\n    self.dialogBoxDiscussion.formContent.parent().css(\"z-index\", 10001);\n    //overlay\n    self.dialogBoxDiscussion.formContent.parent().parent().find(\".ui-widget-overlay\").css(\"z-index\", 10001);\n\n    setTimeout(function () {\n      self.form.subject.focus();\n    }, 50);\n  },\n\n  onSubmitFormDiscussion: function onSubmitFormDiscussion(event) {\n    event.preventDefault();\n\n    var self = this;\n    var guid;\n    if (self.validateAddDiscussionForm(self.dialogBoxDiscussion.formContent)) {\n      if (self.form.edition.guid) {\n        guid = self.form.edition.guid;\n        $.proxy(self.sendDataUpdateDiscussion(guid), self);\n      } else {\n        guid = Math.guid();\n        $.proxy(self.sendDataInsertDiscussion(guid), self);\n      }\n    }\n  },\n\n  restrictedEventsHandler: function restrictedEventsHandler() {\n    var self = this;\n    var $contentWidget = self.getContent();\n\n    $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\", \".bz-bizagi-wp-project-discussions-attachment-itemwrapper\", $.proxy(self.switchCommentsEvents, self));\n  },\n\n  eventsHandler: function eventsHandler() {\n    var self = this;\n    var $contentWidget = self.getContent();\n\n    //Add events\n    self.form.buttonShowFormNewDiscussion.on(\"click\", $.proxy(self.onNotifyOpenPopup, self));\n    self.form.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\n    self.form.buttonAddDiscussion.on(\"click\", $.proxy(self.onSubmitFormDiscussion, self));\n    self.form.attachments.on(\"click\", \".bz-bizagi-wp-project-discussions-attachment-delete, .bz-bizagi-wp-project-discussions-attachment-itemwrapper\", function (event) {\n\n      if ($(event.target).hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\n        self.onRemoveFiles($(event.target));\n      } else {\n        self.onDownloadAttachment($(event.target).closest(\"li\"));\n      }\n\n      event.stopPropagation();\n    });\n\n    $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\", \".ui-bizagi-wp-project-discussions-add-comment textarea\" +\n    \", .ui-bizagi-wp-project-discussions-comment-buttons-cancel\" +\n    \", .ui-bizagi-wp-project-discussions-comment-buttons-share\" +\n    \", .ui-bizagi-wp-project-discussion-showmore-comments button\" +\n    \", .bz-bizagi-wp-project-discussions-attachment-delete\" +\n    \", .ui-bizagi-wp-project-discussion-delete\" +\n    \", .bz-bizagi-wp-project-discussions-attachment-itemwrapper\" +\n    \", .ui-bizagi-wp-project-discussions-comment-view\" +\n    \", .ui-bizagi-wp-project-discussions-items-edition\" +\n    \", .biz-wp-action-edit-discussion\", $.proxy(self.switchCommentsEvents, self));\n\n    self.sub(\"changeProjectWidget\", function () {\n      self.resetWidget();\n    });\n    self.sub(\"OPEN_POPUP_DISCUSSION\", $.proxy(self.onNotifyOpenPopup, self));\n  },\n\n  resetWidget: function resetWidget() {\n    var self = this;\n    self.userPictures = [];\n    if (self.plugins.attchComments) {\n      self.plugins.attchComments.close();\n    }\n  },\n\n  clean: function clean() {\n\n    var self = this;\n    self.resetWidget();\n\n    if (self.form && self.form.buttonShowFormNewDiscussion) {\n      self.form.buttonShowFormNewDiscussion.off(\"click\", $.proxy(self.onNotifyOpenPopup, self));\n    }\n\n\n    for (var i in self.plugins) {\n      if (self.plugins[i] && self.plugins[i].hasOwnProperty(\"destroy\")) {\n        if (self.plugins[i].destroy) {\n          self.plugins[i].destroy();\n        }\n      }\n    }\n  },\n\n  mapTempComments: function mapTempComments($source, $target) {\n    var $textareaSource = $source.find(\"textarea\");\n    var $textareaTarget = $target.find(\"textarea\");\n    var $uploadListSource = $source.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\n    var $uploadListTarget = $target.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\n    $textareaTarget.val($textareaSource.val());\n    $uploadListTarget.empty().append($uploadListSource.html());\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.discussions\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.discussions], true);","/*\r\n *   Name: Bizagi Workportal project Plan Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.sidebar\", {}, {\n\n  /*\r\n                                                                                                       *   Constructor\r\n                                                                                                       */\n  init: function init(workportalFacade, dataService, serviceloadDataPlan, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.serviceloadDataPlan = serviceloadDataPlan;\n    self.params = params || {};\n    params.supportNav = false;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-plan-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.plan.sidebar\").concat(\"#project-plan-sidebar\") });\n\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    var template = self.getTemplate(\"project-plan-sidebar\");\n    self.content = template.render({});\n    $.when(self.areTemplatedLoaded()).\n    done(function () {\n      var params = { idPlan: self.params.plan.id };\n      if (self.params.planChild && self.params.planChild.id) {\n        params.idPlan = self.params.planChild.id;\n      }\n      self.serviceloadDataPlan.loadData(params, self.getDateServer, self.params);\n      self.serviceloadDataPlan.subscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\n      self.serviceloadDataPlan.subscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\n    });\n    return self.content;\n  },\n\n  loadedWithDataActivities: function loadedWithDataActivities() {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"LOADED_ACTIVITIES_PLAN\",\n      args: self.params });\n\n    self.pub(\"notify\", {\n      type: \"UPDATE_INFO_PLAN\",\n      args: self.params });\n\n    self.pub(\"notify\", {\n      type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\n      args: self.params });\n\n    self.pub(\"notify\", {\n      type: \"LOAD_INFO_ACTIVITIES_PLAN\",\n      args: self.params });\n\n  },\n\n  loadedWithDataFirstParent: function loadedWithDataFirstParent() {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"LOAD_INFO_SUMMARY_PLAN\",\n      args: self.params });\n\n  },\n\n  clean: function clean() {\n    var self = this;\n    if (self.serviceloadDataPlan) {\n      self.serviceloadDataPlan.unsubscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\n      self.serviceloadDataPlan.unsubscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\n    }\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.sidebar\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.loadDataPlan\", bizagi.workportal.widgets.project.plan.sidebar], true);","/*\r\n *   Name: Bizagi Workportal project Discussion Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.discussion.sidebar\", {}, {\n\n  /*\r\n                                                                                                       *   Constructor\r\n                                                                                                       */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    params = params || {};\n    params.supportNav = false;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-discussion-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussion.sidebar\").concat(\"#project-discussion-sidebar\") });\n\n  },\n\n  /**\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-discussion-sidebar\");\n    self.content = template.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) });\n\n    return self.content;\n  },\n\n  /**\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    var $contentWidget = self.getContent();\n    $(\".ui-bizagi-wp-project-discussions-sidebar-action-add > a\", $contentWidget).on(\"click\",\n    $.proxy(self.onShowPopupDiscussion, self));\n  },\n\n  /**\r\n      * Events elements\r\n      */\n  onShowPopupDiscussion: function onShowPopupDiscussion() {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"OPEN_POPUP_DISCUSSION\",\n      args: {} });\n\n  } });\n\n\nbizagi.injector.register('bizagi.workportal.widgets.project.discussion.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.discussion.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Action\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.action\", {}, {\n\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, projectDashboard, notifier, planTemplateCreate, planPopupEdit, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.PENDING_PLAN = \"PENDING\";\n    self.EXECUTING_PLAN = \"EXECUTING\";\n    self.CLOSED_PLAN = \"CLOSED\";\n\n    self.CONTEXT_ACTIVITYPLAN = \"ACTIVITYPLAN\";\n    self.CONTEXT_ACTIVITYPLANOVERVIEW = \"ACTIVITYPLANOVERVIEW\";\n    self.CONTEXT_PLANCREATE = \"PLANCREATE\";\n    self.CONTEXT_ACTIVITYPLANCREATE = \"ACTIVITYPLANCREATE\";\n\n    self.showActionsPlan = false;\n    self.projectDashboard = projectDashboard;\n    self.notifier = notifier;\n    self.planTemplateCreate = planTemplateCreate;\n    self.planPopupEdit = planPopupEdit;\n\n    //Load templates\n    self.loadTemplates({\n      \"plan-action-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.action\").concat(\"#project-plan-action\") });\n\n  },\n\n  renderContent: function renderContent() {\n    var self = this;\n    var tmpl = self.getTemplate(\"plan-action-main\");\n\n    self.showActionsPlan = self.params.showContextByMenuDashboard !== self.CONTEXT_ACTIVITYPLAN &&\n    self.params.showContextByMenuDashboard !== self.CONTEXT_ACTIVITYPLANOVERVIEW;\n\n    self.plugins = {};\n    self.content = tmpl.render({\n      plan: self.params.plan.name,\n      stateClosedPlan: self.CLOSED_PLAN,\n      currentStatePlan: self.params.plan.currentState,\n      showActionsPlan: self.showActionsPlan });\n\n\n    if (self.showActionsPlan) {\n      self.params.plan.contextualized = typeof self.params.plan.contextualized == \"undefined\" ? true : self.params.plan.contextualized;\n    }\n\n    return self.content;\n  },\n\n  postRender: function postRender() {\n\n    var self = this;\n    var $contentWidget = self.getContent();\n\n    if (self.showActionsPlan) {\n      self.initilizeActionMenu();\n      $(\"a#to-close-plan\", $contentWidget).on(\"click\", $.proxy(self.onClosePlan, self));\n    }\n\n    self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\n    self.clearAlertsOnFocus();\n\n    self.planTemplateCreate.sub('planTemplateCreatedSuccess', function () {\n      self.notifier.showSucessMessage(\n      printf(bizagi.localization.getResource('workportal-project-plan-create-template-success'), ''));\n    });\n    self.planTemplateCreate.sub('planTemplateCreatedFailed', function () {\n      self.notifier.showErrorMessage(\n      printf(bizagi.localization.getResource('workportal-project-plan-create-template-fail'), ''));\n    });\n\n    self.planPopupEdit.sub('planEditedSuccess', function () {\n      self.setNamePlan(self.params.plan.name);\n\n      self.pub(\"notify\", {\n        type: \"UPDATE_INFO_PLAN\" });\n\n\n      self.pub(\"notify\", {\n        type: \"LOAD_INFO_SUMMARY_PLAN\",\n        args: self.params });\n\n\n      self.notifier.showSucessMessage(\n      printf(bizagi.localization.getResource('workportal-project-plan-edit-success'), ''));\n    });\n\n    self.planPopupEdit.sub('planEditedFailed', function () {\n      self.notifier.showErrorMessage(\n      printf(bizagi.localization.getResource('workportal-project-plan-edit-fail'), ''));\n    });\n\n    self.sub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\n  },\n\n  onNotifyExpandedRightSidebar: function onNotifyExpandedRightSidebar() {\n    var self = this;\n    if (self.showActionsPlan) {\n      self.initilizeActionMenu();\n    }\n  },\n\n  /**\r\n      * Notifies when an event is raised\r\n      */\n\n  onNotifyLoadInfoSummaryPlan: function onNotifyLoadInfoSummaryPlan() {\n    var self = this;\n    self.setStatePlan(self.params.plan.currentState);\n    self.setNamePlan(self.params.plan.name);\n  },\n\n  /**\r\n      * UI\r\n      */\n\n  setStatePlan: function setStatePlan(statePlan) {\n    var self = this;\n    if (statePlan) {\n      switch (statePlan.toUpperCase()) {\n        case \"PENDING\":\n          $(\".state-pending-plan\", self.content).show().siblings().hide();\n          break;\n        case \"EXECUTING\":\n          $(\".state-executing-plan\", self.content).show().siblings().hide();\n          break;\n        case \"CLOSED\":\n          $(\".state-closed-plan\", self.content).show().siblings().hide();\n          break;}\n\n    }\n  },\n\n  setNamePlan: function setNamePlan(namePlan) {\n    var self = this;\n    $(\".ui-bizagi-wp-project-plan-header .bz-wp-section\", self.content).text(bizagi.util.decodeHtmlEntities(namePlan));\n  },\n\n  /**\r\n      Events\r\n      */\n  onSelectMenu: function onSelectMenu(event, ui) {\n    var self = this;\n    if ($(event.currentTarget).find(\"i\").length === 0) {\n      var item = $(ui.item).data(\"item\");\n\n      switch (item) {\n        case \"edit\":\n          self.onClickMenuOpenEdition();\n          break;\n        case \"delete\":\n          self.onClickMenuDeletePlan();\n          break;\n        case \"saveastmpl\":\n          self.onClickMenuSaveAsTemplate();\n          break;}\n\n    }\n\n  },\n\n  onClickMenuOpenEdition: function onClickMenuOpenEdition() {\n    var self = this;\n    var planSelected = self.params.plan;\n    self.planPopupEdit.showPopup(self.params, self.dataService, planSelected);\n  },\n\n  onClickMenuSaveAsTemplate: function onClickMenuSaveAsTemplate() {\n    var self = this;\n    self.planTemplateCreate.showPopupAddTemplatePlan(self.params,\n    self.dataService, self.params.plan.contextualized, self.params.plan.id);\n  },\n\n  onClickMenuDeletePlan: function onClickMenuDeletePlan() {\n    var self = this;\n\n    $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-plan-action-delete-confirmation\"), \"\", \"info\")).done(function () {\n      var params = { id: self.params.plan.id };\n\n      $.when(self.callDeletePlan(params)).always(function (response) {\n        if (response.status === 200 || typeof response.status === \"undefined\") {\n          $.extend(self.params.plan, params);\n          self.notifier.showSucessMessage(\n          printf(bizagi.localization.getResource(\"workportal-project-plan-delete-success\"), \"\"));\n\n          //when a plan created from an activity is deleted, not created from a case\n          var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\n          var currentLevelNavigator = parseInt(getLevelNavigator[0]);\n          var params = self.projectDashboard.getParamsByBackFromPlan(self.params, currentLevelNavigator, true);\n\n          self.pub(\"notify\", {\n            type: params.typeContext,\n            args: $.extend(self.params, params.paramsNotify) });\n\n        } else\n        {\n          self.notifier.showErrorMessage(\n          printf(bizagi.localization.getResource('workportal-project-plan-delete-fail'), ''));\n        }\n      });\n    });\n  },\n\n  onSubmitFormPlan: function onSubmitFormPlan(event) {\n    event.preventDefault();\n  },\n\n  initilizeActionMenu: function initilizeActionMenu() {\n    var self = this;\n    $(\".ui-bizagi-wp-project-plan-action-menu\", self.content).menu({\n      select: $.proxy(self.onSelectMenu, self) }).\n    removeClass(\"ui-widget-content\");\n  },\n\n\n  /**\r\n      * Initialize edit plugin\r\n      */\n\n  clearAlertsOnFocus: function clearAlertsOnFocus() {\n    $(\".ui-bizagi-wp-project-container-validator-relative input, .ui-bizagi-wp-project-container-validator-relative textarea\").focus(function () {\n      $(this).parent().find(\".k-invalid-msg\").hide();\n    }).focusout(function () {\n      if ($(this).val().length < 1) {\n        $(this).parent().find(\".k-invalid-msg\").show();\n      }\n    });\n  },\n\n  /*activitiesAreCompleted: function(activities){\r\n         var listActivities = activities || [];\r\n         var numActivitiesCompleted =  listActivities.filter(function(activity){\r\n             return activity.finishDate;\r\n         }).length;\r\n         return numActivitiesCompleted == activities.length;\r\n     },*/\n\n  /*getCopyObjectPlan: function(){\r\n              var self = this;\r\n              return {\r\n                  id: self.params.plan.id,\r\n                  name: self.params.plan.name,\r\n                  description: self.params.plan.description,\r\n                  dueDate: self.params.plan.dueDate,\r\n                  waitForCompletion: self.params.plan.waitForCompletion,\r\n                  currentState: self.params.plan.currentState,\r\n                  parentWorkItem: self.params.plan.parentWorkItem,\r\n                  creationDate: self.params.plan.creationDate,\r\n                  startDate: self.params.plan.startDate,\r\n                  idUserCreator: self.params.plan.idUserCreator,\r\n                  contextualized: self.params.plan.contextualized,\r\n                  activities: self.params.plan.activities\r\n              };\r\n          },*/\n\n  /**\r\n                * Call services\r\n                */\n  /*callUpdatePlan: function(params){\r\n                       var self = this;\r\n                       return $.when(self.dataService.updatePlan(params)).done(function () {\r\n                           $.extend(self.params.plan, params);\r\n                         });\r\n                   },\r\n                     callClosePlan: function(params){\r\n                       var self = this;\r\n                       return $.when(self.dataService.closePlan(params)).done(function () {\r\n                           $.extend(self.params.plan, params);\r\n                           self.notifier.showSucessMessage(\r\n                               printf(bizagi.localization.getResource(\"workportal-project-plan-close-success\"), \"\"));\r\n                       });\r\n                   },*/\n\n\n\n  callDeletePlan: function callDeletePlan(params) {\n    var self = this;\n    return $.when(self.dataService.deletePlan(params));\n  },\n\n  clean: function clean() {\n    var self = this;\n    self.planTemplateCreate.unsub(\"planTemplateCreatedSuccess\");\n    self.planTemplateCreate.unsub(\"planTemplateCreatedFailed\");\n    self.planPopupEdit.unsub(\"planEditedSuccess\");\n    self.planPopupEdit.unsub(\"planEditedFailed\");\n\n    self.unsub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.action\", [\"workportalFacade\", \"dataService\",\n\"bizagi.workportal.services.behaviors.projectDashboard\", \"notifier\",\n\"bizagi.workportal.widgets.project.plan.template.create\",\n\"bizagi.workportal.widgets.project.plan.edit\",\nbizagi.workportal.widgets.project.plan.action], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan State\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.state\", {}, {\n\n  /*\r\n                                                                                               *   Constructor\r\n                                                                                               */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"plan-state-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.state\").concat(\"#project-plan-state\") });\n\n  },\n\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  postRender: function postRender() {\n    var self = this;\n    self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\n  },\n\n  /**\r\n      * Notifies when an event is raised\r\n      */\n\n  onNotifyLoadInfoSummaryPlan: function onNotifyLoadInfoSummaryPlan(event, params) {\n    var self = this;\n    var tmpl = self.getTemplate(\"plan-state-main\");\n    var renderWidget = tmpl.render({});\n    self.params = $.extend(self.params, params.args);\n\n    var state = self.params.plan.currentState;\n\n    switch (state.toUpperCase()) {\n      case \"PENDING\":\n        $(\".state-pending\", renderWidget).show().siblings().hide();\n        break;\n      case \"EXECUTING\":\n        $(\".state-executing\", renderWidget).show().siblings().hide();\n        break;\n      case \"CLOSED\":\n        $(\".state-closed\", renderWidget).show().siblings().hide();\n        break;}\n\n    self.content.empty().append(renderWidget);\n\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.state\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.state], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Progress\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.progress\", {}, {\n\n  /*\r\n                                                                                                  *   Constructor\r\n                                                                                                  */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"plan-progress-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.progress\").concat(\"#project-plan-progress\") });\n\n  },\n\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  postRender: function postRender() {\n    var self = this;\n\n    self.sub(\"LOAD_INFO_SUMMARY_PROGRESS_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\n  },\n\n  /**\r\n      * Notifies when an event is raised\r\n      */\n\n  onNotifyLoadInfoSummaryPlan: function onNotifyLoadInfoSummaryPlan(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n\n    var $content = self.getContent().empty();\n\n    var valuePercentBarComplete = self.calculateProgress();\n\n    var argsTemplate = {};\n    argsTemplate.progress = valuePercentBarComplete;\n\n    if (argsTemplate.progress < 33) {\n      argsTemplate.colorBar = \"Red\";\n    } else\n    if (argsTemplate.progress < 66) {\n      argsTemplate.colorBar = \"Yellow\";\n    } else\n    {\n      argsTemplate.colorBar = \"Green\";\n    }\n\n    //Update widget\n    var contentTemplate = self.getTemplate(\"plan-progress-main\");\n    contentTemplate.\n    render(argsTemplate).\n    appendTo($content);\n\n    //Begin Adjust status bar next to the number days\n    var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\n    var widthNumberDays = $(\".remaining-days .days\", $content).width();\n    $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\n    //End Adjust status bar next to the number days\n\n\n  },\n\n  calculateProgress: function calculateProgress() {\n    var self = this;\n\n    var completedActivities = 0;\n    var totalActivities = self.params.plan.activities.length;\n    var percentProgress = 0;\n\n    if (totalActivities !== 0) {\n      self.params.plan.activities.forEach(function (activity) {\n        if (activity.workItemState === \"Completed\") {\n          completedActivities++;\n        }\n      });\n      percentProgress = Math.round(completedActivities / totalActivities * 100);\n    }\n    return percentProgress;\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.progress\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.progress], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Time\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.time\", {}, {\n\n  /*\r\n                                                                                              *   Constructor\r\n                                                                                              */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.PENDING_PLAN = \"PENDING\";\n    self.EXECUTING_PLAN = \"EXECUTING\";\n    self.CLOSED_PLAN = \"CLOSED\";\n\n    //Regional\n    self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\n\n    //Load templates\n    self.loadTemplates({\n      \"plan-time-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.time\").concat(\"#project-plan-time\") });\n\n  },\n\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  postRender: function postRender() {\n    var self = this;\n\n    self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\n  },\n\n  /**\r\n      * Notifies when an event is raised\r\n      */\n\n  onNotifyLoadInfoSummaryPlan: function onNotifyLoadInfoSummaryPlan(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n\n    if (self.params.plan) {\n      if (self.params.plan.dueDate) {\n        if (self.params.plan.currentState === self.PENDING_PLAN || self.params.plan.currentState === self.EXECUTING_PLAN) {\n          self.updateWidget(event, params);\n        } else\n        {\n          self.sub(\"LOADED_ACTIVITIES_PLAN\", $.proxy(self.updateWidget, self));\n        }\n      } else\n      {\n        self.getContent().empty();\n      }\n    }\n\n  },\n\n  /**\r\n      * change the time properties string to timestamp number\r\n      * @param {*} plan \r\n      */\n  planDatesToStamp: function planDatesToStamp(plan) {\n    if (plan.activities)\n    plan.activities.map(function (a) {\n      if (a.estimatedFinishDate) a.estimatedFinishDate = new Date(a.estimatedFinishDate).getTime();\n      if (a.startDate) a.startDate = new Date(a.startDate).getTime();\n      if (a.finishDate) a.finishDate = new Date(a.finishDate).getTime();\n    });\n    if (plan.dueDate) plan.dueDate = new Date(plan.dueDate).getTime();\n    if (plan.creationDate) plan.creationDate = new Date(plan.creationDate).getTime();\n    if (plan.startDate) plan.startDate = new Date(plan.startDate).getTime();\n    if (plan.closedDate) plan.closedDate = new Date(plan.closedDate).getTime();\n    if (plan.finishDate) plan.finishDate = new Date(plan.finishDate).getTime();\n  },\n  updateWidget: function updateWidget(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n    self.planDatesToStamp(self.params.plan);\n    var $content = self.getContent().empty();\n    if (self.params.plan.currentState === self.CLOSED_PLAN) {\n      self.getClosedDatePlan(self.params.plan);\n    }\n    $.when(self.getIntervalOnMinutes(self.params.plan)).done(function (response) {\n      var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - response.minutesToShowTime * 60 * 1000), null, true);\n\n      var messageUnitTimeCalculated = relativeTime.replace(/\\d/g, \"\");\n      var keywordResourceDescriptionDifference = self.getKeywordDifferenceDates(self.params.plan);\n      var messageDescripionDifference = bizagi.localization.getResource(\"workportal-project-plan-state-\" + keywordResourceDescriptionDifference);\n      messageDescripionDifference = messageDescripionDifference.replace(\"%s\", messageUnitTimeCalculated);\n\n      var valueOfTimeCalculated = relativeTime.replace(/\\D/g, \"\");\n\n      var auxToDate = self.getSecondDate(self.params.plan);\n      var auxPercentBar = self.getWidthBar(self.params.plan, response);\n      var auxColorBar = self.getColorBarByPercent(auxPercentBar);\n      var argsTemplate = {\n        fromDate: self.getFormattedDate(new Date(self.getFirstDate(self.params.plan))),\n        toDate: auxToDate ? self.getFormattedDate(new Date(auxToDate)) : null,\n        valueOfTimeCalculated: valueOfTimeCalculated,\n        messageDescripionDifference: messageDescripionDifference,\n        percentBar: auxPercentBar,\n        colorBar: auxColorBar };\n\n\n      var contentTemplate = self.getTemplate(\"plan-time-main\");\n      contentTemplate.\n      render(argsTemplate).\n      appendTo($content);\n\n    });\n  },\n  getFirstDate: function getFirstDate(plan) {\n    var self = this;\n    switch (plan.currentState) {\n      case self.PENDING_PLAN:\n        if (plan.dueDate) {\n          return plan.dueDate;\n        } else\n        {\n          return plan.creationDate;\n        }\n        break;\n      case self.EXECUTING_PLAN:\n      case self.CLOSED_PLAN:\n        return plan.startDate;}\n\n  },\n  getSecondDate: function getSecondDate(plan) {\n    var self = this;\n    switch (plan.currentState) {\n      case self.PENDING_PLAN:\n        return null;\n      case self.EXECUTING_PLAN:\n        return plan.dueDate;\n      case self.CLOSED_PLAN:\n        return plan.closedDate;}\n\n  },\n  getLastActivity: function getLastActivity(activities) {\n    var copyActivities = JSON.parse(JSON.stringify(activities));\n    return copyActivities.sort(function (activityA, activityB) {\n      return activityA.finishDate < activityB.finishDate ? 1 : -1;\n    })[0];\n  },\n\n  getClosedDatePlan: function getClosedDatePlan(plan) {\n    var self = this;\n    plan.closedDate = self.getLastActivity(plan.activities).finishDate;\n    return plan.closedDate;\n  },\n\n  getDifferenceBetweenDates: function getDifferenceBetweenDates(firstDate, secondDate) {\n    var self = this;\n    var defer = $.Deferred();\n    var params = {\n      idUser: bizagi.currentUser.idUser,\n      fromDate: firstDate,\n      toDate: secondDate };\n\n\n    $.when(self.callGetEffectiveDuration(params)).done(function (difference) {\n      defer.resolve(difference.minutes);\n    });\n    return defer.promise();\n  },\n\n  getIntervalOnMinutes: function getIntervalOnMinutes(plan) {\n    var self = this;\n    var defer = $.Deferred();\n    switch (plan.currentState) {\n      case self.PENDING_PLAN:\n        if (plan.dueDate > Date.now()) {\n          $.when(self.getDifferenceBetweenDates(Date.now(), plan.dueDate)).done(function (minutesNowToDueDate) {\n            $.when(self.getDifferenceBetweenDates(plan.creationDate, Date.now())).done(function (minutesCreateToNow) {\n              defer.resolve({ minutesToShowTime: minutesNowToDueDate, minutesCreateToNow: minutesCreateToNow });\n            });\n          });\n        } else\n        if (plan.dueDate < plan.creationDate) {\n          $.when(self.getDifferenceBetweenDates(plan.dueDate, plan.creationDate)).done(function (minutesDueDateToCreate) {\n            $.when(self.getDifferenceBetweenDates(plan.creationDate, Date.now())).done(function (minutesCreateToNow) {\n              defer.resolve({ minutesToShowTime: minutesDueDateToCreate + minutesCreateToNow, minutesCreateToNow: minutesCreateToNow });\n            });\n          });\n        } else\n        if (plan.dueDate > plan.creationDate) {\n          $.when(self.getDifferenceBetweenDates(plan.creationDate, plan.dueDate)).done(function (minutesCreateToDueDate) {\n            $.when(self.getDifferenceBetweenDates(plan.dueDate, Date.now())).done(function (minutesCreateToNow) {\n              defer.resolve({ minutesToShowTime: minutesCreateToDueDate + minutesCreateToNow, minutesCreateToNow: minutesCreateToNow });\n            });\n          });\n        }\n        break;\n      case self.EXECUTING_PLAN:\n        if (plan.dueDate) {\n          if (plan.dueDate > Date.now()) {\n            $.when(self.getDifferenceBetweenDates(Date.now(), plan.dueDate)).done(function (minutesNowToDueDate) {\n              $.when(self.getDifferenceBetweenDates(plan.startDate, Date.now())).done(function (minutesStartToNow) {\n                defer.resolve({ minutesToShowTime: minutesNowToDueDate, minutesStartToNow: minutesStartToNow });\n              });\n            });\n          } else\n          {\n            $.when(self.getDifferenceBetweenDates(plan.dueDate, Date.now())).done(function (minutesDueDateToNow) {\n              $.when(self.getDifferenceBetweenDates(plan.startDate, plan.dueDate)).done(function (minutesStartToDueDate) {\n                defer.resolve({ minutesToShowTime: minutesDueDateToNow, minutesStartToDueDate: minutesStartToDueDate });\n              });\n            });\n          }\n\n        } else\n        {\n          $.when(self.getDifferenceBetweenDates(plan.startDate, Date.now())).done(function (minutes) {\n            defer.resolve({ minutesToShowTime: minutes });\n          });\n        }\n        break;\n      case self.CLOSED_PLAN:\n        $.when(self.getDifferenceBetweenDates(plan.startDate, plan.closedDate)).done(function (minutes) {\n          defer.resolve({ minutesToShowTime: minutes });\n        });}\n\n\n    return defer.promise();\n  },\n\n  getKeywordDifferenceDates: function getKeywordDifferenceDates(plan) {\n    var self = this;\n    switch (plan.currentState) {\n      case self.PENDING_PLAN:\n        if (plan.dueDate > Date.now()) {\n          return \"remaining\";\n        } else\n        {\n          return \"exceeded\";\n        }\n        break;\n      case self.EXECUTING_PLAN:\n        if (plan.dueDate) {\n          if (plan.dueDate > Date.now()) {\n            return \"remaining\";\n          } else\n          {\n            return \"exceeded\";\n          }\n\n        } else\n        {\n          return \"opened\";\n        }\n        break;\n      case self.CLOSED_PLAN:\n        return \"executed\";}\n\n  },\n\n  getRelativeTime: function getRelativeTime(milliseconds) {\n    return bizagi.util.dateFormatter.getRelativeTime(milliseconds, null, false);\n  },\n\n  getWidthBar: function getWidthBar(plan, intervalMinutes) {\n    var self = this,\n    differenceStartDateToCurrentDate = {};\n    switch (plan.currentState) {\n      case self.PENDING_PLAN:\n        if (plan.dueDate) {\n          if (plan.dueDate < Date.now()) {\n            return 0;\n          } else\n          {\n            var totalInterval = intervalMinutes.minutesCreateToNow + intervalMinutes.minutesToShowTime;\n            valuePercentInterval = intervalMinutes.minutesToShowTime;\n            return Math.ceil(valuePercentInterval * 100 / totalInterval);\n          }\n        } else\n        {\n          return 0;\n        }\n        break;\n      case self.EXECUTING_PLAN:\n        if (plan.dueDate) {\n          if (plan.dueDate > Date.now()) {\n            var totalInterval = intervalMinutes.minutesStartToNow + intervalMinutes.minutesToShowTime;\n            valuePercentInterval = intervalMinutes.minutesToShowTime;\n            return Math.ceil(valuePercentInterval * 100 / totalInterval);\n          } else\n          {\n            return 0;\n          }\n        } else\n        {\n          return 0;\n        }\n        break;\n      case self.CLOSED_PLAN:\n        if (plan.closedDate > Date.now()) {\n          var differenceStartDateToClosedDate = plan.closedDate - plan.startDate;\n          differenceStartDateToCurrentDate = Date.now() - plan.startDate;\n          return Math.ceil(differenceStartDateToCurrentDate * 100 / differenceStartDateToClosedDate);\n        } else\n        {\n          return 100;\n        }}\n\n\n\n  },\n\n  getColorBarByPercent: function getColorBarByPercent(percent) {\n    if (percent < 33) {\n      return \"Red\";\n    } else\n    if (percent < 66) {\n      return \"Yellow\";\n    } else\n    {\n      return \"Green\";\n    }\n  },\n\n  /**\r\n      * Call services\r\n      */\n\n  callGetEffectiveDuration: function callGetEffectiveDuration(params) {\n    var self = this;\n    var d = $.Deferred();\n\n    $.when(\n    self.dataService.getEffectiveDuration(params)).\n    done(function (data) {\n      d.resolve(data);\n    });\n    return d.promise();\n  },\n\n  getFormattedDate: function getFormattedDate(dateObj) {\n    var self = this;\n    var monthsNames = self.datePickerRegional.monthNames;\n    var shortMonth = dateObj.getMonth();\n    return monthsNames[shortMonth] + \" \" + bizagi.util.dateFormatter.formatDate(dateObj, \"dd hh:mm tt\", bizagi.localization.getResource(\"datePickerRegional\"));\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.time\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.time], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Parent\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.parent\", {}, {\n\n  /*\r\n                                                                                                *   Constructor\r\n                                                                                                */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"plan-parent-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.parent\").concat(\"#project-plan-parent\") });\n\n  },\n\n  renderContent: function renderContent() {\n\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  postRender: function postRender() {\n    var self = this;\n    self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\n  },\n\n  /**\r\n      * Notifies when an event is raised\r\n      */\n  onNotifyLoadInfoSummaryPlan: function onNotifyLoadInfoSummaryPlan(event, params) {\n    var self = this,\n    $content = self.getContent().empty();\n    self.params = $.extend(self.params, params.args);\n    if (self.params.plan.parentWorkItem) {\n      $.when(self.dataService.getPlanParent({ idPlan: self.params.plan.id })).done(function (planParent) {\n        self.params.plan.parent = planParent;\n\n        if (self.params.plan.parent) {\n          var argsTemplate = {\n            idParent: self.params.plan.parent.radNumber,\n            nameParent: self.params.plan.parent.displayName,\n            idCase: self.params.plan.parent.idCase,\n            idWorkflow: self.params.plan.parent.idWorkflow,\n            idWorkItem: self.params.plan.parent.idWorkItem,\n            idTask: self.params.plan.parent.idTask,\n            processName: self.params.process ? self.params.process : self.params.plan.parent.planName };\n\n\n          if (bizagi.util.isEmpty(self.params.plan.parent.guidActivity)) {\n            self.goToParentCase($content, argsTemplate);\n          } else {\n            var paramsDetailActivity = {\n              idPlan: self.params.plan.id,\n              idActivity: self.params.plan.parent.guidActivity };\n\n            $.when(self.dataService.getActivity(paramsDetailActivity)).done(function (response) {\n              self.params.plan.parent.allowEdition = response.allowEdition;\n              self.goToParentCase($content, argsTemplate);\n            });\n          }\n\n        }\n\n      }).fail(function (msg) {\n\n      });\n    }\n  },\n  goToParentCase: function goToParentCase(content, argsTemplate) {\n    var self = this;\n    //TODO: double call because routing dont release memory and widgets\n    //Test with a breakpoint\n    content.empty();\n\n    //Update widget\n    var contentTemplate = self.getTemplate(\"plan-parent-main\");\n    contentTemplate.\n    render(argsTemplate).\n    appendTo(content);\n    $(\"#go-to-parent-case\", content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\n  },\n  onClickGoToParentCase: function onClickGoToParentCase(event) {\n    event.preventDefault();\n    var self = this;\n    self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.parent\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.parent], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Users\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.users\", {}, {\n\n  /*\r\n                                                                                               *   Constructor\r\n                                                                                               */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n    self.usersMap = {};\n    self.plugins = {};\n    self.usersInformation = [];\n    self.globalHandlersService = bizagi.injector.get('globalHandlersService');\n    self.usersAssignees = [];\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"plan-users-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.users\").concat(\"#project-plan-users\") });\n\n\n    self.auxNoRepeatTypesUser = {};\n    self.hashTypesUser = {\n      \"assigned\": bizagi.localization.getResource(\"workportal-project-user-assigned\"),\n      \"owner\": bizagi.localization.getResource(\"workportal-project-user-owner\") };\n\n  },\n\n  renderContent: function renderContent() {\n\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  postRender: function postRender() {\n    var self = this;\n    self.sub(\"LOAD_INFO_ACTIVITIES_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\n  },\n\n  /**\r\n      * Notifies when an event is raised\r\n      */\n  onNotifyLoadInfoSummaryPlan: function onNotifyLoadInfoSummaryPlan(event, params) {\n    var self = this,\n    args = params.args,\n    cvsGuidUsers = [],\n    activitiesUsers = [],\n    $content = self.getContent().empty();\n    var ownerUserGuid = params.args.plan.idUserCreator;\n    var ownerUserId = params.args.plan.idUserCreator;\n    self.params = $.extend(self.params, params.args);\n\n    activitiesUsers.push({ \"idUser\": ownerUserId, 'userGuid': ownerUserGuid, \"userType\": [\"owner\"] });\n    self.usersMap[\"-\" + ownerUserId + \"-\"] = {\n      picture: \"\",\n      id: ownerUserId,\n      guid: ownerUserGuid,\n      name: \"\",\n      userType: [\"owner\"] };\n\n    cvsGuidUsers.push(ownerUserId);\n    $.each(self.params.plan.activities, function (index, activity) {\n      var userId = activity.userAssigned;\n      var userGuid = activity.userAssignedGuid;\n      if (activity.isRunning == true) {\n        if (userId === ownerUserId) {\n          if ($.inArray(\"Assigned\", activitiesUsers[0].userType) === -1) {\n            activitiesUsers[0].userType.push(\"Assigned\");\n            self.usersMap[\"-\" + ownerUserId + \"-\"].userType.push(\"Assigned\");\n          }\n        } else\n        {\n          self.usersMap[\"-\" + userId + \"-\"] = {\n            picture: \"\",\n            id: userId,\n            guid: userGuid,\n            name: \"\",\n            userType: [\"Assigned\"] };\n\n          if (activitiesUsers.filter(function (user) {return user.idUser == userId;}).length === 0) {\n            activitiesUsers.push({ \"idUser\": userId, \"guidUser\": userGuid, \"userType\": [\"Assigned\"] });\n            cvsGuidUsers.push(userId);\n          }\n        }\n      }\n    });\n    self.activitiesUsers = activitiesUsers;\n    self.params = args;\n    //Update widget\n    var contentTemplate = self.getTemplate(\"plan-users-main\");\n    contentTemplate.\n    render({\n      assignee: self.justAssignees(activitiesUsers),\n      label: bizagi.localization.getResource(\"workportal-project-plan-assignee\") }).\n\n    appendTo($content);\n    self.initilizeTooltip();\n    self.addEventHandlersModal();\n    $.when(self.callGetDataUsers(cvsGuidUsers)).then(function () {\n      self.showCreatorInformation(ownerUserId);\n      self.renderUserProfilesAndImages();\n    });\n  },\n\n  /**\r\n      * return standar userAdapter information with only assigned users when the plan has started\r\n      * @param {Array} allUsers \r\n      */\n  justAssignees: function justAssignees(allUsers) {\n    var self = this;\n    var usersAssignee = [];\n    if ([\"CLOSED\", \"PENDING\"].indexOf(self.params.plan.currentState) == -1) {\n      allUsers.map(function (user) {\n        var isOwner = user.userType.indexOf(\"owner\") !== -1;\n        var isAssignee = user.userType.indexOf(\"Assigned\") !== -1;\n        usersAssignee.push(usersAdapter.createJsonUserInfo(user.idUser, \"\", \"\", \"\", \"\", \"\", isAssignee, isOwner, [], []));\n      });\n    }\n    return usersAdapter.justAssignees(usersAssignee);\n  },\n\n  /**\r\n      * show the information of the creator case\r\n      * @param {string} ownerUserId guid user creator\r\n      */\n  showCreatorInformation: function showCreatorInformation(ownerUserId) {\n    var self = this;\n    var userCreator = self.usersInformation.find(function (user) {\n      return user.id == ownerUserId;\n    });\n    var userInfo = usersAdapter.createJsonUserInfo(\n    userCreator.id,\n    userCreator.name,\n    userCreator.username,\n    userCreator.picture ? \"data:image/png;base64,\" + userCreator.picture : undefined,\n    userCreator.email,\n    userCreator.name.getInitials(),\n    false,\n    true,\n    [],\n    []);\n\n    self.content.find(\".ui-bizagi-wp-project-plan-users .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\n  },\n\n  /**\r\n      * UI\r\n      */\n  renderUserProfilesAndImages: function renderUserProfilesAndImages() {\n    var self = this;\n    $.each(self.usersMap, function (i, obj) {\n      var $li = $(\".ui-bizagi-wp-userlist li[data-iduser=\" + obj.id + \"]\", self.content);\n\n      if (obj.picture !== \"\") {\n        $li.find(\"img\").prop(\"src\", obj.picture);\n        $(\".bz-wp-avatar-label\", $li).hide();\n      } else\n      {\n        if (obj.name !== undefined) {\n          $(\".bz-wp-avatar-img\", $li).hide();\n          $(\".bz-wp-avatar-label\", $li).html(obj.name.getInitials());\n        } else\n        {\n          console.log(\"obj.name is undefined\");\n        }\n\n      }\n    });\n  },\n\n  /*\r\n      *  Get data for users\r\n      */\n  callGetDataUsers: function callGetDataUsers(csvguidUsers) {\n    var self = this,\n    params = {},\n    defer = $.Deferred();\n    params = {\n      usersGuids: csvguidUsers.join(),\n      width: 50,\n      height: 50 };\n\n    $.when(self.dataService.getUsersData(params)).always(function (response) {\n      self.usersInformation = response;\n      for (var i = 0, length = response.length; i < length; i += 1) {\n        if (typeof response[i].name === \"undefined\") {\n          bizagi.log(response[i] + \" Id Not Found\", response, \"error\");\n        } else {\n          if (self.usersMap[\"-\" + response[i].id + \"-\"]) {\n            self.usersMap[\"-\" + response[i].id + \"-\"].picture += response[i].picture ? \"data:image/png;base64,\" + response[i].picture : \"\";\n            self.usersMap[\"-\" + response[i].id + \"-\"].name = response[i].name || \"\";\n          } else\n          {\n            console.log(\"self.usersMap['-' + response[i].id + '-'] is undefined\");\n          }\n\n        }\n      }\n      self.getUsersAssignees();\n      defer.resolve();\n    });\n    return defer.promise();\n  },\n\n  /*\r\n     * validate if the activity is running\r\n     */\n  activityRunning: function activityRunning(activity) {\n    return activity.startDate !== null && activity.finishDate === null;\n  },\n\n  getUsersAssignees: function getUsersAssignees() {\n    var self = this;\n    for (var i = 0; i < self.usersInformation.length; i++) {\n      var res_user = self.getUserAssignee(self.params.plan.activities, self.usersInformation[i]);\n      if (res_user !== false) {\n        self.usersAssignees.push(res_user);\n      }\n    }\n\n  },\n\n  /**\r\n      * review if the user is assigned to some active activities and return this user, else return false\r\n      * @param {Array} activities all activities of this plan\r\n      * @param {User} user to review\r\n      */\n  getUserAssignee: function getUserAssignee(activities, user) {\n    var self = this;\n    var tasks = activities.filter(function (activity) {\n      return activity.userAssigned === user.id && self.activityRunning(activity);\n    }).map(function (a) {\n      return { \"name\": a.name };\n    });\n    if (tasks.length == 0) return false;\n    user.tasks = tasks;\n    var types = self.activitiesUsers.find(function (actUser) {\n      return actUser.idUser == user.id;\n    });\n    user.types = types === undefined ? [] : types.userType;\n\n    var userAssignees = usersAdapter.createJsonUserInfo(\n    user.id,\n    user.name,\n    user.username,\n    user.picture ? \"data:image/png;base64,\" + user.picture : undefined,\n    user.email,\n    user.name.getInitials(),\n    user.types.indexOf(\"Assigned\") > -1,\n    user.types.indexOf(\"owner\") > -1,\n    user.tasks,\n    []);\n\n    return userAssignees;\n  },\n\n  /*\r\n      *  Tooltips\r\n      */\n  initilizeTooltip: function initilizeTooltip() {\n    var self = this;\n\n    $(\".ui-bizagi-wp-userlist > li\", self.content).not(\".moreUsers\").on('mouseenter', '', function (ev) {\n      var $target = $(ev.target);\n      var id_userSelected = $target.closest(\"[data-iduser]\").attr('data-iduser');\n      var user = self.usersInformation.find(function (user) {\n        return user.id == id_userSelected;\n      });\n      var activities = [];\n\n      if (user.tasks)\n      user.tasks.map(function (task) {\n        activities.push(task.name);\n      });\n\n      var types = self.activitiesUsers.find(function (actUser) {\n        return actUser.idUser == id_userSelected;\n      });\n      user.types = types.userType;\n\n      user.owner = user.types.find(function (type) {\n        return type == \"owner\";\n      });\n      user.isAssignee = user.types.find(function (type) {\n        return type == \"Assigned\";\n      });\n\n      var userParam = usersAdapter.createJsonUserInfo(user.id, user.name, user.username, user.picture ? \"data:image/png;base64,\" + user.picture : undefined, user.email, user.name.getInitials(), user.isAssignee, user.owner, activities, []);\n      $target.parent().usertooltip(self, { target: $target, user: userParam });\n    });\n  },\n  addEventHandlersModal: function addEventHandlersModal() {\n    var self = this;\n    $(\".moreUsers\").click(function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n      var usersAssignees = self.usersAssignees || [];\n      self.globalHandlersService.publish(\"showDialogWidget\", {\n        widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL,\n        closeVisible: true,\n        data: usersAssignees,\n        maximize: true,\n        modalParameters: {\n          title: bizagi.localization.getResource(\"workportal-project-users-title\") + \" (\" + usersAssignees.length + \")\",\n          width: 790,\n          height: 526,\n          refreshInbox: false } });\n\n\n    });\n  } });\n\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.users\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.users], true);"]}