{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu/bizagi.workportal.desktop.widgets.project.dashboard.menu.js","jquery/workportal/desktop/widget/project.dashboard.menu.plan/bizagi.workportal.desktop.widgets.project.dashboard.menu.plan.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.files/bizagi.workportal.desktop.widgets.project.files.js","jquery/workportal/desktop/widget/project.filesPreview/bizagi.workportal.desktop.widgets.project.filesPreview.js","jquery/workportal/desktop/widget/project.file.sidebar/bizagi.workportal.desktop.widgets.project.file.sidebar.js"],"names":["bizagi","workportal","widgets","widget","extend","onDiscussionsMenuStatusChange","ev","params","this","updateDiscussionsIcons","hasDiscussionsOrComment","sub","$","proxy","toggle","clean","unsub","injector","register","project","dashboard","menu","init","workportalFacade","dataService","projectDashboard","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","postRender","self","contextsLeftSidebarCaseDashboard","forEach","context","updateView","event","args","$content","getContent","empty","template","menuPlanDashboard","menuDashboard","planState","getPlanState","plan","planChild","argsTemplate","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isVisibleShowTimeLine","render","appendTo","showContextByMenuDashboard","toUpperCase","addClass","siblings","removeClass","handlerEvents","currentState","extraValidationShowTimeLine","loadContentById","preventDefault","$item","target","closest","data","backParentPlan","hasClass","pub","type","subMenuHandler","$comments","$files","$timeline","on","getLevelNavigator","currentLevelNavigator","parseInt","getParamsByBackFromPlan","typeContext","paramsNotify","off","project-content-dashboard","setTimeout","window","trigger","ui","kendo","Widget","ProjectAttachments","element","options","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","localization","name","wrapper","multiple","dropZone","maxFilesSize","currentUser","uploadMaxFileSize","enabled","that","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","select","_filterMaxFilesSize","complete","interval","setInterval","find","length","_showNotificationCompleteUpload","clearInterval","progress","_onProgressFile","success","push","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","title","notifierTitle","actions","animation","open","duration","close","visible","resizable","draggable","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","getResource","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","replace","_getSize","cancel","retry","Math","round","$file","_getFileItemByUID","uid","percent","percentComplete","css","width","text","hide","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$target","$fileWrapper","$uploadWrapper","guid","remove","_onRemoveFile","_onRetryFile","file","grep","i","validation","_isValidFile","message","setStatus","valid","size","undefined","inArray","extension","total","_notifySizeExceeded","show","_switchEvents","currentTarget","cancelFilesUpload","destroy","status","prop","errorUploadiis","plugin","jQuery","base","plugins","prefixBase64","usersData","currentFilesList","fileDateInterval","project-files","project-files-uploaditem","project-files-list","project-attachments","templateHomeFiles","isOpen","util","parseBoolean","isClosedForAllUsers","when","renderFilesList","done","initializeUploadFiles","eventsHandler","restrictedEventsHandler","defer","Deferred","filesLength","globalParent","radNumber","dateTime","date","getDateServer","count","flowContext","id","getFilesListByRadNumber","renderFiles","resolve","promise","$showMoreWrapper","displayFileList","updateRelativeTime","setAdditionalData","notifyFilesNumber","renderNoFiles","noFilesTmpl","resources","$noFiles","tmpl","html","kendoProjectAttachments","serviceLocator","getUrl","onSuccessFile","addFileData","onSaveFileData","supportFileExt","uploadMaxFilesSize","thumbnails","users","guidsUsers","user","attachment","setUserData","join","setThumbnails","usersGuids","height","getUsersData","picture","getFileInfoByGuid","guids","getFilesThumbnails","thumbnail","$wrapper","$img","each","src","toLowerCase","setFilePreview","guidAttch","guidFile","img","userId","fileData","userData","XMLHttpRequest","response","JSON","parse","saveFileData","fail","onRetryFile","toString","description","idUser","attachmentsToCreate","unshift","createProjectFile","always","userName","Date","getTime","photo","reject","action","$filesList","equalizeHeights","deleteFile","filter","updateFileData","changeRelativeTime","item","relativeTime","dateFormatter","getRelativeTime","onSelectFiles","bannedFiles","isValidFile","bannedFile","splice","showFilesError","resetWidget","switchFilesEvents","stopPropagation","fileName","getDownloadAttachment","parent","mandatory","filesNumber","notifier","datePickerRegional","dialogBox","project-filespreview-wrapper","project-filespreview-preview","project-filespreview-popup","project-filespreview-thenumber","generalTmpl","setFilesNumber","fileEdition","initPluginPopupEdition","form","image","edit","parameters","isEmptyObject","currentFile","$filesNumber","formContent","showPreview","idCurrentUser","applyMenu","setEditionData","val","onResetFileForm","onSaveEdition","onSelectMenu","onOpenEdition","onDeleteFile","onDownloadFile","dialog","modal","maximize","focus","showConfirmationBox","attachmentsToDelete","validateAddFileDescriptionForm","updateProjectFile","showSucessMessage","printf","showErrorMessage","$description","result","$textAreadescription","trim","descriptionValidation","next","detach","filesPreview","supportNav","project-file-sidebar","getWidgetName","BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR","sidebar"],"mappings":"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","sourcesContent":["/**\r\n * Name: BizAgi Desktop Widget Dashboard menu (left sidebar) * \r\n * @author Valeria Vanegas\r\n */\n\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu\", {}, {\n\n  /**\r\n                                                                                                   * Handler when discussions menu status change\r\n                                                                                                   * @param {*} ev \r\n                                                                                                   * @param {*} params \r\n                                                                                                   */\n  onDiscussionsMenuStatusChange: function onDiscussionsMenuStatusChange(ev, params) {\n    var self = this;\n    self.updateDiscussionsIcons(params.hasDiscussionsOrComment);\n  },\n\n  /**\r\n      * Update discussions icon on sidebar menu\r\n      * The icon is different when there is other discussion or there are comments\r\n      * @param {*} hasDiscussionsOrComment \r\n      */\n  updateDiscussionsIcons: function updateDiscussionsIcons(hasDiscussionsOrComment) {\n    var self = this;\n\n    self.sub(\"UPDATE_DISCUSSIONS_MENU_STATUS\", $.proxy(self.onDiscussionsMenuStatusChange, self));\n\n    $(\".bz-icon-discussion-comment\").toggle(hasDiscussionsOrComment);\n    $(\".bz-icon-discussion-no-comment\").toggle(!hasDiscussionsOrComment);\n    self.params.hasDiscussionsOrComment = hasDiscussionsOrComment;\n  },\n\n  /**\r\n      * Detach events\r\n      */\n  clean: function clean() {\n    var self = this;\n    self.unsub(\"UPDATE_DISCUSSIONS_MENU_STATUS\", $.proxy(self.onDiscussionsMenuStatusChange, self));\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu], true);","/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Plan\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.dashboard.menu.extend(\"bizagi.workportal.widgets.project.dashboard.menu.plan\", {}, {\n\n  /*\r\n                                                                                                                        *   Constructor\r\n                                                                                                                        */\n  init: function init(workportalFacade, dataService, projectDashboard, params) {\n    var self = this;\n    self.params = params || {};\n    self.projectDashboard = projectDashboard;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.plan\").concat(\"#project-dashboard-menu\") });\n\n  },\n\n  /**\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n\n  },\n\n  /**\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    self._super();\n    //Handlers\n    if (self.params && self.params.contextsLeftSidebarCaseDashboard) {\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function (context) {\n        self.sub(context, $.proxy(self.updateView, self));\n      });\n    }\n  },\n\n\n  updateView: function updateView(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n    self.clean();\n    var $content = self.getContent().empty();\n\n    var template = self.getTemplate(\"project-dashboard-menu\");\n    self.params.menuPlanDashboard = self.params.menuPlanDashboard || {};\n    $.extend(self.params.menuPlanDashboard, self.params.menuDashboard);\n\n    self.planState = self.getPlanState(self.params.plan, self.params.planChild);\n    var argsTemplate = {\n      planState: self.planState,\n      showCommentsOptionMenu: self.params.menuPlanDashboard.showCommentsOptionMenu,\n      showFilesOptionMenu: self.params.menuPlanDashboard.showFilesOptionMenu,\n      showTimeLineOptionMenu: self.params.menuPlanDashboard.showTimeLineOptionMenu && self.isVisibleShowTimeLine(self.planState) };\n\n    template.render(argsTemplate).appendTo($content);\n\n    $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\n\n    self.updateDiscussionsIcons(self.params.hasDiscussionsOrComment);\n    self.handlerEvents();\n  },\n\n  /**\r\n      * Return planState by plan or planChild\r\n      * @param plan\r\n      * @param planChild\r\n      * @returns {*}\r\n      */\n  getPlanState: function getPlanState(plan, planChild) {\n    var currentState;\n    if (planChild && planChild.currentState) {\n      currentState = planChild.currentState;\n    } else\n    if (plan && plan.currentState) {\n      currentState = plan.currentState;\n    }\n    return currentState;\n  },\n\n  /**\r\n      * Behavior visible timeline option\r\n      */\n  isVisibleShowTimeLine: function isVisibleShowTimeLine(planState) {\n    var self = this;\n    var extraValidationShowTimeLine = true;\n    if (planState === \"PENDING\") {\n      extraValidationShowTimeLine = false;\n    }\n    return extraValidationShowTimeLine;\n  },\n\n  /*\r\n      *   Load Content By Id\r\n      */\n  loadContentById: function loadContentById(event) {\n    var self = this;\n    event.preventDefault();\n    var $item = $(event.target).closest(\"li\");\n\n    if ($item.data(\"context\") === \"PLANBACK\") {\n      self.backParentPlan();\n    } else\n    {\n      if (!$item.hasClass(\"active\")) {\n        var showContextByMenuDashboard = $item.data(\"context\");\n        if (showContextByMenuDashboard) {\n\n          self.pub(\"notify\", {\n            type: showContextByMenuDashboard.toUpperCase(),\n            args: $.extend(self.params, { showContextByMenuDashboard: showContextByMenuDashboard }) });\n\n          $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\n        }\n      }\n    }\n  },\n\n  subMenuHandler: function subMenuHandler() {\n    var self = this;\n    var content = self.getContent();\n    var $comments = $(\"[data-context='PLANCOMMENTS']\", content);\n    var $files = $(\"[data-context='PLANFILES']\", content);\n    var $timeline = $(\"[data-context='PLANTIMELINE']\", content);\n\n    $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\n      $comments.toggle();\n      $files.toggle();\n      if (self.isVisibleShowTimeLine(self.planState)) {\n        $timeline.toggle();\n      }\n    });\n  },\n\n  backParentPlan: function backParentPlan() {\n    var self = this;\n    //when a plan created from an activity is deleted, not created from a case\n    var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\n    var currentLevelNavigator = parseInt(getLevelNavigator[0]);\n    var params = self.projectDashboard.getParamsByBackFromPlan(self.params, currentLevelNavigator);\n\n    self.pub(\"notify\", {\n      type: params.typeContext,\n      args: $.extend(self.params, params.paramsNotify) });\n\n\n  },\n\n  handlerEvents: function handlerEvents() {\n    var self = this;\n    var content = self.getContent();\n\n    self.subMenuHandler();\n\n    $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\", $.proxy(self.loadContentById, self));\n  },\n\n  clean: function clean() {\n    var self = this;\n    var content = self.getContent();\n\n    self._super();\n\n    $(\".ui-bizagi-wp-project-tab-links a\", content).off();\n\n    if (self.params && self.params.contextsLeftSidebarCaseDashboard) {\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function (context) {\n        self.unsub(context, $.proxy(self.updateView, self));\n      });\n    }\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.plan\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.projectDashboard\", bizagi.workportal.widgets.project.dashboard.menu.plan], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\n\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\") });\n\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-content-dashboard\");\n    self.content = template.render({});\n\n    return self.content;\n  },\n  postRender: function postRender() {\n    var self = this;\n\n    setTimeout(function () {\n      $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\n    }, 1000);\n\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\n\n(function ($) {\n\n  // shorten references to variables. this is better for uglification \n  var kendo = window.kendo,\n  ui = kendo.ui,\n  Widget = ui.Widget;\n\n  var ProjectAttachments = Widget.extend({\n\n    init: function init(element, options) {\n\n      var that = this;\n\n      // base call to initialize widget\n      Widget.fn.init.call(that, element, options);\n\n      that._maxFilesSize = options.maxSize;\n      that._fileList = [];\n      that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\n      that._supportFileExt = options.extensions;\n      that._uploadMaxFilesSize = options.maxSize;\n      that.upload = that._initUpload();\n      that.loadNotifier = that._initLoadNotifier();\n      that.notification = that._initNotification();\n\n      that._eventsHandler();\n\n      that._initLocalization(that.options.localization);\n    },\n\n    options: {\n      name: \"ProjectAttachments\",\n      wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\n      multiple: true,\n      dropZone: true,\n      maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\n      enabled: true,\n      localization: {} },\n\n\n    _initUpload: function _initUpload() {\n\n      var that = this,\n      options = that.options,\n      localization = options.localization || {},\n      auxNumberFilesSuccess = 0;\n\n      that._initLocalization(localization);\n\n      return this.element.kendoUpload({\n        async: {\n          saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\n          autoUpload: true },\n\n        select: function select(event) {\n          that._filterMaxFilesSize(event);\n          auxNumberFilesSuccess = 0;\n        },\n        complete: function complete() {\n          var interval = setInterval(function () {\n            if (that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0) {\n              that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\n              clearInterval(interval);\n            }\n          }, 300);\n        },\n        upload: options.upload,\n        progress: function progress(event) {\n          that._onProgressFile(event);\n        },\n        success: function success(event) {\n          that._fileList.push(event.files[0]);\n          auxNumberFilesSuccess += 1;\n          options.success(event);\n        },\n        error: function error(event) {\n          that.onErrorFile(event);\n        },\n        localization: {\n          select: localization.selectFiles,\n          dropFilesHere: localization.dropFilesHere },\n\n        multiple: options.multiple,\n        enabled: options.enabled,\n        dropZone: options.dropZone,\n        showFileList: false }).\n      data(\"kendoUpload\");\n\n    },\n\n    _initNotification: function _initNotification() {\n      return $(\"<div></div>\").kendoNotification({\n        position: {\n          pinned: true } }).\n\n      data(\"kendoNotification\");\n    },\n\n    _initLoadNotifier: function _initLoadNotifier() {\n\n      var that = this,\n      localization = that.options.localization,\n      $wrapper = that.options.wrapper;\n\n      return $wrapper.kendoWindow({\n        title: localization.notifierTitle,\n        actions: [\"Close\"],\n        animation: {\n          open: {\n            duration: 100 },\n\n          close: {\n            duration: 100 } },\n\n\n        open: function open() {\n          this.wrapper.addClass(\"project-attachments-wrapper-window\");\n        },\n        visible: false,\n        resizable: false,\n        draggable: false,\n        maxHeight: \"300px\",\n        minWidth: \"430px\" }).\n      data(\"kendoWindow\");\n\n    },\n\n    _initLocalization: function _initLocalization(objectOptionsLocalization) {\n      var that = this;\n      var optionsLocalizationByDefault = {\n        selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\n        notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\n        errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error\"),\n        errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\n        errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\n        errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", that._getSize(that._maxFilesSize)),\n        dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\n        cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\n        retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\n        close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\") };\n\n\n      $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\n    },\n\n    /**\r\n        * return maxSize in MB\r\n        * @param {*} maxSize \r\n        */\n    _getSize: function _getSize(maxSize) {\n      return Math.round(maxSize / (1024 * 1024), -1);\n    },\n\n    _onProgressFile: function _onProgressFile(event) {\n\n      var that = this;\n      var $file = that._getFileItemByUID(event.files[0].uid);\n      var percent = event.percentComplete;\n\n      $(\".k-progress\", $file).css({\n        width: percent + \"%\" });\n\n\n      $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\n\n      if (percent === 100) {$(\".k-upload-action .k-icon\", $file).hide();}\n    },\n\n    _onShowUploadNotifier: function _onShowUploadNotifier(event) {\n\n      var that = this,\n      files = event.files,\n      template = that.options.template;\n\n      that.loadNotifier.content(template.render({ files: files }));\n      that.loadNotifier.wrapper.css({\n        top: \"auto\",\n        left: \"auto\",\n        bottom: \"1em\",\n        right: \"1em\" });\n\n\n      that.loadNotifier.open();\n    },\n\n    _showNotificationCompleteUpload: function _showNotificationCompleteUpload(wrapperMessage, auxNumberFilesSuccess) {\n      var that = this;\n      if (wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\n      {\n        that._autoHideMessage(wrapperMessage);\n      }\n    },\n\n    _autoHideMessage: function _autoHideMessage(wrapperMessage) {\n      var that = this;\n      setTimeout(function () {\n        wrapperMessage.fadeOut(function () {\n          that.loadNotifier.close();\n        });\n      }, 2000);\n    },\n\n    _onCancelFile: function _onCancelFile($target) {\n      var that = this,\n      $fileWrapper = $target.closest(\"li\"),\n      $uploadWrapper = that.upload.wrapper,\n      guid = $fileWrapper.data(\"guid\");\n\n      $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\n      $fileWrapper.remove();\n    },\n\n    _onRemoveFile: function _onRemoveFile($target) {\n      var $fileWrapper = $target.closest(\"li\");\n      $fileWrapper.remove();\n    },\n\n    _onRetryFile: function _onRetryFile($target) {\n      var that = this;\n      var $file = $target.closest(\"li\");\n      var guid = $file.data(\"guid\");\n      var file = $.grep(that._fileList, function (i) {\n        return i.uid === guid;\n      });\n\n      that.options.retry(file[0]);\n    },\n\n    onErrorFile: function onErrorFile(event) {\n\n      var that = this,\n      localization = that.options.localization,\n      file = event.files[0],\n      validation = that._isValidFile(file);\n      var message = validation.message !== \"\" ? validation.message : localization.errorUpload;\n\n      that.setStatus(\"ERROR\", file.uid, message);\n    },\n\n    _isValidFile: function _isValidFile(file) {\n\n      var that = this,\n      localization = that.options.localization,\n      valid = true,\n      message = \"\";\n\n      if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0) {\n        message = localization.errorSize;\n        valid = false;\n      }\n\n      if (!that._onlyValidateServerFileExtension) {\n        if ($.inArray(file.extension, that._supportFileExt) === -1) {\n          message = localization.errorSecurity;\n          valid = false;\n        }\n      }\n\n      return {\n        valid: valid,\n        message: message };\n\n    },\n\n    _filterMaxFilesSize: function _filterMaxFilesSize(event) {\n\n      var that = this;\n      var total = 0;\n\n      for (var i = 0, length = event.files.length; i < length; i++) {\n        total += event.files[i].size;\n      }\n      if (total > that._maxFilesSize) {\n        that._notifySizeExceeded();\n        event.preventDefault();\n      } else {\n        that._onShowUploadNotifier(event);\n      }\n    },\n\n    _notifySizeExceeded: function _notifySizeExceeded() {\n\n      var that = this;\n\n      that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\n    },\n\n    _getFileItemByUID: function _getFileItemByUID(uid) {\n      var that = this;\n      return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\n    },\n\n    _switchEvents: function _switchEvents(event) {\n      var that = this;\n      var $target = $(\".k-icon\", event.currentTarget);\n      if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\n        that._onRemoveFile($target);\n      } else if ($target.hasClass(\"k-retry\")) {\n        that._onRetryFile($target);\n      } else if ($target.hasClass(\"k-cancel\")) {\n        that._onCancelFile($target);\n      }\n    },\n\n    _eventsHandler: function _eventsHandler() {\n      var that = this;\n\n      that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\n        that._switchEvents(event);\n      });\n    },\n\n    cancelFilesUpload: function cancelFilesUpload() {\n      var that = this;\n      var $uploadWrapper = that.upload.wrapper;\n\n      $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\n      that.close();\n    },\n\n    close: function close() {\n      this.loadNotifier.close();\n    },\n\n    destroy: function destroy() {\n      this.loadNotifier.destroy();\n      this.upload.destroy();\n    },\n\n    setStatus: function setStatus(status, uid, message) {\n\n      var $file = this._getFileItemByUID(uid),\n      localization = this.options.localization;\n\n      switch (status) {\n        case \"SUCCESS\":\n          $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\n          $(\".k-errormsg\", $file).text(\"\");\n          break;\n        case \"ERROR\":\n          $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\n          $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\n          $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\n          break;\n        case \"RETRY\":\n          $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\n          $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\n          $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\n          break;}\n\n    } });\n\n\n\n  ui.plugin(ProjectAttachments);\n})(jQuery);","/*\r\n *   Name: Bizagi Workportal Desktop Project Files Controller\r\n *   Author: David Romero Estrada\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.files\", {}, {\n  /**\r\n                                                                                               *   Constructor\r\n                                                                                               */\n  init: function init(workportalFacade, dataService, params) {\n\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.plugins = {};\n    self.prefixBase64 = \"data:image/png;base64,\";\n    self.usersData = {};\n    self.currentFilesList = [];\n    self.fileDateInterval;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-files\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-wrapper\"),\n      \"project-files-uploaditem\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-uploaditem\"),\n      \"project-files-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-list\"),\n      \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\") });\n\n  },\n\n  /**\r\n     * Renders the template defined in the widget\r\n     */\n  renderContent: function renderContent() {\n    var self = this;\n    var templateHomeFiles = self.getTemplate(\"project-files\");\n    self.content = templateHomeFiles.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) });\n    return self.content;\n  },\n\n  /**\r\n     * Post render and links events with handlers\r\n     */\n  postRender: function postRender() {\n    var self = this;\n    $.when(self.renderFilesList()).done(function () {\n      self.plugins[\"uploadFiles\"] = self.initializeUploadFiles();\n      self.eventsHandler();\n      self.restrictedEventsHandler();\n    });\n  },\n\n  /**\r\n     *   Render Files List\r\n     */\n  renderFilesList: function renderFilesList() {\n    var self = this;\n    var defer = $.Deferred();\n    var filesLength = self.currentFilesList.length;\n    var params = {\n      globalParent: self.radNumber,\n      dateTime: !filesLength ? self.getDateServer() : self.currentFilesList[filesLength - 1].date,\n      count: 12 };\n\n    if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\n      params.globalParent = self.params.plan.id;\n    }\n    $.when(self.dataService.getFilesListByRadNumber(params)).done(function (files) {\n      self.currentFilesList = self.currentFilesList.concat(files);\n\n      self.renderFiles(files);\n\n      defer.resolve();\n    });\n\n    return defer.promise();\n  },\n\n  /**\r\n     * Render Files\r\n     */\n  renderFiles: function renderFiles(files) {\n\n    var self = this;\n\n    var $content = self.getContent();\n    var $showMoreWrapper = $(\"#project-files-showmore\", $content);\n    self.displayFileList(files, \"append\");\n    self.updateRelativeTime();\n\n    if (files.length) {\n      self.setAdditionalData(files);\n    }\n\n    if (self.currentFilesList.length >= 12) {\n      $showMoreWrapper.show();\n\n      if (files.length < 12) {\n        $(\"button\", $showMoreWrapper).remove();\n        $(\"#project-files-nomore\", $showMoreWrapper).show();\n      }\n    }\n\n    self.notifyFilesNumber(false);\n  },\n\n  /**\r\n     * Render no files\r\n     */\n  renderNoFiles: function renderNoFiles() {\n\n    var self = this;\n    var noFilesTmpl = self.workportalFacade.getTemplate(\"info-message\");\n    var message = self.resources.getResource(\"workportal-project-files-noavailable\");\n\n    /* self.disableSideBar();*/\n\n    var $noFiles = $.tmpl(noFilesTmpl, {\n      message: message });\n\n\n    self.content.html($noFiles);\n  },\n\n  /**\r\n     * Initialize upload files\r\n     */\n  initializeUploadFiles: function initializeUploadFiles() {\n    var self = this;\n    var content = self.getContent();\n\n    return $(\"#project-files-upload\", content).kendoProjectAttachments({\n      saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\n      template: self.getTemplate(\"project-attachments\"),\n      success: $.proxy(self.onSuccessFile, self),\n      upload: $.proxy(self.addFileData, self),\n      retry: $.proxy(self.onSaveFileData, self),\n      enabled: true,\n      extensions: self.supportFileExt,\n      maxSize: self.uploadMaxFilesSize }).\n    data(\"kendoProjectAttachments\");\n  },\n\n  /**\r\n     * Set Additional Data For Files\r\n     */\n  setAdditionalData: function setAdditionalData(files) {\n\n    var self = this;\n    var thumbnails = [],users = [],guidsUsers = [];\n\n    for (var i = 0, length = files.length - 1; i <= length; i++) {\n      users.push(files[i].user);\n      guidsUsers.push(files[i].user);\n      thumbnails.push(files[i].attachment.guid);\n    }\n\n    self.setUserData(guidsUsers.join());\n    self.setThumbnails(thumbnails.join());\n  },\n\n  /**\r\n     * Set User Data\r\n     */\n  setUserData: function setUserData(users) {\n    var self = this;\n    var $content = self.getContent();\n\n    var params = {\n      usersGuids: users,\n      width: 50,\n      height: 50 };\n\n\n    $.when(self.dataService.getUsersData(params)).done(function (users) {\n      for (var i = 0, length = users.length - 1; i <= length; i++) {\n        if (users[i].picture) {\n          users[i].picture = self.prefixBase64 + users[i].picture;\n        }\n        self.usersData[\"id\" + users[i].id] = users[i];\n        $(\"#project-files-list .ui-bizagi-wp-project-files-user[data-userId=\" + users[i].id + \"]\", $content).text(users[i].name);\n      }\n    });\n  },\n\n  /**\r\n     * Get file list \r\n     */\n  getFileInfoByGuid: function getFileInfoByGuid(guid) {\n    var self = this;\n    var file;\n    for (var i = 0, length = self.currentFilesList.length; i < length; i++) {\n\n      if (guid === self.currentFilesList[i].guid) {\n        file = self.currentFilesList[i];\n        i = length;\n      }\n    }\n    return file;\n  },\n\n  /**\r\n     * Set Thumbnails\r\n     */\n  setThumbnails: function setThumbnails(thumbnails) {\n    var self = this;\n    var $content = self.getContent();\n\n    var params = {\n      guids: thumbnails,\n      width: 480,\n      height: 150,\n      globalParent: self.params.radNumber };\n\n\n    $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\n      var thumbnail, $wrapper, $img;\n\n      $.each(files, function (guid, src) {\n        guid = guid.toLowerCase();\n        thumbnail = self.prefixBase64 + src;\n        $wrapper = $(\"#project-files-list .ui-bizagi-wp-project-files-wrapitem[data-attchGuid=\" + guid + \"]\", $content);\n        $img = $(\".ui-bizagi-wp-project-files-thumbnail\", $wrapper);\n\n        $img.prop(\"src\", thumbnail);\n        $(\".ui-bizagi-wp-project-files-icon\", $wrapper).remove();\n        $img.css(\"display\", \"block\");\n      });\n    });\n  },\n\n  /**\r\n     * Set Preview\r\n     */\n  setFilePreview: function setFilePreview($target, guidAttch, guidFile) {\n\n    var self = this;\n    var img = \"\";\n    var params = {\n      guids: [guidAttch].join(),\n      width: 500,\n      height: 500,\n      globalParent: self.params.radNumber };\n\n\n    $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\n      var $userTag = $target.find(\".ui-bizagi-wp-project-files-user\");\n      var userId = $userTag.data(\"userid\");\n\n      $.each(files, function (guid, src) {\n        img = self.prefixBase64 + src;\n      });\n\n      self.pub(\"notify\", {\n        type: \"FILEPREVIEW\",\n        args: {\n          radNumber: self.radNumber,\n          fileData: self.getFileInfoByGuid(guidFile),\n          userData: self.usersData[\"id\" + userId],\n          isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\n          img: img } });\n\n\n\n      self.pub(\"notify\", {\n        type: \"OPEN_RIGHT_SIDEBAR\" });\n\n    });\n  },\n\n  /**\r\n     *  On Success File\r\n     */\n  onSuccessFile: function onSuccessFile(event) {\n\n    var self = this;\n    var status = event.XMLHttpRequest.response ? JSON.parse(event.XMLHttpRequest.response) : {};\n\n    if (!status.error) {\n      self.onSaveFileData(event.files[0]);\n    } else {\n      self.plugins[\"uploadFiles\"].onErrorFile(event);\n    }\n  },\n\n  /**\r\n     * On Save File Data\r\n     */\n  onSaveFileData: function onSaveFileData(file) {\n\n    var self = this;\n\n    $.when(self.saveFileData(file)).done(function () {\n      self.notifyFilesNumber();\n      self.plugins[\"uploadFiles\"].setStatus(\"SUCCESS\", file.uid);\n    }).fail(function () {\n      self.plugins[\"uploadFiles\"].setStatus(\"RETRY\", file.uid);\n    });\n  },\n\n  /**\r\n      * Retry file\r\n      * @param $target\r\n      */\n  onRetryFile: function onRetryFile($target) {\n    var self = this;\n    var $file = $target.closest(\"li\");\n    var guid = $file.data(\"guid\");\n\n    var file = $.grep(self.currentFilesList, function (i) {\n      return i.uid === guid;\n    });\n\n    self.onSaveFileData($file, file[0]);\n  },\n\n  /**\r\n      * Add Guid to Files Data\r\n      * @param event\r\n      */\n  addFileData: function addFileData(event) {\n    var self = this;\n\n    //add guid to send\n    event.data = {\n      guid: event.files[0].uid };\n\n  },\n\n  /**\r\n      * Save Files\r\n      * @param file\r\n      * @return {*}\r\n      */\n  saveFileData: function saveFileData(file) {\n\n    var self = this;\n    var defer = $.Deferred();\n\n    var guid = Math.guid();\n    var globalParent = self.radNumber ? self.radNumber.toString() : \"\";\n    if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\n      globalParent = self.params.plan.id;\n    }\n\n    var params = {\n      \"content\": {\n        \"guid\": guid,\n        \"description\": \"\",\n        \"name\": file.name,\n        \"attachment\": {\n          \"guid\": file.uid,\n          \"name\": file.name },\n\n        \"date\": self.getDateServer(),\n        \"user\": bizagi.currentUser.idUser,\n        \"globalParent\": globalParent },\n\n      \"attachmentsToCreate\": [\n      file.uid] };\n\n\n\n    self.currentFilesList.unshift(file);\n\n    $.when(self.dataService.createProjectFile(params)).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n\n        //extend file data\n        $.extend(file, {\n          user: bizagi.currentUser.idUser,\n          userName: bizagi.currentUser.userName,\n          date: new Date().getTime(),\n          attachment: params.content.attachment,\n          guid: params.content.guid,\n          description: params.content.description });\n\n\n        self.usersData[\"id\" + bizagi.currentUser.idUser] = {\n          picture: bizagi.currentUser.photo,\n          name: bizagi.currentUser.userName,\n          id: bizagi.currentUser.idUser };\n\n\n        self.displayFileList(file, \"prepend\");\n\n        self.updateRelativeTime();\n        self.setThumbnails(file.uid);\n\n        defer.resolve();\n      } else {\n\n        defer.reject();\n      }\n    });\n\n    return defer;\n  },\n\n  /**\r\n      * Display File List\r\n      * @param files\r\n      * @param action\r\n      */\n  displayFileList: function displayFileList(files, action) {\n    var self = this;\n    var tmpl = self.getTemplate(\"project-files-list\");\n    var files = files || self.currentFilesList;\n    var content = self.getContent();\n    var $filesList = tmpl.render({\n      files: files });\n\n\n    $(\"#project-files-list\", content)[action]($filesList);\n    $.equalizeHeights(\".bz-card\");\n  },\n\n  /**\r\n      * Delete file\r\n      * @param event\r\n      * @param params\r\n      */\n  deleteFile: function deleteFile(event, params) {\n    var self = this;\n\n    var content = self.getContent();\n    $(\"div[data-fileguid='\" + params.args.guid + \"']\", content).remove();\n\n    self.currentFilesList = self.currentFilesList.filter(function (file) {\n      return file.guid !== params.args.guid;\n    });\n\n    self.notifyFilesNumber(true);\n  },\n\n  /**\r\n      * Update File Data\r\n      * @param event\r\n      * @param params\r\n      */\n  updateFileData: function updateFileData(event, params) {\n\n    var self = this;\n    var file = self.getFileInfoByGuid(params.args.guid);\n\n    file.description = params.args.description;\n  },\n\n  /**\r\n     * Update relative time\r\n     */\n  updateRelativeTime: function updateRelativeTime() {\n\n    var self = this;\n\n    if (self.fileDateInterval) clearInterval(self.fileDateInterval);\n\n    self.fileDateInterval = setInterval($.proxy(self.changeRelativeTime, self), \"7000\");\n  },\n\n  /**\r\n     * Change Relative Time\r\n     */\n  changeRelativeTime: function changeRelativeTime() {\n\n    var self = this;\n    var $content = self.getContent();\n\n    $(\"#project-files-list .ui-bizagi-wp-project-files-date\", $content).each(function (i, item) {\n      var dateTime = $(item).data(\"date\");\n      var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(dateTime), null, false);\n\n      $(item).text(relativeTime);\n    });\n  },\n\n  /**\r\n      * Filter files by some criteria\r\n      * @param event\r\n      */\n  onSelectFiles: function onSelectFiles(event) {\n\n    var self = this,\n    bannedFiles = [],\n    files = event.files;\n\n    for (var i = files.length - 1; i >= 0; i--) {\n\n      if (!self.isValidFile(files[i]).valid) {\n        var bannedFile = files.splice(i, i + 1);\n        bannedFiles.unshift(bannedFile[0]);\n      }\n    }\n\n    if (bannedFiles.length > 0) {\n      self.showFilesError(bannedFiles);\n    }\n  },\n\n  /**\r\n      * Reset widget\r\n      */\n  resetWidget: function resetWidget() {\n\n    var self = this;\n    if (self.plugins[\"uploadFiles\"]) {\n      self.plugins[\"uploadFiles\"].close();\n    }\n    self.currentFilesList = [];\n    clearInterval(self.fileDateInterval);\n  },\n\n  /**\r\n     * Switch Events\r\n     */\n  switchFilesEvents: function switchFilesEvents(event) {\n\n    event.stopPropagation();\n\n    var self = this;\n\n    var $target = $(event.target),\n    $item = $target.closest(\".ui-bizagi-wp-project-files-wrapitem\");\n\n    if ($item.length) {\n\n      var guidAttch = $item.data(\"attchguid\"),\n      guidFile = $item.data(\"fileguid\");\n\n      if ($target.hasClass(\"ui-bizagi-wp-project-files-file\")) {\n        var fileName = $target.text();\n\n        self.dataService.getDownloadAttachment(guidAttch, fileName);\n      } else {\n        self.setFilePreview($item, guidAttch, guidFile);\n      }\n\n    } else if ($target.parent().prop(\"id\") === \"project-files-showmore\") {\n      self.renderFilesList();\n    } else if ($target.prop(\"id\") !== \"project-files-upload\") {\n      self.notifyFilesNumber(true);\n    }\n\n  },\n\n  /**\r\n      * Show number files to right sidebar\r\n      * @param mandatory\r\n      */\n  notifyFilesNumber: function notifyFilesNumber(mandatory) {\n    var self = this;\n\n    self.pub(\"notify\", {\n      type: \"SETFILESNUMBER\",\n      args: {\n        filesNumber: self.currentFilesList.length,\n        mandatory: mandatory } });\n\n\n  },\n\n  /**\r\n      * Restricted Event Handler\r\n      */\n  restrictedEventsHandler: function restrictedEventsHandler() {\n    var self = this;\n    self.content.on(\"click\", $.proxy(self.switchFilesEvents, self));\n  },\n\n  /**\r\n     *  Events Handler\r\n     */\n  eventsHandler: function eventsHandler() {\n\n    var self = this;\n    var $content = self.getContent();\n\n    self.sub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\n    self.sub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\n    self.sub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\n\n    $content.on(\"click\", $.proxy(self.switchFilesEvents, self));\n  },\n\n  /**\r\n     * Clean\r\n     */\n  clean: function clean() {\n    var self = this;\n    self.resetWidget();\n\n    self.unsub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\n    self.unsub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\n    self.unsub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\n\n    for (var i in self.plugins) {\n      if (self.plugins[i])\n      self.plugins[i].destroy();\n    }\n\n    clearInterval(self.fileDateInterval);\n    self._super();\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.files\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.files], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project File Preview\r\n *   Author: David Romero Estrada\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.filesPreview\", {}, {\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, notifier, params) {\n    var self = this;\n\n    //Regional\n    self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\n\n    self.dialogBox = {};\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n    self.notifier = notifier;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-filespreview-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-wrapper\"),\n      \"project-filespreview-preview\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-preview\"),\n      \"project-filespreview-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-popup\"),\n      \"project-filespreview-thenumber\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-thenumber\") });\n\n  },\n\n  /**\r\n     * Renders the template defined in the widget\r\n     */\n  renderContent: function renderContent() {\n    var self = this;\n    var generalTmpl = self.getTemplate(\"project-filespreview-wrapper\");\n\n    self.content = generalTmpl.render();\n\n    self.sub(\"SETFILESNUMBER\", $.proxy(self.setFilesNumber, self));\n\n    return self.content;\n  },\n\n  /**\r\n     * links events with handlers\r\n     */\n  postRender: function postRender() {\n    var self = this;\n\n    self.plugins.fileEdition = self.initPluginPopupEdition();\n\n    self.form = {\n      description: $(\"#ui-bizagi-wp-project-filespreview-popup-description\", self.plugins.fileEdition),\n      image: $(\".ui-bizagi-wp-project-popupform-user-image\", self.plugins.fileEdition),\n      cancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.fileEdition),\n      edit: $(\"#ui-bizagi-wp-project-popupform-action-editfile\", self.plugins.fileEdition) };\n\n\n    self.eventsHandler();\n  },\n\n  setFilesNumber: function setFilesNumber(event, params) {\n    var self = this;\n    var parameters = params.args;\n\n    if ($.isEmptyObject(self.currentFile) || parameters.mandatory) {\n      var tmpl = self.getTemplate(\"project-filespreview-thenumber\");\n      var $filesNumber = tmpl.render({ filesNumber: parameters.filesNumber });\n      self.currentFile = {};\n      $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html($filesNumber);\n    }\n  },\n\n  initPluginPopupEdition: function initPluginPopupEdition() {\n    var self = this;\n    var tmpl = self.getTemplate(\"project-filespreview-popup\");\n\n    self.dialogBox.formContent = tmpl.render();\n\n    return self.dialogBox.formContent;\n  },\n\n  showPreview: function showPreview(event, params) {\n    var self = this;\n    var template = self.getTemplate(\"project-filespreview-preview\");\n    self.currentFile = params.args;\n\n    var content = template.render($.extend(params.args, { idCurrentUser: bizagi.currentUser.idUser }));\n\n    $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html(content);\n    self.applyMenu();\n  },\n\n  setEditionData: function setEditionData() {\n    var self = this;\n    self.form.description.val(self.currentFile.fileData.description);\n    if (self.currentFile.userData.picture) {\n      self.form.image.prop(\"src\", self.currentFile.userData.picture);\n    }\n  },\n\n  eventsHandler: function eventsHandler() {\n    var self = this;\n    self.form.cancel.on(\"click\", $.proxy(self.onResetFileForm, self));\n    self.form.edit.on(\"click\", $.proxy(self.onSaveEdition, self));\n    self.sub(\"FILEPREVIEW\", $.proxy(self.showPreview, self));\n  },\n\n  onSelectMenu: function onSelectMenu(event, ui) {\n    var self = this;\n    if ($(event.currentTarget).find(\"i\").length === 0) {\n      var item = $(ui.item).data(\"item\");\n      switch (item) {\n        case \"edit\":\n          self.onOpenEdition();\n          break;\n        case \"delete\":\n          self.onDeleteFile();\n          break;\n        case \"download\":\n          self.onDownloadFile();\n          break;}\n\n    }\n  },\n\n  onDownloadFile: function onDownloadFile() {\n    var self = this;\n    self.dataService.getDownloadAttachment(self.currentFile.fileData.attachment.guid, self.currentFile.fileData.name);\n  },\n\n  onOpenEdition: function onOpenEdition() {\n    var self = this;\n\n    self.dialogBox.formContent.dialog({\n      resizable: false,\n      draggable: false,\n      height: \"auto\",\n      width: \"650px\",\n      modal: true,\n      title: bizagi.localization.getResource(\"workportal-project-files-editfile\"),\n      maximize: true,\n      close: function close() {\n        self.onResetFileForm();\n      } });\n\n\n    self.setEditionData();\n    self.form.description.focus();\n  },\n\n  onDeleteFile: function onDeleteFile() {\n    var self = this;\n    $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-file-querydelete\"), \"\", \"info\")).done(function () {\n      var params = {\n        content: {\n          guid: self.currentFile.fileData.guid },\n\n        attachmentsToDelete: [self.currentFile.fileData.attachment.guid] };\n\n\n      $.when(self.dataService.deleteFile(params)).always(function (response) {\n        if (response.status === 200 || response.status === 201 || response.status === undefined) {\n          self.pub(\"notify\", {\n            type: \"DELETEFILE\",\n            args: {\n              guid: params.content.guid } });\n\n\n        }\n      });\n    });\n  },\n\n  onSaveEdition: function onSaveEdition() {\n    var self = this;\n    if (self.validateAddFileDescriptionForm(self.form.description)) {\n      self.currentFile.fileData.description = self.form.description.val();\n\n      var params = {\n        \"content\": {\n          \"guid\": self.currentFile.fileData.guid,\n          \"description\": self.currentFile.fileData.description,\n          \"attachment\": self.currentFile.fileData.attachment,\n          \"name\": self.currentFile.fileData.name,\n          \"date\": self.currentFile.fileData.date,\n          \"user\": bizagi.currentUser.idUser,\n          \"globalParent\": self.currentFile.radNumber } };\n\n\n\n      $.when(self.dataService.updateProjectFile(params)).always(function (response) {\n        if (response.status === 200 || response.status === 201 || response.status === undefined) {\n          $(\"#ui-bizagi-wp-project-filespreview-description\", self.content).text(params.content.description);\n\n          self.onResetFileForm();\n          self.notifier.showSucessMessage(\n          printf(bizagi.localization.getResource(\"workportal-project-files-editionsuccess\"), \"\"));\n\n          self.pub(\"notify\", {\n            type: \"UPDATEFILE\",\n            args: {\n              description: params.content.description,\n              guid: params.content.guid } });\n\n\n        } else {\n          self.onResetFileForm();\n          self.notifier.showErrorMessage(\n          printf(bizagi.localization.getResource(\"workportal-general-error-generic\"), \"\"));\n        }\n      });\n    }\n  },\n\n  validateAddFileDescriptionForm: function validateAddFileDescriptionForm($description) {\n    var result = false,\n    $textAreadescription = $description;\n    if ($textAreadescription.val().trim() === \"\") {\n      var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\n      $textAreadescription.parent().next().find(\"span\").html(descriptionValidation);\n    } else\n    {\n      $textAreadescription.parent().next().find(\"span\").empty();\n      result = true;\n    }\n    return result;\n  },\n\n  onResetFileForm: function onResetFileForm() {\n    var self = this;\n    self.form.description.parent().next().find(\"span\").empty();\n    self.dialogBox.formContent.dialog(\"destroy\");\n    self.dialogBox.formContent.detach();\n  },\n\n  applyMenu: function applyMenu() {\n    var self = this;\n\n    $(\".ui-bizagi-wp-project-filespreview-edit\", self.content).menu({\n      select: $.proxy(self.onSelectMenu, self) }).\n    removeClass(\"ui-widget-content\");\n  },\n\n  clean: function clean() {\n    var self = this;\n\n    self.plugins = {};\n    self.form = {};\n    self.currentFile = {};\n    self.filesNumber = 0;\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.filesPreview\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.filesPreview]);","/*\r\n *   Name: Bizagi Workportal project File Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.file.sidebar\", {}, {\n\n  /*\r\n                                                                                                *   Constructor\r\n                                                                                                */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    params = params || {};\n    params.supportNav = false;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-file-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.file.sidebar\").concat(\"#project-file-sidebar\") });\n\n\n  },\n\n  /*\r\n     *   Returns the widget name\r\n     */\n  getWidgetName: function getWidgetName() {\n    return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR;\n  },\n\n  /*\r\n     * Renders the template defined in the widget\r\n     */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-file-sidebar\");\n    self.content = template.render({});\n\n    return self.content;\n  } });\n\n\nbizagi.injector.register('bizagi.workportal.widgets.project.file.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.file.sidebar], true);"]}