{"version":3,"sources":["jquery/workportal/desktop/widget/project.plan.activities.form/bizagi.workportal.desktop.widgets.project.plan.activities.form.js"],"names":["bizagi","workportal","widgets","project","base","extend","init","workportalFacade","dataService","notifier","params","this","_super","dateFormat","localization","getResource","timeFormat","estimatedFinishDateTime","MAX_HOURS","plugins","form","loadTemplates","plan-activities-main","getTemplate","concat","plan-activity-items","renderContent","tmpl","plan","contextualized","content","render","postRender","self","$content","getContent","sub","getDataActivityForm","name","$","description","assignee","date","duration","allowEdition","sendNotification","cancel","initializeAutoComplete","initializeDatePicker","initializeSpiner","on","proxy","addNewItem","eventsHandler","initializeItems","arrayItems","templateItems","argsTemplate","items","contentItem","listItems","empty","append","onSaveForm","element","url","serviceLocator","getUrl","autocomplete","minLength","source","request","response","ajax","data","domain","userName","fullName","term","organization","pag","pagSize","orderField","success","map","users","item","label","user","value","idUser","fitList","select","event","ui","val","IdAssignee","pub","type","args","focus","change","window","blur","setTimeout","ul","dif","height","position","top","css","max-height","overflow","datepicker","onSelect","getTime","undefined","onClose","fieldDurationActive","util","dateFormatter","getDateFormatByDatePickerJqueryUI","spinTimer","idActivitySelected","clone","desactivateDateByDuration","newValue","target","isNumeric","parseInt","spinner","min","max","placeHolder","spin","clearTimeout","onKeyPressInputItem","siblings","text","prop","code","keyCode","which","setFocusItemEditing","find","auxValuePlaceCursorEndText","setFocusNextItem","closest","removeClass","next","addClass","setFocusPrevItem","prev","toString","indexItemEdited","index","length","remove","onFocusInputItem","onFocusOutInputItem","trim","$item","animate","backgroundColor","onMouseLeaveItem","onClickDeleteItem","off","nameItem","indexAppend","children","eq","after","onDeleteDate","onTypeDuration","$target","getOnlyNumbersByString","validateMaxHoursDurationField","onCancelForm","preventDefault","_defer","Deferred","dataFormActivity","resolve","bind","when","editActivityPlan","always","_","responseText","xhr","status","showSucessMessage","printf","reject","done","onChangeActivityName","validateParams","idUserAssigned","currentUser","is","currentActivity","each","activities","arrayNamesItem","id","_idActivitySelected","userAssigned","userAssignedGuid","estimatedFinishDate","push","resolved","numTotalItems","nameValidation","html","_idActivitySelectedValue","onChangeForm","_getDefferResolved","idActivityToShow","activityToShow","filter","activity","setValuesFormFields","isEditableFormActivity","setEnabledFormFields","displayName","show","activateElement","hide","deactivateElement","activityDate","isEmpty","getDateFromInvariant","isNaN","Date","isMinimumDate","getDateServer","reset","decodeHtmlEntities","setUserAssignedIDGuid","parent","$inputDuration","state","$el","enable","wrapper","guidUser","callGetDataUsers","then","responseUsers","donetyping","csvguidUsers","defer","usersGuids","width","getUsersData","promise","clean","unsub","injector","register","desktop"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activities Form\r\n *   Author: David Romero Estrada\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.desktop.widgets.project.plan.activities.form\", {}, {\n\n  /**\r\n                                                                                                                       *   Constructor\r\n                                                                                                                       */\n  init: function init(workportalFacade, dataService, notifier, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.dateFormat = bizagi.localization.getResource(\"dateFormat\");\n    self.timeFormat = bizagi.localization.getResource(\"timeFormat\");\n    self.estimatedFinishDateTime; //Save complete date and time, because datepicker dont save time\n\n    self.MAX_HOURS = 9999999;\n\n    self.plugins = {};\n    self.form = {};\n    self.notifier = notifier;\n    // Load templates\n    self.loadTemplates({\n      \"plan-activities-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activities.form\").concat(\"#project-plan-activities-form\"),\n      \"plan-activity-items\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activities.form\").concat(\"#project-activity-items\") });\n\n  },\n\n  /**\r\n      * Render content\r\n      * @returns {*}\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    var tmpl = self.getTemplate(\"plan-activities-main\");\n    self.params.plan.contextualized = typeof self.params.plan.contextualized === \"undefined\" ? true : self.params.plan.contextualized;\n    self.content = tmpl.render(self.params.plan);\n    return self.content;\n  },\n\n  /**\r\n      * Post render\r\n      */\n  postRender: function postRender() {\n\n    var self = this;\n    var $content = self.getContent();\n\n    self.sub(\"GETDATA_FORM_EDIT_ACTIVITIY\", function () {\n      return self.getDataActivityForm();\n    });\n\n    self.form = {\n      name: $(\"#activity-form-itemname\", self.content),\n      description: $(\"#activity-form-description\", self.content),\n      assignee: $(\"#activity-form-assignee\", self.content),\n      date: $(\"#activity-form-date\", self.content),\n      duration: $(\"#activity-form-duration\", self.content),\n      allowEdition: $(\"#activity-form-allowedition\", self.content),\n      sendNotification: $(\"#activity-form-send-notification\", self.content),\n      //save: $(\"#project-plan-activity-form-save\", self.content),\n      cancel: $(\"#project-plan-activity-form-cancel\", self.content) };\n\n\n    self.initializeAutoComplete(self.form.assignee);\n\n    self.initializeDatePicker(self.form.date);\n    self.initializeSpiner(self.form.duration);\n\n    //self.initilizeActionMenu();\n\n    //Activity Items\n    $(\"#link-add-new-item\", $content).on(\"click\", $.proxy(self.addNewItem, self));\n\n    self.eventsHandler();\n  },\n\n  /**\r\n      * Initialize menu plugin\r\n      */\n  /*initilizeActionMenu: function () {\r\n             var self = this;\r\n             $(\".ui-bizagi-wp-project-plan-activity-action-menu\", self.content).menu({\r\n                 select: $.proxy(self.onSelectMenu, self)\r\n             }).removeClass(\"ui-widget-content\");\r\n         },*/\n\n  /**\r\n               * Initialize items on activity\r\n               * @param arrayItems\r\n               */\n  initializeItems: function initializeItems(arrayItems) {\n    var self = this;\n    var $content = self.getContent();\n\n    var templateItems = self.getTemplate(\"plan-activity-items\");\n\n    var argsTemplate = {};\n    argsTemplate.items = arrayItems;\n\n    var contentItem = templateItems.render(argsTemplate);\n\n    var listItems = $(\".list-items\", $content);\n    listItems.empty().append(contentItem);\n    $(\".inputtext\", listItems).on(\"change\", $.proxy(self.onSaveForm, self));\n\n  },\n\n  /**\r\n      * Initialize autocomplete plugin for load users\r\n      * @param element\r\n      */\n  initializeAutoComplete: function initializeAutoComplete(element) {\n    var self = this;\n    var url = self.dataService.serviceLocator.getUrl(\"admin-getUsersListForPlans\");\n    element.autocomplete({\n      minLength: 2,\n      source: function source(request, response) {\n        $.ajax({\n          url: url,\n          data: {\n            domain: \"\",\n            userName: \"\",\n            fullName: request.term,\n            organization: \"\",\n            pag: 1,\n            pagSize: 100,\n            orderField: \"fullName\" },\n\n          success: function success(data) {\n            response($.map(data.users, function (item) {\n              return {\n                label: item.user,\n                value: item.idUser };\n\n            }));\n            self.fitList();\n          } });\n\n      },\n      select: function select(event, ui) {\n        var name = ui.item.label;\n        element.val(name);\n        self.form.IdAssignee = ui.item.value;\n        self.onSaveForm(event);\n        self.pub(\"notify\", {\n          type: \"UPDATE_ACTIVITY_INFO\",\n          args: { assignee: self.form.IdAssignee } });\n\n        return false;\n      },\n      focus: function focus() {\n        return false;\n      },\n      change: function change(event, ui) {\n        if (ui.item === null) {\n          self.form.IdAssignee = null;\n          self.form.assignee.val(\"\");\n        }\n        return false;\n      } });\n\n\n    // Attach Resize eventHandler for activityAssignee field\n    $(window).on('resize.activityAssignee', function () {\n      $('#activity-form-assignee', self.content).blur();\n    });\n  },\n  //Fit the list to avoid an overflow with the window\n  fitList: function fitList() {\n\n    setTimeout(function () {\n      var ul = $('body > ul.ui-autocomplete');\n      var dif = $(window).height() - $(ul).position().top - 10;\n      $(ul).css({ \"max-height\": dif + 'px',\n        overflow: 'auto' });\n    });\n  },\n\n  /**\r\n      * Initialize datepicker plugin\r\n      * @param element\r\n      */\n  initializeDatePicker: function initializeDatePicker(element) {\n    var self = this;\n    element.datepicker({\n      onSelect: function onSelect() {\n        self.form.duration.val(\"\");\n        var oneDayInterval = 24 * 60 * 60 * 1000 - 50;\n        self.estimatedFinishDateTime = self.form.date.datepicker(\"getDate\") ? self.form.date.datepicker(\"getDate\").getTime() + oneDayInterval : undefined;\n        self.onSaveForm();\n      },\n      onClose: function onClose() {\n        if (element.val() === \"\") {\n          self.fieldDurationActive(true);\n        }\n      } });\n\n    element.datepicker(\"option\", \"dateFormat\", bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI());\n  },\n\n  /**\r\n      * Initialize spiner plugin\r\n      * @param element\r\n      */\n  initializeSpiner: function initializeSpiner(element) {\n    var self = this;\n    var spinTimer; //timer identifier\n    var doneTypingInterval = 500; //time in ms, 5 second for example\n\n    //Save other reference of idActivitySelected, because this changes the first on other widget;\n    //more information: QAF-3986\n    var idActivitySelected = bizagi.clone(self.params.plan.idActivitySelected);\n\n    function desactivateDateByDuration(event, newValue) {\n      var value = newValue || $(event.target).val();\n      if (bizagi.util.isNumeric(value) && parseInt(value, 10) > 0) {\n        self.form.date.val(\"\");\n        self.estimatedFinishDateTime = undefined;\n      } else {\n        $(event.target).val(\"\");\n      }\n    }\n\n    element.spinner({\n      min: 1,\n      max: self.MAX_HOURS,\n      placeHolder: bizagi.localization.getResource(\"workportal-hours\"),\n      change: function change(event) {\n        desactivateDateByDuration(event);\n\n        //This event triggered when change select other activities\n        //Because, the implementation spinner validates previusValue (when focus) VS value on input\n        if (idActivitySelected === self.params.plan.idActivitySelected) {\n          self.onSaveForm();\n        }\n      },\n      spin: function spin(event, ui) {\n        desactivateDateByDuration(event, ui.value);\n\n        clearTimeout(spinTimer);\n        if ($('#myInput').val) {\n          spinTimer = setTimeout($.proxy(self.onSaveForm, self), doneTypingInterval);\n        }\n      } });\n\n\n  },\n\n  /**\r\n      List items\r\n      */\n  onKeyPressInputItem: function onKeyPressInputItem(event) {\n    var self = this;\n    var $content = self.getContent();\n\n    setTimeout(function () {\n      $(event.target).siblings(\".showtext\").text($(event.target).val());\n      $(event.target).prop(\"title\", $(event.target).val());\n    }, 51);\n\n    var code = event.keyCode || event.which;\n    $(\".container-items\").removeClass(\"editing-mouse\");\n\n    function setFocusItemEditing() {\n      setTimeout(function () {\n        $(\".list-items .item.edit\", $content).find(\".inputtext\").focus();\n\n        //next code fix cursor to end value text field, when focus\n        var auxValuePlaceCursorEndText = $(\".list-items .item.edit\", $content).find(\".inputtext\").val();\n        $(\".list-items .item.edit\", $content).find(\".inputtext\").val(auxValuePlaceCursorEndText);\n      }, 51);\n    }\n\n    function setFocusNextItem(event) {\n      $(event.target).closest(\".item\").removeClass(\"edit\");\n      $(event.target).closest(\".item\").next().addClass(\"edit\");\n      setFocusItemEditing();\n    }\n\n    function setFocusPrevItem(event) {\n      $(event.target).closest(\".item\").removeClass(\"edit\");\n      $(event.target).closest(\".item\").prev().addClass(\"edit\");\n      setFocusItemEditing();\n    }\n\n    switch (code.toString()) {\n      case \"13\": //Enter\n        if ($(event.target).val() !== \"\") {\n          $(event.target).closest(\".item\").removeClass(\"edit\");\n          var indexItemEdited = $(event.target).closest(\".item\").index();\n          self.addNewItem(\"\", indexItemEdited);\n        }\n        break;\n      case \"27\": //escape\n        if ($(event.target).closest(\".item\").prev().length !== 0) {\n          setFocusPrevItem(event);\n        } else\n        if ($(event.target).closest(\".item\").next().length !== 0) {\n          setFocusNextItem(event);\n        }\n        $(event.target).closest(\".item\").remove();\n        self.onSaveForm(event);\n        break;\n      case \"38\": //up\n        if ($(event.target).closest(\".item\").prev().length !== 0) {\n          setFocusPrevItem(event);\n        }\n        break;\n      case \"40\": //down\n        if ($(event.target).closest(\".item\").next().length !== 0) {\n          setFocusNextItem(event);\n        }\n        break;}\n\n\n  },\n\n  /**\r\n      * Add css class to input focus\r\n      * @param event\r\n      */\n  onFocusInputItem: function onFocusInputItem(event) {\n    $(event.target).closest(\".item\").addClass(\"edit\").siblings().removeClass(\"edit\");\n  },\n\n  /**\r\n      * Event trigger when focus out item\r\n      * @param event\r\n      */\n  onFocusOutInputItem: function onFocusOutInputItem(event) {\n    if ($.trim($(event.target).val()) === \"\") {\n      var $item = $(event.target).closest(\".item\");\n      $($item).css(\"display\", \"block\").empty().css(\"background\", \"#E7BA99\").\n      animate(\n      {\n        backgroundColor: \"#FFF\",\n        height: \"0px\" },\n      300,\n      \"linear\",\n      function () {\n        $(this).remove();\n      });\n\n    } else {\n      $(event.target).closest(\".item\").removeClass(\"edit\");\n    }\n  },\n\n  /**\r\n      * Event mouse leave on item\r\n      */\n  onMouseLeaveItem: function onMouseLeaveItem() {\n    var self = this;\n    var $content = self.getContent();\n    $(\".container-items\", $content).addClass(\"editing-mouse\");\n  },\n\n  /**\r\n      * Event trigger when delete item\r\n      * @param event\r\n      */\n  onClickDeleteItem: function onClickDeleteItem(event) {\n    var self = this;\n\n    $(event.target).closest(\".item\").off(\"keyup\", \".inputtext\", $.proxy(self.onKeyPressInputItem, self));\n    $(event.target).closest(\".item\").off(\"click\", \".item-button.delete\", $.proxy(self.onClickDeleteItem, self));\n\n    $(event.target).closest(\".item\").remove();\n\n    self.onSaveForm(event);\n  },\n\n  /**\r\n      * Add item on activity\r\n      * @param nameItem\r\n      * @param indexAppend\r\n      */\n  addNewItem: function addNewItem(nameItem, indexAppend) {\n    var self = this;\n    var $content = self.getContent();\n\n    if (indexAppend === undefined) {//If click link add Item\n      indexAppend = $(\".list-items .item\", $content).length - 1;\n      if (indexAppend === -1) {\n        indexAppend = 0;\n      }\n\n    }\n\n    var templateItems = self.getTemplate(\"plan-activity-items\");\n\n    var argsTemplate = {};\n    argsTemplate.items = [{}];\n\n    var contentItem = templateItems.render(argsTemplate);\n    $(contentItem).addClass(\"edit\");\n\n    if ($(\".list-items\", $content).children().length === 0) {\n      $(\".list-items\", $content).append(contentItem);\n    } else\n    {\n      $(\".list-items\", $content).children().eq(indexAppend).after(contentItem);\n    }\n\n    $(\".inputtext\", contentItem).on(\"change\", $.proxy(self.onSaveForm, self));\n\n    setTimeout(function () {\n      $(\".list-items .item.edit\", $content).find(\".inputtext\").focus();\n    }, 51);\n  },\n\n  /**\r\n      * Event trigger when delete date\r\n      * @param event\r\n      */\n  onDeleteDate: function onDeleteDate(event) {\n    var self = this;\n    if (event.keyCode === 8) {\n      $(event.target).val(\"\");\n      self.fieldDurationActive(true);\n    }\n  },\n\n  /**\r\n      * Event trigger when keyup duration\r\n      * @param event\r\n      */\n  onTypeDuration: function onTypeDuration(event) {\n    var self = this;\n    var $target = $(event.target);\n    if ($target.val() !== \"\") {\n      $target.val(bizagi.util.getOnlyNumbersByString($target.val()));\n      self.validateMaxHoursDurationField($target);\n      self.form.date.val(\"\");\n      self.estimatedFinishDateTime = undefined;\n    }\n  },\n\n  /**\r\n      * When cancel form\r\n      */\n  onCancelForm: function onCancelForm() {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"PLANSIDEBAR\",\n      args: self.params });\n\n  },\n\n  /**\r\n      * Save activity\r\n      * @param event\r\n      */\n  onSaveForm: function onSaveForm(event) {\n    if (event) event.preventDefault();\n    var self = this;\n    _defer = new $.Deferred(),\n    dataFormActivity = self.getDataActivityForm(),\n    resolve = _defer.resolve.bind(null, dataFormActivity);\n    if (dataFormActivity) {\n      $.when(self.dataService.editActivityPlan(dataFormActivity)).always(function (_, responseText, xhr) {\n        if (xhr.status === 200 && responseText !== \"success\") {\n          self.notifier.showSucessMessage(printf(bizagi.localization.getResource(\"workportal-project-plan-activity-update-message\"), \"\"));\n          _defer.reject(responseText);\n        } else resolve();\n      });\n    } else _defer.reject();\n    _defer.done(self.onChangeActivityName.bind(self));\n    return _defer;\n  },\n\n  /**\r\n      * Get data current activity\r\n      * @returns {*}\r\n      */\n  getDataActivityForm: function getDataActivityForm() {\n    var self = this;\n\n    function getArrayItems() {\n      var arrayNamesItem = [];\n      $(\".list-items .inputtext\").each(function () {\n        if ($(this).val().trim() !== \"\") {\n          arrayNamesItem.push({\n            id: undefined,\n            resolved: $(this).closest(\".item\").find(\"input[type='checkbox']\").is(\":checked\"),\n            name: $(this).val() });\n\n        }\n      });\n      return arrayNamesItem;\n    }\n\n    if (self.validateParams(self.form.name.val())) {\n      var idUserAssigned = self.form.IdAssignee || bizagi.currentUser.idUser;\n      var allowEdition = self.form.allowEdition.is(\":checked\") || false;\n      var sendNotification = self.form.sendNotification.is(\":checked\");\n\n      var currentActivity = {};\n\n      $.each(self.params.plan.activities, function () {\n        if (this.id === self._idActivitySelected()) {\n          self.form.duration.val(bizagi.util.getOnlyNumbersByString(self.form.duration.val()));\n          self.validateMaxHoursDurationField(self.form.duration);\n          this.duration = self.form.duration.val();\n          this.userAssigned = idUserAssigned;\n          this.userAssignedGuid = idUserAssigned;\n          this.allowEdition = allowEdition;\n          this.sendNotification = sendNotification;\n          this.description = self.form.description.val();\n          this.name = self.form.name.val();\n          this.estimatedFinishDate = self.estimatedFinishDateTime;\n          this.items = getArrayItems();\n          this.numTotalItems = this.items.length;\n          currentActivity = this;\n        }\n      });\n\n      return currentActivity;\n    } else\n    {\n      return false;\n    }\n  },\n\n  /**\r\n      * Validate params before update activity\r\n      * @returns {boolean}\r\n      */\n  validateParams: function validateParams(name) {\n    var self = this;\n    if (name === \"\") {\n      var nameValidation = \"* \" + bizagi.localization.getResource(\"workportal-project-plan-popup-field-name-required\");\n      self.form.name.next().find(\"span\").html(nameValidation);\n      return false;\n    } else\n    {\n      self.form.name.next().find(\"span\").empty();\n      return true;\n    }\n  },\n\n  /**\r\n      * save or get idActivitySelected\r\n      * @param {String} value new value or undefined for get\r\n      */\n  _idActivitySelected: function _idActivitySelected(value) {\n    var self = this;\n    if (value !== undefined) {\n      self._idActivitySelectedValue = value;\n    }\n    return self._idActivitySelectedValue;\n  },\n\n  /**\r\n      * Event executed when load activity on form\r\n      * @param event\r\n      * @param params\r\n      */\n  onChangeForm: function onChangeForm(_, params) {\n    var self = this,\n    _getDefferResolved = function _getDefferResolved() {\n      var _defer = new $.Deferred();\n      _defer.resolve();\n      return _defer;\n    },\n    _hasSelectedActivity = self._idActivitySelected() !== undefined,\n    _defer = _hasSelectedActivity ? self.onSaveForm() : _getDefferResolved();\n\n    _defer.done(function () {\n      self.estimatedFinishDateTime = undefined;\n\n      var idActivityToShow = params.args.idActivityToShow || self.params.plan.idActivitySelected;\n      self._idActivitySelected(idActivityToShow);\n      var activityToShow = self.params.plan.activities.filter(function (activity) {\n        return activity.id === idActivityToShow;\n      })[0];\n\n      self.setValuesFormFields(params.args.isEditableFormActivity, activityToShow);\n      self.setEnabledFormFields(params.args.isEditableFormActivity, activityToShow);\n    });\n  },\n\n  /**\r\n      * notify name and id from activity for refresh activity list item\r\n      * @param {JSON} dataFormActivity activity data\r\n      */\n  onChangeActivityName: function onChangeActivityName(dataFormActivity) {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"UPDATE_ACTIVITY_INFO\",\n      args: {\n        displayName: dataFormActivity.name,\n        id: dataFormActivity.id } });\n\n\n  },\n\n  /**\r\n      * Enabled or disabled form fields\r\n      * @param isEditableFormActivity\r\n      * @param activityToShow\r\n      */\n  setEnabledFormFields: function setEnabledFormFields(isEditableFormActivity, activityToShow) {\n    var self = this;\n    $(self.form.date).blur(); //remove focus\n    if (isEditableFormActivity) {\n      $(\".ui-bizagi-wp-project-plan-activity-action-menu\", self.content).show();\n      $(\"#activity-form-itemname\", self.content).prop(\"disabled\", false);\n      $(\"#activity-form-itemname\", self.content).removeClass(\"ui-state-disabled\");\n      $(\"#activity-form-description\", self.content).prop(\"disabled\", false);\n      $(\"#activity-form-description\", self.content).removeClass(\"ui-state-disabled\");\n\n      self.form.assignee.removeClass(\"ui-state-disabled\");\n      self.activateElement(self.form.assignee);\n\n      self.fieldDurationActive(true);\n      self.activateElement(self.form.date);\n      self.form.date.removeClass(\"ui-state-disabled\");\n\n      $(\"#activity-form-allowedition\", self.content).prop(\"disabled\", false);\n      $(\"#activity-form-send-notification\", self.content).prop(\"disabled\", false);\n      $(\".container-items\", self.content).addClass(\"is-editing\");\n      $(\"#link-add-new-item\", self.content).show();\n    } else\n    {\n      $(\".ui-bizagi-wp-project-plan-activity-action-menu\", self.content).hide();\n      $(\"#activity-form-itemname\", self.content).prop(\"disabled\", true);\n      $(\"#activity-form-itemname\", self.content).addClass(\"ui-state-disabled\");\n      $(\"#activity-form-description\", self.content).prop(\"disabled\", true);\n      $(\"#activity-form-description\", self.content).addClass(\"ui-state-disabled\");\n      self.form.assignee.addClass(\"ui-state-disabled\");\n      self.deactivateElement(self.form.assignee);\n      self.deactivateElement(self.form.date);\n      self.form.date.addClass(\"ui-state-disabled\");\n      self.fieldDurationActive(false);\n      $(\"#activity-form-allowedition\", self.content).prop(\"disabled\", true);\n      $(\"#activity-form-send-notification\", self.content).prop(\"disabled\", true);\n      $(\".container-items\", self.content).removeClass(\"is-editing\");\n      $(\"#link-add-new-item\", self.content).hide();\n    }\n  },\n\n  /**\r\n      * Set values to form fields\r\n      * @param isEditableFormActivity\r\n      * @param activityToShow\r\n      */\n  setValuesFormFields: function setValuesFormFields(isEditableFormActivity, activityToShow) {\n    var self = this;\n    var activityDate = activityToShow && !bizagi.util.isEmpty(activityToShow.estimatedFinishDate) ? activityToShow.estimatedFinishDate : \"\";\n    var estimatedFinishDate = activityDate ? bizagi.util.dateFormatter.getDateFromInvariant(activityDate) : \"\";\n    if (!isNaN(activityToShow.estimatedFinishDate))\n    estimatedFinishDate = new Date(activityToShow.estimatedFinishDate);\n    var isMinimumDate = estimatedFinishDate instanceof Date ? estimatedFinishDate.getTime() < self.getDateServer() : false;\n\n    $(\"#project-plan-activity-form\", self.content)[0].reset();\n    $(\".list-items .item\", self.content).remove();\n\n    self.form.name.val(bizagi.util.decodeHtmlEntities(activityToShow.name));\n    self.form.description.val(bizagi.util.decodeHtmlEntities(activityToShow.description));\n\n    if (activityToShow.userAssigned) {\n      self.setUserAssignedIDGuid(activityToShow.userAssigned, activityToShow.userAssignedGuid);\n    }\n\n    self.form.date.datepicker(\"option\", \"minDate\", new Date(self.getDateServer()));\n\n    if (activityToShow.estimatedFinishDate && isMinimumDate) {\n      self.form.date.datepicker(\"option\", \"minDate\", estimatedFinishDate); //set minimum because, if date is past\n    }\n\n    if (activityToShow.estimatedFinishDate) {\n      self.form.date.datepicker(\"setDate\", estimatedFinishDate);\n      self.estimatedFinishDateTime = activityToShow.estimatedFinishDate;\n    }\n\n    if (activityToShow.duration) {\n      self.form.duration.val(parseInt(activityToShow.duration, 10));\n    }\n\n    if (self.params.plan.parent && self.params.plan.parent.allowEdition === false) {\n\n      activityToShow.allowEdition = false; //activityToShow.allowEdition change to false because with it it is not posible to edit the activity.\n      self.form.allowEdition.parent().hide();\n    } else {\n      //Here activityToShow.allowEdition don't change if the edition is enabled, it can have whatever value.\n      self.form.allowEdition.parent().show();\n    }\n\n    if (activityToShow.allowEdition === true) {\n      self.form.allowEdition.prop(\"checked\", true);\n    } else\n    {\n      self.form.allowEdition.prop(\"checked\", false);\n    }\n\n\n    if (activityToShow.sendNotification === true) {\n      self.form.sendNotification.prop(\"checked\", true);\n    } else\n    {\n      self.form.sendNotification.prop(\"checked\", false);\n    }\n\n    if (activityToShow.numTotalItems > 0) {\n      $(\".container-items h4\", self.content).show();\n      $(\".container-items span\", self.content).hide();\n      self.initializeItems(activityToShow.items);\n    } else\n    if (!isEditableFormActivity) {\n      $(\".container-items span\", self.content).show();\n      //$(\".container-items h4\", self.content).hide();\n    } else {\n      $(\".container-items span\", self.content).hide();\n    }\n  },\n  validateMaxHoursDurationField: function validateMaxHoursDurationField($inputDuration) {\n    var self = this;\n    if (bizagi.util.getOnlyNumbersByString($inputDuration.val()) !== '') {\n      if (parseInt($inputDuration.val()) > self.MAX_HOURS) {\n        $inputDuration.val(self.MAX_HOURS);\n      }\n    }\n  },\n\n  /**\r\n      * Active or deactive duration field\r\n      * @param state\r\n      */\n  fieldDurationActive: function fieldDurationActive(state) {\n    var self = this;\n    if (state) {\n      self.form.duration.prop(\"disabled\", false);\n      self.form.duration.spinner(\"option\", \"disabled\", false);\n    } else\n    {\n      self.form.duration.prop(\"disabled\", true);\n      self.form.duration.spinner(\"option\", \"disabled\", true);\n    }\n  },\n\n  /**\r\n      * Deactive field\r\n      * @param $el\r\n      */\n  deactivateElement: function deactivateElement($el) {\n    if ($el.prop) {\n      $el.prop(\"disabled\", true);\n      $el.closest(\"tr\").addClass(\"ui-bizagi-workportal-opacity\");\n    } else\n    {\n      $el.enable(false);\n      $el.wrapper.closest(\"tr\").addClass(\"ui-bizagi-workportal-opacity\");\n    }\n  },\n\n  /**\r\n      * Active element\r\n      * @param $el\r\n      */\n  activateElement: function activateElement($el) {\n    if ($el.prop) {\n      $el.prop(\"disabled\", false);\n      $el.closest(\"tr\").removeClass(\"ui-bizagi-workportal-opacity\");\n    } else\n    {\n      $el.enable(true);\n      $el.wrapper.closest(\"tr\").removeClass(\"ui-bizagi-workportal-opacity\");\n    }\n  },\n\n  /**\r\n      * Set User Id to form\r\n      * @param idUser\r\n      */\n  setUserAssignedIDGuid: function setUserAssignedIDGuid(idUser, guidUser) {\n    var self = this;\n    //Show images users\n    self.callGetDataUsers(idUser).then(function (responseUsers) {\n      self.form.assignee.val(responseUsers[0].name);\n    });\n    self.form.IdAssignee = idUser;\n    //self.form.GuidAssignee = guidUser;\n  },\n\n\n  /**\r\n      * Set events to items and plugins\r\n      */\n  eventsHandler: function eventsHandler() {\n    var self = this;\n\n    self.form.date.on(\"keydown\", $.proxy(self.onDeleteDate, self));\n    self.form.duration.on(\"keyup\", $.proxy(self.onTypeDuration, self));\n    self.form.cancel.on(\"click\", $.proxy(self.onCancelForm, self));\n\n    //Autosave input, checkbox type fields\n    self.form.name.on(\"change\", $.proxy(self.onSaveForm, self));\n    self.form.name.on(\"blur\", $.proxy(self.onSaveForm, self));\n    self.form.description.on(\"change\", $.proxy(self.onSaveForm, self));\n    self.form.allowEdition.on(\"change\", $.proxy(self.onSaveForm, self));\n    self.form.sendNotification.on(\"change\", $.proxy(self.onSaveForm, self));\n\n    self.form.description.donetyping(function () {\n      self.onSaveForm();\n    });\n\n    self.form.duration.donetyping(function () {\n      self.onSaveForm();\n    });\n\n    //Events List items\n    $(\".list-items\", self.content).on(\"keyup\", \".inputtext\", $.proxy(self.onKeyPressInputItem, self));\n    $(\".list-items\", self.content).on(\"focusout\", \".inputtext\", $.proxy(self.onFocusOutInputItem, self));\n    $(\".list-items\", self.content).on(\"focus\", \".inputtext\", $.proxy(self.onFocusInputItem, self));\n    $(\".list-items\", self.content).on(\"click\", \".item-button.delete\", $.proxy(self.onClickDeleteItem, self));\n    $(\".list-items\", self.content).on(\"mouseleave\", \".item\", $.proxy(self.onMouseLeaveItem, self));\n\n    self.sub(\"EDITACTIVITY\", $.proxy(self.onChangeForm, self));\n  },\n\n  /***\r\n      * call services\r\n      */\n  /*\r\n          *  Get data for users\r\n          */\n  callGetDataUsers: function callGetDataUsers(csvguidUsers) {\n    var self = this,\n    defer = $.Deferred();\n    var params = {\n      usersGuids: csvguidUsers,\n      width: 50,\n      height: 50 };\n\n\n    self.dataService.getUsersData(params).always(function (response) {\n      defer.resolve(response);\n    });\n    return defer.promise();\n  },\n\n  /**\r\n      * Clean events\r\n      */\n  clean: function clean() {\n    var self = this;\n    self.unsub(\"EDITACTIVITY\", $.proxy(self.onChangeForm, self));\n\n    // Clean Resize eventHandler for activityAssignee field\n    $(window).off('resize.activityAssignee');\n  } });\n\n\n\n\nbizagi.injector.register(\"bizagi.workportal.desktop.widgets.project.plan.activities.form\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.desktop.widgets.project.plan.activities.form], true);"]}