{"version":3,"sources":["jquery/workportal/desktop/widget/project.plan.activity.sidebar/bizagi.workportal.desktop.widgets.project.plan.activity.sidebar.js","jquery/workportal/desktop/widget/project.plan.activity.action/bizagi.workportal.desktop.widgets.project.plan.activity.action.js","jquery/workportal/desktop/widget/project.plan.activity.time/bizagi.workportal.desktop.widgets.project.plan.activity.time.js","jquery/workportal/desktop/widget/project.plan.activity.progress/bizagi.workportal.desktop.widgets.project.plan.activity.progress.js","jquery/workportal/desktop/widget/project.plan.activity.subprocesses/bizagi.workportal.desktop.widgets.project.plan.activity.subprocesses.js","jquery/workportal/desktop/widget/project.plan.activity.parent/bizagi.workportal.desktop.widgets.project.plan.activity.parent.js","jquery/workportal/desktop/widget/project.plan.activity.users/bizagi.workportal.desktop.widgets.project.plan.activity.users.js","jquery/workportal/desktop/widget/project.dashboard.menu/bizagi.workportal.desktop.widgets.project.dashboard.menu.js","jquery/workportal/desktop/widget/project.dashboard.menu.activity.plan/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.discussions/bizagi.workportal.desktop.widgets.project.discussions.js","jquery/workportal/desktop/widget/project.discussion.sidebar/bizagi.workportal.desktop.widgets.project.discussion.sidebar.js"],"names":["bizagi","workportal","widgets","project","base","extend","init","workportalFacade","dataService","serviceloadDataPlan","params","this","_super","loadTemplates","project-plan-activity-sidebar","getTemplate","concat","renderContent","template","content","render","postRender","sub","$","proxy","onNotifyLoadInfoPlan","event","parans","plan","idActivitySelected","idPlan","id","loadData","getDateServer","subscribe","loadedWithDataActivities","loadedWithDataFirstParent","pub","type","args","clean","unsubscribe","injector","register","activity","sidebar","notifier","dateFormat","localization","getResource","timeFormat","estimatedFinishDateTime","beforeUserAssignedActivity","activity-action-main","activity-action-editionpopup","dialogBox","onNotifyLoadInfoActivityExecution","onNotifyExpandedRightSidebar","self","$content","getContent","empty","currentActivity","activities","filter","toUpperCase","idUserCreator","currentUser","idUser","userAssigned","argsTemplate","currentActivityName","name","showEditAction","tmpl","append","initilizeActionMenu","initializeTempleteAndEvents","plugins","activityEdition","initPluginPopupEdition","formEditActivity","assignee","date","duration","buttonCancel","buttonUpdate","on","onClickPopupButtonCancel","onClickPopupButtonUpdate","onDeleteDate","onTypeDuration","menu","select","onSelectMenu","removeClass","popupEditActivity","formContent","initializeAutoComplete","element","url","serviceLocator","getUrl","autocomplete","minLength","source","request","response","ajax","data","domain","userName","fullName","term","organization","pag","pagSize","orderField","success","map","users","item","label","user","value","ui","val","IdAssignee","focus","change","initializeDatePicker","datepicker","onSelect","getTime","undefined","util","dateFormatter","getDateFormatByDatePickerJqueryUI","initializeSpiner","desactivateDateByDuration","newValue","target","isNumeric","parseInt","spinner","min","max","placeHolder","spin","keyCode","fieldDurationActive","activateElement","form","currentTarget","find","length","onClickOpenPopupEdition","dialog","resizable","draggable","height","width","modal","title","maximize","open","onOpenPopupEdition","close","onClosePopupEdition","activityDate","isEmpty","estimatedFinishDate","isNaN","formatInvariant","Date","getDateFromInvariant","isMinimumDate","setUserAssignedById","removePopupWidgets","callGetDataUsers","then","responseUsers","preventDefault","next","html","remove","validateParamsOfFormEditActivity","idUserAssigned","updateActivity","progress","startDate","allowEdition","description","finishDate","items","when","editActivityPlan","done","refreshAllWidgets","showContextByMenuDashboard","showSucessMessage","onClickFavorite","favoriteOptions","hasClass","idObject","idCase","favoriteType","addFavorite","favoritesData","guidFavorite","idFavorites","addClass","delFavorite","unsub","messageValidationField","replace","toLowerCase","csvIdUsers","defer","Deferred","userIds","getUsersData","always","resolve","promise","action","widget","EXECUTING_ACTIVITY","FINISHED_ACTIVITY","datePickerRegional","plan-time-main","onNotifyLoadInfoActivitySummary","getStateActivity","time","fromDate","getFormattedDate","getFirstDate","dataProgressWidget","getDataByScenarios","unitTime","auxUnitTime","updateWidget","contentTemplate","relativeTime","getRelativeTime","now","minutes","messageDescripionDifference","keywordResource","messageTime","appendTo","$barRemainingDate","widthNumberDays","css","toString","percentBar","currentState","colorBar","getColorByCreatedAndEstimatedDate","toDate","callGetEffectiveDuration","getColorBar","getPercentBar","getKeywordResourceDescriptionBar","getUnitTime","getUTCDate","dateObj","monthNames","getMonth","formatDate","d","getEffectiveDuration","plan-progress-main","plan-progress-popup-edit","onNotifyUpdateItemFromRender","activityToShow","valuePercentBarComplete","canEdit","popupEditProgress","initPluginPopupEditProgress","formEditProgress","sliderProgress","slider","orientation","range","from","to","step","slide","onChangesliderProgress","each","vals","i","el","numericTextBoxPlugin","format","onChangeNumericTextBoxProgress","decimals","buttonChangeProgress","onShowPopupEditProgress","onClickCancel","onSubmitFormChangeProgress","updateProgressUI","listItems","activityWork","hide","show","text","newPercentProgress","templatePopupEditProgress","onOpenPopupPlan","detach","previusValueProgress","prop","project-subprocesses","project-subprocesses-tootip-custom-properties","subprocesses","plan-parent-main","getPlanParent","planParent","parent","idParent","radNumber","nameParent","displayName","idWorkflow","idWorkItem","idTask","onClickGoToParentCase","routingExecute","closest","usersMap","usersInformation","globalHandlersService","get","usersAssignees","plan-users-main","activityRunning","cvsGuidUsers","activitiesUsers","ownerUserId","ownerUserGuid","push","guidUser","userType","picture","guid","index","userId","userGuid","userAssignedGuid","inArray","justAssignees","addEventHandlersModal","showCreatorInformation","renderUserProfilesAndImages","allUsers","usersAssignee","isOwner","indexOf","isAssignee","usersAdapter","createJsonUserInfo","userCreator","userInfo","username","email","getInitials","userinformation","obj","$li","console","log","not","ev","userSelected","$target","usersActivities","userParam","getIsAssignee","getIsOwner","usertooltip","usersGuids","join","getUsersAssignees","getUserAssignee","tasks","types","actUser","click","stopPropagation","publish","widgetName","BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL","closeVisible","modalParameters","refreshInbox","onDiscussionsMenuStatusChange","updateDiscussionsIcons","hasDiscussionsOrComment","toggle","dashboard","project-dashboard-menu","contextsLeftSidebarCaseDashboard","forEach","context","updateView","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","contextualized","siblings","handlerEvents","paramsGetPlan","callGetPlan","responsePlan","loadContentById","$item","autoSave","document","getLevelNavigator","newLevelNavigator","refreshLastItemBreadcrumb","histName","level","getPlan","status","reject","subMenuHandler","$comments","$files","$timeline","off","project-content-dashboard","setTimeout","window","trigger","kendo","Widget","ProjectAttachments","options","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","wrapper","multiple","dropZone","maxFilesSize","uploadMaxFileSize","enabled","that","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","_filterMaxFilesSize","complete","interval","setInterval","_showNotificationCompleteUpload","clearInterval","_onProgressFile","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","notifierTitle","actions","animation","visible","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","_getSize","cancel","retry","Math","round","$file","_getFileItemByUID","uid","percent","percentComplete","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$fileWrapper","$uploadWrapper","_onRemoveFile","_onRetryFile","file","grep","validation","_isValidFile","message","setStatus","valid","size","extension","total","_notifySizeExceeded","_switchEvents","cancelFilesUpload","destroy","errorUploadiis","plugin","jQuery","typeResource","dialogBoxDiscussion","attchComments","attchDiscussions","addition","listDataDiscussion","userPictures","commentsList","globalTags","tempTagsBeforeDelete","tempTagsToDelete","keySentenceAddTag","project-discussions","project-discussions-popup","project-discussions-list","project-discussions-comments","project-discussions-attachments","project-attachments","templateHomeDiscussions","$contentWidget","popupDiscussion","initPluginPopupDiscussion","buttonShowFormNewDiscussion","subject","buttonShowPopupDiscussionToAdd","buttonAddDiscussion","formDiscussion","attachments","edition","tagsFilter","initPluginTagsFilter","tagsMultiSelect","initPluginTagsMultiSelect","getDiscussions","eventsHandler","restrictedEventsHandler","getDataDiscussions","idUsersCreatedDiscussions","idUsersCreatedComments","property","comments","csvGuidUsers","a","seen","out","len","j","removeDuplicateItemsFromArray","getDataUsers","setClassesTagsByDiscussion","onNotifyOpenPopup","showFormAddDiscussion","renderUserProfile","templatePopupDiscussion","newitemtext","categoriesMultiSelect","isDelete","createNewTag","kendoMultiSelect","valuesSelected","slice","dataitems","dataSource","tag","Boolean","pos","newtag","dataItemAddNew","at","refresh","list","itemData","add","dataBound","_prev","isfound","insert","createEmptyTag","search","dataTextField","dataValueField","hideOrShowDiscussionsByFilter","autoClose","tagMode","valueClass","validateAddCommentForm","$wrapperForm","result","$textAreaComment","trim","commentValidation","validateAddDiscussionForm","$subjectDiscussion","$descriptionDiscussion","subjectValidation","descriptionValidation","applyFileAttachments","kendoProjectAttachments","onSuccessFile","addFileData","supportFileExt","uploadMaxFilesSize","paramsGetDiscussions","globalParent","flowContext","getDiscussionsData","pipe","callForListComments","sortDiscussions","updateTemplateListDiscussion","array","splice","arrayUnique","discussions","generalDefer","commentsDefer","addGlobalTags","tags","dateTime","count","getCommentsData","apply","sortedDiscussion","sort","b","dateA","positionDiscussion","iDis","arr","old_index","new_index","k","array_move","resetDiscussionAttachments","sendDataUpdateDiscussion","filesObj","prepareFilesToSave","tagsDiscussion","getTagsDiscussionBySave","guidsTagsDiscussionToDelete","getGuidsTagsDiscussionToDelete","general","attachmentsToCreate","attachmentsToDelete","editDiscussion","discussion","getDiscussionDataByGUID","onClosePopupDiscussion","removeGlobalTags","printf","showErrorMessage","validateStringIsGuid","test","sendDataInsertDiscussion","postDiscussion","newDiscussion","updateDiscussionsMenu","tagsTextSelected","dataSourceTags","tagTextSelected","tagFound","isGuidTextSelected","tagSource","isGuid","differenceArrays","guidsTagsCurrentDiscussion","setStateUIShowMoreComments","$commentsContainer","state","$containerButtonMoreComments","$buttonShowMoreComments","$messageNoMoreComments","$messageLoadingComments","getCurrentUserInfo","createTagsOnServer","iTagAdd","tagGlobal","postTag","guidTagsToDelete","allGuidsMoreGuidsDelete","itemTag","secureGuidsForDelete","guidDelete","guidSecureDelete","idTag","deleteTag","iTagGlobal","iDiscussion","tagsBySpace","templateListDiscussions","contentRenderListDiscussions","listDataDiscussions","isOpen","parseBoolean","isClosedForAllUsers","returnServedCommentByParentId","parentId","mapTempComments","resourceTitlePopup","zIndex","onOpenPopupDiscussion","resetFormDiscussion","userPicture","$parent","$img","$text","attr","iUser","switchCommentsEvents","is","onShowButtonsPanel","onCancelComment","$container","onCreateComment","onViewComment","onViewMoreComments","onRemoveFiles","onEditDiscussion","showConfirmationBox","onDeleteComment","onDownloadAttachment","setDiscussionsDataByGUID","guidTagsDiscussion","renderAttachments","$commentWrapper","toggleClass","getMoreComments","getCommentsCountByParent","dateLastComment","responseMoreComments","Array","prototype","renderCommentByDiscussion","idUsersLoaded","idUsersNewComments","csvIdUsersMissingLoad","fail","guidParent","moreComments","$commentsDOM","tmplComment","renderObject","getCommentByGuid","parentGuid","commentGuid","x","lengthx","currentFiles","removeFiles","tmpSplice","fileGuid","comment","deleteComment","keys","Object","haveDiscussions","haveComments","XMLHttpRequest","JSON","parse","$wrapper","sender","$liTarget","guidAttachment","nameFile","getDownloadAttachment","$commentContainer","$buttonsWrp","$textarea","$uploadForm","$vlTooltip","$fileList","reset","$rplWrp","$addCommentContainer","$uploadList","postComment","newComment","unshift","isIE","fileList","onSubmitFormDiscussion","resetWidget","hasOwnProperty","$source","$textareaSource","$textareaTarget","$uploadListSource","first","$uploadListTarget","supportNav","project-discussion-sidebar","onShowPopupDiscussion"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal Project Activity Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activity.sidebar\", {}, {\n\n  /*\r\n                                                                                                                *   Constructor\r\n                                                                                                                */\n  init: function init(workportalFacade, dataService, serviceloadDataPlan, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.serviceloadDataPlan = serviceloadDataPlan;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-plan-activity-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.sidebar\").concat(\"#project-plan-activity-sidebar\") });\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-plan-activity-sidebar\");\n    self.content = template.render({});\n\n    return self.content;\n  },\n  postRender: function postRender() {\n    var self = this;\n    self.sub(\"LOAD_INFO_PLAN\", $.proxy(self.onNotifyLoadInfoPlan, self));\n  },\n\n  onNotifyLoadInfoPlan: function onNotifyLoadInfoPlan(event, parans) {\n    var self = this;\n    if (self.params.plan.idActivitySelected) {\n\n      var params = { idPlan: self.params.plan.id };\n      self.serviceloadDataPlan.loadData(params, self.getDateServer, self.params);\n      self.serviceloadDataPlan.subscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\n      self.serviceloadDataPlan.subscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\n    }\n  },\n\n  loadedWithDataActivities: function loadedWithDataActivities() {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"LOADED_ACTIVITIES_PLAN\",\n      args: self.params });\n\n    self.pub(\"notify\", {\n      type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\n      args: self.params });\n\n    self.pub(\"notify\", {\n      type: \"LOAD_INFO_ACTIVITY_SUMMARY\",\n      args: self.params });\n\n    self.pub(\"notify\", {\n      type: \"LOAD_INFO_ACTIVITIES_PLAN\",\n      args: self.params });\n\n  },\n\n  loadedWithDataFirstParent: function loadedWithDataFirstParent() {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"LOAD_INFO_SUMMARY_PLAN\",\n      args: self.params });\n\n  },\n\n  clean: function clean() {\n    var self = this;\n    if (self.serviceloadDataPlan) {\n      self.serviceloadDataPlan.unsubscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\n      self.serviceloadDataPlan.unsubscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\n    }\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.sidebar\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.loadDataPlan\", bizagi.workportal.widgets.project.plan.activity.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Action\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activity.action\", {}, {\n\n  /**\r\n                                                                                                               *   Constructor\r\n                                                                                                               */\n  init: function init(workportalFacade, dataService, notifier, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.dateFormat = bizagi.localization.getResource(\"dateFormat\");\n    self.timeFormat = bizagi.localization.getResource(\"timeFormat\");\n    self.estimatedFinishDateTime; //Save complete date and time, because datepicker dont save time\n\n    self.beforeUserAssignedActivity = \"\";\n    self.notifier = notifier;\n\n\n    //Load templates\n    self.loadTemplates({\n      \"activity-action-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.action\").concat(\"#project-plan-activity-action\"),\n      \"activity-action-editionpopup\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.action\").concat(\"#project-plan-activity-action-editionpopup\") });\n\n\n    self.dialogBox = {};\n  },\n\n  /**\r\n      *\r\n      * @returns {*|jQuery|HTMLElement}\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  /**\r\n      *\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\n    self.sub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\n  },\n\n  /**\r\n      * Notifies when an event is raised\r\n      */\n  onNotifyLoadInfoActivityExecution: function onNotifyLoadInfoActivityExecution(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n\n    var $content = self.getContent().empty();\n\n    var currentActivity = {};\n    if (self.params.plan.idActivitySelected) {\n      currentActivity = self.params.plan.activities.filter(function (activity) {\n        return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\n      })[0];\n    }\n\n    if (self.params.plan.idUserCreator === bizagi.currentUser.idUser || currentActivity.userAssigned == bizagi.currentUser.idUser) {\n\n      var argsTemplate = {};\n      argsTemplate.currentActivityName = currentActivity.name;\n      argsTemplate.showEditAction = true;\n      if (self.params.plan.idUserCreator !== bizagi.currentUser.idUser) {\n        argsTemplate.showEditAction = false;\n      }\n\n      var tmpl = self.getTemplate(\"activity-action-main\");\n      $content.append(tmpl.render(argsTemplate));\n\n      if (argsTemplate.showEditAction) {\n        self.initilizeActionMenu();\n        self.beforeUserAssignedActivity = currentActivity.userAssigned;\n        self.content.append($content);\n        self.initializeTempleteAndEvents();\n      }\n    }\n  },\n\n  initializeTempleteAndEvents: function initializeTempleteAndEvents() {\n    var self = this;\n    self.plugins = {};\n    self.plugins.activityEdition = self.initPluginPopupEdition();\n\n    self.formEditActivity = {\n      assignee: $(\"#activity-form-assignee\", self.plugins.activityEdition),\n      date: $(\"#activity-form-date\", self.plugins.activityEdition),\n      duration: $(\"#activity-form-duration\", self.plugins.activityEdition),\n      buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.activityEdition),\n      buttonUpdate: $(\"#ui-bizagi-wp-project-popupform-action-update\", self.plugins.activityEdition) };\n\n\n    self.formEditActivity.buttonCancel.on(\"click\", $.proxy(self.onClickPopupButtonCancel, self));\n    self.formEditActivity.buttonUpdate.on(\"click\", $.proxy(self.onClickPopupButtonUpdate, self));\n\n    self.formEditActivity.date.on(\"keydown\", $.proxy(self.onDeleteDate, self));\n    self.formEditActivity.duration.on(\"keyup\", $.proxy(self.onTypeDuration, self));\n  },\n\n  /**\r\n      *\r\n      */\n  onNotifyExpandedRightSidebar: function onNotifyExpandedRightSidebar() {\n    var self = this;\n    self.initilizeActionMenu();\n  },\n\n  /**\r\n      *\r\n      */\n  initilizeActionMenu: function initilizeActionMenu() {\n    var self = this;\n    $(\"#ui-bizagi-wp-project-plan-activity-action .menu\", self.content).menu({\n      select: $.proxy(self.onSelectMenu, self) }).\n    removeClass(\"ui-widget-content\");\n  },\n\n  /**\r\n      *\r\n      * @returns dialogBox.formContent\r\n      */\n  initPluginPopupEdition: function initPluginPopupEdition() {\n    var self = this;\n    var popupEditActivity = self.getTemplate(\"activity-action-editionpopup\");\n    self.dialogBox.formContent = popupEditActivity.render({});\n    return self.dialogBox.formContent;\n\n  },\n\n  /**\r\n      *\r\n      * @param element\r\n      */\n  initializeAutoComplete: function initializeAutoComplete(element) {\n    var self = this;\n    var url = self.dataService.serviceLocator.getUrl(\"admin-getUsersList\");\n\n    element.autocomplete({\n      minLength: 2,\n      source: function source(request, response) {\n        $.ajax({\n          url: url,\n          data: {\n            domain: \"\",\n            userName: \"\",\n            fullName: request.term,\n            organization: \"\",\n            pag: 1,\n            pagSize: 100,\n            orderField: \"fullName\" },\n\n          success: function success(data) {\n            response($.map(data.users, function (item) {\n              return {\n                label: item.user,\n                value: item.idUser };\n\n            }));\n          } });\n\n      },\n      select: function select(event, ui) {\n        var name = ui.item.label;\n        element.val(name);\n        self.formEditActivity.IdAssignee = ui.item.value;\n        return false;\n      },\n      focus: function focus() {\n        return false;\n      },\n      change: function change(event, ui) {\n        if (ui.item === null) {\n          self.formEditActivity.IdAssignee = null;\n          self.formEditActivity.assignee.val(\"\");\n        }\n        return false;\n      } });\n\n\n\n  },\n\n  /**\r\n      *\r\n      * @param element\r\n      */\n  initializeDatePicker: function initializeDatePicker(element) {\n    var self = this;\n    element.datepicker({\n      onSelect: function onSelect() {\n        self.formEditActivity.duration.val(\"\");\n        self.estimatedFinishDateTime = self.formEditActivity.date.datepicker(\"getDate\") ? self.formEditActivity.date.datepicker(\"getDate\").getTime() : undefined;\n      } });\n\n    element.datepicker(\"option\", \"dateFormat\", bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI());\n  },\n\n  /**\r\n      *\r\n      * @param element\r\n      */\n  initializeSpiner: function initializeSpiner(element) {\n    var self = this;\n    function desactivateDateByDuration(event, newValue) {\n      var value = newValue || $(event.target).val();\n      if (bizagi.util.isNumeric(value) && parseInt(value, 10) > 0) {\n        self.formEditActivity.date.val(\"\");\n        self.estimatedFinishDateTime = undefined;\n      } else {\n        $(event.target).val(\"\");\n      }\n    }\n\n    element.spinner({\n      min: 1,\n      max: 1000,\n      placeHolder: bizagi.localization.getResource(\"workportal-hours\"),\n      change: function change(event) {\n        desactivateDateByDuration(event);\n      },\n      spin: function spin(event, ui) {\n        desactivateDateByDuration(event, ui.value);\n      } });\n\n  },\n\n  /***\r\n      * Events\r\n      * @param event\r\n      */\n\n  onDeleteDate: function onDeleteDate(event) {\n    var self = this;\n    if (event.keyCode === 8) {\n      $(event.target).val(\"\");\n      self.fieldDurationActive(true);\n    }\n  },\n\n  /**\r\n      *\r\n      * @param event\r\n      */\n  onTypeDuration: function onTypeDuration(event) {\n    var self = this;\n    var $target = $(event.target);\n    if ($target.val() !== \"\") {\n      self.estimatedFinishDateTime = undefined;\n    } else {\n      self.activateElement(self.form.date);\n    }\n  },\n\n  /**\r\n      * When select menu\r\n      * @param event\r\n      * @param ui\r\n      */\n  onSelectMenu: function onSelectMenu(event, ui) {\n    var self = this;\n    if ($(event.currentTarget).find(\"i\").length === 0) {\n      var item = $(ui.item).data(\"item\");\n      switch (item) {\n        case \"edit\":\n          self.onClickOpenPopupEdition();\n          break;}\n\n    }\n  },\n\n  /**\r\n      *\r\n      */\n  onClickOpenPopupEdition: function onClickOpenPopupEdition() {\n    var self = this;\n    self.initializeTempleteAndEvents();\n    self.dialogBox.formContent.dialog({\n      resizable: false,\n      draggable: false,\n      height: \"auto\",\n      width: \"600px\",\n      modal: true,\n      title: bizagi.localization.getResource(\"workportal-project-plan-title-activity-properties\"),\n      maximize: true,\n      open: $.proxy(self.onOpenPopupEdition, self),\n      close: $.proxy(self.onClosePopupEdition, self) });\n\n  },\n\n  /**\r\n     *\r\n     */\n  onOpenPopupEdition: function onOpenPopupEdition() {\n    var self = this;\n    var currentActivity = self.params.plan.activities.filter(function (activity) {\n      return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\n    })[0];\n\n    var activityDate = currentActivity && !bizagi.util.isEmpty(currentActivity.estimatedFinishDate) ? currentActivity.estimatedFinishDate : \"\";\n    if (!isNaN(activityDate)) {\n      activityDate = bizagi.util.dateFormatter.formatInvariant(new Date(activityDate));\n    }\n    var estimatedFinishDate = activityDate ? bizagi.util.dateFormatter.getDateFromInvariant(activityDate) : \"\";\n    var isMinimumDate = estimatedFinishDate instanceof Date ? estimatedFinishDate.getTime() < self.getDateServer() : false;\n\n    self.initializeAutoComplete(self.formEditActivity.assignee);\n    self.initializeDatePicker(self.formEditActivity.date);\n    self.initializeSpiner(self.formEditActivity.duration);\n\n    if (currentActivity.userAssigned) {\n      self.setUserAssignedById(currentActivity.userAssigned);\n    }\n\n    self.formEditActivity.date.datepicker(\"option\", \"minDate\", new Date(self.getDateServer()));\n\n    if (currentActivity.estimatedFinishDate && isMinimumDate) {\n      self.formEditActivity.date.datepicker(\"option\", \"minDate\", estimatedFinishDate); //set minimum because, if date is past\n    }\n\n    if (currentActivity.estimatedFinishDate) {\n      if (estimatedFinishDate) {\n        self.formEditActivity.date.datepicker(\"setDate\", estimatedFinishDate);\n      }\n      self.estimatedFinishDateTime = currentActivity.estimatedFinishDate;\n    }\n\n    if (currentActivity.duration) {\n      self.formEditActivity.duration.val(parseInt(currentActivity.duration, 10));\n    }\n  },\n\n  /**\r\n      * When close popup edition\r\n      */\n  onClosePopupEdition: function onClosePopupEdition() {\n    var self = this;\n    self.removePopupWidgets();\n  },\n\n  /**\r\n      *\r\n      * @param idUser\r\n      */\n  setUserAssignedById: function setUserAssignedById(idUser) {\n    var self = this;\n    //Show images users\n    self.callGetDataUsers(idUser).then(function (responseUsers) {\n      self.formEditActivity.assignee.val(responseUsers[0].name);\n    });\n    self.formEditActivity.IdAssignee = idUser;\n  },\n\n  /**\r\n      *\r\n      * @param event\r\n      */\n  onClickPopupButtonCancel: function onClickPopupButtonCancel(event) {\n    var self = this;\n    event.preventDefault();\n    self.removePopupWidgets();\n  },\n\n  /**\r\n     * Remove popup widgets\r\n     */\n  removePopupWidgets: function removePopupWidgets() {\n    var self = this;\n    self.formEditActivity.assignee.next().find(\"span\").html(\"\");\n    self.dialogBox.formContent.remove();\n    $(\"#ui-datepicker-div\").remove();\n  },\n\n  /**\r\n      *  Triggered when click update plan activity\r\n      */\n  onClickPopupButtonUpdate: function onClickPopupButtonUpdate() {\n    var self = this;\n    if (self.validateParamsOfFormEditActivity()) {\n      var currentActivity = self.params.plan.activities.filter(function (activity) {\n        return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\n      })[0];\n      var idUserAssigned = self.formEditActivity.IdAssignee || bizagi.currentUser.idUser;\n      if (self.formEditActivity.duration.val() != \"\") {\n        self.params.plan.activities.filter(function (activity) {\n          return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\n        })[0].estimatedFinishDate = \"\";\n      }\n      var updateActivity = {\n        progress: currentActivity.progress,\n        id: currentActivity.id,\n        startDate: currentActivity.startDate,\n        duration: self.formEditActivity.duration.val(),\n        userAssigned: idUserAssigned,\n        allowEdition: currentActivity.allowEdition,\n        description: currentActivity.description,\n        name: currentActivity.name,\n        idPlan: currentActivity.idPlan,\n        estimatedFinishDate: self.estimatedFinishDateTime,\n        finishDate: currentActivity.finishDate,\n        items: currentActivity.items };\n\n      $.when(self.dataService.editActivityPlan(updateActivity)).done(function () {\n        currentActivity = $.extend(currentActivity, updateActivity);\n        self.removePopupWidgets();\n\n        if (self.beforeUserAssignedActivity !== self.formEditActivity.IdAssignee) {\n          self.pub(\"notify\", {\n            type: \"ACTIVITYPLANCOMMENTS\",\n            args: $.extend(self.params, { refreshAllWidgets: true }) });\n\n        } else\n        {\n          self.pub(\"notify\", {\n            type: self.params.showContextByMenuDashboard,\n            args: self.params });\n\n        }\n\n        self.removePopupWidgets();\n        self.notifier.showSucessMessage(bizagi.localization.getResource(\"workportal-project-plan-activity-update-message\"));\n      });\n    }\n  },\n\n  /***\r\n      * Events\r\n      */\n  onClickFavorite: function onClickFavorite(event) {\n    event.preventDefault();\n    var self = this;\n    var favoriteOptions = {};\n    if ($(event.target).hasClass(\"bz-icon-star-outline\")) {\n      favoriteOptions = {\n        idObject: self.params.idCase,\n        favoriteType: \"CASES\" };\n\n      $.when(self.dataService.addFavorite(favoriteOptions)).done(function (favoritesData) {\n        self.params.guidFavorite = favoritesData.idFavorites;\n        $(event.target).removeClass(\"bz-icon-star-outline\");\n        $(event.target).addClass(\"bz-icon-star\");\n      });\n    } else\n    {\n      favoriteOptions = {\n        idObject: self.params.guidFavorite,\n        favoriteType: \"CASES\" };\n\n      $.when(self.dataService.delFavorite(favoriteOptions)).done(function () {\n        $(event.target).addClass(\"bz-icon-star-outline\");\n        $(event.target).removeClass(\"bz-icon-star\");\n      });\n    }\n  },\n\n  /**\r\n      * Clean events and plugins\r\n      */\n  clean: function clean() {\n    var self = this;\n    self.unsub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\n    self.unsub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\n  },\n\n  /**\r\n      * Validate form edit plan activity\r\n      * @returns {boolean}\r\n      */\n  validateParamsOfFormEditActivity: function validateParamsOfFormEditActivity() {\n    var self = this;\n    var userAssigned = self.formEditActivity.assignee;\n    if (userAssigned.val() && userAssigned.val() !== \"\" && self.formEditActivity.IdAssignee) {\n      return true;\n    } else {\n      var messageValidationField = bizagi.localization.getResource(\"workportal-general-error-field-required\");\n      messageValidationField = messageValidationField.replace(\"{0}\", bizagi.localization.getResource(\"workportal-project-plan-assignee\").toLowerCase());\n      userAssigned.next().find(\"span\").html(messageValidationField);\n      return false;\n    }\n  },\n\n  /**\r\n      * Call services\r\n      */\n  callGetDataUsers: function callGetDataUsers(csvIdUsers) {\n    var self = this,\n    defer = $.Deferred();\n    var params = {\n      userIds: csvIdUsers,\n      width: 50,\n      height: 50 };\n\n\n    self.dataService.getUsersData(params).always(function (response) {\n      defer.resolve(response);\n    });\n    return defer.promise();\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.action\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.plan.activity.action]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Time\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n/***\r\n     * TODO IMPORTANT: This widget is development with TDD, test this file when changes\r\n     */\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.time\", {}, {\n\n  /*\r\n                                                                                                       *   Constructor\r\n                                                                                                       *\r\n                                                                                                       */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Constants\n    self.EXECUTING_ACTIVITY = \"EXECUTING\";\n    self.FINISHED_ACTIVITY = \"FINISHED\";\n\n    //Regional\n    self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\n\n    //Load templates\n    self.loadTemplates({\n      \"plan-time-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.time\").concat(\"#project-plan-activity-time\") });\n\n  },\n\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  postRender: function postRender() {\n    var self = this;\n    self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivitySummary, self));\n  },\n\n  /**\r\n      * Notifies when an event is raised\r\n      */\n  onNotifyLoadInfoActivitySummary: function onNotifyLoadInfoActivitySummary(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n    self.getContent().empty();\n\n    var currentActivity = self.params.plan.activities.filter(function (activity) {\n      return activity.id === self.params.plan.idActivitySelected;\n    })[0];\n\n    if (currentActivity.startDate) {\n      self.getStateActivity(currentActivity);\n\n      var argsTemplate = {\n        time: {\n          fromDate: self.getFormattedDate(new Date(self.getFirstDate(currentActivity))) } };\n\n\n      var dataProgressWidget = self.getDataByScenarios(currentActivity, true);\n\n      $.when(dataProgressWidget.unitTime).done(function (auxUnitTime) {\n        dataProgressWidget = $.extend(dataProgressWidget, {\n          unitTime: auxUnitTime });\n\n        self.updateWidget($.extend(argsTemplate.time, dataProgressWidget));\n      });\n\n    }\n  },\n  updateWidget: function updateWidget(argsTemplate) {\n    var self = this;\n    var $content = self.getContent().empty();\n    var contentTemplate = self.getTemplate(\"plan-time-main\");\n\n    var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - argsTemplate.unitTime.minutes * 60 * 1000), null, false);\n\n    var messageDescripionDifference = bizagi.localization.getResource(\"workportal-project-activity-state-\" + argsTemplate.keywordResource);\n    argsTemplate.messageTime = messageDescripionDifference.replace(\"%s\", relativeTime);\n\n    contentTemplate.\n    render(argsTemplate).\n    appendTo($content);\n\n    //Begin Adjust status bar next to the number days\n    var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\n    var widthNumberDays = $(\".remaining-days .days\", $content).width();\n    $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\n\n    var $barCompletedDate = $(\".remaining-days .bar-completed\", $content);\n\n    $barCompletedDate.css(\"width\", argsTemplate.percentBar + \"%\");\n    //End Adjust status bar next to the number days\n\n  },\n  getStateActivity: function getStateActivity(activity) {\n    var self = this;\n    if (activity.finishDate) {\n      activity.currentState = self.FINISHED_ACTIVITY;\n      return self.FINISHED_ACTIVITY;\n    } else\n    {\n      activity.currentState = self.EXECUTING_ACTIVITY;\n      return self.EXECUTING_ACTIVITY;\n    }\n  },\n  getFirstDate: function getFirstDate(activity) {\n    var self = this;\n    if (activity.currentState === self.EXECUTING_ACTIVITY) {\n      return activity.startDate;\n    } else {\n      return activity.finishDate;\n    }\n  },\n  getDataByScenarios: function getDataByScenarios(activity) {\n    var self = this;\n    var response = {\n      colorBar: null,\n      percentBar: 100,\n      keywordResource: null,\n      unitTime: null };\n\n    var params = {};\n    switch (activity.currentState) {\n      case self.EXECUTING_ACTIVITY:\n        response.keywordResource = \"opened\";\n        response.colorBar = self.getColorByCreatedAndEstimatedDate(activity);\n\n        params = {\n          idUser: bizagi.currentUser.idUser,\n          fromDate: activity.startDate,\n          toDate: Date.now() };\n\n        response.unitTime = self.callGetEffectiveDuration(params);\n\n        break;\n      case self.FINISHED_ACTIVITY:\n        response.colorBar = \"Gray\";\n        response.keywordResource = \"closed\";\n        params = {\n          idUser: bizagi.currentUser.idUser,\n          fromDate: activity.finishDate,\n          toDate: Date.now() };\n\n        response.unitTime = self.callGetEffectiveDuration(params);\n        break;}\n\n    return response;\n  },\n\n  getColorBar: function getColorBar(activity) {\n    var self = this;\n    return self.getDataByScenarios(activity).colorBar;\n  },\n  getPercentBar: function getPercentBar(activity) {\n    var self = this;\n    return self.getDataByScenarios(activity).percentBar;\n  },\n  getKeywordResourceDescriptionBar: function getKeywordResourceDescriptionBar(activity) {\n    var self = this;\n    return self.getDataByScenarios(activity).keywordResource;\n  },\n  getUnitTime: function getUnitTime(activity) {\n    var self = this;\n    return self.getDataByScenarios(activity).unitTime;\n  },\n\n  getColorByCreatedAndEstimatedDate: function getColorByCreatedAndEstimatedDate(activity) {\n    var self = this;\n    var response = \"Red\";\n    if (activity.estimatedFinishDate) {\n      if (Date.now() < activity.estimatedFinishDate) {\n        var theSameDay = new Date().getUTCDate() === new Date(activity.estimatedFinishDate).getUTCDate();\n        if (theSameDay) {\n          response = \"Yellow\";\n        } else\n        {\n          response = \"Green\";\n        }\n      }\n    }\n    return response;\n  },\n\n  getFormattedDate: function getFormattedDate(dateObj) {\n    var self = this;\n    var monthsNames = self.datePickerRegional.monthNames;\n    var shortMonth = dateObj.getMonth();\n\n    return monthsNames[shortMonth] + \" \" + bizagi.util.dateFormatter.formatDate(dateObj, \"dd hh:mm tt\", bizagi.localization.getResource(\"datePickerRegional\"));\n  },\n\n  /**\r\n      * Call services\r\n      */\n  callGetEffectiveDuration: function callGetEffectiveDuration(params) {\n    var self = this;\n    var d = $.Deferred();\n    $.when(\n    self.dataService.getEffectiveDuration(params)).\n    done(function (data) {\n      d.resolve(data);\n    });\n    return d.promise();\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.time\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.time], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Progress\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.progress\", {}, {\n\n  /*\r\n                                                                                                           *   Constructor\r\n                                                                                                           */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.plugins = {};\n    self.dialogBox = {};\n\n    //Load templates\n    self.loadTemplates({\n      \"plan-progress-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.progress\").concat(\"#project-plan-activity-progress\"),\n      \"plan-progress-popup-edit\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.progress\").concat(\"#project-plan-activity-edit-progress\") });\n\n  },\n\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  postRender: function postRender() {\n    var self = this;\n    self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\n    self.sub(\"UPDATE_ITEMS_FROM_FORMRENDER\", $.proxy(self.onNotifyUpdateItemFromRender, self));\n  },\n\n  /**\r\n      * Notifies when an event is raised\r\n      */\n  onNotifyLoadInfoActivityExecution: function onNotifyLoadInfoActivityExecution(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n    var $content = self.getContent().empty();\n\n    var activityToShow = self.params.plan.activities.filter(function (activity) {\n      return activity.id.toUpperCase() == self.params.plan.idActivitySelected.toUpperCase();\n    })[0];\n\n    var argsTemplate = {};\n    argsTemplate.valuePercentBarComplete = 0;\n    argsTemplate.progress = {\n      progress: activityToShow.progress,\n      canEdit: activityToShow.items.length === 0 };\n\n\n    if (argsTemplate.progress.progress) {\n      argsTemplate.valuePercentBarComplete = argsTemplate.progress.progress;\n    }\n\n    //Update widget\n    var templateMain = self.getTemplate(\"plan-progress-main\");\n    templateMain.render(argsTemplate).appendTo($content);\n\n    self.plugins.popupEditProgress = self.initPluginPopupEditProgress();\n\n    var popupEditProgress = self.plugins.popupEditProgress;\n\n    self.formEditProgress = {\n      sliderProgress: $(\"#sliderProgress\", popupEditProgress).slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 100,\n        width: 100,\n        from: 5,\n        to: 50,\n        step: 1,\n        value: argsTemplate.valuePercentBarComplete,\n        slide: $.proxy(self.onChangesliderProgress, self),\n        change: $.proxy(self.onChangesliderProgress, self) }).\n      each(function () {\n        var vals = $(this).slider(\"option\", \"max\") - $(this).slider(\"option\", \"min\");\n        for (var i = 0; i <= vals; i += 10) {\n          var el = $(\"<label class='step'>\" + i + \"</label>\").css(\"left\", i / vals * 100 + \"%\");\n          $(this).append(el);\n        }\n      }),\n      numericTextBoxPlugin: $(\"#inputProgressNumericTextBox\", popupEditProgress).spinner({\n        format: \"n0\",\n        min: 0,\n        max: 100,\n        spin: $.proxy(self.onChangeNumericTextBoxProgress, self),\n        change: $.proxy(self.onChangeNumericTextBoxProgress, self),\n        value: argsTemplate.valuePercentBarComplete,\n        decimals: 0 }),\n\n      buttonChangeProgress: $(\"#button-accept-change-progress\", popupEditProgress),\n      buttonCancel: $(\"#button-cancel-change-progress\", popupEditProgress) };\n\n\n    //Handlers\n    $(\".action-open-popup-edit-progress\", $content).on(\"click\", $.proxy(self.onShowPopupEditProgress, self));\n\n    self.formEditProgress.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\n    self.formEditProgress.buttonChangeProgress.on(\"click\", $.proxy(self.onSubmitFormChangeProgress, self));\n\n    self.updateProgressUI(argsTemplate.valuePercentBarComplete);\n    self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", argsTemplate.valuePercentBarComplete);\n\n  },\n\n  onNotifyUpdateItemFromRender: function onNotifyUpdateItemFromRender(event, params) {\n    var self = this;\n    var listItems = params.args.items;\n    var activityWork = params.args.activityWork;\n\n    var progress;\n    if (listItems.length > 0) {\n      //Hide edit progress\n      $(\".action-open-popup-edit-progress\", self.content).hide();\n    } else {\n      $(\".action-open-popup-edit-progress\", self.content).show();\n    }\n    //set new progress\n    $(\".bz-wp-timestamp span\", self.content).text(activityWork);\n    $(\".bz-wp-progress-bar\", self.content).css(\"width\", activityWork + \"%\");\n\n  },\n\n  updateProgressUI: function updateProgressUI(newPercentProgress) {\n    var self = this,\n    $content = self.getContent();\n\n    $(\".bz-wp-timestamp span\", $content).text(newPercentProgress);\n\n    //Begin Adjust status bar next to the number days\n    var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\n    var widthNumberDays = $(\".remaining-days .days\", $content).width();\n    $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\n\n    var $barCompletedDate = $(\".remaining-days .bar-completed\", $content);\n\n    $barCompletedDate.css(\"width\", newPercentProgress.toString() + \"%\");\n    //End Adjust status bar next to the number days\n  },\n\n  initPluginPopupEditProgress: function initPluginPopupEditProgress() {\n    var self = this;\n    var templatePopupEditProgress = self.getTemplate(\"plan-progress-popup-edit\");\n    self.dialogBox.formContent = templatePopupEditProgress.render();\n    return self.dialogBox.formContent;\n\n  },\n  /*\r\n      * UI\r\n      */\n\n  onShowPopupEditProgress: function onShowPopupEditProgress() {\n    var self = this;\n\n    self.dialogBox.formContent.dialog({\n      resizable: false,\n      draggable: false,\n      height: \"auto\",\n      width: \"600px\",\n      modal: true,\n      title: bizagi.localization.getResource(\"workportal-project-plan-progress-title\"),\n      maximize: true,\n      open: $.proxy(self.onOpenPopupPlan, self),\n      close: function close() {\n        self.dialogBox.formContent.dialog(\"destroy\");\n        self.dialogBox.formContent.detach();\n      } });\n\n\n    self.previusValueProgress = self.formEditProgress.sliderProgress.slider(\"value\");\n\n  },\n\n  onChangeNumericTextBoxProgress: function onChangeNumericTextBoxProgress(event) {\n    var self = this;\n    var newValue = self.formEditProgress.numericTextBoxPlugin.spinner(\"value\");\n    self.formEditProgress.sliderProgress.slider(\"value\", newValue);\n  },\n\n  onChangesliderProgress: function onChangesliderProgress(event) {\n    var self = this;\n    var newValue = self.formEditProgress.sliderProgress.slider(\"value\");\n    self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", newValue);\n  },\n\n  onClickCancel: function onClickCancel(event) {\n    event.preventDefault();\n    var self = this;\n\n    self.dialogBox.formContent.dialog(\"destroy\");\n    self.dialogBox.formContent.detach();\n    //return before value progress\n    self.formEditProgress.sliderProgress.slider(\"value\", self.previusValueProgress);\n    self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", self.previusValueProgress);\n  },\n\n  onSubmitFormChangeProgress: function onSubmitFormChangeProgress(event) {\n    event.preventDefault();\n    var self = this;\n\n    self.formEditProgress.buttonChangeProgress.prop(\"disabled\", true);\n\n    var activityToShow = self.params.plan.activities.filter(function (activity) {\n      return activity.id == self.params.plan.idActivitySelected;\n    })[0];\n    var params = $.extend(activityToShow, {\n      progress: self.formEditProgress.numericTextBoxPlugin.spinner(\"value\"),\n      idPlan: self.params.plan.id });\n\n    $.when(self.dataService.editActivityPlan(params)).done(function () {\n      self.formEditProgress.buttonChangeProgress.prop(\"disabled\", false);\n      activityToShow.progress = self.formEditProgress.numericTextBoxPlugin.spinner(\"value\");\n      self.updateProgressUI(activityToShow.progress);\n      self.dialogBox.formContent.dialog(\"destroy\");\n      self.dialogBox.formContent.detach();\n    });\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.progress\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.progress], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Subprocesses Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.subprocesses\", {}, {\n  /*\r\n                                                                                                               *   Constructor\r\n                                                                                                               */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-subprocesses\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.subprocesses\").concat(\"#project-plan-activity-plan-subprocesses-wrapper\"),\n      \"project-subprocesses-tootip-custom-properties\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.subprocesses\").concat(\"#project-activity-plan-subprocesses-tooltip-custom-properties-wrapper\") });\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  /*\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.subprocesses\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.subprocesses]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Parent\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.parent\", {}, {\n\n  /*\r\n                                                                                                         *   Constructor\r\n                                                                                                         */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"plan-parent-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.parent\").concat(\"#project-plan-activity-parent\") });\n\n  },\n\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  postRender: function postRender() {\n    var self = this;\n    self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\n  },\n\n  /**\r\n      * Notifies when an event is raised\r\n      */\n\n  onNotifyLoadInfoActivityExecution: function onNotifyLoadInfoActivityExecution(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n    var $content = self.getContent().empty();\n\n    $.when(self.dataService.getPlanParent({ idPlan: self.params.plan.id })).done(function (planParent) {\n      self.params.plan.parent = planParent;\n      if (self.params.plan.parent) {\n        var argsTemplate = {};\n        argsTemplate.parent = {\n          idParent: self.params.plan.parent.radNumber,\n          nameParent: self.params.plan.parent.displayName,\n          idCase: self.params.plan.parent.idCase,\n          idWorkflow: self.params.plan.parent.idWorkflow,\n          idWorkItem: self.params.plan.parent.idWorkItem,\n          idTask: self.params.plan.parent.idTask };\n\n\n        //Update widget\n        var contentTemplate = self.getTemplate(\"plan-parent-main\");\n        contentTemplate.\n        render(argsTemplate).\n        appendTo($content);\n\n        $(\"#go-to-parent-case\", $content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\n      }\n    });\n\n\n  },\n\n  onClickGoToParentCase: function onClickGoToParentCase(event) {\n    event.preventDefault();\n    var self = this;\n    self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.parent\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.parent], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Users Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.users\", {}, {\n  /*\r\n                                                                                                        *   Constructor\r\n                                                                                                        */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    self.usersMap = {};\n    self.plugins = {};\n    self.usersInformation = [];\n    self.globalHandlersService = bizagi.injector.get('globalHandlersService');\n    self.usersAssignees = [];\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    //The load template the users plan because they are the same\n    self.loadTemplates({\n      \"plan-users-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.users\").concat(\"#project-plan-users\") });\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  /*\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\n  },\n\n  /*\r\n      * validate if the activity is running\r\n      */\n  activityRunning: function activityRunning(activity) {\n    return activity.startDate !== null && activity.finishDate === null;\n  },\n\n  onNotifyLoadInfoActivityExecution: function onNotifyLoadInfoActivityExecution(event, params) {\n    var self = this,\n    cvsGuidUsers = [],\n    activitiesUsers = [],\n    $content = self.getContent().empty();\n    self.params = $.extend(self.params, params.args);\n\n    var ownerUserId = self.params.plan.idUserCreator;\n    var ownerUserGuid = self.params.plan.idUserCreator;\n\n    activitiesUsers.push({ \"idUser\": ownerUserId, \"guidUser\": ownerUserGuid, \"userType\": [\"owner\"] });\n    self.usersMap[\"-\" + ownerUserId + \"-\"] = {\n      picture: \"\",\n      id: ownerUserId,\n      guid: ownerUserGuid,\n      name: \"\",\n      userType: [\"owner\"] };\n\n    cvsGuidUsers.push(ownerUserGuid);\n    $.each(self.params.plan.activities, function (index, activity) {\n      if (self.activityRunning(activity)) {\n        var userId = activity.userAssigned;\n        var userGuid = activity.userAssignedGuid;\n        if (userId === ownerUserId) {\n          if ($.inArray(\"Assigned\", activitiesUsers[0].userType) === -1) {\n            activitiesUsers[0].userType.push(\"Assigned\");\n            self.usersMap[\"-\" + ownerUserId + \"-\"].userType.push(\"Assigned\");\n          }\n        } else\n        {\n          self.usersMap[\"-\" + userId + \"-\"] = {\n            picture: \"\",\n            id: userId,\n            name: \"\",\n            userType: [\"Assigned\"] };\n\n          if (activitiesUsers.filter(function (user) {return user.idUser == userId;}).length === 0) {\n            var id = userGuid ? userGuid : userId;\n            activitiesUsers.push({ \"idUser\": id, \"userGuid\": id, \"userType\": [\"Assigned\"] });\n            cvsGuidUsers.push(id);\n          }\n        }\n      }\n    });\n    self.activitiesUsers = activitiesUsers;\n\n    //Update widget\n    var contentTemplate = self.getTemplate(\"plan-users-main\");\n    contentTemplate.\n    render({\n      assignee: self.justAssignees(activitiesUsers),\n      label: bizagi.localization.getResource(\"workportal-project-plan-assignee\") }).\n\n    appendTo($content);\n    self.addEventHandlersModal();\n    $.when(self.callGetDataUsers(cvsGuidUsers)).then(function () {\n      self.showCreatorInformation(ownerUserId);\n      self.renderUserProfilesAndImages();\n    });\n  },\n\n  /**\r\n      * return standar userAdapter information with only assigned users\r\n      * @param {Array} allUsers \r\n      */\n  justAssignees: function justAssignees(allUsers) {\n    var usersAssignee = [];\n    allUsers.map(function (user) {\n      var isOwner = user.userType.indexOf(\"owner\") !== -1;\n      var isAssignee = user.userType.indexOf(\"Assigned\") !== -1;\n      usersAssignee.push(usersAdapter.createJsonUserInfo(user.idUser, \"\", \"\", \"\", \"\", \"\", isAssignee, isOwner, [], []));\n    });\n    return usersAdapter.justAssignees(usersAssignee);\n  },\n\n  /**\r\n      * show the information of the creator case\r\n      * @param {string} ownerUserId guid user creator\r\n      */\n  showCreatorInformation: function showCreatorInformation(ownerUserId) {\n    var self = this;\n    var userCreator = self.usersMap[\"-\" + ownerUserId + \"-\"];\n    var userInfo = usersAdapter.createJsonUserInfo(\n    userCreator.id,\n    userCreator.name,\n    userCreator.username,\n    userCreator.picture ? userCreator.picture : undefined,\n    userCreator.email,\n    userCreator.name.getInitials(),\n    false,\n    true,\n    [],\n    []);\n\n    self.content.find(\".ui-bizagi-wp-project-plan-users .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\n  },\n\n  /**\r\n      * UI\r\n      */\n\n  renderUserProfilesAndImages: function renderUserProfilesAndImages() {\n    var self = this;\n    $.each(self.usersMap, function (i, obj) {\n      var $li = $(\".ui-bizagi-wp-userlist li[data-iduser=\" + obj.id + \"]\", self.content);\n      if (obj.picture !== \"\") {\n        $li.find(\"img\").prop(\"src\", obj.picture);\n      } else\n      {\n        $li.find(\"img\").hide();\n        if (obj.name !== undefined) {\n          $li.find(\"span\").html(obj.name.getInitials());\n        } else\n        {\n          console.log(\"obj.name is undefined\");\n        }\n\n      }\n    });\n    $(\".ui-bizagi-wp-userlist li\", self.content).not(\".moreUsers\").on('mouseenter', function (ev) {\n      var $target = $(ev.target);\n      var userId = $(this).data(\"iduser\");\n      var userSelected;\n      $.each(self.usersMap, function (i, obj) {\n        if (obj.id === userId)\n        userSelected = obj;\n      });\n      var usersActivities = self.usersAssignees.find(function (assignee) {\n        return assignee.userAssigned === userSelected.id;\n      });\n      var activities = [];\n      if (usersActivities)\n      usersActivities.activities.map(function (activity) {\n        activities.push(activity.name);\n      });\n      var userParam = usersAdapter.createJsonUserInfo(userSelected.id, userSelected.name, userSelected.username, userSelected.picture, userSelected.email, userSelected.name.getInitials(), self.getIsAssignee(userSelected), self.getIsOwner(userSelected), activities, undefined);\n\n      $target.parent().usertooltip(self, { target: $target, user: userParam });\n    });\n  },\n\n  getIsAssignee: function getIsAssignee(userSelected) {\n    if (userSelected.userType.indexOf(\"Assigned\") > -1) {\n      return true;\n    }\n    return false;\n  },\n\n  getIsOwner: function getIsOwner(userSelected) {\n    if (userSelected.userType.indexOf(\"owner\") > -1) {\n      return true;\n    }\n    return false;\n  },\n  /*\r\n      *  Get data for users\r\n      */\n  callGetDataUsers: function callGetDataUsers(cvsGuidUsers) {\n    var self = this,\n    params = {},\n    defer = $.Deferred();\n    params = {\n      usersGuids: cvsGuidUsers.join(),\n      width: 50,\n      height: 50 };\n\n    $.when(self.dataService.getUsersData(params)).always(function (response) {\n      self.usersInformation = response;\n      for (var i = 0, length = response.length; i < length; i += 1) {\n        if (typeof response[i].name === \"undefined\") {\n          bizagi.log(response[i] + \" Id Not Found\", response, \"error\");\n        } else {\n          if (self.usersMap[\"-\" + response[i].id + \"-\"]) {\n            self.usersMap[\"-\" + response[i].id + \"-\"].picture += response[i].picture ? \"data:image/png;base64,\" + response[i].picture : \"\";\n            self.usersMap[\"-\" + response[i].id + \"-\"].name = response[i].name || \"\";\n            self.usersMap[\"-\" + response[i].id + \"-\"].username = response[i].username || \"\";\n            self.usersMap[\"-\" + response[i].id + \"-\"].email = response[i].email || \"\";\n          } else\n          {\n            console.log(\"The object is undefined\");\n          }\n        }\n      }\n      self.getUsersAssignees();\n      defer.resolve();\n    });\n    return defer.promise();\n  },\n\n  getUsersAssignees: function getUsersAssignees() {\n    var self = this;\n    for (var i = 0; i < self.usersInformation.length; i++) {\n      self.usersAssignees.push(self.getUserAssignee(self.usersInformation[i]));\n    }\n\n  },\n\n  getUserAssignee: function getUserAssignee(user) {\n    var self = this;\n    var tasks = [];\n    $.each(self.params.plan.activities, function (index, activity) {\n      var userId = activity.userAssigned;\n      if (userId === user.id && self.activityRunning(activity)) {\n        tasks.push({ \"name\": activity.name });\n      }\n    });\n    user.tasks = tasks;\n    var types = self.activitiesUsers.find(function (actUser) {\n      return actUser.idUser == user.id;\n    });\n    user.userType = types.userType;\n\n    var userAssignees = usersAdapter.createJsonUserInfo(\n    user.id,\n    user.name,\n    user.username,\n    user.picture ? \"data:image/png;base64,\" + user.picture : undefined,\n    user.email,\n    user.name.getInitials(),\n    self.getIsAssignee(user),\n    self.getIsOwner(user),\n    user.tasks,\n    []);\n\n    return userAssignees;\n  },\n\n  addEventHandlersModal: function addEventHandlersModal() {\n    var self = this;\n    $(\".moreUsers\").click(function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n      var usersAssignees = self.usersAssignees || [];\n      self.globalHandlersService.publish(\"showDialogWidget\", {\n        widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL,\n        closeVisible: true,\n        data: usersAssignees,\n        maximize: true,\n        modalParameters: {\n          title: bizagi.localization.getResource(\"workportal-project-users-title\") + \" (\" + usersAssignees.length + \")\",\n          width: 790,\n          height: 526,\n          refreshInbox: false } });\n\n\n    });\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.users\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.users], true);","/**\r\n * Name: BizAgi Desktop Widget Dashboard menu (left sidebar) * \r\n * @author Valeria Vanegas\r\n */\n\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu\", {}, {\n\n  /**\r\n                                                                                                   * Handler when discussions menu status change\r\n                                                                                                   * @param {*} ev \r\n                                                                                                   * @param {*} params \r\n                                                                                                   */\n  onDiscussionsMenuStatusChange: function onDiscussionsMenuStatusChange(ev, params) {\n    var self = this;\n    self.updateDiscussionsIcons(params.hasDiscussionsOrComment);\n  },\n\n  /**\r\n      * Update discussions icon on sidebar menu\r\n      * The icon is different when there is other discussion or there are comments\r\n      * @param {*} hasDiscussionsOrComment \r\n      */\n  updateDiscussionsIcons: function updateDiscussionsIcons(hasDiscussionsOrComment) {\n    var self = this;\n\n    self.sub(\"UPDATE_DISCUSSIONS_MENU_STATUS\", $.proxy(self.onDiscussionsMenuStatusChange, self));\n\n    $(\".bz-icon-discussion-comment\").toggle(hasDiscussionsOrComment);\n    $(\".bz-icon-discussion-no-comment\").toggle(!hasDiscussionsOrComment);\n    self.params.hasDiscussionsOrComment = hasDiscussionsOrComment;\n  },\n\n  /**\r\n      * Detach events\r\n      */\n  clean: function clean() {\n    var self = this;\n    self.unsub(\"UPDATE_DISCUSSIONS_MENU_STATUS\", $.proxy(self.onDiscussionsMenuStatusChange, self));\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu], true);","/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity Plan\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.dashboard.menu.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity.plan\", {}, {\n\n  /**\r\n                                                                                                                                 *   Constructor\r\n                                                                                                                                 */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n    self.params = params || {};\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan\").concat(\"#project-dashboard-menu2\") });\n\n  },\n\n  /**\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  /**\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    self._super();\n    //Handlers\n    self.params.contextsLeftSidebarCaseDashboard.forEach(function (context) {\n      self.sub(context, $.proxy(self.updateView, self));\n    });\n  },\n\n  /**\r\n      * Update view\r\n      * @param event\r\n      * @param params\r\n      */\n  updateView: function updateView(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n    self.clean();\n    var $content = self.getContent().empty();\n\n    var argsTemplate = {\n      showFormOverview: self.params.menuDashboard.showFormOverview,\n      showFormActivity: self.params.menuDashboard.showFormActivity,\n      showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\n      showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\n      showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu,\n      showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\n      contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\n      contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu,\n      contextualized: self.params.plan.contextualized };\n\n\n    //Update widget\n    var template = self.getTemplate(\"project-dashboard-menu\");\n    template.render(argsTemplate).appendTo($content);\n\n    if (self.params.showContextByMenuDashboard) {\n      $(\"li[data-context='\" + event.type.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\n    }\n\n    self.updateDiscussionsIcons(self.params.hasDiscussionsOrComment);\n    self.handlerEvents();\n\n    var paramsGetPlan = { idPlan: self.params.plan.id };\n    $.when(self.callGetPlan(paramsGetPlan)).then(function (responsePlan) {\n      $.extend(self.params.plan, responsePlan);\n      self.pub(\"notify\", {\n        type: \"LOAD_INFO_PLAN\",\n        args: self.params });\n\n    });\n  },\n\n  /**\r\n      *   Load Content By Id\r\n      */\n  loadContentById: function loadContentById(event) {\n    var self = this;\n    event.preventDefault();\n    var $item = $(event.target).closest(\"li\");\n\n    if (!$item.hasClass(\"active\")) {\n      $.when(bizagi.util.autoSave()).done(function () {\n        $(document).data('auto-save', '');\n\n        var showContextByMenuDashboard = $item.data(\"context\");\n        if (showContextByMenuDashboard) {\n          var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\n          var currentLevelNavigator = parseInt(getLevelNavigator[0]);\n          var nameItemNavigator = \"\";\n          var newLevelNavigator = currentLevelNavigator;\n\n          self.params.refreshLastItemBreadcrumb = false;\n          self.pub(\"notify\", {\n            type: showContextByMenuDashboard.toUpperCase(),\n            args: $.extend(self.params, { showContextByMenuDashboard: showContextByMenuDashboard,\n              histName: nameItemNavigator,\n              level: newLevelNavigator }) });\n\n          $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\n        }\n      });\n    }\n  },\n\n  /**\r\n      * Call services\r\n      */\n\n  callGetPlan: function callGetPlan(params) {\n    var self = this;\n    var defer = $.Deferred();\n    self.dataService.getPlan(params).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n        defer.resolve(response);\n      } else\n      {\n        defer.reject();\n      }\n    });\n\n    return defer.promise();\n  },\n\n  subMenuHandler: function subMenuHandler() {\n    var self = this;\n    var content = self.getContent();\n    var $comments = $(\"[data-context='ACTIVITYPLANCOMMENTS']\", content);\n    var $files = $(\"[data-context='ACTIVITYPLANFILES']\", content);\n    var $timeline = $(\"[data-context='ACTIVITYPLANTIMELINE']\", content);\n\n    $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\n      $comments.toggle();\n      $files.toggle();\n      $timeline.toggle();\n    });\n  },\n\n  /**\r\n      * Handler events\r\n      */\n  handlerEvents: function handlerEvents() {\n    var self = this;\n    var content = self.getContent();\n    self.subMenuHandler();\n    $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\", $.proxy(self.loadContentById, self));\n  },\n\n  /**\r\n      * Clean widgets and events\r\n      */\n  clean: function clean() {\n    var self = this;\n    var content = self.getContent();\n\n    self._super();\n\n    if (self.params && self.params.contextsLeftSidebarCaseDashboard) {\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function (context) {\n        self.unsub(context, $.proxy(self.updateView, self));\n      });\n    }\n\n    $(\".ui-bizagi-wp-project-tab-links a\", content).off();\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity.plan\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity.plan], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\n\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\") });\n\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-content-dashboard\");\n    self.content = template.render({});\n\n    return self.content;\n  },\n  postRender: function postRender() {\n    var self = this;\n\n    setTimeout(function () {\n      $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\n    }, 1000);\n\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\n\n(function ($) {\n\n  // shorten references to variables. this is better for uglification \n  var kendo = window.kendo,\n  ui = kendo.ui,\n  Widget = ui.Widget;\n\n  var ProjectAttachments = Widget.extend({\n\n    init: function init(element, options) {\n\n      var that = this;\n\n      // base call to initialize widget\n      Widget.fn.init.call(that, element, options);\n\n      that._maxFilesSize = options.maxSize;\n      that._fileList = [];\n      that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\n      that._supportFileExt = options.extensions;\n      that._uploadMaxFilesSize = options.maxSize;\n      that.upload = that._initUpload();\n      that.loadNotifier = that._initLoadNotifier();\n      that.notification = that._initNotification();\n\n      that._eventsHandler();\n\n      that._initLocalization(that.options.localization);\n    },\n\n    options: {\n      name: \"ProjectAttachments\",\n      wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\n      multiple: true,\n      dropZone: true,\n      maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\n      enabled: true,\n      localization: {} },\n\n\n    _initUpload: function _initUpload() {\n\n      var that = this,\n      options = that.options,\n      localization = options.localization || {},\n      auxNumberFilesSuccess = 0;\n\n      that._initLocalization(localization);\n\n      return this.element.kendoUpload({\n        async: {\n          saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\n          autoUpload: true },\n\n        select: function select(event) {\n          that._filterMaxFilesSize(event);\n          auxNumberFilesSuccess = 0;\n        },\n        complete: function complete() {\n          var interval = setInterval(function () {\n            if (that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0) {\n              that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\n              clearInterval(interval);\n            }\n          }, 300);\n        },\n        upload: options.upload,\n        progress: function progress(event) {\n          that._onProgressFile(event);\n        },\n        success: function success(event) {\n          that._fileList.push(event.files[0]);\n          auxNumberFilesSuccess += 1;\n          options.success(event);\n        },\n        error: function error(event) {\n          that.onErrorFile(event);\n        },\n        localization: {\n          select: localization.selectFiles,\n          dropFilesHere: localization.dropFilesHere },\n\n        multiple: options.multiple,\n        enabled: options.enabled,\n        dropZone: options.dropZone,\n        showFileList: false }).\n      data(\"kendoUpload\");\n\n    },\n\n    _initNotification: function _initNotification() {\n      return $(\"<div></div>\").kendoNotification({\n        position: {\n          pinned: true } }).\n\n      data(\"kendoNotification\");\n    },\n\n    _initLoadNotifier: function _initLoadNotifier() {\n\n      var that = this,\n      localization = that.options.localization,\n      $wrapper = that.options.wrapper;\n\n      return $wrapper.kendoWindow({\n        title: localization.notifierTitle,\n        actions: [\"Close\"],\n        animation: {\n          open: {\n            duration: 100 },\n\n          close: {\n            duration: 100 } },\n\n\n        open: function open() {\n          this.wrapper.addClass(\"project-attachments-wrapper-window\");\n        },\n        visible: false,\n        resizable: false,\n        draggable: false,\n        maxHeight: \"300px\",\n        minWidth: \"430px\" }).\n      data(\"kendoWindow\");\n\n    },\n\n    _initLocalization: function _initLocalization(objectOptionsLocalization) {\n      var that = this;\n      var optionsLocalizationByDefault = {\n        selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\n        notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\n        errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error\"),\n        errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\n        errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\n        errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", that._getSize(that._maxFilesSize)),\n        dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\n        cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\n        retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\n        close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\") };\n\n\n      $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\n    },\n\n    /**\r\n        * return maxSize in MB\r\n        * @param {*} maxSize \r\n        */\n    _getSize: function _getSize(maxSize) {\n      return Math.round(maxSize / (1024 * 1024), -1);\n    },\n\n    _onProgressFile: function _onProgressFile(event) {\n\n      var that = this;\n      var $file = that._getFileItemByUID(event.files[0].uid);\n      var percent = event.percentComplete;\n\n      $(\".k-progress\", $file).css({\n        width: percent + \"%\" });\n\n\n      $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\n\n      if (percent === 100) {$(\".k-upload-action .k-icon\", $file).hide();}\n    },\n\n    _onShowUploadNotifier: function _onShowUploadNotifier(event) {\n\n      var that = this,\n      files = event.files,\n      template = that.options.template;\n\n      that.loadNotifier.content(template.render({ files: files }));\n      that.loadNotifier.wrapper.css({\n        top: \"auto\",\n        left: \"auto\",\n        bottom: \"1em\",\n        right: \"1em\" });\n\n\n      that.loadNotifier.open();\n    },\n\n    _showNotificationCompleteUpload: function _showNotificationCompleteUpload(wrapperMessage, auxNumberFilesSuccess) {\n      var that = this;\n      if (wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\n      {\n        that._autoHideMessage(wrapperMessage);\n      }\n    },\n\n    _autoHideMessage: function _autoHideMessage(wrapperMessage) {\n      var that = this;\n      setTimeout(function () {\n        wrapperMessage.fadeOut(function () {\n          that.loadNotifier.close();\n        });\n      }, 2000);\n    },\n\n    _onCancelFile: function _onCancelFile($target) {\n      var that = this,\n      $fileWrapper = $target.closest(\"li\"),\n      $uploadWrapper = that.upload.wrapper,\n      guid = $fileWrapper.data(\"guid\");\n\n      $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\n      $fileWrapper.remove();\n    },\n\n    _onRemoveFile: function _onRemoveFile($target) {\n      var $fileWrapper = $target.closest(\"li\");\n      $fileWrapper.remove();\n    },\n\n    _onRetryFile: function _onRetryFile($target) {\n      var that = this;\n      var $file = $target.closest(\"li\");\n      var guid = $file.data(\"guid\");\n      var file = $.grep(that._fileList, function (i) {\n        return i.uid === guid;\n      });\n\n      that.options.retry(file[0]);\n    },\n\n    onErrorFile: function onErrorFile(event) {\n\n      var that = this,\n      localization = that.options.localization,\n      file = event.files[0],\n      validation = that._isValidFile(file);\n      var message = validation.message !== \"\" ? validation.message : localization.errorUpload;\n\n      that.setStatus(\"ERROR\", file.uid, message);\n    },\n\n    _isValidFile: function _isValidFile(file) {\n\n      var that = this,\n      localization = that.options.localization,\n      valid = true,\n      message = \"\";\n\n      if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0) {\n        message = localization.errorSize;\n        valid = false;\n      }\n\n      if (!that._onlyValidateServerFileExtension) {\n        if ($.inArray(file.extension, that._supportFileExt) === -1) {\n          message = localization.errorSecurity;\n          valid = false;\n        }\n      }\n\n      return {\n        valid: valid,\n        message: message };\n\n    },\n\n    _filterMaxFilesSize: function _filterMaxFilesSize(event) {\n\n      var that = this;\n      var total = 0;\n\n      for (var i = 0, length = event.files.length; i < length; i++) {\n        total += event.files[i].size;\n      }\n      if (total > that._maxFilesSize) {\n        that._notifySizeExceeded();\n        event.preventDefault();\n      } else {\n        that._onShowUploadNotifier(event);\n      }\n    },\n\n    _notifySizeExceeded: function _notifySizeExceeded() {\n\n      var that = this;\n\n      that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\n    },\n\n    _getFileItemByUID: function _getFileItemByUID(uid) {\n      var that = this;\n      return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\n    },\n\n    _switchEvents: function _switchEvents(event) {\n      var that = this;\n      var $target = $(\".k-icon\", event.currentTarget);\n      if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\n        that._onRemoveFile($target);\n      } else if ($target.hasClass(\"k-retry\")) {\n        that._onRetryFile($target);\n      } else if ($target.hasClass(\"k-cancel\")) {\n        that._onCancelFile($target);\n      }\n    },\n\n    _eventsHandler: function _eventsHandler() {\n      var that = this;\n\n      that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\n        that._switchEvents(event);\n      });\n    },\n\n    cancelFilesUpload: function cancelFilesUpload() {\n      var that = this;\n      var $uploadWrapper = that.upload.wrapper;\n\n      $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\n      that.close();\n    },\n\n    close: function close() {\n      this.loadNotifier.close();\n    },\n\n    destroy: function destroy() {\n      this.loadNotifier.destroy();\n      this.upload.destroy();\n    },\n\n    setStatus: function setStatus(status, uid, message) {\n\n      var $file = this._getFileItemByUID(uid),\n      localization = this.options.localization;\n\n      switch (status) {\n        case \"SUCCESS\":\n          $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\n          $(\".k-errormsg\", $file).text(\"\");\n          break;\n        case \"ERROR\":\n          $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\n          $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\n          $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\n          break;\n        case \"RETRY\":\n          $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\n          $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\n          $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\n          break;}\n\n    } });\n\n\n\n  ui.plugin(ProjectAttachments);\n})(jQuery);","/*\r\n *   Name: Bizagi Workportal Desktop Project Discussions Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.discussions\", {}, {\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, notifier, params) {\n\n    var self = this;\n\n    self.typeResource = \"DiscussionGuid\";\n    self.plugins = {};\n    self.dialogBoxDiscussion = {};\n    self.attchComments = {};\n    self.attchDiscussions = {\n      remove: [],\n      addition: [] };\n\n    self.listDataDiscussion = [];\n    self.userPictures = [];\n    self.commentsList = {};\n\n    self.globalTags = [];\n\n    self.tempTagsBeforeDelete = [];\n    self.tempTagsToDelete = [];\n    self.keySentenceAddTag = bizagi.localization.getResource(\"workportal-project-discussion-add-new-tag\") + \": \";\n    self.notifier = notifier;\n\n\n    //Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-discussions\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-wrapper\"),\n      \"project-discussions-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-popup-wrapper\"),\n      \"project-discussions-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-list-wrapper\"),\n      \"project-discussions-comments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-comments-list\"),\n      \"project-discussions-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-attachments-list\"),\n      \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\") });\n\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    var templateHomeDiscussions = self.getTemplate(\"project-discussions\");\n\n    self.content = templateHomeDiscussions.render({});\n    return self.content;\n  },\n\n  /*\r\n      * Post render and links events with handlers\r\n      */\n  postRender: function postRender() {\n\n    var self = this;\n    var $contentWidget = self.getContent();\n\n    self.plugins.popupDiscussion = self.initPluginPopupDiscussion();\n    var popupDiscussion = self.plugins.popupDiscussion;\n\n    //reference for html elements\n    self.form = {\n      buttonShowFormNewDiscussion: $(\".ui-bizagi-wp-action-new\", $contentWidget),\n      title: $(\".ui-bizagi-wp-project-popupform-h4\", popupDiscussion),\n      subject: $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", popupDiscussion),\n      description: $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", popupDiscussion),\n      buttonShowPopupDiscussionToAdd: $(\"#ui-bizagi-wp-project-discussions-button-action-show-popup-to-add\", $contentWidget),\n      buttonAddDiscussion: $(\"#ui-bizagi-wp-project-discussions-popup-action-add-discussion\", popupDiscussion),\n      buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", popupDiscussion),\n      formDiscussion: $(\".ui-bizagi-wp-project-discussions-popup\", popupDiscussion),\n      attachments: $(\".ui-bizagi-wp-project-discussions-attachments-cmnwrapper\", popupDiscussion),\n      edition: false };\n\n\n    self.plugins.tagsFilter = self.initPluginTagsFilter();\n\n    self.plugins.tagsMultiSelect = self.initPluginTagsMultiSelect(popupDiscussion);\n\n    //Load discussions\n    self.getDiscussions();\n    self.eventsHandler();\n    self.restrictedEventsHandler();\n  },\n\n  getDiscussions: function getDiscussions() {\n    var self = this;\n\n    self.getDataDiscussions().done(function () {\n\n      var idUsersCreatedDiscussions = $.map(self.listDataDiscussion, function (element) {\n        return element.user;\n      });\n\n      var idUsersCreatedComments = $.map(self.commentsList, function (property) {\n        return $.map(property.comments, function (property) {\n          return property.user;\n        });\n      });\n\n      function removeDuplicateItemsFromArray(a) {\n        var seen = {};\n        var out = [];\n        var len = a.length;\n        var j = 0;\n        for (var i = 0; i < len; i++) {\n          var item = a[i];\n          if (seen[item] !== 1) {\n            seen[item] = 1;\n            out[j++] = item;\n          }\n        }\n        return out;\n      }\n\n      var csvGuidUsers = removeDuplicateItemsFromArray(idUsersCreatedDiscussions.concat(idUsersCreatedComments).concat(bizagi.currentUser.idUser)).join(\",\");\n\n      self.getDataUsers(csvGuidUsers).then(function () {\n        self.renderUserProfilesAndImages();\n      });\n\n      self.setClassesTagsByDiscussion();\n\n    });\n\n  },\n\n  /*\r\n      * Notifies when an event is raised\r\n      */\n  onNotifyOpenPopup: function onNotifyOpenPopup() {\n    var self = this;\n\n    self.form.edition = false;\n    self.showFormAddDiscussion(\"workportal-project-discussion-adddiscussion\");\n    self.renderUserProfile();\n  },\n\n  /*\r\n      * Init plugins\r\n      */\n  initPluginPopupDiscussion: function initPluginPopupDiscussion() {\n    var self = this;\n    var templatePopupDiscussion = self.getTemplate(\"project-discussions-popup\");\n    self.dialogBoxDiscussion.formContent = templatePopupDiscussion.render({ attachments: [] });\n    return self.dialogBoxDiscussion.formContent;\n  },\n\n\n  initPluginTagsMultiSelect: function initPluginTagsMultiSelect(popupDiscussion) {\n    var self = this;\n    var tags = [];\n    var categoriesMultiSelect = popupDiscussion.find(\"#ui-bizagi-wp-project-discussions-options-multiselect-tags\");\n    var newitemtext;\n    var isDelete = false;\n    var createNewTag = false;\n    return categoriesMultiSelect.kendoMultiSelect({\n      change: function change() {\n        var valuesSelected = this.value().slice(0);\n\n        var dataitems = this.dataSource.data();\n        if (valuesSelected.length > 0) {\n          if (dataitems[0].tag.replace(self.keySentenceAddTag, \"\").indexOf(valuesSelected[valuesSelected.length - 1]) !== -1) {\n            //fix because the value dont complete by millisecond\n            valuesSelected[valuesSelected.length - 1] = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\n          }\n        }\n\n\n        valuesSelected = valuesSelected.filter(Boolean); //Remove empty items\n\n        //remove duplicate items\n        valuesSelected = valuesSelected.filter(function (value, pos, self) {\n          return self.indexOf(value) === pos;\n        });\n\n        var newtag = \"\";\n\n        if (dataitems.length > 0) {\n          if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\n            newtag = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\n\n            var dataItemAddNew = {};\n            if (valuesSelected.indexOf(newtag) !== -1) {\n              dataItemAddNew = this.dataSource.at(0);\n              isDelete = true;\n              this.dataSource.remove(dataItemAddNew);\n              isDelete = false;\n              this.refresh();\n              createNewTag = true;\n            } else\n            {\n              if (newtag) {\n                if ($(\"li:first\", this.list).hasClass(\"k-state-focused\")) {\n                  createNewTag = true;\n                  valuesSelected.push(newtag);\n                }\n                dataItemAddNew = this.dataSource.at(0);\n                isDelete = true;\n                this.dataSource.remove(dataItemAddNew);\n                isDelete = false;\n              }\n            }\n          }\n        }\n        if (newtag) {\n          if (createNewTag) {\n            var existInDatasource = this.dataSource.data().filter(function (itemData) {\n              return itemData.tag === newtag;\n            });\n            if (existInDatasource.length === 0) {\n              this.dataSource.add({ guid: newtag, tag: newtag });\n            }\n            createNewTag = false;\n          }\n        }\n        this.dataSource.filter({});\n        this.value(valuesSelected);\n\n      },\n      dataBound: function dataBound() {\n        if ((newitemtext || this._prev) && newitemtext !== this._prev && !isDelete) {\n          newitemtext = this._prev;\n\n          var dataitems = this.dataSource.data();\n\n          var isfound = false;\n          if (dataitems.length > 0) {\n            if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\n              dataitems[0].tag = self.keySentenceAddTag + newitemtext;\n              this.refresh();\n              isfound = true;\n              $(\"li\", this.list).removeClass(\"k-state-focused\");\n              $(\"li:first\", this.list).addClass(\"k-state-focused\");\n            }\n          }\n\n          if (!isfound) //Is found item with text \"Add new tag:\" ?\n            {\n              this.dataSource.insert(0, self.createEmptyTag(self.keySentenceAddTag, newitemtext));\n            }\n\n          if (this.dataSource.total() == 0) {\n            this.search();\n            this.open();\n            this.refresh();\n            $(\"li\", this.list).removeClass(\"k-state-focused\");\n            $(\"li:first\", this.list).addClass(\"k-state-focused\");\n          }\n        }\n      },\n      dataSource: tags,\n      dataTextField: \"tag\",\n      dataValueField: \"guid\",\n      filter: \"contains\",\n      animation: false }).\n    data(\"kendoMultiSelect\");\n  },\n\n  /**\r\n      * return a json with \"Add new tag\" message\r\n      * @param {*} keySentenceAddTag \r\n      * @param {*} newitemtext \r\n      * @returns \r\n      */\n  createEmptyTag: function createEmptyTag(keySentenceAddTag, newitemtext) {\n    return { tag: keySentenceAddTag + newitemtext, guid: \"\" };\n  },\n\n  initPluginTagsFilter: function initPluginTagsFilter() {\n    var self = this;\n    var $contentWidget = self.getContent();\n    return $(\"#ui-bizagi-wp-project-discussions-options-tags-filter\", $contentWidget).kendoMultiSelect({\n      change: function change() {\n        self.hideOrShowDiscussionsByFilter();\n      },\n      autoClose: false,\n      tagMode: \"single\",\n      dataTextField: \"tag\",\n      dataValueField: \"guid\" }).\n    data(\"kendoMultiSelect\");\n  },\n\n  hideOrShowDiscussionsByFilter: function hideOrShowDiscussionsByFilter() {\n    var self = this;\n    var valuesSelected = self.plugins.tagsFilter.value();\n    if (valuesSelected.length > 0) {\n      $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).hide();\n      valuesSelected.forEach(function (valueClass) {\n        $(\".ui-bizagi-wp-project-discussions-item.\" + valueClass, self.getContent()).show();\n      });\n    } else\n    {\n      $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).show();\n    }\n  },\n\n  validateAddCommentForm: function validateAddCommentForm($wrapperForm) {\n    var result = false;\n    var $textAreaComment = $(\"textarea\", $wrapperForm);\n    if ($textAreaComment.val().trim() === \"\") {\n      var commentValidation = bizagi.localization.getResource(\"workportal-project-discussion-requiredcomment\");\n      $textAreaComment.parent().next().find('span').html(commentValidation);\n    } else\n    {\n      $textAreaComment.parent().next().find('span').empty();\n      result = true;\n    }\n    return result;\n  },\n\n  validateAddDiscussionForm: function validateAddDiscussionForm($wrapperForm) {\n    var result = false;\n    var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", $wrapperForm);\n    var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", $wrapperForm);\n    if ($subjectDiscussion.val().trim() !== \"\" && $descriptionDiscussion.val().trim() !== \"\") {\n      result = true;\n    }\n    if ($subjectDiscussion.val().trim() === \"\") {\n      var subjectValidation = bizagi.localization.getResource(\"workportal-project-discussion-subjectrequired\");\n      $subjectDiscussion.parent().find(\"span\").html(subjectValidation);\n    } else\n    {\n      $subjectDiscussion.parent().find(\"span\").empty();\n    }\n    if ($descriptionDiscussion.val().trim() === \"\") {\n      var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\n      $descriptionDiscussion.parent().next().find(\"span\").html(descriptionValidation);\n    } else\n    {\n      $descriptionDiscussion.parent().next().find(\"span\").empty();\n    }\n\n    return result;\n  },\n\n  applyFileAttachments: function applyFileAttachments(type) {\n\n    var self = this;\n    var content = type === \"DISCUSSIONS\" ? self.plugins.popupDiscussion : self.getContent();\n\n    return $(\".ui-bizagi-wp-project-discussions-attachment-upload\", content).kendoProjectAttachments({\n      saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\n      template: self.getTemplate(\"project-attachments\"),\n      success: function success(event) {\n        self.onSuccessFile(event, type);\n      },\n      upload: $.proxy(self.addFileData, self),\n      dropZone: false,\n      extensions: self.supportFileExt,\n      maxSize: self.uploadMaxFilesSize }).\n    data(\"kendoProjectAttachments\");\n  },\n\n  addFileData: function addFileData(event) {\n\n    var uid = event.files[0].uid;\n\n    event.files[0].guid = uid;\n    event.data = {\n      guid: uid };\n\n  },\n\n\n  /*\r\n      *  Get data for discussions\r\n      */\n  getDataDiscussions: function getDataDiscussions() {\n\n    var self = this,\n    defer = $.Deferred();\n\n    var paramsGetDiscussions = {\n      globalParent: self.radNumber,\n      typeResource: self.typeResource };\n\n\n    if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\n      paramsGetDiscussions.globalParent = self.params.plan.id;\n    }\n\n    self.dataService.getDiscussionsData(paramsGetDiscussions).pipe(function (response) {\n      return self.callForListComments(response);\n    }).done(function (response) {\n      self.listDataDiscussion = self.sortDiscussions(response);\n      self.updateTemplateListDiscussion();\n      defer.resolve();\n    });\n    return defer.promise();\n  },\n\n  /*\r\n      *  Get data for users\r\n      */\n  getDataUsers: function getDataUsers(usersGuids) {\n    var self = this,\n    defer = $.Deferred();\n\n    var params = {\n      usersGuids: usersGuids,\n      width: 50,\n      height: 50 };\n\n\n    if (params.usersGuids) {\n      self.dataService.getUsersData(params).always(function (response) {\n\n        function arrayUnique(array) {\n          var a = array.concat();\n          for (var i = 0; i < a.length; ++i) {\n            for (var j = i + 1; j < a.length; ++j) {\n              if (a[i] === a[j]) {\n                a.splice(j--, 1);\n              }\n            }\n          }\n          return a;\n        }\n\n        self.userPictures = arrayUnique(self.userPictures.concat(response));\n        defer.resolve();\n      });\n    } else\n    {\n      defer.resolve();\n    }\n\n\n    return defer.promise();\n  },\n\n  /*\r\n      * Call list of comments by discussion\r\n      */\n  callForListComments: function callForListComments(discussions) {\n\n    var self = this,\n    generalDefer = $.Deferred(),\n    commentsDefer = [];\n\n    for (var i = 0, length = discussions.length - 1; i <= length; i++) {\n\n      self.addGlobalTags(discussions[i].tags, false);\n\n      var params = {\n        idParent: discussions[i].guid,\n        dateTime: self.getDateServer(),\n        count: 6 };\n\n\n      self.commentsList[params.idParent] = {\n        comments: [],\n        count: 0,\n        total: 0 };\n\n\n      var defer = $.when(self.dataService.getCommentsData(params)).done(function (response) {\n        if (response.length > 0) {\n          self.commentsList[response[0].parent] = {\n            comments: response,\n            count: response.length,\n            total: 0 };\n\n        }\n      });\n\n      commentsDefer.push(defer);\n    }\n\n    $.when.apply($, commentsDefer).done(function () {\n      generalDefer.resolve(discussions);\n    });\n\n    return generalDefer.promise();\n  },\n\n  sortDiscussions: function sortDiscussions(discussions) {\n    var sortedDiscussion = [];\n    if (discussions.length) {\n      sortedDiscussion = discussions.sort(function (a, b) {\n        var dateA = a.date;\n        var dateB = b.date;\n\n        return dateB - dateA;\n      });\n\n      if (sortedDiscussion.length > 0) {var\n        array_move = function array_move(arr, old_index, new_index) {\n          if (new_index >= arr.length) {\n            var k = new_index - arr.length + 1;\n            while (k--) {\n              arr.push(undefined);\n            }\n          }\n          arr.splice(new_index, 0, arr.splice(old_index, 1)[0]);\n          return arr;\n        };;\n        var positionDiscussion = -1;\n        for (var iDis = 0; iDis < sortedDiscussion.length; iDis++) {\n          if (sortedDiscussion[iDis].name === \"workportal-project-discussion-generaldiscussion\") {\n            positionDiscussion = iDis;\n            break;\n          }\n        }\n\n        if (positionDiscussion > 0) {\n          array_move(sortedDiscussion, positionDiscussion, 0);\n        }\n      }\n    }\n    return sortedDiscussion;\n  },\n\n  resetDiscussionAttachments: function resetDiscussionAttachments() {\n\n    var self = this;\n    var popupDiscussion = self.plugins.popupDiscussion;\n    $(\".ui-bizagi-wp-project-attachments-list\", popupDiscussion).empty();\n\n    self.plugins.tagsMultiSelect.value([]);\n\n    self.attchDiscussions.addition = [];\n    self.attchDiscussions.remove = [];\n    self.getDiscussions();\n  },\n\n  sendDataUpdateDiscussion: function sendDataUpdateDiscussion(guid) {\n\n    var self = this;\n    var filesObj = self.prepareFilesToSave();\n    self.form.buttonAddDiscussion.prop(\"disabled\", true);\n\n    var tagsDiscussion = self.getTagsDiscussionBySave();\n    var guidsTagsDiscussionToDelete = self.getGuidsTagsDiscussionToDelete();\n\n    var params = {\n      content: {\n        name: self.form.subject.val(),\n        description: self.form.description.val(),\n        globalParent: self.radNumber.toString(),\n        user: bizagi.currentUser.idUser,\n        attachments: filesObj.attachments,\n        guid: guid,\n        tags: tagsDiscussion,\n        typeResource: \"DiscussionGuid\",\n        general: false,\n        date: self.getDateServer() },\n\n      attachmentsToCreate: filesObj.attachmentsToCreate,\n      attachmentsToDelete: filesObj.attachmentsToDelete };\n\n\n    self.plugins.attchDiscussions.close();\n\n    self.dataService.editDiscussion(params).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n        self.addGlobalTags(tagsDiscussion, true);\n\n        var discussion = self.getDiscussionDataByGUID(guid);\n        discussion.name = params.content.name;\n        discussion.description = params.content.description;\n        discussion.attachments = params.content.attachments;\n        discussion.tags = params.content.tags;\n\n        self.onClosePopupDiscussion();\n\n        self.resetDiscussionAttachments();\n        self.updateTemplateListDiscussion();\n\n        self.removeGlobalTags(guidsTagsDiscussionToDelete);\n\n        self.notifier.showSucessMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-edited\"), \"\"));\n      } else {\n\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\n\n        self.onClosePopupDiscussion();\n        self.notifier.showErrorMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-error-edition\"), \"\"));\n      }\n\n\n      self.renderUserProfilesAndImages();\n\n      self.setClassesTagsByDiscussion();\n      self.hideOrShowDiscussionsByFilter();\n    });\n\n  },\n  validateStringIsGuid: function validateStringIsGuid(value) {\n    var validGuid = /^({|()?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}(}|))?$/;\n    var emptyGuid = /^({|()?0{8}-(0{4}-){3}0{12}(}|))?$/;\n    return validGuid.test(value) && !emptyGuid.test(value);\n  },\n\n  sendDataInsertDiscussion: function sendDataInsertDiscussion(guid) {\n\n    var self = this;\n    var filesObj = self.prepareFilesToSave();\n\n    self.form.buttonAddDiscussion.prop(\"disabled\", true);\n\n    var tagsDiscussion = self.getTagsDiscussionBySave();\n\n    var params = {\n      content: {\n        name: self.form.subject.val(),\n        description: self.form.description.val(),\n        globalParent: self.radNumber.toString(),\n        user: bizagi.currentUser.idUser,\n        attachments: filesObj.attachments,\n        guid: guid,\n        tags: tagsDiscussion,\n        typeResource: \"DiscussionGuid\",\n        general: false,\n        date: self.getDateServer() },\n\n      attachmentsToCreate: filesObj.attachmentsToCreate,\n      attachmentsToDelete: filesObj.attachmentsToDelete };\n\n\n    self.plugins.attchDiscussions.close();\n\n    self.dataService.postDiscussion(params).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n\n        self.addGlobalTags(tagsDiscussion, true);\n\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\n\n        var newDiscussion = {\n          \"name\": params.content.name,\n          \"description\": params.content.description,\n          \"date\": params.content.date,\n          \"user\": params.content.user,\n          \"attachments\": params.content.attachments,\n          \"radNumber\": params.content.globalParent,\n          \"general\": params.content.general,\n          \"guid\": params.content.guid,\n          \"tags\": params.content.tags,\n          \"typeResource\": params.content.typeResource };\n\n\n        self.commentsList[params.content.guid] = {\n          comments: [],\n          count: 0,\n          total: 0 };\n\n\n        if (self.listDataDiscussion.length === 0) {//Add first discussion\n          self.listDataDiscussion.push(newDiscussion);\n        } else\n        {//Add discussion in position 1\n          self.listDataDiscussion.splice(1, 0, newDiscussion);\n        }\n\n        self.resetDiscussionAttachments();\n        self.onClosePopupDiscussion();\n        self.notifier.showSucessMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-created\"), \"\"));\n        self.updateTemplateListDiscussion();\n        self.updateDiscussionsMenu(true);\n      } else\n      {\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\n        self.onClosePopupDiscussion();\n        self.notifier.showErrorMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-error-creation\"), \"\"));\n      }\n\n      self.renderUserProfilesAndImages();\n\n      self.setClassesTagsByDiscussion();\n      self.hideOrShowDiscussionsByFilter();\n    });\n  },\n\n  /**\r\n      * Notify that discussions Icon shoul be updated\r\n      * @param {*} hasDiscussionsOrComment \r\n      */\n  updateDiscussionsMenu: function updateDiscussionsMenu(hasDiscussionsOrComment) {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"UPDATE_DISCUSSIONS_MENU_STATUS\",\n      hasDiscussionsOrComment: hasDiscussionsOrComment });\n\n  },\n  getTagsDiscussionBySave: function getTagsDiscussionBySave() {\n    var self = this;\n    var tagsTextSelected = self.plugins.tagsMultiSelect.value();\n    var dataSourceTags = self.plugins.tagsMultiSelect.dataSource.data();\n\n    var tagsDiscussion = [];\n    tagsTextSelected.forEach(function (tagTextSelected) {\n      var isGuidTextSelected = self.validateStringIsGuid(tagTextSelected);\n\n      var tagFound;\n      if (isGuidTextSelected) {\n        tagFound = dataSourceTags.filter(function (tagSource) {\n          return tagSource.guid === tagTextSelected;\n        });\n      } else\n      {\n        tagFound = dataSourceTags.filter(function (tagSource) {\n          var isGuid = self.validateStringIsGuid(tagSource.guid);\n          return tagSource.tag === tagTextSelected && !isGuid;\n        });\n      }\n\n      if (tagFound.length === 1) {\n        tagsDiscussion.push({\n          guid: isGuidTextSelected ? tagFound[0].guid : tagFound[0].uid,\n          tag: tagFound[0].tag });\n\n      }\n\n    });\n\n    return tagsDiscussion;\n  },\n\n  //b: minuendo, a: sustraendo\n  differenceArrays: function differenceArrays(b, a) {\n    return b.filter(function (i) {\n      return a.indexOf(i) < 0;\n    });\n  },\n\n  getGuidsTagsDiscussionToDelete: function getGuidsTagsDiscussionToDelete() {\n    var self = this;\n    var guidsTagsCurrentDiscussion = self.plugins.tagsMultiSelect.value();\n    return self.differenceArrays(self.tempTagsBeforeDelete, guidsTagsCurrentDiscussion);\n  },\n\n  /*\r\n      *   UI Functions\r\n      */\n  setStateUIShowMoreComments: function setStateUIShowMoreComments($commentsContainer, state) {\n    var $containerButtonMoreComments = $commentsContainer.siblings(\".ui-bizagi-wp-project-discussion-showmore-comments\");\n    var $buttonShowMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-comments-button\");\n    var $messageNoMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-no-more-comments\");\n    var $messageLoadingComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-loading-comments\");\n\n    if (state === \"ALLOW_MORE_COMMENTS\") {\n      $buttonShowMoreComments.show();\n      $messageNoMoreComments.hide();\n      $messageLoadingComments.hide();\n    }\n\n    if (state === \"LOADING_MORE_COMMENTS\") {\n      $buttonShowMoreComments.hide();\n      $messageNoMoreComments.hide();\n      $messageLoadingComments.show();\n    }\n\n    if (state === \"NO_MORE_COMMENTS\") {\n      $buttonShowMoreComments.hide();\n      $messageNoMoreComments.show();\n      $messageLoadingComments.hide();\n    }\n  },\n\n  getCurrentUserInfo: function getCurrentUserInfo() {\n    return {\n      name: bizagi.currentUser.userName,\n      id: bizagi.currentUser.idUser,\n      picture: \"\" };\n\n  },\n\n  /*Functions about tags*/\n\n  addGlobalTags: function addGlobalTags(tagsDiscussion, createTagsOnServer) {\n    var self = this;\n\n    for (var iTagAdd = 0; iTagAdd < tagsDiscussion.length; iTagAdd += 1) {\n      var existTag = self.globalTags.filter(function (tagGlobal) {\n        return tagGlobal.tag === tagsDiscussion[iTagAdd].tag;\n      });\n      if (existTag.length === 0) {\n        tagsDiscussion[iTagAdd].globalParent = self.radNumber;\n        self.globalTags.push(tagsDiscussion[iTagAdd]);\n        if (createTagsOnServer) {\n          self.dataService.postTag(tagsDiscussion[iTagAdd]);\n        }\n      }\n    }\n\n    //Sync tags\n    self.plugins.tagsFilter.dataSource.data(self.globalTags);\n    self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\n  },\n\n  removeGlobalTags: function removeGlobalTags(guidTagsToDelete) {\n    var self = this;\n    var allGuidsTagsAllDiscussions = $.map(self.listDataDiscussion, function (discussion) {\n      return $.map(discussion.tags, function (itemTag) {\n        return itemTag.guid;\n      });\n    });\n\n    var allGuidsMoreGuidsDelete = allGuidsTagsAllDiscussions.concat(guidTagsToDelete);\n\n    var secureGuidsForDelete = [];\n    guidTagsToDelete.forEach(function (guidDelete) {\n      var existGuidOnlyTimeThenDelete = allGuidsMoreGuidsDelete.filter(function (guid) {\n        return guid === guidDelete;\n      });\n      if (existGuidOnlyTimeThenDelete.length === 1) {\n        secureGuidsForDelete.push(guidDelete);\n      }\n    });\n\n\n    secureGuidsForDelete.forEach(function (guidSecureDelete) {\n      //delete with service\n      var params = { idTag: guidSecureDelete };\n      self.dataService.deleteTag(params);\n\n      //delete globalTags\n      for (var iTagGlobal = self.globalTags.length - 1; iTagGlobal >= 0; iTagGlobal -= 1) {\n        if (self.globalTags[iTagGlobal].guid === guidSecureDelete) {\n          self.globalTags.splice(iTagGlobal, 1);\n        }\n      }\n    });\n\n    //Sync tags\n    self.plugins.tagsFilter.dataSource.data(self.globalTags);\n    self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\n  },\n\n  setClassesTagsByDiscussion: function setClassesTagsByDiscussion() {\n    var self = this;\n    for (var iDiscussion = 0; iDiscussion < self.listDataDiscussion.length; iDiscussion += 1) {\n      var textTagsDiscussion = $.map(self.listDataDiscussion[iDiscussion].tags, function (itemTag) {\n        return itemTag.guid;\n      });\n      var tagsBySpace = textTagsDiscussion.join(\" \");\n\n      $(\".ui-bizagi-wp-project-discussions-item[data-guid='\" + self.listDataDiscussion[iDiscussion].guid + \"']\", self.getContent()).addClass(tagsBySpace);\n    }\n  },\n\n  updateTemplateListDiscussion: function updateTemplateListDiscussion() {\n\n    var self = this;\n    var $contentWidget = self.getContent();\n    var templateListDiscussions = self.getTemplate(\"project-discussions-list\");\n    var user = self.getCurrentUserInfo();\n    var contentRenderListDiscussions = templateListDiscussions.render({\n      listDataDiscussions: self.listDataDiscussion,\n      user: user,\n      isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\n      returnServedCommentByParentId: function returnServedCommentByParentId(parentId) {\n        return self.returnServedCommentByParentId(parentId);\n      } });\n\n    for (var i = 0; i < this.listDataDiscussion.length; i++) {\n      this.mapTempComments($(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"),\n      contentRenderListDiscussions.find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"));\n    }\n    $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).empty().append(contentRenderListDiscussions);\n\n    self.plugins.attchComments = self.applyFileAttachments(\"COMMENTS\");\n  },\n\n  showFormAddDiscussion: function showFormAddDiscussion(resourceTitlePopup) {\n    var self = this;\n\n    if (self.plugins.attchComments) {\n      self.plugins.attchComments.close();\n    }\n    self.dialogBoxDiscussion.formContent.dialog({\n      resizable: false,\n      draggable: false,\n      height: \"auto\",\n      width: \"650px\",\n      modal: true,\n      zIndex: 1,\n      title: bizagi.localization.getResource(resourceTitlePopup),\n      maximize: true,\n      open: $.proxy(self.onOpenPopupDiscussion, self),\n      close: function close() {\n        self.resetDiscussionAttachments();\n        self.onClosePopupDiscussion();\n      } });\n\n  },\n\n  resetFormDiscussion: function resetFormDiscussion() {\n    var self = this;\n\n    self.form.buttonAddDiscussion.prop(\"disabled\", false);\n    self.form.subject.val(\"\");\n    self.form.description.val(\"\");\n\n    var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", self.dialogBoxDiscussion.formContent);\n    var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", self.dialogBoxDiscussion.formContent);\n    $subjectDiscussion.parent().find(\"span\").empty();\n    $descriptionDiscussion.parent().next().find(\"span\").empty();\n  },\n\n  renderUserProfile: function renderUserProfile() {\n    var self = this;\n\n    var userPicture = $.grep(self.userPictures, function (userPicture) {\n      return userPicture.id === bizagi.currentUser.idUser;\n    })[0];\n\n    var base64Prefix = \"data:image/png;base64,\";\n    var $parent = $(\".ui-bizagi-wp-project-popupform-user\");\n    var $img = $parent.find(\".bz-wp-avatar-img\");\n    var $text = $parent.find(\".bz-wp-avatar-label\");\n\n    if (userPicture) {\n      if (userPicture.picture) {\n        $img.attr(\"src\", base64Prefix + userPicture.picture);\n      } else {\n        $img.hide();\n        $text.html(userPicture.name.getInitials()).show();\n      }\n    }\n  },\n\n  renderUserProfilesAndImages: function renderUserProfilesAndImages() {\n    var self = this;\n\n    var userPicture = $.grep(self.userPictures, function (userPicture) {\n      return userPicture.id === bizagi.currentUser.idUser;\n    })[0];\n\n    var base64Prefix = \"data:image/png;base64,\";\n\n    if (userPicture) {\n      $(\".ui-bizagi-wp-project-discussions-create-comment .bz-wp-discussion-username\").html(userPicture.name);\n      if (userPicture.picture) {\n        $(\".ui-bizagi-wp-project-discussions-item-user img\").attr(\"src\", base64Prefix + userPicture.picture);\n        $(\".ui-bizagi-wp-project-popupform-image-current-user\").attr(\"src\", base64Prefix + userPicture.picture);\n      } else {\n        $(\".ui-bizagi-wp-project-discussions-item-user label.bz-wp-avatar-label\").html(userPicture.name.getInitials()).show();\n        $(\".ui-bizagi-wp-project-discussions-item-user img\").hide();\n      }\n    }\n\n    for (var iUser = 0; iUser < self.userPictures.length; iUser++) {\n      $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-discussion-username\").html(self.userPictures[iUser].name);\n      if (self.userPictures[iUser].picture) {\n        $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").attr(\"src\", base64Prefix + self.userPictures[iUser].picture);\n      } else {\n        $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").hide();\n        $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] label.bz-wp-avatar-label\").html(self.userPictures[iUser].name.getInitials());\n      }\n    }\n  },\n\n  /*EVENTS*/\n  switchCommentsEvents: function switchCommentsEvents(event) {\n\n    var self = this;\n    var $target = $(event.target);\n    var $parent = $target.parent();\n\n    if ($target.is(\"textarea\")) {\n      self.onShowButtonsPanel($target);\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-cancel\")) {\n\n      self.onCancelComment($target);\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-share\")) {\n\n      var $container = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\n      if (self.validateAddCommentForm($container)) {\n        var guid = Math.guid();\n        self.onCreateComment($target, guid);\n      }\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-view\")) {\n      self.onViewComment($target);\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussion-showmore-comments-button\")) {\n      self.onViewMoreComments($target);\n    } else if ($target.hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\n      self.onRemoveFiles($target);\n    } else if ($parent.hasClass(\"biz-wp-user-icon-admin\") && $parent.hasClass(\"biz-wp-action-edit-discussion\")) {\n      self.onEditDiscussion($target);\n    } else if ($parent.hasClass(\"ui-bizagi-wp-project-discussion-delete\")) {\n\n      $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-discussion-querydelete\"), \"\", \"info\")).done(function () {\n        self.onDeleteComment($parent);\n      });\n\n    } else if ($parent.hasClass(\"bz-bizagi-wp-project-discussions-attachment-itemwrapper\")) {\n      self.onDownloadAttachment($target.closest(\"li\"));\n    }\n\n    event.stopPropagation();\n  },\n\n  onEditDiscussion: function onEditDiscussion($target) {\n\n    var self = this;\n    var $discussionCnt = $target.closest(\".ui-bizagi-wp-project-discussions-item\");\n    var guid = $discussionCnt.data(\"guid\");\n\n    self.setDiscussionsDataByGUID(guid);\n    self.showFormAddDiscussion(\"workportal-project-discussion-edit\");\n  },\n\n  setDiscussionsDataByGUID: function setDiscussionsDataByGUID(guid) {\n\n    var self = this;\n\n    var discussion = self.getDiscussionDataByGUID(guid);\n    var $container = $(\".ui-bizagi-wp-project-attachments-list\", self.form.attachments);\n\n    self.form.edition = {\n      guid: guid };\n\n\n    self.attchDiscussions = {\n      addition: discussion.attachments,\n      remove: [] };\n\n\n    self.form.title.text(bizagi.localization.getResource(\"workportal-project-discussion-edit\"));\n    self.form.subject.val(discussion.name);\n    self.form.description.val(discussion.description);\n\n    var guidTagsDiscussion = $.map(discussion.tags, function (itemTag) {\n      return itemTag.guid;\n    });\n    self.plugins.tagsMultiSelect.value(guidTagsDiscussion);\n    self.tempTagsBeforeDelete = [];\n    self.tempTagsBeforeDelete = self.tempTagsBeforeDelete.concat(self.plugins.tagsMultiSelect.value());\n\n    self.renderAttachments(discussion.attachments, \"DISCUSSIONS\", $container);\n\n  },\n\n  getDiscussionDataByGUID: function getDiscussionDataByGUID(guid) {\n\n    var self = this;\n    var discussion;\n\n    for (var i = self.listDataDiscussion.length - 1; i >= 0; i--) {\n      if (self.listDataDiscussion[i].guid === guid) {\n        discussion = self.listDataDiscussion[i];\n        i = 0;\n      }\n    }\n\n    return discussion;\n  },\n\n  onViewComment: function onViewComment($target) {\n    var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-comment-truncatewrapper\");\n    $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-shortcomment\");\n    $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-longcomment\");\n  },\n\n  onViewMoreComments: function onViewMoreComments($target) {\n    var self = this;\n    var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussion-showmore-comments\");\n    var $commentsContainer = $commentWrapper.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\n    var idParent = $commentsContainer.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\n\n    if (!self.commentsList[idParent].total) {\n      //only one time call service if total is null\n      self.dataService.getCommentsCountByParent(idParent).done(function (response) {\n        self.commentsList[idParent].total = response.count;\n        self.getMoreComments(idParent, $commentsContainer);\n      });\n    } else\n    {\n      self.getMoreComments(idParent, $commentsContainer);\n    }\n  },\n\n  getMoreComments: function getMoreComments(idParent, $commentsContainer) {\n    var self = this;\n\n    //validate total comments vs count comments\n    if (self.commentsList[idParent].total > self.commentsList[idParent].comments.length) {\n\n      self.setStateUIShowMoreComments($commentsContainer, \"LOADING_MORE_COMMENTS\");\n\n      var dateLastComment;\n      if (self.commentsList[idParent].comments.length === 0) {\n        dateLastComment = self.getDateServer();\n      } else\n      {\n        dateLastComment = self.commentsList[idParent].comments[self.commentsList[idParent].comments.length - 1].date;\n      }\n\n      //substract one millisecond\n      dateLastComment -= 1;\n\n      self.dataService.getCommentsData(\n      {\n        dateTime: dateLastComment,\n        idParent: idParent,\n        count: 6 }).\n\n      done(function (responseMoreComments) {\n\n        if (responseMoreComments.length) {\n          Array.prototype.push.apply(self.commentsList[idParent].comments, responseMoreComments);\n          self.commentsList[idParent].count += responseMoreComments.length;\n\n          self.renderCommentByDiscussion($commentsContainer, idParent, responseMoreComments);\n          self.renderUserProfilesAndImages();\n\n          if (responseMoreComments.length > 5) {\n            self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\n          } else {\n            self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\n          }\n\n          //Get profiles of idUsers not download in this moment\n          var idUsersLoaded = $.map(self.userPictures, function (element) {\n            return element.id;\n          });\n\n          var idUsersNewComments = $.map(self.commentsList, function (property) {\n            return $.map(property.comments, function (property) {\n              return property.user;\n            });\n          });\n\n          var arrayIdUsersMissingLoad = $(idUsersNewComments).not(idUsersLoaded).get();\n          var csvIdUsersMissingLoad = arrayIdUsersMissingLoad.join(\",\");\n\n          self.getDataUsers(csvIdUsersMissingLoad).then(function () {\n            self.renderUserProfilesAndImages();\n          });\n\n        } else\n        {\n          self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\n        }\n      }).fail(function () {\n        self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\n      });\n    } else\n    {\n      self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\n    }\n\n  },\n\n  renderCommentByDiscussion: function renderCommentByDiscussion($container, guidParent, moreComments) {\n\n    var self = this,\n    tmplComment = self.getTemplate(\"project-discussions-comments\"),\n    $commentsDOM,\n    renderObject = {\n      comments: [],\n      user: self.getCurrentUserInfo(),\n      isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) };\n\n\n    if (!moreComments.length) {\n      renderObject.comments = self.commentsList[guidParent].comments;\n      $commentsDOM = tmplComment.render(renderObject);\n      $container.html($commentsDOM);\n    } else {\n      renderObject.comments = moreComments;\n      $commentsDOM = tmplComment.render(renderObject);\n      $container.append($commentsDOM);\n    }\n  },\n\n  getCommentByGuid: function getCommentByGuid(parentGuid, commentGuid) {\n\n    var self = this;\n    var commentsList = self.commentsList[parentGuid].comments;\n\n    for (var i = 0, length = commentsList.length; i < length; i++) {\n\n      if (commentsList[i].guid === commentGuid) {\n        var attachments = [];\n\n        for (var x = 0, lengthx = commentsList[i].attachments.length; x < lengthx; x++) {\n          attachments.push(commentsList[i].attachments[x].guid);\n        }\n\n        return {\n          attachments: attachments,\n          index: i };\n\n      }\n    }\n\n    return {};\n  },\n\n  returnServedCommentByParentId: function returnServedCommentByParentId(parentId) {\n    var self = this;\n\n    if (typeof self.commentsList[parentId] !== \"undefined\") {\n      return self.commentsList[parentId];\n    }\n  },\n\n  /*\r\n      *   Events\r\n      */\n  onShowButtonsPanel: function onShowButtonsPanel($target) {\n    var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\").find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\n    $buttonsWrp.show();\n  },\n\n  onRemoveFiles: function onRemoveFiles($target) {\n    var self = this;\n    var $container = $target.closest(\"li\"),\n    type = $container.closest(\".ui-bizagi-wp-project-attachments-list\").data(\"type\"),\n    fileGuid = $container.data(\"fileguid\");\n    var currentFiles, removeFiles, tmpSplice;\n\n    if (type === \"COMMENT\") {\n      var guid = $container.closest(\".ui-bizagi-wp-project-discussions-add-comment\").data(\"guid\");\n      currentFiles = self.attchComments[guid].addition;\n      removeFiles = self.attchComments[guid].remove;\n\n    } else {\n      currentFiles = self.attchDiscussions.addition;\n      removeFiles = self.attchDiscussions.remove;\n    }\n\n    for (var i = 0, length = currentFiles.length - 1; i <= length; i++) {\n\n      if (currentFiles[i].guid === fileGuid) {\n        tmpSplice = currentFiles.splice(i, 1);\n        removeFiles.push(tmpSplice[0].guid);\n        i = length;\n      }\n    }\n\n    $container.remove();\n  },\n\n  onDeleteComment: function onDeleteComment($target) {\n    var self = this;\n    var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\n    var commentGuid = $commentWrapper.data(\"cmmtguid\");\n    var parentGuid = $commentWrapper.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\n    var comment = self.getCommentByGuid(parentGuid, commentGuid);\n\n    var params = {\n      content: {\n        guid: commentGuid },\n\n      attachmentsToDelete: comment.attachments };\n\n\n    $.when(self.dataService.deleteComment(params)).always(function (response) {\n      if (response.status === 200 || typeof response.status === \"undefined\") {\n        self.commentsList[parentGuid].comments.splice(comment.index, 1);\n        $commentWrapper.remove();\n\n        var hasDiscussionsOrComment = self.hasDiscussionsOrComment(self.commentsList);\n        self.updateDiscussionsMenu(hasDiscussionsOrComment);\n      } else {\n        self.notifier.showErrorMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-errordelete\"), \"\"));\n      }\n    });\n  },\n\n  hasDiscussionsOrComment: function hasDiscussionsOrComment(comments) {\n    var keys = Object.keys(comments);\n    var haveDiscussions = keys.length > 1;\n    var haveComments = false;\n    for (var i = 0; i < keys.length; i++) {\n      if (comments[keys[i]].comments.length > 0) {\n        haveComments = true;\n        break;\n      }\n    }\n    return haveDiscussions || haveComments;\n  },\n\n  onSuccessFile: function onSuccessFile(event, type) {\n    var self = this;\n    var files = event.files;\n    var status = event.XMLHttpRequest.response ? JSON.parse(event.XMLHttpRequest.response) : {};\n\n    if (!status.error) {\n      var $wrapper = $(event.sender.element).closest(\".ui-bizagi-wp-project-discussion-textwrapper\");\n      var $container = $wrapper.find(\".ui-bizagi-wp-project-attachments-list\");\n\n      if (type === \"DISCUSSIONS\") {\n        self.plugins.attchDiscussions.setStatus(\"SUCCESS\", files[0].guid);\n        Array.prototype.push.apply(self.attchDiscussions.addition, files);\n      } else {\n        self.plugins.attchComments.setStatus(\"SUCCESS\", files[0].guid);\n        var guid = $wrapper.data(\"guid\");\n\n        if (self.attchComments[guid]) {\n          Array.prototype.push.apply(self.attchComments[guid].addition, files);\n        } else {\n          self.attchComments[guid] = {\n            addition: files,\n            remove: [] };\n\n        }\n\n        self.onShowButtonsPanel($container.parent());\n      }\n\n      self.renderAttachments(files, type, $container);\n    } else {\n\n      if (type === \"DISCUSSIONS\") {\n        self.plugins.attchDiscussions.onErrorFile(event);\n      } else {\n        self.plugins.attchComments.onErrorFile(event);\n      }\n    }\n  },\n\n  onDownloadAttachment: function onDownloadAttachment($liTarget) {\n    var self = this;\n    var guidAttachment = $liTarget.data(\"fileguid\");\n\n    if (guidAttachment !== \"\") {\n      var nameFile = $liTarget.find(\".bz-bizagi-wp-project-discussions-attachment-filename\").text();\n      self.dataService.getDownloadAttachment(guidAttachment, nameFile);\n    }\n  },\n\n  onCancelComment: function onCancelComment($target) {\n    var self = this;\n    var $commentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\n    var $buttonsWrp = $commentContainer.find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\n    var $textarea = $commentContainer.find(\"textarea\");\n    var $uploadForm = $commentContainer.find(\".ui-bizagi-wp-project-discussions-add-attachments form\");\n    var $vlTooltip = $commentContainer.find(\".k-tooltip-validation\");\n    var $fileList = $commentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\n    var guid = $commentContainer.data(\"guid\");\n\n    self.attchComments[guid] = {\n      addition: [],\n      remove: [] };\n\n\n    self.plugins.attchComments.cancelFilesUpload();\n\n    $uploadForm[0].reset();\n    $fileList.empty();\n    $textarea.val(\"\");\n    $vlTooltip.hide();\n    $buttonsWrp.hide();\n  },\n\n  onCreateComment: function onCreateComment($target, guid) {\n    var self = this;\n    var $rplWrp = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\n    var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\n    var $addCommentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\n    var $textarea = $addCommentContainer.find(\"textarea\");\n    var $uploadList = $addCommentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\n    var idParent = $addCommentContainer.data(\"guid\");\n    var filesObj = self.prepareFilesToSave(\"COMMENTS\", idParent);\n\n    var params = {\n      content: {\n        guid: guid,\n        attachments: filesObj.attachments,\n        text: $textarea.val(),\n        parent: idParent,\n        date: self.getDateServer(),\n        user: bizagi.currentUser.idUser },\n\n      attachmentsToCreate: filesObj.attachmentsToCreate,\n      attachmentsToDelete: filesObj.attachmentsToDelete };\n\n\n    $.when(self.dataService.postComment(params)).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n        var $commentContainer = $rplWrp.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\n        var newComment = {\n          user: params.content.user,\n          attachments: params.content.attachments,\n          text: params.content.text,\n          guid: params.content.guid,\n          parent: params.content.parent,\n          date: params.content.date };\n\n\n        //reset for a new comment\n        self.attchComments[params.content.parent] = {\n          addition: [],\n          remove: [] };\n\n\n        $textarea.val(\"\");\n        $uploadList.empty();\n        $buttonsWrp.hide();\n\n        //Add new comment to the list\n        self.commentsList[newComment.parent].comments.unshift(newComment);\n        self.renderCommentByDiscussion($commentContainer, newComment.parent, []);\n\n        self.plugins.attchComments.close();\n        self.renderUserProfilesAndImages();\n        self.updateDiscussionsMenu(true);\n      }\n    });\n  },\n\n  renderAttachments: function renderAttachments(files, type, $container) {\n    var self = this;\n    var attachTemplate = self.getTemplate(\"project-discussions-attachments\");\n\n    var $fileList = attachTemplate.render({ attachments: files, type: type });\n    $container.append($fileList);\n    if (bizagi.util.isIE()) {//\"shake\" files container for IE error\n      $(\".ui-bizagi-wp-project-attachments-list li\").hide(10, function () {\n        $(this).show();\n      });\n    }\n  },\n\n  prepareFilesToSave: function prepareFilesToSave(type, guid) {\n\n    var self = this;\n    var files = [],\n    fileList = type === \"COMMENTS\" ? self.attchComments[guid] : self.attchDiscussions,\n    attachmentsToCreate = [];\n\n    fileList = fileList || { addition: [], remove: [] };\n\n    for (var i = 0, length = fileList.addition.length - 1; i <= length; i++) {\n      files.push({\n        guid: fileList.addition[i].guid,\n        name: fileList.addition[i].name });\n\n\n      attachmentsToCreate.push(fileList.addition[i].guid);\n    }\n\n    return {\n      attachments: files,\n      attachmentsToCreate: attachmentsToCreate,\n      attachmentsToDelete: fileList.remove };\n\n  },\n\n  onClickCancel: function onClickCancel(event) {\n    event.preventDefault();\n    var self = this;\n\n    self.resetDiscussionAttachments();\n    self.onClosePopupDiscussion();\n\n    self.plugins.attchDiscussions.cancelFilesUpload();\n  },\n\n  onClosePopupDiscussion: function onClosePopupDiscussion() {\n    var self = this;\n    self.resetFormDiscussion();\n    self.plugins.attchDiscussions.destroy();\n    self.dialogBoxDiscussion.formContent.dialog(\"destroy\");\n    self.dialogBoxDiscussion.formContent.detach();\n  },\n\n  onOpenPopupDiscussion: function onOpenPopupDiscussion() {\n    var self = this;\n\n    self.plugins.attchDiscussions = self.applyFileAttachments(\"DISCUSSIONS\");\n\n    //popup\n    self.dialogBoxDiscussion.formContent.parent().css(\"z-index\", 10001);\n    //overlay\n    self.dialogBoxDiscussion.formContent.parent().parent().find(\".ui-widget-overlay\").css(\"z-index\", 10001);\n\n    setTimeout(function () {\n      self.form.subject.focus();\n    }, 50);\n  },\n\n  onSubmitFormDiscussion: function onSubmitFormDiscussion(event) {\n    event.preventDefault();\n\n    var self = this;\n    var guid;\n    if (self.validateAddDiscussionForm(self.dialogBoxDiscussion.formContent)) {\n      if (self.form.edition.guid) {\n        guid = self.form.edition.guid;\n        $.proxy(self.sendDataUpdateDiscussion(guid), self);\n      } else {\n        guid = Math.guid();\n        $.proxy(self.sendDataInsertDiscussion(guid), self);\n      }\n    }\n  },\n\n  restrictedEventsHandler: function restrictedEventsHandler() {\n    var self = this;\n    var $contentWidget = self.getContent();\n\n    $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\", \".bz-bizagi-wp-project-discussions-attachment-itemwrapper\", $.proxy(self.switchCommentsEvents, self));\n  },\n\n  eventsHandler: function eventsHandler() {\n    var self = this;\n    var $contentWidget = self.getContent();\n\n    //Add events\n    self.form.buttonShowFormNewDiscussion.on(\"click\", $.proxy(self.onNotifyOpenPopup, self));\n    self.form.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\n    self.form.buttonAddDiscussion.on(\"click\", $.proxy(self.onSubmitFormDiscussion, self));\n    self.form.attachments.on(\"click\", \".bz-bizagi-wp-project-discussions-attachment-delete, .bz-bizagi-wp-project-discussions-attachment-itemwrapper\", function (event) {\n\n      if ($(event.target).hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\n        self.onRemoveFiles($(event.target));\n      } else {\n        self.onDownloadAttachment($(event.target).closest(\"li\"));\n      }\n\n      event.stopPropagation();\n    });\n\n    $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\", \".ui-bizagi-wp-project-discussions-add-comment textarea\" +\n    \", .ui-bizagi-wp-project-discussions-comment-buttons-cancel\" +\n    \", .ui-bizagi-wp-project-discussions-comment-buttons-share\" +\n    \", .ui-bizagi-wp-project-discussion-showmore-comments button\" +\n    \", .bz-bizagi-wp-project-discussions-attachment-delete\" +\n    \", .ui-bizagi-wp-project-discussion-delete\" +\n    \", .bz-bizagi-wp-project-discussions-attachment-itemwrapper\" +\n    \", .ui-bizagi-wp-project-discussions-comment-view\" +\n    \", .ui-bizagi-wp-project-discussions-items-edition\" +\n    \", .biz-wp-action-edit-discussion\", $.proxy(self.switchCommentsEvents, self));\n\n    self.sub(\"changeProjectWidget\", function () {\n      self.resetWidget();\n    });\n    self.sub(\"OPEN_POPUP_DISCUSSION\", $.proxy(self.onNotifyOpenPopup, self));\n  },\n\n  resetWidget: function resetWidget() {\n    var self = this;\n    self.userPictures = [];\n    if (self.plugins.attchComments) {\n      self.plugins.attchComments.close();\n    }\n  },\n\n  clean: function clean() {\n\n    var self = this;\n    self.resetWidget();\n\n    if (self.form && self.form.buttonShowFormNewDiscussion) {\n      self.form.buttonShowFormNewDiscussion.off(\"click\", $.proxy(self.onNotifyOpenPopup, self));\n    }\n\n\n    for (var i in self.plugins) {\n      if (self.plugins[i] && self.plugins[i].hasOwnProperty(\"destroy\")) {\n        if (self.plugins[i].destroy) {\n          self.plugins[i].destroy();\n        }\n      }\n    }\n  },\n\n  mapTempComments: function mapTempComments($source, $target) {\n    var $textareaSource = $source.find(\"textarea\");\n    var $textareaTarget = $target.find(\"textarea\");\n    var $uploadListSource = $source.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\n    var $uploadListTarget = $target.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\n    $textareaTarget.val($textareaSource.val());\n    $uploadListTarget.empty().append($uploadListSource.html());\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.discussions\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.discussions], true);","/*\r\n *   Name: Bizagi Workportal project Discussion Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.discussion.sidebar\", {}, {\n\n  /*\r\n                                                                                                       *   Constructor\r\n                                                                                                       */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    params = params || {};\n    params.supportNav = false;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-discussion-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussion.sidebar\").concat(\"#project-discussion-sidebar\") });\n\n  },\n\n  /**\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-discussion-sidebar\");\n    self.content = template.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) });\n\n    return self.content;\n  },\n\n  /**\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    var $contentWidget = self.getContent();\n    $(\".ui-bizagi-wp-project-discussions-sidebar-action-add > a\", $contentWidget).on(\"click\",\n    $.proxy(self.onShowPopupDiscussion, self));\n  },\n\n  /**\r\n      * Events elements\r\n      */\n  onShowPopupDiscussion: function onShowPopupDiscussion() {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"OPEN_POPUP_DISCUSSION\",\n      args: {} });\n\n  } });\n\n\nbizagi.injector.register('bizagi.workportal.widgets.project.discussion.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.discussion.sidebar], true);"]}