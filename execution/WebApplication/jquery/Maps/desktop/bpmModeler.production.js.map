{"version":3,"sources":["jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.observable.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.model.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.aura.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.path.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.connector.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.drawing.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.toolbar.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.viewer.js"],"names":["$","Class","extend","subscribe","this","observableElement","bind","apply","arguments","unsubscribe","unbind","publish","triggerHandler","_observableElement","bizagi","bpmn","modeler","observable","init","tasks","canvas","setModel","model","triggerModelRedraw","getViewModel","task_list","val","durationInMinutes","type","formatDuration","push","isGateway","isEvent","isEmailTask","getPersistenceModel","that","result","jQuery","each","i","task","parseDuration","showAura","getTaskById","id","getConnectionRule","sourceTaskId","targetTaskId","source","rule","grep","rules","target","length","expression","successorConnectionsCanContainRule","setCanvasBounds","bounds","triggerModelChange","redraw","setExtendedProperty","property","value","extendedProperties","getExtendedProperty","addTask","taskType","position","predecessor","newGuid","displayName","getDefaultName","getDuration","predecessors","successors","connectors","successor","displayNamePosition","x","y","setAura","addConnection","isPresent","key","changeTaskName","newDisplayName","changeConnectorName","connectorName","changeConnectorPos","idSourceTask","idTargetTask","labelPosition","Math","round","changeDuration","duration","changeTaskType","newType","triggerChangeShape","moveTask","setConnectionRule","removeConnectorsInPredecessors","predecesor","splice","deleteTask","removeAll","deleteArrow","indexOf","replace","c","r","random","toString","displaySecuence","numbersOfNameTask","uniqueSecuence","numberPattern","manualTasks","viewer","featureLocalization","getKeyLocalization","secuence","match","parseInt","sort","a","b","inArray","String","trim","test","last_hour","last_minuts","resultMinuts","hour","substring","floor","split","pop","minuts","m","h","params","activeConfirmationPopup","item","isEditableName","element","externalOptions","form","assignee","notify","getClassForExternalOption","getTitleForType","toolBarTitles","views","converters","aura","toolbar","getOldLocalization","templates","bpm_modeler_aura","bpm_modeler_auraOption","bpm_modeler_auraChangeTo","bpm_modeler_auraExternalOption","previousElementId","isActiveConfirmDialog","isEndEvent","data","showForTask","taskId","attr","options","getOptions","changeTo","getChangeTo","getExternalOptions","showArrow","positioning","shown","show","specialOptions","find","typeItem","css","of","my","at","collision","option","on","showChangeToOptions","activePopupConfirmationDelete","actionConfirmDelete","manageExternalOption","draggable","helper","containment","grid","drag","ev","ui","dragArrow","showForArrow","arrow","showRuleOption","arrowId","addClass","addHandlersForExpressions","elementId","isSame","hide","render","after","moveTo","detach","changeToOptions","toggleClass","top","click","proxy","connector","getSourceTaskFromId","getTargetTaskFromId","deleteOptions","left","btn","className","offset","changeOption","currentTarget","externalOption","possibleChanges","removeOne","curve","arrowHeight","calculateAnchors","el1","el2","threshold_x","min","width","threshold_y","height","e1xh","e2xh","e1yh","e2yh","areElementsVeryCloseInXAxis","abs","getPath","box","anchors","coords","w","areVerticalAnchors","getPathTopToBottom","getPathBottomToTop","areHorizontalAnchors","getPathLeftToRight","getPathRightToLeft","getPathLeftToRightBottom","getPathLeftToRightTop","getPathRightToLeftBottom","getPathRightToLeftTop","getPathTopToBottomLeft","getPathBottomToTopLeft","getPathTopToBottomRight","getPathBottomToTopRight","getPathBottomToLeft","getPathBottomToRight","getPathTopToLeft","getPathTopToRight","getTransform","threshold","x1","x2","y1","y2","getArrowRight","getArrowLeft","getArrowDown","getArrowUp","xh","yh","ah","buildConnectorId","i1","i2","bpm_modeler_connector","path","stroke","connect","task1","task2","labelConnectorPos","getBounds","drawLine","modifyPositions","getTop","getLeft","getWidth","getHeight","transform","html","append","svg","labelConnectorName","refresh","line","drawTemporalConnector","sourceTask","removeTemporalConnector","outerWidth","outerHeight","adjustToAnchor","el","anchor","bpm_modeler_drawing","bpm_modeler_drawingItem","drawingWidth","drawingHeight","previusElement","isEditionActive","reviewMode","onElementDragging","onArrowDragging","editExpressionForArrow","triggerElseExpressionForArrow","clickOnTask","aux","setCanvas","readonly","initializeGeneralHandlers","viewModel","drawing","canvasWidth","canvasHeight","scrollTop","scrollLeft","setTimeout","addConnectors","readonlyLoaded","addHandlers","addGeneralHandlers","configureNamesOfItems","setGeneralEvents","activeReviewMode","document","off","e","keyUpEvent","selectedItem","returnSelectedItem","which","nodeName","editConnectorName","firstElementChild","editTaskName","parent","index","obj","text","setNameTask","itemSelected","empty","onTaskDragging","configureDroppable","editDuration","showAuraForArrow","clickCavnas","setConnectorPosition","label","idSourceConnector","idTargetConnector","removeClass","context","mergeElement","mergeTarget","droppable","hoverClass","drop","event","addArrow","hasClass","accept","pos","fixPosition","autoAdjustCanvasOn","input","showPopupEditor","_setTaskTextAndTitle","title","succesorId","sourceId","taskName","stopPropagation","preventDefault","tasksAtPosition","getTasksAtPosition","setExpressionForArrow","moveCanvas","tag","prop","toLowerCase","redrawConnector","draggingOverTasks","predecessorId","successorId","j","addConnector","auraShown","innerHTML","slice","filter","callback","cancelAction","focus","select","closeEditor","remove","keypress","one","relative","bpmShapes","StartEvent","IntermediateEvent","EndEvent","TerminateEvent","ExclusiveGateway","ParallelGateway","InclusiveGateway","ComplexGateway","UserTask","EmailTask","toolBarTitlesOld","changeType","deleteShape","flowSecuence","deleteConfirmationMessage","confirmDeleteShape","cancelDeleteShape","addExpression","elseExpression","getClassForType","bpm_modeler_toolbar","bpm_modeler_toolbarItem","items","onItemDragging","getInstaceLocalizationService","window","localization","getResource","bpm_modeler_viewer_container","changed","selectedTask","canvasEvent","triggerLoadFinish","onToolbarItemDragging","readOnly","diagram","self","container","when","checkCSSLoaded","then","renderToolbar","renderDrawing","load","display","defer","Deferred","cssAppliedOnDrawing","resolve","counterCheckCSS","validateCSSLoaded","setInterval","clearInterval","promise","activeModeReview","localizationModeler","activelocalizationModeler","toolbarCanvas","state","drawingCanvas","setConnectionExpression","save","json","Array","prototype"],"mappings":"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","sourcesContent":["// Pub/Sub class declaration\n$.Class.extend(\"bizagi.bpmn.modeler.observable\", {}, {\n  subscribe: function subscribe() {\n    this.observableElement().bind.apply(this.observableElement(), arguments);\n  },\n  unsubscribe: function unsubscribe() {\n    this.observableElement().unbind.apply(this.observableElement(), arguments);\n  },\n  publish: function publish() {\n    return this.observableElement().triggerHandler.apply(this.observableElement(), arguments);\n  },\n  observableElement: function observableElement() {\n    return !this._observableElement ? this._observableElement = $({}) : this._observableElement;\n  } });","bizagi.bpmn.modeler.observable.extend(\"bizagi.bpmn.modeler.model\", {}, {\n\n  /* Constructor */\n  init: function init() {\n    this.tasks = {};\n    this.canvas = {};\n    var that = this;\n  },\n\n  setModel: function setModel(model) {\n    this.tasks = model.tasks;\n    this.canvas = model.canvas;\n    this.triggerModelRedraw();\n  },\n\n  /************************************************************************\r\n      GETTERS SECTION\r\n      ************************************************************************/\n\n  getViewModel: function getViewModel() {\n    var task_list = [];\n    for (val in this.tasks) {\n      if (this.tasks[val].durationInMinutes != null && this.tasks[val].type === \"UserTask\") {\n        var formatDuration = this.formatDuration(this.tasks[val].durationInMinutes);\n        this.tasks[val].durationInMinutes = formatDuration;\n      }\n      task_list.push(this.tasks[val]);\n    }\n    return {\n      tasks: task_list,\n      canvas: this.canvas,\n      isGateway: this.isGateway,\n      isEvent: this.isEvent,\n      isEmailTask: this.isEmailTask };\n\n  },\n  getPersistenceModel: function getPersistenceModel() {\n    var that = this;\n    var result = { tasks: jQuery.extend({}, this.tasks), canvas: jQuery.extend({}, this.canvas) };\n    $.each(result.tasks, function (i, task) {\n      if (task.durationInMinutes) {\n        task.durationInMinutes = that.parseDuration(task.durationInMinutes);\n      }\n      // Remove showAura\n      delete task.showAura;\n    });\n    return result;\n  },\n  getTaskById: function getTaskById(id) {\n    return this.tasks[id];\n  },\n\n  getConnectionRule: function getConnectionRule(sourceTaskId, targetTaskId) {\n    var source = this.tasks[sourceTaskId];\n    if (!this.isGateway(source.type)) return null;\n\n    // Connection rules only work for gateways\n    var rule = $.grep(source.rules, function (rule) {\n      return rule.target == targetTaskId;\n    });\n    //return rule.length > 0? rule[0].expression: \"missing\";\n    return rule.length > 0 ? rule[0].expression : null;\n  },\n\n  successorConnectionsCanContainRule: function successorConnectionsCanContainRule(task) {\n    var task = this.tasks[task];\n    if (task.type === 'ParallelGateway') {\n      return false;\n    } else {\n      return this.isGateway(task.type);\n    }\n  },\n\n  /************************************************************************\r\n      CANVAS MANAGEMENT SECTION\r\n      ************************************************************************/\n  setCanvasBounds: function setCanvasBounds(bounds) {\n    this.canvas = bounds;\n    this.triggerModelChange({ redraw: false });\n  },\n\n  /************************************************************************\r\n      EXTENDED PROPERTIES SECTION\r\n      ************************************************************************/\n\n  setExtendedProperty: function setExtendedProperty(id, property, value) {\n    if (this.tasks[id]) {\n      // make sure we have extendedProperties\n      this.tasks[id].extendedProperties = this.tasks[id].extendedProperties || {};\n      this.tasks[id].extendedProperties[property] = value;\n\n      // Publish event but don't redraw'\n      this.triggerModelChange({ redraw: false });\n    }\n  },\n\n  getExtendedProperty: function getExtendedProperty(id, property) {\n    if (this.tasks[id]) {\n      return this.tasks[id].extendedProperties[property];\n    }\n    return null;\n  },\n\n  /************************************************************************\r\n      ADD SECTION\r\n      ************************************************************************/\n\n  addTask: function addTask(taskType, position, predecessor) {\n    var task = {\n      id: this.newGuid(),\n      type: taskType,\n      displayName: this.getDefaultName(taskType),\n      durationInMinutes: this.getDuration(taskType),\n      position: position,\n      showAura: false,\n      predecessors: [],\n      successors: [],\n      connectors: [],\n      rules: [],\n      extendedProperties: {} };\n\n    // Add predecessor\n    if (predecessor) task.predecessors.push(predecessor);\n\n    // Add the new task\n    this.tasks[task.id] = task;\n\n    // Add succesor to predecessor\n    if (this.tasks[predecessor]) {\n      this.tasks[predecessor].successors.push(task.id);\n      this.tasks[predecessor].connectors.push({\n        \"successor\": task.id,\n        \"displayName\": \"\",\n        \"displayNamePosition\": {\n          \"x\": 20,\n          \"y\": 20 } });\n\n\n    }\n    // Set the new task, to use the aura\n    this.setAura(task.id, true);\n\n    // Publish event\n    this.triggerModelChange();\n  },\n\n  addConnection: function addConnection(sourceTaskId, targetTaskId) {\n    var source = this.tasks[sourceTaskId];\n    var target = this.tasks[targetTaskId];\n    var isPresent = false;\n    for (var key in source.successors) {\n      if (source.successors[key] === targetTaskId) isPresent = true;\n    }\n    if (!isPresent) {\n      source.successors.push(targetTaskId);\n      source.connectors.push({\n        \"successor\": targetTaskId,\n        \"displayName\": \"\",\n        \"displayNamePosition\": {\n          \"x\": 20,\n          \"y\": 20 } });\n\n\n      target.predecessors.push(sourceTaskId);\n    }\n    // Publish event\n    this.triggerModelChange();\n  },\n\n  /************************************************************************\r\n      EDIT SECTION\r\n      ************************************************************************/\n\n  changeTaskName: function changeTaskName(id, newDisplayName) {\n    if (this.tasks[id]) {\n      if (this.tasks[id].displayName == newDisplayName) return;\n      this.tasks[id].displayName = newDisplayName;\n      // Publish event but don't redraw'\n      this.triggerModelChange({ redraw: false });\n    }\n  },\n  changeConnectorName: function changeConnectorName(source, successor, connectorName) {\n    if (this.tasks[source]) {\n      for (var i = 0; i < this.tasks[source].connectors.length; i++) {\n        if (this.tasks[source].connectors[i].successor == successor) {\n          this.tasks[source].connectors[i].displayName = connectorName;\n        }\n      }\n      this.triggerModelChange({ redraw: false });\n    }\n  },\n  changeConnectorPos: function changeConnectorPos(idSourceTask, idTargetTask, labelPosition) {\n    if (this.tasks[idSourceTask]) {\n      for (var i = 0; i < this.tasks[idSourceTask].connectors.length; i++) {\n        if (this.tasks[idSourceTask].connectors[i].successor == idTargetTask) {\n          this.tasks[idSourceTask].connectors[i].displayNamePosition.x = Math.round(labelPosition.x);\n          this.tasks[idSourceTask].connectors[i].displayNamePosition.y = Math.round(labelPosition.y);\n        }\n      }\n      this.triggerModelChange({ redraw: false });\n    }\n  },\n  changeDuration: function changeDuration(id, duration) {\n    if (this.tasks[id]) {\n      if (this.tasks[id].durationInMinutes == duration) return;\n      this.tasks[id].durationInMinutes = duration;\n      // Publish event but don't redraw'\n      this.triggerModelChange({ redraw: false });\n    }\n  },\n\n  changeTaskType: function changeTaskType(id, newType) {\n    if (this.tasks[id]) {\n      if (this.tasks[id].type == newType) return;\n      this.tasks[id].type = newType;\n      // if (newType === \"EmailTask\") this.tasks[id].duration = this.getDuration(this.tasks[id].type);\n      //if (newType === \"UserTask\") this.tasks[id].duration = this.tasks[id].duration;\n      // Publish event\n      this.triggerModelChange();\n      this.triggerChangeShape();\n    }\n  },\n\n  moveTask: function moveTask(id, position) {\n    if (this.tasks[id]) {\n      this.tasks[id].position = position;\n\n      // Publish event\n      this.triggerModelChange();\n    }\n  },\n\n  setAura: function setAura(id, showAura) {\n    $.each(this.tasks, function (key, task) {\n      task.showAura = false;\n    });\n    if (this.tasks[id]) {\n      this.tasks[id].showAura = showAura;\n    }\n  },\n\n  setConnectionRule: function setConnectionRule(sourceTaskId, targetTaskId, expression) {\n    var source = this.tasks[sourceTaskId];\n\n    // Get / create rule\n    var rules = $.grep(source.rules, function (rule) {\n      return rule.target == targetTaskId;\n    });\n    var rule = rules.length > 0 ? rules[0] : { target: targetTaskId };\n    if (rules.length == 0) source.rules.push(rule);\n\n    // Change rule (possible values: boolean/else)\n    rule.expression = expression;\n\n    // Publish event\n    this.triggerModelChange();\n  },\n\n  /************************************************************************\r\n      DELETE SECTION\r\n      ************************************************************************/\n  removeConnectorsInPredecessors: function removeConnectorsInPredecessors(task, predecesor) {\n    for (var i = 0; i < this.tasks[predecesor].connectors.length; i++) {\n      if (this.tasks[predecesor].connectors[i].successor == task) {\n        this.tasks[predecesor].connectors.splice(i, 1);\n      }\n    }\n  },\n  deleteTask: function deleteTask(id) {\n    var that = this;\n    $.each(this.tasks, function (key, task) {\n      // Remove from predecessors\n      if (task.predecessors && task.predecessors.length > 0) {\n        task.predecessors.removeAll(id);\n        for (var i = 0; i < task.predecessors.length; i++) {\n          that.removeConnectorsInPredecessors(id, task.predecessors[i]);\n        }\n      }\n      // Remove from successors\n      if (task.successors && task.successors.length > 0) task.successors.removeAll(id);\n\n\n    });\n\n    // Remove task\n    delete this.tasks[id];\n\n    // Publish event\n    this.triggerModelChange();\n  },\n\n  deleteArrow: function deleteArrow(sourceTaskId, targetTaskId) {\n    var that = this;\n    var source = this.tasks[sourceTaskId];\n    var target = this.tasks[targetTaskId];\n\n    if (source) source.successors.removeAll(targetTaskId);\n    if (target) target.predecessors.removeAll(sourceTaskId);\n\n    //Remove connectors\n    that.removeConnectorsInPredecessors(targetTaskId, sourceTaskId);\n\n    if (source.rules.length > 0) {\n      for (var i = 0; i < source.rules.length; i++) {\n        var rule = source.rules[i].target;\n        if (source.successors.indexOf(rule) == -1) {\n          source.rules.splice(i, 1);\n        }\n      }\n    }\n    // Publish event\n    this.triggerModelChange();\n  },\n\n  /************************************************************************\r\n      MISC METHODS SECTION\r\n      ************************************************************************/\n\n  newGuid: function newGuid() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n      var r = Math.random() * 16 | 0,\n      v = c == 'x' ? r : r & 0x3 | 0x8;\n      return v.toString(16);\n    });\n  },\n\n  getDefaultName: function getDefaultName(taskType) {\n    var displaySecuence = 0;\n    var numbersOfNameTask = [];\n    var uniqueSecuence = [];\n    var numberPattern = /\\d+/g;\n    var manualTasks = [];\n    var key = 'Task';\n    if (bizagi.bpmn.modeler.viewer.featureLocalization) {\n      key = bizagi.bpmn.modeler.viewer.getKeyLocalization(\"workportal-process-modeler-task\");\n    }\n    if (taskType == \"UserTask\" || taskType == \"EmailTask\") {\n\n      /* var manualTasks = $.grep(Object.values(this.tasks), function( task ) {\r\n                                                                 return task.type == \"UserTask\";\r\n                                                             });*/\n      for (var task in this.tasks) {\n        if (this.tasks[task].type === \"UserTask\" || this.tasks[task].type === \"EmailTask\") {\n          manualTasks.push(this.tasks[task]);\n        }\n      }\n      if (manualTasks.length > 0) {\n        for (var i = 0; i < manualTasks.length; i++) {\n          if (manualTasks[i].displayName.indexOf(key) == 0) {\n            var secuence = manualTasks[i].displayName.match(numberPattern);\n            numbersOfNameTask.push(parseInt(secuence));\n          }\n        }\n\n        numbersOfNameTask = numbersOfNameTask.sort(function (a, b) {\n          return a - b;\n        });\n\n        /*\r\n            $.each(numbersOfNameTask, function(i, el){\r\n                if($.inArray(el, uniqueSecuence) === -1 && el !=0 ) uniqueSecuence.push(el);\r\n            });*/\n        for (var i = 0; i < numbersOfNameTask.length; i++) {\n          if ($.inArray(numbersOfNameTask[i], uniqueSecuence) === -1 && numbersOfNameTask[i] != 0) uniqueSecuence.push(numbersOfNameTask[i]);\n        }\n      }\n\n      for (var i = 1; i <= uniqueSecuence.length; i++) {\n        displaySecuence = i;\n        if (uniqueSecuence[i - 1] > i) {\n          displaySecuence = displaySecuence - 1;\n          break;\n        }\n      }\n      return key + \" \" + (displaySecuence + 1);\n    }\n    return null;\n  },\n\n  //DR\n  getDuration: function getDuration(taskType) {\n    if (taskType == \"UserTask\") {\n      return \"1h\";\n    }\n    return null;\n  },\n  //DR\n  parseDuration: function parseDuration(value) {\n    if (String(value).indexOf(\"h\") == -1 && String(value).indexOf(\"m\") == -1) {\n      value += \"m\";\n      value = value.trim();\n    }\n    var regex = /(?:^\\d+h[ ]+\\d+m$)|(?:^\\d+[hm]?$)/;\n    if (typeof value != \"string\") {\n      return value;\n    } else {\n      value = value.trim();\n    }\n    if (regex.test(String(value))) {\n      var last_hour = \"\";\n      var last_minuts = \"\";\n      var resultMinuts = 0;\n      var hour = value.indexOf(\"h\");\n      if (hour != -1) {\n        last_hour = value.substring(0, hour);\n        last_hour = Math.floor(last_hour * 60);\n        value = value.split(\"h\").pop();\n        resultMinuts = last_hour;\n      }\n      var minuts = value.indexOf(\"m\");\n      if (minuts != -1) {\n        last_minuts = value.substring(0, minuts);\n        resultMinuts += parseInt(last_minuts);\n      }\n      return resultMinuts;\n    } else {\n      return null;\n    }\n  },\n  formatDuration: function formatDuration(value) {\n    if (value != 0) {\n      var m = value % 60;\n      var h = (value - m) / 60;\n      var hoursMinutes = h.toString() + \"h \" + m.toString() + \"m\";\n      var result = hoursMinutes.replace(\" 0m\", \"\");\n      if (h == 0) {\n        result = result.replace(\"0h\", \"\");\n      }\n      return result;\n    } else {\n      return \"0m\";\n    }\n  },\n  triggerModelRedraw: function triggerModelRedraw() {\n    this.publish(\"model.redraw\");\n  },\n\n  triggerModelChange: function triggerModelChange(params) {\n    params = params || { redraw: true };\n    this.publish(\"model.change\");\n    if (params.redraw) this.triggerModelRedraw();\n  },\n  triggerChangeShape: function triggerChangeShape(params) {\n    this.publish(\"shape.change\", params);\n  },\n  activeConfirmationPopup: function activeConfirmationPopup(item) {\n    return item === \"UserTask\" || item === \"EmailTask\" || item === \"IntermediateEvent\" || this.isGateway(item);\n  },\n  //return if the element is editable name\n  isEditableName: function isEditableName(element) {\n    return !(element.type === 'StartEvent' ||\n    element.type === 'EndEvent' ||\n    element.type === 'TerminateEvent');\n\n  },\n  isEmailTask: function isEmailTask(type) {\n    return type = \"EmailTask\";\n  },\n  isEvent: function isEvent(type) {\n    return type == \"ExclusiveGateway\" || type == \"IntermediateEvent\";\n  },\n  isGateway: function isGateway(type) {\n    return type == \"ExclusiveGateway\" || type == \"ParallelGateway\" || type == \"InclusiveGateway\" || type == \"ComplexGateway\";\n  } });","bizagi.bpmn.modeler.observable.extend(\"bizagi.bpmn.modeler.aura\", {\n  /* STATIC STUFF */\n  externalOptions: {\n    \"form\": \"bz-icon bz-icon-template-outline\",\n    \"assignee\": \"bz-icon bz-icon-cog-outline\",\n    \"notify\": \"bz-icon bz-icon-cog-outline\" },\n\n  getClassForExternalOption: function getClassForExternalOption(type) {\n    return this.externalOptions[type];\n  },\n  getTitleForType: function getTitleForType(type) {\n    return this.toolBarTitles[type];\n  } },\n{\n\n  /* INSTANCE STUFF */\n  /* Constructor */\n  init: function init(model) {\n    // Define converter for task type class        \n    $.views.converters(\"externaloption_class\", function (val) {\n      return bizagi.bpmn.modeler.aura.getClassForExternalOption(val);\n    });\n\n    $.views.converters(\"getResourceLocalization\", function (val) {\n      var key = '';\n      var result = '';\n      if (bizagi.bpmn.modeler.viewer.featureLocalization) {\n        key = bizagi.bpmn.modeler.toolbar.getTitleForType(val);\n        result = bizagi.bpmn.modeler.viewer.getKeyLocalization(key);\n      } else {\n        result = bizagi.bpmn.modeler.toolbar.getOldLocalization(val);\n      }\n      return result;\n    });\n    $.templates({\n      bpm_modeler_aura: '\\\r\n                <aura class=\"bpm-aura-for-{{:type}}\"> \\\r\n                 \\ <div class=\"wrapper-options\">\\\r\n                        {{if changeTo && changeTo.length > 0}} \\\r\n                            <special-option class=\"tooltip bpm-option-change bz-icon bz-icon-asynchronous-outline\"><span class=\"tooltiptext tooltip-right\"><p>{{title: \"changeType\"}}</p></span></special-option> \\\r\n                                <aura-change> \\\r\n                                    {{for changeTo tmpl=\"bpm_modeler_auraChangeTo\"/}} \\\r\n                                </aura-change> \\\r\n                        {{/if}} \\\r\n                    {{if externalOptions && externalOptions.length > 0}} \\\r\n                        <external-options> \\\r\n                            {{for externalOptions tmpl=\"bpm_modeler_auraExternalOption\"/}} \\\r\n                        </external-options> \\\r\n                    {{/if}} \\\r\n                     \\<special-options {{if showRuleOption}} class=\"bpm-show-rule-option\" {{/if}}> \\\r\n                        {{if showRuleOption}} \\\r\n                            <special-option class=\"tooltip bpm-option-expression bpmn-icon-conditional-flow\"><span class=\"tooltiptext tooltip-right\"><p>{{title: \"addExpression\"}}</p></span></special-option> \\\r\n                            <special-option class=\"tooltip bpm-option-else bpmn-icon-default-flow\"><span class=\"tooltiptext tooltip-right\"><p>{{title:\"elseExpression\"}}</p></span></special-option> \\\r\n                        {{/if}} \\\r\n                        <special-option class=\"tooltip bpm-option-delete bpmn-icon-trash bpmn-icon-trash-{{:type}}\"><span class=\"tooltiptext tooltip-right\"><p>{{title: \"deleteShape\"}}</p></span></special-option> \\\r\n                        </special-options> \\\r\n                         \\ <aura-confirmation-delete class=\"popup__confirmationDelete\"> \\\r\n                                                    <div>\\\r\n                                                        <p>{{getResourceLocalization: \"deleteConfirmationMessage\"}}</p>\\\r\n                                                        <div class=\"contentButtons\">\\\r\n                                                            <div class=\"btn btn__confirmation btn__confirmation--yes\">{{getResourceLocalization: \"confirmDeleteShape\"}}</div>\\\r\n                                                            <div class=\"btn btn__confirmation btn__confirmation--no\">{{getResourceLocalization: \"cancelDeleteShape\"}}</div>\\\r\n                                                        </div>\\\r\n                                                        <span class=\"downArrow\"></span>\\\r\n                                                    </div>\\\r\n                                                </aura-cofirmation-delete>\\\r\n                        </div>\\\r\n                        \\<div class=\"wrapper-aura-options\">\\\r\n                            {{for options tmpl=\"bpm_modeler_auraOption\"/}} \\\r\n                             \\{{if showArrow}} \\\r\n                            <aura-option class=\"tooltip bpm-option-arrow bpmn-icon-connection\" data-predecessor=\"{{:~root.id}}\"><span class=\"tooltiptext tooltip-right\"><p>{{title: \"flowSecuence\"}}</p></span></aura-option> \\\r\n                        {{/if}} \\\r\n                        \\</div>\\\r\n                  </aura>',\n      bpm_modeler_auraOption: '<aura-option class=\"{{if ~#data==\"IntermediateEvent\"}}bpm-aura-intermediate-icon{{/if}} tooltip bpm-{{:#data}} {{tasktype_class: #data}} bpm-cloneable\" \\\r\n                                            data-type=\"{{:#data}}\" \\\r\n                                            data-predecessor=\"{{:~root.id}}\">\\\r\n                                            <span class=\"tooltiptext tooltip-right\"><p>{{title: #data}}</p></span>\\\r\n                                        </aura-option>',\n      bpm_modeler_auraChangeTo: '<aura-change-to class=\"tooltip bpm-{{:#data}} {{tasktype_class: #data}}\"  \\\r\n                                                data-type=\"{{:#data}}\" \\\r\n                                                data-task=\"{{:~root.id}}\">\\\r\n                                                <span class=\"tooltiptext tooltip-right\"><p>{{title: #data}}</p></span>\\\r\n                                        </aura-change-to>',\n      bpm_modeler_auraExternalOption: '{{if (~root.type ===\"EmailTask\" && #data ===\"notify\") || ((~root.type === \"UserTask\" || ~root.type==\"IntermediateEvent\") && (#data === \"form\" || #data ===\"assignee\") )}} \\\r\n                                            <external-option class=\"tooltip bpm-{{:#data}} {{externaloption_class: #data}}\" \\\r\n                                                        data-option=\"{{:#data}}\" \\\r\n                                                        data-task=\"{{:~root.id}}\">\\\r\n                                                        <span class=\"tooltiptext tooltip-right\"><p>{{title: #data}}</p></span>\\\r\n                                                </external-option>{{/if}}' });\n\n\n    // Set class variables\n    this.model = model;\n    this.previousElementId = null;\n    this.aura = null;\n    this.isActiveConfirmDialog = false;\n  },\n  /*FUNCTION FOR VALIDATE IF THE ELEMNT ADD ARROW OPTION*/\n  isEndEvent: function isEndEvent(task) {\n    if (task.data(\"type\") === 'EndEvent' || task.data(\"type\") === 'TerminateEvent') {\n      return false;\n    } else {\n      return true;\n    }\n  },\n  /************************************************************************\r\n      SHOW METHODS SECTION\r\n      ************************************************************************/\n  showForTask: function showForTask(task) {\n    var that = this;\n    var taskId = task.attr(\"id\");\n    var typeShape = this.model.getTaskById(taskId);\n    var params = {\n      type: typeShape.type,\n      options: this.getOptions(task),\n      changeTo: this.getChangeTo(task),\n      externalOptions: this.getExternalOptions(task),\n      showArrow: this.isEndEvent(task),\n      positioning: \"right\" };\n\n\n    // Show aura\n    var shown = this.show(task, params);\n\n    if (shown) {\n      // Put special options at bottom\n      var specialOptions = this.aura.find(\".wrapper-options\");\n      var typeItem = this.model.getTaskById(task.attr(\"id\"));\n      specialOptions.css('display', 'absolute');\n\n      switch (typeItem.type) {\n        case 'UserTask':\n          specialOptions.position({ of: task, my: \"center-47 top-35\", at: \"center top\", collision: \"none\" });\n          // Publish event\n          this.publish(\"task.click\", { task: taskId, option: \"assignee\", type: typeItem.type }); //To detect click in the task and inform angular code to keep the properties right side bar if is is open \n          break;\n        case 'EmailTask':\n          specialOptions.position({ of: task, my: \"center-47 top-35\", at: \"center top\", collision: \"none\" });\n          break;\n        case 'IntermediateEvent':\n          specialOptions.position({ of: task, my: \"center-43 top-42\", at: \"center top\", collision: \"none\" });\n          this.publish(\"task.click\", { task: taskId, option: \"assignee\", type: typeItem.type }); //To detect click in the task and inform angular code to keep the properties right side bar if is is open\n          break;\n        case 'StartEvent':\n          specialOptions.position({ of: task, my: \"center top-48\", at: \"center top\", collision: \"none\" });\n          break;\n        case 'EndEvent':\n        case 'TerminateEvent':\n        case 'ParallelGateway':\n        case 'ExclusiveGateway':\n          specialOptions.position({ of: task, my: \"center-18 top-48\", at: \"center top\", collision: \"none\" });\n          break;\n        default:\n          specialOptions.position({ of: task, my: \"center-8 top+25\", at: \"center bottom\", collision: \"none\" });\n          break;}\n\n\n\n\n      // Manage changeTo handler\n      this.aura.find(\"special-option.bpm-option-change\").on(\"click\", function () {that.showChangeToOptions(this, typeItem.type);});\n\n      // Manage delete handler\n      this.aura.find(\"special-option.bpm-option-delete\").on(\"click\", function () {that.activePopupConfirmationDelete(this, taskId);});\n\n      //new\n      this.aura.find(\"aura-confirmation-delete .contentButtons .btn\").on(\"click\", function () {that.actionConfirmDelete(this, taskId);});\n\n      // Manage external options handler\n      this.aura.find(\"external-option\").on(\"click\", function () {\n        that.manageExternalOption($(this), taskId);\n      });\n\n      // Make arrow dragabble\n      this.aura.find(\"aura-option.bpm-option-arrow\").draggable({\n        helper: \"clone\",\n        containment: \"#bpm-drawing\",\n        grid: [20, 20],\n        drag: function drag(ev, ui) {that.dragArrow(ui, taskId);} });\n\n    }\n\n    return shown;\n  },\n\n  showForArrow: function showForArrow(arrow, showRuleOption) {\n    var that = this;\n    var arrowId = arrow.attr(\"id\");\n    var params = {\n      type: \"arrow\",\n      positioning: \"center\",\n      showRuleOption: showRuleOption };\n\n\n    // Show aura\n    var shown = this.show(arrow, params);\n\n    if (shown) {\n      // Put special options at bottom\n      var specialOptions = this.aura.find(\".wrapper-options\");\n      specialOptions.position({ of: arrow, my: \"center center\", at: \"center+20 center-20\", collision: \"none\" });\n\n      this.aura.find(\"special-option.bpm-option-delete\").addClass(\"bpmn-icon-trash--arrow\");\n      // Manage delete handler\n      this.aura.find(\"special-option.bpm-option-delete\").on(\"click\", function () {that.deleteArrow(arrowId);});\n\n      // Manage rule handler\n      this.addHandlersForExpressions(arrowId);\n    }\n\n    return shown;\n  },\n\n  show: function show(element, params) {\n    var that = this;\n    var elementId = element.attr(\"id\");\n\n    // Check previous element to toggle on/off\n    if (this.previousElementId) {\n      var isSame = this.previousElementId == elementId;\n      this.hide(this.previousElementId);\n      if (isSame) return false;\n    }\n    this.previousElementId = elementId;\n\n    // Render template\n    var aura = $.templates.bpm_modeler_aura.render($.extend(params, { id: elementId }));\n    this.aura = $(aura);\n    element.after(this.aura);\n    this.moveTo(element, params.positioning);\n\n    // Put external options at top\n    if (params.externalOptions) {\n      var externalOptions = this.aura.find(\"external-options\");\n      //externalOptions.position({ of: element, my: \"center-42 bottom+16\", at: \"center top\", collision: \"none\" });\n    }\n\n    // Make items draggable\n    this.aura.find(\"aura-option\").draggable({\n      helper: \"clone\",\n      containment: \"#bpm-drawing\",\n      grid: [20, 20],\n      drag: function drag(ev, ui) {that.publish(\"item.drag\", ui);} });\n\n\n    return true;\n  },\n\n  /************************************************************************\r\n      OTHER PUBLIC METHODS SECTION\r\n      ************************************************************************/\n\n  hide: function hide(elementId) {\n    elementId = elementId || this.previousElementId;\n    if (elementId == null) return;\n    if (this.aura) this.aura.detach();\n    this.previousElementId = null;\n  },\n\n  moveTo: function moveTo(element, positioning) {\n    var id = element.attr(\"id\");\n    if (id != this.previousElementId) {\n      this.hide();\n      return;\n    }\n    // Only perform the move when the aura is displayed for the given task\n    positioning = positioning || \"right\";\n    if (positioning == \"right\")\n    this.aura.position({ of: element, my: \"left+20 center\", at: \"right center\", collision: \"none\" });\n  },\n\n\n  /************************************************************************\r\n      HANDLER METHODS SECTION\r\n      ************************************************************************/\n  showChangeToOptions: function showChangeToOptions(element, type) {\n    var changeToOptions = this.aura.find(\"aura-change\");\n    changeToOptions.toggleClass(\"visible\");\n    changeToOptions.position({ of: element, my: \"center top-60\", at: \"center top\", collision: \"none\" });\n    //Change position of aura-change when the element is on top limit.\n    var auraTopPosition = this.aura.position().top;\n    var limitTopPosition = type === \"UserTask\" ? 57 : 120;\n    if (auraTopPosition < limitTopPosition) {\n      changeToOptions.css({ 'top': 33 });\n    }\n    // Add click handlers\n    changeToOptions.find(\"aura-change-to\").click($.proxy(this.changeTo, this));\n  },\n\n  addHandlersForExpressions: function addHandlersForExpressions(arrowId) {\n    var that = this;\n\n    // Add click handlers\n    this.aura.find(\".bpm-option-else\").click(function () {\n      var source = bizagi.bpmn.modeler.connector.getSourceTaskFromId(arrowId);\n      var target = bizagi.bpmn.modeler.connector.getTargetTaskFromId(arrowId);\n\n      // Publish event\n      that.publish(\"arrow.setElse\", arrowId);\n\n      // Change model\n      that.model.setConnectionRule(source, target, \"else\");\n    });\n    this.aura.find(\".bpm-option-expression\").click(function () {\n      // Publish event\n      that.publish(\"arrow.setExpression\", arrowId);\n    });\n  },\n  activePopupConfirmationDelete: function activePopupConfirmationDelete(element, taskId) {\n    var item = this.model.getTaskById(taskId);\n    var deleteOptions = this.aura.find(\".popup__confirmationDelete\");\n    var left = $(element).position().left;\n    var top = $(element).position().top;\n\n    if (this.model.activeConfirmationPopup(item.type)) {\n      this.isActiveConfirmDialog = true;\n      if (item.position.y < 170) {\n        $(deleteOptions).css({ \"top\": top + 38, \"left\": left - 90 });\n        $(deleteOptions).find(\".downArrow\").addClass(\"rotateArrow\");\n      } else {\n\n        $(deleteOptions).css({ \"top\": top - 115, \"left\": left - 90 });\n      }\n      $(deleteOptions).show();\n    } else {\n      this.deleteTask(taskId);\n    }\n\n  },\n  actionConfirmDelete: function actionConfirmDelete(ev, taskId) {\n    var event = ev;\n    var btn = event.className;\n    var deleteOptions = this.aura.find(\".popup__confirmationDelete\");\n    if (btn.indexOf('--yes') > 0) {\n      this.deleteTask(taskId);\n    } else {\n      this.isActiveConfirmDialog = false;\n      $(deleteOptions).hide();\n    }\n  },\n  deleteTask: function deleteTask(taskId) {\n    this.model.deleteTask(taskId);\n  },\n\n  deleteArrow: function deleteArrow(arrowId) {\n    var source = bizagi.bpmn.modeler.connector.getSourceTaskFromId(arrowId);\n    var target = bizagi.bpmn.modeler.connector.getTargetTaskFromId(arrowId);\n    this.model.deleteArrow(source, target);\n  },\n\n  dragArrow: function dragArrow(ui, elementId) {\n    // Publish event\n    this.publish(\"arrow.drag\", { source: elementId, target: ui.offset });\n  },\n\n  changeTo: function changeTo(ev) {\n    var changeOption = $(ev.currentTarget);\n    var type = changeOption.data(\"type\");\n    var task = changeOption.data(\"task\");\n\n    // Publish event\n    this.model.changeTaskType(task, type);\n  },\n\n  manageExternalOption: function manageExternalOption(externalOption, taskId) {\n    var option = externalOption.data(\"option\");\n    // Publish event\n    this.publish(\"task.externaloption\", { task: taskId, option: option });\n  },\n\n  /************************************************************************\r\n      MISC METHODS SECTION\r\n      ************************************************************************/\n  getOptions: function getOptions(task) {\n    var type = task.data(\"type\");\n    if (type == \"EndEvent\" || type == 'TerminateEvent') return [];\n\n    return [\n    \"UserTask\",\n    \"IntermediateEvent\",\n    \"ExclusiveGateway\",\n    \"EndEvent\"];\n\n  },\n\n  getChangeTo: function getChangeTo(task) {\n    var type = task.data(\"type\");\n    var possibleChanges = [];\n    if (type == \"ExclusiveGateway\" || type == \"ParallelGateway\" || type == \"InclusiveGateway\" || type == \"ComplexGateway\") {\n      //possibleChanges =  [ \"ParallelGateway\", \"ExclusiveGateway\"];\n      possibleChanges = [\"ParallelGateway\", \"InclusiveGateway\", \"ComplexGateway\", \"ExclusiveGateway\"];\n    } else if (type == \"EndEvent\" || type == \"TerminateEvent\") {\n      possibleChanges = [\"EndEvent\", \"TerminateEvent\"];\n    } else if (type === \"UserTask\" || type === \"EmailTask\") {\n      possibleChanges = [\"EmailTask\", \"UserTask\"];\n    }\n    if (possibleChanges.length > 0) {\n      possibleChanges.removeOne(type);\n      return possibleChanges;\n    }\n    return null;\n  },\n\n  getExternalOptions: function getExternalOptions(task) {\n    var type = task.data(\"type\");\n    if (type != \"UserTask\" && type != \"IntermediateEvent\" && type != \"EmailTask\") return [];\n\n    return [\"form\", \"assignee\", \"notify\"];\n  } });","$.Class.extend(\"bizagi.bpmn.modeler.path\", {}, {\n  curve: 8,\n  arrowHeight: 10,\n  calculateAnchors: function calculateAnchors(el1, el2) {\n    var threshold_x = Math.min(el1.width, el2.width);\n    var threshold_y = Math.min(el1.height, el2.height);\n    var e1xh = el1.x + el1.width / 2;\n    var e2xh = el2.x + el2.width / 2;\n    var e1yh = el1.y + el1.height / 2;\n    var e2yh = el2.y + el2.height / 2;\n\n    // FIRST CASES, THE ELEMENTS ARE FAR ENOUGH IN X-AXIS\n    // Task 1 is at x from Task 2\n    if (el1.x + el1.width + threshold_x < el2.x) return { el1: \"right\", el2: \"left\" };\n    // Task 1 is at right from Task 2\n    if (el1.x > el2.x + el2.width + threshold_x) return { el1: \"left\", el2: \"right\" };\n\n    /* SECOND CASES, THE ELEMENT'S CENTERS ARE VERY CLOSE IN X-AXIS*/\n    if (this.areElementsVeryCloseInXAxis(el1, el2, threshold_x)) {\n      // Task 1 and Task 2 centers are almost in the same x-axis position, but task 1 is on y of task 2 \n      if (el1.y + el1.height < el2.y) return { el1: \"bottom\", el2: \"top\" };\n      // Task 1 and Task 2 centers are almost in the same x-axis position, but task 1 is on bottom of task 2\n      if (el1.y > el2.y + el2.height) return { el1: \"top\", el2: \"bottom\" };\n    }\n\n    // THIRD CASES, THE ELEMENTS ARE VERY CLOSE IN X-AXIS, AND VERY CLOSE IN Y-AXIS\n    if (Math.abs(e1yh - e2yh) < threshold_y) {\n      // Task 1 is at x from Task 2\n      if (el1.x < el2.x) return { el1: \"right\", el2: \"left\" };\n      // Task 1 is at right from Task 2\n      if (el1.x >= el2.x) return { el1: \"left\", el2: \"right\" };\n    }\n\n    // FOURTH CASES, THE ELEMENTS ARE CLOSE BUT NOT SO CLOSE, SO WE NEED TO MOVE THE ANCHORS\n    if (e1xh < e2xh && e1yh < e2yh) return { el1: \"bottom\", el2: \"left\" };\n    if (e1xh > e2xh && e1yh < e2yh) return { el1: \"bottom\", el2: \"right\" };\n    if (e1xh < e2xh && e1yh > e2yh) return { el1: \"top\", el2: \"left\" };\n    if (e1xh > e2xh && e1yh > e2yh) return { el1: \"top\", el2: \"right\" };\n  },\n\n  getPath: function getPath(box, anchors, el1, el2) {\n    var threshold_x = Math.min(el1.width, el2.width);\n    var threshold_y = Math.min(el1.height, el2.height);\n    var coords = { x: this.arrowHeight, y: this.arrowHeight, w: box.width - this.arrowHeight, h: box.height - this.arrowHeight };\n\n    /* STRAIGHT LINE CASES */\n    if (this.areVerticalAnchors(anchors) && Math.abs(el1.x - el2.x) < 10) {\n      // Task 1 is at y from task2, and the difference in x-axis is very small\n      if (el1.y < el2.y) return this.getPathTopToBottom(coords, el1, el2);\n      // Task 1 is at bottom from task2, and the difference in x-axis is very small\n      if (el1.y > el2.y) return this.getPathBottomToTop(coords, el1, el2);\n    }\n    if (this.areHorizontalAnchors(anchors) && Math.abs(el1.y - el2.y) < 10) {\n      // Task 1 is at x from task2, and the difference in y-axis is very small\n      if (el1.x < el2.x) return this.getPathLeftToRight(coords);\n      // Task 1 is at right from task2, and the difference in y-axis is very small\n      if (el1.x > el2.x) return this.getPathRightToLeft(coords);\n    }\n\n    /* MUST DRAW TWO CURVE CASES */\n    if (this.areHorizontalAnchors(anchors)) {\n      // Task 1 is at x-y from task2\n      if (el1.x < el2.x && el1.y < el2.y) return this.getPathLeftToRightBottom(coords);\n      // Task 1 is at x-bottom from task2\n      if (el1.x < el2.x && el1.y > el2.y) return this.getPathLeftToRightTop(coords);\n      // Task 1 is at right-y from task2\n      if (el1.x > el2.x && el1.y < el2.y) return this.getPathRightToLeftBottom(coords);\n      // Task 1 is at right-bottom from task2\n      if (el1.x > el2.x && el1.y > el2.y) return this.getPathRightToLeftTop(coords);\n    }\n    if (this.areVerticalAnchors(anchors)) {\n      // Task 1 is at x-y from task2\n      if (el1.x < el2.x && el1.y < el2.y) return this.getPathTopToBottomLeft(coords);\n      // Task 1 is at x-bottom from task2\n      if (el1.x < el2.x && el1.y > el2.y) return this.getPathBottomToTopLeft(coords);\n      // Task 1 is at right-y from task2\n      if (el1.x > el2.x && el1.y < el2.y) return this.getPathTopToBottomRight(coords);\n      // Task 1 is at right-bottom from task2\n      if (el1.x > el2.x && el1.y > el2.y) return this.getPathBottomToTopRight(coords);\n    }\n\n    /* MUST DRAW ONE CURVE CASES*/\n    if (anchors.el1 == \"bottom\" && anchors.el2 == \"left\") return this.getPathBottomToLeft(coords);\n    if (anchors.el1 == \"bottom\" && anchors.el2 == \"right\") return this.getPathBottomToRight(coords);\n    if (anchors.el1 == \"top\" && anchors.el2 == \"left\") return this.getPathTopToLeft(coords);\n    if (anchors.el1 == \"top\" && anchors.el2 == \"right\") return this.getPathTopToRight(coords);\n  },\n\n  getTransform: function getTransform(anchors, el1, el2) {\n    if (this.areVerticalAnchors(anchors)) {\n      if (Math.abs(el1.x - el2.x) < this.arrowHeight) return \"translate(5, 0)\";\n    }\n    if (anchors.el1 == \"left\" || anchors.el1 == \"right\") {\n      if (Math.abs(el1.y - el2.y) < this.arrowHeight) return \"translate(0, 5)\";\n    }\n    return \"\";\n  },\n\n  areHorizontalAnchors: function areHorizontalAnchors(anchors) {\n    return anchors.el1 == \"left\" && anchors.el2 == \"right\" || anchors.el1 == \"right\" && anchors.el2 == \"left\";\n  },\n\n  areVerticalAnchors: function areVerticalAnchors(anchors) {\n    return anchors.el1 == \"top\" && anchors.el2 == \"bottom\" || anchors.el1 == \"bottom\" && anchors.el2 == \"top\";\n  },\n\n  areElementsVeryCloseInXAxis: function areElementsVeryCloseInXAxis(el1, el2, threshold) {\n    var e1xh = el1.x + el1.width / 2;\n    var e2xh = el2.x + el2.width / 2;\n    // Centers are very close\n    if (Math.abs(e1xh - e2xh) < threshold) return true;\n    // Center of 1 is close to left edge of 2\n    if (Math.abs(e1xh - el2.x) < threshold) return true;\n    // Center of 1 is close to right  edge of 2\n    if (Math.abs(e1xh - el2.x + el2.width) < threshold) return true;\n    // Center of 2 is close to left edge of 1\n    if (Math.abs(e2xh - el1.x) < threshold) return true;\n    // Center of 2 is close to right  edge of 1\n    if (Math.abs(e2xh - el1.x + el1.width) < threshold) return true;\n    return false;\n  },\n\n  /* STRAIGHT LINES */\n  getPathLeftToRight: function getPathLeftToRight(coords) {\n    var x1 = coords.x,x2 = coords.w,y1 = coords.h / 2,y2 = coords.h / 2;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go to the end\n    this.getArrowRight(x2, y2);\n  },\n\n  getPathRightToLeft: function getPathRightToLeft(coords) {\n    var x1 = coords.w,x2 = coords.x,y1 = coords.h / 2,y2 = coords.h / 2;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go to the end\n    this.getArrowLeft(x2, y2);\n  },\n\n  getPathTopToBottom: function getPathTopToBottom(coords, el1, el2) {\n    var min = el1.x < el2.x ? this.arrowHeight : coords.w;\n    var x1 = min / 2,x2 = min / 2,y1 = coords.y,y2 = coords.h;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go to the end\n    this.getArrowDown(x2, y2);\n  },\n\n  getPathBottomToTop: function getPathBottomToTop(coords, el1, el2) {\n    var min = el1.x < el2.x ? this.arrowHeight : coords.w;\n    var x1 = min / 2,x2 = min / 2,y1 = coords.h,y2 = coords.y;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go to the end\n    this.getArrowUp(x2, y2);\n  },\n\n  /* TWO CURVES X-AXIS*/\n  getPathLeftToRightBottom: function getPathLeftToRightBottom(coords) {\n    var x1 = coords.x,x2 = coords.w,y1 = coords.y,y2 = coords.h;\n    var xh = coords.w / 2,yh = coords.h / 2,c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + (xh - c) + \",\" + y1 + \" \" + // Go half the way\n    \"S \" + xh + \",\" + y1 + \" \" + xh + \",\" + (y1 + c) + \" \" + // Create a corner\n    \"L \" + xh + \",\" + (y2 - c) + \" \" + // Go down in y-axis\n    \"S \" + xh + \",\" + y2 + \" \" + (xh + c) + \",\" + y2 + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go another half-way\n    this.getArrowRight(x2, y2);\n\n  },\n\n  getPathLeftToRightTop: function getPathLeftToRightTop(coords) {\n    var x1 = coords.x,x2 = coords.w,y1 = coords.h,y2 = coords.y;\n    var xh = coords.w / 2,yh = coords.h / 2,c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + (xh - c) + \",\" + y1 + \" \" + // Go half the way\n    \"S \" + xh + \",\" + y1 + \" \" + xh + \",\" + (y1 - c) + \" \" + // Create a corner\n    \"L \" + xh + \",\" + (y2 + c) + \" \" + // Go up in y-axis\n    \"S \" + xh + \",\" + y2 + \" \" + (xh + c) + \",\" + y2 + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go another half-way\n    this.getArrowRight(x2, y2);\n  },\n\n  getPathRightToLeftBottom: function getPathRightToLeftBottom(coords) {\n    var x1 = coords.w,x2 = coords.x,y1 = coords.y,y2 = coords.h;\n    var xh = coords.w / 2,yh = coords.h / 2,c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + (xh + c) + \",\" + y1 + \" \" + // Go half the way in reverse\n    \"S \" + xh + \",\" + y1 + \" \" + xh + \",\" + (y1 + c) + \" \" + // Create a corner\n    \"L \" + xh + \",\" + (y2 - c) + \" \" + // Go down in y-axis\n    \"S \" + xh + \",\" + y2 + \" \" + (xh - c) + \",\" + y2 + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go another half-way in reverse\n    this.getArrowLeft(x2, y2);\n  },\n\n  getPathRightToLeftTop: function getPathRightToLeftTop(coords) {\n    var x1 = coords.w,x2 = coords.x,y1 = coords.h,y2 = coords.y;\n    var xh = coords.w / 2,yh = coords.h / 2,c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + (xh + c) + \",\" + y1 + \" \" + // Go half the way in reverse\n    \"S \" + xh + \",\" + y1 + \" \" + xh + \",\" + (y1 - c) + \" \" + // Create a corner\n    \"L \" + xh + \",\" + (y2 + c) + \" \" + // Go up in y-axis\n    \"S \" + xh + \",\" + y2 + \" \" + (xh - c) + \",\" + y2 + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go another half-way in reverse\n    this.getArrowLeft(x2, y2);\n  },\n\n  /* TWO CURVES Y-AXIS*/\n  getPathTopToBottomLeft: function getPathTopToBottomLeft(coords) {\n    var x1 = coords.x,x2 = coords.w,y1 = coords.y,y2 = coords.h;\n    var xh = coords.w / 2,yh = coords.h / 2,c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x1 + \",\" + (yh - c) + \" \" + // Go half the way down\n    \"S \" + x1 + \",\" + yh + \" \" + (x1 + c) + \",\" + yh + \" \" + // Create a corner\n    \"L \" + (x2 - c) + \",\" + yh + \" \" + // Go left in y-axis\n    \"S \" + x2 + \",\" + yh + \" \" + x2 + \",\" + (yh + c) + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go another half-way\n    this.getArrowDown(x2, y2);\n\n  },\n\n  getPathTopToBottomRight: function getPathTopToBottomRight(coords) {\n    var x1 = coords.w,x2 = coords.x,y1 = coords.y,y2 = coords.h;\n    var xh = coords.w / 2,yh = coords.h / 2,c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x1 + \",\" + (yh - c) + \" \" + // Go half the way down\n    \"S \" + x1 + \",\" + yh + \" \" + (x1 - c) + \",\" + yh + \" \" + // Create a corner\n    \"L \" + (x2 + c) + \",\" + yh + \" \" + // Go right in y-axis\n    \"S \" + x2 + \",\" + yh + \" \" + x2 + \",\" + (yh + c) + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go another half-way\n    this.getArrowDown(x2, y2);\n  },\n\n  getPathBottomToTopLeft: function getPathBottomToTopLeft(coords) {\n    var x1 = coords.x,x2 = coords.w,y1 = coords.h,y2 = coords.y;\n    var xh = coords.w / 2,yh = coords.h / 2,c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x1 + \",\" + (yh + c) + \" \" + // Go half the way up\n    \"S \" + x1 + \",\" + yh + \" \" + (x1 + c) + \",\" + yh + \" \" + // Create a corner\n    \"L \" + (x2 - c) + \",\" + yh + \" \" + // Go left in y-axis\n    \"S \" + x2 + \",\" + yh + \" \" + x2 + \",\" + (yh - c) + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go another half-way\n    this.getArrowUp(x2, y2);\n\n  },\n\n  getPathBottomToTopRight: function getPathBottomToTopRight(coords) {\n    var x1 = coords.w,x2 = coords.x,y1 = coords.h,y2 = coords.y;\n    var xh = coords.w / 2,yh = coords.h / 2,c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x1 + \",\" + (yh + c) + \" \" + // Go half the way up\n    \"S \" + x1 + \",\" + yh + \" \" + (x1 - c) + \",\" + yh + \" \" + // Create a corner\n    \"L \" + (x2 + c) + \",\" + yh + \" \" + // Go right in y-axis\n    \"S \" + x2 + \",\" + yh + \" \" + x2 + \",\" + (yh - c) + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go another half-way\n    this.getArrowUp(x2, y2);\n\n  },\n\n  /* ONE CURVE */\n  getPathBottomToLeft: function getPathBottomToLeft(coords) {\n    var x1 = coords.x,x2 = coords.w,y1 = coords.y,y2 = coords.h;\n    var c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x1 + \",\" + (y2 - c) + \" \" + // Go down in y-axis\n    \"S \" + x1 + \",\" + y2 + \" \" + (x1 + c) + \",\" + y2 + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go to final position\n    this.getArrowRight(x2, y2);\n  },\n\n  getPathBottomToRight: function getPathBottomToRight(coords) {\n    var x1 = coords.w,x2 = coords.x,y1 = coords.y,y2 = coords.h;\n    var c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x1 + \",\" + (y2 - c) + \" \" + // Go down in y-axis\n    \"S \" + x1 + \",\" + y2 + \" \" + (x1 - c) + \",\" + y2 + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go to final position (reverse)\n    this.getArrowLeft(x2, y2);\n  },\n\n  getPathTopToLeft: function getPathTopToLeft(coords) {\n    var x1 = coords.x,x2 = coords.w,y1 = coords.h,y2 = coords.y;\n    var c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x1 + \",\" + (y2 + c) + \" \" + // Go up in y-axis\n    \"S \" + x1 + \",\" + y2 + \" \" + (x1 + c) + \",\" + y2 + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go to final position\n    this.getArrowRight(x2, y2);\n  },\n\n  getPathTopToRight: function getPathTopToRight(coords) {\n    var x1 = coords.w,x2 = coords.x,y1 = coords.h,y2 = coords.y;\n    var c = this.curve;\n    return \"M \" + x1 + \",\" + y1 + \" \" + // Start position\n    \"L \" + x1 + \",\" + (y2 + c) + \" \" + // Go up in y-axis\n    \"S \" + x1 + \",\" + y2 + \" \" + (x1 - c) + \",\" + y2 + \" \" + // Create a corner\n    \"L \" + x2 + \",\" + y2 + \" \" + // Go to final position (reverse)\n    this.getArrowLeft(x2, y2);\n  },\n\n  /* ARROWS */\n  getArrowRight: function getArrowRight(x, y) {\n    var ah = this.arrowHeight / 2;\n    return \"m -\" + ah + \",-\" + ah + \" \" +\n    \"l \" + ah + \",\" + ah + \" \" +\n    \"l -\" + ah + \",\" + ah;\n  },\n\n  getArrowLeft: function getArrowLeft(x, y) {\n    var ah = this.arrowHeight / 2;\n    return \"m \" + ah + \",-\" + ah + \" \" +\n    \"l -\" + ah + \",\" + ah + \" \" +\n    \"l \" + ah + \",\" + ah;\n  },\n\n  getArrowUp: function getArrowUp(x, y) {\n    var ah = this.arrowHeight / 2;\n    return \"m -\" + ah + \",\" + ah + \" \" +\n    \"l \" + ah + \",-\" + ah + \" \" +\n    \"l \" + ah + \",\" + ah;\n  },\n\n  getArrowDown: function getArrowDown(x, y) {\n    var ah = this.arrowHeight / 2;\n    return \"m -\" + ah + \",-\" + ah + \" \" +\n    \"l \" + ah + \",\" + ah + \" \" +\n    \"l \" + ah + \",-\" + ah;\n  } });","$.Class.extend(\"bizagi.bpmn.modeler.connector\", {\n\n  /* STATIC STUFF */\n  buildConnectorId: function buildConnectorId(source, target) {\n    return \"svgFrom_\" + source + \"_to_\" + target;\n  },\n\n  getSourceTaskFromId: function getSourceTaskFromId(id) {\n    var i1 = id.indexOf(\"svgFrom_\");\n    var i2 = id.indexOf(\"_to_\");\n    return id.substring(i1 + 8, i2);\n  },\n\n  getTargetTaskFromId: function getTargetTaskFromId(id) {\n    var i1 = id.indexOf(\"_to_\");\n    return id.substring(i1 + 4);\n  } },\n\n\n{\n  /* INSTANCE STUFF */\n\n  /* Constructor */\n  init: function init() {\n    $.templates({\n      bpm_modeler_connector: '<connector style=\"position:absolute;left:{{:left}}px;top:{{:top}}px\" \\\r\n                                                id=\"{{:id}}\" \\\r\n                                                class=\"bpm-{{:expression}}\" \\\r\n                                                data-expression=\"{{:expression}}\"> \\\r\n                                                <label class=\"label_connector_name\">{{:displayName}}</label> \\\r\n                                        <svg width=\"{{:width}}\" height=\"{{:height}}\"> \\\r\n                                            <path d=\"{{:path}}\" fill=\"none\" stroke=\"{{:stroke}}\" transform=\"{{:transform}}\"/> \\\r\n                                        </svg> \\\r\n                                        {{if expression == \"else\"}} <connector-label>else</connection-label> {{/if}} \\\r\n                                    </connector>' });\n\n\n\n    // Create dependencies\n    this.path = new bizagi.bpmn.modeler.path();\n    this.stroke = \"#2C121C\";\n  },\n\n  connect: function connect(canvas, task1, task2, expression, displayName, labelConnectorPos) {\n    var el1 = this.getBounds(task1);\n    var el2 = this.getBounds(task2);\n    var id = this.Class.buildConnectorId(task1.attr(\"id\"), task2.attr(\"id\"));\n    if (task1.attr(\"id\") != task2.attr(\"id\")) this.drawLine(canvas, id, el1, el2, expression, displayName, labelConnectorPos);\n  },\n\n  drawLine: function drawLine(canvas, id, el1, el2, expression, displayName, labelConnectorPos) {\n    // Adjust positions for better fit\n    var anchors = this.modifyPositions(el1, el2);\n    var data = {\n      id: id,\n      top: this.getTop(el1, el2),\n      left: this.getLeft(el1, el2),\n      width: this.getWidth(el1, el2),\n      height: this.getHeight(el1, el2),\n      transform: this.path.getTransform(anchors, el1, el2),\n      expression: expression,\n      displayName: displayName,\n      stroke: this.stroke };\n\n\n    // Create path\n    data.path = this.path.getPath(data, anchors, el1, el2);\n    var html = $.templates.bpm_modeler_connector.render(data);\n    connector = $(html);\n    canvas.append(connector);\n\n    // If ELSE\n    if (expression == \"else\") {\n      var svg = connector.find(\"svg\");\n      var elseLabel = connector.find(\"connector-label\");\n      elseLabel.position({ of: svg, my: \"center center\", at: \"center center\", collision: \"none\" });\n    }\n    // attach event drag of label\n    $(\".label_connector_name\").draggable({\n      containment: \"#bpm-drawing\",\n      grid: [20, 20] });\n\n\n    var labelConnectorName = $(connector).find(\".label_connector_name\");\n    if (labelConnectorPos) {\n      $(labelConnectorName).css({ top: labelConnectorPos.y, left: labelConnectorPos.x });\n    } else {\n      labelConnectorPos = {\n        \"x\": Math.round($(connector).find(\".label_connector_name\").position.left),\n        \"y\": Math.round($(connector).find(\".label_connector_name\").position.top) };\n\n      $(labelConnectorName).css({ top: labelConnectorPos.y, left: labelConnectorPos.x });\n    }\n  },\n\n  refresh: function refresh(canvas, task1, task2) {\n    var id = this.Class.buildConnectorId(task1.attr(\"id\"), task2.attr(\"id\"));\n    var line = $(\"#\" + id);\n    var expression = line.data(\"expression\");\n    line.detach();\n    this.connect(canvas, task1, task2, expression);\n  },\n\n  drawTemporalConnector: function drawTemporalConnector(canvas, sourceTask, target) {\n    var id = \"svgTemporalConnector\";\n\n    // Remove previous line\n    canvas.find(\"#\" + id).detach();\n\n    // Draw a new line\n    var el1 = this.getBounds(sourceTask);\n    var el2 = { x: target.left, y: target.top, width: 0, height: 0 };\n    this.drawLine(canvas, id, el1, el2);\n  },\n\n  removeTemporalConnector: function removeTemporalConnector(canvas) {\n    var id = \"svgTemporalConnector\";\n\n    // Remove \n    canvas.find(\"#\" + id).detach();\n  },\n\n  getBounds: function getBounds(element) {\n    var position = element.position();\n    return { x: position.left, y: position.top, width: element.outerWidth(), height: element.outerHeight() };\n  },\n\n  getLeft: function getLeft(el1, el2) {\n    return Math.min(el1.x, el2.x) - this.path.arrowHeight;\n  },\n\n  getTop: function getTop(el1, el2) {\n    return Math.min(el1.y, el2.y) - this.path.arrowHeight;\n  },\n\n  getWidth: function getWidth(el1, el2) {\n    return Math.abs(el1.x - el2.x) + this.path.arrowHeight * 2;\n  },\n\n  getHeight: function getHeight(el1, el2) {\n    return Math.abs(el1.y - el2.y) + this.path.arrowHeight * 2;\n  },\n\n  modifyPositions: function modifyPositions(el1, el2) {\n    var anchors = this.path.calculateAnchors(el1, el2);\n    // Modify according anchors\n    this.adjustToAnchor(el1, anchors.el1);\n    this.adjustToAnchor(el2, anchors.el2);\n\n    return anchors;\n  },\n\n  adjustToAnchor: function adjustToAnchor(el, anchor) {\n    if (anchor == \"top\" || anchor == \"bottom\") el.x = el.x + el.width / 2; // adjust to x-center\n    if (anchor == \"left\" || anchor == \"right\") el.y = el.y + el.height / 2; // adjust to y-center\n    if (anchor == \"bottom\") el.y = el.y + el.height; // Put to bottom\n    if (anchor == \"right\") el.x = el.x + el.width; // Put to right\n  } });","bizagi.bpmn.modeler.observable.extend(\"bizagi.bpmn.modeler.drawing\", {}, {\n\n  /* Constructor */\n  init: function init(model) {\n    var that = this;\n    this.canvas = null;\n    $.templates({\n      bpm_modeler_drawing: '<drawing> \\\r\n                                    {{for tasks tmpl=\"bpm_modeler_drawingItem\"/}} \\\r\n                                  </drawing>',\n      bpm_modeler_drawingItem: '<item id=\"{{: id}}\" class=\"bpm-{{:type}} bpm-moveable\" title=\"{{>displayName}}\" \\\r\n                                            style=\"left:{{:position.x}}px; top:{{:position.y}}px\" \\\r\n                                            data-type=\"{{: type}}\"\\\r\n                                            data-show-aura=\"{{:showAura}}\"> \\\r\n                                            <label class=\"labelNameTask label-{{:type}}\">{{>displayName}}</label>\\\r\n                                            {{if type==\"IntermediateEvent\"}}<svg id=\"Layer_1\" data-name=\"Layer 1\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><defs><style>.cls-1{fill:#fdffe7;}.cls-2{fill:#99a805;}</style></defs><title>event</title><circle class=\"cls-1\" cx=\"12\" cy=\"12\" r=\"12\"/><path class=\"cls-2\" d=\"M12,1A11,11,0,1,1,1,12,11,11,0,0,1,12,1m0-1A12,12,0,1,0,24,12,12,12,0,0,0,12,0Z\"/><path class=\"cls-2\" d=\"M12,2.85A9.15,9.15,0,1,1,2.85,12,9.15,9.15,0,0,1,12,2.85m0-1.1A10.25,10.25,0,1,0,22.25,12,10.25,10.25,0,0,0,12,1.75Z\"/></svg>{{/if}}\\\r\n                                            {{if type ===\"EmailTask\"}}<i class=\"ico_mail bpmn-icon-intermediate-event-throw-escalation\"></i>{{/if}}\\\r\n                                            {{if ~root.isGateway(type)}}<gateway-helper></gateway-helper>{{/if}} \\\r\n                                            {{if type !=\"EmailTask\" && durationInMinutes }}<duration title=\"{{:durationInMinutes}}\">{{:durationInMinutes}}</duration>{{/if}} \\\r\n                                       </item>' });\n\n\n    // Set model\n    this.drawingWidth = 0;\n    this.drawingHeight = 0;\n    this.model = model;\n    this.model.subscribe(\"model.redraw\", $.proxy(this.refresh, this));\n    this.previusElement = null;\n\n    this.isEditionActive = false;\n\n    this.reviewMode = false;\n\n    // Create dependencies\n    this.aura = new bizagi.bpmn.modeler.aura(this.model);\n    this.aura.subscribe(\"item.drag\", $.proxy(this.onElementDragging, this));\n    this.aura.subscribe(\"arrow.drag\", $.proxy(this.onArrowDragging, this));\n    this.aura.subscribe(\"arrow.setExpression\", $.proxy(this.editExpressionForArrow, this));\n    this.aura.subscribe(\"arrow.setElse\", $.proxy(this.triggerElseExpressionForArrow, this));\n    this.aura.subscribe(\"task.externaloption\", $.proxy(this.manageExternalOption, this));\n    this.aura.subscribe(\"task.click\", $.proxy(this.clickOnTask, this));\n    this.connector = new bizagi.bpmn.modeler.connector();\n    this.aux = \"\";\n  },\n  setCanvas: function setCanvas(canvas) {\n    this.canvas = canvas;\n  },\n  render: function render(canvas, readonly) {\n    var that = this;\n    var initializeGeneralHandlers = this.canvas == null;\n    this.canvas = canvas;\n    // Render template\n    var viewModel = this.model.getViewModel();\n    var html = $.templates.bpm_modeler_drawing.render(viewModel);\n\n    canvas.append(html);\n    // Set drawing canvas\n    this.drawing = canvas.find(\"drawing\");\n    // Calculate size for drawing\n    this.canvasWidth = canvas.width();\n    this.canvasHeight = canvas.height();\n    this.scrollTop = viewModel.canvas.top || 0;\n    this.scrollLeft = viewModel.canvas.left || 0;\n    this.drawingWidth = this.drawingWidth || viewModel.canvas.width || this.canvasWidth;\n    this.drawingHeight = this.drawingHeight || viewModel.canvas.height || this.canvasHeight;\n    //this.drawing.css({ minWidth: this.canvasWidth, minHeight: this.canvasHeight, width: this.drawingWidth, height: this.drawingHeight});\n    this.drawing.width(this.drawingWidth);\n    this.drawing.height(this.drawingHeight);\n    this.canvas.scrollLeft(this.scrollLeft);\n    this.canvas.scrollTop(this.scrollTop);\n\n    // Add connectors\n    setTimeout(function () {that.addConnectors(viewModel);}, 0);\n\n    // Add event handlers\n    if (readonly !== true && that.readonlyLoaded !== true) {\n      this.addHandlers();\n    } else {\n      that.readonlyLoaded = true;\n    }\n\n    // Add general event handlers (ONLY ONCE)\n    if (initializeGeneralHandlers && readonly !== true) {\n      this.addGeneralHandlers();\n    }\n\n    // Show aura for item where data-show-aura = true\n    this.drawing.find(\"item[data-show-aura=true]\").click();\n\n    // Set Name of all items\n    this.configureNamesOfItems();\n\n    //Set events in the document\n    this.setGeneralEvents();\n  },\n  activeReviewMode: function activeReviewMode() {\n    $(document).find('#bpm-toolbar').hide();\n    $(this.drawing).find('.bpm-moveable').draggable('disable');\n    $(this.drawing).find('aura').hide();\n    this.reviewMode = true;\n    $(\"body\").unbind('keyup');\n    $(\"body\").off();\n  },\n  setGeneralEvents: function setGeneralEvents() {\n    var that = this;\n    $(\"body\").off();\n    $(\"body\").on(\"keyup\", function (e) {\n      if (!this.reviewMode) that.keyUpEvent(e);\n    });\n  },\n\n  keyUpEvent: function keyUpEvent(e) {\n    var that = this;\n    var selectedItem = that.returnSelectedItem();\n    if (selectedItem) {\n      switch (e.which) {\n        case 113: //F2 Change name of items\n          if (selectedItem.nodeName == \"CONNECTOR\") {\n            if (!that.isEditionActive) that.editConnectorName($(selectedItem.firstElementChild), \"f2\");\n          } else {\n\n            if (!that.isEditionActive) {\n              that.editTaskName($(selectedItem.firstElementChild), \"f2\");\n            }\n          }\n          break;\n        case 46: //SUPR - Delete items\n          if (!this.reviewMode) {\n            if (selectedItem && selectedItem.nodeName == \"CONNECTOR\") {\n              var source = selectedItem.id.split(\"_to_\")[0].split(\"svgFrom_\")[1];\n              var target = selectedItem.id.split(\"_to_\")[1];\n              that.model.deleteArrow(source, target);\n            } else {\n              var element = that.model.getTaskById(selectedItem.id);\n\n              if (that.model.activeConfirmationPopup(element.type)) {\n                var source = $(\"#\" + selectedItem.id).parent().find(\".bpm-option-delete\");\n                that.aura.activePopupConfirmationDelete($(source), selectedItem.id);\n              } else {\n                that.model.deleteTask(element.id);\n              }\n            }\n\n          }\n          break;}\n\n    }\n  },\n\n  configureNamesOfItems: function configureNamesOfItems() {\n    var that = this;\n    $(\"#bpm-drawing\").find(\".labelNameTask\").each(function (index, obj) {\n      var value = $(obj).text();\n      if (that.setNameTask(value, $(obj))) {\n        $(obj).attr(\"desc\", value);\n        $(obj).text(value.substring(0, 20) + '...');\n      } else {\n        $(obj).text(value);\n      }\n    });\n  },\n  returnSelectedItem: function returnSelectedItem() {\n    var itemSelected = null;\n    $(\"#bpm-drawing\").find(\".active\").each(function (i, el) {\n      itemSelected = el;\n    });\n    return itemSelected;\n  },\n  refresh: function refresh() {\n    this.isEditionActive = false;\n    this.canvas.empty();\n    this.aura.hide();\n    this.render(this.canvas);\n  },\n  /************************************************************************\r\n      HANDLER CONFIGURATION SECTION\r\n      ************************************************************************/\n  addHandlers: function addHandlers() {\n    // Add movement to items\n\n    if (!this.reviewMode) {\n      this.drawing.find(\"item\").draggable({\n        containment: \"#bpm-drawing\",\n        grid: [20, 20],\n        drag: $.proxy(this.onTaskDragging, this) });\n\n\n      // Configure drop area\n      this.configureDroppable();\n    }\n  },\n\n  addGeneralHandlers: function addGeneralHandlers() {\n    // Make items clickable\n    this.canvas.on(\"click\", \"item\", $.proxy(this.showAura, this));\n\n    // Edit items name\n    this.canvas.on(\"dblclick\", \"item\", $.proxy(this.editTaskName, this));\n\n    // Edit task duration\n    this.canvas.on(\"dblclick\", \"item duration\", $.proxy(this.editDuration, this));\n\n    // Make arrows clickable\n    this.canvas.on(\"click\", \"connector\", $.proxy(this.showAuraForArrow, this));\n\n    // Edit arrows name\n    this.canvas.on(\"dblclick\", \"connector\", $.proxy(this.editConnectorName, this));\n\n    // Make canvas click\n    this.canvas.on(\"click\", \"drawing\", $.proxy(this.clickCavnas, this));\n\n    //Set position of label connector\n    this.canvas.on(\"mouseup\", \"connector label\", $.proxy(this.setConnectorPosition, this));\n\n  },\n  setConnectorPosition: function setConnectorPosition(ev) {\n    var that = this;\n    var label = $(ev.currentTarget);\n    var idSourceConnector = $(label).parent().attr(\"id\").split(\"_to_\")[0].split(\"svgFrom_\")[1];\n    var idTargetConnector = $(label).parent().attr(\"id\").split(\"_to_\")[1];\n    var labelPosition = {\n      \"x\": label.position().left,\n      \"y\": label.position().top };\n\n    that.model.changeConnectorPos(idSourceConnector, idTargetConnector, labelPosition);\n  },\n  clickCavnas: function clickCavnas(ev) {\n    var event = ev;\n    if (event.target.className === \"ui-droppable\") {\n      this.drawing.find(\"*\").removeClass(\"active\");\n      if (this.previusElement) {\n        if (this.previusElement.context.nodeName === \"CONNECTOR\") {\n          var auraShown = this.aura.showForArrow(this.previusElement, false);\n        } else {\n          var auraShown = this.aura.showForTask(this.previusElement);\n        }\n      }\n      this.previusElement = null;\n    }\n  },\n  configureDroppable: function configureDroppable() {\n    var that = this;\n    var mergeElement = false;\n    var mergeTarget = null;\n    this.drawing.find(\"item\").droppable({\n      hoverClass: \"dragging-arrow\",\n      drop: function drop(event, ui) {\n        setTimeout(function () {\n          mergeElement = true;\n          mergeTarget = ui;\n        });\n      } });\n\n    this.drawing.droppable({\n      // We use a setTimeout to avoid some weird error from jquery ui\n      drop: function drop(event, ui) {\n        setTimeout(function () {\n          if (!mergeElement) {\n            if (ui.helper.hasClass(\"bpm-cloneable\")) that.addTask(ui);else\n            if (ui.helper.hasClass(\"bpm-moveable\")) that.moveTask(ui);else\n            if (ui.helper.hasClass(\"bpm-option-arrow\")) that.addArrow(ui);\n          } else {\n            that.addArrow(mergeTarget);\n            if (mergeElement.successor) {\n              //that.addArrow(mergeTarget);\n            }\n          }\n          mergeElement = false;\n        }, 0);\n      },\n      accept: \".bpm-cloneable, .bpm-moveable, .bpm-option-arrow\" });\n\n  },\n\n  /************************************************************************\r\n      MODEL MODIFIERS SECTION\r\n      ************************************************************************/\n  addTask: function addTask(ui) {\n    var type = ui.draggable.data(\"type\");\n    var predecessor = ui.draggable.data(\"predecessor\");\n    var pos = this.fixPosition(ui.offset);\n    var x = pos.left;\n    var y = pos.top;\n    this.autoAdjustCanvasOn(x, y);\n    /* Align to the grid*/\n    x = x - x % 20;\n    y = y - y % 20;\n    if (x < 80) x = 80;\n    if (y < 60) y = 60;\n    this.model.addTask(type, { x: x, y: y }, predecessor);\n  },\n\n  /**\r\n      * this method move the canvas if the task or element is near to the right border and bottom border\r\n      * @param {Int} x of element\r\n      * @param {Int} y of element\r\n      */\n  autoAdjustCanvasOn: function autoAdjustCanvasOn(x, y) {\n    if (this.canvasWidth + this.scrollLeft - 200 < x) {\n      $(\"move-right\").click();\n    }\n    if (this.canvasHeight + this.scrollTop - 100 < y) {\n      $(\"move-bottom\").click();\n    }\n  },\n\n  moveTask: function moveTask(ui) {\n    var type = ui.draggable.data(\"type\");\n    var id = ui.draggable.attr(\"id\");\n    var x = ui.position.left;\n    var y = ui.position.top;\n\n    this.autoAdjustCanvasOn(x, y);\n    /* Align to the grid*/\n    x = x - x % 20;\n    y = y - y % 20;\n    if (x < 80) x = 80;\n    if (y < 60) y = 60;\n    this.model.moveTask(id, { x: x, y: y });\n  },\n\n  editTaskName: function editTaskName(ev, params) {\n    this.isEditionActive = true;\n    if (params) {\n      var label = $(ev);\n    } else {\n      var label = $(\"label\", ev.currentTarget);\n    }\n    var taskId = label.parent().attr(\"id\");\n    var item = this.model.getTaskById(taskId);\n    var isEditableName = this.model.isEditableName(item);\n\n    if (isEditableName && !this.reviewMode) {\n      var that = this;\n      var input = $(\"<input class='input_name' type='text' />\");\n      if (label.attr(\"desc\")) {\n        input.val(label.attr(\"desc\"));\n      } else {\n        input.val(label.text());\n      }\n      if (this.isEditionActive) {\n        this.showPopupEditor(label, input, this._setTaskTextAndTitle.bind(this, that, taskId, label));\n      }\n    } else {\n      this.isEditionActive = false;\n    }\n  },\n\n  /**\r\n      * Return text and title of a task\r\n      * @param {*} that \r\n      * @param {*} taskId \r\n      * @param {*} label\r\n      * @param {*} value = text and title value\r\n      */\n  _setTaskTextAndTitle: function _setTaskTextAndTitle(that, taskId, label, value) {\n    that.model.changeTaskName(taskId, value);\n    if (value === \"\") {\n      value = \"\";\n    }\n    if (that.setNameTask(value, label)) {\n      that.aux = value;\n      label.attr(\"desc\", value);\n      label.text(value.substring(0, 20) + '...');\n    } else {\n      label.text(value);\n    }\n    label.context.title = value;\n  },\n\n  editConnectorName: function editConnectorName(ev, params) {\n    var that = this;\n    if (params) {\n      var label = $(ev);\n    } else {\n      var label = $(\"label\", ev.currentTarget);\n    }\n    var input = $(\"<input type='text' maxlength='20' class='input--ConnectorName input_name'/>\");\n    if (!that.reviewMode) {\n      that.isEditionActive = true;\n      input.val(label.text());\n      var succesorId = label.parent().attr(\"id\");\n      var sourceId = label.parent().attr(\"id\");\n      succesorId = succesorId.split(\"_to_\")[1];\n      sourceId = sourceId.split(\"_to_\")[0].split(\"svgFrom_\")[1];\n      this.showPopupEditor(label, input, function (value) {\n        that.model.changeConnectorName(sourceId, succesorId, value);\n        label.text(value);\n        label.context.title = value;\n      });\n    }\n  },\n  manageExternalOption: function manageExternalOption(ev, params) {\n    var taskName = this.model.getTaskById(params.task);\n    params[\"taskName\"] = taskName.displayName;\n    params[\"type\"] = taskName.type;\n    this.publish(\"drawing.externaloption\", params);\n  },\n  clickOnTask: function clickOnTask(ev, params) {\n    var taskName = this.model.getTaskById(params.task);\n    params[\"taskName\"] = taskName.displayName;\n    this.publish(\"drawing.clickOnTask\", params);\n  },\n  editDuration: function editDuration(ev, params) {\n    ev.stopPropagation();\n    if (!this.reviewMode) {\n      var that = this;\n      that.isEditionActive = true;\n      var label = $(ev.currentTarget);\n      var taskId = label.parent().attr(\"id\");\n      var input = $('<input type=\"text\" maxlength=\"6\" class=\"input__duration\"/>');\n      input.bind(\"paste\", function (e) {\n        e.preventDefault();\n      });\n      input.val(label.text());\n      this.showPopupEditor(label, input, function (value) {\n        if (value === \"\") {\n          value = \"1h\";\n        }\n        var duration = that.model.parseDuration(value);\n        if (duration != null) {\n          that.model.changeDuration(taskId, duration);\n          label.text(that.model.formatDuration(duration));\n          label.context.title = label.text();\n        }\n        input.unbind(\"paste\");\n      });\n    }\n  },\n\n  addArrow: function addArrow(ui) {\n    var source = ui.draggable.data(\"predecessor\");\n    var position = this.fixPosition(ui.offset);\n    var tasksAtPosition = this.getTasksAtPosition(position);\n    if (tasksAtPosition.length == 1) {\n      // Add connection in model\n      var target = tasksAtPosition.attr(\"id\");\n      var classTarget = $(tasksAtPosition).attr(\"class\");\n      if (classTarget.indexOf(\"bpm-StartEvent\") != 0 && source !== target) {\n        this.model.addConnection(source, target);\n      } else {\n        this.connector.removeTemporalConnector(this.canvas);\n      }\n    } else {\n      //  Remove temporal arrow\n      this.connector.removeTemporalConnector(this.canvas);\n    }\n  },\n\n  editExpressionForArrow: function editExpressionForArrow(ev, arrowId) {\n    var source = bizagi.bpmn.modeler.connector.getSourceTaskFromId(arrowId);\n    var target = bizagi.bpmn.modeler.connector.getTargetTaskFromId(arrowId);\n    var data = {\n      option: \"rule\",\n      source: source,\n      target: target };\n\n    this.publish(\"drawing.externaloption\", data);\n  },\n\n  triggerElseExpressionForArrow: function triggerElseExpressionForArrow(ev, arrowId) {\n    var source = bizagi.bpmn.modeler.connector.getSourceTaskFromId(arrowId);\n    var target = bizagi.bpmn.modeler.connector.getTargetTaskFromId(arrowId);\n    var data = {\n      option: \"else\",\n      source: source,\n      target: target };\n\n    this.publish(\"drawing.externaloption\", data);\n  },\n\n  setExpressionForArrow: function setExpressionForArrow(sourceTaskId, targetTaskId) {\n    this.model.setConnectionRule(sourceTaskId, targetTaskId, \"boolean\");\n  },\n\n  moveCanvas: function moveCanvas(ev, ui) {\n    var DISTANCE = 100;\n    var element = $(ev.target);\n    var tag = element.prop(\"tagName\").toLowerCase();\n    if (tag == \"move-right\") {\n      this.scrollLeft += DISTANCE;\n      if (this.canvasWidth + this.scrollLeft >= this.drawingWidth) this.drawingWidth += DISTANCE;\n    }\n    if (tag == \"move-left\") {\n      this.scrollLeft -= DISTANCE;\n    }\n    if (tag == \"move-top\") {\n      this.scrollTop -= DISTANCE;\n    }\n    if (tag == \"move-bottom\") {\n      this.scrollTop += DISTANCE;\n      if (this.canvasHeight + this.scrollTop >= this.drawingHeight) this.drawingHeight += DISTANCE;\n    }\n\n    // Validations\n    if (this.scrollTop < 0) this.scrollTop = 0;\n    if (this.scrollLeft < 0) this.scrollLeft = 0;\n\n    // Apply changes\n    this.drawing.width(this.drawingWidth);\n    this.drawing.height(this.drawingHeight);\n    this.canvas.scrollLeft(this.scrollLeft);\n    this.canvas.scrollTop(this.scrollTop);\n\n    // Update model\n    this.model.setCanvasBounds({\n      top: this.scrollTop,\n      left: this.scrollLeft,\n      width: this.drawingWidth,\n      height: this.drawingHeight });\n\n  },\n\n  /************************************************************************\r\n      DRAGGING HANDLERS\r\n      ************************************************************************/\n  onTaskDragging: function onTaskDragging(event, ui) {\n    this.redrawConnector(ui.helper.attr(\"id\"), ui.position);\n\n    // Move aura\n    this.aura.moveTo(ui.helper);\n    this.onElementDragging(event, ui);\n  },\n\n  onArrowDragging: function onArrowDragging(ev, params) {\n    var drawing = this.drawing;\n\n    // Fixes position to make it relative to drawing container\n    var position = this.fixPosition(params.target);\n\n    // Draw temporal connector\n    this.connector.drawTemporalConnector(drawing, drawing.find(\"#\" + params.source), position);\n\n    // Find hovering task\n    var draggingOverTasks = this.getTasksAtPosition(position);\n\n    // Remove class to all elements\n    drawing.find(\"item\").removeClass(\"dragging-arrow\");\n\n    // Add class to tasks where the cursor is hovering when dragging\n    draggingOverTasks.addClass(\"dragging-arrow\");\n  },\n\n  onElementDragging: function onElementDragging(ev, ui) {\n    // TO BE IMPLEMENTED MAYBE, THE IDEA IS TO PERFORM SCROLL AUTOMATICALLY\n  },\n\n  /************************************************************************\r\n      CONNECTORS CONFIGURATION SECTION\r\n      ************************************************************************/\n  redrawConnector: function redrawConnector(taskId) {\n    var that = this;\n    var task = this.model.getTaskById(taskId);\n    var drawing = this.drawing;\n    $.each(task.predecessors, function (i, predecessorId) {\n      if (predecessorId) {\n        that.connector.refresh(drawing, drawing.find(\"#\" + predecessorId), drawing.find(\"#\" + taskId));\n      }\n    });\n    $.each(task.successors, function (i, successorId) {\n      if (successorId) {\n        var task = that.drawing.find(\"#\" + successorId);\n        var classD = $(task).attr(\"class\");\n        if (classD.indexOf(\"bpm-StartEvent\") != 0) {\n          that.connector.refresh(drawing, drawing.find(\"#\" + taskId), drawing.find(\"#\" + successorId));\n        }\n      }\n    });\n  },\n\n  addConnectors: function addConnectors(viewModel) {\n    var that = this;\n    var displayName = \"\";\n    var labelConnectorPos = {};\n    $.each(viewModel.tasks, function (i, task) {\n      $.each(task.successors, function (j, successorId) {\n        for (var i = 0; i < task.connectors.length; i++) {\n          if (task.connectors[i].successor == successorId) {\n            displayName = task.connectors[i].displayName;\n            labelConnectorPos = {\n              \"x\": Math.round(task.connectors[i].displayNamePosition.x),\n              \"y\": Math.round(task.connectors[i].displayNamePosition.y) };\n\n          }\n        }\n        that.addConnector(task.id, successorId, displayName, labelConnectorPos);\n      });\n    });\n  },\n\n  addConnector: function addConnector(task1, task2, displayName, labelConnectorPos) {\n    var expression = this.model.getConnectionRule(task1, task2);\n    var task = this.drawing.find(\"#\" + task2);\n    var classD = $(task).attr(\"class\");\n    if (classD.indexOf(\"bpm-StartEvent\") != 0) {\n      this.connector.connect(this.drawing, this.drawing.find(\"#\" + task1), this.drawing.find(\"#\" + task2), expression, displayName, labelConnectorPos);\n    }\n  },\n\n  /************************************************************************\r\n      AURA CONFIGURATION SECTION\r\n      ************************************************************************/\n  showAura: function showAura(ev) {\n    var task = $(ev.currentTarget);\n    var auraShown = this.aura.showForTask(task);\n    this.model.setAura(task.id, auraShown);\n    this.previusElement = task;\n    var displayName = null;\n\n    if (task.attr(\"data-type\") === \"UserTask\") {\n      displayName = $(task[0].innerHTML).text().slice(0, -1);\n    } else {\n      displayName = $(task[0].innerHTML).text();\n    }\n\n    this.drawing.find(\"*\").removeClass(\"active\");\n    if (auraShown) {\n      // Remove active class from all items, and add it to this one\n      task.addClass(\"active\");\n    }\n    var data = {\n      task: task[0].id,\n      displayName: displayName,\n      type: task.attr(\"data-type\"),\n      option: 'selecTask' };\n\n    this.publish(\"drawing.selectedTask\", data);\n    // ev.stopImmediatePropagation();\n\n    if (this.reviewMode) {\n      $(task).parent().find('aura .wrapper-aura-options, aura .wrapper-options .bpm-option-change, aura .wrapper-options .bpm-option-delete').hide();\n    }\n\n  },\n  showAuraForArrow: function showAuraForArrow(ev) {\n    var arrow = $(ev.currentTarget);\n    this.previusElement = arrow;\n    var id = arrow.attr(\"id\");\n    var sourceTask = bizagi.bpmn.modeler.connector.getSourceTaskFromId(id);\n    var showRuleOption = this.model.successorConnectionsCanContainRule(sourceTask);\n    var auraShown = this.aura.showForArrow(arrow, showRuleOption);\n    this.drawing.find(\"*\").removeClass(\"active\");\n    if (auraShown) {\n      arrow.addClass(\"active\");\n    }\n    if (this.reviewMode) {\n      $(arrow).parent().find('.bpm-aura-for-arrow .wrapper-options').css('width', '27px');\n      $(arrow).parent().find('.bpm-aura-for-arrow .wrapper-options special-options .bpm-option-else, .bpm-aura-for-arrow .wrapper-options special-options .bpm-option-delete').hide();\n    }\n    if (this.reviewMode && $(arrow).hasClass('bpm-else')) {\n      $(arrow).parent().find('.bpm-aura-for-arrow .wrapper-options').hide();\n    }\n  },\n  /************************************************************************\r\n      HELPERS SECTION\r\n      ************************************************************************/\n  getTasksAtPosition: function getTasksAtPosition(position) {\n    return this.drawing.find(\"item\").\n    filter(function () {\n      var el = $(this);\n      var pos = el.position();\n      var coords = {\n        x: pos.left - 25,\n        y: pos.top - 25,\n        w: el.width() + 25,\n        h: el.height() + 25 };\n\n      return coords.x <= position.left && position.left <= coords.x + coords.w &&\n      coords.y <= position.top && position.top <= coords.y + coords.h;\n    });\n  },\n\n  showPopupEditor: function showPopupEditor(label, input, callback) {\n    var that = this;\n    var cancelAction = false;\n    // Create input\n    label.hide();\n    label.after(input);\n    input.focus();\n    input.select();\n\n    $(\"#bpm-drawing\").find(\".ui-droppable\").bind(\"keydown\", function (e) {\n      switch (e.which) {\n        case 27:\n          cancelAction = true;\n          closeEditor();\n          break;}\n\n    });\n\n    $(label).parent().find(\".input_name\").each(function (index, el) {\n      if (index === 1) {\n        $(el).remove();\n      }\n    });\n    $(label).parent().find(\".input_name\").focus();\n\n\n    var closeEditor = function closeEditor() {\n      if (cancelAction) {\n        callback(label.text());\n        label.show();\n        input.detach();\n        cancelAction = false;\n      } else {\n        var value = input.val();\n        callback(value);\n        label.show();\n        input.detach();\n      }\n      that.model.triggerModelChange(true);\n      that.isEditionActive = false;\n    };\n\n    // Change handler\n    input.keypress(function (ui) {\n      if (that.isEditionActive && ui.key == \"Enter\") {\n        closeEditor();\n      }\n\n    });\n\n    // Close up handler\n    input.click(function (e) {e.preventDefault();return false;});\n\n    $(\"#canvas\").one(\"click\", function () {\n      if (that.isEditionActive) {\n        closeEditor();\n      }\n    });\n  },\n\n  fixPosition: function fixPosition(position) {\n    // Fixes position to make it relative to drawing container\n    var relative = this.drawing.offset();\n    position.left -= relative.left;\n    position.top -= relative.top;\n    return position;\n  },\n  setNameTask: function setNameTask(text, obj) {\n    if (text.length > 20 || obj.height() > 34) {\n      return true;\n    }\n  } });","bizagi.bpmn.modeler.observable.extend(\"bizagi.bpmn.modeler.toolbar\", {\n\n  /* STATIC STUFF */\n  bpmShapes: {\n    \"StartEvent\": \"bpmn-icon-start-event-none\",\n    \"IntermediateEvent\": \"bpmn-icon-intermediate-event-none\",\n    \"EndEvent\": \"bpmn-icon-end-event-none\",\n    \"TerminateEvent\": \"bpmn-icon-end-event-terminate\",\n    \"ExclusiveGateway\": \"bpmn-icon-gateway-xor\",\n    \"ParallelGateway\": \"bpmn-icon-gateway-parallel\",\n    \"InclusiveGateway\": \"bpmn-icon-gateway-or\",\n    \"ComplexGateway\": \"bpmn-icon-gateway-complex\",\n    \"UserTask\": \"bpmn-icon-task\",\n    \"EmailTask\": \"ico_mail bpmn-icon-intermediate-event-throw-escalation\" },\n\n  toolBarTitlesOld: {\n    \"StartEvent\": \"Start Event\",\n    \"IntermediateEvent\": \"Intermediate Event\",\n    \"EndEvent\": \"End Event\",\n    \"ExclusiveGateway\": \"Exclusive Gateway\",\n    \"UserTask\": \"Task\",\n    \"TerminateEvent\": \"Terminate Event\",\n    \"ParallelGateway\": \"Parallel Gateway\",\n    \"assignee\": \"Settings\",\n    \"form\": \"Form Designer\",\n    \"EmailTask\": \"Email Task\",\n    \"notify\": \"Email Settings\",\n    \"changeType\": \"Change type\",\n    \"deleteShape\": \"Delete\",\n    \"flowSecuence\": \"Sequence Flow\",\n    \"deleteConfirmationMessage\": \"Do you want to DELETE this element? By doing so you will delete all the configurations associated to it.\",\n    \"confirmDeleteShape\": \"Yes\",\n    \"cancelDeleteShape\": \"No\",\n    \"addExpression\": \"Define expressions\",\n    \"elseExpression\": \"Else\" },\n\n  toolBarTitles: {\n    \"StartEvent\": \"workportal-process-modeler-startEvent\",\n    \"IntermediateEvent\": \"workportal-process-modeler-intermediateEvent\",\n    \"EndEvent\": \"workportal-process-modeler-endEvent\",\n    \"ExclusiveGateway\": \"workportal-process-modeler-exclusiveGateway\",\n    \"UserTask\": \"workportal-process-modeler-userTask\",\n    \"TerminateEvent\": \"workportal-process-modeler-terminateEvent\",\n    \"ParallelGateway\": \"workportal-process-modeler-parallelGateway\",\n    \"assignee\": \"workportal-process-modeler-settings\",\n    \"form\": \"workportal-process-modeler-formDesigner\",\n    \"EmailTask\": \"workportal-process-modeler-emailTask\",\n    \"notify\": \"workportal-process-modeler-emailSettings\",\n    \"changeType\": \"workportal-process-modeler-changeType\",\n    \"deleteShape\": \"workportal-process-modeler-deleteShape\",\n    \"flowSecuence\": \"workportal-process-modeler-flowSecuence\",\n    \"deleteConfirmationMessage\": \"workportal-process-modeler-deleteConfirmationMessage\",\n    \"confirmDeleteShape\": \"workportal-process-modeler-confirm-delete\",\n    \"cancelDeleteShape\": \"workportal-process-modeler-cancel-delete\",\n    \"addExpression\": \"workportal-process-modeler-rules-addExpression\",\n    \"elseExpression\": \"workportal-process-modeler-rules-elseExpression\" },\n\n  getClassForType: function getClassForType(type) {\n    return this.bpmShapes[type];\n  },\n  getTitleForType: function getTitleForType(type) {\n    return this.toolBarTitles[type];\n  },\n  getOldLocalization: function getOldLocalization(type) {\n    return this.toolBarTitlesOld[type];\n  } },\n\n{\n\n  /* INSTANCE STUFF */\n\n  /* Constructor */\n  init: function init() {\n    // Define converter for task type class\n    var that = this;\n    $.views.converters(\"tasktype_class\", function (val) {\n      return bizagi.bpmn.modeler.toolbar.getClassForType(val);\n    });\n\n    $.views.converters(\"title\", function (val) {\n      var result = '';\n      var key = '';\n      if (bizagi.bpmn.modeler.viewer.featureLocalization) {\n        key = bizagi.bpmn.modeler.toolbar.getTitleForType(val);\n        result = bizagi.bpmn.modeler.viewer.getKeyLocalization(key);\n      } else {\n        result = bizagi.bpmn.modeler.toolbar.getOldLocalization(val);\n      }\n      return result;\n    });\n\n    $.templates({\n      bpm_modeler_toolbar: '<toolbar> {{for items tmpl=\"bpm_modeler_toolbarItem\"/}}</toolbar>',\n      bpm_modeler_toolbarItem: '<item class=\"tooltip bpm-{{:#data}} {{tasktype_class: #data}}  bpm-cloneable\" data-type=\"{{:#data}}\">{{if #data==\"IntermediateEvent\"}}<svg id=\"Layer_1\" data-name=\"Layer 1\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><defs><style>.cls-11{fill:#fff;}.cls-22{fill:#9ca613;}</style></defs><title>event 2</title><circle class=\"cls-11\" cx=\"12\" cy=\"12\" r=\"12\"/><path class=\"cls-22\" d=\"M12,1.12A10.88,10.88,0,1,1,1.12,12,10.89,10.89,0,0,1,12,1.12M12,0A12,12,0,1,0,24,12,12,12,0,0,0,12,0Z\"/><path class=\"cls-22\" d=\"M12,3.79A8.21,8.21,0,1,1,3.79,12,8.22,8.22,0,0,1,12,3.79m0-1.12A9.33,9.33,0,1,0,21.33,12,9.33,9.33,0,0,0,12,2.67Z\"/></svg>{{/if}}<span class=\"tooltiptext tooltip-right\"><p>{{title: #data}}</p></span></item>' });\n\n    // Define items\n    this.items = [\n    \"StartEvent\",\n    \"UserTask\",\n    \"ExclusiveGateway\",\n    \"IntermediateEvent\",\n    \"EndEvent\"];\n\n  },\n\n  render: function render(canvas) {\n    var that = this;\n    this.canvas = canvas;\n\n    // Render template\n    var html = $.templates.bpm_modeler_toolbar.render({ items: this.items });\n    this.canvas.append(html);\n\n    // Make items draggable\n    canvas.find(\"item\").draggable({\n      helper: \"clone\",\n      containment: \"#bpm-drawing\",\n      grid: [20, 20],\n      drag: $.proxy(this.onItemDragging, this) });\n\n  },\n\n  onItemDragging: function onItemDragging(event, ui) {\n    this.publish(\"item.dragging\", ui);\n  } });","bizagi.bpmn.modeler.observable.extend(\"bizagi.bpmn.modeler.viewer\", {\n  // Static Values\n  featureLocalization: false,\n  // Static Functions\n  getInstaceLocalizationService: function getInstaceLocalizationService() {\n    if (window.parent && window.parent.bizagi.localization) {\n      return window.parent.bizagi.localization;\n    } else {\n      return window.bizagi.localization;\n    }\n  },\n  getKeyLocalization: function getKeyLocalization(key) {\n    var localizator = this.getInstaceLocalizationService();\n    var result = localizator.getResource(key);\n    return result;\n  } },\n{\n\n  /* Constructor */\n  init: function init(params) {\n    $.templates({\n      bpm_modeler_viewer_container: '<bpm-modeler> \\\r\n                            <div id=\"bpm-toolbar\"></div> \\\r\n                            <div id=\"bpm-drawing\"></div> \\\r\n                            <move-helper> \\\r\n                                <move-top class=\"bpm-move\"></move-top> \\\r\n                                <move-left class=\"bpm-move\"></move-left> \\\r\n                                <move-bottom class=\"bpm-move\"></move-bottom> \\\r\n                                <move-right class=\"bpm-move\"></move-right> \\\r\n                            </move-helper> \\\r\n                        </bpm-modeler>' });\n\n\n    // Create  model\n    this.model = new bizagi.bpmn.modeler.model();\n    this.model.subscribe(\"model.change\", $.proxy(this.changed, this));\n    this.model.subscribe(\"shape.change\", $.proxy(this.triggerChangeShape, this));\n    if (params && params.model) this.model.setModel(params.model);\n\n    // Declare dependencies\n    this.drawing = new bizagi.bpmn.modeler.drawing(this.model);\n    this.drawing.subscribe(\"drawing.externaloption\", $.proxy(this.manageExternalOption, this));\n    this.drawing.subscribe(\"drawing.selectedTask\", $.proxy(this.selectedTask, this));\n    this.drawing.subscribe(\"drawing.canvasEvent\", $.proxy(this.canvasEvent, this));\n    this.drawing.subscribe(\"load.finish\", $.proxy(this.triggerLoadFinish, this));\n    this.drawing.subscribe(\"drawing.clickOnTask\", $.proxy(this.clickOnTask, this));\n    this.toolbar = new bizagi.bpmn.modeler.toolbar();\n    this.toolbar.subscribe(\"item.dragging\", $.proxy(this.onToolbarItemDragging, this));\n    this.readOnly = false;\n    if (params === false || !params) {\n      this.readOnly = false;\n    } else {\n      this.readOnly = true;\n    }\n  },\n\n  render: function render(canvas, diagram) {\n    var self = this;\n\n    self.canvas = canvas;\n\n    // Render container\n    var container = $.templates.bpm_modeler_viewer_container.render();\n    self.canvas.html(container);\n\n    $.when(self.checkCSSLoaded()).then(function () {\n      // Render dependencies\n      self.renderToolbar();\n      self.renderDrawing(self.readOnly);\n\n      if (diagram) self.load(diagram);\n      if (self.readOnly) {\n        $(\"#bpm-toolbar\").css({ \"display\": \"none\" });\n        $(\"#bpm-drawing\").addClass(\"bpm-modeler-readOnly\");\n        $(\"#bpm-drawing\").bind(\"over\");\n      }\n      // Assign move handlers\n      self.canvas.on(\"click\", \".bpm-move\", $.proxy(self.moveCanvas, self));\n    });\n  },\n\n  checkCSSLoaded: function checkCSSLoaded() {\n    var self = this;\n    var defer = $.Deferred();\n    if (self.cssAppliedOnDrawing()) {\n      defer.resolve();\n    } else\n    {\n      var MAX_COUNTER_CHECK_CSS = 10;\n      var counterCheckCSS = 0;\n      var validateCSSLoaded = setInterval(function () {\n        counterCheckCSS++;\n        if (self.cssAppliedOnDrawing() > 0 || MAX_COUNTER_CHECK_CSS <= counterCheckCSS) {\n          defer.resolve();\n          clearInterval(validateCSSLoaded);\n        }\n      }, 1000);\n    }\n\n    return defer.promise();\n  },\n\n  cssAppliedOnDrawing: function cssAppliedOnDrawing() {\n    return $(\"bpm-modeler #bpm-drawing\").height() > 0;\n  },\n\n  reviewMode: function reviewMode(activeModeReview) {\n    if (activeModeReview) this.drawing.activeReviewMode();\n  },\n\n  localizationModeler: function localizationModeler(activelocalizationModeler) {\n    bizagi.bpmn.modeler.viewer.featureLocalization = activelocalizationModeler;\n  },\n  renderToolbar: function renderToolbar() {\n    var toolbarCanvas = this.canvas.find(\"#bpm-toolbar\");\n    this.toolbar.render(toolbarCanvas);\n  },\n\n  renderDrawing: function renderDrawing(state) {\n    var drawingCanvas = this.canvas.find(\"#bpm-drawing\");\n    this.drawing.render(drawingCanvas, state);\n  },\n\n  moveCanvas: function moveCanvas(ev, ui) {\n    this.drawing.moveCanvas(ev, ui);\n  },\n\n  onToolbarItemDragging: function onToolbarItemDragging(event, ui) {\n    this.drawing.onElementDragging(event, ui);\n  },\n\n  manageExternalOption: function manageExternalOption(ev, params) {\n    this.publish(\"bpm.modeler.externalOption\", params);\n  },\n  selectedTask: function selectedTask(ev, params) {\n    this.publish(\"bpm.modeler.selectedTask\", params);\n  },\n  canvasEvent: function canvasEvent(ev, params) {\n    this.publish(\"bpm.modeler.canvasEvent\", params);\n  },\n  triggerLoadFinish: function triggerLoadFinish() {\n    this.publish(\"bpm.modeler.loadFinish\");\n  },\n  clickOnTask: function clickOnTask(ev, params) {\n    this.publish(\"bpm.modeler.clickOnTask\", params);\n  },\n  setConnectionExpression: function setConnectionExpression(source, target) {\n    this.drawing.setExpressionForArrow(source, target);\n  },\n\n  save: function save() {\n    return this.model.getPersistenceModel();\n  },\n\n  load: function load(json) {\n    this.model.setModel(json);\n  },\n\n  changed: function changed(params) {\n    this.publish(\"bpm.modeler.changed\");\n  },\n  triggerChangeShape: function triggerChangeShape() {\n    this.publish(\"bpm.modeler.changeShape\");\n  },\n  setExtendedProperty: function setExtendedProperty(taskId, property, value) {\n    this.model.setExtendedProperty(taskId, property, value);\n  },\n\n  getExtendedProperty: function getExtendedProperty(taskId, property) {\n    return this.model.getExtendedProperty(taskId, property);\n  } });\n\n\n// Utility functions -> Move to bizagi.js\nif (!Array.prototype.removeOne) {\n  Array.prototype.removeOne = function (item) {\n    for (var i = this.length; i--;) {\n      if (this[i] === item) {\n        this.splice(i, 1);\n        return;\n      }\n    }\n  };\n}\nif (!Array.prototype.removeAll) {\n  Array.prototype.removeAll = function (item) {\n    for (var i = this.length; i--;) {\n      if (this[i] === item) {\n        this.splice(i, 1);\n      }\n    }\n  };\n}"]}