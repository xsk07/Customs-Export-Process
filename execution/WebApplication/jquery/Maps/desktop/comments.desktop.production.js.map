{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu/bizagi.workportal.desktop.widgets.project.dashboard.menu.js","jquery/workportal/desktop/widget/project.dashboard.menu.activity/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.discussions/bizagi.workportal.desktop.widgets.project.discussions.js","jquery/workportal/desktop/widget/project.discussion.sidebar/bizagi.workportal.desktop.widgets.project.discussion.sidebar.js","jquery/workportal/desktop/widget/project.caseState/bizagi.workportal.desktop.widgets.project.caseState.js","jquery/workportal/desktop/widget/project.activityState/bizagi.workportal.desktop.widgets.project.activityState.js","jquery/workportal/desktop/widget/project.processState/bizagi.workportal.desktop.widgets.project.processState.js","jquery/workportal/desktop/widget/project.users/bizagi.workportal.desktop.widgets.project.users.js","jquery/workportal/desktop/widget/project.subprocesses.data/bizagi.workportal.desktop.widgets.project.subprocesses.data.js","jquery/workportal/desktop/widget/project.events/bizagi.workportal.desktop.widgets.project.events.js","jquery/workportal/desktop/widget/project.subprocesses/bizagi.workportal.desktop.widgets.project.subprocesses.js","jquery/workportal/desktop/widget/project.activity.description/bizagi.workportal.project.activity.description.js"],"names":["bizagi","workportal","widgets","widget","extend","onDiscussionsMenuStatusChange","ev","params","this","updateDiscussionsIcons","hasDiscussionsOrComment","sub","$","proxy","toggle","clean","unsub","injector","register","project","dashboard","menu","init","workportalFacade","dataService","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","postRender","self","contextsLeftSidebarCaseDashboard","forEach","context","updateView","event","args","plan","idActivitySelected","undefined","$content","getContent","empty","type","showContextByMenuDashboard","argsTemplate","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isAdhocProcess","util","isEnableFeature","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","render","appendTo","toUpperCase","addClass","siblings","removeClass","handlerEvents","loadContentById","preventDefault","$item","target","closest","hasClass","data","getLevelNavigator","pub","currentLevelNavigator","parseInt","nameItemNavigator","newLevelNavigator","localization","getResource","refreshLastItemBreadcrumb","histName","level","subMenuHandler","$comments","$files","$timeline","on","options","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","idCase","idTask","idWorkflow","idWorkItem","idWorkitem","referrer","publish","off","activity","project-content-dashboard","template","setTimeout","window","trigger","ui","kendo","Widget","ProjectAttachments","element","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","name","wrapper","multiple","dropZone","maxFilesSize","currentUser","uploadMaxFileSize","enabled","that","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","select","_filterMaxFilesSize","complete","interval","setInterval","find","length","_showNotificationCompleteUpload","clearInterval","progress","_onProgressFile","success","push","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","title","notifierTitle","animation","open","duration","close","visible","resizable","draggable","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","replace","_getSize","cancel","retry","Math","round","$file","_getFileItemByUID","uid","percent","percentComplete","css","width","text","hide","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$target","$fileWrapper","$uploadWrapper","guid","remove","_onRemoveFile","_onRetryFile","file","grep","i","validation","_isValidFile","message","setStatus","valid","size","inArray","extension","total","_notifySizeExceeded","show","_switchEvents","currentTarget","cancelFilesUpload","destroy","status","prop","errorUploadiis","plugin","jQuery","base","notifier","typeResource","plugins","dialogBoxDiscussion","attchComments","attchDiscussions","addition","listDataDiscussion","userPictures","commentsList","globalTags","tempTagsBeforeDelete","tempTagsToDelete","keySentenceAddTag","project-discussions","project-discussions-popup","project-discussions-list","project-discussions-comments","project-discussions-attachments","project-attachments","templateHomeDiscussions","$contentWidget","popupDiscussion","initPluginPopupDiscussion","form","buttonShowFormNewDiscussion","subject","description","buttonShowPopupDiscussionToAdd","buttonAddDiscussion","buttonCancel","formDiscussion","attachments","edition","tagsFilter","initPluginTagsFilter","tagsMultiSelect","initPluginTagsMultiSelect","getDiscussions","eventsHandler","restrictedEventsHandler","getDataDiscussions","done","idUsersCreatedDiscussions","map","user","idUsersCreatedComments","property","comments","csvGuidUsers","a","seen","out","len","j","item","removeDuplicateItemsFromArray","idUser","join","getDataUsers","then","renderUserProfilesAndImages","setClassesTagsByDiscussion","onNotifyOpenPopup","showFormAddDiscussion","renderUserProfile","templatePopupDiscussion","formContent","newitemtext","categoriesMultiSelect","isDelete","createNewTag","kendoMultiSelect","change","valuesSelected","value","slice","dataitems","dataSource","tag","indexOf","filter","Boolean","pos","newtag","dataItemAddNew","at","refresh","list","itemData","add","dataBound","_prev","isfound","insert","createEmptyTag","search","dataTextField","dataValueField","hideOrShowDiscussionsByFilter","autoClose","tagMode","valueClass","validateAddCommentForm","$wrapperForm","result","$textAreaComment","val","trim","commentValidation","parent","next","html","validateAddDiscussionForm","$subjectDiscussion","$descriptionDiscussion","subjectValidation","descriptionValidation","applyFileAttachments","kendoProjectAttachments","serviceLocator","getUrl","onSuccessFile","addFileData","supportFileExt","uploadMaxFilesSize","defer","Deferred","paramsGetDiscussions","globalParent","radNumber","flowContext","id","getDiscussionsData","pipe","response","callForListComments","sortDiscussions","updateTemplateListDiscussion","resolve","promise","usersGuids","height","getUsersData","always","array","splice","arrayUnique","discussions","generalDefer","commentsDefer","addGlobalTags","tags","idParent","dateTime","getDateServer","count","when","getCommentsData","apply","sortedDiscussion","sort","b","dateA","date","positionDiscussion","iDis","arr","old_index","new_index","k","array_move","resetDiscussionAttachments","sendDataUpdateDiscussion","filesObj","prepareFilesToSave","tagsDiscussion","getTagsDiscussionBySave","guidsTagsDiscussionToDelete","getGuidsTagsDiscussionToDelete","toString","general","attachmentsToCreate","attachmentsToDelete","editDiscussion","discussion","getDiscussionDataByGUID","onClosePopupDiscussion","removeGlobalTags","showSucessMessage","printf","showErrorMessage","validateStringIsGuid","test","sendDataInsertDiscussion","postDiscussion","newDiscussion","updateDiscussionsMenu","tagsTextSelected","dataSourceTags","tagTextSelected","tagFound","isGuidTextSelected","tagSource","isGuid","differenceArrays","guidsTagsCurrentDiscussion","setStateUIShowMoreComments","$commentsContainer","state","$containerButtonMoreComments","$buttonShowMoreComments","$messageNoMoreComments","$messageLoadingComments","getCurrentUserInfo","userName","picture","createTagsOnServer","iTagAdd","tagGlobal","postTag","guidTagsToDelete","allGuidsMoreGuidsDelete","itemTag","secureGuidsForDelete","guidDelete","guidSecureDelete","idTag","deleteTag","iTagGlobal","iDiscussion","tagsBySpace","templateListDiscussions","contentRenderListDiscussions","listDataDiscussions","isOpen","parseBoolean","isClosedForAllUsers","returnServedCommentByParentId","parentId","mapTempComments","append","resourceTitlePopup","dialog","modal","zIndex","maximize","onOpenPopupDiscussion","resetFormDiscussion","userPicture","$parent","$img","$text","attr","getInitials","iUser","switchCommentsEvents","is","onShowButtonsPanel","onCancelComment","$container","onCreateComment","onViewComment","onViewMoreComments","onRemoveFiles","onEditDiscussion","showConfirmationBox","onDeleteComment","onDownloadAttachment","stopPropagation","setDiscussionsDataByGUID","guidTagsDiscussion","renderAttachments","$commentWrapper","toggleClass","getMoreComments","getCommentsCountByParent","dateLastComment","responseMoreComments","Array","prototype","renderCommentByDiscussion","idUsersLoaded","idUsersNewComments","csvIdUsersMissingLoad","not","get","fail","guidParent","moreComments","$commentsDOM","tmplComment","renderObject","getCommentByGuid","parentGuid","commentGuid","x","lengthx","index","currentFiles","removeFiles","tmpSplice","fileGuid","comment","deleteComment","keys","Object","haveDiscussions","haveComments","XMLHttpRequest","JSON","parse","$wrapper","sender","$liTarget","guidAttachment","nameFile","getDownloadAttachment","$commentContainer","$buttonsWrp","$textarea","$uploadForm","$vlTooltip","$fileList","reset","$rplWrp","$addCommentContainer","$uploadList","postComment","newComment","unshift","isIE","fileList","onClickCancel","detach","focus","onSubmitFormDiscussion","resetWidget","hasOwnProperty","$source","$textareaSource","$textareaTarget","$uploadListSource","first","$uploadListTarget","supportNav","project-discussion-sidebar","onShowPopupDiscussion","sidebar","contextsSidebarActivity","datePickerRegional","project-caseState","project-caseState-remaining","project-cancel-case-button","isFavoriteCase","isFavorite","showCaseNumber","creationDate","timeZoneName","creationDateObject","getDateWithTimezone","creationDateFormat","getFormattedDate","solutionDateObject","solutionDate","solutionDateFormat","currentDate","calculateDataForTemplate","showGraphicQuery","idCaseForGraphicQuery","idWorkFlow","isAdhoc","idProcess","idAdhocProcess","showHelpUrl","helpUrl","paramsEffectiveDuration","fromDate","getTime","toDate","differenceCreationToCurrent","actualDate","relativeTime","dateFormatter","getRelativeTime","Date","relativeTimeState","colorStateCase","percentCompleteBar","showCancelCase","_showCancelCase","contentTemplate","buttonCancelCase","click","widgetParameters","widgetName","BIZAGI_WORKPORTAL_WIDGET_CANCEL_CASE","dialogClass","modalParameters","refreshInbox","closeVisible","validateUrlWellFormed","security","menuSecurity","urlHelp","isEmpty","_startShowCancelCase","onClickFavorite","goToCase","showBackNextNavigation","_navigatorWidget","_start","bind","getShowCancelCase","dateObj","monthsNames","monthNames","shortMonth","getMonth","bizagiLanguage","BIZAGI_LANGUAGE","substring","datepicker","formatDate","favoriteOptions","idObject","favoriteType","addFavorite","favoritesData","guidFavorite","idFavorites","delFavorite","callGetEffectiveDuration","d","getEffectiveDuration","cntxtSidebarActivity","getBackCase","getNextCase","getListKey","lstIdCases","key","nextCase","backCase","caseState","project-activityState-wrapper","currentState","currentWorkitem","objectWorkItem","activityName","activityIsEvent","isEvent","initDateObject","entryDateWorkItem","initDateFormat","estimatedSolutionDateObject","estimatedSolutionDate","estimatedSolutionDateFormat","updateTemplateWidget","initilizeActionMenu","allowsReassign","btReassing","btShareActivity","onClickMenuReasign","onClickShareActivity","onCloseSaveDialogBox","loader","startAndThen","BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE","closeDialogWidget","button","getShareActivity","unbind","diffMillisecondsCurrentToEstimated","diffMillisecondsCreationToSolution","paramsEffectiveDurationOpened","currentDateExceededEstimatedDate","paramsEffectiveDurationInitialToEstimated","differenceCreatedToCurrent","differenceCurrentToEstimated","differenceInitialToEstimated","colorState","showEstimatedSolutionDate","percentBar","getPercentBar","canShareActivity","isShared","totalMinutes","sectionMinutes","override","enableShareActivity","shareActivityTooltip","activityButton","texto","tooltip","tooltipClass","my","of","collision","activityState","project-process-state","displayName","onClickGoToParentCase","routingExecute","processState","relatedusers","users","loadedUsers","project-users","onRenderFinish","showCreatorInformation","typesAssignUser","createdBy","userId","typeName","userIds","userInfo","usersAdapter","createJsonUserInfo","username","email","userinformation","responseSubprocessState","responseSubprocess","newValue","auxArrayListSubprocessesState","auxArrayListSubprocesses","newItem","isArray","Class","project-subprocesses-tootip-custom-properties","initializeTooltip","selectorTooltip","indexSubprocess","idCustData","itemsFinded","getContentTooltip","originalEvent","$id","hover","stop","fadeTo","textLI","templateTooltip","rowCustomProperty","nameProperty","valueProperty","arrayCustomsProperties","auxValueProperty","subprocessData","getSubprocessData","custData","custDataTypes","custFields","formatMonetaryCell","formatBoolean","formatDecimalCell","objectTemplate","nameSubprocess","contentTableCustomProperties","subProcessData","subProcess","subProcesses","subProcPersonalized","customFields","CustFields","subprocesses","project-events","getArgsTemplate","responseArgsTemplate","onClickGoEvent","def","callSummaryCaseEvents","responseEvents","elementEvent","autoSave","summaryCaseEvents","events","project-subprocesses","summarySubProcess","organizeDataForSubprocesses","showSubProcess","each","tempSubprocesses","renderWidget","onClickGoSubprocess","pluginTooltip","project-activity-description","getWorkitemDescription","callTaskDescription","taskDescriptionParams","container","taskDescriptionWidget","task","tskDescription"],"mappings":"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","sourcesContent":["/**\r\n * Name: BizAgi Desktop Widget Dashboard menu (left sidebar) * \r\n * @author Valeria Vanegas\r\n */\n\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu\", {}, {\n\n  /**\r\n                                                                                                   * Handler when discussions menu status change\r\n                                                                                                   * @param {*} ev \r\n                                                                                                   * @param {*} params \r\n                                                                                                   */\n  onDiscussionsMenuStatusChange: function onDiscussionsMenuStatusChange(ev, params) {\n    var self = this;\n    self.updateDiscussionsIcons(params.hasDiscussionsOrComment);\n  },\n\n  /**\r\n      * Update discussions icon on sidebar menu\r\n      * The icon is different when there is other discussion or there are comments\r\n      * @param {*} hasDiscussionsOrComment \r\n      */\n  updateDiscussionsIcons: function updateDiscussionsIcons(hasDiscussionsOrComment) {\n    var self = this;\n\n    self.sub(\"UPDATE_DISCUSSIONS_MENU_STATUS\", $.proxy(self.onDiscussionsMenuStatusChange, self));\n\n    $(\".bz-icon-discussion-comment\").toggle(hasDiscussionsOrComment);\n    $(\".bz-icon-discussion-no-comment\").toggle(!hasDiscussionsOrComment);\n    self.params.hasDiscussionsOrComment = hasDiscussionsOrComment;\n  },\n\n  /**\r\n      * Detach events\r\n      */\n  clean: function clean() {\n    var self = this;\n    self.unsub(\"UPDATE_DISCUSSIONS_MENU_STATUS\", $.proxy(self.onDiscussionsMenuStatusChange, self));\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu], true);","/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.dashboard.menu.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", {}, {\n\n  /**\r\n                                                                                                                            *   Constructor\r\n                                                                                                                            */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n    self.params = params || {};\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity\").concat(\"#project-dashboard-menu1\") });\n\n  },\n\n  /**\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  /**\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    self._super();\n    //Handlers\n    self.params.contextsLeftSidebarCaseDashboard.forEach(function (context) {\n      self.sub(context, $.proxy(self.updateView, self));\n    });\n  },\n\n  /**\r\n      * Update view\r\n      * @param event\r\n      * @param params\r\n      */\n  updateView: function updateView(event, params) {\n    var self = this;\n    self.params = $.extend(self.params, params.args);\n    self.params.plan.idActivitySelected = undefined;\n    self.clean();\n    var $content = self.getContent().empty();\n\n    if (typeof event.type !== \"undefined\") {\n      self.params.showContextByMenuDashboard = event.type;\n    }\n\n    var argsTemplate = {\n      showFormOverview: self.params.menuDashboard.showFormOverview,\n      showFormActivity: self.params.menuDashboard.showFormActivity,\n      showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\n      showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\n      showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu && (\n      !self.params.isAdhocProcess ||\n      self.params.isAdhocProcess && bizagi.util.isEnableFeature(\"enableTimelineOnLiveProcesses\")),\n      showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\n      contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\n      contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu };\n\n\n    //Update widget\n    var template = self.getTemplate(\"project-dashboard-menu\");\n    template.render(argsTemplate).appendTo($content);\n\n\n    if (self.params.showContextByMenuDashboard) {\n      $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\n    }\n\n    self.updateDiscussionsIcons(self.params.hasDiscussionsOrComment);\n    self.handlerEvents();\n  },\n\n  /**\r\n      *   Load Content By Id\r\n      */\n  loadContentById: function loadContentById(event) {\n    var self = this;\n    event.preventDefault();\n    var $item = $(event.target).closest(\"li\");\n\n    if (!$item.hasClass(\"active\")) {\n\n      var showContextByMenuDashboard = $item.data(\"context\");\n\n      if (showContextByMenuDashboard) {\n        var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\n        var currentLevelNavigator = parseInt(getLevelNavigator[0], 10);\n        var nameItemNavigator = \"\";\n        var newLevelNavigator = currentLevelNavigator;\n\n        if (showContextByMenuDashboard == \"PLANACTIVITIES\") {\n          newLevelNavigator = currentLevelNavigator + 1;\n          nameItemNavigator = bizagi.localization.getResource(\"workportal-project-casedashboard-plan\");\n        }\n\n        self.params.refreshLastItemBreadcrumb = false;\n        self.pub(\"notify\", {\n          type: showContextByMenuDashboard.toUpperCase(),\n          args: $.extend(self.params, { showContextByMenuDashboard: showContextByMenuDashboard,\n            histName: nameItemNavigator,\n            level: newLevelNavigator }) });\n\n        $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\n      }\n    }\n  },\n\n  subMenuHandler: function subMenuHandler() {\n    var self = this;\n    var content = self.getContent();\n    var $comments = $(\"[data-context='COMMENTS']\", content);\n    var $files = $(\"[data-context='FILES']\", content);\n    var $timeline = $(\"[data-context='TIMELINE']\", content);\n\n    $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\n      $comments.toggle();\n      $files.toggle();\n      $timeline.toggle();\n    });\n  },\n\n  /**\r\n      * Handler events\r\n      */\n  handlerEvents: function handlerEvents() {\n    var self = this;\n    var content = self.getContent();\n\n    self.subMenuHandler();\n\n    $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\", $.proxy(self.loadContentById, self));\n\n    // Bind for click event on refresh botton\n    $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).on(\"click\", function () {\n      var options = {\n        action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\n        idCase: self.params.idCase,\n        idTask: self.params.idTask,\n        idWorkflow: self.params.idWorkflow,\n        idWorkItem: self.params.idWorkitem,\n        referrer: self.params.referrer || \"inboxGrid\" };\n\n      self.publish(\"executeAction\", options);\n    });\n  },\n\n  /**\r\n      * Clean widgets and events\r\n      */\n  clean: function clean() {\n    var self = this;\n    var content = self.getContent();\n\n    self._super();\n\n    if (self.params && self.params.contextsLeftSidebarCaseDashboard) {\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function (context) {\n        self.unsub(context, $.proxy(self.updateView, self));\n      });\n    }\n\n    $(\".ui-bizagi-wp-project-tab-links a\", content).off();\n    $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).off();\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\n\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\") });\n\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-content-dashboard\");\n    self.content = template.render({});\n\n    return self.content;\n  },\n  postRender: function postRender() {\n    var self = this;\n\n    setTimeout(function () {\n      $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\n    }, 1000);\n\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\n\n(function ($) {\n\n  // shorten references to variables. this is better for uglification \n  var kendo = window.kendo,\n  ui = kendo.ui,\n  Widget = ui.Widget;\n\n  var ProjectAttachments = Widget.extend({\n\n    init: function init(element, options) {\n\n      var that = this;\n\n      // base call to initialize widget\n      Widget.fn.init.call(that, element, options);\n\n      that._maxFilesSize = options.maxSize;\n      that._fileList = [];\n      that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\n      that._supportFileExt = options.extensions;\n      that._uploadMaxFilesSize = options.maxSize;\n      that.upload = that._initUpload();\n      that.loadNotifier = that._initLoadNotifier();\n      that.notification = that._initNotification();\n\n      that._eventsHandler();\n\n      that._initLocalization(that.options.localization);\n    },\n\n    options: {\n      name: \"ProjectAttachments\",\n      wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\n      multiple: true,\n      dropZone: true,\n      maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\n      enabled: true,\n      localization: {} },\n\n\n    _initUpload: function _initUpload() {\n\n      var that = this,\n      options = that.options,\n      localization = options.localization || {},\n      auxNumberFilesSuccess = 0;\n\n      that._initLocalization(localization);\n\n      return this.element.kendoUpload({\n        async: {\n          saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\n          autoUpload: true },\n\n        select: function select(event) {\n          that._filterMaxFilesSize(event);\n          auxNumberFilesSuccess = 0;\n        },\n        complete: function complete() {\n          var interval = setInterval(function () {\n            if (that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0) {\n              that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\n              clearInterval(interval);\n            }\n          }, 300);\n        },\n        upload: options.upload,\n        progress: function progress(event) {\n          that._onProgressFile(event);\n        },\n        success: function success(event) {\n          that._fileList.push(event.files[0]);\n          auxNumberFilesSuccess += 1;\n          options.success(event);\n        },\n        error: function error(event) {\n          that.onErrorFile(event);\n        },\n        localization: {\n          select: localization.selectFiles,\n          dropFilesHere: localization.dropFilesHere },\n\n        multiple: options.multiple,\n        enabled: options.enabled,\n        dropZone: options.dropZone,\n        showFileList: false }).\n      data(\"kendoUpload\");\n\n    },\n\n    _initNotification: function _initNotification() {\n      return $(\"<div></div>\").kendoNotification({\n        position: {\n          pinned: true } }).\n\n      data(\"kendoNotification\");\n    },\n\n    _initLoadNotifier: function _initLoadNotifier() {\n\n      var that = this,\n      localization = that.options.localization,\n      $wrapper = that.options.wrapper;\n\n      return $wrapper.kendoWindow({\n        title: localization.notifierTitle,\n        actions: [\"Close\"],\n        animation: {\n          open: {\n            duration: 100 },\n\n          close: {\n            duration: 100 } },\n\n\n        open: function open() {\n          this.wrapper.addClass(\"project-attachments-wrapper-window\");\n        },\n        visible: false,\n        resizable: false,\n        draggable: false,\n        maxHeight: \"300px\",\n        minWidth: \"430px\" }).\n      data(\"kendoWindow\");\n\n    },\n\n    _initLocalization: function _initLocalization(objectOptionsLocalization) {\n      var that = this;\n      var optionsLocalizationByDefault = {\n        selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\n        notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\n        errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error\"),\n        errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\n        errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\n        errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", that._getSize(that._maxFilesSize)),\n        dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\n        cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\n        retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\n        close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\") };\n\n\n      $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\n    },\n\n    /**\r\n        * return maxSize in MB\r\n        * @param {*} maxSize \r\n        */\n    _getSize: function _getSize(maxSize) {\n      return Math.round(maxSize / (1024 * 1024), -1);\n    },\n\n    _onProgressFile: function _onProgressFile(event) {\n\n      var that = this;\n      var $file = that._getFileItemByUID(event.files[0].uid);\n      var percent = event.percentComplete;\n\n      $(\".k-progress\", $file).css({\n        width: percent + \"%\" });\n\n\n      $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\n\n      if (percent === 100) {$(\".k-upload-action .k-icon\", $file).hide();}\n    },\n\n    _onShowUploadNotifier: function _onShowUploadNotifier(event) {\n\n      var that = this,\n      files = event.files,\n      template = that.options.template;\n\n      that.loadNotifier.content(template.render({ files: files }));\n      that.loadNotifier.wrapper.css({\n        top: \"auto\",\n        left: \"auto\",\n        bottom: \"1em\",\n        right: \"1em\" });\n\n\n      that.loadNotifier.open();\n    },\n\n    _showNotificationCompleteUpload: function _showNotificationCompleteUpload(wrapperMessage, auxNumberFilesSuccess) {\n      var that = this;\n      if (wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\n      {\n        that._autoHideMessage(wrapperMessage);\n      }\n    },\n\n    _autoHideMessage: function _autoHideMessage(wrapperMessage) {\n      var that = this;\n      setTimeout(function () {\n        wrapperMessage.fadeOut(function () {\n          that.loadNotifier.close();\n        });\n      }, 2000);\n    },\n\n    _onCancelFile: function _onCancelFile($target) {\n      var that = this,\n      $fileWrapper = $target.closest(\"li\"),\n      $uploadWrapper = that.upload.wrapper,\n      guid = $fileWrapper.data(\"guid\");\n\n      $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\n      $fileWrapper.remove();\n    },\n\n    _onRemoveFile: function _onRemoveFile($target) {\n      var $fileWrapper = $target.closest(\"li\");\n      $fileWrapper.remove();\n    },\n\n    _onRetryFile: function _onRetryFile($target) {\n      var that = this;\n      var $file = $target.closest(\"li\");\n      var guid = $file.data(\"guid\");\n      var file = $.grep(that._fileList, function (i) {\n        return i.uid === guid;\n      });\n\n      that.options.retry(file[0]);\n    },\n\n    onErrorFile: function onErrorFile(event) {\n\n      var that = this,\n      localization = that.options.localization,\n      file = event.files[0],\n      validation = that._isValidFile(file);\n      var message = validation.message !== \"\" ? validation.message : localization.errorUpload;\n\n      that.setStatus(\"ERROR\", file.uid, message);\n    },\n\n    _isValidFile: function _isValidFile(file) {\n\n      var that = this,\n      localization = that.options.localization,\n      valid = true,\n      message = \"\";\n\n      if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0) {\n        message = localization.errorSize;\n        valid = false;\n      }\n\n      if (!that._onlyValidateServerFileExtension) {\n        if ($.inArray(file.extension, that._supportFileExt) === -1) {\n          message = localization.errorSecurity;\n          valid = false;\n        }\n      }\n\n      return {\n        valid: valid,\n        message: message };\n\n    },\n\n    _filterMaxFilesSize: function _filterMaxFilesSize(event) {\n\n      var that = this;\n      var total = 0;\n\n      for (var i = 0, length = event.files.length; i < length; i++) {\n        total += event.files[i].size;\n      }\n      if (total > that._maxFilesSize) {\n        that._notifySizeExceeded();\n        event.preventDefault();\n      } else {\n        that._onShowUploadNotifier(event);\n      }\n    },\n\n    _notifySizeExceeded: function _notifySizeExceeded() {\n\n      var that = this;\n\n      that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\n    },\n\n    _getFileItemByUID: function _getFileItemByUID(uid) {\n      var that = this;\n      return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\n    },\n\n    _switchEvents: function _switchEvents(event) {\n      var that = this;\n      var $target = $(\".k-icon\", event.currentTarget);\n      if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\n        that._onRemoveFile($target);\n      } else if ($target.hasClass(\"k-retry\")) {\n        that._onRetryFile($target);\n      } else if ($target.hasClass(\"k-cancel\")) {\n        that._onCancelFile($target);\n      }\n    },\n\n    _eventsHandler: function _eventsHandler() {\n      var that = this;\n\n      that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\n        that._switchEvents(event);\n      });\n    },\n\n    cancelFilesUpload: function cancelFilesUpload() {\n      var that = this;\n      var $uploadWrapper = that.upload.wrapper;\n\n      $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\n      that.close();\n    },\n\n    close: function close() {\n      this.loadNotifier.close();\n    },\n\n    destroy: function destroy() {\n      this.loadNotifier.destroy();\n      this.upload.destroy();\n    },\n\n    setStatus: function setStatus(status, uid, message) {\n\n      var $file = this._getFileItemByUID(uid),\n      localization = this.options.localization;\n\n      switch (status) {\n        case \"SUCCESS\":\n          $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\n          $(\".k-errormsg\", $file).text(\"\");\n          break;\n        case \"ERROR\":\n          $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\n          $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\n          $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\n          break;\n        case \"RETRY\":\n          $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\n          $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\n          $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\n          $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\n          break;}\n\n    } });\n\n\n\n  ui.plugin(ProjectAttachments);\n})(jQuery);","/*\r\n *   Name: Bizagi Workportal Desktop Project Discussions Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.discussions\", {}, {\n  /*\r\n                                                                                                      *   Constructor\r\n                                                                                                      */\n  init: function init(workportalFacade, dataService, notifier, params) {\n\n    var self = this;\n\n    self.typeResource = \"DiscussionGuid\";\n    self.plugins = {};\n    self.dialogBoxDiscussion = {};\n    self.attchComments = {};\n    self.attchDiscussions = {\n      remove: [],\n      addition: [] };\n\n    self.listDataDiscussion = [];\n    self.userPictures = [];\n    self.commentsList = {};\n\n    self.globalTags = [];\n\n    self.tempTagsBeforeDelete = [];\n    self.tempTagsToDelete = [];\n    self.keySentenceAddTag = bizagi.localization.getResource(\"workportal-project-discussion-add-new-tag\") + \": \";\n    self.notifier = notifier;\n\n\n    //Call base\n    self._super(workportalFacade, dataService, params);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-discussions\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-wrapper\"),\n      \"project-discussions-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-popup-wrapper\"),\n      \"project-discussions-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-list-wrapper\"),\n      \"project-discussions-comments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-comments-list\"),\n      \"project-discussions-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-attachments-list\"),\n      \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\") });\n\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    var templateHomeDiscussions = self.getTemplate(\"project-discussions\");\n\n    self.content = templateHomeDiscussions.render({});\n    return self.content;\n  },\n\n  /*\r\n      * Post render and links events with handlers\r\n      */\n  postRender: function postRender() {\n\n    var self = this;\n    var $contentWidget = self.getContent();\n\n    self.plugins.popupDiscussion = self.initPluginPopupDiscussion();\n    var popupDiscussion = self.plugins.popupDiscussion;\n\n    //reference for html elements\n    self.form = {\n      buttonShowFormNewDiscussion: $(\".ui-bizagi-wp-action-new\", $contentWidget),\n      title: $(\".ui-bizagi-wp-project-popupform-h4\", popupDiscussion),\n      subject: $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", popupDiscussion),\n      description: $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", popupDiscussion),\n      buttonShowPopupDiscussionToAdd: $(\"#ui-bizagi-wp-project-discussions-button-action-show-popup-to-add\", $contentWidget),\n      buttonAddDiscussion: $(\"#ui-bizagi-wp-project-discussions-popup-action-add-discussion\", popupDiscussion),\n      buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", popupDiscussion),\n      formDiscussion: $(\".ui-bizagi-wp-project-discussions-popup\", popupDiscussion),\n      attachments: $(\".ui-bizagi-wp-project-discussions-attachments-cmnwrapper\", popupDiscussion),\n      edition: false };\n\n\n    self.plugins.tagsFilter = self.initPluginTagsFilter();\n\n    self.plugins.tagsMultiSelect = self.initPluginTagsMultiSelect(popupDiscussion);\n\n    //Load discussions\n    self.getDiscussions();\n    self.eventsHandler();\n    self.restrictedEventsHandler();\n  },\n\n  getDiscussions: function getDiscussions() {\n    var self = this;\n\n    self.getDataDiscussions().done(function () {\n\n      var idUsersCreatedDiscussions = $.map(self.listDataDiscussion, function (element) {\n        return element.user;\n      });\n\n      var idUsersCreatedComments = $.map(self.commentsList, function (property) {\n        return $.map(property.comments, function (property) {\n          return property.user;\n        });\n      });\n\n      function removeDuplicateItemsFromArray(a) {\n        var seen = {};\n        var out = [];\n        var len = a.length;\n        var j = 0;\n        for (var i = 0; i < len; i++) {\n          var item = a[i];\n          if (seen[item] !== 1) {\n            seen[item] = 1;\n            out[j++] = item;\n          }\n        }\n        return out;\n      }\n\n      var csvGuidUsers = removeDuplicateItemsFromArray(idUsersCreatedDiscussions.concat(idUsersCreatedComments).concat(bizagi.currentUser.idUser)).join(\",\");\n\n      self.getDataUsers(csvGuidUsers).then(function () {\n        self.renderUserProfilesAndImages();\n      });\n\n      self.setClassesTagsByDiscussion();\n\n    });\n\n  },\n\n  /*\r\n      * Notifies when an event is raised\r\n      */\n  onNotifyOpenPopup: function onNotifyOpenPopup() {\n    var self = this;\n\n    self.form.edition = false;\n    self.showFormAddDiscussion(\"workportal-project-discussion-adddiscussion\");\n    self.renderUserProfile();\n  },\n\n  /*\r\n      * Init plugins\r\n      */\n  initPluginPopupDiscussion: function initPluginPopupDiscussion() {\n    var self = this;\n    var templatePopupDiscussion = self.getTemplate(\"project-discussions-popup\");\n    self.dialogBoxDiscussion.formContent = templatePopupDiscussion.render({ attachments: [] });\n    return self.dialogBoxDiscussion.formContent;\n  },\n\n\n  initPluginTagsMultiSelect: function initPluginTagsMultiSelect(popupDiscussion) {\n    var self = this;\n    var tags = [];\n    var categoriesMultiSelect = popupDiscussion.find(\"#ui-bizagi-wp-project-discussions-options-multiselect-tags\");\n    var newitemtext;\n    var isDelete = false;\n    var createNewTag = false;\n    return categoriesMultiSelect.kendoMultiSelect({\n      change: function change() {\n        var valuesSelected = this.value().slice(0);\n\n        var dataitems = this.dataSource.data();\n        if (valuesSelected.length > 0) {\n          if (dataitems[0].tag.replace(self.keySentenceAddTag, \"\").indexOf(valuesSelected[valuesSelected.length - 1]) !== -1) {\n            //fix because the value dont complete by millisecond\n            valuesSelected[valuesSelected.length - 1] = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\n          }\n        }\n\n\n        valuesSelected = valuesSelected.filter(Boolean); //Remove empty items\n\n        //remove duplicate items\n        valuesSelected = valuesSelected.filter(function (value, pos, self) {\n          return self.indexOf(value) === pos;\n        });\n\n        var newtag = \"\";\n\n        if (dataitems.length > 0) {\n          if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\n            newtag = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\n\n            var dataItemAddNew = {};\n            if (valuesSelected.indexOf(newtag) !== -1) {\n              dataItemAddNew = this.dataSource.at(0);\n              isDelete = true;\n              this.dataSource.remove(dataItemAddNew);\n              isDelete = false;\n              this.refresh();\n              createNewTag = true;\n            } else\n            {\n              if (newtag) {\n                if ($(\"li:first\", this.list).hasClass(\"k-state-focused\")) {\n                  createNewTag = true;\n                  valuesSelected.push(newtag);\n                }\n                dataItemAddNew = this.dataSource.at(0);\n                isDelete = true;\n                this.dataSource.remove(dataItemAddNew);\n                isDelete = false;\n              }\n            }\n          }\n        }\n        if (newtag) {\n          if (createNewTag) {\n            var existInDatasource = this.dataSource.data().filter(function (itemData) {\n              return itemData.tag === newtag;\n            });\n            if (existInDatasource.length === 0) {\n              this.dataSource.add({ guid: newtag, tag: newtag });\n            }\n            createNewTag = false;\n          }\n        }\n        this.dataSource.filter({});\n        this.value(valuesSelected);\n\n      },\n      dataBound: function dataBound() {\n        if ((newitemtext || this._prev) && newitemtext !== this._prev && !isDelete) {\n          newitemtext = this._prev;\n\n          var dataitems = this.dataSource.data();\n\n          var isfound = false;\n          if (dataitems.length > 0) {\n            if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\n              dataitems[0].tag = self.keySentenceAddTag + newitemtext;\n              this.refresh();\n              isfound = true;\n              $(\"li\", this.list).removeClass(\"k-state-focused\");\n              $(\"li:first\", this.list).addClass(\"k-state-focused\");\n            }\n          }\n\n          if (!isfound) //Is found item with text \"Add new tag:\" ?\n            {\n              this.dataSource.insert(0, self.createEmptyTag(self.keySentenceAddTag, newitemtext));\n            }\n\n          if (this.dataSource.total() == 0) {\n            this.search();\n            this.open();\n            this.refresh();\n            $(\"li\", this.list).removeClass(\"k-state-focused\");\n            $(\"li:first\", this.list).addClass(\"k-state-focused\");\n          }\n        }\n      },\n      dataSource: tags,\n      dataTextField: \"tag\",\n      dataValueField: \"guid\",\n      filter: \"contains\",\n      animation: false }).\n    data(\"kendoMultiSelect\");\n  },\n\n  /**\r\n      * return a json with \"Add new tag\" message\r\n      * @param {*} keySentenceAddTag \r\n      * @param {*} newitemtext \r\n      * @returns \r\n      */\n  createEmptyTag: function createEmptyTag(keySentenceAddTag, newitemtext) {\n    return { tag: keySentenceAddTag + newitemtext, guid: \"\" };\n  },\n\n  initPluginTagsFilter: function initPluginTagsFilter() {\n    var self = this;\n    var $contentWidget = self.getContent();\n    return $(\"#ui-bizagi-wp-project-discussions-options-tags-filter\", $contentWidget).kendoMultiSelect({\n      change: function change() {\n        self.hideOrShowDiscussionsByFilter();\n      },\n      autoClose: false,\n      tagMode: \"single\",\n      dataTextField: \"tag\",\n      dataValueField: \"guid\" }).\n    data(\"kendoMultiSelect\");\n  },\n\n  hideOrShowDiscussionsByFilter: function hideOrShowDiscussionsByFilter() {\n    var self = this;\n    var valuesSelected = self.plugins.tagsFilter.value();\n    if (valuesSelected.length > 0) {\n      $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).hide();\n      valuesSelected.forEach(function (valueClass) {\n        $(\".ui-bizagi-wp-project-discussions-item.\" + valueClass, self.getContent()).show();\n      });\n    } else\n    {\n      $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).show();\n    }\n  },\n\n  validateAddCommentForm: function validateAddCommentForm($wrapperForm) {\n    var result = false;\n    var $textAreaComment = $(\"textarea\", $wrapperForm);\n    if ($textAreaComment.val().trim() === \"\") {\n      var commentValidation = bizagi.localization.getResource(\"workportal-project-discussion-requiredcomment\");\n      $textAreaComment.parent().next().find('span').html(commentValidation);\n    } else\n    {\n      $textAreaComment.parent().next().find('span').empty();\n      result = true;\n    }\n    return result;\n  },\n\n  validateAddDiscussionForm: function validateAddDiscussionForm($wrapperForm) {\n    var result = false;\n    var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", $wrapperForm);\n    var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", $wrapperForm);\n    if ($subjectDiscussion.val().trim() !== \"\" && $descriptionDiscussion.val().trim() !== \"\") {\n      result = true;\n    }\n    if ($subjectDiscussion.val().trim() === \"\") {\n      var subjectValidation = bizagi.localization.getResource(\"workportal-project-discussion-subjectrequired\");\n      $subjectDiscussion.parent().find(\"span\").html(subjectValidation);\n    } else\n    {\n      $subjectDiscussion.parent().find(\"span\").empty();\n    }\n    if ($descriptionDiscussion.val().trim() === \"\") {\n      var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\n      $descriptionDiscussion.parent().next().find(\"span\").html(descriptionValidation);\n    } else\n    {\n      $descriptionDiscussion.parent().next().find(\"span\").empty();\n    }\n\n    return result;\n  },\n\n  applyFileAttachments: function applyFileAttachments(type) {\n\n    var self = this;\n    var content = type === \"DISCUSSIONS\" ? self.plugins.popupDiscussion : self.getContent();\n\n    return $(\".ui-bizagi-wp-project-discussions-attachment-upload\", content).kendoProjectAttachments({\n      saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\n      template: self.getTemplate(\"project-attachments\"),\n      success: function success(event) {\n        self.onSuccessFile(event, type);\n      },\n      upload: $.proxy(self.addFileData, self),\n      dropZone: false,\n      extensions: self.supportFileExt,\n      maxSize: self.uploadMaxFilesSize }).\n    data(\"kendoProjectAttachments\");\n  },\n\n  addFileData: function addFileData(event) {\n\n    var uid = event.files[0].uid;\n\n    event.files[0].guid = uid;\n    event.data = {\n      guid: uid };\n\n  },\n\n\n  /*\r\n      *  Get data for discussions\r\n      */\n  getDataDiscussions: function getDataDiscussions() {\n\n    var self = this,\n    defer = $.Deferred();\n\n    var paramsGetDiscussions = {\n      globalParent: self.radNumber,\n      typeResource: self.typeResource };\n\n\n    if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\n      paramsGetDiscussions.globalParent = self.params.plan.id;\n    }\n\n    self.dataService.getDiscussionsData(paramsGetDiscussions).pipe(function (response) {\n      return self.callForListComments(response);\n    }).done(function (response) {\n      self.listDataDiscussion = self.sortDiscussions(response);\n      self.updateTemplateListDiscussion();\n      defer.resolve();\n    });\n    return defer.promise();\n  },\n\n  /*\r\n      *  Get data for users\r\n      */\n  getDataUsers: function getDataUsers(usersGuids) {\n    var self = this,\n    defer = $.Deferred();\n\n    var params = {\n      usersGuids: usersGuids,\n      width: 50,\n      height: 50 };\n\n\n    if (params.usersGuids) {\n      self.dataService.getUsersData(params).always(function (response) {\n\n        function arrayUnique(array) {\n          var a = array.concat();\n          for (var i = 0; i < a.length; ++i) {\n            for (var j = i + 1; j < a.length; ++j) {\n              if (a[i] === a[j]) {\n                a.splice(j--, 1);\n              }\n            }\n          }\n          return a;\n        }\n\n        self.userPictures = arrayUnique(self.userPictures.concat(response));\n        defer.resolve();\n      });\n    } else\n    {\n      defer.resolve();\n    }\n\n\n    return defer.promise();\n  },\n\n  /*\r\n      * Call list of comments by discussion\r\n      */\n  callForListComments: function callForListComments(discussions) {\n\n    var self = this,\n    generalDefer = $.Deferred(),\n    commentsDefer = [];\n\n    for (var i = 0, length = discussions.length - 1; i <= length; i++) {\n\n      self.addGlobalTags(discussions[i].tags, false);\n\n      var params = {\n        idParent: discussions[i].guid,\n        dateTime: self.getDateServer(),\n        count: 6 };\n\n\n      self.commentsList[params.idParent] = {\n        comments: [],\n        count: 0,\n        total: 0 };\n\n\n      var defer = $.when(self.dataService.getCommentsData(params)).done(function (response) {\n        if (response.length > 0) {\n          self.commentsList[response[0].parent] = {\n            comments: response,\n            count: response.length,\n            total: 0 };\n\n        }\n      });\n\n      commentsDefer.push(defer);\n    }\n\n    $.when.apply($, commentsDefer).done(function () {\n      generalDefer.resolve(discussions);\n    });\n\n    return generalDefer.promise();\n  },\n\n  sortDiscussions: function sortDiscussions(discussions) {\n    var sortedDiscussion = [];\n    if (discussions.length) {\n      sortedDiscussion = discussions.sort(function (a, b) {\n        var dateA = a.date;\n        var dateB = b.date;\n\n        return dateB - dateA;\n      });\n\n      if (sortedDiscussion.length > 0) {var\n        array_move = function array_move(arr, old_index, new_index) {\n          if (new_index >= arr.length) {\n            var k = new_index - arr.length + 1;\n            while (k--) {\n              arr.push(undefined);\n            }\n          }\n          arr.splice(new_index, 0, arr.splice(old_index, 1)[0]);\n          return arr;\n        };;\n        var positionDiscussion = -1;\n        for (var iDis = 0; iDis < sortedDiscussion.length; iDis++) {\n          if (sortedDiscussion[iDis].name === \"workportal-project-discussion-generaldiscussion\") {\n            positionDiscussion = iDis;\n            break;\n          }\n        }\n\n        if (positionDiscussion > 0) {\n          array_move(sortedDiscussion, positionDiscussion, 0);\n        }\n      }\n    }\n    return sortedDiscussion;\n  },\n\n  resetDiscussionAttachments: function resetDiscussionAttachments() {\n\n    var self = this;\n    var popupDiscussion = self.plugins.popupDiscussion;\n    $(\".ui-bizagi-wp-project-attachments-list\", popupDiscussion).empty();\n\n    self.plugins.tagsMultiSelect.value([]);\n\n    self.attchDiscussions.addition = [];\n    self.attchDiscussions.remove = [];\n    self.getDiscussions();\n  },\n\n  sendDataUpdateDiscussion: function sendDataUpdateDiscussion(guid) {\n\n    var self = this;\n    var filesObj = self.prepareFilesToSave();\n    self.form.buttonAddDiscussion.prop(\"disabled\", true);\n\n    var tagsDiscussion = self.getTagsDiscussionBySave();\n    var guidsTagsDiscussionToDelete = self.getGuidsTagsDiscussionToDelete();\n\n    var params = {\n      content: {\n        name: self.form.subject.val(),\n        description: self.form.description.val(),\n        globalParent: self.radNumber.toString(),\n        user: bizagi.currentUser.idUser,\n        attachments: filesObj.attachments,\n        guid: guid,\n        tags: tagsDiscussion,\n        typeResource: \"DiscussionGuid\",\n        general: false,\n        date: self.getDateServer() },\n\n      attachmentsToCreate: filesObj.attachmentsToCreate,\n      attachmentsToDelete: filesObj.attachmentsToDelete };\n\n\n    self.plugins.attchDiscussions.close();\n\n    self.dataService.editDiscussion(params).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n        self.addGlobalTags(tagsDiscussion, true);\n\n        var discussion = self.getDiscussionDataByGUID(guid);\n        discussion.name = params.content.name;\n        discussion.description = params.content.description;\n        discussion.attachments = params.content.attachments;\n        discussion.tags = params.content.tags;\n\n        self.onClosePopupDiscussion();\n\n        self.resetDiscussionAttachments();\n        self.updateTemplateListDiscussion();\n\n        self.removeGlobalTags(guidsTagsDiscussionToDelete);\n\n        self.notifier.showSucessMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-edited\"), \"\"));\n      } else {\n\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\n\n        self.onClosePopupDiscussion();\n        self.notifier.showErrorMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-error-edition\"), \"\"));\n      }\n\n\n      self.renderUserProfilesAndImages();\n\n      self.setClassesTagsByDiscussion();\n      self.hideOrShowDiscussionsByFilter();\n    });\n\n  },\n  validateStringIsGuid: function validateStringIsGuid(value) {\n    var validGuid = /^({|()?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}(}|))?$/;\n    var emptyGuid = /^({|()?0{8}-(0{4}-){3}0{12}(}|))?$/;\n    return validGuid.test(value) && !emptyGuid.test(value);\n  },\n\n  sendDataInsertDiscussion: function sendDataInsertDiscussion(guid) {\n\n    var self = this;\n    var filesObj = self.prepareFilesToSave();\n\n    self.form.buttonAddDiscussion.prop(\"disabled\", true);\n\n    var tagsDiscussion = self.getTagsDiscussionBySave();\n\n    var params = {\n      content: {\n        name: self.form.subject.val(),\n        description: self.form.description.val(),\n        globalParent: self.radNumber.toString(),\n        user: bizagi.currentUser.idUser,\n        attachments: filesObj.attachments,\n        guid: guid,\n        tags: tagsDiscussion,\n        typeResource: \"DiscussionGuid\",\n        general: false,\n        date: self.getDateServer() },\n\n      attachmentsToCreate: filesObj.attachmentsToCreate,\n      attachmentsToDelete: filesObj.attachmentsToDelete };\n\n\n    self.plugins.attchDiscussions.close();\n\n    self.dataService.postDiscussion(params).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n\n        self.addGlobalTags(tagsDiscussion, true);\n\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\n\n        var newDiscussion = {\n          \"name\": params.content.name,\n          \"description\": params.content.description,\n          \"date\": params.content.date,\n          \"user\": params.content.user,\n          \"attachments\": params.content.attachments,\n          \"radNumber\": params.content.globalParent,\n          \"general\": params.content.general,\n          \"guid\": params.content.guid,\n          \"tags\": params.content.tags,\n          \"typeResource\": params.content.typeResource };\n\n\n        self.commentsList[params.content.guid] = {\n          comments: [],\n          count: 0,\n          total: 0 };\n\n\n        if (self.listDataDiscussion.length === 0) {//Add first discussion\n          self.listDataDiscussion.push(newDiscussion);\n        } else\n        {//Add discussion in position 1\n          self.listDataDiscussion.splice(1, 0, newDiscussion);\n        }\n\n        self.resetDiscussionAttachments();\n        self.onClosePopupDiscussion();\n        self.notifier.showSucessMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-created\"), \"\"));\n        self.updateTemplateListDiscussion();\n        self.updateDiscussionsMenu(true);\n      } else\n      {\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\n        self.onClosePopupDiscussion();\n        self.notifier.showErrorMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-error-creation\"), \"\"));\n      }\n\n      self.renderUserProfilesAndImages();\n\n      self.setClassesTagsByDiscussion();\n      self.hideOrShowDiscussionsByFilter();\n    });\n  },\n\n  /**\r\n      * Notify that discussions Icon shoul be updated\r\n      * @param {*} hasDiscussionsOrComment \r\n      */\n  updateDiscussionsMenu: function updateDiscussionsMenu(hasDiscussionsOrComment) {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"UPDATE_DISCUSSIONS_MENU_STATUS\",\n      hasDiscussionsOrComment: hasDiscussionsOrComment });\n\n  },\n  getTagsDiscussionBySave: function getTagsDiscussionBySave() {\n    var self = this;\n    var tagsTextSelected = self.plugins.tagsMultiSelect.value();\n    var dataSourceTags = self.plugins.tagsMultiSelect.dataSource.data();\n\n    var tagsDiscussion = [];\n    tagsTextSelected.forEach(function (tagTextSelected) {\n      var isGuidTextSelected = self.validateStringIsGuid(tagTextSelected);\n\n      var tagFound;\n      if (isGuidTextSelected) {\n        tagFound = dataSourceTags.filter(function (tagSource) {\n          return tagSource.guid === tagTextSelected;\n        });\n      } else\n      {\n        tagFound = dataSourceTags.filter(function (tagSource) {\n          var isGuid = self.validateStringIsGuid(tagSource.guid);\n          return tagSource.tag === tagTextSelected && !isGuid;\n        });\n      }\n\n      if (tagFound.length === 1) {\n        tagsDiscussion.push({\n          guid: isGuidTextSelected ? tagFound[0].guid : tagFound[0].uid,\n          tag: tagFound[0].tag });\n\n      }\n\n    });\n\n    return tagsDiscussion;\n  },\n\n  //b: minuendo, a: sustraendo\n  differenceArrays: function differenceArrays(b, a) {\n    return b.filter(function (i) {\n      return a.indexOf(i) < 0;\n    });\n  },\n\n  getGuidsTagsDiscussionToDelete: function getGuidsTagsDiscussionToDelete() {\n    var self = this;\n    var guidsTagsCurrentDiscussion = self.plugins.tagsMultiSelect.value();\n    return self.differenceArrays(self.tempTagsBeforeDelete, guidsTagsCurrentDiscussion);\n  },\n\n  /*\r\n      *   UI Functions\r\n      */\n  setStateUIShowMoreComments: function setStateUIShowMoreComments($commentsContainer, state) {\n    var $containerButtonMoreComments = $commentsContainer.siblings(\".ui-bizagi-wp-project-discussion-showmore-comments\");\n    var $buttonShowMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-comments-button\");\n    var $messageNoMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-no-more-comments\");\n    var $messageLoadingComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-loading-comments\");\n\n    if (state === \"ALLOW_MORE_COMMENTS\") {\n      $buttonShowMoreComments.show();\n      $messageNoMoreComments.hide();\n      $messageLoadingComments.hide();\n    }\n\n    if (state === \"LOADING_MORE_COMMENTS\") {\n      $buttonShowMoreComments.hide();\n      $messageNoMoreComments.hide();\n      $messageLoadingComments.show();\n    }\n\n    if (state === \"NO_MORE_COMMENTS\") {\n      $buttonShowMoreComments.hide();\n      $messageNoMoreComments.show();\n      $messageLoadingComments.hide();\n    }\n  },\n\n  getCurrentUserInfo: function getCurrentUserInfo() {\n    return {\n      name: bizagi.currentUser.userName,\n      id: bizagi.currentUser.idUser,\n      picture: \"\" };\n\n  },\n\n  /*Functions about tags*/\n\n  addGlobalTags: function addGlobalTags(tagsDiscussion, createTagsOnServer) {\n    var self = this;\n\n    for (var iTagAdd = 0; iTagAdd < tagsDiscussion.length; iTagAdd += 1) {\n      var existTag = self.globalTags.filter(function (tagGlobal) {\n        return tagGlobal.tag === tagsDiscussion[iTagAdd].tag;\n      });\n      if (existTag.length === 0) {\n        tagsDiscussion[iTagAdd].globalParent = self.radNumber;\n        self.globalTags.push(tagsDiscussion[iTagAdd]);\n        if (createTagsOnServer) {\n          self.dataService.postTag(tagsDiscussion[iTagAdd]);\n        }\n      }\n    }\n\n    //Sync tags\n    self.plugins.tagsFilter.dataSource.data(self.globalTags);\n    self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\n  },\n\n  removeGlobalTags: function removeGlobalTags(guidTagsToDelete) {\n    var self = this;\n    var allGuidsTagsAllDiscussions = $.map(self.listDataDiscussion, function (discussion) {\n      return $.map(discussion.tags, function (itemTag) {\n        return itemTag.guid;\n      });\n    });\n\n    var allGuidsMoreGuidsDelete = allGuidsTagsAllDiscussions.concat(guidTagsToDelete);\n\n    var secureGuidsForDelete = [];\n    guidTagsToDelete.forEach(function (guidDelete) {\n      var existGuidOnlyTimeThenDelete = allGuidsMoreGuidsDelete.filter(function (guid) {\n        return guid === guidDelete;\n      });\n      if (existGuidOnlyTimeThenDelete.length === 1) {\n        secureGuidsForDelete.push(guidDelete);\n      }\n    });\n\n\n    secureGuidsForDelete.forEach(function (guidSecureDelete) {\n      //delete with service\n      var params = { idTag: guidSecureDelete };\n      self.dataService.deleteTag(params);\n\n      //delete globalTags\n      for (var iTagGlobal = self.globalTags.length - 1; iTagGlobal >= 0; iTagGlobal -= 1) {\n        if (self.globalTags[iTagGlobal].guid === guidSecureDelete) {\n          self.globalTags.splice(iTagGlobal, 1);\n        }\n      }\n    });\n\n    //Sync tags\n    self.plugins.tagsFilter.dataSource.data(self.globalTags);\n    self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\n  },\n\n  setClassesTagsByDiscussion: function setClassesTagsByDiscussion() {\n    var self = this;\n    for (var iDiscussion = 0; iDiscussion < self.listDataDiscussion.length; iDiscussion += 1) {\n      var textTagsDiscussion = $.map(self.listDataDiscussion[iDiscussion].tags, function (itemTag) {\n        return itemTag.guid;\n      });\n      var tagsBySpace = textTagsDiscussion.join(\" \");\n\n      $(\".ui-bizagi-wp-project-discussions-item[data-guid='\" + self.listDataDiscussion[iDiscussion].guid + \"']\", self.getContent()).addClass(tagsBySpace);\n    }\n  },\n\n  updateTemplateListDiscussion: function updateTemplateListDiscussion() {\n\n    var self = this;\n    var $contentWidget = self.getContent();\n    var templateListDiscussions = self.getTemplate(\"project-discussions-list\");\n    var user = self.getCurrentUserInfo();\n    var contentRenderListDiscussions = templateListDiscussions.render({\n      listDataDiscussions: self.listDataDiscussion,\n      user: user,\n      isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\n      returnServedCommentByParentId: function returnServedCommentByParentId(parentId) {\n        return self.returnServedCommentByParentId(parentId);\n      } });\n\n    for (var i = 0; i < this.listDataDiscussion.length; i++) {\n      this.mapTempComments($(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"),\n      contentRenderListDiscussions.find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"));\n    }\n    $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).empty().append(contentRenderListDiscussions);\n\n    self.plugins.attchComments = self.applyFileAttachments(\"COMMENTS\");\n  },\n\n  showFormAddDiscussion: function showFormAddDiscussion(resourceTitlePopup) {\n    var self = this;\n\n    if (self.plugins.attchComments) {\n      self.plugins.attchComments.close();\n    }\n    self.dialogBoxDiscussion.formContent.dialog({\n      resizable: false,\n      draggable: false,\n      height: \"auto\",\n      width: \"650px\",\n      modal: true,\n      zIndex: 1,\n      title: bizagi.localization.getResource(resourceTitlePopup),\n      maximize: true,\n      open: $.proxy(self.onOpenPopupDiscussion, self),\n      close: function close() {\n        self.resetDiscussionAttachments();\n        self.onClosePopupDiscussion();\n      } });\n\n  },\n\n  resetFormDiscussion: function resetFormDiscussion() {\n    var self = this;\n\n    self.form.buttonAddDiscussion.prop(\"disabled\", false);\n    self.form.subject.val(\"\");\n    self.form.description.val(\"\");\n\n    var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", self.dialogBoxDiscussion.formContent);\n    var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", self.dialogBoxDiscussion.formContent);\n    $subjectDiscussion.parent().find(\"span\").empty();\n    $descriptionDiscussion.parent().next().find(\"span\").empty();\n  },\n\n  renderUserProfile: function renderUserProfile() {\n    var self = this;\n\n    var userPicture = $.grep(self.userPictures, function (userPicture) {\n      return userPicture.id === bizagi.currentUser.idUser;\n    })[0];\n\n    var base64Prefix = \"data:image/png;base64,\";\n    var $parent = $(\".ui-bizagi-wp-project-popupform-user\");\n    var $img = $parent.find(\".bz-wp-avatar-img\");\n    var $text = $parent.find(\".bz-wp-avatar-label\");\n\n    if (userPicture) {\n      if (userPicture.picture) {\n        $img.attr(\"src\", base64Prefix + userPicture.picture);\n      } else {\n        $img.hide();\n        $text.html(userPicture.name.getInitials()).show();\n      }\n    }\n  },\n\n  renderUserProfilesAndImages: function renderUserProfilesAndImages() {\n    var self = this;\n\n    var userPicture = $.grep(self.userPictures, function (userPicture) {\n      return userPicture.id === bizagi.currentUser.idUser;\n    })[0];\n\n    var base64Prefix = \"data:image/png;base64,\";\n\n    if (userPicture) {\n      $(\".ui-bizagi-wp-project-discussions-create-comment .bz-wp-discussion-username\").html(userPicture.name);\n      if (userPicture.picture) {\n        $(\".ui-bizagi-wp-project-discussions-item-user img\").attr(\"src\", base64Prefix + userPicture.picture);\n        $(\".ui-bizagi-wp-project-popupform-image-current-user\").attr(\"src\", base64Prefix + userPicture.picture);\n      } else {\n        $(\".ui-bizagi-wp-project-discussions-item-user label.bz-wp-avatar-label\").html(userPicture.name.getInitials()).show();\n        $(\".ui-bizagi-wp-project-discussions-item-user img\").hide();\n      }\n    }\n\n    for (var iUser = 0; iUser < self.userPictures.length; iUser++) {\n      $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-discussion-username\").html(self.userPictures[iUser].name);\n      if (self.userPictures[iUser].picture) {\n        $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").attr(\"src\", base64Prefix + self.userPictures[iUser].picture);\n      } else {\n        $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").hide();\n        $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] label.bz-wp-avatar-label\").html(self.userPictures[iUser].name.getInitials());\n      }\n    }\n  },\n\n  /*EVENTS*/\n  switchCommentsEvents: function switchCommentsEvents(event) {\n\n    var self = this;\n    var $target = $(event.target);\n    var $parent = $target.parent();\n\n    if ($target.is(\"textarea\")) {\n      self.onShowButtonsPanel($target);\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-cancel\")) {\n\n      self.onCancelComment($target);\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-share\")) {\n\n      var $container = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\n      if (self.validateAddCommentForm($container)) {\n        var guid = Math.guid();\n        self.onCreateComment($target, guid);\n      }\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-view\")) {\n      self.onViewComment($target);\n    } else if ($target.hasClass(\"ui-bizagi-wp-project-discussion-showmore-comments-button\")) {\n      self.onViewMoreComments($target);\n    } else if ($target.hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\n      self.onRemoveFiles($target);\n    } else if ($parent.hasClass(\"biz-wp-user-icon-admin\") && $parent.hasClass(\"biz-wp-action-edit-discussion\")) {\n      self.onEditDiscussion($target);\n    } else if ($parent.hasClass(\"ui-bizagi-wp-project-discussion-delete\")) {\n\n      $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-discussion-querydelete\"), \"\", \"info\")).done(function () {\n        self.onDeleteComment($parent);\n      });\n\n    } else if ($parent.hasClass(\"bz-bizagi-wp-project-discussions-attachment-itemwrapper\")) {\n      self.onDownloadAttachment($target.closest(\"li\"));\n    }\n\n    event.stopPropagation();\n  },\n\n  onEditDiscussion: function onEditDiscussion($target) {\n\n    var self = this;\n    var $discussionCnt = $target.closest(\".ui-bizagi-wp-project-discussions-item\");\n    var guid = $discussionCnt.data(\"guid\");\n\n    self.setDiscussionsDataByGUID(guid);\n    self.showFormAddDiscussion(\"workportal-project-discussion-edit\");\n  },\n\n  setDiscussionsDataByGUID: function setDiscussionsDataByGUID(guid) {\n\n    var self = this;\n\n    var discussion = self.getDiscussionDataByGUID(guid);\n    var $container = $(\".ui-bizagi-wp-project-attachments-list\", self.form.attachments);\n\n    self.form.edition = {\n      guid: guid };\n\n\n    self.attchDiscussions = {\n      addition: discussion.attachments,\n      remove: [] };\n\n\n    self.form.title.text(bizagi.localization.getResource(\"workportal-project-discussion-edit\"));\n    self.form.subject.val(discussion.name);\n    self.form.description.val(discussion.description);\n\n    var guidTagsDiscussion = $.map(discussion.tags, function (itemTag) {\n      return itemTag.guid;\n    });\n    self.plugins.tagsMultiSelect.value(guidTagsDiscussion);\n    self.tempTagsBeforeDelete = [];\n    self.tempTagsBeforeDelete = self.tempTagsBeforeDelete.concat(self.plugins.tagsMultiSelect.value());\n\n    self.renderAttachments(discussion.attachments, \"DISCUSSIONS\", $container);\n\n  },\n\n  getDiscussionDataByGUID: function getDiscussionDataByGUID(guid) {\n\n    var self = this;\n    var discussion;\n\n    for (var i = self.listDataDiscussion.length - 1; i >= 0; i--) {\n      if (self.listDataDiscussion[i].guid === guid) {\n        discussion = self.listDataDiscussion[i];\n        i = 0;\n      }\n    }\n\n    return discussion;\n  },\n\n  onViewComment: function onViewComment($target) {\n    var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-comment-truncatewrapper\");\n    $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-shortcomment\");\n    $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-longcomment\");\n  },\n\n  onViewMoreComments: function onViewMoreComments($target) {\n    var self = this;\n    var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussion-showmore-comments\");\n    var $commentsContainer = $commentWrapper.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\n    var idParent = $commentsContainer.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\n\n    if (!self.commentsList[idParent].total) {\n      //only one time call service if total is null\n      self.dataService.getCommentsCountByParent(idParent).done(function (response) {\n        self.commentsList[idParent].total = response.count;\n        self.getMoreComments(idParent, $commentsContainer);\n      });\n    } else\n    {\n      self.getMoreComments(idParent, $commentsContainer);\n    }\n  },\n\n  getMoreComments: function getMoreComments(idParent, $commentsContainer) {\n    var self = this;\n\n    //validate total comments vs count comments\n    if (self.commentsList[idParent].total > self.commentsList[idParent].comments.length) {\n\n      self.setStateUIShowMoreComments($commentsContainer, \"LOADING_MORE_COMMENTS\");\n\n      var dateLastComment;\n      if (self.commentsList[idParent].comments.length === 0) {\n        dateLastComment = self.getDateServer();\n      } else\n      {\n        dateLastComment = self.commentsList[idParent].comments[self.commentsList[idParent].comments.length - 1].date;\n      }\n\n      //substract one millisecond\n      dateLastComment -= 1;\n\n      self.dataService.getCommentsData(\n      {\n        dateTime: dateLastComment,\n        idParent: idParent,\n        count: 6 }).\n\n      done(function (responseMoreComments) {\n\n        if (responseMoreComments.length) {\n          Array.prototype.push.apply(self.commentsList[idParent].comments, responseMoreComments);\n          self.commentsList[idParent].count += responseMoreComments.length;\n\n          self.renderCommentByDiscussion($commentsContainer, idParent, responseMoreComments);\n          self.renderUserProfilesAndImages();\n\n          if (responseMoreComments.length > 5) {\n            self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\n          } else {\n            self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\n          }\n\n          //Get profiles of idUsers not download in this moment\n          var idUsersLoaded = $.map(self.userPictures, function (element) {\n            return element.id;\n          });\n\n          var idUsersNewComments = $.map(self.commentsList, function (property) {\n            return $.map(property.comments, function (property) {\n              return property.user;\n            });\n          });\n\n          var arrayIdUsersMissingLoad = $(idUsersNewComments).not(idUsersLoaded).get();\n          var csvIdUsersMissingLoad = arrayIdUsersMissingLoad.join(\",\");\n\n          self.getDataUsers(csvIdUsersMissingLoad).then(function () {\n            self.renderUserProfilesAndImages();\n          });\n\n        } else\n        {\n          self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\n        }\n      }).fail(function () {\n        self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\n      });\n    } else\n    {\n      self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\n    }\n\n  },\n\n  renderCommentByDiscussion: function renderCommentByDiscussion($container, guidParent, moreComments) {\n\n    var self = this,\n    tmplComment = self.getTemplate(\"project-discussions-comments\"),\n    $commentsDOM,\n    renderObject = {\n      comments: [],\n      user: self.getCurrentUserInfo(),\n      isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) };\n\n\n    if (!moreComments.length) {\n      renderObject.comments = self.commentsList[guidParent].comments;\n      $commentsDOM = tmplComment.render(renderObject);\n      $container.html($commentsDOM);\n    } else {\n      renderObject.comments = moreComments;\n      $commentsDOM = tmplComment.render(renderObject);\n      $container.append($commentsDOM);\n    }\n  },\n\n  getCommentByGuid: function getCommentByGuid(parentGuid, commentGuid) {\n\n    var self = this;\n    var commentsList = self.commentsList[parentGuid].comments;\n\n    for (var i = 0, length = commentsList.length; i < length; i++) {\n\n      if (commentsList[i].guid === commentGuid) {\n        var attachments = [];\n\n        for (var x = 0, lengthx = commentsList[i].attachments.length; x < lengthx; x++) {\n          attachments.push(commentsList[i].attachments[x].guid);\n        }\n\n        return {\n          attachments: attachments,\n          index: i };\n\n      }\n    }\n\n    return {};\n  },\n\n  returnServedCommentByParentId: function returnServedCommentByParentId(parentId) {\n    var self = this;\n\n    if (typeof self.commentsList[parentId] !== \"undefined\") {\n      return self.commentsList[parentId];\n    }\n  },\n\n  /*\r\n      *   Events\r\n      */\n  onShowButtonsPanel: function onShowButtonsPanel($target) {\n    var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\").find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\n    $buttonsWrp.show();\n  },\n\n  onRemoveFiles: function onRemoveFiles($target) {\n    var self = this;\n    var $container = $target.closest(\"li\"),\n    type = $container.closest(\".ui-bizagi-wp-project-attachments-list\").data(\"type\"),\n    fileGuid = $container.data(\"fileguid\");\n    var currentFiles, removeFiles, tmpSplice;\n\n    if (type === \"COMMENT\") {\n      var guid = $container.closest(\".ui-bizagi-wp-project-discussions-add-comment\").data(\"guid\");\n      currentFiles = self.attchComments[guid].addition;\n      removeFiles = self.attchComments[guid].remove;\n\n    } else {\n      currentFiles = self.attchDiscussions.addition;\n      removeFiles = self.attchDiscussions.remove;\n    }\n\n    for (var i = 0, length = currentFiles.length - 1; i <= length; i++) {\n\n      if (currentFiles[i].guid === fileGuid) {\n        tmpSplice = currentFiles.splice(i, 1);\n        removeFiles.push(tmpSplice[0].guid);\n        i = length;\n      }\n    }\n\n    $container.remove();\n  },\n\n  onDeleteComment: function onDeleteComment($target) {\n    var self = this;\n    var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\n    var commentGuid = $commentWrapper.data(\"cmmtguid\");\n    var parentGuid = $commentWrapper.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\n    var comment = self.getCommentByGuid(parentGuid, commentGuid);\n\n    var params = {\n      content: {\n        guid: commentGuid },\n\n      attachmentsToDelete: comment.attachments };\n\n\n    $.when(self.dataService.deleteComment(params)).always(function (response) {\n      if (response.status === 200 || typeof response.status === \"undefined\") {\n        self.commentsList[parentGuid].comments.splice(comment.index, 1);\n        $commentWrapper.remove();\n\n        var hasDiscussionsOrComment = self.hasDiscussionsOrComment(self.commentsList);\n        self.updateDiscussionsMenu(hasDiscussionsOrComment);\n      } else {\n        self.notifier.showErrorMessage(\n        printf(bizagi.localization.getResource(\"workportal-project-discussion-errordelete\"), \"\"));\n      }\n    });\n  },\n\n  hasDiscussionsOrComment: function hasDiscussionsOrComment(comments) {\n    var keys = Object.keys(comments);\n    var haveDiscussions = keys.length > 1;\n    var haveComments = false;\n    for (var i = 0; i < keys.length; i++) {\n      if (comments[keys[i]].comments.length > 0) {\n        haveComments = true;\n        break;\n      }\n    }\n    return haveDiscussions || haveComments;\n  },\n\n  onSuccessFile: function onSuccessFile(event, type) {\n    var self = this;\n    var files = event.files;\n    var status = event.XMLHttpRequest.response ? JSON.parse(event.XMLHttpRequest.response) : {};\n\n    if (!status.error) {\n      var $wrapper = $(event.sender.element).closest(\".ui-bizagi-wp-project-discussion-textwrapper\");\n      var $container = $wrapper.find(\".ui-bizagi-wp-project-attachments-list\");\n\n      if (type === \"DISCUSSIONS\") {\n        self.plugins.attchDiscussions.setStatus(\"SUCCESS\", files[0].guid);\n        Array.prototype.push.apply(self.attchDiscussions.addition, files);\n      } else {\n        self.plugins.attchComments.setStatus(\"SUCCESS\", files[0].guid);\n        var guid = $wrapper.data(\"guid\");\n\n        if (self.attchComments[guid]) {\n          Array.prototype.push.apply(self.attchComments[guid].addition, files);\n        } else {\n          self.attchComments[guid] = {\n            addition: files,\n            remove: [] };\n\n        }\n\n        self.onShowButtonsPanel($container.parent());\n      }\n\n      self.renderAttachments(files, type, $container);\n    } else {\n\n      if (type === \"DISCUSSIONS\") {\n        self.plugins.attchDiscussions.onErrorFile(event);\n      } else {\n        self.plugins.attchComments.onErrorFile(event);\n      }\n    }\n  },\n\n  onDownloadAttachment: function onDownloadAttachment($liTarget) {\n    var self = this;\n    var guidAttachment = $liTarget.data(\"fileguid\");\n\n    if (guidAttachment !== \"\") {\n      var nameFile = $liTarget.find(\".bz-bizagi-wp-project-discussions-attachment-filename\").text();\n      self.dataService.getDownloadAttachment(guidAttachment, nameFile);\n    }\n  },\n\n  onCancelComment: function onCancelComment($target) {\n    var self = this;\n    var $commentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\n    var $buttonsWrp = $commentContainer.find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\n    var $textarea = $commentContainer.find(\"textarea\");\n    var $uploadForm = $commentContainer.find(\".ui-bizagi-wp-project-discussions-add-attachments form\");\n    var $vlTooltip = $commentContainer.find(\".k-tooltip-validation\");\n    var $fileList = $commentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\n    var guid = $commentContainer.data(\"guid\");\n\n    self.attchComments[guid] = {\n      addition: [],\n      remove: [] };\n\n\n    self.plugins.attchComments.cancelFilesUpload();\n\n    $uploadForm[0].reset();\n    $fileList.empty();\n    $textarea.val(\"\");\n    $vlTooltip.hide();\n    $buttonsWrp.hide();\n  },\n\n  onCreateComment: function onCreateComment($target, guid) {\n    var self = this;\n    var $rplWrp = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\n    var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\n    var $addCommentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\n    var $textarea = $addCommentContainer.find(\"textarea\");\n    var $uploadList = $addCommentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\n    var idParent = $addCommentContainer.data(\"guid\");\n    var filesObj = self.prepareFilesToSave(\"COMMENTS\", idParent);\n\n    var params = {\n      content: {\n        guid: guid,\n        attachments: filesObj.attachments,\n        text: $textarea.val(),\n        parent: idParent,\n        date: self.getDateServer(),\n        user: bizagi.currentUser.idUser },\n\n      attachmentsToCreate: filesObj.attachmentsToCreate,\n      attachmentsToDelete: filesObj.attachmentsToDelete };\n\n\n    $.when(self.dataService.postComment(params)).always(function (response) {\n      if (response.status === 200 || response.status === 201 || response.status === undefined) {\n        var $commentContainer = $rplWrp.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\n        var newComment = {\n          user: params.content.user,\n          attachments: params.content.attachments,\n          text: params.content.text,\n          guid: params.content.guid,\n          parent: params.content.parent,\n          date: params.content.date };\n\n\n        //reset for a new comment\n        self.attchComments[params.content.parent] = {\n          addition: [],\n          remove: [] };\n\n\n        $textarea.val(\"\");\n        $uploadList.empty();\n        $buttonsWrp.hide();\n\n        //Add new comment to the list\n        self.commentsList[newComment.parent].comments.unshift(newComment);\n        self.renderCommentByDiscussion($commentContainer, newComment.parent, []);\n\n        self.plugins.attchComments.close();\n        self.renderUserProfilesAndImages();\n        self.updateDiscussionsMenu(true);\n      }\n    });\n  },\n\n  renderAttachments: function renderAttachments(files, type, $container) {\n    var self = this;\n    var attachTemplate = self.getTemplate(\"project-discussions-attachments\");\n\n    var $fileList = attachTemplate.render({ attachments: files, type: type });\n    $container.append($fileList);\n    if (bizagi.util.isIE()) {//\"shake\" files container for IE error\n      $(\".ui-bizagi-wp-project-attachments-list li\").hide(10, function () {\n        $(this).show();\n      });\n    }\n  },\n\n  prepareFilesToSave: function prepareFilesToSave(type, guid) {\n\n    var self = this;\n    var files = [],\n    fileList = type === \"COMMENTS\" ? self.attchComments[guid] : self.attchDiscussions,\n    attachmentsToCreate = [];\n\n    fileList = fileList || { addition: [], remove: [] };\n\n    for (var i = 0, length = fileList.addition.length - 1; i <= length; i++) {\n      files.push({\n        guid: fileList.addition[i].guid,\n        name: fileList.addition[i].name });\n\n\n      attachmentsToCreate.push(fileList.addition[i].guid);\n    }\n\n    return {\n      attachments: files,\n      attachmentsToCreate: attachmentsToCreate,\n      attachmentsToDelete: fileList.remove };\n\n  },\n\n  onClickCancel: function onClickCancel(event) {\n    event.preventDefault();\n    var self = this;\n\n    self.resetDiscussionAttachments();\n    self.onClosePopupDiscussion();\n\n    self.plugins.attchDiscussions.cancelFilesUpload();\n  },\n\n  onClosePopupDiscussion: function onClosePopupDiscussion() {\n    var self = this;\n    self.resetFormDiscussion();\n    self.plugins.attchDiscussions.destroy();\n    self.dialogBoxDiscussion.formContent.dialog(\"destroy\");\n    self.dialogBoxDiscussion.formContent.detach();\n  },\n\n  onOpenPopupDiscussion: function onOpenPopupDiscussion() {\n    var self = this;\n\n    self.plugins.attchDiscussions = self.applyFileAttachments(\"DISCUSSIONS\");\n\n    //popup\n    self.dialogBoxDiscussion.formContent.parent().css(\"z-index\", 10001);\n    //overlay\n    self.dialogBoxDiscussion.formContent.parent().parent().find(\".ui-widget-overlay\").css(\"z-index\", 10001);\n\n    setTimeout(function () {\n      self.form.subject.focus();\n    }, 50);\n  },\n\n  onSubmitFormDiscussion: function onSubmitFormDiscussion(event) {\n    event.preventDefault();\n\n    var self = this;\n    var guid;\n    if (self.validateAddDiscussionForm(self.dialogBoxDiscussion.formContent)) {\n      if (self.form.edition.guid) {\n        guid = self.form.edition.guid;\n        $.proxy(self.sendDataUpdateDiscussion(guid), self);\n      } else {\n        guid = Math.guid();\n        $.proxy(self.sendDataInsertDiscussion(guid), self);\n      }\n    }\n  },\n\n  restrictedEventsHandler: function restrictedEventsHandler() {\n    var self = this;\n    var $contentWidget = self.getContent();\n\n    $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\", \".bz-bizagi-wp-project-discussions-attachment-itemwrapper\", $.proxy(self.switchCommentsEvents, self));\n  },\n\n  eventsHandler: function eventsHandler() {\n    var self = this;\n    var $contentWidget = self.getContent();\n\n    //Add events\n    self.form.buttonShowFormNewDiscussion.on(\"click\", $.proxy(self.onNotifyOpenPopup, self));\n    self.form.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\n    self.form.buttonAddDiscussion.on(\"click\", $.proxy(self.onSubmitFormDiscussion, self));\n    self.form.attachments.on(\"click\", \".bz-bizagi-wp-project-discussions-attachment-delete, .bz-bizagi-wp-project-discussions-attachment-itemwrapper\", function (event) {\n\n      if ($(event.target).hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\n        self.onRemoveFiles($(event.target));\n      } else {\n        self.onDownloadAttachment($(event.target).closest(\"li\"));\n      }\n\n      event.stopPropagation();\n    });\n\n    $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\", \".ui-bizagi-wp-project-discussions-add-comment textarea\" +\n    \", .ui-bizagi-wp-project-discussions-comment-buttons-cancel\" +\n    \", .ui-bizagi-wp-project-discussions-comment-buttons-share\" +\n    \", .ui-bizagi-wp-project-discussion-showmore-comments button\" +\n    \", .bz-bizagi-wp-project-discussions-attachment-delete\" +\n    \", .ui-bizagi-wp-project-discussion-delete\" +\n    \", .bz-bizagi-wp-project-discussions-attachment-itemwrapper\" +\n    \", .ui-bizagi-wp-project-discussions-comment-view\" +\n    \", .ui-bizagi-wp-project-discussions-items-edition\" +\n    \", .biz-wp-action-edit-discussion\", $.proxy(self.switchCommentsEvents, self));\n\n    self.sub(\"changeProjectWidget\", function () {\n      self.resetWidget();\n    });\n    self.sub(\"OPEN_POPUP_DISCUSSION\", $.proxy(self.onNotifyOpenPopup, self));\n  },\n\n  resetWidget: function resetWidget() {\n    var self = this;\n    self.userPictures = [];\n    if (self.plugins.attchComments) {\n      self.plugins.attchComments.close();\n    }\n  },\n\n  clean: function clean() {\n\n    var self = this;\n    self.resetWidget();\n\n    if (self.form && self.form.buttonShowFormNewDiscussion) {\n      self.form.buttonShowFormNewDiscussion.off(\"click\", $.proxy(self.onNotifyOpenPopup, self));\n    }\n\n\n    for (var i in self.plugins) {\n      if (self.plugins[i] && self.plugins[i].hasOwnProperty(\"destroy\")) {\n        if (self.plugins[i].destroy) {\n          self.plugins[i].destroy();\n        }\n      }\n    }\n  },\n\n  mapTempComments: function mapTempComments($source, $target) {\n    var $textareaSource = $source.find(\"textarea\");\n    var $textareaTarget = $target.find(\"textarea\");\n    var $uploadListSource = $source.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\n    var $uploadListTarget = $target.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\n    $textareaTarget.val($textareaSource.val());\n    $uploadListTarget.empty().append($uploadListSource.html());\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.discussions\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.discussions], true);","/*\r\n *   Name: Bizagi Workportal project Discussion Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.discussion.sidebar\", {}, {\n\n  /*\r\n                                                                                                       *   Constructor\r\n                                                                                                       */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    params = params || {};\n    params.supportNav = false;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-discussion-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussion.sidebar\").concat(\"#project-discussion-sidebar\") });\n\n  },\n\n  /**\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n\n    var template = self.getTemplate(\"project-discussion-sidebar\");\n    self.content = template.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) });\n\n    return self.content;\n  },\n\n  /**\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    var $contentWidget = self.getContent();\n    $(\".ui-bizagi-wp-project-discussions-sidebar-action-add > a\", $contentWidget).on(\"click\",\n    $.proxy(self.onShowPopupDiscussion, self));\n  },\n\n  /**\r\n      * Events elements\r\n      */\n  onShowPopupDiscussion: function onShowPopupDiscussion() {\n    var self = this;\n    self.pub(\"notify\", {\n      type: \"OPEN_POPUP_DISCUSSION\",\n      args: {} });\n\n  } });\n\n\nbizagi.injector.register('bizagi.workportal.widgets.project.discussion.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.discussion.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Case State Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.caseState\", {}, {\n  /*\r\n                                                                                              *   Constructor\r\n                                                                                              */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.contextsSidebarActivity = params.contextsSidebarActivity;\n\n    //Regional\n    self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\n\n    //Load templates\n    self.loadTemplates({\n      \"project-caseState\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.caseState\").concat(\"#project-caseState-wrapper\"),\n      \"project-caseState-remaining\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.caseState\").concat(\"#project-caseState-remaining\"),\n      \"project-cancel-case-button\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.caseState\").concat(\"#project-caseState-cancel-case-button\") });\n\n  },\n\n  /**\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  /*\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    var cntxtSidebarActivity = self.contextsSidebarActivity || [];\n    //Handlers\n    cntxtSidebarActivity.forEach(function (context) {\n      self.sub(context, $.proxy(self.updateView, self));\n    });\n  },\n\n  /**\r\n      * Update view when load case\r\n      * @param event\r\n      * @param params\r\n      */\n  updateView: function updateView(event, params) {\n    var self = this;\n    $.extend(self.params, params.args);\n    var args = params.args;\n    self.getContent().empty();\n\n    var argsTemplate = {};\n\n    //is Favorite Case\n    argsTemplate.isFavoriteCase = \"off\";\n    if (args.isFavorite && JSON.parse(args.isFavorite)) {\n      argsTemplate.isFavoriteCase = \"bz-icon-star\";\n    } else\n    {\n      argsTemplate.isFavoriteCase = \"bz-icon-star-outline\";\n    }\n\n    self.showCaseNumber(args, argsTemplate);\n\n    //Begin Calculated Remaining Date\n    if (args.creationDate) {\n      var MOMENT_FORMAT = \"MM/DD/yyyy H:mm\";\n      var timeZoneName = bizagi.currentUser.timeZoneName;\n      var creationDate = args.creationDate;\n      var creationDateObject = self.getDateWithTimezone(MOMENT_FORMAT, timeZoneName, creationDate);\n\n      argsTemplate.creationDateFormat = self.getFormattedDate(creationDateObject);\n\n      var solutionDateObject = self.getDateWithTimezone(MOMENT_FORMAT, timeZoneName, args.solutionDate);\n      argsTemplate.solutionDateFormat = self.getFormattedDate(solutionDateObject);\n\n      var currentDate = self.getDateWithTimezone(MOMENT_FORMAT, timeZoneName);\n      self.calculateDataForTemplate(argsTemplate, creationDateObject, currentDate, solutionDateObject, args);\n    }\n    $(self.getContent()).on(\"click\", \".show-diagram-case\", function () {\n      var isAdhoc = false;\n      if (!self.params.isAdhocProcess || typeof self.params.isAdhocProcess === 'undefined') {\n        isAdhoc = false;\n      } else {\n        isAdhoc = true;\n      }\n      if (isAdhoc) {\n        self.showGraphicQuery({ idCase: self.params.idCaseForGraphicQuery || self.params.idCase, idWorkflow: self.params.idWorkFlow, isAdhoc: true, idProcess: self.params.idAdhocProcess });\n      } else {\n        self.showGraphicQuery({ idCase: self.params.idCaseForGraphicQuery || self.params.idCase, idWorkflow: self.params.idWorkflow });\n      }\n\n    });\n\n    $(self.getContent()).on(\"click\", \".show-process-help\", function () {\n      self.showHelpUrl(self.params.helpUrl);\n    });\n\n  },\n\n  /**\r\n      * Calculate percent bar\r\n      * @param argsTemplate\r\n      * @param creationDateObject\r\n      * @param currentDate\r\n      * @param solutionDateObject\r\n      * @param args\r\n      */\n  calculateDataForTemplate: function calculateDataForTemplate(argsTemplate, creationDateObject, currentDate, solutionDateObject, args) {\n    var self = this;\n    var $content = self.getContent();\n    var MOMENT_FORMAT = \"MM/DD/yyyy H:mm\";\n    var timeZoneName = bizagi.currentUser.timeZoneName;\n    var paramsEffectiveDuration = {};\n    paramsEffectiveDuration.idUser = bizagi.currentUser.idUser;\n    if (bizagi.util.parseBoolean(args.isOpen)) {\n      paramsEffectiveDuration.fromDate = creationDateObject.getTime();\n      paramsEffectiveDuration.toDate = currentDate.getTime();\n    } else\n    {\n      paramsEffectiveDuration.fromDate = solutionDateObject.getTime();\n      paramsEffectiveDuration.toDate = currentDate.getTime();\n    }\n\n    var differenceCreationToCurrent = paramsEffectiveDuration.toDate - paramsEffectiveDuration.fromDate;\n    var actualDate = self.getDateWithTimezone(MOMENT_FORMAT, timeZoneName);\n    var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(actualDate.getTime() - differenceCreationToCurrent), null, false, timeZoneName);\n    if (bizagi.util.parseBoolean(args.isOpen)) {\n      argsTemplate.relativeTimeState = bizagi.localization.getResource(\"workportal-project-case-state-opened\").replace(\"%s\", relativeTime);\n      argsTemplate.colorStateCase = \"Opened\";\n    } else\n    {\n      argsTemplate.relativeTimeState = bizagi.localization.getResource(\"workportal-project-case-state-closed\").replace(\"%s\", relativeTime);\n      argsTemplate.colorStateCase = \"Closed\";\n    }\n\n    argsTemplate.percentCompleteBar = 100;\n    argsTemplate.isOpen = bizagi.util.parseBoolean(args.isOpen);\n    //Update widget\n    var contentTemplate = self.getTemplate(\"project-caseState-remaining\");\n    contentTemplate.\n    render($.extend(args, argsTemplate)).\n    appendTo($(\"#ui-bizagi-remaining\", $content));\n  },\n\n\n  /**\r\n      * Show cancel case button\r\n      * @param {JSON} args \r\n      * @param {Template} argsTemplate \r\n      * @param {Boolean} showCancelCase \r\n      */\n  showCancelCase: function showCancelCase(args, argsTemplate, _showCancelCase) {\n    var self = this;\n    var $content = self.getContent();\n    var contentTemplate = self.getTemplate(\"project-cancel-case-button\");\n\n    argsTemplate.buttonCancelCase = _showCancelCase;\n    contentTemplate.render($.extend(args, argsTemplate)).appendTo($(\"#ui-bizagi-cancel-case\", $content));\n    $(\"#ui-bizagi-wp-project-activity-cancel-case-button > a\", self.content).click(function () {\n      var widgetParameters = {\n        widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_CANCEL_CASE,\n        maximize: false,\n        dialogClass: 'bz-cancel-case-widget',\n        idWorkitem: self.params.idWorkitem,\n        idCase: self.params.idCase,\n        modalParameters: {\n          refreshInbox: false,\n          title: bizagi.localization.getResource(\"workportal-widget-cancel-case-title\"),\n          width: 420,\n          height: 400 },\n\n        closeVisible: false };\n\n      self.publish(\"showDialogWidget\", widgetParameters);\n    });\n  },\n\n  /**\r\n      * Show case number\r\n      * @param args\r\n      * @param argsTemplate\r\n      */\n  showCaseNumber: function showCaseNumber(args, argsTemplate) {\n    var self = this;\n    var $content = self.getContent();\n    var contentTemplate = self.getTemplate(\"project-caseState\");\n    var isAdhoc = false;\n    if (!this.params.isAdhocProcess || typeof this.params.isAdhocProcess === 'undefined') {\n      isAdhoc = false;\n    } else\n    {\n      isAdhoc = this.params.isAdhocProcess;\n    }\n\n    self.params.helpUrl = bizagi.util.validateUrlWellFormed(self.params.helpUrl);\n\n    contentTemplate.\n    render(\n    $.extend(\n    args,\n    argsTemplate,\n    {\n      security: bizagi.menuSecurity,\n      isAdhocProcess: isAdhoc,\n      urlHelp: !bizagi.util.isEmpty(self.params.helpUrl) })).\n\n\n\n    appendTo($content);\n    self._startShowCancelCase(args, argsTemplate);\n    //Handle events\n    $(\".case-summary-favorite\", $content).on(\"click\", $.proxy(self.onClickFavorite, self));\n    // Set back and next case navigation\n    $(\".case-summary-back\", self.content).on(\"click\", $.proxy(self.goToCase, self, 'back'));\n    $(\".case-summary-next\", self.content).on(\"click\", $.proxy(self.goToCase, self, 'next'));\n\n    self.showBackNextNavigation();\n  },\n\n  /**\r\n      * wait for showCancelCase value from Navigator widget\r\n      * @param {JSON} args \r\n      * @param {Template} argsTemplate \r\n      */\n  _startShowCancelCase: function _startShowCancelCase(args, argsTemplate) {\n    var self = this,\n    _navigatorWidget = bizagi.injector.get(\"bizagi.workportal.widgets.navigator\"),\n    _start = self.showCancelCase.bind(self, args, argsTemplate);\n\n    _navigatorWidget.getShowCancelCase().done(_start);\n  },\n\n  /**\r\n      * Get Format date\r\n      * @param dateObj\r\n      * @returns {string}\r\n      */\n  getFormattedDate: function getFormattedDate(dateObj) {\n    var self = this;\n    var monthsNames = self.datePickerRegional.monthNames;\n    var shortMonth = dateObj.getMonth();\n    var bizagiLanguage = BIZAGI_LANGUAGE;\n    if (bizagiLanguage != null && bizagiLanguage != undefined && bizagiLanguage.length > 0 && bizagiLanguage.substring(0, 2) == \"fr\")\n    return $.datepicker.formatDate(\"dd\", dateObj) + \" \" + monthsNames[shortMonth];else\n\n    return monthsNames[shortMonth] + \" \" + $.datepicker.formatDate(\"dd\", dateObj);\n  },\n\n  /***\r\n      * Events\r\n      */\n  onClickFavorite: function onClickFavorite(event) {\n    event.preventDefault();\n    var self = this;\n    var favoriteOptions = {};\n    if ($(event.target).hasClass(\"bz-icon-star-outline\")) {\n      favoriteOptions = {\n        idObject: self.params.idCase,\n        favoriteType: \"CASES\" };\n\n      $.when(self.dataService.addFavorite(favoriteOptions)).done(function (favoritesData) {\n        self.params.guidFavorite = favoritesData.idFavorites;\n        $(event.target).removeClass(\"bz-icon-star-outline\");\n        $(event.target).addClass(\"bz-icon-star\");\n      });\n    } else\n    {\n      favoriteOptions = {\n        idObject: self.params.guidFavorite,\n        favoriteType: \"CASES\" };\n\n      $.when(self.dataService.delFavorite(favoriteOptions)).done(function () {\n        $(event.target).addClass(\"bz-icon-star-outline\");\n        $(event.target).removeClass(\"bz-icon-star\");\n      });\n    }\n  },\n\n  showHelpUrl: function showHelpUrl(urlHelp) {\n    window.open(urlHelp);\n  },\n\n  /**\r\n      * Call service effective duration by schedule work\r\n      * @param params\r\n      * @return {*}\r\n      */\n  callGetEffectiveDuration: function callGetEffectiveDuration(params) {\n    var self = this;\n    var d = $.Deferred();\n\n    if (params.fromDate) {\n      $.when(\n      self.dataService.getEffectiveDuration(params)).\n      done(function (data) {\n        d.resolve(data);\n      });\n    } else\n    {\n      d.resolve(null);\n    }\n\n    return d.promise();\n  },\n\n  /**\r\n      * Clean plugins and events\r\n      */\n  clean: function clean() {\n    var self = this;\n    $(\".show-diagram-case\", self.getContent()).off();\n    var cntxtSidebarActivity = self.contextsSidebarActivity || [];\n    this.params = {};\n    cntxtSidebarActivity.forEach(function (context) {\n      self.unsub(context, $.proxy(self.updateView, self));\n    });\n  },\n\n  goToCase: function goToCase(action) {\n    var self = this;\n    var idCase = action == 'back' ? self.getBackCase() : self.getNextCase();\n    if (idCase > 0) {\n      self.publish(\"executeAction\", {\n        action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\n        idCase: idCase });\n\n    }\n  },\n\n  getListKey: function getListKey() {\n    var self = this;\n    bizagi.lstIdCases = bizagi.lstIdCases || {};\n    if (bizagi.lstIdCases.length > 1) {\n      for (var i = 0; i < bizagi.lstIdCases.length; i++) {\n        if (self.params.idCase == bizagi.lstIdCases[i]) {\n          return i;\n        }\n      }\n    }\n    return -1;\n  },\n\n  getNextCase: function getNextCase() {\n    var self = this;\n    var nextIdCase = 0;\n    var key = self.getListKey();\n\n    // Check if last element\n    if (bizagi.lstIdCases.length == key + 1 || bizagi.lstIdCases.length == 1) {\n      nextIdCase = -1;\n    } else {\n      nextIdCase = bizagi.lstIdCases[key + 1];\n    }\n\n    return nextIdCase;\n  },\n\n  getBackCase: function getBackCase() {\n    var self = this;\n    var prevIdCase = 0;\n    var key = self.getListKey();\n\n    // Check if first element\n    if (key == 0) {\n      prevIdCase = -1;\n    } else {\n      prevIdCase = bizagi.lstIdCases[key - 1] || -1;\n    }\n\n    return prevIdCase;\n  },\n\n  showBackNextNavigation: function showBackNextNavigation() {\n    var self = this;\n    var nextCase = self.getNextCase();\n    var backCase = self.getBackCase();\n    nextCase <= 0 ? $(\".case-summary-next\", self.content).hide() : $(\".case-summary-next\", self.content).show();\n    backCase <= 0 ? $(\".case-summary-back\", self.content).hide() : $(\".case-summary-back\", self.content).show();\n\n    if (nextCase <= 0 && backCase <= 0) {\n      $(\".content-right-sidebar\").removeClass(\"bz-state-number--active-case\");\n      $(\".bz-case-navigation\").hide();\n    } else\n    {\n      $(\".content-right-sidebar\").addClass(\"bz-state-number--active-case\");\n      $(\".bz-case-navigation\").show();\n    }\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.caseState\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.caseState]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Activity State Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activityState\", {}, {\n  /*\r\n                                                                                                  *   Constructor\r\n                                                                                                  */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.contextsSidebarActivity = params.contextsSidebarActivity;\n\n    //Regional\n    self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\n\n    //Load templates\n    self.loadTemplates({\n      \"project-activityState-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.activityState\").concat(\"#project-activityState-wrapper\") });\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  /*\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    //Handlers\n    self.contextsSidebarActivity.forEach(function (context) {\n      self.sub(context, $.proxy(self.updateView, self));\n    });\n\n  },\n\n  updateView: function updateView(event, params) {\n    var self = this,\n    args = params.args;\n    self.params = args;\n    self.getContent();\n    var timeZoneName = bizagi.currentUser.timeZoneName;\n    var argsTemplate = {};\n    var currentState = args.currentState || [];\n\n    var currentWorkitem = currentState.filter(function (objectWorkItem) {return objectWorkItem.idWorkItem == args.idWorkitem;})[0];\n\n\n    if (currentWorkitem) {\n      argsTemplate.activityName = currentWorkitem.state;\n      argsTemplate.activityIsEvent = bizagi.util.parseBoolean(currentWorkitem.isEvent);\n\n      var MOMENT_FORMAT = \"MM/DD/yyyy H:mm\";\n      var initDateObject = self.getDateWithTimezone(MOMENT_FORMAT, timeZoneName, currentWorkitem.entryDateWorkItem);\n      if (initDateObject.getTime) {\n        argsTemplate.initDateFormat = self.getFormattedDate(initDateObject);\n      }\n\n      var currentDate = self.getDateWithTimezone(MOMENT_FORMAT, timeZoneName);\n      var estimatedSolutionDateObject = self.getDateWithTimezone(MOMENT_FORMAT, timeZoneName, currentWorkitem.estimatedSolutionDate);\n      argsTemplate.estimatedSolutionDateFormat = \"\";\n\n      if (initDateObject.getTime && estimatedSolutionDateObject.getTime && currentWorkitem) {\n        self.calculateDataForTemplate(currentWorkitem, argsTemplate, initDateObject, currentDate, estimatedSolutionDateObject, currentState);\n      } else\n      {\n        //Update widget\n        self.updateTemplateWidget(argsTemplate, currentState);\n      }\n    }\n  },\n\n  initilizeActionMenu: function initilizeActionMenu(currentState) {\n    var self = this;\n    var allowsReassign = false;\n\n    if (currentState && currentState.length > 0) {\n      for (j = 0; j < currentState.length; ++j) {\n        if (currentState[j] && self.params && currentState[j].idWorkItem == self.params.idWorkitem) {\n          allowsReassign = bizagi.util.parseBoolean(currentState[j].allowsReassign) || false;\n        }\n      }\n    }\n    var btReassing = $(\"#bt-case-action-reassing\", self.content);\n    var btShareActivity = $(\"#ui-bizagi-wp-project-activity-button:not(.ui-bizagi-wp-project-activity-shared)\", self.content);\n\n    if (allowsReassign) {\n      btReassing.show();\n    }\n    btReassing.on(\"click\", function () {\n      self.onClickMenuReasign();\n    });\n    btShareActivity.on(\"click\", function () {\n      self.onClickShareActivity();\n    });\n  },\n  /**\r\n       * Executed when user reasign case\r\n       */\n  onClickMenuReasign: function onClickMenuReasign() {\n    var self = this;\n    var idCase = self.params.idCase;\n    var idWorkItem = self.params.idWorkitem,\n    onCloseSaveDialogBox = function onCloseSaveDialogBox() {\n      self.publish(\"closeCurrentDialog\");\n    };\n    bizagi.loader.startAndThen(\"admin\").then(function () {\n      $.when(self.publish(\"showDialogWidget\", {\n        widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,\n        data: {\n          \"idCase\": idCase,\n          \"idWorkItem\": idWorkItem,\n          closeDialogWidget: onCloseSaveDialogBox },\n\n        closeVisible: false,\n        maximize: true,\n        modalParameters: {\n          title: bizagi.localization.getResource(\"render-actions-reassign\"),\n          width: \"910px\",\n          id: \"CaseAdmin\" } }));\n\n\n    });\n  },\n\n  /**\r\n      * let share the activity\r\n      */\n  onClickShareActivity: function onClickShareActivity() {\n    var self = this;\n    var params = {\n      \"idWorkItem\": self.params.idWorkitem };\n\n    var button = $(\"#ui-bizagi-wp-project-activity-button\", self.content);\n    button.attr(\"disabled\", true);\n    $.when(self.dataService.getShareActivity(params)).done(function (data) {\n      var notifier = window.parent.bizagi.injector.get('notifier');\n      if (data.value === true) {\n        button.addClass(\"ui-bizagi-wp-project-activity-shared\").\n        unbind(\"click\");\n        notifier.showSucessMessage(bizagi.localization.getResource(\"workportal-project-activity-success-message\"), '');\n      } else {\n        notifier.showErrorMessage(bizagi.localization.getResource(\"workportal-project-activity-error-message\"), '');\n      }\n    }).always(function () {\n      button.attr(\"disabled\", false);\n    });\n  },\n\n  calculateDataForTemplate: function calculateDataForTemplate(currentWorkitem, argsTemplate, creationDateObject, currentDate, estimatedSolutionDateObject, currentState) {\n    var self = this;\n    var MOMENT_FORMAT = \"MM/DD/yyyy H:mm\";\n    var timeZoneName = bizagi.currentUser.timeZoneName;\n    var diffMillisecondsCurrentToEstimated = currentDate.getTime() - estimatedSolutionDateObject.getTime();\n    var diffMillisecondsCreationToSolution = creationDateObject.getTime() - estimatedSolutionDateObject.getTime();\n\n    var paramsEffectiveDurationOpened = {\n      idUser: bizagi.currentUser.idUser,\n      fromDate: creationDateObject.getTime(),\n      toDate: self.getDateWithTimezone(MOMENT_FORMAT, timeZoneName).getTime() };\n\n\n    var currentDateExceededEstimatedDate = false;\n    var paramsEffectiveDuration = {\n      idUser: bizagi.currentUser.idUser,\n      fromDate: currentDate.getTime(),\n      toDate: estimatedSolutionDateObject.getTime() };\n\n    var paramsEffectiveDurationInitialToEstimated = {};\n    if (diffMillisecondsCurrentToEstimated > 0) {//Exceeded limit estimatedSolution\n      paramsEffectiveDuration.fromDate = estimatedSolutionDateObject.getTime();\n      paramsEffectiveDuration.toDate = currentDate.getTime();\n      currentDateExceededEstimatedDate = true;\n    } else\n    {\n      paramsEffectiveDurationInitialToEstimated.idUser = bizagi.currentUser.idUser;\n      paramsEffectiveDurationInitialToEstimated.fromDate = creationDateObject.getTime();\n      paramsEffectiveDurationInitialToEstimated.toDate = estimatedSolutionDateObject.getTime();\n    }\n\n    var differenceCreatedToCurrent = paramsEffectiveDurationOpened.toDate - paramsEffectiveDurationOpened.fromDate;\n    var differenceCurrentToEstimated = paramsEffectiveDuration.toDate - paramsEffectiveDuration.fromDate;\n    var differenceInitialToEstimated = diffMillisecondsCurrentToEstimated > 0 ? 0 : paramsEffectiveDurationInitialToEstimated.toDate - paramsEffectiveDurationInitialToEstimated.fromDate;\n\n    var actualDate = self.getDateWithTimezone(MOMENT_FORMAT, timeZoneName);\n    var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(actualDate.getTime() - differenceCreatedToCurrent), null, false, timeZoneName);\n    argsTemplate.colorState = currentWorkitem.colorState;\n    argsTemplate.relativeTimeState = bizagi.localization.getResource(\"workportal-project-activity-state-opened\").replace(\"%s\", relativeTime);\n    argsTemplate.percentCompleteBar = 100;\n\n    if (diffMillisecondsCreationToSolution === 0) {\n      argsTemplate.showEstimatedSolutionDate = false;\n    } else\n    {\n      argsTemplate.showEstimatedSolutionDate = true;\n      if (currentDateExceededEstimatedDate === false) {\n        var percentBar = self.getPercentBar(differenceInitialToEstimated / 1000 / 60, differenceCurrentToEstimated / 1000 / 60);\n        argsTemplate.percentCompleteBar = percentBar.percent;\n      }\n    }\n\n    if (currentWorkitem) {\n      argsTemplate.isEvent = bizagi.util.parseBoolean(currentWorkitem.isEvent);\n      argsTemplate.canShareActivity = currentWorkitem.canShareActivity;\n      argsTemplate.isShared = currentWorkitem.isShared;\n    }\n\n    argsTemplate.estimatedSolutionDateFormat = self.getFormattedDate(estimatedSolutionDateObject);\n\n    //Update widget\n    self.updateTemplateWidget(argsTemplate, currentState);\n  },\n\n  getPercentBar: function getPercentBar(totalMinutes, sectionMinutes) {\n    var response = {};\n    response.percent = Math.round((1 - sectionMinutes / totalMinutes) * 100);\n    return response;\n  },\n\n\n  updateTemplateWidget: function updateTemplateWidget(argsTemplate, currentState) {\n    var self = this,\n    $content = self.getContent().empty();\n    if (bizagi.override.enableShareActivity === false) {\n      argsTemplate.canShareActivity = false;\n      argsTemplate.isShared = false;\n    }\n    //Update widget\n    var contentTemplate = self.getTemplate(\"project-activityState-wrapper\");\n    contentTemplate.\n    render(argsTemplate).appendTo($content);\n\n    if (currentState.length > 0) {\n      self.initilizeActionMenu(currentState);\n    }\n    self.shareActivityTooltip();\n  },\n\n  /**\r\n      * show tooltip when the activity is shared or can be\r\n      */\n  shareActivityTooltip: function shareActivityTooltip() {\n    var self = this;\n    var activityButton = $(\"#ui-bizagi-wp-project-activity-button\", self.content);\n    activityButton.on('mouseenter', function () {\n      var texto = activityButton.hasClass(\"ui-bizagi-wp-project-activity-shared\") ? \"workportal-project-activity-shared\" : \"workportal-project-activity-share\";\n      activityButton.attr(\"title\", bizagi.localization.getResource(texto));\n    });\n    activityButton.tooltip({\n      tooltipClass: \"custom-tooltip-styling-bottom-bar\",\n      position: {\n        my: 'right top',\n        at: 'left top',\n        of: activityButton,\n        collision: 'flip' } });\n\n\n  },\n\n  getFormattedDate: function getFormattedDate(dateObj) {\n    var self = this;\n    var monthsNames = self.datePickerRegional.monthNames;\n    var shortMonth = dateObj.getMonth();\n    var bizagiLanguage = BIZAGI_LANGUAGE;\n    if (bizagiLanguage != null && bizagiLanguage != undefined && bizagiLanguage.length > 0 && bizagiLanguage.substring(0, 2) == \"fr\")\n    return $.datepicker.formatDate(\"dd\", dateObj) + \" \" + monthsNames[shortMonth];else\n\n    return monthsNames[shortMonth] + \" \" + $.datepicker.formatDate(\"dd\", dateObj);\n  },\n\n  clean: function clean() {\n    var self = this;\n    var cntxtSidebarActivity = self.contextsSidebarActivity || [];\n    this.params = {};\n    cntxtSidebarActivity.forEach(function (context) {\n      self.unsub(context, $.proxy(self.updateView, self));\n    });\n  },\n\n  /**\r\n      * Call services\r\n      */\n  callGetEffectiveDuration: function callGetEffectiveDuration(params) {\n    var self = this;\n    var d = $.Deferred();\n\n    //Fix .NET, multiple call service with same data in a few milliseconds\n    setTimeout(function () {\n      if (params.fromDate) {\n        $.when(\n        self.dataService.getEffectiveDuration(params)).\n        done(function (data) {\n          d.resolve(data);\n        });\n      } else\n      {\n        d.resolve(null);\n      }\n    }, 200);\n\n\n    return d.promise();\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.activityState\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.activityState]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Process State Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.processState\", {}, {\n  /*\r\n                                                                                                 *   Constructor\r\n                                                                                                 */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.contextsSidebarActivity = params.contextsSidebarActivity;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-process-state\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processState\").concat(\"#project-process-state\") });\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    var template = self.getTemplate(\"project-process-state\");\n    self.content = template.render({});\n    return self.content;\n  },\n\n  /*\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n\n    //Handlers\n    self.contextsSidebarActivity.forEach(function (context) {\n      self.sub(context, $.proxy(self.updateView, self));\n    });\n  },\n\n  updateView: function updateView(event, params) {\n    var self = this,\n    args = params.args,\n    $content = self.getContent().empty();\n    self.params = args;\n\n    var argsTemplate = {};\n    argsTemplate[\"showParentProcess\"] = args[\"idParentCase\"] >= 1 ? true : false;\n    argsTemplate[\"parentProcess\"] = {\n      \"displayName\": args[\"parentDisplayName\"],\n      \"idCase\": args[\"idParentCase\"],\n      \"idWorkItem\": args[\"idWorkItem\"],\n      \"idTask\": args[\"idTask\"] == \"0\" ? \"\" : args[\"idTask\"],\n      \"idWorkflow\": args[\"idWorkflowParentCase\"] };\n\n\n    //Update widget\n    var contentTemplate = self.getTemplate(\"project-process-state\");\n    contentTemplate.\n    render($.extend(args, argsTemplate)).\n    appendTo($content);\n\n    //handle click\n\n    $(\"#go-to-parent-case\", $content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\n\n  },\n\n  onClickGoToParentCase: function onClickGoToParentCase(event) {\n    event.preventDefault();\n    var self = this;\n\n    self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\n  },\n\n  clean: function clean() {\n    var self = this;\n    self.params = {};\n    self.contextsSidebarActivity.forEach(function (context) {\n      self.unsub(context, $.proxy(self.updateView, self));\n    });\n  } });\n\n\n\nbizagi.injector.register('bizagi.workportal.widgets.project.processState', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.processState]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Users Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.users\", {}, {\n  /*\r\n                                                                                          *   Constructor\r\n                                                                                          */\n  init: function init(workportalFacade, dataService, relatedusers, params) {\n    var self = this;\n    self.relatedusers = relatedusers;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.contextsSidebarActivity = params.contextsSidebarActivity;\n\n    self.plugins = {};\n    self.users = [];\n    self.loadedUsers = false;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-users\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.users\").concat(\"#project-users-main\") });\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  /*\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n\n    //Handlers\n    self.contextsSidebarActivity.forEach(function (context) {\n      self.sub(context, $.proxy(self.updateView, self));\n    });\n    self.sub('ON_RENDER_FINISH', $.proxy(self.onRenderFinish, self));\n  },\n\n  updateView: function updateView(event, params) {\n    var self = this;\n    self.params = params;\n    setTimeout(function () {\n      if (self.loadedUsers === false) {\n        self.onRenderFinish();\n      }\n    }, 500);\n  },\n\n  onRenderFinish: function onRenderFinish() {\n    var self = this;\n    var args = self.params.args;\n    var $content = self.getContent().empty();\n    self.loadedUsers = true;\n\n    var contentTemplate = self.getTemplate(\"project-users\");\n    contentTemplate.render().appendTo($content);\n    self.showCreatorInformation($content);\n\n    var typesAssignUser = [{\n      id: args.createdBy.userId,\n      typeName: \"owner\" }];\n\n\n    if (args.idCase > 0) {\n      self.relatedusers.render(self.content, \".relatedusers-wrapper\", args.idCase, typesAssignUser);\n    }\n  },\n\n  /**\r\n      * show the information of the creator case\r\n      * @param {string} $content html conteiner\r\n      */\n  showCreatorInformation: function showCreatorInformation($content) {\n    var self = this;\n    var params = {\n      userIds: self.params.args.createdBy.userId,\n      width: 50,\n      height: 50 };\n\n\n    self.dataService.getUsersData(params).done(function (user) {\n      var userInfo = usersAdapter.createJsonUserInfo(\n      user[0].id,\n      user[0].name,\n      user[0].username,\n      user[0].picture ? \"data:image/png;base64,\" + user[0].picture : undefined,\n      user[0].email,\n      user[0].name.getInitials(),\n      false,\n      true,\n      [],\n      []);\n\n      $content.find(\"#ui-bizagi-wp-project-users-wrapper .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\n    });\n  },\n\n  clean: function clean() {\n    var self = this;\n    self.loadedUsers = false;\n    self.contextsSidebarActivity.forEach(function (context) {\n      self.unsub(context, $.proxy(self.updateView, self));\n    });\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.users\", [\"workportalFacade\", \"dataService\", \"relatedusers\", bizagi.workportal.widgets.project.users]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Subprocesses Data Tooltip\r\n *   Author: Bizagi Latam\r\n */\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.subprocesses.data\", {\n\n  responseSubprocessState: {},\n  responseSubprocess: function responseSubprocess(newValue) {\n    if (newValue) {\n      responseSubprocessState = newValue;\n    }\n    return responseSubprocessState;\n  },\n\n  auxArrayListSubprocessesState: [],\n  auxArrayListSubprocesses: function auxArrayListSubprocesses(newItem) {\n    if (newItem) {\n      if (jQuery.isArray(newItem) && newItem.length === 0) {\n        this.auxArrayListSubprocessesState.length = 0; //clean array if change reference\n      } else\n      {\n        return this.auxArrayListSubprocessesState.push(newItem);\n      }\n    } else\n    {\n      return this.auxArrayListSubprocessesState;\n    }\n  } },\n{\n  /*\r\n   *   Constructor\r\n   */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    // Init static properties\n    self.Class.auxArrayListSubprocesses([]);\n\n    //Load templates\n    self.loadTemplates({\n      \"project-subprocesses-tootip-custom-properties\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.subprocesses.data\").concat(\"#project-subprocesses-tooltip-custom-properties-wrapper\") });\n\n  },\n\n\n  initializeTooltip: function initializeTooltip(selectorTooltip) {\n    var self = this;\n    var $content = self.getContent();\n\n    $(selectorTooltip, $content).tooltip({\n      position: {\n        collision: \"flipfit\",\n        my: \"right center\", at: \"left-10 center\" },\n\n      show: null, // show immediately\n      content: function content() {\n\n        var idCase = $(this).closest(\"li\").find(\"#idCase\").val();\n        var itemsFinded = self.Class.auxArrayListSubprocesses().filter(function (item) {\n          return item.idCase == idCase;\n        });\n\n        var indexSubprocess, idCustData, text;\n        if (itemsFinded.length > 0) {\n          indexSubprocess = itemsFinded[0].indexSubprocess;\n          idCustData = itemsFinded[0].idCustData;\n          text = $(this).text();\n\n          return self.getContentTooltip(indexSubprocess, idCustData, text,\n          self.getTemplate(\"project-subprocesses-tootip-custom-properties\"));\n        }\n\n\n      },\n      open: function open(event, ui) {\n        if (typeof event.originalEvent === 'undefined') {\n          return false;\n        }\n        var $id = $(ui.tooltip).attr('id');\n        // close any lingering tooltips\n        $('div.ui-tooltip').not('#' + $id).remove();\n      },\n      close: function close(event, ui) {\n        ui.tooltip.hover(function () {\n          $(this).stop(true).fadeTo(400, 1);\n        },\n        function () {\n          $(this).fadeOut('400', function () {\n            $(this).remove();\n          });\n        });\n      } });\n\n  },\n\n  getContentTooltip: function getContentTooltip(indexSubprocess, idCustData, textLI, templateTooltip) {\n    var self = this;\n\n    //when not show custom columns\n    if (idCustData == \"-1\") {\n      idCustData = \"0\"; //So show only basic data subprocess\n    }\n\n    var rowCustomProperty = function rowCustomProperty(nameProperty, valueProperty) {\n      return {\n        nameProperty: nameProperty,\n        valueProperty: valueProperty };\n\n    };\n\n    var arrayCustomsProperties = [];\n    var auxValueProperty = \"\";\n    var subprocessData = self.getSubprocessData(indexSubprocess, idCustData);\n    var custData = subprocessData.custData;\n    var custDataTypes = subprocessData.custDataTypes;\n    var custFields = subprocessData.custFields;\n    var displayName = subprocessData.displayName;\n\n    //subproceso\n    arrayCustomsProperties.push(new rowCustomProperty(bizagi.localization.getResource(\"workportal-widget-inboxcommon-subprocess\"), displayName));\n\n    //Others custom properties\n    if (custData.length) {\n      for (var i = 0; i < custData.length; i += 1) {\n        auxValueProperty = custData[i];\n        if (custDataTypes) {\n          if (custDataTypes[i] == \"Money\") {\n            auxValueProperty = bizagi.util.formatMonetaryCell(auxValueProperty);\n          } else {\n            if (custDataTypes[i] == \"Boolean\") {\n              auxValueProperty = bizagi.util.formatBoolean(auxValueProperty);\n            } else {\n              if (custDataTypes[i] == \"Float\" || custDataTypes[i] == \"Real\") {\n                auxValueProperty = bizagi.util.formatDecimalCell(auxValueProperty);\n              } else\n              {\n                if (typeof auxValueProperty === \"function\") {\n                  auxValueProperty = \"\";\n                }\n              }\n            }\n          }\n        }\n        arrayCustomsProperties.push(new rowCustomProperty(custFields[i], auxValueProperty));\n      }\n    }\n\n    //Render properties\n    var objectTemplate = {};\n    objectTemplate.arrayCustomsProperties = arrayCustomsProperties;\n    objectTemplate.nameSubprocess = textLI;\n    var contentTemplate = templateTooltip;\n    var contentTableCustomProperties = $('<div class=\"bizagi-custom-tooltip-subprocesses\"></div>');\n    contentTemplate.render(objectTemplate).appendTo(contentTableCustomProperties);\n\n    return contentTableCustomProperties.html();\n  },\n\n  getSubprocessData: function getSubprocessData(indexSubprocess, idCustData) {\n    var self = this;\n    var subProcessData = {};\n    var subProcess = self.Class.responseSubprocess().subProcesses;\n    var subProcPersonalized = self.Class.responseSubprocess().subProcPersonalized;\n\n    if (subProcess && subProcess.length > 0) {\n      subProcessData.custData = subProcess[indexSubprocess].custData;\n      subProcessData.custDataTypes = subProcess[indexSubprocess].custDataTypes;\n      var customFields = self.Class.responseSubprocess().CustFields[idCustData];\n      subProcessData.custFields = customFields[Object.keys(customFields)[0]];\n      subProcessData.displayName = subProcess[indexSubprocess].displayName;\n    } else if (subProcPersonalized && Object.keys(subProcPersonalized).length > 0) {\n      subProcessData.custData = subProcPersonalized[0].subProcesses[indexSubprocess].custData;\n      subProcessData.custDataTypes = subProcPersonalized[0].subProcesses[indexSubprocess].custDataTypes;\n      subProcessData.custFields = subProcPersonalized[0].CustFields[0];\n      subProcessData.displayName = subProcPersonalized[0].subProcesses[indexSubprocess].displayName;\n    }\n    return subProcessData;\n  },\n\n\n  clean: function clean() {\n\n  } });\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.subprocesses.data\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.subprocesses.data]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Events Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.subprocesses.data.extend(\"bizagi.workportal.widgets.project.events\", {}, {\n  /*\r\n                                                                                                              *   Constructor\r\n                                                                                                              */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.contextsSidebarActivity = params.contextsSidebarActivity;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-events\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.events\").concat(\"#project-events-wrapper\") });\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    var template = self.getTemplate(\"project-events\");\n    self.content = template.render({});\n    return self.content;\n  },\n\n  /*\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n\n    //Handlers\n    self.contextsSidebarActivity.forEach(function (context) {\n      self.sub(context, $.proxy(self.updateView, self));\n    });\n  },\n\n  updateView: function updateView(event, params) {\n    var self = this,\n    args = params.args,\n    $content = self.getContent().empty();\n    self.params = args;\n\n    $.when(self.getArgsTemplate(args)).done(function (responseArgsTemplate) {\n      //Update widget\n      var contentTemplate = self.getTemplate(\"project-events\");\n      contentTemplate.\n      render($.extend(args, responseArgsTemplate)).\n      appendTo($content);\n\n      $(\".list-events li.event a\", $content).on(\"click\", $.proxy(self.onClickGoEvent, self));\n\n      self.initializeTooltip(\".list-events li\");\n    });\n  },\n\n  getArgsTemplate: function getArgsTemplate(args) {\n    var def = $.Deferred(),\n    argsTemplate = {},\n    self = this;\n\n    //check if show event tab or not\n    if (args[\"countEvents\"] >= 1) {\n      for (var i = 0; i < args[\"currentState\"].length; i++) {\n        if (args[\"currentState\"][i][\"isEvent\"] == \"true\" && args[\"currentState\"][i][\"idWorkItem\"] == args.idWorkitem) {\n          args[\"countEvents\"] = args[\"countEvents\"] - 1;\n        }\n      }\n    }\n    argsTemplate[\"showEvents\"] = args[\"countEvents\"] >= 1 ? true : false;\n\n    if (argsTemplate[\"showEvents\"]) {\n      $.when(self.callSummaryCaseEvents(args.idCase)).done(function (responseEvents) {\n        args[\"showEvents\"] = responseEvents[\"events\"].length >= 1 ? true : false;\n\n        if (args[\"showEvents\"]) {\n          argsTemplate[\"events\"] = [];\n          responseEvents[\"events\"].forEach(function (elementEvent) {\n            argsTemplate[\"events\"].push($.extend(elementEvent[Object.keys(elementEvent)[0]],\n            { idWorkFlow: responseEvents[\"idWorkFlow\"] }));\n          });\n        }\n        def.resolve(argsTemplate);\n      });\n    } else\n    {\n      def.resolve(argsTemplate);\n    }\n    return def.promise();\n  },\n\n  /**\r\n      * Events UI\r\n      */\n\n  onClickGoEvent: function onClickGoEvent(event) {\n    event.preventDefault();\n    var self = this;\n    $.when(bizagi.util.autoSave()).done(function () {\n      self.routingExecute($(event.target).closest(\"li\"));\n    });\n  },\n\n  /**\r\n      * Call services\r\n      */\n\n  /*\r\n          *  Get data for users\r\n          */\n  callSummaryCaseEvents: function callSummaryCaseEvents(idCase) {\n    var self = this,\n    def = $.Deferred();\n\n    $.when(\n    self.dataService.summaryCaseEvents({\n      idCase: idCase })).\n\n    done(function (events) {\n      def.resolve(events);\n    });\n\n    return def.promise();\n  },\n\n  clean: function clean() {\n    var self = this;\n    this.params = {};\n    self.contextsSidebarActivity.forEach(function (context) {\n      self.unsub(context, $.proxy(self.updateView, self));\n    });\n  } });\n\n\n\nbizagi.injector.register('bizagi.workportal.widgets.project.events', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.events], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Subprocesses Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\n\nbizagi.workportal.widgets.project.subprocesses.data.extend(\"bizagi.workportal.widgets.project.subprocesses\", {\n\n  responseSubprocess: function responseSubprocess(newValue) {\n    return this._super(newValue);\n  },\n\n  auxArrayListSubprocesses: function auxArrayListSubprocesses(newValue) {\n    return this._super(newValue);\n  } },\n\n{\n  /*\r\n   *   Constructor\r\n   */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    self.contextsSidebarActivity = params.contextsSidebarActivity;\n\n    //Load templates\n    self.loadTemplates({\n      \"project-subprocesses\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.subprocesses\").concat(\"#project-subprocesses-wrapper\") });\n\n  },\n\n  /*\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    self.content = $(\"<div></div>\");\n    return self.content;\n  },\n\n  /*\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n\n    //Handlers\n    self.contextsSidebarActivity.forEach(function (context) {\n      self.sub(context, $.proxy(self.updateView, self));\n    });\n  },\n\n  updateView: function updateView(event, params) {\n    var self = this,\n    args = params.args,\n    $content = self.getContent().empty();\n    self.params = args;\n\n    if (self.params.idCase > 0) {\n      $.when(\n      self.dataService.summarySubProcess({\n        idCase: self.params.idCase })).\n\n      done(function (responseSubprocess) {\n        self.Class.responseSubprocess(responseSubprocess);\n\n        self.organizeDataForSubprocesses(self.params);\n      });\n    }\n  },\n\n  organizeDataForSubprocesses: function organizeDataForSubprocesses(args) {\n    var self = this;\n    if (self.Class.responseSubprocess().showSubProcess) {\n      $.each(self.Class.responseSubprocess().subProcesses, function (key) {\n        var custData = self.Class.responseSubprocess().subProcesses[key].custData;\n        if (custData && custData.length) {\n          for (var i = 0; i < custData.length; i += 1) {\n            if (custData[i] === null) {\n              custData[i] = \"\";\n            }\n          }\n        }\n\n      });\n\n      var subProcess = self.Class.responseSubprocess().subProcesses || self.Class.responseSubprocess().subProcPersonalized;\n\n      //prepare array with subprocess\n      self.Class.auxArrayListSubprocesses([]);\n      for (var i = 0; i < Object.keys(subProcess).length; i += 1) {\n        var tempSubprocesses = subProcess[i];\n\n        self.Class.auxArrayListSubprocesses({\n          isOpen: tempSubprocesses.isOpen,\n          radNumber: tempSubprocesses.radNumber,\n          displayName: tempSubprocesses.displayName,\n          idCase: tempSubprocesses.idCase,\n          indexSubprocess: i,\n          idCustData: tempSubprocesses.idCustData });\n\n        if (tempSubprocesses.subProcesses) {\n          Object.keys(tempSubprocesses).forEach(function (key) {//only one iteration\n            self.Class.auxArrayListSubprocesses({\n              isOpen: tempSubprocesses[key].isOpen,\n              radNumber: tempSubprocesses[key].radNumber,\n              displayName: tempSubprocesses[key].displayName,\n              idCase: tempSubprocesses[key].idCase,\n              indexSubprocess: i,\n              idCustData: tempSubprocesses[key].idCustData });\n\n          });\n        }\n      }\n\n      self.renderWidget();\n    }\n  },\n\n  renderWidget: function renderWidget() {\n    var self = this;\n    var $content = self.getContent();\n\n    //Update widget\n    var contentTemplate = self.getTemplate(\"project-subprocesses\");\n    contentTemplate.\n    render({ auxArrayListSubprocesses: self.Class.auxArrayListSubprocesses() }).\n    appendTo($content);\n\n    $(\".list-subprocesses a\", $content).on(\"click\", $.proxy(self.onClickGoSubprocess, self));\n\n    self.initializeTooltip(\".list-subprocesses li\");\n  },\n\n\n  /**\r\n      * Events UI\r\n      */\n\n  onClickGoSubprocess: function onClickGoSubprocess(event) {\n    event.preventDefault();\n    var self = this;\n\n    self.routingExecute($(event.target).closest(\"li\"));\n  },\n\n  clean: function clean() {\n    var self = this;\n\n    self.params = {};\n    self.pluginTooltip = null;\n\n    self.contextsSidebarActivity.forEach(function (context) {\n      self.unsub(context, $.proxy(self.updateView, self));\n    });\n  } });\n\n\n\nbizagi.injector.register(\"bizagi.workportal.widgets.project.subprocesses\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.subprocesses]);","/*\r\n    Name   : Bizagi Workportal Project Activity Description\r\n    Created on : Jun 27, 2017\r\n    Author     : Diana Mogollon\r\n*/\n\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activity.description\", {}, {\n\n  /*\r\n                                                                                                         *   Constructor\r\n                                                                                                         */\n  init: function init(workportalFacade, dataService, params) {\n    var self = this;\n\n    // Call base\n    self._super(workportalFacade, dataService, params);\n\n    params = params || {};\n\n    //Load templates\n    self.loadTemplates({\n      \"project-activity-description\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.activity.description\").concat(\"#project-activity-description\") });\n\n  },\n\n  /**\r\n      * Renders the template defined in the widget\r\n      */\n  renderContent: function renderContent() {\n    var self = this;\n    var template = self.getTemplate(\"project-activity-description\");\n    self.content = template.render();\n    return self.content;\n  },\n\n  /**\r\n      * links events with handlers\r\n      */\n  postRender: function postRender() {\n    var self = this;\n    self.description = self.getWorkitemDescription();\n    if (self.description) {\n      self.callTaskDescription();\n    } else {\n      self.content = $('<div />');\n    }\n  },\n\n  /**\r\n      * \r\n      * Call task description widget \r\n      */\n\n  callTaskDescription: function callTaskDescription() {\n    var self = this;\n    var width = 310;\n    var taskDescriptionParams = {\n      container: $(\"#ui-bizagi-wp-project-activity-task_description_container\", self.content),\n      description: self.description,\n      width: width };\n\n    self.taskDescriptionWidget = new bizagi.workportal.widgets.task.description(self.workportalFacade, self.dataService, taskDescriptionParams);\n    self.taskDescriptionWidget.render();\n  },\n\n  getWorkitemDescription: function getWorkitemDescription() {\n    var self = this;\n    var params = self.params || {};\n    var idWorkitem = params.idWorkitem || 0;\n    var currentState = params.currentState || [];\n    var description = \"\";\n\n    for (var i = 0; i < currentState.length; i++) {\n      if (idWorkitem == currentState[i].idWorkItem) {\n        description = currentState[i].tskDescription;\n        break;\n      }\n    }\n\n    return description;\n  },\n\n  /**\r\n      * Clean widget\r\n      */\n  clean: function clean() {\n\n  } });\n\n\nbizagi.injector.register('bizagi.workportal.widgets.project.activity.description', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.activity.description], true);"]}