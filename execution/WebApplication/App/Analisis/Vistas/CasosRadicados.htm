<HTML>
<META name=VI60_defaultClientScript content=VBScript>
<!--BODY ONLOAD = "Window_OnLoad"-->
<div id="bancafe_27758" align=center x:publishsource="Excel">
<object id="PivotControl_Chart"
    codebase="file:\\W2abogdc02\Instalar\OFFICE\OF2000.PRM\Disco1\msowc.cab"
 classid="CLSID:0002E500-0000-0000-C000-000000000046" width="80%" height="30%">
 <param name=XMLData
 value="&lt;!--[if gte mso 9]&gt;&lt;xml xmlns:v=&quot;urn:schemas-microsoft-com:vml&quot;&#13;&#10; xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;&#13;&#10; xmlns:x=&quot;urn:schemas-microsoft-com:office:excel&quot;&gt;&#13;&#10; &lt;x:WebChart&gt;&#13;&#10;  &lt;x:Palette&gt;&#13;&#10;   &lt;x:Entry&gt;#000000&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FFFFFF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FF0000&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#00FF00&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#0000FF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FFFF00&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FF00FF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#00FFFF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#800000&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#008000&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#000080&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#808000&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#800080&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#008080&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#C0C0C0&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#808080&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#9999FF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#993366&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FFFFCC&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#CCFFFF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#660066&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FF8080&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#0066CC&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#CCCCFF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#000080&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FF00FF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FFFF00&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#00FFFF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#800080&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#800000&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#008080&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#0000FF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#00CCFF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#CCFFFF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#CCFFCC&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FFFF99&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#99CCFF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FF99CC&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#CC99FF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FFCC99&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#3366FF&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#33CCCC&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#99CC00&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FFCC00&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FF9900&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#FF6600&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#666699&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#969696&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#003366&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#339966&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#003300&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#333300&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#993300&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#993366&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#333399&lt;/x:Entry&gt;&#13;&#10;   &lt;x:Entry&gt;#333333&lt;/x:Entry&gt;&#13;&#10;  &lt;/x:Palette&gt;&#13;&#10;  &lt;x:DataSource&gt;&#13;&#10;   &lt;x:Type&gt;PivotList&lt;/x:Type&gt;&#13;&#10;  &lt;/x:DataSource&gt;&#13;&#10;  &lt;x:Chart&gt;&#13;&#10;   &lt;x:Name&gt;Gráfico 21&lt;/x:Name&gt;&#13;&#10;    &lt;x:Options&gt;&#13;&#10;    &lt;x:SizeWithWindow/&gt;&#13;&#10;   &lt;/x:Options&gt;&#13;&#10;   &lt;x:PageSetup&gt;&#13;&#10;    &lt;x:ChartSize&gt;FullPage&lt;/x:ChartSize&gt;&#13;&#10;   &lt;/x:PageSetup&gt;&#13;&#10;   &lt;x:Font&gt;&#13;&#10;    &lt;x:FontName&gt;Arial&lt;/x:FontName&gt;&#13;&#10;    &lt;x:Size&gt;10&lt;/x:Size&gt;&#13;&#10;    &lt;x:AutoScale/&gt;&#13;&#10;   &lt;/x:Font&gt;&#13;&#10;   &lt;x:Left&gt;0&lt;/x:Left&gt;&#13;&#10;   &lt;x:Top&gt;0&lt;/x:Top&gt;&#13;&#10;   &lt;x:Width&gt;9299.99267578125&lt;/x:Width&gt;&#13;&#10;   &lt;x:Height&gt;6255&lt;/x:Height&gt;&#13;&#10;   &lt;x:PivotChart/&gt;&#13;&#10;   &lt;x:ChartGrowth&gt;&#13;&#10;    &lt;x:HorzGrowth&gt;1&lt;/x:HorzGrowth&gt;&#13;&#10;    &lt;x:VertGrowth&gt;1&lt;/x:VertGrowth&gt;&#13;&#10;   &lt;/x:ChartGrowth&gt;&#13;&#10;   &lt;x:PlotArea&gt;&#13;&#10;    &lt;x:Border&gt;&#13;&#10;     &lt;x:ColorIndex&gt;15&lt;/x:ColorIndex&gt;&#13;&#10;     &lt;x:LineStyle&gt;Solid&lt;/x:LineStyle&gt;&#13;&#10;     &lt;x:Weight&gt;Narrow&lt;/x:Weight&gt;&#13;&#10;    &lt;/x:Border&gt;&#13;&#10;    &lt;x:Interior&gt;&#13;&#10;     &lt;x:ColorIndex&gt;14&lt;/x:ColorIndex&gt;&#13;&#10;     &lt;x:BGColorIndex&gt;Neutral&lt;/x:BGColorIndex&gt;&#13;&#10;    &lt;/x:Interior&gt;&#13;&#10;    &lt;x:Font&gt;&#13;&#10;     &lt;x:FontName&gt;Arial&lt;/x:FontName&gt;&#13;&#10;     &lt;x:Size&gt;10&lt;/x:Size&gt;&#13;&#10;     &lt;x:AutoScale/&gt;&#13;&#10;    &lt;/x:Font&gt;&#13;&#10;    &lt;x:Graph&gt;&#13;&#10;     &lt;x:Type&gt;Pie&lt;/x:Type&gt;&#13;&#10;     &lt;x:SubType&gt;Standard&lt;/x:SubType&gt;&#13;&#10;     &lt;x:VaryColors/&gt;&#13;&#10;     &lt;x:FirstSliceAngle&gt;0&lt;/x:FirstSliceAngle&gt;&#13;&#10;     &lt;x:Series&gt;&#13;&#10;      &lt;x:Index&gt;0&lt;/x:Index&gt;&#13;&#10;      &lt;x:Caption&gt;&#13;&#10;       &lt;x:DataSource&gt;0&lt;/x:DataSource&gt;&#13;&#10;       &lt;x:Data&gt;$H$1:$H$4&lt;/x:Data&gt;&#13;&#10;      &lt;/x:Caption&gt;&#13;&#10;      &lt;x:Name&gt;Casos Ingresados - 2001 - Diciembre&lt;/x:Name&gt;&#13;&#10;     &lt;/x:Series&gt;&#13;&#10;     &lt;x:Series&gt;&#13;&#10;      &lt;x:Index&gt;1&lt;/x:Index&gt;&#13;&#10;      &lt;x:Caption&gt;&#13;&#10;       &lt;x:DataSource&gt;0&lt;/x:DataSource&gt;&#13;&#10;       &lt;x:Data&gt;$J$1:$J$4&lt;/x:Data&gt;&#13;&#10;      &lt;/x:Caption&gt;&#13;&#10;      &lt;x:Name&gt;Casos Ingresados - 2002 - Enero&lt;/x:Name&gt;&#13;&#10;     &lt;/x:Series&gt;&#13;&#10;     &lt;x:Series&gt;&#13;&#10;      &lt;x:Index&gt;2&lt;/x:Index&gt;&#13;&#10;      &lt;x:Caption&gt;&#13;&#10;       &lt;x:DataSource&gt;0&lt;/x:DataSource&gt;&#13;&#10;       &lt;x:Data&gt;$L$1:$L$4&lt;/x:Data&gt;&#13;&#10;      &lt;/x:Caption&gt;&#13;&#10;      &lt;x:Name&gt;Porct Incremento - 2001 - Diciembre&lt;/x:Name&gt;&#13;&#10;     &lt;/x:Series&gt;&#13;&#10;     &lt;x:Series&gt;&#13;&#10;      &lt;x:Index&gt;3&lt;/x:Index&gt;&#13;&#10;      &lt;x:Caption&gt;&#13;&#10;       &lt;x:DataSource&gt;0&lt;/x:DataSource&gt;&#13;&#10;       &lt;x:Data&gt;$N$1:$N$4&lt;/x:Data&gt;&#13;&#10;      &lt;/x:Caption&gt;&#13;&#10;      &lt;x:Name&gt;Porct Incremento - 2002 - Enero&lt;/x:Name&gt;&#13;&#10;     &lt;/x:Series&gt;&#13;&#10;     &lt;x:PlotVisible/&gt;&#13;&#10;    &lt;/x:Graph&gt;&#13;&#10;   &lt;/x:PlotArea&gt;&#13;&#10;   &lt;x:Legend&gt;&#13;&#10;    &lt;x:Placement&gt;Right&lt;/x:Placement&gt;&#13;&#10;    &lt;x:Font&gt;&#13;&#10;     &lt;x:FontName&gt;Arial&lt;/x:FontName&gt;&#13;&#10;     &lt;x:Size&gt;10&lt;/x:Size&gt;&#13;&#10;     &lt;x:AutoScale/&gt;&#13;&#10;    &lt;/x:Font&gt;&#13;&#10;   &lt;/x:Legend&gt;&#13;&#10;  &lt;/x:Chart&gt;&#13;&#10; &lt;/x:WebChart&gt;&#13;&#10;&lt;/xml&gt;&lt;![endif]--&gt;">
 <p style='margin-top:100;font-family:Arial;font-size:8.0pt'>Para usar esta
 página Web interactivamente, debe utilizar Microsoft® Internet Explorer 4.0 o
 superior y Microsoft Office Web Components. Visite el <a
 HRef="http://officeupdate.microsoft.com/office/redirect/fromOffice9/MSOWCPub.htm?&amp;HelpLCID=3082">sitio
 Web de Microsoft Office</a> para obtener más información.</p>
</object>

<object id="PivotControl_DSC"
    codebase="file:\\W2abogdc02\Instalar\OFFICE\OF2000.PRM\Disco1\msowc.cab"
 classid="CLSID:0002E530-0000-0000-C000-000000000046" VIEWASTEXT>
 <param name=XMLData
 value="&lt;!--[if gte mso 9]&gt;&lt;xml xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;&#13;&#10; xmlns:x=&quot;urn:schemas-microsoft-com:office:excel&quot;&gt;&#13;&#10; &lt;x:PTSource&gt;&#13;&#10;  &lt;x:DataMember&gt;Bancafe&lt;/x:DataMember&gt;&#13;&#10;  &lt;x:CacheIndex&gt;1&lt;/x:CacheIndex&gt;&#13;&#10;  &lt;x:RefreshName&gt;gonzalop&lt;/x:RefreshName&gt;&#13;&#10;  &lt;x:RefreshDate&gt;2002-01-21T16:54:53&lt;/x:RefreshDate&gt;&#13;&#10;  &lt;x:NoSaveData/&gt;&#13;&#10;  &lt;x:CubeSource/&gt;&#13;&#10;  &lt;x:QuerySource&gt;&#13;&#10;   &lt;x:QueryType&gt;OLEDB&lt;/x:QueryType&gt;&#13;&#10;   &lt;x:CommandText&gt;Bancafe&lt;/x:CommandText&gt;&#13;&#10;   &lt;x:CommandType&gt;Cube&lt;/x:CommandType&gt;&#13;&#10;   &lt;x:Maintain/&gt;&#13;&#10;   &lt;x:Connection&gt;Provider=MSOLAP.1;Data Source=localhost;Initial Catalog=Bancafe;Client Cache Size=25;Auto Synch Period=10000&lt;/x:Connection&gt;&#13;&#10;  &lt;/x:QuerySource&gt;&#13;&#10; &lt;/x:PTSource&gt;&#13;&#10; &lt;x:ElementExtension&gt;&#13;&#10;  &lt;x:ElementID&gt;PivotControl_Chart&lt;/x:ElementID&gt;&#13;&#10;  &lt;x:ConsumesRecordset/&gt;&#13;&#10;  &lt;x:AlternateDataSource&gt;PivotControl&lt;/x:AlternateDataSource&gt;&#13;&#10; &lt;/x:ElementExtension&gt;&#13;&#10; &lt;x:ElementExtension&gt;&#13;&#10;  &lt;x:ElementID&gt;PivotControl&lt;/x:ElementID&gt;&#13;&#10;  &lt;x:ConsumesRecordset/&gt;&#13;&#10; &lt;/x:ElementExtension&gt;&#13;&#10;&lt;/xml&gt;&lt;![endif]--&gt;">
</object>
</p>
<OBJECT id=PivotControl style="LEFT: 0px; WIDTH: 500px; TOP: 0px; HEIGHT: 500px" 
classid=CLSID:0002E520-0000-0000-C000-000000000046><PARAM NAME="XMLData" VALUE='<xml xmlns:x="urn:schemas-microsoft-com:office:excel">&#13;&#10; <x:PivotTable>&#13;&#10;  <x:OWCVersion>9.0.0.5319</x:OWCVersion>&#13;&#10;  <x:CacheDetails/>&#13;&#10; </x:PivotTable>&#13;&#10;</xml>'></OBJECT>
</div>

<SCRIPT language=VBScript>
'Private Function SetArray(ByVal vntInfo As Variant, strVal As String) As Variant
Function SetArray(ByVal vntInfo, strVal)
On Error Resume Next
    Dim iSize 'As Integer
    
    iSize = UBound(vntInfo)
    If Err.Number > 0 Then
        Err.Clear
        ReDim vntInfo(0)
    Else
        'Chequea que no exista
        Dim j 'As Integer
        For j = 0 To iSize
            If StrComp(vntInfo(j), strVal, vbBinaryCompare) = 0 Then
                SetArray = vntInfo
                Exit Function
            End If
        Next
        
        ReDim Preserve vntInfo(iSize + 1)
        iSize = iSize + 1
    End If
    vntInfo(iSize) = strVal
    SetArray = vntInfo
End Function

Function Window_OnLoad() 

Dim strConn 'As String
Dim conn 'As Object 'OWC.DataSourceControl
Dim view 'As OWC.PivotView
Dim j 'As Integer

    strConn = "Provider=MSOLAP.1;Data Source=localhost;Initial Catalog=Bancafe;Client Cache Size=25;Auto Synch Period=10000"

    PivotControl.AllowDetails = False
    PivotControl.AllowPropertyToolbox = False
    PivotControl.DisplayPropertyToolbox = False
'    PivotControl.DisplayToolbar = False
    PivotControl.DisplayFieldList = False

'    PivotControl.DisplayExpandIndicator = False
'    PivotControl.AllowGrouping = False
'    PivotControl.AllowFiltering = False
'    PivotControl.DisplayAlerts = False
    
    PivotControl.ConnectionString = strConn
    PivotControl.DataMember = "Bancafe"
    
    Set conn = PivotControl.Connection
    Set view = PivotControl.ActiveView
    
    ' Pass the statement that creates the new calculated member through
    ' the Connection object.
    '       conn.Execute "Create Set [Bancafe].[Radicaciones] " & _
    '            " as 'Filter(CrossJoin([Oficina de Radicacion].members, [Usuario Radicador].members), NOT IsEmpty([Measures].[Casos Entrados]))' "
        
    conn.Execute "Create Set [Bancafe].[OfRadicaciones] " & _
        " as 'Filter([Informacion Radicacion].members, NOT IsEmpty([Measures].[Casos Entrados]))' "
        
    Dim ret 'As Recordset
    Set ret = conn.Execute("SELECT {[OfRadicaciones]} ON ROWS, {[Measures].[Casos Ingresados]} ON COLUMNS FROM Bancafe")
    
    Dim iNumLevels 'As Integer
    iNumLevels = ret.Fields.Count - 1
    Dim Oficinas 'As Variant
    ReDim Oficinas(iNumLevels) 'As Variant
    While Not ret.EOF
        
    '            For j = 0 To iNumLevels - 1
    '                If Not IsNull(ret.Fields(j).value) And Not IsEmpty(ret.Fields(j).value) Then
    '                    Dim value As String
    '                    Dim iPos As Integer
    '                    iPos = InStrRev(ret.Fields(j).Name, ".")
    '                    value = Left(ret.Fields(j).Name, iPos) & "[" & ret.Fields(j).value & "]"
    '                    Oficinas(j) = SetArray(Oficinas(j), value)
    '                End If
    '            Next
        
        If Not IsNull(ret.Fields(iNumLevels - 1).value) And Not IsEmpty(ret.Fields(iNumLevels - 1).value) Then
            Dim value 'As String
            Dim iPos 'As Integer
            
            iPos = InStr(ret.Fields(0).Name, ".")
            value = Left(ret.Fields(0).Name, iPos - 1)
            For j = 0 To iNumLevels - 1
                value = value & ".[" & ret.Fields(j).value & "]"
            Next
            Oficinas(iNumLevels - 1) = SetArray(Oficinas(iNumLevels - 1), value)
        End If
        ret.MoveNext
    Wend
    
    Dim fld 'As OWC.PivotField
    Dim c 'As Object
    Set c = PivotControl.Constants
    
    'Filtra las radicaciones por cantidad de casos > 0
    For j = iNumLevels - 1 To iNumLevels - 1
        Set fld = view.FieldSets("Informacion Radicacion").Fields(j)
        fld.FilterFunction = c.plFilterFunctionInclude
        fld.FilterMembers = Oficinas(j)
    Next
    
    'Ordena las radicaciones en forma descendente por casos ingresados
    For j = 0 To iNumLevels - 1
        Set fld = view.FieldSets("Informacion Radicacion").Fields(j)
        fld.SortDirection = c.plSortDirectionDescending
        Set fld.SortOn = view.Totals("Casos Ingresados")
        fld.Subtotals(j) = False
        'Solo muestra los dos primeros niveles inicialmente
        If j > 1 Then
			fld.Expanded = False
            fld.GroupedAutoFit = False
            fld.GroupedWidth = 0
        End If
    Next
    
    'Filtra la fecha EXCLUYENDO la fecha "Ninguno"
    Set fld = view.FieldSets("Fecha").Fields(0)
    fld.FilterFunction = c.plFilterFunctionExclude
    fld.FilterMembers = Array("[Fecha].[Ninguno]")
    
    'Ordena la fecha en forma descendente
    For j = 0 To 2
        Set fld = view.FieldSets("Fecha").Fields(j)
        fld.SortDirection = c.plSortDirectionDescending
        Set fld.SortOn = Nothing
        If j > 1 Then
            fld.IsIncluded = False
        End If
        fld.Expanded = True
        fld.Subtotals(j) = False
    Next
    
    'Cambia el formato de los datos
    Dim total 'As OWC.PivotTotal
    Set total = view.Totals("Porct Incremento")
    total.NumberFormat = "[Green][>-0.10]0.00%;[Red]0.00%"
    
    PivotControl.Refresh
    Set view = PivotControl.ActiveView
    
    view.ColumnAxis.InsertFieldSet view.FieldSets("Fecha")
    view.RowAxis.InsertFieldSet view.FieldSets("Informacion Radicacion")
    view.DataAxis.InsertTotal view.Totals("Casos Ingresados")
    view.DataAxis.InsertTotal view.Totals("Porct Incremento")
End function

'Busca el ultimo miembro que haya sido expandido en el pivottable
'Private Function GetMember(ByVal CurMember As OWC.PivotMember, iLevel As Long) 'As OWC.PivotField
Private Function GetMember(ByVal CurMember, iLevel)
Dim ChildMember 'As OWC.PivotMember
Dim iChildLevel 'As Long
Dim tmpLevel 'As Long
Dim tmpPivotField 'As OWC.PivotField

Set GetMember = nothing

    iChildLevel = 0
    For Each ChildMember In CurMember.ChildMembers
        If ChildMember.Expanded Then
            tmpLevel = iLevel + 1
            Set tmpPivotField = GetMember(ChildMember, tmpLevel)
            
            If tmpPivotField Is Nothing Then
                tmpLevel = iLevel + 1
                Set tmpPivotField = ChildMember.Field
            End If
            
            If tmpLevel > iChildLevel Then
                Set GetMember = tmpPivotField
                iChildLevel = tmpLevel
            End If
        End If
    Next
    
    If Not GetMember Is Nothing Then
        iLevel = iChildLevel
    End If
End Function

'Busca el ultimo miembro que haya sido expandido en el pivottable
'Private Function LowerMember(ByVal Members As OWC.PivotMembers) As OWC.PivotField
Private Function LowerMember(ByVal Members )
Dim ChildMember 'As OWC.PivotMember
Dim iChildLevel 'As Long
Dim tmpLevel 'As Long
Dim tmpPivotField 'As OWC.PivotField

set LowerMember = nothing

    iChildLevel = 0
    For Each ChildMember In Members
        If ChildMember.Expanded Then
            tmpLevel = 0
            Set tmpPivotField = GetMember(ChildMember, tmpLevel)
            
            If tmpLevel > iChildLevel Then
                Set LowerMember = tmpPivotField
                iChildLevel = tmpLevel
            End If
        End If
    Next
    
    If LowerMember Is Nothing Then
        Set LowerMember = Members(0).Field
    End If
End Function

Sub PivotControl_Chart_DataSetChange
Dim view 'As OWC.PivotView
Dim fld 'As OWC.PivotField
Dim c 'As Object
Dim iNumLevels 'As Integer
Dim iCurLevel 'As Integer
Dim j 'As Integer

Dim CurFld 'As OWC.PivotField
    
    Set c = PivotControl.Constants
    Set view = PivotControl.ActiveView
    if view is nothing then exit sub
    iNumLevels = view.FieldSets("Informacion Radicacion").Fields.Count
    
    'Busca el ultimo miembro seleccionado expandido en el pivottable
    Set CurFld = LowerMember(PivotControl.ActiveData.RowMembers)
    
    For j = 0 To iNumLevels - 1
        Set fld = view.FieldSets("Informacion Radicacion").Fields(j)
        If fld Is CurFld Then
            iCurLevel = j
            Exit For
        End If
    Next
    
    'Expande visualmente hasta ese elemento
    If iCurLevel + 1 > iNumLevels Then
        iCurLevel = iNumLevels - 1
    End If
    For j = 0 To iCurLevel + 1
        Set fld = view.FieldSets("Informacion Radicacion").Fields(j)
        fld.GroupedAutoFit = True
    Next
    For j = j To iNumLevels - 1
        Set fld = view.FieldSets("Informacion Radicacion").Fields(j)
        
        fld.GroupedAutoFit = False
        fld.GroupedWidth = 0
    Next
    
End Sub

</SCRIPT>

</BODY>
</HTML> 


